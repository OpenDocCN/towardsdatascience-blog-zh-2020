<html>
<head>
<title>A Quicker Way to Build Datasets through Web Scraping</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过网络抓取构建数据集的更快捷方式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-quicker-way-to-build-datasets-through-web-scraping-4ce9e51e16d8?source=collection_archive---------26-----------------------#2020-09-10">https://towardsdatascience.com/a-quicker-way-to-build-datasets-through-web-scraping-4ce9e51e16d8?source=collection_archive---------26-----------------------#2020-09-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="241e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过抓取 Yelp 评论来比较 Autoscraper 和 Selenium + BeautifulSoup</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/62256a2dc181e09d7bdd312fcc05ffff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sRhmtv6SrwQB4OPI"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">托马斯·毕晓普在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b957" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想跳过 HTML 标签的挖掘，直接进入抓取，这里是要点。<strong class="lb iu">注意，scraper 试图与你想要的列表中的每一项进行精确匹配。</strong>否则，请继续阅读有关网络抓取的简短背景知识，这对于抓取网站很有用，以及抓取时您可能会遇到的一些挑战。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="2784" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">背景</h1><p id="e51e" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">我最近在研究美国的泡沫茶趋势。我想看看饮料订单的变化，精品和特许泡泡茶店开业的时间，以及顾客对这些店的评价。很自然地，我转向 Yelp。但是一些限制很快让我退缩了；我被限制在 Yelp API 上的前 1000 个商家，每个商家我只能得到三个 Yelp 精选评论。</p><p id="91d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从商业的角度来看，这是有意义的——你不希望其他企业轻易窥探你的成功和失败，并重复这些。但它也展示了网络抓取的更大不幸。一方面，这是为我们感兴趣的课题获取数据的好方法。另一方面，公司很少希望机器人在他们的网站上互动。即使他们提供了 API，他们也不总是公开所有需要的信息。</p><p id="ebb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">针对网络抓取的安全性也提高了。从标题数据验证，到验证码挑战，再到机器学习指导的行为方法，已经投入了大量工作来使机器人更难祸害网站。最后，大多数页面不会立即用 HTML 提供有用的信息。相反，它们是通过 JavaScript 执行注入的，并且只有在检测到“真实用户”时才注入。</p><p id="daa2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，值得信赖的过程:</p><ol class=""><li id="06ed" class="nb nc it lb b lc ld lf lg li nd lm ne lq nf lu ng nh ni nj bi translated">手动导航到网站</li><li id="8160" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">突出显示感兴趣的部分</li><li id="9581" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">右键单击并检查元素</li><li id="cb89" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">复制 html 标记或 XPath，并使用 BeautifulSoup 之类的库来解析 HTML</li></ol><h1 id="e8e8" class="me mf it bd mg mh np mj mk ml nq mn mo jz nr ka mq kc ns kd ms kf nt kg mu mv bi translated">该过程</h1><p id="8ff9" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">这是我项目中的一个例子。比方说，你想解析 Yelp 上关于某个泡泡茶店的评论<a class="ae ky" href="https://www.yelp.com/biz/chun-yang-tea-flushing-new-york-flushing?osq=bubble%20tea&amp;sort_by=date_desc" rel="noopener ugc nofollow" target="_blank">https://www . Yelp . com/biz/chun-yang-tea-flushing-new York-flushing？osq = bubble % 20 tea&amp;sort _ by = date _ desc</a>(我不属于这家泡泡茶店，也不属于 Yelp。这是我目前项目中的一个样本，分析美国的泡沫茶趋势。)</p><p id="1e4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在动态网页上执行任何 JavaScript，您首先需要设置一个无头浏览器，或者模拟真实浏览器的标题。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="bbf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，将它连接到一个可以从 HTML 和 XML 文件中提取数据的库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="9d0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了找出将我引向评论的特定标签<code class="fe nu nv nw nx b">lemon--span__373c0__3997G raw__373c0__3rKqk</code>，我按照上面编号的步骤列表，突出显示一个示例评论，检查元素，并四处窥探感兴趣的标签。</p><h1 id="542b" class="me mf it bd mg mh np mj mk ml nq mn mo jz nr ka mq kc ns kd ms kf nt kg mu mv bi translated">问题是</h1><p id="506c" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">这实际上是非常脆弱的，因为网站可能会随时改变它们呈现页面的方式。更重要的是，这个过程是多余的，因为我们需要首先手动找到想要的标签，然后才能设置一个自动化的 webscraper。</p><h1 id="5511" class="me mf it bd mg mh np mj mk ml nq mn mo jz nr ka mq kc ns kd ms kf nt kg mu mv bi translated">另一种方法</h1><p id="6b2a" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">与其搜索 HTML 标记或 XPath，为什么不使用简单的匹配规则自动进行手动搜索呢？这是<a class="ae ky" href="https://medium.com/@alirezamika" rel="noopener"> Alireza Mika </a>的<a class="ae ky" href="https://github.com/alirezamika/autoscraper" rel="noopener ugc nofollow" target="_blank"> AutoScraper 库</a>的基本前提。让我们完成搜集 Yelp 评论的相同任务，这次是用 AutoScraper 库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="21c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nu nv nw nx b">AutoScraper</code>对象#3 接受目标 url #1 和想要的项目列表#2，并围绕提供的参数#4 建立一些规则。请注意，它只会标记与感兴趣的项目完全匹配的标签；因此，我列入通缉名单的评论是 Yelp 网页上第一篇完整的评论。</p><p id="b8dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在打印<code class="fe nu nv nw nx b">results</code>时，你将会看到 webscraper 找到的所有元素。您可以使用以下命令在同一个或另一个 url 上再次获取这些结果。</p><p id="253f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nu nv nw nx b">scraper.get_result_similar(url)</code></p><p id="13d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能会注意到，刮刀已经获得了一些无关的信息。您可以微调其选择，方法是首先根据刮刀已学习的规则对其进行分组:</p><pre class="kj kk kl km gt ny nx nz oa aw ob bi"><span id="8cc2" class="oc mf it nx b gy od oe l of og">groups = scraper.get_result_similar(url, grouped=True)</span></pre><p id="63bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于<code class="fe nu nv nw nx b">groups</code>是一个字典，你可以通过调用<code class="fe nu nv nw nx b">print(groups.keys())</code>得到规则的名称</p><p id="911f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以使用特定的规则键入字典:</p><p id="0e8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nu nv nw nx b">groups['rule_io6e']</code></p><p id="7156" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果指定规则的结果准确地反映了期望的结果，你可以选择用方法调用来保持规则:</p><pre class="kj kk kl km gt ny nx nz oa aw ob bi"><span id="21c3" class="oc mf it nx b gy od oe l of og">scraper.keep_rules('rule_io6e')</span></pre><p id="75ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您可以将模型保存到文件中以备后用。</p><pre class="kj kk kl km gt ny nx nz oa aw ob bi"><span id="057d" class="oc mf it nx b gy od oe l of og">scraper.save('yelp-reviews')</span></pre><h1 id="df91" class="me mf it bd mg mh np mj mk ml nq mn mo jz nr ka mq kc ns kd ms kf nt kg mu mv bi translated">最后</h1><p id="ce47" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">当然，这个库并不是万无一失的。如果没有浏览器模拟器，点击量大的网页(如谷歌的商业评论)将很难实现自动化。</p><p id="c910" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于 AutoScraper 希望通缉列表中的物品与网站上出现的物品完全匹配，因此很难确定一个不断更新的值，如股票价格。</p><p id="627d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，作为开发人员，我们的部分职责是将解决方案沿着管道连接在一起，以迭代或创建新产品。希望你可以利用这个抓取库，无论是在 scrapy 这样的框架中，还是只是为了简化你的下一个抓取任务。</p><p id="573e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不管你如何决定刮一个网站，这样做负责任！</p><ol class=""><li id="7746" class="nb nc it lb b lc ld lf lg li nd lm ne lq nf lu ng nh ni nj bi translated"><strong class="lb iu">不要用请求轰炸网站</strong>。这是网络抓取新手犯的头号错误:他们试图通过一次从多个服务器发送多个请求来加快抓取速度——这是一种 DDoS 攻击！</li><li id="184d" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">尊重 robots.txt:你通常可以通过在索引页面添加<code class="fe nu nv nw nx b">robots.txt</code>来找到它们。比如<a class="ae ky" href="https://www.yelp.com/robots.txt" rel="noopener ugc nofollow" target="_blank">https://www.yelp.com/robots.txt</a></li><li id="2477" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">使用提供的 API！</li></ol></div></div>    
</body>
</html>