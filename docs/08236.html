<html>
<head>
<title>Build &amp; Deploy a Spam Classifier app on Heroku Cloud in 10 minutes!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">10 分钟内在 Heroku Cloud 上构建和部署垃圾邮件分类器应用程序！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-deploy-a-spam-classifier-app-on-heroku-cloud-in-10-minutes-f9347b27ff72?source=collection_archive---------48-----------------------#2020-06-16">https://towardsdatascience.com/build-deploy-a-spam-classifier-app-on-heroku-cloud-in-10-minutes-f9347b27ff72?source=collection_archive---------48-----------------------#2020-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ba72" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">垃圾邮件分类器的构建及其在 Heroku 上的应用</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8d23b08307c23a3d757493bac20fb0fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fOZsyCRNkYJEHN6B"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">查尔斯·德鲁维奥在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="854e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天我们将构建一个简洁的垃圾邮件分类器，一个基于自然语言处理的模型。然后，我们将构建一个 flask 应用程序，它将呈现一个基于 HTML 的主页和一个预测页面。用户将在主页中输入文本，应用程序将在预测页面上预测它是否像垃圾邮件或 Ham(非垃圾邮件)。这个 flask API 将部署在 Heroku 上的公共主机中。Heroku 是这里显而易见的选择，因为它超级快，超级容易。我说过它是免费的吗？是的，它是！先自己检查并使用这个应用程序<a class="ae ky" href="https://spamhamheroku.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">这里</a>以了解你将构建什么。</p><p id="e67d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你已经看到了，让我们开始吧！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b601" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">模型</h1><p id="1d19" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">第一步将是建立我们的 NLP 模型，从用户那里获取自然文本，并预测它是垃圾邮件还是垃圾邮件(不是垃圾邮件)。我们将通过几段 python 代码来实现这一点。我的<a class="ae ky" href="https://github.com/chayankathuria/NLP-Heroku" rel="noopener ugc nofollow" target="_blank"> Github </a>上有完整的代码和数据集。首先，让我们导入所有需要的库。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5e8f" class="ne md it na b gy nf ng l nh ni">import pandas as pd  #Pandas for data pre-processing<br/><br/>import pickle #Pickle for pickling (saving) the model <br/><br/>from sklearn.feature_extraction.text import CountVectorizer #To Vectorize the textual data <br/><br/>from sklearn.naive_bayes import MultinomialNB #The algorithm for prediction <br/><br/>from sklearn.externals import joblib #Alternative Usage of Saved Model <br/><br/>from sklearn.model_selection import train_test_split #Validation split</span></pre><p id="4974" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要加载数据，并分成文本数据(X)和标签(y)。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3674" class="ne md it na b gy nf ng l nh ni">df = pd.read_csv("spam.csv", encoding="latin-1")<br/><br/>df.drop(['Unnamed: 2', 'Unnamed: 3', 'Unnamed: 4'], axis=1, inplace=True) #Some garbage features that need to be removed<br/><br/># Text and Labels<br/><br/>df['label'] = df['class'].map({'ham': 0, 'spam': 1}) <br/><br/>X = df['message']<br/><br/>y = df['label']</span></pre><p id="6ea5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要使用计数矢量器对文本数据进行矢量化(将文本转换为数字形式)。然后只需拆分训练和测试数据。没有考虑进一步的文本预处理，因为我们的目标是快速构建模型并部署它。可以自己试验一下文字清理部分，让性能更好。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1186" class="ne md it na b gy nf ng l nh ni"># Extract Feature With CountVectorizer <br/><br/>cv = CountVectorizer() <br/><br/>X = cv.fit_transform(X) # Fit the Data <br/><br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)</span></pre><p id="a7a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦完成，我们只需要拟合模型，并将其保存为 pickle 文件，稍后将加载到 flask 应用程序中。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="95d5" class="ne md it na b gy nf ng l nh ni">#Naive Bayes Classifier  <br/><br/>clf = MultinomialNB() <br/>clf.fit(X_train,y_train) <br/>print(clf.score(X_test,y_test)) <br/><br/>#Alternative Usage of Saved Model <br/><br/>joblib.dump(clf, 'NB_spam_model.pkl') <br/>joblib.dump(cv, 'cv.pkl')</span></pre><p id="dfc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们已经保存了朴素贝叶斯模型和计数矢量器。这是因为对于您来说，从用户处获取的文本输入必须使用与模型训练时相同的计数矢量器参数进行矢量化。好了，现在我们有了模型和矢量器。</p><p id="feb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要构建 flask 应用程序，它将把我们刚刚构建的 NLP 模型连接到我们的浏览器，然后在云上托管它。</p><h1 id="1710" class="mc md it bd me mf nj mh mi mj nk ml mm jz nl ka mo kc nm kd mq kf nn kg ms mt bi translated">烧瓶应用程序</h1><p id="b96d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">只要用户访问应用程序的 URL，flask 应用程序就会将用户路由到主页。稍后，当用户输入文本并点击预测按钮时，它会将其重定向到预测页面并呈现输出。让我们看看它是怎么做的。</p><p id="3002" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要导入 flask 和其他一些功能。如果您还没有安装 flask，那么您需要通过一个简单的 pip install 命令来安装它。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="62ae" class="ne md it na b gy nf ng l nh ni">from flask import Flask, render_template, request</span></pre><p id="30ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，<em class="no"> Flask </em>将用于定义我们正在使用的 app。然后<em class="no"> render_template </em>会渲染首页(home.html)和预测页面(result.html)。并且<em class="no">请求</em>将被用于检索文本输入，该文本输入将通过 HTML Post 方法从 HTML 页面发送到 flask 应用程序。</p><p id="63ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要定义 flask 应用程序及其到主页的默认路由，即 home.html。我们将定义一个函数，当应用程序 URL 被调用时，该函数除了显示主页之外什么也不做。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="dba6" class="ne md it na b gy nf ng l nh ni">app = Flask(__name__) <br/><br/>@app.route('/') #Routes the app to below task when the URL is called <br/><br/>def home(): <br/><br/>    return render_template('home.html')</span></pre><p id="a11b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是应用程序的主要部分，预测。我们需要定义一个函数来打开和加载 NLP 模型，并对矢量器 pickle 文件进行计数。然后，它检索通过 POST 方法发送给它的文本输入。然后，使用相同的矢量器对检索到的文本输入进行矢量化，并转储到我们的模型中以获得预测。就是这样！我们现在只需要在预测页面上呈现这个预测结果，我们就完成了。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="05dc" class="ne md it na b gy nf ng l nh ni">def predict_fun(): <br/><br/>    NB_spam_model = open('NB_spam_model.pkl','rb') <br/>    clf = joblib.load(NB_spam_model)<br/>	<br/>    cv_model = open('cv.pkl', 'rb')<br/>    cv = joblib.load(cv_model)	<br/>	<br/>    if request.method == 'POST': <br/><br/>        message = request.form['message'] <br/>        data = [message] <br/>        vect = cv.transform(data).toarray()<br/>        my_prediction = clf.predict(vect) <br/><br/>    return render_template('result.html',prediction = my_prediction)   <br/><br/>#Calling the main function and running the flask app <br/><br/>if __name__ == '__main__':<br/>    app.run(debug=True)</span></pre><p id="f97b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的模型和烧瓶应用程序已经完成。我们现在只需要在 Heroku 上部署这些文件。</p><h1 id="27c6" class="mc md it bd me mf nj mh mi mj nk ml mm jz nl ka mo kc nm kd mq kf nn kg ms mt bi translated">部署</h1><p id="20db" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要在 Heroku 上部署应用程序，您需要将所有链接到 Heroku 的文件推送到 Github 上。您需要将以下文件上传到您的存储库:</p><ol class=""><li id="256b" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">NLP 模型泡菜</li><li id="2fce" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">计数矢量器泡菜</li><li id="94ae" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">烧瓶应用程序</li><li id="004e" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">HTML 和 CSS 文件</li><li id="c747" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">需求文件</li><li id="b7f8" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">Procfile</li></ol><p id="f81c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的，你可能想知道什么是需求和 procfile 文件。需求是一个文本文件，其中包含所有的依赖关系(如熊猫，烧瓶等库。)以及应用程序按预期运行所需的版本。Heroku 将在部署应用程序之前安装所有这些依赖项。Procfile 是一个配置文件，看起来类似于:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="f106" class="ne md it na b gy nf ng l nh ni">web: gunicorn app1:app</span></pre><p id="0076" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的“app1”是我的 flask 文件名，即“app 1 . py”,“app”是我们在上面的代码中定义的 flask 应用程序。这只是告诉 Heroku 查找名为 app1 的 flask 文件，并在其中查找定义为“app”的 flask 应用程序。</p><p id="e6c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你把所有的文件推送到一个新的 github 库，你需要在 Heroku 上创建一个应用程序，并把你的 github 库连接到它。要做到这一点，只需前往<a class="ae ky" href="https://dashboard.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a> <a class="ae ky" href="https://dashboard.heroku.com/" rel="noopener ugc nofollow" target="_blank">。</a>如果您还没有帐户，请创建一个帐户，然后转到“创建新应用程序”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/28d2f5fb073b83ae00621787d155eb22.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*aRYhk2zktIOeyRlSFlD6EA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建新应用程序</p></figure><p id="9732" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在新创建的应用程序中，您需要连接到包含代码的 github 存储库。在搜索框中搜索 github 库名称，然后点击“连接”按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/42904ffcc2bc1bf4c2091d988f3b74af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eG-y6hxvgfXZ6RrB4sNH9A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将 Github 存储库连接到 Heroku</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/afd36cee86896a4595ee5fcabb23d88e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IA8zpvIdadw-xo3nZe_giQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Github 已连接</p></figure><p id="ad11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦连接，你只需要点击“部署”按钮，你就完成了！Heroku 将首先检查需求文件并安装所有依赖项，然后将 flask 应用程序部署到公共主机。将生成一个 URL，它是您的应用程序的 URL。只需复制并在浏览器中打开它，瞧！你完了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/1511824a1ffc43f14d37c775bfbf5378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*suQq0JsORzppZQfp5EDMIw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">点击部署！</p></figure><p id="593e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是本教程的内容。希望你让应用程序运行，并得到体面的结果！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/b5a01e4f255854057a305894a56b9301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*msJ-PF9ela2GM2rUME552g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">输入一些“spamish”测试</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/724082bbc2645049df2c2048ac97d520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WymDHV2zByIxmFfi1lzIlQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在那里！</p></figure><p id="54f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你已经走了这么远，并准备好了应用程序，给自己一个鼓励。你应得的！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="1f18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我们在这里使用了 Heroku Cloud，因为它安装起来很快也很容易。然而，我鼓励你也尝试在其他云平台上部署该应用程序——如 AWS EC2、谷歌云平台和 Azure。</p><p id="8811" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请随意从我的<a class="ae ky" href="https://github.com/chayankathuria/NLP-Heroku" rel="noopener ugc nofollow" target="_blank"> github </a>获取源代码，如果有任何疑问和建议，请在<a class="ae ky" href="https://www.linkedin.com/in/chayankathuria/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系我。</p><p id="0f1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一篇帖子再见，干杯！</p></div></div>    
</body>
</html>