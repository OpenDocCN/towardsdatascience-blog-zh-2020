<html>
<head>
<title>How to Extract Data from Twitter through Cloud Computing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何通过云计算从Twitter中提取数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-a-dataset-with-twitter-and-cloud-computing-fcd82837d313?source=collection_archive---------22-----------------------#2020-04-13">https://towardsdatascience.com/how-to-create-a-dataset-with-twitter-and-cloud-computing-fcd82837d313?source=collection_archive---------22-----------------------#2020-04-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="72f5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过使用Python和Tweepy库。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c81e56ff697f788721ce46f525ca04f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Lzc35WOiyQyw2N7s"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@dole777?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> dole777 </a>拍摄</p></figure><p id="58ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于有抱负的数据分析师和数据科学家来说，Twitter是一个很好的信息来源。它也是辩论和争论的场所。此外，Twitter可以成为文本数据的良好资源；它有一个API，凭证很容易获得，并且有许多Python库可以帮助调用Twitter的API。</p><p id="0ae5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建立投资组合的一种方式是获得自己的自然语言处理项目，但就像每个项目一样，第一步是获得数据，然后通过使用亚马逊网络服务(AWS)将这些数据保存在本地计算机或云上。</p><p id="98f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，建立这个管道的资源是很棒的，但是它们有一些很容易让人头疼的怪癖。在本文中，我将向您展示如何建立一个简单的管道流程，并帮助您浏览该流程，避免那些令人头痛的问题。考虑这篇文章你的赛前泰诺！</p><p id="3abc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很好，对吗？所以，坚持住。</p><p id="9f02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过四个步骤，我将演示如何建立下面的管道。第一步包括使用来自Twitter的API收集数据，然后向您展示如何启动EC2实例，将其连接到kinesis，最后使用Python脚本将数据传输到AWS上的S3(数据湖)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/055626899ed659b078c4f7443d5b3ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FOpri2FiNeju2Elk9BLweg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从Twitter到S3的管道</p></figure><p id="0b62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你准备好掌握所有这些了吗？</p><h1 id="0a25" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第一步:在Twitter上建立你的开发者账户，并获得你的证书</h1><p id="d62f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><strong class="lb iu">给自己弄一个账号:</strong>一个Twitter用户账号是拥有一个“开发者”账号的要求，所以要么注册一个新账号，要么登录一个现有账号，简直易如反掌。</p><p id="a698" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">创建app: </strong>在<a class="ae ky" href="https://developer.twitter.com/en/apps" rel="noopener ugc nofollow" target="_blank">https://developer.twitter.com/en/apps</a>注册app。设置好之后，转到“令牌和密钥”来生成访问令牌和秘密令牌。连同消费者API密钥(已经生成)，这些是我们将用来与Twitter API通信的凭证。我也将这些凭证用于Python脚本。我建议将凭证保存在文本文件中，因为我们将在后面的阶段使用这些凭证。</p><h1 id="4312" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">步骤2:创建一个AWS帐户</h1><p id="b6ff" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在这个项目中，你需要使用来自亚马逊的三个不同的服务:<strong class="lb iu"> EC2实例</strong>、<strong class="lb iu"> Kinesis </strong>(数据流)和<strong class="lb iu"> S3 </strong>(数据湖)来建立管道。您需要创建一个帐户，并在此帐户下注册您的信用卡；亚马逊根据你对服务的使用情况收费。关于费用，不用担心。你在这个项目中使用的服务并不昂贵；在我的项目中，我每月花费不到<strong class="lb iu">5-6加元</strong>。如果你需要使用其他服务，我建议你事先检查一下费用。请注意，偶尔查看一下您的账单总是一个好习惯，以确保您不会对此感到惊讶，并且如果您不再需要它，不要忘记终止服务或实例。</p><p id="2f41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，在EC2管理控制台中，创建一个私钥对，您将使用它来设置EC2实例。此外，在接下来的步骤中，正确设置“安全组”以允许您的IP进行SSH访问。</p><p id="b0fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，通过7个步骤启动一个<strong class="lb iu"> EC2实例。在我的项目中，我使用了一个简单的t2.micro，它足以提取tweets，你可以只使用一个实例，大小为8gb。如果你想知道更多关于如何建立EC2的细节，我建议你看看下面Connor Leech的这篇好文章。请注意，您的第一年EC2 <strong class="lb iu"> t2.micro </strong>实例将是免费的，直到达到某个阈值。</strong></p><div class="mv mw gp gr mx my"><a href="https://medium.com/employbl/how-to-launch-an-ec2-instance-de568295205d" rel="noopener follow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd iu gy z fp nd fr fs ne fu fw is bi translated">如何启动Amazon EC2实例</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">在这篇文章中，我们将在Amazon Web Services托管的云中创建一个Linux虚拟机。我们打算…</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">medium.com</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm ks my"/></div></div></a></div><p id="318c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">EC2实例是一个处理器或CPU，在这个项目中，我们通过使用python脚本来收集数据(我将在下面解释)。</p><p id="02e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">EC2实例是一个处理器或CPU，在这个项目中，您的实例通过使用Python脚本从Twitter中提取数据来收集数据(我将在下面解释)。</p><p id="0e18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> S3 </strong>是一个数据湖，对于阅读本文的新手来说，这是存储由EC2实例收集的原始数据的服务。在我的项目中，我决定让我的S3公开，以便连接其他软件，比如Apache Spark，并减少访问问题。我知道这不是最好的做法，因为其他人可以访问你的数据，但在这个项目中，这是可以的，我不处理敏感数据。</p><p id="7810" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">亚马逊Kinesis数据流</strong> (KDS)是一个极具扩展性和可持续性的实时数据交付服务。该服务是EC2实例和S3之间的“管道”。因此，在设置此服务的过程中，您需要将其链接到您的S3，方法是指明存储桶(即文件夹)的名称，并指明您希望如何保存收集的数据。</p><p id="ce6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦所有的服务都准备好并链接起来，我们就可以进入下一步了。</p><h1 id="8cc8" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">第三步:了解API和Tweepy </strong></h1><p id="858f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Twitter上关于API的文档相当不错，但是对于该领域的初学者来说可能有点混乱。我有几个问题要理解API是如何工作的，我希望您在阅读完这一部分后会清楚。</p><p id="aba3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在下面的链接中找到开展这个项目的大部分信息:</p><div class="mv mw gp gr mx my"><a href="https://developer.twitter.com/en/docs/tweets/tweet-updates" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd iu gy z fp nd fr fs ne fu fw is bi translated">推文更新</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">本文档概述了开发者对已经到位的Tweets的更改的指导，以允许人们…</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">developer.twitter.com</p></div></div><div class="nh l"><div class="nn l nj nk nl nh nm ks my"/></div></div></a></div><p id="e4bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Twitter的API允许你提取不同的数据字段，包含每个用户的推文内容、用户名、位置、日期和关注者数量。在这个项目中，我将提取所有这些字段。</p><p id="1f9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了提取推文，你需要我们使用Tweepy包。这是一个Python库，可以方便地使用Twitter API。首先，您需要使用之前创建并存储在文本文件中的身份验证凭证来设置API对象。这是一个带有数据和一些帮助方法的Tweepy模型类实例。</p><div class="mv mw gp gr mx my"><a href="http://docs.tweepy.org/en/v3.6.0/api.html#tweepy-api-twitter-api-wrapper" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd iu gy z fp nd fr fs ne fu fw is bi translated">API参考- tweepy 3.5.0文档</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">本页包含Tweepy模块的一些基本文档。模块中直接提供了例外情况…</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">docs.tweepy.org</p></div></div></div></a></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d8b72e31ebded4af3aa1f61f587787f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z1rlrR3FwQZsjPvC"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@lucabravo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卢卡·布拉沃</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="5acf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">脚本的第一步包括加载您想要使用的不同Python库，它们是<em class="no"> tweepy </em>、<em class="no"> json </em>、<em class="no"> boto3 </em>和<em class="no"> time </em>。然后，您输入来自Twitter的凭证。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="38f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，输入代码来解析tweets并将其导出到json/text文件中。该脚本分为两个主要部分。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="107c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一部分叫做听众。正是在这个块中，我们从API中提取数据并打印出来。以下是脚本将为此项目记录的信息:</p><ul class=""><li id="24ae" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">用户名</li><li id="6000" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">用户屏幕名称</li><li id="1c19" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">推特内容</li><li id="4fca" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">用户关注者计数</li><li id="5486" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">用户位置</li><li id="fe82" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">地理定位</li><li id="0a8b" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">推特时间</li></ul><p id="c998" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据您进行的项目，我鼓励您根据自己的方便来修改这一部分(例如，删除不需要的字段)。</p><p id="a890" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在这个项目中了解到的一个奇怪的方面是，Twitter最初限制其用户只能发140个字符的推文，2017年11月，Twitter开始允许其用户发最多240个字符的推文。</p><p id="ccda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使API适应这一新变化，Twitter创建了另一个新的字段，称为“extended tweet ”,其中显示了长tweet的所有内容。因此，如果一条tweet超过180个字符，并且您想要提取整个tweet，您需要提取这个字段，而如果tweet少于180个字符，您需要提取最初的tweet字段，名为“text”。不完全是本能，对吧？</p><p id="ceb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们回到剧本上。为了容纳和提取扩展的tweet，我创建了一个if/elif条件。如果API有一个“extended tweet”字段(这意味着tweet超过180个字符)，提取它；否则，提取“文本”字段。</p><p id="f1ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一部分是身份验证和与Twitter流媒体API的连接，然后在下面输入您的AWS凭据(请注意，这不是推荐的)，并输入您在上一步中设置的kinesis的名称。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="ac47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，你需要输入你想要追踪和收集的关键词，用哪种语言。在我的项目中，我决定用英语和法语关注包含#giletsJaunes的推文。你可以追踪多个标签。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="1d33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是<a class="ae ky" href="https://github.com/walkyrie67/project2_big_data_gilets_jaunes/blob/master/script_python_twitter_extended_nokeys.py" rel="noopener ugc nofollow" target="_blank">完整脚本</a>的链接。</p><h1 id="9892" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">步骤4:使用screen在AWS上运行代码</h1><p id="877d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在，管道和Python脚本已经准备好了，您可以使用之前在步骤2中创建的EC2实例开始运行脚本。</p><p id="f4f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先使用下面的命令登录到EC2:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="5b06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在你的EC2上安装几个包:<em class="no"> python3 </em>和<em class="no"> tweepy </em>，以便顺利运行你的python脚本。然后，通过在终端上使用以下命令，将位于本地机器上的Python脚本上传到EC2:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="5ff1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为您需要长时间运行脚本，所以您可能希望在EC2上打开一个“屏幕”,在后台运行作业。这允许您关闭EC2的终端并运行它而不进行检查。</p><p id="592d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是使用<em class="no">屏幕</em>的主要命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="48d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，一旦您的“屏幕”设置完毕，您只需通过输入以下命令来运行您的脚本:</p><blockquote class="of og oh"><p id="f02e" class="kz la no lb b lc ld ju le lf lg jx lh oi lj lk ll oj ln lo lp ok lr ls lt lu im bi translated">python3 my_script.py</p></blockquote><p id="335f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您输入它，您应该看到EC2实例收集的所有tweetss，这些tweet将保存在您的S3中。</p><h1 id="e563" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">第五步:监控你的渠道</strong></h1><p id="682d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">通过登录AWS，您将能够看到您的管道活动。一个很酷的功能是kinesis中的“监控”标签。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/d269eadb6bd875f42ce44f4583631e1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TlSGjfSmozPJHDxNFZbu_A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Kinesis消防水管输送流中的输入记录</p></figure><p id="db4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在该图中，您可以看到一段时间内收集的推文活动。在我的项目中，看起来#giletsjaunes标签在周六和周日比平时更活跃。你也可以查看在你的S3数据湖中创建的文件，把文件下载到你的本地机器上，然后查看保存的推文。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/5eece0ab3e3ce9bb7ee706253060ccfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9L3jwhUMrczbBrTJYRDX6A.png"/></div></div></figure><p id="85b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您已经准备好进入下一步，通过使用另一个AWS服务或Apache Spark来分析本地机器中的数据。</p></div></div>    
</body>
</html>