<html>
<head>
<title>Training, Tracking, Analyzing, Interpreting and Serving Models with One Line of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用一行代码训练、跟踪、分析、解释和服务模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/training-tracking-analyzing-interpreting-and-serving-models-with-one-line-of-code-785ea3b0668b?source=collection_archive---------22-----------------------#2020-01-23">https://towardsdatascience.com/training-tracking-analyzing-interpreting-and-serving-models-with-one-line-of-code-785ea3b0668b?source=collection_archive---------22-----------------------#2020-01-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/67c07ef6ac6bd82e2d8eff77595b4df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kLOs-ZxKXEjl5GByo83M7w.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">贾斯汀·杰拉姆从<a class="ae jg" href="https://www.instagram.com/jusspreme/?hl=en" rel="noopener ugc nofollow" target="_blank"> @jusspreme </a>拍摄的照片</p></figure><div class=""/><div class=""><h2 id="94d9" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">自动化模型训练、跟踪、分析、解释和服务文件生成，每一项只需一行代码</h2></div><p id="f488" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为一名数据科学家，快速实验极其重要。如果一个想法不起作用，最好是快速失败，尽早发现。</p><p id="d09a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">说到建模，快速实验已经相当简单了。所有模型实现都遵循相同的 API 接口，因此您所要做的就是初始化模型并训练它。当您必须解释、跟踪和比较每个模型时，问题就来了。</p><p id="6aba" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你是把你所有的模型做成一个大笔记本，然后上下滚动，还是用一个目录表来查看不同模型的结果？你会为每个型号创建不同的笔记本，然后在笔记本之间来回翻转吗？如果您开始调整参数，您如何跟踪模型的迭代？你把工件存放在哪里，以便日后再次访问或进一步分析？</p><p id="c6ab" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将通过训练多个模型来演示解决这些问题的方法，每个模型只有一行代码，轻松查看整体结果，分析模型，解释模型，在 MLFlow 中跟踪模型，并使用 Aethos 为它们提供服务。</p><h1 id="048a" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">准备数据</h1><p id="3868" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我们将使用 Aethos 快速准备数据。有关如何使用 Aethos 分析和转换数据集的更多信息，请点击这里查看我之前的博文<a class="ae jg" rel="noopener" target="_blank" href="/aethos-a-data-science-library-to-automate-workflow-17cd76b073a4">。从 Aethos repo 载入泰坦尼克号的训练数据。</a></p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="c9dc" class="na lv jj mw b gy nb nc l nd ne">import aethos as at<br/>import pandas as pd</span><span id="7e6e" class="na lv jj mw b gy nf nc l nd ne">data = pd.read_csv('<a class="ae jg" href="https://raw.githubusercontent.com/Ashton-Sidhu/aethos/develop/examples/data/train.csv'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/Ashton-Sidhu/aethos/develop/examples/data/train.csv')</a></span></pre><p id="2a74" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将数据传入 Aethos。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="c997" class="na lv jj mw b gy nb nc l nd ne">df = at.Data(data, target_field='Survived')</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ng"><img src="../Images/3184139df738980630bd73fb058564db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TupqtKz0HX7w1KdAw5RcNA.png"/></div></div></figure><p id="a5f8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这篇文章的重点是建模，所以让我们快速预处理数据。我们将使用幸存者、Pclass、性别、年龄、票价和上船特征。在此插入</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="c7cf" class="na lv jj mw b gy nb nc l nd ne">df.drop(keep=['Survived', 'Pclass', 'Sex', 'Age', 'Fare', 'Embarked'])</span><span id="cc76" class="na lv jj mw b gy nf nc l nd ne">df.standardize_column_names()</span></pre><p id="ec5e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">替换“年龄”和“已装船”列中缺少的值。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="5a45" class="na lv jj mw b gy nb nc l nd ne">df.replace_missing_median('age')<br/>df.replace_missing_mostcommon('embarked')</span></pre><p id="ccf7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对年龄和票价列中的值进行规范化，并对性别、阶级和上船特征进行编码。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="9f3a" class="na lv jj mw b gy nb nc l nd ne">df.onehot_encode('sex', 'pclass', 'embarked', keep_col=False)<br/>df.normalize_numeric('fare', 'age')</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nh"><img src="../Images/996067a5717ff90d9e70d720b2761819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hjvdWaRUnBu0aR_vZeUetA.png"/></div></div></figure><p id="62c8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用 Aethos，转换器适合训练集并应用于测试集。只需一行代码，您的训练集和测试集就已经完成了转换。</p><h1 id="aff8" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">系统模型化</h1><p id="d2b8" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">来训练 Sklearn，XGBoost，LightGBM 等。使用 Aethos 的模型，首先从数据争论对象转换到模型对象。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="8d55" class="na lv jj mw b gy nb nc l nd ne">model = at.Model(df)</span></pre><p id="0c43" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">模型对象的行为方式与数据对象相同，因此如果您有已经处理过的数据，您可以用与数据对象相同的方式启动模型对象。</p><p id="ce14" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将使用 MLFlow 启用实验跟踪。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="6494" class="na lv jj mw b gy nb nc l nd ne">at.options.track_experiments = True</span></pre><p id="5ac1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在一切都设置好了，训练模型并获得预测就像这样简单:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="b8ab" class="na lv jj mw b gy nb nc l nd ne">lr = model.LogisticRegression(C=0.1)</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ni"><img src="../Images/571294a0e4308125a51e1f6cceede36d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ld17UeHatYiPPX814iZrNA.png"/></div></div></figure><p id="9753" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要使用 Gridsearch 使用最佳参数训练模型，请在初始化模型时指定<code class="fe nj nk nl mw b">gridsearch</code>参数。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="2877" class="na lv jj mw b gy nb nc l nd ne">lr = model.LogisticRegression(gridsearch={'C': [0.01, 0.1]}, tol=0.001)</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nm"><img src="../Images/58ebec4e46d996b8f1a1aa1ff377072b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9WwmWTEq_qYnYdYn9Rq9WQ.png"/></div></div></figure><p id="9c59" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将返回具有由 Gridsearch 评分方法定义的最佳参数的模型。</p><p id="09b5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，如果您想交叉验证您的模型，有几个选项:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="419f" class="na lv jj mw b gy nb nc l nd ne">lr = model.LogisticRegression(cv=5, C=0.001)</span></pre><p id="c987" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将对您的模型执行 5 重交叉验证，并显示平均分数和学习曲线，以帮助衡量数据质量、过度拟合和欠拟合。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nn"><img src="../Images/f6748277ccf3658013503a8cc2265fd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hGvqawspAru2kLueK_3g6g.png"/></div></div></figure><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nm"><img src="../Images/58ebec4e46d996b8f1a1aa1ff377072b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9WwmWTEq_qYnYdYn9Rq9WQ.png"/></div></div></figure><p id="1a02" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您也可以将它与 Gridsearch 一起使用:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="5755" class="na lv jj mw b gy nb nc l nd ne">lr = model.LogisticRegression(cv=5, gridsearch={'C': [0.01, 0.1]}, tol=0.001)</span></pre><p id="3f6a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将首先使用 Gridsearch 用最佳参数训练一个模型，然后交叉验证它。目前支持的交叉验证方法有 k-fold 和分层 k-fold。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi no"><img src="../Images/5f12512d2d6e4dd19577e0b95933ea3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hu087E2e7sNrXFNsyzzVdg.png"/></div></div></figure><p id="4e67" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要一次训练多个模型(串行或并行)，在定义模型时指定<code class="fe nj nk nl mw b">run</code>参数。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="5f0a" class="na lv jj mw b gy nb nc l nd ne">lr = model.LogisticRegression(cv=5, gridsearch={'C': [0.01, 0.1]}, tol=0.001, run=False)</span></pre><p id="0a3d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们再找几个模特来训练:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="79b0" class="na lv jj mw b gy nb nc l nd ne">model.DecisionTreeClassification(run=False)<br/>model.RandomForestClassification(run=False)<br/>model.LightGBMClassification(run=False)</span></pre><p id="4967" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以通过运行以下命令来查看排队模型和定型模型:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="8614" class="na lv jj mw b gy nb nc l nd ne">model.list_models()</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi np"><img src="../Images/70d43b9520ddd2430d69f670b25b0ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2PoK5XdML01ObWDxPgLHQ.png"/></div></div></figure><p id="e89c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，默认情况下，并行运行所有排队的模型:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="756d" class="na lv jj mw b gy nb nc l nd ne">dt, rf, lgbm = model.run_models()</span></pre><p id="b75f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你现在可以去喝杯咖啡或吃顿饭，而你所有的模型同时接受训练！</p><h2 id="65d3" class="na lv jj bd lw nq nr dn ma ns nt dp me lh nu nv mg ll nw nx mi lp ny nz mk oa bi translated">分析模型</h2><p id="0bd7" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">默认情况下，您训练的每个模型都有一个名称。这允许您使用相同的模型对象和 API 训练同一模型的多个版本，同时仍然可以访问每个单独模型的结果。在 Jupyter 笔记本中按下<code class="fe nj nk nl mw b">Shift + Tab</code>可以在功能头看到每个型号的默认名称。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/8f4291c15ff6baf178c19a9c14d998d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v6Nhfwh8MRJTZDY7IvkShA.png"/></div></div></figure><p id="304e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您也可以通过在初始化函数时指定您选择的名称来更改模型名称。</p><p id="1124" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，让我们比较一下我们训练过的所有模型:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="b899" class="na lv jj mw b gy nb nc l nd ne">model.compare_models()</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/c9062b64c90f937d790201680f7d0c54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ldjb-jJzEj9juJTvibsiPA.png"/></div></div></figure><p id="34fc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以根据各种指标查看每个型号的性能。在数据科学项目中，有一些预定义的指标，您希望将模型与这些指标进行比较(如果没有，您应该这样做)。您可以通过选项来指定那些项目度量。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="6d38" class="na lv jj mw b gy nb nc l nd ne">at.options.project_metrics = ['Accuracy', 'Balanced Accuracy', 'Zero One Loss']</span></pre><p id="2775" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，当您比较模型时，您将只看到项目度量。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="1a8e" class="na lv jj mw b gy nb nc l nd ne">model.compare_models()</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/25ec40420cd5ee04a06042acb9ab3fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mnUB5A81jPm73JSDqKhFFQ.png"/></div></div></figure><p id="03ae" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您还可以通过运行以下命令来查看单个模型的指标:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="6d05" class="na lv jj mw b gy nb nc l nd ne">dt.metrics() # Shows metrics for the Decision Tree model<br/>rf.metrics() # Shows metrics for the Random Forest model<br/>lgbm.metrics() # Shows metrics for the LightGBM model</span></pre><p id="bb51" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以使用相同的 API 来查看每个模型的 RoC 曲线、混淆矩阵、错误分类预测的指数等。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="3b54" class="na lv jj mw b gy nb nc l nd ne">dt.confusion_matrix(output_file='confusion_matrix.png') # Confusion matrix for the Decision Tree model</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi od"><img src="../Images/6c5fbca1a8af76f8ccdf1f191d3f42f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*ZfamBQhQuMjFH7aI6gc2VQ.png"/></div></figure><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="42b0" class="na lv jj mw b gy nb nc l nd ne">rf.confusion_matrix(output_file='confusion_matrix.png') # Confusion matrix for the random forest model</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/f685cb6f91490a2bfb1b81e4d7fac864.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*oARwsa2CRquJKnnCw9vUog.png"/></div></figure><h2 id="07a4" class="na lv jj bd lw nq nr dn ma ns nt dp me lh nu nv mg ll nw nx mi lp ny nz mk oa bi translated">解释模型</h2><p id="7d12" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">Aethos 配备了自动 SHAP 用例来解释每个模型。您可以查看任何模型的 force、decision、summary 和 dependence 图，每个图都有可定制的参数来满足您的用例。</p><p id="9cb4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过指定<code class="fe nj nk nl mw b">output_file</code>参数，Aethos 知道为特定的模型保存和跟踪这个工件。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="1143" class="na lv jj mw b gy nb nc l nd ne">lgbm.decision_plot(output_file='decision_plot.png')</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi of"><img src="../Images/faf84b33b949eac3911813b3b43eab4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*7NbpF_RkZZyH7daFfjDQ5Q.png"/></div></figure><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="3530" class="na lv jj mw b gy nb nc l nd ne">lgbm.force_plot(output_file='force_plot.png')</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi og"><img src="../Images/629792482a03171a428099ac1361257b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ch0FccSmO0EhP4jVaViq9Q.png"/></div></div></figure><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="3fb4" class="na lv jj mw b gy nb nc l nd ne">lgbm.shap_get_misclassified_index()<br/># [2, 10, 21, 38, 43, 57, 62, 69, 70, 85, 89, 91, 96, 98, 108, 117, 128, 129, 139, 141, 146, 156, 165, 167, 169]<br/>lgbm.force_plot(2, output_file='force_plot_2.png')</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/4ac1154f9fd137b812ba834534217745.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Ng-OvO4PohgDaUL989CzQ.png"/></div></div></figure><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="8b76" class="na lv jj mw b gy nb nc l nd ne">lgbm.summary_plot(output_file='summary_plot.png')</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/9a0cb97cc9fbac6674fb8d719f56000c.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*ZQAH1vFeeb0foFn1lTqvvA.png"/></div></figure><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="3a1c" class="na lv jj mw b gy nb nc l nd ne">lgbm.dependence_plot('fare', output_file='dep_plot.png')</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/4dd37016d7d0524c7b72eb73d02e8d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*3FYBXislUhjrPn5xxQeKDQ.png"/></div></figure><p id="905e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要获得更自动化的体验，请运行:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="2b83" class="na lv jj mw b gy nb nc l nd ne">lgbm.interpret_model()</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ok"><img src="../Images/7c7d084c570ded8143e9b69b711e1999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*omCNzoZiRl764wukTZC4LA.png"/></div></div></figure><p id="349a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将显示一个交互式仪表板，您可以在其中使用石灰、SHAP、莫里斯敏感度等来解释您的模型的预测。</p><h2 id="2336" class="na lv jj bd lw nq nr dn ma ns nt dp me lh nu nv mg ll nw nx mi lp ny nz mk oa bi translated">在 MLFlow 中查看模型</h2><p id="1215" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">当我们训练模型和查看结果时，我们的实验会被自动跟踪。如果从命令行运行<code class="fe nj nk nl mw b">aethos mlflow-ui</code>，将会启动一个本地 MLFlow 实例，供您查看实验的结果和工件。导航到<a class="ae jg" href="http://127.0.0.1:10000" rel="noopener ugc nofollow" target="_blank"> localhost:10000。</a></p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ol"><img src="../Images/6b031886aa87a041ce8be19a7a6e8a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sGYV3PXwZfiaGgVS5LHYFw.png"/></div></div></figure><p id="1625" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您的每个模型和任何保存的工件都被跟踪，并且可以从 UI 中查看，包括参数和度量！要查看和下载模型工件，包括特定模型的 pickle 文件，单击 date 列中的超链接。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi om"><img src="../Images/e7977ae0fd17ca3e6276faa16a415fef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*Qj0uPwQfKLNX48k1hEEELg.png"/></div></figure><p id="bd90" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您将获得模型的度量以及模型参数的详细分解，并且在底部，您将看到您为特定模型保存的所有工件。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi on"><img src="../Images/99c2d19253f0320525dc7c11284035e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XumJ_6hL1jmrCeagfeTahA.png"/></div></div></figure><p id="5d0a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意:交叉验证学习曲线和平均分数图总是作为工件保存。</p><p id="a1b8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要更改实验的名称(默认为 my-experiment)，请在启动模型对象(<code class="fe nj nk nl mw b">exp_name</code>)时指定名称，否则每个模型都将被添加到 my-experiment 中。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/4a5fa08cac44e24d12520a11ee9d32a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*dAp7y7lFvklShXVgTnXiHw.png"/></div></figure><h2 id="d3bc" class="na lv jj bd lw nq nr dn ma ns nt dp me lh nu nv mg ll nw nx mi lp ny nz mk oa bi translated">服务模型</h2><p id="1519" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">一旦您决定了要用于预测的模型，您就可以使用 FastAPI 和 Gunicorn 通过 RESTful API 轻松地生成所需的文件来为模型提供服务。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="d3bf" class="na lv jj mw b gy nb nc l nd ne">dt.to_service('titanic')</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi op"><img src="../Images/ad7ec5fff034746551fd60f904a04834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*AYq8GvGgFywB9KqZjPE3bA.png"/></div></figure><p id="9b47" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您熟悉 MLFlow，您也可以随时使用它来服务您的模型。打开保存部署文件的终端。我建议将这些文件转移到 git 存储库中，以便对模型和服务文件进行版本控制。</p><p id="ed60" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">按照说明构建 docker 容器，然后独立运行它。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="8d26" class="na lv jj mw b gy nb nc l nd ne">docker build -t titanic:1.0.0 ./<br/>docker run -d --name titanic -p 1234:80 titanic:1.0.0</span></pre><p id="050a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在导航到<a class="ae jg" href="http://127.0.0.1/docs" rel="noopener ugc nofollow" target="_blank"> localhost:1234/docs </a>来测试您的 API。现在，您可以通过向 127.0.0.1:1234/predict 发送 POST 请求来提供预测服务。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oq"><img src="../Images/2bbc880860465b252f8665d1a8224f16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJNnrTN26U6ZEMr8IPKm0Q.png"/></div></div></figure><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi or"><img src="../Images/581c40780333ae1a67f37a213999dc34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iwfr8epMkYyg-MyX78C0Hg.png"/></div></div></figure><p id="b0bf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">现在有一件重要的事情需要注意</strong>，这是运行默认配置，在没有保护它并为生产使用配置服务器之前，不应在生产中使用。在未来，我将自己添加这些配置，这样您就可以或多或少地将一个模型直接投入生产，只需进行最小的配置更改。</p><p id="9428" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个特性仍处于初级阶段，我将继续积极开发和改进它。</p><h1 id="8d22" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">你还能做什么？</h1><p id="d0d2" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">虽然这篇文章是一个半全面的 Aethos 建模指南，但您也可以运行统计测试，如 T-Test、Anovas，使用预训练的模型，如 BERT 和 XLNet 进行情感分析和问题回答，使用 TextRank 执行提取摘要，训练 gensim LDA 模型，以及聚类、异常检测和回归模型。</p><p id="f0a8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完整的例子可以看<a class="ae jg" href="https://github.com/Ashton-Sidhu/aethos/blob/develop/examples/Modelling%20with%20Aethos.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>！</p><h1 id="c967" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">反馈</h1><p id="5ee9" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我鼓励所有关于这个帖子或 Aethos 的反馈。你可以在推特上给我发信息，或者在 sidhuashton@gmail.com 给我发电子邮件。</p><p id="e6fb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">任何 bug 或功能请求，请在<a class="ae jg" href="https://github.com/Ashton-Sidhu/aethos/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc" rel="noopener ugc nofollow" target="_blank"> Github repo </a>上创建问题。我欢迎所有功能请求和任何贡献。如果你想为一个开源项目做贡献，这个项目是一个很好的开端——如果你需要帮助，可以随时给我发消息。</p></div></div>    
</body>
</html>