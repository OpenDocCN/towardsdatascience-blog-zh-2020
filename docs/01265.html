<html>
<head>
<title>Recurrent Neural Networks for Electricity Price Prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">电价预测的递归神经网络</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/recurrent-neural-networks-for-electricity-price-prediction-a26f8411ea44?source=collection_archive---------29-----------------------#2020-02-04">https://towardsdatascience.com/recurrent-neural-networks-for-electricity-price-prediction-a26f8411ea44?source=collection_archive---------29-----------------------#2020-02-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="834b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">具有外生变量的时间序列分析</h2></div></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><p id="e6c8" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><em class="li">用于预测这些价格的最终模型可以找到(</em> <a class="ae lj" href="https://github.com/Carterbouley/ElectricityPricePrediction/blob/master/multivariate_LSTM_electricity.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="li">此处</em> </a> <em class="li"> ) </em></p><p id="7b24" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><em class="li">(f</em><a class="ae lj" href="https://github.com/Carterbouley/ElectricityPricePrediction" rel="noopener ugc nofollow" target="_blank"><em class="li">full GitHub库</em> </a> <em class="li"> ) </em></p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/8b7acb5cfc072ca8c0c221e169f2f3a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aJwuj_Nd5ugCMki7.jpg"/></div></div></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="5d5a" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">什么是需求灵活性？</h1><p id="d46d" class="pw-post-body-paragraph km kn iq ko b kp mo jr kr ks mp ju ku kv mq kx ky kz mr lb lc ld ms lf lg lh ij bi translated">需求灵活性可以描述为电力终端用户(包括企业和家庭)根据市场信号(如随时间变化的电价)改变其电力消费模式的能力。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mt"><img src="../Images/a0d52548a61a43663b4381c7d1595566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0y8oHhCQ4SuyW6_qmhIQPQ.png"/></div></div></figure><p id="ea6b" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">电价遵循每日、每周和季节性模式。上面我们可以看到日线模式。早上，每个人醒来，打开所有设备，价格上涨。随着人们去工作，需求和价格下降(太阳能发电开始上网)。下午5点左右，人们开始离开办公室，回家，打开电视，洗衣服等，价格再次上涨，直到就寝时间，价格下降。这个循环然后重复。</p><p id="0ec1" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">鉴于电价和碳排放的相关性(见我之前的博客)，如果我们能把人们从高峰时间转移到非高峰时间，我们就能节省成本和碳排放。</p><p id="9ea4" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><em class="li">没有多少公司向他们的客户提供提前一天的价格，但是</em> <a class="ae lj" href="https://octopus.energy/agile/" rel="noopener ugc nofollow" target="_blank"> <em class="li">章鱼能源公司的灵活关税</em> </a> <em class="li">正是这样做的。</em></p><p id="7760" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">然而，首先，对价格的准确预测将是有用的。</p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="3cd8" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">外变量</h1><p id="27ff" class="pw-post-body-paragraph km kn iq ko b kp mo jr kr ks mp ju ku kv mq kx ky kz mr lb lc ld ms lf lg lh ij bi translated">通常当进行特征工程时，我们需要确保我们的输入确实有助于(而不是阻碍)模型。幸运的是，神经网络非常善于辨别什么是有益的，什么是无益的，所以我们可以非常慷慨。</p><p id="c990" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">电力生产的投入可能对决定价格很有帮助。以下是2013年至2019年的数据图。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mu"><img src="../Images/6e83288c033604d130a1bda316b8df54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oxw2a8x5S4ck6BS0j0XT5A.png"/></div></div></figure><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mt"><img src="../Images/a243e57bed2f90a772f352cca645e88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n_J-YWDPukPOud78tzeibA.png"/></div></div></figure><p id="7603" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">随着时间的推移，每个输入似乎都与电价有某种关联。</p><p id="c82b" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">最重要的是，考虑到季节变化，包括温度数据是有帮助的。由于空调需求，夏季可能会有更高的价格。</p><p id="4d98" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">所有这些数据必须来自不同的来源。我用Nordpools的提前一天市场来获取价格数据，用DarkSky API来获取温度数据，用Investing.com来获取商品数据。(这个都可以在这里找到<a class="ae lj" href="https://github.com/Carterbouley/ElectricityPricePrediction/tree/master/data" rel="noopener ugc nofollow" target="_blank">。)</a></p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="d3ac" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">时间序列分析的整形</h1><p id="a6c1" class="pw-post-body-paragraph km kn iq ko b kp mo jr kr ks mp ju ku kv mq kx ky kz mr lb lc ld ms lf lg lh ij bi translated">现在，经过一些清理，我有了一个完整的数据帧(<a class="ae lj" href="https://github.com/Carterbouley/ElectricityPricePrediction/blob/master/re_fixed_multivariate_timeseires.csv" rel="noopener ugc nofollow" target="_blank">这里</a>)。</p><p id="be3d" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">因为我正在执行时间序列分析，而我试图预测的变量也在预测中使用，所以我需要将数据重塑为监督学习问题。</p><pre class="ll lm ln lo gt mv mw mx my aw mz bi"><span id="9029" class="na lx iq mw b gy nb nc l nd ne">data = df.values</span><span id="13e6" class="na lx iq mw b gy nf nc l nd ne">n_steps = 168</span><span id="bfa9" class="na lx iq mw b gy nf nc l nd ne">series_reshaped =  np.array([data[i:i + (n_steps+24)].copy() <strong class="mw ir">for</strong> i <strong class="mw ir">in</strong> range(len(data) - (n_steps+24))])</span><span id="d38f" class="na lx iq mw b gy nf nc l nd ne">series_reshaped.shape</span><span id="ee26" class="na lx iq mw b gy nf nc l nd ne">(61134, 192, 6)</span></pre><p id="6676" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">取数据帧的值(在对神经网络进行缩放之后),我定义它可以看到168个向后的时间步长(1周),我希望它可以预测未来24小时。</p><p id="836e" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">它在数据框上创建了一个窗口，这样我就有了一个192行X 6列的矩阵。此窗口向下移动原始数据框“行我的行”,每小时创建一个新矩阵。如果2013年1月1日中午是第一个矩阵的第一行，那么下午1点将是第二个矩阵的第一行。</p><p id="3d02" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">像这样增加维度将允许神经网络理解时间到来的顺序很重要。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/e48a28b5e12107e438f3492ae7c46ba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/0*V0QqtTlLHZiK9lV8.png"/></div></figure><p id="60b0" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">既然数据是这种格式，我将它拆分，这样我们就有了168小时(1周)的输入数据块，对于每168小时块，我们有24小时的价格输出，所以我们的模型可以“看到”接下来的24小时。这将数据转化为监督学习问题。</p><pre class="ll lm ln lo gt mv mw mx my aw mz bi"><span id="300c" class="na lx iq mw b gy nb nc l nd ne">X_train = series_reshaped[:43800, :n_steps] <br/>X_valid = series_reshaped[43800:52560, :n_steps] <br/>X_test = series_reshaped[52560:, :n_steps] <br/>Y = np.empty((61134, n_steps, 24))  <br/><strong class="mw ir">for</strong> step_ahead <strong class="mw ir">in</strong> range(1, 24 + 1):     <br/>   Y[..., step_ahead - 1] =   series_reshaped[..., step_ahead:step_ahead + n_steps, 0]<br/> <br/>Y_train = Y[:43800] <br/>Y_valid = Y[43800:52560] <br/>Y_test = Y[52560:]</span></pre><p id="7797" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">现在X训练数据是所有商品过去的168小时，而Y训练数据是未来24小时的价格。</p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="7f76" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">训练模型</h1><p id="d354" class="pw-post-body-paragraph km kn iq ko b kp mo jr kr ks mp ju ku kv mq kx ky kz mr lb lc ld ms lf lg lh ij bi translated">将数据格式化后输入神经网络，只需要尝试不同的格式。</p><p id="ed51" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在尝试了LSTM的、GRU的卷积层以及经典的机器学习(回归树和ARIMA预测)之后，一个递归神经网络提供了最好的结果。</p><pre class="ll lm ln lo gt mv mw mx my aw mz bi"><span id="502b" class="na lx iq mw b gy nb nc l nd ne">np.random.seed(42)<br/>tf.random.set_seed(42)<br/><br/>model6 = keras.models.Sequential([<br/>    keras.layers.SimpleRNN(20, return_sequences=<strong class="mw ir">True</strong>, input_shape=[<strong class="mw ir">None</strong>, 6]),<br/>    keras.layers.SimpleRNN(20, return_sequences=<strong class="mw ir">True</strong>),<br/>    keras.layers.TimeDistributed(keras.layers.Dense(24))<br/>])<br/><br/>model6.compile(loss="mape", optimizer="adam")<br/>history = model6.fit(X_train, Y_train, epochs=20,<br/>                    validation_data=(X_valid, Y_valid))</span></pre><p id="fc42" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这里有两个重要的事情需要了解，对于那些更喜欢技术方面的人来说，那就是return_sequences=True，以及最终的时间分布层24。第一个确保数据在网络中保持相同的多维(时间序列)格式，第二个是它以相同的结构每小时输出未来24小时的数据。</p><p id="d0e9" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">对于预测，我只关心最后的24小时，因为一个小时后，将有一个新的输入，这将产生下一个小时的预测。</p><p id="d961" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在2013年至2018年对模型进行训练后，我用2019年来评估模型在看不见的数据上的工作情况。随机选择几天，这样你就能真正看到效果，这是相当准确的。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nh"><img src="../Images/fb0faaca477cb233437d7494896d88cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b_Ljio3-WHAXQ-dbbCJ8sQ.png"/></div></div></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="b860" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">使用案例</h1><p id="364d" class="pw-post-body-paragraph km kn iq ko b kp mo jr kr ks mp ju ku kv mq kx ky kz mr lb lc ld ms lf lg lh ij bi translated">鉴于该模型现在可以提前24小时预测电价，我们现在可以调整我们的用电量，使其远离那些高峰时段。这可能意味着设置我们的烘干机和电器在我们睡觉时运行，甚至投资智能插头来自动化我们的循环设备(如冰箱和空调)。</p><p id="1517" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">为了简单起见，我模拟了一个家用电池。它大致基于特斯拉Powerwall 2，容量为14KW，功率为5 KW。为简单起见，这意味着它可以容纳近3个小时的电荷。它查看模型的24小时预测，并选择3个最便宜的充电时间和3个最贵的放电时间。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ni"><img src="../Images/c23a13cdc25fe0c55f840adad1322829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rlpX32qh0YMNolXUnKrpbw.png"/></div></div></figure><p id="1320" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">然而，你不太可能以这些日前价格将电力卖回给电网，我模拟的估值指标正是如此。在2019年的过程中，这种电池将花费151.02英镑用于充电，并从出售给电网中“赚取”280.23英镑，从而获得85.5%的投资回报率。考虑到这是一个相当初级的电池模型，这是一个不错的结果。</p><p id="f7b5" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">还不错，但是钱也不多。当我们开始考虑灵活需求的真正潜在规模时，真正有趣的场景出现了，事实是，有成千上万个巨大的1MW +空调机组可以做到这一点，既减少了碳排放，又节省了大量成本。</p></div></div>    
</body>
</html>