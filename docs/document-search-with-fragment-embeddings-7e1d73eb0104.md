# 具有片段嵌入的文档搜索

> 原文：<https://towardsdatascience.com/document-search-with-fragment-embeddings-7e1d73eb0104?source=collection_archive---------18----------------------->

## **新冠肺炎问题—改进句子片段搜索的用例**

![](img/e2002e8b91901634b995f934f43ec516.png)

**图一。**展示了用于回答特定问题(左图)和更广泛问题(右图)的嵌入驱动的片段搜索。用黄色突出显示的文本片段是使用 [BERT 嵌入](https://github.com/UKPLab/sentence-transformers)获得的与搜索输入匹配的文档。右图是具有冠状病毒存在的文献证据的动物样本——字体大小是文献中参考计数的定性度量。蝙蝠(一般而言，特别是中国马蹄形蝙蝠)和鸟类被认为是冠状病毒的来源——蝙蝠是α和β冠状病毒的基因来源，鸟类是γ冠状病毒和δ冠状病毒的基因来源。还报道了来自果子狸和穿山甲的冠状病毒(β冠状病毒)的人畜共患传播。**以上所有信息都是使用机器学习模型自动获得的，无需人工处理**。对于右侧面板中的宽泛问题，通过搜索术语“动物”和在 [Word2vec](https://arxiv.org/abs/1301.3781) 嵌入的邻域中的聚类结果，创建了一个引导列表。然后使用 BERT 的[无监督 NER 对该列表进行生物实体类型筛选，然后使用片段中捕获的文献证据创建动物的最终列表，作为相应文件的摘要。新冠肺炎](/unsupervised-ner-using-bert-2d7af5f90b8a)[的动物来源至今未被确认。](https://www.nature.com/articles/d41586-020-00548-w)疾病预防控制中心[制作的冠状病毒插图](https://www.cdc.gov/coronavirus/2019-ncov/covid-data/covidview.html)

# TL；速度三角形定位法(dead reckoning)

从文档中收获的句子片段的嵌入可以作为该文档的提取概要方面，并且潜在地加速其发现，特别是当用户输入是句子片段时。这些片段嵌入不仅比传统的文本匹配系统产生更好的质量结果，而且还避免了现代分布式表示驱动的搜索方法中固有的问题——创建有效的文档嵌入的挑战，即在文档级别的单个嵌入，其捕获文档的所有方面并允许通过搜索发现它。

句子片段的例子有*、*、*作为*、、*冠状病毒的来源、*、、*穿山甲中的*、**、*、*由介词、形容词等连接一个或多个名词短语的短序列。这些在很大程度上被传统搜索系统忽略的突出显示的连接性术语不仅在捕获用户意图*中可以发挥关键作用(例如*** *bats 中的“冠状病毒* ***”具有与“bats* ***不同的搜索意图，作为*** *冠状病毒或者*** *bats 中不存在的“冠状病毒****”)*通过将这些句子片段嵌入到适当的嵌入空间*(例如* [*伯特*](https://arxiv.org/abs/1810.04805) *)* 中，我们可以使用搜索输入片段作为对该嵌入空间的探测，以发现相关文档。**

# 使用句子片段改进搜索的需要

对问题**“新冠肺炎**[](https://www.nature.com/articles/d41586-020-00548-w)****的动物来源是什么？”**或**“冠状病毒结合的受体”**即使在像最近发布的[新冠肺炎数据集](https://www.kaggle.com/allen-institute-for-ai/CORD-19-research-challenge) *这样的微小数据集上也具有挑战性(大约 500 MB 的语料库大小，大约 13k 个文档，8500 多万个单词，标准化文本中大约有 100 万个独特的单词)。***

**传统的文档搜索方法对于典型的用例是非常有效的，在这种用例中，通过在搜索中使用一个或多个名词短语可以从几个文档中获得答案。传统的文档搜索方法还满足以下对单词和短语的用户体验约束:**

```
“what we **see** (results) is what we **typed** (searched for)”
```

**例如，当我们搜索单词和短语(*连续的单词序列，如 New York，Rio De Janeiro)——*时，结果通常包含我们输入的术语或它们的同义词*(例如，新冠肺炎搜索产生关于 Sars-COV-2 或新型冠状病毒等的结果。).***

**然而，随着搜索输入中单词数量的增加，结果的质量往往会下降，特别是在名词短语之间使用连接术语时。这种结果质量的下降是显而易见的，甚至通过这些搜索引擎在结果中突出显示的术语。**

**例如，在下图中，*“bats as a source of corona virus”*中的大部分名词被当前的搜索引擎以分布式方式在所显示的文档摘要的句子/段落内和句子/段落间选择性地突出显示，有时甚至不考虑这些单词在输入序列中的顺序。尽管文档相关性排序通常在很大程度上缓解了这种情况，但我们仍然需要检查每个文档的摘要，经常不得不导航到文档中，然后再次返回到主结果集，因为文档不满足我们的搜索意图。**

**![](img/3f885b39cd1cfa1dd23647f5aa357516.png)**

****图二。**当前的搜索引擎，包括像谷歌学术这样的文献证据搜索引擎，对于片段搜索不如对于单词和短语搜索有效。**

**本文中描述的文档搜索方法除了产生更相关的结果之外，还可以减少搜索系统中存在的这种认知超载，特别是在搜索句子片段时。举例来说，我们在现有搜索系统中使用的相同查询可以产生如下所示形式的结果*(该界面是一个示意图，纯粹是为了展示搜索方法)。*在下面的示意图中值得注意的关键点是，提取的概要面是文档中的实际匹配*(括号中的数字是包含片段的文档的数量以及片段与输入搜索片段的余弦距离)*，与传统搜索系统中显示的建议查询或相关搜索查询相反。这些概要面给出了结果空间的全景，减少了无用的文档导航并加速了对感兴趣的文档的收敛。**

**![](img/47b9caad7e5d77a65ffcbe7a0162adba.png)**

****图三。**片段搜索示意图。匹配用户输入的片段的摘要有助于减少查找感兴趣的文档的时间**

**输入片段可以是完整的或部分的句子，其组成或风格没有限制。例如，它们可以是疑问的，而不是上面的肯定询问——我们可以通过搜索“*受体冠状病毒结合*”来找到冠状病毒结合的蛋白质受体**

**![](img/8dc9d388d4a088d9e6ecc452c35de35c.png)**

****图 4。**另一个例子片段搜索示意图。输入可以是完整或部分句子的任何单词序列，并且可以是任何性质的(肯定、疑问等)。)**

**上述搜索系统之间的比较只是为了说明文档发现的基本方法的差异。否则，鉴于语料库规模的数量级差异，这将是一个不公平的比较——我们肯定会在一个小语料库中获得更多相关结果。**

# **嵌入在文献搜索中的作用**

**鉴于分布式表示相对于传统的纯符号搜索方法的优势，分布式表示已经成为任何形式的搜索的组成部分。现代搜索系统越来越多地利用它们的属性来补充符号搜索方法。如果我们广义地将文档搜索视为文档空间的广度优先和深度优先遍历的组合，那么这两种形式的遍历需要具有特定于这些遍历的特征的嵌入。例如，我们可能会从搜索引起冠状病毒的动物开始，然后深入到蝙蝠，然后再扩大到爬行动物等。**

**文档方面的分布式表示——无论是单词、短语还是句子片段，都来自 Word2vec 和 BERT 的嵌入空间，具有独特的互补属性，有助于执行广泛和深入的搜索。具体来说，**

*   **[Word2vec](https://arxiv.org/abs/1301.3781) 术语的嵌入 *(* ***术语*** *指的是单词和短语——例如蝙蝠、灵猫)*对于广度优先搜索有效，对结果应用基于实体的聚类。搜索单个单词"*蝙蝠"*或短语"*灵猫"*的结果会产生其他动物，如穿山甲、骆驼等。**
*   **[BERT](https://arxiv.org/abs/1810.04805) 句子片段嵌入(*穿山甲中的冠状病毒】*、*蝙蝠作为冠状病毒的来源】*等。)有助于找到片段变体，这些变体很大程度上保留了原始名词，取决于它们在语料库中的存在。例如，*“蝙蝠作为冠状病毒的来源”*会产生片段变体，如*“蝙蝠携带冠状病毒”*、*“源自蝙蝠的冠状病毒”*等。**
*   **这些嵌入虽然在很大程度上是互补的，但也有重叠的特性——word 2 vec 嵌入可以产生深度优先的结果，而 BERT 嵌入在统计显著性结果的分布尾部产生广度优先的结果。例如，使用 word2vec 嵌入搜索*蝙蝠*，除了骆驼、穿山甲等其他动物之外，还会产生蝙蝠种类*(例如果蝠、蝙蝠、狐蝠、狐蝠)*。使用 BERT 对*“孔雀中的冠状病毒”*进行片段搜索，得到*“猫的冠状病毒疾病”、“猎豹中的冠状病毒”*，尽管结果主要是鸟类中的冠状病毒。**
*   **BERT 模型允许搜索输入*(术语或片段)*在词汇表之外，使任何用户输入候选项都能找到相关文档。**

# **这种方法是如何工作的？**

**![](img/b71bf850f321096dc680beabaf654d77.png)**

****图 5。**片段搜索中涉及的离线和实时流程/流。**

**从用于用户输入的 word2vec/BERT 嵌入中获得的扩展术语/片段被用于精确匹配已经使用这些术语/片段离线索引的文档。离线时，使用词性标注器和组块器的组合从语料库中获取片段，并使用 word2vec 和 BERT 两种模型为它们创建嵌入。**

*   **将用户输入映射到术语和片段嵌入的中间步骤，然后用于查找文档，不仅具有增加搜索的广度和深度的优点，而且避免了创建匹配用户输入的高质量文档嵌入的问题。具体来说，片段扮演了文档索引的双重角色，并且使得单个文档能够具有由嵌入其中的片段表征的可搜索的多个“提取子摘要”。与纯粹使用术语或短语找到这样的文档相比，片段还增加了找到“大海捞针”文档*(语料库中包含问题答案的单个文档)*的机会。搜索冠状病毒的潜在动物来源是大海捞针的一个明显用例——我们可以在上面的图 3 和图 4 中看到片段与单个文档的匹配*(这在下面的注释部分中详细讨论)*。**
*   **将嵌入纯粹用于寻找候选术语/片段的中间步骤，并利用传统的搜索索引方法来寻找匹配那些术语/片段的文档，这使得我们能够大规模地执行文档搜索。**
*   **最后，在寻找像***[](https://www.nature.com/articles/d41586-020-00548-w)****这些宽泛问题的答案时，动物的来源是什么？*********

# *****当前方法的局限性*****

*****如前所述，word2vec 嵌入扩展了单词和短语的搜索范围。它们没有扩大碎片搜索的广度——邻域的直方图经常缺少明显的尾部*(下图 8)*。这是因为片段由于它们的长度而没有足够的相邻上下文来学习高质量的嵌入。这种不足可以通过扩大训练的窗口大小和通过忽略句子边界来增加周围的上下文来部分解决，但是在实践中这仍然是不够的，因为片段的低出现计数*(图 8)* 。*****

*****BERT 嵌入在很大程度上仅增加了搜索的深度，特别是对于片段和短语*(使用 BERT 嵌入的单词的搜索深度扩展在实践中没有用)*。虽然它们在一定程度上增加了广度，例如，查询“猕猴中的冠状病毒”扩展到在重要结果的分布尾部中包括“棕榈果子狸中的冠状病毒”，但广度不如 word2vec 为单词和短语提供的深度。下面的图 6 说明了它的不足之处。实施说明中还有一些片段搜索缺乏广度的例子，以及规避这种限制的方法。*****

*****![](img/6eacab6f4cf7e9ec1af3daad64e3fbb2.png)*****

*******图 6。**说明了基于搜索输入长度使用的嵌入类型(单词序列少于 5-项；≥5 个片段)和搜索的深度/广度。Word2vec 嵌入对于术语(单词/短语)的深度和广度(它们提供的广度大于深度)搜索都是有效的，而 BERT 嵌入对于使用片段的深度搜索更有效。片段的 BERT 邻域也有提供宽度的结果，但不如 Word2vec 多-当输入片段没有许多匹配深度结果时，我们通常会在 BERT 邻域中看到更多宽度(在重要结果的尾部)。例如，“蝙蝠是冠状病毒的来源”中的句子几乎都是关于蝙蝠的。然而，搜索“孔雀中的冠状病毒”将从鸟类中的冠状病毒开始，并有类似“猎豹中的冠状病毒”的广泛结果。实际上，这可能被认为是优点而不是缺点，特别是当用户键入片段来寻找特定答案时。然而，当用户键入用于广泛搜索的片段时，例如“带有冠状病毒的动物”，这是不够的。然而，这样的问题不能仅仅通过一次搜索来解决——它本质上是一个多步骤的过程，如图 1 所示。*****

# *****最终想法/总结*****

*****[大约七年前，Word2vec](https://arxiv.org/pdf/1301.3781.pdf) 可能是第一个明确建立分布式表示能力的模型。由这个简单模型输出的嵌入对于其“体系结构”来说基本上具有[两个向量阵列](https://www.quora.com/How-does-word2vec-work-Can-someone-walk-through-a-specific-example/answer/Ajit-Rajasekharan)，对于下游应用，例如上述的文档搜索方法，仍然具有巨大的价值。*****

*****[Word2vec](https://arxiv.org/pdf/1301.3781.pdf) ，与[BERT](https://arxiv.org/abs/1810.04805)embedding 一起，为文档搜索提供了一个解决方案，该解决方案在结果质量和收敛时间方面有可能改进传统方法*(这一声明需要量化)*。该解决方案避免了在单个向量表示中学习文档的所有重要方面的问题，然后搜索系统可以使用该向量表示来不仅挑选特定的文档，还可以找到与所挑选的文档相似的文档。*****

*****通过使用嵌入(无论是单词、短语还是句子片段)来在文档挑选之前扩大/深化搜索，规避是可能的。单词和短语的 Word2vec 嵌入大大增加了文档搜索的广度。句子片段的 BERT 嵌入大大增加了搜索的深度。BERT 嵌入还消除了词汇表之外的情况，以及促进了文档的不同显著方面的可搜索的提取摘要，这加速了向相关文档的收敛。*****

# *****参考*****

*   *****[新冠肺炎](https://www.sciencedaily.com/releases/2020/03/200317175442.htm)的动物来源是至今未确认的。*****
*   *****[句伯特](https://arxiv.org/pdf/1908.10084.pdf)*****
*   *****使用 BER 的无监督 NER*****
*   *****[解释 word2vec 工作原理的答案](https://www.quora.com/How-does-word2vec-work-Can-someone-walk-through-a-specific-example/answer/Ajit-Rajasekharan)*****

# *****实施说明*****

*******1。这种方法中使用的 NLP 方法/模型是什么？*******

*****[*词性标注器，用于标注句子*](https://www.logos.ic.i.u-tokyo.ac.jp/~tsuruoka/lapos/) *(基于可扩展的 CRF，与具有一流 F1 分数的最新模型相比，至少快一个数量级。然而，该模型的召回对于该标记任务是足够的)，******

******chunker 创建短语，******

*****[*word 2 vec*](https://arxiv.org/abs/1301.3781)*用于单词和短语的嵌入，******

*****[*伯特*](https://arxiv.org/abs/1810.04805) *为* [*片段嵌入(句子变形金刚)*](https://arxiv.org/pdf/1908.10084.pdf) *和******

******伯特为* [*无监督实体标注*](/unsupervised-ner-using-bert-2d7af5f90b8a)*****

*******2。如何计算文档结果的相关性？*******

******片段的排序基于与输入片段的余弦距离。从匹配每个方面片段的文档集中挑选第一个文档，并以与输入片段顺序相同的顺序列出。文档的排序可以基于一些其他的文档相关性排序。从每个片段匹配集中挑选文档也可以基于一些其他的相关性排序。******

*******3。这种搜索方法会扩展到实时搜索吗？*******

******实时搜索中的计算密集型步骤是嵌入空间中的相似性搜索(Word2vec 或 BERT)。已经存在现有的* [*开源解决方案*](https://cloud.google.com/solutions/machine-learning/building-real-time-embeddings-similarity-matching-system) *来大规模执行该操作。我们可以做一些优化来减少时间/计算周期，例如，根据输入搜索长度，仅在两个嵌入空间中的一个中进行搜索，因为这些模型的优势/劣势依赖于输入搜索长度。******

*******4。片段不就是一个很长的短语吗？如果是，为什么要换个称呼？*******

******片段本质上是一个长短语。与短语的区别有两个原因******

******a)片段可以是完整的句子，而不仅仅是部分句子******

******b)这些模型的强度依赖于我们前面看到的输入长度(见图 6)。BERT 在片段区域表现最佳(≥ 5 个单词)******

*******5。邻域的直方图分布如何寻找术语和片段？*******

*****下面针对单词、短语(3 个单词)和片段(8 个单词)的 BERT 和 Word2vec 邻域说明了这两个模型的互补性质。对于 BERT，分布的尾部随着单词长度的增加而增加，与短语或单词相比，片段具有明显的尾部。当术语计数较低时，分布有时可能具有非常厚的尾部，这表明结果不佳。与[*Bert-as-service*](https://github.com/hanxiao/bert-as-service)*嵌入相比，由* [*句子变形器*](https://github.com/UKPLab/sentence-transformers) *创建的嵌入往往具有明显的尾部，尽管两者都使用子词的总和作为汇集(两者也有其他汇集方法)，因为句子变形器中的监督训练步骤使用带有蕴涵、中性和矛盾标签的句子对。******

*****Word2vec 社区有一个单词和短语的尾巴。对于长短语，即使具有高出现计数，分布也几乎分解成“病态形式”,拥挤在高端，然后其余的质量集中在低端。长短语的分布形状也各不相同。然而，不管形状如何，邻域结果清楚地显示了质量的下降。*****

*****![](img/5b1e1d1aa2ef380786da689beafe2d0c.png)*****

*******图七。**随着输入字数的增加，BERT 邻域呈现出明显的尾部。*当术语计数较低时，分布有时可能具有非常厚的尾部，这表明结果不佳。******

*****![](img/d76927fa200e23a6c3b936ab78664952.png)*****

*******图 8。Word2vec 邻域表现出与 BERT 相反的行为。事实上，这种分布呈现出一种“病态的转折”,一部分项集中在高端(一些项的值为 1 ),而其余部分集中在低端。不管片段在语料库中的出现次数是多少，都会发生这种分解，尽管在形状上有一些变化。对碎片的一致观察是邻域质量下降——邻居看起来几乎像噪音。这可能是因为长短语没有足够的上下文来训练。*******

*******6。结果对输入片段的变化敏感。这就是我们使用输入变量收敛到相同结果的可能性。*******

******虽然针对同一问题的不同变体检索到的片段集是不同的，但是在检索到的片段集中似乎有很多交集。然而，由于前面讨论的片段宽度的限制，一些问题可能不会产生涉及所有搜索名词的任何片段。例如“作为冠状病毒来源的狐蝠”或“狐蝠中的冠状病毒”可能不会产生任何含有狐蝠或蝙蝠(狐蝠属于蝙蝠家族)的片段。当片段不包含所有名词时，可以考虑的一种方法是找到该词的 Word2vec 邻居，并使用这些词重建查询。******

*******7。这些模型与使用术语、短语和片段的大海捞针相比如何？*******

*****Word2vec 嵌入在这种情况下并不直接有用，因为单个出现的术语/短语的向量没有足够的上下文来学习丰富的表示。由于从子词构造单词的本质，BERT 嵌入不会遭受这一缺点——子词有足够的上下文来学习好的表示。然而，Word2vec 仍然可以在搜索中找到一个名词的等价名称，这就像大海捞针一样。例如，如果文档空间只引用了果蝠中的冠状病毒，则在狐蝠中搜索冠状病毒可能不会得到该文档。然而，在果蝠(使用 Word2vec 创建)中搜索冠状病毒片段将在 BERT 的嵌入空间中找到该单个文档。除了存在分布尾部的片段(如果确实存在)使其有资格作为候选者之外，大多数片段中固有的可解释性提供了一个优势，这是单词或短语不一定具有的。*****

*******8。关于动物冠状病毒信息提取的更多细节*******

*****使用 Word2vec 和实体标记收集了大约 1000 个 *(998)* 生物实体提及。这些用于收获 195 个提及病毒的片段。显示了 30 个片段的样本*****

*****![](img/68a82dac586af9729afb20176b98b37e.png)*****

*****带有动物证据的片段样本是冠状病毒的潜在来源*****

*****![](img/80ef9689fcc5a245d43b389e9cb7483b.png)*****

*******9。片段搜索需要两种形式的嵌入吗？*******

*****我们可以只做一个——伯特嵌入。然而，我们至少需要将它与传统的词汇搜索系统配对，以在它的薄弱领域——单个术语和短语搜索——对其进行补充。*****

*****下面的流程显示了这两个系统一起用于发现文档的用例*****

*****![](img/d206c99a7dd053619b6c392ee0f8927e.png)*****

*****一个基于 BERT 嵌入和传统词汇搜索的文档搜索系统。*使用单个术语在片段空间中专门搜索(tmprss2)有助于规避 BERT 嵌入的不足，以找到具有单个单词和短语的良好余弦近邻。将单个词汇的词汇搜索限制在只有片段的数据空间有助于我们发现可能相关的片段嵌入。另一方面，用长片段搜索更有可能在余弦空间产生结果。如果精确合取匹配的概率随着长度的增加而降低，那么它们不太可能通过词汇搜索产生任何结果。使用*[*meilisearch*](https://www.meilisearch.com/)对片段进行词法搜索*****

*****下图显示了使用上述两种流程的文档发现示例。*****

*****![](img/7534f5c25d3ae9f7de1d8385924682b1.png)*****

*****在使用 BERT 和传统词汇搜索的搜索系统中使用长片段进行文档发现的示例流程示意图—发现的两个步骤*****

*****![](img/c832d0fbe25cefa4a5b7de240b44a673.png)*****

*****使用单个单词和传统词汇搜索进行文档发现的示例流程示意图。(BERT 空间中的余弦邻居对于单个单词是无用的。(2)然而，将用户输入与片段匹配有助于发现相关片段。挑选相关片段的余弦相邻链接有助于发现更多感兴趣的片段，其中之一(3)可能产生我们正在寻找的文档。*****

******本文由* [*Quora*](https://qr.ae/pNrXUl) 手动导入*****