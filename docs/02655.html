<html>
<head>
<title>How to manage data integrations with an ESB alternative</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何管理与 ESB 替代方案的数据集成</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-manage-data-integrations-with-an-esb-alternative-96049b999b57?source=collection_archive---------20-----------------------#2020-03-14">https://towardsdatascience.com/how-to-manage-data-integrations-with-an-esb-alternative-96049b999b57?source=collection_archive---------20-----------------------#2020-03-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9122" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何在几分钟内设置 N8N 并实施工作流程</h2></div><p id="18e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们开始讨厌独石之后的一秒钟，集成已经在我们的必备清单上占据了一席之地。如今，在现实世界的应用程序中，不可避免地会出现多个系统相互通信的情况。就像人类一样，交流是非常困难的。你可能会失去连接，在某一方有计划外的改变，错误可能会在任何地方发生。这就是为什么交流太重要了，没有工具是不行的。手工制作的解决方案以噩梦告终。企业模式建议我们将 ESB 解决方案添加到我们的架构中，但是在许多场景中这可能很昂贵。在本文中，我们将学习如何使用免费且简单的工具 n8n 解决最常见的集成问题。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/aec30a7988e7f59ade038c94b32a2c48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4yhtmqrT2JHuduYOTFaSqQ.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">图片来自 geralt 的 pixabay</p></figure><h1 id="f881" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">什么是 ESB</h1><p id="1370" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">一条<strong class="kk iu">企业服务总线</strong> ( <strong class="kk iu"> ESB </strong>)就是数据高速公路。它不仅将数据从 A 分发到 B，还创建了一个基于 API 的公共集成层(面向服务的架构，SOA，面向旧时尚定义爱好者)。在这种体系结构中，多个软件只使用一条总线来通知本地变化和数据变化。简单地说，在这个架构中，您不必集成多个系统，只需集成一个系统:ESB。将变更传播给可能对该信息感兴趣的其他参与者的将是 ESB 本身。所有这些过程对你来说都是透明的。这就把系统间的网状通信问题变成了星型拓扑。对于那些没有多点集成经验的人来说，这意味着您将减少集成成本和维护。您将降低成本，因为所有的集成都将支持相同的格式和标准。您将减少维护成本，因为由其他系统引起的所有更改都将被 ESB 吸收(希望由有效管理这些问题的专业团队来完成)。许多现代 ESB 维护流入管道的信息的副本。这意味着一个包含公司所有战略信息(黄金记录)的数据库，可以由使用结构化 API 协议(如 GraphQL)的各方使用。</p><p id="4241" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里总结了 ESB 的职责:</p><ul class=""><li id="074d" class="mr ms it kk b kl km ko kp kr mt kv mu kz mv ld mw mx my mz bi translated">在系统间发送消息</li><li id="a13d" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld mw mx my mz bi translated">监控、记录和控制此消息流，包括错误报告</li><li id="87de" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld mw mx my mz bi translated">提供一个稳定的 API 架构，可以被所有系统集成</li><li id="4fd6" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld mw mx my mz bi translated">使所有格式符合标准</li><li id="5bbe" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld mw mx my mz bi translated">对事件进行排队，保持性能，出错时动作的可重复性。</li><li id="b1c4" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld mw mx my mz bi translated">可选功能，如在本地存储数据以作为 MDM 或内部工作流来转换信息</li></ul><h1 id="ac9d" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">N8N 是什么？</h1><p id="966c" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">N8N 不完全是 ESB，更像是一个工作流自动化工具。在官方网站上，它将自己定义为领先的点对点集成云解决方案 Zapier 的免费内部替代方案。</p><p id="bccf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样的解决方案不是 ESB，因为基本上，它提供了一个网状集成网络。当你把 A 和 B，C 和 D 直接连接起来时，就会发生这种情况，这很自然。理论上，这样做，您会失去 ESB 的大部分好处，就像所有数据都在其中流动的真正总线一样。</p><p id="3856" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无论如何，即使通信仍然是点对点的，只要在同一个平台上管理它，就可以通过简单的用户界面完全控制所有的集成。</p><h2 id="7285" class="nf lv it bd lw ng nh dn ma ni nj dp me kr nk nl mg kv nm nn mi kz no np mk nq bi translated">N8N 的关键特性是什么？</h2><ul class=""><li id="db19" class="mr ms it kk b kl mm ko mn kr nr kv ns kz nt ld mw mx my mz bi translated"><strong class="kk iu">免费</strong>您可以在您的内部数据中心或云中免费运行 n8n。无论你的公司规模或整合数量。</li><li id="f296" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld mw mx my mz bi translated"><strong class="kk iu">易于扩展</strong>您可以使用市场上的连接器，也可以自己创建连接器。</li><li id="73f0" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld mw mx my mz bi translated"><strong class="kk iu">你的数据会留在身边</strong>你可以在本地运行。这是安全的、高效的、高性能的，并且避免了像向云开放 VPN 或在内部安装代理以允许云工具进入您的 l an 这样的痛苦。</li></ul><h2 id="22b0" class="nf lv it bd lw ng nh dn ma ni nj dp me kr nk nl mg kv nm nn mi kz no np mk nq bi translated">最常见的场景是什么？</h2><ul class=""><li id="da5e" class="mr ms it kk b kl mm ko mn kr nr kv ns kz nt ld mw mx my mz bi translated"><strong class="kk iu">循环作业</strong>您可以处理像“每 Y 小时运行 X”或“每天将数据从 X 移动到 Y”这样的用例</li><li id="7243" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld mw mx my mz bi translated"><strong class="kk iu">同步数据</strong>您可以从源和目标创建移动数据，使它们保持一致。您可以有任何种类的源或目的地，比如 API、RDBMS、NoSQL 和文件。</li><li id="d146" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld mw mx my mz bi translated"><strong class="kk iu">对事件做出反应</strong>所有的工作流都可以通过一个 API 调用来启动。这让我们可以管理类似“当用户在 Y 应用程序中执行 X 操作时，也执行该操作”的场景我们需要的唯一部分是调用 Y 应用程序上的 API。</li></ul><h1 id="e651" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">如何设置 N8N</h1><p id="8509" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">N8N 的设置非常简单。我跳过了每次手动安装，因为我是 docker 爱好者，但如果你愿意，你可以使用传统的安装过程。如果你是一个 docker 爱好者，或者不太害怕容器，你可以使用下面的 docker-compose 文件并运行“docker-compose up”命令</p><pre class="lf lg lh li gt nu nv nw nx aw ny bi"><span id="bd9c" class="nf lv it nv b gy nz oa l ob oc">version: '2'</span><span id="c3fc" class="nf lv it nv b gy od oa l ob oc">services:<br/>  n8n:<br/>    ports:<br/>     - "5678:5678"<br/>    image: n8nio/n8n<br/>    environment:<br/>     - N8N_BASIC_AUTH_ACTIVE=true<br/>     - N8N_BASIC_AUTH_USER=admin<br/>     - N8N_BASIC_AUTH_PASSWORD=admin<br/>     - DB_TYPE=mongodb <br/>     - DB_MONGODB_CONNECTION_URL=mongodb://root:password@mongo:27017/n8n?authSource=admin</span><span id="993f" class="nf lv it nv b gy od oa l ob oc">mongo:<br/>    image: mongo<br/>    environment:<br/>      - MONGO_INITDB_ROOT_USERNAME=root<br/>      - MONGO_INITDB_ROOT_PASSWORD=password<br/>      - MONGO_INITDB_DATABASE=n8n<br/>    ports:<br/>      - 38017:27017</span><span id="29dd" class="nf lv it nv b gy od oa l ob oc">mysql:<br/>     image: mysql:5.7<br/>     environment:<br/>       MYSQL_ROOT_PASSWORD: mysql<br/>       MYSQL_DATABASE: mysql<br/>       MYSQL_USER: mysql<br/>       MYSQL_PASSWORD: mysql</span></pre><p id="2126" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个 docker-compose 创建了一个链接在一起 8N 实例和一个 MongoDB 数据库。对于生产用途，您将需要像往常一样持久化数据和管理备份，但是对于快速启动来说就足够了。compose 还包含一个 MySQL 实例，我们将使用它进行测试。</p><h1 id="6a44" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">配置您的第一个工作流</h1><p id="aad6" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">我们要配置的第一个工作流是一个简单的作业，它从 web 服务中读取数据并将其转储到数据库中。</p><p id="b490" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们需要创建一个工作流。我们可以轻松设置步骤:</p><ol class=""><li id="b5e2" class="mr ms it kk b kl km ko kp kr mt kv mu kz mv ld oe mx my mz bi translated">下载数据</li><li id="1924" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld oe mx my mz bi translated">如果不存在，则创建目标表</li><li id="7fd6" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld oe mx my mz bi translated">转换数据</li><li id="22d1" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld oe mx my mz bi translated">将数据保存到目标目的地</li></ol><p id="bcee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有这些步骤都将由 UI 来管理，不用写一行代码，真好！</p><p id="7f1a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该示例是手动触发的(点击或调度),以尽可能简单地维护该工作流，但也可以通过 API 调用来激活。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi of"><img src="../Images/2f748c796c1a14e9a80677ccd59dc060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DWDipfjyCreTNhvGQc1VdA.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">数据传输的工作流程</p></figure><h2 id="e24d" class="nf lv it bd lw ng nh dn ma ni nj dp me kr nk nl mg kv nm nn mi kz no np mk nq bi translated">下载数据</h2><p id="a345" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">我使用了一个生成随机数据的 Mockaroo API。数据将类似于:</p><pre class="lf lg lh li gt nu nv nw nx aw ny bi"><span id="9417" class="nf lv it nv b gy nz oa l ob oc">curl -H "X-API-Key: XXXXX" <a class="ae og" href="https://my.api.mockaroo.com/test.json" rel="noopener ugc nofollow" target="_blank">https://my.api.mockaroo.com/test.json</a></span><span id="7a75" class="nf lv it nv b gy od oa l ob oc">[{   "id": 1,   "first_name": "Atlante",   "last_name": "Hick",   "email": "ahick0@blog.com",   "gender": "Female",   "ip_address": "64.230.69.253" }, {   "id": 2,   "first_name": "Kaitlynn",   "last_name": "Klaes",   "email": "kklaes1@hexun.com",   "gender": "Female",   "ip_address": "247.25.175.87" },...]</span></pre><p id="2d2c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个步骤被配置为指向 API，传递身份验证头，并获取数据。请注意，使用不同的配置，我们也可以处理所有其他 HTTP 操作。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oh"><img src="../Images/3f4575e69f01407c949ad2ee28330539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IB9ybpSF9QNvo6WMIiJcqA.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">HTTP 请求步骤预览中 API 的结果</p></figure><h2 id="80b5" class="nf lv it bd lw ng nh dn ma ni nj dp me kr nk nl mg kv nm nn mi kz no np mk nq bi translated">如果不存在，则创建数据表</h2><p id="ac85" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">这一步可以通过运行一个简单的查询语句来轻松管理。为了连接到数据库，我们需要设置连接字符串(在本例中，是我们的本地 MySQL 数据库)。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oi"><img src="../Images/bfc103a6cab8563f15a1c9aa153a430c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rYrOcoy0nBl1jC4jbfw3Q.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">创建数据库连接的这一步</p></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oj"><img src="../Images/6133f74401fb2732793b70ad800fceb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2xqmViFewkmPIWmcbw4rBw.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">创建目标表的步骤(如果不存在)</p></figure><h2 id="f72f" class="nf lv it bd lw ng nh dn ma ni nj dp me kr nk nl mg kv nm nn mi kz no np mk nq bi translated">转换数据</h2><p id="769b" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">因为我们只有一个 json 输出，所以我们需要将数据分成行。基本上，n8n 中的下一步是对每个输入元素执行的。将直接输出传递给 insert 语句将导致对整个有效负载只执行一次。这不是预期的行为。在这一步中，我使用了一个 javascript 块来转换数组中的有效负载，并将其作为输出。这将导致每行执行一次下一步。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ok"><img src="../Images/ae1249b56ded5d756263100a74ed952e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rOQe1ZW6akjLCKukUPek-A.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">这一步将数据从 json 数组转换成行。</p></figure><h2 id="5791" class="nf lv it bd lw ng nh dn ma ni nj dp me kr nk nl mg kv nm nn mi kz no np mk nq bi translated">插入语句</h2><p id="0ba3" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">insert 语句非常简单。只要映射字段，所有的工作就完成了。这将对每一行执行一次，在数据库上转换一组 insert 中的输入行。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ol"><img src="../Images/43cf3d335438852c0bcfdc58ac915151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mRyw0fp-r_Z0YtbiTCAdjA.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">这一步是插入，json 在插入中被转换</p></figure><h2 id="0d17" class="nf lv it bd lw ng nh dn ma ni nj dp me kr nk nl mg kv nm nn mi kz no np mk nq bi translated">如果我要做一个 insert 或 update 语句会怎么样？</h2><p id="6de4" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">在这个例子中，我们将行插入到表中。这是测试该工具的一个很好的例子，但是在现实世界中，我们需要 upsert(更新或插入)数据。实际上，该工具本身并不允许这样做。无论如何，检查行是否存在，然后插入或更新一般都很昂贵。为了不浪费时间地完成这个目标，我们可以使用两种模式:</p><ol class=""><li id="5d99" class="mr ms it kk b kl km ko kp kr mt kv mu kz mv ld oe mx my mz bi translated">使用原生 MySQL 语句 INSERT 或 UPDATE。这仅对 MYSQL 有效，并且需要一个定制的 SQL 语句。</li><li id="fb97" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld oe mx my mz bi translated">使用分段表。您可以创建一个临时表来保存数据。这个操作很快，因为插入是更快的操作。然后，作为最后一步，您可以添加一个 SQL 合并，将真实表与临时表同步</li></ol><h1 id="fc94" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">带什么回家</h1><p id="0e3b" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">ESB 是企业架构中的一个重要组成部分，但是:</p><ul class=""><li id="8d22" class="mr ms it kk b kl km ko kp kr mt kv mu kz mv ld mw mx my mz bi translated">没有它我不能出去。你愿意不穿衣服走出家门吗？不能。因此，不要在没有 it 的情况下设计公司基础架构。另一种选择是点对点集成，这就是问题所在。我们必须为处理所有遗留架构花费大量精力(时间&amp;金钱)，所以请为新设计做出正确的选择。</li><li id="e788" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld mw mx my mz bi translated"><strong class="kk iu">它不能手工制作。</strong>这不仅是一个不重新发明轮子的问题，而且是一个事实，即从零开始(当然是在有限的时间和预算内)创建像商业系统一样的系统是不可能的。</li><li id="724b" class="mr ms it kk b kl na ko nb kr nc kv nd kz ne ld mw mx my mz bi translated">工作流自动化不是 ESB，但总比没有好。 ESB 解决方案并不便宜。商业工具齐全但成本高。如果您预算不足，可以选择手动或通过 ETL 来管理数据流。工作流自动化工具呢？像<a class="om on ep" href="https://medium.com/u/530c4c926670?source=post_page-----96049b999b57--------------------------------" rel="noopener" target="_blank"> Zapier </a>或 N8N 这样的产品性能好，性价比高。</li></ul></div></div>    
</body>
</html>