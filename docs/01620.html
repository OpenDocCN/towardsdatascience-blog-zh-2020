<html>
<head>
<title>End to end Case Study: Bike-sharing demand prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">端到端案例研究:自行车共享需求预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/end-to-end-case-study-bike-sharing-demand-dataset-53201926c8db?source=collection_archive---------7-----------------------#2020-02-14">https://towardsdatascience.com/end-to-end-case-study-bike-sharing-demand-dataset-53201926c8db?source=collection_archive---------7-----------------------#2020-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/927f8fccd261b0961241cd8288517cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gTer_2Mf4cjVl5v5"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">阿纳托利·阿尼金在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b4d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大家好！！</p><p id="0492" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">欢迎来到这个关于自行车共享需求预测的博客。这个数据集取自<a class="ae kc" href="https://www.kaggle.com/c/bike-sharing-demand/overview" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>。在这篇博客中，我们将经历简单而有效的预处理步骤，然后我们将更深入地挖掘数据，并应用各种机器学习回归技术，如<em class="lb">决策树、随机森林和 Ada boost 回归器</em>。我们将通过使用 GridSearchCV 对每个回归器算法进行参数调整来找到最佳的超参数。</p><p id="adfe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在分析每个模型的误差后，我们将选择一个给出最小<strong class="kf ir">均方根对数误差(RMSLE)分数</strong>的模型，并使用它建立一个模型。</p><p id="3203" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们将看到如何使用函数将整个代码包含在 python 中以获得更高的效率。希望，你会喜欢。</p><h2 id="e61c" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">1)数据预处理</h2><ul class=""><li id="9976" class="lv lw iq kf b kg lx kk ly ko lz ks ma kw mb la mc md me mf bi translated">理解数据</li></ul><p id="5f51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">给定的训练数据集具有 10886 行和 12 列。季节、假日、工作日列是绝对的。除了' datetime '之外，其余都是数字列。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="901a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用' datetime '列获得另外两个功能' time '和' month '。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="460f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">删除不必要的列。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="68c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">分类列上的一个热编码。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="937e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用每个相应列的中值输入空值。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><ul class=""><li id="7bae" class="lv lw iq kf b kg kh kk kl ko mm ks mn kw mo la mc md me mf bi translated">使用 python 函数的代码:</li></ul><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mp ml l"/></div></figure><h2 id="1cb2" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">2)模型构建:</h2><p id="971e" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">我已经根据“工作日”列分离了数据，因为与非工作日相比，工作日的需求变化很大。</p><p id="07c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我建立了两个模型，一个预测“休闲”，另一个预测“注册”。预测的“计数”是预测的“临时”和预测的“注册”的总和。这里，我只展示了预测工作日“已注册”的代码。同样的技术可以用于预测工作日的“休闲”和非工作日的“休闲”、“注册”。最后可以检查全部代码。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><ul class=""><li id="63b3" class="lv lw iq kf b kg kh kk kl ko mm ks mn kw mo la mc md me mf bi translated"><strong class="kf ir">线性回归</strong></li></ul><p id="7933" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">线性回归<strong class="kf ir"> </strong>在这里被用作基础模型，尽管我们知道线性回归在这里不起作用。我们拟合该模型以使用该模型的‘均方误差’( mean _ squared _ log _ error)作为参考来检查其他模型的表现如何。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><ul class=""><li id="5d52" class="lv lw iq kf b kg kh kk kl ko mm ks mn kw mo la mc md me mf bi translated"><strong class="kf ir">决策树</strong></li></ul><p id="b5ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对'<strong class="kf ir"> max_depth </strong>'和'<strong class="kf ir"> min_samples_leaf </strong>'参数进行参数调整。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="b73a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用最佳参数建立决策树模型。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><ul class=""><li id="58e8" class="lv lw iq kf b kg kh kk kl ko mm ks mn kw mo la mc md me mf bi translated"><strong class="kf ir">随机森林</strong></li></ul><p id="b964" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对'<strong class="kf ir"> n_estimators </strong>'、<strong class="kf ir"> max_depth </strong>和'<strong class="kf ir"> min_samples_leaf </strong>参数进行参数调整。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="bd38" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用最佳参数建立随机森林模型。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><ul class=""><li id="29e6" class="lv lw iq kf b kg kh kk kl ko mm ks mn kw mo la mc md me mf bi translated"><strong class="kf ir"> Ada-Boost </strong></li></ul><p id="e75d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用基本模型作为我们在上面找到的“最佳随机森林模型”来寻找最佳的 n 估计量。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="f674" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用最佳 n 估计量建立一个最终的 Ada 推进模型。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><h2 id="2885" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">3)分析错误</h2><p id="a63a" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">上述模型在工作日预测“注册”的均方根对数误差(<strong class="kf ir"> RMSLE </strong>):</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/98520a5ce30efc354ec4f736c2163a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*T_W4dG9zV6N-A4x6Ct-lCg.jpeg"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">每个模型的 RMSLE 分数</p></figure><p id="7765" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">随机森林</strong>的 RMSLE 分数<strong class="kf ir">最低</strong>，非工作日也是如此。因此，我们可以得出结论，随机森林是这里的最佳模型。</p><h2 id="3797" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">4)最终模型</h2><p id="f4ac" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">在对整个数据进行模型拟合后，以下是工作日和非工作日的 RMLSE 得分。</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/5ad29c6d0270625618aa4cb02b030256.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*NZk2P4G4Ma-2pBigypDSBg.jpeg"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">一个工作日和非工作日的 RMSLE 分数</p></figure><p id="b939" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">整体数据</strong>的 RMSLE 分数结果为<strong class="kf ir"> 0.351。</strong></p><p id="b633" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用 python 函数的代码:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mp ml l"/></div></figure><h2 id="2dea" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">5)特征重要性</h2><p id="333d" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">对于工作日，预测“已登记”的重要特征是:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/59591bfa3b1fba3b2cfeb8be7e25d7f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*OSXRduCAVJyl_M22KjnZ6g.jpeg"/></div></figure><p id="6c14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于工作日，预测“休闲”的重要特征是:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/5c59edf99aafa69dc981a476f0cb3d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*e8W_KkQ7RizBxjVZrqvK8w.jpeg"/></div></figure><p id="c008" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">非工作日的特性重要性也类似于工作日。因此，<strong class="kf ir">时间、湿度、温度和月份</strong>是所有情况下最重要的<strong class="kf ir">特征</strong>。</p><h2 id="00f6" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">6)模型测试</h2><p id="7951" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">由于测试数据缺少一些列，我们将编写一个新的函数，使用以前的模型来预测“计数”。</p><p id="1c1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用 python 函数的代码:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mp ml l"/></div></figure><p id="7411" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更新和保存 CSV 文件:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="b48f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后在 Kaggle 提交了这个文件后，我得到了一个 RMSLE 的分数<strong class="kf ir"> 0.513。</strong></p><p id="df02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在这里找到完整的代码<a class="ae kc" href="https://github.com/pawanreddy-u/ML_Projects/blob/master/Bike_final.ipynb" rel="noopener ugc nofollow" target="_blank"/>。</p></div></div>    
</body>
</html>