<html>
<head>
<title>Mastering Dates and Timestamps in Pandas (and Python in general)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">掌握 Pandas(和 Python)中的日期和时间戳</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mastering-dates-and-timestamps-in-pandas-and-python-in-general-5b8c6edcc50c?source=collection_archive---------3-----------------------#2020-03-04">https://towardsdatascience.com/mastering-dates-and-timestamps-in-pandas-and-python-in-general-5b8c6edcc50c?source=collection_archive---------3-----------------------#2020-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="97a9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你所需要的就是在熊猫中处理日期和时间戳！提供了许多例子。</h2></div><h1 id="6d12" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated"><strong class="ak">内容</strong></h1><ul class=""><li id="4d1d" class="kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">一般日期</li></ul><p id="8fe1" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">更具体地说，用…处理操作</p><ul class=""><li id="d89a" class="kx ky iq kz b la lr lc lt le me lg mf li mg lk ll lm ln lo bi translated">天</li><li id="2c9e" class="kx ky iq kz b la mh lc mi le mj lg mk li ml lk ll lm ln lo bi translated">周；星期</li><li id="82ab" class="kx ky iq kz b la mh lc mi le mj lg mk li ml lk ll lm ln lo bi translated">月份</li><li id="dcdd" class="kx ky iq kz b la mh lc mi le mj lg mk li ml lk ll lm ln lo bi translated">年</li></ul><p id="9e0f" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">额外:生成日期范围</p><ul class=""><li id="b628" class="kx ky iq kz b la lr lc lt le me lg mf li mg lk ll lm ln lo bi translated">生成连续的日期范围</li><li id="5e97" class="kx ky iq kz b la mh lc mi le mj lg mk li ml lk ll lm ln lo bi translated">生成随机日期范围</li></ul><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mm"><img src="../Images/b032f1f55dd7ac34090319a13035eeb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ugkz9tNs16_66dQF"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">照片由<a class="ae nc" href="https://unsplash.com/@aronvisuals?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Aron 视觉效果</a>在<a class="ae nc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="2c87" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">一般日期</h1><p id="cd45" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">(*)在运行任何代码之前，请导入熊猫！</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="f4ba" class="nl kg iq nh b gy nm nn l no np">import pandas as pd</span></pre><p id="a0e5" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">现在，让我们开始吧。</p><h2 id="788f" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated"><strong class="ak">改变列数据框架中的日期格式</strong></h2><p id="757b" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">按照这个简单的<a class="ae nc" href="http://strftime.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir"> strftime </strong> </a>文档，你可以随意选择每种格式。</p><p id="808d" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">例如，从这个数据框架开始:</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/123017336107b41519f1cc959b87e52b.png" data-original-src="https://miro.medium.com/v2/resize:fit:352/format:webp/1*8WpZ-pDpZbpp_WthChrNQA.png"/></div></figure><p id="33a8" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">将<strong class="kz ir">日期格式</strong>更改为:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="947b" class="nl kg iq nh b gy nm nn l no np">df['date'] = df['date'].apply(lambda x: pd.Timestamp(x).<strong class="nh ir">strftime('%Y-%m-%d')</strong>)</span></pre><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/87191fe439143e93d0a1b3f721a5eaac.png" data-original-src="https://miro.medium.com/v2/resize:fit:254/format:webp/1*tu00dTKamkecn8rnkhU0TA.png"/></div></figure><p id="82aa" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">或者，我们可以来点更有异国情调的:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="1575" class="nl kg iq nh b gy nm nn l no np">df['date'] = df['date'].apply(lambda x: pd.Timestamp(x).<strong class="nh ir">strftime('%B-%d-%Y %I:%M %p')</strong>)</span></pre><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/50d9f215ef8eafe9e61596ab6cc4c5c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*HQaOs2y-_0jUpULuLg74-g.png"/></div></figure><p id="ce6a" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">请记住，您可以选择的时间戳格式的所有变体都可以在此链接中找到:<a class="ae nc" href="http://strftime.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir"> strftime </strong> </a></p><p id="600e" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">你自己试试！从这个示例构建的数据框架开始:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="6354" class="nl kg iq nh b gy nm nn l no np">df = pd.DataFrame({'date': ['2018-08-09 11:10:55','2019-03-02 13:15:21']})</span></pre><h2 id="226d" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">将列类型从对象/字符串更改为日期时间</h2><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="21cd" class="nl kg iq nh b gy nm nn l no np"># 4 possible options</span><span id="beae" class="nl kg iq nh b gy oe nn l no np"># 1<br/>df['date'] = pd.to_datetime(df['date'])<br/># 2<br/>df['date'] = df['date'].astype('datetime64[ns]')<br/># 3<br/>df['date'] = df['date'].apply(lambda x: parse(x))<br/># 4<br/>df['date'] = df['date'].apply(lambda x: pd.Timestamp(x))</span></pre><p id="57e0" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">示例(我们只尝试了 4 个选项中的一个，但所有选项都应该有效)</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="6056" class="nl kg iq nh b gy nm nn l no np">df = pd.DataFrame({'date': ['2018-08-09 11:10:55','2019-01-02 13:15:21']})</span><span id="d1b8" class="nl kg iq nh b gy oe nn l no np">df<br/>df.dtypes</span><span id="cb85" class="nl kg iq nh b gy oe nn l no np">df['date'] = pd.to_datetime(df['date'])<br/>df<br/>df.dtypes</span></pre><p id="9da7" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出:</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/e6c9e116038c6e0df04bbd98e9ed976e.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/1*iz4tRjTcsyhKOYr4ugd-1g.png"/></div></figure><h2 id="331f" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">从字符串到日期格式，再从日期格式到字符串</h2><p id="f8d8" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">隔离变量示例:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="8c4a" class="nl kg iq nh b gy nm nn l no np">from dateutil.parser import parse</span><span id="9c3d" class="nl kg iq nh b gy oe nn l no np">str_date = '2018-05-01'</span><span id="3e7c" class="nl kg iq nh b gy oe nn l no np"># String to Date:<br/>date_1 = parse(str_date)<br/>print ('date_1: ',date_1, type(date_1))</span><span id="9711" class="nl kg iq nh b gy oe nn l no np"># Date to String:<br/>date_2 = date_1.strftime('%Y-%m-%d')<br/>print ('date_2: ',date_2, type(date_2))</span></pre><p id="c9a0" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出:</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/a669fc9e094bcacd6016815e76c29514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/0*FLEagpgdxTbLhw2_"/></div></figure><h2 id="611a" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">从 Unix/纪元时间到可读日期格式</h2><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="f333" class="nl kg iq nh b gy nm nn l no np">df['date'] = pd.to_datetime(df['date'],unit='s')</span></pre><p id="bc16" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">示例:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="36ee" class="nl kg iq nh b gy nm nn l no np">df = pd.DataFrame({'date': [1349720105,1349806505]})</span><span id="f806" class="nl kg iq nh b gy oe nn l no np">df</span><span id="f106" class="nl kg iq nh b gy oe nn l no np">df['date'] = pd.to_datetime(df['date'],unit='s')</span><span id="7b1e" class="nl kg iq nh b gy oe nn l no np">df</span></pre><p id="5eff" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出(之前和之后):</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/297ddfd45fbb171c7aceaa1a0855ede8.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/format:webp/1*vCOc_Vyq_cPsFOzOMM_MuQ.png"/></div></figure><h2 id="a545" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">加减日期</h2><p id="3b6a" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">使用<strong class="kz ir">时间增量</strong>！示例:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="4109" class="nl kg iq nh b gy nm nn l no np">from datetime import datetime, timedelta<br/>from dateutil.parser import parse</span><span id="4b53" class="nl kg iq nh b gy oe nn l no np">parse('2019-04-07') — timedelta(days=3)</span><span id="8df7" class="nl kg iq nh b gy oe nn l no np"># or, to get it as a string<br/>(parse('2019-04-07') — timedelta(days=3)).strftime('%Y-%m-%d')</span></pre><p id="cf6a" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="55e9" class="nl kg iq nh b gy nm nn l no np"># with date format <br/>datetime.datetime(2019, 4, 4, 0, 0) </span><span id="74ea" class="nl kg iq nh b gy oe nn l no np"># with string format<br/>'2019-04-04'</span></pre><h2 id="0fe2" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">得到两个日期之间的差异</h2><p id="d628" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">将两个字符串转换成日期格式，然后进行计算。示例:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="f3d8" class="nl kg iq nh b gy nm nn l no np">from dateutil.parser import parse</span><span id="65ce" class="nl kg iq nh b gy oe nn l no np">d1 = parse('2018-12-01')<br/>d2 = parse('2018-12-08')<br/>abs((d2 - d1).days)</span></pre><p id="98c3" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="172f" class="nl kg iq nh b gy nm nn l no np">7<br/># 7 days</span></pre><h1 id="3a7d" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">带天数的操作</h1><h2 id="a2b8" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">从日期中获取日期</h2><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="986f" class="nl kg iq nh b gy nm nn l no np"># for a column in a DataFrame<br/>from datetime import datetime as dt<br/>df['day'] = df['date'].dt.day</span><span id="ec84" class="nl kg iq nh b gy oe nn l no np"># for a single value<br/>from dateutil.parser import parse<br/>parse('2018-08-09').day</span></pre><p id="dd76" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="1030" class="nl kg iq nh b gy nm nn l no np">9</span></pre></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><h1 id="4eba" class="kf kg iq bd kh ki op kk kl km oq ko kp jw or jx kr jz os ka kt kc ot kd kv kw bi translated">数周的操作</h1><h2 id="254e" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">获取一年中的第几周</h2><p id="3f4b" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">示例:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="94d3" class="nl kg iq nh b gy nm nn l no np">df = pd.DataFrame({'date': ['2018-08-09 11:10:55','2019-01-02 13:15:21']})</span><span id="d149" class="nl kg iq nh b gy oe nn l no np"># if date column type is a string<br/>df['week'] = pd.DatetimeIndex(df['date']).week</span><span id="1b50" class="nl kg iq nh b gy oe nn l no np"># if date column type is a datetime<br/># df['week'] = df['date'].dt.week</span></pre><p id="6039" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出:</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/aa372d22d303e2dacb72b1287d8dc77e.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*cUuQwmnwIgjaOmYQf-ABsA.png"/></div></figure><p id="7277" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">(*)要创建 yyyy-ww 格式的周列，请使用:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="3e7a" class="nl kg iq nh b gy nm nn l no np">df = pd.DataFrame({'date': ['2018-08-09 11:10:55','2019-03-02 13:15:21']})</span><span id="067c" class="nl kg iq nh b gy oe nn l no np"># if column type is a string/object<br/>df['yyyy_ww'] = pd.DatetimeIndex(df['date']).strftime('%Y-%U')</span><span id="5158" class="nl kg iq nh b gy oe nn l no np"># if column type is a datetime<br/># df['yyyy_ww'] = df['date'].dt.strftime('%Y-%U')</span></pre><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/b454b16706970513cd610a8a36e1990a.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*n3Oojgr0elvN5wltBs1ntw.png"/></div></figure><p id="9bc6" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">对于独立变量:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="95ee" class="nl kg iq nh b gy nm nn l no np">import datetime<br/>date_1 = '2018-02-06'<br/>parse(date_1).isocalendar()[1]</span></pre><p id="c531" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="e423" class="nl kg iq nh b gy nm nn l no np">6<br/># 6th week of the year</span></pre><h2 id="a1d8" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">获取工作日</h2><p id="41c2" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">示例:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="8c88" class="nl kg iq nh b gy nm nn l no np">df['weekday'] = df['date'].apply(lambda x: parse(str(x)).strftime("%A"))</span></pre><p id="03db" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出:</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/966a6236897d3464b2f92a3c13673756.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*f43ZajT2xcw07gN62zvE5w.png"/></div></figure><h2 id="b9df" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">从年-周格式转换到 yyyy-mm-dd 格式(获得一周的第一天和最后一天)</h2><p id="47b3" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">示例:您想知道 2018 年第 37 周的开始和结束日期:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="158b" class="nl kg iq nh b gy nm nn l no np"># define this function<br/>def get_start_end_dates(yyyyww):<br/>    year = yyyyww[:4]<br/>    week = yyyyww[-2:]<br/>    first_day_year = str(year) + '-' +  '01' + '-' + '01'<br/>    d = parse(first_day_year)<br/>    if(d.weekday()&lt;= 3):<br/>        d = d - timedelta(d.weekday())             <br/>    else:<br/>        d = d + timedelta(7-d.weekday())<br/>    dlt = timedelta(days = (int(week)-1)*7)<br/>    return (d + dlt).strftime('%Y-%m-%d'),  (d + dlt + timedelta(days=6)).strftime('%Y-%m-%d')</span><span id="027e" class="nl kg iq nh b gy oe nn l no np"># run it<br/>get_start_end_dates('201837')</span></pre><p id="c4f1" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出(包含一周的开始和结束的元组):</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="274d" class="nl kg iq nh b gy nm nn l no np">('2018-09-10', '2018-09-16')</span></pre></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><h1 id="9767" class="kf kg iq bd kh ki op kk kl km oq ko kp jw or jx kr jz os ka kt kc ot kd kv kw bi translated">月操作</h1><h2 id="a7f5" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">获取一年中的月份号</h2><p id="743a" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">示例:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="49fb" class="nl kg iq nh b gy nm nn l no np">df = pd.DataFrame({'date': ['2018-08-09 11:10:55','2019-03-02 13:15:21']})</span><span id="3cdb" class="nl kg iq nh b gy oe nn l no np"># if date column type is a string/object<br/>df['month'] = pd.DatetimeIndex(df['date']).month</span><span id="6722" class="nl kg iq nh b gy oe nn l no np"># if date column type is a datetime<br/># df['month'] = df['date'].dt.month</span></pre><p id="d326" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出:</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/31fd4a934bbd994fc4fc03a715b01e12.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*qleU1mSefptUFpeo_DGidQ.png"/></div></figure><p id="0575" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">对于独立变量:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="5902" class="nl kg iq nh b gy nm nn l no np">import datetime<br/>date_1 = '2018-02-06'<br/>parse(date_1).month</span></pre><p id="ab98" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="2550" class="nl kg iq nh b gy nm nn l no np">2<br/># 2nd month of the year</span></pre><p id="8f14" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">(*)要创建 YYYY-MM 格式的月份列，请使用:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="c3e1" class="nl kg iq nh b gy nm nn l no np">df = pd.DataFrame({'date': ['2018-08-09 11:10:55','2019-03-02 13:15:21']})</span><span id="fd5f" class="nl kg iq nh b gy oe nn l no np"># if column type is a string/object<br/>df['yyyy_mm'] = pd.DatetimeIndex(df['date']).strftime('%Y-%m')</span><span id="fcc6" class="nl kg iq nh b gy oe nn l no np"># if column type is a datetime<br/># df['yyyy_mm'] = df['date'].dt.strftime('%Y-%m')</span></pre><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/6b01769d6fd469c6d81d5a531399d6db.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*qOcv7eLCUSqtsPAfGJgiNw.png"/></div></figure><h2 id="fa37" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">加减月份(向前或向后移动 X 个月)</h2><p id="1d87" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">使用此功能</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="679b" class="nl kg iq nh b gy nm nn l no np">def monthdelta(date, delta):<br/>    m, y = (date.month+delta) % 12, date.year + ((date.month)+delta-1) // 12<br/>    if not m: m = 12<br/>    d = min(date.day, [31,<br/>        29 if y%4==0 and not y%400==0 else 28,31,30,31,30,31,31,30,31,30,31][m-1])<br/>    new_date = (date.replace(day=d,month=m, year=y))<br/>    return new_date.strftime('%Y-%m-%d')</span></pre><p id="cbb6" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">示例(某个日期减去 4 个月):</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="9ffb" class="nl kg iq nh b gy nm nn l no np">monthdelta(parse('2019-11-09'), -4)</span></pre><p id="e21e" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出(显示相同的日期，但在 4 个月之前):</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="f75b" class="nl kg iq nh b gy nm nn l no np">'2019-07-09'</span></pre></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><h1 id="053c" class="kf kg iq bd kh ki op kk kl km oq ko kp jw or jx kr jz os ka kt kc ot kd kv kw bi translated">运营年限</h1><h2 id="e5fe" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">获得年份</h2><p id="45a7" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">示例:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="40d0" class="nl kg iq nh b gy nm nn l no np">df = pd.DataFrame({'date': ['2018-08-09 11:10:55','2019-03-02 13:15:21']})</span><span id="6ece" class="nl kg iq nh b gy oe nn l no np"># if date column type is a string/object<br/>df['year'] = pd.DatetimeIndex(df['date']).year</span><span id="6eda" class="nl kg iq nh b gy oe nn l no np"># if date column type is a datetime<br/># df['year'] = df['date'].dt.year</span></pre><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/08c2757658a93860de645ea12eeb9086.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*6QNpChf237bVCZadn0eSGw.png"/></div></figure><p id="29b9" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">对于独立变量:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="821f" class="nl kg iq nh b gy nm nn l no np">import datetime<br/>date_1 = '2018-02-06'<br/>parse(date_1).year</span></pre><p id="8d63" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">输出:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="b108" class="nl kg iq nh b gy nm nn l no np">2018</span></pre><h1 id="1580" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">生成数据范围</h1><h2 id="1d69" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">生成连续的日期范围</h2><p id="30a9" class="pw-post-body-paragraph lp lq iq kz b la lb jr ls lc ld ju lu le nd lw lx lg ne lz ma li nf mc md lk ij bi translated">示例:生成从 2019 年 1 月 1 日到 2019 年 1 月 2 日的日期范围，频率为每小时。</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="b388" class="nl kg iq nh b gy nm nn l no np">from datetime import datetime<br/>import numpy as np</span><span id="51f0" class="nl kg iq nh b gy oe nn l no np">date_range = pd.date_range(start='01/01/2019', end='01/02/2019', freq='H')</span></pre><p id="570c" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">参见<a class="ae nc" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases" rel="noopener ugc nofollow" target="_blank">中的不同频率选项。</a></p><h2 id="f799" class="nl kg iq bd kh nq nr dn kl ns nt dp kp le nu nv kr lg nw nx kt li ny nz kv oa bi translated">生成随机日期范围</h2><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="c383" class="nl kg iq nh b gy nm nn l no np">import random<br/>import time<br/>from dateutil.parser import parse</span><span id="5b31" class="nl kg iq nh b gy oe nn l no np">def str_time_prop(start, end, format, prop):<br/>    stime = time.mktime(time.strptime(start, format))<br/>    etime = time.mktime(time.strptime(end, format))<br/>    ptime = stime + prop * (etime - stime)<br/>    return time.strftime(format, time.localtime(ptime))</span><span id="f213" class="nl kg iq nh b gy oe nn l no np">selected_format = '%Y-%m-%d %H:%M:%S'</span><span id="509e" class="nl kg iq nh b gy oe nn l no np">def random_date(start, end, prop):<br/>    return parse(str_time_prop(start, end, selected_format, prop)).strftime(selected_format)</span><span id="05bc" class="nl kg iq nh b gy oe nn l no np">print(random_date("2020-01-01 13:40:00", "2020-01-01 14:10:00", random.random()))</span><span id="16f4" class="nl kg iq nh b gy oe nn l no np">def make_date(x):<br/>    return random_date("2012-12-01 13:40:00", "2012-12-24 14:50:00", random.random())</span></pre><p id="68bb" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">这里是这个函数的<a class="ae nc" href="# more https://stackoverflow.com/questions/553303/generate-a-random-date-between-two-other-dates" rel="noopener ugc nofollow">源</a>。</p><p id="3e6a" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">由此，我们可以生成随机日期。例如，让我们生成圣诞节和新年之间的 10 个随机时间戳的列表:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="70b0" class="nl kg iq nh b gy nm nn l no np">def make_date(x):<br/>    return random_date("2012-12-24 00:00:00", "2012-12-31 23:59:59", random.random())</span><span id="31c8" class="nl kg iq nh b gy oe nn l no np">[make_date(x) for x in range(10)]</span></pre><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/5ec1075232a6feb5a91fc87b7707a87b.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*ByYljojEz0R_EhQGZzpPVw.png"/></div></figure><p id="2aac" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">我们还可以将它添加到任何数据帧中，如下所示:</p><pre class="mn mo mp mq gt ng nh ni nj aw nk bi"><span id="5ca1" class="nl kg iq nh b gy nm nn l no np">df = pd.DataFrame({'number': [1,2,3,4,5]})<br/>df['time'] = df['number'].apply(make_date)<br/>df</span></pre><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/f69062347500880ee30e34dd8eb8f05b.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*xhjQWzlGmiIc_dDLrmYpLA.png"/></div></figure></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><p id="8030" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">这是文章的结尾。希望你喜欢它，也希望你能好好利用它！</p><p id="ba3b" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">如果您有任何问题，请给我发消息或留下回复。</p><p id="dbd9" class="pw-post-body-paragraph lp lq iq kz b la lr jr ls lc lt ju lu le lv lw lx lg ly lz ma li mb mc md lk ij bi translated">如果你想在将来了解类似这样的文章，请关注我！</p></div></div>    
</body>
</html>