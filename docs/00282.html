<html>
<head>
<title>How to create your own Custom Object Detector</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建自己的自定义对象检测器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-your-own-custom-object-detector-766cb11ccd1c?source=collection_archive---------11-----------------------#2020-01-09">https://towardsdatascience.com/how-to-create-your-own-custom-object-detector-766cb11ccd1c?source=collection_archive---------11-----------------------#2020-01-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="8bad" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">目标检测</h2><div class=""/><div class=""><h2 id="e1cd" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用 YOLOv3 和 ImageAI 创建您的自定义对象检测器</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/2106b512469b5edbc8cda6e4f6765a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ySz_Y6AsNdBMnzLs"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">伊利亚·巴甫洛夫在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="12a4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这篇文章旨在帮助那些想第一次开发自己的自定义对象检测器的初学者，指导他们通过所有的关键点来训练一个成功的模型。</p><p id="c431" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所示的例子将用<a class="ae lh" href="https://github.com/OlafenwaMoses/ImageAI/blob/master/imageai/Detection/Custom/CUSTOMDETECTIONTRAINING.md" rel="noopener ugc nofollow" target="_blank"> ImageAI </a>进行训练，这是一个开源的 Python 库，它允许你用几行代码训练一个模型。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="927d" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">介绍</h1><p id="6871" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">在本文中，我们将详细介绍创建自定义对象检测器的所有必要步骤，从收集数据到最终测试我们的模型。</p><p id="06a9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">整个过程的步骤是:</p><ol class=""><li id="fe06" class="ni nj it lk b ll lm lo lp lr nk lv nl lz nm md nn no np nq bi translated">收集数据</li><li id="bd7e" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md nn no np nq bi translated">标注数据集</li><li id="1f4b" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md nn no np nq bi translated">数据扩充</li><li id="43cc" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md nn no np nq bi translated">培训模式</li><li id="b6f2" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md nn no np nq bi translated">评估模型</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="7f27" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">数据采集</h1><p id="2039" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">在我们训练我们的模型之前，我们需要收集大量的数据，在这种情况下，是图像。根据检测机的复杂程度，最少 200 张图像应该没问题。</p><p id="6043" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们希望我们的模型尽可能健壮，我们的图像应该在光照和背景方面彼此不同，这样模型才能更好地概括。</p><p id="6d60" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些图像可以从你的手机上获取，也可以从互联网上获取。</p><p id="6d5e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这里，您可以看到我的药丸探测器模型的一个子集:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/c07fdb1130689f5d425937bced082edf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*UNIe-0-zND47nCKubwrsmA.png"/></div></figure><p id="edc8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">收集数据后，我们需要调整图像的大小，因为有些图像可能会很大。更小的图像意味着我们的模型将训练得更快。</p><p id="c23f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为此，我编写了以下脚本:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="ce46" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">标签数据</h1><p id="e623" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">这是最繁琐的一步，因为你需要在每张图像中标注出你希望模型检测到的每一个物体。</p><p id="8508" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以用<a class="ae lh" href="https://github.com/tzutalin/labelImg" rel="noopener ugc nofollow" target="_blank"> LabelImg </a>库给你的数据加标签。运行以下命令从终端安装它。</p><pre class="ks kt ku kv gt nz oa ob oc aw od bi"><span id="05e9" class="oe mm it oa b gy of og l oh oi">pip3 install labelImg</span></pre><p id="d166" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">安装完成后，我们可以通过运行以下命令开始标记数据集。</p><pre class="ks kt ku kv gt nz oa ob oc aw od bi"><span id="d758" class="oe mm it oa b gy of og l oh oi">labelImg path_to_images/</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oj"><img src="../Images/ab83050e2b23f60f2e25dac555dcf2fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GHfCdbT35JCduOQ2mPta7g.png"/></div></div></figure><p id="de40" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，您必须为图像中的每个对象创建一个带有相应标签的矩形框。</p><p id="1292" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦标记了图像中的所有对象，就必须将其保存为 PascalVOC 格式，生成一个. xml 文件。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="d05d" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">数据扩充</h1><p id="4ced" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">拥有大型数据集对于我们深度学习模型的性能至关重要，因此我们可以使用<a class="ae lh" href="https://github.com/aleju/imgaug" rel="noopener ugc nofollow" target="_blank"> imgaug </a>库来扩充我们已经拥有的数据。</p><p id="2dfb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个 github repo 解释并提供了关于如何在图像边界框旁边增加图像的代码。这个过程可以分为三个步骤:</p><ol class=""><li id="c6c1" class="ni nj it lk b ll lm lo lp lr nk lv nl lz nm md nn no np nq bi translated">转换。xml 文件合并成一个。csv 文件</li><li id="1c7b" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md nn no np nq bi translated">应用数据增强管道</li><li id="edf6" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md nn no np nq bi translated">转换结果。csv 文件分成多个。xml 文件</li></ol><p id="6ad8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我们定义一个函数来转换我们的。xml 文件合并成一个。csv 文件:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="f7ed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后我们定义另一个函数来做相反的过程:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="5d63" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我们用<a class="ae lh" href="https://github.com/aleju/imgaug" rel="noopener ugc nofollow" target="_blank"> imgaug </a>定义一个数据增强管道，比如下面这个。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="7892" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我们将这个管道应用到我们的数据集，并保存增强图像及其增强标签。你还要定义<em class="ok"> image_aug() </em>和<em class="ok"> bbs_obj_to_df() </em>函数，在这个 github repo 里可以找到<a class="ae lh" href="https://github.com/asetkn/Tutorial-Image-and-Multiple-Bounding-Boxes-Augmentation-for-Deep-Learning-in-4-Steps/blob/master/Tutorial-Image-and-Multiple-Bounding-Boxes-Augmentation-for-Deep-Learning-in-4-Steps.ipynb" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="f632" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">训练模型</h1><p id="61bc" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">在所有这些预处理之后，我们最终可以用<a class="ae lh" href="https://github.com/OlafenwaMoses/ImageAI#customdetectiontraining" rel="noopener ugc nofollow" target="_blank"> ImageAI </a>训练我们的模型。</p><p id="e052" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我们需要安装库。</p><pre class="ks kt ku kv gt nz oa ob oc aw od bi"><span id="af09" class="oe mm it oa b gy of og l oh oi">pip3 install imageai</span></pre><p id="7d42" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要使用迁移学习，可以在这里下载模型<a class="ae lh" href="https://github.com/OlafenwaMoses/ImageAI/releases/tag/essential-v4" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="bd95" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我们需要将数据集分成训练和验证文件夹。</p><pre class="ks kt ku kv gt nz oa ob oc aw od bi"><span id="cc31" class="oe mm it oa b gy of og l oh oi">dataset<br/>├─ train<br/>│   └── images<br/>│   └── annotations<br/>└─ validation<br/>    ├── images<br/>    ├── annotations</span></pre><p id="2051" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以通过下面几行代码做到这一点:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="963f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后我们可以用下面的脚本进行训练。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="24fc" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">评估模型</h1><p id="3b42" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">一旦我们训练了我们的检测器，我们就可以通过它的映射来评估每个模型检查点的执行情况。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="fd68" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">输出应该类似于以下内容:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/4c53ef9d0537b9ab4edb7c19d76ebb37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*GEpd5Hk0js3x4jT38uuyhA.png"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="ed82" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">使用我们的模型进行检测</h1><p id="0466" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">最后，我们可以在生产中使用我们的模型来检测单个图像中的对象。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="dcbc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以调整<em class="ok">minimum _ percentage _ probability</em>参数，以或多或少的置信度显示检测到的对象，获得如下结果。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi om"><img src="../Images/b146fe47a829611c3ee55ef100a83864.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*sjf-tHHdrQ3H4so8q0R0DQ.jpeg"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="50c1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在我想听听你的意见，让我知道它是如何工作的！</p><p id="455e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">感谢阅读！</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="3214" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">参见</strong></p><div class="on oo gp gr op oq"><a href="https://neptune.ai/blog/object-detection-algorithms-and-libraries" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd jd gy z fp ov fr fs ow fu fw jc bi translated">对象检测算法和库- neptune.ai</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">对象检测在图像中找到并识别事物，这是深度学习的最大成就之一…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">海王星. ai</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe lb oq"/></div></div></a></div></div></div>    
</body>
</html>