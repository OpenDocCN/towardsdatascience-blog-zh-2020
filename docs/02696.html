<html>
<head>
<title>Impact of Coronavirus on Stock Prices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">冠状病毒对股票价格的影响</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/impact-of-coronavirus-on-stock-prices-41c108c1ec65?source=collection_archive---------34-----------------------#2020-03-15">https://towardsdatascience.com/impact-of-coronavirus-on-stock-prices-41c108c1ec65?source=collection_archive---------34-----------------------#2020-03-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bbe8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解一下武汉和欧洲爆发病毒以来，冠状病毒对股价的影响。</h2></div><p id="20eb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个故事中，我们将构建一个Python脚本来计算冠状病毒对股票价格的影响。我们将把意大利病毒爆发前的股票价格作为参考，并与几周后的相同股票价格进行比较。</p><p id="09dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将通过使用Python和Pandas计算多只股票的每日价格变化来实现这一点。我们的最终结果将显示在下面的数据框中，该数据框包含了相对于2月21日的股价百分比变化，2月21日是意大利病毒大爆发的前一天。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/cec9b89f6d6e097bd28bc130d39635f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aJgX-4h6ue-fIQRk"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Python for Finance —冠状病毒对股票价格的影响</p></figure><h1 id="8cde" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">冠状病毒对股票市场的影响</h1><p id="4d7a" class="pw-post-body-paragraph kf kg iq kh b ki mj jr kk kl mk ju kn ko ml kq kr ks mm ku kv kw mn ky kz la ij bi translated">我们都知道这种病毒确实起源于201年12月的武汉。它迅速发展到其他国家，最终<a class="ae mo" href="https://www.nytimes.com/2020/03/11/health/coronavirus-pandemic-who.html" rel="noopener ugc nofollow" target="_blank">已经成为一个全球性的疫情。</a></p><p id="86ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就股市影响而言，我认为股市只是在意大利疫情爆发后才受到病毒的影响。让我们看看我的理解是否正确。</p><p id="c76d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">冠状病毒对股票市场的真正影响是什么？让我们构建一个简单的Python脚本来找出答案。</p><p id="ca9b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我将选择10家公司进行分析。我选择了10家公司，这些公司是我之前一直在跟踪的潜在未来投资对象。自由地将你自己的公司添加到列表中。</p><p id="6031" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我已经将这10只股票添加到一个名为<strong class="kh ir"> <em class="mp">公司</em> </strong>的列表中。我们将对每个公司做的是:</p><ol class=""><li id="5d2b" class="mq mr iq kh b ki kj kl km ko ms ks mt kw mu la mv mw mx my bi translated"><strong class="kh ir"> <em class="mp">向<a class="ae mo" href="https://fmpcloud.io/documentation" rel="noopener ugc nofollow" target="_blank">财务API发出http请求</a></em> </strong>，下载历史价格数据。API通过创建一个免费账户提供500次免费的每日通话。</li><li id="71c6" class="mq mr iq kh b ki mz kl na ko nb ks nc kw nd la mv mw mx my bi translated">提取每家公司的n天历史价格，并将它们添加到熊猫数据框架中。注意:检查<a class="ae mo" href="https://fmpcloud.io/api/v3/historical-price-full/AAPL?serietype=line&amp;apikey=demo" rel="noopener ugc nofollow" target="_blank"> API历史价格端点</a>以查看API响应的结构。</li><li id="c1d0" class="mq mr iq kh b ki mz kl na ko nb ks nc kw nd la mv mw mx my bi translated">将每个股票数据帧连接成一个<strong class="kh ir"> s <em class="mp">单个数据帧</em> </strong>。</li><li id="1428" class="mq mr iq kh b ki mz kl na ko nb ks nc kw nd la mv mw mx my bi translated">以冠状病毒在欧洲爆发的前一天为参考，计算价格变化。</li></ol><pre class="lc ld le lf gt ne nf ng nh aw ni bi"><span id="a61b" class="nj ls iq nf b gy nk nl l nm nn">import pandas as pd<br/>import requests<br/><br/>#Store your API Key in demo. 500 free daily API calls<br/>demo ='YourAPIKEY'<br/><br/>companies = ['HEAR','F', 'GOOG', 'MSFT', 'AAPL', 'IBM', 'ORCL','AMZN','BABA','JNJ']<br/><br/>#Create a empty list to later add each of the stock prices DataFrame<br/>listofdf = []<br/># We will extract the latest 16 days of stock prices since it was when the virus outbreak started in Europe (i.e. 21st of February)<br/>days = -16<br/><br/>#(1)<br/>for item in companies:<br/>    histprices = requests.get(f"https://fmpcloud.io/api/v3/historical-price-full/{item}?serietype=line&amp;apikey={demo}")<br/>    histprices = histprices.json()<br/><br/>    #Parse the API response and select only last n days of prices. 16 days in our example<br/>    histprices = histprices['historical'][days:]</span></pre><p id="f302" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码所做的是提取包含在<strong class="kh ir"> <em class="mp">公司</em> </strong>列表中的每只股票的历史价格。然后，我们解析API响应并提取最近的16天。</p><p id="7f22" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以很容易地做到这一点，因为历史键中包含的响应是一个列表。因此，我们可以简单地对列表进行切片，以保留最新的16个元素，这16个元素代表最近的16个每日价格。下面是API响应的摘录，便于参考。</p><pre class="lc ld le lf gt ne nf ng nh aw ni bi"><span id="f190" class="nj ls iq nf b gy nk nl l nm nn">{<br/>"symbol": "AAPL",<br/>"historical": [<br/>{<br/>"date": "1989-09-19",<br/>"close": 1.54<br/>},<br/>{<br/>"date": "1989-09-20",<br/>"close": 1.59<br/>},<br/>{<br/>"date": "1989-09-21",<br/>"close": 1.6<br/>},...</span></pre><p id="bcd7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="mp">从API中提取最近n天的</em> </strong>。我们可以<strong class="kh ir"> <em class="mp">为每只股票</em> </strong> <em class="mp"> ( </em> 2)创建一个熊猫数据帧。我们使用pd。DataFrame.from_Dict方法在我们的字典之外创建一个包含每日价格的DataFrame。</p><p id="3baf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们将每个股票数据帧添加到一个列表中。</p><pre class="lc ld le lf gt ne nf ng nh aw ni bi"><span id="3b3d" class="nj ls iq nf b gy nk nl l nm nn">for item in companies:<br/>    histprices = requests.get(f"https://fmpcloud.io/api/v3/historical-price-full/{item}?serietype=line&amp;apikey={demo}")<br/>    histprices = histprices.json()<br/>    histprices = histprices['historical'][days:]  <br/>    #2<br/>    histpricesdf = pd.DataFrame.from_dict(histprices)<br/>     #rename column to the name of the stock<br/>    histpricesdf = histpricesdf.rename({'close': item}, axis=1) <br/>    #append all dfs to list<br/>    listofdf.append(histpricesdf)</span></pre><h1 id="7ba2" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">将所有股票价格放在一起</h1><p id="2b74" class="pw-post-body-paragraph kf kg iq kh b ki mj jr kk kl mk ju kn ko ml kq kr ks mm ku kv kw mn ky kz la ij bi translated">现在，我们已经将我们的每只股票的价格放入一个熊猫数据框架中。但是，我们希望将所有公司的价格放在一个数据框架中。</p><p id="8c24" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以很容易地将它们连接起来。首先，我们将日期<em class="mp">设置为每个数据帧的索引。然后，我们可以使用pd.concat方法将它们放在一起:</em></p><pre class="lc ld le lf gt ne nf ng nh aw ni bi"><span id="736e" class="nj ls iq nf b gy nk nl l nm nn">#set index of each DataFrame by common column before concatinatinghtem<br/>dfs = [df.set_index('date') for df in listofdf]<br/><br/>histpriceconcat = pd.concat(dfs,axis=1)</span></pre><p id="8c43" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，如果我们打印<strong class="kh ir"><em class="mp">histpricecontat</em></strong>，我们就有了一个漂亮的熊猫数据框架，其中包含了所选股票 的所有<strong class="kh ir"> <em class="mp">日价格。</em></strong></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/720b487e6e2ebb6767f7e834b70f52d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*edA9uY_tV2-xn0pL"/></div></div></figure><p id="e686" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过考察个股价格，很难发现冠状病毒对股价的影响是什么。我们看到价格一直在下降，但看看正常化的结果会更有意思。</p><p id="81e0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们要做的是用第一行数据除每只股票的每日价格。在我们的例子中，这是2月21日，因为这是所有冠状病毒病例开始在意大利出现的前一天，这将是我们的参考:</p><pre class="lc ld le lf gt ne nf ng nh aw ni bi"><span id="da75" class="nj ls iq nf b gy nk nl l nm nn">histpriceconcat = histpriceconcat/histpriceconcat.iloc[0] histpriceconcat['mean'] = histpriceconcat.mean(axis=1) </span><span id="2f94" class="nj ls iq nf b gy no nl l nm nn">histpriceconcat</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/e6d09995958ce1e21493453c43bad717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sR-JU9mgsJo_HuTA"/></div></div></figure><p id="b9b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">酷！现在，我们可以很容易地看到<strong class="kh ir">电晕病毒对股票价格的影响百分比。例如，我们看到像苹果这样的公司，在3月13日的收盘价比2月21日的价格低12%</strong>(即1–0.887941)。</p><p id="05df" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，亚马逊的股价有15%的折让，而中国公司阿里巴巴的股价只有9%的折让。</p><h1 id="a525" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">意大利爆发前冠状病毒对股价的影响</h1><p id="29f4" class="pw-post-body-paragraph kf kg iq kh b ki mj jr kk kl mk ju kn ko ml kq kr ks mm ku kv kw mn ky kz la ij bi translated">显然，冠状病毒在欧洲的爆发对股票价格产生了影响。但是中间的那段时间呢？那是危机第一次从武汉开始，直到病毒到达欧洲？</p><p id="f61b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过重现12月27日到2月21日的分析来轻松检查影响。我们可以通过修改下面两行代码来实现这一点:</p><pre class="lc ld le lf gt ne nf ng nh aw ni bi"><span id="616b" class="nj ls iq nf b gy nk nl l nm nn">#-53 days is the 27th of December 2019<br/>days = -53 <br/>#-15 days is the 21st of February   <br/>histprices = histprices['historical'][days:-15]</span></pre><p id="6791" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于大多数股票来说，在欧洲几乎没有病例的情况下，病毒的爆发似乎没有对股价产生影响。在此期间，股票价格平均上涨了2%。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi np"><img src="../Images/29bdcc455c048370ac5f932fbb0521e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OC4c3yV-LaiCWJnS"/></div></div></figure><h1 id="58e4" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">包扎</h1><p id="82e7" class="pw-post-body-paragraph kf kg iq kh b ki mj jr kk kl mk ju kn ko ml kq kr ks mm ku kv kw mn ky kz la ij bi translated">在这篇文章中，我们构建了一个很好的Python工具来计算多只股票的价格变化。我们这样做是为了分析冠状病毒对股票价格的影响。</p><p id="f9f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如所选股票所示，似乎只有当病毒爆发到达意大利时，股票价格才开始下跌。然而，我想指出这种分析的一个局限性。我几乎只选择了美国股票。</p><p id="4022" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对亚洲股票重复这一分析，看看结果是否会有所不同，将会很有意思。我把这个任务留给你。</p><p id="8782" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很高兴在我的Twitter账户中听到您的回复。参见以下脚本供您参考。</p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="18d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mp">原载于2020年3月15日</em><a class="ae mo" href="https://codingandfun.com/impact-coronavirus-stock-prices/" rel="noopener ugc nofollow" target="_blank"><em class="mp">【https://codingandfun.com】</em></a><em class="mp">。</em></p><pre class="lc ld le lf gt ne nf ng nh aw ni bi"><span id="49c9" class="nj ls iq nf b gy nk nl l nm nn">#Price change<br/>import pandas as pd<br/>import requests<br/><br/>companies = ['HEAR','F', 'GOOG', 'MSFT', 'AAPL', 'IBM', 'ORCL','AMZN','BABA','JNJ']<br/>listofdf = []<br/>days = -16<br/><br/>for item in companies:<br/>    histprices = requests.get(f"https://fmpcloud.io/api/v3/historical-price-full/{item}?serietype=line&amp;apikey={demo}")<br/>    histprices = histprices.json()<br/><br/>    #Parse the API response and select only last n days of prices<br/>    histprices = histprices['historical'][days:]<br/>    histpricesdf = pd.DataFrame.from_dict(histprices)<br/>    histpricesdf = histpricesdf.rename({'close': item}, axis=1) <br/>    #append all dfs to list<br/>    listofdf.append(histpricesdf)<br/><br/>#set index of each DataFrame by common column before concatinatinghtem<br/>dfs = [df.set_index('date') for df in listofdf]<br/><br/>histpriceconcat = pd.concat(dfs,axis=1)<br/>#divide all dataframe by first line of data to enable comparison<br/>histpriceconcat = histpriceconcat/histpriceconcat.iloc[0]<br/>histpriceconcat['mean'] = histpriceconcat.mean(axis=1)<br/><br/>histpriceconcat</span></pre></div></div>    
</body>
</html>