<html>
<head>
<title>How Jane Jacobs-y is Your Neighborhood? Analysis with Pandas, OpenStreetMap, and the US Census — Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的邻居简·雅各布斯怎么样？熊猫、开放街道地图和美国人口普查的分析——第一部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-jane-jacobs-y-is-your-neighborhood-65d678001c0d?source=collection_archive---------41-----------------------#2020-08-12">https://towardsdatascience.com/how-jane-jacobs-y-is-your-neighborhood-65d678001c0d?source=collection_archive---------41-----------------------#2020-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b1ec" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">基于熊猫、开放街道地图和美国人口普查的《美国大城市的死与生》的城市设计分析</h2></div><p id="9128" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在《美国大城市的生与死》中，伟大的简·雅各布斯展示了一个好社区的四个基本特征:</p><ul class=""><li id="4d2a" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated">密度</li><li id="1b3a" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">多种用途的混合</li><li id="8776" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">建筑年代、类型和状况的混合</li><li id="58d3" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">由短而相连的街区组成的街道网络</li></ul><p id="280b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，她对所有这些进行了更详细的描述，但我不会涉及所有的街头见闻。相反，我要去寻找有合适的“骨骼”来建造伟大的都市生活的社区。与大多数地理空间规划工具一样，需要注意的是，不要盲目信任它。有很多细节需要实地关注。</p><p id="922e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在数据上。</p><h1 id="2a4c" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">工具</h1><p id="7814" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">对于这个项目，我将使用下面的导入语句:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="2486" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要用 Census API 启动一个会话，您需要给它一个密钥(在这里得到一个<a class="ae mx" href="https://api.census.gov/data/key_signup.html" rel="noopener ugc nofollow" target="_blank"/>)。为了方便起见，我还将启动我的 OSM 工具，定义几个投影，并为我感兴趣的位置创建一些字典:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="ccba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这两个国家很有意思，因为它们都经历了战后的显著增长，并拥有广泛的发展模式。作为一名前博伊西居民，我非常了解阿达县，并能提供实地的见解。King County 拥有一个强大的数据平台，可以在本分析的第二部分提供不同的见解。</p><h2 id="22d6" class="my lu it bd lv mz na dn lz nb nc dp md kr nd ne mf kv nf ng mh kz nh ni mj nj bi translated">密度</h2><p id="96f0" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">我们会从简单开始。美国人口普查局定期发布人口估计，所以我们只需将这些数据进行一些几何运算，就能知道有多少人生活在不同的地区。我要使用的所有数据可用的最小地理区域是区域，所以这就是我们要得到的。</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="273f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我有了地理信息，我只需要得到人口来计算密度。显然，人口普查表是‘b 01003 _ 001 e’。下面是按县查询该表的函数:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="8501" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">既然我们有了包含人口的数据框架和包含区域的地理数据框架，我们只需将它们合并在一起:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="b5a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个函数更一般化一些，这样我们就可以将几何添加到人口以外的其他数据中，我们将在后面看到。</p><p id="b702" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以简单地调用我们的函数并绘制结果:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/d43ee5068d5f7ac13cf5036c741f5937.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*u8EAtMI3k3y0VOVrmG6qmw.png"/></div></figure><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi nn"><img src="../Images/ad99ea964d47a19867b618746041275d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jWzajMlkc0t-M0v7IHZ50A.png"/></div></div></figure><h1 id="22fa" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">建筑年代的混合</h1><p id="1eab" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">下一个最复杂的搜索是在每个区域内找到不同的建筑年代。幸运的是，人口普查有一些足够接近的数据。他们通过十年的建造时间来追踪小区内的房龄。首先，我们将从这些表名中创建一个字典:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="cb87" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，创建一个函数，将所有这些组合成一个数据帧。由于 Jane-Jacobsy-est 区域在每十年内最接近相等，因此最简单的度量标准是标准差，最低值为最佳值:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="c85e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，我们只需调用我们的函数并绘制结果:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/3f56ed93e71a5b70c658c44715dd51da.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*FEbILY7BM9qr4nnHKnJSjw.png"/></div></figure><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi ns"><img src="../Images/d56d370538715e100f237920ecb3262d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n2v12Ll_hHJwDxHWZUrbng.png"/></div></div></figure><h1 id="09d5" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">由短的相互连接的块组成的网络</h1><p id="6ffc" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">现在我们开始变得复杂。幸运的是，由于有了<a class="ae mx" href="https://github.com/gboeing/osmnx" rel="noopener ugc nofollow" target="_blank"> osmnx </a> Python 包，我们可以领先一步。我们将使用 graph_from_polygon 函数获取每个人口普查区域内的街道网络，然后使用 basic_stats 包获取平均街道长度和每个交叉路口的平均街道数量，即网络分析术语中的“节点”。然而，在我们这样做之前，我们需要解决我们的网络的一个问题:OpenStreetMap 将停车场车道作为街道网络的一部分，这将扭曲我们的结果，因为这些往往相对较短，至少在地面停车场的内部连接。为了解决这个问题，我们将查询该县的所有停车场，然后将它们从我们的小册子中排除，以获得一些瑞士奶酪小册子。首先，函数查询 OSM 的东西，一般化，因为我们将在下一节大量使用它:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="c245" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要获得免停车区域:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="b922" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这不会是一个完美的解决方案，因为很多停车场并没有这样的标签，但它至少会排除很多这样的停车场。现在，我们可以创建一个函数来迭代每个区域，并获得一个“街道分数”，我将它定义为区域内街道的平均长度除以每个十字路口的街道数量:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="cdfe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这需要一段时间，所以我包括了一个进度条和地图输出，让我在等待时开心。还有一些区域没有街道(我假设是普吉特湾)，因此有了 try/except。现在我们调用这个函数:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi nt"><img src="../Images/fe3546030f4895199cbbb7410c014420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*JrNyHtoCKvMbd4fsbwnUJQ.png"/></div></div></figure><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi nu"><img src="../Images/68446abfa9f41f282d4e75376b4612ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCLTuO2MNYNPH_zptrCCZA.png"/></div></div></figure><h2 id="c730" class="my lu it bd lv mz na dn lz nb nc dp md kr nd ne mf kv nf ng mh kz nh ni mj nj bi translated">多种用途的混合</h2><p id="8415" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">现在是分析中最复杂的部分。以下是我的总体计划:</p><ol class=""><li id="46df" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld nv ll lm ln bi translated">在 OpenStreetMap 中查询“15 分钟街区”所需的所有组件:</li></ol><ul class=""><li id="5c0f" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated">办公室</li><li id="9b28" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">公园</li><li id="da80" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">酒吧</li><li id="e8bd" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">餐馆</li><li id="ebe9" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">咖啡店</li><li id="dfba" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">图书馆</li><li id="0269" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">学校</li><li id="eb50" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">银行</li><li id="6124" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">医生办公室</li><li id="b2b0" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">药房</li><li id="0657" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">邮局</li><li id="b75b" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">杂货店</li><li id="64f9" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">五金店</li></ul><p id="e2a8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.获取每个普查区域内的点的样本</p><p id="35c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.计算每个样本点步行距离内的所有邻域要素</p><p id="9e6b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.获取该区域内所有点的步行距离内必需品的平均数量。</p><p id="bddb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将从上面我用来查找停车场的 osm_query 函数开始，以获取给定地理区域内的所有社区要素。由于 OSM 是开放源代码和可编辑的，有一些数据需要解决。首先，有些人为某些事物放置点地理，而其他人放置建筑物的区域。这就是函数中有 poly_to_point 选项的原因，如果我们需要，可以将所有这些点标准化为点。天桥 API 几何图形的原始输出是一个坐标字典，因此我们需要将它们转换成形状良好的几何图形，以便输入 GeoPandas:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="8491" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们希望这些数据出现在一个单独的列中，因此我们合并了输出:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="f360" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们终于准备好购买我们的邻里必需品了:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="7ae4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们需要获得一组随机点进行搜索:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="bf21" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们将通过我们的步行距离来缓冲我们的点，我将它设置为 1 公里。如果我们想变得更有趣，我们可以使用 walksheds，但是这种分析本身就需要大量的处理器，所以我将选择坚持使用欧几里德距离。然后，我们将获取缓冲区内的所有邻域要素，并计算步行距离内要素的百分比:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="1ece" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这让我们“接近”了一个区域。我们现在需要遍历该县的所有区域:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="a3a3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以调用我们的函数来获得我们的分析:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/428f924b277de6b5b4333d98cdf5e463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*2jvf5uE77dI1iPtbJ6BjmA.png"/></div></figure><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/9d260684b8a43644b8ed16829620ec0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*VzxETXWtspk8NPr-Xa3x5g.png"/></div></figure><h2 id="c14d" class="my lu it bd lv mz na dn lz nb nc dp md kr nd ne mf kv nf ng mh kz nh ni mj nj bi translated">把所有的放在一起</h2><p id="24d3" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">我们现在有了简·雅各布斯的每个优质社区因素的分数。我更感兴趣的是比较县内的区域，而不是比较县本身，因此我将简单地对每个区域的得分进行排名，并取平均值以获得“简·雅各布指数”(JJI):</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="f8b0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了查看我们做了什么，我们将使用之前制作的四个数据帧来调用函数:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/b6896a2abc96b8c3ad760cc6e07b0945.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*YOFH6x9wJ9mcpzPsrfTTtQ.png"/></div></figure><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi nu"><img src="../Images/f0342eb6c80f9348a915f530cb6af8c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yT2zgnoaxSB_SuMS6FewyQ.png"/></div></div></figure><p id="c913" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，对于酷点，我们将使用叶创建一个交互式地图:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="410a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是两个新创建地图的链接:</p><p id="03b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae mx" href="https://bcparker21.github.io/jane_jacobs_index/ada_map.html" rel="noopener ugc nofollow" target="_blank">爱达县</a></p><p id="24cf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae mx" href="https://bcparker21.github.io/jane_jacobs_index/king_map.html" rel="noopener ugc nofollow" target="_blank">郡王</a></p><p id="df9c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这一切意味着什么？我们将在<a class="ae mx" href="https://medium.com/analytics-vidhya/the-jane-jacobs-index-part-ii-testing-610e2e963983" rel="noopener">第二部</a>中深入探讨这个问题……</p></div></div>    
</body>
</html>