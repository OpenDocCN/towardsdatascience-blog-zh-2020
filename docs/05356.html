<html>
<head>
<title>Predicting the Maliciousness of URLs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测网址的恶意性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-the-maliciousness-of-urls-24e12067be5?source=collection_archive---------11-----------------------#2020-05-06">https://towardsdatascience.com/predicting-the-maliciousness-of-urls-24e12067be5?source=collection_archive---------11-----------------------#2020-05-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2d95" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建用于分离恶意和良性URL的特征向量</h2></div><p id="72d9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将逐步开发一个用于识别恶意URL的简单特性集表示。我们将为URL创建特征向量，并使用这些向量来开发用于识别恶意URL的分类模型。为了评估这些特征在区分恶意网址和良性网址方面有多好，我们建立了一个基于决策树的机器学习模型来预测给定网址的恶意性。</p><p id="9266" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">恶意网站是网络安全中众所周知的威胁。它们是在线传播病毒、蠕虫和其他类型恶意代码的有效工具，并且是大多数网络攻击的60%以上的罪魁祸首。恶意URL可以通过电子邮件链接、文本消息、浏览器弹出窗口、页面广告等方式发送。这些URL可能是指向可疑网站的链接，或者很可能嵌入了“可下载内容”。这些嵌入的下载可能是间谍软件、键盘记录器、病毒、蠕虫等。因此，及时检测和缓解恶意代码在其网络中的传播已成为网络防御人员的当务之急。恶意URL检测器的各种技术以前主要依赖于URL黑名单或签名黑名单。这些技术大多提供“事后”解决方案。为了提高恶意URL检测方法的及时性和抽象性，机器学习技术正日益被接受。</p><p id="f1fa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了开发机器学习模型，我们需要一个特征提取框架来表征URL或将URL转换为特征向量。在本文中，我们将收集已知恶意网址和已知良性网址的样本。然后，我们开发一个指纹识别框架，并为样本中的所有URL提取一组给定的<strong class="kh ir"><em class="lb">【M】</em></strong>特征。我们通过开发一个具有这些特征的简单预测模型来测试这些特征在区分恶意URL和良性URL方面的有效性。最后，我们测量模型预测恶意网址的能力，作为区分恶意网址和良性网址的特征的有效性。</p><p id="0434" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下图是本文中方法流程的概述。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/a2b0fb73854e0ec17265b0180753bc4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KXXup_JUJzhW43PDyy6D4A.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">分析处理</p></figure><h1 id="d3f8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">数据</h1><p id="5768" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">我们从两个来源收集数据:Alexa 1000强网站和phishtank.com。从Alexa的前1000个网站中抓取了1000个假定的良性URL，从<a class="ae mp" href="http://phishtank.com" rel="noopener ugc nofollow" target="_blank">phishtank.com</a>中抓取了1000个可疑的恶意URL。由于virustotal API的限制率，我们随机抽取了500个假定的良性URL和500个假定的恶意URL。然后通过<a class="ae mp" href="https://eneyi.github.io/2020/04/01/virustotal.com" rel="noopener ugc nofollow" target="_blank">病毒扫描这些网址。检测到0个恶意内容的URL被标记为良性(b_urlX)，检测到至少8个恶意内容的URL被标记为恶意(m_urlX)。我们将每次扫描的JSON结果转储到相应的文件‘b _ urlx . JSON’、‘m _ urlx . JSON’中。您可以在这里</a>找到这些文件<a class="ae mp" href="https://github.com/eneyi/dataarchive/tree/master/pmurls/data/featurized" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="abb1" class="mv lt iq mr b gy mw mx l my mz">from requests import get<br/>from os import listdir<br/>import pandas <strong class="mr ir">as</strong> pd<br/>import numpy <strong class="mr ir">as</strong> np<br/>from pandas.io.json import json_normalize<br/>import seaborn <strong class="mr ir">as</strong> sns<br/>import matplotlib.pyplot <strong class="mr ir">as</strong> plt<br/>import math<br/>from datetime import datetime<br/>plt<strong class="mr ir">.</strong>rcParams["figure.figsize"] <strong class="mr ir">=</strong> (20,20)</span></pre><h1 id="ad31" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">处理应用编程接口速率限制和IP阻塞</h1><p id="fbe5" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">为了确认示例中的恶意URL是恶意的，我们需要向VirusTotal发送多个请求。病毒扫描提供多个病毒扫描引擎的汇总结果。此外，我们通过(Shodan)[shodan.io]传递URL。Shodan是所有连接到互联网的设备的搜索引擎，提供基于服务的URL服务器功能。VirusTotal和Shodan目前的API速率限制分别是每分钟4个请求和每个API密钥每月至少10，000个请求。虽然对数据的URL请求数量在Shodan API请求限制之内，但事实证明，病毒总数有点困难。这是通过创建几个虚拟磁带库应用编程接口密钥(最多4个)并在每个请求中随机采样来解决的。除了限制API请求的数量之外，在短时间内发送多个请求还会导致来自VT和Shodan服务器的IP阻塞。我们编写了一个小爬虫，从<a class="ae mp" href="https://free-proxy-list.net/" rel="noopener ugc nofollow" target="_blank">https://free-proxy-list.net/</a>获取最新的精英IP地址集，并为每个请求创建一个新的代理列表，因为自由代理的寿命非常短。除了IP池之外，我们还使用Python的FakeUserAgent库在每个请求上切换用户代理。</p><p id="cdb3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，对于每个请求，使用新的代理和用户代理，我们可以每分钟发送16个请求，而不是之前的4个。每个请求都有以下请求参数:</p><ul class=""><li id="935e" class="na nb iq kh b ki kj kl km ko nc ks nd kw ne la nf ng nh ni bi translated">1病毒总密钥:来自VT API密钥池的样本。</li><li id="4e62" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">1 Shodan密钥:来自Shodan API密钥池的示例。</li><li id="9349" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">1 IP:向<a class="ae mp" href="https://free-proxy-list.net/" rel="noopener ugc nofollow" target="_blank">https://free-proxy-list.net/</a>发送请求，获取最新的免费精英代理。</li><li id="49d3" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">1用户代理:Python的可用用户代理示例(假冒用户代理)[https://pypi . org/project/假冒用户代理/]</li></ul><p id="0507" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Shodan和VT的扫描产生了以下<a class="ae mp" href="https://github.com/eneyi/dataarchive/blob/master/pmurls/data/scanned_data.csv" rel="noopener ugc nofollow" target="_blank">数据集</a>。从shodan中，我们提取了以下特征:</p><ul class=""><li id="bb3e" class="na nb iq kh b ki kj kl km ko nc ks nd kw ne la nf ng nh ni bi translated">numServices:主机上运行的服务(开放端口)总数</li><li id="a907" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">robotstxt:网站是否启用了robots txt</li></ul><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="a4fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">扫描后的最终数据集在<a class="ae mp" href="https://eneyi.github.io/2020/04/01/predicting-the-maliciousness-of-urls.html" rel="noopener ugc nofollow" target="_blank">这里</a>可用。您可以下载这些数据并运行您的分析。</p><h1 id="840f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">指纹URL(用于恶意软件URL检测的特征URL)</h1><p id="7f3f" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">目标是提取URL特征，这些特征对于区分恶意URL和良好URL非常重要。首先，让我们看看一个URL的结构中的相关部分。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nq"><img src="../Images/fe059c4d122b06d6a6e32a454d621d5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rv7F9B5XdtfhmsMabR9XUQ.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">典型的URL</p></figure><p id="c0e0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">URL(统一资源定位器的缩写)是一种引用，它指定了web资源在计算机网络上的位置以及检索它的机制。如下图所示，URL由不同的组件组成。该协议或方案规定了如何(或需要什么)传输信息。主机名是计算机网络上计算机IP地址的人类可读的唯一引用。域名服务(DNS)命名层次结构将IP地址映射到主机名。被攻破的网址被用来实施网络攻击。这些攻击可能是任何或多种形式的网络钓鱼电子邮件、垃圾邮件和驾车下载。</p><p id="0a18" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于域名，所有者购买人们觉得更容易记住的域名。所有者通常希望他们提供的品牌、产品或服务的名称是特定的。URL的这一部分(域)一旦设置就不能更改。恶意域名所有者可能会选择多个廉价域名，例如“xsertyh.com”。</p><p id="8f8b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">免费URL参数是URL的一部分，可以通过更改来创建新的URL。这些包括目录名、文件路径和URL参数。这些免费的URL参数通常被攻击者操纵来创建新的URL、嵌入恶意代码并传播它们。</p><p id="8b7f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有许多用于恶意URL检测的技术，两种主要技术是a)黑名单技术，和b)机器学习技术。黑名单包括维护已知恶意域的数据库，并将新URL的主机名与数据库中的主机名进行比较。这是一个“事后”问题。它将无法检测新的和看不见的恶意网址，只有当它被认为是来自受害者的恶意网址时，它才会被加入黑名单。另一方面，机器学习方法提供了一种可跨平台推广且独立于已知签名的先验知识的预测方法。给定恶意和良性恶意软件样本的样本，ML技术将提取已知好的和坏的URL的特征，并概括这些特征以识别新的和看不见的好的或坏的URL。</p><p id="a9be" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">URL指纹识别过程针对3种类型的URL功能:</p><ul class=""><li id="ee4d" class="na nb iq kh b ki kj kl km ko nc ks nd kw ne la nf ng nh ni bi translated">URL字符串特征:源自URL字符串本身的特征。</li><li id="a125" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">URL域特征:URL域的域特征。其中包括whois信息和shodan信息。</li><li id="6816" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">页面内容特征:从URL的页面提取的特征(如果有的话)</li></ul><p id="4976" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下表显示了提取的所有特征的摘要:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nr"><img src="../Images/c68a1f713659fc64baa547a279f061ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YW3D20o-cXrd-WzdYutUNg.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">URL的特征向量摘要</p></figure><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="9b54" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行上面的脚本会产生以下带有23个特征的数据。我们将把整数、布尔值和对象列名放在不同的列表中，以便于数据访问。</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="191d" class="mv lt iq mr b gy mw mx l my mz">objects <strong class="mr ir">=</strong> [i <strong class="mr ir">for</strong> i <strong class="mr ir">in</strong> data<strong class="mr ir">.</strong>columns <strong class="mr ir">if</strong> 'object' <strong class="mr ir">in</strong> str(data<strong class="mr ir">.</strong>dtypes[i])]<br/>booleans <strong class="mr ir">=</strong> [i <strong class="mr ir">for</strong> i <strong class="mr ir">in</strong> data<strong class="mr ir">.</strong>columns <strong class="mr ir">if</strong> 'bool' <strong class="mr ir">in</strong> str(data<strong class="mr ir">.</strong>dtypes[i])]<br/>ints <strong class="mr ir">=</strong> [i <strong class="mr ir">for</strong> i <strong class="mr ir">in</strong> data<strong class="mr ir">.</strong>columns <strong class="mr ir">if</strong> 'int' <strong class="mr ir">in</strong> str(data<strong class="mr ir">.</strong>dtypes[i]) <strong class="mr ir">or</strong> 'float' <strong class="mr ir">in</strong> str(data<strong class="mr ir">.</strong>dtypes[i])]</span></pre><h1 id="7ddc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">移除高度相关的要素</h1><p id="7cbd" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">最线性分析假设预测变量之间不存在多重共线性，即预测要素对不得相关。这种假设背后的直觉是，没有额外的信息添加到具有多个相关特征的模型中，因为相同的信息被其中一个特征捕获。</p><p id="a6fb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">多重相关特征也表示数据中的冗余特征，删除它们是数据降维的良好开端。通过移除相关特征(仅保留一组观察到的相关特征)，我们可以解决预测值之间的特征冗余和共线性问题。</p><p id="4414" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们创建一个简单的相关性网格来观察恶意和良性URL的派生特征之间的相关性，并删除一个或多个高度相关的特征。</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="9c9d" class="mv lt iq mr b gy mw mx l my mz">corr <strong class="mr ir">=</strong> data[ints<strong class="mr ir">+</strong>booleans]<strong class="mr ir">.</strong>corr()<br/><em class="lb"># Generate a mask for the upper triangle<br/></em>mask <strong class="mr ir">=</strong> np<strong class="mr ir">.</strong>triu(np<strong class="mr ir">.</strong>ones_like(corr, dtype<strong class="mr ir">=</strong>np<strong class="mr ir">.</strong>bool))</span><span id="02b8" class="mv lt iq mr b gy ns mx l my mz"><em class="lb"># Set up the matplotlib figure<br/></em>f, ax <strong class="mr ir">=</strong> plt<strong class="mr ir">.</strong>subplots(figsize<strong class="mr ir">=</strong>(20, 15))</span><span id="d140" class="mv lt iq mr b gy ns mx l my mz"><em class="lb"># Generate a custom diverging colormap<br/></em>cmap <strong class="mr ir">=</strong> sns<strong class="mr ir">.</strong>diverging_palette(220, 10, as_cmap<strong class="mr ir">=</strong>True)</span><span id="0ebb" class="mv lt iq mr b gy ns mx l my mz"><em class="lb"># Draw the heatmap with the mask and correct aspect ratio<br/></em>sns<strong class="mr ir">.</strong>heatmap(corr, mask<strong class="mr ir">=</strong>mask, cmap<strong class="mr ir">=</strong>cmap, vmax<strong class="mr ir">=</strong>.3, center<strong class="mr ir">=</strong>0,<br/>            square<strong class="mr ir">=</strong>True, linewidths<strong class="mr ir">=</strong>.5, cbar_kws<strong class="mr ir">=</strong>{"shrink": .5}, annot<strong class="mr ir">=</strong>True)</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nt"><img src="../Images/47a6bda695cf82e6065ee598a6570110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E7CscN3339GQKk0D6qKpHQ.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">互相关系数</p></figure><p id="5d07" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，我们并不希望删除所有相关的变量——只删除那些相关性非常强、不会给模型增加额外信息的变量。为此，我们为观察到的正相关和负相关定义了某个“阈值”(0.7)。</p><p id="2796" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们看到大部分高度相关的特征都是负相关的。例如，在URL中的字符数和URL的熵之间存在0.56的负相关系数，这表明较短的URL具有</p><p id="65a5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我们将创建一个函数来识别和删除多个相关特征中的一个。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="no np l"/></div></figure><h1 id="ce37" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">预测URL的恶意性(决策树)</h1><p id="7fc4" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">建模根据以前观察到的数据模式构建了解释数据的蓝图。建模通常是预测性的，因为它试图使用这种开发的“蓝图”来预测基于过去观察的未来或新观察的值。</p><p id="ce79" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">基于提取的特征，我们想要最好的预测模型来告诉我们一个看不见的URL是恶意的还是良性的。因此，我们寻求有用功能的独特组合，以准确区分恶意和良性URL。我们将经历两个阶段，特征选择，其中我们只选择对预测目标变量有用的特征，并用决策树建模以开发恶意和良性URL的预测模型。</p><h1 id="3454" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">特征选择</h1><p id="0249" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">什么样的变量对识别一个网址是“恶意的”还是“良性的”最有用？在计算上，我们可以通过测试哪些变量“改善”或“未能改善”预测模型的整体性能，来自动选择哪些变量最有用。这个过程被称为“特征选择”。特征选择还有助于降低数据的维数，解决计算复杂性和模型性能的问题。特征选择的目标是获得原始数据的有用子集，该子集以不丢失有用信息的方式预测目标特征(一起考虑所有预测)。尽管特征选择超出了简单的相关性消除，但是对于本文，我们将我们的特征选择方法限制为仅仅保留这些特征。让我们创建一个只包含不相关要素的原始数据子集。</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="ea80" class="mv lt iq mr b gy mw mx l my mz">predictor_columns <strong class="mr ir">=</strong> data2<strong class="mr ir">.</strong>columns<br/>d <strong class="mr ir">=</strong> data2[predictor_columns]<br/>x, y <strong class="mr ir">=</strong> d[predictor_columns], data['vt_class']</span></pre><p id="486f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只保留对模型有独特贡献的特征。我们现在可以开始用原始样本的70%和这14个特征来开发模型。我们将保留30%的样本来评估模型在新数据上的性能。</p><ul class=""><li id="db68" class="na nb iq kh b ki kj kl km ko nc ks nd kw ne la nf ng nh ni bi translated">数字服务</li><li id="d1b3" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">熵</li><li id="c4eb" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">数字</li><li id="25b0" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">数字图表</li><li id="b24e" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">体长</li><li id="ddf6" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">数字标题</li><li id="b83f" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">数字图像</li><li id="0287" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">数字链接</li><li id="cbe6" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">每日业务报告(Daily Service Report)</li><li id="ea66" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">data-storageequipment数据储藏设备</li><li id="42a1" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">sscr</li><li id="5f9e" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">小触须（同small bristles）</li><li id="5ef4" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">机器人</li><li id="f0ae" class="na nb iq kh b ki nj kl nk ko nl ks nm kw nn la nf ng nh ni bi translated">哈希Http</li></ul><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="6a34" class="mv lt iq mr b gy mw mx l my mz">from sklearn.model_selection import train_test_split<br/>X_train, X_test, y_train, y_test <strong class="mr ir">=</strong> train_test_split(x, y, test_size <strong class="mr ir">=</strong> 0.3, random_state <strong class="mr ir">=</strong> 100)</span></pre><h1 id="de59" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">决策树</h1><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="707b" class="mv lt iq mr b gy mw mx l my mz">from sklearn import tree<br/>from sklearn.metrics import accuracy_score</span><span id="754b" class="mv lt iq mr b gy ns mx l my mz">from sklearn.externals.six import StringIO  <br/>from IPython.display import Image  <br/>from sklearn.tree import export_graphviz<br/>import pydotplus</span></pre><p id="6c87" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有多种机器学习算法(分类)算法可用于识别恶意URL。在将URL转换成代表性的特征向量之后，我们将“恶意URL识别问题”建模为二元分类问题。二元分类模型为只有两种结果“恶意”和“良性”的类训练预测模型。批量学习算法是在以下假设下工作的机器学习算法:</p><p id="c7b2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nu nv nw mr b">- the entire training data is available before model development and</code></p><p id="c8ec" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nu nv nw mr b">- the target variable is known before the model training task.</code></p><p id="c7fd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">批处理算法是理想和有效的，因为它们是可解释的区分学习模型，使用训练数据点之间的简单损失最小化。决策树是机器学习中的一种批量学习算法。</p><p id="f1ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在决策分析中，决策树是模型得出某些结论的决策过程的可视化表示。决策树背后的基本思想是试图理解什么因素影响类成员，或者为什么一个数据点属于一个类标签。决策树清楚地显示了构成类成员的条件。因此，它们是决策过程的可视化表示。</p><p id="2f2d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">决策树通过将数据集分解成越来越小的部分来构建预测模型。分割子集的决定基于最大化分割的信息增益或最小化分割的信息损失。从根节点(没有不确定性的最纯粹的特征)开始，通过基于子集的纯粹性创建各种叶节点来形成树。</p><p id="8e15" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种情况下，决策树将解释每个特征的类别边界，以将URL分类为恶意或良性。构建决策树时，有两个主要因素需要考虑:</p><p id="1beb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nu nv nw mr b">- a) What criteria to use in splitting or creating leaf nodes and<br/>- b) tree pruning to control how long a tree is allowed to grow to control the risk of over-fitting.</code></p><p id="d48d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">决策树算法的criteria参数指定控制什么标准(Gini或熵),而max_depth参数控制允许树增长多远。基尼系数是指如果我们根据分支中的分布随机选择一个标签，随机样本被错误分类的概率。熵是对信息(或者说缺乏信息)的一种度量。</p><p id="6dfc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不幸的是，由于事先不知道标准和树深度的正确组合，我们将不得不反复测试这两个参数的最佳值。我们针对两个标准测试了50次迭代的max_depth，并可视化了模型准确度分数。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="no np l"/></div></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nx"><img src="../Images/79cbd417abb4d53590cf08926f760aaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c-kSATbb5jBFokykz2oXeQ.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">参数调谐</p></figure><p id="4d14" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">似乎最好的模型是最简单的模型，基尼指数和最大深度为4，样本外准确率为84%。此外，最大化熵似乎不会产生好的结果，这表明添加到模型中的新参数不一定给出新的信息，但是可以产生改进的节点概率纯度。因此，我们可以用max_depth = 4和Gini标准来拟合和可视化该树，以识别哪些特征在分离恶意和良性URL中最重要。</p><p id="963d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">建立模型…</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="4e73" class="mv lt iq mr b gy mw mx l my mz"><em class="lb">###create decision tree classifier object<br/></em>DT <strong class="mr ir">=</strong> tree<strong class="mr ir">.</strong>DecisionTreeClassifier(criterion<strong class="mr ir">=</strong>"gini", max_depth<strong class="mr ir">=</strong>4)</span><span id="8c92" class="mv lt iq mr b gy ns mx l my mz"><em class="lb">##fit decision tree model with training data<br/></em>DT<strong class="mr ir">.</strong>fit(X_train, y_train)</span><span id="2a14" class="mv lt iq mr b gy ns mx l my mz"><em class="lb">##test data prediction<br/></em>DT_expost_preds <strong class="mr ir">=</strong> DT<strong class="mr ir">.</strong>predict(X_test)</span></pre><p id="5e49" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">想象这棵树…</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="9555" class="mv lt iq mr b gy mw mx l my mz">dot_data <strong class="mr ir">=</strong> StringIO()<br/>export_graphviz(DT, out_file<strong class="mr ir">=</strong>dot_data,  <br/>                filled<strong class="mr ir">=</strong>True, rounded<strong class="mr ir">=</strong>True,<br/>                special_characters<strong class="mr ir">=</strong>True,feature_names<strong class="mr ir">=</strong>X_train<strong class="mr ir">.</strong>columns, class_names<strong class="mr ir">=</strong>DT<strong class="mr ir">.</strong>classes_)<br/>graph <strong class="mr ir">=</strong> pydotplus<strong class="mr ir">.</strong>graph_from_dot_data(dot_data<strong class="mr ir">.</strong>getvalue())  <br/>Image(graph<strong class="mr ir">.</strong>create_png())</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ny"><img src="../Images/b7889bf9d07b3ded1515f9d5cc3ea0f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tF_zByN641ckTQA-5fmuPg.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">树</p></figure><p id="81cc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">预测模型的准确性对max_depth(树修剪)和分裂质量标准(节点分裂)的参数调整非常敏感。这也有助于实现最简单的简约模型，防止过度拟合，并在看不见的数据上表现得一样好。这些参数特定于不同的数据问题，最好测试不同参数值的组合。</p><p id="1394" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该模型显示，恶意URL的脚本与特殊字符比率(sscr)较低，URL字符相对更“有序”或更单调。此外，恶意网址的域名可能在5-9个月前已经过期。我们还知道“恶意广告”的问题，即骗子获得过期合法域名的所有权，以分发可下载的恶意代码。最后，大概良性URL最显著的特点就是长寿。他们似乎缓和了HTML正文内容中脚本与特殊字符的比例，使域名寿命延长到4-8年。</p></div></div>    
</body>
</html>