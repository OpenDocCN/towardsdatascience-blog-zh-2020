<html>
<head>
<title>Using MongoDB with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过 Python 使用 MongoDB</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-mongodb-with-python-bcb26bf25d5d?source=collection_archive---------13-----------------------#2020-05-30">https://towardsdatascience.com/using-mongodb-with-python-bcb26bf25d5d?source=collection_archive---------13-----------------------#2020-05-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/3fc4861c51c0dea8b1a020b1ffaa4e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tAeCz6hDgnJqorFy"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kf" href="https://unsplash.com/@heyerlein?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> h heyerlein </a>拍摄</p></figure><p id="c551" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我们将学习如何在 Python 中使用 MongoDB。MongoDB 是一个非常快速灵活的 NoSQL 数据库。它非常受欢迎，应用广泛。</p><p id="446d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在潜水之前，让我们先来学习三个我们会经常用到的术语。</p><ul class=""><li id="965d" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated"><strong class="ki iu">文档:</strong> MongoDB 是一个文档数据库，这意味着集合中的每条记录都是一个文档。</li><li id="bc39" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><strong class="ki iu">集合:</strong>一个集合可以存储多个文档。</li><li id="4302" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">数据库:数据库保存文档的集合。</li></ul><p id="a77c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们来深入探讨一下。</p><h2 id="7c79" class="ls lt it bd lu lv lw dn lx ly lz dp ma kr mb mc md kv me mf mg kz mh mi mj mk bi translated"><em class="ml">目录</em></h2><ul class=""><li id="5ee1" class="le lf it ki b kj mm kn mn kr mo kv mp kz mq ld lj lk ll lm bi translated"><a class="ae kf" href="#d824" rel="noopener ugc nofollow">安装 MongoDB </a></li><li id="b4ab" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#f481" rel="noopener ugc nofollow">连接到您的集群</a></li><li id="b015" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#9a1f" rel="noopener ugc nofollow">创建数据库</a></li><li id="b8d1" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#3e32" rel="noopener ugc nofollow">插入文件</a></li><li id="86d4" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#af8d" rel="noopener ugc nofollow">插入多份文件</a></li><li id="85c8" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#9c71" rel="noopener ugc nofollow">更新一份文件</a></li><li id="ebef" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#ea99" rel="noopener ugc nofollow">更新多个文档</a></li><li id="71c0" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#64d1" rel="noopener ugc nofollow">获取一份文件</a></li><li id="29a6" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#913f" rel="noopener ugc nofollow">根据 id 获取文档</a></li><li id="7369" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#4360" rel="noopener ugc nofollow">获取多个文档</a></li><li id="b7c4" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#a6cd" rel="noopener ugc nofollow">更复杂的查询</a></li><li id="6080" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#0a5e" rel="noopener ugc nofollow">删除一个文件</a></li><li id="2a1e" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#f92e" rel="noopener ugc nofollow">删除多个文档</a></li><li id="03c2" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#d0ef" rel="noopener ugc nofollow">限制</a></li><li id="5824" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="#2fc4" rel="noopener ugc nofollow">分拣</a></li></ul><h1 id="d824" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">1.安装 MongoDB</h1><p id="6098" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">我将使用 MongoDB Atlas 免费层，这样您就不需要在您的计算机上安装 MongoDB，这样我们将只关注 MongoDB 和 Python。你可以从<a class="ae kf" href="https://www.mongodb.com/cloud/atlas/register" rel="noopener ugc nofollow" target="_blank">这里</a>得到。在那里创建一个集群并设置你的账户。</p><p id="9d83" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">建立帐户后，不要忘记将您当前的 IP 地址添加到白名单中，并创建一个 MongoDB 用户，否则您将无法访问您的集群。</p><h2 id="67f8" class="ls lt it bd lu lv lw dn lx ly lz dp ma kr mb mc md kv me mf mg kz mh mi mj mk bi translated"><strong class="ak">安装 PyMongo </strong></h2><p id="180e" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">我们需要安装<code class="fe nl nm nn no b">pymongo</code>和<code class="fe nl nm nn no b">dnspython</code>。我们需要<code class="fe nl nm nn no b">dnspython</code>来连接<code class="fe nl nm nn no b">mongo+srv</code>协议。<strong class="ki iu"> </strong>要安装两者，可以使用下面这个命令。</p><pre class="np nq nr ns gt nt no nu nv aw nw bi"><span id="59f8" class="ls lt it no b gy nx ny l nz oa">pip install pymongo[srv]</span></pre><h1 id="f481" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">2.连接到您的集群</h1><p id="39f9" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">设置好账户后，点击控制面板中的<code class="fe nl nm nn no b">connect</code>按钮，然后点击<code class="fe nl nm nn no b">connect your application</code>，再选择<code class="fe nl nm nn no b">Python driver</code>。您将在那里看到您的连接字符串，复制它。</p><p id="4cbb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不要忘记将<code class="fe nl nm nn no b">admin</code>和<code class="fe nl nm nn no b">&lt;password&gt;</code>占位符替换为您在设置用户时创建的用户名和密码。请注意，此用户不是您注册时的用户，而是您在创建集群后创建的用户。</p><p id="07a9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将使用环境变量，因为我不想公开我的用户信息。您可以简单地将<code class="fe nl nm nn no b">user</code>变量分配给用户名，将<code class="fe nl nm nn no b">password</code>变量分配给密码。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="9a1f" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">3.创建数据库</h1><p id="3bc8" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">连接到您的集群后，您可以作为<code class="fe nl nm nn no b">client</code>的属性访问您的数据库。所以当我们说<code class="fe nl nm nn no b">client.test</code>时，我们基本上是访问一个名为<code class="fe nl nm nn no b">test</code>的数据库。如果我们还没有<code class="fe nl nm nn no b">test</code>数据库，它将在插入一个文档到数据库后被创建。我们将在本节中看到如何做到这一点。</p><blockquote class="od oe of"><p id="0e70" class="kg kh og ki b kj kk kl km kn ko kp kq oh ks kt ku oi kw kx ky oj la lb lc ld im bi translated">立正！如果您的数据库名称是<code class="fe nl nm nn no b">test-db</code>，您将不能使用类似<code class="fe nl nm nn no b">client.test-db</code>的属性样式。你应该使用字典风格。<code class="fe nl nm nn no b">client[‘test-db’]</code>会起作用。</p></blockquote><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="42ca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看我们的<code class="fe nl nm nn no b">test</code>数据库是否存在。运行下面的代码后，您期望哪个输出？输出将是<code class="fe nl nm nn no b">test database was not created.</code>,因为我们还没有向<code class="fe nl nm nn no b">test</code>数据库插入任何文档。一旦我们将文档插入到数据库中，数据库就会被创建。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="0969" class="ls lt it bd lu lv lw dn lx ly lz dp ma kr mb mc md kv me mf mg kz mh mi mj mk bi translated">在数据库中创建集合</h2><p id="c177" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">让我们创建一个名为<code class="fe nl nm nn no b">col</code>的集合，看看会发生什么。检查输出，我们没有名为<code class="fe nl nm nn no b">test</code>的数据库和名为<code class="fe nl nm nn no b">col</code>的集合。让我们插入一个文档，看看会发生什么。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="37b2" class="ls lt it bd lu lv lw dn lx ly lz dp ma kr mb mc md kv me mf mg kz mh mi mj mk bi translated">插入文档</h2><p id="b237" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">首先，我们需要创建一个<code class="fe nl nm nn no b">user</code>字典来将文档插入到集合中。<code class="fe nl nm nn no b">user</code>字典的关键字将是文档的字段，<code class="fe nl nm nn no b">user</code>字典的元素将是文档中该字段的值。</p><p id="d78a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将把<code class="fe nl nm nn no b">user</code>插入到<code class="fe nl nm nn no b">col</code>集合中，我们可以用<code class="fe nl nm nn no b">insert_one</code>的方法来完成。插入这个文档后，您可以获得它的 id。<code class="fe nl nm nn no b">insert_user.inserted_id</code>是 bson 对象，不是常规字符串。</p><p id="e9d1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您没有自己指定<code class="fe nl nm nn no b">_id</code>字段，它会自动添加到您的文档中。</p><blockquote class="od oe of"><p id="5a18" class="kg kh og ki b kj kk kl km kn ko kp kq oh ks kt ku oi kw kx ky oj la lb lc ld im bi translated">你可以很容易地在你的面板中创建一个数据库和集合，但我也想用这种方式来展示。</p></blockquote><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="3e32" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">4.插入文档</h1><p id="ceaf" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">到目前为止一切顺利。我们已经创建了我们的<code class="fe nl nm nn no b">test</code>数据库，我们可以使用<code class="fe nl nm nn no b">client</code>的属性访问风格来访问它。现在我们可以在这个数据库上创建一个名为<code class="fe nl nm nn no b">blog</code>的集合，并将文档插入到这个集合中。</p><p id="6bb7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们首先选择<code class="fe nl nm nn no b">test</code>数据库，然后<code class="fe nl nm nn no b">db</code>指向该对象。然后我们创建一个<code class="fe nl nm nn no b">blog</code>集合，<code class="fe nl nm nn no b">blog_collection</code>指向那个对象。</p><p id="2ffa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以在插入文档后检索它的 id。请参见我们文档第 13 行插入的 id。</p><p id="cde4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在将第一个文档插入到<code class="fe nl nm nn no b">blog</code>集合之后，博客集合就在我们的数据库<code class="fe nl nm nn no b">test</code>上创建了。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="8d4e" class="ls lt it bd lu lv lw dn lx ly lz dp ma kr mb mc md kv me mf mg kz mh mi mj mk bi translated">我想自己指定文档的 id，可以吗？</h2><p id="ae6a" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">是的，你可以！<code class="fe nl nm nn no b">_id</code>会自动确定，除非你亲自动手。我自己来，把我的<code class="fe nl nm nn no b">_id</code>设为<code class="fe nl nm nn no b">1</code>。</p><p id="8713" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要非常小心！如果您插入另一个带有<code class="fe nl nm nn no b">1</code>的<code class="fe nl nm nn no b">_id</code>的文档，id 在文档中应该是唯一的。您将得到一个重复的密钥错误。身份证就像你的公民身份证，他们应该是唯一的，以被正确识别。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="af8d" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">5.插入多个文档</h1><p id="5cb4" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">我们可以插入多个文档，看看如何看到代码片段。我希望你在这个片段中关注 3 件事。</p><ul class=""><li id="eb19" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">首先，我们需要传递一个字典列表来插入多个文档，其中每个字典代表一个文档，检查第 10 行的<code class="fe nl nm nn no b">posts</code>变量。</li><li id="ab16" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">其次，看看我们的文档有多灵活，不需要模式！每个文档都不一样！你可以在 MongoDB 中做到，没有什么可以阻止你去做！</li><li id="3ef0" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">第三，看插入多个文档和一个文档的区别，我们用<code class="fe nl nm nn no b">insert_many</code>代替<code class="fe nl nm nn no b">insert_one</code>，用<code class="fe nl nm nn no b">inserted_ids</code>代替<code class="fe nl nm nn no b">inserted_id</code>。</li></ul><p id="40c3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将把<code class="fe nl nm nn no b">posts</code>变量作为第一个参数传递给<code class="fe nl nm nn no b">insert_many</code>方法。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="9c71" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">6.更新一个文档</h1><p id="8f90" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">我们可以更新数据库中的文档。我们将使用<code class="fe nl nm nn no b">update_one</code>方法对我们的数据库执行一次更新。让我们回顾一下所有的步骤，并很好地理解如何去做。</p><ul class=""><li id="0f46" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">首先，我在第 9 行检索匹配我们的<code class="fe nl nm nn no b">query</code>过滤器的文档。我这样做是因为我想在更新之前/之后给你看。</li><li id="1be6" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">第二，我们准备一本字典，然后<code class="fe nl nm nn no b">new_document</code>指向它。重点看那本字典，<code class="fe nl nm nn no b">‘<strong class="ki iu">$set</strong>’</code>和<code class="fe nl nm nn no b">{'content': 'I love MongoDB and Python', 'title': 'Updated Post'}</code>。我们这里基本讲的是<strong class="ki iu">设置</strong> <code class="fe nl nm nn no b">content</code>到<code class="fe nl nm nn no b">I love MongoDB and Python</code><code class="fe nl nm nn no b">title</code>到<code class="fe nl nm nn no b">Updated Post</code>。</li><li id="a8ba" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">最后，我们检索更新后的文档，看看它是否有效。看看<code class="fe nl nm nn no b">updated_document</code>的输出，我们的修改被应用了。Id 和其他我们没改的还是一样，只有<code class="fe nl nm nn no b">content</code>和<code class="fe nl nm nn no b">title</code>按照我们的本意改了。</li></ul><p id="df70" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nl nm nn no b">update_one</code>方法的第一个参数是你的过滤器，第二个参数是你要应用的修改和<code class="fe nl nm nn no b">upsert</code>。如果您将<code class="fe nl nm nn no b">upsert</code>设置为<code class="fe nl nm nn no b">True</code>，如果没有符合您的过滤器的文件，它将插入一个新文件。默认是<code class="fe nl nm nn no b">False</code>。</p><blockquote class="od oe of"><p id="0c93" class="kg kh og ki b kj kk kl km kn ko kp kq oh ks kt ku oi kw kx ky oj la lb lc ld im bi translated">如果有多个文档与您的过滤器匹配，将更新第一个匹配项。</p></blockquote><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="ea99" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">7.更新多个文档</h1><p id="3cdf" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">您博客中的一个用户已经更改了用户名，因此，您想要更新他的所有文档，以便将他的旧用户名更改为新用户名。我们将使用<code class="fe nl nm nn no b">update_many</code>方法更新多个文档。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="64d1" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">8.获取一个文档</h1><p id="f189" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">目前我们已经填充了数据库。现在我们想搜索我们的数据库，并检索与我们的查询相匹配的文档。</p><p id="396d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用<code class="fe nl nm nn no b">find_one</code>方法。我们将把<code class="fe nl nm nn no b">{‘title’: ‘Second’}</code>字典作为第一个参数传递给这个方法。通过传递这个字典，我们基本上告诉我们要从<code class="fe nl nm nn no b">blog</code>集合和<code class="fe nl nm nn no b">test</code>数据库中检索一个标题为<code class="fe nl nm nn no b">Second</code>的文档。我们只使用<code class="fe nl nm nn no b">title</code>进行过滤，但是我们可以向我们的<code class="fe nl nm nn no b">{‘title’: ‘Second’}</code>字典中添加更多像<code class="fe nl nm nn no b">‘user’: ‘halilylm’</code>这样的字段。</p><p id="296d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意<code class="fe nl nm nn no b">document</code>是一个字典，所以您可以使用 get 函数来检索第 12 行的内容。</p><blockquote class="od oe of"><p id="d60e" class="kg kh og ki b kj kk kl km kn ko kp kq oh ks kt ku oi kw kx ky oj la lb lc ld im bi translated">如果我们有不止一个带有<code class="fe nl nm nn no b">Second</code>的<code class="fe nl nm nn no b">title</code>的文档怎么办？向下滚动到下一个例子，看看会发生什么！</p></blockquote><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="e0a6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果有多个文档匹配我们的查询，我们只检索第一个匹配。请参见下面的示例。有多个文档与我们的查询匹配，我们只得到第一个匹配项。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="913f" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">9.通过 id 获取文档</h1><p id="376f" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">让我们假设，您创建了一个博客，并希望按 id 显示一篇文章。URL 是<code class="fe nl nm nn no b">/blog/posts/5ed0254d97e5367d20c22e63</code>，而<code class="fe nl nm nn no b">5ed0254d97e5367d20c22e63</code>是帖子的 id。因为这是一个普通的字符串，如果你用它作为<code class="fe nl nm nn no b">_id</code>，你将得到<code class="fe nl nm nn no b">None</code>。因为这是一个普通的字符串，而不是 bson 对象。您需要将这个字符串对象转换为 bson 对象。我假设这里的 id 是自动添加的，而不是你自己指定的。</p><p id="86ab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您只需要导入<code class="fe nl nm nn no b">ObjectId</code>并将插入的 id 作为第一个参数传递给它。</p><p id="e2dd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还想排除<code class="fe nl nm nn no b">title</code>和<code class="fe nl nm nn no b">content</code>，我可以传递一个我想排除的字段字典，并将字段设置为<code class="fe nl nm nn no b">0</code>作为<code class="fe nl nm nn no b">find_one</code>方法的第二个参数。看输出，<code class="fe nl nm nn no b">title</code>和<code class="fe nl nm nn no b">content</code>排除在外。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="4360" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">10.获取多个文档</h1><p id="d3c7" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">您也可以一次获得多个文档。让我们尝试检索具有<code class="fe nl nm nn no b">halilylm</code>的<code class="fe nl nm nn no b">user</code>字段的所有文档</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="a6cd" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">11.更复杂的查询</h1><p id="c1e2" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">查询并不总是简单的。如果你在你的博客中建立一个搜索系统，你可能想要使用更复杂的查询。我的意思是，当一个用户搜索一个关键字时，你也希望显示与该关键字相关的帖子，而不仅仅是与用户完全匹配的帖子。</p><p id="7822" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们想要显示文档以及这些文档中以<code class="fe nl nm nn no b">I love</code>开头的<code class="fe nl nm nn no b">content</code>字段。你会怎么做？我们将使用正则表达式来实现这一点。我将传递一个字典来过滤我们想要的结果。这本字典将作为第一个参数传递给<code class="fe nl nm nn no b">find</code>方法。</p><p id="3e46" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还想排除<code class="fe nl nm nn no b">id</code>、<code class="fe nl nm nn no b">post_date</code>和<code class="fe nl nm nn no b">user</code>。我将把字典作为第二个参数传递给<code class="fe nl nm nn no b">find</code>方法。</p><p id="a961" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看到输出，我们得到所有匹配我们的查询的文档。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="0a5e" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">12.删除一个文档</h1><p id="1589" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">我们将使用<code class="fe nl nm nn no b">delete_one</code>方法从数据库中删除一个文档。</p><p id="3391" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们想要删除一个带有<code class="fe nl nm nn no b">First post</code>的<code class="fe nl nm nn no b">title</code>的文档，因此我们需要将<code class="fe nl nm nn no b">{'title': ‘First post'}</code> dictionary 作为第一个参数传递给<code class="fe nl nm nn no b">delete_one</code>方法来定义我们到底想要删除哪个文档。</p><p id="0050" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以使用<code class="fe nl nm nn no b">deleted_count</code>属性访问方式检查删除了多少个文档。第 9 行的输出是 1，因此一个与我们的查询匹配的文档如预期的那样被删除。</p><blockquote class="od oe of"><p id="87c6" class="kg kh og ki b kj kk kl km kn ko kp kq oh ks kt ku oi kw kx ky oj la lb lc ld im bi translated">如果有多个文档匹配该查询，该怎么办？答案是只有第一个匹配会被删除。</p></blockquote><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="f92e" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">13.删除多个文档</h1><p id="1e18" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">我们可以一次删除多个文档。假设<code class="fe nl nm nn no b">halilylm</code>用户已经删除了他的账户。我们想删除所有属于他的帖子。我们将使用<code class="fe nl nm nn no b">delete_many()</code>方法来执行此操作。</p><blockquote class="od oe of"><p id="afa7" class="kg kh og ki b kj kk kl km kn ko kp kq oh ks kt ku oi kw kx ky oj la lb lc ld im bi translated">立正！如果您将空字典传递给<code class="fe nl nm nn no b">delete_many()</code>方法，它将从该集合中删除所有文档！非常小心！！！</p></blockquote><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="d0ef" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">14.限制性的</h1><p id="8344" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">假设我们的查询与<code class="fe nl nm nn no b">2 posts</code>匹配，我们希望将结果限制为仅与<code class="fe nl nm nn no b">1 post</code>匹配。我们可以限制从数据库中获取的文档数量。为此，我们将使用<code class="fe nl nm nn no b">limit</code>方法。只需将您想要从我们的数据库中检索多少个文档传递给<code class="fe nl nm nn no b">limit</code>方法</p><p id="157a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看看输出，我们只得到一个文档。输出更长，因为这次我没有排除任何字段。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="2fc4" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">15.整理</h1><p id="5456" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">我们将使用<code class="fe nl nm nn no b">sort</code>方法按照<code class="fe nl nm nn no b">title</code>字段对结果进行排序。</p><p id="1722" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将字段名作为第一个参数传递给<code class="fe nl nm nn no b">sort</code>方法。将<code class="fe nl nm nn no b">1</code>或<code class="fe nl nm nn no b">–1</code>作为第二个参数传递给<code class="fe nl nm nn no b">sort</code>方法。然而，你不必通过<code class="fe nl nm nn no b">1</code>来指定方向，因为默认是升序。</p><blockquote class="od oe of"><p id="ca82" class="kg kh og ki b kj kk kl km kn ko kp kq oh ks kt ku oi kw kx ky oj la lb lc ld im bi translated">排序('标题'，1)升序(默认)<br/>排序('标题'，-1)降序</p></blockquote><p id="69d9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们先按升序排序，排除<code class="fe nl nm nn no b">id</code>、<code class="fe nl nm nn no b">post_date</code>、<code class="fe nl nm nn no b">user</code>和<code class="fe nl nm nn no b">category</code>字段。</p><p id="0611" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意，一个空字典向<code class="fe nl nm nn no b">find</code>方法传递了第一个参数。这意味着你不想应用任何过滤器。第二个参数是要排除的字段的字典。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="248f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于降序，只需将<code class="fe nl nm nn no b">-1</code>放在<code class="fe nl nm nn no b">sort</code>方法的第二个参数中。</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="7ea4" class="mr lt it bd lu ms mt mu lx mv mw mx ma my mz na md nb nc nd mg ne nf ng mj nh bi translated">结论</h1><p id="141d" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated">我希望您喜欢这篇文章，并且很好地理解了如何在 Python 中使用 MongoDB。敬请关注未来的作品。</p></div></div>    
</body>
</html>