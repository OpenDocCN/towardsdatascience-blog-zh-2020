<html>
<head>
<title>Predicting Apple Inc. Stock Prices Using Facebook’s Prophet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用脸书的预言家预测苹果公司的股价</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-apple-inc-stock-prices-using-facebooks-prophet-54ed6e91dbda?source=collection_archive---------43-----------------------#2020-05-04">https://towardsdatascience.com/predicting-apple-inc-stock-prices-using-facebooks-prophet-54ed6e91dbda?source=collection_archive---------43-----------------------#2020-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5bb1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">时间序列预测的最新方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5f81d7ded4f827b759b8a754df06cc0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Un7GEjIgqvcL7AjE"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">亚历克斯·哈尼在<a class="ae ky" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="89da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列预测是用于根据以前观察到的值预测未来值的模型。时间序列数据是在离散的时间尺度上记录的。</p><p id="73bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列预测广泛应用于非平稳数据。统计属性(如均值和方差)不随时间变化的数据是非平稳数据。非平稳数据的最好例子是股票价格。</p><p id="02d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列预测广泛用于预测销售和股票价格。已经有人尝试使用时间序列分析算法来预测股票价格，尽管它们仍然不能用于在真实市场中下注。</p><p id="736f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了开发一种可以捕捉时间序列数据中季节性的模型，脸书开发了 Prophet，这是脸书数据科学团队发布的开源软件。</p><p id="2cd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Prophet 试图捕捉每日、每周和每年的季节性以及假日效应，实现加法回归模型。</p><h1 id="a5ce" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">先知方程式</h1><p id="3f1c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">正如我前面引用的，Prophet 是一个加法回归模型。下面的等式代表了 Prophet 背后的数学。</p><blockquote class="ms mt mu"><p id="28f4" class="kz la mv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated"><em class="it"> y(t) = g(t) + s(t) + h(t) + e(t) </em></p></blockquote><p id="6041" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">g(t)代表趋势。Prophet 使用分段线性模型进行趋势预测。</p><p id="931c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">s(t)代表周期性变化(每周、每月、每年)。</p><p id="e7a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">h(t)表示持续时间超过一天的假期的影响。假期影响商业。</p><p id="b034" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">e(t)涵盖了模型未涵盖的变更或错误。</p><p id="f80c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Prophet 是一个易于使用的模型。它速度很快，不需要数据预处理。它处理带有几个异常值的缺失数据。</p><p id="bd94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将尝试使用脸书的先知来预测苹果公司的股票价格。苹果公司的每日股票价格可以从雅虎财经网站下载。雅虎财经是股市数据的主要来源之一。我们将获得苹果公司自 2015 年以来的股价数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fbce2d50656518c4ff8298ee5a0d2d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JSMqvDA-Wk0gE6_6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@florisand?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">芙罗莉丝·安德烈亚</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0acc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要下载先知包。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3675" class="ne lw it na b gy nf ng l nh ni">conda install gccconda install -c conda-forge fbprophetconda install pystan #prophet dependency</span></pre><p id="e7e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以从模型的 Python 实现开始。</p><p id="5d87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将从导入库和数据集开始。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ee2f" class="ne lw it na b gy nf ng l nh ni">#importing the libraries<br/>import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as pltdata = pd.read_csv("F:\\AAPL.csv") <br/>data.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/7d4625f489ee0a02758a160e850355ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/0*5x6SJOQ3_qFICB-z.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苹果股票价格数据集</p></figure><p id="ba77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要数据集中的日期和收盘价，然后我们将把列“日期”和“收盘”分别重命名为“ds”和“y ”,因为这是 Prophet 的标准输入方式。这是 Prophet 要求的唯一预处理步骤。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="eb22" class="ne lw it na b gy nf ng l nh ni">data = data[['Date','Close']] #selecting the important features<br/>data = data.rename(columns = {'Date':'ds','Close':'y'}) #renaming the columns of the dataset</span></pre><p id="dd98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将把数据分为训练和测试，因为我们不想在测试集上训练数据。如果我们隐藏测试数据，那么模型将会预测看不见的数据的值。我们希望机器只从以前的数据中学习，而不知道测试数据的趋势。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b40b" class="ne lw it na b gy nf ng l nh ni">train = data.iloc[:1000,0:2] #training set(this will be the data to train the model)<br/>test = data.iloc[1000:0:2] #we can use this data to compare the results of the predictions made by the model</span></pre><p id="37e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将从 fbprophet 模块导入 prophet 类，然后创建 Prophet 类的一个对象。我们将把训练数据输入到模型中。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="0c5a" class="ne lw it na b gy nf ng l nh ni">from fbprophet import Prophet<br/>m = Prophet(daily_seasonality = True) #creating an object of the Prophet class<br/>m.fit(train) #fitting the training data to the model</span></pre><p id="b717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，对于最后一步，我们将要求模型预测未来值，然后尝试将预测可视化。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3a7a" class="ne lw it na b gy nf ng l nh ni">future = m.make_future_dataframe(periods=341) #we need to specify the number of days in future, for which we want to predict the prices<br/>prediction = m.predict(future)<br/>m.plot(prediction)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/00bba4b0634d043612b15c99bcafcc39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HFKdrFY8OXDLB2jK.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苹果股票价格</p></figure><p id="c151" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想要查看预测组件、周组件、季组件、年组件和假日组件，那么您可以使用以下命令。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="6335" class="ne lw it na b gy nf ng l nh ni">m.plot_components(prediction)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/4de64d44536305d6721aa483f2f7af2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/0*t24jXSgmcsvvN5Te.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/f95da7703ec8f3deecaceb92eb2c8ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/0*yKiaf18tHxPkMy2J.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/2c33d6b873b17c2fd92942dade8b1daf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/0*V5XE6qm9LLpddgvJ.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/36636b55682b05c44043d5cad76303db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/0*-mOham1CDj33tVnI.png"/></div></figure><p id="0d26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Prophet 还提供了一个交互式的预测图。这显示了过去一周、一个月、六个月和一年内的预测。为此，我们需要安装 Plotly，它不会随 fbprophet 一起安装，只需在命令提示符下键入'<em class="mv">pip install Plotly【T1]'即可。</em></p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2fd0" class="ne lw it na b gy nf ng l nh ni">from fbprophet.plot import plot_plotly<br/>import plotly.offline as py<br/>py.init_notebook_mode()<br/>fig = plot_plotly(m, prediction)<br/>py.iplot(fig)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/4945a608ef5dd3d7ba81e11c74f47645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AA0CeTr0dxcnWtqg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">股票价格的交互式图表</p></figure><p id="d52d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尝试为不同的数据集实现该模型，看看它是否对您有益。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><p id="5b1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="mv">来自《走向数据科学》编辑的提示:</em> </strong> <em class="mv">虽然我们允许独立作者根据我们的</em> <a class="ae ky" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="mv">规则和指导方针</em> </a> <em class="mv">发表文章，但我们不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae ky" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="mv">读者术语</em> </a> <em class="mv">。</em></p></div></div>    
</body>
</html>