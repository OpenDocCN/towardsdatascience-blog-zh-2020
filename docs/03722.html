<html>
<head>
<title>Introduction to Hive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hive 简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-hive-859ba31a5769?source=collection_archive---------20-----------------------#2020-04-07">https://towardsdatascience.com/introduction-to-hive-859ba31a5769?source=collection_archive---------20-----------------------#2020-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="38fa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Hive &amp; SQL 编码初学者指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5414ad76e3d9323dd1eb8afce4f4554a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nbjNPvUi0OAw-6e2VXPwqw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图像信用—Confusedcoders.com</p></figure></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><p id="2e3f" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">本文主要关注 Hive、它的特性、用例以及 Hive 查询。因为许多 DML 和 DDL 查询与 SQL 非常相似，所以它可以作为任何 SQL 新手的基础或构建块。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><p id="22d4" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">Apache Hive 通常被称为构建在 Apache Hadoop 之上的数据仓库基础设施。最初由脸书开发，用于查询他们每天大约 20TB 的输入数据，目前，程序员使用它对存储在 HDFS (Hadoop 分布式框架系统)等文件系统中的大型数据集进行特别查询和分析，而无需了解 map-reduce 的细节。Hive 最好的部分是查询被 Hive 引擎隐式地转换成高效的链式 map-reduce 作业。</p><h2 id="93fe" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">蜂巢的特点:</h2><ul class=""><li id="f082" class="mu mv it lh b li mw ll mx lo my ls mz lw na ma nb nc nd ne bi translated">支持不同的存储类型，如纯文本、csv、Apache Hbase 等</li><li id="2803" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">数据建模，如创建数据库、表格等。</li><li id="db5e" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">易于编码；使用类似 SQL 的查询语言 HiveQL</li><li id="7325" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">ETL 功能，例如提取、转换和将数据加载到表中，以及连接、分区等。</li><li id="1fce" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">包含内置的用户定义函数(UDF ),用于操作日期、字符串和其他数据挖掘工具</li><li id="a9e3" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">无论布局如何，非结构化数据都显示为看起来像表格的数据</li><li id="5c2e" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">自定义映射器、缩减器和 UDF 的插件功能</li><li id="d5be" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">Hadoop 上的增强查询</li></ul><h2 id="7656" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">Hive 的使用案例:</h2><ul class=""><li id="21b9" class="mu mv it lh b li mw ll mx lo my ls mz lw na ma nb nc nd ne bi translated"><strong class="lh iu">文本挖掘</strong> —具有便捷结构的非结构化数据，通过 map-reduce 进行覆盖和分析</li><li id="fb9d" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated"><strong class="lh iu">文档索引</strong> —为多个文档分配标签以便于恢复</li><li id="c4ac" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated"><strong class="lh iu">业务查询</strong> —查询大量历史数据以获得可操作的洞察，例如交易历史、支付历史、客户数据库等。</li><li id="4a06" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated"><strong class="lh iu">日志处理</strong> —处理各种类型的日志文件，如通话日志、网络日志、机器日志等。</li></ul><h1 id="2fd5" class="nk mc it bd md nl nm nn mg no np nq mj jz nr ka mm kc ns kd mp kf nt kg ms nu bi translated">Hive 中的编码</h1><p id="0aae" class="pw-post-body-paragraph lf lg it lh b li mw ju lk ll mx jx ln lo nv lq lr ls nw lu lv lw nx ly lz ma im bi translated">我们将使用一个名为“transaction”的表来了解如何在 Hive 中查询数据。事务表包含属性 id、item 和 sales。</p><p id="46ee" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">以下是任何编程语言的一些最佳编码实践。</p><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/are-your-coding-skills-good-enough-for-a-data-science-job-49af101457aa"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">对于数据科学的工作，你的编码技能够好吗？</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">5 编码嗅探如果你在数据科学行业工作，你必须知道</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op ks ob"/></div></div></a></div><h1 id="7eda" class="nk mc it bd md nl nm nn mg no np nq mj jz nr ka mm kc ns kd mp kf nt kg ms nu bi translated">配置单元中的 DDL 命令</h1><p id="669c" class="pw-post-body-paragraph lf lg it lh b li mw ju lk ll mx jx ln lo nv lq lr ls nw lu lv lw nx ly lz ma im bi translated">DDL 是数据定义语言的简称，它处理数据库模式和描述，说明数据应该如何驻留在数据库中。一些常见的例子有</p><h2 id="d404" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">创建表格</h2><ul class=""><li id="4d14" class="mu mv it lh b li mw ll mx lo my ls mz lw na ma nb nc nd ne bi translated">创建表—创建表事务(id INT，item STRING，sales FLOAT)；</li><li id="f0a0" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">在特定位置存储表格—创建表格事务(id INT，item STRING，sales FLOAT)行格式分隔字段，以“\001”终止，存储为文本文件位置<hdfs path="" name="">；</hdfs></li><li id="556b" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">对表进行分区—创建由(id INT)分区的表事务(id INT，item STRING，sales FLOAT)</li></ul><h2 id="e422" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">翻桌</h2><ul class=""><li id="d66c" class="mu mv it lh b li mw ll mx lo my ls mz lw na ma nb nc nd ne bi translated">删除表交易记录；</li></ul><h2 id="ab83" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">改变表格</h2><ul class=""><li id="3d53" class="mu mv it lh b li mw ll mx lo my ls mz lw na ma nb nc nd ne bi translated">将表事务重命名为 transaction _ front _ of _ stores</li><li id="185e" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">添加列—ALTER TABLE transaction ADD COLUMNS(customer _ name STRING)；</li></ul><h2 id="c17c" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">显示表格</h2><ul class=""><li id="ef09" class="mu mv it lh b li mw ll mx lo my ls mz lw na ma nb nc nd ne bi translated">显示表格；</li></ul><h2 id="ed01" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">描述表格</h2><ul class=""><li id="69d0" class="mu mv it lh b li mw ll mx lo my ls mz lw na ma nb nc nd ne bi translated">描述交易记录；</li><li id="a068" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">描述扩展交易记录；</li></ul><h1 id="63f8" class="nk mc it bd md nl nm nn mg no np nq mj jz nr ka mm kc ns kd mp kf nt kg ms nu bi translated">配置单元中的 DML 命令</h1><p id="8063" class="pw-post-body-paragraph lf lg it lh b li mw ju lk ll mx jx ln lo nv lq lr ls nw lu lv lw nx ly lz ma im bi translated">DML 是<strong class="lh iu">数据操作语言</strong>的简称，它处理数据操作，包括最常用的 SQL 语句，如 SELECT、INSERT、UPDATE、DELETE 等。它主要用于存储、修改、检索、删除和更新数据库中的数据。</p><h2 id="32bd" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">加载数据</h2><ul class=""><li id="5646" class="mu mv it lh b li mw ll mx lo my ls mz lw na ma nb nc nd ne bi translated">从外部文件加载数据——加载数据本地路径“<file_path>”【覆盖】到表<table name="">；</table></file_path></li><li id="9c3a" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">将数据本地路径“/documents/datasets/transaction . CSV”[OVERWRITE]加载到表事务中；</li><li id="abb3" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">从单独的表写入数据集—插入覆盖表事务 SELECT id，item，date，volume FROM transaction _ updated</li></ul><h2 id="8b39" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">选择指令</h2><p id="9aba" class="pw-post-body-paragraph lf lg it lh b li mw ju lk ll mx jx ln lo nv lq lr ls nw lu lv lw nx ly lz ma im bi translated">select 语句用于从数据库表中提取数据。主要用于查看记录、选择必需的字段元素、获取不同的值以及显示任何筛选、限制或分组操作的结果。</p><p id="6a1a" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">要从事务表中获取所有记录:</p><p id="643a" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">从交易记录中选择*；</p><p id="bb98" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">要从事务表中获取不同的事务 id:</p><p id="a615" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">从交易记录中选择不同的 id；</p><h2 id="9d05" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">极限语句</h2><p id="2e56" class="pw-post-body-paragraph lf lg it lh b li mw ju lk ll mx jx ln lo nv lq lr ls nw lu lv lw nx ly lz ma im bi translated">与 Select 语句一起使用，限制编码人员希望查看的行数。任何事务数据库都包含大量数据，这意味着选择每一行都会导致更长的处理时间。</p><p id="fea8" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">SELECT *从交易限额 10；</p><h2 id="b3de" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">过滤语句</h2><p id="cd2b" class="pw-post-body-paragraph lf lg it lh b li mw ju lk ll mx jx ln lo nv lq lr ls nw lu lv lw nx ly lz ma im bi translated">SELECT * FROM 销售额&gt; 100 的交易；</p><h2 id="ffbd" class="mb mc it bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms mt bi translated">Group by 语句</h2><p id="95ec" class="pw-post-body-paragraph lf lg it lh b li mw ju lk ll mx jx ln lo nv lq lr ls nw lu lv lw nx ly lz ma im bi translated">Group by 语句用于汇总不同级别的数据。设想一个场景，我们希望按商品计算总销售额。</p><p id="58f7" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">选择项目，SUM(sales)作为按项目分组的交易中的销售额；</p><p id="32c1" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">如果我们想过滤掉所有销售额至少为 1000 英镑的商品。</p><p id="041d" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">按销售额&gt; 1000 的项目从交易组中选择项目，SUM(sales)作为销售额；</p><h1 id="6bee" class="nk mc it bd md nl nm nn mg no np nq mj jz nr ka mm kc ns kd mp kf nt kg ms nu bi translated">加入配置单元</h1><p id="e733" class="pw-post-body-paragraph lf lg it lh b li mw ju lk ll mx jx ln lo nv lq lr ls nw lu lv lw nx ly lz ma im bi translated">为了组合和检索多个表中的记录，我们使用了 Hive Join。目前，Hive 支持两个或更多表的内、外、左和右连接。语法类似于我们在 SQL 中使用的语法。在我们看语法之前，让我们了解不同的连接是如何工作的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/45b0e14d1c2f856c4071cb5e64c0792e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JuQcwgo52I8jqtuuPzWnBg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">配置单元中的不同联接</p></figure><p id="19dc" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">SELECT A . * FROM transaction A { LEFT | RIGHT | FULL } JOIN transaction _ date B ON(A . ID = B . ID)；</p><p id="77b6" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">注意事项:</p><ul class=""><li id="010e" class="mu mv it lh b li lj ll lm lo or ls os lw ot ma nb nc nd ne bi translated">配置单元不支持 IN/EXISTS 子查询</li><li id="7055" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">配置单元不支持不包含相等条件的连接条件</li><li id="e441" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">可以连接多个表，但要组织好表，使最大的表出现在序列的最后</li><li id="1d03" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated">如果对于每个表，在 join 子句中使用了相同的列，则 Hive 会将多个表的连接转换为单个 map/reduce 作业</li></ul><h1 id="4300" class="nk mc it bd md nl nm nn mg no np nq mj jz nr ka mm kc ns kd mp kf nt kg ms nu bi translated">优化配置单元中的查询</h1><p id="1d12" class="pw-post-body-paragraph lf lg it lh b li mw ju lk ll mx jx ln lo nv lq lr ls nw lu lv lw nx ly lz ma im bi translated">为了优化 hive 中的查询，这里有 5 条你应该知道的经验法则</p><ol class=""><li id="4dd3" class="mu mv it lh b li lj ll lm lo or ls os lw ot ma ou nc nd ne bi translated">默认情况下，分组、聚合函数和连接发生在 reducer 中，而过滤操作发生在 mapper 中</li><li id="1ccf" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma ou nc nd ne bi translated">使用 hive.map.aggr=true 选项直接在地图任务中执行第一级聚合</li><li id="a672" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma ou nc nd ne bi translated">根据正在执行的任务类型设置映射器/缩减器的数量。对于筛选条件，请使用 set mapred . mapper . tasks = X；对于聚合操作:设置 mapred . reduce . tasks = Y；</li><li id="778b" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma ou nc nd ne bi translated">在连接中，序列中的最后一个表通过 reducers 进行流式传输，而其他表则被缓冲。<strong class="lh iu"> <em class="ov">组织表格，使最大的表格出现在序列的最后</em> </strong></li><li id="1689" class="mu mv it lh b li nf ll ng lo nh ls ni lw nj ma ou nc nd ne bi translated">流表和地图连接可用于加速连接任务</li></ol><p id="e8cb" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">想了解更多关于 Python 可视化的知识吗？</p><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/data-visualization-say-it-with-charts-in-python-138c77973a56"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">数据可视化:用 Python 中的图表说出来</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">使用 matplotlib、pyplot 和…的 python 可视化最佳实践和概念的完整实践指南</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="ow l om on oo ok op ks ob"/></div></div></a></div><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/the-dawn-of-modern-analytics-a-look-into-some-of-the-recent-trends-of-business-intelligence-fc12cdf41cae"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">现代分析的黎明——了解商业智能的一些最新趋势…</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">基于调查的方法来确定每个数据科学家都应该知道的 BI 工具</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="ox l om on oo ok op ks ob"/></div></div></a></div></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><p id="c071" class="pw-post-body-paragraph lf lg it lh b li lj ju lk ll lm jx ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated"><em class="ov">关于作者:高级分析专家和管理顾问，帮助公司通过对组织数据的商业、技术和数学的组合找到各种问题的解决方案。一个数据科学爱好者，在这里分享、学习、贡献；可以和我在</em> <a class="ae oy" href="https://www.linkedin.com/in/angel-das-9532bb12a/" rel="noopener ugc nofollow" target="_blank"> <em class="ov">上联系</em> </a> <em class="ov">和</em> <a class="ae oy" href="https://twitter.com/dasangel07_andy" rel="noopener ugc nofollow" target="_blank"> <em class="ov">推特</em></a><em class="ov">；</em></p></div></div>    
</body>
</html>