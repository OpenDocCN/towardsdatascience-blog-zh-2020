<html>
<head>
<title>Deploying Panel (Holoviz) dashboards using Heroku Container Registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Heroku容器注册中心部署Panel (Holoviz)仪表板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-panel-holoviz-dashboards-using-heroku-container-registry-5221eb0538ba?source=collection_archive---------35-----------------------#2020-04-30">https://towardsdatascience.com/deploying-panel-holoviz-dashboards-using-heroku-container-registry-5221eb0538ba?source=collection_archive---------35-----------------------#2020-04-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/b27a160629def6ef6f1751f0abc43c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RI5b7nG6OmDNJzolkZueOw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">交互式Python仪表盘</p></figure><div class=""/><div class=""><h2 id="bcaa" class="pw-subtitle-paragraph kf jh ji bd b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dk translated">这篇文章旨在为使用Heroku部署面板应用程序提供一个简要的指南。当前的面板文档使用Heroku的默认应用程序构建，没有涵盖这里概述的大部分过程。</h2></div><p id="87c4" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">个人副业的福分之一就是选择和探索的能力。我最近开始了这样一个项目，主要是出于对全球变暖及其与我们宏观经济活动的联系的好奇。这让我经历了一个激动人心但有时也很痛苦的过程，我总结如下:</p><blockquote class="lt lu lv"><p id="a294" class="kx ky lw kz b la lb kj lc ld le km lf lx lh li lj ly ll lm ln lz lp lq lr ls im bi translated">使用世界银行的API进行数据提取(高难度)→用于建模的数据准备(EDA)(高难度)→数据建模(低难度)</p></blockquote><p id="c6b7" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">对我来说，最有趣的发现是，全国平均气温可能不一定是一个微不足道的概念。在某些情况下，我发现在同一气候带的国家之间，测量期间的温度变化很大；这是我们的宏观经济活动对气温产生重大影响的一个潜在迹象。不过，需要提醒的是，还需要更多的研究。对于任何有兴趣浏览研究结果或该项目的任何其他方面的人，这里有<a class="ae ma" href="https://github.com/InsciteAnalytics/Climate-WorldBank" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><h2 id="44ea" class="mb mc ji bd md me mf dn mg mh mi dp mj lg mk ml mm lk mn mo mp lo mq mr ms mt bi translated">仪表板建筑</h2><p id="6032" class="pw-post-body-paragraph kx ky ji kz b la mu kj lc ld mv km lf lg mw li lj lk mx lm ln lo my lq lr ls im bi translated">鉴于我已经经历了组织这个困难的数据集的过程，我不希望这个附带项目保持独立。我想建立一个仪表板，使我能够通过点击世界地图上的国家来查看每个国家的数据(我的数据是按国家排列的)。我还希望这张地图有一个显示每个国家温度变化(基于指数)的色标。最后，仪表板还必须在网上公开。</p><p id="ef42" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">基于我对Python可视化/部署工具的了解，我期望花很多时间找到合适的库来实现这一点。令我惊讶的是，我发现Anaconda的Holoviz生态系统，由几个可视化、dashboarding和部署工具组成，是我计划的一站式商店。</p><figure class="na nb nc nd gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mz"><img src="../Images/2c7febf25fa50c75497dbf2d0135744b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xQEm58a7c_g1Go9G5NMyuw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">Holoviz是所有这些多用途工具的集合</p></figure><p id="0267" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我不会进入代码或我如何建立仪表板的细节；有足够的材料可以带你经历这些。这些<a class="ae ma" href="https://holoviz.org/tutorial/index.html" rel="noopener ugc nofollow" target="_blank">教程</a>是一个很好的开始。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h2 id="eb7d" class="mb mc ji bd md me mf dn mg mh mi dp mj lg mk ml mm lk mn mo mp lo mq mr ms mt bi translated">部署</h2><p id="1b92" class="pw-post-body-paragraph kx ky ji kz b la mu kj lc ld mv km lf lg mw li lj lk mx lm ln lo my lq lr ls im bi translated">现在这个帖子的关键来了。这是我旅程中在互联网上找不到太多直接帮助的部分。Panel库(Holoviz的一部分)为管理数据交互、设置管道、使用小部件和部署动态仪表板提供了一个优秀的工具包。部署就像用。servable()。这只有在部署在您的本地环境中时才成立。但是当涉及到像Heroku(我将在这里讨论)这样的云服务器时，你很可能会遇到问题。然而，我希望这个简短的演练将有助于解决这些问题。</p><h2 id="00ab" class="mb mc ji bd md me mf dn mg mh mi dp mj lg mk ml mm lk mn mo mp lo mq mr ms mt bi translated">web部署的问题</h2><p id="3e30" class="pw-post-body-paragraph kx ky ji kz b la mu kj lc ld mv km lf lg mw li lj lk mx lm ln lo my lq lr ls im bi translated">1.当我开始使用Heroku进行部署时，我遇到的第一个问题是我环境中的许多包无法通过pip获得；因此，应用程序构建阶段不断失败。</p><p id="00be" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">2.为了纠正上述问题，我尝试了几个定制的第三方构建包，它们应该能够处理基于conda的环境，但没有一个对我有效。</p><p id="b728" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">3.即使我很幸运地找到了一个buildpack，我意识到我的环境超过了3GB，而Heroku只允许最大500 MB用于这样的部署。</p><p id="59db" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">4.Panel library文档中的另一个选项是使用MyBinder进行部署，我试过了，但还是无法构建我的环境。</p><h2 id="e6f5" class="mb mc ji bd md me mf dn mg mh mi dp mj lg mk ml mm lk mn mo mp lo mq mr ms mt bi translated">解决办法</h2><p id="f4ab" class="pw-post-body-paragraph kx ky ji kz b la mu kj lc ld mv km lf lg mw li lj lk mx lm ln lo my lq lr ls im bi translated">通过创建docker文件使用Heroku容器注册表进行部署解决了这个问题。这是Heroku提供的三个部署选项中的第三个。其次，我没有使用环境文件，而是在docker文件中使用单独的库安装命令(这提供了更多的稳定性；然而，如果使用环境文件是强制性的，这里有一个<a class="ae ma" href="https://pythonspeed.com/articles/activate-conda-dockerfile/" rel="noopener ugc nofollow" target="_blank">指南</a>。</p><h2 id="43ac" class="mb mc ji bd md me mf dn mg mh mi dp mj lg mk ml mm lk mn mo mp lo mq mr ms mt bi translated">用近乎外行的语言快速浏览Docker</h2><p id="0aee" class="pw-post-body-paragraph kx ky ji kz b la mu kj lc ld mv km lf lg mw li lj lk mx lm ln lo my lq lr ls im bi translated">3个重要的docker概念:</p><p id="1b75" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">1.<strong class="kz jj"> Docker容器</strong>:一个更简单/更快速的虚拟机替代品。因此，您可以在Docker容器中复制您的本地环境，该容器可能运行在提供商的平台上(在本例中为Heroku ),并在其上运行您的应用程序。</p><p id="ec95" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">2.<strong class="kz jj"> Docker镜像</strong>:构建和运行Docker容器的指令。</p><p id="b89e" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">3.<strong class="kz jj"> Dockerfile </strong>:包含docker图像蓝图的文本文件。</p><p id="5684" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">以下是我用来部署我的应用程序的docker文件:</p><pre class="na nb nc nd gt nl nm nn no aw np bi"><span id="6a14" class="mb mc ji nm b gy nq nr l ns nt"># Starting from base miniconda image<br/>FROM continuumio/miniconda3</span><span id="f726" class="mb mc ji nm b gy nu nr l ns nt"># Setting working directory in destination<br/>WORKDIR /app</span><span id="43a6" class="mb mc ji nm b gy nu nr l ns nt"># This is the complete set of libraries required<br/>RUN conda install -c pyviz holoviz<br/>RUN conda install -c pyviz geoviews-core<br/>RUN conda install geopandas</span><span id="5200" class="mb mc ji nm b gy nu nr l ns nt"># Copy the relevant folder into the container<br/>COPY ./dep-test/ .</span><span id="7492" class="mb mc ji nm b gy nu nr l ns nt"># Run panel serve to start the app<br/>CMD panel serve --address="0.0.0.0" --port=$PORT main.py --allow-websocket-origin=worldbank-climate-dashboard.herokuapp.com</span></pre><p id="e2fa" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我的重点是最后一个CMD命令；但是为了理解这一点，有必要简要介绍一下Panel的部署系统:</p><p id="ae25" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated"><strong class="kz jj">本地部署使用。servable() </strong></p><p id="1c0d" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我提到过。servable()方法。什么时候。servable()附加到一个panel对象，该对象是使用Tornado web服务器部署的。因此，假设我有一个python文件或一个jupyter笔记本(在上面的例子中是它的main.py ),其中包含一个带有可显示面板对象的仪表板的全部代码，我决定使用。servable()。要访问已部署的版本，我必须使用命令提示符浏览到我的项目文件夹(注意，提示符应该在适当的conda环境中),并输入以下命令:</p><p id="624b" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated"><strong class="kz jj">panel serve<em class="lw">filename . py</em>或<em class="lw"> filename.ipynb </em> </strong> →这将在Tornado web服务器中打开应用程序，并为您提供使用浏览器访问它的链接。链接通常是:<a class="ae ma" href="http://localhost:5006/filename" rel="noopener ugc nofollow" target="_blank"> http://localhost:5006/ <em class="lw">文件名</em>T9】</a></p><p id="7132" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated"><strong class="kz jj"> Web部署使用。servable() </strong></p><p id="f86c" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">使用Heroku的Web部署是类似的。使用上面的Dockerfile文件，我们已经设置了所需的环境。CMD命令使您能够在shell中运行命令；因此，这就是我们使用<em class="lw">面板服务</em>的地方。以下是您将如何根据自己的应用程序自定义上述docker文件中的panel serve命令:</p><pre class="na nb nc nd gt nl nm nn no aw np bi"><span id="e58d" class="mb mc ji nm b gy nq nr l ns nt">CMD panel serve --address="0.0.0.0" --port=$PORT <strong class="nm jj"><em class="lw">main.py</em></strong> --allow-websocket-origin=<strong class="nm jj"><em class="lw">worldbank-climate-dashboard</em></strong>.herokuapp.com</span></pre><p id="4685" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">考虑上面粗体和斜体部分，您将执行以下操作:</p><ul class=""><li id="1002" class="nv nw ji kz b la lb ld le lg nx lk ny lo nz ls oa ob oc od bi translated">用包含仪表板代码的文件替换<strong class="kz jj"> <em class="lw"> main.py </em> </strong></li><li id="f112" class="nv nw ji kz b la oe ld of lg og lk oh lo oi ls oa ob oc od bi translated">将<strong class="kz jj"><em class="lw">world bank-climate-dashboard</em></strong>替换为您在Heroku中为应用程序选择的名称</li></ul><p id="b59b" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">如果你还没有帐户，下一步就是注册Heroku(这是免费的)。他们的网络用户界面很棒，会引导你完成应用简介的创建过程。最后，在Heroku的web UI的应用程序部署部分，您将看到三种部署方法:</p><ul class=""><li id="60f2" class="nv nw ji kz b la lb ld le lg nx lk ny lo nz ls oa ob oc od bi translated">Heroku Git(使用Heroku CLI)</li><li id="16b1" class="nv nw ji kz b la oe ld of lg og lk oh lo oi ls oa ob oc od bi translated">Github(连接到应用程序的Github Repo)</li><li id="510d" class="nv nw ji kz b la oe ld of lg og lk oh lo oi ls oa ob oc od bi translated">容器注册表(使用Heroku CLI)</li></ul><p id="9c16" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">选择容器注册表，将显示必要的程序。只需记住Heroku提供的命令的以下附加内容:</p><pre class="na nb nc nd gt nl nm nn no aw np bi"><span id="6064" class="mb mc ji nm b gy nq nr l ns nt">$ heroku container:push web -a 'name of your app'<br/>$ heroku container:release web -a 'name of your app'</span></pre><p id="e87d" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我的朋友们。万事如意！</p><p id="f7ff" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">PS:这里有一个仪表盘<a class="ae ma" href="https://github.com/InsciteAnalytics/worldbank-climate-dashboard" rel="noopener ugc nofollow" target="_blank">回购</a>的链接。</p></div></div>    
</body>
</html>