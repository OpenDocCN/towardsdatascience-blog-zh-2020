<html>
<head>
<title>Waffle Charts Using Python’s Matplotlib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 的 Matplotlib 的华夫饼图表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/waffle-charts-using-pythons-matplotlib-94252689a701?source=collection_archive---------19-----------------------#2020-07-28">https://towardsdatascience.com/waffle-charts-using-pythons-matplotlib-94252689a701?source=collection_archive---------19-----------------------#2020-07-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6174" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用 Matplotlib 库在 Python 中绘制华夫饼图表</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6b35348daaa9ca816f2dee2b0133c830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rndu9ryFktG-jzJc46y4Vg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">资料来源:佩雷斯·冈萨雷斯的 Unsplash</p></figure><p id="7111" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">华夫饼图表可能是仪表板中一个有趣的元素。显示实现目标的进度以及查看每个项目对整体的贡献尤其有用。但是如果你试图在里面放太多的项目，华夫饼图表就不是很有用了。r、Tableau 和 Python 都有用于华夫饼图表的包或函数。<strong class="lb iu">我将展示如何从头开始生成一个华夫饼干图表，并使用 pywaffle 中的华夫饼干函数。</strong></p><h2 id="8a2c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">要使用的工具</h2><p id="534f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">对于本教程，我们将使用:</p><ol class=""><li id="0074" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated"><a class="ae ky" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> Numpy 图书馆</a></li><li id="4dc0" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫图书馆</a></li><li id="b3ec" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><a class="ae ky" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> Matplotlib 库</a></li><li id="c727" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><a class="ae ky" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>环境。</li></ol><h2 id="c6af" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">开发一个没有华夫饼包装的华夫饼图表</h2><ol class=""><li id="9322" class="mt mu it lb b lc mo lf mp li nh lm ni lq nj lu my mz na nb bi translated">导入必要的包:</li></ol><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="d05b" class="lv lw it nl b gy np nq l nr ns">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import matplotlib.patches as mpatches</span></pre><p id="1b01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.创建一个数据框架。在本教程中，我将制作一个数据图，假称从阿根廷、巴西、古巴和秘鲁移民到美国的人数。这些数字只是虚构的。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="aab9" class="lv lw it nl b gy np nq l nr ns">df = pd.DataFrame({<br/>    'country': ['Argentina', 'Brazil', 'Cuba', 'Peru'],<br/>    'number': [212, 334, 1500, 130] <br/>})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/ff39870022f2dcdbbf24a61fe29b5b72.png" data-original-src="https://miro.medium.com/v2/resize:fit:328/format:webp/1*5gAYl2DdHkttl4s_NC6qNQ.png"/></div></figure><p id="1fad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.由于我们将呈现每个国家的移民人数对总数的贡献，我们需要知道总数。计算总数:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="f875" class="lv lw it nl b gy np nq l nr ns">total = sum(df['number'])</span></pre><p id="3e5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.计算每个国家的比例</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="34b8" class="lv lw it nl b gy np nq l nr ns">proportions = [(float(value) / total) for value in df['number']]</span><span id="5233" class="lv lw it nl b gy nu nq l nr ns">#Output:<br/>[0.0974264705882353,<br/> 0.15349264705882354,<br/> 0.6893382352941176,<br/> 0.05974264705882353]</span></pre><p id="a5ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.指定图表的宽度和高度。然后计算华夫饼图表中瓷砖的总数</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="6601" class="lv lw it nl b gy np nq l nr ns">width = 40<br/>height=10<br/>total= width * height</span></pre><p id="6319" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6.确定每个国家将分配多少瓷砖</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="b07b" class="lv lw it nl b gy np nq l nr ns">tiles_per_category = [round(proportion * total) for proportion in proportions]</span><span id="b62b" class="lv lw it nl b gy nu nq l nr ns">#Output:<br/>[39, 61, 276, 24]</span></pre><p id="fc68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有的数据准备都做好了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> GIPHY </a></p></figure><p id="9484" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">7.所有容易的工作都完成了。现在是棘手的部分。生成华夫饼。为此，我们将生成一个全零矩阵。然后用相应的类别替换每个零。这个矩阵将类似于华夫格图。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="e01f" class="lv lw it nl b gy np nq l nr ns">waffle = np.zeros((height, width))<br/>category_index = 0<br/>tile_index = 0</span><span id="cf43" class="lv lw it nl b gy nu nq l nr ns">for col in range(width):<br/>    for row in range(height):<br/>        tile_index += 1<br/>        if tile_index &gt; sum(tiles_per_category[0:category_index]):<br/>            category_index += 1<br/>        waffle[row, col] = category_index</span></pre><p id="666f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">8.选择<a class="ae ky" href="https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html" rel="noopener ugc nofollow" target="_blank">颜色图</a>并使用<a class="ae ky" href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.matshow.html" rel="noopener ugc nofollow" target="_blank"> matshow </a>显示矩阵</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="cf72" class="lv lw it nl b gy np nq l nr ns">fig = plt.figure()<br/>colormap = plt.cm.coolwarm<br/>plt.matshow(waffle, cmap=colormap)<br/>plt.colorbar()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/e5d872790627c380735c232f2f112cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*QZQgFq6LNuaKYM-pGSI6MA.png"/></div></figure><p id="f548" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">9.添加一些美化元素，如蜱和网格</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="3a37" class="lv lw it nl b gy np nq l nr ns">fig = plt.figure()<br/>colormap = plt.cm.coolwarm<br/>plt.matshow(waffle, cmap=colormap)<br/>ax = plt.gca()</span><span id="0955" class="lv lw it nl b gy nu nq l nr ns">ax.set_xticks(np.arange(-0.5, (width), 1), minor=True)<br/>ax.set_yticks(np.arange(-0.5, (height), 1), minor=True)</span><span id="ab27" class="lv lw it nl b gy nu nq l nr ns">ax.grid(which='minor', color='w', linestyle='-', linewidth=2)</span><span id="80e8" class="lv lw it nl b gy nu nq l nr ns">plt.xticks([])<br/>plt.yticks([])<br/>plt.colorbar()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/8e4f511f1bb5affa87cd6f3e88bd341c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*CVNRNCYjeoGxi-0xK1blrw.png"/></div></figure><p id="6082" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">10.最后，添加图例来完成华夫饼图表。这是华夫饼图表的完整代码。如果您喜欢，您可以简单地保留这段代码，并在您的数据中重用它。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="8652" class="lv lw it nl b gy np nq l nr ns">fig = plt.figure()<br/>colormap = plt.cm.coolwarm<br/>plt.matshow(waffle, cmap=colormap)<br/>ax = plt.gca()</span><span id="1301" class="lv lw it nl b gy nu nq l nr ns">ax.set_xticks(np.arange(-0.5, (width), 1), minor=True)<br/>ax.set_yticks(np.arange(-0.5, (height), 1), minor=True)</span><span id="cb4d" class="lv lw it nl b gy nu nq l nr ns">ax.grid(which='minor', color='w', linestyle='-', linewidth=2)</span><span id="e5ed" class="lv lw it nl b gy nu nq l nr ns">plt.xticks([])<br/>plt.yticks([])</span><span id="5847" class="lv lw it nl b gy nu nq l nr ns">values = df['number']<br/>categories = df['country']<br/>value_sign = ''<br/>values_cumsum = np.cumsum(values)<br/>total_values = values_cumsum[len(values_cumsum) - 1]</span><span id="d7bd" class="lv lw it nl b gy nu nq l nr ns">legend_handles = []<br/>for i, category in enumerate(categories):<br/>    if value_sign == '%':<br/>        label_str = category + ' (' + str(values[i]) + value_sign + ')' <br/>    else:<br/>        label_str = category + ' (' + value_sign + str(values[i]) + ')'<br/>    color_val = colormap(float(values_cumsum[i]) / total_values)<br/>    legend_handles.append(mpatches.Patch(color=color_val, label=label_str))<br/>    <br/>plt.legend(handles=legend_handles, loc = 'lower center', ncol=len(categories),<br/>          bbox_to_anchor=(0., 0.2, 0.95, 0.1)) #positioning legends<br/>plt.colorbar()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/c6cbdd160a80fd89ccb6e86d4a25c073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*7Y0QqvqI42ueShtG5R78Tw.png"/></div></div></figure><p id="63de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看，每个国家的移民人数对总人数的贡献是非常明显的</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nw l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://giphy.com/stories/black-excellence-simone-biles-9718bf95-8b0b" rel="noopener ugc nofollow" target="_blank"> GIPHY </a></p></figure><blockquote class="oa"><p id="6c71" class="ob oc it bd od oe of og oh oi oj lu dk translated">如果情节中的元素太多，就不再那么清晰了。这是华夫饼图表的一个重要缺点</p></blockquote><h2 id="7c92" class="lv lw it bd lx ly ok dn ma mb ol dp md li om mf mg lm on mi mj lq oo ml mm mn bi translated">使用 Waffle 类开发 Waffle 图表</h2><p id="67f0" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">您需要使用以下命令安装 pywaffle 包</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="1b4f" class="lv lw it nl b gy np nq l nr ns">pip install pywaffle</span></pre><p id="5255" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在从 pywaffle 包中导入华夫饼</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="2fcb" class="lv lw it nl b gy np nq l nr ns">from pywaffle import Waffle</span></pre><p id="b94e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用与上一个示例相同的数据，使用 waffle 函数绘制一个 Waffle 图</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="c4f9" class="lv lw it nl b gy np nq l nr ns">fig = plt.figure(<br/>    FigureClass=Waffle, <br/>    rows=10, <br/>    values=list(df.number/5),<br/>    labels=list(df.country),<br/>    figsize=(12, 8),<br/>    legend={'bbox_to_anchor': (0.5, 0.5)}    <br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/965ffd84f808e6f7a0fb0d84ecf365a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*1SYRTj8MbOgCmxG790fgRA.png"/></div></figure><p id="f456" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我试图展示如何使用 Matplotlib 库而不是 pywaffle 包来编写一个 waffle 图表，因为我认为这样可以给你更多的灵活性。使用 pywaffle 包也不错。这也可以制作一个像样的华夫饼图表，并很好地服务于您的目的。点击<a class="ae ky" href="https://readthedocs.org/projects/pywaffle/downloads/pdf/latest/" rel="noopener ugc nofollow" target="_blank">此链接</a>了解更多关于 pywaffle 套餐的选项和细节。</p><p id="f05b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢您阅读这篇文章。我希望这有所帮助。</p><p id="2675" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">推荐阅读:</p><p id="46b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/bubble-plots-in-matplotlib-3f0b3927d8f9">Matplotlib 中的气泡图</a></p><p id="558d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/basic-plots-in-matplotlib-visualization-in-python-13013c9e4ee4">Matplotlib 中的基本绘图:Python 中的可视化</a></p><p id="a99a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/master-pandas-groupby-for-efficient-data-summarizing-and-analysis-c6808e37c1cb"> Pandas 的详细分组功能，用于高效的数据汇总和分析</a></p><p id="36dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/understanding-the-data-using-histogram-and-boxplot-with-example-425a52b5b8a6">使用直方图和箱线图理解数据，并举例</a></p><p id="a474" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/how-to-present-the-relationships-amongst-multiple-variables-in-python-fa1bdd4f368c">如何在 Python 中展现多个变量之间的关系</a></p></div></div>    
</body>
</html>