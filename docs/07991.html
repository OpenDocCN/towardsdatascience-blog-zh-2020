<html>
<head>
<title>Automatic Notification to Email with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python自动通知电子邮件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automatic-notification-to-email-with-python-810fd357d89c?source=collection_archive---------16-----------------------#2020-06-13">https://towardsdatascience.com/automatic-notification-to-email-with-python-810fd357d89c?source=collection_archive---------16-----------------------#2020-06-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1344" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python自动化您的通知系统</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d286e9464f04ee747eebfcb0fcb3187e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CAXefMdYi8CDyPc1"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约纳斯·勒普在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a5c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你有没有处于一个等待你的机器学习模型，需要去某个地方的位置？或者您正在执行另一项任务，并且一直在思考您的脚本是否已经成功运行？我以前也有过这样的经历，这就是为什么我用Python为我的电子邮件创建了一个自动通知系统。</p><p id="50df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将解释如何通过几个简单的步骤用Python创建自动化系统。让我们开始吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b02c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">电子邮件准备</h1><p id="bf00" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了简单起见，我会使用Gmail的电子邮件系统。我们首先需要做的是从<a class="ae ky" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌API控制台</a>设置Gmail API。在开发人员仪表板中，选择启用API和服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/454afe2dcfecea1f0fd59dcb4fd2f682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*mDWWeYnftIj3H-v4iMC-NQ.png"/></div></figure><p id="3b5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在那里，尝试输入并搜索Gmail API。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/942bb6f18016ec2af2f79cd0ccf01598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*wjNGay42enbPBCzb6cw_Yg.png"/></div></figure><p id="cbf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Gmail API选项中，单击启用以激活我们的Gmail API。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/fdf084b9b2f90cd6c5eb277f59b0b168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*i-BhAk8RyuuuPqldOmWCBw.png"/></div></figure><p id="e435" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成后，我们需要在中创建凭据来访问电子邮件，并使用Gmail发送通知。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/57ba1ae8f366d47cc2967d0efa9da9cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UPJAOGKmqND-uC4iUNga1Q.png"/></div></div></figure><p id="3099" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择OAuth客户端ID，当询问应用程序类型时，因为我使用Jupyter Notebook来运行我的脚本，所以我会选择桌面应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/b98c18b48087cfd9a52e344ccdb2089b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*c4Sugzz30cNGUsQxy6hPHw.png"/></div></figure><p id="0d4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随便你给它起什么名字，这里我就叫它gmail_python。当您完成创建凭证时，您需要以JSON形式下载它。对于我的推荐，最好改名为‘credentials . JSON’。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/9cc361ced64869670c6e8fc5eb15430c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uF9eZRYtkVWGdaKYmsGtyA.png"/></div></div></figure><p id="ac9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将文件与Jupyter笔记本(或脚本)放在同一个文件夹中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4df0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建通知系统</h1><p id="b44c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">电子邮件系统将基于谷歌Gmail API的推荐发送电子邮件。我还会使用<a class="ae ky" href="https://docs.python.org/3/library/email.html#module-email" rel="noopener ugc nofollow" target="_blank">电子邮件模块</a>来帮助我构建发送电子邮件的系统。</p><p id="313e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们创建生成消息的函数。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="adbf" class="nk md it ng b gy nl nm l nn no">from email import encoders<br/>from email.mime.base import MIMEBase<br/>from email.mime.multipart import MIMEMultipart<br/>from email.mime.text import MIMEText<br/>import base64<br/>import os</span><span id="ec95" class="nk md it ng b gy np nm l nn no">def create_message(sender, to, subject, message_text):<br/>  """Create a message for an email.</span><span id="0ed9" class="nk md it ng b gy np nm l nn no">Args:<br/>    sender: Email address of the sender.<br/>    to: Email address of the receiver.<br/>    subject: The subject of the email message.<br/>    message_text: The text of the email message.</span><span id="e01e" class="nk md it ng b gy np nm l nn no">Returns:<br/>    An object containing a base64url encoded email object.<br/>  """<br/>  message = MIMEText(message_text)<br/>  message['to'] = to<br/>  message['from'] = sender<br/>  message['subject'] = subject<br/>  return {'raw': base64.urlsafe_b64encode(message.as_string().encode()).decode()}</span></pre><p id="4e04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们创建发送消息的函数。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="2c2f" class="nk md it ng b gy nl nm l nn no">def send_message(service, user_id, message):<br/>  """Send an email message.</span><span id="2768" class="nk md it ng b gy np nm l nn no">Args:<br/>    service: Authorized Gmail API service instance.<br/>    user_id: User's email address. The special value "me"<br/>    can be used to indicate the authenticated user.<br/>    message: Message to be sent.</span><span id="d11b" class="nk md it ng b gy np nm l nn no">Returns:<br/>    Sent Message.<br/>  """<br/>  try:<br/>    message = (service.users().messages().send(userId=user_id, body=message)<br/>               .execute())<br/>    print('Message Id: {}'.format(message['id']))<br/>    return message<br/>  except:<br/>    print ('An error occurred')</span></pre><p id="0fee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有两个功能来创建消息和发送电子邮件。下一步，让我们创建一个自动化通知系统的函数。这里我们需要之前从google Gmail API创建的凭证。在这里，我将我的系统设置为使用凭证JSON文件作为‘credentials . JSON’。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="94cd" class="nk md it ng b gy nl nm l nn no">def notification(sender, to, subject, notification):</span><span id="a463" class="nk md it ng b gy np nm l nn no">#Sender is the sender email, to is the receiver email, subject is the email subject, and notification is the email body message. All the text is str object.</span><span id="4514" class="nk md it ng b gy np nm l nn no">SCOPES = '<a class="ae ky" href="https://mail.google.com/'" rel="noopener ugc nofollow" target="_blank">https://mail.google.com/'</a><br/>    message = create_message(sender, to, subject, notification)<br/>    creds = None</span><span id="29dc" class="nk md it ng b gy np nm l nn no">if os.path.exists('token.pickle'):<br/>        with open('token.pickle', 'rb') as token:<br/>            creds = pickle.load(token)<br/>        #We use login if no valid credentials<br/>    if not creds or not creds.valid:<br/>        if creds and creds.expired and creds.refresh_token:<br/>            creds.refresh(Request())<br/>        else:<br/>            flow =   InstalledAppFlow.from_client_secrets_file('credentials.json', SCOPES)<br/>            creds = flow.run_local_server(port=0)<br/>            # Save the credentials for the next run<br/>        with open('token.pickle', 'wb') as token:<br/>            pickle.dump(creds, token)</span><span id="d72e" class="nk md it ng b gy np nm l nn no">service = build('gmail', 'v1', credentials=creds)<br/>    send_message(service, sender, message)</span></pre><p id="7a78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着我们的通知功能准备就绪，我们可以尝试发送通知。例如，我会尝试学习下面的机器学习模型。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="8a6e" class="nk md it ng b gy nl nm l nn no">import seaborn as sns<br/>import pandas as pd<br/>from sklearn.linear_model import LinearRegression</span><span id="60de" class="nk md it ng b gy np nm l nn no">#Loading the dataset and only using the numerical variables<br/>mpg = sns.load_dataset('mpg').drop(['origin', 'name'], axis = 1)<br/>linear_model = LinearRegression()</span><span id="2b2c" class="nk md it ng b gy np nm l nn no">try:<br/>    #Training the model<br/>    linear_model.fit(mpg.drop('mpg', axis =1), mpg['mpg'])</span><span id="cd9b" class="nk md it ng b gy np nm l nn no">notification('test1<a class="ae ky" href="mailto:cornelliusyudhaw@gmail.com" rel="noopener ugc nofollow" target="_blank">@gmail.com</a>', 'test2<a class="ae ky" href="mailto:cornelliusyudhaw@gmail.com" rel="noopener ugc nofollow" target="_blank">@gmail.com</a>', 'Notification - Success Training', 'The model has finish')<br/>except:<br/>    notification('test1<a class="ae ky" href="mailto:cornelliusyudhaw@gmail.com" rel="noopener ugc nofollow" target="_blank">@gmail.com</a>', 'test2<a class="ae ky" href="mailto:cornelliusyudhaw@gmail.com" rel="noopener ugc nofollow" target="_blank">@gmail.com</a>', 'Notification - Failed Training', 'The model encountered error')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/1357c81494d7870627735f1617c45ecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oeCHOmTxRAwbFZBsPQXaew.png"/></div></div></figure><p id="8fa6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当培训结束或他们遇到错误时，我会收到通知。我们用于训练的上述数据含有NaN值，所以这显然会导致误差。虽然，我的观点是，我们现在能够为我们的电子邮件创建通知系统。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2bc9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="f351" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，我向您展示了如何使用python为您的电子邮件创建一个简单的通知系统。你可以随意修改这个系统。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="75d1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如果您喜欢我的内容，并希望获得更多关于数据或数据科学家日常生活的深入知识，请考虑在此订阅我的<a class="ae ky" href="https://cornellius.substack.com/welcome" rel="noopener ugc nofollow" target="_blank">简讯。</a></h1><blockquote class="nr"><p id="52a0" class="ns nt it bd nu nv nw nx ny nz oa lu dk translated">如果<!-- -->您没有订阅为中型会员，请考虑通过<a class="ae ky" href="https://cornelliusyudhawijaya.medium.com/membership" rel="noopener">我的介绍</a>订阅。</p></blockquote></div></div>    
</body>
</html>