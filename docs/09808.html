<html>
<head>
<title>Recommender Systems from Learned Embeddings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于学习嵌入的推荐系统</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/recommender-systems-from-learned-embeddings-f1d12288f278?source=collection_archive---------7-----------------------#2020-07-12">https://towardsdatascience.com/recommender-systems-from-learned-embeddings-f1d12288f278?source=collection_archive---------7-----------------------#2020-07-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="71af" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一种深度神经网络方法</h2></div><p id="0038" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">推荐系统是现代消费者网络应用的基本构建模块，其寻求预测用户<strong class="kk iu"> <em class="le"> </em> </strong>偏好。有不同的方法来建立推荐系统。我们对基于最近邻的方法特别感兴趣。我们研究一个项目的配对之间的相似性，并推荐给用户</p><p id="68cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将在电影数据集上应用深度神经网络，向用户推荐电影。该系统将随着模型训练过程学习电影嵌入。我们将使用这些嵌入来创建最近邻数据库。每当用户点击一部电影，系统就会提取它的嵌入，找到最近邻的电影推荐给用户。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/5a654e1a4fe2fb494eb18a111e0e2af9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nc_cAV8F7DhIduIwGGltuA.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图片来自 Pixabay 的 Thomas Breher</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="4ba5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你觉得这篇文章很有趣，请随时联系 LinkedIn。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a452" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">一般建筑</h1><p id="ff22" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">该系统的整体架构如图 1 所示</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/485b877c5ac2d18ca878bdb1dfde73c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*9XhuIRuXAF1iVZrtYURTgA.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图 1 —系统架构</p></figure><p id="19be" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用电影 ID 和用户 ID 来生成它们相应的嵌入。这些嵌入是通过模型训练过程与其他参数一起生成的。一旦我们有了嵌入，我们建立一个 K-最近邻(KNN)模型。那么每当有一个用户，我们就可以从我们的神经网络模型中得到那个用户的嵌入。我们使用这种嵌入在 KNN 数据库中查找并向该用户推荐 top-K 电影。</p><p id="5dc0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里需要注意的一点是，这种方法无法处理未知用户。也就是说，如果用户 ID 在模型训练过程中不存在，我们将无法为该用户推荐电影。解决这个问题有不同的方法。例如基于人口统计或其他特征找到相似的用户，并基于此为新用户进行推荐。但是这种讨论超出了本文的范围。</p><p id="7166" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将使用 Keras (Tensorflow 2.0 作为后端)来构建我们的深度学习模型。</p><h1 id="b069" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">资料组</h1><p id="ea0b" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">在这篇文章中，我们将使用<a class="ae mc" href="http://files.grouplens.org/datasets/movielens/ml-100k.zip" rel="noopener ugc nofollow" target="_blank"> MovieLens 100K </a>数据集。数据集包含 100K 行和 34 列。各列如下所示。</p><pre class="lg lh li lj gt ng nh ni nj aw nk bi"><span id="75e1" class="nl me it nh b gy nm nn l no np">'user_id', 'movie_id', 'rating', 'unix_timestamp', 'title', 'release_date', 'video_release_date', 'imdb_url', 'genre_unknown','Action', 'Adventure', 'Animation', 'Children', 'Comedy', 'Crime','Documentary', 'Drama', 'Fantasy', 'Film-Noir', 'Horror', 'Musical','Mystery', 'Romance', 'Sci-Fi', 'Thriller', 'War', 'Western', 'year','genre', 'all_genres', 'age', 'sex', 'occupation', 'zip_code'</span></pre><p id="e1e6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我不会深入特性工程的细节，因为这超出了这篇文章的范围。数据集有 943 个唯一的<code class="fe nq nr ns nh b">users</code>和 1682 个唯一的<code class="fe nq nr ns nh b">movies</code>。我们将使用<code class="fe nq nr ns nh b">user_id</code>和<code class="fe nq nr ns nh b">movie_id</code>作为特征，使用<code class="fe nq nr ns nh b">rating</code>作为基于嵌入模型的目标。</p><h1 id="2b08" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">关于嵌入的注释</h1><p id="57c8" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">嵌入是实体的向量表示。你可以通过嵌入把任何离散的实体表示成一个连续的空间[2]。向量中的每一项代表该实体的一个特征或特征组合。</p><p id="f49b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，您可以将电影和用户 id 表示为嵌入。为了简单起见，让我们假设这些嵌入是二维向量，如图 2 所示。我们将创建电影和用户嵌入，并用我们的神经网络训练它们。目标是将用户和电影放在一个相似的嵌入空间中，这样我们就可以应用基于最近邻的推荐。图 2 显示了一个假设的例子，其中<code class="fe nq nr ns nh b">user_1</code>比<code class="fe nq nr ns nh b">movie_3</code>更接近嵌入空间中的<code class="fe nq nr ns nh b">movie_1</code>和<code class="fe nq nr ns nh b">movie_2</code>。所以我们将推荐<code class="fe nq nr ns nh b">movie_1</code>和<code class="fe nq nr ns nh b">movie_2</code>到<code class="fe nq nr ns nh b">user_1</code>。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/da80d7446b1849fd449debf79319e11f.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*8NXH77Ylw5z5xfnU9fcmKg.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图 2 —嵌入空间中的电影和用户</p></figure><h1 id="7db8" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">模型</h1><p id="f56e" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">记住上面的概念，让我们定义我们的模型。在本文中，我正在构建一个四层深度神经网络。您将定义<code class="fe nq nr ns nh b">EMBEDDING_SIZE</code>为您想要嵌入的向量的维数。一般来说，更高的维度更好，因为这可以捕捉更多的特征，尽管这可能会增加训练时间。本例中<code class="fe nq nr ns nh b">NUM_USERS</code>为<code class="fe nq nr ns nh b">943</code>而<code class="fe nq nr ns nh b">NUM_MOVIES</code>为<code class="fe nq nr ns nh b">1682</code>。<code class="fe nq nr ns nh b">ROW_COUNT</code>表示您的训练集的大小。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="4b44" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如您在上面的代码中看到的，我们已经为电影(第 4 行)和用户(第 11 行)创建了一个嵌入层。对于一个机器学习工程师来说，了解 Keras 嵌入层是如何工作的是值得的[3][4]。<code class="fe nq nr ns nh b">output_dim</code>表示嵌入向量的长度，在我们的例子中是<code class="fe nq nr ns nh b">EMBEDDING_SIZE</code>。<code class="fe nq nr ns nh b">input_dim</code>表示不同实体的数量——在本例中为<code class="fe nq nr ns nh b">NUM_MOVIES</code>或<code class="fe nq nr ns nh b">NUM_USERS</code>。<code class="fe nq nr ns nh b">input_length</code>参数决定每个输入序列的大小。嵌入层根据<code class="fe nq nr ns nh b">embedding_initializer</code>参数【3】初始化嵌入权重。如果您将这些嵌入层与网络一起训练，这些层的输出将得到更新。这就是我们模型中发生的情况。</p><p id="502d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我为<code class="fe nq nr ns nh b">50</code>个时期训练模型，将<code class="fe nq nr ns nh b">early_stopping</code>设置为在连续 10 个时期内验证损失不变。您可以根据自己的需要调整这些参数。</p><p id="ad8a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以绘制模型来可视化它的架构</p><pre class="lg lh li lj gt ng nh ni nj aw nk bi"><span id="7ef5" class="nl me it nh b gy nm nn l no np">keras.utils.plot_model(model, show_shapes=True) </span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nw"><img src="../Images/2b0be82899e63dd8042b47ecd43ca915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j8OtPs_oprR-f91x7dJ6SQ.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图 3——可视化模型架构</p></figure><p id="d107" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以绘制不同时期的损失曲线</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/56d0f7f9d4f663312db4d3452bbe668c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*yzdT7lI6OCEby_K-1B5TPA.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图 4 —历元曲线上的损耗</p></figure><p id="14f9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">图 4 示出了训练损失随着时期减少，这意味着训练收敛到最佳点。</p><p id="a0a9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以使用<code class="fe nq nr ns nh b">movie_model.predict(numpy.array([id]))</code>从每个电影 ID 的<code class="fe nq nr ns nh b">movie_model</code>中提取电影嵌入。</p><h1 id="2f50" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">验证嵌入</h1><p id="e4c8" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">你怎么知道这些嵌入是正确的呢？验证它们的一种方法是绘制嵌入图。一旦你画了图，你会看到有相似评级的电影(因为评级是我们的目标)就在嵌入空间附近。让我们看一看。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ny"><img src="../Images/a70c8060d055f12a83c55beeae6898fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mhYBBjNYnF-UotqP-0f1vA.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图 5 —电影嵌入的 t-SNE 图</p></figure><p id="f3b4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">图 5 有点难以想象。所以我打算绘制前 300 个电影嵌入，看看我是否能得到更清晰的图像。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ny"><img src="../Images/b1b48c71b823df8176e0599ed47153a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QHNVPk4NqwcqfHWj0IROgg.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图 6-电影 ID 300 之前电影嵌入的 t-SNE 图</p></figure><p id="da53" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，在图 6 中，电影 ID <code class="fe nq nr ns nh b">53</code>和<code class="fe nq nr ns nh b">66</code>在嵌入空间上比电影 ID <code class="fe nq nr ns nh b">9</code>更接近。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nz"><img src="../Images/e256fabc653ac65a5ce1fa8a90438180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Blg57LlO3VRlK3HNZ9M4dg.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图 7 —计算平均电影评级</p></figure><p id="3734" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您检查数据集的平均评分(图 7)，您会发现电影 ID <code class="fe nq nr ns nh b">53</code>和<code class="fe nq nr ns nh b">66</code>的平均评分分别为<code class="fe nq nr ns nh b">3.24</code>和<code class="fe nq nr ns nh b">3.04 </code>，而电影 ID <code class="fe nq nr ns nh b">9</code>的平均评分为<code class="fe nq nr ns nh b">3.83</code>。</p><h1 id="b319" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">使用 KNN 的最近邻居</h1><p id="a054" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">现在我们有了嵌入，我们可以应用最近邻算法向用户推荐电影。我们可以从<code class="fe nq nr ns nh b">user_id</code>中得到<code class="fe nq nr ns nh b">user_embedding</code>，找出嵌入空间中与<code class="fe nq nr ns nh b">user_embedding</code>接近的电影有哪些。为此，我们使用 K-最近邻算法。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="a399" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里推荐的 10 部电影列表如图 8 所示。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/5b0838f61625e63d19ae4b452dfa3b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*hpjYibmU7pekhGN2S1PY_g.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图 8 —推荐电影列表</p></figure><p id="89a6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里需要注意的是，如果嵌入发生变化，推荐的电影列表可能会有所不同。嵌入可能会因运行而异。这主要是因为我们使用了一个较小的数据集(100K 行)。更大的数据集(1M+)以及更长的训练时间可能会输出更稳定的嵌入。</p><p id="40c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文的完整代码可以在<a class="ae mc" href="https://github.com/nahidalam/blog/blob/master/Recommender%20Systems%20from%20Learned%20Embedding.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="34d3" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">参考:</h1><ol class=""><li id="8348" class="ob oc it kk b kl mv ko mw kr od kv oe kz of ld og oh oi oj bi translated">Youtube 深度神经网络推荐<a class="ae mc" href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/45530.pdf" rel="noopener ugc nofollow" target="_blank">此处</a></li><li id="ba7d" class="ob oc it kk b kl ok ko ol kr om kv on kz oo ld og oh oi oj bi translated">m .库拉(2015 年)。<a class="ae mc" href="https://arxiv.org/pdf/1507.08439.pdf" rel="noopener ugc nofollow" target="_blank">用户和项目冷启动推荐的元数据嵌入</a>。arXiv:1507.08439。</li><li id="310f" class="ob oc it kk b kl ok ko ol kr om kv on kz oo ld og oh oi oj bi translated">Keras 嵌入层【https://keras.io/api/layers/core_layers/embedding/ T2】</li><li id="6b91" class="ob oc it kk b kl ok ko ol kr om kv on kz oo ld og oh oi oj bi translated">Keras 嵌入层如何工作<a class="ae mc" href="https://stats.stackexchange.com/questions/270546/how-does-keras-embedding-layer-work" rel="noopener ugc nofollow" target="_blank">https://stats . stack exchange . com/questions/270546/how-does-Keras-Embedding-layer-work</a></li><li id="412e" class="ob oc it kk b kl ok ko ol kr om kv on kz oo ld og oh oi oj bi translated"><a class="ae mc" href="https://drop.engineering/building-a-recommender-system-using-embeddings-de5a30e655aa" rel="noopener ugc nofollow" target="_blank">https://drop . engineering/building-a-recommenders-system-using-embeddings-de 5a 30 e 655 aa</a></li><li id="0b00" class="ob oc it kk b kl ok ko ol kr om kv on kz oo ld og oh oi oj bi translated"><a class="ae mc" href="https://www.kaggle.com/willkoehrsen/neural-network-embedding-recommendation-system#Neural-Network-Embedding-Model" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/willkoehrsen/Neural-Network-Embedding-recommendation-system # Neural-Network-Embedding-Model</a></li></ol></div></div>    
</body>
</html>