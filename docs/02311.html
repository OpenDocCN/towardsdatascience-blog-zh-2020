<html>
<head>
<title>Russian Text Normalization for STT and TTS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向 STT 和 TTS 的俄语文本规范化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/russian-text-normalization-for-stt-and-tts-a6d8f03aaeb9?source=collection_archive---------49-----------------------#2020-03-04">https://towardsdatascience.com/russian-text-normalization-for-stt-and-tts-a6d8f03aaeb9?source=collection_archive---------49-----------------------#2020-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1715" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">包括 STT(语音到文本)和 TTS(文本到语音)在内的许多语音相关问题都需要将抄本转换成真实的“<strong class="jp ir">口语</strong>”形式，即说话者所说的准确单词。这意味着在一些<strong class="jp ir">书写的</strong>表达式成为我们的抄本之前，它需要被<strong class="jp ir">规范化</strong>。换句话说，文本必须分几个步骤进行处理，包括:</p><ul class=""><li id="567c" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">转换数字:<code class="fe ku kv kw kx b">1984 год</code>-&gt;<em class="ky">тысячадевятьсотвосемьдесятчетвёртыйгод</em>；</li><li id="9856" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated">展开缩写:<code class="fe ku kv kw kx b">2 мин. ненависти</code>-&gt;<em class="ky">двеминутыненависти</em>；</li><li id="cc8b" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated">拉丁符号的转写(多为英文):<code class="fe ku kv kw kx b">Orwell</code> - &gt; <code class="fe ku kv kw kx b">Оруэлл</code> <br/>等等。</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/8a9e280758bd9a4e65f3773e0bfbe976.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TFKlaUyEIpvtxQ3P.jpg"/></div></div></figure><p id="799a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我想总结一下我们在俄语语音数据集<a class="ae lq" href="https://github.com/snakers4/open_stt" rel="noopener ugc nofollow" target="_blank"> Open_STT </a>中的文本规范化方法，简单介绍一下我们使用的思想和工具。</p><p id="df35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为锦上添花，我们决定与社区共享我们的 seq2seq 标准化器。它实际上是通过一行程序调用的，只要看看我们的 github <a class="ae lq" href="https://github.com/snakers4/russian_stt_text_normalization" rel="noopener ugc nofollow" target="_blank">库</a>就知道了。</p><pre class="lf lg lh li gt lr kx ls lt aw lu bi"><span id="2614" class="lv lw iq kx b gy lx ly l lz ma">norm = Normalizer() <br/>result = norm.norm_text('С 9 до 11 котики кушали whiskas')</span><span id="3747" class="lv lw iq kx b gy mb ly l lz ma">&gt;&gt;&gt; 'С девяти до одиннадцати котики кушали уискас'</span></pre><h1 id="94fa" class="mc lw iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">关于任务的更多信息</h1><p id="2936" class="pw-post-body-paragraph jn jo iq jp b jq mz js jt ju na jw jx jy nb ka kb kc nc ke kf kg nd ki kj kk ij bi translated">那么，怎么了？理论上，如果很难将缩写扩展为完整的形式，缩写就不会如此常用:每个人都知道“Dr .”代表“医生”。事实上，这并不简单，一些母语人士的直觉是理解所有细微差别的必备属性。</p><p id="ef76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想知道兔子洞有多深，请看下面的例子:</p><ul class=""><li id="2b65" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated"><code class="fe ku kv kw kx b">2е</code> - <em class="ky"> второе(ые)/the 第二</em>，<strong class="jp ir">但是</strong>t5】-<em class="ky">двае</em>/两个 e；</li><li id="737d" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated"><code class="fe ku kv kw kx b">2 части</code> - <em class="ky"> две </em> части/two 部分，<strong class="jp ir">但</strong>T7】-нет<em class="ky">второй</em>части/no 第二部分；</li><li id="1134" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated"><code class="fe ku kv kw kx b">длиной до 2 км</code>-длинойдо<em class="ky">двух</em>километиов/长达两公里，<strong class="jp ir">但</strong>T9】-ееемдо<em class="ky">вто</em></li><li id="66c8" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated"><code class="fe ku kv kw kx b">= 2/5</code>-равно<em class="ky">двепятых</em>/等于五分之二，<strong class="jp ir">但是</strong><code class="fe ku kv kw kx b">д. 2/5</code>-дом<em class="ky">двадробьпять/house</em>二建五甚至-<em class="ky">двапять</em>/二建五。</li></ul><p id="15f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">缩写和首字母缩略词也是一个问题:同一个缩写可以根据语境(<code class="fe ku kv kw kx b">г</code> - <em class="ky"> город </em>或<em class="ky"> год </em>)或说话人(<code class="fe ku kv kw kx b">БЦ</code> - <em class="ky"> б ц </em>或<em class="ky"> бизнес центр </em>？).想象一下一个令人头痛的音译是什么:不知何故，它相当于学习另一种语言。上述所有问题对口语形式来说都是特别具有挑战性的。</p><h1 id="6e93" class="mc lw iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">统计管道</h1><p id="214c" class="pw-post-body-paragraph jn jo iq jp b jq mz js jt ju na jw jx jy nb ka kb kc nc ke kf kg nd ki kj kk ij bi translated">人们很容易迷失在这无尽的变化中:你沉浸在搜索和处理越来越多新案件的无尽循环中。在某些时候，最好停下来回忆一下帕累托原则或 20/80 法则。我们可以处理大约 20%的最流行的案例，覆盖大约 80%的整个语言，而不是解决一般的任务。</p><p id="d5db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一个 Open_STT 版本的方法更加残酷:如果你看到一个数字，就把它改成一个默认的基数。作为对 STT 应用程序的攻击，这个决定甚至是合理的。通过将<code class="fe ku kv kw kx b">2020 год</code>转换为<em class="ky"> две тысячи двадцать год </em>，你只丢失了 1-2 个字母，而忽略一个完整的数字会导致三个单词的错误。</p><p id="85a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">渐渐地，我们添加了某种形式的上下文依赖。现在<code class="fe ku kv kw kx b">год</code>这个词前面的数字变成了序数<code class="fe ku kv kw kx b">2020</code>最后变成了<em class="ky"> две тысячи двадцатый </em>。因此，我们的“手动”统计管道出现了——我们找到最流行的组合，并将它们添加到规则集中。</p><h1 id="129c" class="mc lw iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">序列到序列网络</h1><p id="5b12" class="pw-post-body-paragraph jn jo iq jp b jq mz js jt ju na jw jx jy nb ka kb kc nc ke kf kg nd ki kj kk ij bi translated">在某种程度上，序列到序列(seq2seq)架构显然非常适合我们的任务。事实上，seq2seq 与手动管道工作得一样好，甚至更好:</p><ul class=""><li id="da27" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">将一个序列转换为另一个序列—选中；</li><li id="204b" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated">模型上下文依赖关系—检查；</li><li id="5c04" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated">找到最合适的规则来转换序列—检查；</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/71080e46e6e35bc8a5b60c257788358e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*Al6DYOY7crrSZ1uV.png"/></div></figure><blockquote class="nf ng nh"><p id="453f" class="jn jo ky jp b jq jr js jt ju jv jw jx ni jz ka kb nj kd ke kf nk kh ki kj kk ij bi translated"><em class="iq">序列“5 января".”的注意力得分图为了生成“пятого”模型的结尾，不仅考虑了单词“5 ”,还考虑了单词“января".”的后续字符</em></p></blockquote><p id="fb39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为基础，我们从这里的开始，在 PyTorch <a class="ae lq" href="https://bastings.github.io/annotated_encoder_decoder/" rel="noopener ugc nofollow" target="_blank">上实现 seq2seq。要了解更多关于这个架构的信息，请阅读原版指南，它非常棒。更详细地说:</a></p><ul class=""><li id="e943" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">我们的模型是 Char 级的；</li><li id="f394" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated">源词典包含俄语字母+英语+标点+特殊记号；</li><li id="81a6" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated">目标词典—仅俄语字母+标点符号。</li></ul><p id="4a10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你拥有的多样化和高质量的数据越多，你的模型训练得就越好——这是常识。如果你曾经试图为英语语言找到这样的数据，那么你知道这是非常简单的。此外，甚至还有数字规范化的开源解决方案。至于俄语，一切就更复杂了。</p><p id="3d4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，训练数据是以下各项的组合:</p><ul class=""><li id="ad35" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">开源规范化数据— <a class="ae lq" href="https://www.kaggle.com/c/text-normalization-challenge-russian-language/overview" rel="noopener ugc nofollow" target="_blank">俄语文本规范化</a> —大部分是书籍，部分用规则集规范化；</li><li id="e964" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated">使用我们的手动管道处理的随机网站的过滤<a class="ae lq" href="https://spark-in.me/post/parsing-common-crawl-in-four-simple-commands" rel="noopener ugc nofollow" target="_blank">数据；</a></li><li id="c68f" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated">一些使模型更加健壮的扩展——例如，任意位置的标点和空格、大写、长数字等。</li></ul><h1 id="b9b9" class="mc lw iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">火炬报</h1><p id="76cf" class="pw-post-body-paragraph jn jo iq jp b jq mz js jt ju na jw jx jy nb ka kb kc nc ke kf kg nd ki kj kk ij bi translated">除了解决这个问题，我们还想测试一些新的有趣的工具，比如 TorchScript。<br/> TorchScript 是 PyTorch 提供的一个很棒的工具，可以帮助你从 Python 中导出你的模型，甚至可以作为 C++程序独立运行。</p><p id="5220" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之，PyTorch 中有两种使用 TorchScript 的方式:</p><ol class=""><li id="1650" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk nl kr ks kt bi translated">硬核，那需要完全沉浸到 TorchScript 语言中，一切后果自负；</li><li id="ef00" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk nl kr ks kt bi translated">轻柔，使用开箱即用的<code class="fe ku kv kw kx b">torch.jit.script</code>(和<code class="fe ku kv kw kx b">torch.jit.trace</code>)工具。</li></ol><p id="a26e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实证明，对于比官方<a class="ae lq" href="https://pytorch.org/tutorials/beginner/Intro_to_TorchScript_tutorial.html" rel="noopener ugc nofollow" target="_blank">指南</a>中介绍的更复杂的模型，您必须重写几行代码。然而，这不是火箭科学，只需要一些小的改变:</p><ul class=""><li id="c46d" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">打字要多注意；</li><li id="6b8f" class="kl km iq jp b jq kz ju la jy lb kc lc kg ld kk kq kr ks kt bi translated">想办法重写不支持的函数和方法。</li></ul><p id="daec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有关更详细的指南，请查看<a class="ae lq" href="https://t.me/snakers4/2418" rel="noopener ugc nofollow" target="_blank"> a 通道柱</a>。</p><h1 id="fb55" class="mc lw iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">例子</h1><p id="f653" class="pw-post-body-paragraph jn jo iq jp b jq mz js jt ju na jw jx jy nb ka kb kc nc ke kf kg nd ki kj kk ij bi translated">综上所述，查看几个归一化结果。以下所有句子均取自测试数据集，即该模型未见过这些示例中的任何一个:</p><ul class=""><li id="b350" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated"><code class="fe ku kv kw kx b">norm.norm_string("Вторая по численности группа — фарсиваны — от 27 до 38 %.")</code></li></ul><p id="674e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ky">'вторая·численности·фарсиваны·двадцати·тридцативосьмипроцентов.'</em></p><ul class=""><li id="b009" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated"><code class="fe ku kv kw kx b">norm.norm_string("Висенте Каньяс родился 22 октября 1939 года")</code></li></ul><p id="f1a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ky">'висентеканьясродилсядвадцатьвторогооктябрятысячадевятьсоттридцатьдевятогогода'</em></p><ul class=""><li id="7cd2" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated"><code class="fe ku kv kw kx b">norm.norm_string("играет песня «The Crying Game»")</code></li></ul><p id="0c87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ky">песнязэ</em></p><ul class=""><li id="d480" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated"><code class="fe ku kv kw kx b">norm.norm_string("к началу XVIII века")</code></li></ul><p id="7b13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ky">‘началувосемнадцатоговека’</em></p><ul class=""><li id="032f" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated"><code class="fe ku kv kw kx b">norm.norm_string("и в 2012 году составляла 6,6 шекеля")</code></li></ul><p id="1436" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ky">тысячидвенадцатом·составлялашестьцелых·шестьдесятыхшекеля'</em></p></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><p id="b3c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ky">原载于 2020 年 3 月 4 日</em><a class="ae lq" href="https://spark-in.me/post/russian_text_normalization" rel="noopener ugc nofollow" target="_blank"><em class="ky">https://spark-in . me</em></a><em class="ky">。</em></p></div></div>    
</body>
</html>