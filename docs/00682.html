<html>
<head>
<title>Use Environment Variable in your next Golang Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在下一个 Golang 项目中使用环境变量</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/use-environment-variable-in-your-next-golang-project-39e17c3aaa66?source=collection_archive---------2-----------------------#2020-01-20">https://towardsdatascience.com/use-environment-variable-in-your-next-golang-project-39e17c3aaa66?source=collection_archive---------2-----------------------#2020-01-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="aea8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">golang 中有多种方法可以使用环境变量和文件。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1f65fa120eacaf4d88809b266b0c09a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qCEMqr6hnylxa0oB-2H_mw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@mojamsanii?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Moja Msanii </a>在<a class="ae kv" href="https://unsplash.com/s/photos/security?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="162f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当创建生产级应用程序时，在应用程序中使用环境变量是事实上的<em class="ls"/>。</p><blockquote class="lt lu lv"><p id="86e0" class="kw kx ls ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">也可以看 youtube 视频。</p></blockquote><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><h1 id="3950" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">我们为什么要使用环境变量？</h1><p id="3d6d" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">假设您有一个具有许多特性的应用程序，每个特性都需要访问数据库。您在每个特性中配置了所有的数据库信息，如<code class="fe my mz na nb b">DBURL</code>、<code class="fe my mz na nb b">DBNAME</code>、<code class="fe my mz na nb b">USERNAME</code>和<code class="fe my mz na nb b">PASSWORD</code>。</p><p id="75d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种方法有几个主要缺点，但也有很多。</p><h2 id="9c8e" class="nc mc iq bd md nd ne dn mh nf ng dp ml lf nh ni mn lj nj nk mp ln nl nm mr nn bi translated">安全问题:</h2><ul class=""><li id="e80a" class="no np iq ky b kz mt lc mu lf nq lj nr ln ns lr nt nu nv nw bi translated">你在输入密码中的所有信息。现在，所有未经授权的人也可以访问数据库。</li><li id="86ec" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">如果你使用的是代码版本控制工具<code class="fe my mz na nb b">git</code>，那么一旦你发布代码，你的数据库的细节就会公之于众。</li></ul><h2 id="50a5" class="nc mc iq bd md nd ne dn mh nf ng dp ml lf nh ni mn lj nj nk mp ln nl nm mr nn bi translated">代码管理:</h2><ul class=""><li id="afe7" class="no np iq ky b kz mt lc mu lf nq lj nr ln ns lr nt nu nv nw bi translated">如果你改变一个单一的变量，那么你必须改变所有的特征。很有可能你会错过一两个。😌去过那里</li><li id="7c8d" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">您可以对环境变量进行分类，如<code class="fe my mz na nb b">PROD</code>、<code class="fe my mz na nb b">DEV</code>或<code class="fe my mz na nb b">TEST</code>。只需给变量加上环境前缀。</li></ul><p id="cced" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始时，它可能看起来像一些额外的工作，但是这将在你的项目中奖励你很多。</p><blockquote class="oc"><p id="bde1" class="od oe iq bd of og oh oi oj ok ol lr dk translated">⚠️只是不要忘记在<code class="fe my mz na nb b"><strong class="ak">.gitignore</strong></code>中包含你的环境文件。</p></blockquote><p id="95a6" class="pw-post-body-paragraph kw kx iq ky b kz om jr lb lc on ju le lf oo lh li lj op ll lm ln oq lp lq lr ij bi translated">是采取行动的时候了。🔨</p><h2 id="c6e6" class="nc mc iq bd md nd ne dn mh nf ng dp ml lf nh ni mn lj nj nk mp ln nl nm mr nn bi translated">在这个教程中我们要做什么？</h2><p id="3479" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在本教程中，我们将以 3 种不同的方式访问环境变量。</p><p id="0fcc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以根据你的需要来使用它。</p><ul class=""><li id="3c09" class="no np iq ky b kz la lc ld lf or lj os ln ot lr nt nu nv nw bi translated"><code class="fe my mz na nb b">os</code>包装</li><li id="2605" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated"><code class="fe my mz na nb b">godotenv</code>包装</li><li id="9139" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated"><code class="fe my mz na nb b">viper</code>包装</li></ul></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><h1 id="5acd" class="mb mc iq bd md me pb mg mh mi pc mk ml jw pd jx mn jz pe ka mp kc pf kd mr ms bi translated">创建项目</h1><p id="2913" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在<code class="fe my mz na nb b"><strong class="ky ir">$GOPATH</strong></code>之外创建一个项目<code class="fe my mz na nb b"><strong class="ky ir">go-env-ways</strong></code>。</p><h1 id="71e5" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">初始化模块</h1><p id="a8c3" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">打开项目根目录下的终端，运行下面的命令。</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="bebb" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">go mod init goenv</strong></span></pre><p id="b84c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个模块将记录项目中使用的所有包及其版本。类似于<code class="fe my mz na nb b">nodejs</code>中的<code class="fe my mz na nb b">package.json</code>。</p></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><p id="add5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从最简单的开始，使用<code class="fe my mz na nb b">os</code>包。</p><h1 id="b78e" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">操作系统包</h1><p id="e40b" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">Golang 提供了<code class="fe my mz na nb b">os</code>包，这是一种配置和访问环境变量的简单方法。</p><p id="9d9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要设置环境变量，</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="b509" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">os.Setenv(key, value)</strong></span></pre><p id="65d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要获得环境变量，</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="6c12" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">value := os.Getenv(key)</strong></span></pre><p id="bc00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在项目中创建一个新文件<code class="fe my mz na nb b">main.go</code>。</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="4af5" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">package main</strong><br/><br/>import (<br/>  "fmt"<br/>  "os"<br/>)<br/><br/>// use os package to get the env variable which is already set<br/><strong class="nb ir">func envVariable(key string) string </strong>{<br/><br/>  // set env variable using os package<br/>  <strong class="nb ir">os.Setenv(key, "gopher")</strong><br/><br/>  // return the env variable using os package<br/>  <strong class="nb ir">return os.Getenv(key)</strong><br/>}<br/><br/><strong class="nb ir">func main() {</strong><br/>  // os package<br/> <strong class="nb ir"> value := envVariable("name")</strong><br/><br/>  <strong class="nb ir">fmt.Printf("os package: name = %s \n", value)</strong></span><span id="874e" class="nc mc iq nb b gy po pl l pm pn"><strong class="nb ir">  fmt.Printf("environment = %s \n", os.Getenv("APP_ENV"))</strong><br/>}</span></pre><p id="7160" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行以下命令进行检查。</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="9e26" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">APP_ENV=prod go run main.go</strong><br/><br/>// Output<br/><strong class="nb ir">os package: name = gopher<br/>environment = prod</strong></span></pre></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><h1 id="b817" class="mb mc iq bd md me pb mg mh mi pc mk ml jw pd jx mn jz pe ka mp kc pf kd mr ms bi translated">GoDotEnv 包</h1><p id="0293" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">加载<code class="fe my mz na nb b">.env</code>文件最简单的方法是使用<code class="fe my mz na nb b">godotenv</code>包。</p><h1 id="2815" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">安装</h1><p id="20c2" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在项目根目录下打开终端。</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="2c42" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">go get github.com/joho/godotenv</strong></span></pre><p id="4c98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe my mz na nb b">godotenv </code>提供了一个<code class="fe my mz na nb b">Load </code>方法来加载 env 文件。</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="ed90" class="nc mc iq nb b gy pk pl l pm pn">// Load the .env file in the current directory<br/><strong class="nb ir">godotenv.Load()</strong><br/><br/>// or<br/><br/><strong class="nb ir">godotenv.Load(".env")</strong></span></pre><blockquote class="lt lu lv"><p id="39ea" class="kw kx ls ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><em class="iq"> Load 方法可以一次加载多个 env 文件。这也支持</em> <code class="fe my mz na nb b"><em class="iq">yaml</em></code> <em class="iq">。更多信息请查看</em> <a class="ae kv" href="https://github.com/joho/godotenv" rel="noopener ugc nofollow" target="_blank"> <em class="iq">文档</em> </a> <em class="iq">。</em></p></blockquote><p id="90a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在项目根目录下创建一个新的<code class="fe my mz na nb b">.env</code>文件。</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="c0f3" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">STRONGEST_AVENGER=Thor</strong></span></pre><p id="e805" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更新<code class="fe my mz na nb b">main.go</code>。</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="e11b" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">package main</strong><br/><br/>import (<br/><br/>    ...<br/>    // Import godotenv<br/>  <strong class="nb ir">"github.com/joho/godotenv"</strong><br/>)<br/><br/><br/>// use godot package to load/read the .env file and<br/>// return the value of the key<br/><strong class="nb ir">func goDotEnvVariable(key string) string {</strong><br/><br/>  // load .env file<br/>  <strong class="nb ir">err := godotenv.Load(".env")</strong><br/><br/>  if err != nil {<br/>    log.Fatalf("Error loading .env file")<br/>  }<br/><br/>  <strong class="nb ir">return os.Getenv(key)</strong><br/>}<br/><br/><strong class="nb ir">func main() {</strong><br/>    // os package<br/>    ... <br/><br/>  // godotenv package<br/>  <strong class="nb ir">dotenv := goDotEnvVariable("STRONGEST_AVENGER")</strong><br/><br/>  fmt.Printf("godotenv : %s = %s \n", "STRONGEST_AVENGER", dotenv)<br/>}</span></pre><p id="8ead" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开终端并运行<code class="fe my mz na nb b">main.go</code>。</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="a8a9" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">go run main.go</strong><br/><br/>// Output<br/><strong class="nb ir">os package: name = gopher</strong><br/><br/><strong class="nb ir">godotenv : STRONGEST_AVENGER = Thor</strong></span></pre><blockquote class="lt lu lv"><p id="ced7" class="kw kx ls ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">只需在主函数中添加 os 包末尾的代码即可。</p></blockquote></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><h1 id="0519" class="mb mc iq bd md me pb mg mh mi pc mk ml jw pd jx mn jz pe ka mp kc pf kd mr ms bi translated">毒蛇包装</h1><p id="766d" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">Viper 是 golang 社区中最受欢迎的软件包之一。许多围棋项目都是使用 Viper 构建的，包括 Hugo、Docker 公证人、Mercury。</p><blockquote class="oc"><p id="56ac" class="od oe iq bd of og oh oi oj ok ol lr dk translated"><em class="pp">毒蛇🐍是 Go 应用的完整配置解决方案，包括 12 因素应用。它设计用于在应用程序中工作，可以处理所有类型的配置需求和格式。读取 JSON、TOML、YAML、HCL、envfile 和 Java 属性配置文件</em></p><p id="6cd0" class="od oe iq bd of og oh oi oj ok ol lr dk translated">更多信息请阅读<a class="ae kv" href="https://github.com/spf13/viper" rel="noopener ugc nofollow" target="_blank">蝰蛇</a>的官方文档</p></blockquote><h1 id="a783" class="mb mc iq bd md me mf mg mh mi mj mk ml jw pq jx mn jz pr ka mp kc ps kd mr ms bi translated">安装</h1><p id="dd6f" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在项目根目录下打开终端。</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="299e" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">go get github.com/spf13/viper</strong></span></pre><p id="e1a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要设置配置文件和路径</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="799b" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">viper.SetConfigFile(".env")</strong></span></pre><p id="c33f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要读取配置文件</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="0102" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">viper.ReadInConfig()</strong></span></pre><p id="aacb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用键从配置文件中获取值</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="24b1" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">viper.Get(key)</strong></span></pre><p id="3f3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更新<code class="fe my mz na nb b">main.go</code>。</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="6b3d" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">import </strong>(<br/>  "fmt"<br/>  "log"<br/>  "os"<br/><br/>  "github.com/joho/godotenv"<br/>  <strong class="nb ir">"github.com/spf13/viper"</strong><br/>)<br/><br/>// use viper package to read .env file<br/>// return the value of the key<br/><strong class="nb ir">func viperEnvVariable(key string) string {</strong><br/><br/>  // SetConfigFile explicitly defines the path, name and extension of the config file.<br/>  // Viper will use this and not check any of the config paths.<br/>  // .env - It will search for the .env file in the current directory<br/>  <strong class="nb ir">viper.SetConfigFile(".env")<br/></strong><br/>  // Find and read the config file<br/>  <strong class="nb ir">err := viper.ReadInConfig()</strong><br/><br/>  if err != nil {<br/>    log.Fatalf("Error while reading config file %s", err)<br/>  }<br/><br/>  // viper.Get() returns an empty interface{}<br/>  // to get the underlying type of the key,<br/>  // we have to do the type assertion, we know the underlying value is string<br/>  // if we type assert to other type it will throw an error<br/>  <strong class="nb ir">value, ok := viper.Get(key).(string)</strong><br/><br/>  // If the type is a string then ok will be true<br/>  // ok will make sure the program not break<br/>  if !ok {<br/>    log.Fatalf("Invalid type assertion")<br/>  }<br/><br/> <strong class="nb ir"> return value</strong><br/>}<br/><br/><strong class="nb ir">func main() {</strong><br/><br/>    // os package  <br/>    ...<br/>  <br/>  // godotenv package<br/>  ...<br/><br/>  // viper package read .env<br/> <strong class="nb ir"> viperenv := viperEnvVariable("STRONGEST_AVENGER")</strong><br/><br/>  fmt.Printf("viper : %s = %s \n", "STRONGEST_AVENGER", viperenv)<br/>}</span></pre><p id="057f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开终端并运行<code class="fe my mz na nb b">main.go</code>。</p></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><h1 id="30c1" class="mb mc iq bd md me pb mg mh mi pc mk ml jw pd jx mn jz pe ka mp kc pf kd mr ms bi translated">毒蛇不仅限于。环境文件。</h1><p id="51a9" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">它支持:</p><ul class=""><li id="9b5c" class="no np iq ky b kz la lc ld lf or lj os ln ot lr nt nu nv nw bi translated">设置默认值</li><li id="f837" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">读取 JSON、TOML、YAML、HCL、envfile 和 Java 属性配置文件</li><li id="e51c" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">实时观察和重读配置文件(可选)</li><li id="a4ac" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">从环境变量中读取</li><li id="bca3" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">从远程配置系统(etcd 或 Consul)读取，并观察变化</li><li id="64bc" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">从命令行标志中读取</li><li id="dd10" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">从缓冲区读取</li><li id="bb8a" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">设置显式值</li></ul><p id="25ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Viper 可以被看作是满足应用程序所有配置需求的注册表。</p><p id="e48d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们实验一下:💣</p><p id="70e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在项目根目录下创建一个新的<code class="fe my mz na nb b">config.yaml</code>文件。</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="83c7" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">I_AM_INEVITABLE: "I am Iron Man"</strong></span></pre><p id="a476" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要设置配置文件名</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="e957" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">viper.SetConfigName("config")</strong></span></pre><p id="b3ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要设置配置文件路径</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="6ab0" class="nc mc iq nb b gy pk pl l pm pn">// Look in the current working directory <br/><strong class="nb ir">viper.AddConfigPath(".")</strong></span></pre><p id="37bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要读取配置文件</p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="a219" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">viper.ReadInConfig()</strong></span></pre><p id="515f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更新<code class="fe my mz na nb b"><strong class="ky ir">main.go</strong></code></p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="89e1" class="nc mc iq nb b gy pk pl l pm pn">// use viper package to load/read the config file or .env file and<br/>// return the value of the key<br/><strong class="nb ir">func viperConfigVariable(key string) string </strong>{<br/><br/>  // name of config file (without extension)<br/>  <strong class="nb ir">viper.SetConfigName("config")</strong><br/>  // look for config in the working directory<br/> <strong class="nb ir"> viper.AddConfigPath(".")</strong><br/><br/>  // Find and read the config file<br/>  <strong class="nb ir">err := viper.ReadInConfig()</strong><br/><br/>  if err != nil {<br/>    log.Fatalf("Error while reading config file %s", err)<br/>  }<br/><br/>  // viper.Get() returns an empty interface{}<br/>  // to get the underlying type of the key,<br/>  // we have to do the type assertion, we know the underlying value is string<br/>  // if we type assert to other type it will throw an error<br/>  <strong class="nb ir">value, ok := viper.Get(key).(string)</strong><br/><br/>  // If the type is a string then ok will be true<br/>  // ok will make sure the program not break<br/>  if !ok {<br/>    log.Fatalf("Invalid type assertion")<br/>  }<br/><br/> <strong class="nb ir"> return value</strong><br/>}<br/><br/><strong class="nb ir">func main() </strong>{<br/><br/>  // os package<br/>  ...<br/><br/>  // godotenv package<br/>  ...<br/><br/>  // viper package read .env<br/>  ...<br/><br/>  // viper package read config file<br/>  <strong class="nb ir">viperconfig := viperConfigVariable("I_AM_INEVITABLE")</strong>  <br/>  <br/>  fmt.Printf("viper config : %s = %s \n", "I_AM_INEVITABLE", viperconfig)  <br/>}</span></pre><p id="0dce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开终端并运行<code class="fe my mz na nb b">main.go</code></p><pre class="kg kh ki kj gt pg nb ph pi aw pj bi"><span id="8884" class="nc mc iq nb b gy pk pl l pm pn"><strong class="nb ir">go run main.go</strong><br/><br/>// Output<br/><strong class="nb ir">os package: name = gopher</strong><br/><br/><strong class="nb ir">godotenv : STRONGEST_AVENGER = Thor<br/><br/>viper : STRONGEST_AVENGER = Thor<br/><br/>viper config : I_AM_INEVITABLE = I am Iron Man</strong></span></pre></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><h1 id="32fb" class="mb mc iq bd md me pb mg mh mi pc mk ml jw pd jx mn jz pe ka mp kc pf kd mr ms bi translated">结论</h1><p id="f49e" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">就这样，现在你可以探索他们更多的秘密了🔐。如果你发现一些值得分享的东西，不要犹豫😉。</p><p id="ad13" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完整的代码可以在<a class="ae kv" href="https://github.com/schadokar/blog-projects/tree/go-env-ways" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div></div>    
</body>
</html>