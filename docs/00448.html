<html>
<head>
<title>Tracking Monster Jobs with tqdm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用tqdm跟踪大型作业</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tracking-monster-jobs-with-tqdm-7a8a9856aff0?source=collection_archive---------34-----------------------#2020-01-13">https://towardsdatascience.com/tracking-monster-jobs-with-tqdm-7a8a9856aff0?source=collection_archive---------34-----------------------#2020-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="afa8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">TQDM是Python的一个易于使用、可扩展的进度条包。这篇短文给了你一些有用的例子来帮助你开始。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fbdf1a756d00c6aaecaafd26145d60bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vDcD_MCw65prGFVu1qNMDQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Unsplash上的Volodymyr Hryshchenko</p></figure><h1 id="6158" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">追踪你的进度</h1><p id="4836" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">你真的无法击败一个伟大的，高质量的小包装，使你更有生产力。<code class="fe mk ml mm mn b">tqdm</code>就是这样一个包。这是一个易于使用、可扩展的进度条Python包，使得向Python进程添加简单的进度条变得极其容易。如果你是一名专业的数据科学家或机器学习(ML)工程师，你可能已经使用或开发了算法或数据转换，这可能需要相当长的时间——可能需要几个小时甚至几天——才能完成。</p><p id="c0bf" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">对于人们来说，选择简单地将状态消息打印到控制台并不罕见，或者在一些稍微复杂一些的情况下，使用(优秀的和推荐的)内置<code class="fe mk ml mm mn b">logging</code>模块。在很多情况下，这是好的。然而，如果您正在运行一个有数百个步骤的任务(例如，训练时期)，或者运行一个有数百万个元素的数据结构，这些方法有时会有点不清楚和冗长，坦率地说有点难看。另外，在你的代码中加入一些“开发者体验”的东西(比如进度条！)也可以让你的代码<a class="ae kv" href="https://www.bbc.com/future/article/20191205-why-progress-bars-can-make-you-feel-better" rel="noopener ugc nofollow" target="_blank">更加用户友好</a>。</p><h1 id="ef28" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">给我看看代码！</h1><p id="4fc4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这就是<code class="fe mk ml mm mn b">tqdm</code>的用武之地。它有一个漂亮干净的API，可以让你快速地在代码中添加进度条。此外，它还有一个轻量级的“剩余时间”估计算法内置在进度条中。在一些ML包中使用了<code class="fe mk ml mm mn b">tqdm</code>包，其中最突出的可能是<code class="fe mk ml mm mn b">implicit</code>，一个Python <a class="ae kv" href="https://github.com/benfred/implicit" rel="noopener ugc nofollow" target="_blank">隐式矩阵分解库</a>。在这篇文章中，我们来看看下面这个使用<code class="fe mk ml mm mn b">tqdm</code>的模拟“训练循环”的例子:</p><pre class="kg kh ki kj gt mt mn mu mv aw mw bi"><span id="7d60" class="mx kx iq mn b gy my mz l na nb">import time <br/>from tqdm import tqdm </span><span id="65e2" class="mx kx iq mn b gy nc mz l na nb">with tqdm(total=100) as progress: <br/>    for i in range(100): <br/>        time.sleep(0.25) <br/>        progress.update(1)</span></pre><p id="14fb" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在这个简单的例子中，您设置了一个<code class="fe mk ml mm mn b">tqdm</code>进度条，该进度条预计包含100个步骤。然后，您可以运行循环(步骤之间有0.25秒的停顿)，每次在步骤完成时更新进度条。如果你也跳出了循环，你也可以任意数量的更新进度条。这是两行代码(加上import语句),可以在代码中得到一个很酷的小进度条。以下是您得到的结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/b058c1798d906f80128e3a427492b805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_bDhdow7aJIelVVfyLCBQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一个简单的<strong class="bd ne"> tqdm </strong>进度条！Mark Douthwaite截图</p></figure><h1 id="99ca" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">熊猫集成</h1><p id="3cf9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">除了给你的程序输出添加一些很酷的小东西之外，<code class="fe mk ml mm mn b">tqdm</code>还可以很好地与其他广泛使用的软件包集成。对于数据科学家来说，最有趣的集成可能是Pandas，无处不在的Python数据分析库。看看下面的例子:</p><pre class="kg kh ki kj gt mt mn mu mv aw mw bi"><span id="05a8" class="mx kx iq mn b gy my mz l na nb">df = pd.read_csv("weather.csv") <br/>tqdm.pandas(desc="Applying Transformation") <br/>df.progress_apply(lambda x: x)</span></pre><p id="eefa" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">从技术上讲，<code class="fe mk ml mm mn b">tqdm.pandas</code>方法猴子将<code class="fe mk ml mm mn b">progress_apply</code>方法修补到熊猫的数据结构上，给它们一个常用的<code class="fe mk ml mm mn b">apply</code>方法的修改版本。实际上，当我们调用<code class="fe mk ml mm mn b">progress_apply</code>方法时，这个包用一个<code class="fe mk ml mm mn b">tqdm</code>进度条包装了标准的Pandas <code class="fe mk ml mm mn b">apply</code>方法。当您处理大型数据帧时，这非常方便！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/9a09f07e23ee4a2bd0fbc9d3eea64b12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*En87afF7f6ukhwDTrbrptw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一个进度条的例子，由Mark Douthwaite截图的<code class="fe mk ml mm mn b"><strong class="bd ne">tqdm</strong></code>与<code class="fe mk ml mm mn b">pandas. </code>的集成生成</p></figure><h1 id="f0c3" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">平行过程</h1><p id="8341" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这里还有另一个值得一提的常见应用:<code class="fe mk ml mm mn b">tqdm</code>对于设置跟踪并行进程的进度条也很有用。下面是一个使用一些<code class="fe mk ml mm mn b">tqdm</code>内置支持更新平行贴图进度条的例子:</p><pre class="kg kh ki kj gt mt mn mu mv aw mw bi"><span id="29b8" class="mx kx iq mn b gy my mz l na nb">import time <br/>from tqdm.contrib.concurrent import process_map </span><span id="f9fc" class="mx kx iq mn b gy nc mz l na nb">def my_process(_): <br/>    time.sleep(0.25) <br/>    r = process_map(my_process, range(0, 100), max_workers=2, desc="MyProcess")</span></pre><p id="92e8" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在这种情况下，在每个子流程中，每次<code class="fe mk ml mm mn b">my_process</code>调用完成<em class="ng">时，都会有一个进度条更新。不过还有第二个用例:如果您有许多长时间运行的流程，并且希望单独跟踪它们，该怎么办？例如，如果您想避免在进程中序列化和反序列化大型对象，这可能更好。你也可以这样做:</em></p><pre class="kg kh ki kj gt mt mn mu mv aw mw bi"><span id="8cd0" class="mx kx iq mn b gy my mz l na nb">import time <br/>import multiprocessing as mp <br/>from tqdm import tqdm </span><span id="3a23" class="mx kx iq mn b gy nc mz l na nb">def my_process(pos): <br/>    _process = mp.current_process() <br/>    with tqdm(desc=f"Process {pos}", total=100, position=pos) as progress: <br/>        for _ in range(100): <br/>            time.sleep(0.1) <br/>            progress.update(1) </span><span id="baaf" class="mx kx iq mn b gy nc mz l na nb">n_cpu = mp.cpu_count()</span><span id="7d96" class="mx kx iq mn b gy nc mz l na nb">with mp.Pool(processes=n_cpu, initializer=tqdm.set_lock, initargs=(tqdm.get_lock(),)) as pool: <br/>    pool.map(my_process, range(n_cpu))</span></pre><p id="a785" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">这将为您提供类似以下内容的输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/9c453ede10e05385e3af17196e358beb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sC7cIwQ6HOas9dVz.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一个进度条同时跟踪8个任务的例子。Mark Douthwaite截图</p></figure><p id="80cd" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">还有一个要点<a class="ae kv" href="https://gist.github.com/markdouthwaite/4a33bf92d5ffdf264d7ee5938a31d84b" rel="noopener ugc nofollow" target="_blank">这个例子</a>你也可以用:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一些示例代码，只给你！💛</p></figure><h1 id="7713" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">还有一点</h1><p id="b062" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">另外，<code class="fe mk ml mm mn b">tqdm</code>在Jupyter笔记本中运行<a class="ae kv" href="https://tqdm.github.io/docs/notebook/" rel="noopener ugc nofollow" target="_blank">时，提供了对进度条的支持，作为格式良好的小部件。例如，在笔记本中运行以下代码:</a></p><pre class="kg kh ki kj gt mt mn mu mv aw mw bi"><span id="b034" class="mx kx iq mn b gy my mz l na nb">import time<br/>from tqdm.notebook import tnrange, tqdm</span><span id="8d79" class="mx kx iq mn b gy nc mz l na nb">for i in tnrange(10):<br/>    time.sleep(0.1)</span></pre><p id="ace5" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">会产生以下结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/696b9046c2ffb9de71461c7cc065268f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aU5B-Hzo09z4QsGQ9G1TfQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Jupyter的进度条！Mark Douthwaite截图</p></figure><p id="f595" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">您可能会注意到您在这里重新导入了<code class="fe mk ml mm mn b">tqdm</code>。当您想要直接使用<code class="fe mk ml mm mn b">tqdm</code>对象时，您应该以这种方式导入<code class="fe mk ml mm mn b">tqdm</code>(如上例所示)。您应该能够直接放下上面的示例片段，并立即获得好看的进度条。哦，请确保从示例中删除<code class="fe mk ml mm mn b">time.sleep</code>行！</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="a156" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated"><em class="ng">原载于</em><a class="ae kv" href="https://mark.douthwaite.io/monster-jobs-with-tqdm/" rel="noopener ugc nofollow" target="_blank"><em class="ng">https://mark . douthwaite . io</em></a><em class="ng">。</em></p></div></div>    
</body>
</html>