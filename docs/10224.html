<html>
<head>
<title>How to Collect Song Lyrics with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 收集歌词</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/song-lyrics-genius-api-dcc2819c29?source=collection_archive---------11-----------------------#2020-07-19">https://towardsdatascience.com/song-lyrics-genius-api-dcc2819c29?source=collection_archive---------11-----------------------#2020-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2179" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一种创建用于训练生成语言模型的歌词数据集的简单方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e406d5f316bbb6cdcc55541719f467d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yILTzeXqwSMKJDlTIhTM-A.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Brandon Erlinger-Ford 在<a class="ae kv" href="https://unsplash.com/s/photos/music-artists?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="4170" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">简介</strong></h2><p id="ff14" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">为语言模型训练和微调构建数据集可能非常繁琐。当我试图收集一个对话文本数据集和一个小众歌词数据集时，我学到了这一点，这两个数据集都是为了训练一个单独的<a class="ae kv" href="https://openai.com/blog/better-language-models/" rel="noopener ugc nofollow" target="_blank"> GPT-2 </a>模型。经过几个小时的半自动刮擦和人工清理，我才碰到了<a class="ae kv" href="https://genius.com/Genius-about-genius-annotated" rel="noopener ugc nofollow" target="_blank"> Genius </a>和它的<a class="ae kv" href="https://docs.genius.com" rel="noopener ugc nofollow" target="_blank"> API </a>。这真是天赐良机。它不仅易于安装和使用，而且还拥有大量不一定家喻户晓的艺术家。这使得它成为创建主流和小众歌词数据集的绝佳选择。当与<a class="ae kv" href="https://github.com/johnwmillr/LyricsGenius" rel="noopener ugc nofollow" target="_blank"> lyricsgenius </a>堆叠在一起时，这个过程变得更加轻松，lyricsgenius 是由<a class="ae kv" href="https://github.com/johnwmillr" rel="noopener ugc nofollow" target="_blank"> John Miller </a>创建的一个包，它大大简化了过滤由 Genius API 检索的数据的任务。</p><p id="da91" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">这篇文章将围绕为生成式语言模型(如 GPT)构建训练数据集的用例展开。明确地说，这将不包括实际构建模型的步骤。我们将逐步完成设置 API 客户端的过程，然后编写一个函数来获取<strong class="lu ir"> <em class="mq"> k </em> </strong>歌曲的歌词并将歌词保存到一个. txt 文件中。</p><h2 id="f402" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">设置 API 客户端</h2><ol class=""><li id="7c63" class="mr ms iq lu b lv lw ly lz lf mt lj mu ln mv mk mw mx my mz bi translated">查看<a class="ae kv" href="https://docs.genius.com/" rel="noopener ugc nofollow" target="_blank"> API 文件页面</a>。</li><li id="0611" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">查看<a class="ae kv" href="https://genius.com/static/terms" rel="noopener ugc nofollow" target="_blank"> API 服务条款</a>。</li><li id="18a5" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">在文档页面，点击<em class="mq"> API 客户端管理页面</em>导航到<a class="ae kv" href="https://genius.com/signup_or_login" rel="noopener ugc nofollow" target="_blank">注册/登录页面</a>。</li><li id="731b" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">使用您选择的注册或登录(如果您有帐户)方法完成表格，然后单击<em class="mq">创建帐户</em>。这应该会把你带到你的<em class="mq"> API 客户端</em>页面，或者让你重新回到主页。如果您返回到主页，向下滚动到页面页脚并点击<em class="mq">开发者</em>。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/fc940964527f10f0b2a41887f9535cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l_NsUERcW1sJa_5IbOCLFA.png"/></div></div></figure><p id="a17e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">5.一旦进入 API 客户端页面，点击<em class="mq">创建 API 客户端</em>(在 Safari 上)或<em class="mq">新建 API 客户端</em>(在 Chrome 上)来创建你的应用。在这种情况下，术语“应用程序”是指 Genius API 的使用。只有下面截图中的<em class="mq">应用程序名称</em>和<em class="mq">应用程序网站 URL </em>字段是继续的必要条件。我们将主要使用应用程序名称来识别这个单独的客户端(您可以创建几个 API 客户端)。我通常默认使用我的 Github 来满足大多数网站的需求，但任何网站都应该适合 URL 字段。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/0a111b357cca38ba7363c043ad0ce205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EE2pgm_APpCfY3BEkpLLEA.png"/></div></div></figure><p id="68d4" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">6.点击<em class="mq">保存</em>将带您进入凭证页面，该页面应类似于下面的屏幕截图。如果您已经创建了多个 API 客户端，它们都会显示在这里。稍后，我们将回到这个页面，查看客户端访问令牌。恭喜你，你已经完成了注册过程！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/6e48ee20c93878268adf97de9224f5f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OO5DNokn9JCC6WvkKMbdkw.png"/></div></div></figure><h2 id="e411" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">安装 LyricsGenius</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/81e4eef78a5f24214d771210eed4feaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KWtOTCKrqkz00KDjOsLMlQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自<a class="ae kv" href="https://github.com/johnwmillr/LyricsGenius" rel="noopener ugc nofollow" target="_blank">https://github.com/johnwmillr/LyricsGenius</a></p></figure><p id="519d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">可以使用<em class="mq"> pip install lyricsgenius </em>从<a class="ae kv" href="https://pypi.org/project/lyricsgenius/" rel="noopener ugc nofollow" target="_blank"> PyPI </a>安装 Lyricsgenius，或者使用<em class="mq">pip install git+https://Github . com/johnwmillr/lyricsgenius . git</em>从<a class="ae kv" href="https://github.com/johnwmillr/LyricsGenius" rel="noopener ugc nofollow" target="_blank"> Github </a>安装 lyrics genius。</p><h2 id="b943" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">代码(最终)</h2><p id="d196" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">我们首先从导入 lyricsgenius 开始。</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="920b" class="kw kx iq nk b gy no np l nq nr">import lyricsgenius as lg</span></pre><p id="d051" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">我们还需要为我们想要写入歌词的文件的路径创建一个变量。在这个例子中。txt 文件命名为<strong class="lu ir"> <em class="mq"> auto_。txt </em> </strong>。</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="6c7c" class="kw kx iq nk b gy no np l nq nr">file = open("/Users/User/Desktop/auto_.txt", "w")</span></pre><p id="b83a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">终于到了使用我们的 API 客户端凭证的时候了。导航回您的 API 客户端页面，然后单击生成访问令牌。</p><p id="7738" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">这个令牌将被传递给<strong class="lu ir"><em class="mq">lyricsgius。Genius() </em> </strong>连同我们要用来过滤文本数据的参数。在过滤方面，我们将忽略非官方歌曲的歌词，忽略现场表演和混音。将<strong class="lu ir"><em class="mq">remove _ section _ headers</em></strong>设置为<strong class="lu ir"> <em class="mq"> True </em> </strong>也是一个好主意，假设我们希望我们的数据集只关注口语歌词，并排除歌曲元数据。</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="e826" class="kw kx iq nk b gy no np l nq nr">genius = lg.Genius('Client_Access_Token_Goes_Here', skip_non_songs=True, excluded_terms=["(Remix)", "(Live)"], remove_section_headers=True)</span></pre><p id="5fbd" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">最后，让我们编写一个名为<strong class="lu ir"> <em class="mq"> get_lyrics() </em> </strong>的函数，该函数将艺术家姓名列表和我们希望为每个艺术家获取的歌曲数量<strong class="lu ir"> <em class="mq"> k </em> </strong>作为参数。该功能将打印收集的每首歌曲的名称和每个艺术家成功抓取的歌曲总数，然后将歌词写入我们的。txt 文件。</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="a6e2" class="kw kx iq nk b gy no np l nq nr">def get_lyrics(arr, k):<br/>    c = 0<br/>    for name in arr:<br/>        try:<br/>            songs = (genius.search_artist(name, max_songs=k, sort='popularity')).songs<br/>            s = [song.lyrics for song in songs]<br/>            file.write("\n \n   &lt;|endoftext|&gt;   \n \n".join(s))<br/>            c += 1<br/>            print(f"Songs grabbed:{len(s)}")<br/>        except:<br/>            print(f"some exception at {name}: {c}")</span></pre><p id="3813" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">我们来分解一下逻辑。</p><ol class=""><li id="9494" class="mr ms iq lu b lv ml ly mm lf ns lj nt ln nu mk mw mx my mz bi translated">设置一个计数器<strong class="lu ir"> <em class="mq"> c </em> </strong>用来记录写入的歌词的组数。txt 文件。</li><li id="408e" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">循环浏览姓名列表<strong class="lu ir"> <em class="mq"> arr </em> </strong>。</li><li id="b5f9" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">创建一个<strong class="lu ir"> <em class="mq">试</em> </strong>块。</li><li id="b2fe" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">把<strong class="lu ir"> <em class="mq"> </em> </strong>的名字传给<strong class="lu ir"> <em class="mq">的抒情天才。genius . search _ artist()</em></strong>连同<strong class="lu ir"> <em class="mq"> </em> </strong>我们想要的歌曲数量<strong class="lu ir"> <em class="mq"> k </em> </strong>并按照<strong class="lu ir"> <em class="mq">流行度</em> </strong>对歌曲进行排序，以便首先抓取每个艺术家最流行的歌曲(当然是达到我们的限制<strong class="lu ir"> <em class="mq"> k </em> </strong>)。这会给我们一个名为<strong class="lu ir"> <em class="mq">歌曲</em> </strong>的歌名列表。</li><li id="509c" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">通过<strong class="lu ir"> <em class="mq">歌曲</em> </strong>列表理解循环，将每首歌曲的歌词<strong class="lu ir"> <em class="mq"> song.lyrics </em> </strong>添加到新列表<strong class="lu ir"> <em class="mq"> s </em> </strong>。</li><li id="215a" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">调用<strong class="lu ir"> <em class="mq"> file.write() </em> </strong>并传递<strong class="lu ir"> <em class="mq">“。join(s) </em> </strong>将字符串列表压缩成一个字符串，并将新生成的字符串(代表抓取的所有歌词)写入。txt 文件。除了联合反对<strong class="lu ir"><em class="mq">"</em></strong>，我们还可以联合反对一个更明显的分隔符，如<strong class="lu ir"><em class="mq">" \ n \ n&lt;| endoftext |&gt;\ n \ n "</em></strong>，这将使阅读文本文件变得容易得多，因为每一组单曲歌词都将由该分隔符接续。另外，<a class="ae kv" href="https://git.scc.kit.edu/debatelab/gpt-2/commit/1e32b10ac456cb70331ccd3dff83437a7e33836d" rel="noopener ugc nofollow" target="_blank">分隔符在为一些语言模型</a>构建数据集时非常有用，可以帮助模型理解单个文本样本何时结束。</li><li id="bf46" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">将<strong class="lu ir"> <em class="mq"> c </em> </strong>增加 1。</li><li id="efdf" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">打印通用成功消息以及收集的歌曲数量<strong class="lu ir"><em class="mq">【len(s)】</em></strong>。</li><li id="74f1" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">创建除和块之外的<strong class="lu ir">和<em class="mq">。</em></strong></li><li id="dc99" class="mr ms iq lu b lv na ly nb lf nc lj nd ln ne mk mw mx my mz bi translated">打印通用异常消息以及引发异常的艺术家姓名和<strong class="lu ir"> <em class="mq"> c </em> </strong>。</li></ol><p id="fae8" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/6d039067421325f03e135db4316da72f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*DmQdNA7oL4QWV_n1NC7U9Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">运行<strong class="bd nw"> get_lyrics(['Logic '，' Frank Sinatra '，' Rihanna']，3) </strong>时打印输出。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/c73a80fe07e15cdc02faca2e44c5e7d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_GEWSo671JQ1yGkqFpLkRA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">的示例。运行<strong class="bd nw">时的 txt 输出 get_lyrics(['Logic '，' Frank Sinatra '，' Rihanna']，3) </strong>。</p></figure><h2 id="e8d5" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">流程改进</strong></h2><p id="e821" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">一个明显需要改进的地方是我们的流程对传递给<strong class="lu ir"> <em class="mq"> lyricsgenius 的艺术家姓名集合的依赖。Genius.search_artist() </em> </strong>。手动创建艺术家姓名列表肯定是不可伸缩的。在我们的例子中，我们只使用了三个艺术家，但是为了建立一个足够大的数据集来微调生产级别的模型，我们理想的是需要几十个艺术家和一个高得多的<strong class="lu ir"> k </strong>变量。</p><p id="4df4" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">该解决方案自动执行创建艺术家列表的任务；一种方法是使用<a class="ae kv" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank"> bs4 </a>从两个来源中的一个获取名称。<a class="ae kv" href="https://en.wikipedia.org/wiki/Lists_of_musicians" rel="noopener ugc nofollow" target="_blank">维基百科提供了几个基于音乐流派的音乐家名单</a>，可能是获取这些艺术家名字的一个伟大的单一来源。</p><h2 id="dbfe" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h2><p id="1123" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">由于 Genius 团队和 John Miller 的努力，曾经困难而复杂的流程现在变得顺畅而简化。</p><p id="7dac" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">下面是我在上面使用的所有代码，用于连接到 API 并将歌词写到。txt 文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="5049" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">非常感谢你让我分享，以后还会有更多。😃</p></div></div>    
</body>
</html>