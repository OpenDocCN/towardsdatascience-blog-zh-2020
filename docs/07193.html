<html>
<head>
<title>Building an Automated Machine Learning Pipeline: Part Three</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建自动化机器学习管道:第三部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-an-automated-machine-learning-pipeline-a74acda76b98?source=collection_archive---------56-----------------------#2020-06-01">https://towardsdatascience.com/building-an-automated-machine-learning-pipeline-a74acda76b98?source=collection_archive---------56-----------------------#2020-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="1f22" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" rel="noopener" target="_blank" href="https://towardsdatascience.com/machine-learning/home">机器学习</a></h2><div class=""/><div class=""><h2 id="25cd" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">训练和评估模型，解释模型结果和最终结论</h2></div><ul class=""><li id="d27d" class="kr ks it kt b ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/building-an-automated-machine-learning-pipeline-part-one-5c70ae682f35?source=friends_link&amp;sk=8de05327eedb3d0dadcfa4b1a8e8cc75">第1部分:理解、清理、探索、处理数据</a></li><li id="eb2d" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le lf lg lh li bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/building-an-automated-machine-learning-pipeline-part-two-1d3c86e6fe42?source=friends_link&amp;sk=a005d5ead7a844adb7819403ddc6dc0e">第2部分:设置指标和基线，选择和调整模型</a></li><li id="e8fb" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le lf lg lh li bi translated">第三部分:训练、评估和解释模型(你现在正在阅读)</li><li id="f8db" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le lf lg lh li bi translated">第4部分:使用Docker和Luigi自动化您的管道。)</li></ul><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/48c936bc0d59e985329266f3c44672e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AHf0EoED5zbb41ZS"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated"><a class="ae lj" href="https://unsplash.com/@davadventurelife?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> David Espina </a>在<a class="ae lj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="64d8" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">在这个系列文章中，我们将我们的课程设置为构建一个9步机器学习(ML)管道，并使用<a class="ae lj" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>和<a class="ae lj" href="https://luigi.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> Luigi </a>来自动化它——只剩下一步了😉。我们将最终组装这些步骤，以便它可以在任何生产系统上运行，而不需要专门的配置和设置。</p><p id="7cb1" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">我们遵循直观的ML管道来构建葡萄酒评级预测器:</p><ol class=""><li id="8a50" class="kr ks it kt b ku kv kw kx ky kz la lb lc ld le ms lg lh li bi translated">理解、清理和格式化数据</li><li id="3321" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">探索性数据分析</li><li id="0547" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">特征工程和预处理</li><li id="5f97" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">设置评估指标并建立基线</li><li id="7efb" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">基于评估度量选择ML模型</li><li id="92eb" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">对所选模型执行超参数调整</li><li id="3e45" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">训练和评估模型</li><li id="aaad" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">解释模型预测</li><li id="2429" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">得出结论并记录工作</li></ol><p id="172f" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">这个问题本身是一个监督回归问题，因为我们试图使用定义的特征集来确定<em class="mt">点</em>(目标变量)。<em class="mt">点</em>是一个介于80和100之间的数字，表示葡萄酒的质量。</p><p id="6fb9" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">我们的原始数据看起来像这样:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mu"><img src="../Images/f716ddbfc9281fc3eb69f9b44f3d5668.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulOsYIFnLMC16rzqLQtaVw.png"/></div></div></figure><p id="ae87" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">我们从阐述业务问题和解释我们的目标开始:</p><blockquote class="mv"><p id="154f" class="mw mx it bd my mz na nb nc nd ne le dk translated">该项目的目标是使用样本数据集建立一个葡萄酒评级预测器，以显示良好的预测是可能的，也许是作为一个更大项目的概念证明。</p></blockquote><p id="5d6f" class="pw-post-body-paragraph mf mg it kt b ku nf kd mh kw ng kg mi ky nh mk ml la ni mn mo lc nj mq mr le im bi translated">通过第一个笔记本中<a class="ae lj" rel="noopener" target="_blank" href="/building-an-automated-machine-learning-pipeline-part-one-5c70ae682f35?source=friends_link&amp;sk=8de05327eedb3d0dadcfa4b1a8e8cc75">所涵盖的管道的前三个步骤，我们清理、理解并格式化了数据集。此外，我们添加并转换了一些特性，为最终在任何ML模型中使用的训练和测试数据集做好了准备:</a></p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi nk"><img src="../Images/343c2b59efb9a90fd33bea33c3777557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cjXIFPVXGNE836CYLUy8AQ.png"/></div></div></figure><p id="fc2b" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">在<a class="ae lj" rel="noopener" target="_blank" href="/building-an-automated-machine-learning-pipeline-part-two-1d3c86e6fe42?source=friends_link&amp;sk=a005d5ead7a844adb7819403ddc6dc0e">的第二个笔记本</a>中，我们选择的评估指标为<strong class="kt jd"><em class="mt">【MSE】</em></strong>，这是一个适合我们问题的指标。然后，我们使用<strong class="kt jd"> <em class="mt">集合评估指标&amp;建立基线</em> </strong>中的均方差计算逻辑计算基线(结果为<em class="mt"> 9.01 </em>)。</p><p id="cae4" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">然后，我们测试了几种不同的ML算法，并决定在<strong class="kt jd"> <em class="mt">选择基于评估指标的ML模型</em> </strong>步骤中使用<a class="ae lj" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html" rel="noopener ugc nofollow" target="_blank">随机森林回归器form scikit-learn </a>构建葡萄酒评级预测器。我们对所选算法进行了超参数调整，并在<strong class="kt jd"> <em class="mt">对所选模型进行超参数调整</em> </strong>步骤中进一步改进了我们的模型性能。</p><blockquote class="mv"><p id="1fd7" class="mw mx it bd my mz na nb nc nd ne le dk translated">我们已经显著降低了基线MSE，从9.01降低到4.99，从而实现了45%的改善！</p></blockquote><p id="c770" class="pw-post-body-paragraph mf mg it kt b ku nf kd mh kw ng kg mi ky nh mk ml la ni mn mo lc nj mq mr le im bi translated">在本文中，我们将完成剩下的最后三个步骤:我们将在测试集上评估我们的模型并解释预测。我们将在最后一步总结整个流程并报告亮点。</p><p id="25e4" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">这篇文章背后的代码可以在这个笔记本里找到<a class="ae lj" href="https://github.com/cereniyim/Wine-Rating-Predictor-ML-Model/blob/master/notebooks/WineRatingPredictor-3.ipynb" rel="noopener ugc nofollow" target="_blank">。GitHub上提供了完整的项目:</a></p><div class="nl nm gp gr nn no"><a href="https://github.com/cereniyim/Wine-Rating-Predictor-ML-Model" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd jd gy z fp nt fr fs nu fu fw jc bi translated">cereniyim/葡萄酒评级预测模型</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">在这个项目中，我为一个在线葡萄酒卖家构建了一个葡萄酒评级预测器。这款葡萄酒预测器旨在显示良好的…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc lz no"/></div></div></a></div><p id="d2ce" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">页（page的缩写）s:我鼓励你在我们开始之前阅读以前的文章，如果你还没有的话！</p><ul class=""><li id="0d0a" class="kr ks it kt b ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/building-an-automated-machine-learning-pipeline-part-one-5c70ae682f35?source=friends_link&amp;sk=8de05327eedb3d0dadcfa4b1a8e8cc75">第1部分:理解、清理、探索、处理数据</a></li><li id="5448" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le lf lg lh li bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/building-an-automated-machine-learning-pipeline-part-two-1d3c86e6fe42?source=friends_link&amp;sk=a005d5ead7a844adb7819403ddc6dc0e">第2部分:设置指标和基线，选择和调整模型</a></li></ul></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><h1 id="f943" class="ok ol it bd om on oo op oq or os ot ou ki ov kj ow kl ox km oy ko oz kp pa pb bi translated">在我们开始之前:</h1><p id="c037" class="pw-post-body-paragraph mf mg it kt b ku pc kd mh kw pd kg mi ky pe mk ml la pf mn mo lc pg mq mr le im bi translated">我们将要使用的数据集在<code class="fe ph pi pj pk b"><a class="ae lj" href="https://github.com/cereniyim/Wine-Rating-Predictor-ML-Model/tree/master/notebooks/transformed" rel="noopener ugc nofollow" target="_blank">notebooks/transformed</a></code>中提供。我们在之前的笔记本中保存的模型可在与本笔记本相同的目录中找到。</p><p id="2421" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">在本笔记本中，我们将需要以下Python库:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="pl pm l"/></div></figure><p id="8513" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">让我们加载数据集和模型:</p><pre class="lq lr ls lt gt pn pk po pp aw pq bi"><span id="cc7a" class="pr ol it pk b gy ps pt l pu pv">X_train = pd.read_csv("transformed/X_train.csv")<br/>y_train = pd.read_csv("transformed/y_train.csv")<br/><br/>X_valid = pd.read_csv("transformed/X_valid.csv")<br/>y_valid = pd.read_csv("transformed/y_valid.csv")<br/><br/>test_features = pd.read_csv("transformed/test_features.csv")<br/>test_target = pd.read_csv("transformed/test_target.csv")</span><span id="d448" class="pr ol it pk b gy pw pt l pu pv">random_forest_model = (pickle<br/>                       .load(<br/>                           open('random_forest_model.sav', <br/>                                'rb')))</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi px"><img src="../Images/0100b4416fe44e4e28f4cf7796b8babd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SRTenzuypxgZP8bDUZ04Rw.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">随机森林模型的参数</p></figure><p id="8143" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">使用我们在第二篇文章中使用的相同函数将它们转换成数组:</p><pre class="lq lr ls lt gt pn pk po pp aw pq bi"><span id="e3dd" class="pr ol it pk b gy ps pt l pu pv">X = pd.concat([X_train, X_valid]) <br/>y = pd.concat([y_train, y_valid])</span><span id="c2b4" class="pr ol it pk b gy pw pt l pu pv">X_array = convert_features_to_array(X) <br/>y_array = convert_target_to_array(y)</span><span id="1fec" class="pr ol it pk b gy pw pt l pu pv">X_test_array = convert_features_to_array(test_features)<br/>y_test_array = convert_target_to_array(test_target)</span></pre><h1 id="d276" class="ok ol it bd om on py op oq or pz ot ou ki qa kj ow kl qb km oy ko qc kp pa pb bi translated">7.训练和评估模型</h1><p id="2202" class="pw-post-body-paragraph mf mg it kt b ku pc kd mh kw pd kg mi ky pe mk ml la pf mn mo lc pg mq mr le im bi translated"><strong class="kt jd"> <em class="mt">训练集</em> </strong>将用于映射特征(<code class="fe ph pi pj pk b">X_array</code>)和目标(<code class="fe ph pi pj pk b">y_array</code>)之间的模式，并构建葡萄酒评级预测器。这个过程叫做<strong class="kt jd"> <em class="mt">训练模型</em> </strong>或者<strong class="kt jd"> <em class="mt">建立模型</em> </strong>。映射将通过在我们的随机森林模型上调用的<code class="fe ph pi pj pk b">fit</code>方法来完成。</p><pre class="lq lr ls lt gt pn pk po pp aw pq bi"><span id="df33" class="pr ol it pk b gy ps pt l pu pv">random_forest_model.fit(X_array, y_array)</span></pre><p id="bb06" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">在评估模型之前，实际目标值(<code class="fe ph pi pj pk b">y_test_array</code>)从测试集(<code class="fe ph pi pj pk b">X_test_array</code>)中拿出来，用作与预测值的比较。两者都将用于使用模型拟合期间发现的模式生成葡萄酒的<em class="mt">点/ </em>等级。</p><p id="7d11" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">将测试集输入模型并生成预测称为<strong class="kt jd"> <em class="mt">评估模型。</em> </strong>当我们在我们的随机森林模型上调用<strong class="kt jd"> <em class="mt"> </em> </strong> <code class="fe ph pi pj pk b">predict</code>方法时，预测的数组就生成了。</p><pre class="lq lr ls lt gt pn pk po pp aw pq bi"><span id="e708" class="pr ol it pk b gy ps pt l pu pv">predictions = random_forest_model.predict(X_test_array)</span></pre><p id="88e8" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated"><strong class="kt jd">让我们看看我们的模型在测试集(我们的模型从未见过的训练数据集的一部分)上的表现如何:</strong></p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi qd"><img src="../Images/49479558ccef39434eaa101a1f131e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g9WyzqYO_7peN3x2QFBCBA.png"/></div></div></figure><h1 id="96a2" class="ok ol it bd om on py op oq or pz ot ou ki qa kj ow kl qb km oy ko qc kp pa pb bi translated">8.解释模型预测</h1><p id="1327" class="pw-post-body-paragraph mf mg it kt b ku pc kd mh kw pd kg mi ky pe mk ml la pf mn mo lc pg mq mr le im bi translated">作为数据科学家，我们是机器学习技术的解释者。我们应该能够解释解决方案是如何工作的，以及需要进一步改进的地方。这发生在<strong class="kt jd"> <em class="mt">解释模型预测</em> </strong>步骤。</p><p id="004d" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">我们将从以下角度解释模型预测:</p><ol class=""><li id="2c7d" class="kr ks it kt b ku kv kw kx ky kz la lb lc ld le ms lg lh li bi translated">可视化单个决策树</li><li id="d39b" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">将<em class="mt">点的实际值与预测值进行比较</em></li><li id="c052" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">查看特性的重要性</li><li id="9573" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">检查模型的单个预测</li></ol><h2 id="35c2" class="pr ol it bd om qe qf dn oq qg qh dp ou ky qi qj ow la qk ql oy lc qm qn pa iz bi translated">8.1.可视化单个决策树</h2><p id="7fd2" class="pw-post-body-paragraph mf mg it kt b ku pc kd mh kw pd kg mi ky pe mk ml la pf mn mo lc pg mq mr le im bi translated">我们已经在上一个笔记本中定义了随机森林算法的工作原理:</p><blockquote class="mv"><p id="7d3b" class="mw mx it bd my mz na nb nc nd ne le dk translated"><strong class="ak"> <em class="qo">随机森林回归器</em> </strong>是一种集成算法，它一次构建多个决策树，并在数据集的各种子样本和各种特征子集上训练它们。</p></blockquote><p id="ba8c" class="pw-post-body-paragraph mf mg it kt b ku nf kd mh kw ng kg mi ky nh mk ml la ni mn mo lc nj mq mr le im bi translated">我们的随机森林算法由200棵决策树组成。如果我们一次绘制所有的树，它可能不会给我们提供太多的信息。然而，可视化单个决策树足以理解葡萄酒评级预测器如何产生预测。</p><p id="e9b4" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">让我们将随机森林回归算法中决策树的前3个节点可视化，以进一步理解我们的算法是如何工作的:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi qp"><img src="../Images/06e5094305fc6cb490c84788db25661d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwGOvSxUQVWHKnLjV2J-1Q.png"/></div></div></figure><p id="68d7" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">看这张图，你可以把决策树想象成一系列的是/否问题，像流程图一样被问和回答。这个特定的树是使用总共8948个数据点中的5645个数据点构建的，这是完整数据集的随机子样本。</p><p id="86ea" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">通过询问<em class="mt">区域_1 </em>是否小于320.5来启动根节点。可以容易地认识到，初始MSE与MSE的基线估计相同。预测<em class="mt">分</em>是88.425。</p><p id="4ac9" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">根节点被分成两个分别由5018(初始子样本的88%)和627个数据点(初始子样本的12%)组成的真和假子节点。</p><p id="0a6d" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">根节点的假子节点询问<em class="mt">价格</em>是否小于30.5，并使用初始子样本的12%来回答这个问题。与前一个节点相比，MSE略有改善，这表明节点更加连贯。预测<em class="mt">分</em>是87.818。</p><p id="b626" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">这个过程迭代地继续，直到到达叶节点。当节点的MSE没有进一步提高时，或者当达到叶节点的指定标准(对于我们的模型，在叶节点中具有最少2个样本)时，该过程停止。</p><h2 id="6064" class="pr ol it bd om qe qf dn oq qg qh dp ou ky qi qj ow la qk ql oy lc qm qn pa iz bi translated">8.2.将P <em class="qo">点</em>的实际值与预测值进行比较</h2><p id="6a05" class="pw-post-body-paragraph mf mg it kt b ku pc kd mh kw pd kg mi ky pe mk ml la pf mn mo lc pg mq mr le im bi translated">为了理解实际的<em class="mt">点</em>和预测的<em class="mt">点</em>有什么不同，让我们用柱状图将它们并排可视化:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="pl pm l"/></div></figure><pre class="lq lr ls lt gt pn pk po pp aw pq bi"><span id="0726" class="pr ol it pk b gy ps pt l pu pv">PlotPredictedVSActual(predictions, y_test_array)</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi qq"><img src="../Images/eb9aa1203f0738acf919e8d20e74cf40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b-09pKnQOCqk5YKo7keZJQ.png"/></div></div></figure><p id="1909" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">回想一下<em class="mt">点</em>呈正态分布，95%的<em class="mt">点</em>位于82.5–94.5范围内。我们的模型成功预测了该范围内的<em class="mt">点</em>，但未能预测低于84的点和高于94的点，它们是分布的不太频繁的值。这也是预测分布较窄的原因。</p><p id="2e61" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">这是我们的葡萄酒评级预测器的一个更进一步和有趣的改进领域，但我们现在不会触及它。</p><h2 id="815e" class="pr ol it bd om qe qf dn oq qg qh dp ou ky qi qj ow la qk ql oy lc qm qn pa iz bi translated">8.3.查看特性的重要性</h2><p id="2549" class="pw-post-body-paragraph mf mg it kt b ku pc kd mh kw pd kg mi ky pe mk ml la pf mn mo lc pg mq mr le im bi translated">评估模型的另一种方法是查看模型认为哪些特性最重要。以下是每个特征在确定一个<em class="mt">点</em>时的相对贡献值:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="pl pm l"/></div></figure><pre class="lq lr ls lt gt pn pk po pp aw pq bi"><span id="3444" class="pr ol it pk b gy ps pt l pu pv">PlotFeatureImportances(random_forest_model, test_features.columns)</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi qr"><img src="../Images/5355ad4ac03c9ae2f01663a7ebd66cca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VOqKARUERxyyejhzjvXNGg.png"/></div></div></figure><p id="f27a" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">根据模型，最强的预测因子是<em class="mt">价格</em>。其次是<em class="mt"> region_1 </em>、<em class="mt"> year </em>、<em class="mt"> variety </em>和<em class="mt"> taster_name </em>用于预测葡萄酒的<em class="mt">点</em>。</p><p id="0aa4" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">这些符合我们在<strong class="kt jd"> <em class="mt">探索性数据分析</em> </strong>步骤中得出的初步观察结果。</p><blockquote class="mv"><p id="0c35" class="mw mx it bd my mz na nb nc nd ne le dk translated">价格是葡萄酒质量和年份的指标。因此，我们期望它成为该模型的一个基本特征。</p></blockquote><figure class="qt qu qv qw qx lu gh gi paragraph-image"><div class="gh gi qs"><img src="../Images/93363dabfc5074ade4e0de5ca3ddaa7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:596/format:webp/1*qsBO2npFMy3AQMxFmRDqMw.png"/></div><p class="mb mc gj gh gi md me bd b be z dk translated">前5大功能重要性</p></figure><p id="6f88" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">前5个特征占总重要性的80%。这难道不是帕累托法则的又一个美丽例子吗？</p><p id="0375" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">从提取的特征来看，<em class="mt">年份</em>是其中最重要的，葡萄酒是否起泡是<em class="mt">点数</em>最不重要的预测因素。</p><p id="f015" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">另一个重要的观察结果是，从<em class="mt">品种</em>和<em class="mt">描述</em>中提取的与音符和味道相关的特征对我们的预测器来说成为中等重要的特征。综合运用自然语言处理和情感分析可能有助于从<em class="mt">描述</em>和<em class="mt">变化</em>特征中发现更多有价值的特征。</p><p id="4894" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">到目前为止，我们已经从总体的角度解释了我们的葡萄酒评级预测器的预测。现在，让我们从我们的模型中检验一个单独的预测。</p><h2 id="698d" class="pr ol it bd om qe qf dn oq qg qh dp ou ky qi qj ow la qk ql oy lc qm qn pa iz bi translated">8.4.检验单个预测</h2><p id="44f8" class="pw-post-body-paragraph mf mg it kt b ku pc kd mh kw pd kg mi ky pe mk ml la pf mn mo lc pg mq mr le im bi translated">我们将从一个名为<a class="ae lj" href="https://github.com/marcotcr/lime" rel="noopener ugc nofollow" target="_blank"> LIME(本地可解释的模型不可知解释)</a>的解释器库中获得一些帮助来观察一个预测。这个库在数据点浓缩的地方创建一个近似的局部模型，并使用这个模型来解释任何ML算法的单个预测。</p><p id="59bb" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">我们将观察从残差的最大值中检测到的最不正确的预测。然后，我们将创建<code class="fe ph pi pj pk b">LimeTabularExplainer</code>对象。</p><pre class="lq lr ls lt gt pn pk po pp aw pq bi"><span id="2160" class="pr ol it pk b gy ps pt l pu pv"><em class="mt"># find the residuals and wrong prediction</em><br/>residuals = abs(predictions - y_test_array)<br/>wrong = X_test_array[np.argmax(residuals), :]</span><span id="c948" class="pr ol it pk b gy pw pt l pu pv"><em class="mt"># Create a lime explainer object</em><br/>explainer = lime.lime_tabular.LimeTabularExplainer(<br/>    training_data = X_array, <br/>    mode = 'regression',<br/>    training_labels = y_array,<br/>    feature_names = test_features.columns)</span></pre><p id="a485" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">下面的代码块将描述葡萄酒评级预测器是如何得出错误预测的。它预测的是90.3分，而实际是82分。这是该模型最不正确的预测:</p><pre class="lq lr ls lt gt pn pk po pp aw pq bi"><span id="684d" class="pr ol it pk b gy ps pt l pu pv"><em class="mt"># Display the predicted and true value for the wrong instance</em><br/>print('Prediction: <strong class="pk jd">{}</strong>'<br/>      .format(random_forest_model.predict(wrong.reshape(1, -1))))<br/>print('Actual Value: <strong class="pk jd">{}</strong>' <br/>      .format(y_test_array[np.argmax(residuals)]))<br/><br/><em class="mt"># Explanation for wrong prediction</em><br/>wrong_exp = explainer.explain_instance(<br/>    data_row = wrong, <br/>    predict_fn = random_forest_model.predict)<br/><br/><em class="mt"># Plot the prediction explaination</em><br/>figsize(20, 10)<br/>plt.rcParams['font.size'] = 24</span><span id="d843" class="pr ol it pk b gy pw pt l pu pv">wrong_exp.as_pyplot_figure()<br/>plt.title('Explanation of a Wrong Prediction', size = 24)<br/>plt.xlabel('Effect on Prediction', size = 24)</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi qr"><img src="../Images/eae277c9fd36163ecc997083a5c1ae97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GitE57bc9ctwiiEBR9fgqA.png"/></div></div></figure><p id="acfd" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">该图显示了每个特征对错误预测示例的影响。积极的贡献用绿色表示，消极的贡献用红色表示。</p><p id="9b3d" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">由于<em class="mt">价格</em>是最强的预测值，并且该示例中的<em class="mt">价格</em>高于40，这显著增加了模型对点数的预测。另一方面，<em class="mt">国家</em>，<em class="mt">是红色</em>和<em class="mt">是白色</em>通过减少来平衡预测。这是一个很好的例子，说明机器学习算法也可能像我们人类一样陷入常见的陷阱。你难道没有买过昂贵的酒来保证高质量吗🙂</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi qy"><img src="../Images/3ce2febc80b54954144ef67720863d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/0*YlFFSu_hySJdDHcr.gif"/></div><p class="mb mc gj gh gi md me bd b be z dk translated"><strong class="bd qz">其实是吗？</strong>图像来源:黑书系列—第一季第三集<br/>blackbooks.gifglobe.com<a class="ae lj" href="https://blackbooks.gifglobe.com/scene/?id=dRJwMw2SMio6" rel="noopener ugc nofollow" target="_blank">上的愤怒的葡萄</a></p></figure><h1 id="53e3" class="ok ol it bd om on py op oq or pz ot ou ki qa kj ow kl qb km oy ko qc kp pa pb bi translated">9.得出结论并记录工作</h1><p id="f884" class="pw-post-body-paragraph mf mg it kt b ku pc kd mh kw pd kg mi ky pe mk ml la pf mn mo lc pg mq mr le im bi translated">因为我们是机器学习技术的解释者，所以根据我们的受众来定制我们的信息和交付内容是很重要的。特别是，如果你向你的经理或客户展示你的结果，你必须非常简洁和相关。你可能期望他们会对你的推理和结果更感兴趣，所以在展示你的发现时，要关注他们😉</p><p id="1c3f" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">如果你还记得第一篇文章，我在<a class="ae lj" href="https://www.datarevenue.com/" rel="noopener ugc nofollow" target="_blank"> Data Revenue </a>建立了这个项目作为ML工程师面试过程的带回家作业。作业的目标是通过观察葡萄酒等级预测器的结果来决定是否建立一个全面生产的解决方案。因此，我准备了一份报告，介绍了我的决定和9步ML流程中最关键的几个要点，并得出了结论。</p><p id="8134" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated"><strong class="kt jd">我提议依靠</strong>构建完整的生产解决方案</p><blockquote class="ra rb rc"><p id="f253" class="mf mg mt kt b ku kv kd mh kw kx kg mi rd mj mk ml re mm mn mo rf mp mq mr le im bi translated">给定样本数据集、确定的功能集和调整的随机森林回归器，答案是<strong class="kt jd">是</strong>，完全生产解决方案适用于这些。</p><p id="6a91" class="mf mg mt kt b ku kv kd mh kw kx kg mi rd mj mk ml re mm mn mo rf mp mq mr le im bi translated">该模型显著降低了基线MSE(45%)，并在测试集上产生了4.93 MSE。这是构建全面生产解决方案的依据。</p></blockquote><p id="7c83" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated"><strong class="kt jd">..并且强调了最重要的两个发现:</strong></p><blockquote class="ra rb rc"><p id="a029" class="mf mg mt kt b ku kv kd mh kw kx kg mi rd mj mk ml re mm mn mo rf mp mq mr le im bi translated">-葡萄酒评级预测器可以推断出葡萄酒的分数，其合理方差(MSE)为4.9。</p><p id="b308" class="mf mg mt kt b ku kv kd mh kw kx kg mi rd mj mk ml re mm mn mo rf mp mq mr le im bi translated">-最有用的点数预测器被确定为价格、区域_1、年份、品种和品尝者_姓名。</p></blockquote><p id="0c41" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated"><strong class="kt jd">..并且我指出了进一步改进的地方:</strong></p><blockquote class="ra rb rc"><p id="7fd3" class="mf mg mt kt b ku kv kd mh kw kx kg mi rd mj mk ml re mm mn mo rf mp mq mr le im bi translated"><strong class="kt jd">扩展预测范围:</strong>以便模型可以预测不太频繁的目标值。当前的样本数据集主要是来自最主要国家(美国、意大利、法国、西班牙)的葡萄酒，输入更多来自非当前国家的数据可能有助于模型更好地学习不太频繁点的决定因素。</p><p id="e729" class="mf mg mt kt b ku kv kd mh kw kx kg mi rd mj mk ml re mm mn mo rf mp mq mr le im bi translated"><strong class="kt jd">利用NLP提取更强的预测因子:</strong>目前最强的预测因子是“价格”。从与葡萄酒味道和注释相关的描述中提取更多特征可以帮助创建像价格这样的强预测器，从而减少模型的预测误差。</p></blockquote><p id="019c" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">你可以在这里找到完整的报道<a class="ae lj" href="https://github.com/cereniyim/Wine-Rating-Predictor-ML-Model/blob/master/notebooks/ClientSummaryReport.2020.04.02.pdf" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="1503" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">它最终成为一份全面而简洁的报告。此外，我把代码放在一边，因为报告是为一个假设的客户准备的，他的统计学和ML知识是有限的。</p><p id="b227" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">你可以把你的Jupyter笔记本转换成文档，为你自己的项目或学习目的准备一份类似的总结报告(我准备了PDF格式)。您可以使用<code class="fe ph pi pj pk b">File &gt; Download As</code>中提供的各种下载选项。HTML或LaTeX格式很容易使用。(如果您的机器上安装了<a class="ae lj" href="https://www.texstudio.org/" rel="noopener ugc nofollow" target="_blank"> LaTeX Studio </a>，那么您可以稍后将其转换为pdf格式)。你可以在这里阅读更多关于那个<a class="ae lj" href="https://nbconvert.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi rg"><img src="../Images/85bc990900b005ee40cf4c8cf11c60db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*AeQ3Drqv_Ro-wmaVZxgsmQ.png"/></div><p class="mb mc gj gh gi md me bd b be z dk translated">Jupyter笔记本中提供了一些下载选项</p></figure><p id="6eb1" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">我们应该永远记住，数据科学中的“科学”是有目的的，最终是为了非科学的目的。我们的工作主要用于支持商业决策过程或解决现实世界的问题。展示结果(口头或书面)并根据你的听众调整语言将是你拥有的一项有价值的技能。</p><h1 id="5fa1" class="ok ol it bd om on py op oq or pz ot ou ki qa kj ow kl qb km oy ko qc kp pa pb bi translated">完整的9步ML管道的结论</h1><p id="67ed" class="pw-post-body-paragraph mf mg it kt b ku pc kd mh kw pd kg mi ky pe mk ml la pf mn mo lc pg mq mr le im bi translated">从构建原始数据到理解它们的意义，我们走过了漫长的道路。我们从清理和格式化数据开始，然后我们训练和调整选择的模型(随机森林回归)。通过评估模型和解释其结果，我们总结了9步流程。最后，我们在一份报告中强调了该项目的最重要成果。</p><ol class=""><li id="5a17" class="kr ks it kt b ku kv kw kx ky kz la lb lc ld le ms lg lh li bi translated">理解、清理和格式化数据</li><li id="a28c" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">探索性数据分析</li><li id="f455" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">特征工程和预处理</li><li id="51f0" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">设置评估指标并建立基线</li><li id="8a16" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">基于评估度量选择ML模型</li><li id="c85d" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">对所选模型执行超参数调整</li><li id="ab2a" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">训练和评估模型</li><li id="0575" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">解释模型预测</li><li id="1abe" class="kr ks it kt b ku lk kw ll ky lm la ln lc lo le ms lg lh li bi translated">得出结论并记录工作</li></ol><p id="a96c" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">在本系列文章中，我们按顺序遵循了这些步骤。然而，当我在这个项目中工作的时候，我有20%的时间在这些步骤之间来来回回。总而言之，我相信建立一个机器学习解决方案是一个迭代和实验的过程，所以不要犹豫改进和重温以前的步骤！</p><h2 id="c86c" class="pr ol it bd om qe qf dn oq qg qh dp ou ky qi qj ow la qk ql oy lc qm qn pa iz bi translated"><strong class="ak">特别感谢</strong></h2><p id="7169" class="pw-post-body-paragraph mf mg it kt b ku pc kd mh kw pd kg mi ky pe mk ml la pf mn mo lc pg mq mr le im bi translated">在这里我要感谢<a class="rh ri ep" href="https://medium.com/u/e2f299e30cb9?source=post_page-----a74acda76b98--------------------------------" rel="noopener" target="_blank">威尔·科尔森</a>。他是我写数据科学/机器学习项目的灵感来源之一。</p><p id="b360" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">我第一次从<a class="ae lj" rel="noopener" target="_blank" href="/a-complete-machine-learning-walk-through-in-python-part-one-c62152f39420">的一篇文章</a>中了解到这个管道，并根据我自己的目标和问题进行了调整。现在，我在构建任何类型的机器学习/数据科学项目时，都使用这条管道作为指南。它帮助我组织我的思维过程，并看到机器学习的各个元素是如何连接的！</p></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="2fb0" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">我们还有最后一篇文章要写，它将使用<a class="ae lj" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>和<a class="ae lj" href="https://luigi.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> Luigi </a>来自动化这条流水线。下周敬请关注！</p><div class="nl nm gp gr nn no"><a rel="noopener follow" target="_blank" href="/building-an-automated-machine-learning-pipeline-part-four-787cdc50a12d"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd jd gy z fp nt fr fs nu fu fw jc bi translated">构建自动化机器学习管道:第四部分</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">利用Docker和Luigi实现管道自动化</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">towardsdatascience.com</p></div></div><div class="nx l"><div class="rj l nz oa ob nx oc lz no"/></div></div></a></div><p id="c7be" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">感谢阅读🙂请随意使用这个管道，代码和<a class="ae lj" href="https://github.com/cereniyim/Wine-Rating-Predictor-ML-Model" rel="noopener ugc nofollow" target="_blank">库</a>用于你自己的项目。</p><p id="c958" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">对于评论或建设性的反馈，您可以通过回复、<a class="ae lj" href="https://twitter.com/cereniyim" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae lj" href="https://www.linkedin.com/in/ceren-iyim" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>联系我！</p><p id="add4" class="pw-post-body-paragraph mf mg it kt b ku kv kd mh kw kx kg mi ky mj mk ml la mm mn mo lc mp mq mr le im bi translated">在那之前保持安全和健康👋</p></div></div>    
</body>
</html>