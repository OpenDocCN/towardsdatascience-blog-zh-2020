<html>
<head>
<title>A faster Hyper Parameter Tuning using Nature-Inspired Algorithms in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中使用自然启发算法的快速超参数调整</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-faster-hyper-parameter-tuning-using-nature-inspired-algorithms-in-python-33a32eb34f54?source=collection_archive---------46-----------------------#2020-07-06">https://towardsdatascience.com/a-faster-hyper-parameter-tuning-using-nature-inspired-algorithms-in-python-33a32eb34f54?source=collection_archive---------46-----------------------#2020-07-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5e94" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Bat 算法与网格搜索的性能比较</h2></div><p id="982a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">受自然启发的算法非常强大，通常用于解决 NP 难问题(如旅行推销员问题)或其他计算量大的任务。它们也被称为<strong class="kh ir">优化算法。</strong>受自然启发的算法试图找到问题的最佳解决方案，然而<strong class="kh ir">并不保证会找到最佳解决方案</strong>。</p><p id="9726" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">超参数调整通常使用网格搜索或随机搜索来完成。<em class="lb">网格搜索</em>的问题在于它非常昂贵，因为它尝试了所有可能的参数组合。<em class="lb">随机搜索</em>会尝试一定数量的随机参数组合。它不太可能找到参数的最佳组合，但是，它比网格搜索要快得多。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/dbd9af138f791473829f92e715826fa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9mYQ--uIRVMIfUBo"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">蝙蝠的<strong class="bd ls">回声定位</strong>是蝙蝠算法的基础部分(杨新社 2010)。照片由<a class="ae lt" href="https://unsplash.com/@igamogam" rel="noopener ugc nofollow" target="_blank"> Igam Ogam </a>在<a class="ae lt" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="572e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来是<strong class="kh ir">自然启发算法</strong>。它们比网格搜索更快，并且有可能找到最佳解决方案——超参数的最佳组合。然而，算法与算法之间的结果会有所不同(有许多受自然启发的算法，例如:<a class="ae lt" href="https://en.wikipedia.org/wiki/Bat_algorithm" rel="noopener ugc nofollow" target="_blank">蝙蝠算法</a>、<a class="ae lt" href="https://en.wikipedia.org/wiki/Firefly_algorithm" rel="noopener ugc nofollow" target="_blank">萤火虫算法</a>……)，这些算法也有自己的参数，这些参数控制它们如何搜索解决方案。如果您知道这些算法是如何工作的，您可能希望设置这些参数来改进搜索过程。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="26c1" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">使用自然启发的算法开始超参数调谐</h1><p id="7149" class="pw-post-body-paragraph kf kg iq kh b ki mt jr kk kl mu ju kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">如果您在您的机器学习项目中使用<a class="ae lt" href="https://scikit-learn.org/" rel="noopener ugc nofollow" target="_blank"> Scikit-Learn </a>，您可以使用一个名为<a class="ae lt" href="https://github.com/timzatko/Sklearn-Nature-Inspired-Algorithms" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> Sklearn 自然启发算法</strong> </a>的 python 库，它将允许您使用自然启发算法进行超参数调整。我们将在本教程中使用这个库，通过 pip 安装它。</p><pre class="ld le lf lg gt my mz na nb aw nc bi"><span id="18f8" class="nd mc iq mz b gy ne nf l ng nh">pip install sklearn-nature-inspired-algorithms</span></pre><p id="e580" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们想要优化我们的<em class="lb">随机森林分类器</em>的参数。</p><pre class="ld le lf lg gt my mz na nb aw nc bi"><span id="43c4" class="nd mc iq mz b gy ne nf l ng nh">from sklearn.ensemble import RandomForestClassifier</span><span id="30c9" class="nd mc iq mz b gy ni nf l ng nh">clf = RandomForestClassifier(random_state=42)</span></pre><p id="325a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们需要定义我们将尝试的参数集，用法类似于 scikit-learn 的<a class="ae lt" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html" rel="noopener ugc nofollow" target="_blank"> GridSearchCV </a>。这组参数总共有 216 种不同的组合。</p><pre class="ld le lf lg gt my mz na nb aw nc bi"><span id="6840" class="nd mc iq mz b gy ne nf l ng nh">param_grid = {<br/>   'n_estimators': range(10, 80, 20),<br/>   'max_depth': [2, 4, 6, 8, 10, 20],<br/>   'min_samples_split': range(2, 8, 2),<br/>   'max_features': ["auto", "sqrt", "log2"]<br/>}</span></pre><p id="c16a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们需要一个数据集。我们将使用<em class="lb"> make_classification 人工创建一个。</em></p><pre class="ld le lf lg gt my mz na nb aw nc bi"><span id="702f" class="nd mc iq mz b gy ne nf l ng nh">from sklearn.model_selection import train_test_split<br/>from sklearn.datasets import make_classification</span><span id="6bd8" class="nd mc iq mz b gy ni nf l ng nh">X, y = make_classification(n_samples=1000, n_features=10, class_sep=0.8, n_classes=2)<br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)</span><span id="233f" class="nd mc iq mz b gy ni nf l ng nh">print(f'train size - {len(X_train)}\ntest size - {len(X_test)}')</span></pre><p id="e27a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">现在我们可以使用自然启发的算法进行超参数调整。</strong>我们正在使用<a class="ae lt" href="https://en.wikipedia.org/wiki/Bat_algorithm" rel="noopener ugc nofollow" target="_blank"> Bat 算法</a>进行优化。我们将训练 25 个个体的种群规模，如果算法在 10 代内找不到更好的解决方案，我们将停止该算法。我们将这样做 5 次，并将使用 5 倍交叉验证。<em class="lb">要了解关于 NatureInspiredSearchCV 参数的更多信息，请参考其</em> <a class="ae lt" href="https://sklearn-nature-inspired-algorithms.readthedocs.io/en/stable/introduction/nature-inspired-search-cv.html" rel="noopener ugc nofollow" target="_blank"> <em class="lb">文档</em> </a> <em class="lb">，您也可以使用 Bat 算法之外的其他算法。</em></p><pre class="ld le lf lg gt my mz na nb aw nc bi"><span id="c763" class="nd mc iq mz b gy ne nf l ng nh">from sklearn_nature_inspired_algorithms.model_selection import NatureInspiredSearchCV</span><span id="9345" class="nd mc iq mz b gy ni nf l ng nh">nia_search = NatureInspiredSearchCV(<br/>    clf,<br/>    param_grid,<br/>    cv=5,<br/>    verbose=1,<br/>    algorithm='ba',<br/>    population_size=25,<br/>    max_n_gen=100,<br/>    max_stagnating_gen=10,    <br/>    runs=5,<br/>    scoring='f1_macro',<br/>    random_state=42,<br/>)<br/><br/>nia_search.fit(X_train, y_train)</span></pre><p id="68d0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">花费了一些时间，大约 1 分钟(GridSearch 大约需要 2 分钟，参数网格越大，差异越大)。现在，您可以用找到的最佳参数来拟合您的模型。最佳参数存储在<em class="lb">nia _ search . best _ params _</em>中。</p><pre class="ld le lf lg gt my mz na nb aw nc bi"><span id="2eb8" class="nd mc iq mz b gy ne nf l ng nh">from sklearn.metrics import classification_report</span><span id="06aa" class="nd mc iq mz b gy ni nf l ng nh">clf = RandomForestClassifier(**nia_search.best_params_, random_state=42)<br/><br/>clf.fit(X_train, y_train)<br/><br/>y_pred = clf.predict(X_test)<br/><br/>print(classification_report(y_test, y_pred, digits=4))</span></pre><p id="0524" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您已经使用受自然启发的算法选择的最佳参数成功训练了模型。这是完整的例子。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="744e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我还做了一个<em class="lb"> GridSearchCV </em>和 NatureInspiredSearchCV 的比较(在本<a class="ae lt" href="https://github.com/timzatko/Sklearn-Nature-Inspired-Algorithms/blob/master/examples/notebooks/hyper_parameter_tuning_nia_vs_grid_search.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>)。我使用了更大的数据集和更多的超参数(总共 1560 个组合)。<em class="lb">natureinspiredsearchv</em><strong class="kh ir">找到了与<em class="lb"> GridSearchCV </em>相同的解决方案</strong>，并且<strong class="kh ir">比</strong>快了 4.5 倍！花了<strong class="kh ir"><em class="lb">GridSearchCV</em>2h 23 分 44 秒</strong>找到了<strong class="kh ir">最佳</strong>方案，<strong class="kh ir"><em class="lb">natureinspiredsearchv</em>在 31 分 58 秒</strong>找到了。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="92ca" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">受自然启发的算法非常强大，在超参数调整方面优于网格搜索，因为它们能够更快地找到相同的解决方案(或非常接近)。在本教程中，我们使用 Bat 算法，其默认参数由<a class="ae lt" href="https://github.com/timzatko/Sklearn-Nature-Inspired-Algorithms" rel="noopener ugc nofollow" target="_blank"> Sklearn 自然启发的算法</a>库设置，但也有许多其他自然启发的算法可用于超参数调整。</p></div></div>    
</body>
</html>