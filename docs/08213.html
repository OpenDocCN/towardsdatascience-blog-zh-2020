<html>
<head>
<title>Auto-deploy FastAPI App to Heroku via Git in these 5 Easy Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Git将FastAPI应用程序自动部署到Heroku，只需5个简单的步骤</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/autodeploy-fastapi-app-to-heroku-via-git-in-these-5-easy-steps-8c7958ef5d41?source=collection_archive---------25-----------------------#2020-06-16">https://towardsdatascience.com/autodeploy-fastapi-app-to-heroku-via-git-in-these-5-easy-steps-8c7958ef5d41?source=collection_archive---------25-----------------------#2020-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="73ef" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在5分钟内将您的应用分享到互联网</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/78f98c8dc591fbab86800783dcd8d714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OiLIb2c3vyTjfHI1"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏珊·路易斯·佩尼克斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9a8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果不是用现有的app，可以参考我的虹膜分类器FastAPI App进行参考。我写过一篇关于如何设置的文章(Docker组件是可选的)。</p><p id="06c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>我很快地组装了Iris应用程序来演示如何设置FastAPI——在提供模型预测时，它肯定不符合最佳实践</p><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/deploying-iris-classifications-with-fastapi-and-docker-7c9b83fdec3a"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">使用FastAPI和Docker部署Iris分类</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">让我们用Docker部署一个FastAPI应用程序来对一些虹膜进行分类。</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="a214" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我的虹膜分类器应用程序的GitHub repo。我们将在本教程中以此为例。确保您正在使用的FastAPI项目也被托管为GitHub存储库。</p><h1 id="b5f4" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">什么是FastAPI？</h1><blockquote class="nf ng nh"><p id="1fe8" class="kz la ni lb b lc ld ju le lf lg jx lh nj lj lk ll nk ln lo lp nl lr ls lt lu im bi translated">FastAPI是一个现代、快速(高性能)的web框架，用于基于标准Python类型提示用Python 3.6+构建API。</p></blockquote><p id="42cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">FastAPI网站<a class="ae ky" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank">提供了有关FastAPI如何工作以及使用FastAPI的优势的更多详细信息。</a></p><h1 id="b64c" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">什么是Heroku？</h1><blockquote class="nf ng nh"><p id="37d8" class="kz la ni lb b lc ld ju le lf lg jx lh nj lj lk ll nk ln lo lp nl lr ls lt lu im bi translated"><strong class="lb iu"> Heroku </strong>是一个平台即服务(PaaS ),支持开发者完全在云中构建、运行和操作应用。</p></blockquote><p id="c067" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我真的很喜欢使用Heroku来展示我的副业项目，因为它很容易设置，而且免费层通常足以满足大多数目的。</p><p id="a999" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将使用Heroku将我的FastAPI应用程序部署到公共互联网，并将主分支与生产应用程序同步。每当我将更改推送到主分支时，它们都会在web应用程序上同步。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="bbe6" class="mn mo it bd mp mq nt ms mt mu nu mw mx jz nv ka mz kc nw kd nb kf nx kg nd ne bi translated">步骤1:添加Procfile</h1><p id="e7a8" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">Procfile指定了应用程序在启动时执行的命令。创建一个名为<code class="fe od oe of og b">Procfile</code>的新文件(没有扩展名，确保使用相同的大小写)。</p><p id="0630" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是虹膜分类器的过程文件:</p><pre class="kj kk kl km gt oh og oi oj aw ok bi"><span id="46cd" class="ol mo it og b gy om on l oo op">web: uvicorn iris.app:app --host=0.0.0.0 --port=${PORT:-5000}</span></pre><p id="0c56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您使用自己的FastAPI项目，相应地更改路径<code class="fe od oe of og b">iris.app:app</code>。这是实例化的<code class="fe od oe of og b">FastAPI()</code>对象的路径。</p><p id="585f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是<a class="ae ky" href="https://github.com/happilyeverafter95/iris-classifier-fastapi/blob/master/iris/app.py#L4" rel="noopener ugc nofollow" target="_blank">矿</a>供参考。</p><h1 id="d8ac" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">[可选]步骤2:下载Heroku CLI</h1><p id="252f" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">按照Heroku网站上的说明下载CLI:</p><div class="lv lw gp gr lx ly"><a href="https://devcenter.heroku.com/articles/heroku-cli#download-and-install" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">Heroku CLI</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">Heroku命令行界面(CLI)使得直接从终端创建和管理您的Heroku应用程序变得非常容易…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">devcenter.heroku.com</p></div></div><div class="mh l"><div class="oq l mj mk ml mh mm ks ly"/></div></div></a></div><p id="ce55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我们在这里实际上根本没有使用CLI，但是CLI使得通过终端管理应用程序变得很容易。</p><h1 id="d7c3" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">步骤3:在Heroku上创建应用程序</h1><p id="31ce" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">前往<a class="ae ky" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank">https://www.heroku.com/</a>创建一个账户。导航到<a class="ae ky" href="https://dashboard.heroku.com/apps" rel="noopener ugc nofollow" target="_blank">仪表盘</a>创建一个新应用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/615dff99654a48f48d6d33ece6f16e46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o0vDowMZksAb-nSeoifa2Q.png"/></div></div></figure><p id="093b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我把我的应用程序命名为<em class="ni"> irisclassifierfastapi </em>。这个名字决定了默认的URL——这个项目将在<a class="ae ky" href="http://www.irisclassifierfastapi.myherokuapp.com." rel="noopener ugc nofollow" target="_blank">www.irisclassifierfastapi.herokuapp.com托管。</a>可以在应用程序的<code class="fe od oe of og b">Settings</code>页面将自定义域名添加到应用程序中。</p><h1 id="fff0" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated"><strong class="ak">步骤4:设置自动部署</strong></h1><p id="b775" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">导航到<strong class="lb iu"> deploy </strong>选项卡，点击GitHub logo，认证并授权Heroku从你的GitHub账户部署代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/e75f9c65d23381972446aa2eead4e7e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z-7_h9rqaC1ZDs_vHrKAqQ.png"/></div></div></figure><p id="8c89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">连接后，选择存储库以连接到应用程序。从那里，选择一个分支并点击<strong class="lb iu">启用自动部署。</strong>如果您正在使用CI工具，您可以选中复选框以确保CI在部署变更之前通过。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/f35e949cac59fc51da28ca4d28ebbca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iGvGqA6QXg5U8Z6vK5CItA.png"/></div></div></figure><h1 id="ed57" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">第5步:首次手动部署您的应用程序</h1><p id="f2ed" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">下次将更改推送到主分支时，将会部署该应用程序。由于我们还没有部署我们的应用程序(到目前为止还没有进行任何更改)，我们可以通过滚动到<strong class="lb iu">部署</strong>选项卡的底部来触发手动部署。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/27bab233396d59acf45a646410f24ee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KDC_rHoK76y1FRDddMSViQ.png"/></div></div></figure><p id="d706" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您安装了CLI，也可以通过命令行执行手动部署。</p><div class="lv lw gp gr lx ly"><a href="https://devcenter.heroku.com/categories/command-line" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">命令行</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">heroku命令行界面(CLI)是使用Heroku的重要部分。使用它来执行几乎任何…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">devcenter.heroku.com</p></div></div></div></a></div></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="7c6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">部署更改大约需要一分钟。你可以在<a class="ae ky" href="https://irisclassifierfastapi.herokuapp.com/docs" rel="noopener ugc nofollow" target="_blank">https://irisclassifierfastapi.herokuapp.com/docs</a>上找到虹膜分类器的Swagger UI</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/ad796dad36c6517c7fc4a8e0fa7df370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*-W_t_xqwjnUE9Umeym4ehQ.png"/></div></figure><p id="37ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只要我的应用程序在运行，这个CURL请求就允许我从分类器中获取预测。</p><pre class="kj kk kl km gt oh og oi oj aw ok bi"><span id="60f8" class="ol mo it og b gy om on l oo op">curl 'http://irisclassifierfastapi.herokuapp.com/iris/classify_iris' -X POST -H 'Content-Type: application/json' -d '{"sepal_l": 5, "sepal_w": 2, "petal_l": 3, "petal_w": 4}'</span></pre><p id="ab46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分类器预测这种鸢尾有91%的概率是海滨鸢尾。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/1bbdbab57efb304a77d020bc53192c8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YcfN-bWL4v6Tk2MEc4HsyA.png"/></div></div></figure><h1 id="8188" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">有用的后期制作工具</h1><p id="2ce2" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">这里有一些工具，你可以利用它们来调试糟糕的部署，并从总体上监控你的应用。</p><h2 id="598c" class="ol mo it bd mp ox oy dn mt oz pa dp mx li pb pc mz lm pd pe nb lq pf pg nd ph bi translated">日志</h2><p id="299f" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">在应用页面中，点击<strong class="lb iu">更多</strong>，从下拉菜单中选择<strong class="lb iu">查看日志</strong>查看应用日志。每个日志都是应用程序中发生的事件。日志可用于提供信息(例如，您可以记录用户属性)、警告和错误。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/d261f0f8a1406d2809be85ab9fb4adab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*BJKPmRia4ENbYzUO1gEBaQ.png"/></div></figure><p id="43f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用Python <a class="ae ky" href="https://docs.python.org/3/library/logging.html" rel="noopener ugc nofollow" target="_blank"> logging </a>库来添加更多的日志，这将使调试您的应用程序变得更加容易。</p><h2 id="0e32" class="ol mo it bd mp ox oy dn mt oz pa dp mx li pb pc mz lm pd pe nb lq pf pg nd ph bi translated">反转</h2><p id="a665" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">如果部署不当，您可能希望回滚您的更改。虽然您可以在Git中通过恢复到以前的提交来实现这一点，但Heroku也提供了通过UI实现这一点的选项。</p><p id="7f17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导航到<strong class="lb iu">活动</strong>选项卡查看以前的版本，并单击<strong class="lb iu">回滚到此处</strong>恢复到以前的版本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/619a85195ac037fc98b93f16ea03e037.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*3ZKl-hnXdI9R7T1gUkiqHg.png"/></div></figure><h2 id="8dfc" class="ol mo it bd mp ox oy dn mt oz pa dp mx li pb pc mz lm pd pe nb lq pf pg nd ph bi translated">指标(不可用于免费计划)</h2><p id="2f5f" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">指标不可用于空闲层。度量图表捕获与系统健康和性能相关的信息，例如内存使用和事件发生。</p><p id="6b82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">爱好层下我的一个应用的指标选项卡如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/62c02ff3b15b0bb6bd7547cc24975345.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hNhDyebkVCAv7IU3fG1zjQ.png"/></div></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="f2cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有兴趣了解更多关于应用程序开发的知识，请查看本课程。</p><div class="lv lw gp gr lx ly"><a href="https://click.linksynergy.com/link?id=J2RDo*Rlzkk&amp;offerid=759505.11680934640&amp;type=2&amp;murl=https%3A%2F%2Fwww.coursera.org%2Flearn%2Fapp-deployment-debugging-performance" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">应用部署、调试和性能</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">在本课程中，应用程序开发人员将学习如何设计和开发云原生应用程序，以便无缝地…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">click.linksynergy.com</p></div></div><div class="mh l"><div class="pl l mj mk ml mh mm ks ly"/></div></div></a></div><h1 id="9aac" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">感谢您的阅读！</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://ko-fi.com/mandygu#checkoutModal"><div class="gh gi pm"><img src="../Images/c2fcf86bbf79d7f57582562b51819c0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IED-LbhRFh_vET8NWDCIew.png"/></div></a></figure><p id="23a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这篇文章，可以考虑给我买杯咖啡——每一点小小的贡献都帮助我找到更多的时间在这个博客上工作。请通过Medium 关注我的最新消息。😃</p><p id="cf11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个业余爱好项目，我还在<a class="ae ky" href="http://www.dscrashcourse.com/" rel="noopener ugc nofollow" target="_blank">www.dscrashcourse.com</a>建立了一套全面的<strong class="lb iu">免费</strong>数据科学课程和练习题。</p><p id="8a99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再次感谢您的阅读！📕</p></div></div>    
</body>
</html>