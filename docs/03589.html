<html>
<head>
<title>How to Identify Unusual Observations on Your Regression Model with R?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何识别R回归模型上的异常观察值？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-detect-unusual-observations-on-your-regression-model-with-r-de0eaa38bc5b?source=collection_archive---------6-----------------------#2020-04-05">https://towardsdatascience.com/how-to-detect-unusual-observations-on-your-regression-model-with-r-de0eaa38bc5b?source=collection_archive---------6-----------------------#2020-04-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/222a118103a25be4afc08b148de7eed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xzxJFmd9RmeznGvGl3V1fw.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">兰迪·法特在<a class="ae kf" href="https://unsplash.com/s/photos/different?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c8ec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将讨论一些在回归分析中如何检测异常观察值的方法。作为一个分析师，你可能要考虑筛选不寻常的观察值，这将帮助你得到一个全面的回归模型。不寻常的观察结果需要进一步调查，要么是因为它们与其他观察结果不同，要么是因为它们对模型的结果产生了不成比例的影响。</p><p id="5934" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将回顾三种不同寻常的观察结果:</p><p id="5559" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">极端值</p><p id="db79" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">高杠杆观察</p><p id="f339" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有影响的观察</p><p id="caac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了便于说明，我将使用R样本数据(state.x77)。这个数据集为我们提供了美国50个州的人口数量、平均收入、文盲率、气温和谋杀率等信息。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/edb3ca97dc8de07b83220da1577171ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GxalToUpYhYWnLHkl-nJgw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">来自R的state.x77样本数据</p></figure><p id="9020" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用下面的代码，我想建立一个回归模型，该模型可以根据某些州的人口、收入、文盲率和温度来预测这些州的谋杀率。同样，我们将应用<a class="ae kf" href="https://cran.r-project.org/web/packages/car/car.pdf" rel="noopener ugc nofollow" target="_blank"> <em class="lj">汽车</em> </a> <em class="lj"> </em>包为我们的数据扯皮。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="4aee" class="lp lq it ll b gy lr ls l lt lu"># How to Identify Unusual Observations in Regression?<br/># Created by Michaelino Mervisiano</span><span id="37d6" class="lp lq it ll b gy lv ls l lt lu">install.packages(“car”)<br/>library(“car”)</span><span id="c375" class="lp lq it ll b gy lv ls l lt lu">states &lt;- as.data.frame(state.x77[,c(“Murder”, “Population”,”Illiteracy”, “Income”, “Frost”)])<br/>View(states) </span><span id="33c2" class="lp lq it ll b gy lv ls l lt lu">fit &lt;- lm(Murder ~ Population + Illiteracy + Income + Frost, data=states)<br/>summary(fit)</span></pre><p id="385b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从<em class="lj">总结</em>函数中，我们发现我们的模型确实是显著的，F统计量的p值&lt;为0.05。从t检验中，我们还发现<strong class="ki iu">文盲率</strong>和<strong class="ki iu">人口规模</strong>对预测一个州的谋杀率有重要意义。接下来，我们将调查在我们的模型中是否有不寻常的观察</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="e722" class="lp lq it ll b gy lr ls l lt lu">&gt; summary(fit)</span><span id="e8e0" class="lp lq it ll b gy lv ls l lt lu">Call:<br/>lm(formula = Murder ~ Population + Illiteracy + Income + Frost, <br/> data = states)</span><span id="7361" class="lp lq it ll b gy lv ls l lt lu">Residuals:<br/> Min 1Q Median 3Q Max <br/>-4.7960 -1.6495 -0.0811 1.4815 7.6210</span><span id="77fb" class="lp lq it ll b gy lv ls l lt lu">Coefficients:<br/> Estimate Std. Error t value Pr(&gt;|t|) <br/>(Intercept) 1.235e+00 3.866e+00 0.319 0.7510 <br/>Population 2.237e-04 9.052e-05 2.471 0.0173 * <br/>Illiteracy 4.143e+00 8.744e-01 4.738 2.19e-05 ***<br/>Income 6.442e-05 6.837e-04 0.094 0.9253 <br/>Frost 5.813e-04 1.005e-02 0.058 0.9541 <br/> — -<br/>Signif. codes: 0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1<br/>Residual standard error: 2.535 on 45 degrees of freedom<br/>Multiple R-squared: 0.567, Adjusted R-squared: 0.5285 <br/>F-statistic: 14.73 on 4 and 45 DF, p-value: 9.133e-08</span></pre><blockquote class="lw lx ly"><p id="a21c" class="kg kh lj ki b kj kk kl km kn ko kp kq lz ks kt ku ma kw kx ky mb la lb lc ld im bi translated"><strong class="ki iu">异常值</strong></p></blockquote><p id="edf8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">回归模型不能很好地预测异常值。它们要么有非常大的正残差，要么有非常大的负残差。如果模型低估了响应值，那么它将由正残差表示。另一方面，如果模型高估了响应值，那么它将由负残差指示。</p><p id="1839" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从我们的回归模型示例中，我们可以通过使用Q-Q图开始研究异常值观察。下面的代码有助于您绘制和发现潜在的异常值。内华达州(第28次观察)和罗德岛州(第39次观察)被检测为潜在的异常值。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="09b0" class="lp lq it ll b gy lr ls l lt lu">&gt; qqPlot(fit,labels=row.names(states), id.method=”identify”,<br/>         simulate=TRUE, main=”Q-Q Plot”)<br/> Nevada Rhode Island <br/> 28          39</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/17863ecde8e0880928c27c7f7e735bfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vWQtdwpeWsERHYlJft3RHQ.png"/></div></div></figure><p id="e0dd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">应用<em class="lj"> outlierTest </em>函数帮助我们确认潜在的异常值是否确实是异常值。统计检验表明，内华达州不可否认地被检测为异常值，p值= 0.048。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="cada" class="lp lq it ll b gy lr ls l lt lu">&gt; outlierTest(fit)<br/>       rstudent unadjusted p-value Bonferroni p<br/>Nevada 3.542929         0.00095088     0.047544</span></pre><p id="f199" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Q-Q图也证实了内华达有一个大的正残差。意味着我们的模型低估了这个州的谋杀率。你可以发现内华达州的谋杀率是11.5%，而模型预测只有3.9%。我们清楚地知道，与其他州相比，内华达州确实不同。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="0a96" class="lp lq it ll b gy lr ls l lt lu">&gt; states[“Nevada”,]<br/>        Murder Population Illiteracy Income Frost<br/>Nevada   11.5     590        0.5      5149   188</span><span id="af0a" class="lp lq it ll b gy lv ls l lt lu">&gt; fitted(fit)[“Nevada”]<br/> Nevada <br/>3.878958</span></pre><p id="a8b4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，您可以删除这个观察结果，并重新运行测试来查看是否存在其他异常值。作为一名分析师，你可能想知道为什么内华达州的谋杀率很高。也许你可以把这个问题发到Quora上，让我知道你是否有答案😉</p><blockquote class="lw lx ly"><p id="fdcd" class="kg kh lj ki b kj kk kl km kn ko kp kq lz ks kt ku ma kw kx ky mb la lb lc ld im bi translated"><strong class="ki iu">高杠杆点</strong></p></blockquote><p id="fa8a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们将其与其他预测值进行比较时，如果观察值类似于异常值，则它们将被视为高杠杆点。严格地说，它们具有不常见的预测值组合，而响应值对确定杠杆作用的影响较小。</p><p id="90e3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以通过查看模型中估计的参数数量与样本大小的比率来计算高杠杆观察值。如果观察值的比率大于平均比率的2 -3倍，则该观察值被认为是高杠杆点。我个人喜欢用这个简单的函数来识别高杠杆的观测值。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="a953" class="lp lq it ll b gy lr ls l lt lu">highleverage &lt;- function(fit) {<br/> p &lt;- length(coefficients(fit))<br/> n &lt;- length(fitted(fit))<br/> ratio &lt;-p/n<br/> plot(hatvalues(fit), main=”Index Plot of Ratio”)<br/> abline(h=c(2,3)*ratio, col=”red”, lty=2)<br/> identify(1:n, hatvalues(fit), names(hatvalues(fit)))<br/>}<br/>highleverage(fit)</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/1a32f22fbfb9b4de32d5f02bd81d2f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T6KkKUukbVxuJKWnKOG1FQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">高杠杆点</p></figure><p id="ac12" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上图显示阿拉斯加和加利福尼亚的比例最高。这意味着如果我们将这两种状态的预测值与其他状态进行比较，这两种状态是非常不寻常的。原因如下:</p><p id="fe04" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于阿拉斯加来说，该州的收入比其他州高得多，但人口较少，气温较低。</p><p id="01de" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于加州来说，这个州的人口比其他州多得多，同时收入更高，气温也更高。</p><p id="bb2f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与其他48个州相比，这两个州确实很特别。有一点要记住，并非所有高杠杆的观察都是有影响力的观察。这将取决于他们是否是离群值。</p><blockquote class="lw lx ly"><p id="9656" class="kg kh lj ki b kj kk kl km kn ko kp kq lz ks kt ku ma kw kx ky mb la lb lc ld im bi translated"><strong class="ki iu">有影响的观察</strong></p></blockquote><p id="a052" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对模型参数值具有不成比例影响的观察值可以被认为是有影响的观察值。例如，如果您删除一个观察，那么它会显著地改变您模型。那个单一的观察一定是有影响力的观察。因此，检查我们的数据是否包含有影响的点是很重要的。</p><p id="9a6b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据我的经验，有两种有效的方法来识别有影响的观察结果:</p><p id="5361" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> 1。</strong> <strong class="ki iu">厨师的距离</strong></p><p id="c309" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的代码提供了一种方法来计算截止值，并为我们的每次观察绘制库克距离。该图显示阿拉斯加、夏威夷和内华达是有影响的观察点。移除这3个状态将对我们的回归模型中的截距和斜率值产生重大影响。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="29b3" class="lp lq it ll b gy lr ls l lt lu">cutoff &lt;- 4/(nrow(states)-length(fit$coefficients)-2)<br/>plot(fit, which=4, cook.levels=cutoff)<br/>abline(h=cutoff, lty=2, col=”red”)</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/8345a27d0bc7ba5e35db665abcde6bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BqZ9mreHmm9PvkVg9Pwtiw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">每次观察的库克距离图</p></figure><p id="b742" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我需要强调的是，上面的图确实有助于识别有影响的观察，但是它没有给出关于这些观察如何影响模型的额外信息。这就是为什么<strong class="ki iu">增加的变量</strong>图可以成为我们挖掘更多信息的一个选项。</p><p id="1c3e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> 2。</strong> <strong class="ki iu">增加了可变地块</strong></p><p id="c29c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">附加变量图的工作原理是绘制每个预测变量与响应变量和其他预测变量的关系图。可以使用<em class="lj"> car </em>包中的<em class="lj"> avPlots() </em>函数轻松创建。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="c5a3" class="lp lq it ll b gy lr ls l lt lu">library(car) <br/>avPlots(fit, ask=FALSE, id.method=”identify”)</span></pre><p id="83b6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从下图中，每个图中的直线是该预测变量的实际回归系数。我们可以通过想象如果代表观察结果的点被移走，线会如何变化来观察有影响的观察结果的影响。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mf"><img src="../Images/04270ec0d3a5436785463e76cc367069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6MGkD85B3rgiZNO54r3ReA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">添加了变量图</p></figure><p id="37c4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们将把来自异常值、高杠杆和有影响的观察的所有信息合并到一个单一的信息图中。我个人发现<em class="lj"> influencePlot() </em>是一个非常方便的函数来表示这些不寻常的观察问题。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="31aa" class="lp lq it ll b gy lr ls l lt lu">library(car) <br/>influencePlot(fit, id.method=”identify”, main=”Influence Plot”, sub=”Circle size is proportional to Cook’s distance”)</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mg"><img src="../Images/9725547bb4c936aac3fc82ab5547b6aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ERSUu003Gj4d0gPqo2Xa4w.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">影响图</p></figure><p id="7af8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上图方便地总结了我们的最终裁决。这是:</p><p id="781d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">内华达州和罗德岛州是异常值。</p><p id="ae13" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">加利福尼亚、华盛顿、纽约和夏威夷是<strong class="ki iu">高杠杆观察点</strong></p><p id="36aa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">阿拉斯加是<strong class="ki iu">有影响力的观测地</strong></p><p id="79a4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望你发现这篇文章是有用的，并与他人分享</p><p id="d61e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">干杯，</p><p id="de57" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">米夏里诺·梅尔维西亚诺</p></div></div>    
</body>
</html>