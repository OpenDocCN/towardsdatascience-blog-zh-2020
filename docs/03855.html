<html>
<head>
<title>Scraping, Downloading, and Storing PDFs in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在R中抓取、下载和存储pdf</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scraping-downloading-and-storing-pdfs-in-r-367a0a6d9199?source=collection_archive---------18-----------------------#2020-04-10">https://towardsdatascience.com/scraping-downloading-and-storing-pdfs-in-r-367a0a6d9199?source=collection_archive---------18-----------------------#2020-04-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="2c38" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">网页抓取pdf</h2><div class=""/><div class=""><h2 id="f321" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">嵌套擦伤，以避免按钮点击</h2></div></div><div class="ab cl kr ks hx kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="im in io ip iq"><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/a3a265e50d92ce0f5ab3b9beaa5bc721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mahdor_CBeD4zJW3dnfR8w.jpeg"/></div></div><p class="lk ll gj gh gi lm ln bd b be z dk translated">来源:https://rstudio.com/resources/cheatsheets/</p></figure><p id="d593" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">“汇流”一词的意思是事物的汇合或融合，通常指河流。我在西弗吉尼亚州长大，靠近<a class="ae lo" href="https://www.nps.gov/gari/index.htm" rel="noopener ugc nofollow" target="_blank"> Gauley河</a>(为你椽子准备的世界级白水)和<a class="ae lo" href="https://en.wikipedia.org/wiki/Meadow_River" rel="noopener ugc nofollow" target="_blank"> Meadow河</a>(小嘴鲈鱼的天堂)。汇流这个词也很恰当地描述了我作品中的思想潮流是如何汇聚的。我的工作融合了统计学、数据科学和公共政策。如果是这些河流，数据科学无疑是最小的。虽然现在称自己为“数据科学家”很时髦，但我不是数据科学家。然而，我确实使用了数据科学家的许多工具、技术和流程。</p><p id="6614" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我研究公共政策，因此，我没有形式和度量一致的数据(例如，对你们经济学家来说是美元和美分)。因此，有一天我正在使用机器学习技术对文本进行分类，第二天我正在为这些分类建立测量模型，之后我可能会为与数据相关的一些方面建立一个极端事件模型。所有这些意味着我做了很多数据科学家，特别是那些Tidyverse说服者，称之为“数据争论”的事情——清理、组织和转换数据以供分析。</p><p id="5ad5" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我经常忘记需要处理数据的各种命令。RStudio为数据科学和统计的各种包和过程提供了一套很好的备忘单。它们以pdf海报的形式出现，就像你在会议上看到的那样。我的问题是，我经常在西弗吉尼亚州的旅馆工作，那里的互联网连接是一个挑战，背景是高利河峡谷的轰鸣声。这意味着我经常搜索和下载我认为可能需要的备忘单。因为备忘单会不时更新，所以我冒着在本地存储过期备忘单的风险。这一切促使我考虑编写一个简短的脚本来访问所有RStudio备忘单并将其下载到本地。关于代码…</p><h1 id="0b12" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">加载有用的库</h1><p id="cd4d" class="pw-post-body-paragraph lp lq it lr b ls nd kd lu lv ne kg lx ly nf ma mb mc ng me mf mg nh mi mj mk im bi translated">至少对于那些使用r的人来说，<code class="fe ni nj nk nl b">tidyverse</code>是这些类型操作的主力，特别是，<code class="fe ni nj nk nl b">rvest</code>是读取和解析HTML的主要工具。最后，<code class="fe ni nj nk nl b">stringr</code>提供了一致的处理文本字符串的方法——在抓取URL列表时非常有用。</p><pre class="kz la lb lc gt nm nl nn no aw np bi"><span id="f5b9" class="nq mm it nl b gy nr ns l nt nu">library(tidyverse)<br/>library(rvest)<br/>library(stringr)</span></pre><h1 id="afbf" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">抓取链接和下载文件</h1><p id="6ef6" class="pw-post-body-paragraph lp lq it lr b ls nd kd lu lv ne kg lx ly nf ma mb mc ng me mf mg nh mi mj mk im bi translated">下面的代码行通过识别和读取包含RStudio Cheatsheets的pdf的Github存储库的HTML来开始抓取。</p><pre class="kz la lb lc gt nm nl nn no aw np bi"><span id="5378" class="nq mm it nl b gy nr ns l nt nu">page &lt;- read_html("https://www.github.com/rstudio/cheatsheets")</span></pre><p id="56e2" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">如果您访问该存储库，您会发现单击表格中的一个pdf文件并不会单独生成相关的备忘单。它将我们带到存储库的第二级页面，并在代码编辑器中打开文件。获取文件以便在工作中引用意味着单击代码编辑器顶部菜单栏上的下载按钮。当然，没有什么刮擦练习是真正简单的。要获取文件，我们需要找到一种绕过“点击”下载按钮的方法。明确地说，一些脚本允许我们“点击”按钮，但是我在<code class="fe ni nj nk nl b">jsonlite</code>中找到的那些比我在这里做的更复杂(虽然更有效)。</p><pre class="kz la lb lc gt nm nl nn no aw np bi"><span id="86e8" class="nq mm it nl b gy nr ns l nt nu">raw_list &lt;- page %&gt;% <em class="nv"># takes the page above for which we've read the html</em><br/>  html_nodes("a") %&gt;%  <em class="nv"># find all links in the page<br/>  </em>html_attr("href") %&gt;% <em class="nv"># get the url for these links<br/>  </em>str_subset("\\.pdf") %&gt;% <em class="nv"># find those that end in pdf only<br/>  </em>str_c("https://www.github.com", .) %&gt;% <em class="nv"># prepend the website to the url<br/>  </em><strong class="nl jd">map</strong>(read_html) %&gt;% <em class="nv"># take previously generated list of urls and read them</em><br/>  <strong class="nl jd">map</strong>(html_node, "#raw-url") %&gt;% <em class="nv"># parse out the 'raw' url - the link for the download button</em><br/>  <strong class="nl jd">map</strong>(html_attr, "href") %&gt;% <em class="nv"># return the set of raw urls for the download buttons</em><br/>  str_c("https://www.github.com", .) %&gt;% <em class="nv"># prepend the website again to get a full url</em><br/>  walk2(., basename(.), download.file, mode = "wb") <em class="nv"># use purrr to download the pdf associated with each url to the current working directory</em></span></pre><p id="050a" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我利用存储库主页上的链接来访问、记录和获取与每个备忘单的下载按钮相关联的链接列表。这种解决方法不需要为每个按钮编写一个“点击”按钮的脚本。这个脚本不是最高效的，但是您最终会在本地工作目录中找到所有优秀的RStudio备忘单。</p><p id="1c11" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">前置很重要，因为每个对<code class="fe ni nj nk nl b">read_html</code>的调用都需要完整的URL。反过来，<code class="fe ni nj nk nl b">html_nodes</code>和<code class="fe ni nj nk nl b">html_attr</code>中的解析依赖于已经读取了HTML。来自<code class="fe ni nj nk nl b">stringr</code>的字符串折叠函数<code class="fe ni nj nk nl b">str_c</code>使这变得容易。对于解析，我们使用Tidyverse包<code class="fe ni nj nk nl b">purrr</code>中的<code class="fe ni nj nk nl b">map</code>函数。</p><h1 id="3b79" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">重要花絮</h1><ul class=""><li id="be7e" class="nw nx it lr b ls nd lv ne ly ny mc nz mg oa mk ob oc od oe bi translated">在最初的抓取中，<code class="fe ni nj nk nl b">str_subset("\\.pdf")</code>告诉R返回所有带有pdf的链接。否则，您将获得整个存储库的链接，包括开发文件。</li><li id="3ece" class="nw nx it lr b ls of lv og ly oh mc oi mg oj mk ob oc od oe bi translated"><code class="fe ni nj nk nl b">map(html_node, "#raw-url")</code>告诉R查找与每个备忘单的下载按钮相关联的URL。您可以通过使用Google的选择器小工具来识别这个标签——在上面搜索例子以及如何识别标签。</li><li id="940e" class="nw nx it lr b ls of lv og ly oh mc oi mg oj mk ob oc od oe bi translated"><code class="fe ni nj nk nl b">purrr::walk2</code>将<code class="fe ni nj nk nl b">download.file</code>函数应用于每个生成的原始链接。的“.”告诉它使用前一个命令中的数据(原始URL)。<code class="fe ni nj nk nl b">basename(.)</code>告诉它给下载的文件一个URL的基本名称(例如，“purrr.pdf”)。</li><li id="e2a7" class="nw nx it lr b ls of lv og ly oh mc oi mg oj mk ob oc od oe bi translated">根据您的pdf阅读器，您可能需要添加<code class="fe ni nj nk nl b">mode = "wb"</code>。否则，文件可能会显示为空白、损坏或无法正确呈现。更多信息参见<code class="fe ni nj nk nl b">download.file()</code>命令的文档。</li></ul><h1 id="c390" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">老派</h1><p id="b942" class="pw-post-body-paragraph lp lq it lr b ls nd kd lu lv ne kg lx ly nf ma mb mc ng me mf mg nh mi mj mk im bi translated">请注意，Tidyverse的<code class="fe ni nj nk nl b">walk2</code>和许多其他伟大的功能本身并不必要。下面的for循环是上面的<code class="fe ni nj nk nl b">walk2</code>的老式实现。这里，<code class="fe ni nj nk nl b">download.file</code>应用于<code class="fe ni nj nk nl b">raw_list</code>中的每个URL(URL在这里只是对象<code class="fe ni nj nk nl b">raw_list</code>中每一行的标签)。</p><pre class="kz la lb lc gt nm nl nn no aw np bi"><span id="e004" class="nq mm it nl b gy nr ns l nt nu">for (url in raw_list){ download.file(url, destfile = basename(url), mode = "wb") }</span></pre><h1 id="f65b" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">包扎</h1><p id="7ac9" class="pw-post-body-paragraph lp lq it lr b ls nd kd lu lv ne kg lx ly nf ma mb mc ng me mf mg nh mi mj mk im bi translated">因此，对于需要“点击按钮”的地方来说，这不是最有效的代码，但是它用最少的包和对<code class="fe ni nj nk nl b">json</code>或其他语言的了解就完成了工作。现在我们已经完成了，我还可以说在<a class="ae lo" href="https://rstudio.com/resources/cheatsheets/" rel="noopener ugc nofollow" target="_blank"> RStudio的</a>资源页面上可以找到备忘单。在那里，它们会更容易抓取，当然你可以点击下载。我经常向学生提及它们，因为它们是数据分析和统计教学的重要资源。</p></div><div class="ab cl kr ks hx kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="im in io ip iq"><p id="3eaf" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated"><em class="nv">原载于2020年4月10日https://www.samuelworkman.org</em><a class="ae lo" href="https://www.samuelworkman.org/blog/scraping-up-bits-of-helpfulness/" rel="noopener ugc nofollow" target="_blank"><em class="nv"/></a><em class="nv">。</em></p></div></div>    
</body>
</html>