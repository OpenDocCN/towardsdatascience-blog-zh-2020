<html>
<head>
<title>Pandas to look for the cutest cat per town</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫在每个城镇寻找最可爱的猫</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandas-to-look-for-the-cutest-cat-per-town-fbaffc7363c9?source=collection_archive---------54-----------------------#2020-06-06">https://towardsdatascience.com/pandas-to-look-for-the-cutest-cat-per-town-fbaffc7363c9?source=collection_archive---------54-----------------------#2020-06-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/6cb361bbfa73155acd90a982a377848b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hU2NZPggho_Oyg-s9U7QQw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://unsplash.com/@tsaiwen_hsu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">蔡文许</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的原图，本人编辑。</p></figure><div class=""/><div class=""><h2 id="0203" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">熊猫的有趣介绍——Python 数据分析库</h2></div><p id="94dc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">嗨，在<a class="ae jg" href="https://medium.com/activeai/finding-meow-the-cutest-cat-from-each-town-using-elastic-search-29a9417bc24d" rel="noopener">的上一篇文章</a>中，我们看到了使用 SQL 和 Elasticsearch 解决典型的<em class="lu">每组最大数量</em>的问题。本文将探讨如何使用强大的 Python 数据分析库<a class="ae jg" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> <em class="lu"> Pandas </em> </a>来解决这个问题。🐼</p><p id="9156" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">熊猫得到了两个重要的数据结构<a class="ae jg" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html" rel="noopener ugc nofollow" target="_blank">系列</a>和<a class="ae jg" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank">数据帧</a>。我们将探索 Pandas DataFrame 数据结构和它的一些功能来解决我们的问题。说问题，没看过上一篇的我来解释一下。在一个城镇里，会有许多可爱的猫。我们要从每个镇只挑一只最可爱的猫，它的名字叫喵(或者类似喵，以后会看到)。</p><p id="7469" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想跟进，我建议你参考<a class="ae jg" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/install.html" rel="noopener ugc nofollow" target="_blank">熊猫官方网站</a>进行本地设置，或者你可以在<a class="ae jg" href="https://www.kaggle.com/sharmasha2nk/finding-meow" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上创建一个新的笔记本。甚至提交你的<a class="ae jg" href="https://www.kaggle.com/sharmasha2nk/finding-meow/tasks?taskId=1056" rel="noopener ugc nofollow" target="_blank"> Kaggle 找喵任务</a>的解决方案。</p><p id="79eb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们用一个小的猫的数据集，列 id，猫的名字，城镇，可爱程度从 1 到 10，10 是最可爱的。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">资料组</p></figure><p id="3c9d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该数据集的预期输出为:</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">预期结果</p></figure><p id="dea4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们将 pandas 库作为<code class="fe mb mc md me b">pd</code>导入，并用样本数据集创建一个数据帧<code class="fe mb mc md me b">df</code>。有许多方法可以创建数据帧。下面我提供了三个选项。选项 1 使用字典；选项 2，通过加载本地可用的 CSV 文件；选项 3 从 URL 读取 CSV 文件。</p><p id="b6ca" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦创建了数据帧，就可以使用<code class="fe mb mc md me b">df.head()</code>方法从数据帧中获取前 5 行。可选地，您可以传递要检索的行数，比如<code class="fe mb mc md me b">df.head(10)</code>，检索前 10 行。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">创建数据框架</p></figure><p id="c0a9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">类似于<code class="fe mb mc md me b">df.head(n)</code>方法，有<code class="fe mb mc md me b">df.tail(n)</code>返回最后 n 条记录。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">df.tail()</p></figure><p id="cefc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mb mc md me b">df.columns</code>将返回所有的列名。<br/> <code class="fe mb mc md me b">df.shape</code>返回表示数据帧维度的元组。比如我们的 DataFrame，(10，4)，这意味着 10 行 4 列。<br/> <code class="fe mb mc md me b">df.size</code>返回一个表示该对象中元素个数的 int。比如我们的数据帧，40 (10*4)</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">数据帧信息</p></figure><p id="e413" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了获得数据帧的简明摘要，我们可以使用<code class="fe mb mc md me b">df.info()</code>。我们的数据有 4 个非空列，每个列有 10 个条目。<code class="fe mb mc md me b">id</code>和<code class="fe mb mc md me b">cuteness</code>为表示数字的<code class="fe mb mc md me b">int64</code>数据类型。<code class="fe mb mc md me b">name</code>和<code class="fe mb mc md me b">town</code>作为一个<code class="fe mb mc md me b">object</code>。如果您正在处理一些未知的数据，这可能是方便的信息。</p><p id="6d08" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">其中<code class="fe mb mc md me b">df.info</code>提供关于数据类型、内存使用等的信息。，我们可以使用<code class="fe mb mc md me b">df.describe()</code>来获得统计数据。你可以参考官方的<a class="ae jg" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.describe.html#pandas.DataFrame.describe" rel="noopener ugc nofollow" target="_blank">文件</a>来理解这些数字的含义。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">数据帧描述</p></figure><p id="bf1a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要引用特定的列数据，您可以像<code class="fe mb mc md me b">df['town']</code>一样访问并对其执行查询。想要获得列 town 的唯一值，我们可以运行<code class="fe mb mc md me b">df['town'].unique()</code>。或者获取每个城镇的值计数，<code class="fe mb mc md me b">df['town'].value_counts()</code>。根据我们的数据，我们在德里有 4 只猫，在孟买和班加罗尔各有 2 只猫&amp; Meerut，我们必须在每个城镇中找出 1 只最可爱的猫。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">唯一计数</p></figure><p id="dd5a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要查看每个城镇每列的最大值，我们可以按城镇对数据进行分组，并使用 max 函数。如果你看下面的结果，乍一看，它可能似乎是我们问题的解决方案(忽略名称条件)，但它肯定不是。像我前面说的，它分别返回每一列的最大值<strong class="la jk"/>。如您所见，我们没有 id 和姓名为 5、tom 可爱度为 10 的记录。尽管我们在班加罗尔的最大 id 是 8。同样，在密鲁特和孟买，9 是最大的可爱。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">最大</p></figure><p id="4882" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要找到名为喵的猫，我们必须添加过滤器。我们可以通过多种方式查询数据。比如<code class="fe mb mc md me b">df[df['name']=='meow']</code>或者使用<code class="fe mb mc md me b">df.query()</code>执行字符串查询。本文将使用前一个。但是，在某些情况下，后一种方法可能更有用，比如您从一些外部来源获取这些查询。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">询问</p></figure><p id="0d11" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">根据我们的任务，我们不仅要寻找猫名"喵",还要寻找听起来相似的猫名。所以将修改我们的搜索查询来查找包含喵的名字。我们将如何使用<code class="fe mb mc md me b">.str</code>将列转换为字符串，并使用字符串的 contains 方法。看看下面的搜索结果，现在我们有了猫的子集，它们的名字叫喵或者听起来像喵。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">包含查询</p></figure><p id="c36e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于猫的子集，让我们按城镇将它们分组，并找出每个城镇的最大可爱程度。这给了我们每个城镇最大的可爱度，但是我们还没有从这个结果中识别出猫。我们丢失了一些列，如 id 和 name。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">分组依据</p></figure><p id="3797" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，不是取出可爱列并对其应用一个<code class="fe mb mc md me b">max</code>函数，而是对整个<code class="fe mb mc md me b">DataFrameGroupBy</code>对象应用一个 lambda 函数，返回一个以城镇为索引的数据帧。如果你检查下面的结果，现在我们有城镇作为一个列和一个索引。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">分类</p></figure><p id="788d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在有了这个数据框架，我们可以再次按城镇分组，并从每个组中获得第一个条目，这就是我们的解决方案。但是如果我们这样做，我们会得到一个异常，因为<code class="fe mb mc md me b">town</code>既是一个索引级别又是一个列标签，这是不明确的。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">错误</p></figure><p id="a79a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们能做的是在做另一个 group by 之前重置索引。我们可以在<code class="fe mb mc md me b">df.reset_index(drop<strong class="la jk">=</strong>True)</code>前完成。<code class="fe mb mc md me b">drop=True</code>选项将避免索引作为一列添加到结果数据帧中。或者更好的是，我们可以使用<code class="fe mb mc md me b">groupby</code>方法的现有选项<code class="fe mb mc md me b">as_index=False</code>，这将产生类似的结果。</p><p id="2a3e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看看下面的解决方案，我们可以在每个城镇找到名字为喵或与之相似的最可爱的猫。</p><p id="ed47" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是它与我们预期的解决方案不匹配😳。对于德里，我们期待 id 为 5 的猫，而不是 3。我们遗漏了任务的一部分，我们必须优先选择名字叫喵的猫，而不是名字听起来像喵的猫。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">解决办法</p></figure><p id="54c9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，一种方法是我们添加另一个得分字段。假设猫的名字不能超过 100 个单词，我们可以使用公式<code class="fe mb mc md me b">(cuteness of cat * 100) — length of the name</code>给每只猫打分。所以即使两只猫的可爱度都是 10。喵喵猫会得分<code class="fe mb mc md me b">10*100-4 = 996</code>，卡米诺会得分<code class="fe mb mc md me b">10*100-6 = 994</code>。有趣的是，我们的分数不会因为可爱程度不同而重叠。比如，如果可爱度是 10，分数将在范围<code class="fe mb mc md me b">10*100-100 = 900</code>到<code class="fe mb mc md me b">10*100-4 = 996</code>之间。如果可爱度是 9，分数将在<code class="fe mb mc md me b">9*100-100 = 800</code>到<code class="fe mb mc md me b">9*100-4 = 896</code>的范围内。所以我们可以安全地使用这个公式。</p><p id="90bb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要向我们的 DataFrame 添加一个新列，我们可以简单地做如下的事情。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">新列</p></figure><p id="3e6c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以现在对于我们的最终解决方案，我们可以用可爱度排序代替 total _ score，我们得到了正确的结果。🤗</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="lz ma l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">最终解决方案</p></figure><p id="4ff3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！如果你有任何疑问或者你觉得你知道一个更好的方法来“找到喵”，请发表评论</p><p id="9fe2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">页（page 的缩写）准备好迎接每镇最可爱的猫挑战了吗？在推特上发布你对熊猫的最佳解决方案，标签为# <em class="lu">每镇最可爱的猫，#findingmeow </em>👨‍💻或者下面评论。如果我们发现您的解决方案比我们的更好，我们将附上您的姓名和您提交的内容。</p></div></div>    
</body>
</html>