<html>
<head>
<title>Graphics in R with ggplot2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带 ggplot2 的 R 中的图形</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/graphics-in-r-with-ggplot2-9380cbfe116a?source=collection_archive---------25-----------------------#2020-08-21">https://towardsdatascience.com/graphics-in-r-with-ggplot2-9380cbfe116a?source=collection_archive---------25-----------------------#2020-08-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b133" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用 ggplot2 软件包在 R 中创建专业的图形和绘图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/124ca09a32a3fb427bbb4c18f6f49af6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lMC8n6SRX1lpzr0K"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@isaacmsmith?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">艾萨克·史密斯</a></p></figure><h1 id="9729" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="f83f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi mn translated">众所周知，R 在图形和可视化方面是一种非常强大的编程语言(当然除了<a class="ae ky" href="https://www.statsandr.com/tags/statistics/" rel="noopener ugc nofollow" target="_blank">统计学</a>和数据科学！).</p><p id="0b07" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">为了保持简短，R 中的图形可以通过三种方式完成，通过:</p><ol class=""><li id="98eb" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm ng nh ni nj bi translated"><code class="fe nk nl nm nn b">{graphics}</code>包(R 中的基本图形，默认加载)</li><li id="44fa" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm ng nh ni nj bi translated"><code class="fe nk nl nm nn b">{lattice}</code>为基础套装增加更多功能的套装</li><li id="000d" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm ng nh ni nj bi translated"><code class="fe nk nl nm nn b">{ggplot2}</code>包(需要预先<a class="ae ky" href="https://www.statsandr.com/blog/an-efficient-way-to-install-and-load-r-packages/" rel="noopener ugc nofollow" target="_blank">安装并加载</a></li></ol><p id="f96d" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated"><code class="fe nk nl nm nn b">{graphics}</code>包自带大量剧情选择(如<code class="fe nk nl nm nn b">plot</code>、<code class="fe nk nl nm nn b">hist</code>、<code class="fe nk nl nm nn b">barplot</code>、<code class="fe nk nl nm nn b">boxplot</code>、<code class="fe nk nl nm nn b">pie</code>、<code class="fe nk nl nm nn b">mosaicplot</code>等)。)和附加的相关特征(例如，<code class="fe nk nl nm nn b">abline</code>、<code class="fe nk nl nm nn b">lines</code>、<code class="fe nk nl nm nn b">legend</code>、<code class="fe nk nl nm nn b">mtext</code>、<code class="fe nk nl nm nn b">rect</code>等)。).对于大多数 R 用户，尤其是初学者到中级用户，这通常是绘制图形的首选方式。</p><p id="d2f7" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">自从 Hadley Wickham 在 2005 年创建以来，<code class="fe nk nl nm nn b"><strong class="lt iu">{ggplot2}</strong></code>已经成为最受欢迎的 R 包之一，也是最受欢迎的图形和数据可视化包。<code class="fe nk nl nm nn b">{ggplot2}</code>软件包是一种更现代的创建专业质量图形的方法。更多关于这个包的信息可以在 ggplot2.tidyverse.org 找到。</p><p id="2f71" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">在本文中，我们将看到如何用这个包在 R 中创建常见的图，如散点图、线图、直方图、箱线图、条形图、密度图。如果你不熟悉这些类型的图表，你会找到更多关于每一个的信息(何时使用，它的目的，它显示什么，等等。)在我关于 R 中<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/" rel="noopener ugc nofollow" target="_blank">描述性统计的文章中。</a></p><h1 id="44f1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">数据</h1><p id="8d87" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了说明使用<code class="fe nk nl nm nn b">{ggplot2}</code>包的图，我们将使用包中可用的<code class="fe nk nl nm nn b">mpg</code>数据集。该数据集包含美国环境保护署从 1999 年到 2008 年收集的 38 种流行车型的燃油经济性观察数据(运行<code class="fe nk nl nm nn b">?mpg</code>了解更多数据信息):</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="effc" class="nx la it nn b gy ny nz l oa ob">library(ggplot2)<br/>dat &lt;- ggplot2::mpg</span></pre><p id="8d97" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">在继续之前，让我们用<code class="fe nk nl nm nn b">transform()</code>函数转换<a class="ae ky" href="https://www.statsandr.com/blog/data-types-in-r/#factor" rel="noopener ugc nofollow" target="_blank">因子</a>中的<code class="fe nk nl nm nn b">cyl</code>、<code class="fe nk nl nm nn b">drv</code>、<code class="fe nk nl nm nn b">fl</code>、<code class="fe nk nl nm nn b">year</code>和<code class="fe nk nl nm nn b">class</code>变量:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="fa9d" class="nx la it nn b gy ny nz l oa ob">dat &lt;- transform(dat,<br/>  cyl = factor(cyl),<br/>  drv = factor(drv),<br/>  fl = factor(fl),<br/>  year = factor(year),<br/>  class = factor(class)<br/>)</span></pre><p id="bd5c" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">对于感兴趣的读者，请参阅 R 中的更多<a class="ae ky" href="https://statsandr.com/blog/data-manipulation-in-r/" rel="noopener ugc nofollow" target="_blank">数据操作技术。</a></p><h1 id="248b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><code class="fe nk nl nm nn b">{ggplot2}</code>的基本原理</h1><p id="7120" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe nk nl nm nn b">{ggplot2}</code>包基于“图形语法”的原则(因此<code class="fe nk nl nm nn b">{ggplot2}</code>的名字是“gg”)，也就是一个描述和构建图形的连贯系统。主要想法是<strong class="lt iu">设计一个图形作为一系列层</strong>。</p><p id="7d4d" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">主要层有:</p><ol class=""><li id="ddc5" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm ng nh ni nj bi translated">包含我们想要表示的变量的数据集。这是通过<code class="fe nk nl nm nn b">ggplot()</code>功能完成的，并且排在第一位。</li><li id="e5d3" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm ng nh ni nj bi translated">要在 x 和/或 y 轴上表示的<strong class="lt iu">变量</strong>，以及要表示的对象的美学元素(如颜色、大小、填充、形状和透明度)。这是通过<code class="fe nk nl nm nn b">aes()</code>功能(美学的缩写)完成的。</li><li id="53df" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm ng nh ni nj bi translated"><strong class="lt iu">类型的图形表示</strong>(散点图、线图、条形图、直方图、箱线图等)。).这是通过<code class="fe nk nl nm nn b">geom_point()</code>、<code class="fe nk nl nm nn b">geom_line()</code>、<code class="fe nk nl nm nn b">geom_bar()</code>、<code class="fe nk nl nm nn b">geom_histogram()</code>、<code class="fe nk nl nm nn b">geom_boxplot()</code>等功能完成的。</li><li id="88a5" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm ng nh ni nj bi translated">如果需要，附加层(如标签、注释、比例、轴刻度、图例、主题、小平面等。)可以加进去个性化剧情。</li></ol><p id="457b" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">为了创建一个图，我们首先需要在<code class="fe nk nl nm nn b">ggplot()</code>函数中指定数据，然后添加所需的层，如变量、美学元素和图的类型:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="5373" class="nx la it nn b gy ny nz l oa ob">ggplot(data) +<br/>  aes(x = var_x, y = var_y) +<br/>  geom_x()</span></pre><ul class=""><li id="3ea0" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm oc nh ni nj bi translated"><code class="fe nk nl nm nn b">ggplot()</code>中的<code class="fe nk nl nm nn b">data</code>是包含变量<code class="fe nk nl nm nn b">var_x</code>和<code class="fe nk nl nm nn b">var_y</code>的数据帧的名称。</li><li id="51af" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated"><code class="fe nk nl nm nn b">+</code>符号用于指示将被添加到绘图的不同层。确保将<code class="fe nk nl nm nn b">+</code> <em class="od">符号写在代码行</em>的末尾，而不是行首，否则 R 抛出错误。</li><li id="817c" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">层<code class="fe nk nl nm nn b">aes()</code>表示什么样的变量将被用在剧情中，更一般地说，是剧情的美学元素。</li><li id="5e1c" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">最后，<code class="fe nk nl nm nn b">geom_x()</code>中的<code class="fe nk nl nm nn b">x</code>代表剧情类型。</li><li id="38f1" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">其他层通常是不需要的，除非我们想进一步个性化情节。</li></ul><p id="2595" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">请注意，为提高代码可读性，每层编写一行代码是一个很好的做法。</p><h1 id="0cc7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">用<code class="fe nk nl nm nn b">{ggplot2}</code>创建图</h1><p id="6e10" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在以下章节中，我们将展示如何绘制以下图形:</p><ul class=""><li id="ac24" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm oc nh ni nj bi translated">散点图</li><li id="981d" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">线形图</li><li id="69ad" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">柱状图</li><li id="d91d" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">密度图</li><li id="ccb6" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">箱线图</li><li id="cd3e" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">条形图</li></ul><p id="a3d0" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">为了将重点放在不同情节的构建和<code class="fe nk nl nm nn b">{ggplot2}</code>的使用上，我们将限制自己只画基本的(但很漂亮的)情节，不画不必要的图层。为了完整起见，我们将在文章的最后简要讨论和说明不同的层，以进一步个性化一个情节(见本<a class="ae ky" href="https://www.statsandr.com/blog/graphics-in-r-with-ggplot2/#further-personalization" rel="noopener ugc nofollow" target="_blank">节</a>)。</p><p id="2d05" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">请注意，如果你在阅读完本教程后仍然难以用<code class="fe nk nl nm nn b">{ggplot2}</code>创建剧情，你可能会发现<a class="ae ky" href="https://www.statsandr.com/blog/rstudio-addins-or-how-to-make-your-coding-life-easier/#esquisse" rel="noopener ugc nofollow" target="_blank"> {esquisse}插件</a>很有用。这个插件允许你用<code class="fe nk nl nm nn b">{ggplot2}</code>包<strong class="lt iu">交互</strong>(即通过拖放变量)创建图形。试试看！</p><h1 id="25db" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">散点图</h1><p id="54e9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们首先使用<code class="fe nk nl nm nn b">geom_point</code>创建一个<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/#scatterplot" rel="noopener ugc nofollow" target="_blank">散点图</a>。请记住，散点图用于可视化两个<a class="ae ky" href="https://www.statsandr.com/blog/variable-types-and-examples/#quantitative" rel="noopener ugc nofollow" target="_blank">定量变量</a>之间的关系。</p><ol class=""><li id="9fb8" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm ng nh ni nj bi translated">我们从指定数据开始:</li></ol><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="5dd8" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) # data</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/c3fe56edc89114a49411566d5aab969a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NyTr8PbEwmRJ5n2E.png"/></div></div></figure><p id="ea5b" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">2.然后我们添加用<code class="fe nk nl nm nn b">aes()</code>函数表示的变量:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="f8e3" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) + # data<br/>  aes(x = displ, y = hwy) # variables</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/7521224e1d3ad441c148bc8d4d958731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RGxvMvS6GHxfG3W0.png"/></div></div></figure><p id="591b" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">3.最后，我们指出情节的类型:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="e418" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) + # data<br/>  aes(x = displ, y = hwy) + # variables<br/>  geom_point() # type of plot</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/a6ec2d5211541ac22a3bfce3f0e433d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EFy2nJITJc4Mn1SP.png"/></div></div></figure><p id="6b70" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">除了数据集之外，您有时还会看到<code class="fe nk nl nm nn b">ggplot()</code>函数中的美学元素(【T2 与变量】):</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="9133" class="nx la it nn b gy ny nz l oa ob">ggplot(mpg, aes(x = displ, y = hwy)) +<br/>  geom_point()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/fa81168364c705039daed4a94d862e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aRY35L11FyTYXMPc.png"/></div></div></figure><p id="ddec" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">第二种方法给出的图与第一种方法完全相同。为了获得更好的可读性，我倾向于选择第一种方法，但这更多的是个人喜好的问题，所以选择由你决定。</p><h1 id="3991" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">线形图</h1><p id="9d9f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/#line-plot" rel="noopener ugc nofollow" target="_blank">线形图</a>，在时间序列或金融中特别有用，可以类似地创建，但使用<code class="fe nk nl nm nn b">geom_line()</code>:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="db9a" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = displ, y = hwy) +<br/>  geom_line()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/77c02e400e1893544860cca104c33f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FvKq7Cg7WmfrKqWx.png"/></div></div></figure><h1 id="8dc3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">线和点的结合</h1><p id="14cc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe nk nl nm nn b">{ggplot2}</code>的一个优势是能够结合多种类型的情节，并且设计灵活。例如，我们可以通过简单地向初始散点图添加一个层来向散点图添加一条线:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="550f" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = displ, y = hwy) +<br/>  geom_point() +<br/>  geom_line() # add line</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/c031f442148674eb40a09d0e30f36440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*THzMIUbBAgOBYtWi.png"/></div></div></figure><h1 id="be11" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">柱状图</h1><p id="b5a7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">可以使用<code class="fe nk nl nm nn b">geom_histogram()</code>绘制<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/#histogram" rel="noopener ugc nofollow" target="_blank">直方图</a>(用于可视化分布和检测潜在的<a class="ae ky" href="https://www.statsandr.com/blog/outliers-detection-in-r/" rel="noopener ugc nofollow" target="_blank">异常值</a>):</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="1d10" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = hwy) +<br/>  geom_histogram()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/f3077a58a73368f1eebb235b7d635f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WxLOlBH6gdEPEkr7.png"/></div></div></figure><p id="cfe7" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">默认情况下，箱的数量等于 30。您可以使用<code class="fe nk nl nm nn b">geom_histogram()</code>函数中的<code class="fe nk nl nm nn b">bins</code>参数来更改该值:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="847d" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = hwy) +<br/>  geom_histogram(bins = sqrt(nrow(dat)))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/5a20ca6afa11e8f36740e97c20448ee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vvGXWeRsIK_yC9tU.png"/></div></div></figure><p id="d97d" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">这里我指定箱的数量等于观察数量的平方根(遵循斯特奇法则),但是您可以指定任何数值。</p><h1 id="ee64" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">密度图</h1><p id="a431" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/#density-plot" rel="noopener ugc nofollow" target="_blank">密度图</a>可以使用<code class="fe nk nl nm nn b">geom_density()</code>创建:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="4b87" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = hwy) +<br/>  geom_density()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/5f39015d986af9d93a7d753cdb9054ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ANJ2WwAncwsG_hCX.png"/></div></div></figure><h1 id="594c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">直方图和密度的组合</h1><p id="b3c3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们也可以在同一个图上叠加直方图和密度曲线:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="ff70" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = hwy, y = ..density..) +<br/>  geom_histogram() +<br/>  geom_density()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/db1789d9a79660fffb62d81f95e359b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AjhPit1aXlG1mUgC.png"/></div></div></figure><p id="ca52" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">或者叠加几个密度:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="0744" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = hwy, color = drv, fill = drv) +<br/>  geom_density(alpha = 0.25) # add transparency</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/5ff8f3769873ac14d26a1a15a3d78cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tnzNHsIdbN8netle.png"/></div></div></figure><p id="fd79" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">为了增加透明度，增加了参数<code class="fe nk nl nm nn b">alpha = 0.25</code>。关于这个论点的更多信息可以在这个<a class="ae ky" href="https://www.statsandr.com/blog/graphics-in-r-with-ggplot2/#further-personalization" rel="noopener ugc nofollow" target="_blank">部分</a>中找到。</p><h1 id="8e3b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">箱线图</h1><p id="17fa" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">可以使用<code class="fe nk nl nm nn b">geom_boxplot()</code>绘制一个<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/#boxplot" rel="noopener ugc nofollow" target="_blank">箱线图</a>(对可视化分布和检测潜在的<a class="ae ky" href="https://www.statsandr.com/blog/outliers-detection-in-r/" rel="noopener ugc nofollow" target="_blank">异常值</a>也非常有用):</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="f6f5" class="nx la it nn b gy ny nz l oa ob"># Boxplot for one variable<br/>ggplot(dat) +<br/>  aes(x = "", y = hwy) +<br/>  geom_boxplot()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/b4f41e5f1e7d43c2d45063e1883ef07a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-CryCznC9u81CoGu.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="0bda" class="nx la it nn b gy ny nz l oa ob"># Boxplot by factor<br/>ggplot(dat) +<br/>  aes(x = drv, y = hwy) +<br/>  geom_boxplot()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/0229196e2cabd1c954bb137fe58aade9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yCf16fVXmLqhVoe3.png"/></div></div></figure><p id="7956" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">也可以用<code class="fe nk nl nm nn b">geom_jitter()</code>在箱线图上绘制点，并用<code class="fe nk nl nm nn b">varwidth = TRUE</code>根据每个级别的大小(即观察次数)改变方框的宽度:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="9460" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = drv, y = hwy) +<br/>  geom_boxplot(varwidth = TRUE) + # vary boxes width according to n obs.<br/>  geom_jitter(alpha = 0.25, width = 0.2) # adds random noise and limit its width</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/4c50aa5973a3bb8d8684bec007b694d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KwrtP6-eSW-UgXwL.png"/></div></div></figure><p id="4cbd" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated"><code class="fe nk nl nm nn b">geom_jitter()</code>层给每个点添加一些随机变化，以防止它们重叠(一个被称为过度绘制的问题)。<a class="ae ky" href="https://www.statsandr.com/blog/graphics-in-r-with-ggplot2/#fn1" rel="noopener ugc nofollow" target="_blank"> 1 </a>此外，<code class="fe nk nl nm nn b">alpha</code>参数为点增加了一些透明度(详见本<a class="ae ky" href="https://www.statsandr.com/blog/graphics-in-r-with-ggplot2/#further-personalization" rel="noopener ugc nofollow" target="_blank">部分</a>)以保持焦点在框上而不是点上。</p><p id="2d6b" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">最后，也可以根据<a class="ae ky" href="https://www.statsandr.com/blog/variable-types-and-examples/#qualitative" rel="noopener ugc nofollow" target="_blank">定性变量</a>的水平将箱线图分成几个面板:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="369d" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = drv, y = hwy) +<br/>  geom_boxplot(varwidth = TRUE) + # vary boxes width according to n obs.<br/>  geom_jitter(alpha = 0.25, width = 0.2) + # adds random noise and limit its width<br/>  facet_wrap(~year) # divide into 2 panels</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/b1ad688687c20e4946576ae80c6a0dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vU7LXlcUN49iOXph.png"/></div></div></figure><p id="8403" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">为了视觉上更吸引人的绘图，也可以根据 x 变量对框使用一些颜色:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="9434" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = drv, y = hwy, fill = drv) + # add color to boxes with fill<br/>  geom_boxplot(varwidth = TRUE) + # vary boxes width according to n obs.<br/>  geom_jitter(alpha = 0.25, width = 0.2) + # adds random noise and limit its width<br/>  facet_wrap(~year) + # divide into 2 panels<br/>  theme(legend.position = "none") # remove legend</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/b238655d8a624967bd8729f7e333a47a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y8lH9j2ekO-lfmhG.png"/></div></div></figure><p id="adbf" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">在这种情况下，最好删除图例，因为它变得多余。参见<a class="ae ky" href="https://www.statsandr.com/blog/graphics-in-r-with-ggplot2/#legend" rel="noopener ugc nofollow" target="_blank">部分</a>中关于图例的更多信息。</p><p id="3990" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">如果你对<code class="fe nk nl nm nn b">{ggplot2}</code>中提供的默认颜色不满意，你可以用<code class="fe nk nl nm nn b">scale_fill_manual()</code>层手动改变它们:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="484b" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = drv, y = hwy, fill = drv) + # add color to boxes with fill<br/>  geom_boxplot(varwidth = TRUE) + # vary boxes width according to n obs.<br/>  geom_jitter(alpha = 0.25, width = 0.2) + # adds random noise and limit its width<br/>  facet_wrap(~year) + # divide into 2 panels<br/>  theme(legend.position = "none") + # remove legend<br/>  scale_fill_manual(values = c("darkred", "darkgreen", "steelblue")) # change fill color manually</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/ff5d06fc1e6acc14a661104ca051dbe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bUmQ4crPl3kw2Ne8.png"/></div></div></figure><h1 id="608d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">条形图</h1><p id="c1b8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">可以使用<code class="fe nk nl nm nn b">geom_bar()</code>绘制<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/#barplot" rel="noopener ugc nofollow" target="_blank">柱状图</a>(用于可视化定性变量):</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="1a9f" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = drv) +<br/>  geom_bar()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/14a120c210cf13eeebe408f3ed960b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*47KMSpxt_Noxt05x.png"/></div></div></figure><p id="9ee7" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">默认情况下，条形的高度对应于感兴趣变量的每个级别的观察频率(在我们的例子中为<code class="fe nk nl nm nn b">drv</code>)。</p><p id="6d3e" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">同样，为了更吸引人的情节，我们可以用<code class="fe nk nl nm nn b">fill</code>参数给条形添加一些颜色:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="20fe" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = drv, fill = drv) + # add colors to bars<br/>  geom_bar() +<br/>  theme(legend.position = "none") # remove legend</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/d79d2621b98e8e7a13b3fc0ba75ff761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Z4n4WYhPFNBoaFjd.png"/></div></div></figure><p id="5f77" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">我们还可以创建一个包含两个定性变量的柱状图:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="bce1" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = drv, fill = year) + # fill by years<br/>  geom_bar()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/596f46e4dabde201168b010942d0449b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*o9sSnC2I9u0wnFDB.png"/></div></div></figure><p id="b6d6" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">为了比较各组之间的比例，最好使用<code class="fe nk nl nm nn b">position = "fill"</code>使每个条形的高度相同:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="5028" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  geom_bar(aes(x = drv, fill = year), position = "fill")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/50418aeb46e070f9595a03b15707493a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QL1mZ6hQ5-xmOWtP.png"/></div></div></figure><p id="7f04" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">要为每组绘制相邻的条形，请使用<code class="fe nk nl nm nn b">position = "dodge"</code>:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="60d5" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  geom_bar(aes(x = drv, fill = year), position = "dodge")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/baebe832aaa13a3874de931567d798d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4DrjQnj8tNLWVHzy.png"/></div></div></figure><h1 id="b131" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">进一步个性化</h1><h1 id="ff4f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">标题和轴标签</h1><p id="7bf6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在一个情节中，首先要个性化的是标签，以使情节对观众更具信息性。我们可以使用<code class="fe nk nl nm nn b">labs()</code>功能轻松添加标题、副标题、说明和编辑轴标签:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="e81a" class="nx la it nn b gy ny nz l oa ob">p &lt;- ggplot(dat) +<br/>  aes(x = displ, y = hwy) +<br/>  geom_point()</span><span id="a5fc" class="nx la it nn b gy of nz l oa ob">p + labs(<br/>  title = "Fuel efficiency for 38 popular models of car",<br/>  subtitle = "Period 1999-2008",<br/>  caption = "Data: ggplot2::mpg. See more at www.statsandr.com",<br/>  x = "Engine displacement (litres)",<br/>  y = "Highway miles per gallon (mpg)"<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/36a724838ed6e5945755a520fadad0d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HcxYRNqPXBSoc5NJ.png"/></div></div></figure><p id="1ada" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">正如您在上面的代码中看到的，您可以将一个或多个绘图层保存在一个对象中以供以后使用。这样，您可以保存您的“主”图，并添加更多的个性化层，直到您获得所需的输出。这里，我们将主散点图保存在一个名为<code class="fe nk nl nm nn b">p</code>的对象中，我们将在后续的个性化设置中引用它。</p><p id="350c" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">您还可以通过<code class="fe nk nl nm nn b">theme()</code>图层和<code class="fe nk nl nm nn b">element_text()</code>功能编辑标题和副标题的对齐、大小和形状:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="ef52" class="nx la it nn b gy ny nz l oa ob">p + labs(<br/>  title = "Fuel efficiency for 38 popular models of car",<br/>  subtitle = "Period 1999-2008",<br/>  caption = "Data: ggplot2::mpg. See more at www.statsandr.com",<br/>  x = "Engine displacement (litres)",<br/>  y = "Highway miles per gallon (mpg)"<br/>) +<br/>  theme(<br/>    plot.title = element_text(<br/>      hjust = 0.5, # center<br/>      size = 12,<br/>      color = "steelblue",<br/>      face = "bold"<br/>    ),<br/>    plot.subtitle = element_text(<br/>      hjust = 0.5, # center<br/>      size = 10,<br/>      color = "gray",<br/>      face = "italic"<br/>    )<br/>  )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/2520f18ded3dcd8c534e0a4633060352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*37YXvOUA196AQ8cc.png"/></div></div></figure><p id="4a42" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">如果标题或副标题很长，你想把它分成多行，用<code class="fe nk nl nm nn b">\n</code>:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="9f59" class="nx la it nn b gy ny nz l oa ob">p + labs(<br/>  title = "Fuel efficiency for 38 popular \n models of car",<br/>  subtitle = "Period 1999-2008",<br/>  caption = "Data: ggplot2::mpg. See more at www.statsandr.com",<br/>  x = "Engine displacement (litres)",<br/>  y = "Highway miles per gallon (mpg)"<br/>) +<br/>  theme(<br/>    plot.title = element_text(<br/>      hjust = 0.5, # center<br/>      size = 12,<br/>      color = "steelblue",<br/>      face = "bold"<br/>    ),<br/>    plot.subtitle = element_text(<br/>      hjust = 0.5, # center<br/>      size = 10,<br/>      color = "gray",<br/>      face = "italic"<br/>    )<br/>  )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/3302de45b8e65b10d9be39c31fac3cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GlaUUCr542-jc8jI.png"/></div></div></figure><h1 id="fd50" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">坐标轴刻度</h1><p id="339c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">可以分别使用 x 轴和 y 轴的<code class="fe nk nl nm nn b">scale_x_continuous()</code>和<code class="fe nk nl nm nn b">scale_y_continuous()</code>调整轴刻度:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="3790" class="nx la it nn b gy ny nz l oa ob"># Adjust ticks<br/>p + scale_x_continuous(breaks = seq(from = 1, to = 7, by = 0.5)) + # x-axis<br/>  scale_y_continuous(breaks = seq(from = 10, to = 45, by = 5)) # y-axis</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/b7af0ec6b5cc402236af71b418cfc5d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5Qipwzy7-hzrqzX2.png"/></div></div></figure><h1 id="1d51" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">日志转换</h1><p id="7485" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在某些情况下，绘制变量的对数变换很有用。这可以通过<code class="fe nk nl nm nn b">scale_x_log10()</code>和<code class="fe nk nl nm nn b">scale_y_log10()</code>功能完成:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="01f2" class="nx la it nn b gy ny nz l oa ob">p + scale_x_log10() +<br/>  scale_y_log10()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/ec8eb9dfb9c6bc12b9fc87d59aec5f0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j93tCpMrZHX44ftx.png"/></div></div></figure><h1 id="c5db" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">限制</h1><p id="0379" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">除了<code class="fe nk nl nm nn b">limits</code>参数之外，控制绘图限制的最方便的方法是再次使用<code class="fe nk nl nm nn b">scale_x_continuous()</code>和<code class="fe nk nl nm nn b">scale_y_continuous()</code>功能:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="1812" class="nx la it nn b gy ny nz l oa ob">p + scale_x_continuous(limits = c(3, 6)) +<br/>  scale_y_continuous(limits = c(20, 30))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/c1b2b29ecb5247469a6c3728d705a49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cFjz4d7o4WRLZ7XZ.png"/></div></div></figure><p id="7b3c" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">也可以用<code class="fe nk nl nm nn b">subset()</code>或<code class="fe nk nl nm nn b">filter()</code>函数简单地获取数据集的一个子集。如果您需要提醒，请参阅如何<a class="ae ky" href="https://statsandr.com/blog/data-manipulation-in-r/#subset-a-data-frame" rel="noopener ugc nofollow" target="_blank">子集化数据集</a>。</p><h1 id="0650" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">缩放以获得更好的轴格式</h1><p id="1cd5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">根据您的数据，可以用<code class="fe nk nl nm nn b">{scales}</code>包以某种方式格式化轴。我最常用的格式是<code class="fe nk nl nm nn b">comma</code>和<code class="fe nk nl nm nn b">label_number_si()</code>，它们以更易读的方式格式化大数字。</p><p id="4025" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">在本例中，我们将两个变量都乘以 1000 以得到更大的数字，然后对每个轴应用不同的格式:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="6599" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = displ * 1000, y = hwy * 1000) +<br/>  geom_point() +<br/>  scale_y_continuous(labels = scales::label_number_si()) + # format y-axis<br/>  scale_x_continuous(labels = scales::comma) # format x-axis</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/7a61906de9abcef77f8c1789974950ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w-X0BhQxjwTTkbhi.png"/></div></div></figure><p id="ee48" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">如您所见，y 轴上的数字自动标有最佳 SI 前缀(“K”表示值≥ 10e3，“M”表示值≥ 10e6，“B”表示值≥ 10e9，“T”表示值≥ 10e12)，x 轴上的数字显示为 2，000、3，000 等。而不是 2000，3000 等等。</p><p id="61fe" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">这两种格式使得大数字更容易阅读。其他格式也是可能的，例如使用美元符号、百分比符号、日期等。参见<a class="ae ky" href="https://scales.r-lib.org/" rel="noopener ugc nofollow" target="_blank">包文档</a>中的更多信息。</p><h1 id="086a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">神话；传奇</h1><p id="9155" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">默认情况下，图例位于图的右侧(当然，当有图例显示时)。为了控制图例的位置，除了使用<code class="fe nk nl nm nn b">legend.position</code>参数之外，我们还需要使用<code class="fe nk nl nm nn b">theme()</code>函数:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="8f8a" class="nx la it nn b gy ny nz l oa ob">p + aes(color = class) +<br/>  theme(legend.position = "top")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/6f4f03d5bc7394fe248ed1b8035ff4c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s1R0WD-BBl7-ApX2.png"/></div></div></figure><p id="3811" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">用<code class="fe nk nl nm nn b">"left"</code>或<code class="fe nk nl nm nn b">"bottom"</code>替换<code class="fe nk nl nm nn b">"top"</code>以改变其位置，用<code class="fe nk nl nm nn b">"none"</code>将其移除。</p><p id="3436" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">可以用<code class="fe nk nl nm nn b">labs()</code>层编辑图例的标题:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="f190" class="nx la it nn b gy ny nz l oa ob">p + aes(color = class) +<br/>  labs(color = "Car's class")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/cb1323f49cae82701a70cce36ddd05d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*A7HZfgjCOd520q4t.png"/></div></div></figure><p id="c52a" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">请注意，<code class="fe nk nl nm nn b">labs()</code>中的参数必须与<code class="fe nk nl nm nn b">aes()</code>层中的参数相匹配(在本例中为:<code class="fe nk nl nm nn b">color</code>)。</p><p id="2561" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">图例的标题也可以在<code class="fe nk nl nm nn b">theme()</code>层内用<code class="fe nk nl nm nn b">legend.title = element_blank()</code>移除:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="4b19" class="nx la it nn b gy ny nz l oa ob">p + aes(color = class) +<br/>  theme(<br/>    legend.title = element_blank(),<br/>    legend.position = "bottom"<br/>  )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/68f7eac898618f9293b71869b0ea90dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uAIweXBEI4uUYUbv.png"/></div></div></figure><p id="1a2f" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">图例现在出现在图的底部，但没有图例标题。</p><h1 id="c9a1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">形状、颜色、大小和透明度</h1><p id="11bc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">有大量的选项可以提高绘图质量或添加附加信息。其中包括:</p><ul class=""><li id="f92d" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm oc nh ni nj bi translated">形状，</li><li id="59f6" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">尺寸，</li><li id="645d" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">颜色，以及</li><li id="8097" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">alpha(透明度)。</li></ul><p id="4e3f" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">例如，我们可以通过添加<code class="fe nk nl nm nn b">shape</code>到<code class="fe nk nl nm nn b">geom_point()</code>来改变散点图中所有点的形状，或者根据另一个变量的值改变形状(在这种情况下，<code class="fe nk nl nm nn b">shape</code>参数必须在<code class="fe nk nl nm nn b">aes()</code>内):<a class="ae ky" href="https://www.statsandr.com/blog/graphics-in-r-with-ggplot2/#fn2" rel="noopener ugc nofollow" target="_blank"> 2 </a></p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="70a1" class="nx la it nn b gy ny nz l oa ob"># Change shape of all points<br/>ggplot(dat) +<br/>  aes(x = displ, y = hwy) +<br/>  geom_point(shape = 4)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/47234a6983d36f0a45169952805d593f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y8FoQAlUJkZ_4Qm0.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="0991" class="nx la it nn b gy ny nz l oa ob"># Change shape of points based on a categorical variable<br/>ggplot(dat) +<br/>  aes(x = displ, y = hwy, shape = drv) +<br/>  geom_point()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/0322ff54a7afb0e95e27a975934e7381.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uGzuZivPBZNlijo6.png"/></div></div></figure><p id="01c3" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">遵循同样的原则，我们可以基于<a class="ae ky" href="https://www.statsandr.com/blog/variable-types-and-examples/#qualitative" rel="noopener ugc nofollow" target="_blank">定性</a>或<a class="ae ky" href="https://www.statsandr.com/blog/variable-types-and-examples/#quantitative" rel="noopener ugc nofollow" target="_blank">定量</a>变量修改点的颜色、大小和透明度。以下是一些例子:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="ac3f" class="nx la it nn b gy ny nz l oa ob">p &lt;- ggplot(dat) +<br/>  aes(x = displ, y = hwy) +<br/>  geom_point()</span><span id="6589" class="nx la it nn b gy of nz l oa ob"># Change color for all points<br/>p + geom_point(color = "steelblue")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/a65d3df0251223999e18cec944d89d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WUILT80-Aos4IMqw.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="e252" class="nx la it nn b gy ny nz l oa ob"># Change color based on a qualitative variable<br/>p + aes(color = drv)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/6ee30bf2e39cd31c44436510947b19d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RbB9l-jT-3yHFNDp.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="3546" class="nx la it nn b gy ny nz l oa ob"># Change color based on a quantitative variable<br/>p + aes(color = cty)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/e220e75053ac90c082fa8e4494e06a2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PkM51V6VNGic1gaS.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="2c2f" class="nx la it nn b gy ny nz l oa ob"># Change color based on a criterion (median of cty variable)<br/>p + aes(color = cty &gt; median(cty))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/8a870dad86a58af88c139624dea5c1ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ltZUayRSGbKcNMJY.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="3009" class="nx la it nn b gy ny nz l oa ob"># Change size of all points<br/>p + geom_point(size = 4)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/83f1d5193b4cd1255d5651bdcebd4744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4UKF3W7wcADQg9m2.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="a7f1" class="nx la it nn b gy ny nz l oa ob"># Change size of points based on a quantitative variable<br/>p + aes(size = cty)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/c469e64ff9c3149f70db117f4110a5ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xTz-0Ui53w_DGCBZ.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="3c9a" class="nx la it nn b gy ny nz l oa ob"># Change transparency based on a quantitative variable<br/>p + aes(alpha = cty)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/71139eed6b4bb9468331e7ceaafeb5cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x1zVdhhJ93GDr1tv.png"/></div></div></figure><p id="f915" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">我们当然可以混合几种选项(形状、颜色、大小、alpha)来构建更复杂的图形:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="84fa" class="nx la it nn b gy ny nz l oa ob">p + geom_point(size = 0.5) +<br/>  aes(color = drv, shape = year, alpha = cty)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/4a616c84800924fe46698686797334f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iOVjwcw176uvtY3h.png"/></div></div></figure><p id="2b02" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">如果您对默认颜色不满意，您可以使用<code class="fe nk nl nm nn b">scale_colour_manual()</code>层(用于定性变量)和<code class="fe nk nl nm nn b">scale_coulour_gradient2()</code>层(用于定量变量)手动更改它们:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="39d2" class="nx la it nn b gy ny nz l oa ob"># Change color based on a qualitative variable<br/>p + aes(color = drv) +<br/>  scale_colour_manual(values = c("red", "blue", "green"))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/6c00e90ceb4d9986782ffc20f6ea92f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TRvBGTOoopTY07Ln.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="cd36" class="nx la it nn b gy ny nz l oa ob"># Change color based on a quantitative variable<br/>p + aes(color = cty) +<br/>  scale_colour_gradient2(<br/>    low = "green",<br/>    mid = "gray",<br/>    high = "red",<br/>    midpoint = median(dat$cty)<br/>  )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/025647f49671816b1026f5ded5e2ceca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SYYkALjgZyQo9J20.png"/></div></div></figure><h1 id="7ae8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">文本和标签</h1><p id="0fa5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要在一个点上添加标签(例如行号)，我们可以使用<code class="fe nk nl nm nn b">geom_text()</code>和<code class="fe nk nl nm nn b">aes()</code>功能:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="486d" class="nx la it nn b gy ny nz l oa ob">p + geom_text(aes(label = rownames(dat)),<br/>  check_overlap = TRUE,<br/>  size = 2,<br/>  vjust = -1<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/7bda8623788d25dbf64a38c6b08f6c01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l169hbOXuYaunoPU.png"/></div></div></figure><p id="92ec" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">要在图上添加文本，我们使用<code class="fe nk nl nm nn b">annotate()</code>功能:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="97dc" class="nx la it nn b gy ny nz l oa ob">p + annotate("text",<br/>  x = 6,<br/>  y = 40,<br/>  label = "hwy and displ are \n negatively correlated \n (rho = -0.77, p-value &lt; 0.001)",<br/>  size = 3<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/490df3ab630de4415415b0411b717a16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*idMlf-khvMNQ6xN_.png"/></div></div></figure><p id="dffc" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">阅读 R 中关于<a class="ae ky" href="https://www.statsandr.com/blog/correlation-coefficient-and-correlation-test-in-r/" rel="noopener ugc nofollow" target="_blank">相关系数和相关性测试的文章，看看我是如何计算相关系数(rho)和相关性测试的<em class="od"> p </em>值的。</a></p><h1 id="4e55" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">平滑线和回归线</h1><p id="f08e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在散点图中，可以添加拟合数据的平滑线:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="9e44" class="nx la it nn b gy ny nz l oa ob">p + geom_smooth()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/86921e575a24910330aff06f4df99d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*98URrpLe9gJRigS-.png"/></div></div></figure><p id="2286" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">在简单线性回归的情况下，回归线通常显示在图上。这可以通过在<code class="fe nk nl nm nn b">geom_smooth()</code>层添加<code class="fe nk nl nm nn b">method = lm</code> ( <code class="fe nk nl nm nn b">lm</code>代表线性模型)来实现:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="cf42" class="nx la it nn b gy ny nz l oa ob">p + geom_smooth(method = lm)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/89a5e58984ac5717d4d49e45537317e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XLTfZUIlLGpcsaAj.png"/></div></div></figure><p id="0d27" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">还可以为分类变量的每个级别绘制一条回归线:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="1add" class="nx la it nn b gy ny nz l oa ob">p + aes(color = drv, shape = drv) +<br/>  geom_smooth(method = lm, se = FALSE)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/ca604d5b84f36b2ff194a0281698e067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eg0bjcM0CabQzQg_.png"/></div></div></figure><p id="282a" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated"><code class="fe nk nl nm nn b">se = FALSE</code>参数删除回归线周围的置信区间。</p><h1 id="bc8c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">面状</h1><p id="0f12" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe nk nl nm nn b">facet_grid</code>允许您根据一个或两个定性变量的值将同一个图形分成几个面板:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="1afa" class="nx la it nn b gy ny nz l oa ob"># According to one variable<br/>p + facet_grid(. ~ drv)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/ce3a18b47643cba17fa0db493248382b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kN3BIpiUKN2PAlN1.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="8f9d" class="nx la it nn b gy ny nz l oa ob"># According to 2 variables<br/>p + facet_grid(drv ~ year)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/e8dcddbd0f125bff34ca58b9093acc5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dwxYLpUb81I8C3p3.png"/></div></div></figure><p id="f802" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">然后可以为每个面添加一条回归线:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="bd22" class="nx la it nn b gy ny nz l oa ob">p + facet_grid(. ~ drv) +<br/>  geom_smooth(method = lm)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/c8ad2101373e87aecd4843580ddffa95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MSBs97BaivtV0J-u.png"/></div></div></figure><p id="0bd9" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated"><code class="fe nk nl nm nn b">facet_wrap()</code>也可以使用，如本<a class="ae ky" href="https://www.statsandr.com/blog/graphics-in-r-with-ggplot2/#boxplot" rel="noopener ugc nofollow" target="_blank">章节</a>所示。</p><h1 id="bafa" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">主题</h1><p id="7b27" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在<code class="fe nk nl nm nn b">{ggplot2}</code>包中有几个功能可以改变情节的主题。默认主题(即<code class="fe nk nl nm nn b">theme_gray()</code>)之后最常见的主题是黑白(<code class="fe nk nl nm nn b">theme_bw()</code>)、极简(<code class="fe nk nl nm nn b">theme_minimal()</code>)和经典(<code class="fe nk nl nm nn b">theme_classic()</code>)主题:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="44bc" class="nx la it nn b gy ny nz l oa ob"># Black and white theme<br/>p + theme_bw()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/bed32d18727af1f9a1c02d88f22f095d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NcSx4zbNhohdRQez.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="1db3" class="nx la it nn b gy ny nz l oa ob"># Minimal theme<br/>p + theme_minimal()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/c4259e22b7509c96821bd0ce0455617e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xRx_5goIMLYhQis7.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="5bcc" class="nx la it nn b gy ny nz l oa ob"># Classic theme<br/>p + theme_classic()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/db4dc5f9a94f5adac85e8ac49b99cc94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5M0e8u9iv67JCbwN.png"/></div></div></figure><p id="85ac" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">我倾向于在我的大部分降价报告中使用最小化主题，因为它展现了模式和要点，而不是情节的布局，但这也是个人品味的问题。在 ggplot2.tidyverse.org/reference/ggtheme.html<a class="ae ky" href="https://ggplot2.tidyverse.org/reference/ggtheme.html" rel="noopener ugc nofollow" target="_blank"/>和<code class="fe nk nl nm nn b">{ggthemes}</code>套餐中查看更多主题。</p><p id="c3c0" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">为了避免必须更改您创建的每个图的主题，您可以使用<code class="fe nk nl nm nn b">theme_set()</code>功能更改当前 R 会话的主题，如下所示:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="9896" class="nx la it nn b gy ny nz l oa ob">theme_set(theme_minimal())</span></pre><h1 id="525b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">与<code class="fe nk nl nm nn b">{plotly}</code>的互动剧情</h1><p id="4474" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可以轻松地将使用<code class="fe nk nl nm nn b">{ggplot2}</code>创建的情节与<code class="fe nk nl nm nn b">{plotly}</code>包进行交互:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="a8ab" class="nx la it nn b gy ny nz l oa ob">library(plotly)<br/>ggplotly(p + aes(color = year))</span></pre><p id="5641" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">23456720304019992008 显示年份</p><p id="74a6" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">现在，您可以将鼠标悬停在某个点上，以显示关于该点的更多信息。也有可能放大和缩小，下载图，选择一些观察，等等。关于 R 的<code class="fe nk nl nm nn b">{plotly}</code>的更多信息可以在这里找到<a class="ae ky" href="https://plotly.com/r/" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="4ea6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">用<code class="fe nk nl nm nn b">{patchwork}</code>合并图形</h1><p id="e4b0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">有几种方法可以组合<code class="fe nk nl nm nn b">{ggplot2}</code>中制作的剧情。在我看来，最方便的方法是在<code class="fe nk nl nm nn b">{patchwork}</code>包中使用符号，如<code class="fe nk nl nm nn b">+</code>、<code class="fe nk nl nm nn b">/</code>和括号。</p><p id="2ba3" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">我们首先需要创建一些情节并保存它们:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="5409" class="nx la it nn b gy ny nz l oa ob">p_a &lt;- ggplot(dat) +<br/>  aes(x = displ, y = hwy) +<br/>  geom_point()</span><span id="e448" class="nx la it nn b gy of nz l oa ob">p_b &lt;- ggplot(dat) +<br/>  aes(x = hwy) +<br/>  geom_histogram()</span><span id="9b2b" class="nx la it nn b gy of nz l oa ob">p_c &lt;- ggplot(dat) +<br/>  aes(x = drv, y = hwy) +<br/>  geom_boxplot()</span></pre><p id="558d" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">现在我们的环境中已经保存了 3 个地块，我们可以将它们组合起来。要使图<strong class="lt iu">彼此相邻</strong>，只需使用<code class="fe nk nl nm nn b">+</code>符号:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="396e" class="nx la it nn b gy ny nz l oa ob">library(patchwork)<br/>p_a + p_b + p_c</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/1f875840d7c7b6ef3415f5447179b740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1QXFBl6rG3WCkUo7.png"/></div></div></figure><p id="8197" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">要上下显示它们<strong class="lt iu">只需使用<code class="fe nk nl nm nn b">/</code>符号:</strong></p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="4d95" class="nx la it nn b gy ny nz l oa ob">p_a / p_b / p_c</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/eae9778f4e8140650a2212b394eef2e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bG6tOtFED1XfIX13.png"/></div></div></figure><p id="9431" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">最后，将上面的<strong class="lt iu">和下面的</strong>组合在一起，混合<code class="fe nk nl nm nn b">+</code>、<code class="fe nk nl nm nn b">/</code>和括号:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="c4f3" class="nx la it nn b gy ny nz l oa ob">p_a + p_b / p_c</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/31e98dc4fda6be4098c5ee511f935b3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xCzpZH_qLhty5zB2.png"/></div></div></figure><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="eabc" class="nx la it nn b gy ny nz l oa ob">(p_a + p_b) / p_c</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/a551b6ed6c45b5dce760306a0a32c6f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FExU4BaMSqsksm65.png"/></div></div></figure><p id="4133" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">查看更多结合绘图的方式:</p><ul class=""><li id="fe62" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm oc nh ni nj bi translated"><code class="fe nk nl nm nn b">grid.arrange()</code>来自<code class="fe nk nl nm nn b">{gridExtra}</code>包</li><li id="384a" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated"><code class="fe nk nl nm nn b">plot_grid()</code>来自<code class="fe nk nl nm nn b">{cowplot}</code>包</li></ul><h1 id="eae6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">翻转坐标</h1><p id="63c9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">翻转图的坐标对于创建水平盒状图很有用，或者当变量的标签太长以至于在 x 轴上相互重叠时也很有用。请参见下面的带和不带翻转坐标:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="99a6" class="nx la it nn b gy ny nz l oa ob"># without flipping coordinates<br/>p1 &lt;- ggplot(dat) +<br/>  aes(x = class, y = hwy) +<br/>  geom_boxplot()</span><span id="7624" class="nx la it nn b gy of nz l oa ob"># with flipping coordinates<br/>p2 &lt;- ggplot(dat) +<br/>  aes(x = class, y = hwy) +<br/>  geom_boxplot() +<br/>  coord_flip()</span><span id="f43e" class="nx la it nn b gy of nz l oa ob">library(patchwork)<br/>p1 + p2 # left: without flipping, right: with flipping</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/91b3740594129fc6373d4c88fab53068.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0SFPBwZIG11DInVd.png"/></div></div></figure><p id="3d39" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">这可以用许多类型的图来完成，而不仅仅是箱线图。例如，如果分类变量有许多级别或标签很长，通常最好翻转坐标以获得更好的视觉效果:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="b0e9" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = class) +<br/>  geom_bar() +<br/>  coord_flip()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/82efdcbfc98188dca4255baeb88c147d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*92F-GNLOggmY9rKe.png"/></div></div></figure><h1 id="0462" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">保存绘图</h1><p id="4b35" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">除非您指定另一个文件夹的路径，否则<code class="fe nk nl nm nn b">ggsave()</code>功能会将最近的绘图保存在您当前的<a class="ae ky" href="https://www.statsandr.com/blog/how-to-import-an-excel-file-in-rstudio/#r-working-directory" rel="noopener ugc nofollow" target="_blank">工作目录</a>中:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="e818" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = displ, y = hwy) +<br/>  geom_point()</span><span id="dbf6" class="nx la it nn b gy of nz l oa ob">ggsave("plot1.pdf")</span></pre><p id="b6a3" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">您也可以指定宽度、高度和分辨率，如下所示:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="d327" class="nx la it nn b gy ny nz l oa ob">ggsave("plot1.pdf",<br/>  width = 12,<br/>  height = 12,<br/>  units = "cm",<br/>  dpi = 300<br/>)</span></pre><h1 id="2eea" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">管理日期</h1><p id="37eb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果数据集中的时间变量是日期格式的，<code class="fe nk nl nm nn b">{ggplot2}</code>包会识别日期格式，并自动使用特定类型的轴刻度。</p><p id="fec2" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">在我们的数据集中没有日期格式的时间变量，所以让我们借助<code class="fe nk nl nm nn b">as.Date()</code>函数创建一个这种类型的新变量:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="8a12" class="nx la it nn b gy ny nz l oa ob">dat$date &lt;- as.Date("2020-08-21") - 0:(nrow(dat) - 1)</span></pre><p id="49ac" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">查看此日期变量及其类的前 6 个观察值:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="578a" class="nx la it nn b gy ny nz l oa ob">head(dat$date)</span><span id="4851" class="nx la it nn b gy of nz l oa ob">## [1] "2020-08-21" "2020-08-20" "2020-08-19" "2020-08-18" "2020-08-17"<br/>## [6] "2020-08-16"</span><span id="6ee8" class="nx la it nn b gy of nz l oa ob">str(dat$date)</span><span id="b009" class="nx la it nn b gy of nz l oa ob">##  Date[1:234], format: "2020-08-21" "2020-08-20" "2020-08-19" "2020-08-18" "2020-08-17" ...</span></pre><p id="3143" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">新变量<code class="fe nk nl nm nn b">date</code>以日期格式正确指定。</p><p id="4af1" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">大多数情况下，对于时间变量，我们希望创建一个线形图，在 X 轴上显示日期，在 Y 轴上显示另一个连续变量，如下图所示:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="7c7c" class="nx la it nn b gy ny nz l oa ob">p &lt;- ggplot(dat) +<br/>  aes(x = date, y = hwy) +<br/>  geom_line()<br/>p</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/ec691a844f6f88fb743d13e2999a2d44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LmepagHQpfm9qpg6.png"/></div></div></figure><p id="1d1c" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">一旦时间变量被识别为日期，我们就可以使用<code class="fe nk nl nm nn b">scale_x_date()</code>层来改变 X 轴上显示的格式。下表显示了最常用的日期格式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/d70a29557b3edf828b1288464812c9e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/0*jT9xuq4HZbLGqIIQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:www.statmethods.net</p></figure><p id="e460" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">运行<code class="fe nk nl nm nn b">?strptime()</code>查看 r 中更多可用的日期格式。</p><p id="e309" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">对于本例，除了未缩写的月份之外，我们还要加上年份:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="7d3e" class="nx la it nn b gy ny nz l oa ob">p + scale_x_date(date_labels = "%B %Y")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/d86e164b8027829b1cedbfdbc5715d08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SdcAJkw5IzhU3RyU.png"/></div></div></figure><p id="21bf" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">也可以用<code class="fe nk nl nm nn b">date_breaks</code>参数控制显示在 X 轴上的断点。在本例中，假设我们希望将日期显示为数字，并将每个 10 天的间隔显示为月份缩写:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="957e" class="nx la it nn b gy ny nz l oa ob">p + scale_x_date(date_breaks = "10 days", date_labels = "%d %b")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/de5fad521347d3a1625bdf6519ad3469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-MdyHZjtaA6MCKwt.png"/></div></div></figure><p id="befa" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">如果 X 轴上显示的标签因相互重叠而不可读，您可以使用<code class="fe nk nl nm nn b">theme()</code>层和<code class="fe nk nl nm nn b">angle</code>参数旋转它们:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="18b6" class="nx la it nn b gy ny nz l oa ob">p + scale_x_date(date_breaks = "10 days", date_labels = "%d %b") +<br/>  theme(axis.text.x = element_text(angle = 60, hjust = 1))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/222ccf543fd2c4230dc680485e78a00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jo3vKuFWbfwDsCuN.png"/></div></div></figure><h1 id="a511" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">小费</h1><p id="d0dd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我最近学到了一个用<code class="fe nk nl nm nn b">{ggplot2}</code>绘图时非常有用的技巧。如果像我一样，您经常注释和取消注释您的图中的一些代码行，您知道如果不删除上一行中的<code class="fe nk nl nm nn b">+</code>符号，您就不能将最后一行转换为注释。</p><p id="96bd" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">如果您忘记删除代码最后一行中的<code class="fe nk nl nm nn b">+</code>符号，在图的末尾添加一行<code class="fe nk nl nm nn b">NULL</code>将会避免错误。请看这个基本的例子:</p><pre class="kj kk kl km gt nt nn nu nv aw nw bi"><span id="c825" class="nx la it nn b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = date, y = hwy) +<br/>  geom_line() + # I do not have to remove the + sign<br/>  # theme_minimal() + # this line is a comment<br/>  NULL # adding this line doesn't change anything to the plot</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/185b8dbdd387c25b19fc79a212dc3862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ssi4e70Ao85gYpKs.png"/></div></div></figure><p id="53dd" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">这个技巧节省了我很多时间，因为我不需要担心在注释了我的图中的一些代码行之后，要确保删除最后一个<code class="fe nk nl nm nn b">+</code>符号。</p><p id="5c24" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">如果你觉得这个技巧很有用，你可能会喜欢 RStudio 和 R Markdown 中的这些其他<a class="ae ky" href="https://statsandr.com/blog/tips-and-tricks-in-rstudio-and-r-markdown/" rel="noopener ugc nofollow" target="_blank">提示和技巧。</a></p><h1 id="eaf6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">走得更远</h1><p id="51fb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">到目前为止，你已经看到了<code class="fe nk nl nm nn b">{ggplot2}</code>是一个非常强大和完整的软件包，可以在 r 中创建情节。本文只展示了冰山一角，你会发现许多关于如何使用<code class="fe nk nl nm nn b">{ggplot2}</code>在线创建更高级的情节和可视化的教程。如果您想了解比本文所述更多的内容，我强烈建议您从以下内容开始:</p><ul class=""><li id="f716" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm oc nh ni nj bi translated">章节<a class="ae ky" href="https://r4ds.had.co.nz/data-visualisation.html" rel="noopener ugc nofollow" target="_blank">数据可视化</a>和<a class="ae ky" href="https://r4ds.had.co.nz/graphics-for-communication.html" rel="noopener ugc nofollow" target="_blank">用于交流的图形</a>来自 Garrett Grolemund 和 Hadley Wickham 的《数据科学的研究》一书<a class="ae ky" href="https://r4ds.had.co.nz/" rel="noopener ugc nofollow" target="_blank"> R</a></li><li id="6d34" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">Hadley Wickham 的书<a class="ae ky" href="https://ggplot2-book.org/" rel="noopener ugc nofollow" target="_blank"> ggplot2:优雅的数据分析图形</a></li><li id="61cb" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">温斯顿·张的书</li><li id="d866" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">列出了许多扩展<code class="fe nk nl nm nn b">{ggplot2}</code>的包的<a class="ae ky" href="https://exts.ggplot2.tidyverse.org/gallery/" rel="noopener ugc nofollow" target="_blank"> ggplot2 扩展指南</a></li><li id="b93a" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated"><code class="fe nk nl nm nn b"><a class="ae ky" href="https://www.statsandr.com/blog/files/ggplot2-cheatsheet.pdf" rel="noopener ugc nofollow" target="_blank">{ggplot2}</a></code> <a class="ae ky" href="https://www.statsandr.com/blog/files/ggplot2-cheatsheet.pdf" rel="noopener ugc nofollow" target="_blank">小抄</a></li></ul><p id="b356" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">感谢阅读。我希望这篇文章能帮助你用<code class="fe nk nl nm nn b">{ggplot2}</code>包创建你的第一个情节。提醒一下，对于简单的图形，有时通过<a class="ae ky" href="https://www.statsandr.com/blog/rstudio-addins-or-how-to-make-your-coding-life-easier/#esquisse" rel="noopener ugc nofollow" target="_blank"> {esquisse}插件</a>来绘制更容易。过一段时间后，您将很快学会如何自己创建它们，并且很快就能够构建复杂和高级的数据可视化。</p><p id="32a1" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">和往常一样，如果您有与本文主题相关的问题或建议，请将其添加为评论，以便其他读者可以从讨论中受益。</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><ol class=""><li id="3ca6" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm ng nh ni nj bi translated">小心使用<code class="fe nk nl nm nn b">geom_jitter()</code>图层，因为尽管它在大比例下使绘图更具揭示性，但在小比例下也会使其稍不精确，因为点上增加了一些随机性。<a class="ae ky" href="https://www.statsandr.com/blog/graphics-in-r-with-ggplot2/#fnref1" rel="noopener ugc nofollow" target="_blank"> ↩︎ </a></li><li id="b84d" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm ng nh ni nj bi translated">(在撰写本文时)在<code class="fe nk nl nm nn b">shape</code>参数中接受了 26 种形状。参见本<a class="ae ky" href="https://ggplot2.tidyverse.org/reference/aes_linetype_size_shape.html" rel="noopener ugc nofollow" target="_blank">文档</a>了解所有可用的形状。<a class="ae ky" href="https://www.statsandr.com/blog/graphics-in-r-with-ggplot2/#fnref2" rel="noopener ugc nofollow" target="_blank"> ↩︎ </a></li></ol><h1 id="39ee" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">相关文章</h1><ul class=""><li id="d2c7" class="nb nc it lt b lu lv lx ly ma oo me op mi oq mm oc nh ni nj bi translated"><a class="ae ky" href="https://www.statsandr.com/blog/correlation-coefficient-and-correlation-test-in-r/" rel="noopener ugc nofollow" target="_blank">R 中的相关系数和相关检验</a></li><li id="9730" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated">比利时的新冠肺炎:结束了吗？</li><li id="8c40" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated"><a class="ae ky" href="https://www.statsandr.com/blog/a-package-to-download-free-springer-books-during-covid-19-quarantine/" rel="noopener ugc nofollow" target="_blank">新冠肺炎隔离期间免费下载施普林格书籍的套装</a></li><li id="182b" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated"><a class="ae ky" href="https://www.statsandr.com/blog/how-to-create-a-simple-coronavirus-dashboard-specific-to-your-country-in-r/" rel="noopener ugc nofollow" target="_blank">如何创建针对贵国的简单冠状病毒仪表板</a></li><li id="23f2" class="nb nc it lt b lu no lx np ma nq me nr mi ns mm oc nh ni nj bi translated"><a class="ae ky" href="https://www.statsandr.com/blog/top-r-resources-on-covid-19-coronavirus/" rel="noopener ugc nofollow" target="_blank">新型新冠肺炎冠状病毒前 100 名资源</a></li></ul></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><p id="95d3" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated"><em class="od">原载于 2020 年 8 月 21 日 https://statsandr.com</em><em class="od">T21</em><a class="ae ky" href="https://statsandr.com/blog/graphics-in-r-with-ggplot2/" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>