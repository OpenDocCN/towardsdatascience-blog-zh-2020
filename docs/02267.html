<html>
<head>
<title>How to Run Apache Airflow as Daemon Using Linux “systemd”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Linux“systemd”将Apache Airflow作为守护进程运行</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-run-apache-airflow-as-daemon-using-linux-systemd-63a1d85f9702?source=collection_archive---------5-----------------------#2020-03-04">https://towardsdatascience.com/how-to-run-apache-airflow-as-daemon-using-linux-systemd-63a1d85f9702?source=collection_archive---------5-----------------------#2020-03-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/8d97307aad883ee7a97ed286bffac8f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EjLL1Dgk0XZ-RD60DaUJAA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/users/VanVangelis-7215570/" rel="noopener ugc nofollow" target="_blank">拍摄的</a>在<a class="ae jg" href="https://pixabay.com/photos/pinwheel-park-wind-children-s-toys-985699/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><div class=""/><div class=""><h2 id="d4c5" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">CentOS上的气流守护程序教程。从安装、下载、配置到使用systemctl运行。</h2></div><p id="d670" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">自从Airflow从孵化器成为顶级Apache项目后，它作为一个具有简洁Web UI的工作流调度管理器越来越受欢迎。</p><p id="4002" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在一个典型的用例中，Airflow需要两个必须<strong class="la jk">持续</strong>运行的组件，web服务器和调度器。前者是用于管理和监控工作流的Web UI，后者负责在预定义的时间戳正确触发工作流。</p><p id="1e03" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，使用Linux中提供的命令来运行这两个组件并不是一个好主意，例如:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="067a" class="md me jj lz b gy mf mg l mh mi">$ airflow scheduler<br/>$ airflow webserver</span></pre><p id="0e1e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">缺点显而易见:</p><ul class=""><li id="39c4" class="mj mk jj la b lb lc le lf lh ml ll mm lp mn lt mo mp mq mr bi translated">如果任何组件崩溃，服务将被终止，没有任何通知。</li><li id="4e82" class="mj mk jj la b lb ms le mt lh mu ll mv lp mw lt mo mp mq mr bi translated">这些服务的日志被打印在stdout中，如果crush的话，这些日志将会丢失，所以要找出发生了什么是很困难的</li><li id="9a0d" class="mj mk jj la b lb ms le mt lh mu ll mv lp mw lt mo mp mq mr bi translated">当Linux系统重新启动时，它不会自动启动运行。</li></ul><p id="058b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了解决这些问题，我们需要将Apache Airflow作为守护进程运行。Apache Airflow GitHub repo已经提供了支持<code class="fe mx my mz lz b">systemd</code>和<code class="fe mx my mz lz b">upstart</code>的守护程序服务定义。在本文中，我们将使用前者。</p><p id="6fb9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">官方文档只给出了非常简要的解释，没有可以遵循的教程。对于一些没有太多Linux经验的数据工程师或数据科学家来说，这相对比较困难。本文将一步步演示如何将Airflow作为守护进程运行。从安装到启动和运行。</p><h1 id="995e" class="na me jj bd nb nc nd ne nf ng nh ni nj kp nk kq nl ks nm kt nn kv no kw np nq bi translated">安装阿帕奇气流</h1><figure class="lu lv lw lx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nr"><img src="../Images/1526f1fa7cd08a82adc78ba6030a3bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hK0j6cGgrbF3WA6HYxKR4g.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://pixabay.com/users/teru_teru-1434373/" rel="noopener ugc nofollow" target="_blank"> teru_teru </a>在<a class="ae jg" href="https://pixabay.com/photos/pinwheel-park-wind-children-s-toys-985699/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄</p></figure><p id="c48b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Medium上已经有一些关于如何安装Airflow的教程，比如这个，如果你在Ubuntu上的话:</p><div class="is it gp gr iu ns"><a href="https://medium.com/@shaikzillani/how-to-install-apache-airflow-on-ubuntu-using-python-interpreter-20f10348e7bd" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jk gy z fp nx fr fs ny fu fw ji bi translated">如何使用python解释器在Ubuntu上安装apache airflow</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">在这篇博文中，我将向您展示如何在ubuntu上安装apache airflow，</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">medium.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og ja ns"/></div></div></a></div><p id="253c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，对于CentOS等基于Red Hat的Linux，似乎还没有这样的教程，依赖项的名称和安装方式可能与基于Debian的Linux略有不同。</p><p id="0973" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，强烈建议为气流创建一个特定的用户</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="3730" class="md me jj lz b gy mf mg l mh mi">useradd airflow</span></pre><p id="1999" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，您的Linux可能会也可能不会绑定Airflow所需的一些依赖项。典型的，我发现有以下三种缺失是相当普遍的。</p><ul class=""><li id="cd46" class="mj mk jj la b lb lc le lf lh ml ll mm lp mn lt mo mp mq mr bi translated">（同groundcontrolcenter）地面控制中心</li><li id="728e" class="mj mk jj la b lb ms le mt lh mu ll mv lp mw lt mo mp mq mr bi translated">Python开发</li><li id="d7ce" class="mj mk jj la b lb ms le mt lh mu ll mv lp mw lt mo mp mq mr bi translated">MySQL开发(如果你需要连接到MySQL)</li></ul><p id="dc41" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，Ubuntu和CentOS中的库名并不相同。例如，Python Dev包在Ubuntu的<code class="fe mx my mz lz b">apt-get</code>中是<code class="fe mx my mz lz b">python-dev</code>，而在CentOS的<code class="fe mx my mz lz b">yum</code>中，它被称为<code class="fe mx my mz lz b">python-devel</code>。如果你使用Python3，确保你安装了<code class="fe mx my mz lz b">python3-devel</code>。此外，MySQL Dev在<code class="fe mx my mz lz b">apt-get</code>中被称为<code class="fe mx my mz lz b">libmysqldev</code>，而在<code class="fe mx my mz lz b">yum</code>中被称为<code class="fe mx my mz lz b">mysql-devel</code>。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="d947" class="md me jj lz b gy mf mg l mh mi">yum install gcc<br/>yum install python3-devel<br/>yum install mysql-devel</span></pre><p id="441f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，让我们安装气流和额外的软件包，如有必要，如:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="ac1e" class="md me jj lz b gy mf mg l mh mi">pip3 install apache-airflow<br/>pip3 install 'apache-airflow[crypto]'<br/>pip3 install 'apache-airflow[mysql]'</span></pre><h1 id="ed33" class="na me jj bd nb nc nd ne nf ng nh ni nj kp nk kq nl ks nm kt nn kv no kw np nq bi translated">气流守护程序的准备</h1><figure class="lu lv lw lx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/ac94d1f95116e3995b7e2a86c1fa2b2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NlN5tlZFQ_E1r4UTX0iqbA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/users/Hans-2/" rel="noopener ugc nofollow" target="_blank">汉斯</a>在<a class="ae jg" href="https://pixabay.com/photos/pinwheel-park-wind-children-s-toys-985699/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄的照片</p></figure><p id="097e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们能够为气流配置我们的<code class="fe mx my mz lz b">systemd</code>服务之前，我们需要做一些准备。第一步是从Airflow GitHub Repo下载服务定义文件。</p><p id="cca2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae jg" href="https://github.com/apache/airflow/tree/master/scripts/systemd" rel="noopener ugc nofollow" target="_blank">https://github . com/Apache/air flow/tree/master/scripts/systemd</a></p><h2 id="27ef" class="md me jj bd nb oi oj dn nf ok ol dp nj lh om on nl ll oo op nn lp oq or np os bi translated">下载守护程序服务文件</h2><p id="7585" class="pw-post-body-paragraph ky kz jj la b lb ot kk ld le ou kn lg lh ov lj lk ll ow ln lo lp ox lr ls lt im bi translated">让我们为下载文件创建一个临时文件夹。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="3c53" class="md me jj lz b gy mf mg l mh mi">mkdir /tmp/airflow-daemon<br/>cd /tmp/airflow-daemon</span></pre><p id="1d31" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，将文件下载到这个临时文件夹中。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="cf95" class="md me jj lz b gy mf mg l mh mi"># wget <a class="ae jg" href="https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow</a><br/># wget <a class="ae jg" href="https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow-scheduler.service" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow-scheduler.service</a><br/># wget <a class="ae jg" href="https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow-webserver.service" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow-webserver.service</a><br/># wget <a class="ae jg" href="https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow.conf" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow.conf</a></span></pre><p id="a9ed" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在GitHub回购中，有一个简短的解释如下:</p><blockquote class="oy oz pa"><p id="8455" class="ky kz pb la b lb lc kk ld le lf kn lg pc li lj lk pd lm ln lo pe lq lr ls lt im bi translated">该目录中的systemd文件是在基于RedHat的系统上测试的。将它们复制(或链接)到/usr/lib/systemd/system <br/>并将airflow.conf复制到/etc/tmpfiles . d/or/usr/lib/tmpfiles . d/。复制airflow.conf确保/run/airflow是用正确的所有者和权限创建的<br/>( 0755 air flow air flow)</p><p id="afe0" class="ky kz pb la b lb lc kk ld le lf kn lg pc li lj lk pd lm ln lo pe lq lr ls lt im bi translated">然后，您可以使用systemctl start <service>启动不同的服务器。启用服务可以通过发出<br/> systemctl enable &lt;服务&gt;来完成。</service></p><p id="a22b" class="ky kz pb la b lb lc kk ld le lf kn lg pc li lj lk pd lm ln lo pe lq lr ls lt im bi translated">默认情况下，环境配置指向/etc/sysconfig/airflow。你可以复制这个<br/>目录下的“气流”文件，根据自己的喜好进行调整。</p><p id="b3be" class="ky kz pb la b lb lc kk ld le lf kn lg pc li lj lk pd lm ln lo pe lq lr ls lt im bi translated">经过一些小的改动，它们可能可以在其他systemd系统上工作。</p></blockquote><p id="dbef" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">嗯，我想对于大多数没有Linux背景的人来说，上面的文档可能会非常模糊和误导。所以，我画了这个图来显示哪个文件应该放在哪个路径上。</p><figure class="lu lv lw lx gt iv gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/8bacdd446bd74f3dea27710abb41c09f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*6MqgnGv-XxGX7A1AWNbe8w.png"/></div></figure><p id="5dca" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">根据图中所示的路径，让我们将文件复制到正确的位置。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="8ef1" class="md me jj lz b gy mf mg l mh mi">cp *.service /usr/lib/systemd/system/<br/>cp airflow.conf /usr/lib/tmpfiles.d/<br/>cp airflow /etc/sysconfig/</span></pre><h2 id="e578" class="md me jj bd nb oi oj dn nf ok ol dp nj lh om on nl ll oo op nn lp oq or np os bi translated">创建必要的目录</h2><p id="c453" class="pw-post-body-paragraph ky kz jj la b lb ot kk ld le ou kn lg lh ov lj lk ll ow ln lo lp ox lr ls lt im bi translated">我们还需要创建一些守护进程需要的目录。首先，它需要一个专用的目录来存储运行时信息，比如<code class="fe mx my mz lz b">pid</code>。让我们在<code class="fe mx my mz lz b">/run</code>目录下创建目录，并更改权限。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="3afd" class="md me jj lz b gy mf mg l mh mi">mkdir /run/airflow<br/>chown airflow:airflow /run/airflow<br/>chmod 0755 airflow -R</span></pre><p id="4ea6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，权限被设置为<code class="fe mx my mz lz b">0755</code>,因为实际上我们可能有其他多个用户来开发Dag(工作流)。有了<code class="fe mx my mz lz b">0755</code>权限，它确保所有其他用户都有他们的次要组，因为<code class="fe mx my mz lz b">airflow</code>将有足够的权限。</p><p id="5f3e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们需要创建的另一个目录是Airflow主目录，它包括:</p><ul class=""><li id="e7c2" class="mj mk jj la b lb lc le lf lh ml ll mm lp mn lt mo mp mq mr bi translated">气流配置</li><li id="3b95" class="mj mk jj la b lb ms le mt lh mu ll mv lp mw lt mo mp mq mr bi translated">气流使用的SQLite</li><li id="9644" class="mj mk jj la b lb ms le mt lh mu ll mv lp mw lt mo mp mq mr bi translated">熟练的技艺</li><li id="3e7d" class="mj mk jj la b lb ms le mt lh mu ll mv lp mw lt mo mp mq mr bi translated">Dag日志</li></ul><p id="4be0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通常如果没有<code class="fe mx my mz lz b">export AIRFLOW_HOME=...</code>，这些会在当前用户的主目录下自动生成，比如<code class="fe mx my mz lz b">/home/airflow/airflow/</code>。如果您正在测试气流或开发一些Dag，这很好。但是，不建议这样做，而且在生产中也不方便，因为其他用户不容易访问<code class="fe mx my mz lz b">airflow</code>用户的主目录。</p><p id="9616" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的例子中，我想把Airflow主目录放在<code class="fe mx my mz lz b">/opt</code>下，所以让我们创建它。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="a34b" class="md me jj lz b gy mf mg l mh mi">mkdir /opt/airflow<br/>chown airflow:airflow airflow -R<br/>chmod 775 airflow -R</span></pre><p id="b172" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">同样，更改权限以允许<code class="fe mx my mz lz b">airflow</code>组中的所有用户不仅可以读取目录，还可以写入目录，因为他们需要修改Dag。</p><h2 id="25bc" class="md me jj bd nb oi oj dn nf ok ol dp nj lh om on nl ll oo op nn lp oq or np os bi translated">初始化气流主目录</h2><p id="9d97" class="pw-post-body-paragraph ky kz jj la b lb ot kk ld le ou kn lg lh ov lj lk ll ow ln lo lp ox lr ls lt im bi translated">一切准备就绪。我们需要初始化气流的主目录。将主目录导出到<code class="fe mx my mz lz b">AIRFLOW_HOME</code>环境变量是很重要的。否则，如上所述，将在用户的主文件夹中自动生成主目录。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="5e06" class="md me jj lz b gy mf mg l mh mi">export AIRFLOW_HOME=/opt/airflow<br/>airflow initdb</span></pre><h1 id="8993" class="na me jj bd nb nc nd ne nf ng nh ni nj kp nk kq nl ks nm kt nn kv no kw np nq bi translated">配置气流守护程序</h1><figure class="lu lv lw lx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pg"><img src="../Images/78424215c492bfb155534907cdced4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HBHtA2XfMoFrQLyM3srDow.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/users/photogrammer7-236216/" rel="noopener ugc nofollow" target="_blank">摄影师7 </a>在<a class="ae jg" href="https://pixabay.com/photos/pinwheel-park-wind-children-s-toys-985699/" rel="noopener ugc nofollow" target="_blank">图片栏</a>上拍摄</p></figure><p id="6056" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，所有的服务文件、配置文件和必要的目录都准备好了。我们需要配置守护进程，以确保在守护进程正常运行之前，一切都指向正确的路径。</p><p id="b6c5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，让我们仔细检查一下<code class="fe mx my mz lz b">airflow</code>二进制文件的路径，因为稍后需要在服务定义中指定它。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="d9f3" class="md me jj lz b gy mf mg l mh mi">$ which airflow<br/>/usr/local/bin/airflow</span></pre><p id="444f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我的情况是<code class="fe mx my mz lz b">/usr/local/bin/airflow</code>。请记下你的，很可能是一样的，但以防万一要注意一下。不要直接抄我的。</p><p id="a201" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们来修改一下<code class="fe mx my mz lz b">airflow-webserver</code>的定义。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="a0f6" class="md me jj lz b gy mf mg l mh mi">vi /usr/lib/systemd/system/airflow-scheduler.service</span></pre><p id="a86a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如下更改<code class="fe mx my mz lz b">ExecStart</code>值。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="12a2" class="md me jj lz b gy mf mg l mh mi">ExecStart=/usr/local/bin/airflow scheduler</span></pre><p id="4c1b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">同样的，我们也在<code class="fe mx my mz lz b">airflow-scheduler</code>里改一下吧。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="80dc" class="md me jj lz b gy mf mg l mh mi">vi /usr/lib/systemd/system/airflow-webserver.service</span></pre><p id="e005" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，<code class="fe mx my mz lz b">pid</code>需要写入我们刚刚创建的目录<code class="fe mx my mz lz b">/run/airflow</code>。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="0aa6" class="md me jj lz b gy mf mg l mh mi">ExecStart=/usr/local/bin/airflow webserver --pid /run/airflow/webserver.pid</span></pre><p id="fcca" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们需要修改气流的系统配置。否则，服务将不知道Airflow主目录在哪里。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="fa30" class="md me jj lz b gy mf mg l mh mi">vi /etc/sysconfig/airflow</span></pre><p id="0bf4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">根据我们刚才准备的内容，需要对下面的两个配置进行如下修改。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="97c8" class="md me jj lz b gy mf mg l mh mi">AIRFLOW_CONFIG=/opt/airflow/airflow.cfg<br/>AIRFLOW_HOME=/opt/airflow</span></pre><p id="ab12" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为服务配置的最后一步，我们需要在运行这些服务之前启用它们。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="49a1" class="md me jj lz b gy mf mg l mh mi">systemctl enable airflow-scheduler<br/>systemctl enable airflow-webserver</span></pre><h1 id="3475" class="na me jj bd nb nc nd ne nf ng nh ni nj kp nk kq nl ks nm kt nn kv no kw np nq bi translated">运行配置的气流守护程序</h1><figure class="lu lv lw lx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/1b0bd8d8f90b303b12677b24307ac5f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DFCb2EQvvG-Fk_b5dEk7Hw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://pixabay.com/users/suju-165106/" rel="noopener ugc nofollow" target="_blank"> suju </a>在<a class="ae jg" href="https://pixabay.com/photos/pinwheel-park-wind-children-s-toys-985699/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄</p></figure><p id="8072" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有了<code class="fe mx my mz lz b">root</code>权限(root用户或sudo)，我们可以</p><ul class=""><li id="50cb" class="mj mk jj la b lb lc le lf lh ml ll mm lp mn lt mo mp mq mr bi translated">运行气流守护程序</li></ul><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="1e3d" class="md me jj lz b gy mf mg l mh mi">systemctl start airflow-scheduler<br/>systemctl start airflow-webserver</span></pre><ul class=""><li id="1ef8" class="mj mk jj la b lb lc le lf lh ml ll mm lp mn lt mo mp mq mr bi translated">检查其状态</li></ul><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="61f5" class="md me jj lz b gy mf mg l mh mi">systemctl status airflow-scheduler<br/>systemctl status airflow-webserver</span></pre><ul class=""><li id="6c62" class="mj mk jj la b lb lc le lf lh ml ll mm lp mn lt mo mp mq mr bi translated">停止守护进程</li></ul><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="f48a" class="md me jj lz b gy mf mg l mh mi">systemctl stop airflow-scheduler<br/>systemctl stop airflow-webserver</span></pre><ul class=""><li id="8eec" class="mj mk jj la b lb lc le lf lh ml ll mm lp mn lt mo mp mq mr bi translated">重新启动守护程序</li></ul><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="1749" class="md me jj lz b gy mf mg l mh mi">systemctl restart airflow-scheduler<br/>systemctl restart airflow-webserver</span></pre><ul class=""><li id="6255" class="mj mk jj la b lb lc le lf lh ml ll mm lp mn lt mo mp mq mr bi translated">查看守护程序服务日志(最近50行，行数可使用<code class="fe mx my mz lz b">-n</code>参数定制)</li></ul><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="4495" class="md me jj lz b gy mf mg l mh mi"># journalctl -u airflow-scheduler -n 50<br/># journalctl -u airflow-webserver -n 50</span></pre><h1 id="220a" class="na me jj bd nb nc nd ne nf ng nh ni nj kp nk kq nl ks nm kt nn kv no kw np nq bi translated">摘要</h1><figure class="lu lv lw lx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/bf07985f057068e84dda1b6f8e59d6d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NzA8Vnh-by--pX5_d_0QYw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/users/distelAPPArath-2726923/" rel="noopener ugc nofollow" target="_blank">摄影师</a>在<a class="ae jg" href="https://pixabay.com/photos/pinwheel-park-wind-children-s-toys-985699/" rel="noopener ugc nofollow" target="_blank">图片栏</a>上拍摄</p></figure><p id="2bf3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文介绍了如何在CentOS系统上安装Airflow。然后，我认为如果我们简单地在命令行运行Airflow会有缺点，所以我们需要通过将它作为守护进程来解决这个问题。</p><p id="7e92" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们首先需要从Apache Airflow GitHub repo下载服务定义文件，然后将它们放入正确的系统目录中。我们还需要创建一些文件夹，因为守护进程需要它们来正确运行。</p><p id="d5b6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们需要配置服务定义文件，以确保守护程序可以在正确的位置找到资源。之后，我们可以将Apache Airflow作为守护进程运行，这样它将收集适当的服务运行日志，并在出现问题时自动重启服务。</p><div class="is it gp gr iu ns"><a href="https://medium.com/@qiuyujx/membership" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jk gy z fp nx fr fs ny fu fw ji bi translated">通过我的推荐链接加入Medium克里斯托弗·陶</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">medium.com</p></div></div><div class="ob l"><div class="pi l od oe of ob og ja ns"/></div></div></a></div><p id="7d6b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你觉得我的文章有帮助，请考虑加入Medium会员来支持我和成千上万的其他作者！(点击上面的链接)</p></div></div>    
</body>
</html>