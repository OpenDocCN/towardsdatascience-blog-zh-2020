<html>
<head>
<title>Docker: You Are Doing it Wrong</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">码头工人:你做错了</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/docker-you-are-doing-it-wrong-e703075dd67b?source=collection_archive---------6-----------------------#2020-06-25">https://towardsdatascience.com/docker-you-are-doing-it-wrong-e703075dd67b?source=collection_archive---------6-----------------------#2020-06-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7ff5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 VS 代码和 Docker 扩展成为 Docker 超级用户。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4f9e4939e70a578344cf26134a9478df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fWPTwnLBSgrKVb3uqAvdvw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">micha Parzuchowski 在<a class="ae ky" href="/s/photos/difficult?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5eb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您已经用自己选择的语言实现了服务。现在，您希望在将它部署到生产环境之前，将其打包并在本地进行测试。第一步是编写 Dockerfile 文件、构建映像、运行容器并检查日志。对吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/75cf9356720f7210933036eaeb28e4e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*KDcZhABwvcVpcXxH1doNlA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">插图作者<a class="ae ky" href="https://twitter.com/laurelcomics?lang=en" rel="noopener ugc nofollow" target="_blank">劳雷尔·杜尔马尔</a></p></figure><p id="010c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不完全是。虽然这个过程是完全可以接受的，但有一个更好的方法:<strong class="lb iu">一个可以为您编写 Docker 文件的工具，如果您想要编辑它，它可以帮助您自动完成，并提供一个图形用户界面来与 Docker 引擎进行交互。</strong></p><blockquote class="lw"><p id="20f8" class="lx ly it bd lz ma mb mc md me mf lu dk translated">如果有一个工具可以为你编写 Docker 文件，帮助你自动完成，并提供图形用户界面与 Docker 引擎进行交互，会怎么样？</p></blockquote><p id="8b53" class="pw-post-body-paragraph kz la it lb b lc mg ju le lf mh jx lh li mi lk ll lm mj lo lp lq mk ls lt lu im bi translated">Visual Studio 代码的 Docker 扩展不仅仅是另一个 IDE 扩展。它有能力提升你与 Docker 的工作方式。<strong class="lb iu">在这个故事中，我们深入探讨了 Docker Visual Studio 代码扩展可以做什么，以及如何使用它成为 Docker 超级用户。</strong></p><blockquote class="ml mm mn"><p id="c698" class="kz la mo lb b lc ld ju le lf lg jx lh mp lj lk ll mq ln lo lp mr lr ls lt lu im bi translated"><a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=article&amp;utm_medium=medium&amp;utm_campaign=docker_vs_code&amp;utm_term=docker_vs_code" rel="noopener ugc nofollow" target="_blank">学习率</a>是我每周给那些对 AI 和 MLOps 世界好奇的人发的简讯。你会在每周五收到我关于最新人工智能新闻、研究、回购和书籍的更新和想法。在这里订阅<a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=article&amp;utm_medium=medium&amp;utm_campaign=docker_vs_code&amp;utm_term=docker_vs_code" rel="noopener ugc nofollow" target="_blank"/>！</p></blockquote></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="4c39" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">Docker + VS</h1><p id="ae73" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">VS 代码的 Docker 扩展使得从 Visual Studio 代码构建、运行、管理和部署容器化的应用程序变得容易。要开始使用它，请确保<a class="ae ky" href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker" rel="noopener ugc nofollow" target="_blank">下载 Visual Studio 代码市场的扩展</a>。此外，这是一个开源项目，因此您可以检查它的代码，安装过程非常简单，因此没有必要在这里的另一节中介绍它。</p><h1 id="9c84" class="mz na it bd nb nc nw ne nf ng nx ni nj jz ny ka nl kc nz kd nn kf oa kg np nq bi translated">主要特征</h1><p id="0387" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">在这一节中，我们将介绍 Docker 扩展的突出特性。稍后，我们将在一个简单的示例中使用它们中的许多。</p><ul class=""><li id="4b53" class="ob oc it lb b lc ld lf lg li od lm oe lq of lu og oh oi oj bi translated"><strong class="lb iu">编辑 docker 文件:</strong>编辑<code class="fe ok ol om on b">Dockerfile</code>和<code class="fe ok ol om on b">docker-compose.yml</code>文件时，您可以使用智能感知自动完成功能。此外，您还可以获得常用命令的语法帮助。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/52199d6e8712dd2b3e629b0783b5c7b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sOXYvH4QKfBhGlIf.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">VS 代码上 Docker 的智能感知和语法帮助</p></figure><ul class=""><li id="ff04" class="ob oc it lb b lc ld lf lg li od lm oe lq of lu og oh oi oj bi translated"><strong class="lb iu">通用 Dockerfiles: </strong>通过使用命令面板中的<code class="fe ok ol om on b">Docker: Add Docker Files to Workspace</code>命令，你可以生成并添加一个 Dockerfile 到你的工作空间。该命令将生成<code class="fe ok ol om on b">Dockerfile</code>和<code class="fe ok ol om on b">.dockerignore</code>文件，并将它们添加到您的工作区。您也可以使用此命令来生成 Docker 合成文件。这将证明在调试时非常方便。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/b8affe0df184b24ffaf8a4effd4ea286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KRg1kMZ3ArnoTJ51PqrdaQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为一个简单的 flask 应用程序生成 docker 文件</p></figure><ul class=""><li id="8da7" class="ob oc it lb b lc ld lf lg li od lm oe lq of lu og oh oi oj bi translated"><strong class="lb iu">Explore:</strong>Docker 扩展为 VS 代码贡献了一个 Docker 视图。Docker 视图允许您检查和管理 Docker 资产:容器、映像、卷、网络和容器注册表。一切只需点击鼠标右键。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/950676fdc077b5aaf30ec0363da077e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/0*3MNyXWjZOE4rIavq.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">VS 代码中的 Docker 视图</p></figure><ul class=""><li id="ecd4" class="ob oc it lb b lc ld lf lg li od lm oe lq of lu og oh oi oj bi translated"><strong class="lb iu">执行 Docker 命令:</strong>许多最常见的 Docker 命令都内置在命令面板中。您可以运行 Docker 命令来管理<a class="ae ky" href="https://docs.docker.com/engine/reference/commandline/image/" rel="noopener ugc nofollow" target="_blank">图像</a>、<a class="ae ky" href="https://docs.docker.com/engine/reference/commandline/network/" rel="noopener ugc nofollow" target="_blank">网络</a>、<a class="ae ky" href="https://docs.docker.com/engine/reference/commandline/volume/" rel="noopener ugc nofollow" target="_blank">卷</a>、<a class="ae ky" href="https://docs.docker.com/engine/reference/commandline/push/" rel="noopener ugc nofollow" target="_blank">图像注册表</a>，以及<a class="ae ky" href="https://docs.docker.com/compose/reference/overview/" rel="noopener ugc nofollow" target="_blank"> Docker 组合</a>。此外，<code class="fe ok ol om on b"><strong class="lb iu">Docker: Prune System</strong></code>命令将删除停止的容器、悬挂的图像以及未使用的网络和卷。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/8ac5391e518e66be35b2808c5696daeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2izSnI9aIEHf2Zvq.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">集成到调色板中的通用 Docker 命令</p></figure><ul class=""><li id="33ca" class="ob oc it lb b lc ld lf lg li od lm oe lq of lu og oh oi oj bi translated"><strong class="lb iu">调试容器:</strong>使用 Docker 扩展，我们可以调试使用 Node.js、Python 或。NET (C#)在一个容器内运行。</li></ul><p id="1202" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有更多的特性，比如注册表连接和上下文管理，但是仅仅通过使用这些关键的产品，你就可以走很长的路。接下来，我们实现一个简单的 Python Flask 应用程序，对它进行 dockerize 并部署它，而无需摆弄 Docker CLI。</p><h1 id="cf16" class="mz na it bd nb nc nw ne nf ng nx ni nj jz ny ka nl kc nz kd nn kf oa kg np nq bi translated">简单的例子</h1><p id="2515" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">在本节中，我们构建一个简单的"<em class="mo"> Hello World </em> " Flask 应用程序，并使用 Docker 扩展部署它。首先，代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="9cda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您熟悉 Flask，您会发现这是您可以实现的最简单的应用程序。每当您点击根端点时，它就返回“<em class="mo"> Hello World </em>”。接下来，我们需要一个<code class="fe ok ol om on b">requirements.txt</code>文件来保存依赖项，我们已经准备好了:</p><pre class="kj kk kl km gt ou on ov ow aw ox bi"><span id="b363" class="oy na it on b gy oz pa l pb pc">Flask==1.1.2<br/>gunicorn</span></pre><p id="042c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建 Dockerfile 和其他任何东西，你只需要在命令面板中运行<code class="fe ok ol om on b">Docker: Add Docker Files to Workspace</code>(windows 中的<code class="fe ok ol om on b">ctlr+shift+p</code>)。</p><p id="8a9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为第一个问题选择<code class="fe ok ol om on b">Python: Flask</code>选项，然后，扩展将询问您是否想要包含可选的 Docker 编写文件。选择是；这样，您将能够在以后调试运行在容器内部的应用程序。最后，选择包含 Flask 应用程序的 python 文件(上面提供的代码)和您想要公开的端口(<code class="fe ok ol om on b">5000</code>是默认的)。你准备好了！</p><p id="8881" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，要构建图像，右键单击生成的 Dockerfile 并选择<code class="fe ok ol om on b">Build Image...</code>。一个终端将打开，你的图像将在几秒钟内准备好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/902aedd01e774b41b187be374c2a5a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zH0Gz7KzyNjcwg6C9cMo2Q.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 VS 代码的 Docker 扩展构建您的映像</p></figure><p id="ef21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要运行应用程序，从左侧面板选择 Docker 图标，在<code class="fe ok ol om on b">Images</code>部分找到您的图像，右键单击它并选择 run。就这么简单。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/1cb74c4f4d87e98b6e75196dcb3a47e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5ygOpNtIPSZSuACtGZmlAA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 VS 代码的 Docker 扩展运行你的容器</p></figure><p id="b63f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ok ol om on b">Containers</code>部分找到正在运行的容器，右键单击它并选择<code class="fe ok ol om on b">View Logs</code>。这个命令将在终端中显示容器的日志。获取它正在监听的端点(应该是<code class="fe ok ol om on b"><a class="ae ky" href="http://0.0.0.0:5000" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:5000</a></code>)。要获得 Python 服务的结果，请运行<code class="fe ok ol om on b">curl <a class="ae ky" href="http://0.0.0.0:5000" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:5000</a></code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/b5c67a739d00c9a773c73d7fd6f96d5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*RIlAgLHJoUHj8B4OiniNZA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 VS 代码的 Docker 扩展查看日志</p></figure><p id="dbce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！VS 代码的 Docker 扩展简化了这个过程，你可以有时间专注于你的代码。</p><h1 id="fc07" class="mz na it bd nb nc nw ne nf ng nx ni nj jz ny ka nl kc nz kd nn kf oa kg np nq bi translated">排除故障</h1><p id="0182" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">要用 Gunicorn 配置调试，我们需要更多的东西。<code class="fe ok ol om on b">The Docker: Python-Flask</code>使用 Python 调试器，自动创建的启动配置会覆盖容器的 Gunicorn 入口点。要调试运行 Gunicorn 的应用程序，我们应该遵循以下步骤:</p><ol class=""><li id="1261" class="ob oc it lb b lc ld lf lg li od lm oe lq of lu pd oh oi oj bi translated">将<code class="fe ok ol om on b">debugpy</code>添加到您的<code class="fe ok ol om on b">requirements.txt</code>文件中。</li><li id="ea0e" class="ob oc it lb b lc pe lf pf li pg lm ph lq pi lu pd oh oi oj bi translated">将以下代码片段添加到要调试的文件中:</li></ol><pre class="kj kk kl km gt ou on ov ow aw ox bi"><span id="0103" class="oy na it on b gy oz pa l pb pc">import debugpy<br/>debugpy.listen(("0.0.0.0", 5678))<br/>debugpy.wait_for_client()</span></pre><p id="4dcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.将一个<code class="fe ok ol om on b">Python: Remote Attach</code>配置添加到<code class="fe ok ol om on b">.vscode</code>文件夹中的<code class="fe ok ol om on b">launch.json</code>中。JSON 文件现在应该如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="f060" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.通过将<code class="fe ok ol om on b">5678:5678</code>添加到 ports 部分，修改<code class="fe ok ol om on b">docker-compose.yml</code>文件以公开调试器端口。该文件现在应该如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="b056" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.右键单击一个<code class="fe ok ol om on b">docker-compose.yml</code>文件并选择 Compose Up 来启动容器。</p><p id="e1ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6.在所选文件中设置断点，导航至<code class="fe ok ol om on b">Run and Debug</code>并选择<code class="fe ok ol om on b">Python: Remote Attach</code>启动配置。</p><p id="9a78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">7.按 F5 或按播放按钮来连接调试器。</p><p id="99d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">调试愉快！</p><h1 id="4431" class="mz na it bd nb nc nw ne nf ng nx ni nj jz ny ka nl kc nz kd nn kf oa kg np nq bi translated">结论</h1><p id="852f" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">在这个故事中，我们探索了 VS 代码的 Docker 扩展，以及它如何帮助我们编写 Docker 文件、构建映像并部署它。要深入了解，请查看 Visual Studio 代码文档网站上的<a class="ae ky" href="https://code.visualstudio.com/docs/containers/overview" rel="noopener ugc nofollow" target="_blank">使用容器</a>主题。</p><blockquote class="ml mm mn"><p id="34ec" class="kz la mo lb b lc ld ju le lf lg jx lh mp lj lk ll mq ln lo lp mr lr ls lt lu im bi translated"><a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=article&amp;utm_medium=medium&amp;utm_campaign=docker_vs_code&amp;utm_term=docker_vs_code" rel="noopener ugc nofollow" target="_blank">学习率</a>是我每周给那些对 AI 和 MLOps 世界好奇的人发的简讯。你会在每周五收到我关于最新人工智能新闻、研究、回购和书籍的更新和想法。在这里订阅<a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=article&amp;utm_medium=medium&amp;utm_campaign=docker_vs_code&amp;utm_term=docker_vs_code" rel="noopener ugc nofollow" target="_blank"/>！</p></blockquote><h1 id="d7ae" class="mz na it bd nb nc nw ne nf ng nx ni nj jz ny ka nl kc nz kd nn kf oa kg np nq bi translated">关于作者</h1><p id="ed7e" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">我的名字是<a class="ae ky" href="https://www.dimpo.me/?utm_source=article&amp;utm_medium=medium&amp;utm_campaign=docker_vs_code&amp;utm_term=docker_vs_code" rel="noopener ugc nofollow" target="_blank"> Dimitris Poulopoulos </a>，我是一名为<a class="ae ky" href="https://www.arrikto.com/" rel="noopener ugc nofollow" target="_blank"> Arrikto </a>工作的机器学习工程师。我曾为欧洲委员会、欧盟统计局、国际货币基金组织、欧洲央行、经合组织和宜家等主要客户设计和实施过人工智能和软件解决方案。</p><p id="dce9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有兴趣阅读更多关于机器学习、深度学习、数据科学和数据运算的帖子，请在 Twitter 上关注我的<a class="ae ky" href="https://towardsdatascience.com/medium.com/@dpoulopoulos/follow" rel="noopener" target="_blank"> Medium </a>、<a class="ae ky" href="https://www.linkedin.com/in/dpoulopoulos/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae ky" href="https://twitter.com/james2pl" rel="noopener ugc nofollow" target="_blank"> @james2pl </a>。此外，请访问我的网站上的<a class="ae ky" href="https://www.dimpo.me/resources/" rel="noopener ugc nofollow" target="_blank">资源</a>页面，这里有很多好书和顶级课程，开始构建您自己的数据科学课程吧！</p></div></div>    
</body>
</html>