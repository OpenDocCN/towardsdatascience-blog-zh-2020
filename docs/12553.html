<html>
<head>
<title>Forecasting the Copper Producer Price Index with Prophet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Prophet 预测铜生产者价格指数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/forecasting-the-copper-producer-price-index-with-prophet-d570e3baac78?source=collection_archive---------30-----------------------#2020-08-29">https://towardsdatascience.com/forecasting-the-copper-producer-price-index-with-prophet-d570e3baac78?source=collection_archive---------30-----------------------#2020-08-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d188" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用 Prophet 预测商品价格</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5286fc7891d5c961de2c1131d1b2d540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PCJGkVsRBftByFgwep43A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:图片由<a class="ae ky" href="https://pixabay.com/photos/coins-ancient-roman-money-old-4786028/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/papazachariasa-12696704/" rel="noopener ugc nofollow" target="_blank"> papazachariasa </a>提供</p></figure><p id="7497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">免责声明:本文是在“原样”的基础上编写的，没有担保。它旨在提供数据科学概念的概述，不应被解释为投资建议或任何其他类型的专业建议。</em></p><p id="7fc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使在最好的情况下，预测资产价格也可能是一件棘手的事情。首先，资产价格受高度随机性(或随机影响)的影响，这使得预测未来变得困难。</p><p id="59fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，脸书的<a class="ae ky" href="https://facebook.github.io/prophet/docs/trend_changepoints.html" rel="noopener ugc nofollow" target="_blank">先知时间序列模型</a>的一个有用的特性是能够识别<strong class="lb iu">变点</strong>，或者时间序列中重大结构变化的时期。准确识别这些点反过来可以改进时间序列预测。让我们看看 Prophet 如何预测铜的生产者价格指数。数据来源于<a class="ae ky" href="https://fred.stlouisfed.org/series/WPUSI019011" rel="noopener ugc nofollow" target="_blank">弗雷德经济数据</a>使用 Quandl。</p><h1 id="bee8" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">背景</h1><p id="a49b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">铜生产者价格指数从 1985 年 9 月到 2020 年 7 月进行分析。由于这是一个金融时间序列，因此该序列被转换为对数格式，以平滑数据并确保模型考虑了百分比基础上的回报。</p><p id="d1b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一张数据图表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/4c4b5f5a4251966fc48b3dbf43f61bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*nJ8FgmqhHqCwUEcZxnvzfA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">资料来源:弗雷德经济数据</p></figure><p id="dc9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从 1985 年 9 月<strong class="lb iu">到 2017 年 1 月<strong class="lb iu">的数据作为训练数据。截止到 2020 年 7 月</strong>的剩余月份用作测试数据——这些数据用于与模型预测进行比较，以评估准确性。</strong></p><p id="c95b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是对该系列的分解:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/8f0bc72a8e21a3489efec961bef438ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*sTz9K1jEb5zFiZaZ6js-fg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="e8a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，在这种情况下，该系列有一个强大的上升趋势。然而，没有证据表明该系列具有季节性。</p><p id="0291" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，数据中确实出现了几个结构性突变。从这个角度来看，Prophet 模型在预测测试数据的价格时可能会产生很好的预测能力。</p><h1 id="8882" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">模型结构</h1><p id="9fc9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">数据集定义如下:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="203a" class="na lx it mw b gy nb nc l nd ne">train_dataset= pd.DataFrame()<br/>train_dataset['ds'] = train_df['Date']<br/>train_dataset['y']= train_df['Value']<br/>train_dataset.head(10)</span></pre><p id="6ca5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">标准 Prophet 模型与数据集的拟合如下:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="cd06" class="na lx it mw b gy nb nc l nd ne">prophet_basic = Prophet()<br/>prophet_basic.fit(train_dataset)</span></pre><p id="08c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是使用该模型生成的预测:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="46ad" class="na lx it mw b gy nb nc l nd ne">forecast=prophet_basic.predict(future)<br/>fig1 =prophet_basic.plot(forecast)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/2c85817cd73ac51085c6ea17207e254d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fgtqx22694_bd1pdov0pBw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:先知</p></figure><p id="fad0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所述，特别令人感兴趣的是<strong class="lb iu">变化点</strong>，或者时间序列中的重大结构突变。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="7e62" class="na lx it mw b gy nb nc l nd ne">from fbprophet.plot import add_changepoints_to_plot<br/>fig = prophet_basic.plot(forecast)<br/>a = add_changepoints_to_plot(fig.gca(), prophet_basic, forecast)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/c129a752c2abd3b2c3303d74599f7fb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LK2o5JnI6hqHv53vZbnLiA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:先知</p></figure><p id="d34b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上图可以明显看出，模型已经识别出 12 个变化点。现在在此基础上进行预测。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="47d2" class="na lx it mw b gy nb nc l nd ne">pro_change= Prophet(n_changepoints=12)<br/>forecast = pro_change.fit(train_dataset).predict(future)<br/>fig= pro_change.plot(forecast);<br/>a = add_changepoints_to_plot(fig.gca(), pro_change, forecast)</span><span id="7555" class="na lx it mw b gy ng nc l nd ne">future_data = pro_change.make_future_dataframe(periods=43, freq = 'm')<br/> <br/>#forecast the data for future data<br/>forecast_data = pro_change.predict(future_data)<br/>pro_change.plot(forecast_data);</span></pre><p id="7134" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Prophet 生成了详细的预测:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/b1f08fcec3b9b2d1fd670a5b4199869c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LLYFJKB2XOq0Q8vzCZ2EoQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:先知</p></figure><h1 id="c798" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">准确(性)</h1><p id="a765" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在让我们根据以下内容评估模型的准确性:</p><ul class=""><li id="6c4a" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated"><strong class="lb iu">平均定向精度:</strong> 95%</li><li id="6195" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><strong class="lb iu">均方根误差:</strong> 0.1948</li><li id="c870" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><strong class="lb iu">平均预测误差:</strong> 0.1839</li></ul><p id="5562" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是测试集的预测价格与实际价格的对比图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/1e55f91b935d0f01e6509a697d73e9aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*lOHJWfjOFT-0-GUOGZo92Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="d02e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整个测试集的平均值为 5.93(以对数表示)，相比之下，RMSE 和 MAE 相当低(大约为平均值的 3%)，表明该模型在预测方面表现良好。由于我们使用的是月度数据，因此不清楚当使用较短的时间范围(例如每小时或每天)时，该模型的表现如何。从这个角度来看，模型预测在预测短期波动方面可能是有限的，但在捕捉总体趋势方面似乎做得相当好。</p><p id="b947" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，由于 MDA 为 95%，这表明该模型能够在 95%的时间内预测特定月份的价格方向，这相当不错。</p><p id="32f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，变点配置对预测准确性有直接影响。例如，当预测中的变点数降低到<strong class="lb iu"> 4 </strong>时，RMSE 达到<strong class="lb iu"> 0.2840 </strong>。虽然这与平均值相比仍然很低，但仍然是用 12 个变点计算的 RMSE 的近两倍。</p><h1 id="3625" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">限制</h1><p id="948e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">一般来说，预测资产价格(或任何种类的经济数据)都很棘手。</p><p id="b9d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为资产价格天生受制于反馈回路。例如，假设一个预言家模型在预测铜价方面带来近乎完美的准确性。在这种情况下，更广泛的市场最终将开始使用该模型——假设市场在长期内保持有效——此时，就预测能力而言，竞争优势不再能够获得。</p><p id="0c8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，不像天气这样的时间序列——它不能通过人为干预来改变——基于预测的后续交易具有改变价格本身的效果——这意味着以前准确的预测不再准确。</p><p id="d168" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，金融时间序列可能会受到干预，这些干预在以前的数据中可能没有被捕捉到。例如，2008 年之前的时间序列数据不会捕捉到美联储将美国利率降至零的情况，因此时间序列本身无法解释如此重大的结构性变化。</p><p id="d8e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当涉及到具体的干预建模时，更有效的方法可能是通过使用<a class="ae ky" href="https://github.com/dafiti/causalimpact" rel="noopener ugc nofollow" target="_blank">因果影响</a>包。这里有一个<a class="ae ky" rel="noopener" target="_blank" href="/analysing-time-series-interventions-with-causalimpact-currency-fluctuations-e6ab14a30768">的例子</a>，说明如何使用这样的工具来模拟利率变化对货币波动的影响。</p><h1 id="b59b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">结论</h1><p id="f853" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在这个例子中，我们已经看到，在预测资产价格的长期趋势时，Prophet 可以非常有效，并且在识别重大结构变化点以通知此类预测时特别有效。</p><p id="8ed6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢您的阅读，非常感谢您的任何问题或反馈。</p><p id="657a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更新:如果你感兴趣，<a class="ae ky" href="https://medium.com/@mgcodesandstats/cnn-vs-prophet-forecasting-the-copper-producer-price-index-af4da63bd93d" rel="noopener">这里有一篇关于这个主题的更新文章，我在其中讨论了如何使用 CNN(卷积神经网络)预测铜价！</a></p></div></div>    
</body>
</html>