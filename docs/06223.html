<html>
<head>
<title>How to use D3js with WebComponents</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将D3js与WebComponents一起使用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-d3js-with-webcomponents-a75ae4f980de?source=collection_archive---------30-----------------------#2020-05-19">https://towardsdatascience.com/how-to-use-d3js-with-webcomponents-a75ae4f980de?source=collection_archive---------30-----------------------#2020-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/400bf6882d5a6146059be8375a05d185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpyrgqwMjfclV2oN1U2VIA.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">卢克·切瑟在Unsplash<a class="ae jd" href="https://unsplash.com/s/photos/metrics?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">上的照片</a></p></figure><div class=""/><div class=""><h2 id="d9b8" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">用D3js和模板制作强大的图形</h2></div><p id="dbf4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">D3是一个非常棒的用于数据可视化的开源库，最初由Mike Bostock开发。它提供了各种各样的工具，允许从零开始或使用预建的模板制作罕见的图形。D3提供的可能性是无限的，你只需要看看<a class="ae jd" href="https://observablehq.com/@d3/gallery" rel="noopener ugc nofollow" target="_blank">他们的画廊</a>。</p><p id="c65a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你已经使用过D3，你会知道除了得到惊人的图形之外，你还会得到一堆脚本，用于格式化数据、迭代SVG元素、与服务器通信的服务、模型等等..所有这些，很可能，在一个与图表本身联系不紧密的项目中，真是一团糟！</p><p id="a8fb" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">幸运的是，<strong class="kx jh"> Web组件</strong>的世界比以往任何时候都更容易接近，它是创建<strong class="kx jh">自己的图形中枢</strong>以及<strong class="kx jh">封装的</strong>和<strong class="kx jh">可重用的</strong>的完美工具。在任何地方的自定义元素上，您都可以检查Web组件是否与您首选的开发框架兼容。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="484e" class="ly lz jg bd ma mb mc md me mf mg mh mi km mj kn mk kp ml kq mm ks mn kt mo mp bi translated">StencilJS</h1><p id="ec92" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated"><a class="ae jd" href="https://stenciljs.com/" rel="noopener ugc nofollow" target="_blank"> Stencil </a>是一个web组件，或者更确切地说是自定义元素，一个使用了大多数已知Web开发框架的主要功能的编译器。</p><p id="e412" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个工具是由<a class="ae jd" href="https://ionicframework.com/" rel="noopener ugc nofollow" target="_blank"><em class="mv">ionic framework</em></a><em class="mv"/>开发的，旨在让兼容多种web开发框架的组件变得更加容易，朝着一个不可知的框架思想发展。</p><p id="c87e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，在一个基于<em class="mv"> Web组件</em> ( <em class="mv">定制组件</em>)标准的项目中使用D3，使用<em class="mv"> StencilJS </em>是一个优雅且容易实现的解决方案，如果你想要一个可重用的图形项目的话。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="2fe6" class="ly lz jg bd ma mb mc md me mf mg mh mi km mj kn mk kp ml kq mm ks mn kt mo mp bi translated">第一步:创建模具项目</h1><p id="c2f4" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">首先使用<code class="fe mw mx my mz b">npm</code>安装最新版本的<em class="mv"> StencilJS </em>并初始化基础项目:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="cc09" class="ni lz jg mz b gy nj nk l nl nm">npm install @stencil/core@latest --save-exact<br/>npm init stencil</span></pre><p id="fb2c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用箭头键选择<code class="fe mw mx my mz b">component</code>选项，并设置项目名称。Stencil的CLI将创建一个项目文件夹，您会在其中找到包含默认生成的第一个组件<code class="fe mw mx my mz b">my-component</code>的<code class="fe mw mx my mz b">src</code>文件夹。组件文件夹的<code class="fe mw mx my mz b">.tsx</code>文件是包含其主要逻辑的文件。</p><figure class="na nb nc nd gt is gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/33aa8ae8f8c65d2954d1d5d79244838d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/0*sww7cbVu9OBUefAJ.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">生成组件的脚手架</p></figure><p id="c442" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，通过在控制台的根项目文件夹中键入<code class="fe mw mx my mz b">start</code>命令，检查一切是否正常。</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="be14" class="ni lz jg mz b gy nj nk l nl nm">npm run start</span></pre><p id="62cf" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">应该会打开一个新的浏览器窗口，显示<strong class="kx jh"> HelloWorld！</strong>的<em class="mv">模版，</em>的<em class="mv">老实说有点钝。</em></p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="3b9d" class="ly lz jg bd ma mb mc md me mf mg mh mi km mj kn mk kp ml kq mm ks mn kt mo mp bi translated">步骤2:导入D3并创建一个图表</h1><p id="5cd6" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">启动项目后，代码中的任何更新都将呈现在浏览器上。现在，我们只需要将D3导入到组件的代码中。首先，我们需要使用<code class="fe mw mx my mz b">npm</code>来安装它:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="c2b6" class="ni lz jg mz b gy nj nk l nl nm">npm install d3 --save</span></pre><p id="fd1c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通常，当我们在Javascript代码中使用d3时，我们一次导入D3别名上所有引用，如下所示:<code class="fe mw mx my mz b">import * from ‘d3.js'</code>。然而，从上一版本开始，使用<em class="mv">打字稿</em>，我们将不得不单独导入不同的模块。这有点乏味，但它会帮助我们使应用程序轻量级。在本例中，我们使用的是<strong class="kx jh">饼图</strong>，因此我们将导入以下模块:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="f910" class="ni lz jg mz b gy nj nk l nl nm">import { select } from 'd3-selection'<br/>import { pie, arc } from 'd3-shape';import { scaleOrdinal } from 'd3-scale';<br/>import { quantize } from 'd3-interpolate';<br/>import { interpolateCool } from 'd3-scale-chromatic';</span></pre><ul class=""><li id="a4fd" class="no np jg kx b ky kz lb lc le nq li nr lm ns lq nt nu nv nw bi translated"><code class="fe mw mx my mz b">select</code>操作符允许获取我们想要使用或修改的<code class="fe mw mx my mz b">html</code>元素的引用。</li><li id="206b" class="no np jg kx b ky nx lb ny le nz li oa lm ob lq nt nu nv nw bi translated"><code class="fe mw mx my mz b">pie</code>操作员负责生成数据结构，而<code class="fe mw mx my mz b">arc</code>是一个工具，允许我们生成绘制图表所需的角度值和比率。</li><li id="fc5c" class="no np jg kx b ky nx lb ny le nz li oa lm ob lq nt nu nv nw bi translated"><code class="fe mw mx my mz b">scaleOrdinal</code>、<code class="fe mw mx my mz b">quantize</code>和<code class="fe mw mx my mz b">interpolateCool</code>运算符帮助我们根据图表各部分的值生成多种颜色。</li></ul><p id="c86f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这样，我们就设置好了，我们只需要知道在哪里放置D3代码。该组件的基本结构如下所示:</p><figure class="na nb nc nd gt is"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="c044" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Stencil API提供了许多装饰器和方法，允许我们与组件及其生命周期进行交互。</p><h1 id="4d6d" class="ly lz jg bd ma mb oe md me mf of mh mi km og kn mk kp oh kq mm ks oi kt mo mp bi translated">道具()</h1><p id="3458" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">这个装饰器允许从组件的外部世界获取输入。在我们的例子中，这些将是图表数据。这些输入是在html中使用我们的组件时提供的。</p><p id="a762" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">事实上，如果我们查看项目文件，<code class="fe mw mx my mz b">src/index.html</code>包含生成的组件(在本例中只有一个),我们可以看到组件的实例化是这样完成的:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="cd5a" class="ni lz jg mz b gy nj nk l nl nm">&lt;my-component data='myData'&gt;&lt;/my-component&gt;</span></pre><p id="4713" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">其中<code class="fe mw mx my mz b">myData</code>是提供给我们的组件的数据结构，因此它可以迭代它并绘制图表。</p><h1 id="b2d2" class="ly lz jg bd ma mb oe md me mf of mh mi km og kn mk kp oh kq mm ks oi kt mo mp bi translated">渲染()</h1><p id="34d7" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">该函数在组件被实例化或修改后被调用，负责生成最终将由浏览器呈现的<code class="fe mw mx my mz b">html</code>标签。这里我们生成组件的<code class="fe mw mx my mz b">html</code>模式，并且我们将包含SVG元素，我们将使用它来生成所有的饼状图元素。</p><h1 id="7a3a" class="ly lz jg bd ma mb oe md me mf of mh mi km og kn mk kp oh kq mm ks oi kt mo mp bi translated">componentDidLoad()</h1><p id="2f36" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">一旦元素被完全加载，这个方法就被调用，防止我们得到组件的html元素的空引用。</p><p id="7aaa" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">与D3相关的逻辑用于重新生成数据结构和图形元素，必须在这个方法中设置，这样我们可以保证我们可以引用最终的html。</p><h1 id="354d" class="ly lz jg bd ma mb oe md me mf of mh mi km og kn mk kp oh kq mm ks oi kt mo mp bi translated">元素()</h1><p id="f9fc" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">这个装饰器允许我们访问主组件，从而迭代其子元素<code class="fe mw mx my mz b">html</code>。特别是，这是我们使用D3的<code class="fe mw mx my mz b">select</code>函数并获取SVG的参考，我们将在SVG中膨胀我们的图表。由于模板的封装，我们必须通过<code class="fe mw mx my mz b">shadowRoot</code>访问:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="53c1" class="ni lz jg mz b gy nj nk l nl nm">select(this.element.shadowRoot.querySelectorAll(".chart")[0]);</span></pre><figure class="na nb nc nd gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oj"><img src="../Images/7dd0c3ea7eb2b92e597aa6d3f21f2888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*H2JJRTeXOm4S4zAY.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">用于上下文隔离的组件封装</p></figure><p id="a68e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦我们得到了SVG元素的引用，我们可能会忘记所有关于<em class="mv">模板</em>的事情，开始专门考虑D3。所以我们添加脚本来生成饼图(或其他),这就是了，我们将准备好我们的<em class="mv"> webcomponent </em>:</p><p id="8fed" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用前面的代码，我们将得到如下图表:</p><figure class="na nb nc nd gt is gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/3e692133eb83db67ec538d927abb9bc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*BPmhtmI4HFSrz50m.gif"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">圆形分格统计图表</p></figure><p id="0d58" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以在GitHub链接中找到完整的代码示例。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="1a95" class="ly lz jg bd ma mb mc md me mf mg mh mi km mj kn mk kp ml kq mm ks mn kt mo mp bi translated">最后:导出并随处重用</h1><p id="1a08" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">一旦我们准备好发布我们的图表，我们只需要建立它，并在我们可能有的任何其他项目中使用它。幸运的是，这个过程非常简单，只需检查<code class="fe mw mx my mz b">package.json</code>文件来设置项目名称、版本号、许可证、描述等..并发射<code class="fe mw mx my mz b">build</code>命令:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="bc31" class="ni lz jg mz b gy nj nk l nl nm">npm run build</span></pre><p id="bdfd" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将在<code class="fe mw mx my mz b">www/build</code>文件夹中生成准备分发的WebComponent。要在任何其他项目中使用它，您只需将其发布到您的<a class="ae jd" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>帐户中，即可享受其所有功能:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="7643" class="ni lz jg mz b gy nj nk l nl nm">npm login<br/>npm publish</span></pre></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="ce30" class="ly lz jg bd ma mb mc md me mf mg mh mi km mj kn mk kp ml kq mm ks mn kt mo mp bi translated">结论</h1><p id="39d1" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated"><em class="mv">模板</em>允许创建一个<strong class="kx jh">模块化的工作环境，可导出和访问</strong>主web开发框架。这是一个很好的机会来统一多个项目的所有图形元素，并标准化它们的使用，代码回收，html，css等..</p><p id="54b3" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你在一个与<strong class="kx jh"> UX/UI </strong>部门持续接触的开发团队中工作，那么模板是开发一个可持续的<a class="ae jd" href="https://stenciljs.com/docs/what-is-design-system" rel="noopener ugc nofollow" target="_blank"> <strong class="kx jh">设计系统</strong> </a> <strong class="kx jh"> </strong>的完美地方，它可以一劳永逸地让每个人都轻松。</p></div></div>    
</body>
</html>