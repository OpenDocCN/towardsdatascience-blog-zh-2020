<html>
<head>
<title>Getting started with PyTorch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyTorch 入门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-started-with-pytorch-9bae16926744?source=collection_archive---------38-----------------------#2020-07-15">https://towardsdatascience.com/getting-started-with-pytorch-9bae16926744?source=collection_archive---------38-----------------------#2020-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5ad8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于如何使用 PyTorch 进行数据分析和推断的实践演练。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/340c94888b50068c6c32b1b7e2fa0fca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Nm9G7o_5_46OYF0O"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">伊霍尔·马里茨基在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="kz la l"/></div></figure><h1 id="ff9f" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">介绍</h1><p id="e525" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">PyTorch 是目前发展最快的深度学习 Python 框架之一。事实上，这个库最初主要由研究人员使用，以创建新的模型，但由于最近的进步，它也引起了许多公司的兴趣。对该框架感兴趣的一些原因是:</p><ul class=""><li id="2cf2" class="mp mq it lv b lw mr lz ms mc mt mg mu mk mv mo mw mx my mz bi translated">GPU 优化的张量计算(类似矩阵的数据结构)使用非常类似 Numpy 的接口，以便于采用。</li><li id="ebf1" class="mp mq it lv b lw na lz nb mc nc mg nd mk ne mo mw mx my mz bi translated">使用<a class="ae ky" href="https://pytorch.org/tutorials/beginner/blitz/autograd_tutorial.html#sphx-glr-beginner-blitz-autograd-tutorial-py" rel="noopener ugc nofollow" target="_blank">自动微分</a>的神经网络训练(跟踪发生在张量上的所有操作并自动计算梯度)。</li><li id="ae31" class="mp mq it lv b lw na lz nb mc nc mg nd mk ne mo mw mx my mz bi translated">动态计算图(使用 PyTorch，不需要像在 Tensorflow 中那样为了运行模型而首先定义整个计算图)。</li></ul><p id="f603" class="pw-post-body-paragraph lt lu it lv b lw mr ju ly lz ms jx mb mc nf me mf mg ng mi mj mk nh mm mn mo im bi translated">PyTorch 可以按照<a class="ae ky" href="https://pytorch.org/get-started/locally/" rel="noopener ugc nofollow" target="_blank">文档说明</a>免费安装在任何操作系统上。组成该库的一些主要元素是:</p><ul class=""><li id="90cb" class="mp mq it lv b lw mr lz ms mc mt mg mu mk mv mo mw mx my mz bi translated"><strong class="lv iu"> <em class="ni">自动签名</em> </strong>模块:用于记录在张量上执行的操作，并反向执行这些操作以计算梯度(该属性对于加速神经网络操作和允许 PyTorch 遵循<a class="ae ky" href="https://en.wikipedia.org/wiki/Imperative_programming" rel="noopener ugc nofollow" target="_blank">命令式编程</a>范例非常有用)。</li><li id="204f" class="mp mq it lv b lw na lz nb mc nc mg nd mk ne mo mw mx my mz bi translated"><strong class="lv iu"> <em class="ni"> Optim </em> </strong>模块:用于方便地导入和应用各种神经网络训练的优化算法，如 Adam、随机梯度下降等..</li><li id="cff0" class="mp mq it lv b lw na lz nb mc nc mg nd mk ne mo mw mx my mz bi translated"><strong class="lv iu"> <em class="ni"> nn </em> </strong>模块:提供一组函数，可以帮助我们快速逐层设计任何类型的神经网络。</li></ul><h1 id="62ff" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">示范</h1><p id="ca5f" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">在本文中，我将带您通过一个实际的例子来开始使用 PyTorch。本文中使用的所有代码(以及更多！)可以在我的<a class="ae ky" href="https://github.com/pierpaolo28/Kaggle-Challenges/blob/master/rain-prediction.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>和<a class="ae ky" href="https://www.kaggle.com/pierpaolo28/rain-prediction" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>账户上使用。对于这个例子，我们将使用澳大利亚<a class="ae ky" href="https://www.kaggle.com/jsphyg/weather-dataset-rattle-package" rel="noopener ugc nofollow" target="_blank">Kaggle Rain</a>数据集来预测明天是否会下雨。</p><h2 id="2ebb" class="nj lc it bd ld nk nl dn lh nm nn dp ll mc no np ln mg nq nr lp mk ns nt lr nu bi translated">导入库</h2><p id="8768" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">首先，我们需要导入所有必需的库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv la l"/></div></figure><h2 id="0ec4" class="nj lc it bd ld nk nl dn lh nm nn dp ll mc no np ln mg nq nr lp mk ns nt lr nu bi translated">数据预处理</h2><p id="5d1d" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">对于这个例子，我们将重点使用<strong class="lv iu"> <em class="ni"> RISK_MM </em> </strong>和<strong class="lv iu"> <em class="ni"> Location </em> </strong>指标作为我们的模型特征(图 1)。将数据划分为训练集和测试集后，我们可以将 Numpy 数组转换为 PyTorch 张量，并创建一个训练和测试数据加载器，以便将数据输入到我们的神经网络中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv la l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/ca64fb808888106884d73e93ea8f2009.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*psRLPKcWnE8A_auP96cCpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 1:简化的数据帧</p></figure><h2 id="3acb" class="nj lc it bd ld nk nl dn lh nm nn dp ll mc no np ln mg nq nr lp mk ns nt lr nu bi translated">系统模型化</h2><p id="b2c8" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">此时，使用 PyTorch <strong class="lv iu"> <em class="ni"> nn </em> </strong>模块，我们就可以设计我们的人工神经网络(ANN)了。在 PyTorch 中，神经网络可以定义为由两个主要函数构成的类:<strong class="lv iu"> <em class="ni"> __inti__() </em> </strong>和<strong class="lv iu"> <em class="ni"> forward() </em> </strong>。</p><p id="248f" class="pw-post-body-paragraph lt lu it lv b lw mr ju ly lz ms jx mb mc nf me mf mg ng mi mj mk nh mm mn mo im bi translated">在<strong class="lv iu"> <em class="ni"> __inti__() </em> </strong>函数中，我们可以设置我们的网络层，而在<strong class="lv iu"><em class="ni">【forward()</em></strong>函数中，我们决定如何将我们网络的不同元素堆叠在一起。这样，只需在<strong class="lv iu"><em class="ni">【forward()</em></strong>函数中添加打印语句，就可以相对容易地进行调试和试验，以便在任何时间点检查网络的任何部分。</p><p id="543f" class="pw-post-body-paragraph lt lu it lv b lw mr ju ly lz ms jx mb mc nf me mf mg ng mi mj mk nh mm mn mo im bi translated">此外，PyTorch 还提供了一个<a class="ae ky" href="https://pytorch.org/docs/stable/nn.html#sequential" rel="noopener ugc nofollow" target="_blank">顺序接口</a>，可以使用该接口以类似于使用 Keras Tensorflow API 构建模型的方式来创建模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv la l"/></div></figure><p id="f7ac" class="pw-post-body-paragraph lt lu it lv b lw mr ju ly lz ms jx mb mc nf me mf mg ng mi mj mk nh mm mn mo im bi translated">在这个简单的网络中，我们将 50 个特征作为输入，因为我们之前使用 Pandas <strong class="lv iu"> get_dummies() </strong>功能将输入分类变量转换为虚拟/指示变量。因此，我们的网络将由 50 个输入神经元、20 个神经元的隐藏层和单个神经元的输出层组成。隐藏层的大小当然可以变化，并且可以很容易地添加更多的隐藏层，但是考虑到可用的数据量有限，这可能会导致过度拟合我们的数据的风险。将连续图层堆叠在一起时，我们只需确保一个图层的输出要素数量等于连续图层的输入要素数量。</p><p id="cae9" class="pw-post-body-paragraph lt lu it lv b lw mr ju ly lz ms jx mb mc nf me mf mg ng mi mj mk nh mm mn mo im bi translated">一旦实例化了我们的模型，我们就可以打印出网络架构。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv la l"/></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="a239" class="nj lc it ny b gy oc od l oe of">ANN(<br/>  (fc1): Linear(in_features=50, out_features=20, bias=True)<br/>  (fc2): Linear(in_features=20, out_features=1, bias=True)<br/>)</span></pre><h2 id="4dca" class="nj lc it bd ld nk nl dn lh nm nn dp ll mc no np ln mg nq nr lp mk ns nt lr nu bi translated">神经网络训练</h2><p id="0378" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">我们现在终于准备好训练我们的模型了。在下面的代码片段中，我们首先将二元交叉熵定义为我们的损失函数，将 Adam 定义为模型参数的优化器。最后，我们创建一个 7 次迭代的训练循环，并存储一些关键的度量参数，如每次迭代的总损失和模型精度。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv la l"/></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="de2b" class="nj lc it ny b gy oc od l oe of">Epoch: 0, Loss: 294.88, Accuracy: 0.13% <br/>Epoch: 1, Loss: 123.58, Accuracy: 6.31% <br/>Epoch: 2, Loss: 62.27, Accuracy: 28.72% <br/>Epoch: 3, Loss: 35.33, Accuracy: 49.40% <br/>Epoch: 4, Loss: 22.99, Accuracy: 64.99% <br/>Epoch: 5, Loss: 16.80, Accuracy: 71.59% <br/>Epoch: 6, Loss: 13.16, Accuracy: 74.13%</span></pre><p id="e242" class="pw-post-body-paragraph lt lu it lv b lw mr ju ly lz ms jx mb mc nf me mf mg ng mi mj mk nh mm mn mo im bi translated">正如图 2 所总结的，我们的模型成功地实现了良好的准确性，而没有过度拟合原始数据的风险(训练损失和准确性都即将达到平稳状态)。还可以通过实现训练/验证分割来训练我们的模型并调整其参数来进一步验证这一点(如本<a class="ae ky" href="https://github.com/pierpaolo28/Kaggle-Challenges/blob/master/rain-prediction.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>笔记本所示)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/3b576b644d1ef91a32517f4361fb8142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xRv2fq_2q9jRWm_-r4ktbg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 2:培训报告</p></figure><h2 id="ce17" class="nj lc it bd ld nk nl dn lh nm nn dp ll mc no np ln mg nq nr lp mk ns nt lr nu bi translated">估价</h2><p id="2be2" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">最后，我们现在可以创建第二个循环来针对一些全新的数据测试我们的模型(为了确保我们的模型不再是训练模型，而是仅用于推理，请注意<strong class="lv iu"> <em class="ni"> model.eval() </em> </strong>语句)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv la l"/></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="54b6" class="nj lc it ny b gy oc od l oe of">Test Accuracy: 74.66 %</span></pre><p id="5fee" class="pw-post-body-paragraph lt lu it lv b lw mr ju ly lz ms jx mb mc nf me mf mg ng mi mj mk nh mm mn mo im bi translated">从打印输出可以看出，我们的模型测试精度与我们的最终训练精度非常匹配(74.66 %对 74.13%)。</p><h1 id="a5e3" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">结论</h1><p id="c4e2" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">如果您有兴趣了解 PyTorch 的更多潜力，PyTorch Lighting<a class="ae ky" href="https://pytorch-lightning.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">和 Livelossplot </a>是两个很棒的软件包，可以帮助您开发、调试和评估您的 py torch 模型。</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><p id="8361" class="pw-post-body-paragraph lt lu it lv b lw mr ju ly lz ms jx mb mc nf me mf mg ng mi mj mk nh mm mn mo im bi translated"><em class="ni">希望您喜欢这篇文章，感谢您的阅读！</em></p><h1 id="939d" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">联系人</h1><p id="c843" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">如果你想了解我最新的文章和项目<a class="ae ky" href="https://medium.com/@pierpaoloippolito28?source=post_page---------------------------" rel="noopener">，请通过媒体</a>关注我，并订阅我的<a class="ae ky" href="http://eepurl.com/gwO-Dr?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">邮件列表</a>。以下是我的一些联系人详细信息:</p><ul class=""><li id="7254" class="mp mq it lv b lw mr lz ms mc mt mg mu mk mv mo mw mx my mz bi translated"><a class="ae ky" href="https://uk.linkedin.com/in/pier-paolo-ippolito-202917146?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">领英</a></li><li id="5128" class="mp mq it lv b lw na lz nb mc nc mg nd mk ne mo mw mx my mz bi translated"><a class="ae ky" href="https://pierpaolo28.github.io/blog/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">个人博客</a></li><li id="2d94" class="mp mq it lv b lw na lz nb mc nc mg nd mk ne mo mw mx my mz bi translated"><a class="ae ky" href="https://pierpaolo28.github.io/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">个人网站</a></li><li id="edb2" class="mp mq it lv b lw na lz nb mc nc mg nd mk ne mo mw mx my mz bi translated"><a class="ae ky" href="https://towardsdatascience.com/@pierpaoloippolito28?source=post_page---------------------------" rel="noopener" target="_blank">中等轮廓</a></li><li id="9e6a" class="mp mq it lv b lw na lz nb mc nc mg nd mk ne mo mw mx my mz bi translated"><a class="ae ky" href="https://github.com/pierpaolo28?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> GitHub </a></li><li id="87ea" class="mp mq it lv b lw na lz nb mc nc mg nd mk ne mo mw mx my mz bi translated"><a class="ae ky" href="https://www.kaggle.com/pierpaolo28?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">卡格尔</a></li></ul></div></div>    
</body>
</html>