<html>
<head>
<title>How to Access Stocks Market Data for Machine Learning on Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python上访问股票市场数据进行机器学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-access-stocks-market-data-for-machine-learning-on-python-c69db51e7a0d?source=collection_archive---------35-----------------------#2020-06-16">https://towardsdatascience.com/how-to-access-stocks-market-data-for-machine-learning-on-python-c69db51e7a0d?source=collection_archive---------35-----------------------#2020-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3d07" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如果你想使用机器学习来交易股票，你需要创建一个股票市场数据的数据集。了解如何使用现成的代码轻松完成这项工作。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/97259d351e9426250dcb255eb4901bac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VGFQa-wIKJuXgLyT"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Austin Distel </a>拍摄的照片</p></figure><p id="0040" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">机器学习和人工智能开发的一个常见瓶颈是获得足够大的数据集，以便你可以用它来训练你的算法。特别是，如果你正在使用深度学习，你会知道获得足够的数据来正确训练神经网络有多难。<a class="ae ky" href="http://google dataset search" rel="noopener ugc nofollow" target="_blank">谷歌数据集搜索</a>不久前出现，大大改善了这个问题，但仍然很难找到一些主题的数据，如股票交易。</p><p id="a65a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我以前遇到过这个问题，所以我知道这有多难。然而，就在昨天，我发现了<a class="ae ky" href="https://medium.com/swlh/build-an-ai-stock-trading-bot-for-free-4a46bec2a18" rel="noopener">这篇关于构建交易机器人</a>的伟大文章，它很好地指向了最近一家名为<a class="ae ky" href="https://alpaca.markets" rel="noopener ugc nofollow" target="_blank">羊驼</a>的初创公司，该公司提供了一个构建交易算法的API。有了这个API，我们可以免费使用他们的Python SDK访问股票的实时和历史数据。在本文中，我将向您展示如何实现一个函数来下载股票数据并将其存储在Pandas Dataframe中，以便它可以用于机器学习。</p><blockquote class="lv lw lx"><p id="de5b" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">注意:尽管我在下面的代码中使用了这个API，但是您可以选择您喜欢的任何其他API，并根据需要随意修改代码。</p></blockquote><h1 id="a47b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">安装必要的库并连接到服务器</h1><p id="4613" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先:<a class="ae ky" href="https://app.alpaca.markets/signup" rel="noopener ugc nofollow" target="_blank">在这里创建一个新账户</a>。然后转到纸质账户(模拟器)，点击API键上的“查看”。最后，点击“生成密钥”，你将得到你的密钥id和你的秘密密钥。有了这些密钥，您将从Python连接到服务器，并能够下载我们想要的数据(您可以做更多的事情，但在本文中，我们将只下载数据)。</p><p id="b8fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在您的终端上执行“pip install alpaca_trade_api ”,您就可以使用以下代码连接到api了:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="6058" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在<a class="ae ky" href="https://github.com/alpacahq/alpaca-trade-api-python" rel="noopener ugc nofollow" target="_blank"> Github </a>上看到官方文档和代码。</p><h1 id="f22b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">下载资产的数据</h1><p id="f8fd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们将用于下载资产数据的基本调用如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="a211" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们使用上面实例化的管理器来调用方法<a class="ae ky" href="https://alpaca.markets/docs/api-documentation/api-v2/market-data/bars/" rel="noopener ugc nofollow" target="_blank"> get_barset </a>，该方法返回一组条(或者您甚至可以将它们想象为烛台),并具有以下参数集:</p><ul class=""><li id="0d52" class="nb nc it lb b lc ld lf lg li nd lm ne lq nf lu ng nh ni nj bi translated">Symbols:这是一个字符串列表，其中包含我们要下载数据的符号。</li><li id="4094" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">时间范围:表示数据时间性的字符串，可以是1分钟、5分钟、15分钟或1D。</li><li id="e463" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">Limit:一个介于1和1000之间的数字，表示我们将下载的最大条数(最大值为1000)。</li><li id="bd8c" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">日期(开始-结束，之后，直到):iso格式的日期。</li></ul><p id="f69b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，您已经可以从股票中下载数据，但是如果您想要获得大量数据(您可能会这样做)，您将必须实现一些代码来处理分步分解时间并为每个步骤进行调用，否则，您将很快达到1000的限制(想象一下，如果您使用1分钟的临时时间，您将被限制为每次调用1000分钟或大约16个小时)。</p><h1 id="8e54" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">长期下载数据</h1><p id="da55" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我自己实现了处理这个问题的代码，我把它放在这里，因为我很好:))</p><h2 id="e6ad" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">打破日期中的句点并对其进行格式化</h2><p id="aec8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，我们需要将周期分解成更小的步骤，这样我们就可以确保不会达到API返回的bar的限制。为此，我创建了break_period_in_dates_list方法，它采用datetime对象形式的start_date和end_date，以及带有每步天数的int。每个步骤的天数不能太大，这一点很重要，因为否则您将达到限制，然后您将无法获得您想要的所有数据。该方法返回一个日期元组列表，其中有开始日期和结束日期。</p><p id="65a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是按照API期望的那样格式化日期。在format_dates方法中，我们正是这样做的，并以预期的格式返回列表。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><h2 id="33f1" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">创建数据框架</h2><p id="8f2b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在，一旦我们得到了条集，我们需要用它创建一个熊猫数据框架。具体来说，每个barset都是一个对象，其属性在这里定义为<a class="ae ky" href="https://alpaca.markets/docs/api-documentation/api-v2/market-data/bars/" rel="noopener ugc nofollow" target="_blank"/>。在下面的方法中，我们转换字典列表中的条集列表，然后用它创建一个Pandas数据帧。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><h2 id="5cfe" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">实际下载数据</h2><p id="8557" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后，我们准备下载我们的数据。为此，我创建了download_data方法，该方法将REST管理器、我们需要的数据的符号列表、开始和结束日期以及最后将数据存储为csv文件的文件名作为参数。请注意，我选择将时间段分为10天，这对于示例中使用的5分钟临时时间来说很好，但是如果您更改临时时间，应该更改该参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="1da4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">完全码</h1><p id="3544" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">作为总结，在这里你可以看到完整的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="b0a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你发现这篇文章很有用，现在可以为你的机器学习项目获得所有的市场数据。感谢您的阅读！:)</p></div></div>    
</body>
</html>