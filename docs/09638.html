<html>
<head>
<title>Window Functions and other concepts of SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">窗口函数和 SQL 的其他概念</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/window-functions-and-other-concepts-of-sql-d53ca756e254?source=collection_archive---------62-----------------------#2020-07-08">https://towardsdatascience.com/window-functions-and-other-concepts-of-sql-d53ca756e254?source=collection_archive---------62-----------------------#2020-07-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="978b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/Sql%20Tutorial" rel="noopener" target="_blank">带 PostgreSQL 的 Sql 教程</a></h2><div class=""/><div class=""><h2 id="0160" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">用 SQL 开发您解决问题的技能</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/f6ca161a2941ef599c916ddc265c628c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KcJMPhZMIKlfIOIQQBF8iQ.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@007felix?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">菲利克斯·杜布瓦-罗伯特</a>在<a class="ae lh" href="https://unsplash.com/collections/4794263/frameworks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="f0c0" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated"><strong class="lr jd">简介</strong></p><p id="aa08" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">在我的<a class="ae lh" href="https://towardsdatascience.com/tagged/Sql%20Tutorial" rel="noopener" target="_blank">教程</a>的最后一部分，我们将看到窗口函数的效用和 SQL 的其他概念，它们允许为我们的问题找到解决方案。</p><p id="d7ac" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">正如在<a class="ae lh" rel="noopener" target="_blank" href="/working-with-multiple-tables-thanks-to-sql-and-erd-9cb5dcb99228?source=friends_link&amp;sk=7734128676dd5fe6e8f91256f0505d6f">前一部分</a>中，我将使用为名为<strong class="lr jd">太空漫游</strong>的虚拟公司建造的 ERD。</p><p id="442a" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我的教程的第二部分解释了这个图的结构，你可以在这里找到<a class="ae lh" rel="noopener" target="_blank" href="/working-with-multiple-tables-thanks-to-sql-and-erd-9cb5dcb99228?source=friends_link&amp;sk=7734128676dd5fe6e8f91256f0505d6f"/>。</p><p id="8a71" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">现在，我们可以从我的 SQL 教程的最后一部分开始。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ml"><img src="../Images/284233438b77e521e919da819202b77a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k9O5sgYp9el3NeR6BTar_g.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="896b" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated"><strong class="lr jd">第一部分:窗口功能</strong></p><p id="5ec8" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">假设您希望有一个表，允许将每部电影的销售价格与特定国家的平均价格进行比较。显然第一件要做的事是将表<strong class="lr jd">与区域</strong>、<strong class="lr jd">卖家、电影</strong>和<strong class="lr jd">订单连接起来。</strong>之后，我们<strong class="lr jd"> </strong>可以使用我们的窗口功能。所以:</p><pre class="ks kt ku kv gt mm mn mo mp aw mq bi"><span id="c85a" class="mr ms it mn b gy mt mu l mv mw">WITH sub AS (SELECT a.country, o.amt_euro<br/>FROM area AS a<br/>JOIN seller AS s<br/>ON a.id = s.area_id<br/>JOIN movies AS m<br/>ON s.id = m.id_seller<br/>JOIN orders AS o<br/>ON m.id = o.id_movie)</span><span id="f26a" class="mr ms it mn b gy mx mu l mv mw">SELECT country, amt_euro,<br/>avg(amt_euro::numeric) OVER (PARTITION BY country) <br/>FROM sub;</span></pre><p id="6185" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">出局:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi my"><img src="../Images/2b410dabfa019352ad9b5511025a790f.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*Cpl8y_QsrSwHgy0CmGE4Ag.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure><p id="bf3c" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">正如你在上面看到的，我没有对电影的价格进行求和，而是做了一个分组，我报告了每个价格在一个特定国家的平均价格。这样一来，我们可以即时看到一部电影的价格是超过还是低于我们要考虑的国家的平均价格。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="957b" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated"><strong class="lr jd">第二部分:右侧、长度和 Strpos </strong></p><p id="08c7" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">假设我们需要知道邮件列表中每封邮件的域。在这种情况下，我们可以使用以下函数:<strong class="lr jd"> Right，Length </strong>和<strong class="lr jd"> Strpos </strong>。</p><pre class="ks kt ku kv gt mm mn mo mp aw mq bi"><span id="7387" class="mr ms it mn b gy mt mu l mv mw">SELECT email,<br/>RIGHT(email, LENGTH(email) — STRPOS(email,’.’)) AS domain<br/>FROM mailing_list;</span></pre><p id="39b2" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">出局:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/5ed12e46991294e890e875240f1b7d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*wRsNGgWqwTNSgjZ6hd-qCg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure><p id="5bbc" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">正如你所观察到的，每封邮件我们都有自己的域名。事实上，<strong class="lr jd">右函数</strong>帮助我找到了我想要的值，相反，<strong class="lr jd">长度</strong>和<strong class="lr jd"> Strpos </strong>之间的差值确定了我想要从右边拉出的字符数<strong class="lr jd"> </strong>。<strong class="lr jd"> Length 函数</strong>显示每行电子邮件的长度，<strong class="lr jd"> Strops </strong>显示圆点前的电子邮件长度。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="8b01" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated"><strong class="lr jd">第三部分:串联</strong></p><p id="a20d" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我们决定对销售者表进行反规范化，以便拥有一个包含名字和姓氏的唯一列。为此，我们可以使用一个简单的连接。</p><p id="1f5e" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我们可以使用两种不同的技术。</p><p id="6d5e" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">第一个技巧:</p><pre class="ks kt ku kv gt mm mn mo mp aw mq bi"><span id="e668" class="mr ms it mn b gy mt mu l mv mw">SELECT first_name, last_name,<br/>CONCAT(first_name,’ ‘,last_name) AS name<br/>FROM seller;</span></pre><p id="7618" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">第二个技巧:</p><pre class="ks kt ku kv gt mm mn mo mp aw mq bi"><span id="e6ba" class="mr ms it mn b gy mt mu l mv mw">SELECT first_name, last_name,<br/> first_name||’ ‘||last_name AS name<br/>FROM seller;</span></pre><p id="0819" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">出局:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi na"><img src="../Images/d1e9d34f66e465e3ad8def151af8090a.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*0FdBFHgXc8JtGwfCeSXznQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="32b5" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated"><strong class="lr jd">结论</strong></p><p id="6ff2" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">感谢我在我的<a class="ae lh" href="https://towardsdatascience.com/tagged/Sql%20Tutorial" rel="noopener" target="_blank">教程</a>的所有部分中向您介绍的概念，现在您已经对如何应用 SQL 有了一个大致的了解，并开始提高处理越来越复杂问题的技能。</p><p id="8d39" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">在 ETL 过程中，数据以杂乱的形式出现在我们面前，数据工程师或数据分析师的目标是规范化数据，并创建一个架构，以满足使用这些数据的不同部门的需求。这是数据分析师或数据工程师面临的基本挑战之一。</p><p id="08b8" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">此外，通过创建或使用一家公司的数据仓库架构，您将拥有一个企业不同流程的全景，换句话说，您的眼睛将无处不在。这是深入研究一家公司的绝佳机会。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="7ef7" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我发出一份期刊简讯。如果你想加入，请通过此链接注册。 </p><p id="7c84" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">除了我的<strong class="lr jd">简讯</strong>之外，还可以在我的电报群<a class="ae lh" href="https://t.me/DataScienceForBeginners" rel="noopener ugc nofollow" target="_blank"> <strong class="lr jd">初学数据科学</strong> </a> <strong class="lr jd">中取得联系。</strong></p></div></div>    
</body>
</html>