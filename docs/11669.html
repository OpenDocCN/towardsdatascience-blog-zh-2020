<html>
<head>
<title>An Introduction to the Pipe in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R 中的管道介绍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-introduction-to-the-pipe-in-r-823090760d64?source=collection_archive---------6-----------------------#2020-08-13">https://towardsdatascience.com/an-introduction-to-the-pipe-in-r-823090760d64?source=collection_archive---------6-----------------------#2020-08-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="561f" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">r 基础知识</h2><div class=""/><div class=""><h2 id="f5d9" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">r 对数据处理最重要的运算符，解释道。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/006ed1a367a8b51fd8d2f90149f2f2a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1Zj6xmXG-nf_XpDF"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@er1end?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Erlend Ekseth </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="94bd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据分析通常包括许多步骤。从原始数据到结果的典型过程可能涉及筛选案例、转换值、汇总数据，然后运行统计测试。但是，我们如何将所有这些步骤联系在一起，同时保持代码的有效性和可读性呢？</p><p id="c95b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">输入管道，R 对数据处理最重要的操作符。</p><h1 id="db58" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">管子是做什么的？</h1><p id="fd6a" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">管道操作符写为<code class="fe nb nc nd ne b">%&gt;%</code>，是 r 的<a class="ae lh" href="https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html" rel="noopener ugc nofollow" target="_blank">magritter</a>包的一个长期特性。它接受一个函数的输出，并将其作为参数传递给另一个函数。这使我们能够将一系列分析步骤联系起来。</p><p id="4389" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了形象化这个过程，想象一个工厂，不同的机器沿着传送带放置。每台机器都是一种功能，执行我们分析的一个阶段，比如过滤或转换数据。因此，管道就像传送带一样工作，将一台机器的输出传输到另一台机器进行进一步处理。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nf"><img src="../Images/aa40612ce5377477d3904c1cc293b012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fenClHiB5KHd5axMzkPycA.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">一个美味的分析程序。图片:Shutterstock</p></figure><p id="24b9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以在使用 mtcars 数据集的真实示例中看到这是如何工作的。这个数据集带有 base R，包含各种汽车的规格和燃油效率的数据。</p><p id="bab8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面的代码根据每辆车的气缸数对数据进行分组，然后返回每组的平均每加仑英里数。确保在运行这段代码之前安装好<a class="ae lh" href="https://tidyverse.tidyverse.org/articles/paper.html" rel="noopener ugc nofollow" target="_blank"> tidyverse </a>套件，因为它既包括管道又包括<code class="fe nb nc nd ne b">group_by</code>和<code class="fe nb nc nd ne b">summarise</code>函数。</p><pre class="ks kt ku kv gt ng ne nh bn ni nj bi"><span id="500f" class="nk mf it ne b be nl nm l nn no">library(tidyverse)<br/>result &lt;- mtcars %&gt;% <br/>    group_by(cyl) %&gt;% <br/>    summarise(meanMPG = mean(mpg))</span></pre><p id="1027" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">管道操作员将 mtcars 数据帧送入<code class="fe nb nc nd ne b">group_by</code>功能，然后将<code class="fe nb nc nd ne b">group_by</code>的输出送入<code class="fe nb nc nd ne b">summarise</code>。该过程的结果存储在 tibble <code class="fe nb nc nd ne b">result</code>中，如下所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi np"><img src="../Images/d3527c0bfcd0fbf8777cc8496c829a36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWZ6kYL1iLnpnrY0kwWptQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">mtcars 数据集中车辆的平均每加仑英里数，按发动机气缸数量分组。</p></figure><p id="ffb1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">尽管这个例子非常简单，但它演示了基本的管道工作流。为了更进一步，我鼓励用这个来玩。也许交换和添加新的功能到“管道”中，以获得对数据的更多了解。这样做是了解如何使用管道的最佳方式。</p><p id="a14d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是我们为什么要首先使用它呢？</p><h1 id="a476" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">为什么要用管子？</h1><p id="c02c" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">与 R 中处理数据的任何其他方法相比，管道有一个巨大的优势:它使进程易于阅读。如果我们将<code class="fe nb nc nd ne b">%&gt;%</code>读作“then ”,上一节的代码很容易理解为一组简单的英语指令:</p><pre class="ks kt ku kv gt ng ne nq nr aw ns bi"><span id="5845" class="nt mf it ne b gy nu nv l nw no">Load tidyverse packages</span><span id="a0fd" class="nt mf it ne b gy nx nv l nw no">To get our result, take the mtcars dataframe, THEN<br/>    Group its entries by number of cylinders, THEN<br/>    Compute the mean miles-per-gallon of each group</span></pre><p id="86d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这比我们用另一种方式来表达这个过程更具可读性。下面的两个选项是前面代码的不同表达方式，但两者都更糟糕，原因如下。</p><pre class="ks kt ku kv gt ng ne nh bn ni nj bi"><span id="4288" class="nk mf it ne b be nl nm l nn no"># Option 1: Store each step in the process sequentially<br/>result &lt;- group_by(mtcars, cyl)<br/>result &lt;- summarise(result, meanMPG = mean(mpg))<br/><br/># Option 2: chain the functions together<br/>&gt; result &lt;- summarise(<br/>                group_by(mtcars, cyl), <br/>                meanMPG = mean(mpg))</span></pre><p id="3ce1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">选项 1 完成了工作，但是在每一行覆盖我们的输出数据帧<code class="fe nb nc nd ne b">result</code>是有问题的。首先，对于包含许多步骤的过程来说，这样做是没有效率的，并且会在代码中产生不必要的重复。在某些情况下，这种重复也使得准确识别每一行上的变化变得更加困难。</p><p id="3013" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">选项 2 更不实际。嵌套我们想要使用的每个函数变得很快，特别是对于长过程。很难阅读，更难调试。这种方法还使得很难看到分析中的步骤顺序，如果您希望以后添加新功能，这是个坏消息。</p><p id="ad87" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">显而易见，使用管道可以极大地改进大多数 R 脚本。它使分析更具可读性，消除了重复，并简化了添加和修改代码的过程。有什么是它做不到的吗？</p><h1 id="7cd6" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">管道的局限性是什么？</h1><p id="2d9d" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">尽管它非常方便，但管道并不是在所有情况下都有用。以下是它的一些局限性:</p><ul class=""><li id="8534" class="ny nz it lk b ll lm lo lp lr oa lv ob lz oc md od oe of og bi translated">因为它以线性顺序链接函数，所以管道不太适用于包含多方向关系的问题。</li><li id="452b" class="ny nz it lk b ll oh lo oi lr oj lv ok lz ol md od oe of og bi translated">管道一次只能传输一个对象，这意味着它不太适合需要多个输入或产生多个输出的函数。</li><li id="37b8" class="ny nz it lk b ll oh lo oi lr oj lv ok lz ol md od oe of og bi translated">它不适用于使用当前环境的函数，也不适用于使用惰性求值的函数。Hadley Wickham 的书《数据科学的 R》中有几个这样的例子<a class="ae lh" href="https://r4ds.had.co.nz/pipes.html" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><p id="e6b0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些事情是意料之中的。就像你想用一个工具建造一座房子一样，没有一个单独的特性可以解决你所有的编程问题。但是不管怎样，这种管子还是很通用的。虽然这篇文章关注的是基础，但是有足够的空间以高级或创造性的方式使用管道。我在各种各样的脚本中使用过它，无论是面向数据的还是非面向数据的，它都让我的生活变得更加轻松。</p><h1 id="add0" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">额外管道提示</h1><p id="63e1" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">谢谢你读到这里。作为奖励，这里有一些奖金管道提示和资源:</p><ul class=""><li id="52e7" class="ny nz it lk b ll lm lo lp lr oa lv ob lz oc md od oe of og bi translated">厌倦了笨拙地打字<code class="fe nb nc nd ne b">%&gt;%</code>？稍微简单一点的键盘快捷键<code class="fe nb nc nd ne b">CTRL + SHIFT + M</code>会在 RStudio 中打印一个管道！</li><li id="335f" class="ny nz it lk b ll oh lo oi lr oj lv ok lz ol md od oe of og bi translated">需要关于如何格式化管道的样式指导？看看哈德利·威克姆的《R 风格指南》中这一有用的章节。</li><li id="557d" class="ny nz it lk b ll oh lo oi lr oj lv ok lz ol md od oe of og bi translated">想了解更多关于 R 中管道的历史吗？查看阿道夫·Á·阿尔瓦雷斯的博客文章<a class="ae lh" href="http://adolfoalvarez.cl/plumbers-chains-and-famous-painters-the-history-of-the-pipe-operator-in-r/" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><p id="be04" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">烟斗很棒。它将您的代码转换成一系列可读的指令，并有许多其他的实际好处。现在您已经了解了管道，使用它，并看到您的代码变成了一个故事。</p></div><div class="ab cl om on hx oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="im in io ip iq"><p id="b1d8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">想阅读我所有关于编程、数据科学等方面的文章吗？在<a class="ae lh" href="https://medium.com/@roryspanton/membership" rel="noopener">这个链接</a>注册一个媒体会员，就可以完全访问我所有的作品和媒体上的所有其他故事。这也直接帮助了我，因为我从你的会员费中得到一小部分，而不需要你额外付费。</p><p id="2da6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你也可以通过<a class="ae lh" href="https://roryspanton.medium.com/subscribe" rel="noopener">订阅这里</a>让我的所有新文章直接发送到你的收件箱。感谢阅读！</p></div></div>    
</body>
</html>