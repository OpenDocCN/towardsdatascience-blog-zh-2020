<html>
<head>
<title>How to Deploy a Machine Learning UI on Heroku in 5 Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 5 个步骤在 Heroku 上部署机器学习 UI</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-deploy-a-machine-learning-ui-on-heroku-in-5-steps-b8cd3c9208e6?source=collection_archive---------27-----------------------#2020-07-19">https://towardsdatascience.com/how-to-deploy-a-machine-learning-ui-on-heroku-in-5-steps-b8cd3c9208e6?source=collection_archive---------27-----------------------#2020-07-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9e56" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Gradio 让你为你的机器学习模型建立一个 UI。Heroku 让你主持。以下是如何一起使用它们。</h2></div><p id="98ad" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本教程中，我将一步一步地向您展示如何在 Heroku 上创建和部署您的机器学习模型和 UI。我将使用我为 Inception Net 模型创建的这个拖放图像界面作为一个例子:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/0c0939c7c275b66fadbff2330964dd2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ytmRlbaIzTgk57fJ8EMP-A.gif"/></div></div></figure><p id="ba16" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以在:<a class="ae lq" href="https://arcane-tundra-83748.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://arcane-tundra-83748.herokuapp.com/</a>试用 GUI(dyno 启动可能需要一分钟)</p><h2 id="d6bf" class="lr ls it bd lt lu lv dn lw lx ly dp lz kr ma mb mc kv md me mf kz mg mh mi mj bi translated">格拉迪欧的作品</h2><p id="e114" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">我假设你已经对 Gradio 库(<a class="ae lq" href="https://github.com/gradio-app/gradio" rel="noopener ugc nofollow" target="_blank">https://github.com/gradio-app/gradio</a>)有所了解。如果没有，<a class="ae lq" href="https://medium.com/swlh/a-gui-to-recognize-handwritten-digits-in-19-lines-of-python-fda715e525d0" rel="noopener">这个 MNIST 教程</a>是一个开始的好地方。快速概述是:Gradio 是一个 Python 库，它允许您通过指定三件事情来围绕您的机器学习模型创建 ui:Python 函数、输入组件和输出组件。</p><p id="df56" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">第一步:创建你的 Gradio 应用</strong></p><p id="be1f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将从一个脚本开始，该脚本围绕先启模型创建一个拖放图像界面。创建一个全新的目录，并将下面的代码复制粘贴到一个 python 文件中，我们称之为<code class="fe mp mq mr ms b">app.py</code>:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="d99c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个脚本中发生的事情是，我们正在使用 Tensorflow Keras 加载 Inception Net 图像分类器。由于这是一个图像分类模型，我们将使用<code class="fe mp mq mr ms b">Image</code>输入接口。我们将使用<code class="fe mp mq mr ms b">Label</code>输出接口输出一个标签字典和它们相应的置信度得分。(<em class="mv">要部署您自己的模型，请用您自己的代码来替换它</em>)。</p><p id="a672" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">第二步:编写你的</strong> <code class="fe mp mq mr ms b"><strong class="kk iu">requirements.txt</strong></code> <strong class="kk iu">文件</strong></p><p id="207a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要确保将所有需要的 Python 库指定为依赖项。所以在与<code class="fe mp mq mr ms b"><strong class="kk iu">app.py</strong></code>相同的目录下创建一个<code class="fe mp mq mr ms b"><strong class="kk iu">requirements.txt</strong></code> <strong class="kk iu"> </strong>文件。对我来说，那就是:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="d2bc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让包版本在 Heroku 上工作可能有点棘手，但是上面的包和版本对我来说是有效的。<strong class="kk iu">重要提示:</strong> Heroku 将您的构建大小限制为 500 MB，考虑到 Tensorflow 包的大小，这很容易填满。<strong class="kk iu">我建议用 Tensorflow 2.0.0 库，比其他一些版本的库要小一些。</strong></p><p id="cc97" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您想在本地测试脚本(您应该这样做！)，从终端运行:<code class="fe mp mq mr ms b">pip install -r requirements.txt</code>安装依赖项，然后<code class="fe mp mq mr ms b">python app.py</code>启动 UI。此时，您应该看到您的界面正在<code class="fe mp mq mr ms b">localhost:7860</code>(或另一个端口)上运行，如果您在浏览器中导航到该端口，应该会显示您的 GUI！</p><p id="4ec4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此 URL 可在本地访问。我们如何与世界分享这些？Gradio 带有一个内置的<code class="fe mp mq mr ms b">share</code>参数，可以创建公共 URL，但这些 URL 会在一定时间后过期。为了创建永久的公共链接，我们将使用 Heroku！</p><h2 id="0449" class="lr ls it bd lt lu lv dn lw lx ly dp lz kr ma mb mc kv md me mf kz mg mh mi mj bi translated">Heroku 的作品</h2><p id="52ac" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">要在 Heroku 上部署您的 web 应用程序，您需要有一个 Heroku 帐户，拥有 Heroku CLI 也非常方便。因此，如果你还没有做的话，请继续<a class="ae lq" href="https://signup.heroku.com/" rel="noopener ugc nofollow" target="_blank">创建一个 Heroku 帐户</a>并<a class="ae lq" href="https://devcenter.heroku.com/articles/heroku-cli#download-and-install" rel="noopener ugc nofollow" target="_blank">下载 CLI </a>。</p><p id="05f4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，开始部署！</p><p id="618a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">第三步:创建一个</strong> <code class="fe mp mq mr ms b"><strong class="kk iu">setup.sh</strong></code> <strong class="kk iu">文件</strong></p><p id="eefc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了在 Heroku 上正确部署我们的应用程序，我们需要确保它服务于正确的 URL 和端口。下面的命令可以做到这一点，所以把它们放在一个名为<code class="fe mp mq mr ms b"><strong class="kk iu">setup.sh</strong></code> <strong class="kk iu"> </strong>的文件中，这个文件和你的应用程序在同一个目录下。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="571e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里发生的事情是，我们告诉 Gradio 在<code class="fe mp mq mr ms b">0.0.0.0</code>上提供 UI，特别是使用 Heroku dyno 让世界可见的端口。</p><p id="1e18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">第四步:创建一个</strong>T7】</p><p id="d69a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们要创建一个名为<code class="fe mp mq mr ms b"><strong class="kk iu">Procfile</strong></code>的文件(就是它，这个文件没有扩展名！)它的工作是告诉 Heroku 运行什么命令来启动 Gradio 应用程序。只有两个命令:运行我们在上一步创建的 bash 脚本，然后启动我们的应用程序。所以我们的 Heroku <code class="fe mp mq mr ms b"><strong class="kk iu">Procfile</strong></code> <strong class="kk iu"> </strong>看起来是这样的:</p><pre class="lf lg lh li gt mw ms mx my aw mz bi"><span id="5d12" class="lr ls it ms b gy na nb l nc nd">web: source setup.sh &amp;&amp; python app.py</span></pre><p id="7bd8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想知道为什么我们使用<code class="fe mp mq mr ms b">source</code>而不是<code class="fe mp mq mr ms b">sh</code>，那是因为我们需要在脚本执行完毕后保存环境变量。</p><p id="d33c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">第五步:部署！</strong></p><p id="1fa9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此时，您的目录应该如下所示:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/78bd1acb3436f0961b833a0fca7059d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*vyoN3MQ7DCijbnGPECFOwQ.png"/></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">一个目录中只有 4 个文件——超级简单！</p></figure><p id="c846" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您还没有将这些文件添加到 git repo 中，请在您的终端中运行以下命令:</p><pre class="lf lg lh li gt mw ms mx my aw mz bi"><span id="2f8f" class="lr ls it ms b gy na nb l nc nd">git init<br/>git add -A<br/>git commit -am "commit message here"</span></pre><p id="1cfe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们只需要把这个推到 Heroku dyno 上。首先，让我们通过运行以下命令为我们的应用程序分配一个 Heroku dyno:</p><pre class="lf lg lh li gt mw ms mx my aw mz bi"><span id="a1c3" class="lr ls it ms b gy na nb l nc nd">heroku create</span></pre><p id="3f93" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Heroku 会自动旋转并给你的应用程序分配一个随机的名字。现在，我们把我们的改变推给 Heroku:</p><pre class="lf lg lh li gt mw ms mx my aw mz bi"><span id="6fa8" class="lr ls it ms b gy na nb l nc nd">git push heroku master</span></pre><p id="fd48" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">给它几分钟时间在你的 dyno 上安装所有的依赖项。这里可能会遇到依赖性问题，您可以通过阅读错误消息并安装每个库的正确版本来解决这个问题(<em class="mv">参见我上面关于 Heroku 大小限制的注释</em>)。如果您没有看到任何错误，那么您应该能够通过运行以下命令打开您的应用程序:</p><pre class="lf lg lh li gt mw ms mx my aw mz bi"><span id="4220" class="lr ls it ms b gy na nb l nc nd">heroku ps:scale web=1<br/>heroku open</span></pre><p id="57e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后一个命令将打开您的默认浏览器，并把您带到应用程序。您会注意到网址是自动生成的实例名加上 Heroku 域。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nj"><img src="../Images/7306898d2ba93434fd5f6db303de2800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KMAOFWIrjSxrZ2_brCosSQ.png"/></div></div></figure><p id="1e0f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就是这样！您有一个可以与任何人分享的实时链接。是时候开始运行一些预测了:)</p></div></div>    
</body>
</html>