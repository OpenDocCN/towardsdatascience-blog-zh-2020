<html>
<head>
<title>The statistics of Blackjack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">二十一点的统计</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-statistics-of-blackjack-e3b5fc29e67d?source=collection_archive---------7-----------------------#2020-07-27">https://towardsdatascience.com/the-statistics-of-blackjack-e3b5fc29e67d?source=collection_archive---------7-----------------------#2020-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9095" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过 R 数据分析揭示 21 点赔率和最佳策略</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/02a82a429d8a4853c03cae0ed60bf696.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mXOj-gvVhlZQS8iS"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">雅罗斯瓦夫·库奥查拉在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="5f16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">21 点被认为是赌场中筹码最少的游戏，赌徒们在 21 点中获胜的机会比在任何其他游戏中都要多。但是几率有多大呢？我们如何找到适用的最佳策略？</p><p id="b2e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过简单的统计分析来了解一下吧！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5758" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置场景</h1><p id="33e9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">本文开发了一个用<strong class="lb iu"> R </strong>构建的 21 点模拟工具，用于推导最优策略和相关概率。</p><p id="46af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有代码都可以在<a class="ae ky" href="https://github.com/ArnaudBu/blackjack_simulation" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得。</p><div class="mz na gp gr nb nc"><a href="https://github.com/arnaudbu/blackjack_simulation" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">阿尔诺布/21 点 _ 模拟</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">21 点游戏的模拟。通过在…上创建帐户，为 ArnaudBu/blackjack_simulation 开发做出贡献</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq ks nc"/></div></div></a></div><p id="dd51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用于模拟的规则是:</p><ul class=""><li id="5861" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">每个玩家，包括庄家，从两张牌开始。庄家的一张牌是隐藏的，将在这一轮结束，轮到庄家出牌时显示出来。</li><li id="8788" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">目标是要求牌手打出不超过 21 张的牌，每张牌占其名义价值(国王、王后和杰克值 10)。ace 值为 1 或 11，无论哪个值都能在不破坏的情况下得到最高分。如果一手牌有一张值为 11 的 a，称为<em class="of">软</em>，相反的称为<em class="of">硬</em>手。</li><li id="e18a" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">如果玩家超过 21 ( <em class="of">半身像</em>)，无论庄家的分数如何，庄家都赢。如果庄家破产而玩家没有破产，玩家获胜。如果得分低于 21，该轮比赛将产生一个<em class="of">平局</em>。在所有其他情况下，得分高者获胜。</li><li id="45a8" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">庄家以 1 比 1 支付赌注，除了自然 21 点(a+牌值为 10)以 3 比 2 支付。</li><li id="b696" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">在每一步棋中，玩家可以<em class="of">击</em>(要牌)、<em class="of">站</em>(保持在当前位置)，或<em class="of">加倍</em>(赌注加倍，但只会多抽一张牌)。</li><li id="7cf0" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">当玩家有两张相同的牌时，他可以<em class="of">拆分</em>，这意味着他可以将他的一对牌转换成两个独立的手牌，独立出牌。</li></ul><p id="7227" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">脚本<code class="fe og oh oi oj b"><a class="ae ky" href="https://github.com/ArnaudBu/blackjack_simulation/blob/master/run.R" rel="noopener ugc nofollow" target="_blank">run.R</a></code>模拟 21 点游戏(基于 10，000，000 步，8 副牌，3 个人玩)以生成一个数据库，该数据库将用<strong class="lb iu">数据表</strong>包进行分析。</p><p id="afd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生成的数据集遵循以下格式，每条线代表一轮(<em class="of"> game_id) </em>中的一步棋，如果玩家击中、站立或双打，则有预期的收入。<em class="of"> hard_if_hit </em>值表示移动后手牌是否硬，并且是最佳策略定义所必需的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表 1—21 点分析数据集</p></figure><p id="7832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行的所有分析均可在<code class="fe og oh oi oj b"><a class="ae ky" href="https://github.com/ArnaudBu/blackjack_simulation/blob/master/analysis.R" rel="noopener ugc nofollow" target="_blank">analysis.R</a></code>脚本中获得。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8fc5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">基本策略</h1><p id="2fb4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">人们可以想到的最基本的策略是，一旦分数达到某个阈值，就站起来。</p><p id="c958" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就代码而言，我们只需要过滤数据集，以通过与超过阈值的第一个<em class="of">分数</em>相对应的<em class="of"> game_id </em>检索一行，或者如果第一个条件不满足，则通过第一个<em class="of">分数 _if_hit </em>检索一行。</p><p id="f63d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将该策略应用于从 2 到 21 的每个阈值的数据集，我们在聚合后得到以下结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/6a87cde226e289ef250139f5cee35d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ju8B-pJviYm54HiA8MBWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 1 —命中阈值策略回报</p></figure><p id="4db4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图显示了每一轮的预期收益(占赌博金额的百分比)和结果分布。</p><p id="a879" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最佳策略使用的阈值为<strong class="lb iu"> 15 </strong>，每轮的预期损失为赌博金额的<strong class="lb iu"> 8.57 % </strong>。对于大多数玩家来说，这些赔率显然会导致游戏提前结束。</p><p id="8ea6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，通过在决策过程中考虑庄家的分数和玩家手中的软 a，可以设计出能够提高这些赔率的策略。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="94a0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最优策略</h1><p id="659a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了找到最佳策略，我们首先需要一个优化指标。我们将使用移动后的<strong class="lb iu">预期收益</strong>。</p><p id="d436" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">计算给定手牌的这一指标(得分&amp;如果手牌较软)，需要知道:</p><ul class=""><li id="0853" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">击球时的下一手牌，以及转移到每一手牌的概率；</li><li id="e09f" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">根据我们旨在定义的策略给出的移动，这些手牌的相关预期收益。</li></ul><p id="3887" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们有一个递归问题要处理，因为我们首先需要估计这一轮可能的后续移动，庄家的分数是常数。这需要在分数上实现一个向后<strong class="lb iu">的循环。</strong>尽管如此，手或硬或软的可能性意味着在安排步骤时也要考虑这一点。</p><p id="5824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图描述了手与手之间的过渡。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/99f029b8082017f67181e8df2aab4730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*TOvo_S87hjN3_DAg-q8dHQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 2 —撞击时的可能性</p></figure><p id="e228" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果玩家有一手高于 10 分的硬手，那么在击球时只能得到一手得分更高的硬手。软手可以转变成得分更高的软手<strong class="lb iu">或者得分高于 10 的硬手</strong>。最后，低于 9 分的硬手可以给软手，也可以给更高分的硬手。这意味着我们需要用三个关键步骤来排序我们的反向循环。</p><ul class=""><li id="593b" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">首先是得分高于 10 的硬牌。</li><li id="4d7d" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">然后是柔软的手。</li><li id="814a" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">最后是得分低于 9 的硬手。</li></ul><p id="5582" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将确保在每一步中，所有未来的可能性都得到考虑。</p><p id="4070" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于每一个类别，我们对可能的玩家分数进行反向循环，并根据所有未来可能性的加权收入计算预期收入(这是在前面的步骤中估计的)。</p><p id="a830" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码可在<code class="fe og oh oi oj b"><a class="ae ky" href="https://github.com/ArnaudBu/blackjack_simulation/blob/master/analysis.R" rel="noopener ugc nofollow" target="_blank">analysis.R</a></code>中找到。</p><p id="06a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们看看硬手和软手的计算策略。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/8f41f9bb3438569444e51ea60ada68aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XhCUbnBGSt0oyT8wyWqS8w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 3 —硬牌的决策图</p></figure><p id="a604" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如所料，在 9、10 或 11 的分数上加倍是很有趣的，因为抽到值为 10 的牌的概率很高(13 次中有 4 次)。对于 7 分以上的庄家来说，击中的阈值似乎增加了，因为庄家获得 17 分和站立的概率更高，这使得必须击中才能击败他。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/0e5b66783c626e927ddde0bf2fa2d60a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JMF5XHBLw64LjdyXmbFMMA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 4——软手决策图</p></figure><p id="a82b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">软 11 只有在分割后才是可能的，并且对应于单个 ace。由于有可能在被击中后不崩溃，我们可以看到，软手的策略比硬手的策略更具侵略性。</p><p id="455f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在所有其他条件相同的情况下，我们可以通过比较两张相同卡片的预期收益和一半的预期收益来估计拆分是最优的情况。如果第一个值不如第二个值的两倍(我们在拆分后下注两只手)，那么拆分就是预期收益较高的棋步，否则可以参考前面的图表。</p><p id="1dab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，最佳拆分情况是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/0f2ca3d9212c97bb676e868ce04e5444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJyb6pkI9JnqdD_Aflj-DA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 5 —分裂决策</p></figure><p id="042b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分割 a 总是很有趣，因为拿到 10 的概率更高。相反，分裂 5s 从来不被推荐，也是因为得到 10 或者 a 的概率。</p><p id="a3c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一手牌是两个 9，而庄家的分数是 7，这种情况很有趣，因为站着的决定似乎是孤立的。这也是因为庄家下一步不可能超过 18，这使他要么处于他必须站着的位置(最好的情况下也要听牌)，要么处于他需要以高风险出击的情况。</p><p id="a83b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该策略及相关收益可在以下 gist 处获得:<a class="ae ky" href="https://gist.github.com/ArnaudBu/797094581de3f6703a6c12b994da18c6" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/ArnaudBu/797094581 de 3 f 6703 a6 c 12 b 994 da 18c 6</a>。</p><blockquote class="op oq or"><p id="394a" class="kz la of lb b lc ld ju le lf lg jx lh os lj lk ll ot ln lo lp ou lr ls lt lu im bi translated">注意:在网上找到的战略图表在一些决策上可能是不同的。查看上面策略文件中的预期收益，我们可以看到，在这些情况下，两个不同决策的计算收益非常接近，这表明可以通过更多模拟来解决收敛问题。</p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3a5c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在破产之前，我可以享受多长时间的 21 点游戏？</h1><p id="7fb9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">根据模拟(使用<code class="fe og oh oi oj b"><a class="ae ky" href="https://github.com/ArnaudBu/blackjack_simulation/blob/master/test_strategy.R" rel="noopener ugc nofollow" target="_blank">test_strategy.R</a></code>脚本)测试这个策略，我们可以估计一定轮次后的平均累积收益，以及一些分位数区间。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/96cfaa38e47c10f6a7cd94ab19593b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lhUcgSazcPX6WcVg6IdD9Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 6 —稳定下注 1，000 回合的盈利方案</p></figure><p id="37d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们可以估计，在 1000 轮后，考虑到 1 美元的赌注，平均损失为 8.34 美元。这意味着针对这种策略的估计赌场优势为<strong class="lb iu"> 0.834% </strong>，与轮盘赌的 2.7%相比相对较低。</p><p id="8b72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到一轮 21 点平均持续 1 分钟，玩家将在 3 小时后平均输掉 1.15 美元，每次下注 1 美元。损失的累计 5%分位数是 26.5 美元。因此，如果你带着 26 倍于你下注金额的钱来到赌场，在三个小时的游戏结束时，你破产的可能性不到 5%。</p><p id="c6c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是算牌的可能性呢？由于赌场优势如此之小，而且 10 在这场游戏中非常重要，因此有可能用这种技巧将赌场的优势转移到玩家身上。电影说是的，但现实是否取决于小说？这肯定会是未来帖子的一个有趣话题。</p></div></div>    
</body>
</html>