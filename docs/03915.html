<html>
<head>
<title>Interactive Data Visualization for exploring Coronavirus Spreads</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索冠状病毒传播的交互式数据可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-data-visualization-for-exploring-coronavirus-spreads-f33cabc64043?source=collection_archive---------28-----------------------#2020-04-11">https://towardsdatascience.com/interactive-data-visualization-for-exploring-coronavirus-spreads-f33cabc64043?source=collection_archive---------28-----------------------#2020-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="16db" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Altair创建不到30行代码的交互式复合图表</h2></div><h1 id="2abc" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">一个简单的例子</h1><p id="0e8a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在我们进入细节之前，我想向您展示一个不到30行代码的交互式复合图表，用于探索冠状病毒的传播。</p><ul class=""><li id="2019" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv md me mf mg bi translated">最上面的一个显示的是<em class="mh">每日新病例</em></li><li id="2ba9" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv md me mf mg bi translated">底部显示的是<em class="mh">选择区域</em>的<em class="mh">新增病例总数</em>。</li></ul><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mn"><img src="../Images/62b356b7f6fb1e7fffcb338f2259dd6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9SPOTYF0LYpFKGjmvxhnxA.gif"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">利用牛郎星探索冠状病毒传播的交互式数据可视化</p></figure><p id="d193" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">这个图表是用Python数据可视化库Altair创建的。Altair是Python的声明式统计可视化库，基于<a class="ae ng" href="http://vega.github.io/vega" rel="noopener ugc nofollow" target="_blank"> Vega </a>和<a class="ae ng" href="http://vega.github.io/vega-lite" rel="noopener ugc nofollow" target="_blank"> Vega-Lite </a>。Altair提供了强大而简洁的可视化语法，使您能够快速构建各种各样的统计可视化。</p><p id="28c6" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">下面是文章大纲:</p><ul class=""><li id="57a8" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv md me mf mg bi translated">安装和基本指南</li><li id="76b5" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv md me mf mg bi translated">牛郎星的时间和日期</li><li id="3d23" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv md me mf mg bi translated">逐步构建探索冠状病毒传播的交互式图表</li></ul><h1 id="2e93" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">安装和基本指南</h1><p id="615c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">关于Altair安装的细节和基本概念，可以看看:</p><div class="nh ni gp gr nj nk"><a rel="noopener follow" target="_blank" href="/python-interactive-data-visualization-with-altair-b4c4664308f8"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">用Altair实现Python交互式数据可视化</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">用不到20行代码创建交互式图表。</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny mx nk"/></div></div></a></div><p id="ddfa" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">以下是以上介绍的要点:</p><ol class=""><li id="a5aa" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv nz me mf mg bi translated">Altair有很多依赖项，我强烈建议创建一个新的虚拟环境。</li><li id="488b" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv nz me mf mg bi translated">激活您的虚拟环境，并运行<code class="fe oa ob oc od b">pip install altair vega_datasets</code>来安装Altair以及<a class="ae ng" href="https://github.com/altair-viz/vega_datasets" rel="noopener ugc nofollow" target="_blank"> vega_datasets </a>中的示例数据集。</li><li id="c62b" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv nz me mf mg bi translated">Altair创建图表只需要三个主要概念:<strong class="lc iu">数据</strong>、<strong class="lc iu">标记</strong>和<strong class="lc iu">编码</strong>。牛郎星中的<strong class="lc iu">数据</strong>是围绕熊猫数据框架建立的。<strong class="lc iu">标记</strong>是点、线、面积、散点图、直方图、地图等各种图表。<strong class="lc iu">编码</strong>是数据到视觉属性的映射，如轴、标记颜色、标记形状等。</li></ol><p id="5d8f" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">对于创建虚拟环境的教程，你可以看看:</p><div class="nh ni gp gr nj nk"><a rel="noopener follow" target="_blank" href="/create-virtual-environment-using-virtualenv-and-add-it-to-jupyter-notebook-6e1bf4e03415"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">使用“virtualenv”创建虚拟环境，并将其添加到Jupyter笔记本中</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">你是机器学习工程师，正在使用Python和Jupyter Notebook吗？在这篇文章中，你会看到为什么…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="oe l nv nw nx nt ny mx nk"/></div></div></a></div><div class="nh ni gp gr nj nk"><a href="https://medium.com/analytics-vidhya/create-virtual-environment-using-conda-and-add-it-to-jupyter-notebook-d319a81dfd1" rel="noopener follow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">使用“conda”创建虚拟环境，并将其添加到Jupyter笔记本中</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">你正在使用anaconda和使用Jupyter Notebook和Python吗？在这篇文章中，你将看到如何创建虚拟的…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">medium.com</p></div></div><div class="nt l"><div class="of l nv nw nx nt ny mx nk"/></div></div></a></div><h1 id="c2ac" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">牛郎星的时间和日期</h1><p id="07b0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在我们开始用Altair制作交互式时间序列图之前，最好先了解一下Altair是如何处理时间和日期的。</p><p id="a6cf" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">处理时间和日期通常是数据分析和可视化的挑战之一。了解以下基本用法，应该足以让你用Altair创建一个时序图。</p><h2 id="4890" class="og kj it bd kk oh oi dn ko oj ok dp ks lj ol om ku ln on oo kw lr op oq ky or bi translated"><strong class="ak">时间和日期的数据类型</strong></h2><p id="3e9c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">牵牛星的设计是为了更好地与<a class="ae ng" href="https://pandas.pydata.org/pandas-docs/stable/timeseries.html" rel="noopener ugc nofollow" target="_blank">熊猫系列</a>配合使用。当您将数据指定为pandas数据帧时，数据类型由Altair自动确定。</p><p id="c8a3" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">例如，下面是一个包含西雅图每小时测量温度的数据集:</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="2e83" class="og kj it od b gy ow ox l oy oz">import altair as alt<br/>from vega_datasets import data</span><span id="b9cf" class="og kj it od b gy pa ox l oy oz"><strong class="od iu">source = data.seattle_temps()<br/>source.head()</strong></span></pre><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/9492a2f8996e55f720437fe50ab5fac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*UZylGCpPyFjAIbzQDb_RXw.png"/></div><p class="mz na gj gh gi nb nc bd b be z dk translated">西雅图测得的每小时温度示例</p></figure><p id="5809" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">下面是一个创建简单折线图的示例</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="3c20" class="og kj it od b gy ow ox l oy oz">alt.Chart(source).mark_line().encode(<br/>    <strong class="od iu">x='date'</strong>,<br/>    <strong class="od iu">y='temp'</strong><br/>)</span></pre><p id="a026" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">通过执行上面的代码，它应该会给你一个如下的图表。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi pc"><img src="../Images/d9a20d34cd958be1ace87572c7b4c31d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1KZjfRLdgYwT02nsQhvnfg.png"/></div></div></figure><p id="3964" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">您会注意到Altair已经自动为您确定了数据类型。由于在短时间内压缩了大量的数据点，情节过于繁忙；我们可以通过使用<a class="ae ng" href="https://altair-viz.github.io/user_guide/transform/timeunit.html" rel="noopener ugc nofollow" target="_blank">时间单位转换</a>让它变得更清楚一点。</p><p id="81a2" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">Altair支持的基本数据类型如下:</p><ul class=""><li id="4819" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv md me mf mg bi translated"><code class="fe oa ob oc od b">quantitative</code>:简写码<strong class="lc iu"> Q </strong>，连续实数值。</li><li id="1235" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv md me mf mg bi translated"><code class="fe oa ob oc od b">nominal</code>:简写代码<strong class="lc iu"> O </strong>，离散订购数量。</li><li id="73e7" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv md me mf mg bi translated"><code class="fe oa ob oc od b">ordinal</code>:简写代码<strong class="lc iu"> N </strong>，离散订购数量。</li><li id="2b7a" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv md me mf mg bi translated"><code class="fe oa ob oc od b">temporal</code>:速记代码<strong class="lc iu"> T </strong>，一个时间或日期值。</li></ul><p id="f412" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">因此，如果您手动为每个列指定数据类型，则等效于:</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="18fc" class="og kj it od b gy ow ox l oy oz">alt.Chart(source).mark_line().encode(<br/>    <strong class="od iu">x='date:T'</strong>,<br/>    <strong class="od iu">y='temp:Q'</strong><br/>)</span></pre><h2 id="58c0" class="og kj it bd kk oh oi dn ko oj ok dp ks lj ol om ku ln on oo kw lr op oq ky or bi translated">时间单位转换</h2><p id="c50d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">随着对数据类型的理解。让我们转到<a class="ae ng" href="https://altair-viz.github.io/user_guide/transform/timeunit.html" rel="noopener ugc nofollow" target="_blank">时间单位转换</a>，它可以用来离散化Altair中的日期和时间。</p><p id="eacc" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">让我们通过离散化使西雅图温度图更清晰一点，例如，按月(在日期上应用<a class="ae ng" href="https://altair-viz.github.io/user_guide/transform/timeunit.html" rel="noopener ugc nofollow" target="_blank">时间单位转换</a>函数<code class="fe oa ob oc od b">month()</code>)并仅绘制月平均温度:</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="5735" class="og kj it od b gy ow ox l oy oz">alt.Chart(temps).mark_line().encode(<br/>    x='<strong class="od iu">month(date):T</strong>',<br/>    y='<strong class="od iu">mean(temp):Q</strong>'<br/>)</span></pre><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi pd"><img src="../Images/8a4ad5740314c5a5d38769c160dd1dd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6qa0j694HeNvtixR6kLpg.png"/></div></div></figure><p id="fb7a" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">多个时间单位可以组合在一个图中，以生成有趣的数据视图；例如，这里我们使用<a class="ae ng" href="https://altair-viz.github.io/user_guide/transform/timeunit.html" rel="noopener ugc nofollow" target="_blank">时间单位转换</a>函数<code class="fe oa ob oc od b">date()</code>和<code class="fe oa ob oc od b">month()</code>提取月份和日期，给出西雅图全年的温度概况:</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="2390" class="og kj it od b gy ow ox l oy oz">alt.Chart(source).mark_rect().encode(<br/>    x = <strong class="od iu">alt.X('date(date):O', title='day')</strong>,<br/>    y = <strong class="od iu">alt.Y('month(date):O', title='month')</strong>,<br/>    color='max(temp):Q'<br/>).properties(<br/>    title="2010 Daily High Temperatures in Seattle (F)"<br/>)</span></pre><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi pe"><img src="../Images/3ba1fa0f5aa5cd7b36e87a1becb57c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kB7Mzv59qIne9tSZjo9Fuw.png"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">西雅图温度时间单位转换示例</p></figure><h1 id="4f9f" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">逐步构建探索冠状病毒传播的交互式图表</h1><p id="2547" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">利用Altair的基本知识以及它如何处理时间和日期，让我们制作一个交互式图表来探索冠状病毒的传播。</p><h2 id="56aa" class="og kj it bd kk oh oi dn ko oj ok dp ks lj ol om ku ln on oo kw lr op oq ky or bi translated">数据</h2><p id="270d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">用于这种数据可视化的数据是由<strong class="lc iu">约翰·霍普金斯大学系统科学与工程中心</strong>(JHU·CSSE)提供的，他们在公共<a class="ae ng" href="https://github.com/CSSEGISandData/COVID-19" rel="noopener ugc nofollow" target="_blank"> Github页面</a>上分享了他们的数据。约翰霍普金斯CSSE汇总了主要来源的数据，如世界卫生组织、国家和地区公共卫生机构。这些数据免费提供，并且每天更新。</p><p id="d962" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">对于本教程，我已经完成了<a class="ae ng" rel="noopener" target="_blank" href="/covid-19-data-processing-58aaa3663f6">数据处理</a>，它运行以下步骤:</p><ol class=""><li id="f33c" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv nz me mf mg bi translated">将原始确认、死亡和恢复的CSV数据合并到一个数据框架中。</li><li id="1edc" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv nz me mf mg bi translated">由于ships中缺少值、错误的数据类型和案例，执行数据清理。</li><li id="63a6" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv nz me mf mg bi translated">增加一个名为<strong class="lc iu"> <em class="mh">活动</em> </strong>的活动案例列，由<code class="fe oa ob oc od b">active_case = confirmed — deaths — recovered</code>计算。</li><li id="368d" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv nz me mf mg bi translated">将数据聚集到<code class="fe oa ob oc od b">Country/Region</code> wise中，并按<code class="fe oa ob oc od b">Date</code>和<code class="fe oa ob oc od b">Country/Region</code>分组。</li><li id="8cbc" class="lw lx it lc b ld mi lg mj lj mk ln ml lr mm lv nz me mf mg bi translated">添加当日明智<strong class="lc iu"> <em class="mh">新增病例</em></strong><strong class="lc iu"><em class="mh">新增死亡病例</em> </strong>和<strong class="lc iu"> <em class="mh">新增痊愈病例</em> </strong>扣除前一日相应的累计数据。</li></ol><p id="4db0" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">而这里是数据处理后的样子(可以从我的<a class="ae ng" href="https://gist.github.com/BindiChen/cd911af6eb6205038d3aff036d20fb20" rel="noopener ugc nofollow" target="_blank"> Github Gist </a>下载)。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi pf"><img src="../Images/9ce95a5dc4a848e815704981d49c39d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*avefF3KMX8oga2ZOLvf-Ig.png"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">数据处理后的<a class="ae ng" href="https://gist.github.com/BindiChen/cd911af6eb6205038d3aff036d20fb20" rel="noopener ugc nofollow" target="_blank">covid _ 19 _ clean _ complete . CSV</a></p></figure><p id="414d" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">注意<strong class="lc iu"> <em class="mh">确认</em> </strong>，<strong class="lc iu"> <em class="mh">死亡</em> </strong>，<strong class="lc iu"> <em class="mh">痊愈</em> </strong>，<strong class="lc iu"> <em class="mh">活跃</em> </strong>都是累计数据。<strong class="lc iu"> <em class="mh">新增病例</em> </strong>，<strong class="lc iu"> <em class="mh">新增死亡病例</em> </strong>和<strong class="lc iu"> <em class="mh">新增痊愈病例</em> </strong>均为日明智数据。该数据帧按<strong class="lc iu"> <em class="mh">日期</em> </strong>和<strong class="lc iu"> <em class="mh">国家/地区</em> </strong>分组。</p><h2 id="210e" class="og kj it bd kk oh oi dn ko oj ok dp ks lj ol om ku ln on oo kw lr op oq ky or bi translated">构建交互式图表</h2><p id="e344" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">首先，让我们导入库并加载数据，</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="6074" class="og kj it od b gy ow ox l oy oz">import pandas as pd<br/>import altair as alt</span><span id="8fcf" class="og kj it od b gy pa ox l oy oz">full_clean_data = pd.read_csv('covid_19_clean_complete.csv', <strong class="od iu">parse_dates=['Date']</strong>)</span></pre><p id="6406" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">有将近200个国家/地区，如果我们把它们都显示出来，图表会很忙。所以让我们列一个我们想去探索的国家的清单。</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="17e8" class="og kj it od b gy ow ox l oy oz">countries = ['US', 'Italy', 'China', 'Spain', 'France', 'Iran', 'United Kingdom', 'Switzerland']</span><span id="3612" class="og kj it od b gy pa ox l oy oz">selected_data = full_clean_data[full_clean_data['Country/Region']<strong class="od iu">.isin(countries)</strong>]</span></pre><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi pg"><img src="../Images/b0c6bb19ab928d0c437af47621f32678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QP3o7YAckJrp0s9lCTg0sg.png"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">从covid_19_clean_complete.csv中选择的国家</p></figure><p id="5c59" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">让我们创建一个圆形图表来显示当天的<strong class="lc iu"> <em class="mh">新增案例</em> </strong>、</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="9cb8" class="og kj it od b gy ow ox l oy oz">alt.Chart(selected_data).<strong class="od iu">mark_circle()</strong>.encode(<br/>    <strong class="od iu">x='Date',</strong><br/>    <strong class="od iu">y='Country/Region',<br/>    color='Country/Region',<br/>    size='New cases:Q'</strong><br/>).properties(<br/>    width=1000,<br/>    height=300,<br/>)</span></pre><p id="59cc" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">上面的结果应该是一个图表，让您可以看到每天的新情况。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ph"><img src="../Images/ec1ee17e0c46ff246bb338204a21f49f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ew4bVmxJA-S-P_Y3Ci-SNA.png"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">基本圆图</p></figure><p id="cae6" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">由于默认的圆形大小刻度，图表并不突出；我们可以用<code class="fe oa ob oc od b">alt.Size()</code>把它放大一点。</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="d1ce" class="og kj it od b gy ow ox l oy oz">alt.Chart(selected_data).mark_circle().encode(<br/>    x='monthdate(Date):O',<br/>    y='Country/Region',<br/>    color='Country/Region',<br/>    <strong class="od iu">size=alt.Size('New cases:Q',<br/>        scale=alt.Scale(range=[0, 3000]),<br/>        legend=alt.Legend(title='Daily new cases')</strong><br/>    ) <br/>)</span></pre><p id="fe41" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">这是结果</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ph"><img src="../Images/5c71530e733d3915cd35b11da719203c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZnmMP-Frtt_t-FL_WsTiwA.png"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">具有自定义圆形大小的基本圆形图</p></figure><p id="bc87" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">接下来，我们将使用<code class="fe oa ob oc od b"><a class="ae ng" href="https://altair-viz.github.io/user_guide/generated/api/altair.selection_interval.html#altair.selection_interval" rel="noopener ugc nofollow" target="_blank"><strong class="lc iu">selection_interval()</strong></a></code>函数创建一个区间选择:</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="6b50" class="og kj it od b gy ow ox l oy oz">interval = alt.selection_interval()</span></pre><p id="7d67" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">我们现在可以通过设置<code class="fe oa ob oc od b">selection</code>属性将这个间隔绑定到我们的图表上:</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="efba" class="og kj it od b gy ow ox l oy oz">alt.Chart(selected_data).mark_circle().encode(<br/>    x='monthdate(Date):O',<br/>    y='Country/Region',<br/>    color='Country/Region',<br/>    size=alt.Size('New cases:Q',<br/>        scale=alt.Scale(range=[0, 3000]),<br/>        legend=alt.Legend(title='Daily new cases')<br/>    ) <br/>).properties(<br/>    width=1000,<br/>    height=300,<br/>    <strong class="od iu">selection=interval</strong><br/>)</span></pre><p id="d019" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">上面的结果是一个图表，它允许您单击并拖动来创建一个选择区域，并在创建区域后移动该区域。这很整洁，但是选择实际上还没有做任何事情。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi pi"><img src="../Images/67236f1a65d2b000dd81acd3cb79d431.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-VLR9WfL96R88pOy1C5grA.gif"/></div></div></figure><p id="9fee" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">要使用这个选项，我们需要在图表中以某种方式引用它。这里，我们将使用<code class="fe oa ob oc od b"><a class="ae ng" href="https://altair-viz.github.io/user_guide/generated/api/altair.condition.html#altair.condition" rel="noopener ugc nofollow" target="_blank"><strong class="lc iu">condition()</strong></a></code>函数来创建一个条件颜色编码:我们将把颜色绑定到选择中的数据的<code class="fe oa ob oc od b">"Country/Region"</code>列，并将选择之外的数据的颜色设置为<code class="fe oa ob oc od b">"lightgray"</code>:</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="7e0f" class="og kj it od b gy ow ox l oy oz">alt.Chart(selected_data).mark_circle().encode(<br/>    x='monthdate(Date):O',<br/>    y='Country/Region',<br/>    <strong class="od iu">color=alt.condition(interval, 'Country/Region', alt.value('lightgray')),</strong><br/>    size=alt.Size('New cases:Q',<br/>        scale=alt.Scale(range=[0, 3000]),<br/>        legend=alt.Legend(title='Daily new cases')<br/>    ) <br/>).properties(<br/>    width=1000,<br/>    height=300,<br/>    selection=interval<br/>)</span></pre><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ph"><img src="../Images/bf2b5d75e033f404e74c27ed08c8b04c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*IMLY3C2tFTQNAAX6c-VSAw.gif"/></div></div></figure><p id="41b7" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">接下来，我们创建一个<code class="fe oa ob oc od b">mark_bar()</code>图表来显示新案例的总和:</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="c258" class="og kj it od b gy ow ox l oy oz">alt.Chart(selected_data).mark_bar().encode(<br/>    y='Country/Region',<br/>    color='Country/Region',<br/>    x='sum(New cases):Q'<br/>).properties(<br/>    width=1000,<br/>)</span></pre><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi pi"><img src="../Images/0ce11340fa77a0eab1ed67bf79ee9984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K6Kh7DZRUsDTu3DmFdP_zg.png"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">显示新案例总数的条形图</p></figure><p id="ef12" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">为了将条形图与之前的散点图关联起来，我们需要使用<code class="fe oa ob oc od b">transform_filter()</code>并传递同一个<code class="fe oa ob oc od b">interval</code>。此外，为了合成多选图表，我们还需要为它们分别创建变量，并使用合成多选<code class="fe oa ob oc od b">&amp;</code>。</p><pre class="mo mp mq mr gt os od ot ou aw ov bi"><span id="f09b" class="og kj it od b gy ow ox l oy oz">interval = alt.selection_interval()</span><span id="8122" class="og kj it od b gy pa ox l oy oz"><strong class="od iu">circle</strong> = alt.Chart(selected_day_wise).mark_circle().encode(<br/>    x='monthdate(Date):O',<br/>    y='Country/Region',<br/>    color=alt.condition(interval, 'Country/Region', alt.value('lightgray')),<br/>    size=alt.Size('New cases:Q',<br/>        scale=alt.Scale(range=[0, 3000]),<br/>        legend=alt.Legend(title='Daily new cases')<br/>    ) <br/>).properties(<br/>    width=1000,<br/>    height=300,<br/>    selection=interval<br/>)</span><span id="816f" class="og kj it od b gy pa ox l oy oz"><strong class="od iu">bars</strong> = alt.Chart(selected_day_wise).mark_bar().encode(<br/>    y='Country/Region',<br/>    color='Country/Region',<br/>    x='sum(New cases):Q'<br/>).properties(<br/>    width=1000<br/>)<strong class="od iu">.transform_filter(<br/>    interval<br/>)</strong></span><span id="a932" class="og kj it od b gy pa ox l oy oz"><strong class="od iu">circle &amp; bars</strong></span></pre><p id="8daa" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">而且，就是这样。这是输出</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi pj"><img src="../Images/fadcd168477c0410413add193b03c60d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Xx0yOEO_lBKuNwfjI1zI9g.gif"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">探索冠状病毒传播的交互式数据可视化</p></figure><p id="54b5" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">这是完整的代码:</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h1 id="a78c" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">尽情享受吧！</h1><p id="c58d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">仅此而已。感谢阅读。</p><p id="674c" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">关于使用Altair创建交互式数据可视化的介绍，您可以看看</p><div class="nh ni gp gr nj nk"><a rel="noopener follow" target="_blank" href="/python-interactive-data-visualization-with-altair-b4c4664308f8"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">用Altair实现Python交互式数据可视化</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">用不到20行代码创建交互式图表。</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny mx nk"/></div></div></a></div><p id="2856" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nd ll lm ln ne lp lq lr nf lt lu lv im bi translated">对于新冠肺炎数据处理</p><div class="nh ni gp gr nj nk"><a rel="noopener follow" target="_blank" href="/covid-19-data-processing-58aaa3663f6"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">新冠肺炎数据处理</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">下载、加载、合并、清理和聚合新冠肺炎时间序列数据的分步指南</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="pm l nv nw nx nt ny mx nk"/></div></div></a></div></div></div>    
</body>
</html>