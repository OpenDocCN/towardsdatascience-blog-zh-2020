<html>
<head>
<title>Python Pandas and SQLite</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 熊猫和 SQLite</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-pandas-and-sqlite-a0e2c052456f?source=collection_archive---------2-----------------------#2020-09-16">https://towardsdatascience.com/python-pandas-and-sqlite-a0e2c052456f?source=collection_archive---------2-----------------------#2020-09-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cdcd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 SQLite 存储您的熊猫数据帧为您提供了一个持久存储，并提供了一种轻松选择和过滤数据的方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c215ace9fc9df0568b3355cf5870e1cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FLK0uSo-cxqsafT3"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·温克勒在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0699" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQLite 数据库是 Python 的内置特性，而且非常有用。它不是 SQL 的完整实现，但是它具有个人数据库甚至数据驱动网站后端所需的所有特性。</p><p id="3847" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和熊猫一起用很简单，真的很有用。您可以将数据帧永久存储在一个表中，并在需要时将它们直接读入一个新的数据帧。</p><p id="04b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但不仅仅是存储方面如此有用。您可以使用简单的 SQL 命令来选择和过滤数据:这样您就不必处理数据帧本身。</p><p id="2837" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将使用 SQLite 演示一些简单的技术，并使用我最喜欢的伦敦天气数据集演示熊猫。它来自英国气象局的公共领域数据，你可以从我的 Github 账户下载。</p><p id="7408" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的所有代码都是用 Jupyter 笔记本写的，但是作为一个独立的 Python 程序也应该运行得很好。</p><p id="840f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从导入库开始:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d468" class="ma mb it lw b gy mc md l me mf">import sqlite3 as sql<br/>import pandas as pd<br/>import matplotlib.pyplot as plt</span></pre><p id="22ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，我们需要 SQLite 和 Pandas 库，我们还会得到 matplotlib，因为我们要绘制一些图形。</p><p id="32d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们来获取数据。在一个 csv 文件中有大约 70 年的温度、降雨量和日照数据。我们是这样下载的:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0e1a" class="ma mb it lw b gy mc md l me mf">weather = pd.read_csv('https://github.com/alanjones2/dataviz/raw/master/londonweather.csv')</span></pre><p id="53fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是它看起来的样子。记录一年中每个月的数据。气温以摄氏度为单位，降雨量以毫米为单位，“太阳”是一个月的总日照时数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/0534412fe1f5ffa730b07a645a5a79ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/0*-EBtMyzPlj2kRCfZ"/></div></figure><p id="26bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们要将数据帧保存在 SQLite 数据库中。</p><p id="eec8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们打开一个到新数据库的连接(如果数据库不存在的话，这将创建一个数据库)，然后在数据库中创建一个名为<em class="mh">天气的新表。</em></p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c8e5" class="ma mb it lw b gy mc md l me mf">conn = sql.connect('weather.db')<br/>weather.to_sql('weather', conn)</span></pre><p id="bfc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除非原始数据发生变化，否则我们不需要再次运行这段代码，事实上，我们不应该这样做，因为如果已经存在同名的表，SQLIte 将不允许我们在数据库中创建新表。</p><p id="8a2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们假设我们已经运行了上面的代码一次，并且我们有我们的数据库，<em class="mh">天气，</em>和表，也被称为<em class="mh">天气</em>。我们现在可以启动一个新的笔记本或 Python 程序来完成本教程的其余部分，或者简单地注释掉代码来下载和创建数据库。</p><p id="4c5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，我们有一个数据库，里面有我们的天气数据，现在我们想把它读入一个数据帧。下面是我们如何将数据库表加载到数据帧中。</p><p id="2571" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们像以前一样连接到数据库。然后我们使用 Pandas 的 sql_read 方法读入数据。但是要做到这一点，我们必须发送</p><p id="428e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对数据库的查询:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6adc" class="ma mb it lw b gy mc md l me mf">SELECT * FROM weather</span></pre><p id="bc0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是你能做的最简单的 SQL 查询。这意味着从名为 weather 的表中选择所有列并返回数据。下面是代码(查询作为字符串传递)。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="de54" class="ma mb it lw b gy mc md l me mf">conn = sql.connect('weather.db')<br/>weather = pd.read_sql('SELECT * FROM weather', conn)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/f2ae7e2bfad42f47418a01af0336958c.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/0*qtPq5wFSvPCxrUI_"/></div></figure><p id="9f81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这只是复制原始数据帧，所以让我们使用 SQL 的强大功能来加载数据的一个子集。</p><p id="5ad6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将获得相隔 50 年的几年的数据，并比较它们，看看是否有任何明显的差异。</p><p id="ed0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从获取 2010 年的数据开始。</p><p id="9eb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将像以前一样使用 read_sql 创建一个名为<em class="mh"> y2010 </em>的新数据帧，但是查询略有不同。我们添加一个 WHERE 子句。这只选择关键字 where 后的条件为真的数据。因此，在这种情况下，我们只获得 year 列中的值为“2010”的数据行。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9e1a" class="ma mb it lw b gy mc md l me mf">y2010 = pd.read_sql('SELECT * FROM weather WHERE Year == 2010', conn)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/02e867047a4ed4803c74a98c9f80b48d.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/0*67vCEVIuEb11hirH"/></div></figure><p id="d2f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到，唯一返回的数据是 2010 年的。</p><p id="1c1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是 Tmax 的线图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/0664e2f6bc8f241e60fd2cb834faa781.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/0*JXW9zCbp4g3EQzsj"/></div></figure><p id="d283" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们再来一次，但是是 50 年前的 1960 年</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="093a" class="ma mb it lw b gy mc md l me mf">y1960 = pd.read_sql('SELECT * FROM weather WHERE Year == 1960', conn)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/52d62b7680700eafcdd8ea91d844f82b.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/0*rFLkNt3UyJpQvIp7"/></div></figure><p id="ae0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们画出这两年的<em class="mh"> Tmax </em>。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a1ec" class="ma mb it lw b gy mc md l me mf">ax2010 = y2010.plot(y='Tmax')<br/>ax = y1960.plot(y='Tmax',color = 'red', ax=ax2010)<br/>ax.legend(['2010','1960'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/91084be955ad628036a6f0eae6151713.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/0*lw0zB0Y0NukiYBFM"/></div></div></figure><p id="b36f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有趣的是，2010 年似乎比 1960 年更热也更冷。天气越来越极端了吗？我们需要做更多的分析来得出这个结论。</p><p id="ae95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也许我们可以从找出最热的年份开始，比如温度超过 25 度的年份。</p><p id="1d73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们通过使用带有条件的 WHERE 子句来实现这一点，<em class="mh"> Tmax &gt; 25 </em>，即选择 Tmax 大于 25 度的行</p><p id="c69e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，由于我们只对最高温度感兴趣，我们将只选择我们感兴趣的列。我们通过修改 SQL 查询中的 SELECT 子句来做到这一点。</p><p id="2344" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们没有选择*(即所有列)，而是列出了我们想要返回的列:Year、Month 和 Tmax。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b93e" class="ma mb it lw b gy mc md l me mf">high = pd.read_sql('SELECT Year,Month,Tmax FROM weather WHERE Tmax &gt; 25', conn)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/0f04506a598b38fca6f4442b3f3ab070.png" data-original-src="https://miro.medium.com/v2/resize:fit:376/0*wh9AsudcAuHz4NHD"/></div></figure><p id="a5e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那是按年份顺序的。也许按温度顺序排会更有意思。</p><p id="f543" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以用 SQL 做到这一点。我们加上 ORDER BY 子句，并给出应规定顺序的列。DESC 的意思是降序(省略它，您将得到默认的升序)。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="859f" class="ma mb it lw b gy mc md l me mf">high = pd.read_sql('SELECT Year,Month,Tmax FROM weather WHERE Tmax &gt; 25 ORDER BY Tmax DESC', conn)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/82e054657fb5e3372c2c2b69ef375507.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/0*5arpfnoiiYlertl3"/></div></figure><p id="9f32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，2018 年高居榜首，2006 年紧随其后。但是 1983 年和 1995 年分别排在第三和第四位，所以这里没有明显的模式显示温度随着时间的推移而变热。</p><p id="0fc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一点我们可以看到，最热的月份是在夏天！(谁会想到呢。)但为了确保万无一失，让我们绘制一个直方图。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4baf" class="ma mb it lw b gy mc md l me mf">high.plot.hist(y='Month', xticks=high['Month'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/90ac5419b3f007cf97784f7c23a106f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/0*qEVfZ67g6aopmOwu"/></div></figure><p id="5fb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，最热的月份往往是七月。所以，如果我们在寻找一种趋势，为什么我们不看看几十年来的七月，看看气温是如何变化的。</p><p id="3de1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是另一个查询:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f2a5" class="ma mb it lw b gy mc md l me mf">july = pd.read_sql('SELECT Year,Month,Tmax FROM weather WHERE month == 6', conn)</span></pre><p id="afbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这给了我们一个所有年份的温度表，但只有当月份等于 6 时，即 7 月。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/54bac2ae2ae0618ca5db8358790b1c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/0*NgtwivfbFA_43qXE"/></div></figure><p id="d566" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将绘制一个 Tmax 值随时间变化的条形图。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7684" class="ma mb it lw b gy mc md l me mf">july.plot.bar(x='Year', y='Tmax', figsize=(20,5));</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/12df1ebfa724d51f7a06b661db01bb72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HZXmVQCMFnV6rxkH"/></div></div></figure><p id="da18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以做一个回归图，看看是否有任何趋势，但坦率地说，看看这个条形图，没有明显的趋势。</p><p id="a7c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，通过对伦敦气温数据的这种极其有限的分析，我们无法得出气候变化是否正在影响伦敦人的任何结论(但从个人经验来看，我可以说那里最近感觉相当温暖)。</p><p id="3601" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是我希望我已经展示了 SQLite 在与 Pandas 一起使用时是一个有用的工具，并且如果您以前没有使用过 SQL，您可以看到如何，即使是我在这里使用的很小一部分，可能会使您的数据分析受益。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="6ef7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一如既往，感谢阅读。如果你想知道我什么时候发表新文章，请考虑在这里注册一个电子邮件提醒。</p><p id="9e59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不是一个媒体订阅者，那就注册吧，这样你就可以每月花 5 美元阅读尽可能多的文章。在这里注册<a class="ae ky" href="https://alan-jones.medium.com/membership" rel="noopener"/>，我将赚取一小笔佣金。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h2 id="1587" class="ma mb it bd mz na nb dn nc nd ne dp nf li ng nh ni lm nj nk nl lq nm nn no np bi translated">获取代码</h2><p id="ea92" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">你可以在我的<a class="ae ky" href="https://alanjones2.github.io/Alan-Jones-article-code/" rel="noopener ugc nofollow" target="_blank"> Github 页面</a>上找到这篇文章和其他文章的样本代码。</p></div></div>    
</body>
</html>