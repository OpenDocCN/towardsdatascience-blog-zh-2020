<html>
<head>
<title>Building dynamic dashboards in Python with Angular and Bokeh Charts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 构建带有角度和散景图的动态仪表盘</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-dynamic-dashboards-with-angular-and-bokeh-51668a5367f1?source=collection_archive---------20-----------------------#2020-01-15">https://towardsdatascience.com/building-dynamic-dashboards-with-angular-and-bokeh-51668a5367f1?source=collection_archive---------20-----------------------#2020-01-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4648" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个灵活的动态仪表板示例，使用散景图、Angular 和 Python 作为后端。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/472c4179d21299e3263712d7f6ca15d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*Uc5KW7hV3kPvueSuKKqVnA.png"/></div></figure><p id="5686" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi lm translated"><span class="l ln lo lp bm lq lr ls lt lu di">如果</span>我们考虑工业 4.0 应用，一般来说，对其有必然的要求。</p><p id="5b5a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">它们应该是:</p><ul class=""><li id="4ae7" class="lv lw it ks b kt ku kw kx kz lx ld ly lh lz ll ma mb mc md bi translated">模块化，</li><li id="4734" class="lv lw it ks b kt me kw mf kz mg ld mh lh mi ll ma mb mc md bi translated">可扩展，</li><li id="60f4" class="lv lw it ks b kt me kw mf kz mg ld mh lh mi ll ma mb mc md bi translated">易于集成到现有网络中，并且</li><li id="5d2b" class="lv lw it ks b kt me kw mf kz mg ld mh lh mi ll ma mb mc md bi translated">可互操作-可以轻松连接到任何其他服务。</li></ul><h1 id="340a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"><strong class="ak">动态图表示例</strong></h1><p id="c740" class="pw-post-body-paragraph kq kr it ks b kt nb ju kv kw nc jx ky kz nd lb lc ld ne lf lg lh nf lj lk ll im bi translated">例如，这种应用程序的主要目标之一是独立于工作平台及时查看数据。数据的来源应该与技术无关，可能来自其他物联网设备，如传感器或服务器或其他连接的资源。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="7b58" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="ks iu">我们已经向您展示了… </strong></p><p id="172f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi lm translated"><span class="l ln lo lp bm lq lr ls lt lu di">是</span>这可以使用<a class="ae ni" rel="noopener" target="_blank" href="/angular-and-bokeh-e8acd86e7ab1">我们之前在 Medium 上介绍的 web-app 架构</a>来实现。</p><h2 id="a92f" class="nj mk it bd ml nk nl dn mp nm nn dp mt kz no np mv ld nq nr mx lh ns nt mz nu bi translated"><strong class="ak">动态仪表板展示区</strong></h2><p id="c010" class="pw-post-body-paragraph kq kr it ks b kt nb ju kv kw nc jx ky kz nd lb lc ld ne lf lg lh nf lj lk ll im bi translated">为此，我们利用最近提出的架构构建了一个动态仪表板。它由作为框架的<a class="ae ni" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a>组成，在过去几年中已经发展成为非常成熟的前端解决方案。它在<a class="ae ni" href="https://material.angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular Material </a>中提供了 web 应用程序的标准组件，可以很容易地扩展到任何更复杂的视图或组件。</p><p id="f77c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于后端，我们一如既往地坚持使用 Python，因为它以非常低的开发开销提供了各种连接，还因为它是一门优秀的语言。此外，它还提供了广泛的数据处理工具，如人工智能/深度学习工具、数学工具以及最后但并非最不重要的绘图工具，如我们将在本次演示中使用的<a class="ae ni" href="https://docs.bokeh.org/en/latest/" rel="noopener ugc nofollow" target="_blank">散景</a>。</p><p id="1f8f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们也非常乐意用异步编程范式来扩展我们通常使用的 web 服务器技术，这意味着我们使用<a class="ae ni" href="https://aiohttp.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> aiohttp </a>作为我们的标准 python web 服务器。</p><p id="1a6e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了连接这两个部分，我们决定广泛使用<a class="ae ni" href="https://websockets.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> websockets </a>，它通过标准的 tcp/ip 协议保证双向的响应数据流。</p><p id="923e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="ks iu">需要解决的问题</strong></p><p id="6c82" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在此过程中出现的一些典型问题有</p><ul class=""><li id="858f" class="lv lw it ks b kt ku kw kx kz lx ld ly lh lz ll ma mb mc md bi translated">图表或数字表示中的动态数据供应，</li><li id="4545" class="lv lw it ks b kt me kw mf kz mg ld mh lh mi ll ma mb mc md bi translated">在 Angular 应用程序中使用独立的散景图表，每个图表都应该是一个组件，图表的内容完全由后端驱动，</li><li id="1baf" class="lv lw it ks b kt me kw mf kz mg ld mh lh mi ll ma mb mc md bi translated">例如，在板上排列图表的灵活性。</li></ul><h2 id="7b70" class="nj mk it bd ml nk nl dn mp nm nn dp mt kz no np mv ld nq nr mx lh ns nt mz nu bi translated"><strong class="ak">动态数据供应入门</strong></h2><p id="0bfa" class="pw-post-body-paragraph kq kr it ks b kt nb ju kv kw nc jx ky kz nd lb lc ld ne lf lg lh nf lj lk ll im bi translated">仪表板必须显示可以随时更新的数据。在某些情况下，我们将需要实时数据显示，或者至少在 tcp/ip 协议处理时间和浏览器显示时间之内。我们从一个稍微不太严格的要求开始。</p><p id="2619" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为图表提供动态数据的最简单方法是使用 ajax 调用散景图表。幸运的是，这已经作为散景图的标准方式实现了。Ajax 数据结构的行为与普通数据结构相同，可以作为一种无缝的方式定期更新数据。</p><p id="4b5a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这里我们展示了如何更新标签中的数字。为此，我们必须使用<em class="nv"> LabelSet </em>，因为这是与图表上显示的文本相结合的唯一动态更新的数据结构。我们将下面的代码放在 Python 后端的一个单独的类<em class="nv"> ChartProvider </em>中，这个类有一个类似于下面的函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nh l"/></div></figure><p id="a387" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这段代码片段展示了如何每 300 毫秒更新一次<em class="nv">源</em>，以及如何在<em class="nv">适配器</em>中进一步处理数据，适配器是一小段 JavaScript 代码。在 Python 端,<em class="nv"> AjaxDataSource </em>的行为很大程度上类似于以下格式的每个静态数据源</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nh l"/></div></figure><p id="a46d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了以 ajax 方式提供连续的数据，我们必须使用我们的 web 服务器支持的 URL。如前所述，我们使用了<em class="nv"> aiohttp </em>，因此我们可以将此路由作为 POST 路由，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nh l"/></div></figure><p id="874e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">最后，我们可以包含来自于 ChartProvider 的 chart_item ，就像我们之前在文章中详细描述的一样。chart_item 是一个自包含的<em class="nv"> json </em>格式的图表。这也意味着图表已经包含了数据获取机制<em class="nv"> ajax </em>。在下图中，我们看到了典型的角形材料卡片中包含的图表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="00fb" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Bokeh 提供了一种简单的 ajax 更新方式。但遗憾的是 Bokeh 还没有一个简单的功能，它只能在 JavaScript 端重绘图表。提醒一下，我们使用全局包含的散景模块的调用，它通过以下方式导入到我们的角度组件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nh l"/></div></figure><p id="1e76" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">角度方面的主要任务是为 embed_item 函数调用提供数据。因为我们使用 websocket 连接，所以我们将 chart_item 从 python 发送到 angular。它也可以由 REST-api 提供。顺便说一下，如果我们需要来自服务器的及时数据，我们的 websocket 连接更可行。另一方面，ajax 调用是通过轮询完成的，这有几个缺点。其中之一是，web 服务器在每次客户端请求数据时都工作，即使数据没有改变。</p><p id="4a05" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">长话短说。我们可以通过 websocket 提供第一个图表数据或其他事件驱动的数据，但目前图表的更新数据仅限于 ajax 调用。我们希望将来避开 ajax 调用，从后端切换到事件驱动的调用。如果你想想解决办法，为什么不是每次都通过 websocket 发送完整的图表，调用 embed_item 方法，那也不是办法。散景嵌入图表的方式非常昂贵，因此我们永远不会达到我们想要的更新速度。</p><h2 id="d4e1" class="nj mk it bd ml nk nl dn mp nm nn dp mt kz no np mv ld nq nr mx lh ns nt mz nu bi translated"><strong class="ak">总结</strong></h2><p id="498b" class="pw-post-body-paragraph kq kr it ks b kt nb ju kv kw nc jx ky kz nd lb lc ld ne lf lg lh nf lj lk ll im bi translated">我们展示了如何在 Angular 应用程序中实现定期更新的散景图，这是我们最终目标的一部分，即创建一个动态仪表板。</p><p id="762f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于数据更新，我们使用了 ajax 方法，因为它已经是 Bokeh 中的内置方法，我们不必调整我们的 websocket 连接。</p><p id="b873" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在 python 方面，数据供应或多或少是一项简单的任务，但重要的是我们要确保使用非阻塞调用，这意味着一致地使用异步方法。</p><p id="d747" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们会尽快让你知道如何解决其他问题。</p></div></div>    
</body>
</html>