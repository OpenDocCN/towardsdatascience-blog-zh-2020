<html>
<head>
<title>Uploading files to Google Drive directly from the Terminal (using Curl)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">直接从终端上传文件到 Google Drive(使用 Curl)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/uploading-files-to-google-drive-directly-from-the-terminal-using-curl-2b89db28bb06?source=collection_archive---------3-----------------------#2020-09-14">https://towardsdatascience.com/uploading-files-to-google-drive-directly-from-the-terminal-using-curl-2b89db28bb06?source=collection_archive---------3-----------------------#2020-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d102" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将数据从计算机推送到云的另一种方法。</h2></div><p id="633c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在许多情况下，从一台新机器向另一台机器发送数据可能很困难。这方面的例子包括隐藏在登录门户后面但不允许 ssh 隧道的 HPC 设施，或者只安装了几个核心程序的简单无头机器。在本文中，我们将使用 cURL(一个用于传输数据的命令行程序)将一个压缩文件(包含日志文件)推送到我们的 google drive 帐户上，以便进行进一步的分析。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/45955a7cb6dd82c49b13943e164cc727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*isMV4Du51KnAdI80"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@element5digital?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Element5 数码</a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="c3f1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">装置</h1><p id="fb27" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">大多数机器都会安装 cURL(试着输入<code class="fe ms mt mu mv b">which curl</code>)。如果不是这样，我们可以安装它</p><pre class="lf lg lh li gt mw mv mx my aw mz bi"><span id="8fd1" class="na lw it mv b gy nb nc l nd ne">sudo apt install curl # Linux Debian/Ubuntu</span></pre><p id="9591" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者</p><pre class="lf lg lh li gt mw mv mx my aw mz bi"><span id="39f3" class="na lw it mv b gy nb nc l nd ne">brew install curl     # Mac</span></pre><p id="fc61" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们已经安装了它，我们可以看看如何创建发送文件所需的凭证。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="1efb" class="lv lw it bd lx ly nm ma mb mc nn me mf jz no ka mh kc np kd mj kf nq kg ml mm bi translated">创建您的项目凭据</h1><p id="b2b3" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">由于我们允许访问我们的谷歌驱动器，我们希望能够管理这一点。这是通过创建一个具有用户定义权限的项目来实现的，该项目充当我们的用户(在本例中，我们在不同的机器上)和我们的帐户之间的代理。我们首先转到下面的页面(下面的链接)并创建一个新项目。</p><div class="nr ns gp gr nt nu"><a href="https://console.developers.google.com/apis/credentials?pli=1" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">谷歌云平台</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">Google 云平台让您可以在同一基础设施上构建、部署和扩展应用程序、网站和服务…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">console.developers.google.com</p></div></div><div class="od l"><div class="oe l of og oh od oi lo nu"/></div></div></a></div><p id="b652" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完成后，我们选择“凭据”选项卡(在左侧),然后从顶部选择“创建凭据”。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oj"><img src="../Images/00a0a553b19fdd97f5dc712f94c3036d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dN4GWsvluseqAXfsnNZSMA.png"/></div></div></figure><p id="71f7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当询问应用程序类型时，我们选择电视和其他。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ok"><img src="../Images/6f84fc4318be1b24dec0c5aaab76fa4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q4O5zivox7I3vvF2rMdGag.png"/></div></div></figure><p id="a5c8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，这会生成一个<code class="fe ms mt mu mv b">client id</code>和一个<code class="fe ms mt mu mv b">client seacret</code>。</p><p id="c335" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是您的用户名和密码，请将其复制到安全的地方。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="7d01" class="lv lw it bd lx ly nm ma mb mc nn me mf jz no ka mh kc np kd mj kf nq kg ml mm bi translated">现在我们需要验证设备</h1><p id="7874" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">为此，我们<code class="fe ms mt mu mv b">ssh</code>进入我们希望上传的机器，并运行以下命令:</p><pre class="lf lg lh li gt mw mv mx my aw mz bi"><span id="a363" class="na lw it mv b gy nb nc l nd ne">curl -d "client_id=<strong class="mv iu">&lt;client_id&gt;</strong>&amp;scope=<!-- -->https://www.googleapis.com/auth/drive.file<!-- -->" https://oauth2.googleapis.com/device/code</span></pre><p id="7d52" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样，我们会得到以下格式的响应</p><pre class="lf lg lh li gt mw mv mx my aw mz bi"><span id="2cd8" class="na lw it mv b gy nb nc l nd ne">{"<strong class="mv iu">device_code</strong>": "&lt;long string&gt;",<br/>"<strong class="mv iu">user_code</strong>": "xxx-xxx-xxx",<br/>"expires_in": 1800,<br/>"interval": 5,<br/>"<strong class="mv iu">verification_url</strong>": "https://www.google.com/device"}</span></pre><p id="9eec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里我们需要访问 URL(<a class="ae lu" href="https://www.google.com/device" rel="noopener ugc nofollow" target="_blank">https://www.google.com/device</a>)并提供用户代码来完成我们的验证。我们现在继续选择我们的 google 帐户并授予相关权限。进行此操作时，确保记下<strong class="kk iu">设备代码</strong>用于下一步。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="7eef" class="lv lw it bd lx ly nm ma mb mc nn me mf jz no ka mh kc np kd mj kf nq kg ml mm bi translated">获取不记名代码</h1><p id="f395" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">当我们开始上传时，这是我们需要用来识别我们的帐户的代码。我们通过使用以下内容获得它:</p><pre class="lf lg lh li gt mw mv mx my aw mz bi"><span id="fdfa" class="na lw it mv b gy nb nc l nd ne">curl -d client_id=<strong class="mv iu">&lt;client id&gt;</strong> -d client_secret=<strong class="mv iu">&lt;client secret&gt;</strong> -d device_code=<strong class="mv iu">&lt;device code&gt;</strong> -d grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Adevice_code https://accounts.google.com/o/oauth2/token</span></pre><p id="a966" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">客户端 id 和密码保存在<em class="ol">第一步</em>中，设备代码保存在<em class="ol">上一节</em>中。输出应采用以下格式:</p><pre class="lf lg lh li gt mw mv mx my aw mz bi"><span id="f7e2" class="na lw it mv b gy nb nc l nd ne">{<br/>"access_token": ".....",<br/>"expires_in": 3599,<br/>"refresh_token": "....",<br/>"scope": "https://www.googleapis.com/auth/drive.file",<br/>"token_type": "Bearer"<br/>}</span></pre><p id="7f94" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">记下<strong class="kk iu">访问令牌</strong>，因为上传阶段会用到它。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="e048" class="lv lw it bd lx ly nm ma mb mc nn me mf jz no ka mh kc np kd mj kf nq kg ml mm bi translated">上传文件</h1><p id="50b2" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">下面给出了我们用来上传文件的命令</p><pre class="lf lg lh li gt mw mv mx my aw mz bi"><span id="8105" class="na lw it mv b gy nb nc l nd ne">curl -X POST -L \<br/>    -H "Authorization: Bearer <strong class="mv iu">&lt;enter </strong><strong class="mv iu">access token here</strong><strong class="mv iu">&gt;</strong>" \<br/>    -F "metadata={name :'<strong class="mv iu">&lt;our.zip&gt;'</strong>};type=application/json;charset=UTF-8" \<br/>    -F "file=@<strong class="mv iu">&lt;our.zip&gt;</strong>;type=application/zip" \<br/>    "https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart"</span></pre><p id="f6ae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ol">在允许上传数据之前，您可能需要启用应用程序 API。如果是这种情况，错误消息中会给出执行此操作的链接。</em></p><p id="d1a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里的<em class="ol">多部分</em>文件预计只有几 MB 大小。然而，如果你正在考虑移动更大的文件<em class="ol">可恢复的</em>可能更适合(见<a class="ae lu" href="https://developers.google.com/drive/api/v3/manage-uploads" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/drive/api/v3/manage-uploads</a></p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="fff5" class="lv lw it bd lx ly nm ma mb mc nn me mf jz no ka mh kc np kd mj kf nq kg ml mm bi translated">用一个脚本把它包起来</h1><p id="7d16" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">现在我们知道我们的命令工作，我们可以创建一个可执行脚本来为我们做所有的工作。在这里，我们可以提供一组文件，它将它们压缩，然后发送到 google drive。</p><p id="d7de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们首先用<code class="fe ms mt mu mv b">nano curlgoogle;</code>创建一个新文件，并输入以下代码——记得添加您自己的个人身份验证令牌！选择 Python 2.7 是因为这仍然是旧系统上的默认 Python 版本，但是下面的脚本也应该适用于 python 3。</p><p id="2502" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果 curl 已经存在于系统中，它应该不需要新的依赖关系。</p><pre class="lf lg lh li gt mw mv mx my aw mz bi"><span id="baa3" class="na lw it mv b gy nb nc l nd ne">#!/usr/bin/python</span><span id="fcf9" class="na lw it mv b gy om nc l nd ne">'''<br/>A quick python script to automate curl-&gt;googledrive interfacing<br/>This should require nothing more than the system python version and curl. Written for python2.7 (with 3 in mind).</span><span id="c305" class="na lw it mv b gy om nc l nd ne">Dan Ellis 2020<br/>'''</span><span id="0af7" class="na lw it mv b gy om nc l nd ne">import os,sys,json</span><span id="47ad" class="na lw it mv b gy om nc l nd ne">if sys.version[0]=='3':<br/>  raw_input = lambda(x): input(x)</span><span id="c26f" class="na lw it mv b gy om nc l nd ne">##############################<br/>#Owner information goes here!#<br/>##############################<br/>name = 'curldata'<br/>client_id= '<strong class="mv iu">&lt;enter your client id&gt;</strong>'<br/>client_secret='<strong class="mv iu">&lt;enter your client secret&gt;</strong>'</span><span id="efa5" class="na lw it mv b gy om nc l nd ne">##############################</span><span id="ca32" class="na lw it mv b gy om nc l nd ne"><br/>cmd1 = json.loads(os.popen('curl -d "client_id=%s&amp;scope=<a class="ae lu" href="https://www.googleapis.com/auth/drive.file" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/drive.file</a>" https://oauth2.googleapis.com/device/code'%client_id).read())</span><span id="0e52" class="na lw it mv b gy om nc l nd ne">str(raw_input('\n Enter %(user_code)s\n\n at %(verification_url)s \n\n Then hit Enter to continue.'%cmd1))</span><span id="c786" class="na lw it mv b gy om nc l nd ne">str(raw_input('(twice)'))</span><span id="4a26" class="na lw it mv b gy om nc l nd ne">cmd2 = json.loads(os.popen(('curl -d client_id=%s -d client_secret=%s -d device_code=%s -d grant_type=urn~~3Aietf~~3Aparams~~3Aoauth~~3Agrant-type~~3Adevice_code https://accounts.google.com/o/oauth2/token'%(client_id,client_secret,cmd1['device_code'])).replace('~~','%')).read())<br/>print(cmd2)</span><span id="f57f" class="na lw it mv b gy om nc l nd ne"># zip files<br/>cmd3 = os.popen('zip -r %s.zip %s'%(name,' '.join(sys.argv[1:]))).read<br/>print(cmd3)</span><span id="efc5" class="na lw it mv b gy om nc l nd ne">cmd4 = os.popen('''<br/>curl -X POST -L \<br/>    -H "Authorization: Bearer %s" \<br/>    -F "metadata={name :\'%s\'};type=application/json;charset=UTF-8" \<br/>    -F "file=@%s.zip;type=application/zip" \<br/>    "<a class="ae lu" href="https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart</a>"<br/>    '''%(cmd2["access_token"],name,name)).read()</span><span id="8d49" class="na lw it mv b gy om nc l nd ne">print(cmd4)<br/>print('end')</span></pre><p id="49aa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们使它可执行<code class="fe ms mt mu mv b">chmod a+x curlgoogle</code>,允许我们以可执行的方式使用它:</p><pre class="lf lg lh li gt mw mv mx my aw mz bi"><span id="9d79" class="na lw it mv b gy nb nc l nd ne"><strong class="mv iu">./curlgoogle</strong> file1 file2.txt file3.jpg etc... </span></pre></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="0fa3" class="lv lw it bd lx ly nm ma mb mc nn me mf jz no ka mh kc np kd mj kf nq kg ml mm bi translated">结论</h1><p id="d1f5" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">现在我们有了一个简单的方法，可以将多个日志文件从一台无头机器发送到一个 google drive 存储库中，供多人访问以进行分析。</p><p id="e46d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你需要更多的信息，由<a class="ae lu" href="https://stackoverflow.com/users/7108653/tanaike" rel="noopener ugc nofollow" target="_blank"> Tanaike </a>和<a class="ae lu" href="https://stackoverflow.com/users/7362099/haks" rel="noopener ugc nofollow" target="_blank"> HAKS </a>(以及其他人)提供的堆栈溢出回答对创建这篇文章特别有帮助。</p></div></div>    
</body>
</html>