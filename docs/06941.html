<html>
<head>
<title>COVID-19: Face Mask Detection using TensorFlow and OpenCV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新冠肺炎:使用TensorFlow和OpenCV的人脸面具检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/covid-19-face-mask-detection-using-tensorflow-and-opencv-702dd833515b?source=collection_archive---------3-----------------------#2020-05-29">https://towardsdatascience.com/covid-19-face-mask-detection-using-tensorflow-and-opencv-702dd833515b?source=collection_archive---------3-----------------------#2020-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2e62" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建一个CNN模型，用你的网络摄像头或手机摄像头检测一个人是否戴着口罩。</h2></div><p id="4967" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这些艰难的<strong class="kk iu"><em class="le"/></strong>时代，做一些与之相关的事情岂不是令人满足？我决定用<strong class="kk iu"> <em class="le"> TensorFlow </em> </strong>搭配<strong class="kk iu"> <em class="le"> Keras </em> </strong>库和<strong class="kk iu"> <em class="le"> OpenCV </em> </strong>建立一个非常简单基本的卷积神经网络(CNN)模型，来检测你是否戴了口罩来保护自己。有意思！不是吗？</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/3cc3f5d6547381df6dddca15a69d1056.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dGfdg8T6mTkDjYtz"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated"><a class="ae lv" href="https://unsplash.com/@macauphotoagency?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">澳门图片社</a>拍摄于<a class="ae lv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="bac8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了建立这个模型，我将使用由<a class="ae lv" href="https://www.linkedin.com/feed/update/urn%3Ali%3Aactivity%3A6655711815361761280/" rel="noopener ugc nofollow" target="_blank">般若班达瑞</a>提供的面具数据集。它由大约<strong class="kk iu"><em class="le">1376</em></strong>个图像和<strong class="kk iu"> <em class="le"> 690 </em> </strong>个包含带面罩人的图像和<strong class="kk iu"> <em class="le"> 686 </em> </strong>个包含不带面罩人的图像组成。</p><p id="6d59" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将使用这些图像构建一个CNN<strong class="kk iu"><em class="le"/></strong>模型，使用TensorFlow通过使用您的<em class="le"> PC </em>的<em class="le">网络摄像头</em>来检测您是否戴着面罩。此外，你也可以用你的<em class="le">手机的摄像头</em>来做同样的事情！</p><h2 id="b1a8" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">步骤1:数据可视化</h2><p id="46a9" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">在第一步中，让我们可视化两个类别的数据集中的图像总数。我们可以看到在'<strong class="kk iu"> <em class="le"> yes </em> </strong>'类中有<strong class="kk iu"> <em class="le"> 690 </em> </strong>图像，在'<strong class="kk iu"> <em class="le"> no </em> </strong>类中有<strong class="kk iu"> <em class="le"> 686 </em> </strong>图像。</p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="3b49" class="lw lx it mv b gy mz na l nb nc">The number of images with facemask labelled 'yes': 690 <br/>The number of images with facemask labelled 'no': 686</span></pre><h2 id="6f2d" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated"><strong class="ak">第二步:数据扩充</strong></h2><p id="85f2" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">在下一步中，我们<strong class="kk iu"> <em class="le">增加</em> </strong>我们的数据集，以包括更多数量的图像用于我们的训练。在这个<em class="le">数据扩充</em>的步骤中，我们<em class="le">旋转</em>和<em class="le">翻转</em>我们数据集中的每张图像。我们看到，在数据扩充后，我们总共有2751张<strong class="kk iu"><em class="le"/></strong>图像，其中<strong class="kk iu"> <em class="le"> 1380张</em> </strong>图像属于“<strong class="kk iu"> <em class="le">是</em> </strong>类，而“<strong class="kk iu"> <em class="le"> 1371张</em> </strong>图像属于“<strong class="kk iu"> <em class="le">否</em> </strong>类。</p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="2de5" class="lw lx it mv b gy mz na l nb nc">Number of examples: 2751 <br/>Percentage of positive examples: 50.163576881134134%, number of pos examples: 1380 <br/>Percentage of negative examples: 49.836423118865866%, number of neg examples: 1371</span></pre><h2 id="8bd0" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated"><strong class="ak">第三步:拆分数据</strong></h2><p id="ec89" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">在这一步中，我们<strong class="kk iu"> <em class="le">将我们的数据分割成<strong class="kk iu"> <em class="le">训练集</em> </strong>和<strong class="kk iu"> <em class="le">测试集</em> </strong>，训练集</em></strong>将包含CNN模型将被训练的图像，测试集<strong class="kk iu"><em class="le">包含我们的模型将被测试的图像。</em></strong></p><p id="0e78" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，我们取<strong class="kk iu"><em class="le">split _ size = 0.8</em></strong>，这意味着总图像的<strong class="kk iu"><em class="le"/></strong>的80%将进入<em class="le">训练集</em>，剩余的<strong class="kk iu"> <em class="le">图像的20% </em> </strong>将进入<em class="le">测试集。</em></p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="fadb" class="lw lx it mv b gy mz na l nb nc">The number of images with facemask in the training set labelled 'yes': 1104<br/>The number of images with facemask in the test set labelled 'yes': 276<br/>The number of images without facemask in the training set labelled 'no': 1096<br/>The number of images without facemask in the test set labelled 'no': 275</span></pre><p id="55cf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在分割之后，我们看到如上所述，期望百分比的图像已经被分配给训练集和测试集。</p><h2 id="60fa" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated"><strong class="ak">第四步:建立模型</strong></h2><p id="877f" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">下一步，我们构建我们的<strong class="kk iu"> <em class="le">顺序CNN模型</em> </strong>，具有各种层，如<em class="le"> Conv2D、MaxPooling2D、Flatten、Dropout </em>和<em class="le"> Dense </em>。在最后一个密集层中，我们使用'<strong class="kk iu"> <em class="le"> softmax </em> </strong>'函数来输出一个向量，该向量给出两个类中每一个的<em class="le">概率</em>。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nd ne l"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">人脸面具检测的序贯模型</p></figure><p id="05df" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里，我们使用'<strong class="kk iu"><em class="le">Adam</em></strong>' optimizer和'<strong class="kk iu"><em class="le">binary _ cross entropy</em></strong>'作为我们的损失函数，因为只有两个类。此外，您甚至可以使用<em class="le"> MobileNetV2 </em>来获得更高的精确度。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nf"><img src="../Images/3648b3d7b16aaa574c42b80ae247d87a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r7wdvwMaBa52CgOlykmCFw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">口罩CNN模型(来源——自己)</p></figure><h2 id="b6a0" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated"><strong class="ak">第五步:预先训练CNN模型</strong></h2><p id="c08e" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">在构建了我们的模型之后，让我们创建'<strong class="kk iu"> <em class="le"> train_generator </em> </strong>和'<strong class="kk iu"><em class="le">validation _ generator</em></strong>'以在下一步中使它们适合我们的模型。我们看到<strong class="kk iu"> <em class="le">训练集</em> </strong>中总共有<strong class="kk iu"> <em class="le"> 2200张</em> </strong>图像，<strong class="kk iu"><em class="le"/></strong>中有<strong class="kk iu"> <em class="le"> 551张</em> </strong>图像。</p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="9c8b" class="lw lx it mv b gy mz na l nb nc">Found 2200 images belonging to 2 classes. <br/>Found 551 images belonging to 2 classes.</span></pre><h2 id="e87f" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">步骤6:训练CNN模型</h2><p id="36fd" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">这一步是我们将训练集和测试集中的图像与我们使用<strong class="kk iu"> <em class="le"> keras </em> </strong>库构建的序列模型相匹配的主要步骤。我已经为<strong class="kk iu"> <em class="le"> 30 </em> </strong> <strong class="kk iu"> <em class="le">历元</em> </strong>训练了模型(迭代)。但是，我们可以训练更多的周期数以获得更高的精度，以免出现<em class="le">过拟合</em>。</p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="ead7" class="lw lx it mv b gy mz na l nb nc">history = model.fit_generator(train_generator,<br/>                              epochs=30,<br/>                              validation_data=validation_generator,<br/>                              callbacks=[checkpoint])</span><span id="6af6" class="lw lx it mv b gy ng na l nb nc">&gt;&gt;Epoch 30/30<br/>220/220 [==============================] - 231s 1s/step - loss: 0.0368 - acc: 0.9886 - val_loss: 0.1072 - val_acc: 0.9619</span></pre><p id="e35e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们看到，在第30个历元之后，我们的模型对于训练集的准确度为<strong class="kk iu"><em class="le"/></strong>98.86%，对于测试集的准确度为<strong class="kk iu"> <em class="le"> 96.19% </em> </strong>。这意味着它训练有素，没有任何过度配合。</p><h2 id="a23b" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated"><strong class="ak">第七步:标注信息</strong></h2><p id="9638" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">建立模型后，我们为我们的结果标注两个概率。<strong class="kk iu"><em class="le">【0】</em></strong><em class="le">为</em> <strong class="kk iu"> <em class="le">【不带_面具】</em> </strong> <em class="le">和</em><strong class="kk iu"><em class="le">【1】</em></strong><em class="le">为</em> <strong class="kk iu"> <em class="le">【带_面具】</em> </strong>。我还使用RGB值设置了边界矩形的颜色。<strong class="kk iu"> <em class="le">【红色】</em> </strong> <em class="le">为</em> <strong class="kk iu"> <em class="le">【不带_面具】</em> </strong> <em class="le">和</em> <strong class="kk iu"> <em class="le">【绿色】</em> </strong> <em class="le">为</em> <strong class="kk iu"> <em class="le">【带_面具】</em> </strong></p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="533a" class="lw lx it mv b gy mz na l nb nc">labels_dict={0:'without_mask',1:'with_mask'} <br/>color_dict={0:(0,0,255),1:(0,255,0)}</span></pre><h2 id="e855" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated"><strong class="ak">步骤8:导入面部检测程序</strong></h2><p id="def4" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">在此之后，我们打算用它来检测我们是否戴着口罩使用我们的电脑的网络摄像头。为此，首先，我们需要实现人脸检测。在这里，我使用<em class="le">基于Haar特征的级联分类器</em>来检测面部特征。</p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="1aa0" class="lw lx it mv b gy mz na l nb nc">face_clsfr=cv2.CascadeClassifier('haarcascade_frontalface_default.xml')</span></pre><p id="059e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个级联分类器是由<em class="le"> OpenCV </em>设计的，通过训练成千上万的图像来检测<em class="le">正面人脸</em>。的。xml文件也需要下载并用于检测面部。我已经将文件上传到了我的GitHub存储库中。</p><h2 id="f7ac" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated"><strong class="ak">第九步:检测戴面具和不带面具的人脸</strong></h2><p id="ef3f" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">在最后一步中，我们使用OpenCV库运行一个无限循环来使用我们的网络摄像头，其中我们使用<em class="le">级联分类器</em>来检测人脸。代码<code class="fe nh ni nj mv b">webcam = cv2.VideoCapture(0)</code>表示网络摄像头的使用。</p><p id="3f9d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该模型将预测两类<code class="fe nh ni nj mv b">([without_mask, with_mask])</code>中每一类的可能性。基于哪个概率更高，标签将被选择并显示在我们的脸部周围。</p><blockquote class="nk nl nm"><p id="8aad" class="ki kj le kk b kl km ju kn ko kp jx kq nn ks kt ku no kw kx ky np la lb lc ld im bi translated"><em class="it">此外，您可以下载适用于手机和PC的</em><a class="ae lv" href="https://www.dev47apps.com/" rel="noopener ugc nofollow" target="_blank"><em class="it">droid cam</em></a><em class="it">应用程序，以使用您手机的摄像头并在</em> <code class="fe nh ni nj mv b"><em class="it">webcam= cv2.VideoCapture(1).</em></code>中将数值从0更改为1</p></blockquote><h2 id="6db0" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">演示</h2><p id="8a1e" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">让我们看看我在自己身上试用的演示吧！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/d28f6fd2208c918fb723f9d77d78fd53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/1*8gA9ZFF86FwjifyvDbk_5g.gif"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">演示视频</p></figure><p id="1d17" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从上面的演示视频中，我们看到模型能够正确地检测到我是否戴着面具，并在标签上显示出来。</p><p id="8b0f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我正在分享我的<em class="le"> GitHub库</em>的链接，在那里你可以找到详细的。ipynb程序代码，供你试用。</p><div class="nr ns gp gr nt nu"><a href="https://github.com/mk-gurucharan/Face-Mask-Detection/" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">MK-gurucharan/面罩检测</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">在此，我附上我的代码，建立一个CNN模型，以检测一个人是否戴着口罩或不使用…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">github.com</p></div></div><div class="od l"><div class="oe l of og oh od oi lp nu"/></div></div></a></div><p id="585b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我们成功地建立了一个CNN模型来检测一个人是否戴着面罩。这可以用于许多应用中。考虑到<em class="le">新冠肺炎危机</em>，戴口罩在不久的将来可能是必要的，这种检测人是否戴口罩的方法可能会派上用场。</p><p id="c5a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我真的希望这些艰难的日子能尽快结束。让我们都保持健康和安全。到那时，快乐的机器学习！</p></div></div>    
</body>
</html>