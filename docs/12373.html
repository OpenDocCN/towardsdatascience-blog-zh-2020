<html>
<head>
<title>Automate your Machine Learning workflow with TanD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 TanD 自动化您的机器学习工作流程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automate-your-machine-learning-workflow-with-tand-7bb79ccad384?source=collection_archive---------61-----------------------#2020-08-25">https://towardsdatascience.com/automate-your-machine-learning-workflow-with-tand-7bb79ccad384?source=collection_archive---------61-----------------------#2020-08-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2f0f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用几个终端命令训练和部署您的 ML 模型，根本不需要代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e5488f7e3faa36d781a286e6e08b41df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5JFVvnU619kAgSlZUdmuZA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://cdn.pixabay.com/photo/2019/04/14/10/28/gears-4126485_1280.jpg" rel="noopener ugc nofollow" target="_blank">https://cdn . pix abay . com/photo/2019/04/14/10/28/gears-4126485 _ 1280 . jpg</a>。访问时间:2020 年 8 月 24 日</p></figure><p id="8abe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个关于 TanD 的帖子，一个自动化机器学习工作流程的无代码框架。它的目的是展示如何使用它来自动化您的机器学习工作流任务，以将您的时间花在对您来说重要的事情上。</p><p id="f2b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里查看<a class="ae ky" href="https://github.com/piEsposito/TanD" rel="noopener ugc nofollow" target="_blank"> GitHub 回购</a>。</p><p id="95ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据科学家、机器学习工程师或任何从事数据建模工作的人的工作流程都是重复的:在一些预处理的数据集上迭代地训练和部署模型，编写相同的函数来导入数据，一次又一次地拟合和部署一些机器学习模型，这很无聊，而且根本没有效率。</p><p id="4559" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种背景下，开发了 TanD(训练和部署)框架来自动化这一机器学习工作流的一部分，以缓解数据科学家的生活，让他们把时间花在对他们来说重要的事情上。</p><h1 id="aed6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">它是如何工作的</h1><p id="4ff8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">类似于“Django for Machine Learning”，TanD 的主要思想很简单:通过一些终端命令和对一个<code class="fe ms mt mu mv b">.json</code>文件的一些设置，用户能够训练一个 ML 模型(在 PyTorch 或 sklearn 上)，将它记录到<code class="fe ms mt mu mv b">mlflow</code>中，自动创建一个 API 来参考它。只需几个命令，您甚至可以将它部署到 AWS 上，无需编写任何代码。</p><p id="31e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让你在工作中想怎么懒就怎么懒，而不会影响工作质量。在使用它的 CLI 生成项目模板之后，您可以插入您的数据集，让它为您完成工作，或者指定复杂的 train 函数和 API 端点。</p><p id="d805" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在将展示如何使用 TanD 来自动化 UCI 心脏病数据集上从训练到部署的 ML 工作流。</p><h1 id="6633" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">设置项目</h1><p id="f996" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们首先必须安装 TanD，这很容易做到:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="498e" class="na lw it mv b gy nb nc l nd ne">pip install train-and-deploy</span></pre><p id="22d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想遵循本教程的部署部分，您还应该安装<a class="ae ky" href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a>、<a class="ae ky" href="https://docs.aws.amazon.com/pt_br/elasticbeanstalk/latest/dg/eb-cli3-install.html" rel="noopener ugc nofollow" target="_blank"> ElasticBeanstalk CLI </a>，并设置您的 AWS CLI 凭证。不要担心，我们在这里展示的一切都可以用自由层来完成，尽管 API 将是可伸缩和有弹性的。为此，您也可以遵循<a class="ae ky" href="https://docs.aws.amazon.com/en_us/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-creds" rel="noopener ugc nofollow" target="_blank"> AWS 文档</a>中的说明。</p><p id="a087" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建一个 TanD 项目，必须在终端上运行命令。我们将使用 PyTorch 模板，尽管您可以使用 sklearn one 来跟踪所有内容:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="8fdc" class="na lw it mv b gy nb nc l nd ne">tand-create-project --template pytorch-structured-classification</span><span id="9ecd" class="na lw it mv b gy nf nc l nd ne">## or if you prefer: tand-create-project --template sklearn-structured-classification</span></pre><p id="6e74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在文件夹上创建项目文件，并加载一个默认数据集(我们将使用它)，这就是上面提到的 UCI 心脏病。我们现在将逐一查看这些文件:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="4d55" class="na lw it mv b gy nb nc l nd ne">├── app.py<br/>├── config.json<br/>├── data<br/>│   └── data.csv<br/>├── Dockerfile<br/>├── env_files<br/>│   ├── app.env<br/>│   ├── docker_app.env<br/>│   └── train.env<br/>├── lib<br/>│   ├── __init__.py<br/>│   ├── model.py<br/>│   └── preprocess.py<br/>├── mlflow-server.sh<br/>├── requirements.txt<br/>├── test_app.py<br/>└── train.py</span></pre><h2 id="77d0" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">数据</h2><p id="ec60" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">数据文件夹包含将要使用的数据集。阳光下无新事。</p><h2 id="8444" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">配置</h2><p id="f681" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><code class="fe ms mt mu mv b">config.json</code>文件遵循以下结构:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="36ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中训练子字典包含与数据集和网络架构相关的训练参数。注意，我们必须指定包含标签的列，并在<code class="fe ms mt mu mv b">labels</code>列表中按顺序命名它们。<code class="fe ms mt mu mv b">to_drop</code>包含在定型之前应该从数据集中删除的所有列。</p><p id="f4bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ms mt mu mv b">mlflow</code>子目录包含与实验的<code class="fe ms mt mu mv b">mlflow</code>记录相关的参数。</p><h2 id="cef7" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">环境文件</h2><p id="34d7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><code class="fe ms mt mu mv b">env_files</code>文件夹包含用于模型训练和部署的环境变量源文件。<code class="fe ms mt mu mv b">train.env</code>为训练期间实验的<code class="fe ms mt mu mv b">mlflow</code>记录设置变量；</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="91ba" class="na lw it mv b gy nb nc l nd ne">MLFLOW_TRACKING_URI=sqlite:///database.db<br/>MLFLOW_DEFAULT_ARTIFACT_ROOT=./mlruns/</span></pre><p id="6fe9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">两者都可以设置为本地路径或云托管路径。为了简单起见，我们将保留它们的默认值，但是注意，为了可伸缩性，您应该设置自己的<code class="fe ms mt mu mv b">mlflow</code> db 和存储路径。</p><p id="1e20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ms mt mu mv b">app.env</code>包含与服务于模型的 API 相关的环境变量:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="4b56" class="na lw it mv b gy nb nc l nd ne">MLFLOW_TRACKING_URI="sqlite:///database.db"<br/>MLFLOW_DEFAULT_ARTIFACT_ROOT="./mlruns/"<br/>API_TOKEN="TOKEN123"<br/>MODEL_STAGE="Production"</span></pre><p id="8858" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了出现在<code class="fe ms mt mu mv b">train.env</code>上的那些，我们在这里有模型的阶段，它将由<code class="fe ms mt mu mv b">mlflow</code>加载器在生产中获取，还有一个令牌，它必须作为请求参考 API 的<code class="fe ms mt mu mv b">TOKEN</code>头传递。</p><p id="a927" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果用户想在本地运行一个<code class="fe ms mt mu mv b">Docker</code>，那么<code class="fe ms mt mu mv b">docker_app.env</code>在一个单独的文件中包含变量。</p><h2 id="b7bb" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">Dockerfile 文件</h2><p id="c87c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">当然，它包含了基于 FastAPI 构建服务于模型的图像的指令。</p><h2 id="5379" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">解放运动</h2><p id="e939" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Lib 包含模型架构(或者，在<code class="fe ms mt mu mv b">sklearn</code>项目中，一个将<code class="fe ms mt mu mv b">config.json</code>中选择的模型映射到<code class="fe ms mt mu mv b">sklearn</code>模型的解析器)。</p><p id="9d59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还包含<code class="fe ms mt mu mv b">preprocess.py</code>，具有<code class="fe ms mt mu mv b">preprocess</code>功能。在训练之前，我们在数据集中放置任何应该完成的预处理操作，这比仅仅删除列更复杂(或者我们可以在配置上保持在<code class="fe ms mt mu mv b">to_drop</code>)。我们今天不会使用定制的预处理程序。</p><p id="3cba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后是主要文件:</p><h2 id="43bb" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">火车</h2><p id="90ea" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在执行任何所需的预处理操作后，<code class="fe ms mt mu mv b">train.py</code>文件使用配置根据数据路径给出的数据训练模型。它将模型存储在<code class="fe ms mt mu mv b">mlflow</code>上，这样就可以在生产中读取它，以及许多指标，如准确性、AUC-ROC、AUPR、精确度、召回、NPV 等...</p><p id="3822" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您运行多次，它将保存不同的运行及其指标，您将能够在<code class="fe ms mt mu mv b">mlflow</code> UI 中设置生产模型，只需运行:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="5dc3" class="na lw it mv b gy nb nc l nd ne">bash mlflow-server.sh</span></pre><p id="ba16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个脚本还从预处理的数据中创建了一个请求模型，存储在<code class="fe ms mt mu mv b">request_model.json</code>中。该文件既用于测试模型，也用于新请求的验证和重新排序。</p><h2 id="acf9" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">应用</h2><p id="75c2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">TanD 模型模板包括一个简单的 FastAPI 应用程序，用于服务模型，受<code class="fe ms mt mu mv b">$API_TOKEN</code>保护。它包括端点:</p><ul class=""><li id="f617" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated"><code class="fe ms mt mu mv b">/</code>进行健康检查；</li><li id="b031" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe ms mt mu mv b">/update-model</code>用于通过请求使 API 在<code class="fe ms mt mu mv b">mlflow</code>指定的后端获取最新的生产阶段模型—需要<code class="fe ms mt mu mv b">$API_TOKEN</code>；和</li><li id="3c96" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe ms mt mu mv b">/predict</code>接收特征并返回模型预测—需要<code class="fe ms mt mu mv b">$API_TOKEN</code>。</li></ul><h2 id="a0b4" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">试验</h2><p id="92ea" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了确保一切正常，包括对 API 所有端点的测试。设置好适当的环境变量后，只需运行:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="25ff" class="na lw it mv b gy nb nc l nd ne">pytest</span></pre><p id="e780" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果通过了，你就可以走了。</p><p id="c216" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在准备继续训练模型，测试 API，最后部署它。</p><h1 id="e97d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">训练模型</h1><p id="2dd0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要训练模型，只需运行:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="0027" class="na lw it mv b gy nb nc l nd ne">source env_files/train.env &amp;&amp; python train.py</span></pre><p id="e20a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将执行操作并将其记录到<code class="fe ms mt mu mv b">mlflow</code>。您可能希望看到以下结果:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="6023" class="na lw it mv b gy nb nc l nd ne">bash mlflow-server.sh</span></pre><p id="1d38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将看到带有以下内容的用户界面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/aa5383a412fe3f866e389ccb15eac2b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Pxr_9kKMtZ5LvEkne7rVg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">注意，除了度量标准，它还存储了大量的度量标准和图表来帮助您评估模型。来源:我卑微的机器打印。</p></figure><p id="f163" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">训练脚本还保存对预测的每个要素的分析，以便可视化给定每个分类要素的预测比例和每个类的连续要素的分布。(这有助于检查模型是否有任何“欺骗”的特征，并对学习有一些解释)。</p><p id="47e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于心脏病预测为阳性的情况，该图像将是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/9568b0e1e91342f26ce0088601ffddc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iQWpsqolomsK4UWQGbhrXg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">大量的图表有助于评估模型和理解它学到了什么。</p></figure><p id="ee01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你也可以在那里看到混淆矩阵，PR 和 ROC 曲线。</p><p id="5030" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后你可能会想</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="aee0" class="na lw it mv b gy nb nc l nd ne">source env_files/app.env &amp;&amp; pytest</span></pre><p id="44a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">断言一切正常。</p><p id="e558" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们训练了这个模型，我们就能够开始探索 API，用<code class="fe ms mt mu mv b">Docker</code>运行它，甚至用几个终端命令将它部署到 AWS。</p><h1 id="d772" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">运行 API</h1><p id="f72c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们现在将展示运行一个 TanD 项目 API 的三种方法:本地，通过<code class="fe ms mt mu mv b">Docker</code>和部署到 AWS ElasticBeanstalk。</p><h2 id="7157" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">本地运行</h2><p id="847a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要在本地运行 API，您可以在具有适当要求的环境中运行:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="eced" class="na lw it mv b gy nb nc l nd ne">uvicorn app:app --reload --host 0.0.0.0 --port 8000</span></pre><p id="6cf7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，API 就可以在您的本地网络上打开了。你可以用一个<code class="fe ms mt mu mv b">curl</code>帖子请求来测试一下:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="dfc4" class="na lw it mv b gy nb nc l nd ne">curl --header "Content-Type: application/json" \<br/>  --header "TOKEN: $API_TOKEN" \<br/>  --request POST \<br/>  --data '{"age":1,"sex":1,"cp":1,"trestbps":1,"chol":1,"fbs":1,"restecg":1,"thalach":1,"exang":1,"oldpeak":1,"slope":1,"ca":1,"thal":1}' \<br/>  http://localhost:8000/predict</span></pre><h2 id="99ff" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">码头运行</h2><p id="8506" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可能希望通过<code class="fe ms mt mu mv b">Docker</code>运行它，这是一种可用于在云服务的通用虚拟机上部署它的方法。在 TanD 项目的根上构建它非常简单:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="8ed4" class="na lw it mv b gy nb nc l nd ne">docker build . -t tand-app:v1</span></pre><p id="7c6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您运行它时，一定要传递适当的环境文件和 API 使用的变量。您可以将它们设置在<code class="fe ms mt mu mv b">env_files/docker_app.env</code>:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="bf8e" class="na lw it mv b gy nb nc l nd ne">docker run -p 8000:8000 --env-file env_files/docker_app.env tand-app:v1</span></pre><p id="b673" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，您可以使用相同的命令来测试它，只需记住为请求使用正确的令牌:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="cd08" class="na lw it mv b gy nb nc l nd ne">curl --header "Content-Type: application/json" \<br/>  --header "TOKEN: $API_TOKEN" \<br/>  --request POST \<br/>  --data '{"age":1,"sex":1,"cp":1,"trestbps":1,"chol":1,"fbs":1,"restecg":1,"thalach":1,"exang":1,"oldpeak":1,"slope":1,"ca":1,"thal":1}' \<br/>  http://localhost:8000/predict</span></pre><h2 id="69dd" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">使用 AWS ElasticBeanstalk 部署它</h2><p id="59ca" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">TanD 还帮助您在 AWS EB 上部署它，这是一个很好的方法，因为它具有弹性和可伸缩性，同时仍然易于使用(通过我们的助手)。如果您按照上面的建议设置了 AWS CLI 凭据，安装了它，并安装了 ElasticBeanstalk CLI，那么现在就可以开始了。</p><p id="3c9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要准备在 AWS 上部署您的 TanD 项目，请在项目根目录下运行:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="7f45" class="na lw it mv b gy nb nc l nd ne">tand-prepare-aws-eb-deployment --init-git</span></pre><p id="19dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们传递这个<code class="fe ms mt mu mv b">--init-git</code>标志，因为 ElasticBeanstalk 使用了来自<code class="fe ms mt mu mv b">.git</code>目录的一些信息，以便在部署期间将项目上传到 AWS S3。这样，在部署之前，TanD 创建了一个 g it 存储库，并提交了使其工作的所有内容。</p><p id="8b52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您已经初始化了一个 git 存储库，您不必传递那个标志，只需记住添加并提交所有内容。</p><p id="008a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该脚本将创建一个脚本来部署 TanD 项目根目录上的应用程序、<code class="fe ms mt mu mv b">deploy-aws-eb.sh</code>和<code class="fe ms mt mu mv b">.ebextensions</code>目录，其中填充了一些用于部署的默认<code class="fe ms mt mu mv b">.config</code>文件，遵循以下结构:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="f99d" class="na lw it mv b gy nb nc l nd ne">├── .ebextensions<br/>    ├── options.config<br/>    ├── cron.config<br/>    └── scaling.config</span></pre><ul class=""><li id="5cc9" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated"><code class="fe ms mt mu mv b">options.config</code>为项目设置环境变量，同<code class="fe ms mt mu mv b">app.env</code> — <code class="fe ms mt mu mv b">mlflow</code>后端、模型阶段、API token。这就是环境变量传递给 EB 的方式。</li><li id="c8fe" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe ms mt mu mv b">cron.config</code>在部署的应用程序的每个实例上创建一个 cron 作业来每日查询 API <code class="fe ms mt mu mv b">update-model</code>端点，因此它从<code class="fe ms mt mu mv b">mlflow</code>后端获取最新的生产阶段模型。这样，如果您运行不同的实验并想要部署不同的模型，您可以通过<code class="fe ms mt mu mv b">mlflow</code> UI 进行，它将在生产中更新。</li><li id="5eda" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe ms mt mu mv b">scaling.config</code>为您的 API 设置缩放配置。我们将这些参数设置为我们的应用程序可以拥有的最小和最大实例数、实例类型和缩放标准。我们将最后一个默认为延迟，但是您可以自由地这样做。</li></ul><p id="d89b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以通过一个简单的:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="6c67" class="na lw it mv b gy nb nc l nd ne">bash deploy-aws-eb.sh</span></pre><p id="59e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">部署大约需要 5 分钟。之后，您可以使用以下命令检查链接:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="88a9" class="na lw it mv b gy nb nc l nd ne">eb open</span></pre><p id="f4af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后用相同的 curl 命令测试它(记住正确设置链接和 API 令牌):</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="1fe3" class="na lw it mv b gy nb nc l nd ne">curl --header "Content-Type: application/json" \<br/>  --header "TOKEN: $API_TOKEN" \<br/>  --request POST \<br/>  --data '{"age":1,"sex":1,"cp":1,"trestbps":1,"chol":1,"fbs":1,"restecg":1,"thalach":1,"exang":1,"oldpeak":1,"slope":1,"ca":1,"thal":1}' \<br/>  http://YOUR_LINK_GOES_HERE/predict</span></pre><p id="b48a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至此，我们结束了项目教程。</p><h1 id="4ded" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="f52c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">作为一个结论，我们可以看到，TanD 允许您非常快速地训练和部署您的 ML 模型，只需要一些设置和终端命令，根本不需要任何代码，但是让您可以自由地适应和更改项目模板。</p><p id="b104" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了训练和部署您的项目，您只做了 6 个终端命令并检查了<code class="fe ms mt mu mv b">config.json</code>上的一些设置:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="59f0" class="na lw it mv b gy nb nc l nd ne">tand-create-project --template pytorch-structured-classification</span><span id="121a" class="na lw it mv b gy nf nc l nd ne">## check config.json for your dataset</span><span id="29a5" class="na lw it mv b gy nf nc l nd ne">source train.env &amp;&amp; python train.py<br/>source app.env &amp;&amp; pytest</span><span id="f73c" class="na lw it mv b gy nf nc l nd ne">## run API as you will:</span><span id="712f" class="na lw it mv b gy nf nc l nd ne">tand-prepare-aws-deployment --init-git<br/>bash deploy-aws-eb.sh</span></pre><p id="7df4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了 TanD，你就可以自动化你的 ML 工作流程的很大一部分，节省你的时间去做对你来说重要的事情，或者只是偷懒和开心。</p><p id="1cee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这个帖子，考虑给它一些掌声或者主演<a class="ae ky" href="https://github.com/piEsposito/TanD" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>，它有助于项目获得更多的可见性。</p><p id="9857" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想和我谈谈这个项目，有一些见解，只是想聊天的批评，你可以在 LinkedIn 上 ping 我或者在回购中创建一些问题。</p><h1 id="d55d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考资料:</h1><div class="oj ok gp gr ol om"><a href="https://github.com/piEsposito/TanD" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">piEsposito/TanD</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">TanD 是一个简单、无代码、灵活和可定制的框架，用于自动化机器学习工作流。用和…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">github.com</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa ks om"/></div></div></a></div><div class="oj ok gp gr ol om"><a href="https://mlflow.org/" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">MLflow -机器学习生命周期的平台</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">机器学习生命周期的开源平台 MLflow 是一个开源平台，用于管理机器学习生命周期</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">mlflow.org</p></div></div><div class="ov l"><div class="pb l ox oy oz ov pa ks om"/></div></div></a></div><div class="oj ok gp gr ol om"><a href="https://www.kaggle.com/ronitf/heart-disease-uci" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">心脏病 UCI</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">https://archive.ics.uci.edu/ml/datasets/Heart+Disease</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">www.kaggle.com</p></div></div><div class="ov l"><div class="pc l ox oy oz ov pa ks om"/></div></div></a></div></div></div>    
</body>
</html>