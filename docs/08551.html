<html>
<head>
<title>Can We Beat the Bookmaker with Machine Learning?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们能用机器学习打败庄家吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/can-we-beat-the-bookmaker-with-machine-learning-45e3b30fc921?source=collection_archive---------29-----------------------#2020-06-21">https://towardsdatascience.com/can-we-beat-the-bookmaker-with-machine-learning-45e3b30fc921?source=collection_archive---------29-----------------------#2020-06-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f2e5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用LSTM模型预测足球博彩的利润</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/84f10228718b8a1ca280adfab06b3760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vIHp478XyxqL8oxk"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">埃里克·麦克林在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="1625" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">编者注:</em> </strong> <em class="ls">本文仅供教育娱乐之用。如果你想用这个模型进行真正的下注，那么你要自担风险。请确保这是符合你的庄家的条款和条件。</em></p><p id="2e5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着疾病的爆发和相应的经济关闭，数百万人不幸失去了工作。非常时期需要非常手段，我们可能会对创造新的非常规收入来源感兴趣。使用机器学习来预测足球比赛结果，从而帮助我们进行有利可图的下注，怎么样？</p><p id="675a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们使用一个简单的长短期记忆(LSTM)模型来预测足球比赛的结果。我们建立一个程序，在预测下一轮的结果之前，迭代地训练前几轮的模型。</p><p id="97ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以跟着<strong class="ky ir"> </strong> <a class="ae kv" href="https://colab.research.google.com/drive/1t81lv6pB4n0iPdm84taWOwaqVDEmsKUD?usp=sharing" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">这款Google Colab笔记本</strong> </a>。</p><h1 id="ad3a" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">LSTMs</h1><p id="10c9" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果你不知道什么是LSTM模式，我强烈推荐<a class="mq mr ep" href="https://medium.com/u/1bdc81ea939d?source=post_page-----45e3b30fc921--------------------------------" rel="noopener" target="_blank"> Michael Phi </a>在他的<a class="ae kv" rel="noopener" target="_blank" href="/illustrated-guide-to-lstms-and-gru-s-a-step-by-step-explanation-44e9eb85bf21">优秀文章</a>中解释它们。</p><p id="dea9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简而言之，LSTMs是一种特殊的递归神经网络，通常用于序列模型(例如自然语言处理)或时间序列预测(例如股票市场、需求、温度)。由于一个赛季的足球比赛代表一系列数据，模型可以使用以前的事件来预测未来，我们尝试使用LSTM博彩模型。</p><h1 id="476e" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">获取数据</h1><p id="fb4c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">每个机器学习模型的基础都在于数据。幸运的是，我们可以很容易地用谷歌搜索包含游戏分数和博彩赔率的数据集。对于我们的模型，我们将使用2018/2019德甲联赛的数据，这些数据可以从<a class="ae kv" href="https://www.football-data.co.uk/germanym.php" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><p id="bef6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于下载的csv包含了很多我们的模型不需要的数据，让我们简单地删除不必要的列。在<a class="ae kv" href="https://github.com/guggio/soccer_bets" rel="noopener ugc nofollow" target="_blank">我的GitHub储存库</a>中，你会发现一个精简的数据集，只包括比赛日期、球队、进球和全职成绩，以及B365的下注赔率(主场赢、平局和客场赢)。让我们看看前五排。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/c1af7e31c9aef1145591cc63f50cd65f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kYOx387FzTSCKwWLxopplw.png"/></div></div></figure><h1 id="ba37" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">数据准备</h1><p id="65e7" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们不是建立模型来预测忽略净胜球的全职结果，而是希望它预测主队和客场队之间的净胜球。此外，我们希望按轮协调结果的训练和预测，例如，在前9轮训练模型，并预测第10轮的结果以下注，等等。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="bcbb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于神经网络需要浮点数据或整数的张量，我们不能简单地使用团队的名称作为我们模型的输入(Chollet，2018年，第101页)。为了让我们的模型能够使用团队作为输入，我们为每个团队分配一个唯一的整数值。为此，我们创建了一个团队名称词汇表，并根据每个团队在词汇表中的索引，用他们各自的id来表示每个团队。对于实际的训练，我们将把这些指数输入到一个嵌入层中，这将在下面解释。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="e162" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Chollet (2018年，第101页)还建议，应该对数据进行归一化(所有值都应该很小，并且在同一范围内)，以促进网络的训练过程。由于我们预测主队和客场队的进球之差，而这些数值实际上可以在-5 (0:5)到5 (5:0)的范围内，甚至进一步分布，所以我们肯定要对数据进行缩放。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="309b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">准备好数据后，前五行应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/d143a7353f07b567cd71de094b0d1b51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vEBlsF58-QBWqfdBthElOg.png"/></div></div></figure><h1 id="873b" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">建模</h1><p id="15a3" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如上所述，模型应该在前几轮中进行训练，然后对下一轮的比赛进行预测。为了创建区别特征(X)和标签(y)集，我修改了<a class="mq mr ep" href="https://medium.com/u/102e34a0beb1?source=post_page-----45e3b30fc921--------------------------------" rel="noopener" target="_blank">维尼林·瓦尔科夫</a>的<a class="ae kv" rel="noopener" target="_blank" href="/demand-prediction-with-lstms-using-tensorflow-2-and-keras-in-python-1d1076fc89a0">需求预测模型</a>的create_dataset函数来满足我们的需求。如果你对LSTMs的进一步应用感兴趣，我绝对推荐他的文章。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="2b46" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们想在下注前观察赛季的前五轮。因此，这些观察轮次的数据被用来对模型的结构进行一些调整。具体来说，我们想弄清楚模型在过度拟合之前需要多少训练。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/45848850343e4ba991717ceb53dddfa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qXEi81JR4YU7I0YO9oM-ng.png"/></div></div></figure><p id="93fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们在上面的图表中看到的，在模型似乎开始过度拟合之前，火车损失减少了大约20个时期。因此，在进行预测之前，我们稍后将对模型进行20个时期的训练。</p><blockquote class="mx my mz"><p id="5548" class="kw kx ls ky b kz la jr lb lc ld ju le na lg lh li nb lk ll lm nc lo lp lq lr ij bi translated">注意:运行模型时，您可能会看到不同的结果。不幸的是，Keras的<a class="ae kv" href="https://keras.io/getting_started/faq/#how-can-i-obtain-reproducible-results-using-keras-during-development" rel="noopener ugc nofollow" target="_blank">建议</a>使模型可复制，这似乎对Google Colab不起作用。</p></blockquote><h1 id="2336" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">创建程序</h1><p id="53d2" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">为了建立一个程序来反复训练前几轮比赛，预测下一轮比赛的结果，然后下注，我们应该将整个过程分成几部分，并为每一步定义函数。</p><ul class=""><li id="6e8e" class="nd ne iq ky b kz la lc ld lf nf lj ng ln nh lr ni nj nk nl bi translated"><strong class="ky ir">数据选择</strong>:选择前几轮进行训练，选择当前轮进行预测</li><li id="c136" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated"><strong class="ky ir">建模、训练和预测</strong>:创建和训练模型以及进行预测和格式化输出的功能</li><li id="527b" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated"><strong class="ky ir">下注</strong>:根据模型的预测选择下注的游戏</li><li id="be1d" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated"><strong class="ky ir">汇总</strong>:迭代训练、轮次预测、结果汇编</li></ul><h2 id="054f" class="nr lu iq bd lv ns nt dn lz nu nv dp md lf nw nx mf lj ny nz mh ln oa ob mj oc bi translated">数据格式编排</h2><p id="4c0f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">因为我们在数据集上循环，并且在我们想要预测的回合之前的回合上训练模型，所以我们必须在每个回合之后重新创建数据集。我们使用上面的create_dataset函数为每次迭代创建一个训练和测试集。因为我们需要返回多个值，所以让我们将它们放入字典中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="36da" class="nr lu iq bd lv ns nt dn lz nu nv dp md lf nw nx mf lj ny nz mh ln oa ob mj oc bi translated">建模、训练和预测</h2><p id="dc0b" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">上面我已经概述了我们将如何建模我们的LSTM，你可能想知道，什么是嵌入层，为什么我们需要它。根据Chollet (2018年，第186页)的说法，这一层可以理解为一个字典，它将整数索引(即团队索引)映射到密集向量，然后这些向量可以用作模型的输入。我们需要它，因为否则我们的毫无意义的团队指数(从0到17)可能会被我们的模型误解。</p><p id="beee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我对超参数使用了相当随机的值，并明确鼓励您测试不同的组合，以优化模型的性能。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="43dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我们让模型预测缩放的游戏分数，我们必须反向转换这些预测，以便以想要的格式检索预测。为了创建一个包含模型预测的新数据框，我们需要对反向转换后的游戏分数进行整形。最后，我们将实际分数和预测分数堆叠到一个字典中，然后由函数返回。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="cc1b" class="nr lu iq bd lv ns nt dn lz nu nv dp md lf nw nx mf lj ny nz mh ln oa ob mj oc bi translated">打赌</h2><p id="d179" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">基于模型的预测，我们想要下注。我肯定不是博彩专家，但我建议只在模型非常有信心主队或客场队会赢(得分≥ |1.1|)的情况下下注。</p><p id="cd5b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">calculate_bets函数创建两个列表，一个包含我们投资的赌注单位(如果我们在这个游戏上下注，则为1，否则为0)，另一个包含赢款。对于我们没有考虑下注的游戏或我们下注失败的情况(例如，预测主场获胜，但它是平局)，赢款为0。如果模型正确预测了主场或客场获胜，则该游戏的获胜机会等于该结果的相应赔率。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="daf5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们可以创建一个将所有内容放在一起并预测赛季每一轮的循环之前，我们基于测试集(一轮9场比赛)创建一个新的数据框，并添加重新转换的实际和预测分数以及投资和获胜下注单位的列。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="5db9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">将所有这些放在一起</strong></p><p id="2e71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们可以将上面的所有部分加在一起，并定义一个循环的函数，创建训练、测试集和模型。然后对模型进行训练，对结果进行预测，然后放入数据框中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="8504" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">让我们打败庄家</h1><p id="7d33" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">把所有的碎片放在一起，是我们打败庄家的时候了！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="2b74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我上面已经提到的，模型不能产生可重复的结果，这意味着，你的结果可能与我的不同。</p><p id="c360" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的模型总共下了92注，这意味着它投入了92个下注单位。该模型可能是一个比我更好的游戏预测工具，赢得了94.71个下注单位，这意味着净赢款占2.71个下注单位🔥</p><p id="92b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了分析我们的模型在每一轮中的表现，并随着时间的推移看到胜利，让我们绘制数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/e590e8a170d3059975218647551bb37a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FiufYwpRUss_dcndXMIP1g.png"/></div></div></figure><p id="7460" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，第9、20和21轮是最差的，因为我们没有赢得任何赌注。为了改进模型，进一步观察这些回合并弄清楚是什么导致了这些结果肯定是有意义的。很有可能，明显的热门被失败者击败，或者我们的模型只是做出了错误的预测。</p><h1 id="274f" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论</h1><p id="00d5" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">恭喜你，你刚刚赢了庄家。好吧，至少假设，2018/2019年。</p><p id="38fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们都知道这种模式远非完美，但这是一种简单的方法，似乎适用于2018/2019德甲赛季。此外，我们处理了一些数据，用Keras建立了一个LSTM模型，并绘制了结果。我相信这种模式也可以应用到其他联赛，甚至不同的运动，如冰球，篮球或美式足球。</p><p id="511b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您对可能改进模型的其他特性或模型架构有任何建议，请告诉我。我考虑在以后的文章中用更高级的特性扩展当前的模型。</p><p id="148f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">非常感谢您的阅读！</p><p id="0a69" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保持保存和快乐编码！</p><h1 id="cd19" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">参考</h1><p id="b165" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">f . chollet(2018)。用Python进行深度学习。纽约:曼宁出版公司</p></div></div>    
</body>
</html>