<html>
<head>
<title>Building a Vulnerable Rails Application for Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为学习构建易受攻击的 Rails 应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-vulnerable-rails-application-for-learning-2a1de8cf98d5?source=collection_archive---------61-----------------------#2020-05-09">https://towardsdatascience.com/building-a-vulnerable-rails-application-for-learning-2a1de8cf98d5?source=collection_archive---------61-----------------------#2020-05-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="acfa" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">了解损坏的 DevSecOps 进程中的安全缺陷</h2><div class=""/><div class=""><h2 id="a8b1" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">介绍“Hammer”:一个易受攻击的 Ruby on Rails 应用程序的开源示例</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/9d79419c5e9d95ed82f97ff4b4f8bde1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gWxL0dEwVUIk5lpVsPDegQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">一个黑客的公寓——胡安·卡西尼的艺术作品</p></figure><p id="361c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di">答</span>任何人都可以学习做技术“黑客”，这篇文章将带你看一个你可以自己实现的开源例子。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="7f79" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当你想到“黑客”这个词时，它会唤起什么形象？你会想到一个技术高超、意志坚定的计算机安全对手躲在他(或她)的地下室里，试图穿透你的防御并窃取你的数据吗？在 2020 年，这个词传达了一种更加邪恶的恶意语气。现在这个术语有一系列的分类，包括“黑帽子”、“白帽子”和“灰帽子”。它们通过意图和许可来区分。然而，情况并非总是如此。黑客攻击曾经是所有美好事物的信号。有趣的是，这个术语起源于 1961 年麻省理工学院的模型铁路俱乐部。成员们黑进了他们的列车组以修改它们的功能。通过这一点，我们可以把它的意思扩展到理解黑客是如何在幕后工作的。它正在调整技术，以新的和创造性的方式使用它。我喜欢追溯这个词的原意。黑客是最纯粹最高尚的形式。本着下面这个指南的精神，你可以享受一个关于技术黑客的教程。至少，探索一个可以反映生产系统中有缺陷的安全方法的应用程序是很有趣的。请随意复制这个回购协议，并根据您自己的想法进行扩展。</p><p id="3c6a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di">我</span>最近偶然发现了一个有一些安全缺陷的迷人的网络应用程序。每隔一段时间，你就会发现一些让你兴奋不已的事情，去学习新的东西。我不得不回去，把我所看到的分解开来，然后按照我自己的理解重新创造。现在我不是专业的软件工程师。但是我绝对喜欢学习和理解事物。这是开发人员如何通过代码或部署环境引入风险的一个很好的例子。这个项目的精神是为所有人共享一个学习应用程序。介绍<a class="ae le" href="https://github.com/iknowjason/hammer" rel="noopener ugc nofollow" target="_blank">Hammer</a>——用 Ruby on Rails 编写的 web 应用程序的一个易受攻击的例子。在这篇文章中，我将带你创建锤子。你准备好了吗？让我们开始吧。但首先，概述一下什么是<a class="ae le" href="https://github.com/iknowjason/hammer" rel="noopener ugc nofollow" target="_blank"> <strong class="lh ja"> <em class="mr">锤子</em> </strong> </a>其实是:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ms"><img src="../Images/d2f5ef2aa4f5f0276c7b7f1a904cf624.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*82BV22hkqp_humz8LIAT2w.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">Ruby on Rails</p></figure><ul class=""><li id="184a" class="mt mu iq lh b li lj ll lm lo mv ls mw lw mx ma my mz na nb bi translated">用 Ruby on Rails 编写的易受攻击的 web 应用程序。</li><li id="d8bd" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma my mz na nb bi translated">100% FOSS InfoSec 社区贡献，可在此下载<a class="ae le" href="https://github.com/iknowjason/hammer" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="3597" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma my mz na nb bi translated">使用 Rails 搭建技术模拟 MySQL 数据库后端的生产 web 应用程序部署。</li><li id="42ae" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma my mz na nb bi translated">docker——编写自动化部署或手动构建指令。Docker 容器使用 MariaDB 数据库后端。</li><li id="f35c" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma my mz na nb bi translated">自举管理仪表板好看的用户界面。</li><li id="ef59" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma my mz na nb bi translated">包含使用信用卡和用户凭证部署模拟生产用户数据的 python 脚本。</li><li id="985f" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma my mz na nb bi translated">包含一个错误配置的 Ruby on Rails gem。</li><li id="357d" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma my mz na nb bi translated">隐藏在申请中的复活节彩蛋。</li><li id="ee70" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma my mz na nb bi translated">生产配置的配置步骤，包括加密 TLS 证书</li><li id="8578" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma my mz na nb bi translated">在 https://preprod.rtcfingroup.com<a class="ae le" href="https://preprod.rtcfingroup.com" rel="noopener ugc nofollow" target="_blank">演示锤子应用</a>(请善待我的应用)</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nh"><img src="../Images/4d8a98921fdf3bb2fa8e3584b20a228c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uLIgM4PV9AAtejsTyhp6WA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">它既好看又脆弱！</p></figure></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="1dc7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di"> F </span>或自动 Docker 构建部署，请跳至“<strong class="lh ja"> <em class="mr"> Docker 部署</em> </strong>”部分。否则，您可以按照下面指定的这些<strong class="lh ja"><em class="mr"/></strong>手动构建步骤。注意，这是在 Ubuntu Linux 18.04 上构建和测试的。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="74f6" class="ni nj iq bd nk nl nm nn no np nq nr ns kf nt kg nu ki nv kj nw kl nx km ny nz bi translated">手动构建步骤(Ubuntu Linux 18.04)</h1><p id="86a0" class="pw-post-body-paragraph lf lg iq lh b li oa ka lk ll ob kd ln lo oc lq lr ls od lu lv lw oe ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di">S</span>T16】step 1:安装 MySQL。这些步骤在 Ubuntu Linux 18.04 上得到了验证。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="de45" class="ok nj iq og b gy ol om l on oo">$sudo apt update</span><span id="193a" class="ok nj iq og b gy op om l on oo">$sudo apt install mysql-server mysql-client libmysqlclient-dev -y</span></pre><p id="d1ea" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">运行<strong class="lh ja"><em class="mr">MySQL _ secure _ installation</em></strong>脚本。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="f38f" class="ok nj iq og b gy ol om l on oo">$sudo mysql_secure_installation</span></pre><p id="5c67" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下面是一个指南，展示了我在创建这个应用程序时的脚本选择。请随意选择您认为最适合自己的安全要求。因为这是一个故意不安全的应用程序，所以应该仔细考虑需要更好安全性的其他部署类型:</p><ol class=""><li id="c564" class="mt mu iq lh b li lj ll lm lo mv ls mw lw mx ma oq mz na nb bi translated">验证密码插件？<strong class="lh ja">否</strong></li><li id="ca35" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma oq mz na nb bi translated">新密码？<strong class="lh ja"> &lt;输入密码&gt; </strong></li><li id="aa91" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma oq mz na nb bi translated">删除匿名用户？<strong class="lh ja">是</strong></li><li id="9175" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma oq mz na nb bi translated">不允许远程 root 登录？<strong class="lh ja">是</strong></li><li id="963d" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma oq mz na nb bi translated">远程测试数据库？<strong class="lh ja">是</strong></li><li id="f104" class="mt mu iq lh b li nc ll nd lo ne ls nf lw ng ma oq mz na nb bi translated">重新加载权限表？<strong class="lh ja">是</strong></li></ol><p id="7702" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated">安装 Ruby 版本管理器</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="d4ce" class="ok nj iq og b gy ol om l on oo">$sudo apt-get install software-properties-common -y</span><span id="ca80" class="ok nj iq og b gy op om l on oo">$sudo apt-add-repository -y ppa:rael-gc/rvm</span><span id="647a" class="ok nj iq og b gy op om l on oo">$sudo apt-get update</span><span id="747f" class="ok nj iq og b gy op om l on oo">$sudo apt-get install rvm -y</span></pre><p id="ebe0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">创建一个新用户，并将他们添加到 rvm 组。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="075b" class="ok nj iq og b gy ol om l on oo">$useradd -m -s /bin/bash -G rvm &lt;username&gt;</span></pre><p id="67ce" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过/etc/sudoers 委派权限。编辑/etc/sudoers 中的行，为该用户添加权限。为了便于更改，您可以简单地镜像与 root 用户相同的权限。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="271a" class="ok nj iq og b gy ol om l on oo"># User privilege specification</span><span id="2c3c" class="ok nj iq og b gy op om l on oo">root ALL=(ALL:ALL) ALL</span><span id="8b30" class="ok nj iq og b gy op om l on oo">&lt;username&gt; ALL=(ALL:ALL) ALL</span></pre><p id="c102" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">更改用户密码(duh)</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="bcbb" class="ok nj iq og b gy ol om l on oo">sudo passwd &lt;username&gt;</span></pre><p id="c487" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">以该用户身份登录，并在以该用户身份登录时执行剩余的步骤。</p><p id="12fa" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated">使用 rvm 安装 Ruby 2.6.3(以新用户身份登录)</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="6f63" class="ok nj iq og b gy ol om l on oo">$rvm install 2.6.3</span></pre><p id="ad7e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di"> S </span> <strong class="lh ja">步骤 4: </strong>克隆 hammer repo 并运行“捆绑安装”</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="f5a5" class="ok nj iq og b gy ol om l on oo">$git clone <a class="ae le" href="https://github.com/iknowjason/hammer" rel="noopener ugc nofollow" target="_blank">https://github.com/iknowjason/hammer</a><br/>$cd hammer<br/>$bundle install</span></pre><p id="e6d0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di"> S </span> <strong class="lh ja">第五步:</strong>编辑<strong class="lh ja"><em class="mr">config/database . yml</em></strong>中的数据库配置文件。</p><p id="92b6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">更改<strong class="lh ja"><em class="mr">&lt;DB _ PASSWORD&gt;</em></strong>的密码字段中的密码，以匹配您在步骤 1 中为 root 密码指定的密码。</p><p id="c109" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">运行 mysql 客户端连接 MySQL，更改权限。</strong>在&lt;密码&gt;中指定您在上面和步骤 1 中输入的相同密码。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="1982" class="ok nj iq og b gy ol om l on oo">$sudo mysql</span><span id="a3dc" class="ok nj iq og b gy op om l on oo">mysql&gt; ALTER USER ‘root’@’localhost’ IDENTIFIED WITH mysql_native_password BY ‘&lt;PASSWORD&gt;’;</span><span id="08c5" class="ok nj iq og b gy op om l on oo">mysql&gt; exit</span></pre><p id="37a3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">验证您现在可以作为 root 用户进行身份验证。在提示符下输入您的 root 密码:</strong></p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="9bac" class="ok nj iq og b gy ol om l on oo">$mysql -u root -p</span><span id="a362" class="ok nj iq og b gy op om l on oo">mysql&gt; exit</span></pre><p id="0d17" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated">用 rails 应用程序数据填充 MySQL 数据库。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="7115" class="ok nj iq og b gy ol om l on oo">$cd /home/&lt;username&gt;/hammer</span><span id="1493" class="ok nj iq og b gy op om l on oo">$rake db:create</span><span id="b649" class="ok nj iq og b gy op om l on oo">$rake db:migrate</span></pre><p id="97d9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated">安装最新的节点。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="e81d" class="ok nj iq og b gy ol om l on oo">$curl -sL <a class="ae le" href="https://deb.nodesource.com/setup" rel="noopener ugc nofollow" target="_blank">https://deb.nodesource.com/setup</a>_10.x -o nodesource_setup.sh</span><span id="6d4c" class="ok nj iq og b gy op om l on oo">$sudo bash nodesource_setup.sh</span><span id="3bd3" class="ok nj iq og b gy op om l on oo">$sudo apt install nodejs -y</span></pre><p id="433c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated">安装最新的 yarn，然后为这个应用程序实例重新构建页面。</p><p id="1ec8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">安装最新纱线:</strong></p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="728a" class="ok nj iq og b gy ol om l on oo">$curl -sS <a class="ae le" href="https://dl.yarnpkg.com/debian/pubkey.gpg" rel="noopener ugc nofollow" target="_blank">https://dl.yarnpkg.com/debian/pubkey.gpg</a> | sudo apt-key add -</span><span id="8dc2" class="ok nj iq og b gy op om l on oo">$echo 'deb <a class="ae le" href="https://dl.yarnpkg.com/debian/" rel="noopener ugc nofollow" target="_blank">https://dl.yarnpkg.com/debian/</a> stable main' | sudo tee /etc/apt/sources.list.d/yarn.list</span><span id="df39" class="ok nj iq og b gy op om l on oo">$sudo apt update &amp;&amp; sudo apt install yarn -y</span></pre><p id="d3e0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">运行 rake 命令编译页面:</strong></p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="80cb" class="ok nj iq og b gy ol om l on oo">$bundle exec rake assets:precompile</span><span id="5074" class="ok nj iq og b gy op om l on oo">$bundle exec rake webpacker:compile</span></pre><p id="fdcf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di">S</span>T38】步骤 9: 在默认端口 3000 上启动应用程序</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="1dde" class="ok nj iq og b gy ol om l on oo">$rails s -b 0.0.0.0</span></pre><p id="0917" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过使用浏览器检查默认页面来验证它是否正常工作— URL 为<strong class="lh ja"><em class="mr">http://&lt;IP&gt;:3000</em></strong>。</p><p id="fc24" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">确认页面没有任何错误。</strong>(表格将不显示数据)</p><p id="c518" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">http://<ip>:3000/用户</ip></p><p id="bbd2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">http://<ip>:3000/信用卡</ip></p><p id="f4d1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">您应该会在默认页面上看到:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi or"><img src="../Images/b75daf2b0337f1c4a59e03e935cab61f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*sIvC-5PwOcJzGSDC0oSE9w.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">默认页面</p></figure><p id="9533" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">您应该会在用户页面上看到:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi os"><img src="../Images/1d252dca04dcf159a0077294dcba4a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*4Wm4MNPDTnQ8W7ZSpa7weA.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">用户页面</p></figure><p id="3ad8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di"> S </span> <strong class="lh ja">步骤 10: </strong>用提供的 Python 脚本添加模拟用户和敏感信用卡数据。首先，通过输入&lt; CTRL-C &gt;来中断应用。</p><p id="1ce3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> <em class="mr">安装 python 模块:</em> </strong></p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="c334" class="ok nj iq og b gy ol om l on oo">$sudo apt-get install python3-pip -y</span><span id="9415" class="ok nj iq og b gy op om l on oo">$sudo python3 -m pip install Faker</span><span id="0172" class="ok nj iq og b gy op om l on oo">$sudo pip3 install pymysql</span></pre><p id="54c0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在应用程序的工作目录中，切换到 python_scripts 目录。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="5c14" class="ok nj iq og b gy ol om l on oo">$cd /home/&lt;username&gt;/hammer/python_scripts</span></pre><p id="e6aa" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">编辑<strong class="lh ja"> <em class="mr"> gen_users.py </em> </strong>和<strong class="lh ja"><em class="mr">gen _ credit data . py</em></strong>脚本。更改以下变量以匹配您在步骤 5 中指定的 MySQL DB 实例:</p><p id="b3d4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">数据库用户名</p><p id="b479" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">数据库密码</p><p id="de22" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">数据库名称</p><p id="43c8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">注意:</strong>如果使用了<strong class="lh ja"><em class="mr">config/database . yml</em></strong>中的默认值，那么 DB_NAME 应该是<strong class="lh ja"><em class="mr">rack vuln _ development</em></strong>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ot"><img src="../Images/e49b0b791e55034bb7f4f5ef5b71327c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iCaZjCZaXJtew0oQhwG6-w.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">修改 gen_creditdata.py 脚本的示例</p></figure><p id="fecf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">运行两个脚本:</strong></p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="4553" class="ok nj iq og b gy ol om l on oo">$./gen_users.py</span><span id="ade9" class="ok nj iq og b gy op om l on oo">$./gen_creditdata.py</span></pre><p id="89ab" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">变回 rails 应用程序的工作目录。再次启动应用程序。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="6d18" class="ok nj iq og b gy ol om l on oo">$cd /home/&lt;username&gt;/hammer</span><span id="9c5c" class="ok nj iq og b gy op om l on oo">$rails s -b 0.0.0.0</span></pre><p id="1e86" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">用你的浏览器验证你可以访问<strong class="lh ja"><em class="mr">/用户</em> </strong>和<strong class="lh ja"><em class="mr">/信用卡</em> </strong>的网址，这次他们渲染了一些数据！</p><p id="88f0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">http://<ip>:3000/用户</ip></p><p id="ec4d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">http://<ip>:3000/信用卡</ip></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ou"><img src="../Images/e98a8b3d8e1215c940c3a1ab5b29f01c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTrkDmCPnBhD5RHmllvp0g.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">用户页面现在的样子。</p></figure><p id="8058" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di"> S </span>为了获得更好的产品体验，您可以使用一个根 CA 颁发的 TLS 证书来提供应用程序，该证书托管在使用 Nginx 反向代理的域中。只有当您有域名和 DNS 记录解析到您的站点时，才能继续前进。为此，您可以使用 cloud Linux VPS 提供商(如 Digital Ocean 或 Linode)轻松创建一个新主机。</p><p id="8cf0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di">S</span><strong class="lh ja">step 12:</strong>安装 Nginx 用于反向代理和 TLS 隧道终止。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="96cd" class="ok nj iq og b gy ol om l on oo">$sudo apt install nginx -y</span></pre><p id="65c4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated">安装让我们加密证书机器人</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="60d9" class="ok nj iq og b gy ol om l on oo">$sudo add-apt-repository universe</span><span id="23b2" class="ok nj iq og b gy op om l on oo">$sudo add-apt-repository ppa:certbot/certbot</span><span id="e066" class="ok nj iq og b gy op om l on oo">$sudo apt-get update</span><span id="81f8" class="ok nj iq og b gy op om l on oo">$sudo apt-get install certbot python-certbot-nginx -y</span></pre><p id="5774" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di">S</span>S<strong class="lh ja">步骤 14 </strong>:运行 certbot 创建 TLS 证书</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="d4ba" class="ok nj iq og b gy ol om l on oo">$sudo certbot --nginx</span></pre><p id="7e68" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">回答问题:</strong></p><p id="c8c7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">您的电子邮件地址:<enter/></p><p id="83db" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">同意服务条款:</p><p id="cbd3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">愿意分享您的电子邮件:</p><p id="8d60" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">输入域名:<host.domain.com/></p><p id="806a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">注意:</strong>上面这个步骤很重要。确保 certbot 能够自动部署 TLS 证书。</p><p id="e95d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">重定向:(我总是选择“2”来启用重定向)</p><p id="108f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated">重新启动并验证 nginx</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="a8db" class="ok nj iq og b gy ol om l on oo">$sudo service nginx restart</span><span id="46a4" class="ok nj iq og b gy op om l on oo">$sudo service nginx status</span></pre><p id="223d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di"> S </span> <strong class="lh ja">步骤 16: </strong>编辑 nginx 配置，配置 Nginx 反向代理。这将配置 Nginx 将 TLS 终止的流量转发到运行在本地主机上的 Rails Puma 应用服务器。下面的配置应该与您的特定环境相匹配。</p><p id="527e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">编辑<strong class="lh ja"><em class="mr">/etc/nginx/sites-可用/默认</em> </strong></p><p id="89e8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">替换<strong class="lh ja"> <em class="mr"> server_name </em> </strong>和<strong class="lh ja"> <em class="mr"> root </em> </strong>指令，以匹配您的 FQDN 和您的 rails 应用程序的目录。更换<strong class="lh ja">主机</strong>和<strong class="lh ja">返回 301 </strong>参数，以匹配您的 FQDN。下面的例子可以作为一个模板，但需要根据您的环境进行修改。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="2b39" class="ok nj iq og b gy ol om l on oo">upstream app {</span><span id="399e" class="ok nj iq og b gy op om l on oo">    server 127.0.0.1:3000;</span><span id="9a6b" class="ok nj iq og b gy op om l on oo">}</span><span id="ee2d" class="ok nj iq og b gy op om l on oo">server {</span><span id="4f7a" class="ok nj iq og b gy op om l on oo">    server_name prod.rtcfingroup.com;</span><span id="5311" class="ok nj iq og b gy op om l on oo">    root /home/rails/hammer/public;</span><span id="bc6e" class="ok nj iq og b gy op om l on oo">    try_files $uri <a class="ae le" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>;</span><span id="ce42" class="ok nj iq og b gy op om l on oo">    location <a class="ae le" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a> {</span><span id="655f" class="ok nj iq og b gy op om l on oo">    proxy_pass <a class="ae le" href="http://app" rel="noopener ugc nofollow" target="_blank">http://app</a>;<br/>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br/>        proxy_set_header Host $http_host;<br/>        proxy_redirect off;<br/>    }</span><span id="d1af" class="ok nj iq og b gy op om l on oo">    error_page 500 502 503 504 /500.html;<br/>    client_max_body_size 4G;<br/>    keepalive_timeout 10;</span><span id="af23" class="ok nj iq og b gy op om l on oo">    listen 443 ssl;</span><span id="7428" class="ok nj iq og b gy op om l on oo">    if ($scheme != "https") {<br/>        return 301 <a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/$host$request_uri">https://$host$request_uri</a>;<br/>    }</span><span id="626c" class="ok nj iq og b gy op om l on oo">    ssl_certificate &lt;PATH&gt;<br/>    ssl_certificate_key &lt;PATH&gt;<br/>    include &lt;PATH&gt;<br/>    ssl_dhparam &lt;PATH&gt;</span><span id="7573" class="ok nj iq og b gy op om l on oo">}</span><span id="0a38" class="ok nj iq og b gy op om l on oo">server {<br/>    if ($host = prod.rtcfingroup.com) {<br/>        return 301 <a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/$host$request_uri">https://$host$request_uri</a>;<br/>    } </span><span id="e391" class="ok nj iq og b gy op om l on oo">    listen 80;<br/>    server_name prod.rtcfingroup.com</span><span id="2cfc" class="ok nj iq og b gy op om l on oo">    return 404; </span><span id="8545" class="ok nj iq og b gy op om l on oo">}</span></pre><p id="6cbb" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated">保存文件，重新启动 nginx 服务，并验证它正在运行</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="6dac" class="ok nj iq og b gy ol om l on oo">$sudo service nginx restart</span><span id="65e5" class="ok nj iq og b gy op om l on oo">$sudo service nginx status</span></pre><p id="e2c2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di"> S </span> <strong class="lh ja"> tep 18: </strong>启动 rails app 监听本地主机，端口 3000。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="ae12" class="ok nj iq og b gy ol om l on oo">$cd /home/&lt;username&gt;/hammer</span><span id="c19d" class="ok nj iq og b gy op om l on oo">$rails s</span></pre><p id="58d0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di"> S </span> <strong class="lh ja"> tep 19: </strong>浏览你的新 FQDN(即<a class="ae le" href="https://host.domain.com." rel="noopener ugc nofollow" target="_blank"> https://host.domain.com)验证一切正常。</a> Nginx 应该终止 TLS 连接，并重定向到监听端口 3000 的 Rails Puma 应用服务器！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/9510b83fae9187a34672756d75cc21c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1rtIOoAuJVT4U0jEta-zSA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">现在，您的 Rails 应用程序使用了 Nginx 反向代理！</p></figure></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="6002" class="ni nj iq bd nk nl nm nn no np nq nr ns kf nt kg nu ki nv kj nw kl nx km ny nz bi translated"><strong class="ak"> Docker 部署步骤</strong></h1><p id="6224" class="pw-post-body-paragraph lf lg iq lh b li oa ka lk ll ob kd ln lo oc lq lr ls od lu lv lw oe ly lz ma ij bi mb translated">获取 docker-compose</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="8ca8" class="ok nj iq og b gy ol om l on oo">$sudo apt-get update<br/>$sudo apt-get install docker-compose -y</span></pre><p id="af5c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di"> S </span> <strong class="lh ja">步骤 2: </strong>使用 git 获取回购</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="80a6" class="ok nj iq og b gy ol om l on oo">$git clone <a class="ae le" href="https://github.com/iknowjason/hammer.git" rel="noopener ugc nofollow" target="_blank">https://github.com/iknowjason/hammer.git</a></span></pre><p id="4f8f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di"> S </span> <strong class="lh ja">步骤 3: </strong>运行 docker-compose 命令来构建并启动容器</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="838f" class="ok nj iq og b gy ol om l on oo">$cd hammer</span><span id="5c7b" class="ok nj iq og b gy op om l on oo">$sudo docker-compose build</span><span id="ee71" class="ok nj iq og b gy op om l on oo">$sudo docker-compose up</span></pre><p id="5b2a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated">如果第一次尝试出现数据库错误，再次运行 docker-compose up。</p><pre class="kp kq kr ks gt of og oh oi aw oj bi"><span id="7016" class="ok nj iq og b gy ol om l on oo">$sudo docker-compose up</span></pre><p id="464f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated">使用浏览器导航到您主机上的端口 3000。</p><p id="de11" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">http:// <ip> :3000</ip></p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="84d3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我希望您喜欢构建这个脆弱的演示应用程序。在这个易受攻击的应用程序中，有许多有价值的经验教训可以借鉴。我欢迎任何评论、建议和合作。如果您有改进它的想法，或者是有想法的 Rails 开发人员，请联系我。今后还会有更多的经验教训。</p></div></div>    
</body>
</html>