<html>
<head>
<title>Integrating image and tabular data for deep learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">集成图像和表格数据用于深度学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/integrating-image-and-tabular-data-for-deep-learning-9281397c7318?source=collection_archive---------15-----------------------#2020-06-17">https://towardsdatascience.com/integrating-image-and-tabular-data-for-deep-learning-9281397c7318?source=collection_archive---------15-----------------------#2020-06-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7d58" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用fastai和image_tabular整合用于深度学习的图像和表格数据，并使用整合的数据训练联合模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/87db7cd5c56795933f3b73f84a84db42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*puJiMUSLFs-y84VkJath0A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">凯文·Ku在<a class="ae ky" href="/s/photos/machine-learning?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。由<a class="ae ky" href="https://www.iconfinder.com/ibrandify" rel="noopener ugc nofollow" target="_blank">设计的图标被美化</a>。</p></figure><p id="c638" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近在Kaggle上参加了<a class="ae ky" href="https://www.kaggle.com/c/siim-isic-melanoma-classification" rel="noopener ugc nofollow" target="_blank"> SIIM-ISIC黑色素瘤分类</a>竞赛。在这场比赛中，参与者被要求识别皮肤病变图像中的黑色素瘤。有趣的是，除了图像之外，它们还提供关于患者和解剖位置的元数据。本质上，对于每个示例，我们都有图像和结构化或表格数据。对于图像，我们可以使用基于CNN的模型，对于表格数据，我们可以使用嵌入和完全连接的层，正如我在以前关于UFC和英雄联盟预测的文章中所探讨的。很容易为每个数据形态建立两个独立的模型。但是，如果我们想建立一个联合模型，同时训练两种数据形态呢？比赛论坛里有鼓舞人心的讨论包括这个<a class="ae ky" href="https://www.kaggle.com/c/siim-isic-melanoma-classification/discussion/155251" rel="noopener ugc nofollow" target="_blank">的帖子</a>。在这篇文章中，我将演示如何集成这两种数据模式，并使用fastai和我专门为这些任务创建的<a class="ae ky" href="https://github.com/naity/image_tabular" rel="noopener ugc nofollow" target="_blank"> image_tabular </a>库来训练一个联合深度学习模型。</p><h1 id="b900" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">SIIM-国际标准行业分类数据集</h1><p id="d8d2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">SIIM-ISIC黑色素瘤分类数据集可以在这里下载<a class="ae ky" href="https://www.kaggle.com/c/siim-isic-melanoma-classification/data" rel="noopener ugc nofollow" target="_blank">。训练集由32542幅良性图像和584幅恶性黑色素瘤图像组成。请注意，这个数据集极度不平衡。下图显示了每个班级的一个例子。恶性病变似乎比良性病变更大、更弥散。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/ed0deccbd23cd9bed137d8dd9e1e4eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*OQBLi2GVxkxRIUaIk3rStg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">良性对恶性</p></figure><p id="674c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所述，除了图像之外，还有如下所示的元数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/a2b23ebbf6b6c0697b57f819b8a83f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_U-UKmXOrQ3anEqHFb_Org.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作为熊猫数据框架的元数据</p></figure><p id="b65e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以执行一些基本分析来调查这些特征中的一些是否与目标相关联。有趣的是，男性比女性更容易患恶性黑色素瘤，年龄似乎也是患恶性黑色素瘤的一个风险因素，如下图所示。此外，恶性黑色素瘤的频率在成像部位的位置之间不同，其中头/颈显示最高的恶性率。因此，这些特征包含有用的信息，将它们与图像结合可以帮助我们的模型做出更好的预测。这是有意义的，因为医生可能不仅会检查皮肤病变的图像，还会考虑其他因素以做出诊断。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/f9755f78ef7bca935b20fd1d1a4048e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2M1sxDvuaPMbkKswHHEiKQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">元数据特征与目标相关联</p></figure><h1 id="028c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">方法</h1><p id="683e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们整合图像和表格数据的方法与ISIC 2019皮肤病变分类挑战赛获胜者采用的方法非常相似，正如他们在<a class="ae ky" href="https://www.sciencedirect.com/science/article/pii/S2215016120300832" rel="noopener ugc nofollow" target="_blank">论文</a>中所述，如下图所示。基本上，我们首先加载每个样本的图像和表格数据，分别输入CNN模型和完全连接的神经网络。随后，这两个网络的输出将被连接起来，并输入到另一个完全连接的神经网络中，以生成最终预测。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/ac008e8872168547a48ee6b4a20c0a74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ukR4oVGkNxjiv7tV7sGB_Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">名词（noun的缩写）Gessert，M. Nielsen和M. Shaikh等人/ MethodsX 7 (2020) 100864</p></figure><h1 id="dd81" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用image_tabular库实现</h1><p id="37e6" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了实现这个想法，我们将使用Pytorch和<a class="ae ky" href="https://github.com/fastai/fastai" rel="noopener ugc nofollow" target="_blank"> fastai </a>。更具体地说，我们将使用fastai加载图像和表格数据，并将它们打包到fastai LabelLists中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="03e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将使用<a class="ae ky" href="https://github.com/naity/image_tabular" rel="noopener ugc nofollow" target="_blank"> image_tabular </a>库集成这两种数据形态，可以通过运行以下命令来安装:</p><pre class="kj kk kl km gt my mz na nb aw nc bi"><span id="da6a" class="nd lw it mz b gy ne nf l ng nh">pip install image_tabular</span></pre><p id="0c9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用来自<a class="ae ky" href="https://github.com/naity/image_tabular" rel="noopener ugc nofollow" target="_blank"> image_tabular </a>的<code class="fe ni nj nk mz b">get_imagetabdatasets</code>函数来集成图像和表格标签。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="0123" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">databunch包含图像和表格数据，可用于训练和预测。</p><p id="cde9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦数据准备就绪，我们就可以继续构建模型了。首先，我们需要创建一个CNN模型，在本例中是resnet50，并使用fastai创建一个表格模型。我们将性别和解剖位置视为分类特征，并在表格模型中使用<a class="ae ky" href="https://medium.com/@yuan_tian/predicting-league-of-legends-match-outcome-with-embeddings-and-deep-learning-b7d1446c710f" rel="noopener">嵌入</a>来表示它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="a401" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在准备构建一个联合模型，再次使用<a class="ae ky" href="https://github.com/naity/image_tabular" rel="noopener ugc nofollow" target="_blank"> image_tabular </a>库。我们可以通过指定layers参数来自定义完全连接的层。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="771a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以把所有东西打包成一个fastai学习器，训练联合模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6096" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整个工作流程都详细记录在这个Jupyter <a class="ae ky" href="https://github.com/naity/image_tabular/blob/master/siim_isic_integrated_model.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>里。</p><h1 id="a4b5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结果</h1><p id="4811" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在训练15个时期后，该模型在验证集上获得了约0.87的ROC AUC分数。我随后将训练好的模型在测试集上做出的预测提交给Kaggle，得到了0.864的公开分数。肯定有很大的提升空间。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/8830cdf706624426a8bf791fcfc82d07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S2weYxd9XrP7XzcvsDr-cQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Kaggle公共评分</p></figure><h1 id="50d4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">摘要</h1><p id="32bb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在本文中，我们使用fastai和image_tabular来集成图像和表格数据，并构建了一个同时在两种数据模式上训练的联合模型。如上所述，有许多进一步改进的机会。比如可以尝试更高级的CNN架构比如ResNeXt。另一个问题是，在连接之前，我们应该为图像和表格数据分配多少神经元，换句话说，我们应该如何决定这两种数据形式的相对重要性或权重？我希望这可以作为进一步试验和改进的框架。</p><h1 id="2981" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">源代码</h1><p id="cbab" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">SIIM-ISIC黑色素瘤分类竞赛的image_tabular和jupyter笔记本的源代码可以在<a class="ae ky" href="https://github.com/naity/image_tabular" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="049b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">感谢</h1><p id="eb6d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/naity/image_tabular" rel="noopener ugc nofollow" target="_blank"> image_tabular </a>库依赖于神奇的<a class="ae ky" href="https://github.com/fastai/fastai" rel="noopener ugc nofollow" target="_blank"> fastai </a>库，并受到John F. Wu的<a class="ae ky" href="https://gist.github.com/jwuphysics/f19162d38e1b4fed0030b96411186c3a" rel="noopener ugc nofollow" target="_blank">代码</a>的启发。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="d4c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我是一名具有生物信息学和编程技能的免疫学家。我对数据分析、机器学习和深度学习感兴趣。</p><p id="1bf8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">网址:<a class="ae ky" href="http://www.ytian.me/" rel="noopener ugc nofollow" target="_blank"> www.ytian.me </a> <br/>博客:<a class="ae ky" href="https://medium.com/@yuan_tian" rel="noopener">https://medium.com/@yuan_tian</a>T5】领英:<a class="ae ky" href="https://www.linkedin.com/in/ytianimmune/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/ytianimmune/</a>T8】推特:<a class="ae ky" href="https://twitter.com/_ytian_" rel="noopener ugc nofollow" target="_blank">https://twitter.com/_ytian_</a></p></div></div>    
</body>
</html>