<html>
<head>
<title>Scraping Live Traffic Data in 3 Lines of Code, Step-by-Step</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用3行代码一步一步地抓取实时交通数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scraping-live-traffic-data-in-3-lines-of-code-step-by-step-9b2cc7ddf31f?source=collection_archive---------9-----------------------#2020-04-18">https://towardsdatascience.com/scraping-live-traffic-data-in-3-lines-of-code-step-by-step-9b2cc7ddf31f?source=collection_archive---------9-----------------------#2020-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3ae4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何用最少的代码在python中web抓取实时更新的图表。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/22f88899198ebb14b46260fe1745ddb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I82MvWI7Sfdyx2c8szbScw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:TomTom。</p></figure><p id="0da7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">鉴于最近的疫情，决策者实施的封锁措施已经停止了大部分经济活动。由于经济数据的滞后性，在数据中衡量消费者的实时行为并不总是容易的。事实上，数据往往至少有一个月的时滞，因此很难评估人们是否真的在四处走动。因此，政府、科学家和经济学家等一直在关注<strong class="kx ir">高频数据</strong>，这些数据提供了自限制实施以来全球经济运动如何变化的实时视图。TomTom提供的流量数据是衡量活动进展的一个流行指标。该数据涵盖57个国家的416个城市，并计算整个道路网络上所有车辆的行驶时间。在TomTom的网站上，平均拥堵程度以实时交通图的形式显示。我选择了米兰:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lr"><img src="../Images/8854f0cd688a247f56d325ea5e35d885.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q9TICpSr9uK1z8_JL4264A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">米兰TomTom交通指数。来源:<a class="ae ls" href="https://www.tomtom.com/en_gb/traffic-index/milan-traffic/" rel="noopener ugc nofollow" target="_blank">汤姆汤姆。</a></p></figure><p id="2e25" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以将鼠标悬停在图表上以获得每个单独的数据点，但无法从网站上下载数据。所以有两个选择:</p><ol class=""><li id="a69a" class="lt lu iq kx b ky kz lb lc le lv li lw lm lx lq ly lz ma mb bi translated"><strong class="kx ir">花</strong> <strong class="kx ir">个小时</strong>悬停在每个点上，记录每个数值…</li><li id="544d" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">刮吧！</li></ol><p id="d245" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">检查数据</strong></p><p id="61bc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在任何网站上，网站在加载页面时都会加载一系列不同的信息，这是很常见的。这可能包括cookies、数据文件、图像等等。我们可以通过<strong class="kx ir">检查</strong>页面来了解内幕。在Chrome中，按下'<strong class="kx ir"> Ctrl+shift+I '就可以轻松做到这一点。</strong>将出现一个窗口，显示已加载到页面中的所有数据。我们想要的选项卡是弹出窗口顶部显示的<em class="mh">网络</em>选项卡。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/71117eb3bca72210a55da75010477158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXpKhAGR0VeAvHf2Dp34aQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">检查TomTom米兰交通网页。</p></figure><p id="791a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你看不到所有的数据，点击'<strong class="kx ir"> Ctrl+R' </strong>,重新加载页面，观察所有数据的加载。在<em class="mh">名称</em>选项卡上，你会看到许多不同的文件类型:<em class="mh">。js，。json，。svg，。otf </em>等等。那么我们如何知道哪一个包含我们图表的底层数据呢？首先，我们需要通过<em class="mh"> XHR </em> 进行<strong class="kx ir">过滤。这是<em class="mh"> XML HTTP请求</em>的简称。使用这种格式载入网页上的数据是很常见的。然后我们可以按大小<strong class="kx ir">过滤</strong>——底层数据通常是页面中包含的最大文件之一(可能以千字节而不是字节为单位)。最后，通常情况下，源数据会以<em class="mh">的形式出现。json </em>文件。这代表了<em class="mh"> Javascript对象符号</em>，这是存储大量数据的常用方式。</strong></p><p id="f3fa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，查看我们的数据集，并不能立即看出<em class="mh"> json </em>文件在哪里。下一步，让我们看看<em class="mh">型</em>柱。因为我们已经通过<em class="mh"> xhr </em>进行了过滤，所以我们应该在这个列中只看到<em class="mh"> xhr </em>类型。说到这里，我们顺着栏目往下看，可以看到<strong class="kx ir">既</strong> <em class="mh"> xhr </em> <strong class="kx ir">又</strong> <em class="mh"> fetch </em>。<em class="mh">获取</em>类型意味着该数据从API或<em class="mh">自动处理接口加载。</em>用<em class="mh">获取</em>类型查看数据，这个特定对象的文件名是<em class="mh">“ITA _ Milan”。</em> <strong class="kx ir">看来我们已经得到了我们的数据！</strong>我们可以通过在新标签中打开它来检查它是否正确。当我们打开新选项卡时，我们看到这确实是我们想要的数据，在链接下面:<a class="ae ls" href="https://api.midway.tomtom.com/ranking/live/ITA_milan" rel="noopener ugc nofollow" target="_blank"><em class="mh">【https://api.midway.tomtom.com/ranking/live/ITA_milan】</em></a><em class="mh">，</em>这是从API <em class="mh">中检索的。</em>太好了——现在让我们将这些数据加载到python中，并开始清理它们以复制实时图表。</p><p id="6141" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">检索和清理数据</strong></p><p id="fe7c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，<em class="mh">请求</em>是我们将用来加载数据的模块。在我们之前找到的url上使用requests.get()，我们可以将该文件显示为一个<em class="mh"> json </em>，并使用python中的<em class="mh"> json </em>模块对其进行解包(是的，只使用了三行代码):</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="edea" class="mo mp iq mk b gy mq mr l ms mt">%matplotlib inline<br/>import matplotlib.pyplot as plt<br/>import pandas as pd<br/>import json<br/>import requests</span><span id="1a19" class="mo mp iq mk b gy mu mr l ms mt"># retrieve json file<br/>url_ = "<a class="ae ls" href="https://api.midway.tomtom.com/ranking/live/ITA_milan" rel="noopener ugc nofollow" target="_blank">https://api.midway.tomtom.com/ranking/live/ITA_milan</a>"<br/>italy_req = requests.get(url)<br/>italy_json = italy_req.json()</span></pre><p id="f030" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这为我们提供了以下输出:</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="cdff" class="mo mp iq mk b gy mq mr l ms mt">{'data': [{'JamsDelay': 13.5,</span><span id="6759" class="mo mp iq mk b gy mu mr l ms mt">'TrafficIndexLive': 6,</span><span id="749e" class="mo mp iq mk b gy mu mr l ms mt">'TrafficIndexHistoric': 17,</span><span id="d9d0" class="mo mp iq mk b gy mu mr l ms mt">'UpdateTime': 1586608290000,</span><span id="ae25" class="mo mp iq mk b gy mu mr l ms mt">'JamsLength': 1.4,</span><span id="9521" class="mo mp iq mk b gy mu mr l ms mt">'JamsCount': 4},</span><span id="3672" class="mo mp iq mk b gy mu mr l ms mt">{'JamsDelay': 4.2,</span><span id="c970" class="mo mp iq mk b gy mu mr l ms mt">'TrafficIndexLive': 6,</span><span id="9db4" class="mo mp iq mk b gy mu mr l ms mt">'TrafficIndexHistoric': 17,</span><span id="f7bd" class="mo mp iq mk b gy mu mr l ms mt">'UpdateTime': 1586609190000,</span><span id="c400" class="mo mp iq mk b gy mu mr l ms mt">'JamsLength': 0.4,</span><span id="153b" class="mo mp iq mk b gy mu mr l ms mt">'JamsCount': 2},</span><span id="b531" class="mo mp iq mk b gy mu mr l ms mt">{'JamsDelay': 5.8,</span><span id="9293" class="mo mp iq mk b gy mu mr l ms mt">'TrafficIndexLive': 6,</span><span id="08b7" class="mo mp iq mk b gy mu mr l ms mt">'TrafficIndexHistoric': 18,</span><span id="fb22" class="mo mp iq mk b gy mu mr l ms mt">'UpdateTime': 1586610090000,</span><span id="cf8b" class="mo mp iq mk b gy mu mr l ms mt">'JamsLength': 0.4,</span><span id="5946" class="mo mp iq mk b gy mu mr l ms mt">'JamsCount': 2},</span></pre><p id="704d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个文件可能看起来有点混乱，有很多不同的标点和括号。它比看起来简单——<em class="mh">JSON</em>文件实际上是一个名为<em class="mh">‘数据’</em>的字典，其中包含一个字典列表。所以为了得到我们想要的信息。(“Time”和“TrafficIndexLive”)，我们要调用每个想要检索的点的键。例如，要获得实时流量指数的第一个值，我们需要输入以下内容:</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="4c94" class="mo mp iq mk b gy mq mr l ms mt">italy_json["data"][0]["TrafficIndexLive"]</span></pre><p id="053a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我们可以将字典中的每个条目添加到一个列表中，将每个列表转换为熊猫数据帧中的一列:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/82b810c6861b3f650bc5c5a64f5fb4c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*_Msd6rLOIrHFTjPJAllLkQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">实时交通数据帧。</p></figure><p id="380c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用字典和一点点数据清理，我们已经做到了！让我们通过绘制图表来验证数据是否与实时图表相匹配:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/183d38594f4ba449546aa4129dd4b70c.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*RPBTPRNK7TP4Bqd9n6ye3A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">米兰实时交通。</p></figure><p id="92f2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们做到了！在几行代码中，我们能够从一个图表中检索数据，否则我们无法访问这些数据。原来他们说的是真的:看得见就刮！</p><p id="5227" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> <em class="mh">感谢阅读！</em> </strong> <em class="mh">如果您有任何见解，请随时发表评论。包含我用来做这个项目的源代码的完整Jupyter笔记本可以在我的</em> <a class="ae ls" href="https://github.com/nathanwilthomas/tomtom_live_traffic_scrape" rel="noopener ugc nofollow" target="_blank"> <em class="mh"> Github资源库中找到。</em>T13】</a></p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="cb65" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">参考资料:</p><p id="b5ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">[1] TomTom，2020。《米兰交通报道<em class="mh">》</em>。可在:<a class="ae ls" href="https://www.tomtom.com/en_gb/traffic-index/milan-traffic/" rel="noopener ugc nofollow" target="_blank">https://www.tomtom.com/en_gb/traffic-index/milan-traffic/</a></p><p id="5474" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="mh">免责声明:本文表达的所有观点均为本人观点，与</em> <strong class="kx ir"> <em class="mh">和</em> </strong> <em class="mh">先锋或任何其他金融实体没有任何关联。我不是一个交易者，也没有用本文中的方法赚钱。这不是财务建议。</em></p></div></div>    
</body>
</html>