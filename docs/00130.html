<html>
<head>
<title>Urban water inlet features image segmentation from EagleView aerial imagery using Mask-RCNN/Keras/ArcGIS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Mask-RCNN/Keras/ArcGIS 从 EagleView 航空影像中分割城市入水口特征影像</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/urban-water-inlet-features-detection-from-eagleview-aerial-imagery-using-mask-r-cnn-keras-arcgis-fd3f2ae062bf?source=collection_archive---------22-----------------------#2020-01-04">https://towardsdatascience.com/urban-water-inlet-features-detection-from-eagleview-aerial-imagery-using-mask-r-cnn-keras-arcgis-fd3f2ae062bf?source=collection_archive---------22-----------------------#2020-01-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="c6aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">一个很有前景的深度学习实践</em></p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><p id="2d6e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我上一篇<a class="ae kw" rel="noopener" target="_blank" href="/eagleview-super-high-resolution-image-segmentation-with-deeplabv3-mask-rcnn-using-keras-arcgis-9be08caac42c"> <strong class="js iu">博客</strong> </a>中，我谈到了使用 Mask R-CNN 和 deepLabV3+模型，使用 EagleView 超高分辨率影像对建筑物足迹进行图像分割。尽管这两种深度学习模型的输出通常是有希望的，但它们仍然缺少一定的准确性阈值。这是为什么呢？因为地面实况标签的 GIS 数据没有被任何人验证，所以许多地面实况标签或者不准确或者错过了实际的真实对象描绘，这可能潜在地混淆模型分类器。我的好奇心:如果我验证每个地面真实标签并尽可能精确地描绘每个特征，结果会更好、更有希望吗？输出的统计数据是什么，比如训练模型预测的精度和召回率？该模型的预测能否应用于实际工作中，以节省人类数字化仪潜在的耗时工作？</p><p id="2d9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这次我选择入水口作为使用 Mask R-CNN 的训练模型的目标。寻找进水口特征的训练图像提出了几个挑战。进水口遵循一般的椭圆形和三角形模式，但由于多年的环境风化，颜色方案变化很大，有时甚至很难在航空图像上用肉眼发现。模型必须学会不被道路和房屋特征所迷惑，这些特征可以描绘出表面上相似的模式和形状。</p><p id="af33" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了测试实验并更好地理解模型输出，我亲自在 1 x 1 mile EagleView (Pictometry ) 3 英寸分辨率航空影像(图 1 和图 2)的一个图块顶部确定了 178 个进水口要素(基于之前供应商数字化的要素),并使用 ESRI 的 ArcGIS 软件将每个要素数字化为多边形要素，以获得地面实况标签。在用掩模 R-CNN 训练深度神经网络以从瓦片图像中识别入水口特征之后，将 1×1 英里瓦片图像的另一不同位置馈送给训练的模型，以查看该模型是否能够发现数字化仪遗漏的图像中的入水口特征。该过程产生了更好的结果，因为模型发现了更多人类数字化仪没有注意到或错过的进水口特征。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kx"><img src="../Images/e6d007c58b471766742523b9b62b85de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LjdWhzxgiHQ766ovuHJsiA.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 1:用于训练数据的红色轮廓瓦片图像和用于推断的蓝色轮廓瓦片图像。</p></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ln"><img src="../Images/a470d9990511e3cefda6c0bd130657a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vWJyIa0yyCJgRwaxzEzQ_A.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 2:用于训练的 20，000×20，000×3 RGB 波段的放大图像。</p></figure><p id="eab8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="ko">用 Mask-RCNN 模型训练:</em> </strong></p><p id="21c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Mask R-CNN 是一种先进的深度神经网络，用于解决机器学习中的实例分割问题。Mask-RCNN 有效地检测图像中的对象，同时为每个实例生成高质量的分割掩模。该方法通过与用于边界框识别的现有分支并行地添加用于预测对象遮罩的分支来扩展更快的 R-CNN。可以阅读<a class="ae kw" href="https://arxiv.org/abs/1703.06870" rel="noopener ugc nofollow" target="_blank">研究论文</a>更好的理解模型(图 3)。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/617ef2dbbe70b58da920f8231a3f698f.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/0*KdaYq_CJMWf4jcAP.jpeg"/></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 3:用于实例分割的掩模 R-CNN 框架。来源:https://arxiv.org/abs/1703.06870<a class="ae kw" href="https://arxiv.org/abs/1703.06870" rel="noopener ugc nofollow" target="_blank"/></p></figure><p id="062b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ArcGIS Pro 中的<a class="ae kw" href="http://pro.arcgis.com/en/pro-app/tool-reference/spatial-analyst/export-training-data-for-deep-learning.htm" rel="noopener ugc nofollow" target="_blank">【导出深度学习的训练数据】</a>用于导出瓷砖图像和进水口多边形特征，例如分割数据集(图 4)。输出图像的尺寸为 512x512x3，旋转角度设置为 90 度，以生成更多的图像来防止过度拟合，并帮助模型更好地概化。您可以应用传统的图像增强方法来生成更多的模拟图像，您可以在这里参考<strong class="js iu">I</strong><a class="ae kw" href="https://github.com/aleju/imgaug" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">mgaug</strong></a>Python 库。对于这个实验，我跳过了增强技术，因为裁剪图像的旋转确实生成了一些增强训练数据集。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lp"><img src="../Images/6130721c37ad9bfad47c87ddd989f800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CCBAtJoeeTUOu8HOX5U7cQ.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 4:进水口多边形特征(红色)覆盖用于生成训练数据集的图像</p></figure><p id="c5ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">生成的训练数据集包含超过 1800 个图像和标签。通过进一步的数据处理以去除没有标记的图像，最终数据集具有超过 1764 个训练图像和标记。我用 32 GB CPU 的戴尔笔记本来训练模型。这是一个相当小的数据集，用于训练深度神经网络从航空图像中提取城市特征。对于应用迁移学习，我从在 ImageNet 数据集上训练的权重文件开始。虽然 ImageNet 数据集不包括进水口类，但它包括许多其他类型的图像，因此经过训练的权重已经学习了许多自然图像中常见的特征，这有助于训练模型。</p><p id="6267" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我使用了令人印象深刻的开源实现<a class="ae kw" href="https://github.com/matterport/mask_rcnn" rel="noopener ugc nofollow" target="_blank"> Mask-RCNN 库</a>，MatterPort 在 Github <a class="ae kw" href="https://github.com/matterport/Mask_RCNN" rel="noopener ugc nofollow" target="_blank">上构建了这个库</a>来训练这个模型。</p><p id="940f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">需要在类(Utils.dataset)中修改三个主要函数，以将您自己的数据集加载到框架中。参见下面的数据加载实现(图 5)。锚的比率设置为(16，32，64，128，256)以预测进水口特征的较小尺寸。IMAGES_PER_GPU 设置为=1，因此 CPU 可用于训练模型。图像和遮罩的示例(图 6)。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lq"><img src="../Images/5be3aa34af22abdcda8a6b63479c072f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v8IMPcPY3cAKNVWvTg1-Dg.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 5 将训练图像和标签加载到模型</p></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lr"><img src="../Images/793fc0e90eb66ad9fcd8dc939ecb5d61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aaisApKmucZgXSIXE5Hpxw.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 6:用于训练的随机图像和标签掩模</p></figure><p id="9faa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">迁移学习技术应用于主干网 ResNet-101 模型。我首先用 8 个历元训练最后完全连接的层，以适应进水口要素类，然后用 100 个历元训练整个网络(图 7)</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ls"><img src="../Images/4d4fe066f853135d11c29754ec0d0a63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ickcMQKPHmRHLmhpHemKZQ.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 7:训练头部层以适应进水口特征</p></figure><p id="ca6b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于 32gb 的 CPU，完成训练过程需要 5 天以上的时间(图 8)。图表显示在特定时期后验证数据集的丢失达到稳定状态。当您的训练数据集很小时，这通常会作为过度拟合而发生。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lt"><img src="../Images/fe98f8e7b8f7e03916e792fa20b21e25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NCZAvrtLYoYw3519PcAkwg.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 8:训练全网络层 5 天 18 小时</p></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lu"><img src="../Images/97b48de7cfcb98f66d816807cce2b514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7KYwTw5LM0yNpBR1kRvPDw.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 9:培训损失图表</p></figure><p id="ffa4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是一个不在训练集中的测试图像，在数字化多边形中有一个进水口特征未被识别(图 10)</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lv"><img src="../Images/3b2193c8d0590e255fa5214a3d7ca3fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g6yNe1RXsKKIGSV6XY5u7g.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 10:具有人类数字化仪的遗漏检测的测试图像和标签</p></figure><p id="c094" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从上图推断的进水口特征进行比较。有趣的是，通过推理发现了一个缺失的进水口特征。(图 11)</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lw"><img src="../Images/ca9cbc86b76688ca9cc4ca4bb2be7c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hHFaG09sQXo5H-naInWZbQ.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 11:根据上图推断，确定了缺失的进水口特征。</p></figure><p id="d267" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">带有推论的测试图像的另一个例子(图 12 和图 13)。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lx"><img src="../Images/4f4d717a4a953c69fcc0a4da6d8e658b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UY3Q5cIqqv8NZwZqbSPFvw.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 12:测试图像</p></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/7718099e7feb75d12fd6cb7076055faa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*xycAa30TiXJDQo3P25C4Mg.jpeg"/></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 13:从上面的测试图像推断。</p></figure><p id="0224" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，我使用一个 20，000 x 20，000 x 3 尺寸的完整 2019 分块图像运行 python 推理脚本，该图像距离训练中使用的分块图像有 3 英里远(图 14)。脚本裁剪并处理 1600 张(512x512x3 dim)图像以进行推理。使用 32GB 内存的 CPU 笔记本电脑完成这个过程大约需要一个小时。缺少进水口轮廓主要是因为使用了非常小的训练数据集和进水口要素顶部的树木覆盖。从该县的不同位置选择几个有代表性的切片作为训练数据集可以提高结果的准确性。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lz"><img src="../Images/b66aea8c29ab8b8c159998bb8b123b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0HVdl_yPatf3gWFiZR74A.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 14:等于 1600 (512x512x1)个裁剪栅格的完整切片图像推断</p></figure><p id="8672" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我想使用统计精度和召回来衡量输出性能。对于那些不熟悉这些术语的人，这里有一些基本的:</p><p id="48f4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">精度:</strong>由模型分类的所有正例中真正正例的比例</p><p id="6de1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">召回:</strong>分类模型实际检索到的正例总数的分数。</p><p id="be45" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">随着二进制交叉熵置信度的阈值设置为≥0.9，该模型在 1 平方英里的推理瓦片范围内选择了 271 个候选者。然后，我手动审查候选人，选择最有希望的一个，并在航空图像中确认了 194 个。精度为 71.58%。召回率为 70.78%。当置信度阈值设置为≥0.75 时，精度下降到 53.98%。但召回率高达 78.11%，这意味着更多的进水口被正确识别，也有许多错误检测的进水口特征。根据项目的不同，我们更有可能最大化召回以检索更多的进水口特征，然后快速处理以手动消除误报。下面是与航空影像叠加的推理进水口要素的放大图(图 15)。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ma"><img src="../Images/644b303534486f25229919e76f6159ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S1P_ALpR-YYjSB0YOoxkVA.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图 15:推断:假阳性例子和阳性进水口特征(红色)</p></figure><p id="cb54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="ko">结论:</em> </strong></p><p id="5970" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然它是一个相对非常小的数据集，但 Mask-RCNN 使用迁移学习技术为超高分辨率图像分割提供了有希望的结果。通过增加来自该县不同位置的高质量训练数据集和应用数据变化增强方法，可以进一步增强性能的结果。还可以在多年影像中使用该模型来推断用于比较的要素检测，甚至可以使用 ArcGIS 工具模型构建器或任何开源代码进行低成本的要素描绘，以实现业务任务的自动化。更重要的是，上述深度学习训练过程可以应用于其他类型的图像实例或分割案例。综上所述，我要提一个有趣的事实:当我将置信度≥0.75 的结果与 vendor 在推理瓦片上数字化的多边形特征进行比较时。该模型描绘的入水口特征比人类数字化仪描绘的多 67 个，但遗漏了 45 个人类数字化入水口特征。这让我相信，如果我们应用正确的深度学习模型，并且做得正确，ML 或深度学习可以在实际的现实世界项目中使用，并为用户节省大量时间，并创造全新的体验。</p><p id="41b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko"> 1。</em> <a class="ae kw" href="https://arxiv.org/search/cs?searchtype=author&amp;query=He%2C+K" rel="noopener ugc nofollow" target="_blank">【明凯】何</a>，<a class="ae kw" href="https://arxiv.org/search/cs?searchtype=author&amp;query=Gkioxari%2C+G" rel="noopener ugc nofollow" target="_blank">乔治亚·格基奥萨里</a>，<a class="ae kw" href="https://arxiv.org/search/cs?searchtype=author&amp;query=Doll%C3%A1r%2C+P" rel="noopener ugc nofollow" target="_blank">彼得·多拉尔</a>，<a class="ae kw" href="https://arxiv.org/search/cs?searchtype=author&amp;query=Girshick%2C+R" rel="noopener ugc nofollow" target="_blank">罗斯·吉尔希克</a> (2018)。Mask-RCNN <em class="ko">，</em><a class="ae kw" href="https://arxiv.org/abs/1703.06870v3" rel="noopener ugc nofollow" target="_blank"><em class="ko">https://arxiv.org/abs/1703.06870v3</em></a></p><p id="c332" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko"> 2。</em>面具 R-CNN<a class="ae kw" href="https://github.com/matterport/Mask_RCNN" rel="noopener ugc nofollow" target="_blank">T19】https://github.com/matterport/Mask_RCNNT21】</a></p><p id="b19c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko"> 3。</em> U-Net:用于生物医学图像分割的卷积网络<a class="ae kw" href="https://lmb.informatik.uni-freiburg.de/people/ronneber/u-net/" rel="noopener ugc nofollow" target="_blank"><em class="ko">:https//lmb . informatik . uni-freiburg . de/people/Ron neber/U-Net/</em></a></p><p id="704c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko"> 4。【T29<a class="ae kw" href="http://pro.arcgis.com/en/pro-app/tool-reference/image-analyst/export-training-data-for-deep-learning.htm" rel="noopener ugc nofollow" target="_blank"><em class="ko">http://pro . ArcGIS . com/en/pro-app/tool-reference/image-analyst/export-training-data-for-deep-learning . htm</em></a></em></p></div></div>    
</body>
</html>