<html>
<head>
<title>Dask vs Vaex: Experience of a Data Point in Large Data Processing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dask 与 Vaex:大型数据处理中数据点的经验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dask-vs-vaex-experience-of-a-data-point-on-large-data-processing-ca157b81846e?source=collection_archive---------39-----------------------#2020-09-06">https://towardsdatascience.com/dask-vs-vaex-experience-of-a-data-point-on-large-data-processing-ca157b81846e?source=collection_archive---------39-----------------------#2020-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="de52" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">需要处理十亿行数据？我来和大家分享一下我使用 Dask 和 Vaex 的经验。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/288771d685b3a4bdc385d72bc0d8a5b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XVebYBxHUl1zztUApTDVOg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">嗨，我是数据 N！</p></figure><p id="27b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你好。很高兴见到你！😄我是 Data N(你可以叫我 N)，今天，我想分享我作为 data point 与我的新经理 Dask 和 Vaex 一起工作的经验，以及一些与他们建立良好工作关系的技巧(*wink*)。</p><h1 id="7d7a" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">背景故事</h1><p id="2a38" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">背景故事是这样的…最近，我们公司有一个小的重组和我们的前经理，熊猫🐼，由两名新员工接管。官方给出的原因是熊猫转移到了新的机会，但我们所有内部人士都知道发生了什么。</p><p id="9abd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">嗯，事实是高层管理人员对熊猫最近的表现不满意。我们公司发展迅速，业务呈指数增长。熊猫最初做得很好，但逐渐发现自己无法应对不断增加的数据。当满载美国数据的卡车到达时，我们被证明对熊猫来说太多了。通常，我们会坐在一个名为硬盘的大型仓库中，但当我们需要处理时，有一个名为随机存取存储器(又名 RAM)的临时存储室，我们将被运送到那里进行进一步处理。问题就在这里:RAM 中没有足够的空间容纳我们所有人。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/a9b7ce56cd8976b43decc3b12ab08fdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iagp-pLZZPftuf1DP_XtmQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">RAM 里没有足够的空间容纳我们所有的人</p></figure><p id="7bef" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以我们的猜测是，高层管理人员决定用 Dask 和 Vaex 替换 Pandas，以便进一步发展公司。这很可悲，但这只是生意。</p><h1 id="586c" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">介绍 Dask 和 Vaex…</h1><p id="703d" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">自从两个新经理来了，他们每个人都部署了一个独特的伎俩来对付我们。</p><p id="deb8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用 Dask，我们被分成组(或者用他的话说，“分区”)，并且一次处理一个到几个组。</p><p id="84ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有了 Vaex，我们每个人都提供了我们在仓库中的地址，当 Vaex 需要我们时，她会根据我们的地址调用那些需要来 RAM 的人(她将这种技术称为“内存映射”)。</p><p id="3f07" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不管怎样，好的一面是工作完成了，尽管我们太多了，无法一次全部放入 RAM，高层管理人员现在很高兴。</p><h1 id="0672" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">我如何适应 Dask 和 Vaex？</h1><p id="9aaa" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在一起工作了这么长时间后，我们已经很习惯熊猫的命令了，所以 Dask 和 Vaex 都试图用类似的命令来命令我们，这很有帮助。但是它们毕竟不是熊猫，所以还是有一些不同。</p><h2 id="6300" class="ms lv it bd lw mt mu dn ma mv mw dp me lh mx my mg ll mz na mi lp nb nc mk nd bi translated"><strong class="ak"> # Dask </strong></h2><p id="f3a5" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">Dask 喜欢一个关键词叫“计算”。在他说“计算”之前，我们不能完全处理。达斯克总是告诉我们做事要有目的。因此，他的程序通常会是一系列类似熊猫的命令，然后他会在最后一个主要命令中喊出“计算”,然后我们开始全面的实际工作。</p><p id="d027" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下面的简单代码为例:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="46a5" class="ms lv it nf b gy nj nk l nl nm">import dask.dataframe as dd</span><span id="afb2" class="ms lv it nf b gy nn nk l nl nm">df_dask = dd.read_csv(’data.csv’)<br/>df_dask.describe()</span></pre><p id="09eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您得到的不是您期望得到的一般统计数据，而是这个(基本上没有显示任何数据):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/533c8d9fbba9bf3e42180dacd64710eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pnG239lbqs4Lt7VSWSlXuQ.png"/></div></div></figure><p id="4b81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">发生的情况是，当执行<code class="fe np nq nr nf b">dd.read_csv</code>时，Dask 只从 CSV 文件的开头读入一个美国数据点样本。当调用<code class="fe np nq nr nf b">describe()</code>时，Dask 仅仅记录下要采取的步骤。</p><p id="d9b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了得到你从熊猫那里得到的通常的输出，你需要一个神奇的词“计算”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/8cda4bd7d68bccf3c515ce24e0ecf34e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gIdEdB506VFI92YqntEHFQ.png"/></div></div></figure><h2 id="c64d" class="ms lv it bd lw mt mu dn ma mv mw dp me lh mx my mg ll mz na mi lp nb nc mk nd bi translated"># Vaex</h2><p id="dcdc" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">对于 Vaex，她也有自己的风格。一个显著的区别是，她总是希望我们在任何处理完成之前执行列车测试拆分。</p><p id="f83b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那是因为 Vaex 有一个巧妙的技巧。</p><p id="2ef1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设我们对训练数据进行了一些转换:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="2d8e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过下面两行代码，这些相同的转换可以很容易地应用于测试数据:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="bb3f" class="ms lv it nf b gy nj nk l nl nm">state = df_train.state_get()<br/>df_test.state_set(state)</span></pre><p id="b2e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我问 Vaex 这个技巧背后的秘密，她告诉我实际上她的每个数据帧都包含一个<em class="nv">状态</em>，它基本上包含了应用于数据帧的所有转换的信息。</p><p id="0992" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我们在两行代码中所做的是获取包含在<code class="fe np nq nr nf b">df_train</code>的<em class="nv">状态</em>中的转换信息，并将这个<em class="nv">状态</em>应用到<code class="fe np nq nr nf b">df_test</code>，所有的更改都将被传递。</p><p id="5b53" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想知道，标准化转换在<code class="fe np nq nr nf b">df_test</code>上使用了<code class="fe np nq nr nf b">df_train</code>的平均值和标准偏差。</p><p id="6c16" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我猜她真的知道如何聪明地工作！</p><h1 id="a2c0" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">Dask 和 Vaex 对比如何？</h1><p id="c68b" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">这是一个敏感的话题…</p><p id="2763" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">老实说在我看来，就性能而言，Vaex 似乎比 Dask 更有能力。我们中的一些人喜欢 Dask，所以不要告诉别人我说了什么，否则他们可能会解雇我。你也不用信我的话，看看别人(<a class="ae nw" rel="noopener" target="_blank" href="/beyond-pandas-spark-dask-vaex-and-other-big-data-technologies-battling-head-to-head-a453a1f8cc13">这里</a>和<a class="ae nw" rel="noopener" target="_blank" href="/dask-vs-vaex-for-big-data-38cb66728747#:~:text=Vaex%20is%20a%20high%2Dperformance,and%20explore%20big%20tabular%20datasets.&amp;text=Dask%20is%20more%20focused%20on,datasets%20on%20a%20single%20machine.">这里</a>)在说什么就知道了。</p><p id="d3d6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尽管是一个高水平的表演者，Vaex 还是有点害羞，所以她不适合和其他人相处，比如 Scikit-Learn，通常需要一些中介。然而，Dask 和许多其他人合作得很好，因为他经常和 Numpy，Pandas 和 Scikit-Learn 交往。</p><p id="5f23" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可能还会注意到，Dask 擅长在集群环境中工作，而 Vaex 在单台机器上表现出色。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="f5e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是我对我的新经理 Dask 和 Vaex 的所有分享！希望我的建议是有用的，你也将有一个与 Dask 和/或 Vaex 合作的好时光。😄</p><p id="f427" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢听我的分享，如果你有任何问题或意见，请随时告诉我。</p><h1 id="6077" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">我的内部消息来源</h1><div class="oe of gp gr og oh"><a href="https://tutorial.dask.org/00_overview.html" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">简介- Dask 教程文档</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">您可以在实时会话中运行该笔记本，也可以在 Github 上查看它。欢迎来到 Dask 教程。Dask 是平行的…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">tutorial.dask.org</p></div></div></div></a></div><div class="oe of gp gr og oh"><a href="https://vaex.readthedocs.io/en/latest/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">Vaex 是什么？- vaex 3.0.0 文档</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">Vaex 是一个 python 库，用于懒惰的核外数据框架(类似于 Pandas)，以可视化和探索大的表格…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">vaex.readthedocs.io</p></div></div></div></a></div></div></div>    
</body>
</html>