<html>
<head>
<title>Coding a Web App to Simulate the Gambler’s Ruin Problem</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写一个 Web 应用程序来模拟赌徒的破产问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/coding-a-web-app-to-simulate-the-gamblers-ruin-problem-1bc82660a878?source=collection_archive---------37-----------------------#2020-07-25">https://towardsdatascience.com/coding-a-web-app-to-simulate-the-gamblers-ruin-problem-1bc82660a878?source=collection_archive---------37-----------------------#2020-07-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="461a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用 Plotly Dash 和 Heroku 编写和部署 Python Web 应用程序</h2></div><p id="a19e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我发现模拟是理解数学概念的一种有用的方式，所以我最近编写了一个程序来说明赌徒的破产问题。我做了一个<a class="ae le" href="http://gamblers-ruin.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> web app </a>，用 Python 模拟了一系列游戏及其结局。在这个 web app 中，用户定义一组参数(每轮成功的概率(<em class="lf"> p)、</em>初始金额<em class="lf"> (i)、</em>目标金额(<em class="lf"> N) </em>和游戏数)，它将返回每场游戏的获胜概率以及每轮结束时的余额，如下所示。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/1f2fdebfebb55f413e95ff3010e773c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XFVA7rIgxVFQp_KV_5K0AA.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">p=0.5，i=10，N=50，n_games=30 的模拟结果</p></figure><p id="22de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我将介绍如何编写一个赌徒破产模拟 web 应用程序，分为 3 个步骤:I)用 Python 编写模拟程序，II)使用 Plotly Dash 可视化结果，III)在 Heroku 上部署 web 应用程序。</p><h2 id="d23c" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">浅谈赌徒的破产问题</h2><p id="4397" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">赌徒的破产是一个著名的统计概念，在现代金融中有实际应用，如股票期权和保险费的定价。其概念如下:</p><p id="7723" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你带着最初的$ I，走进赌场，希望将你的财富增加到$ N。你选择一个赌博游戏，其中你每一轮的成功概率是<em class="lf"> p </em>，我们假设每一轮都是独立同分布的。如果这一轮你成功了，一个单位会加到你的余额中。如果你输了那一轮，你的平衡中会减少一个单位。当您的余额为 0 美元或达到$N 美元时，游戏结束。您赢得/达到$N 美元目标的概率是多少？</p><h2 id="4e6a" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">I)用 Python 编写模拟代码</h2><p id="79a0" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">我写了一个<code class="fe mu mv mw mx b">GamblersRuin</code>类用于模拟目的。初始化对象时，以概率<em class="lf"> p、</em>初始量<em class="lf"> i </em>和<em class="lf"> g </em> oal 量<em class="lf"> N </em>为自变量。</p><p id="912f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">初始化该类后，您可以调用<code class="fe mu mv mw mx b">n_simulations</code>函数，在这里您可以指定模拟游戏的数量，如果没有，它将默认为 100。这个函数本质上是一个 for 循环，它玩预定义数量的游戏并调用<code class="fe mu mv mw mx b">gamble</code>函数。它返回一个数据帧，显示每局游戏的每轮余额，稍后用于绘制结果。</p><p id="cdbd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">至于上面提到的<code class="fe mu mv mw mx b">gamble</code>函数，如果余额在 0 到<em class="lf"> N 之间，它会生成一个 0 到 1 之间的随机浮点数</em>如果这个随机数小于概率<em class="lf"> p </em>，那么你的余额就会增加一个单位，否则你的余额就会减去一个单位。该函数返回一个数据帧，其中包含生成的随机浮点和每轮的余额。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="cee0" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">II)用虚线显示结果</h2><p id="be23" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">在用 Python 编写了赌徒的破产类方法后，我们现在可以调用它并使用 Plotly Dash 可视化结果。这可以分为三个部分:a)启动 Dash 应用程序，b)设置应用程序的布局，c)指定回调函数，也就是要显示的输入和信息。</p><p id="8c7e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> II.a .)启动 Dash app </strong></p><p id="5f40" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Plotly Dash 应用程序使用 Flask 作为 web 框架。虽然您可以将自己的 flask 应用程序实例传递到 Dash 中，但我保持它的简单性，用<code class="fe mu mv mw mx b">app.server</code>调用底层 Flask 应用程序。</p><pre class="lh li lj lk gt na mx nb nc aw nd bi"><span id="1f7d" class="lw lx it mx b gy ne nf l ng nh">external_stylesheets = ['https://codepen.io/chriddyp/pen/bWLwgP.css'] </span><span id="188a" class="lw lx it mx b gy ni nf l ng nh">app = dash.Dash(__name__, external_stylesheets=external_stylesheets) </span><span id="bff3" class="lw lx it mx b gy ni nf l ng nh">server = app.server</span></pre><p id="35b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> III.b .)设置布局</strong></p><p id="da2b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了编写 Dash 应用程序的布局，我使用了<code class="fe mu mv mw mx b">dash-html-components</code>库，该库将 web 框架抽象为 Python 代码。这些组件在幕后被转换为 web 应用程序的 HTML，您也可以向类似<code class="fe mu mv mw mx b">style</code>的 Python Dash 类添加 HTML 元素来定制您的布局。</p><p id="399c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了使用<code class="fe mu mv mw mx b">dash-html-components</code>定制我的应用布局，使用<code class="fe mu mv mw mx b">dash-core-components (dcc)</code>库添加不同的组件也很容易。我使用<code class="fe mu mv mw mx b">dcc.Markdown</code>格式化文本，<code class="fe mu mv mw mx b">dcc.Input</code>将用户指定的输入作为我的<code class="fe mu mv mw mx b">GamblersRuin</code>类的参数，使用<code class="fe mu mv mw mx b">dcc.Graph</code>显示结果。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="787d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> III.c .)回调函数</strong></p><p id="38ae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后一步，我根据用户提交的输入指定了必要的回调。我还编写了<code class="fe mu mv mw mx b">update_graph</code>函数来更新获胜计算的概率和要显示的图形，一个 Plotly 线图。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="c72b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您现在可以在本地机器上测试 Dash 应用程序了！如果您运行 app.py 文件，Dash 应用程序现在应该在您的本地主机上运行。最后一步是将应用程序部署到服务器。</p><h2 id="f9ea" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">IV)在 Heroku 上部署应用程序</h2><p id="cc40" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">使用 Heroku 的部署过程相对容易。查看这本<a class="ae le" href="https://devcenter.heroku.com/articles/getting-started-with-python" rel="noopener ugc nofollow" target="_blank">指南</a>部署到 Heroku。</p><ul class=""><li id="b1c2" class="nj nk it kk b kl km ko kp kr nl kv nm kz nn ld no np nq nr bi translated">首先，你需要创建一个<a class="ae le" href="https://signup.heroku.com/dc" rel="noopener ugc nofollow" target="_blank"> Heroku 账户</a>。</li><li id="0f72" class="nj nk it kk b kl ns ko nt kr nu kv nv kz nw ld no np nq nr bi translated">用运行 Dash 应用程序和 python 文件的包定义一个<code class="fe mu mv mw mx b">requirements.txt</code>文件。</li><li id="12a5" class="nj nk it kk b kl ns ko nt kr nu kv nv kz nw ld no np nq nr bi translated">定义一个<code class="fe mu mv mw mx b">Procfile</code>(repo 根目录下的文本文件)来指定启动应用程序的命令。</li></ul><pre class="lh li lj lk gt na mx nb nc aw nd bi"><span id="3d01" class="lw lx it mx b gy ne nf l ng nh">web: gunicorn app:server</span></pre><ul class=""><li id="c1cf" class="nj nk it kk b kl km ko kp kr nl kv nm kz nn ld no np nq nr bi translated">指定要部署的 github repo 和分支。您可以使用 heroku CLI 或他们的 web 界面来实现这一点。</li><li id="e801" class="nj nk it kk b kl ns ko nt kr nu kv nv kz nw ld no np nq nr bi translated">部署！</li></ul><h2 id="6ab0" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">五)总结</h2><p id="143d" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">在本教程中，我介绍了如何编码、可视化和部署一个赌徒破产模拟 web 应用程序。以下是这些步骤的简要总结:</p><ol class=""><li id="5ce3" class="nj nk it kk b kl km ko kp kr nl kv nm kz nn ld nx np nq nr bi translated">将 Python 中的模拟编码为一个类方法，该方法将<em class="lf"> p，I，N </em>作为参数，并具有运行预定义数量的模拟的函数。</li><li id="7e7d" class="nj nk it kk b kl ns ko nt kr nu kv nv kz nw ld nx np nq nr bi translated">使用 Plotly Dash 可视化模拟的结果和结局。</li><li id="a372" class="nj nk it kk b kl ns ko nt kr nu kv nv kz nw ld nx np nq nr bi translated">在 Heroku 上部署 Dash 应用程序。</li></ol><p id="5179" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个网络应用程序从开始到结束花了我大约 5 个小时。我希望这篇文章已经激发了你去思考你可以编码的模拟，请随时在下面评论你的想法！</p><h2 id="db6a" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">参考</h2><ul class=""><li id="5ec1" class="nj nk it kk b kl mp ko mq kr ny kv nz kz oa ld no np nq nr bi translated"><a class="ae le" href="http://gamblers-ruin.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">赌徒的毁灭冲刺 App </a></li><li id="998d" class="nj nk it kk b kl ns ko nt kr nu kv nv kz nw ld no np nq nr bi translated"><a class="ae le" href="https://github.com/claudian37/Gamblers_Ruin_Webapp" rel="noopener ugc nofollow" target="_blank"> Github 回购</a></li><li id="3d53" class="nj nk it kk b kl ns ko nt kr nu kv nv kz nw ld no np nq nr bi translated"><a class="ae le" href="https://devcenter.heroku.com/articles/getting-started-with-python" rel="noopener ugc nofollow" target="_blank">使用 Python 在 Heroku 上部署</a></li><li id="7a90" class="nj nk it kk b kl ns ko nt kr nu kv nv kz nw ld no np nq nr bi translated"><a class="ae le" href="http://www.columbia.edu/~ks20/stochastic-I/stochastic-I-GRP.pdf" rel="noopener ugc nofollow" target="_blank">赌徒的破产问题</a>(卡尔·西格曼的笔记)</li></ul></div></div>    
</body>
</html>