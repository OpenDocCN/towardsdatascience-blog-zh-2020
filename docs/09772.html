<html>
<head>
<title>4 Pandas Function to Reshape Table Layout</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">4 熊猫功能重塑餐桌布局</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/4-pandas-function-to-reshape-table-layout-f08e760c4602?source=collection_archive---------23-----------------------#2020-07-11">https://towardsdatascience.com/4-pandas-function-to-reshape-table-layout-f08e760c4602?source=collection_archive---------23-----------------------#2020-07-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3e7d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">根据你的需求改造你的熊猫桌</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cd20d878f0e5dc35f7fc96d41342b580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vKtfcW_9F4uWpujv"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@anvision?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">安视觉</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="2870" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在处理数据时，有时您需要以您需要的方式转换您的表。这可能是因为您需要更清楚地查看您的数据，或者您需要将您的数据转换成更好的形式。</p><p id="7c45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论如何，本文将重点介绍四个不同的函数，您可以使用它们来转换您的 Pandas 数据框。让我们开始吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fddc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1 .排序值</h1><p id="d094" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">简单而有用。这种优雅的方法是熊猫武器库中最有用的方法之一。仅仅从名字上，你就能猜出这个函数是做什么的。是的，这个函数根据特定列中的值对表进行排序。</p><p id="204b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我用一个数据集的例子来说明。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="abce" class="ne md it na b gy nf ng l nh ni">import pandas as pd<br/>import seaborn as sns</span><span id="1b7f" class="ne md it na b gy nj ng l nh ni">#Loading dataset example<br/>tips = sns.load_dataset('tips')<br/>tips.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/31be13bcf07d1635790815d9bd326d98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*YBw7TR9c0Q_pkMy-Ma-L9A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原始提示表</p></figure><p id="a37c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上是我们的数据集示例。假设我想根据已排序的 total_bill 列重新调整我的表布局。我可以用下面的代码来做。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="db23" class="ne md it na b gy nf ng l nh ni">tips.sort_values('total_bill').head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/5fee496c10287d0253b739af8936b89f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*Mnswd7jLxNpVrxnUM5Dfig.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基于 total_bill 列的排序提示表</p></figure><p id="55ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像这样，我们根据 total_bill 列对表进行升序排序。如果您想基于大小列对列进行排序，然后以降序方式提示列，又会如何呢？用下面的代码也可以做到这一点。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a635" class="ne md it na b gy nf ng l nh ni">#We put our columns in the list and input False value in the ascending parameter to change the sorting direction</span><span id="6ac8" class="ne md it na b gy nj ng l nh ni">tips.sort_values(['size', 'tip'], ascending = False).head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/d063bd1453e98a3c4e7f0efe5fb427fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*mMgbuVzeQmwqJqlTf5zFNw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">根据大小和提示列对表进行降序排序</p></figure><p id="ed1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们首先按照 size 列对表进行排序，然后按照 tip 列降序排序。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fde7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2 .枢轴</h1><p id="689b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Pivot 是一种基于列值从数据框重塑数据(生成“pivot”表)的方法。它使用指定索引/列中的唯一值来形成结果数据帧的轴。</p><p id="b9b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们所做的枢轴的另一个名称是<strong class="lb iu">长到宽的桌子。</strong>为了说明原因，让我们用 tips 数据集来尝试一下。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7078" class="ne md it na b gy nf ng l nh ni">#I specify the as the column and the both total_bill and tip column as the value</span><span id="57e4" class="ne md it na b gy nj ng l nh ni">tips.pivot(columns = 'sex', values = ['total_bill', 'tip'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/9b0ce9d964192074e3a072eeca90879e.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*cuir7zhxa2k3y04kg2ZsTQ.png"/></div></figure><p id="7712" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们现在将表布局更改为数据透视表。性别列中的前一个类现在变成了它们各自的列，并且在它们的位置上用数值填充了值。</p><p id="e82c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NaN 值，因为在原始数据的该行中不存在任何值。例如，索引 0 在男性列中包含 NaN 发生这种情况是因为在行索引 0 中，性别值是女性。看下图就知道了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/422d16759111dfcfecb2926671b4357b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*YK6eI9aOmx9knOKGeiO_7g.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8278" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3 .数据透视表 _ 表格</h1><p id="672f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">熊猫数据框对象中有一个方法。与 pivot 方法相比有什么不同？我们就试试吧。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5f05" class="ne md it na b gy nf ng l nh ni">tips.pivot_table(columns = 'sex', values = ['total_bill', 'tip'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/cab7c61740f369e642bde8e123df98da.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*yM6jvYqvRIve5fXTidCmTg.png"/></div></figure><p id="0939" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，结果与 pivot 方法相比明显不同。这是因为在 pivot_table 函数中，我们得到的不是包含每个数据值的行，而是聚合值。</p><p id="3e70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，聚合函数是<strong class="lb iu"> mean(平均值)</strong>；这就是为什么在上面的数据透视表中，值是每个组合的平均值。</p><p id="4f60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以尝试在我们的数据透视表中有另外几个聚合函数。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="20ec" class="ne md it na b gy nf ng l nh ni">tips.pivot_table(columns = 'sex', values = ['total_bill', 'tip'], aggfunc = ['mean', 'std', 'median'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/cc70baa9e938e9c99f9ac1fac8ef2ccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*n4782Mirlg8NGL464tyTkg.png"/></div></figure><p id="fa45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的数据透视表中，我们添加了 mean 之外的另一个聚合函数；标准差和中位数。它创建了一个附加的多级数据透视表，其中包含聚合函数的所有值。</p><p id="f496" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想要创建一个更详细的分离和汇总值，我们可以用下面的代码来完成。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c2b9" class="ne md it na b gy nf ng l nh ni">#Specificed the size column as the index and margins as True to get the total summary</span><span id="2196" class="ne md it na b gy nj ng l nh ni">tips.pivot_table(columns = 'sex', values = ['total_bill', 'tip'], aggfunc = ['mean', 'std', 'median'], index = 'size',<br/>                margins = True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/bb882ebfd8b2764dfbd125762c3a944d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lmUtSRw7mDXJP0_mmgDcaw.png"/></div></div></figure><p id="59cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面我们得到了我们需要的详细的数据透视表。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8213" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.熔化</h1><p id="924d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">熔化是枢轴功能的逆过程。在这个函数中，我们创建了一个从<strong class="lb iu">宽到长的</strong>表。或者换句话说，我们把桌子拆了。让我们试一下这个函数的功能。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ced8" class="ne md it na b gy nf ng l nh ni">tips.melt(id_vars = 'tip', value_vars = 'sex')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/06b59c899609df8d1db25865f1c48d01.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*hrGy8RtzOAval3yl-zCIZQ.png"/></div></figure><p id="1ad4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，我们得到了融化的桌子。在上面的非透视表中，我们得到三列；提示、变量和值列。提示列是提示列的原始值，可变列值是原始列名，值列值是类类别或可变列值中的值。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f268" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="568f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，我向您展示了四个熊猫函数来重塑表格布局:</p><ol class=""><li id="95b9" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated">排序值</li><li id="f742" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated">在枢轴上转动</li><li id="469b" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated">数据透视表 _ 表格</li><li id="82d3" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated">熔化</li></ol><p id="939e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望有帮助！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4f75" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如果你喜欢我的内容，并想获得更多关于数据或作为数据科学家的日常生活的深入知识，请考虑在这里订阅我的<a class="ae ky" href="https://cornellius.substack.com/welcome" rel="noopener ugc nofollow" target="_blank">时事通讯。</a></h1><blockquote class="oh"><p id="9049" class="oi oj it bd ok ol om on oo op oq lu dk translated">如果您没有订阅为中等会员，请考虑通过<a class="ae ky" href="https://cornelliusyudhawijaya.medium.com/membership" rel="noopener">我的推荐</a>订阅。</p></blockquote></div></div>    
</body>
</html>