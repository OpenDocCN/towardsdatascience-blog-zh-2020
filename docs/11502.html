<html>
<head>
<title>DengAI — Data preprocessing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">邓艾—数据预处理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dengai-data-preprocessing-28fc541c9470?source=collection_archive---------44-----------------------#2020-08-09">https://towardsdatascience.com/dengai-data-preprocessing-28fc541c9470?source=collection_archive---------44-----------------------#2020-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="b95f" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">理解 ML</h2><div class=""/><div class=""><h2 id="78b5" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何对 ML 比赛的数据进行预处理？基于邓艾的例子。</h2></div><blockquote class="ko kp kq"><p id="ec09" class="kr ks kt ku b kv kw ka kx ky kz kd la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><em class="iq">本文基于我在 DrivenData 平台</em>  <em class="iq">上参加</em> <a class="ae lo" href="https://www.drivendata.org/competitions/44/dengai-predicting-disease-spread/" rel="noopener ugc nofollow" target="_blank"> <em class="iq">邓艾比赛。我的得分在 0.2%以内(截至 2020 年 6 月 2 日，14/9069)。</em></a></p></blockquote><p id="5af5" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">在本文中，我假设你已经熟悉了<a class="ae lo" rel="noopener" target="_blank" href="/dengai-how-to-approach-data-science-competitions-eda-22a34158908a">邓艾——埃达</a>。你不需要读它来理解这里的一切，但是如果你读了，就会容易得多。</p><h1 id="461b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">为什么要对数据进行预处理？</h1><p id="4359" class="pw-post-body-paragraph kr ks iq ku b kv mk ka kx ky ml kd la lp mm ld le lq mn lh li lr mo ll lm ln ij bi translated">当设计 ML 模型时，我们必须记住其中一些是基于梯度法的。梯度的问题在于它在归一化/缩放数据上表现得更好。让我举个例子:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mp"><img src="../Images/bf4e53f70826171d443e03afa21532ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Ro7h-zq2G4X_x46UKoDTQ.png"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated"><em class="nf">梯度下降的例子。</em></p></figure><p id="ee6f" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">在左侧，我们有一个由两个要素组成的数据集，其中一个要素的比例比另一个要素大。在这两种情况下，梯度方法都有效，但是当要素位于相似的比例上时，达到最佳效果所需的步骤要少得多(右图)。</p><h1 id="3ec8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">什么是正常化，什么是缩放？</h1><h2 id="3acd" class="ng lt iq bd lu nh ni dn ly nj nk dp mc lp nl nm me lq nn no mg lr np nq mi iw bi translated"><a class="ae lo" href="https://en.wikipedia.org/wiki/Normalization_(statistics)" rel="noopener ugc nofollow" target="_blank">正常化</a></h2><p id="f351" class="pw-post-body-paragraph kr ks iq ku b kv mk ka kx ky ml kd la lp mm ld le lq mn lh li lr mo ll lm ln ij bi translated">在标准意义上，规范化是指调整值分布范围以适应<strong class="ku ja"> &lt; -1，1 &gt; </strong>的过程(id 不必精确到-1 比 1，但在同一数量级内，因此范围)。通过<strong class="ku ja">从集合中的每个值中减去平均值，并将结果除以标准偏差</strong>来完成标准归一化。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/20fa3c962ecf3f7d562806411bc41034.png" data-original-src="https://miro.medium.com/v2/resize:fit:162/format:webp/1*FJC6Mk8aLXGrpUmG6DqJjg.png"/></div></figure><h2 id="693f" class="ng lt iq bd lu nh ni dn ly nj nk dp mc lp nl nm me lq nn no mg lr np nq mi iw bi translated"><a class="ae lo" href="https://en.wikipedia.org/wiki/Feature_scaling#Rescaling_(min-max_normalization)" rel="noopener ugc nofollow" target="_blank">缩放</a></h2><p id="89d6" class="pw-post-body-paragraph kr ks iq ku b kv mk ka kx ky ml kd la lp mm ld le lq mn lh li lr mo ll lm ln ij bi translated">你可以看到它被称为“最小-最大归一化”，但缩放是另一个值调整以适应范围，但这次范围是<strong class="ku ja"> &lt; 0，1 &gt; </strong>。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/e08370a56a564626d53839aab81d5fc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:362/format:webp/1*AtDLnv4uwy5x_WjmjsvFWQ.png"/></div></figure><h1 id="f056" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">归一化还是缩放？</h1><p id="f848" class="pw-post-body-paragraph kr ks iq ku b kv mk ka kx ky ml kd la lp mm ld le lq mn lh li lr mo ll lm ln ij bi translated">您可以对特征执行两种类型的操作。您可以标准化或缩放其值。选择哪一个取决于特性本身。如果您认为要素具有一些正值和负值，并且这些值很重要，则应该执行规范化。在负值没有意义的特征上，应该应用缩放。</p><p id="feac" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">并不总是非黑即白。让我们考虑一个特征，比如温度。取决于你选择的刻度(开尔文或摄氏/华氏),温度可能会有不同的解释。开尔文温标是<strong class="ku ja">绝对热力学温标</strong>(从绝对零度开始，不能低于绝对零度)。另一方面，我们有使用 IRL 的标度，负数对我们有意义。当温度降到摄氏零度以下时，水就结冰了。华氏温标也是如此，它的 0 度描述了<a class="ae lo" href="https://en.wikipedia.org/wiki/Brine" rel="noopener ugc nofollow" target="_blank">盐水</a>(盐在水中的浓缩溶液)的冰点。直截了当的选择是缩放开尔文，并使摄氏和华氏温度正常化。这并不总是奏效。我们可以在邓艾的数据集上展示它:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nt"><img src="../Images/8b1c474fdd00a1ab7f9e431728e15932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sZYs4X4FoubBf6g9VdzLRw.png"/></div></div></figure><p id="7ca2" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">有些温度在开氏温标上，有些在摄氏温标上。这在这里并不重要。如果您仔细观察，您应该能够按类型对这些温度进行分组:</p><ul class=""><li id="419c" class="nu nv iq ku b kv kw ky kz lp nw lq nx lr ny ln nz oa ob oc bi translated">绝对最小值温度</li><li id="624e" class="nu nv iq ku b kv od ky oe lp of lq og lr oh ln nz oa ob oc bi translated">没有绝对最小值的温度(可以是负值)</li></ul><p id="fc62" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">第一个例子是<strong class="ku ja"> station_diur_temp_rng_c </strong>。这就是所谓的<a class="ae lo" href="https://en.wikipedia.org/wiki/Diurnal_temperature_variation" rel="noopener ugc nofollow" target="_blank">日温度变化</a>，它定义了一段时间内最低和最高温度之间的变化。该值不能为负值(因为最小值和最大值之差不能小于 0)。这就是我们应该使用缩放而不是归一化的地方。</p><p id="9336" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">再比如<strong class="ku ja">再分析 _ 空气 _ 温度 _k </strong>。它是空气温度和重要特征。我们无法定义温度可能达到的最小值。如果我们真的希望每个城市都有一个任意的最低温度，我们永远不能低于这个温度，但这不是我们想要做的。在训练模型时，像我们这样的问题中的温度这样的东西可能有另一种意义。温度值可能有一些积极和消极的影响。在这种情况下，温度低于 298K 可能会对一些病例产生积极影响(蚊子减少)。这就是为什么我们应该对这个使用规范化。</p><p id="1bfa" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">检查整个数据集后，我们可以得出要归一化、缩放的特征列表，并从<a class="ae lo" href="https://erdem.pl/2020/07/deng-ai-how-to-approach-data-science-competitions-eda#dataset" rel="noopener ugc nofollow" target="_blank">我们的特征列表</a>中复制:</p><h2 id="f9ab" class="ng lt iq bd lu nh ni dn ly nj nk dp mc lp nl nm me lq nn no mg lr np nq mi iw bi translated">标准化特征</h2><pre class="mq mr ms mt gt oi oj ok ol aw om bi"><span id="3ca7" class="ng lt iq oj b gy on oo l op oq">'reanalysis_air_temp_k'<br/>'reanalysis_avg_temp_k'<br/>'reanalysis_dew_point_temp_k'<br/>'reanalysis_max_air_temp_k'<br/>'reanalysis_min_air_temp_k'<br/>'station_avg_temp_c'<br/>'station_max_temp_c'<br/>'station_min_temp_c'</span></pre><h2 id="dd5b" class="ng lt iq bd lu nh ni dn ly nj nk dp mc lp nl nm me lq nn no mg lr np nq mi iw bi translated">缩放特征</h2><pre class="mq mr ms mt gt oi oj ok ol aw om bi"><span id="cffd" class="ng lt iq oj b gy on oo l op oq">'station_diur_temp_rng_c'<br/>'reanalysis_tdtr_k'<br/>'precipitation_amt_mm'<br/>'reanalysis_precip_amt_kg_per_m2'<br/>'reanalysis_relative_humidity_percent'<br/>'reanalysis_sat_precip_amt_mm'<br/>'reanalysis_specific_humidity_g_per_kg'<br/>'station_precip_mm'<br/>'year'<br/>'weekofyear'</span></pre><h2 id="bf35" class="ng lt iq bd lu nh ni dn ly nj nk dp mc lp nl nm me lq nn no mg lr np nq mi iw bi translated">复制的特征</h2><pre class="mq mr ms mt gt oi oj ok ol aw om bi"><span id="ab9b" class="ng lt iq oj b gy on oo l op oq">'ndvi_ne'<br/>'ndvi_nw'<br/>'ndvi_se'<br/>'ndvi_sw'</span></pre><h1 id="bf4d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">为什么要复制？</h1><p id="f0bf" class="pw-post-body-paragraph kr ks iq ku b kv mk ka kx ky ml kd la lp mm ld le lq mn lh li lr mo ll lm ln ij bi translated">如果我们看看 NDVI 指数的定义，我们可以决定没有理由缩放或标准化这些值。NDVI 值已经在<strong class="ku ja"> &lt; -1、&gt; </strong>范围内。有时我们可能想像这样直接复制值。尤其是当原始值与我们的归一化特征处于同一数量级时。它可能是&lt; 0，2 &gt;或&lt; 1，4 &gt;，但它不会给模型带来问题。</p><h1 id="cfb2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">代码</h1><p id="e8c3" class="pw-post-body-paragraph kr ks iq ku b kv mk ka kx ky ml kd la lp mm ld le lq mn lh li lr mo ll lm ln ij bi translated">现在，我们必须编写一些代码来预处理我们的数据。我们将使用<a class="ae lo" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> sklearn </a>库中的<a class="ae lo" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noopener ugc nofollow" target="_blank"> StandardScaler </a>和<a class="ae lo" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html" rel="noopener ugc nofollow" target="_blank"> MinMaxScaler </a>。</p><p id="bc69" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">作为函数的输入，我们希望发送 3 或 4 个变量。在处理训练集时，我们发送 3 个变量:</p><ul class=""><li id="049b" class="nu nv iq ku b kv kw ky kz lp nw lq nx lr ny ln nz oa ob oc bi translated">训练数据集(如熊猫数据帧)</li><li id="0b44" class="nu nv iq ku b kv od ky oe lp of lq og lr oh ln nz oa ob oc bi translated">要规范化的列列表</li><li id="39ce" class="nu nv iq ku b kv od ky oe lp of lq og lr oh ln nz oa ob oc bi translated">要缩放的列列表</li></ul><p id="1786" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">当我们处理训练数据时，我们必须为缩放/标准化过程定义数据集。该数据集用于获取平均值<strong class="ku ja">或标准差</strong>等值。因为在处理训练数据集时，我们没有任何外部数据集，所以我们使用训练数据集。在第 19 行，我们使用<code class="fe or os ot oj b">StandardScaler()</code>对选择的列进行规范化:</p><p id="4b14" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">StandardScaler 在初始化时不需要任何参数，但它需要缩放数据集以适应。我们可以只通过两次<code class="fe or os ot oj b">new_data</code>就可以了，但是我们需要为测试数据集创建另一个预处理。</p><p id="6990" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">接下来，我们要做同样的事情，但是用的是<code class="fe or os ot oj b">MinMaxScaler()</code>。</p><p id="4796" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">这一次，我们传递一个名为<code class="fe or os ot oj b">feature_range</code>的参数，以确保我们的比例在范围&lt; 0，1 &gt;内。和前面的例子一样，我们传递缩放数据集来适应和转换所选的列。</p><p id="d445" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">最后，我们返回转换后的<code class="fe or os ot oj b">new_data</code>和另外的<code class="fe or os ot oj b">train_scale</code>用于进一步的预处理。但是等一下！什么进一步的预处理？请记住，我们不仅要处理训练数据集，还要处理测试数据集。我们必须对它们应用相同的数据处理，以使模型具有相同的输入。如果我们简单地以同样的方式对测试数据集使用<code class="fe or os ot oj b">preproc_data()</code>，我们将应用完全不同的标准化和缩放。原因是因为归一化和缩放是通过<code class="fe or os ot oj b">.fit()</code>方法完成的，并且该方法使用一些给定的数据集来计算<strong class="ku ja">平均值</strong>和其他所需的值。如果您使用的测试数据集可能具有不同的值范围(由于全球变暖等原因，夏天很热。)您在测试数据集中的值 28C 将使用不同的参数进行标准化。让我给你看一个例子:</p><p id="87f0" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">训练数据集:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/95cf4d4fa67331bba5f23a320e04b994.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*cexgJStTPGuWrttbACzYfQ.png"/></div></figure><p id="5edd" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">测试数据集:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/a8eddbe29eeea8065a6b328ba68ba444.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*GGmW15hLO2eOKo16m0gbKw.png"/></div></figure><p id="aeb9" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">使用训练数据集中的平均值和标准差对测试数据集进行归一化，得到:</p><p id="1e8f" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi">[0.11,0.11,0.91,1.71,0.91,0.11,1.71]</p><p id="a693" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">但是，如果您使用测试数据集中的平均值和标准差，您最终会得到:</p><p id="6b37" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi">[−1.04,−1.04,0.17,1.37,0.17,−1.04,1.37]</p><p id="2b01" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">你可能认为第二个更好地描述了数据集，但这只适用于只处理测试数据集的情况。</p><p id="fedb" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">这就是为什么在构建我们的模型时，我们必须像这样执行它:</p><h1 id="92de" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">结论</h1><p id="d72d" class="pw-post-body-paragraph kr ks iq ku b kv mk ka kx ky ml kd la lp mm ld le lq mn lh li lr mo ll lm ln ij bi translated">我们刚刚完成了一个非常标准的数据集标准化过程。理解标准化和缩放之间的区别很重要。另一件可能更重要的事情是归一化的特征选择(不同温度特征的例子)，你应该总是试图理解你的特征，而不仅仅是应用一些来自互联网的硬编码规则。</p><p id="96a9" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated">我必须提到的最后一件事(你可能已经想到了)是训练和测试数据集中的数据范围之间的差异。您知道测试数据的标准化应该使用来自训练数据的变量来完成，但是我们不应该调整过程以适应不同的范围吗？假设训练数据集的温度范围在 15℃和 23℃之间，测试数据集的温度范围在 18℃和 28℃之间。这难道不是我们模型的问题吗？实际上不是:)模型并不真的关心这样的小变化，因为它们是在逼近连续函数(或分布)，除非你的范围相差很大(来自不同的分布)，否则你不应该有任何问题。</p></div><div class="ab cl ow ox hu oy" role="separator"><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb"/></div><div class="ij ik il im in"><p id="ed9b" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la lp lc ld le lq lg lh li lr lk ll lm ln ij bi translated"><em class="kt">最初发布于</em><a class="ae lo" href="https://erdem.pl/2020/08/deng-ai-data-preprocessing" rel="noopener ugc nofollow" target="_blank"><em class="kt">https://erdem . pl</em></a><em class="kt">。</em></p></div></div>    
</body>
</html>