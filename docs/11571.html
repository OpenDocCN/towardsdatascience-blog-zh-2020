<html>
<head>
<title>Football players tracking — identifying players’ team based on their jersey colors using OpenCV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">足球运动员跟踪——使用 OpenCV 根据运动员球衣的颜色识别他们的球队</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/football-players-tracking-identifying-players-team-based-on-their-jersey-colors-using-opencv-7eed1b8a1095?source=collection_archive---------21-----------------------#2020-08-11">https://towardsdatascience.com/football-players-tracking-identifying-players-team-based-on-their-jersey-colors-using-opencv-7eed1b8a1095?source=collection_archive---------21-----------------------#2020-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="868c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Yolov3、SORT 和 OpenCV 检测、跟踪、确定球员的球队并将其转换为鸟瞰图。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e99729bf62e29209bc5765569546e3ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*bPmhqsLz9cPrk0tBkuOptw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">球员追踪在鸟瞰图中，蓝点和白点代表两队，红点是裁判。(背景图片来自<a class="ae ky" href="https://commons.wikimedia.org/wiki/File:Soccer_field_-_empty.svg" rel="noopener ugc nofollow" target="_blank">https://commons . wikimedia . org/wiki/File:Soccer _ field _-_ empty . SVG</a>)</p></figure><h1 id="18df" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="8681" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我之前的工作中，我使用预训练的 Yolov3 模型进行检测，并使用 SORT(简单的在线和实时跟踪)从视频中跟踪足球运动员。然后我用 OpenCV 的 getPerspectiveTransform 函数把视频转换成鸟瞰图。</p><div class="mn mo gp gr mp mq"><a rel="noopener follow" target="_blank" href="/how-to-track-football-players-using-yolo-sort-and-opencv-6c58f71120b8"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">如何使用 Yolo，SORT 和 Opencv 追踪足球运动员？</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">使用 Yolov3、Opencv 和 SORT 检测和跟踪足球运动员，并将球员的运动转换为鸟瞰图。</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">towardsdatascience.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne ks mq"/></div></div></a></div><p id="0fa4" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">这项工作的一个问题是模型不能区分团队。如果程序能够识别玩家的团队，而不仅仅是检测“人”，那就太好了。为了进一步改善这一点，我希望包括一个功能，告诉球员球衣颜色的差异。</p><p id="7e2a" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">我现在能想到解决这个问题的两种方法。</p><ol class=""><li id="58b9" class="nk nl it lt b lu nf lx ng ma nm me nn mi no mm np nq nr ns bi translated">使用包含 3 个类的自定义数据集训练对象检测模型——两个队的球员和裁判。这种方法对于实际应用可能不实用，因为必须在每次比赛前训练特定的模型。</li><li id="70c8" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">使用当前对象检测模型并从检测中提取颜色信息。基于此，我可以识别球员球衣的颜色。</li></ol><p id="331d" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">我决定使用 OpenCV 尝试方法 2。</p><h1 id="c4bd" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">足球视频</strong></h1><p id="a533" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">静止足球视频从<a class="ae ky" href="https://pspagnolo.jimdofree.com/download/" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><p id="4ae2" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated"><em class="ny">“t . D ' orazio，M.Leo，N. Mosca，P.Spagnolo，P.L.Mazzeo 足球视频序列地面实况生成的半自动系统，第六届 IEEE 高级视频和信号监控国际会议，意大利热那亚，2009 年 9 月 2 日至 4 日”</em></p><h1 id="88fe" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">OpenCV 的彩色蒙版</h1><p id="5bd2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">球队和裁判之间的主要区别是球衣的颜色——一个球队是白色的，另一个是蓝色的，而裁判是红色的。我想根据球衣颜色来确定球员的球队。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/fb9e32c68e180f61696401b55c1a67ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fMu4Qn5arqcaFDkpNglVJQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">视频中的一帧。</p></figure><p id="6157" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">首先，我确定了三种颜色的范围。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="b483" class="of la it ob b gy og oh l oi oj">color_list=['red','blue','white']</span><span id="f23f" class="of la it ob b gy ok oh l oi oj">boundaries = [<br/>    ([17, 15, 75], [50, 56, 200]), #red<br/>    ([43, 31, 4], [250, 88, 50]), #blue<br/>    ([187,169,112],[255,255,255]) #white<br/>    ]</span></pre><p id="d58c" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">然后我应用 OpenCV 的 inRange 函数为三种颜色创建蒙版。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="5e09" class="of la it ob b gy og oh l oi oj">mask = cv2.inRange(image, lower, upper)</span></pre><p id="892b" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">然后使用 bitwise_and 对框架应用遮罩。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="9414" class="of la it ob b gy og oh l oi oj">output = cv2.bitwise_and(image, image, mask = mask)</span></pre><p id="b1f5" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">现在提取了三种颜色</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/9b3063939c78e2f8a6f68e0c0ca769f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mvby8Lv0BWhCAux_9BT2LA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用于图像的红色、蓝色和白色遮罩。</p></figure><p id="cf80" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">现在我们需要将这些掩模应用到检测中。我根据检测到的边界框裁剪了图像，然后应用了蒙版。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="69e7" class="of la it ob b gy og oh l oi oj">crop_img = frame[ymin:ymax, xmin:xmax]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/cbad415e76695adc18eff9c52ba9d096.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*C5auzImCFmzv_MfZGZiubg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用于检测的掩码。基于非黑色/总像素比率，球衣被识别为蓝色。</p></figure><p id="dcc8" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">我识别颜色的方法是计数非黑色像素，并计算三种颜色的输出图像的比率(非黑色/总像素)。比例最高的是球衣的颜色。在上面的例子中，蓝色的比例最高，所以球衣被识别为蓝色。</p><p id="5de2" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">现在我把这个功能集成到玩家检测脚本中，这里是一些面具和玩家检测的例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/7e9afa4d3078807b66b636c262b4e269.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*tdi5CDoPdykB1trWhtxIqg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">检测样本</p></figure><p id="d0fc" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">基于球衣颜色的结果，我可以画出不同颜色的包围盒。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/ecca1315edee30271c984570835f2907.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*wK_22snrgadlYH8kP_hpSg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">足球运动员追踪。边界框的颜色代表运动衫的颜色。</p></figure><p id="b08b" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">然后和我之前的帖子类似，通过使用 Opencv 的<a class="ae ky" href="https://docs.opencv.org/2.4/modules/imgproc/doc/geometric_transformations.html#getperspectivetransform" rel="noopener ugc nofollow" target="_blank"> getPerspectiveTransform </a>，得到了开头所示的鸟瞰图。</p><h1 id="01bb" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="3c21" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">仍然存在一些问题:</p><ol class=""><li id="dabc" class="nk nl it lt b lu nf lx ng ma nm me nn mi no mm np nq nr ns bi translated">一些玩家在一些帧中没有被检测到，一些非玩家的人也被检测到。可以通过专门为足球运动员训练对象检测模型而不是使用预先训练的模型来改进。即使球很小，也可以跟踪球，这将是很有趣的，有可能尝试它或其他对象检测架构。</li><li id="7ccf" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">当有玩家遮挡时 ID 改变。尝试像深度排序这样的其他跟踪算法可能会有帮助。</li></ol><p id="adcd" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">这种跟踪的一些应用:</p><ol class=""><li id="588e" class="nk nl it lt b lu nf lx ng ma nm me nn mi no mm np nq nr ns bi translated">跟踪玩家并计算他们的速度和距离。</li><li id="2040" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">获取两个队的球员路线的热图</li><li id="e165" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">更多</li></ol><p id="2321" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">感谢阅读，欢迎建议和反馈。</p><p id="b2e9" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">在这里支持我:【https://medium.com/@c.kuan/membership】T2</p></div></div>    
</body>
</html>