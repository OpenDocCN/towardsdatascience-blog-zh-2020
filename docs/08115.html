<html>
<head>
<title>Video Segmentation With 5 Lines of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用5行代码实现视频分割</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/video-segmentation-with-5-lines-of-code-87f798afb93?source=collection_archive---------24-----------------------#2020-06-15">https://towardsdatascience.com/video-segmentation-with-5-lines-of-code-87f798afb93?source=collection_archive---------24-----------------------#2020-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7639" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">视频的语义和实例分割</strong></h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f5a3054f6d0f90875d99fcec43b563d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xPvbkOZW0FUsaFNcJqhtfA.jpeg"/></div></div></figure><p id="1d9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">PixelLib的第一个版本是为了使用几行代码执行图像分割而构建的。我很兴奋地宣布，新发布的PixelLib版本支持五行代码的视频分段。</p><p id="7250" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你没有读过关于PixelLib图像分割的文章，点击<a class="ae ln" rel="noopener" target="_blank" href="/image-segmentation-with-six-lines-0f-code-acb870a462e8">这里</a>。</p><p id="95b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装tensorflow，包括:</p><ul class=""><li id="604a" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated"><em class="lx"> pip3安装张量流</em></li></ul><p id="bc39" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装PixelLib与:</p><ul class=""><li id="268c" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated"><em class="lx"> pip3安装pixellib —升级</em></li></ul><p id="0a28" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">视频的语义分割:</strong></p><p id="05be" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">基于pascal voc模型的视频分割；</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="5934" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将在下面解释每一行代码。</p><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="0d1c" class="mf mg iq mb b gy mh mi l mj mk">import pixellib</span><span id="b7c7" class="mf mg iq mb b gy ml mi l mj mk">from pixellib.semantic import semantic_segmentation</span><span id="8c9e" class="mf mg iq mb b gy ml mi l mj mk">segment_video = semantic_segmentation()</span></pre><p id="8a77" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们导入了用于执行语义分段的类，并创建了该类的一个实例。</p><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="355c" class="mf mg iq mb b gy mh mi l mj mk">segment_video.load_pascalvoc_model("deeplabv3_xception_tf_dim_ordering_tf_kernels.h5")</span></pre><p id="fa10" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们加载了在pascal voc数据集上训练的xception模型来执行语义分割，它可以从<a class="ae ln" href="https://github.com/ayoolaolafenwa/PixelLib/releases/download/1.1/deeplabv3_xception_tf_dim_ordering_tf_kernels.h5" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="5829" class="mf mg iq mb b gy mh mi l mj mk">segment_video.process_video_pascalvoc("video_path",  overlay = True, frames_per_second= 15, output_video_name="path_to_output_video")</span></pre><p id="878b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们调用函数对视频文件进行分割。</p><p id="230f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它采用以下参数:-</p><ul class=""><li id="3008" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated"><em class="lx"> video_path </em>:我们要分割的视频文件的路径。</li><li id="961d" class="lo lp iq kt b ku mm kx mn la mo le mp li mq lm lt lu lv lw bi translated"><em class="lx">每秒帧数:</em>该参数用于设置保存的视频文件每秒帧数。在这种情况下，它被设置为15，即保存的视频文件每秒将有15帧。</li><li id="506f" class="lo lp iq kt b ku mm kx mn la mo le mp li mq lm lt lu lv lw bi translated"><em class="lx">输出_视频_名称:</em>保存的<em class="lx"> </em>分段视频的名称<em class="lx">。</em>输出的视频会保存在你当前的工作目录下。</li></ul><p id="6584" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"><em class="lx">sample _ video 1</em></strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr lz l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="16e4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> <em class="lx">输出视频</em> </strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr lz l"/></div></figure><p id="7d9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是使用pascal voc模型保存的分段视频。</p><p id="735c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="lx">现场摄像机的语义分割。</em></p><p id="6ff9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以使用相同的模型在相机上执行语义分割。这可以通过对用于处理视频文件的代码进行少量修改来实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ly lz l"/></div></figure><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="e841" class="mf mg iq mb b gy mh mi l mj mk">import cv2</span><span id="5a7c" class="mf mg iq mb b gy ml mi l mj mk">capture = cv2.VideoCapture(0)</span></pre><p id="a8ef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们导入了cv2并包含了捕捉相机帧的代码。</p><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="e148" class="mf mg iq mb b gy mh mi l mj mk">segment_video.process_camera_pascalvoc(capture,  overlay = True, frames_per_second= 15, output_video_name="output_video.mp4", show_frames= True,frame_name= "frame")</span></pre><p id="5337" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在执行分割的代码中，我们将视频的文件路径替换为<em class="lx">捕获</em>，即我们正在处理摄像机捕获的帧流，而不是视频文件。我们添加了额外的参数来显示相机的帧:</p><ul class=""><li id="473e" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated"><em class="lx">显示帧:</em>该参数处理分段摄像机帧的显示，按q退出帧的显示。</li><li id="f230" class="lo lp iq kt b ku mm kx mn la mo le mp li mq lm lt lu lv lw bi translated"><em class="lx">帧名:</em>这是显示的摄像机帧的名称。</li></ul><p id="5cce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">展示pixelLib使用pascal voc模型对摄像机输入进行语义分割的输出的演示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms lz l"/></div></figure><h2 id="9a7d" class="mf mg iq bd mt mu mv dn mw mx my dp mz la na nb nc le nd ne nf li ng nh ni nj bi translated">干得好！它能够成功地将我和我面前的塑料瓶分割开来。</h2><p id="b8fc" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated"><strong class="kt ir">视频实例分割:</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ly lz l"/></div></figure><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="23b2" class="mf mg iq mb b gy mh mi l mj mk">import pixellib<br/>from pixellib.instance </span><span id="7fa8" class="mf mg iq mb b gy ml mi l mj mk">import instance_segmentation segment_video = instance_segmentation()</span></pre><p id="cccd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们导入类来执行实例分段，并创建了类的一个实例。</p><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="3732" class="mf mg iq mb b gy mh mi l mj mk">segment_video.load_model("mask_rcnn_coco.h5")</span></pre><p id="b12a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们加载了在coco数据集上训练的maskrcnn模型来执行实例分割，它可以从<a class="ae ln" href="https://github.com/ayoolaolafenwa/PixelLib/releases/download/1.2/mask_rcnn_coco.h5" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="2053" class="mf mg iq mb b gy mh mi l mj mk">segment_video.process_video("video_path", frames_per_second = 20, output_video_name = "output_video.mp4")</span></pre><p id="1c78" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们调用该函数对视频文件执行<em class="lx">实例分割</em>。</p><p id="3e3c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它采用以下参数:-</p><ul class=""><li id="74ef" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated"><em class="lx"> video_path: </em>这是我们想要分割的视频文件的路径。</li><li id="7082" class="lo lp iq kt b ku mm kx mn la mo le mp li mq lm lt lu lv lw bi translated"><em class="lx">每秒帧数:</em>该参数用于设置保存的视频文件每秒帧数。在这种情况下，它被设置为15，即保存的视频文件每秒将有15帧。</li><li id="5fcc" class="lo lp iq kt b ku mm kx mn la mo le mp li mq lm lt lu lv lw bi translated"><em class="lx">输出_视频_名称:</em>这是保存的<em class="lx"> </em>分段视频的名称<em class="lx">。</em>输出的视频将保存在您当前的工作目录中。</li></ul><p id="5d1f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> <em class="lx">样本_视频2 </em> </strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr lz l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ly lz l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr lz l"/></div></figure><p id="3185" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以通过将参数<em class="lx"> show_bboxes </em>设置为<em class="lx"> true </em>来实现实例分割。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="2660" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> <em class="lx">输出视频</em> </strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr lz l"/></div></figure><p id="7825" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="lx">现场摄像机的实例分割。</em></p><p id="f32b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以在摄像机的帧上执行实例分割。这可以通过对用于处理视频文件的代码进行少量修改来实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ly lz l"/></div></figure><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="338d" class="mf mg iq mb b gy mh mi l mj mk">import cv2 </span><span id="496d" class="mf mg iq mb b gy ml mi l mj mk">capture = cv2.VideoCapture(0)</span></pre><p id="a46f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们导入了cv2并包含了捕捉相机帧的代码。</p><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="3212" class="mf mg iq mb b gy mh mi l mj mk">segment_video.process_camera(capture, show_bboxes = True, frames_per_second = 15, output_video_name = "output_video.mp4", show_frames = True, frame_name = "frame")</span></pre><p id="6ac1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在执行分段的代码中，我们替换了要捕获的视频文件路径，也就是说，我们正在处理摄像机捕获的帧流，而不是视频文件。为了显示摄像机画面，我们添加了额外的参数:</p><ul class=""><li id="a680" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated"><em class="lx">显示帧:</em>该参数处理分段摄像机帧的显示，按q退出帧显示</li><li id="2dcf" class="lo lp iq kt b ku mm kx mn la mo le mp li mq lm lt lu lv lw bi translated"><em class="lx">帧名:</em>这是显示的摄像机帧的名称。</li></ul><p id="1bc4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一个展示pixelLib使用Mask-RCNN对摄像机输入进行实例分割的输出的演示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms lz l"/></div></figure><h2 id="5176" class="mf mg iq bd mt mu mv dn mw mx my dp mz la na nb nc le nd ne nf li ng nh ni nj bi translated">干得好！它能够成功地检测到我和我的手机。</h2><blockquote class="np"><p id="bc4b" class="nq nr iq bd ns nt nu nv nw nx ny lm dk translated"><a class="ae ln" href="https://github.com/ayoolaolafenwa/PixelLib" rel="noopener ugc nofollow" target="_blank">访问PixelLib的官方github库</a></p><p id="6971" class="nq nr iq bd ns nt nu nv nw nx ny lm dk translated"><a class="ae ln" href="https://pixellib.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">访问PixelLib的官方文档</a></p></blockquote><p id="42f8" class="pw-post-body-paragraph kr ks iq kt b ku nz jr kw kx oa ju kz la ob lc ld le oc lg lh li od lk ll lm ij bi translated">通过以下方式联系我:</p><p id="1c7a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">电子邮件:<a class="ae ln" href="https://mail.google.com/mail/u/0/#inbox" rel="noopener ugc nofollow" target="_blank">olafenwaayoola@gmail.com</a></p><p id="2024" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">推特:<a class="ae ln" href="https://twitter.com/AyoolaOlafenwa" rel="noopener ugc nofollow" target="_blank"> @AyoolaOlafenwa </a></p><p id="ba5e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">脸书:<a class="ae ln" href="https://web.facebook.com/ayofen" rel="noopener ugc nofollow" target="_blank">阿尤拉·奥拉芬娃</a></p><p id="9227" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Linkedin: <a class="ae ln" href="https://www.linkedin.com/in/ayoola-olafenwa-003b901a9/" rel="noopener ugc nofollow" target="_blank">阿尤拉·奥拉芬娃</a></p></div></div>    
</body>
</html>