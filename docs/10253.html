<html>
<head>
<title>Boosting your Neural Networks with Tensorboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Tensorboard 增强你的神经网络</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/boosting-your-neural-networks-with-tensorboard-bc6ce815d55b?source=collection_archive---------40-----------------------#2020-07-19">https://towardsdatascience.com/boosting-your-neural-networks-with-tensorboard-bc6ce815d55b?source=collection_archive---------40-----------------------#2020-07-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="ir is gp gr it iu gh gi paragraph-image"><div class="ab gu cl iv"><img src="../Images/170ffa741f6bacbb93589146c19a9161.png" data-original-src="https://miro.medium.com/v2/0*OHuSJ2kE7uZZJnSr.gif"/></div></figure><div class=""/><div class=""><h2 id="05ba" class="pw-subtitle-paragraph jx iz ja bd b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dk translated">如何将你的实验结果形象化</h2></div><p id="04ca" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">神经网络(NNs)是强大的算法，通常用于深度学习任务。这类算法的美妙之处在于，神经网络是复合的，从某种意义上说，它们由多层组成，可以添加、删除、修改，通常还可以在训练后定制，以便尝试不同的网络配置(如果你想更深入地了解这种算法的功能，请查看我的文章<a class="ae ll" href="https://medium.com/dataseries/understanding-the-maths-behind-neural-networks-108a4ad4d4db" rel="noopener">这里</a>)。</p><p id="3180" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">这样做的最终目的是获得能够返回高精度的算法。</p><p id="6752" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">这就是为什么在训练时对算法中正在发生的事情以及训练后最相关的结果有一个有意义的见解，是机器学习项目管道中的一个关键步骤。带着这个目的，在这篇文章中，我将谈论<a class="ae ll" href="https://www.tensorflow.org/tensorboard" rel="noopener ugc nofollow" target="_blank"> Tensorboard </a>。</p><p id="ac22" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">Tensorboard 是一个强大的仪表板工具，可以通过<em class="lm"> pip </em>轻松安装，并且在不使您的代码变得更加复杂的情况下，能够返回一个非常有意义的仪表板，反映您的 NN 性能。</p><p id="fbe6" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">为了向您展示这个工具的强大功能，我将使用 Keras 设置一个图像分类器。</p><h2 id="997d" class="ln lo ja bd lp lq lr dn ls lt lu dp lv ky lw lx ly lc lz ma mb lg mc md me mf bi translated">用 Keras Sequential()构建卷积神经网络(CNN)</h2><p id="6aa7" class="pw-post-body-paragraph kp kq ja kr b ks mg kb ku kv mh ke kx ky mi la lb lc mj le lf lg mk li lj lk im bi translated">为了构建我的模型，我将使用一个卷积神经网络，使用<a class="ae ll" href="https://keras.io/guides/functional_api/" rel="noopener ugc nofollow" target="_blank"> t </a> he <code class="fe ml mm mn mo b">Sequential()</code>方法(您也可以使用<a class="ae ll" href="https://keras.io/guides/functional_api/" rel="noopener ugc nofollow" target="_blank"> Keras Functional API </a>来实现相同的目的)。</p><p id="2366" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">我要解决的任务是机密任务。更具体地说，我下载了时尚 MNIST 数据集(嵌入在 Keras 中)，其中包含 10 种不同时尚单品的图片。我们算法的目标将是正确地用相应的项目标记给定的图像。</p><p id="0098" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">因此，在开始构建模型之前，我们先来看看数据集。</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="c49d" class="ln lo ja mo b gy mx my l mz na">#downloading necessary packages</span><span id="a225" class="ln lo ja mo b gy nb my l mz na">import tensorflow as tf<br/>import datetime<br/>from tensorflow import keras<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/></span><span id="5654" class="ln lo ja mo b gy nb my l mz na">fashion_mnist = keras.datasets.fashion_mnist</span><span id="9fb8" class="ln lo ja mo b gy nb my l mz na">(train_images, train_labels), (test_images, test_labels) = fashion_mnist.load_data()</span><span id="0722" class="ln lo ja mo b gy nb my l mz na">#creating a list of labels</span><span id="7ab1" class="ln lo ja mo b gy nb my l mz na">class_names = ['T-shirt/top', 'Trouser', 'Pullover', 'Dress', 'Coat','Sandal', 'Shirt', 'Sneaker', 'Bag', 'Ankle boot']</span></pre><p id="7817" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">让我们检查第一个火车图像及其形状:</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="391c" class="ln lo ja mo b gy mx my l mz na">plt.figure()<br/>plt.imshow(train_images[0])<br/>plt.colorbar()<br/>plt.grid(False)<br/>plt.show()</span></pre><figure class="mp mq mr ms gt iu gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/8de4f4371675ab2e27bcf97e64f30275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*oJR4RxF53PW3ruKRhlohVA.png"/></div></figure><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="b8b3" class="ln lo ja mo b gy mx my l mz na">train_images.shape</span><span id="471f" class="ln lo ja mo b gy nb my l mz na">Output: (60000, 28, 28)</span></pre><p id="2172" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">因此，我们的训练集由 60000 张 28x28 像素的图像组成。如果图像是彩色的(RGB)而不是灰度的，我们在上面的张量中也会有第四维，表示通道。</p><p id="67d5" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">在构建模型之前，我们还需要三个步骤，即:</p><ul class=""><li id="a24f" class="nd ne ja kr b ks kt kv kw ky nf lc ng lg nh lk ni nj nk nl bi translated">重塑 4D 物体中的张量(以便它们与 2D 卷积层兼容)；</li></ul><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="aabd" class="ln lo ja mo b gy mx my l mz na">train_images = train_images.reshape((train_images.shape[0], 28, 28, 1))<br/>test_images = test_images.reshape((test_images.shape[0], 28, 28, 1))</span></pre><ul class=""><li id="4ddc" class="nd ne ja kr b ks kt kv kw ky nf lc ng lg nh lk ni nj nk nl bi translated">一键编码标签集(训练和测试)；</li></ul><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="1c25" class="ln lo ja mo b gy mx my l mz na">train_labels = to_categorical(train_labels)<br/>test_labels = to_categorical(test_labels)</span></pre><ul class=""><li id="24b0" class="nd ne ja kr b ks kt kv kw ky nf lc ng lg nh lk ni nj nk nl bi translated">在从 0 到 1 的范围内重新缩放像素(因为像素的范围是从 0 到 255)。</li></ul><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="6981" class="ln lo ja mo b gy mx my l mz na">train_images = train_images / 255.0<br/>test_images = test_images / 255.0</span></pre><p id="b263" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">太好了！现在让我们建立一个简单的 CNN，它有以下几层。注意，在本文中，我不打算深入探究每一层和整个结构背后的数学原理。如果你对 NNs 的特性感兴趣，我推荐你阅读这篇<a class="ae ll" href="https://medium.com/dataseries/understanding-the-maths-behind-neural-networks-108a4ad4d4db" rel="noopener">文章</a>。</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="aadf" class="ln lo ja mo b gy mx my l mz na">#initializing Tensorboard extension</span><span id="4f44" class="ln lo ja mo b gy nb my l mz na">%load_ext tensorboard</span><span id="70ba" class="ln lo ja mo b gy nb my l mz na">#creating a logs directory</span><span id="aaad" class="ln lo ja mo b gy nb my l mz na">log_dir = "logs/fit/" + datetime.datetime.now().strftime("%Y%m%d-%H%M%S")</span><span id="c17e" class="ln lo ja mo b gy nb my l mz na">tensorboard_callback = tf.keras.callbacks.TensorBoard(log_dir=log_dir, histogram_freq=1)</span><span id="21a0" class="ln lo ja mo b gy nb my l mz na"># number of possible label values<br/>nb_classes = len(class_names) #10</span><span id="8372" class="ln lo ja mo b gy nb my l mz na">model = tf.keras.models.Sequential()</span><span id="79c0" class="ln lo ja mo b gy nb my l mz na">model.add(tf.keras.layers.Conv2D(32,(3,3), padding='same', input_shape=(28, 28,1)))<br/>model.add(tf.keras.layers.MaxPooling2D(pool_size=(2, 2)))<br/>model.add(tf.keras.layers.Activation('relu'))<br/>model.add(tf.keras.layers.MaxPooling2D(pool_size=(2, 2)))<br/>model.add(tf.keras.layers.Dropout(0.25))<br/>model.add(tf.keras.layers.Flatten())</span><span id="d7d0" class="ln lo ja mo b gy nb my l mz na">model.add(tf.keras.layers.Dense(nb_classes, activation='softmax'))<br/>model.summary()</span></pre><figure class="mp mq mr ms gt iu gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/d66a2299a2924c34003e5f3c679fde2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XK79KR7xStwLC8ftltu5xg.png"/></div></div></figure><p id="8db3" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">现在让我们训练我们的模型，确保将训练集的 20%作为验证集:</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="dcbb" class="ln lo ja mo b gy mx my l mz na">log_dir = "logs/fit/" + datetime.datetime.now().strftime("%Y%m%d-%H%M%S")<br/>tensorboard_callback = tf.keras.callbacks.TensorBoard(log_dir=log_dir, histogram_freq=1)</span><span id="00b3" class="ln lo ja mo b gy nb my l mz na">model.fit(train_images, <br/>          train_labels, <br/>          validation_split=0.2,<br/>          epochs=10,  <br/>          callbacks=[tensorboard_callback])</span></pre><figure class="mp mq mr ms gt iu gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/534ec738128a48530304793014febf13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CyPs_n-KWsnIAQQCmXk2Cw.png"/></div></div></figure><p id="7194" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">注意，添加<code class="fe ml mm mn mo b">tf.keras.callbacks.TensorBoard</code>回调确保了日志的创建和存储:这在调用 Tensorboard 扩展时是需要的。</p><h2 id="b228" class="ln lo ja bd lp lq lr dn ls lt lu dp lv ky lw lx ly lc lz ma mb lg mc md me mf bi translated">用 Tensorboard 可视化这一切</h2><p id="bd55" class="pw-post-body-paragraph kp kq ja kr b ks mg kb ku kv mh ke kx ky mi la lb lc mj le lf lg mk li lj lk im bi translated">一旦我们的模型被训练好，通过使用<code class="fe ml mm mn mo b">%tensorboard logdir logs/fit</code> magic 命令，我们可以可视化我们的结果的一个很好的仪表板:</p><figure class="mp mq mr ms gt iu gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi ns"><img src="../Images/a952acf1cb701eb40921f1b573a3eeb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j8sZmfekOpo9qYSZ1YRiEQ.png"/></div></div></figure><figure class="mp mq mr ms gt iu gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nt"><img src="../Images/967c9f8ee35abe99d45e8bfcbb78103d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gBvAuVLczGK-jtyN88IkSA.png"/></div></div></figure><p id="a1d3" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">当然，一切都是互动的:</p><figure class="mp mq mr ms gt iu gh gi paragraph-image"><div class="ab gu cl iv"><img src="../Images/170ffa741f6bacbb93589146c19a9161.png" data-original-src="https://miro.medium.com/v2/0*OHuSJ2kE7uZZJnSr.gif"/></div></figure><p id="f9ea" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">正如你所看到的，Tensorboard 提供了各种各样的视觉项目，有助于深入了解 CNN 的表现和结构。请注意，在<em class="lm">图</em>字段中，您可以以互动的方式可视化您网络的整体结构。</p><figure class="mp mq mr ms gt iu gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/cc0f3159b24c19bc4c81423f8a83e6b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*JVKq9EFJt1fO1UQI.gif"/></div></figure><p id="94d8" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">因此，只需几行额外的代码，我们就成功地将我们的网络变成了一个具有非常有趣的洞察力的可视化仪表板。</p><p id="8673" class="pw-post-body-paragraph kp kq ja kr b ks kt kb ku kv kw ke kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">我希望你喜欢阅读！如果你对这个话题感兴趣，我建议你阅读文档部分的更多内容。</p><h2 id="3604" class="ln lo ja bd lp lq lr dn ls lt lu dp lv ky lw lx ly lc lz ma mb lg mc md me mf bi translated">参考资料:</h2><ul class=""><li id="92b4" class="nd ne ja kr b ks mg kv mh ky nv lc nw lg nx lk ni nj nk nl bi translated"><a class="ae ll" href="https://keras.io/guides/functional_api/" rel="noopener ugc nofollow" target="_blank">https://keras.io/guides/functional_api/</a></li><li id="cfb0" class="nd ne ja kr b ks ny kv nz ky oa lc ob lg oc lk ni nj nk nl bi translated">https://keras.io/</li><li id="39f9" class="nd ne ja kr b ks ny kv nz ky oa lc ob lg oc lk ni nj nk nl bi translated"><a class="ae ll" href="https://www.tensorflow.org/tensorboard/get_started" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/tensorboard/get_started</a></li><li id="c4fe" class="nd ne ja kr b ks ny kv nz ky oa lc ob lg oc lk ni nj nk nl bi translated">“用 Python 进行深度学习”，<em class="lm"> Francois Chollet </em></li></ul></div></div>    
</body>
</html>