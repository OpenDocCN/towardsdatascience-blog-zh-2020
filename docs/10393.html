<html>
<head>
<title>Getting Started with Jupyter + Spark on the Cloud in 2020</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2020 年云上的 Jupyter + Spark 入门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-started-with-jupyter-spark-on-the-cloud-in-2020-7f584fba0f3c?source=collection_archive---------43-----------------------#2020-07-21">https://towardsdatascience.com/getting-started-with-jupyter-spark-on-the-cloud-in-2020-7f584fba0f3c?source=collection_archive---------43-----------------------#2020-07-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="63d2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">轻松组装由大数据集群支持的笔记本电脑</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/02617404dbfd9314882122a5a13bb802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GfQKUP0rcPgjs4AP5lHKcw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">迪伦·诺尔特在<a class="ae kv" href="https://unsplash.com/s/photos/winning?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="1a5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2020 年是利用 Jupyter 和 Spark 集群深入研究大数据的大好时机。所有三大云提供商(Amazon Web Services、Microsoft Azure 和 Google Cloud)都配置了托管服务来运行集群，并预装了 Jupyter 和 Spark。随着大数据的爆炸式增长和低准入门槛(成本和工作量)，了解如何使用机器集群解决大数据问题正成为当今数据科学就业市场的一项必备技能。</p><p id="95eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将向您展示如何在 Google Cloud Dataproc 上使用 Jupyter 构建 Spark 集群。我们将回顾:</p><ol class=""><li id="6992" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">在 Dataproc 上配置 Spark 集群设置</li><li id="7d93" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">为 Jupyter 和 Anaconda 配置集群</li><li id="3eab" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">访问 Jupyter 笔记本</li></ol><h1 id="b9a4" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">在 Dataproc 上配置 Spark 集群设置</h1><p id="bed3" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">Dataproc 是 Google Cloud 的托管服务，用于运行 Apache Spark 和 Apache Hadoop 集群。我们将使用 Dataproc 来创建和管理我们的 Spark 集群。在您的 Google 云平台用户控制台中，导航到 Dataproc 并点击“创建集群”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/6d890794f0e38e64a18cf59ab5edc527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*h5w78XM83z2kn0Gweki7jA.png"/></div></figure><p id="7e00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将进入“创建集群”页面，其中包含您的机器集群的设置。在本教程中，我们将对主节点和工作节点使用默认的机器类型 n1-standard-4。如果您想节省一些钱，我建议降级到 n1-standard-2，而不是 n1-standard-1，因为 1 vCPU 机器需要更长的时间来启动。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/fff341f4a8aade69cfbc1dd23c0cd912.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*qQrdVxAm47k9v8ayAfBoPw.png"/></div></figure><h1 id="7724" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">为 Jupyter 和 Anaconda 配置集群</h1><p id="8cda" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">这就是令人兴奋的地方。几年前，你必须编写一个自定义脚本来安装 Jupyter 和 Anaconda。今天，你可以通过点击几个按钮得到同样的结果。选中“组件网关”下的“启用对 web 界面的访问”并展开“高级选项”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/50655208f8e2f79f66ac882af8c1abc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*G6B67B3-jR0uzDn8Y72SxQ.png"/></div></figure><p id="e34b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然是可选的，但是设置一个云存储分段存储桶。使用云存储桶可以将您的笔记本电脑保存在云中，并在您下次启动笔记本电脑时可用。</p><p id="660f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将机器的镜像设置为 1.5 (Debian 10、Hadoop 2.10、Spark 2.4)。根据我的经验，1.3 image 基于 Python 2，不能访问 Python 3 中开发的新工具。</p><p id="2ed3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里最重要的部分是可选组件下的“选择组件”。下图显示了可用的选项。</p><p id="9a73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，选中项目访问下的“允许 API 访问所有 Google 云服务”。这将允许您的集群访问其他 Google 云服务，如 BigQuery。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/ebf3dfc026ad8787c36c986bc6d95023.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*E4DtOF6GQKom01OALlBiiQ.png"/></div></figure><p id="c01c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在可选组件中，我们看到了各种可用的组件。默认安装了 Spark(未列出)，我们将选中 Anaconda 和 Jupyter 笔记本，然后单击“Select”保存我们的选择。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/06336aafb92ea74f06cac91077adce35.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*c5YaYGyAT6md7196x5IK5A.png"/></div></figure><p id="6fcf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回到“cluster settings”菜单，在启动集群之前，我们还有最后一个项目要设置。选中“计划删除”下的“按固定时间计划删除”。此选项确保您的群集在一段设定的时间后自行终止。Dataproc 根据集群保持运行的时间来计费。预设删除时间可以确保当我们忘记手动终止集群时，不会收到任何意外的账单。对于本教程，我们将删除时间设置为 2 小时。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/a3543329b877a3e4a6a926d0c3ee9b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*G4DlMzzF97FcrLH2WwCFsQ.png"/></div></figure><h1 id="6771" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">访问 Jupyter 笔记本</h1><p id="6dd4" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">就是这样！创建集群大约需要 3 到 10 分钟。一旦群集名称旁边的旋转图标变成绿点复选标记，请单击“web interfaces”选项卡和“Component gateway”下的“Jupyter”。如果 Jupyter 不可用，请确保您已按照上一节中的说明“启用对 web 界面的访问”并选择了可选组件。正如我们所看到的，我们在集群创建过程中选择的任何可选组件都将出现在 web interfaces 选项卡中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/96f897b40ddcfbc7234538602e17d2cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ay8M4_I2hjgGyhP8vJ5YrA.png"/></div></div></figure><p id="6af4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">迎接我们的是我们熟悉的 Jupyter 笔记本用户界面。点击“GCS”文件夹访问谷歌云存储桶。我们在该文件夹中上传或创建的任何文件都可以在我们之前在集群创建过程中设置的云桶中使用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/ccfaaf9eadf7f8e728fb977fe7f2e4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*xrP2PfjKispGhRB8Rjl1dQ.png"/></div></figure><p id="257d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的笔记本电脑有 4 种不同的内核。他们都可以进入我们的星火星团。我喜欢使用“Python 3”笔记本，因为它可以访问与 Anaconda 和 PySpark 一起安装的所有数据科学包。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/922fe0c45f872d6acfc8029eb5882032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FfHGf--fCV6s8M0OQxsV4Q.png"/></div></div></figure><p id="92ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还有维奥拉。你现在有一个运行在 Spark 集群上的 Jupyter 笔记本了！我们可以用下面的代码检查笔记本，以确保所有内容都正确加载。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/ddd254294bf0e1cc376f1612bbac61b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c2Pg-Ctx8Vm0f8fDFd4UWQ.png"/></div></div></figure><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="e966" class="ns mh iq no b gy nt nu l nv nw">!scala -version<br/></span><span id="1e85" class="ns mh iq no b gy nx nu l nv nw">import pandas as pd<br/>import numpy as np<br/>from pyspark.sql import SparkSession</span><span id="d8e6" class="ns mh iq no b gy nx nu l nv nw">spark = SparkSession.builder \<br/>  .appName('Jupyter BigQuery Storage')\<br/>  .config('spark.jars', 'gs://spark-lib/bigquery/spark-bigquery-latest_2.12.jar') \<br/>  .getOrCreate()</span><span id="1bcf" class="ns mh iq no b gy nx nu l nv nw">table = "bigquery-public-data.wikipedia.pageviews_2020"<br/>df = spark.read \<br/>  .format("bigquery") \<br/>  .option("table", table) \<br/>  .load()<br/>df.printSchema()</span><span id="8d5f" class="ns mh iq no b gy nx nu l nv nw">df_agg = df \<br/>  .select('wiki', 'views') \<br/>  .where("datehour = '2020-03-03'") \<br/>  .groupBy('wiki') \<br/>  .sum('views')<br/>df_agg.show()</span></pre><p id="f8ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦你完成了你的分析，确保删除你的集群，以避免额外的费用！运行本教程中的集群 2 小时大约需要 1 美元。您可以使用<a class="ae kv" href="https://cloud.google.com/products/calculator" rel="noopener ugc nofollow" target="_blank">Google Cloud Pricing Calculator</a>并选择 Dataproc 服务来估算您的集群的成本。</p><h1 id="f9e3" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">结束语</h1><p id="7a46" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">随着大数据的兴起，对于数据科学家来说，学习如何在云上使用 Jupyter + Spark 非常重要。这样，我们可以水平扩展我们的计算资源，而不仅仅是垂直扩展。在本教程中，我们在 Google Cloud Dataproc 上构建了一个加载了 Jupyter 和 Anaconda 的 Spark 集群。现在，让我们开始处理大数据吧！</p><p id="113b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不知道去哪里找大数据练习？查看我以前的一篇文章，关于谷歌公共数据集上可用的万亿字节数据集:<a class="ae kv" rel="noopener" target="_blank" href="/level-up-with-googles-public-datasets-5ffce0893ea0">用谷歌公共数据集升级</a>。</p><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/level-up-with-googles-public-datasets-5ffce0893ea0"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">用谷歌的公共数据集升级</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">将 Jupyter 笔记本电脑连接到万亿字节的数据</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op kp ob"/></div></div></a></div></div></div>    
</body>
</html>