<html>
<head>
<title>Web Automation Nightmares: 6 Tricks to Overcome Them</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Web 自动化噩梦:克服它们的 6 个技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/web-automation-nightmares-6-tricks-to-overcome-them-4241089953e3?source=collection_archive---------27-----------------------#2020-06-19">https://towardsdatascience.com/web-automation-nightmares-6-tricks-to-overcome-them-4241089953e3?source=collection_archive---------27-----------------------#2020-06-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/052a91fdfddb9bdad43512bb15649db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mnAor4IM0IQgrpK0"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://unsplash.com/@officestock?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">塞巴斯蒂安·赫尔曼</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><div class=""/><div class=""><h2 id="b500" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">当硒和美丽的食物不够的时候。</h2></div><p id="2c24" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lu translated">当我第一次发现 Python 的一些网络抓取库时，真是梦想成真。想想一个人能做的所有事情！可能性是无限的。不用说，当我想刮的那几页纸直接从地狱出来时，我的希望破灭了。</p><blockquote class="md me mf"><p id="83d1" class="ky kz mg la b lb lc kk ld le lf kn lg mh li lj lk mi lm ln lo mj lq lr ls lt im bi translated">当你开始怀疑如果你自己动手，这个过程会不会更快时，你知道你遇到了一个真正的障碍。</p></blockquote><p id="0d03" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">经过几个小时的搜索 StackOverflow，以下是我在开始自动化我的 web 流程时克服一些挑战的 6 个简单方法:</p><h1 id="d73b" class="mk ml jj bd mm mn mo mp mq mr ms mt mu kp mv kq mw ks mx kt my kv mz kw na nb bi translated">1.从 Selenium 导入例外</h1><p id="0bd7" class="pw-post-body-paragraph ky kz jj la b lb nc kk ld le nd kn lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated"><strong class="la jk">问题:</strong>有时候你想定位的按钮可能会被隐藏，可能是因为讨厌的弹出窗口。当您无法确定这些弹出窗口何时会弹出时，这就变得更加令人恼火了。而在其他时候，您的问题可能是由于互联网连接速度慢造成的…</p><p id="acf1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">解决方案:</strong>顺利抓取网页的道路布满了例外——并学习如何处理它们！每当发生这些异常时，知道自己有一个备份计划总是很方便的。首先导入它们:</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="3542" class="nq ml jj nm b gy nr ns l nt nu">from selenium.common.exceptions import NoSuchElementException</span><span id="17ed" class="nq ml jj nm b gy nv ns l nt nu">from selenium.common.exceptions import StaleElementReferenceException</span><span id="e7cc" class="nq ml jj nm b gy nv ns l nt nu">from selenium.common.exceptions import ElementClickInterceptedException</span><span id="4236" class="nq ml jj nm b gy nv ns l nt nu">from selenium.common.exceptions import ElementNotInteractableException</span></pre><p id="bf73" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后用 try/except 块解决可能出现的问题！</p><h1 id="174d" class="mk ml jj bd mm mn mo mp mq mr ms mt mu kp mv kq mw ks mx kt my kv mz kw na nb bi translated">2.让您的浏览器等待</h1><p id="01ab" class="pw-post-body-paragraph ky kz jj la b lb nc kk ld le nd kn lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">回到上一个问题:假设一个缓慢的互联网连接导致了 NoSuchElementException。上面提到的一种方法是使用 try/except 块让您的脚本等待 10 秒钟:</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="35ea" class="nq ml jj nm b gy nr ns l nt nu">try: <br/>    button = driver.find_element_by_id('button-id')<br/>    button.click()</span><span id="12c8" class="nq ml jj nm b gy nv ns l nt nu">except NoSuchElementException: <br/>    sleep(10)<br/>    button = driver.find_element_by_id('button-id')<br/>    button.click()</span></pre><p id="e7ba" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这很棒，而且很可能解决了问题(如果没有，那么你真的需要考虑修理那个路由器)，但是这意味着每次你想点击那个按钮的时候都必须等待整整 10 秒钟。</p><p id="5b33" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">解决方法:</strong>换个更优雅的方式怎么样？使用 WebDriverWait，并将按钮的可见性指定为条件！一旦找到按钮，你的浏览器就会停止等待，允许你点击它。每当你想找到一个按钮时，这可以节省你宝贵的时间:</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="6d2d" class="nq ml jj nm b gy nr ns l nt nu">from selenium.webdriver.support.ui import WebDriverWait<br/>from selenium.webdriver.support import expected_conditions as EC</span><span id="e6e6" class="nq ml jj nm b gy nv ns l nt nu">button = WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.XPATH, 'insert_button_xpath_here')))</span></pre><h1 id="0073" class="mk ml jj bd mm mn mo mp mq mr ms mt mu kp mv kq mw ks mx kt my kv mz kw na nb bi translated">3.用 Javascript 输入文本</h1><p id="237f" class="pw-post-body-paragraph ky kz jj la b lb nc kk ld le nd kn lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated"><strong class="la jk">问题:</strong>现在你正在填写一张表格，然后你意识到 Selenium 的<code class="fe nw nx ny nm b">send_keys()</code>选项是有帮助的，但是帮助<em class="mg">不够快</em>。当然，它能以最快的速度打字，但是你很快就会怀疑自己复制粘贴是否真的会更快。当你看到你的一大段文字在页面上一行一行慢慢串起来时，自我怀疑就开始了。</p><p id="71d2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">解决方案:</strong>通过执行脚本输入文本！这要容易得多，也不需要导入。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="6b5d" class="nq ml jj nm b gy nr ns l nt nu">text = text.replace('\n', '\\n')</span><span id="055c" class="nq ml jj nm b gy nv ns l nt nu">script='''document.getElementById("source").value='{}';'''.format(text)</span><span id="a6e8" class="nq ml jj nm b gy nv ns l nt nu">driver.execute_script(script)</span></pre><p id="4b2d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，您的文本值立即被设置，文本几乎立即出现在表单中！请注意，您应该首先在新行前面添加一个额外的反斜杠' \ '，否则它将不起作用。如果您使用大量文本，这尤其有用。</p><p id="778e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mg">另外，我唯一一次遇到这个问题是在输入外语时(在这种情况下，它不起作用)。如果有人找到了更好的解决方法，请告诉我！</em></p><h1 id="e6af" class="mk ml jj bd mm mn mo mp mq mr ms mt mu kp mv kq mw ks mx kt my kv mz kw na nb bi translated">4.使用动作链点击</h1><p id="b862" class="pw-post-body-paragraph ky kz jj la b lb nc kk ld le nd kn lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated"><strong class="la jk">问题:</strong>一些网站的格式很糟糕，或者找到一些带有 id(或任何其他属性)的按钮似乎无法工作。</p><p id="1540" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">解决方法:在这种令人沮丧的情况下，不要惊慌！有其他方法可以解决这个问题。<em class="mg">首先问问自己:</em> <em class="mg">什么是工作？也许我们可以利用这一点。</em></p><p id="a50b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在之前类似这样的体验中，我首先找到了我知道我肯定能识别的按钮，然后弄清楚了我想点击的按钮的相对位置，但却不能这样做。</p><p id="292d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为有了 ActionChains，你可以先找到一个工作按钮，然后通过选择的坐标偏移点击来点击屏幕上的任何地方！这在大多数情况下工作得很漂亮，但是找到坐标是关键的一步。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="879b" class="nq ml jj nm b gy nr ns l nt nu">from selenium.webdriver.common.action_chains import ActionChains</span><span id="2877" class="nq ml jj nm b gy nv ns l nt nu">ac = ActionChains(driver)</span><span id="6337" class="nq ml jj nm b gy nv ns l nt nu">ac.move_to_element(driver.find_element_by_id('insert_id_here').move_by_offset(x,y).click().perform()</span></pre><p id="2c27" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mg">现在</em>你可以点击屏幕上的任何地方！</p><h1 id="7b4d" class="mk ml jj bd mm mn mo mp mq mr ms mt mu kp mv kq mw ks mx kt my kv mz kw na nb bi translated">5.做人，随机应变</h1><p id="0498" class="pw-post-body-paragraph ky kz jj la b lb nc kk ld le nd kn lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated"><strong class="la jk">问题:</strong>最后，事情进展顺利，你收集了所有你需要的信息…直到你找到验证码。</p><p id="7093" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">解决方法:</strong>负责任的刮！在操作之间引入随机等待时间，以防止服务器过载。更重要的是，它可以防止你的脚本的重复模式被发现。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="ec80" class="nq ml jj nm b gy nr ns l nt nu">from time import sleep<br/>import random</span><span id="5741" class="nq ml jj nm b gy nv ns l nt nu">sleepTimes = [2.1, 2.8, 3.2]<br/>sleep(random.choice(sleepTimes))</span></pre><h1 id="1395" class="mk ml jj bd mm mn mo mp mq mr ms mt mu kp mv kq mw ks mx kt my kv mz kw na nb bi translated">6.最后，确保您的数据得到备份</h1><p id="ef0d" class="pw-post-body-paragraph ky kz jj la b lb nc kk ld le nd kn lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated"><strong class="la jk">问题:</strong>我一开始犯的一个新手错误就是没有引入备份选项，以防我的抓取在中途随机失败(有我的互联网中途断网的可能)。我只是在脚本的<em class="mg">结尾</em>将我收集的数据保存到一个文件中。这是个大错误。</p><p id="6eb2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">解决方案:</strong>备份数据有很多种方法。一些对我有用的方法:</p><ol class=""><li id="e0c0" class="nz oa jj la b lb lc le lf lh ob ll oc lp od lt oe of og oh bi translated">将我的数据的每个“条目”保存到一个 JSON 文件(或任何其他方便的格式)。这让我放心，因为我知道我的脚本运行的每个循环/页面都保存在我的计算机上的某个地方，如果有任何失败，我仍然有我的数据。这也是节省计算机内存的好方法。</li><li id="515f" class="nz oa jj la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated">将循环放在一个 try/except 块中，如果出现任何问题，它会将我的所有数据保存到一个文件中。</li></ol></div><div class="ab cl on oo hx op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="im in io ip iq"><figure class="nh ni nj nk gt iv"><div class="bz fp l di"><div class="ou ov l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">布伦特兰博的 Gif</p></figure><h1 id="cdeb" class="mk ml jj bd mm mn mo mp mq mr ms mt mu kp mv kq mw ks mx kt my kv mz kw na nb bi translated">成功了！</h1><p id="5f85" class="pw-post-body-paragraph ky kz jj la b lb nc kk ld le nd kn lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">这些只是除了简单的 BeautifulSoup 和 Selenium 库之外，您可以使用的许多技巧中的一部分。</p><p id="3db2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这有所帮助，感谢您的阅读！</p></div></div>    
</body>
</html>