<html>
<head>
<title>Scraping the web with Selenium on Google Cloud Composer (Airflow)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Google Cloud Composer 上用 Selenium 抓取网页(气流)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scraping-the-web-with-selenium-on-google-cloud-composer-airflow-7f74c211d1a1?source=collection_archive---------13-----------------------#2020-08-07">https://towardsdatascience.com/scraping-the-web-with-selenium-on-google-cloud-composer-airflow-7f74c211d1a1?source=collection_archive---------13-----------------------#2020-08-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/5a5a8ad6f0c6d0e5d90359bf8925d711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GIPiYv5DpGOwnk6A7RBacQ.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://unsplash.com/@macauphotoagency?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">澳门图片社</a>在<a class="ae jg" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><div class=""/><p id="b393" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">已经有很多不同的资源可以用来使用 Python 创建 web-scraper，这些资源通常基于众所周知的 Python 包<em class="le">urllib</em>+<em class="le">beautiful soup 4</em>或<em class="le"> Selenium 的组合。</em>当您面临抓取大量 javascript 的网页的挑战，或者需要与内容进行一定程度的交互，而这仅仅通过发送 URL 请求是无法实现的，那么<em class="le"> Selenium </em>很可能是您的首选。我不想在这里详细介绍如何设置您的抓取脚本，以及如何以可靠的方式运行它的最佳实践。我只是想参考一下我找到的<a class="ae jg" rel="noopener" target="_blank" href="/web-scraping-using-selenium-python-8a60f4cf40ab">这个</a>和<a class="ae jg" href="https://medium.com/the-andela-way/introduction-to-web-scraping-using-selenium-7ec377a8cf72" rel="noopener">这个</a>资源特别有帮助。</p><p id="aa3d" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我们想要解决的问题是:<strong class="ki jk">作为一名数据分析师/数据科学家，我如何建立一个协调的、完全受管理的流程，以最少的开发操作来促进 Selenium scraper？</strong>这种设置的主要用例是在云中运行所有抓取作业的托管和预定解决方案。</p><p id="624c" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用的工具有:</p><ul class=""><li id="9ba0" class="lf lg jj ki b kj kk kn ko kr lh kv li kz lj ld lk ll lm ln bi translated"><strong class="ki jk"> Google Cloud Composer </strong>用于安排作业和协调工作流程</li><li id="7503" class="lf lg jj ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><strong class="ki jk">硒</strong>为框架刮网站</li><li id="0ee9" class="lf lg jj ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><strong class="ki jk"> Google Kubernetes 引擎</strong>在云中部署 Selenium 远程驱动程序作为容器化的应用程序</li></ul><p id="1fa9" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<a class="ae jg" href="https://housinganywhere.com/" rel="noopener ugc nofollow" target="_blank"><em class="le">houssinganywhere</em></a>的时候，我们已经在使用<em class="le"/><a class="ae jg" rel="noopener" target="_blank" href="/testing-airflow-jobs-on-google-cloud-composer-using-pytest-9e0a1198b4cd"><em class="le">Google Cloud Composer</em>完成许多不同的任务</a>。Cloud Composer 是一个非常神奇的工具，可以轻松管理、调度和监控工作流，如<strong class="ki jk">有向无环图</strong>(Dag)。它基于开源框架<a class="ae jg" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank"><em class="le">Apache air flow</em></a>并使用纯 Python，这使得它非常适合在数据领域工作的每个人。如果您不是来自 DevOps，那么自行部署气流的准入门槛相对较高，这导致一些云提供商提供托管气流部署，谷歌的 Cloud Composer 就是其中之一。</p><p id="4ee9" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当部署 Selenium 进行 web 抓取时，我们实际上使用了所谓的 Selenium Webdriver。这个 WebDriver 是一个框架，允许你使用代码(<em class="le"> Java，。Net、PHP、Python、Perl、Ruby </em>。对于大多数用例，你只需下载一个可以直接与 WebDriver 框架交互的浏览器，例如<a class="ae jg" href="https://www.edureka.co/blog/selenium-chromedriver-and-geckodriver/" rel="noopener ugc nofollow" target="_blank"> Mozilla Geckodriver 或 ChromeDriver </a>。抓取脚本将在您的本地上启动一个浏览器实例<strong class="ki jk">，并执行指定的所有动作。在我们的用例中，事情有点复杂，因为我们希望在不使用任何本地资源的情况下，按照循环的时间表运行脚本。为了能够在云中部署和运行 web 抓取脚本，我们需要使用一个<em class="le">Selenium Remote web driver</em>(又名<em class="le"> Selenium Grid </em>)来代替 Selenium WebDriver。</strong></p><figure class="lu lv lw lx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lt"><img src="../Images/a91ec6af435fb8cc1dc95954ad77bb41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rTaL9of-fJ2TLVB6ZH1eTg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:<a class="ae jg" href="https://www.browserstack.com/guide/difference-between-selenium-remotewebdriver-and-webdriver" rel="noopener ugc nofollow" target="_blank">https://www . browser stack . com/guide/difference-between-selenium-remote web driver-and-web driver</a></p></figure></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h2 id="2363" class="mf mg jj bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">使用 Selenium Grid 运行远程 web 浏览器实例</h2><p id="8fac" class="pw-post-body-paragraph kg kh jj ki b kj my kl km kn mz kp kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">Selenium Grid 背后的思想是提供一个框架，允许您通过在一台或多台机器上运行 web 浏览器来运行并行抓取实例。在这种情况下，我们可以利用<a class="ae jg" href="https://hub.docker.com/r/selenium" rel="noopener ugc nofollow" target="_blank">提供的独立浏览器</a>(请记住，每个可用的浏览器，Firefox、Chrome 和 Opera 都是不同的图像)，它们已经被包装为 Docker 图像。</p><p id="fb98" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Cloud Composer 在 Google Kubernetes 引擎(GKE)集群上运行 Apache Airflow。此外，它与其他谷歌云产品完全集成。新的 Cloud Composer 环境的创建还附带了一个功能性 UI 和一个云存储桶。所有 Dag、插件、日志和其他所需文件都存储在这个桶中。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h2 id="17d8" class="mf mg jj bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">在 GKE 上部署并公开远程驱动程序</h2><p id="b5fd" class="pw-post-body-paragraph kg kh jj ki b kj my kl km kn mz kp kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">您可以使用下面的<em class="le"> selenium-firefox.yaml </em>文件为 Firefox 独立浏览器部署 docker 映像，并通过运行以下命令在您的资源上应用指定的配置:</p><pre class="lu lv lw lx gt nd ne nf ng aw nh bi"><span id="9280" class="mf mg jj ne b gy ni nj l nk nl">kubectl apply -f selenium-firefox.yaml</span></pre><p id="d1d8" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">配置文件描述了你想要创建的<strong class="ki jk">类型</strong>的对象，它是<strong class="ki jk">元数据</strong>以及<strong class="ki jk">规格</strong>。</p><figure class="lu lv lw lx gt iv"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="a812" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以在 Airflow 的管理界面中创建新的连接，然后在我们的插件中访问连接细节。连接细节要么在 yaml 文件中指定，要么可以在 Kubernetes 集群中找到。</p><figure class="lu lv lw lx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi no"><img src="../Images/66f407c1d5bf3bc6fd74a6cdf414bc35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0bQZTHlGUrTKV6poBApvg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">气流连接</p></figure><figure class="lu lv lw lx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi no"><img src="../Images/6f96d225dcec09439bfbfcdf71a68da0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aMuPvCB2LTWPn6d8WSro3A.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">GCP 上的 Kubernetes 发动机</p></figure><p id="5482" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">建立连接后，我们可以访问我们的抓取脚本(气流插件)中的连接，在那里我们连接到远程浏览器。</p><figure class="lu lv lw lx gt iv"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><p id="1b48" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">感谢</em><a class="ae jg" href="https://towardsdatascience.com/@massibelloni" rel="noopener" target="_blank"><em class="le">Massimo Belloni</em></a><em class="le">为实现本项目和本文提供的技术咨询和建议。</em></p></div></div>    
</body>
</html>