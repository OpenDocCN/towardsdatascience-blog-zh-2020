<html>
<head>
<title>Docker Storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">码头仓库</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/docker-storage-598e385f4efe?source=collection_archive---------12-----------------------#2020-07-12">https://towardsdatascience.com/docker-storage-598e385f4efe?source=collection_archive---------12-----------------------#2020-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="68fb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Docker 数据架构和持久存储</h2></div><p id="fac6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本节中，我们将讨论 docker 如何在本地文件系统上存储数据，了解哪些层是可写的，并加深我们对容器持久存储的了解。</p><ol class=""><li id="3919" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated"><a class="ae lk" rel="noopener" target="_blank" href="/a-concise-guide-to-docker-f6b6d5fb56f4">简介</a></li><li id="f666" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><a class="ae lk" href="https://medium.com/@gyani91/docker-file-179b5e3d9171" rel="noopener"> Docker 文件</a></li><li id="9b81" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><a class="ae lk" href="https://medium.com/@gyani91/docker-commands-bbf02780b785" rel="noopener">基本对接命令</a></li><li id="2723" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><a class="ae lk" href="https://medium.com/@gyani91/port-and-volume-mapping-c8bb09221f82" rel="noopener">端口和卷映射</a></li><li id="0efc" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><a class="ae lk" href="https://medium.com/@gyani91/docker-networking-919461b7f498" rel="noopener"> Docker 联网</a></li><li id="5625" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">Docker 存储(你在这里！)</li><li id="ec41" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><a class="ae lk" href="https://medium.com/@gyani91/docker-compose-44a8112c850a" rel="noopener"> Docker 撰写</a></li><li id="e0ff" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><a class="ae lk" href="https://medium.com/@gyani91/deleting-docker-entities-2f90e4a0a765" rel="noopener">删除 Docker 实体</a></li></ol><p id="c7e7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在 linux 系统上，docker 将与映像、容器、卷等相关的数据存储在<strong class="kh ir"> /var/lib/docker </strong>下。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/7ce83312fc14c2be59e4b7965e569d65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MiGJxyhghBXBZcim9LSZQQ.png"/></div></div><p class="mc md gj gh gi me mf bd b be z dk translated">Linux 系统上 Docker 文件的位置</p></figure><p id="5f2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们运行<em class="mg"> docker build </em>命令时，docker 为 docker 文件中的每条指令构建一个层。这些图像图层是只读图层。当我们运行<em class="mg"> docker run </em>命令时，docker 构建容器层，这是读写层。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mh"><img src="../Images/e924085dc72dfa1b54ad67926a21b333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZyDop_nTtu26CVpz5uFQUg.png"/></div></div><p class="mc md gj gh gi me mf bd b be z dk translated">Docker 层</p></figure><p id="41c3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在容器上创建新的文件，例如，下图中的<strong class="kh ir"> temp.txt </strong>。您还可以修改属于容器上图像层的文件，例如，下图中的<strong class="kh ir"> app.py </strong>。当您这样做时，会在容器层上创建该文件的本地副本，并且更改只存在于容器中，这称为写入时复制机制。这很重要，因为几个容器和子图像使用相同的图像层。只要容器还活着，容器上的文件就一直存在。当容器被销毁时，其上的文件/修改也被销毁。为了持久化数据，我们可以使用我们在上一节中看到的卷映射技术。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mi"><img src="../Images/0071109795f2b8666046fd9fef9df683.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9QGX7fzmiqVH2wi7nubaAA.png"/></div></div><p class="mc md gj gh gi me mf bd b be z dk translated">写入时复制机制</p></figure><p id="3cb9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用<strong class="kh ir"> docker volume create </strong>命令创建一个 docker 卷。这个命令将在<strong class="kh ir">/var/lib/docker/volumes</strong>目录中创建一个卷。</p><pre class="lr ls lt lu gt mj mk ml mm aw mn bi"><span id="c44e" class="mo mp iq mk b gy mq mr l ms mt">docker volume create data_volume</span></pre><p id="f38f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，当您运行<strong class="kh ir"> docker run </strong>命令时，您可以使用<strong class="kh ir"> -v </strong>标志来指定使用哪个卷。这称为卷安装。</p><pre class="lr ls lt lu gt mj mk ml mm aw mn bi"><span id="c00e" class="mo mp iq mk b gy mq mr l ms mt">docker run -v data_volume:/var/lib/postgres postgres</span></pre><p id="e3ff" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果该卷不存在，docker 会为您创建一个。现在，即使容器被销毁，数据也将保留在卷中。</p><p id="1422" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果希望将数据放在 docker 主机上的特定位置，或者磁盘上已经有数据，也可以将这个位置挂载到容器上。这被称为绑定安装。</p><pre class="lr ls lt lu gt mj mk ml mm aw mn bi"><span id="34ae" class="mo mp iq mk b gy mq mr l ms mt">docker run -v /data/postgres:/var/lib/postgres postgres</span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mu"><img src="../Images/515ed12956a739f91a377d714fe99067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OHcPcYW2cVDRlrBgR-o68w.png"/></div></div><p class="mc md gj gh gi me mf bd b be z dk translated">具有卷映射的持久存储</p></figure><p id="5476" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae lk" href="https://medium.com/@gyani91/docker-compose-44a8112c850a" rel="noopener">下一节</a>中，我们将了解 Docker Compose、它的文件和它的命令。</p><p id="2017" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">参考:</p><p id="6cca" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[1]穆姆沙德·曼南贝斯，<a class="ae lk" href="https://kodekloud.com/p/docker-for-the-absolute-beginner-hands-on" rel="noopener ugc nofollow" target="_blank"> Docker for the Absolute 初学者</a> (2020)，KodeKloud.com</p></div></div>    
</body>
</html>