<html>
<head>
<title>Automatic data registration for Azure Machine Learning workspaces</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure机器学习工作区的自动数据注册</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automatic-data-registration-for-azure-machine-learning-workspaces-65beb7d81521?source=collection_archive---------61-----------------------#2020-05-29">https://towardsdatascience.com/automatic-data-registration-for-azure-machine-learning-workspaces-65beb7d81521?source=collection_archive---------61-----------------------#2020-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9cc4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">大规模数据科学环境的再现性</h2></div><h1 id="f909" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">A.介绍</h1><p id="fa7f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Azure机器学习(AML)工作区是一个很好的平台，数据科学家和数据工程师可以在这个平台上协作并从事不同的项目。它将笔记本编码环境、为代码提供动力的计算目标、保存数据源引用的数据集和数据存储库以及跟踪实验的方法结合在一起。</p><p id="f1c8" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">虽然围绕此工作区的大多数任务都可以通过用户界面或云外壳/命令行来完成，但是一旦您向外扩展到大量工作区或数据源，手动管理所有资源就会变得难以承受。</p><p id="6c15" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">博客是github repo的伙伴。</p><h2 id="c555" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">这个项目的目的</h2><ul class=""><li id="0b6d" class="mo mp it lc b ld le lg lh lj mq ln mr lr ms lv mt mu mv mw bi translated">创建一种自动注册和管理AML工作区数据的方法(步骤1-4)</li><li id="1aaa" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">将这些任务的有用脚本打包到可以从一个控制点触发的容器中(步骤5-6)</li><li id="7e24" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">启用授权和身份验证措施，以确保解决方案“企业就绪”(步骤7)</li></ul><h2 id="f4b1" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">一些好处:</h2><ul class=""><li id="be15" class="mo mp it lc b ld le lg lh lj mq ln mr lr ms lv mt mu mv mw bi translated">可再现性:不同项目/团队的相同数据(和版本)</li><li id="73d2" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">可伸缩性:易于管理不同的团队/项目:例如，运行Azure数据工厂管道来(同时)在整个域的所有工作区和订阅中填充新数据。</li><li id="14da" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">数据跟踪:定义RBAC，将触发这些任务的权限授予少数团队成员，以提高安全性和可跟踪性</li></ul><h2 id="fee9" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">使用的技术</h2><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/e988084151586a70aee968612c0a64b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*cwIK5DrgAV2i5vkmePXuGg.png"/></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">该解决方案的功能架构:展示了由ADF触发的python Web应用程序，该应用程序将数据从数据湖存储区移动到各种AML工作区，然后再返回。<em class="no">作者图片</em></p></figure><p id="59de" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在<a class="ae mb" href="https://github.com/iuliaferoli/azureML_python_webapp_extensions" rel="noopener ugc nofollow" target="_blank"> github仓库</a>项目中</p><ul class=""><li id="020f" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">Python和azureml-SDK</li><li id="78b3" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">Flask，用于修改python脚本以作为web服务运行</li></ul><p id="0de2" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在这个Azure教程博客中</p><ul class=""><li id="5c73" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">Azure数据湖作为您的数据源</li><li id="904e" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">Azure机器学习工作区是注册数据的地方</li><li id="a789" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">Azure Web服务</li><li id="9596" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">Azure数据工厂触发对web应用的HTTP请求</li><li id="90f8" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">为了使这个解决方案安全，我们将使用Azure授权和认证概念:服务主体、密钥库、托管身份、AAD。</li></ul><h1 id="648d" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">B.辅导的</h1><h2 id="aa52" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">资源部署</h2><p id="f1f9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在本节中，我们将介绍必要资源的部署。查看Azure文档演练和更多信息的链接。</p><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ns"><img src="../Images/ee35ed1f3dac9abbc5d6f24aadfd6689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ufpAHmU8uAb5AubySZ7xVw.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">你在Azure上的新项目资源组。我在西欧部署了一切<em class="no">图片作者</em></p></figure><h2 id="886f" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">1.<a class="ae mb" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-manage-workspace#create-a-workspace" rel="noopener ugc nofollow" target="_blank"> Azure机器学习工作区</a></h2><ul class=""><li id="8af3" class="mo mp it lc b ld le lg lh lj mq ln mr lr ms lv mt mu mv mw bi translated">可以跨不同的资源组或区域</li><li id="1d9d" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">在本教程中，我创建了一个“基本”AML实例。</li></ul><h2 id="e4bc" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">2.具有至少一个容器和至少一个文件的数据湖或blob存储</h2><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi nx"><img src="../Images/2762184f5e0e82bd4faf37c8202af306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WPdrnVUXVVzlCaG8ZnRX2A.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">我在medium-webapp-aml资源组中名为mediumstoragetutorial的存储帐户。<em class="no">作者图片</em></p></figure><ul class=""><li id="00e5" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">创建一个存储帐户，并确保在高级设置中启用“分层命名空间”，使其成为一个数据湖。</li><li id="9bf4" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">我创建了一个名为silver的“主”容器(假设数据将来自您的业务中先前生成数据的任何流程)</li><li id="ad89" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">我添加了包含模拟数据的文件夹:一个会计和销售容器，每个容器包含一个csv文件，我们稍后需要在工作区中注册该文件。</li></ul><h2 id="05c9" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">3.服务主体</h2><ul class=""><li id="746c" class="mo mp it lc b ld le lg lh lj mq ln mr lr ms lv mt mu mv mw bi translated">在这个自动化场景中，服务主体(sp)用于向AML进行身份验证，而不是用户每次运行都必须使用Azure凭据登录。</li></ul><p id="1d84" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">3.1.我们将在您的AAD <a class="ae mb" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-setup-authentication#set-up-service-principal-authentication" rel="noopener ugc nofollow" target="_blank">(链接)</a> <a class="ae mb" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal" rel="noopener ugc nofollow" target="_blank">(链接)</a>上注册一个服务主体作为应用程序</p><ul class=""><li id="b735" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">点击Azure门户右上角的&gt; _图标，打开Azure云外壳。</li><li id="4b93" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">通过使用您想要的任何名称而不是sp-medium-demo运行此命令来创建服务主体:</li></ul><pre class="nd ne nf ng gt ny nz oa ob aw oc bi"><span id="6e43" class="mc kj it nz b gy od oe l of og">az ad sp create-for-rbac --sdk-auth --name sp-medium-demo</span></pre><ul class=""><li id="22aa" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">保存您在json响应中获得的<code class="fe oh oi oj nz b">clientId</code>、<code class="fe oh oi oj nz b">clientSecret</code>和<code class="fe oh oi oj nz b">tenantId</code>字段，以备后用(它们将进入您的密钥库</li></ul><p id="3eb1" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">3.2授予其对您的AML和存储帐户的必要权限</p><ul class=""><li id="4938" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">转到您的门户，打开机器学习和存储帐户资源，准备好您为服务负责人指定的名称，以添加到“角色分配”页面。</li></ul><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ok"><img src="../Images/e3d12d7bd3e41385ecefe6b003a11ec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0xsKC0Ux9GYPZXEj8mFwXA.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated"><em class="no">角色分配菜单。作者图片</em></p></figure><ul class=""><li id="deaa" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">将服务负责人应用程序C <em class="ol">贡献者</em>添加到您的AML工作区</li><li id="37c2" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">使sp成为您的存储帐户的<em class="ol">存储Blob数据读取器</em></li></ul><h2 id="3e4a" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">4.钥匙库</h2><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi om"><img src="../Images/e22a397cc93d447386773b9956de0ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2mk1y4AZWOLvfn3AAYwVOQ.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">github中的代码片段，在register_data.py. <em class="no">文件中。图片作者</em></p></figure><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi on"><img src="../Images/6d75b1adef50a5aedf1bf50c191049b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nSWbm1G6S_YaYIDaewBJnw.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">向密钥库添加秘密。<em class="no">作者图片</em></p></figure><ul class=""><li id="955c" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">在您的资源组中创建一个密钥库，并创建三个秘密来存储您刚刚创建的服务主体的凭证。(<em class="ol">不带引号</em>)</li><li id="05b8" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated"><a class="ae mb" href="https://github.com/iuliaferoli/azureML_python_webapp_extensions#2-run-the-code-locally--fill-in-missing-details" rel="noopener ugc nofollow" target="_blank">您稍后将克隆的代码</a>从密钥库中获取这些凭证，以确保自动化的&amp;安全认证/授权。</li><li id="41f8" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">所以为了简单起见，你可以为你的秘密使用相同的名字，<code class="fe oh oi oj nz b"><strong class="lc iu">tenant-id</strong></code><strong class="lc iu"/><code class="fe oh oi oj nz b"><strong class="lc iu">sp-id</strong></code><strong class="lc iu"/><code class="fe oh oi oj nz b"><strong class="lc iu">sp-password</strong></code>为<code class="fe oh oi oj nz b">tenantId,</code> <code class="fe oh oi oj nz b">clientId</code>，以及在第3.1步得到的<code class="fe oh oi oj nz b">clientSecret</code>值</li></ul><h2 id="2e4f" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">4.部署在Web应用程序中的代码(进行数据注册)，可在我的github上获得<a class="ae mb" href="https://github.com/iuliaferoli/azureML_python_webapp_extensions" rel="noopener ugc nofollow" target="_blank">。</a></h2><ul class=""><li id="0fb0" class="mo mp it lc b ld le lg lh lj mq ln mr lr ms lv mt mu mv mw bi translated">在您选择IDE中克隆存储库。我将使用<a class="ae mb" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a> (VSC)，以便更容易与Azure Web App集成。</li><li id="ef35" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">C <a class="ae mb" href="https://code.visualstudio.com/docs/editor/github#_cloning-a-repository" rel="noopener ugc nofollow" target="_blank">孤独的VSC github库教程</a></li><li id="857a" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">您可以通过将Visual Studio代码作为flask应用程序运行来测试该代码是否已正确导入Visual Studio代码，如repo readme中的<a class="ae mb" href="https://github.com/iuliaferoli/azureML_python_webapp_extensions#3-optional-run-the-code-as-a-web-application-locally" rel="noopener ugc nofollow" target="_blank">所述。</a></li></ul><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi oo"><img src="../Images/558b7405fa3eceb2d61b459e9b0d109e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tm9A_svsxg4aDA351tDLgQ.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">运行代码时Visual Studio代码环境的屏幕截图。<em class="no">作者图片</em></p></figure><ul class=""><li id="9caf" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">在这段代码中，您唯一需要自己填写的是到您新创建的密钥库(DNS名称:yourname.vault.azure.net)的<strong class="lc iu">链接，以及秘密的名称(如果您更改了它们，请参见步骤4)，请参见<a class="ae mb" href="https://github.com/iuliaferoli/azureML_python_webapp_extensions#2-run-the-code-locally--fill-in-missing-details" rel="noopener ugc nofollow" target="_blank"> github自述文件中的说明。</a></strong></li><li id="4294" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">要访问密钥库，您需要在密钥库访问策略中添加机密阅读器权限。你可以从现在开始运行代码的地方(例如一个VM)这样做，但是在本教程中，我们在下一步中只将这些权限直接授予web-app。</li><li id="7996" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">因此，<code class="fe oh oi oj nz b">/send_data</code> POST请求应该还不能工作，这对安全性来说是件好事</li></ul><h2 id="c68c" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">5.<a class="ae mb" href="https://docs.microsoft.com/en-us/azure/developer/python/tutorial-deploy-app-service-on-linux-01" rel="noopener ugc nofollow" target="_blank">一个web应用</a>来托管您的python应用</h2><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi op"><img src="../Images/65a58db7aca7cc49647cb700ad582755.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0mvC6gL7OyyXRqIDf7FQw.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">我通过门户创建了“数据注册”应用程序，然后从您的资源中通过名称选择它来更改配置。<em class="no">作者图片</em></p></figure><ul class=""><li id="1cf7" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">在Azure上创建一个“Web服务”,运行时栈用Python，操作系统用Linux。部署后转到资源。</li><li id="f7e6" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">更改您的应用程序服务<a class="ae mb" href="https://docs.microsoft.com/en-us/azure/developer/python/tutorial-deploy-app-service-on-linux-04#flask-startup-commands" rel="noopener ugc nofollow" target="_blank">的启动命令，以匹配您的</a> flask应用程序的名称，并执行以下操作:</li></ul><pre class="nd ne nf ng gt ny nz oa ob aw oc bi"><span id="62ba" class="mc kj it nz b gy od oe l of og">gunicorn --bind=0.0.0.0 --timeout 600 app_body:app</span></pre><ul class=""><li id="b6dd" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">(见左图)然后保存配置。</li></ul><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi oq"><img src="../Images/b966f59ee476139a50cd3f292b145bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELQA473WErCZR_hZI295uA.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">我创建的数据注册应用程序现在可以在VSC看到。<em class="no">作者图片</em></p></figure><ul class=""><li id="111a" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">现在，您需要将Visual Studio中的代码连接到您在Azure门户上创建的应用程序。</li><li id="32ac" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated"><a class="ae mb" href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azureappservice" rel="noopener ugc nofollow" target="_blank">为VSC安装azure web服务插件</a>，然后根据需要使用您的azure凭据登录。</li><li id="78ff" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">现在你将在VSC拥有蓝色之刃(1。图片中)，您可以在您的订阅下的列表中看到您创建的web应用程序。单击标有deploy (2。)</li><li id="e67b" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">当命令托盘要求时，填写克隆的repo中的“app”文件夹和新部署的web的名称。然后单击accept，现在您就可以将python flask应用程序和依赖项部署到您的新网站了。</li><li id="f60f" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">部署完成后，请访问网站。它应该说“你好，尤利亚！”—将<code class="fe oh oi oj nz b">app_body.py</code>中的此消息更改为您想要的任何内容。</li></ul><p id="b231" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">5.05允许Web应用程序访问密钥库</p><ul class=""><li id="ffc7" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">对于web应用程序的另一个页面，即<code class="fe oh oi oj nz b">/send_data</code>，我们需要Web应用程序从您在步骤4中设置的密钥库中读取秘密。</li><li id="463d" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">首先，Web应用程序需要一个身份来授权。在门户中启用此功能，方法是转到您的web应用程序，然后转到身份设置:</li></ul><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi or"><img src="../Images/78ef5567c59665dcf1d954a0083a4a95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fep2NrOjEkfFctna96gV3g.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">为您的web应用程序启用系统分配的身份，然后保存。<em class="no">作者图片</em></p></figure><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi os"><img src="../Images/810cb71b0c5cbcae12088b9969b173b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YOGZt8AWEsq2cT1Uy73ntA.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated"><em class="no">作者图片</em></p></figure><ul class=""><li id="9ac3" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">现在转到门户中的密钥库，检查访问策略设置。单击以添加新的访问策略，并搜索您刚刚为其创建身份的Web应用的名称；在保存上一步之前，它不会显示在列表中)</li><li id="28e0" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">使用<em class="ol">秘密管理</em>权限模板，在<em class="ol">选择负责人</em>下选择您的Web App名称并保存。然后再次保存对所有访问策略的修改。</li><li id="e600" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">现在，您的web应用程序可以向<code class="fe oh oi oj nz b">/send_data</code>选项卡发送post请求，并使用密钥库中的凭证注册您的数据。</li></ul><h2 id="4515" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated"><a class="ae mb" href="https://docs.microsoft.com/en-us/azure/data-factory/quickstart-create-data-factory-portal" rel="noopener ugc nofollow" target="_blank"> 6。一个Azure数据工厂</a>实例向你的web应用发送请求</h2><ul class=""><li id="6fbd" class="mo mp it lc b ld le lg lh lj mq ln mr lr ms lv mt mu mv mw bi translated">部署Azure数据工厂，通过Author &amp; Monitor打开实例，然后单击create pipeline。</li><li id="d13e" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">现在搜索“Web”活动，并将其拖动到您的管道区域。这将是你管道中的唯一一步。</li><li id="d73a" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">填写您部署的web应用程序的名称，选择POST request，并填写您的请求主体，作为您克隆的代码的JSON输入。<a class="ae mb" href="https://github.com/iuliaferoli/azureML_python_webapp_extensions/blob/master/Runthrough%20example.md#inputs--running" rel="noopener ugc nofollow" target="_blank">点击</a>查看如何创建这个JSON。</li></ul><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ot"><img src="../Images/5fa994c30634b4d5d10252985a4b225b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WpXFuyC3Lht_bwgG4gygIw.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated"><em class="no">作者图片</em></p></figure><ul class=""><li id="aa86" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">您现在可以调试或立即触发来运行您的函数。</li><li id="449f" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">管道成功后，您现在可以检查您的AML工作区。您通过JSON发送的数据存储/数据集现在应该已经注册并可用了！</li></ul><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/6ceca8fdf7cc356dd56f2d07220d0f70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*CyfeTzgnP-vgzTkrfzocvg.png"/></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">成功！！作者图片</p></figure><h1 id="56ca" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">C.增强安全性</h1><h2 id="15b3" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">7.安全和授权限制</h2><h2 id="c45f" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">为什么</h2><p id="3b1a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">此时，任何人都可以调用您的web应用程序，这不是一个健壮和安全的解决方案。</p><p id="7770" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">虽然没有数据通过HTTP请求发送，但应用程序也没有提供任何关于应用程序的信息；这仍然不是尽可能健壮和安全的解决方案(也不是企业解决方案所必需的)</p><h2 id="9b10" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">解决办法</h2><p id="3033" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">期望的状态:只有你的Azure数据工厂实例被授权调用你的Web应用，从而将数据注册到你的工作区。</p><ul class=""><li id="8ace" class="mo mp it lc b ld lw lg lx lj np ln nq lr nr lv mt mu mv mw bi translated">我们通过激活数据工厂的托管标识来实现这一点；这样就可以像授权给用户一样授权给它</li><li id="3d91" class="mo mp it lc b ld mx lg my lj mz ln na lr nb lv mt mu mv mw bi translated">通过设置对Web应用程序的AAD认证，用户(或应用程序)必须登录，并且他们的帐户必须具有正确的授权才能进行呼叫。</li></ul><h2 id="c0b4" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">履行</h2><p id="4c28" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我的同事René Bremer已经设计了这个解决方案，他在github上有一个资源库。按照步骤去做。你只需要从Azure功能适应Web应用程序(无论如何都是同样的步骤)。</p><p id="0f05" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">这是他设计的安全流程:</p><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ov"><img src="../Images/99fef97e319147dd0a539d767d66e6d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUFJOQE18OPys8njlEztcQ.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">由勒内·布雷默创作</p></figure><h1 id="e13c" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结束了</h1><p id="99e4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">希望这对您有用，无论是完整的解决方案，还是您可以在不同项目中使用的独立部分！</p></div></div>    
</body>
</html>