<html>
<head>
<title>Loops in BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BigQuery 中的循环</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/loops-in-bigquery-db137e128d2d?source=collection_archive---------5-----------------------#2020-07-07">https://towardsdatascience.com/loops-in-bigquery-db137e128d2d?source=collection_archive---------5-----------------------#2020-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fc8c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用 BigQuery 脚本通过 for 循环计算斐波那契数</h2></div><p id="e35c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated"><span class="l lf lg lh bm li lj lk ll lm di"> E </span> ver 想在 SQL 中循环？嗯，<strong class="kk iu">你可以用脚本</strong>。让我们看看如何用循环在 BigQuery 中计算<strong class="kk iu">斐波那契数。</strong></p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/c372b742efc5a246036d1befc63b9c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*woB-xH2yji8LDStZKczeKQ.jpeg"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">在 BigQuery 中执行循环！—<a class="ae md" href="https://unsplash.com/@daisybisley?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Claire Satera</a>在<a class="ae md" href="https://unsplash.com/s/photos/loop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><blockquote class="me mf mg"><p id="acfc" class="ki kj mh kk b kl km ju kn ko kp jx kq mi ks kt ku mj kw kx ky mk la lb lc ld im bi translated">我之前展示了如何用 JavaScript UDF(用户定义的函数)在 BigQuery 中实现<a class="ae md" rel="noopener" target="_blank" href="/fibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6"> Fibonacci，也讨论了 BigQuery </a>中的<a class="ae md" rel="noopener" target="_blank" href="/fizzbuzz-in-bigquery-e0c4fbc1d195">数组，所以如果你是 BigQuery 的新手，先看看这些。</a></p></blockquote></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="319c" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">脚本基础</h1><p id="621a" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">在我们开始计算斐波那契数列之前，让我们先讨论一下 SQL 脚本的构建模块。在编程语言(比如 Python)中，用一些值设置变量，然后处理这些变量是很自然的，而在 SQL 中，通常是从表中的一些数据开始。</p><blockquote class="np"><p id="337f" class="nq nr it bd ns nt nu nv nw nx ny ld dk translated">要获得所有媒体文章的完整信息——包括我的——请点击这里订阅<a class="ae md" href="https://niczky12.medium.com/membership" rel="noopener">。</a></p></blockquote><p id="1c11" class="pw-post-body-paragraph ki kj it kk b kl nz ju kn ko oa jx kq kr ob kt ku kv oc kx ky kz od lb lc ld im bi translated">使用 SQL 脚本，你可以声明变量，然后在计算中使用它们。问题是(对于那些来自动态类型语言的人来说)你需要在开始使用它们之前<strong class="kk iu">声明每个变量的类型</strong>，这些类型永远不会改变。</p><blockquote class="np"><p id="4af8" class="nq nr it bd ns nt nu nv nw nx ny ld dk translated">使用 SQL 脚本，您可以声明变量，然后在计算中使用它们，执行 for 循环等。</p></blockquote><p id="1e42" class="pw-post-body-paragraph ki kj it kk b kl nz ju kn ko oa jx kq kr ob kt ku kv oc kx ky kz od lb lc ld im bi translated">让我们声明第一个变量，并将其打印到控制台:</p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="6c58" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在这里执行的步骤是:</p><ul class=""><li id="ee84" class="og oh it kk b kl km ko kp kr oi kv oj kz ok ld ol om on oo bi translated">关键字<code class="fe op oq or os b">DECLARE</code>用名称<code class="fe op oq or os b">uninteresting_number</code>和类型<code class="fe op oq or os b">INT64</code>实例化我们的变量。</li><li id="efcc" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">we <code class="fe op oq or os b">SET</code>中的<strong class="kk iu">号的值</strong>到<a class="ae md" href="https://en.wikipedia.org/wiki/Interesting_number_paradox" rel="noopener ugc nofollow" target="_blank"> 1729 </a>。</li><li id="2806" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">最后，我们只需选择数字，将其打印到控制台。</li></ul><blockquote class="me mf mg"><p id="dca3" class="ki kj mh kk b kl km ju kn ko kp jx kq mi ks kt ku mj kw kx ky mk la lb lc ld im bi translated">如果想把变量的声明和设置一气呵成，也可以使用<code class="fe op oq or os b">DEFAULT</code>实参:<code class="fe op oq or os b">DECLARE my_number INT64 DEFAULT 1729;</code>。</p></blockquote><p id="1e54" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们想更新我们的变量，那么我们再次使用<code class="fe op oq or os b">SET</code>关键字来这样做:</p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="934c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里，我们首先将<code class="fe op oq or os b">c</code>设置为等于<code class="fe op oq or os b">a</code>，然后将<code class="fe op oq or os b">c</code>增加<code class="fe op oq or os b">b</code>，得到如下结果:</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/ddd1789b0e2f0a5dbe9d7e40cf603f96.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*SGt2bG4U1MueHMARFgJGHQ.png"/></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">看，妈妈，我会做数学！</p></figure><h1 id="bbf5" class="ms mt it bd mu mv oz mx my mz pa nb nc jz pb ka ne kc pc kd ng kf pd kg ni nj bi translated">斐波那契数列</h1><p id="cde6" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">现在我们知道了如何声明和设置变量，<strong class="kk iu">让我们开始循环</strong>。首先，我们需要弄清楚我们的算法将如何工作。这里有一个让它工作的方法:</p><ol class=""><li id="83d6" class="og oh it kk b kl km ko kp kr oi kv oj kz ok ld pe om on oo bi translated">设置一个数组<code class="fe op oq or os b">[0,1]</code>——斐波那契数列的前两个元素。</li><li id="4283" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld pe om on oo bi translated">要求用户输入<code class="fe op oq or os b">n</code> —我们将产生序列的前 n 个数字。</li><li id="e5f0" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld pe om on oo bi translated">在每次迭代(<code class="fe op oq or os b">n</code>次)中，将数组最后 2 个元素的和追加到数组中。</li></ol><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="647a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这使我们得到以下结果:</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/c975c8bdf3eaf6f9c099acf5eed536ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*IVL8PR8cYYaEinD2hVLudw.png"/></div></figure><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="pg of l"/></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">看看我们在做 WHILE 循环！— <a class="ae md" href="https://tenor.com/view/rick-and-morty-poopybutthole-oooweee-meme-chalkboard-gif-16063441" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="4d5c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">代码中的注释解释了大部分内容，但只是澄清一下:</p><ul class=""><li id="e2d6" class="og oh it kk b kl km ko kp kr oi kv oj kz ok ld ol om on oo bi translated">我们声明<code class="fe op oq or os b">n</code>来知道我们需要生成多少个数字。</li><li id="ffc8" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">我们声明我们的斐波纳契数列为<code class="fe op oq or os b">f=[0,1]</code>——这是我们的第 0 和第 1 个斐波纳契数列的起点。<em class="mh">仅供参考，</em> <code class="fe op oq or os b"><em class="mh">f</em></code> <em class="mh">代表斐波那契。</em>😃</li><li id="6850" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">我们声明<code class="fe op oq or os b">i</code>，我们的计数器知道我们已经生成了多少个数字。我们将此设置为 1，因为我们在<code class="fe op oq or os b">f</code>中已经有了第 0 和第 1 个数字。</li><li id="976f" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">然后，对于每次迭代，我们通过反转数组找到最后 2 个数字<code class="fe op oq or os b">f</code>——遗憾的是，BigQuery 中没有负索引——将它们相加并添加到数组中。对于你们这些聪明的笨蛋来说，你可以把新元素添加到开头，这样就没有必要在每一步都颠倒了。)</li><li id="30c6" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">哦，别忘了增加<code class="fe op oq or os b">i</code>！不要迷失在无限循环中。</li></ul><h1 id="c658" class="ms mt it bd mu mv oz mx my mz pa nb nc jz pb ka ne kc pc kd ng kf pd kg ni nj bi translated">没有数组</h1><p id="db9f" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">上面的是可行的，但是如果我们只需要第 n 个数而不是整个序列呢？那么我们就可以不用数组来完成整个过程。我们需要做的就是<strong class="kk iu">跟踪序列中的最后 2 个数字</strong>。</p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="4656" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们从上面删除了<code class="fe op oq or os b">i</code>,取而代之的是，在每一步递减<code class="fe op oq or os b">n</code>,直到达到 1。在每个步骤中，我们执行以下操作:</p><ul class=""><li id="63d1" class="og oh it kk b kl km ko kp kr oi kv oj kz ok ld ol om on oo bi translated">将<code class="fe op oq or os b">b</code>存储在一个临时变量中。</li><li id="7f35" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">将<code class="fe op oq or os b">b</code>设置为新值，即<code class="fe op oq or os b">a</code>和<code class="fe op oq or os b">b</code>之和。</li><li id="a925" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">将<code class="fe op oq or os b">a</code>设置为临时变量——之前的<code class="fe op oq or os b">b</code>。</li></ul><p id="a3ca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这为我们提供了带有<code class="fe op oq or os b">a &lt; b</code>的序列的最后两个数字。</p><blockquote class="me mf mg"><p id="fe9f" class="ki kj mh kk b kl km ju kn ko kp jx kq mi ks kt ku mj kw kx ky mk la lb lc ld im bi translated">我将让您来弄清楚那个<code class="fe op oq or os b">IF</code>声明是怎么回事，以及我们为什么需要它。</p></blockquote><h1 id="8aaf" class="ms mt it bd mu mv oz mx my mz pa nb nc jz pb ka ne kc pc kd ng kf pd kg ni nj bi translated">摘要</h1><p id="e9d3" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">阅读完本文后，您现在已经了解了以下内容:</p><ul class=""><li id="8164" class="og oh it kk b kl km ko kp kr oi kv oj kz ok ld ol om on oo bi translated">SQL 脚本是为 BigQuery 中的循环做的事情</li><li id="7c5d" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">如何用变量的名称和类型声明变量</li><li id="780b" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">如何设置变量的值</li><li id="e516" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">如何追加到数组中</li><li id="5c4a" class="og oh it kk b kl ot ko ou kr ov kv ow kz ox ld ol om on oo bi translated">如何执行 WHILE 循环</li></ul><p id="9c31" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">今天学了新东西，给自己一点鼓励。哦，如果我在这篇文章中说了一些愚蠢的话，请在评论中指出来。😉</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ph"><img src="../Images/acb401f0ffeb51b1726a4ee2dc36f4d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6JTz0IpOspxyaz0uJUr1dg.jpeg"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">干得好，SQL 忍者！—<a class="ae md" href="https://unsplash.com/@superwillyfoc?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Guillermo la Torre</a>在<a class="ae md" href="https://unsplash.com/s/photos/applause?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="55d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mh">关于斐波那契数列和数组的其他 BigQuery 文章，请参见这些:</em></p><div class="pi pj gp gr pk pl"><a rel="noopener follow" target="_blank" href="/fibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6"><div class="pm ab fo"><div class="pn ab po cl cj pp"><h2 class="bd iu gy z fp pq fr fs pr fu fw is bi translated">BigQuery 中的斐波那契数列</h2><div class="ps l"><h3 class="bd b gy z fp pq fr fs pr fu fw dk translated">在 BigQuery 中使用用户定义的 JavaScript 函数来计算 Fibonacci</h3></div><div class="pt l"><p class="bd b dl z fp pq fr fs pr fu fw dk translated">towardsdatascience.com</p></div></div><div class="pu l"><div class="pv l pw px py pu pz lx pl"/></div></div></a></div><div class="pi pj gp gr pk pl"><a rel="noopener follow" target="_blank" href="/fizzbuzz-in-bigquery-e0c4fbc1d195"><div class="pm ab fo"><div class="pn ab po cl cj pp"><h2 class="bd iu gy z fp pq fr fs pr fu fw is bi translated">BigQuery 中的 FizzBuzz</h2><div class="ps l"><h3 class="bd b gy z fp pq fr fs pr fu fw dk translated">BigQuery 中的 FizzBuzz，而不是 BigQuery 中的 Java 或 Python。使用 SQL，为什么不呢？</h3></div><div class="pt l"><p class="bd b dl z fp pq fr fs pr fu fw dk translated">towardsdatascience.com</p></div></div><div class="pu l"><div class="qa l pw px py pu pz lx pl"/></div></div></a></div></div></div>    
</body>
</html>