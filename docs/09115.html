<html>
<head>
<title>Serverless BERT with HuggingFace and AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带 HuggingFace 和 AWS Lambda 的无服务器 BERT</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/serverless-bert-with-huggingface-and-aws-lambda-625193c6cc04?source=collection_archive---------12-----------------------#2020-06-30">https://towardsdatascience.com/serverless-bert-with-huggingface-and-aws-lambda-625193c6cc04?source=collection_archive---------12-----------------------#2020-06-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7621" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用 BERT、HuggingFace、无服务器框架和 AWS Lambda 构建一个无服务器问答 API。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/606d56b69a29ad46371efe2341c29b2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hq5UnX-b--f_AlIc.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@samule?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Samule 孙</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="68b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">原载于 2020 年 6 月 30 日</em><a class="ae ky" href="https://www.philschmid.de/serverless-bert-with-huggingface-and-aws-lambda" rel="noopener ugc nofollow" target="_blank"><em class="lv">https://www . philschmid . de</em></a><em class="lv">。</em></p><h1 id="547e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">介绍</h1><p id="981d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">“无服务器”和“BERT”是强烈影响计算世界的两个主题。<a class="ae ky" href="https://hackernoon.com/what-is-serverless-architecture-what-are-its-pros-and-cons-cc4b804022e9" rel="noopener ugc nofollow" target="_blank">无服务器架构</a>允许我们动态扩展和缩小软件，无需管理和配置计算能力。<a class="ae ky" href="https://www.cloudflare.com/learning/serverless/why-use-serverless/" rel="noopener ugc nofollow" target="_blank">它允许我们，开发者，专注于我们的应用</a>。</p><p id="230a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">伯特可能是最有名的自然语言处理模型。你可以说它改变了我们处理文本数据的方式以及我们可以从中学习到什么。<a class="ae ky" href="https://www.blog.google/products/search/search-language-understanding-bert/" rel="noopener ugc nofollow" target="_blank"><em class="lv">“BERT 将帮助[Google]搜索[实现]更好地理解[ing]10 个搜索中的一个”</em> </a>。伯特及其伙伴罗伯塔、GPT-2、艾伯特和 T5 将在未来几年推动商业和商业理念，并将像互联网曾经做过的那样改变/颠覆商业领域。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/1015fcdbba3295800d27b37850472163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uhzHFVzVsRImPWo7nR56tQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.blog.google/products/search/search-language-understanding-bert/" rel="noopener ugc nofollow" target="_blank">搜索语言理解伯特</a></p></figure><p id="c1e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想象一下，将这两者结合在一起，您将获得怎样的商业价值。但是 BERT 并不是最容易在无服务器架构中部署的机器学习模型。BERT 很大，需要相当大的计算能力。您在网上找到的大多数教程都演示了如何在“简单”的环境中部署 BERT，比如一个具有 16GB 内存和 4 个 CPU 的 VM。</p><p id="1cf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将向您展示如何利用无服务器架构的优势，并在无服务器环境中部署 BERT 问答 API。我们将使用 HuggingFace 的<a class="ae ky" href="https://github.com/huggingface/transformers" rel="noopener ugc nofollow" target="_blank">变形金刚</a>库、<a class="ae ky" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>和 AWS Lambda。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="9801" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">通过 Huggingface 创建变压器库</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/af504357f0212622383bdcfe44ebbfac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*nXzmzGtyTL-dClOiXGO8xw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://huggingface.co/" rel="noopener ugc nofollow" target="_blank">变形金刚 logo by huggingface </a></p></figure><p id="4e5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/huggingface/transformers" rel="noopener ugc nofollow" target="_blank">变形金刚库</a>为自然语言理解(NLU)和自然语言生成(NLG)提供最先进的机器学习架构，如 BERT、GPT-2、罗伯塔、XLM、DistilBert、XLNet、T5。它还提供了 100 多种不同语言的数千个预训练模型，并在 PyTorch &amp; TensorFlow 2.0 之间具有深度互操作性。它使开发人员能够针对不同的 NLP 任务(如文本分类、情感分析、问答或文本生成)微调机器学习模型。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="da07" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">自动气象站λ</h1><p id="fbc7" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">AWS Lambda 是一种无服务器计算服务，让你无需管理服务器就能运行代码。它只在需要的时候执行你的代码，并且自动伸缩，从每天几个请求到每秒几千个请求。您只需为您消耗的计算时间付费，当您的代码不运行时，则不收费。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/9fac40b039a172c9433ec56b8986f759.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*wtvYRZg_iZmpjOhCZeUhAw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AWS <a class="ae ky" href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html" rel="noopener ugc nofollow" target="_blank"> Lambda </a>标志</p></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="35f4" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">无服务器框架</h1><p id="a17a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">无服务器框架帮助我们开发和部署 AWS Lambda 功能。它是一个 CLI，开箱即可提供结构、自动化和最佳实践。它还允许我们专注于构建复杂的、事件驱动的、无服务器的架构，由函数和事件组成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/2eee2af0b4ee8744b1dbd824a147bcf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*GKqBWVzXAVsWk337pINN2g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://serverless.com" rel="noopener ugc nofollow" target="_blank">无服务器框架标志</a></p></figure><p id="9bcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不熟悉或者还没有设置无服务器框架，看看这个<a class="ae ky" href="https://serverless.com/framework/docs/providers/aws/guide/quick-start/" rel="noopener ugc nofollow" target="_blank">无服务器框架快速入门</a>。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="6b11" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">辅导的</h1><p id="526c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在我们开始之前，确保您已经配置并设置了<a class="ae ky" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>。你还需要一个工作的 Docker 环境。Docker 环境用于构建我们自己的 python 运行时，我们将其部署到 AWS Lambda。此外，您需要访问 AWS 帐户来创建 S3 桶和 AWS Lambda 函数。</p><p id="14b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在教程中，我们将使用预先训练好的<code class="fe nj nk nl nm b">BERT</code>模型构建一个问答 API。这个想法是我们发送一个上下文(小段落)和一个问题给 lambda 函数，它会用问题的答案来响应。</p><p id="6d82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于本指南不是关于构建模型，我们将使用一个预构建的版本，这是我用<code class="fe nj nk nl nm b">distilbert</code>创建的。你可以在这里查看 colab 笔记本<a class="ae ky" href="https://colab.research.google.com/drive/1eyVi8tkCr7N-sE-yyhDB_lduowp1EZ78?usp=sharing" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="1c07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始之前，我想说我们这次不会深入细节。如果你想更多地了解如何在 AWS Lambda 中使用深度学习，我建议你看看我的其他文章:</p><ul class=""><li id="fd20" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated"><a class="ae ky" href="https://www.philschmid.de/scaling-machine-learning-from-zero-to-hero" rel="noopener ugc nofollow" target="_blank">从零到英雄的缩放机学习</a></li><li id="da5e" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><a class="ae ky" href="https://www.philschmid.de/how-to-set-up-a-ci-cd-pipeline-for-aws-lambda-with-github-actions-and-serverless" rel="noopener ugc nofollow" target="_blank">如何使用 GitHub 操作和无服务器为 AWS Lambda 设置 CI/CD 管道</a></li></ul><p id="6baa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们正在构建的架构将会是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/79cbc948326ad8b55b189e300457abd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DmDUiKe9Xj9irhMv25E4sw.png"/></div></div></figure><p id="8f97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">我们要做什么:</strong></p><ul class=""><li id="db74" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">使用无服务器框架创建 Python Lambda 函数</li><li id="e99c" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">创建一个 S3 桶并上传我们的模型</li><li id="03e8" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">配置<code class="fe nj nk nl nm b">serverless.yaml</code>，添加<code class="fe nj nk nl nm b">transformers</code>作为依赖项，并设置一个 API 网关用于推理</li><li id="59dc" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">将<a class="ae ky" href="https://colab.research.google.com/drive/1eyVi8tkCr7N-sE-yyhDB_lduowp1EZ78?usp=sharing#scrollTo=pUdW5bwb1qre" rel="noopener ugc nofollow" target="_blank"> colab 笔记本</a>中的<code class="fe nj nk nl nm b">BERT</code>型号添加到我们的功能中</li><li id="c8f2" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">部署和测试功能</li></ul><p id="fddf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这个<a class="ae ky" href="https://github.com/philschmid/serverless-bert-with-huggingface-aws-lambda/blob/master/model/model.py" rel="noopener ugc nofollow" target="_blank"> GitHub 库</a>和<a class="ae ky" href="https://colab.research.google.com/drive/1eyVi8tkCr7N-sE-yyhDB_lduowp1EZ78?usp=sharing#scrollTo=pUdW5bwb1qre" rel="noopener ugc nofollow" target="_blank"> colab 笔记本中找到我们正在做的一切。</a></p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="4a85" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">创建 Python Lambda 函数</h1><p id="ad98" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">首先，我们通过使用带有<code class="fe nj nk nl nm b">aws-python3</code>模板的无服务器 CLI 创建 AWS Lambda 函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="286d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该 CLI 命令将创建一个包含<code class="fe nj nk nl nm b">handler.py</code>、<code class="fe nj nk nl nm b">.gitignore</code>和<code class="fe nj nk nl nm b">serverless.yaml</code>文件的新目录。<code class="fe nj nk nl nm b">handler.py</code>包含一些基本的样板代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="b59c" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">添加<code class="fe nj nk nl nm b">transformers</code>作为依赖项</h1><p id="e608" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">除了<code class="fe nj nk nl nm b">requirements.txt</code>，无服务器框架几乎创建了我们需要的任何东西。我们手动创建<code class="fe nj nk nl nm b">requirements.txt</code>并添加以下依赖项。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="4b77" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">创建一个 S3 存储桶并上传模型</h1><p id="a34b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">AWS S3 和 Pytorch 提供了一种独特的方法来处理大于 250MB 的机器学习模型。为什么是 250 MB？Lambda 函数解压缩后的大小限制为 250MB。</p><p id="5f68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是 S3 允许文件直接从 S3 加载到内存中。在我们的函数中，我们将把来自 S3 的模型<code class="fe nj nk nl nm b">squad-distilbert</code>加载到内存中，并作为 Pytorch 中的缓冲区从内存中读取它。</p><p id="44fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您运行<a class="ae ky" href="https://colab.research.google.com/drive/1eyVi8tkCr7N-sE-yyhDB_lduowp1EZ78?usp=sharing#scrollTo=pUdW5bwb1qre" rel="noopener ugc nofollow" target="_blank"> colab 笔记本</a>，它将创建一个名为<code class="fe nj nk nl nm b">squad-distilbert.tar.gz</code>的文件，其中包含我们的模型。</p><p id="b763" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建 S3 存储桶，您可以使用管理控制台或以下命令来创建。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="2cc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们创建桶之后，我们可以上传我们的模型。您可以手动或使用提供的 python 脚本来完成。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="d4ce" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">配置<code class="fe nj nk nl nm b">serverless.yaml</code></h1><p id="9ade" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这次我为我们提供了完整的<code class="fe nj nk nl nm b">serverless.yaml</code>。如果你想知道每一节是做什么用的，建议你去看看<a class="ae ky" href="https://www.philschmid.de/scaling-machine-learning-from-zero-to-hero" rel="noopener ugc nofollow" target="_blank">从零到英雄的缩放机学习</a>。在本文中，我介绍了每种配置，并解释了它们的用法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="3381" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">将<a class="ae ky" href="https://colab.research.google.com/drive/1eyVi8tkCr7N-sE-yyhDB_lduowp1EZ78?usp=sharing#scrollTo=pUdW5bwb1qre" rel="noopener ugc nofollow" target="_blank"> colab 笔记本</a>中的<code class="fe nj nk nl nm b">BERT</code>模型添加到我们的功能中</h1><p id="d5cf" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">典型的<code class="fe nj nk nl nm b">transformers</code>型号由<code class="fe nj nk nl nm b">pytorch_model.bin</code>、<code class="fe nj nk nl nm b">config.json</code>、<code class="fe nj nk nl nm b">special_tokens_map.json</code>、<code class="fe nj nk nl nm b">tokenizer_config.json</code>和<code class="fe nj nk nl nm b">vocab.txt</code>组成。<code class="fe nj nk nl nm b">pytorch_model.bin</code>已经被提取并上传到 S3。</p><p id="03bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将把<code class="fe nj nk nl nm b">config.json</code>、<code class="fe nj nk nl nm b">special_tokens_map.json</code>、<code class="fe nj nk nl nm b">tokenizer_config.json</code>和<code class="fe nj nk nl nm b">vocab.txt</code>直接添加到我们的 Lambda 函数中，因为它们的大小只有几 KB。因此，我们在 lambda 函数中创建了一个<code class="fe nj nk nl nm b">model</code>目录。</p><p id="a15c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">如果这听起来很复杂，可以查看一下</em> <a class="ae ky" href="https://github.com/philschmid/serverless-bert-with-huggingface-aws-lambda" rel="noopener ugc nofollow" target="_blank"> <em class="lv"> GitHub 资源库</em> </a> <em class="lv">。</em></p><p id="4d5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是在保存我们的模型类<code class="fe nj nk nl nm b">ServerlessModel</code>的<code class="fe nj nk nl nm b">model/</code>目录中创建一个<code class="fe nj nk nl nm b">model.py</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="a50b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nj nk nl nm b">handler.py</code>中，我们创建了一个<code class="fe nj nk nl nm b">ServerlessModel</code>的实例，并可以使用<code class="fe nj nk nl nm b">predict</code>函数得到我们的答案。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="deda" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">部署和测试功能</h1><p id="d76f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">为了部署该功能，您只需运行<code class="fe nj nk nl nm b">serverless deploy</code>。</p><p id="e51d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个过程完成后，我们应该看到类似这样的东西。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/3ddea3bf884bd3fe57084b76e7cc3fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uN0ejkuHuB3Qsp7C7yj7Zg.png"/></div></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="969f" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">测试和结果</h1><p id="8296" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">为了测试我们的 Lambda 函数，我们可以使用失眠症、邮差或任何其他 REST 客户端。只需在请求体中添加一个带有<code class="fe nj nk nl nm b">context</code>和<code class="fe nj nk nl nm b">question</code>的 JSON。让我们用 colab 笔记本中的例子来尝试一下。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/aa2712ee23bb3aa870c04ac9a77411e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ds0rTlh5CDBa0Ip1ybq4Cg.png"/></div></div></figure><p id="a6d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的<code class="fe nj nk nl nm b">ServerlessModel</code>用<code class="fe nj nk nl nm b">83.1</code>正确回答了我们的问题。此外，您可以看到完整的请求花费了 319 毫秒，而 lambda 执行时间大约为 530 毫秒。老实说，这是相当快的。</p><p id="20f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最棒的是，如果有几个传入请求，我们的 BERT 模型会自动扩展！它可以扩展到数千个并行请求，而不用担心任何问题。</p><p id="38a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您重新构建它，您必须小心第一个请求可能需要一段时间。首先，Lambda 正在解压和安装我们的依赖项，然后从 S3 下载模型。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="eb8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。你可以在这里找到带有完整代码<a class="ae ky" href="https://github.com/philschmid/scale-machine-learning-w-pytorch" rel="noopener ugc nofollow" target="_blank">的</a><a class="ae ky" href="https://github.com/philschmid/serverless-bert-with-huggingface-aws-lambda/blob/master/model/model.py" rel="noopener ugc nofollow" target="_blank"> GitHub 库</a>，在这里找到 colab 笔记本<a class="ae ky" href="https://colab.research.google.com/drive/1eyVi8tkCr7N-sE-yyhDB_lduowp1EZ78?usp=sharing#scrollTo=pUdW5bwb1qre" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="e917" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。如果你有任何问题，随时联系我或评论这篇文章。你也可以在推特(Twitter)或领英(LinkedIn)上与我联系。</p></div></div>    
</body>
</html>