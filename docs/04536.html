<html>
<head>
<title>csvkit: a Swiss Army Knife for CSV Data ?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CSV kit:CSV 数据的瑞士军刀？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/csvkit-a-swiss-army-knife-for-csv-data-286db551547b?source=collection_archive---------41-----------------------#2020-04-22">https://towardsdatascience.com/csvkit-a-swiss-army-knife-for-csv-data-286db551547b?source=collection_archive---------41-----------------------#2020-04-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="aa73" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">评估 csvkit 从命令行操作数据的潜力</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a3c86f72ce4eec95eba7bf778bdad420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*10YkK5NHOM6JYDP-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·斯皮斯克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="e5c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当面对一个新的 CSV 数据集进行分析时，我们大多数数据科学家会立即启动我们最喜欢的 IDE 或笔记本编辑器，从通常的<code class="fe lv lw lx ly b">numpy</code>和<code class="fe lv lw lx ly b">pandas</code>导入开始。</p><p id="eba7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这并没有什么错，但是今天我想向您展示如何在不离开命令行的情况下近距离接触您的数据。</p><p id="0185" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将使用<code class="fe lv lw lx ly b">csvkit</code>，一个专门为此设计的工具。我还将在示例中使用 Kaggle 数据集，它也可以从命令行下载，如下所示:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="e6a8" class="md me it ly b gy mf mg l mh mi">pip install kaggle </span><span id="c920" class="md me it ly b gy mj mg l mh mi">kaggle datasets download datafiniti/hotel-reviews </span><span id="b58a" class="md me it ly b gy mj mg l mh mi">unzip hotel-reviews.zip</span></pre><h1 id="3f1c" class="mk me it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">探索数据集</h1><p id="ec63" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated"><strong class="lb iu"> csvcut </strong>:</p><p id="67ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们对这个数据集了解不多，只知道它与酒店有关。首先，我们想知道那里有哪些列。简单:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="3709" class="md me it ly b gy mf mg l mh mi">csvcut -n Datafiniti_Hotel_Reviews.csv</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/72edba5f3c1b7cf09b615e5e59f951e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/0*b8aCaxPfNMUFD329.png"/></div></figure><p id="3300" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> csvlook </strong>:</p><p id="aad3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您想看看列<code class="fe lv lw lx ly b">province</code>和<code class="fe lv lw lx ly b">postalCode</code>的前几个值。在下面的代码中，我们选择带有<code class="fe lv lw lx ly b">csvcut</code>的列的子集，并将其作为<code class="fe lv lw lx ly b">csvlook</code>的输入:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="9240" class="md me it ly b gy mf mg l mh mi">csvcut -c country,province,postalCode Datafiniti_Hotel_Reviews.csv | csvlook --max-rows 10</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/1b308dda74cca6c5ede346061a247057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AeHtixhnD1FMoOXm.png"/></div></div></figure><p id="7702" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，我们可以将<code class="fe lv lw lx ly b">csvlook</code>的输出传送到<code class="fe lv lw lx ly b">head</code>命令，而不是使用<code class="fe lv lw lx ly b">--max-rows</code>参数。</p><p id="6fc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> csvstat </strong>:</p><p id="0b15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在给定上面的输出，我们可能想要检查数据是否只覆盖美国。要了解更多关于特定列的信息，我们可以使用<code class="fe lv lw lx ly b">csvstat</code>:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="e936" class="md me it ly b gy mf mg l mh mi">csvcut -c country,province,postalCode Datafiniti_Hotel_Reviews.csv | csvstat</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/f84462e7eb1c956127875426b2ee103c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QuWVyjWCjBFyhufN.png"/></div></div></figure><p id="531e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是很多非常有用的信息，非常容易获得！注意，我们还从上面的输出中获得了文件中的行数。</p><p id="d4a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想获得所有列的统计数据，您当然可以直接使用<code class="fe lv lw lx ly b">csvstat</code>而不用管道:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="7194" class="md me it ly b gy mf mg l mh mi">csvstat Datafiniti_Hotel_Reviews.csv</span></pre><p id="85b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">csvort:</p><p id="9f0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设现在我们想快速浏览一下最近的评论和城市。我们可以试着用<code class="fe lv lw lx ly b">csvsort</code>来做:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="98b0" class="md me it ly b gy mf mg l mh mi">csvcut -c reviews.date,city,reviews.title Datafiniti_Hotel_Reviews.csv | csvsort -c reviews.date -r | csvlook --max-rows 10</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/e9004c19f61f04f2d961bcba6dd7326e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QrzXMzAjQ2JUUiQd.png"/></div></div></figure><p id="73c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nk">旁注:</em>根据我选择的列，我有时会得到一个值错误，类似于<code class="fe lv lw lx ly b">Row has X values, but Table has Y columns</code>。在这种情况下，添加<code class="fe lv lw lx ly b">--snifflimit 0</code>可以解决问题。</p><p id="a5c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> csvgrep </strong>:</p><p id="e8a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了结束探索阶段，让我们寻找所有提到“安静”或“和平”酒店的评论标题。在下面的命令中，我添加了带有<code class="fe lv lw lx ly b">-l</code>标志的行号。<code class="fe lv lw lx ly b">csvgrep</code>命令的一个缺点是我不能将它的输出通过管道传递给其他命令。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="b9c4" class="md me it ly b gy mf mg l mh mi">csvcut -c name,reviews.title -l Datafiniti_Hotel_Reviews.csv | csvgrep -c reviews.title -r "(?i)(quiet|peaceful)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/ab2b32c4624db46a08dd09a3fa3a166c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1fjnPv1tW6ecL7fW.png"/></div></div></figure><h1 id="02d7" class="mk me it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">查询数据集</h1><p id="b65f" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated"><code class="fe lv lw lx ly b">csvkit</code>的一个非常酷的特性是能够用 SQL 从命令行查询数据。</p><p id="4af9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，让我们再次搜索安静的酒店，但这次输出他们的城市和酒店名称:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="f339" class="md me it ly b gy mf mg l mh mi">csvsql --query "select city, name from Datafiniti_Hotel_Reviews where [reviews.text] LIKE '%quiet%' limit 10;" Datafiniti_Hotel_Reviews.csv</span></pre><p id="d68c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行此命令会产生以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/c91a2b8f877b69e7c795a8111060a851.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w8XhjKzGfFJxfWwV.png"/></div></div></figure><p id="0eab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，我不得不说，运行这个查询相当慢，这有点违背了使用命令行的初衷。</p><p id="e735" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管我们可以将 CSV 保存为本地数据库，然后查询该数据库，但我再次发现，如果我打算走数据库这条路，我还不如全力使用编程语言。</p><h1 id="b911" class="mk me it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结论</h1><p id="bc1e" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">总而言之，我发现<strong class="lb iu"> csvkit </strong>的前提很有趣，但是 sql 请求的缓慢运行速度是一个很大的失望。对我来说，价值主张不足以让我放弃熊猫和 jupyter，即使是为了探险。</p></div></div>    
</body>
</html>