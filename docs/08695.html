<html>
<head>
<title>Rule-based Sentiment Analysis of App Store Review in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中基于规则的 App Store 评论情感分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/rule-based-sentiment-analysis-of-app-store-review-in-python-94d8bbfc48bb?source=collection_archive---------34-----------------------#2020-06-23">https://towardsdatascience.com/rule-based-sentiment-analysis-of-app-store-review-in-python-94d8bbfc48bb?source=collection_archive---------34-----------------------#2020-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2bf2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用“VADER”来识别基于用户评论的用户情绪</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bf8ea68451625ec64a1ec4c88ed6a0d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ar7b6nmBJ9mYIloQcdES9A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@williamtm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">威廉·胡克</a>在<a class="ae ky" href="https://unsplash.com/@williamtm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="f0e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过阅读这篇文章，您将学会用 Python 分析和执行基于规则的情感分析。我们将使用名为<code class="fe lv lw lx ly b">VADER</code>的<code class="fe lv lw lx ly b">Python</code>包，并在一款名为 Clash of Clan 的手机游戏的 app store 用户评论数据集上测试它。</p><p id="4ae4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基于官方文档，VADER (Valence Aware 字典和情感推理器)是:</p><blockquote class="lz ma mb"><p id="ad3f" class="kz la mc lb b lc ld ju le lf lg jx lh md lj lk ll me ln lo lp mf lr ls lt lu im bi translated">…一个基于词汇和规则的情绪分析工具，专门针对社交媒体中表达的情绪<em class="it">。</em></p></blockquote><p id="12b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与传统的机器学习方法不同，<code class="fe lv lw lx ly b">VADER</code>使用的方法是针对社交媒体帖子的。它可能不太适合文学或新闻文章。然而，一个主要的优点是推理时间非常快，您可以在简单的笔记本电脑上顺利运行。</p><p id="0d83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程有 3 个部分:</p><ol class=""><li id="f78a" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">设置</li><li id="378e" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">履行</li><li id="a31f" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">结论</li></ol><p id="c8cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续下一部分，开始安装必要的模块。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="dfd6" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">1.设置</h1><h2 id="7798" class="nt nc it bd nd nu nv dn nh nw nx dp nl li ny nz nn lm oa ob np lq oc od nr oe bi translated">Python 包</h2><p id="8c4e" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">你可以通过<code class="fe lv lw lx ly b">pip install</code>在 Python 中轻松安装<code class="fe lv lw lx ly b">VADER</code>。强烈建议您在继续安装之前创建一个虚拟环境。激活您的虚拟环境并运行以下命令。</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="651c" class="nt nc it ly b gy oo op l oq or">pip install vaderSentiment</span></pre><p id="d952" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在读取数据集时，我们还需要另一个名为<code class="fe lv lw lx ly b">pandas</code>的模块。通过以下命令安装它:</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="6dd8" class="nt nc it ly b gy oo op l oq or">pip install pandas</span></pre><h2 id="82bb" class="nt nc it bd nd nu nv dn nh nw nx dp nl li ny nz nn lm oa ob np lq oc od nr oe bi translated">资料组</h2><p id="d33b" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">转到下面的<a class="ae ky" href="https://www.kaggle.com/moradnejad/clash-of-clans-50000-user-comments" rel="noopener ugc nofollow" target="_blank">链接</a>，将整个数据集下载到项目的根目录下。您应该有一个名为<code class="fe lv lw lx ly b">clash-of-clans.csv</code>的<code class="fe lv lw lx ly b">csv</code>文件，其中包含以下数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/c73d93a1eb64f9edbbcf7289092232d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*HkGJ565UAFxFLO9-1qXbXQ.png"/></div></figure><p id="688d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一节中，我们将编写一些 Python 代码。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="5916" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">2.履行</h1><p id="f9ec" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">在本教程中，我将使用<code class="fe lv lw lx ly b">Jupyter Notebook</code>。话虽如此，您也可以在一个<code class="fe lv lw lx ly b">Python</code>文件中正常运行它。</p><h2 id="f50d" class="nt nc it bd nd nu nv dn nh nw nx dp nl li ny nz nn lm oa ob np lq oc od nr oe bi translated">导入</h2><p id="5ede" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">在文件的顶部添加以下导入声明。</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="4227" class="nt nc it ly b gy oo op l oq or">from vaderSentiment.vaderSentiment import SentimentIntensityAnalyzer<br/>import pandas as pd</span></pre><h2 id="8bb1" class="nt nc it bd nd nu nv dn nh nw nx dp nl li ny nz nn lm oa ob np lq oc od nr oe bi translated">初始化</h2><p id="97c6" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">接下来，初始化<code class="fe lv lw lx ly b">SentimentIntensityAnalyzer</code>类的一个实例。我们将在每次计算或分析文本的情感时重用这个实例。</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="70a0" class="nt nc it ly b gy oo op l oq or">analyzer = SentimentIntensityAnalyzer()</span></pre><h2 id="2094" class="nt nc it bd nd nu nv dn nh nw nx dp nl li ny nz nn lm oa ob np lq oc od nr oe bi translated">数据帧</h2><p id="4f1a" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">确保<code class="fe lv lw lx ly b">clash-of-clan.csv</code>和你的文件在同一个目录下。通过<code class="fe lv lw lx ly b">read_csv</code>函数加载数据集。如果您将文件存储在其他位置，请修改文件的路径。</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="abc3" class="nt nc it ly b gy oo op l oq or">df_coc = pd.read_csv("./clash-of-clans.csv", encoding="utf-8")<br/>df_coc.head()</span></pre><p id="2912" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该在控制台上看到以下输出。如果您运行的是 Python 文件而不是 Jupyter Notebook，格式可能会略有不同。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/d68dd9b8ffba8aa3da460f0b6c0c8ca3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*QHm4LZq2drjrrURCCLkjdA.png"/></div></figure><h2 id="242a" class="nt nc it bd nd nu nv dn nh nw nx dp nl li ny nz nn lm oa ob np lq oc od nr oe bi translated">情感分析</h2><p id="ff79" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">你可以通过这个模块提供的<code class="fe lv lw lx ly b">polarity_scores</code>函数来计算单个文本的情感。</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="73c0" class="nt nc it ly b gy oo op l oq or">vs = analyzer.polarity_scores('I felt terrible today')<br/>print(vs)</span></pre><p id="9802" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将得到一个包含 4 个键/值对的字典，如下所示:</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="5045" class="nt nc it ly b gy oo op l oq or">{'neg': 0.508, 'neu': 0.492, 'pos': 0.0, 'compound': -0.4767}</span></pre><p id="8e77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">供你参考，</p><blockquote class="lz ma mb"><p id="b0c1" class="kz la mc lb b lc ld ju le lf lg jx lh md lj lk ll me ln lo lp mf lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">pos</code>、<code class="fe lv lw lx ly b">neu</code>和<code class="fe lv lw lx ly b">neg</code>分数是属于每个类别的文本的比例(因此这些应该加起来都是 1...或者用浮动操作接近它)。如果你想对一个给定的句子进行多维度的情感测量，这些是最有用的指标。</p><p id="944c" class="kz la mc lb b lc ld ju le lf lg jx lh md lj lk ll me ln lo lp mf lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">compound</code>分数是通过对词典中每个单词的化合价分数求和来计算的，根据规则进行调整，然后归一化到-1(最极端的负面)和+1(最极端的正面)之间。如果你想对一个给定的句子进行单一的一维情感测量，这是最有用的度量。称之为“标准化加权综合得分”是准确的。</p></blockquote><p id="4be6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，阈值设置如下:</p><ul class=""><li id="55ec" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ou mm mn mo bi translated"><code class="fe lv lw lx ly b">positive</code> — <code class="fe lv lw lx ly b">compound</code>得分≥ 0.05</li><li id="6100" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ou mm mn mo bi translated"><code class="fe lv lw lx ly b">negative</code> — <code class="fe lv lw lx ly b">compound</code>得分≤ -0.05</li><li id="da48" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ou mm mn mo bi translated"><code class="fe lv lw lx ly b">neutral</code> — <code class="fe lv lw lx ly b">compound</code>在-0.05 和 0.05 之间</li></ul><p id="4ebe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个新函数，并在其中插入以下代码。这个函数接受一个输入文本，并基于复合分数返回文本的情感。情感标签包括:</p><ul class=""><li id="1bfc" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ou mm mn mo bi translated"><code class="fe lv lw lx ly b">positive</code> — 2</li><li id="ca9b" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ou mm mn mo bi translated"><code class="fe lv lw lx ly b">neutral</code> — 1</li><li id="94e2" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ou mm mn mo bi translated"><code class="fe lv lw lx ly b">negative</code> — 0</li><li id="a185" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ou mm mn mo bi translated"><code class="fe lv lw lx ly b">junk</code>——-1</li></ul><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="197b" class="nt nc it ly b gy oo op l oq or">def calc_vader_sentiment(text):<br/>    sentiment = 1</span><span id="e562" class="nt nc it ly b gy ov op l oq or">    vs = analyzer.polarity_scores(str(text))<br/>    compound = vs['compound']</span><span id="3485" class="nt nc it ly b gy ov op l oq or">    if(compound == 0):<br/>        sentiment = -1<br/>    elif(compound &gt;= 0.05):<br/>        sentiment = 2<br/>    elif(compound &lt;= -0.05):<br/>        sentiment = 0</span><span id="be13" class="nt nc it ly b gy ov op l oq or">    return sentiment</span></pre><p id="fd03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦创建了上面的函数，创建一个新的由三列组成的<code class="fe lv lw lx ly b">DataFrame</code>:</p><ul class=""><li id="f058" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ou mm mn mo bi translated"><code class="fe lv lw lx ly b">uid </code> —数据的唯一标识符。我们将使用索引作为 uid</li><li id="3e9d" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ou mm mn mo bi translated"><code class="fe lv lw lx ly b">text </code> —用户评论的文本</li><li id="a962" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ou mm mn mo bi translated"><code class="fe lv lw lx ly b">label </code> —情感分析得分</li></ul><p id="cfec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行列表理解中的<code class="fe lv lw lx ly b">calc_vader_sentiment</code>函数如下</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="72ca" class="nt nc it ly b gy oo op l oq or">df = pd.DataFrame({<br/>    'uid': list(df_coc.index.values),<br/>    'text': df_coc['Content'],<br/>    'label': [calc_vader_sentiment(x) for x in df_coc['Content']]<br/>})</span></pre><p id="e91c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它应该需要几秒钟来计算分数，因为我们有大约 50000 行数据。通过运行下面的代码，您可以简单地查看前 10 个结果。</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="50e3" class="nt nc it ly b gy oo op l oq or">df.head(10)</span></pre><p id="964d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会得到以下结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/6f42d1aeb0619b394fe7dce58db2cba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*q5fod8bvw20WWgyoqLVR-A.png"/></div></figure><h2 id="cf6f" class="nt nc it bd nd nu nv dn nh nw nx dp nl li ny nz nn lm oa ob np lq oc od nr oe bi translated">保存到文件</h2><p id="29c0" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">如果你想把它保存到一个文件中，你可以通过 pandas 模块提供的<code class="fe lv lw lx ly b">to_csv</code>函数来完成。根据您的偏好修改文件的名称。</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="4595" class="nt nc it ly b gy oo op l oq or">df.to_csv("sentiment_result.csv", encoding='utf8', index=False)</span></pre></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="9b4c" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">3.结论</h1><p id="aec2" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">让我们回顾一下今天所学的内容。</p><p id="0734" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先简要介绍了<code class="fe lv lw lx ly b">VADER</code>及其功能。然后，我们通过 pip install 安装了必要的模块，并从<code class="fe lv lw lx ly b">Kaggle</code>下载了<code class="fe lv lw lx ly b">clash-of-clan.csv</code>数据集。</p><p id="25c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们继续实现我们自己的代码，通过使用由<code class="fe lv lw lx ly b">VADER</code>计算的复合分数来计算用户评论的情感分数。</p><p id="df9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除此之外，我们还学会了将最终输出保存到一个 csv 文件中，以供将来参考。</p><p id="0296" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢你阅读这篇文章。希望在下一篇文章中再见到你！</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="ae8c" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">参考</h1><ol class=""><li id="135f" class="mg mh it lb b lc of lf og li ox lm oy lq oz lu ml mm mn mo bi translated"><a class="ae ky" href="https://github.com/cjhutto/vaderSentiment" rel="noopener ugc nofollow" target="_blank">Vader perspection 官方 Github 页面</a></li><li id="6e49" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><a class="ae ky" href="https://www.kaggle.com/moradnejad/clash-of-clans-50000-user-comments" rel="noopener ugc nofollow" target="_blank">来自 Kaggle 的 Clash of Clans 应用商店用户评论数据集</a></li></ol></div></div>    
</body>
</html>