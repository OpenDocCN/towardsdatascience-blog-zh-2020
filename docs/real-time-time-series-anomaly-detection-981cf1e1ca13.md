# 实时时间序列异常检测

> 原文：<https://towardsdatascience.com/real-time-time-series-anomaly-detection-981cf1e1ca13?source=collection_archive---------3----------------------->

## [入门](https://towardsdatascience.com/tagged/getting-started)

## 开发一个基于多个时间序列传感器的监控系统

![](img/6a7540ab1c2a68f609ee1021d6891839.png)

在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上[可爱的镜头](https://unsplash.com/@lovelyshots?utm_source=medium&utm_medium=referral)拍摄的照片

尽管多年来从不同来源收集大量数据变得越来越容易，但公司需要确保他们收集的数据能够带来价值。为了帮助从数据中收集洞察力，机器学习和分析已经成为趋势工具。由于这些领域需要实时洞察，大量不受欢迎的数据可能会产生真正的问题。

在做出决定之前，关键的是，在采取行动之前，我们必须问:我们的数据中是否存在异常，可能会扭曲算法分析的结果？如果异常确实存在，我们自动检测并减轻它们的影响是至关重要的。这可以确保我们在采取行动之前获得最准确的结果。

在本帖中，我们将探索不同的异常检测方法，这些方法可以在大数据源上实时扩展。这个 [**tsmoothie**](https://github.com/cerlymarco/tsmoothie) 包可以帮助我们完成这个任务。 [**Tsmoothie**](https://github.com/cerlymarco/tsmoothie) 是一个用于时间序列平滑和离群点检测的 python 库，能够以矢量化的方式处理多个序列。它很有用，因为它可以提供我们需要的技术来监控传感器。

# 异常的类型

首先，让我们定义异常。它们可以是任何不同的或异常的，并且与样本中的其他数据或历史数据有很大偏差的数据。

异常通常分为**点状异常和**状异常。**点异常**是异常的单个实例，而**模式异常**代表异常的数据簇。

在大多数情况下，一些点异常可能看起来像是运气不好。取而代之的是模式异常，数据创建了一个看起来非常不同于正常的模式。模式异常更难检测，因为我们必须首先能够定义一个正常的模式，然后我们可能需要更多的数据来分类这种模式与历史活动相比是异常的。

下面我们给出了不同的模拟场景，其中我们应用了适合于异常检测的不同技术。它们的采用是与领域相关的，并且它们都基于简单的假设。这种简单性在我们缺少信息或存在少量数据的所有任务中都是基本的。

# 点异常

我们的目标是检测与其他数据偏离如此之大的数据点。这让人怀疑这些点是由不同的机制产生的。

使用两种不同的算法:卷积平滑器和指数平滑器。两者都使用滑动窗口方法平滑接收的信号。卷积方法使用离散线性卷积，而指数方法使用指数加权卷积。卷积是一种数学运算，可以描述为两个序列(原始信号和权重)乘积的积分。卷积平滑器使用预定义窗口函数生成的权重(*线性、汉宁、汉明、巴特利特、布莱克曼*)。在*线性*类型的情况下，权重都是相同的并且等于 1。这使得操作等于移动平均线。指数平滑器使用指数函数生成的权重。因此，在计算平滑度时，最近的观测值权重最大。

分别考虑了两种不同的数据结构:随机游走序列和无趋势的季节性序列。

![](img/74713426e0d9a519488c2abd4bb04cc5.png)

随机游动中卷积平滑的点异常

![](img/8755973a026e840b471170158e2ee269.png)

无趋势的季节性数据中指数平滑的点异常

收集新值时，会计算平滑度。实际观测值和相应的平滑值之间的差异称为残差。我们用它们来定义异常值或异常值，即实际观测值超过残差置信带的点。

从模拟中，我们可以看到，我们的方法能够检测峰值和疯狂值，这些值可以归类为点异常。

# 模式异常

我们的目标是检测一组连续的数据点，这些数据点总体上是异常的，即使单个点可能是也可能不是异常点。当我们寻找模式异常时，潜在的假设是原始数据必须显示一个模式。例如，季节性时间序列就是这种情况。

时间序列中的季节性在很多数据中都可以观察到。研究季节性因素对于有效的异常检测至关重要。在这方面，一个关键的挑战是如何确定季节周期并将其从趋势中分离出来。季节趋势分解是检测季节和趋势分量的常用方法之一。卷积滤波、LOWESS 或自然三次样条是 tsmoothie 用来检测趋势分量的技术。而季节模式是使用周期中的平均集合来检测的。从提取的趋势和观察到的季节性的联合中，我们可以构建一个假设的平滑值的时间序列。

使用分解平滑器，将具有趋势的季节性序列考虑在内，以检测模式异常。在第一种情况下，我们的目标是检测到目前为止数据中不符合研究模式的观察结果。对大多数人来说，这是打破季节性模式的观察结果。在第二种情况下，我们在某些区间引入一个移位。我们想知道这是否被检测为可以改变趋势的剧烈变化，从而被指出为异常。

![](img/28ca7f6044a0b80a913a93c8c8c8a4c1.png)

具有趋势的季节性数据中分解更平滑的模式异常

![](img/e5c21a858630cd5b445fd9fdeee2b03f.png)

具有趋势和偏移的季节性数据中分解更平滑的模式异常

平滑机制和残差置信带的计算和以前一样工作。

从模拟中，我们可以看到我们的方法能够检测出不符合季节模式的峰值。我们还可以指出我们的传感器偏离过去观察中出现的假设模式的部分。在最后一种情况下，我们也试图提供理论信号的重建。

# 摘要

在这篇文章中，我们介绍了一些开发时序数据监控工具的标准技术。当我们想要检测异常，但是我们不处理关于底层系统的很多信息时，我们的方法看起来非常有用。所提出的方法也适用于同时处理多个时间序列。我们必须小心选择正确的一个，并进行一些参数调整。

[**查看我的 GITHUB 回购**](https://github.com/cerlymarco/MEDIUM_NoteBook)

保持联系: [Linkedin](https://www.linkedin.com/in/marco-cerliani-b0bba714b/)