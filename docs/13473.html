<html>
<head>
<title>Improve Quality and Efficiency of your Analysis with this little Python Statement</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用这个小 Python 语句提高您的分析质量和效率</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/improve-quality-and-efficiency-of-your-analysis-with-this-little-python-statement-d73ee434823f?source=collection_archive---------51-----------------------#2020-09-15">https://towardsdatascience.com/improve-quality-and-efficiency-of-your-analysis-with-this-little-python-statement-d73ee434823f?source=collection_archive---------51-----------------------#2020-09-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/73f750bf10a6cd08c16a0e351b84655b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DA8et7qClCWOUJs4"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://unsplash.com/photos/-2vD8lIhdnw" rel="noopener ugc nofollow" target="_blank">图片</a>由<a class="ae jg" href="https://unsplash.com/@jeshoots" rel="noopener ugc nofollow" target="_blank">jeeshots.com</a>在<a class="ae jg" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">上 Unsplash </a></p></figure><div class=""/><div class=""><h2 id="a61d" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">如何使用 assert 利用 Python 和 SQL 中的测试驱动开发的实际例子</h2></div><p id="7167" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">曾经写过 SQL 查询或者操作过熊猫数据帧吗？那么你就知道犯一个小错误很容易导致完全错误的结果。如果只是更新和重新运行一个旧的查询，情况会更糟。这些偏见最终会导致错误的(商业)决策，从而产生巨大的影响。</p><blockquote class="lu"><p id="87f6" class="lv lw jj bd lx ly lz ma mb mc md lt dk translated">"你能快速重新运行你 6 个月前为我们做的分析吗？"-“嗯，好吧，我看看我是否能把它拼起来。”</p></blockquote><p id="fd92" class="pw-post-body-paragraph ky kz jj la b lb me kk ld le mf kn lg lh mg lj lk ll mh ln lo lp mi lr ls lt im bi translated">与语法或语义错误不同，逻辑编程错误很难在分析结果中检测出来。但是幸运的是，使用 assert 语句可以大大降低产生这些错误的风险！</p><p id="6825" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们快速看一下这个小陈述如何帮助提高你的分析质量和效率(以及对你的结果的信心)。</p><h1 id="4c27" class="mj mk jj bd ml mm mn mo mp mq mr ms mt kp mu kq mv ks mw kt mx kv my kw mz na bi translated">试驾开发快速入门</h1><p id="f3a3" class="pw-post-body-paragraph ky kz jj la b lb nb kk ld le nc kn lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我在这篇文章中介绍的方法被广泛称为<strong class="la jk">测试驱动开发</strong> (TDD)。根据我的经验，TDD(不幸的是)在数据科学中并不常见，至少在进行探索性分析时是这样。同时，它作为一种确保高质量代码的机制，在软件工程领域被广泛使用。</p><p id="c128" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种方法背后的思想是，首先从实现您想要编写的代码的测试开始。该测试基本上定义了您想要实现的输出。然后，您开始编写和重新定义代码，直到它通过预定义的测试。</p><p id="d7dd" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">TDD 迫使程序员在编写第一行代码之前坐下来思考想要的输出。这样，一个人被迫关注实际目标，这自动有助于提高效率。</p><figure class="nh ni nj nk gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ng"><img src="../Images/cb4e811624ac2f6d7b348c00dc9623c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dqEucQkC9nvoqk0_chRcwA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://unsplash.com/photos/rD2dc_2S3i0" rel="noopener ugc nofollow" target="_blank">图片</a>由<a class="ae jg" href="https://unsplash.com/@chrisliverani" rel="noopener ugc nofollow" target="_blank">克里斯·利维拉尼</a>在<a class="ae jg" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="35c3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种方法不仅有助于写作，也有助于<strong class="la jk">更新你的代码</strong>。想象一下，你被要求重新进行一项半年前进行的分析。通常，您必须对您的旧代码进行一些修改。例如，可能需要更新一些参数，或者应该使用一些额外的指标来增强结果。再翻旧剧本总是一件麻烦事。所以更新脚本时很容易出错。但是您在第一次进行分析时定义的测试将帮助您快速识别那些错误，并确保您仍然产生相同的结果。</p><p id="aca0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那么，在 Python 或 SQL 中进行分析时，TDD 到底可以如何使用呢？</p><h1 id="58ae" class="mj mk jj bd ml mm mn mo mp mq mr ms mt kp mu kq mv ks mw kt mx kv my kw mz na bi translated">什么是断言？</h1><p id="be2f" class="pw-post-body-paragraph ky kz jj la b lb nb kk ld le nc kn lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">首先，Python 中有 pytest 这样的专用测试包。但是特别是当在笔记本上工作时，我认为 assert 是一种更轻量级和更直接的使用 TDD 的方法。</p><p id="2a8d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">assert 语句测试条件是否为真。否则，它将引发 AssertionError。这使它成为调试代码的有益工具:</p><figure class="nh ni nj nk gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nl"><img src="../Images/4d589d731c73aa062250acd4116e68be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s0UV_C5bgP5vDH49CUBb7A.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">assert 语句引发 AssertionError。</p></figure><p id="ab8c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，让我们看看在 Python 中处理数据时，如何将 assert 用于 TDD。</p><h1 id="746d" class="mj mk jj bd ml mm mn mo mp mq mr ms mt kp mu kq mv ks mw kt mx kv my kw mz na bi translated">对 TDD 使用断言</h1><p id="125b" class="pw-post-body-paragraph ky kz jj la b lb nb kk ld le nc kn lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">为了展示如何将 assert 用于 TDD，我将使用一个实际的例子。我们有一个演员和他们出演的电影的表格(这是 Kaggle 的 2006-2016 年 IMDB 数据集)。目标是生成一个只包含每个演员的最后一部电影的表:</p><figure class="nh ni nj nk gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nm"><img src="../Images/3ea486310dd80a9ef1d6435953f00c8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JzsnTikq2EFLShSviAs53A.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">示例数据集的样本。</p></figure><h2 id="3a51" class="nn mk jj bd ml no np dn mp nq nr dp mt lh ns nt mv ll nu nv mx lp nw nx mz ny bi translated">1.定义测试用例</h2><p id="70f5" class="pw-post-body-paragraph ky kz jj la b lb nb kk ld le nc kn lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">首先要做的是定义我们想要获得的期望输出。因此，我们可以查看其中一个演员，并检查该演员制作的最后一部电影是哪部。对于布拉德·皮特来说，这个数据集中最新的电影是<em class="nz">联盟</em>:</p><figure class="nh ni nj nk gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nl"><img src="../Images/3cddeb1033560708a162a2ee2f44ae20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aky00Rc1IIOXUyoh59R6Eg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">布拉德·皮特的电影包含在按年份排序的数据集中。</p></figure><p id="7e4a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们知道我们的输出表必须包含一行，其中演员是布拉德·皮特，标题是<em class="nz">盟军</em>。此外，这必须是唯一一排有布拉德皮特作为演员。基于此，我们可以定义以下测试用例:</p><figure class="nh ni nj nk gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/c7f4d3949aeab24ae7b36b54ef9389d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W95N4_MY0GDRXXOwgmttsw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">输出数据帧的测试用例。</p></figure><p id="bc2b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这几行代码确保我们生成的数据帧满足定义的条件。如果没有，将引发 AssertionError 并停止笔记本的执行。</p><h2 id="c07b" class="nn mk jj bd ml no np dn mp nq nr dp mt lh ns nt mv ll nu nv mx lp nw nx mz ny bi translated">2.编写和验证代码</h2><p id="e073" class="pw-post-body-paragraph ky kz jj la b lb nb kk ld le nc kn lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">因此，让我们开始构建一个只包含每个演员的最后一部电影的表。为了做到这一点，我使用 Pandas 的 rank()函数按电影制作年份对每部电影进行排序，并按演员分组。然后用预定义的测试用例检查其输出:</p><figure class="nh ni nj nk gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/2a3e29739ba72afbbc8a140397587070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ft_NirpBLA_q56gAIRhehQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">测试函数抛出 AssertionError，因为输出表与定义的标准不匹配。</p></figure><p id="3ec5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我们所看到的，生成的数据帧没有通过测试。布拉德·皮特似乎只有一部电影(这是第一个条件)，但这部电影是<em class="nz">巴贝尔</em>而不是<em class="nz">联盟</em>。</p><p id="1cb9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从之前的探索性分析我们知道<em class="nz">巴别塔</em>实际上是布拉德·皮特在数据集中的第<em class="nz">部</em>电影。所以电影的排名肯定有问题。记住，rank()默认情况下按升序排列电影，我们必须更改这个参数，以便电影按年份降序排列:</p><figure class="nh ni nj nk gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/60f383ae06965d4617e274eeb27a41de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GmH8PtVCU4SbpF-5e2185A.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">输出表满足测试用例中定义的标准。</p></figure><p id="1033" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这个小小的更新之后，表通过了测试用例！当然，我们通常会定义一个有更多条件的更复杂的测试用例，但是我认为这个小案例已经帮助传达了这个想法。</p><h2 id="bc0c" class="nn mk jj bd ml no np dn mp nq nr dp mt lh ns nt mv ll nu nv mx lp nw nx mz ny bi translated">在 SQL 中测试</h2><p id="6a1e" class="pw-post-body-paragraph ky kz jj la b lb nb kk ld le nc kn lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">所提出的方法对于在 Python 中测试 SQL 查询也非常有用。如果我们连接到一个数据库，任何查询的输出都可以很容易地用完全相同的方法进行测试:</p><figure class="nh ni nj nk gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/f704eb4d0662001b2310d31c28ac9ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7lVtGn3-i9FcqJg20-euyw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">用 Python 测试 SQL 查询。</p></figure><h1 id="001c" class="mj mk jj bd ml mm mn mo mp mq mr ms mt kp mu kq mv ks mw kt mx kv my kw mz na bi translated">结论</h1><p id="54a9" class="pw-post-body-paragraph ky kz jj la b lb nb kk ld le nc kn lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我们已经看到了 TDD 如何帮助我们在处理数据时关注我们想要达到的目标，并确保我们产生正确的结果。所有这些都可以通过 Pythons 内置的 assert 语句轻松实现。</p><p id="eb1a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将来，这个测试用例将确保我们在更新表格后仍然获得预定义的结果。因此，尽管数据工作可能变得更加复杂，测试功能仍然有助于确保我们代码的一定质量。如果有人拿起代码并开始添加更新，这将变得更加有用:</p><figure class="nh ni nj nk gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/e47667cf2d218660a316298fc11e0018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MNPXJ17J66uGqV-5oLV1hQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">带有更多过滤标准的最后一个电影表。</p></figure><p id="991a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我只能鼓励每个人习惯用这种方法测试你的查询。它可以成为救命稻草！</p><p id="de92" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请在 Github 上我的<a class="ae jg" href="https://github.com/denmei/data-science-projects/tree/master/AssertBlog" rel="noopener ugc nofollow" target="_blank">库中找到这个项目的代码。</a></p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="7837" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">喜欢这篇文章吗？那么你可能也会喜欢我的其他帖子:</p><div class="is it gp gr iu oj"><a rel="noopener follow" target="_blank" href="/ab-testing-challenges-in-social-networks-e67611c92916"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd jk gy z fp oo fr fs op fu fw ji bi translated">社交网络中的 AB 测试挑战</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">脸书和他的同事如何在 AB 测试中克服互联用户的挑战。</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox ja oj"/></div></div></a></div><div class="is it gp gr iu oj"><a href="https://treatwell.engineering/version-control-for-jupyter-notebooks-4012646d1662" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd jk gy z fp oo fr fs op fu fw ji bi translated">Jupyter 笔记本电脑的版本控制</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">为什么版本控制笔记本不是直截了当的，以及如何使用 nbdime 这样的工具来克服这些问题。</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">treatwell .工程</p></div></div><div class="os l"><div class="oy l ou ov ow os ox ja oj"/></div></div></a></div></div></div>    
</body>
</html>