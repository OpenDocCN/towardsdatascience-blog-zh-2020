<html>
<head>
<title>5 Must-Know Pandas Operations on Strings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫 5 个必知的串线操作</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-must-know-pandas-operations-on-strings-4f88ca6b8e25?source=collection_archive---------18-----------------------#2020-08-10">https://towardsdatascience.com/5-must-know-pandas-operations-on-strings-4f88ca6b8e25?source=collection_archive---------18-----------------------#2020-08-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6244" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">熊猫让字符串操作变得简单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/98380dc8446743830e275125967da6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U0hBA8NnTD6l7L8Z2j-eiQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿玛多·洛雷罗在<a class="ae ky" href="https://unsplash.com/s/photos/letters?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6431" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须用数值来表示每一位数据，以便由机器学习和深度学习模型进行处理和分析。然而，字符串通常不会有一个好的和干净的格式，需要预处理来转换成数值。Pandas 提供了许多通用函数来高效地修改和处理字符串数据。</p><p id="6402" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将会发现熊猫是如何操纵绳子的。我将字符串函数和方法分为 5 类:</p><ol class=""><li id="ef83" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">分裂</strong></li><li id="1653" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">剥离</strong></li><li id="8b3c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">更换</strong></li><li id="f971" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">过滤</strong></li><li id="a2e3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">合并</strong></li></ol><p id="925f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先创建一个示例数据框架来处理示例。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="a59a" class="mo mp it mk b gy mq mr l ms mt">import numpy as np<br/>import pandas as pd</span><span id="eea5" class="mo mp it mk b gy mu mr l ms mt">sample = {<br/>'col_a':['Houston,TX', 'Dallas,TX', 'Chicago,IL', 'Phoenix,AZ',      'San Diego,CA'],<br/>'col_b':['$64K-$72K', '$62K-$70K', '$69K-$76K', '$62K-$72K', '$71K-$78K' ],<br/>'col_c':['A','B','A','a','c'],<br/>'col_d':['  1x', ' 1y', '2x  ', '1x', '1y  ']<br/>}</span><span id="d21d" class="mo mp it mk b gy mu mr l ms mt">df_sample = pd.DataFrame(sample)<br/>df_sample</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/a07130754653016cf97d00ef07f27f29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*XzmOHZ4pgy4gch1DWpCFYA.png"/></div></figure><h1 id="c597" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated"><strong class="ak"> 1。分割</strong></h1><p id="1ae2" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">有时字符串携带多条信息，我们可能需要分别使用它们。例如，“col_a”包含城市和州。熊猫的<strong class="lb iu">拆分</strong>功能是一个非常灵活的拆分字符串的功能。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="956a" class="mo mp it mk b gy mq mr l ms mt">df_sample['col_a'].str.split(',')</span><span id="9aa4" class="mo mp it mk b gy mu mr l ms mt">0      [Houston, TX] <br/>1       [Dallas, TX] <br/>2      [Chicago, IL] <br/>3      [Phoenix, AZ] <br/>4    [San Diego, CA] <br/>Name: col_a, dtype: object</span></pre><p id="b4f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，每个元素都根据用于拆分的字符转换成一个列表。我们可以很容易地从这些列表中导出单个元素。让我们创建一个“state”列。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="0c5c" class="mo mp it mk b gy mq mr l ms mt">df_sample['state'] = df_sample['col_a'].str.split(',').str[1]</span><span id="6ca8" class="mo mp it mk b gy mu mr l ms mt">df_sample</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/ba76737a127b539041be40715b014a82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*14v8M3TTRsBDaZl1RJOUlQ.png"/></div></figure><p id="856a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">警告</strong>:下标([1])必须与 str 关键字一起应用。否则，我们将获得指定行中的列表。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="060d" class="mo mp it mk b gy mq mr l ms mt">df_sample['col_a'].str.split(',')[1]<br/>['Dallas', 'TX']</span></pre><p id="6fc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拆分可以在任何字符或字母上进行。</p><p id="fe1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果<strong class="lb iu">扩展</strong>参数设置为真，分割功能返回一个数据帧。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="5a1b" class="mo mp it mk b gy mq mr l ms mt">df_sample['col_a'].str.split('a', expand=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/9e5a813dfd8f626c8024f9e65406d4c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*Hy0GoqfVQxW8vNZm5o1qsA.png"/></div></figure><h1 id="0286" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated"><strong class="ak">拆分与再拆分</strong></h1><p id="cc92" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">默认情况下，从左侧进行拆分。要在右侧进行分割，请使用<strong class="lb iu"> rsplit </strong>。</p><p id="98f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑下面的系列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/5792c6586b9c5b705a37a3e9f73578b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*4Q94-snsDx_69r4AksAKtQ.png"/></div></figure><p id="de62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们应用分割功能，并使用<strong class="lb iu"> n </strong>参数限制分割次数:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="51fa" class="mo mp it mk b gy mq mr l ms mt">categories.str.split('-', expand=True, n=2)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/337519aa97ee9d258d0a399fb0be4e3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*7QZvvZ-PbfavJTBocJ-RVw.png"/></div></figure><p id="caa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅执行左侧的 2 次拆分。如果我们用<strong class="lb iu"> rsplit </strong>做同样的操作:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="3394" class="mo mp it mk b gy mq mr l ms mt">categories.str.rsplit('-', expand=True, n=2)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/e11b02b2faffd654fd7534e6bb393c6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*2avK-jpzgT1W-MoAmIymgA.png"/></div></figure><p id="f8dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成相同的操作，但在右侧。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="9bd1" class="mw mp it bd mx my oe na nb nc of ne nf jz og ka nh kc oh kd nj kf oi kg nl nm bi translated"><strong class="ak"> 2。剥离</strong></h1><p id="0b75" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">剥就像修剪树枝。我们可以删除字符串开头或结尾的空格或任何其他字符。</p><p id="64f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如,“col_b”中的字符串开头有$字符，可以用<strong class="lb iu"> lstrip </strong>删除:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="a3c2" class="mo mp it mk b gy mq mr l ms mt">df_sample['col_b'].str.lstrip('$')</span><span id="bfaf" class="mo mp it mk b gy mu mr l ms mt">0    64K-$72K <br/>1    62K-$70K <br/>2    69K-$76K <br/>3    62K-$72K <br/>4    71K-$78K <br/>Name: col_b, dtype: object</span></pre><p id="4269" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类似地，<strong class="lb iu"> rstrip </strong>用于从末尾开始修剪字符。</p><p id="e406" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">字符串的开头或结尾可以有空格。考虑我们数据框架中的“col_d”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/468b809311cf075b58406c7fa0f1b9e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*B9K7BwaY0-hwxEaXEBCWlw.png"/></div></figure><p id="6525" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些前导和尾随空格可以用 strip 删除:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="1ec4" class="mo mp it mk b gy mq mr l ms mt">df_sample['col_d'] = df_sample['col_d'].str.strip()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/dc0e419c6fe45439734afcaa0c7723c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*4bGSI_iNZhYa76Y7JVlsYw.png"/></div></figure></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="b668" class="mw mp it bd mx my oe na nb nc of ne nf jz og ka nh kc oh kd nj kf oi kg nl nm bi translated"><strong class="ak"> 3。更换</strong></h1><p id="d84a" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">熊猫替换函数用于替换行或列中的值。类似地，替换为字符串操作用于替换字符串中的字符。</p><p id="027b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用“z”代替“col_d”中的“x”字母。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="895f" class="mo mp it mk b gy mq mr l ms mt">df_sample['col_d'] = df_sample['col_d'].str.replace('x', 'z')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/af995d1f27ffe65a3ec34a6840d1b7e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*Dr9NdUIoUM17pEljEkqb5Q.png"/></div></figure></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="3197" class="mw mp it bd mx my oe na nb nc of ne nf jz og ka nh kc oh kd nj kf oi kg nl nm bi translated"><strong class="ak"> 4。过滤</strong></h1><p id="9e91" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">我们可以根据第一个和最后一个字符过滤字符串。要使用的函数有<strong class="lb iu"> startswith() </strong>和<strong class="lb iu"> endswith() </strong>。</p><p id="4ef9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们的原始数据框架:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/ac0d7862a45498ec1c34d4e746b94add.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*bl9PxkXLNOTV6uzW9b7QDQ.png"/></div></figure><p id="9849" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个经过筛选的版本，只包含“col_a”以字母“x”结尾的行。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="9787" class="mo mp it mk b gy mq mr l ms mt">df_sample[df_sample['col_a'].str.endswith('X')]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/178baaa8b7ee6b4ac9817685be9738cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*Wostx8tcyX8r0zVAuK6hjQ.png"/></div></figure><p id="7a3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，“col_b”以“$6”开头的行:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="51ba" class="mo mp it mk b gy mq mr l ms mt">df_sample[df_sample['col_b'].str.startswith('$6')]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/51edeb654383f4647a7cee83ee2d372c.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*QD5MBLGlxiUYKjOiep5IPw.png"/></div></figure><p id="266b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以通过提取某些字符来过滤字符串。例如，我们可以通过<strong class="lb iu"> str[:2] </strong>得到一列或一系列字符串的前 2 个字符。</p><p id="53aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“col_b”表示一个数值范围，但数值隐藏在字符串中。让我们用字符串下标提取它们:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="47d0" class="mo mp it mk b gy mq mr l ms mt">lower  = df_sample['col_b'].str[1:3]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/1a1749c474104593384fbb41c00b38b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*beD7wW_2n7mKgWxKZsAMfQ.png"/></div></figure><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="ef6f" class="mo mp it mk b gy mq mr l ms mt">upper  = df_sample['col_b'].str[-3:-1]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/0b9582ada4ece7617b3123ab6ad74669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*uGVHs6tHy9ZGF4h5vBXqIg.png"/></div></figure></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="3714" class="mw mp it bd mx my oe na nb nc of ne nf jz og ka nh kc oh kd nj kf oi kg nl nm bi translated"><strong class="ak"> 5。组合</strong></h1><p id="4420" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><strong class="lb iu"> Cat </strong>函数可用于连接字符串。</p><p id="d5b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要使用<strong class="lb iu"> sep </strong>参数传递一个参数放在连接的字符串之间。默认情况下，cat 忽略缺失值，但是我们也可以使用<strong class="lb iu"> na_rep </strong>参数指定如何处理它们。</p><p id="ab38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过用“-”分隔符连接“col_c”和“col_d”来创建一个新列。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="d617" class="mo mp it mk b gy mq mr l ms mt">df_sample['new']=df_sample['col_c'].str.cat(df_sample['col_d'], sep='-')</span><span id="b989" class="mo mp it mk b gy mu mr l ms mt">df_sample</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/a969bebc05e7c75571d6cf15a7455a4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*Wn1JNYOUN4-3XYuCSJwoYQ.png"/></div></figure></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="9104" class="mw mp it bd mx my oe na nb nc of ne nf jz og ka nh kc oh kd nj kf oi kg nl nm bi translated">额外收获:对象 vs 字符串</h1><p id="6c14" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">在 pandas 1.0 之前，只有“object”数据类型用于存储字符串，这导致了一些缺点，因为非字符串数据也可以使用“object”数据类型存储。Pandas 1.0 引入了一种新的特定于字符串数据的数据类型，即<strong class="lb iu">string type</strong>。到目前为止，我们仍然可以使用 object 或 string type 来存储字符串，但是在将来，我们可能会被要求只使用 string type。</p><blockquote class="oq or os"><p id="6e3a" class="kz la ot lb b lc ld ju le lf lg jx lh ou lj lk ll ov ln lo lp ow lr ls lt lu im bi translated">这里需要注意的一件重要事情是，对象数据类型仍然是字符串的默认数据类型。要使用 StringDtype，我们需要显式声明它。</p></blockquote><p id="6163" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过“<strong class="lb iu">字符串</strong>或<strong class="lb iu"> pd。StringDtype() </strong>参数为 Dtype 参数为 string 数据类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/093622c0a552520fb747ed53fd35390b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/0*-8fHHYP5ajlfSQx5.png"/></div></figure></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="c8c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>