<html>
<head>
<title>Categorical Feature Encoding Techniques</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分类特征编码技术</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/categorical-encoding-techniques-93ebd18e1f24?source=collection_archive---------7-----------------------#2020-04-04">https://towardsdatascience.com/categorical-encoding-techniques-93ebd18e1f24?source=collection_archive---------7-----------------------#2020-04-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="85d9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python 中分类特征的编码方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1ba9beeced6cd2e6f8a39957fa6e28f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cAdMhSq0ZoeoDhOkvw-N-g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@v2osk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> v2osk </a>在<a class="ae ky" href="https://unsplash.com/s/photos/categories?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="82cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分类数据是一种常见的非数值型数据，它包含标签值而不是数字。一些例子包括:</p><ul class=""><li id="0803" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">颜色:红色、绿色、蓝色</li><li id="f2e3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">城市:纽约、奥斯汀、丹佛</li><li id="b765" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">性别:男，女</li><li id="d989" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">排名:第一，第二，第三</li></ul><p id="e543" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据<a class="ae ky" href="https://en.wikipedia.org/wiki/Categorical_variable" rel="noopener ugc nofollow" target="_blank">维基百科</a>，“分类变量是一个可以取有限的，通常是固定数量的可能值的变量。”</p><p id="a82d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常将分类变量的可能值称为级别。</p><p id="30fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有几种不同类型的分类数据，包括:</p><ul class=""><li id="89cc" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">二进制</strong>:只有 2 个值的变量。例如，对/错或是/否。</li><li id="9939" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">序数</strong>:一个变量，它有一些相关的顺序，就像我们上面的 place 例子。</li><li id="5a79" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">名义</strong>:没有数值重要性的变量，例如颜色或城市。</li></ul><p id="e3c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多机器学习算法不能直接处理分类数据。它们要求数据是数字。因此，了解如何对分类变量进行编码至关重要。</p><h2 id="d3e7" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">数据</h2><p id="9040" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们将使用来自<a class="ae ky" href="https://www.kaggle.com/c/cat-in-the-dat-ii" rel="noopener ugc nofollow" target="_blank"> Kaggle 的分类特征编码挑战 II </a>的数据。这个挑战的特点是数据集只有分类变量，这使得它非常适合探索不同的分类编码方法。</p><p id="d744" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集包含二进制、名义和序数要素。我们将探索对每种类型的特征进行编码的方法。</p><p id="4f17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的笔记本可以在<a class="ae ky" href="https://www.kaggle.com/tboyle10/categorical-encoding-techniques" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="5f36" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">二进制特征编码</h1><p id="059c" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">二元特征是那些只有两个可能值的特征。</p><p id="65ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的数据集中有五个二元要素。正如我们在下面看到的，前三个已经是数字，不需要任何操作，<code class="fe ns nt nu nv b">bin_3</code>和<code class="fe ns nt nu nv b">bin_4</code>是需要编码的字符串。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/03ee3662e970db2b7bdb9a3f556d3dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*WHPPqOosAg49u8Ocoqqk1A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">编码前的二进制特征</p></figure><p id="7e8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为这些是二进制特征，我们可以用<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.replace.html" rel="noopener ugc nofollow" target="_blank">熊猫的</a>T2 对它们进行编码:</p><pre class="kj kk kl km gt nx nv ny nz aw oa bi"><span id="4029" class="mj mk it nv b gy ob oc l od oe">df['bin_3'] = df['bin_3'].replace({'T':1}, 'F':0})<br/>df['bin_4'] = df['bin_4'].replace({'Y':1, 'N':0})</span></pre><p id="d21e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们将一个字典传递给<code class="fe ns nt nu nv b">replace()</code>，以当前值作为键，以所需值作为值。下面我们可以看到我们的二进制特征编码。(现在，我们将忽略空值。)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/54a31ab66e040f53a2e22bcb0c189e57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*NQCo_bTTAtpi54c25AvcCQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">编码后的二进制特征</p></figure><p id="e4af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于二元特征，使用<code class="fe ns nt nu nv b">replace()</code>非常有帮助，但是如果我们有更多类别的分类特征呢？</p><h1 id="5b69" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">序数特征编码</h1><p id="129b" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">序数特征是那些具有某种顺序的特征。我们可以从下面的有序特征样本中看出，这些特征有一个可能很重要的顺序。</p><p id="747b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从 Kaggle 的排名系统中，我们知道特级大师的位置高于新手或贡献者。</p><p id="0d6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">机器学习模型可能能够使用订单信息来做出更好的预测，我们希望保留它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/ff19b9342d2c6edaebc84449ccd0c9ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h_kLUi5Jwd5IOxQCx2_CtQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">编码前的序数特征。</p></figure><p id="1afb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于序数特征，我们使用整数编码。要对数据进行整数编码，我们只需将标签转换为整数值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/89801c2aba27f52ec0905865dc6c94e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kPKvp4c462GB1NS8UotXYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">标签编码。</p></figure><p id="04e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然整数编码有许多方法，但我们将在这里讨论两种:</p><ul class=""><li id="7ccf" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">Sklearn 的<code class="fe ns nt nu nv b">LabelEncoder()</code></li><li id="acfa" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">熊猫的<code class="fe ns nt nu nv b">map()</code></li></ul><p id="0240" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.LabelEncoder.html" rel="noopener ugc nofollow" target="_blank"> Sklearn 的</a> <code class="fe ns nt nu nv b">LabelEncoder()</code>来标注编码数据:</p><pre class="kj kk kl km gt nx nv ny nz aw oa bi"><span id="8e97" class="mj mk it nv b gy ob oc l od oe">from sklearn.preprocessing import LabelEncoder</span><span id="0338" class="mj mk it nv b gy oi oc l od oe">#label encoder can't handle missing values<br/>ordinal_features['ord_1'] = ordinal_features['ord_1'].fillna('None')</span><span id="6108" class="mj mk it nv b gy oi oc l od oe"># Label encode ord_1 feature<br/>label_encoder = LabelEncoder()<br/>ordinal_features['ord_1'] = label_encoder.fit_transform(ordinal_features['ord_1'])</span><span id="ee60" class="mj mk it nv b gy oi oc l od oe"># Print sample of dataset<br/>ordinal_features.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/c65eaa7630747391e96ac7b93b82b826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*IzHEf6mnE9uTZEX2A6FgZg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ord _ 1 编码的序数特征。</p></figure><p id="da16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面我们看到了编码特征<code class="fe ns nt nu nv b">ord_1</code>。我们可以看到值<em class="ok">特级大师</em>用整数 2 编码，<em class="ok">新手</em>用整数 5 编码，<em class="ok">无</em>用整数 4 编码。</p><p id="c7fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然使用<code class="fe ns nt nu nv b">LabelEncoder()</code>非常快速和简单，但它可能不是这里的最佳选择:我们的编码顺序并不完全正确。此外，在能够使用它之前，我们必须处理我们的空值。</p><p id="2ef3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ns nt nu nv b">LabelEncoder()</code>的另一个缺点是，文档声明它应该用于编码目标值(y ),而不是输入值(x)。让我们探索一种不同的方法来编码我们的序数特征。</p><p id="e5cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的另一个选项是使用<code class="fe ns nt nu nv b">map()</code>。</p><p id="2211" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.map.html" rel="noopener ugc nofollow" target="_blank">熊猫的</a> <code class="fe ns nt nu nv b">map()</code>用另一个指定值替换每个值，类似于我们上面用的<code class="fe ns nt nu nv b">replace()</code>。在这里，我们用我们想要的映射创建一个字典，并将映射应用到我们的系列:</p><pre class="kj kk kl km gt nx nv ny nz aw oa bi"><span id="d9c2" class="mj mk it nv b gy ob oc l od oe"># create dictionary of ordinal to integer mapping<br/>ord_2 = {'Freezing':1, <br/>            'Cold':2, <br/>            'Warm':3, <br/>            'Hot':4, <br/>            'Boiling Hot':5, <br/>            'Lava Hot':6}</span><span id="1e3f" class="mj mk it nv b gy oi oc l od oe"># apply using map<br/>df['ord_2'] = df.ord_2.map(ord_2)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/62c37d87761368742f71429561e67958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*W_RWad6rEP3RRqyzgvXcZg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ord _ 1 和 ord _ 2 使用 map 编码的序号要素。</p></figure><p id="e520" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe ns nt nu nv b">map()</code>允许我们指定分类特征中值的顺序，以确保它们处于有意义的排列中。</p><p id="7de5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些方法应该只用于顺序特征，因为顺序很重要。对于顺序不重要的特性，我们必须探索其他技术。</p><h1 id="40ed" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">名义特征</h1><p id="1f78" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">名义特征是没有数字重要性的分类特征。顺序并不重要。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/4d84043b058b2c14f2e8e3d764a9e134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ezyT7nhZSrypJwuZQJEK5Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">编码前的名义特征。</p></figure><p id="de57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当顺序不重要时，一键编码是一种更好的技术。例如，在特征<code class="fe ns nt nu nv b">nom_1</code>中，我们有形状。这里没有明显的顺序。一种形状并不比另一种好。</p><p id="08bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，顺序并不重要，整数编码可能会导致模型性能下降，因此不应该使用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/f99386c7d491d42ab1d6de48d97bed4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZLqbZqqrwiqkGxxl2vYkg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个热编码</p></figure><p id="93d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在一个热编码中，为分类变量中的每个唯一值创建一个新的二进制(虚拟)变量。在上图中，我们有三种独特的颜色，所以我们创建了三个新的特征，每种颜色一个。如果值为真，则将整数 1 放入字段中，如果值为假，则放入 0。</p><p id="e995" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们可以使用<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.get_dummies.html" rel="noopener ugc nofollow" target="_blank">熊猫的</a> <code class="fe ns nt nu nv b">get_dummies()</code>对我们的名义特征进行一次热编码。</p><p id="fd77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该方法将分类变量转换为虚拟变量，并返回数据帧。<code class="fe ns nt nu nv b">drop_first</code>参数有助于通过移除第一级来获得 k-1 个假人。</p><pre class="kj kk kl km gt nx nv ny nz aw oa bi"><span id="4b14" class="mj mk it nv b gy ob oc l od oe">nominal_features = pd.get_dummies(nominal_features, drop_first=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/149e05aa3eb150b66c26d9262853eab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pIPG6Ao8n2y9_egO1uwzaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">编码后的名义特征。</p></figure><p id="41aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以从上面的一个热编码的名义特征的例子中看到，这种类型的编码可以大大增加我们的列数。我们输入 10 列，编码后现在有超过 5000！</p><p id="cd91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在高基数特性的情况下，那些具有许多可能值的特性，我们可能需要在编码之前做一些操作。例如，对于只出现很少一部分时间的值，我们可以将它们归入“其他”类别。</p><h1 id="cfa7" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">其他技术</h1><h2 id="843b" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">删除分类变量</h2><p id="a122" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">另一种方法是从数据集中删除分类变量。虽然移除特征始终是一种选择，但它可能不是处理分类变量的最佳方式，因为我们会丢失潜在的重要信息。</p><p id="bc36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我们一直在处理的数据集只包含分类特征，这显然不是这种情况下的一个选项！</p><h1 id="9fe3" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">结论</h1><p id="7235" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们探索了根据类型对分类变量进行编码的基本技术:</p><ul class=""><li id="06fa" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">二进制的</li><li id="c29c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">序数</li><li id="6fce" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">名义上的</li></ul><p id="10a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然回顾的技术决不是编码分类变量的唯一选择，但它们是一个很好的起点。</p><p id="7b5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在以后的文章中，我们将探索其他分类编码技术。</p></div></div>    
</body>
</html>