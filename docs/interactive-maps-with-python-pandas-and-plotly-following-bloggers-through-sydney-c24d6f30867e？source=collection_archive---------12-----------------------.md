# Pythonã€Pandas å’Œ Plotly çš„äº¤äº’å¼åœ°å›¾

> åŸæ–‡ï¼š<https://towardsdatascience.com/interactive-maps-with-python-pandas-and-plotly-following-bloggers-through-sydney-c24d6f30867e?source=collection_archive---------12----------------------->

## è·Ÿéšåšä¸»åœ¨æ‚‰å°¼çš„è¶³è¿¹

åœ¨è¿™ç¯‡æ–‡ç« å’Œå…¶ä»–å‡ ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æ¢ç´¢ Python å’Œ Plotlyï¼ŒæŠŠä¸€äº›ä¸åŒçš„çœ‹èµ·æ¥å¾ˆæ£’çš„å›¾è¡¨æ”¾åœ¨ä¸€èµ·ã€‚Plotly.js æ˜¯ä¸€ä¸ªåŸºäº Javascript çš„å¯è§†åŒ–åº“ï¼Œç”±ä¸€å®¶åä¸º Plotly çš„å…¬å¸æ„å»ºï¼Œä»–ä»¬ä¹Ÿä¸ºå„ç§è¯­è¨€æä¾›äº†åŒ…è£…å™¨ï¼ŒåŒ…æ‹¬ä¸€ä¸ªåä¸ºâ€¦ plotly çš„ python åŒ…è£…å™¨ã€‚

å°½ç®¡å®ƒä»¬çš„å‘½åæ¨¡å¼ä¸å°½å¦‚äººæ„ï¼Œä½†å®ƒä»¬ç¡®å®æ„å»ºäº†ä¸€ä¸ªéå¸¸å¼ºå¤§ã€ä½†ä»éå¸¸å¯å®šåˆ¶çš„åº“ï¼Œæˆ‘å¾ˆæƒ³æ¢ç´¢å®ƒèƒ½åšä»€ä¹ˆã€‚

> *ä½ å¯ä»¥è·Ÿéšæˆ‘ä½¿ç”¨çš„æºä»£ç å’Œæ•°æ®ï¼Œä»è¿™ä¸ª* [*GitLab åº“*](https://gitlab.com/jphwang/online_articles) *ã€‚*

# ä½ç½®ï¼Œä½ç½®ï¼Œä½ç½®

ç»å¸¸çœ‹æ–‡ç« ï¼Œåƒç¾é£Ÿåšå®¢ï¼Œæˆ–è€…æ—…æ¸¸åšå®¢ï¼Œæƒ³:*è¿™äº›åœ°æ–¹åˆ°åº•åœ¨å“ªé‡Œ*ï¼Ÿ

åœ¨å»å¹´çš„åœ£è¯å‡æœŸï¼Œæˆ‘æœ‰æœºä¼šå’Œæˆ‘çš„ä¼´ä¾£ä¸€èµ·å›åˆ°æ‚‰å°¼ï¼Œå¥¹ä»æœªå»è¿‡æ¾³å¤§åˆ©äºšï¼Œæ›´ä¸ç”¨è¯´æ‚‰å°¼äº†ã€‚æˆ‘æ¥è‡ªæ‚‰å°¼ï¼Œæˆ‘æƒ³å¸®åŠ©å¥¹çœ‹åˆ°æ‚‰å°¼çš„â€œæœ€å¥½â€ï¼Œå¹¶åƒæˆ‘ä»¬è®¸å¤šäººä¸€æ ·æ¬£èµå®ƒã€‚

æ‰€ä»¥æˆ‘è¯»äº†ä¸€äº›æ—…æ¸¸åšå®¢ï¼Œçœ‹çœ‹ç¬¬ä¸€æ¬¡æ¥çš„æ¸¸å®¢å–œæ¬¢æ‚‰å°¼çš„ä»€ä¹ˆã€‚æˆ‘çªç„¶æ„è¯†åˆ°è¿™æ ·åšä¼šè®©æ¸¸å®¢å¾ˆå®¹æ˜“æä¸æ¸…ä¸œè¥¿åœ¨å“ªé‡Œï¼Œå“ªäº›æ™¯ç‚¹å€¼å¾—ä¸€çœ‹ã€‚è®¡åˆ’æ¯ä¸€å¤©çš„æ—¥ç¨‹å°†æ˜¯ä¸€ä»¶ç—›è‹¦çš„äº‹ï¼Œå› ä¸ºæ°¸è¿œä¸æ¸…æ¥šä¸€ä¸ªåœ°æ–¹ä¸å¦ä¸€ä¸ªåœ°æ–¹ç›¸æ¯”æœ‰å¤šè¿œã€‚

æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯ç»˜åˆ¶ä¸€å¼ åœ°å›¾ï¼Œå¿ƒä¸­æœ‰ä¸‰ä¸ªç›®æ ‡:

*   ç¬¬ä¸€ï¼Œå»ºç«‹ä¸€ä¸ªäº’åŠ¨åœ°å›¾ï¼ŒåŒ…æ‹¬æ¯ä¸€ä¸ªæ ‡è®°çš„ä½ç½®ã€‚
*   ç¬¬äºŒï¼Œåœ°å›¾ä¼šæœ‰ä¸åŒçš„æ ‡è®°æ¥è¡¨ç¤ºä½ç½®çš„ç±»å‹ã€‚æ— è®ºå®ƒæ˜¯ä¸€ä¸ªåœ°æ ‡ï¼Œä¸€ä¸ªä½ç½®(åƒä¸€ä¸ªéƒŠåŒº)ï¼Œè¿˜æ˜¯ä¸€ä¸ªäº¤é€šæ¢çº½ã€‚
*   ç¬¬ä¸‰ï¼Œæ˜¾ç¤ºæœ‰å¤šå°‘åšå®¢æåˆ°äº†è¿™ä¸ªä½ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç­›é€‰å‡ºæ›´â€œé‡è¦â€çš„ã€‚

Plotly æœ‰æˆ‘å®šåˆ¶çš„å¯è§†åŒ–åº“ã€‚æˆ‘å·²ç»çœ‹åˆ°å®ƒåŒ…å«äº†ä¸€ä¸ªæƒŠäººçš„åœ°å›¾æ¡†é›†æˆï¼Œè¿™æ˜¯æˆ‘ä»¥å‰æ²¡æœ‰å°è¯•è¿‡çš„ã€‚æ‰€ä»¥æˆ‘æƒ³æˆ‘ä¼šä¸€çŸ³äºŒé¸Ÿã€‚

# åœ¨å¼€å§‹ä¹‹å‰

æˆ‘å‡è®¾æ‚¨ç†Ÿæ‚‰ pythonã€‚å³ä½¿ä½ ç›¸å¯¹è¾ƒæ–°ï¼Œè¿™ä¸ªæ•™ç¨‹ä¹Ÿä¸åº”è¯¥å¤ªéš¾ã€‚

ä½ éœ€è¦ç”¨ä¸€ä¸ªç®€å•çš„`pip install [PACKAGE_NAME]`å°†`pandas`å’Œ`plotly`å®‰è£…åˆ°ä½ çš„è™šæ‹Ÿç¯å¢ƒä¸­ã€‚

å¦‚æœä½ æ²¡æœ‰åœ°å›¾æ¡†ä»¤ç‰Œï¼Œ[ç»™ä»–ä»¬è®¾ç½®ä¸€ä¸ª](https://www.mapbox.com)â€”â€”æˆ‘ä»¬ä¼šéœ€è¦å®ƒã€‚ä»–ä»¬æä¾›äº†ä¸€ä¸ªéå¸¸è‡ªç”±çš„å¸æˆ·ï¼Œæœ‰éå¸¸åˆç†çš„è®¿é—®é™åˆ¶ã€‚

æˆ‘å°†å¯†é’¥ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åŠ è½½å®ƒ:

```
with open('mapbox_tkn.txt', 'r') as f: 
    mapbox_key = f.read().strip()
```

# åœ°å›¾å¾ˆæœ‰è¶£

## ä»‹ç»

å°½ç®¡ä½¿ç”¨äº† NLP å·¥å…·ï¼Œæ•´ç†è¿™äº›ä¿¡æ¯è¿˜æ˜¯æœ‰ç‚¹å›°éš¾ï¼Œå› ä¸ºäººä»¬åšæŒåœ¨åšå®¢ä¸Šæ‹¼é”™åå­—ï¼Œæˆ–è€…åªæ˜¯ç”¨ä¸åŒçš„åå­—ç§°å‘¼äº‹ç‰©ã€‚(â€˜æµ·æ¸¯å¤§æ¡¥â€™è¿˜æ˜¯â€˜æ‚‰å°¼æ¸¯æ¹¾å¤§æ¡¥â€™ï¼Ÿç»´å¤šåˆ©äºšå¥³ç‹å¤§å¦è¿˜æ˜¯ QVBï¼Ÿ)

æœ¬æ•™ç¨‹ä¾§é‡äºæƒ…èŠ‚ï¼Œè€Œä¸æ˜¯åˆ®ï¼Œæ‰€ä»¥æˆ‘ä¼šæä¾›`loc_data.csv`(æ‰€æœ‰æ•°æ®å’Œè„šæœ¬å¯åœ¨æˆ‘çš„ [repo è¿™é‡Œ](https://gitlab.com/jphwang/online_articles))ã€‚è¯¥æ–‡ä»¶åŒ…å«æˆ‘ä»¬è¦æŸ¥çœ‹çš„æ‰€æœ‰ç‹¬ç‰¹ä½ç½®çš„æ•°æ®ã€‚æ¯ä¸ªåšå®¢çš„æ•°æ®éƒ½åŒ…å«åœ¨åä¸º`blog_file[N].csv`çš„`data_csvs`å­ç›®å½•ä¸­ã€‚

å°† csv æ–‡ä»¶åŠ è½½åˆ°æ•°æ®å¸§ä¸­ï¼Œå¹¶æŸ¥çœ‹å…¶å†…å®¹:

```
loc_df = pd.read_csv('mapping_blogs/loc_data.csv', index_col=0) print(loc_df.head())
```

æ‚¨å°†çœ‹åˆ°æœ‰äº”åˆ—:ç´¢å¼•ã€ä½ç½®ã€çº¬åº¦ã€ç»åº¦å’Œç±»å‹ã€‚

å®ƒä»¬æ˜¯ç´¢å¼•å·ã€ä½ç½®åç§°å­—ç¬¦ä¸²ã€ä»¥å°æ•°è¡¨ç¤ºçš„çº¬åº¦å’Œç»åº¦ä»¥åŠä½ç½®ç±»å‹ã€‚

## æ•°æ®æ¸…ç†

ç¬¬ä¸€æ¬¡æ£€æŸ¥æ—¶,â€œç±»å‹â€åˆ—çœ‹èµ·æ¥æ˜¯ç»å¯¹çš„ã€‚ä¸€åˆ—ä¸­çš„æ‰€æœ‰å”¯ä¸€å€¼éƒ½å¯ä»¥é€šè¿‡`loc_df.type.unique()`è¿›è¡Œæ•´ç†ã€‚å®ƒæ˜¾ç¤ºçš„æ˜¯`['Area', nan, 'Food/Drinks', 'Transport', 'Lodging']`ã€‚çš„ç¡®å¦‚æ­¤ï¼æˆ‘è®°å¾— NaN å€¼æ˜¯é‚£äº›æˆ‘æ— æ³•å½’ç±»çš„å€¼ã€‚å…ˆç»™å®ƒä»¬èµ·ä¸ªåå­—ï¼Œ`Misc`ä¸ºæ‚ã€‚

æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ pandas çš„`.fillna`æ–¹æ³•å’Œ`inplace`å‚æ•°ã€‚`loc_df.type.fillna('Misc', inplace=True)`å°†å®Œæˆæ­¤æ“ä½œï¼Œå¹¶å¡«å…¥ä»»ä½• NaN å€¼ã€‚

## æˆ‘ä»¬çš„ç¬¬ä¸€å¼ åœ°å›¾

åˆ°è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å®é™…ä¸Šå·²ç»æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥è®¾è®¡ä¸€äº›ä¸œè¥¿äº†ï¼é€šè¿‡ plotly çš„é­”åŠ›ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸ºæˆ‘ä»¬çš„ç¬¬ä¸€å¼ åœ°å›¾æ·»åŠ ä»¥ä¸‹ä»£ç è¡Œ:

```
import plotly.express as px 
fig = px.scatter_mapbox(loc_df, lat="lat", lon="lon", color="type")
fig.update_layout(mapbox_style="open-street-map") 
fig.show()
```

![](img/321a5b80393be013f6698fef491ac3e4.png)

æˆ‘ä»¬çš„ç¬¬ä¸€å¼ åœ°å›¾ï¼

ç±»ä¼¼è¿™æ ·çš„ä¸œè¥¿åº”è¯¥å·²ç»åœ¨ä½ çš„æµè§ˆå™¨ä¸Š(æˆ–è€…åœ¨ä½ çš„ Jupyter ç¬”è®°æœ¬ä¸Š)æ‰“å¼€äº†ã€‚æ˜¯ä¸æ˜¯å¾ˆé…·ï¼Ÿä»…ä»…ç”¨äº†ä¸‰è¡Œä»£ç å°±ç”»å‡ºäº†è¿™ä¸ªã€‚Plotly Express å¯ä»¥æ›´å¿«åœ°åˆ›å»ºæƒ…èŠ‚ã€‚åœ°å›¾æ˜¯äº¤äº’å¼çš„ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å•å‡»å›¾ä¾‹æ¥ç¼©æ”¾ã€å¹³ç§»ã€æŸ¥çœ‹æ ‡è®°å’Œéš”ç¦»æ¯ä¸ªåœ°å—ã€‚

æˆ‘ä»¬åœ¨è¿™é‡Œåšçš„æ˜¯å°†æ•´ä¸ªæ•°æ®å¸§ä¼ é€’ç»™`.scatter_mapbox`å‡½æ•°ï¼Œå¹¶æŒ‡å®šæ•°æ®æ‰€åœ¨çš„åˆ—ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨`update_layout`æŒ‡å®š`open-street-map`æ ·å¼(æœ¬æŒ‡å—ä¸­çš„[åˆ—å‡ºäº†å¯ç”¨çš„æ ·å¼)ã€‚](https://plot.ly/python/mapbox-layers/)

å¦‚æœæ‚¨æƒ³çŸ¥é“æˆ‘ä»¬æ˜¯å¦‚ä½•å°†ä¹‹å‰åŠ è½½çš„`mapbox_key`å˜é‡ä¼ é€’ç»™ Plotly çš„ï¼Œç­”æ¡ˆæ˜¯æˆ‘ä»¬æ²¡æœ‰ã€‚ä½¿ç”¨`open-street-map`é£æ ¼æ„å‘³ç€ä¸éœ€è¦åœ°å›¾æ¡†é”®ï¼Œå¼€æ”¾è¡—é“åœ°å›¾æ˜¯ä¸€ä¸ªå…è´¹çš„åˆä½œé¡¹ç›®ã€‚

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•åˆ¶ä½œä¸€ä¸ªåŸºæœ¬çš„åœ°å›¾ï¼Œè®©æˆ‘ä»¬è¿›å…¥æ‚è‰ä¸­ï¼Œä»”ç»†è§‚å¯Ÿæ•°æ®ï¼Œå¹¶æ·»åŠ ä¸€äº›é™„åŠ åŠŸèƒ½ã€‚

# ä¸¥è‚ƒçš„æ˜ å°„

## é¼ æ ‡æ‚¬åœ

åœ¨ç©åœ°å›¾çš„æ—¶å€™ï¼Œä½ å¯èƒ½æ³¨æ„åˆ°äº†é¼ æ ‡æ‚¬åœå·¥å…·æç¤ºã€‚å®ƒä»¬å¾ˆæ£’ï¼Œä½†ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚æ‰€ä»¥è®©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬æƒ³çœ‹çœ‹è¿™ä¸ªåœ°æ–¹çš„åå­—ï¼Œä¸å¤ªåœ¨ä¹ç¡®åˆ‡çš„åæ ‡ã€‚è®©æˆ‘ä»¬æŒ‡å®šå‚æ•°`hover_name='location'`ï¼Œè€Œä¸æ˜¯`hover_data=['type']`ã€‚

æˆ‘è¿˜è®¤ä¸ºå½©è‰²åœ°å›¾æœ‰ç‚¹åˆ†æ•£äº†å åŠ çš„æ³¨æ„åŠ›ï¼Œæ‰€ä»¥æˆ‘æŠŠåœ°å›¾æ¡†æ ·å¼æ”¹æˆäº†`light`ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦æä¾›åœ°å›¾æ¡†é”®ã€‚æœ€åï¼Œå½“æˆ‘å¯¹æ‚‰å°¼å¸‚åŒºæœ€æ„Ÿå…´è¶£çš„æ—¶å€™ï¼Œæˆ‘è®¤ä¸ºåœ°å›¾ä¸€å¼€å§‹å°±å¤ªé«˜äº†ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬é€šè¿‡æŒ‡å®š`zoom`å‚æ•°æ¥æ›´æ”¹é»˜è®¤çš„æ˜ å°„åŒºåŸŸã€‚ä»£ç å’Œç”Ÿæˆçš„åœ°å›¾å¦‚ä¸‹:

```
fig = px.scatter_mapbox(loc_df, lat="lat", lon="lon", color="type", hover_name='location', hover_data=['type'], zoom=12) 
# Now using Mapbox 
fig.update_layout(mapbox_style="light", mapbox_accesstoken=mapbox_key) 
fig.show()
```

![](img/bafe48e006b5c7ce25cf3abd2826573f.png)

é¼ æ ‡æ‚¬åœå¼¹å‡ºçª—å£å¾ˆæ£’ï¼Œä½†æ˜¯(è¿˜)ä¸å¤ªèƒ½æä¾›ä¿¡æ¯

å¥½å§ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„è¿›æ­¥ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†ä¸‰ä¸ªç›®æ ‡ä¸­çš„ä¸¤ä¸ªã€‚å¯¹äºæœ€åä¸€ä¸ªï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ç¼–è¯‘ä½ç½®çš„è®¡æ•°ã€‚æ‰€ä»¥ï¼Œå›åˆ°æ•°æ®æ¡†æ¶ã€‚

## å¯»æ‰¾æœ€å—æ¬¢è¿çš„ç›®çš„åœ°

æˆ‘æƒ³çœ‹çœ‹å“ªäº›ç›®çš„åœ°æˆ–åœ°ç‚¹æœ€å—åšå®¢ä½œè€…çš„æ¬¢è¿ã€‚å› æ­¤ï¼Œåœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç»Ÿè®¡æ¯ä¸ªä½ç½®è¢«åŒ…å«çš„æ¬¡æ•°ã€‚

ç¬¬ä¸€æ­¥æ˜¯ç»Ÿè®¡ä¸»åˆ—è¡¨ä¸­çš„å“ªäº›ä½ç½®åœ¨æ¯ä¸ªåšå®¢ä¸­ï¼Œå¹¶å¯¹ç»“æœæ•°æ®å¸§è¿›è¡Œæ’åº:

```
data_dir = 'data_csvs' 
data_files = [i for i in os.listdir(data_dir) if i.endswith('.csv')] for csv_file in data_files: 
    with open(os.path.join(data_dir, csv_file), 'r') as f: 
        locs_txt = f.read() 
    temp_locs = locs_txt.split('\n') 
    locs_bool = [loc_in_list(i, temp_locs) for i in list(loc_df['location'])] 
    loc_df = loc_df.assign(**{csv_file: locs_bool}) loc_df = loc_df.assign(counts=loc_df[data_files].sum(axis=1))
loc_df.sort_values(by='counts', inplace=True, ascending=False)
```

`loc_in_list`å‡½æ•°æ˜¯æˆ‘å†™çš„ç”¨æ¥æ¯”è¾ƒä½ç½®åç§°å’Œåˆ—è¡¨çš„ä¸œè¥¿ï¼Œè€ƒè™‘äº†åŒ…æ‹¬/çœç•¥å•è¯â€˜theâ€™å’Œå„ç§æ’‡å·/å¼•å·çš„å„ç§ç»„åˆã€‚

```
def loc_in_list(loc, loc_list): loc_list = list(set([i.strip().lower() for i in loc_list if len(i.strip().lower()) > 0])) 
loc_list += ['the ' + i for i in loc_list if i[:4] != 'the '] 
loc_list += [i[4:] for i in loc_list if i[:4] == 'the '] for t_char in ["'", "-"]: 
    loc_list += [i.replace(t_char, "") for i in loc_list if t_char in i] 
    loc_list += [i.replace(t_char, " ") for i in loc_list if t_char in i] loc = loc.replace("'", "'") 
loc = loc.strip().lower() loc_in_list_bool = (loc in loc_list) or (loc.replace("'", "") in loc_list) return loc_in_list_boolprint(loc_df.head())
```

å†æ¬¡æŸ¥çœ‹æ•°æ®å¸§ï¼Œçœ‹èµ·æ¥æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªæŒ‰å‡ºç°æ¬¡æ•°æ’åºçš„æ•°æ®å¸§ã€‚ã€Šæµ·æ¸¯å¤§æ¡¥ã€‹åœ¨æ¯ä¸ªæ¦œå•ä¸Šéƒ½å‡ºç°äº† 6 ä¸ªï¼

æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª`sizing`å‚æ•°(å’Œ`max_size`æ¥æ§åˆ¶ç¬¦å·å¤§å°)ï¼Œå¹¶å†æ¬¡ç»˜åˆ¶åœ°å›¾:

```
fig = px.scatter_mapbox( loc_df, lat="lat", lon="lon", color="type", size="counts", hover_name='location', hover_data=['type'], zoom=12, size_max=15) 
fig.update_layout(mapbox_style="light", mapbox_accesstoken=mapbox_key) 
fig.show()
```

![](img/9cd2d139a2183453d86572e62754571a.png)

# é‡å ä½ç½®

ä½ ä»¬å½“ä¸­çœ¼å°–çš„äººå¯èƒ½å·²ç»æ³¨æ„åˆ°äº†è¿™äº›é‡å çš„ä½ç½®ã€‚

![](img/ba0db6baa2f20ffbb3aad7a5cc740322.png)

å¯¹äºåƒè¿™æ ·çš„åœ°æ–¹ï¼Œæˆ‘å°†æŸ¥çœ‹é‡å çš„ä½ç½®ï¼ŒåªæŸ¥çœ‹è®¡æ•°è¾ƒé«˜çš„åç§°çš„ä½ç½®ã€‚

æˆ‘ç®€å•åœ°éå†æ¯ä¸€è¡Œï¼Œå¯»æ‰¾è·ç¦»å°äºé˜ˆå€¼çš„è¡Œ:

```
loc_df = loc_df.assign(dup_row=0) 
loc_thresh = 0.0001 for i in range(len(loc_df)): 
    src_ind = loc_df.iloc[i].name 
    for j in range(i+1, len(loc_df)): 
        tgt_ind = loc_df.iloc[j].name 
        lat_dist = loc_df.loc[src_ind]['lat'] - loc_df.loc[tgt_ind]['lat'] 
        lon_dist = loc_df.loc[src_ind]['lon'] - loc_df.loc[tgt_ind]['lon'] 
        tot_dist = (lat_dist ** 2 + lon_dist ** 2) ** 0.5 
        if tot_dist < loc_thresh: 
            print(f'Found duplicate item "{loc_df.loc[tgt_ind]["location"]}", index {tgt_ind}') 
            for csv_file in data_files: 
                if loc_df.loc[tgt_ind, csv_file]: 
                    loc_df.loc[src_ind, csv_file] = True 
                if loc_df.loc[tgt_ind, 'location'] not in loc_df.loc[src_ind, 'location']: 
                    loc_df.loc[src_ind, 'location'] = loc_df.loc[src_ind, 'location'] + ' | ' + loc_df.loc[tgt_ind, 'location'] 
                    loc_df.loc[tgt_ind, 'dup_row'] = 1 loc_df = loc_df[loc_df.dup_row == 0] 
loc_df = loc_df.assign(counts=loc_df[data_files].sum(axis=1))
loc_df.sort_values(by='counts', inplace=True, ascending=False)
```

ç°åœ¨å¯ä»¥ç»˜åˆ¶æ•°æ®äº†ï¼æˆ‘è¿˜å…³é—­äº†æ˜¾ç¤ºæ å’Œç¦ç”¨ç¼–è¾‘ï¼Œè¿™æ˜¯æˆ‘åœ¨æ‰€æœ‰ç»˜å›¾ä¸­ä½¿ç”¨çš„ã€‚

```
fig = px.scatter_mapbox(loc_df, lat="lat", lon="lon", color="type", size="counts", hover_name='location', hover_data=['type'], zoom=12, size_max=15) 
fig.update_layout(mapbox_style="light", mapbox_accesstoken=mapbox_key) 
fig.show( config={ 'displayModeBar': False, 'editable': False, }, )
```

![](img/bbdff6c79a261943d9d8b9044df75698.png)

çœ‹é‚£ä¸ªâ€”â€”æ¡¥ä¸Šçš„ç‚¹å·²ç»è¢«è¿æ¥èµ·æ¥ï¼Œåå­—å½¼æ­¤ç›¸åŠ ï¼Œè®¡æ•°å¢åŠ äº†ï¼

å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªäº¤äº’å¼çš„ï¼Œå¯æŒ‰ç±»åˆ«è¿‡æ»¤çš„å·¥å…·æç¤ºï¼

![](img/50374c214c603465e053fc3855674b7f.png)

è¿™å°±å®Œæˆäº†è¿™ç¯‡å…³äºåœ¨åœ°å›¾ä¸Šç»˜åˆ¶æ•£ç‚¹å›¾çš„æ–‡ç« ã€‚å¸Œæœ›ä½ å¯¹æ­¤æ„Ÿå…´è¶£ã€‚

å¦‚æœä½ å–œæ¬¢è¿™ä¸ªï¼Œæ¯”å¦‚è¯´ğŸ‘‹/åœ¨ [twitter](https://twitter.com/_jphwang) ä¸Šå…³æ³¨ï¼Œæˆ–å…³æ³¨æ›´æ–°ã€‚