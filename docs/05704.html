<html>
<head>
<title>Preparing data for time series analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为时间序列分析准备数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/preparing-data-for-time-series-analysis-cd6f080e6836?source=collection_archive---------22-----------------------#2020-05-12">https://towardsdatascience.com/preparing-data-for-time-series-analysis-cd6f080e6836?source=collection_archive---------22-----------------------#2020-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d819" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一些简单的技巧和窍门来获得分析就绪的数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/89772f69c405510e3522393298691905.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cvxZH6x1E0ga_0c4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@neonbrand?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NeONBRAND </a>拍摄的照片</p></figure><p id="0470" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个单独的时间序列(TS)数据都装载有信息；时间序列分析(TSA)就是解开所有这些的过程。然而，为了释放这种潜力，数据需要在通过分析管道之前进行适当的准备和格式化。</p><p id="aea6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">TS 可能看起来像一个简单的数据对象，很容易处理，但事实是，对于一个新人来说，在真正有趣的事情开始之前准备数据集可能是一项艰巨的任务。</p><p id="e7aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在本文中，我们将讨论一些简单的技巧和诀窍，以获得可供分析的数据，从而潜在地节省大量的生产时间。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4a87" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">查找数据</h1><p id="ed28" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果你用你自己的数据集做分析，你就有了。但是，刚刚学习 TSA 的人，找到正确的数据集可能会很麻烦。</p><p id="c14f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据来源其实不少。机器学习库附带的一些数据集——众所周知的玩具数据——已经存在很长时间了。这些“玩具”数据很好玩，尤其是对初学者来说。但这是一种瘾，每个人都需要尽快戒掉，投入到现实世界中去。</p><p id="cc91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一些在不同领域的一系列主题上查找数据的来源——一些是经过策划的，一些需要清理。你一定能从这个列表中找到你最喜欢的。</p><blockquote class="mz"><p id="8b86" class="na nb it bd nc nd ne nf ng nh ni lu dk translated">我建议你从整理过的数据集开始，这样你就不必揪着头发去解决数据问题，对真正有趣的东西失去兴趣。但是一旦你学会了基本原理，发现数据越乱越好，这将迫使你经历整个分析过程。</p></blockquote><p id="2160" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">好了，这里有一些玩具数据集——干净、有条理、可供分析——经常在机器学习教程中使用:</p><ul class=""><li id="2d0e" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">1949 年至 1960 年间每月报道的<a class="ae ky" href="https://www.kaggle.com/chirag19/air-passengers" rel="noopener ugc nofollow" target="_blank">航空旅客人数</a></li><li id="6875" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">美国某些州的客户每小时消耗的<a class="ae ky" href="https://www.kaggle.com/robikscube/hourly-energy-consumption" rel="noopener ugc nofollow" target="_blank">电能</a></li><li id="d2ef" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><a class="ae ky" href="https://www.kaggle.com/camnugent/sandp500" rel="noopener ugc nofollow" target="_blank">股票市场数据</a>不同公司的开盘价、最高价、最低价和收盘价以及交易量</li><li id="9ae5" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">一个关于<a class="ae ky" href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/shampoo.csv" rel="noopener ugc nofollow" target="_blank">洗发水销售的超小型数据集</a></li><li id="35d1" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><a class="ae ky" href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/daily-min-temperatures.csv" rel="noopener ugc nofollow" target="_blank">1981-1990 年间的日最低气温</a>数据(不知道代表哪个国家/城市，不过那不重要)</li><li id="8e25" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">每日记录的<a class="ae ky" href="https://www.kaggle.com/rohanrao/air-quality-data-in-india" rel="noopener ugc nofollow" target="_blank">空气质量数据</a>(一氧化碳、二氧化硫、臭氧等。)针对印度的不同城市</li></ul><p id="a7e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于真实世界的数据集，有一些非常棒的存储库。老实说，我认为您不需要超越这些存储库来学习高级 TS 分析和建模。</p><p id="1f96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1)美国<a class="ae ky" href="https://www.census.gov/econ/currentdata/dbsearch?program=RESSALES&amp;startYear=1963&amp;endYear=2020&amp;categories=ASOLD&amp;dataType=TOTAL&amp;geoLevel=US&amp;adjusted=1&amp;notAdjusted=0&amp;errorData=0" rel="noopener ugc nofollow" target="_blank">人口普查局</a>拥有大量美国商业活动的时间序列数据</p><p id="f9a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2 ) <a class="ae ky" href="https://fred.stlouisfed.org/tags/series" rel="noopener ugc nofollow" target="_blank">美联储经济数据(FRED) </a>是关于美国经济指标的一个很好的数据源</p><p id="d935" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3 ) <a class="ae ky" href="https://databank.worldbank.org/source/world-development-indicators" rel="noopener ugc nofollow" target="_blank">世界发展指标(WDI) </a>是一个由世界银行维护的关于世界各国社会、经济和环境问题的巨大资料库。</p><h1 id="78be" class="mc md it bd me mf oc mh mi mj od ml mm jz oe ka mo kc of kd mq kf og kg ms mt bi translated">数据准备</h1><blockquote class="mz"><p id="3790" class="na nb it bd nc nd ne nf ng nh ni lu dk translated">首先，人们总是倾向于像对待任何其他数据集一样对待时间序列。然后操之过急。但是 TS 观测和我们熟悉的横截面观测是不一样的。</p></blockquote><p id="c222" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">时间序列数据已经存在很长时间了，许多人致力于让其他人的生活更轻松(想到了 R 编程语言中的<a class="ae ky" href="https://robjhyndman.com/" rel="noopener ugc nofollow" target="_blank"> Rob Hyndman </a>和 Python 世界中的<a class="ae ky" href="https://machinelearningmastery.com/" rel="noopener ugc nofollow" target="_blank"> Jason Brownlee </a>)。</p><p id="c5a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有很多非常好的库是专门用来处理 TS 数据的。通过转换数据，您让库认识到它是一个特殊的 TS 对象。</p><p id="a401" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您已经完成了所需的预处理，例如重命名列、处理缺失值等。—以下是如何通过几个步骤准备数据。</p><p id="d8aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个练习中，我使用了一个在机器学习中被过度使用的玩具数据——<a class="ae ky" href="https://www.kaggle.com/chirag19/air-passengers" rel="noopener ugc nofollow" target="_blank">航空乘客数据集</a>——并用 Python 执行代码。</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="0c44" class="om md it oi b gy on oo l op oq"># import a couple of libraries<br/>import pandas as pd<br/>import numpy as np</span><span id="f504" class="om md it oi b gy or oo l op oq"># import data<br/>df = pd.read_csv("../DataFolder/file.csv")</span><span id="7835" class="om md it oi b gy or oo l op oq"># look at the head<br/>df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/d2eaf15f1acc264bf0762064fd9625b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:374/format:webp/1*p5R0IJ1P4siyaaMO5YJgiA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据集的前几行</p></figure><p id="8ce6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从前面几行我们可以看到，数据集有两列，第一列表示“yyyy — mm”格式的日期列，另一列表示实际观测值。</p><p id="f83f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记住，我们还不知道它是否是一个时间序列对象，我们只知道它是一个有两列的数据帧。</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="400d" class="om md it oi b gy on oo l op oq">df.info()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/dbb430dbb7beb46e14a37ce14e6b2fd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*F5xOCa9HLu3VLEi1Sopfvw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据帧信息</p></figure><p id="2774" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在其他信息中，这个摘要确认了它是一个有两列的<code class="fe ou ov ow oi b">pandas</code>数据帧。第一列是对象，第二列是整数。</p><p id="4d0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它不显示任何时间维度，这是因为月列存储为字符串。所以我们需要将其转换成日期时间格式。</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="d18d" class="om md it oi b gy on oo l op oq">df_air["Month"] = pd.to_datetime(df_air["Month"])</span></pre><p id="0e30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让它成为索引。这样做的好处是，您可以以任何方式过滤/切片数据:按年、月、日、工作日、周末、特定的日/月/年范围等等。</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="088f" class="om md it oi b gy on oo l op oq">df_air = df_air.set_index("Month")<br/>df_air.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/ea5ee6e6ae4c5d261ffb266bcef8217f.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*xamgJAMmzBeWRpC_nkdqYQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将月份更改为日期时间并设置为索引后的数据帧</p></figure><p id="9a4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一个好的实践是从日期时间索引中提取年、月和工作日，并将它们存储在单独的列中。如果需要的话，这为根据年/月等对数据进行“分组”提供了一些额外的灵活性。</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="5ec1" class="om md it oi b gy on oo l op oq">df_air['year'] = df_air.index.year<br/>df_air['month'] = df_air.index.month<br/>df_air['weekday'] = df_air.index.weekday_name</span></pre><p id="d162" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们的最终数据集。只需对比与原始数据的差异。此外，正如下面用黄色墨水突出显示的，它现在确认它不只是任何数据帧，而是一个时间序列对象。</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="5323" class="om md it oi b gy on oo l op oq">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/cd213c64049e3c41ea63b3d279b7f731.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*qkWlImlpaV8Apfi-5i-H6Q.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/abcfb4b9bf9942e9003e81e8e864b57e.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*1CUB7jwgwdzP3VzG-wVbbg.png"/></div></figure><p id="7a9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总之，我们做了一些事情来将我们的数据转换成时间序列对象:</p><p id="431f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1)将月份列从字符串转换为日期时间；</p><p id="bd94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2)将转换后的日期时间列设置为索引；</p><p id="3761" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3)从索引中提取年、月和工作日，并存储在新列中</p><h1 id="aec4" class="mc md it bd me mf oc mh mi mj od ml mm jz oe ka mo kc of kd mq kf og kg ms mt bi translated">现在怎么办？</h1><p id="28f0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在您已经有了可供分析的数据，下一步是什么？你现在可以用它进行所有你想要的有趣的分析了，我会在以后的文章中介绍。与此同时，如果你想阅读一些先进的运输安全管理局分析，我写了几篇，看看下面。</p><ul class=""><li id="e389" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/time-series-data-mining-techniques-and-applications-5159b8ad26ec">时间序列数据挖掘技术及应用</a></li><li id="a192" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/six-essential-plots-for-time-series-data-analysis-477bd7e778ac">时间序列数据分析中的六个关键点</a></li><li id="58a7" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/multivariate-time-series-forecasting-653372b3db36">多元时间序列预测</a></li></ul><p id="7982" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝你 TSA 之旅好运！</p><p id="5376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="pa">联系提问或者只是关注:</em> <a class="ae ky" href="https://twitter.com/DataEnthus" rel="noopener ugc nofollow" target="_blank"> <em class="pa">推特</em> </a> <em class="pa">。</em></p></div></div>    
</body>
</html>