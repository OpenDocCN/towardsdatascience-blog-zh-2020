<html>
<head>
<title>Pandas tips I wish I knew before</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫小贴士我希望我以前就知道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandas-tips-i-wish-i-knew-before-ef4ea6a39e1a?source=collection_archive---------8-----------------------#2020-04-01">https://towardsdatascience.com/pandas-tips-i-wish-i-knew-before-ef4ea6a39e1a?source=collection_archive---------8-----------------------#2020-04-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0fac" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">pivot 是如何工作的？熊猫的主要构件是什么？还有更多…</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9d85867082c21f878b734611c8f1c75c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_gu2ctyUqKGYe2Q6KbgDJA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">伊洛娜·弗罗利希在<a class="ae ky" href="https://unsplash.com/s/photos/panda-talk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="087a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我成为熊猫超级用户已经有几年了。有时候我认为我已经掌握了它，但是几个月后我发现我像个菜鸟一样编程。我们都经历过😊我在这里与你分享的技巧是我最近学到的。</p><p id="4ffc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要运行示例，请下载这个<a class="ae ky" href="https://romanorac.github.io/assets/notebooks/2020-04-01-pandas-tips-i-wish-i-knew.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>。</p><p id="4c32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">这里有几个你可能会感兴趣的链接:</strong></p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a134" class="ma mb it lw b gy mc md l me mf">- <a class="ae ky" href="https://trymito.io/" rel="noopener ugc nofollow" target="_blank">Complete your Python analyses 10x faster with Mito</a> [Product]</span><span id="cf78" class="ma mb it lw b gy mg md l me mf">- <a class="ae ky" href="https://aigents.co/skills" rel="noopener ugc nofollow" target="_blank">Free skill tests for Data Scientists &amp; ML Engineers</a> [Test]</span><span id="1e41" class="ma mb it lw b gy mg md l me mf">- <a class="ae ky" href="https://imp.i115008.net/c/2402645/1116216/11298" rel="noopener ugc nofollow" target="_blank">All New Self-Driving Car Engineer Nanodegree</a><strong class="lw iu"> </strong>[Course]</span></pre><p id="3897" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你愿意阅读更多这样的文章吗？如果是这样，你可以点击上面的任何链接来支持我。其中一些是附属链接，但你不需要购买任何东西。</p><h1 id="9da3" class="mi mb it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">让我们从一个爆炸性的提示开始💥</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/ffa46e4ebb7ed99f71dbab6c7c80ce50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*DO29mLJL7zxGEqxZ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从<a class="ae ky" href="https://giphy.com/gifs/reactionseditor-l0IxYWDltdHEqujnO" rel="noopener ugc nofollow" target="_blank"> giphy </a>下载的 Gif</p></figure><p id="5dc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">熊猫有爆炸的功能。别担心，使用它是完全安全的😊当 DataFrame 列中存储有列表时，该函数非常有用。它解包列表中的值，并复制所有其他值，因此会爆炸💥</p><p id="83be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个 DataFrame，它的一列在列表中有随机数量的元素。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="725b" class="ma mb it lw b gy mc md l me mf">n = 10<br/>df = pd.DataFrame(<br/>    {<br/>        "list_col": [[random.randint(0, 10) for _ in range(random.randint(3, 5))] for _ in range(10)],<br/>    }<br/>)<br/>df.shape</span><span id="69b2" class="ma mb it lw b gy mg md l me mf">(10, 1) # output</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/5234a8ea375f763593188cf3910806c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEMBWQvWDDVqdbkc-RM4cg.png"/></div></div></figure><p id="b64e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们执行 explode 函数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6934" class="ma mb it lw b gy mc md l me mf">df = df.explode("list_col")<br/>df.shape</span><span id="36ab" class="ma mb it lw b gy mg md l me mf">(40, 1) #output</span></pre><p id="5437" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下表中，我们可以观察到由于从列表中解包值，索引被重复。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/1f7be639e0b3c225644092d03f891122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ip3pWpcpOh06VD069Ivp5Q.png"/></div></div></figure><h1 id="71c5" class="mi mb it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">数据帧不是熊猫的主要构件</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/e977cc9bb3066c28ab5298961068e81b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/0*wZRzCyDXACxr_egM.jpg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">迷因创造了<a class="ae ky" href="https://imgflip.com/memegenerator" rel="noopener ugc nofollow" target="_blank">imgflip.com</a></p></figure><p id="1e86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas 几乎是 DataFrames 的同义词，但如果我告诉你它不是它的主要构建块，你可能会感到惊讶。熊猫数据框架是建立在熊猫系列之上的。所以数据帧中的每一列都是一个系列。我们可以更深入，熊猫系列是基于什么？Numpy！但是我们不要走那么远。</p><p id="7122" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当收益超过在项目中安装 pandas 的成本时，我甚至将 Python 的 list 包含在 pandas 系列中——我这里指的是后端，而不是分析项目。</p><p id="372f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用窗口 2 计算一个列表中值的滚动和。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="851f" class="ma mb it lw b gy mc md l me mf">values = [1, 2, 0, 0, 0, 0, 1, 2, 3]<br/>sr = pd.Series(values)<br/>sr.rolling(2).sum()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/01463e6da630963f7b6bf055288c32f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*arSqzFkRtMTGxmD-gMCQ2g.png"/></div></div></figure><p id="3def" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样代码就更简洁了。</p><h1 id="4d20" class="mi mb it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">Pivot —数据科学家的必备工具</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/85bb757b7b1350089ed877a1384d09a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*Nz2Tu5anxxGnx84G.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从<a class="ae ky" href="https://giphy.com/gifs/Friends-season-5-episode-113-the-one-with-cop-UrbnbuU24p1zgyDMUH" rel="noopener ugc nofollow" target="_blank"> giphy </a>下载的 Gif</p></figure><p id="3c78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">什么是支点？数据透视表是一个统计表，它汇总了一个更广泛的表中的数据。听起来很有用！让我们试一试。</p><p id="ac3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们有一家水果店和几个顾客。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7d7f" class="ma mb it lw b gy mc md l me mf">df = pd.DataFrame(<br/>    {<br/>        "fruit": ["apple", "orange", "apple", "avocado", "orange"],<br/>        "customer": ["ben", "alice", "ben", "josh", "steve"],<br/>        "quantity": [1, 2, 3, 1, 2],<br/>    }<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/6ea5ba372066e89e74dc82ceddc1ae2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dZP01PAb94mx9q_ZySAmHw.png"/></div></div></figure><p id="9659" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们用 fruit 和 customer 列以及聚合数量值来透视表。我们期待一张桌子，水果在一个轴上，顾客在另一个轴上。应合计数量值</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="089e" class="ma mb it lw b gy mc md l me mf">df.pivot(index="fruit", columns="customer", values="quantity")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/9d6327384429483adaf4f055fd07a617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3fSPQn6nQpnEDVUGuFhP4Q.png"/></div></div></figure><p id="f324" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们得到一个“值错误:索引包含重复条目，无法整形”。这是什么意思？</p><p id="14bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用一个不同的命令(但是更容易解释)来尝试 pivot，它与 pivot 函数具有相同的效果。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="dbbf" class="ma mb it lw b gy mc md l me mf">df.set_index(["fruit", "customer"])["quantity"].unstack()</span></pre><p id="132f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令返回与 pivot 函数相同的错误，但是更清楚幕后发生了什么。水果列和客户列组合在一起时似乎没有唯一的索引。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/e446be87964fd241e00637aa3365f7f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NVuWilvrPlB90tCQMIsSyg.png"/></div></div></figure><p id="eefe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们尝试使用 pivot_table 函数，这也是推荐的方法。注意，该函数还支持 aggfunc，默认情况下是 np.mean。我们在下面的例子中使用 np.sum。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="634d" class="ma mb it lw b gy mc md l me mf">df.pivot_table(index="fruit", columns="customer", values="quantity", aggfunc=np.sum)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/a77da3ed230a1dce4fd100cd201728da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*relhzNR8q3baCXi_220yWQ.png"/></div></div></figure><h1 id="bff9" class="mi mb it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">很少值得一提</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/da023c8128277f7f7c93330d4013d463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*lFXGYXROUKf9HEjK.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从<a class="ae ky" href="https://giphy.com/gifs/waynes-world-wayne-campbell-MUeQeEQaDCjE4" rel="noopener ugc nofollow" target="_blank"> giphy </a>下载的 Gif</p></figure><h2 id="5be9" class="ma mb it bd mj nj nk dn mn nl nm dp mr li nn no mt lm np nq mv lq nr ns mx nt bi translated">访问元素</h2><p id="6ce6" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">访问数据帧中的第一个元素(和最后一个元素)非常简单:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3431" class="ma mb it lw b gy mc md l me mf">df = pd.DataFrame({"col": [1, 2, 3, 4, 5]})</span><span id="620e" class="ma mb it lw b gy mg md l me mf">df.iloc[0]</span><span id="7d77" class="ma mb it lw b gy mg md l me mf">df.iloc[-1] # the last element</span></pre><p id="4305" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能会问 loc 和 iloc 有什么区别？当通过索引访问行时，我们使用 loc，其中索引可以是字符串、整数或其他类型。</p><p id="6466" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还使用 loc 在某个索引上设置一个新的列值(我们不能用 iloc 这样做—它会返回 ValueError):</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="cec4" class="ma mb it lw b gy mc md l me mf">df.loc[0, "col"] = 1</span></pre><h2 id="6016" class="ma mb it bd mj nj nk dn mn nl nm dp mr li nn no mt lm np nq mv lq nr ns mx nt bi translated">追加值</h2><p id="7ad0" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">Pandas 有一个 append 函数，使您能够将值追加到数据帧中。但是技巧是附加的值也需要在数据帧中。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6f76" class="ma mb it lw b gy mc md l me mf">df = df.append(pd.DataFrame({'col': [999]}))<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/1213d3d97a3400188153460c1bb8fff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1hSwWw-TWsYWoy4aZOSkZw.png"/></div></div></figure><h2 id="8dbc" class="ma mb it bd mj nj nk dn mn nl nm dp mr li nn no mt lm np nq mv lq nr ns mx nt bi translated">行到列</h2><p id="6c9b" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我最喜欢的将行变成列的方法是使用转置。它在 numpy 中也有效。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8730" class="ma mb it lw b gy mc md l me mf">df.T</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/46294bc77605beb2222203d94a2e466d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3OgH472UOxxuIWKSeyjbRA.png"/></div></div></figure><h1 id="b7ef" class="mi mb it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">在你走之前</h1><p id="dea3" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">在<a class="ae ky" href="https://twitter.com/romanorac" rel="noopener ugc nofollow" target="_blank">推特</a>上关注我，在那里我定期<a class="ae ky" href="https://twitter.com/romanorac/status/1328952374447267843" rel="noopener ugc nofollow" target="_blank">发关于数据科学和机器学习的推特</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/b5d426b68cc5a21b1a35d0a157ebc4f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*69rP1pwjJi9mLSFE"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@cmhedger?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Courtney hedge</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div></div>    
</body>
</html>