<html>
<head>
<title>Getting Started with Databricks — Analyzing COVID-19</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Databricks 入门—分析新冠肺炎</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-started-with-databricks-analyzing-covid-19-1194d833e90f?source=collection_archive---------30-----------------------#2020-09-17">https://towardsdatascience.com/getting-started-with-databricks-analyzing-covid-19-1194d833e90f?source=collection_archive---------30-----------------------#2020-09-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/cd2c2df8dd77ea3948fb8cab99a2ab3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jwnNke-BaN5MZ4-4Uuvu4A.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">马丁·桑切斯在<a class="ae jd" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="384d" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">深入了解 Databricks 平台</h2></div><p id="fdc5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh"> <em class="lr">来自《走向数据科学》编辑的提示:</em> </strong> <em class="lr">虽然我们允许独立作者根据我们的</em> <a class="ae jd" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="lr">规则和指导方针</em> </a> <em class="lr">发表文章，但我们并不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae jd" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="lr">读者术语</em> </a> <em class="lr">。</em></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="0234" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">典型的数据科学工作流由以下步骤组成:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="3093" class="mi mj jg me b gy mk ml l mm mn">Identify Business Needs -&gt; Data Ingestion -&gt; Data preparation -&gt; Data analysis -&gt; Sharing data insights</span></pre><p id="1fe0" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些步骤中的每一步都需要一组专业知识，这些专业知识可以分为:</p><p id="ed86" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">数据工程师:开发、建造、测试和维护数据管道</p><p id="1669" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">数据科学家</strong>:使用多种方法提取洞察(机器学习模型)</p><p id="c221" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">数据分析师:获取数据工程师准备的数据，以图形、图表和仪表板的形式从中提取见解(商业智能)</p><p id="5294" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">平台管理员</strong>:负责管理和支持数据基础设施(DevOps)</p><p id="d78e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Databricks 是一个统一的平台，为这些工作提供了必要的工具。在本文中，我们将通过创建数据管道和指定每个团队成员的职责来分析巴西的新冠肺炎数据。</p><h1 id="6790" class="mo mj jg bd mp mq mr ms mt mu mv mw mx km my kn mz kp na kq nb ks nc kt nd ne bi translated">准备</h1><p id="a1be" class="pw-post-body-paragraph kv kw jg kx b ky nf kh la lb ng kk ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">要完成接下来的步骤，您需要访问 Databricks 帐户。最简单的方法就是在 https://community.cloud.databricks.com<a class="ae jd" href="https://community.cloud.databricks.com/" rel="noopener ugc nofollow" target="_blank"/>创建一个 Databricks 社区账户</p><h1 id="0da8" class="mo mj jg bd mp mq mr ms mt mu mv mw mx km my kn mz kp na kq nb ks nc kt nd ne bi translated">集群创建(平台管理员)</h1><p id="1033" class="pw-post-body-paragraph kv kw jg kx b ky nf kh la lb ng kk ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">第一步是配置集群。Databricks 是一个基于 Spark 的平台，是最流行的大数据分析框架之一。Spark 本质上是一个分布式系统，这就是为什么集群创建过程包括为驱动程序和工作节点选择虚拟机。基本上，驱动程序是集群的指挥者，工作节点负责繁重的工作。</p><p id="0fa4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">平台管理员负责根据用例、spark 版本、工作节点数量和自动扩展配置选择合适的虚拟机系列。例如，ETL 过程可能需要内存优化的设备，繁重的机器学习训练过程可能在 GPU 上运行。</p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/37ba138f9eecb810648fe1ccbcbf6367.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*TkK5Br8Tt4DjoMYoo9guJg.gif"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">集群创建过程</p></figure><p id="bee1" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">转到<code class="fe nl nm nn me b">Clusters</code>页面，使用 6.6 ML 运行时创建一个新集群。如果您使用 Azure Databricks 或 AWS，您将需要选择驱动程序和工作节点的 VM 系列。对于这个教程，你可以选择最便宜的。</p><h1 id="ef34" class="mo mj jg bd mp mq mr ms mt mu mv mw mx km my kn mz kp na kq nb ks nc kt nd ne bi translated">数据接收(数据工程师)</h1><p id="05ca" class="pw-post-body-paragraph kv kw jg kx b ky nf kh la lb ng kk ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">数据摄取可能是一个具有挑战性的领域。通常，公司将数据存储在多个数据库中，现在使用数据流非常普遍。幸运的是，Databricks 与 Spark 和 Delta Lake 一起，可以帮助我们用一个简单的接口进行批处理或流式 ETL(提取、转换和加载)。</p><p id="63af" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本教程中，我们将从最简单的 ETL 开始，从 CSV 文件加载数据。</p><p id="b09d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们需要下载数据集。请访问以下 URL:</p><p id="9c88" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae jd" href="https://github.com/relferreira/databricks-tutorial/tree/master/covid" rel="noopener ugc nofollow" target="_blank">https://github . com/relferreira/databricks-tutorial/tree/master/covid</a></p><p id="2357" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">并下载文件<code class="fe nl nm nn me b">caso.csv.gz</code></p><p id="a4ac" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">解压文件，进入数据菜单，点击<code class="fe nl nm nn me b">Add Data</code>按钮。接下来，上传之前下载的 CSV 文件。</p><p id="27ca" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上传完成后，我们将使用数据集中显示的信息创建一个新表。单击<code class="fe nl nm nn me b">Create Table UI</code>，将表格重命名为<code class="fe nl nm nn me b">covid</code>，将第一行设置为标题，最后，单击 create 按钮。</p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/08a4c6270676284ff21ac80bd9b9b88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YdLifXnLe-CY2oz6g9OCcw.gif"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表创建过程</p></figure><h1 id="2f27" class="mo mj jg bd mp mq mr ms mt mu mv mw mx km my kn mz kp na kq nb ks nc kt nd ne bi translated">数据分析(数据分析师)</h1><p id="81a2" class="pw-post-body-paragraph kv kw jg kx b ky nf kh la lb ng kk ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">创建好表后，我们可以开始分析数据集了。首先，我们需要创建一个新的 python 笔记本。去</p><p id="903b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nl nm nn me b">Worspace &gt; Users &gt; YOUR EMAIL</code></p><p id="2507" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击箭头，创建一个新的笔记本</p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/98f4972101dda389c180c540336d58bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FDb8aKCUk3rFI_SUJrZ3jA.gif"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">笔记本创建流程</p></figure><p id="606f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虽然是一个 python 笔记本，但 Databricks 支持笔记本中的多种语言。在我们的例子中，我们将主要使用<strong class="kx jh"> SparkSQL </strong>。如果你熟悉 SQL，SparkSQL 会给你家的感觉。</p><p id="4ac0" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们先来看看我们的新表格:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="cfab" class="mi mj jg me b gy mk ml l mm mn">%sql<br/>SELECT * FROM covid</span></pre><p id="bb13" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您应该会看到这样一个表格:</p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi no"><img src="../Images/d64d0b332f48cb15b1efff0af93904a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZBLG7OuVzxwR4Vzu0hJYhw.png"/></div></div></figure><p id="1fb1" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">作为数据分析师，您应该能够从数据中提取有价值的信息。首先，我们需要理解表格中每一列的含义。一种方法是使用<code class="fe nl nm nn me b">DESCRIBE</code>功能:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="644d" class="mi mj jg me b gy mk ml l mm mn">%sql<br/>DESCRIBE covid</span></pre><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/2f2a6d925078ea8e019f642c9bcca26c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SXrvPzKnOem2EMOvFSVMZw.png"/></div></div></figure><p id="e537" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">分析这两个表，我们可以推断出，当列<code class="fe nl nm nn me b">place_type</code>等于<code class="fe nl nm nn me b">state</code>时，每一行代表该状态的总数。让我们试着画出人口最多的三个州的死亡人数的变化图:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="3936" class="mi mj jg me b gy mk ml l mm mn">%sql<br/>SELECT date, state, deaths FROM covid WHERE state in (“MG”, “RJ”, “SP”) and place_type = “state”</span></pre><p id="fa99" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击<code class="fe nl nm nn me b">Bar Chart</code>按钮<code class="fe nl nm nn me b">Plot Options</code>，用以下配置配置一个<code class="fe nl nm nn me b">Line chart</code>:</p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nq"><img src="../Images/5806ccd42647ea91aaef4665c6cacd2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dbhUJytPPdFGnqUeXkXU1w.png"/></div></div></figure><p id="e341" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们有了疫情时期死亡人数演变的一个很好的代表。例如，我们可以将这个图表嵌入到仪表板中，以提醒这些州的人口。</p><h1 id="bbc1" class="mo mj jg bd mp mq mr ms mt mu mv mw mx km my kn mz kp na kq nb ks nc kt nd ne bi translated">数据科学(数据科学家)</h1><p id="90d6" class="pw-post-body-paragraph kv kw jg kx b ky nf kh la lb ng kk ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">接下来，我们将尝试预测之前绘制的时间序列的未来值。为此，我们将使用一个名为<a class="ae jd" href="https://facebook.github.io/prophet/" rel="noopener ugc nofollow" target="_blank"> Prophet </a>的脸书库</p><p id="5e8a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们需要安装一些依赖项。去…</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="05e7" class="mi mj jg me b gy mk ml l mm mn">Clusters &gt; COVID &gt; Libraries</span></pre><p id="2105" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">并使用<code class="fe nl nm nn me b">PyPI</code>安装以下依赖项</p><ul class=""><li id="a918" class="nr ns jg kx b ky kz lb lc le nt li nu lm nv lq nw nx ny nz bi translated">熊猫</li><li id="42df" class="nr ns jg kx b ky oa lb ob le oc li od lm oe lq nw nx ny nz bi translated">pystan</li><li id="9148" class="nr ns jg kx b ky oa lb ob le oc li od lm oe lq nw nx ny nz bi translated">FB 先知</li></ul><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi of"><img src="../Images/59d04b7685e58e82a8792f53ca9fa28d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_o3vesdozPt3zQlCwPNPqA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">库安装过程</p></figure><p id="200e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将尝试预测米纳斯吉拉斯州(MG)未来的死亡人数。所以第一步是收集我们的数据。</p><p id="1787" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">*也许您需要清除笔记本的状态</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="cf92" class="mi mj jg me b gy mk ml l mm mn">import pandas as pd<br/>import logging</span><span id="16d6" class="mi mj jg me b gy og ml l mm mn">logger = spark._jvm.org.apache.log4j<br/>logging.getLogger("py4j").setLevel(logging.ERROR)</span><span id="b3fe" class="mi mj jg me b gy og ml l mm mn">query = """<br/> SELECT string(date) as ds, int(deaths) as y FROM covid WHERE state = "MG" and place_type = "state" order by date<br/>"""</span><span id="46c4" class="mi mj jg me b gy og ml l mm mn">df = spark.sql(query)<br/>df = df.toPandas()<br/>display(df)</span></pre><p id="0c90" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们将使用<code class="fe nl nm nn me b">Prophet</code>来拟合模型，并最终绘制“未来”</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="6b89" class="mi mj jg me b gy mk ml l mm mn">from fbprophet import Prophet</span><span id="60d8" class="mi mj jg me b gy og ml l mm mn">m = Prophet()<br/>m.fit(df)</span><span id="557d" class="mi mj jg me b gy og ml l mm mn">future = m.make_future_dataframe(periods=30)</span><span id="027c" class="mi mj jg me b gy og ml l mm mn">forecast = m.predict(future)</span><span id="bd95" class="mi mj jg me b gy og ml l mm mn">fig1 = m.plot(forecast)</span></pre><p id="93c4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您应该会看到以下带有预测的图表:</p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oh"><img src="../Images/b0f6ac7966954edcadb3ec9392df3da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_lyrh8rvpUpLgDmjwI1M9w.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">米纳斯吉拉斯州的时间序列预测</p></figure><h1 id="d209" class="mo mj jg bd mp mq mr ms mt mu mv mw mx km my kn mz kp na kq nb ks nc kt nd ne bi translated">结论</h1><p id="b98d" class="pw-post-body-paragraph kv kw jg kx b ky nf kh la lb ng kk ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">我们的目标是展示数据科学工作流程的所有步骤。这就是为什么我们没有描述时间序列模型是如何工作的。如果您遵循本教程，您应该对 Databricks 平台有了很好的了解。</p><p id="2855" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">完整的笔记本可以在这个公共存储库中获得</p><div class="ip iq gp gr ir oi"><a href="https://github.com/relferreira/databricks-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd jh gy z fp on fr fs oo fu fw jf bi translated">relferreira/data bricks-教程</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">github.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ix oi"/></div></div></a></div><p id="97e0" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您有任何疑问，可以通过以下方式找到我:</p><p id="5eae" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae jd" href="https://twitter.com/relferreira" rel="noopener ugc nofollow" target="_blank">https://twitter.com/relferreira</a></p><p id="30e7" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">#住宿之家#住宿安全</p></div></div>    
</body>
</html>