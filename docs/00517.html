<html>
<head>
<title>Getting started with Pandas time-series functionality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫时序功能入门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-started-with-pandas-time-series-functionality-c10b6ee733a4?source=collection_archive---------22-----------------------#2020-01-15">https://towardsdatascience.com/getting-started-with-pandas-time-series-functionality-c10b6ee733a4?source=collection_archive---------22-----------------------#2020-01-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/639b20bd3107fbc27992410f5ec73444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-9ZGmQJsYJMqqOTQLfbL0Q.png"/></div></div></figure><div class=""/><div class=""><h2 id="b609" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">提高数据分析速度的3种技巧</h2></div><p id="a014" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">Pandas具有分析时间序列数据的特殊功能，包括自动日期解析、高级过滤功能和几个特定于日期的绘图功能。</p><p id="5804" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我发现自己几乎每天都在使用这些功能，但我花了很长时间才发现它们:Pandas datetime的许多功能并不明显，而且我在开始时并没有使用这些功能。</p><p id="2b87" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">但是使用这些功能很容易，而且无论何时处理时间序列数据，都有助于提高分析速度。</p><p id="3df7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为了帮助你开始，这里有3个我最常用的时间序列特征。</p><h2 id="9190" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">1.自动解析时间序列数据</h2><p id="f6e2" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">Pandas可以自动将数据集中的列解析成时间序列数据，而不需要您指定任何正则表达式模式。</p><p id="ecb0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">假设您正在分析一个数据集，其中前五行如下所示。</p><figure class="mn mo mp mq gt iv"><div class="bz fp l di"><div class="mr ms l"/></div><p class="mt mu gj gh gi mv mw bd b be z dk translated">带有日期时间字段的示例表</p></figure><p id="5a8c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">您可以看到列<code class="fe mx my mz na b">date</code>看起来像一个时间序列，我们将该列中的值转换为Pandas datetime类型是有意义的。</p><p id="342f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">要指示Pandas转换这些值，在加载数据时使用<code class="fe mx my mz na b">parse_dates</code>参数。</p><blockquote class="nb nc nd"><p id="1796" class="kt ku ne kv b kw kx kf ky kz la ki lb nf ld le lf ng lh li lj nh ll lm ln lo im bi translated">注意:<code class="fe mx my mz na b">parse_dates</code>参数在所有熊猫数据加载函数中都可用，包括<code class="fe mx my mz na b">read_csv</code>。</p></blockquote><pre class="mn mo mp mq gt ni na nj nk aw nl bi"><span id="492b" class="lp lq je na b gy nm nn l no np">&gt;&gt;&gt; import pandas as pd<br/>&gt;&gt;&gt; df = pd.read_csv('<a class="ae nq" href="http://bit.ly/30iosS6" rel="noopener ugc nofollow" target="_blank">http://bit.ly/30iosS6</a>', parse_dates=['date'])<br/>&gt;&gt;&gt; df.info()<br/>&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>RangeIndex: 360 entries, 0 to 359<br/>Data columns (total 2 columns):<br/> #   Column  Non-Null Count  Dtype<br/>---  ------  --------------  -----<br/> 0   dau     360 non-null    int64<br/> 1   date    360 non-null    datetime64[ns]<br/>dtypes: datetime64[ns](1), int64(1)<br/>memory usage: 5.8 KB</span></pre><p id="4178" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">注意列<code class="fe mx my mz na b">date</code>的<code class="fe mx my mz na b">Dtype</code>是如何变为<code class="fe mx my mz na b">datetime64[ns]</code>的。您现在可以在<code class="fe mx my mz na b">date</code>列上使用Pandas的所有特殊datetime方法。</p><pre class="mn mo mp mq gt ni na nj nk aw nl bi"><span id="0f80" class="lp lq je na b gy nm nn l no np">&gt;&gt;&gt; df.date.dt.day_name()<br/>0      Tuesday<br/>1    Wednesday<br/>2     Thursday<br/>3       Friday<br/>4     Saturday<br/>...</span></pre><h2 id="bd65" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">2.过滤时间戳索引</h2><p id="9269" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">当数据帧的索引是一个<code class="fe mx my mz na b">datetime</code>类型时，Pandas提供了方便的过滤方法。</p><pre class="mn mo mp mq gt ni na nj nk aw nl bi"><span id="8486" class="lp lq je na b gy nm nn l no np">&gt;&gt;&gt; df.set_index('date', inplace=True)<br/>&gt;&gt;&gt; df.index<br/>DatetimeIndex(['2019-01-01', ... ,'2019-12-26'])</span></pre><p id="aabc" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">例如，您可以通过向DataFrame的<code class="fe mx my mz na b">loc</code>访问器传递一个字符串来选择一个特定的日期。</p><pre class="mn mo mp mq gt ni na nj nk aw nl bi"><span id="9fdf" class="lp lq je na b gy nm nn l no np">&gt;&gt;&gt; df.loc['2019-02-01']<br/>dau    554<br/>Name: 2019-02-01 00:00:00, dtype: int64</span></pre><p id="2f89" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">你也可以使用字符串来选择数据范围，即分割数据帧。</p><pre class="mn mo mp mq gt ni na nj nk aw nl bi"><span id="2ef3" class="lp lq je na b gy nm nn l no np">&gt;&gt;&gt; df.loc['2019-02-01':'2019-03-01']<br/>            dau<br/>date<br/>2019-02-01  554<br/>2019-02-02  798<br/>...<br/>2019-02-28  569<br/>2019-03-01  599</span></pre><p id="c297" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">注意，索引是最后一个值的<em class="ne">和</em>。我们使用<code class="fe mx my mz na b">2019-03-01</code>作为我们选择的范围的结尾，所以标签为<code class="fe mx my mz na b">2019–03–01</code>的行包含在结果数据帧中。</p><p id="8620" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">您甚至可以传入部分字符串来选择特定范围的数据。</p><pre class="mn mo mp mq gt ni na nj nk aw nl bi"><span id="a713" class="lp lq je na b gy nm nn l no np">&gt;&gt;&gt; df.loc['2019-03']<br/>            dau<br/>date<br/>2019-03-01  599<br/>2019-03-02  724<br/>...<br/>2019-03-30  724<br/>2019-03-31  638</span></pre><h2 id="9aae" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">3.快速绘制时间序列数据</h2><p id="6767" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">最后但同样重要的是，您可以使用Pandas <code class="fe mx my mz na b">plot</code>函数轻松绘制时间序列数据。</p><pre class="mn mo mp mq gt ni na nj nk aw nl bi"><span id="e1d1" class="lp lq je na b gy nm nn l no np">&gt;&gt;&gt; df.plot()</span></pre><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/59953736d90eb0bb9b1ad9c3be8788bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*OSUySkTFj8vLGCGSB78yeQ.png"/></div><p class="mt mu gj gh gi mv mw bd b be z dk translated">自动生成的日期时间图</p></figure><p id="ac80" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">注意Pandas是如何使用X轴的数据帧索引的。</p><p id="2d9b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">当然，这个图表不是很有帮助。让我们使用一个聚合视图来产生更具可读性的东西。</p><p id="e1d8" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为此，我们可以使用DataFrame的<code class="fe mx my mz na b">resample</code>方法按月聚合timeseries索引。然后，我们将计算每个月的<code class="fe mx my mz na b">mean</code>,并创建结果的条形图。</p><pre class="mn mo mp mq gt ni na nj nk aw nl bi"><span id="e350" class="lp lq je na b gy nm nn l no np">&gt;&gt;&gt; df.resample('M').mean().plot.bar()</span></pre><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/664ca3cdcf1fa589c2eea6975e3f48bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*5XUEgAnfQ0NVJRU9GVChVw.png"/></div><p class="mt mu gj gh gi mv mw bd b be z dk translated">时序索引的汇总视图</p></figure><p id="bf36" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">关于如何在Pandas中快速生成图表的更多细节，你可以阅读我的文章“<a class="ae nq" rel="noopener" target="_blank" href="/the-best-pandas-plotting-features-c9789e04a5a0">用Pandas </a>快速绘图”。</p><div class="is it gp gr iu ns"><a rel="noopener follow" target="_blank" href="/the-best-pandas-plotting-features-c9789e04a5a0"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jf gy z fp nx fr fs ny fu fw jd bi translated">用熊猫快速绘图</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">使用这些简单的内置函数快速可视化您的数据</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og ja ns"/></div></div></a></div></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><p id="8c78" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">感谢阅读！我经常在Medium上写关于数据科学和编程技巧的文章，所以请关注我以获得更多类似本文的文章。</p></div></div>    
</body>
</html>