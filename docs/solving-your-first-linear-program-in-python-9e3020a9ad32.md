# 用 Python 求解你的第一个线性程序

> 原文：<https://towardsdatascience.com/solving-your-first-linear-program-in-python-9e3020a9ad32?source=collection_archive---------7----------------------->

## Python 中线性编程的“为什么”、“什么”和“如何”。

![](img/deaa3bbe50346e675beeb0308bdd47f9.png)

想出一个我不记得的蛋糕配方。作者照片。

您可能在数据科学或研究的某个时候遇到过术语“线性编程”。我将尝试解释它是什么，以及如何用 Python 实现一个线性程序。

## 为什么我们需要一个线性程序？

线性程序为变量服从许多线性关系的问题找到最优解。此外，该问题可能需要最大化或最小化某个条件，例如最小化产品成本，或最大化利润。

一个经常讨论的线性规划的例子是旅行推销员。从他的家乡出发，一个销售人员需要走遍一个地区的所有城市，但是为了最小化旅行成本，他必须选择最短的路径，穿过每个城市，到达他的家乡。一般来说，最好的可能路径是每个城市只穿过一次，从而类似于一个闭环(起点和终点都在家乡)。

就我个人而言，我已经在许多应用中应用了线性程序。

*   **运输行业:**路线优化，需要访问不同的站点，同时将运营成本降至最低。
*   **能源行业:**在预测负荷模式的同时，优化安装太阳能电池板的家庭的用电量。
*   **逻辑问题:**使用线性程序解决逻辑问题/难题，其中所有的逻辑约束必须“并行”满足(下一篇文章的主题)。

## 什么是线性规划？

**吧谈:** 想高中数学，线性方程组和解线性方程组。基本上，这就是我们的想法，但除此之外，还有一个需要最小化或最大化的额外条件。

**技术对话:****线性程序优化一个*目标函数*(或成本函数)，其中需要满足一组线性等式(和不等式)。**

**我将用一个真实的例子来说明这一切意味着什么。**

## **工作示例**

**我需要用四种原料烤一个蛋糕:面粉、鸡蛋、黄油和糖。然而，我只记得食谱的一些部分，如下所述。**

*   **所有配料的总重量正好是 700 克**
*   **黄油的量是糖的一半**
*   **面粉和鸡蛋的总重量最多为 450 克**
*   **鸡蛋和黄油加起来最多 300 克**
*   **鸡蛋加黄油的重量至多是面粉加糖的重量**

**能否从上述信息中计算出每种成分的最佳*值？***

**答案是肯定的。这就是线性程序的设计目的。**

**我们可以将每个变量定义为**

*   **面粉:**fT21****
*   ***鸡蛋: ***e******
*   ***黄油:**T5 b*****
*   ***糖: ***s******

***然后，我们可以将每个条件写成***

***寻找蛋糕原料。***

***请注意，上面的等式遵循一种模式。所有变量出现在左边，所有常量出现在右边。不等式表示为*小于或等于。一旦我们能够以上述方式表达一个问题，就可以构造一个线性程序。拼图的最后一块是目标函数。*成本函数*或*目标函数*基本上是另一种需要最大化或最小化的线性关系(在我们求解的变量之间)。这实际上进一步简化了问题。****

***健康意识成本函数的一个例子如下***

*   ***尽量减少黄油和糖的消耗***

***或者换句话说***

***走向健康的成本函数。***

***我们几乎已经准备好用 Python 来编码我们的线性问题了。然而，我们可以用一种稍微对代码更友好的方式来表述这个问题。从数学上讲，我们可以用矩阵形式表示一组线性方程，这有助于我们通过计算来形象化问题。***

***我们定义以下矩阵***

***用矩阵定义问题。***

***其中第一行包含我们在矩阵*中求解的所有变量，以及我们的成本函数 ***c*** 。等式矩阵在第二行，描述不等式条件的矩阵在最后一行。矩阵被定义为遵循[矩阵乘法](https://mathworld.wolfram.com/MatrixMultiplication.html)的规则。这个公式允许我们将方程写成****

****矩阵形式的方程。****

****因此，使用线性代数我们的问题采取的形式****

****使用线性代数的问题公式。****

****注意我们使用了矩阵*的[转置](https://en.wikipedia.org/wiki/Transpose)(上标 **T** )这样我们就可以把它和我们的求解矩阵 ***X*** 相乘。*****

****我们现在可以开始用 Python 来编码这个问题了。****

## ****如何用 Python 编写线性程序****

****我的 Python 设置****

*   ****Python 3.8.2****
*   ****科学版 1.18.1****
*   ****数字版本 1.4.1****
*   ****Cvxopt 1.2.3(可选)****

******使用 SciPy******

****Python 中的 SciPy 提供了基本的线性编程能力。为了使用 SciPy 实现上面的程序[，我们需要相应地定义所有的矩阵。下面是我使用 SciPy 的*优化*库实现的上述等式的工作示例。](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.linprog.html)****

****它返回以下输出****

```
**WITHOUT BOUNDS      
con: array([ 5.27055590e-08, -3.78719278e-11])      
fun: 249.99999998121916  
message: 'Optimization terminated successfully.'      
nit: 5    
slack: array([3.39247208e-08, 6.95661413e+01, 7.24656159e+01])   status: 0  
success: True        
x: array([302.8994746 , 147.10052537,  83.33333333, 166.66666665])**
```

****上面输出中的*成功*字段告诉我们优化是否成功。事实上，该消息在字段*消息*中被显式返回，或者在*状态*字段中被编码为整数值，该值可以取范围从 0 到 4 的 5 个整数值。最后, *x* 字段包含我们求解的变量，按照我们用矩阵公式定义的顺序返回。因此，解决方案是****

*   ****面粉= 302.89 克****
*   ****鸡蛋= 147.10 克****
*   ****黄油= 83.33 克****
*   ****糖= 166.66 克****

****结果满足了我们之前强加的所有条件。所有配料的总重量仍然正好是 700 克，黄油和糖的量是尽可能少的，黄油仍然是糖的一半，等等。****

*   ****注意:如果您没有得到上面的值，这可能与您使用的 SciPy 版本和/或用于执行线性程序的默认方法有关，即*单纯形*与*内点*****

******使用 SciPy 并为变量添加边界******

****我可以通过为我的变量添加一些估计值来使问题变得更加精确。例如，我记得面粉不超过 300 克，有一次我用了 100 克的黄油就能做蛋糕。我对其余的变量进行合理的猜测。****

****改进蛋糕食谱****

****它返回****

```
**WITH BOUNDS      
con: array([ 4.53132998e-09, -3.25428573e-12])      
fun: 249.9999999983819  
message: 'Optimization terminated successfully.'      
nit: 6    
slack: array([2.91322522e-09, 5.30261661e+01, 3.93856656e+01])  
status: 0  
success: True        
x: array([286.35949946, 163.64050053,  83.33333333, 166.66666667])**
```

****输出现在意味着****

*   ****面粉= 286.35 克****
*   ****鸡蛋= 163.64 克****
*   ****黄油= 83.33 克****
*   ****糖= 166.66 克****

****请注意，现在黄油和糖的含量比以前高了。这是完全可以接受的，因为线性程序试图同时满足我们编码的所有条件，包括我们为每种成分新设定的界限。总数还是 700g，黄油还是糖的一半，黄油还是不到 100g(我们强加的一个界限)，面粉+黄油还是大于等于鸡蛋+糖等等。这就是线性程序的美妙之处。它的目标是满足通过的每一个条件，从而返回最优解。****

****我为结果编写了一个简单的解析器，它以字典的形式返回可读性更好的输出。****

****随着输出****

```
**Result (no bounds):  
{'Flour': 303.0, 'Eggs': 147.0, 'Butter': 83.0, 'Sugar': 167.0}
Result (with bounds):  
{'Flour': 286.0, 'Eggs': 164.0, 'Butter': 83.0, 'Sugar': 167.0}**
```

******使用另一个线性编程库******

****Python 中有很多库( [CVXOPT](https://cvxopt.org/) 、[浆](https://github.com/coin-or/pulp)、 [CVXPY](https://www.cvxpy.org/) 、 [ECOS](https://github.com/embotech/ecos-python) 等。)基本上自带 LP 解算器，或者充当其他 LP 解算器的包装器。因此，人们可以根据手头的问题选择包装器-解算器的组合。****

****下面是使用 [CVXOPT](https://cvxopt.org/) 库和 [GLPK](https://www.gnu.org/software/glpk/glpk.html) 解算器实现的相同问题序言(矩阵和方程)。这里的主要区别是需要在 cvxopt 自己的矩阵框架中定义方程。请注意，CVXOPT 相当灵活，允许根据问题使用多个解算器。我没有通过变量的任何界限。****

****它返回输出****

```
**solution found 
[ 2.67e+02] 
[ 1.83e+02] 
[ 8.33e+01] 
[ 1.67e+02]**
```

****这是我们使用上面 SciPy 自己的线性优化程序找到的两个解决方案之间的一个。虽然黄油和糖的数量保持一致，但面粉和鸡蛋的价值不同。这是为什么呢？一个原因是我们的问题可能不是很好构造的(特别是对于面粉和鸡蛋的值)，但是这三个解决方案是同样可以接受的，因为它们满足了所有的约束。请注意，在最后两个解决方案中，面粉和鸡蛋的总量保持不变，但是各个值相差 20 克。人们可能需要增加另一个约束来打破这种简并。****

## ****对于读者来说****

****我们可以通过加入面粉加糖的重量正好是 500 克的等式或知识来打破这种退化，或者换句话说****

****打破简并。****

****你能试着把这个添加到相关的矩阵(和代码)中吗？然后重新运行无边界的 SciPy 求解器，无边界的 CVXOPT，看看成分的值是否匹配？****

****整个笔记本和这个等式的加法都托管在[这里](https://github.com/codiusmaximus/lights)。****

****一般来说，特定求解器找到的解归结为给定求解器如何实际求解线性规划。这是另一个帖子的主题，我将避免在这里进入细节。****