<html>
<head>
<title>Python Stock Analysis — Candlestick Chart with Python and Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 股票分析—使用 Python 和 Plotly 的蜡烛图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-stock-analysis-candlestick-chart-with-python-and-plotly-e619143642bb?source=collection_archive---------9-----------------------#2020-01-22">https://towardsdatascience.com/python-stock-analysis-candlestick-chart-with-python-and-plotly-e619143642bb?source=collection_archive---------9-----------------------#2020-01-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d3c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">蜡烛图是一种非常常见和有用的股票价格表示法。通过查看蜡烛图，我们可以直观地看到任何给定股票的开盘价、收盘价、最低价和最高价。</p><blockquote class="kl km kn"><p id="b97c" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">在本文中，我将向您展示如何使用 Python、Pandas 和 Plotly 来构建您自己的蜡烛图。</p></blockquote><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/6f9f3b3c0c98bf3e5e52b5cd4db86519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0TJmX03vIJHkwVjqH4Fq0g.jpeg"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated"><a class="ae li" href="https://unsplash.com/@m_b_m?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> M. B. M. </a>在<a class="ae li" href="https://unsplash.com/photos/3Tf1J8q9bBA?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c0d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将从导入所有需要的包开始。我们将需要<em class="ko">熊猫</em>、<em class="ko"> Plotly </em>、<em class="ko"> Json </em>和<em class="ko">请求。需要 Requests 和 Json </em>从免费的金融 API F<a class="ae li" href="https://financialmodelingprep.com/" rel="noopener ugc nofollow" target="_blank">financialmodelingprep</a>中检索股票信息。</p><pre class="kt ku kv kw gt lj lk ll lm aw ln bi"><span id="fe26" class="lo lp iq lk b gy lq lr l ls lt">import plotly.express as px<br/>import plotly.graph_objects as go<br/>import pandas as pd<br/>import requests<br/>import json</span><span id="4291" class="lo lp iq lk b gy lu lr l ls lt">quote = 'AAPL'</span><span id="efc6" class="lo lp iq lk b gy lu lr l ls lt">days = 300</span><span id="6e0b" class="lo lp iq lk b gy lu lr l ls lt">def candlestick(quote,days):<br/>    r =     requests.get(f'<a class="ae li" href="https://financialmodelingprep.com/api/v3/historical-price-full/{quote}?timeseries={days}'" rel="noopener ugc nofollow" target="_blank">https://financialmodelingprep.com/api/v3/historical-  price-full/{quote}?timeseries={days}'</a>)</span><span id="0955" class="lo lp iq lk b gy lu lr l ls lt">    r = r.json()</span><span id="9a5b" class="lo lp iq lk b gy lu lr l ls lt">    return r</span></pre><p id="317f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将 API 端点 url 作为 get 函数的一个参数进行传递，该 URL 存储在一个名为<em class="ko"> r </em>的变量中。然后，我们把 API 响应转换成 Json，这样我们 Python 就可以很容易地用 Python 操纵它了。变量<em class="ko"> r </em>将包含我们传递给函数<em class="ko">烛台</em>的任何股票的历史价格数据。在上面的例子中，我们传递了函数'<em class="ko"> AAPL </em>'(即苹果)和<em class="ko"> 300 </em>天作为参数。因此，结果是，我们得到一个代表 300 个数据点的列表。<strong class="jp ir">列表中的每个元素都是一个字典，包含</strong>我们的蜡烛图所需要的信息，即<strong class="jp ir">的<em class="ko">开市、</em>的</strong>高、低和<strong class="jp ir">的<em class="ko">收市</em>和</strong>的。</p><pre class="kt ku kv kw gt lj lk ll lm aw ln bi"><span id="5a8a" class="lo lp iq lk b gy lq lr l ls lt">“symbol” : “AAPL”, “historical” : [ { “date” : “2015–01–20”, “open” : 107.84, “high” : 108.97, “low” : 106.5, “close” : 108.72, “volume” : 4.98999E7, “unadjustedVolume” : 4.98999E7, “change” : -0.88, “changePercent” : -0.816,....</span></pre><p id="a067" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果可能的话，我总是喜欢把我的数据转换成熊猫数据框架，因为它让我以一种非常容易和方便的方式处理、操作和清理我的数据。这就是我们用下面两行代码实现的。</p><p id="e1ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们解析变量<em class="ko"> r </em>来提取与<em class="ko">历史</em>键相关的值，并将其存储在名为<em class="ko"> stockdata </em>的变量中。通过这种方式，我们保留了一个字典列表。每个字典包含一天的股票价格数据。然后，我们可以简单地将 stockdata 列表转换成 Pandas 数据帧。</p><pre class="kt ku kv kw gt lj lk ll lm aw ln bi"><span id="0201" class="lo lp iq lk b gy lq lr l ls lt">stockdata = r[‘historical’]<br/>stockdata_df = pd.DataFrame(stockdata)</span></pre><p id="3acf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们打印出我们的 Pandas data frame<em class="ko">stock data _ df，</em>我们会得到类似下面的内容，其中每行代表一天，每列为我们提供股票价格信息:</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lv"><img src="../Images/4d7ce6c2a614a0d80b11d42b8938bbf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*arVZpKZyv58y_yL75c8mQQ.png"/></div></div></figure><p id="f89a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止一切顺利。现在，让我们进入有趣的部分。我们可以开始用<a class="ae li" href="https://plot.ly/python/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>构建我们的图表。Plotly 是一个非常强大的图形库。非常容易使用 Python 和熊猫。</p><p id="0987" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要创建一个包含数据点的 fig 对象。在我们的数字中，我们定义了我们的日期，开盘价、最高价、最低价和收盘价。每个数据点都将是我们的<em class="ko">股票数据 _df </em>熊猫数据框架中的一列。例如，open 将包含我们的 Pandas 数据框架中包含的每个日期的开盘价。因为，我们在函数中传递了 300 天，open 将包含<em class="ko">苹果</em>最近 300 天的公开股票价格。</p><p id="6302" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还可以使用 Plotly <em class="ko"> fig.update_layout </em>命令更新图表的布局，为图表添加一些漂亮的标题，更改字体，并确保文本位于图表区域的顶部中央。</p><p id="9b05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们可以使用<em class="ko"> fig.show() </em>来显示蜡烛图:</p><pre class="kt ku kv kw gt lj lk ll lm aw ln bi"><span id="aa8d" class="lo lp iq lk b gy lq lr l ls lt">fig = go.Figure(data=[go.Candlestick(x=stockdata_df['date'],<br/>                open=stockdata_df['open'],<br/>                high=stockdata_df['high'],<br/>                low=stockdata_df['low'],<br/>                close=stockdata_df['close'])])</span><span id="483c" class="lo lp iq lk b gy lu lr l ls lt">fig.update_layout(<br/>    title= {<br/>        'text': quote,<br/>      'y':0.9,<br/>        'x':0.5,<br/>        'xanchor': 'center',<br/>        'yanchor': 'top'},<br/>      font=dict(<br/>        family="Courier New, monospace",<br/>        size=20,<br/>        color="#7f7f7f"<br/>    )<br/>    )</span><span id="9d02" class="lo lp iq lk b gy lu lr l ls lt">fig.show()</span></pre><p id="55da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在神奇的是，或者说是因为我们的编码技能，一个令人印象深刻的烛台图表显示在我们面前，包括一个滑块来放大和缩小任何特定的时间段。自己尝试一下吧！</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lw"><img src="../Images/8ce72b902d28396807186eaf2efddd78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SDL9AcNj79z-5Pjd0hk0kw.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">用 Python 和 Plotly 制作的烛台图</p></figure><p id="e2a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经包括了下面的整个脚本供您参考。只需替换<em class="ko">报价</em>和<em class="ko">天数</em>变量<em class="ko">和</em>来选择想要的股票和你想在图表中显示的天数。</p><p id="9736" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:如果您在运行下面的代码时遇到任何问题，请确保您已经安装了所有必需的库。</p><pre class="kt ku kv kw gt lj lk ll lm aw ln bi"><span id="3495" class="lo lp iq lk b gy lq lr l ls lt">import plotly.express as px<br/>import plotly.graph_objects as go<br/>import pandas as pd<br/>import requests<br/>import json</span><span id="a7c6" class="lo lp iq lk b gy lu lr l ls lt">quote = ‘AAPL’<br/>days = 300</span><span id="add3" class="lo lp iq lk b gy lu lr l ls lt">def candlestick(quote,days):<br/>  r = requests.get(f’<a class="ae li" href="https://financialmodelingprep.com/api/v3/historical-price-full/{quote}?timeseries={days}'" rel="noopener ugc nofollow" target="_blank">https://financialmodelingprep.com/api/v3/historical-price-full/{quote}?timeseries={days}'</a>)<br/>  r = r.json()<br/> <br/>  stockdata = r[‘historical’]<br/>  stockdata_df = pd.DataFrame(stockdata)<br/> <br/>  fig = go.Figure(data=[go.Candlestick(x=stockdata_df[‘date’],<br/>  open=stockdata_df[‘open’],<br/>  high=stockdata_df[‘high’],<br/>  low=stockdata_df[‘low’],<br/>  close=stockdata_df[‘close’])])</span><span id="9990" class="lo lp iq lk b gy lu lr l ls lt">  fig.update_layout(<br/>    title= {<br/>     ‘text’: quote,<br/>     ‘y’:0.9,<br/>     ‘x’:0.5,<br/>     ‘xanchor’: ‘center’,<br/>     ‘yanchor’: ‘top’},<br/>   font=dict(<br/>    family=”Courier New, monospace”,<br/>    size=20,<br/>    color=”#7f7f7f”<br/> ))</span><span id="ba9b" class="lo lp iq lk b gy lu lr l ls lt">  fig.show()<br/> <br/> <br/>candlestick(quote,days)</span></pre></div></div>    
</body>
</html>