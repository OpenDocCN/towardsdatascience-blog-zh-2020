<html>
<head>
<title>COVID-19 Data Acquisition in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R 中的新冠肺炎数据采集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/r-interface-to-covid-19-data-hub-244ae056af2c?source=collection_archive---------65-----------------------#2020-06-07">https://towardsdatascience.com/r-interface-to-covid-19-data-hub-244ae056af2c?source=collection_archive---------65-----------------------#2020-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5cb0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">跨政府来源收集数据，检索政策措施，与世界银行公开数据、谷歌和苹果移动报告接口。</h2></div><p id="f66c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="lb">编者注:</em> </strong> <em class="lb"> </em> <a class="ae lc" href="http://towardsdatascience.com/" rel="noopener" target="_blank"> <em class="lb">走向数据科学</em> </a> <em class="lb">是一份以研究数据科学和机器学习为主的中型刊物。我们不是健康专家或流行病学家，本文的观点不应被解释为专业建议。想了解更多关于疫情冠状病毒的信息，可以点击</em> <a class="ae lc" href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports" rel="noopener ugc nofollow" target="_blank"> <em class="lb">这里</em> </a> <em class="lb">。</em></p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ld"><img src="../Images/64649b1b95786649837d79a7e1d97bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0CQdf1IXrTK6eaCDgsiQg.jpeg"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">KOBU 机构在<a class="ae lc" href="https://unsplash.com/s/photos/coronavirus-data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2ce4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">新冠肺炎数据中心<a class="ae lc" href="https://covid19datahub.io/" rel="noopener ugc nofollow" target="_blank">由 R 构建，支持任何语言，提供了一个全球范围的、细粒度的、统一的数据集，有助于更好地了解新冠肺炎。用户可以立即从多个官方来源下载最新的结构化历史每日数据。这些数据每小时被处理一次，并以 csv 格式保存在</a><a class="ae lc" href="https://covid19datahub.io/articles/data.html" rel="noopener ugc nofollow" target="_blank">云存储</a>中，以便于从 Excel、R、Python…和任何其他软件中访问。所有的资料来源都有适当的记录，连同他们的引用。</p><p id="facb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本教程中，我们将探索与新冠肺炎数据中心的接口。</p><h2 id="d191" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">快速入门</h2><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="7eb6" class="lt lu iq mn b gy mr ms l mt mu"># install the package<br/>install.packages("COVID19")<br/><br/># load the package<br/>library("COVID19")<br/><br/># additional packages to replicate the examples<br/>library("ggplot2")<br/>library("directlabels")</span></pre><h2 id="e2fc" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">数据</h2><p id="49e5" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">使用<code class="fe na nb nc mn b">covid19</code>功能检索数据。默认情况下，它按国家下载全球数据，并打印相应的数据源。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="09a4" class="lt lu iq mn b gy mr ms l mt mu">x &lt;- covid19()</span></pre><p id="ea62" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe na nb nc mn b">verbose = FALSE</code>隐藏数据源</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="f814" class="lt lu iq mn b gy mr ms l mt mu">x &lt;- covid19(verbose = FALSE)</span></pre><p id="5096" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">返回一个包含几列的表格:累计确诊病例数、检测数、恢复数、死亡数、每日住院数、强化治疗数、需要通气的患者数、政策措施、地理信息、人口数和外部标识符，以便使用其他来源轻松扩展数据集。更多细节请参考<a class="ae lc" href="https://covid19datahub.io/articles/doc/data.html" rel="noopener ugc nofollow" target="_blank">文件</a>。</p><h2 id="1017" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">干净的数据</h2><p id="cecc" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">默认情况下，通过用<code class="fe na nb nc mn b">NA</code>值填充缺失的日期来清除原始数据。这确保了所有地点共享相同的日期网格，并且没有一天被跳过。然后，<code class="fe na nb nc mn b">NA</code>值被替换为之前的非<code class="fe na nb nc mn b">NA</code>值或<code class="fe na nb nc mn b">0</code>。</p><p id="0b1a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">例</em>:按国家绘制确诊病例。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="9f8f" class="lt lu iq mn b gy mr ms l mt mu">ggplot(data = x, aes(x = date, y = confirmed)) +<br/>  geom_line(aes(color = id)) +<br/>  geom_dl(aes(label = administrative_area_level_1), method = list("last.points", cex = .75, hjust = 1, vjust = 0)) +<br/>  scale_y_continuous(trans = 'log10') +<br/>  theme(legend.position = "none") +<br/>  ggtitle("Confirmed cases (log scale)")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/36714e43dfcf9aa1bb2c808a60478a55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Vp9uQMg8Wu6alsQi.png"/></div></div></figure><p id="958d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">例</em>:按国家绘制确诊病例占总人口的比例。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="bbad" class="lt lu iq mn b gy mr ms l mt mu">ggplot(data = x, aes(x = date, y = confirmed/population)) +<br/>  geom_line(aes(color = id)) +<br/>  geom_dl(aes(label = administrative_area_level_1), method = list("last.points", cex = .75, hjust = 1, vjust = 0)) +<br/>  scale_y_continuous(trans = 'log10') +<br/>  theme(legend.position = "none") +<br/>  ggtitle("Confirmed cases - Fraction of total population (log scale)")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/c0f6d8d40158ec6c8d7aa3141fa828c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gPaSza-EjSLX8mhO.png"/></div></div></figure><h2 id="8a7e" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">原始数据</h2><p id="ad6f" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">并不总是建议用以前的非缺失数据填充数据，尤其是在计算比率或处理除数据可视化之外的更复杂的分析时。<code class="fe na nb nc mn b">raw</code>参数允许跳过数据清理，按原样检索原始数据，无需任何预处理。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="705c" class="lt lu iq mn b gy mr ms l mt mu">x &lt;- covid19(raw = TRUE, verbose = FALSE)</span></pre><p id="6ac4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该包依赖于来自多个来源的公开可用数据，但这些数据并不总是一致的，例如，确诊病例数大于检测数、累计计数减少等。<a class="ae lc" href="https://covid19datahub.io" rel="noopener ugc nofollow" target="_blank">新冠肺炎数据中心</a>可以发现数据源之间的不一致，并自动通知当局可能的错误。所有日志都可以在<a class="ae lc" href="https://covid19datahub.io/articles/data.html" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="de83" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">例</em>:按国家绘制确诊病例，作为检测的一部分。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="192e" class="lt lu iq mn b gy mr ms l mt mu">ggplot(data = x, aes(x = date, y = confirmed/tests)) +<br/>  geom_line(aes(color = id)) +<br/>  geom_dl(aes(label = administrative_area_level_1), method = list("last.points", cex = .75, hjust = 1, vjust = 0)) +<br/>  scale_y_continuous(trans = 'log10') +<br/>  theme(legend.position = "none") +<br/>  ggtitle("Confirmed cases - Fraction of tests (log scale)")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/1b02eeb2eac75380c9f74cd31c8bc26b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*laPR__maRuJ_rt8n.png"/></div></div></figure><p id="14c9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">示例</em>:按国家绘制死亡率。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="25f5" class="lt lu iq mn b gy mr ms l mt mu">ggplot(data = x, aes(x = date, y = deaths/confirmed)) +<br/>  geom_line(aes(color = id)) +<br/>  geom_dl(aes(label = administrative_area_level_1), method = list("last.points", cex = .75, hjust = 1, vjust = 0)) +<br/>  scale_y_continuous(trans = 'log10') +<br/>  theme(legend.position = "none") +<br/>  ggtitle("Mortality rate (log scale)")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/0e91784879e17e6e4d23d274816b3fe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xECYLvMYH-903DNx.png"/></div></div></figure><h2 id="44be" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">复古数据</h2><p id="49b5" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">检索在<code class="fe na nb nc mn b">end</code>日期生成的数据集快照，而不是使用最新版本。此选项确保结果的可重复性，并跟踪数据提供者可能做出的更改。示例:检索 2020-06-02 的年份数据。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="c08c" class="lt lu iq mn b gy mr ms l mt mu"># retrieve vintage data on 2020-06-02 <br/>x &lt;- covid19(end = "2020-06-02", vintage = TRUE, verbose = FALSE)</span></pre><p id="e99e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例子:与英国的最新数据比较。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="6743" class="lt lu iq mn b gy mr ms l mt mu"># retrieve latest data<br/>y &lt;- covid19(verbose = FALSE)<br/><br/># add type<br/>x$type &lt;- "vintage"<br/>y$type &lt;- "latest"<br/><br/># bind and filter<br/>x &lt;- rbind(x, y)<br/>x &lt;- x[x$iso_alpha_3=="GBR",]<br/><br/># plot<br/>ggplot(data = x, aes(x = date, y = deaths)) +<br/>  geom_line(aes(color = type)) +<br/>  theme(legend.position = "right") +<br/>  ggtitle("UK fatalities")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/ece5d5e21109ac2250547cfcfa76c81d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dtvSp8biW37UYEBO.png"/></div></div></figure><h2 id="4c53" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">行政区域</h2><p id="45c9" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">参数<code class="fe na nb nc mn b">country</code>指定要检索的不区分大小写的国家名称或<a class="ae lc" href="https://github.com/covid19datahub/COVID19/blob/master/inst/extdata/db/ISO.csv" rel="noopener ugc nofollow" target="_blank"> ISO 代码</a> (alpha-2，alpha-3，数字)的向量。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="0fec" class="lt lu iq mn b gy mr ms l mt mu"># load data for United States, Italy, and Switzerland<br/>x &lt;- covid19(c("United States", "ITA", "ch"), verbose = FALSE)</span></pre><p id="ec9c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">例</em>:绘制死亡率。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="5d5d" class="lt lu iq mn b gy mr ms l mt mu">ggplot(data = x, aes(x = date, y = deaths/confirmed)) +<br/>  geom_line(aes(color = id)) +<br/>  geom_dl(aes(label = administrative_area_level_1), method = list("last.points", cex = .75, hjust = 1, vjust = 0)) +<br/>  scale_y_continuous(trans = 'log10') +<br/>  theme(legend.position = "none") + <br/>  ggtitle("Mortality rate (log scale)")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/6912179b3a19b9648886d505c5b3491b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*koFe8l7Vk6aJZgrp.png"/></div></div></figure><p id="6ae4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据在不同的粒度级别上可用:行政区级别 1(顶级行政区，通常是国家)，行政区级别 2(通常是州、地区、县)，行政区级别 3(通常是城市、自治市)。数据的粒度由参数<code class="fe na nb nc mn b">level</code>指定。<em class="lb">示例</em>:检索意大利地区的数据并绘制死亡率。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="758a" class="lt lu iq mn b gy mr ms l mt mu"># italy admin area level 2<br/>x &lt;- covid19("ITA", level = 2, verbose = FALSE)<br/><br/># plot<br/>ggplot(data = x, aes(x = date, y = deaths/confirmed)) +<br/>  geom_line(aes(color = id)) +<br/>  geom_dl(aes(label = administrative_area_level_2), method = list("last.points", cex = .75, hjust = 1, vjust = 0)) +<br/>  scale_y_continuous(trans = 'log10') +<br/>  theme(legend.position = "none") +<br/>  ggtitle("Mortality rate by region (log scale)")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/f1781c93ba49ba2aba814518048f0f43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Lj6eYsI01ZwS_i4e.png"/></div></div></figure><p id="7b65" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该软件包允许跨国比较。<em class="lb">示例</em>:绘制意大利地区和瑞士各州的死亡率。根据国家的不同，还支持城市级数据(3 级)。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="c671" class="lt lu iq mn b gy mr ms l mt mu"># italy and switzerland admin area level 2<br/>x &lt;- covid19(c("ITA","CHE"), level = 2, verbose = FALSE)<br/><br/># plot<br/>ggplot(data = x, aes(x = date, y = deaths/confirmed)) +<br/>  geom_line(aes(color = administrative_area_level_1, group = administrative_area_level_2)) +<br/>  geom_dl(aes(label = administrative_area_level_2), method = list("last.points", cex = .75, hjust = 1, vjust = 0)) +<br/>  scale_y_continuous(trans = 'log10') +<br/>  theme(legend.position = "top", legend.title = element_blank()) +<br/>  ggtitle("Mortality rate by region (log scale)")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/cc3dd0ecb570ef4a37d43a7f14cd9ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2afS_bR8xtRCArny.png"/></div></div></figure><h2 id="afb4" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">政策措施</h2><p id="d914" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">国家层面的政策由牛津新冠肺炎政府响应跟踪系统获取。管理区域级别 2 和 3 的策略继承自国家级别的策略。详见<a class="ae lc" href="https://covid19datahub.io/articles/doc/data.html" rel="noopener ugc nofollow" target="_blank">文件</a>。</p><p id="13cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">示例</em>:加载美国数据，检测测试政策的变化，并将其与死亡率一起绘制。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="b573" class="lt lu iq mn b gy mr ms l mt mu"># US data<br/>x &lt;- covid19("USA", verbose = FALSE)<br/><br/># detect changes in testing policy<br/>testing_policy_dates &lt;- x$date[diff(x$testing_policy)!=0]<br/><br/># plot mortality rate and changes in testing policy<br/>ggplot(data = x, aes(x = date, y = deaths/confirmed)) +<br/>  geom_line(aes(color = id)) +<br/>  geom_dl(aes(label = administrative_area_level_1), method = list("last.points", cex = .75, hjust = 1, vjust = 0)) +<br/>  geom_vline(xintercept = testing_policy_dates, linetype = 4) +<br/>  scale_y_continuous(trans = 'log10') +<br/>  theme(legend.position = "none") +<br/>  ggtitle("US mortality rate and changes in testing policy")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/b1e12f18bb11de2853006a9afd096242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*N1u1c6-P2AXYBZI6.png"/></div></div></figure><h2 id="13b6" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">世界银行公开数据</h2><p id="b39f" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">数据集可以通过参数<code class="fe na nb nc mn b">wb</code>使用<a class="ae lc" href="https://data.worldbank.org/" rel="noopener ugc nofollow" target="_blank">世界银行公开数据</a>进行扩展，参数<code class="fe na nb nc mn b">wb</code>是指标代码的字符向量。可以通过检查相应的 URL 找到代码。例如，这里可用的 GDP 指标<a class="ae lc" href="https://data.worldbank.org/indicator/NY.GDP.MKTP.CD" rel="noopener ugc nofollow" target="_blank">的代码</a>是<code class="fe na nb nc mn b">NY.GDP.MKTP.CD</code>。</p><p id="b7ed" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">例</em>:用世界银行指标<code class="fe na nb nc mn b">NY.GDP.MKTP.CD</code> (GDP)和<code class="fe na nb nc mn b">SH.MED.BEDS.ZS</code>(每千人医院床位)扩展数据集。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="1b02" class="lt lu iq mn b gy mr ms l mt mu"># download worldwide data + GDP + hospital beds (per 1,000 people)<br/>wb &lt;- c("gdp" = "NY.GDP.MKTP.CD", "hosp_beds" = "SH.MED.BEDS.ZS")<br/>x  &lt;- covid19(wb = wb, raw = TRUE, verbose = FALSE)</span></pre><p id="5e4b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">例子</em>:绘制死亡率与医院病床数量的函数关系图。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="93d1" class="lt lu iq mn b gy mr ms l mt mu">ggplot(data = x, aes(x = hosp_beds, y = deaths/confirmed)) +<br/>  geom_line(aes(color = id)) +<br/>  geom_dl(aes(label = administrative_area_level_1), method = list("last.points", cex = .75, hjust = 1, vjust = 0)) +<br/>  scale_y_continuous(trans = 'log10') +<br/>  xlab("Hospital beds per 1,000 people") +<br/>  theme(legend.position = "none") +<br/>  ggtitle("Worldwide mortality rates (log scale) and number of hospital beds")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/cfe24578e9bb9bcde150bf0727b15aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Vm0xH2oPcrcgnped.png"/></div></div></figure><h2 id="3915" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">谷歌移动报告</h2><p id="75e1" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">数据集可以通过参数<code class="fe na nb nc mn b">gmr</code>(Google CSV 文件的 url)用<a class="ae lc" href="https://www.google.com/covid19/mobility/" rel="noopener ugc nofollow" target="_blank"> Google Mobility Reports </a>扩展。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="2533" class="lt lu iq mn b gy mr ms l mt mu"># at the time of writing, the CSV is available at:<br/>gmr &lt;- "https://www.gstatic.com/covid19/mobility/Global_Mobility_Report.csv"<br/>x   &lt;- covid19("ITA", gmr = gmr, raw = TRUE, verbose = FALSE)</span></pre><p id="bb0b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">示例</em>:检测意大利交通政策的变化，并将其与死亡率、确诊病例百分比和谷歌移动指标一起绘制。根据国家/地区，还支持地区或城市级别的移动数据。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="fdf0" class="lt lu iq mn b gy mr ms l mt mu"># detect changes in transport policy<br/>transport_dates &lt;- x$date[diff(x$transport_closing)!=0]<br/><br/># plot<br/>ggplot(x, aes(x = date)) +<br/>    geom_line(aes(y = confirmed/tests*100, color = "Confirmed/Tested"), size = 1.2) +<br/>    geom_line(aes(y = deaths/confirmed*100, color = "Deaths/Confirmed"), size = 1.2) +<br/>    geom_line(aes(y = residential_percent_change_from_baseline, color = "Residential")) +<br/>    geom_line(aes(y = workplaces_percent_change_from_baseline, color = "Workplaces")) +<br/>    geom_line(aes(y = transit_stations_percent_change_from_baseline, color = "Transit Stations")) + <br/>    geom_line(aes(y = parks_percent_change_from_baseline, color = "Parks")) +<br/>    geom_line(aes(y = grocery_and_pharmacy_percent_change_from_baseline, color = "Grocery and Pharmacy")) + <br/>    geom_line(aes(y = retail_and_recreation_percent_change_from_baseline, color = "Retail and Recreation")) + <br/>    geom_vline(xintercept = transport_dates, linetype = 4) +<br/>    ylab("") +<br/>    theme(legend.position = "bottom", legend.title = element_blank()) +<br/>    ggtitle("ITA - Google mobility and transport policy")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/10034082e59e9ecd99683001afecbc71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yRz2f-vGfFNPflbY.png"/></div></div></figure><h2 id="7519" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">苹果移动报告</h2><p id="f39e" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">数据集可以用<a class="ae lc" href="https://www.apple.com/covid19/mobility" rel="noopener ugc nofollow" target="_blank"> Apple Mobility Reports </a>通过参数<code class="fe na nb nc mn b">amr</code>扩展，这是 Apple CSV 文件的 url。根据国家/地区，还支持地区或城市级别的移动数据。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="4e6a" class="lt lu iq mn b gy mr ms l mt mu"># at the time of writing, the CSV is available at:<br/>amr &lt;- "https://covid19-static.cdn-apple.com/covid19-mobility-data/2009HotfixDev19/v3/en-us/applemobilitytrends-2020-06-03.csv"<br/>x   &lt;- covid19("ITA", amr = amr, raw = TRUE, verbose = FALSE)</span></pre><p id="5ba3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">示例</em>:检测意大利交通政策的变化，并将其与死亡率、确诊病例百分比和苹果移动性指标一起绘制。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="0a8e" class="lt lu iq mn b gy mr ms l mt mu"># detect changes in transport policy<br/>transport_dates &lt;- x$date[diff(x$transport_closing)!=0]<br/><br/># plot<br/>ggplot(x, aes(x = date)) +<br/>    geom_line(aes(y = confirmed/tests*100, color = "Confirmed/Tested"), size = 1.2) +<br/>    geom_line(aes(y = deaths/confirmed*100, color = "Deaths/Confirmed"), size = 1.2) +<br/>    geom_line(aes(y = driving-100, color = "Driving")) +<br/>    geom_line(aes(y = walking-100, color = "Walking")) +<br/>    geom_line(aes(y = transit-100, color = "Transit")) +<br/>    geom_vline(xintercept = transport_dates, linetype = 4) +<br/>    ylab("") +<br/>    theme(legend.position = "bottom", legend.title = element_blank()) +<br/>    ggtitle("ITA - Apple mobility and transport policy")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nd"><img src="../Images/5849375abb459a56061f5fb3ca144c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xG5uPjaUD8li7_0b.png"/></div></div></figure><h2 id="33bd" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">规模分析</h2><p id="0b59" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">通过使用<code class="fe na nb nc mn b">dplyr</code>包，数据集的结构使得复制多个国家、州和城市的分析变得容易。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="6e39" class="lt lu iq mn b gy mr ms l mt mu">library("dplyr")</span></pre><p id="f78a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">加载数据。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="e1c3" class="lt lu iq mn b gy mr ms l mt mu">x &lt;- covid19(raw = TRUE, verbose = FALSE)</span></pre><p id="5132" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">定义应用于每个组(如国家)的函数，必须返回一个数据帧。例如，该函数可以计算每个国家或地区的 R0。为了简单起见，下面的示例仅限于提取每组的最新死亡人数。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="657a" class="lt lu iq mn b gy mr ms l mt mu">f &lt;- function(x, key){<br/>  # x:   the subset of rows for the given group <br/>  # key: row with one column per grouping variable <br/>  <br/>  # code here... <br/>  example &lt;- tail(x$deaths, 1)<br/>  <br/>  # return data.frame<br/>  data.frame(id = key$id, example = example)<br/>  <br/>}</span></pre><p id="26b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">定义组，将函数应用于每个组，并绑定结果。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="7d12" class="lt lu iq mn b gy mr ms l mt mu">y &lt;- x %&gt;% <br/>  group_by(id) %&gt;% # group by location id<br/>  group_map(f) %&gt;% # apply the function to each group<br/>  bind_rows()      # bind the results</span></pre><p id="e546" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">打印第一行。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="d29e" class="lt lu iq mn b gy mr ms l mt mu">head(y, 5)</span><span id="ec32" class="lt lu iq mn b gy ne ms l mt mu">##    id example<br/>## 1 AFG     309<br/>## 2 AGO       4<br/>## 3 ALB      33<br/>## 4 AND      51<br/>## 5 ARE     274</span></pre><h2 id="7a2e" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">闪亮的应用程序</h2><p id="3d9d" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated"><code class="fe na nb nc mn b">covid19</code>功能使用内部内存缓存系统，因此数据不会被下载两次。这特别适合交互式框架，比如 Shiny。参见<a class="ae lc" rel="noopener" target="_blank" href="/how-to-build-covid-19-data-driven-shiny-apps-in-5mins-2d7982882a73">如何在 5 分钟内构建新冠肺炎数据驱动的闪亮应用</a>。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><p id="5240" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">新冠肺炎数据中心是免费软件，没有任何担保。请确保同意<a class="ae lc" href="https://covid19datahub.io/LICENSE.html" rel="noopener ugc nofollow" target="_blank">使用条款</a>。</p><p id="1c3f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[1]吉多蒂，即阿尔迪亚，d .(2020)。<a class="ae lc" href="https://doi.org/10.21105/joss.02376" rel="noopener ugc nofollow" target="_blank">新冠肺炎数据中心</a>，《开源软件杂志》，5(51):2376</p></div></div>    
</body>
</html>