<html>
<head>
<title>BigQuery, PII, and Cloud Data Loss Prevention (DLP): Take it to the next level with Data Catalog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BigQuery、PII和云数据丢失防护(DLP):通过数据目录将其提升到新的水平</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/bigquery-pii-and-cloud-data-loss-prevention-dlp-take-it-to-the-next-level-with-data-catalog-c47c31bcf677?source=collection_archive---------20-----------------------#2020-06-02">https://towardsdatascience.com/bigquery-pii-and-cloud-data-loss-prevention-dlp-take-it-to-the-next-level-with-data-catalog-c47c31bcf677?source=collection_archive---------20-----------------------#2020-06-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5410" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何通过使用云数据丢失防护检查所有BigQuery数据来创建数据目录标记。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/00eefd6cbeedda197b396c1ef89ec49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_OcGm3SZwmasy61CtNwMXg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">背景由<a class="ae kv" href="https://unsplash.com/@kellitungay?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Kelli Tungay </a>上<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="cc10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi ls translated"><span class="l lt lu lv bm lw lx ly lz ma di">你知道你的组织掌握着什么样的敏感数据吗？您是否跟踪应用于所有表和列的每个更改？你有信心回答审计员可能提出的关于数据法规的问题吗？</span></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mb"><img src="../Images/08b798c08a81bf582127ee6020033be7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lKGKYOv51BuTP6IbqYzjvA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">背景由<a class="ae kv" href="https://unsplash.com/@elmuff?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Sandra Grünewald </a>在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="837c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让一个审计员来敲你的门并不是最可怕的事情，数据泄露才是最可怕的！从罚款到客户流失和法律后果，后果可能是残酷而持久的。</p><p id="466f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对您的敏感数据进行分类和管理是着手处理这一问题的好方法，但用手动方式来做不是办法。</p><p id="85de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有一点值得思考，谁想检查数千、数百万的数据资产，然后给每一个都贴上标签，说它们是敏感的还是不敏感的？如果表有令人困惑的列名怎么办？我不会开始讨论这有多容易出错，但你会明白…</p><p id="8bd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要以某种方式自动完成这项工作。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><p id="56a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将看到一个全自动的解决方案，通过使用DLP和数据目录来发现所有大型查询资产中的敏感数据(每当我提到DLP时，它都会支持<a class="ae kv" href="https://cloud.google.com/dlp" rel="noopener ugc nofollow" target="_blank">数据丢失预防】</a>)。如果您不熟悉DLP和数据目录，您会对第一部分和第二部分感兴趣。</p><p id="c3ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">否则，如果您想了解DLP和数据目录的神奇之处，请直接跳到第三部分。</p><p id="ea78" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文涵盖的主题有:</p><ol class=""><li id="d1bd" class="mj mk iq ky b kz la lc ld lf ml lj mm ln mn lr mo mp mq mr bi translated"><strong class="ky ir">云数据防丢失概述</strong></li><li id="44b7" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr mo mp mq mr bi translated"><strong class="ky ir">数据目录概述</strong></li><li id="272b" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr mo mp mq mr bi translated"><strong class="ky ir"> DLP到数据目录标签概述</strong></li><li id="296a" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr mo mp mq mr bi translated"><strong class="ky ir">脚本执行演练</strong></li></ol><p id="572a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事不宜迟，我们走吧！</p><blockquote class="mx my mz"><p id="f127" class="kw kx na ky b kz la jr lb lc ld ju le nb lg lh li nc lk ll lm nd lo lp lq lr ij bi translated">我们将提供一个带有工作示例的GitHub存储库。</p></blockquote></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="e563" class="ne nf iq bd ng nh ni nj nk nl nm nn no jw np jx nq jz nr ka ns kc nt kd nu nv bi translated">云数据丢失防护概述</h1><p id="8a18" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">DLP是一项托管的Google云服务，旨在帮助您发现、分类和保护您最敏感的数据。</p><blockquote class="ob"><p id="212f" class="oc od iq bd oe of og oh oi oj ok lr dk translated"><a class="ae kv" href="https://cloud.google.com/dlp/" rel="noopener ugc nofollow" target="_blank">Cloud DLP拥有120多种内置信息类型，让您能够从几乎任何地方扫描、发现、分类和报告数据。云DLP具有对云存储、BigQuery和数据存储中的敏感数据进行扫描和分类的原生支持，以及支持附加数据源、自定义工作负载和应用程序的流内容API。</a></p></blockquote><h2 id="6bcb" class="ol nf iq bd ng om on dn nk oo op dp no lf oq or nq lj os ot ns ln ou ov nu ow bi translated">特征</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/b4142a1b61b532603a83856a350295a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*1O5BL0IKUTLSdZYoGoxfWQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自<a class="ae kv" href="https://cloud.google.com/dlp/" rel="noopener ugc nofollow" target="_blank">官方文件</a>的DLP特性</p></figure><p id="e0c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将利用<a class="ae kv" href="https://cloud.google.com/dlp/docs/reference/rest/v2/projects.content/inspect" rel="noopener ugc nofollow" target="_blank">流媒体内容API </a> <strong class="ky ir"> </strong>和<strong class="ky ir"> </strong> <a class="ae kv" href="https://cloud.google.com/dlp/docs/creating-templates-inspect" rel="noopener ugc nofollow" target="_blank"> DLP检查模板</a>。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="5de4" class="ne nf iq bd ng nh ni nj nk nl nm nn no jw np jx nq jz nr ka ns kc nt kd nu nv bi translated">数据目录概述</h1><p id="273f" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">数据目录是一种可管理和可扩展的元数据管理服务，使组织能够快速发现、了解和管理其所有数据。</p><blockquote class="ob"><p id="5568" class="oc od iq bd oe of og oh oi oj ok lr dk translated"><a class="ae kv" href="https://cloud.google.com/data-catalog" rel="noopener ugc nofollow" target="_blank"> Data Catalog通过Google Cloud提供了一个更安全的中央数据目录，使组织能够对其所有数据资产有一个统一的视图。该服务自动吸收BigQuery和云发布/订阅的技术元数据，并允许客户通过标签、自定义API和UI以模式化格式捕获业务元数据，从而提供一种简单高效的方法来对其数据资产进行编目。</a></p></blockquote><h2 id="b465" class="ol nf iq bd ng om on dn nk oo op dp no lf oq or nq lj os ot ns ln ou ov nu ow bi translated">特征</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/15bf7ee3e2f193216c3156f7f36c3c4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ef0NfrNHptCc8eyMZAy6zQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://cloud.google.com/data-catalog" rel="noopener ugc nofollow" target="_blank">正式文档</a>中的数据目录特性</p></figure><p id="23c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将利用标签模板<strong class="ky ir">、</strong>标签、<strong class="ky ir">、</strong>和<strong class="ky ir"> </strong>进行数据目录搜索。</p><p id="e291" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">快速查看数据目录<strong class="ky ir">标签</strong>结构:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/919bdf62d3e5d03f0f253f379b4473b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*EBc3GFW2OCiMZFbaAKrT-A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从<a class="ae kv" href="https://github.com/ricardolsmendes/gcp-datacatalog-diagrams" rel="noopener ugc nofollow" target="_blank">GCP-数据目录-图表</a>中标记心智模型</p></figure><p id="7e79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将在后面介绍更多细节，但是请记住，由于我们关注的是大型查询资产，每个大型查询表都代表数据目录中的一个条目，我们将创建<strong class="ky ir">标记</strong>来对敏感数据进行分类，标记模板将代表<a class="ae kv" href="https://cloud.google.com/dlp/docs/infotypes-reference" rel="noopener ugc nofollow" target="_blank"> DLP信息类型</a>。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="e6d8" class="ne nf iq bd ng nh ni nj nk nl nm nn no jw np jx nq jz nr ka ns kc nt kd nu nv bi translated">DLP到数据目录标记概述</h1><p id="ca6a" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">现在，您已经熟悉了DLP和数据目录，让我们继续了解体系结构概述:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/e1acb87294654e20ea17164a7bfdf436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u7U9gtXhT3vmjSiC7IMO_g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从<a class="ae kv" href="https://cloud.google.com/community/tutorials/dlp-to-datacatalog-tags" rel="noopener ugc nofollow" target="_blank"> dlp到数据目录标签</a>的参考架构</p></figure><p id="99d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该脚本使用<code class="fe pb pc pd pe b">Java</code>工作负载，用户能够在他们的本地机器、云外壳或计算引擎虚拟机上执行它。</p><p id="55a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您对脚本执行的快速视频演示感兴趣，请查看:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pf pg l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自<a class="ae kv" href="https://cloud.google.com/community/tutorials/dlp-to-datacatalog-tags" rel="noopener ugc nofollow" target="_blank"> dlp到数据目录标签</a>的演示视频</p></figure><h2 id="a1d8" class="ol nf iq bd ng om ph dn nk oo pi dp no lf pj or nq lj pk ot ns ln pl ov nu ow bi translated">阅读大查询资源</h2><p id="0975" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">工作负载从读取来自Google Cloud项目的大查询资源开始，然后我们将大查询行分成许多块。我们需要这一点，因为DLP内容API有一个<a class="ae kv" href="https://cloud.google.com/dlp/limits" rel="noopener ugc nofollow" target="_blank">使用限制</a>，这也是奇迹发生的地方。</p><h2 id="e968" class="ol nf iq bd ng om ph dn nk oo pi dp no lf pj or nq lj pk ot ns ln pl ov nu ow bi translated">呼叫DLP</h2><p id="6841" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">对于DLP使用限制，我们可以将其分为两类:</p><ul class=""><li id="9992" class="mj mk iq ky b kz la lc ld lf ml lj mm ln mn lr pm mp mq mr bi translated"><strong class="ky ir">请求大小</strong></li></ul><p id="049f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们需要确保请求大小不超过使用限制，在撰写本文时，我们得到了以下值:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/7356778d835237ab4435519d6296e5eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*FHzD4zwKtb5IesUt3mZp_A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示来自<a class="ae kv" href="https://github.com/GoogleCloudPlatform/community/blob/3ab1721969929ea18735a77fa84bc3283153cc65/tutorials/dlp-to-datacatalog-tags/src/main/java/com/example/dlp/DlpDataCatalogTagsTutorial.java" rel="noopener ugc nofollow" target="_blank">DlpDataCatalogTagsTutorial.java</a>的请求大小限制的代码</p></figure><ul class=""><li id="b861" class="mj mk iq ky b kz la lc ld lf ml lj mm ln mn lr pm mp mq mr bi translated"><strong class="ky ir">每分钟请求数</strong></li></ul><p id="21d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二，每分钟有一个请求强制限制，所以我们添加了简单的睡眠和重试逻辑:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi po"><img src="../Images/13309a7fdc17aa7ab636086568f85e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*T_IXQfDByhY_D-RCi4OU8A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示来自<a class="ae kv" href="https://github.com/GoogleCloudPlatform/community/blob/3ab1721969929ea18735a77fa84bc3283153cc65/tutorials/dlp-to-datacatalog-tags/src/main/java/com/example/dlp/DlpDataCatalogTagsTutorial.java" rel="noopener ugc nofollow" target="_blank">DlpDataCatalogTagsTutorial.java</a>的睡眠逻辑的代码</p></figure><h2 id="687f" class="ol nf iq bd ng om ph dn nk oo pi dp no lf pj or nq lj pk ot ns ln pl ov nu ow bi translated">DLP检查模板</h2><p id="d5aa" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">接下来，为了调用DLP，我们将使用<a class="ae kv" href="https://cloud.google.com/dlp/docs/creating-templates-inspect" rel="noopener ugc nofollow" target="_blank"> DLP Inspect模板</a>，它们对于解耦配置信息非常有用。在这个用例中，我们使用它来存储我们的<code class="fe pb pc pd pe b">infoTypes</code>:</p><div class="kg kh ki kj gt ab cb"><figure class="pp kk pq pr ps pt pu paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/ca1906234c84cc767af14b4a0838236f.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*L6JmbpzT7oXvkjRdtoLL3A.png"/></div></figure><figure class="pp kk pv pr ps pt pu paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/0e7f64fea67ac0251b340327bee4c305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*iHAd0Zrf21fDQBMYYBG4CQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk pw di px py translated">DLP检查来自<a class="ae kv" href="https://cloud.google.com/community/tutorials/dlp-to-datacatalog-tags" rel="noopener ugc nofollow" target="_blank">DLP-to-data catalog-tags</a>的模板</p></figure></div><blockquote class="mx my mz"><p id="32d0" class="kw kx na ky b kz la jr lb lc ld ju le nb lg lh li nc lk ll lm nd lo lp lq lr ij bi translated">云数据丢失防护(DLP)使用信息类型或<code class="fe pb pc pd pe b">infoTypes</code>来定义它扫描的内容。<code class="fe pb pc pd pe b">infoType</code>是一种敏感数据，如姓名、电子邮件地址、电话号码、身份证号或信用卡号。</p></blockquote><p id="1c5b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们创建检查请求:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/907926e543c582dbb15900817d69f356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*iVfEoBEwZ2cN_JYdhk-T_g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示来自DlpDataCatalogTagsTutorial.java<a class="ae kv" href="https://github.com/GoogleCloudPlatform/community/blob/3ab1721969929ea18735a77fa84bc3283153cc65/tutorials/dlp-to-datacatalog-tags/src/main/java/com/example/dlp/DlpDataCatalogTagsTutorial.java" rel="noopener ugc nofollow" target="_blank">的检查内容逻辑的代码</a></p></figure><h2 id="46a9" class="ol nf iq bd ng om ph dn nk oo pi dp no lf pj or nq lj pk ot ns ln pl ov nu ow bi translated">写入数据目录列标记</h2><p id="2546" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">一旦我们从DLP获得检查结果，我们需要将它们转换成数据目录标记，我们从检索列名开始:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/a8ffd00a01afc851ffb76e948071b590.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*sa8VncVm7Nw99OKppQUEFg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示从DlpDataCatalogTagsTutorial.java<a class="ae kv" href="https://github.com/GoogleCloudPlatform/community/blob/3ab1721969929ea18735a77fa84bc3283153cc65/tutorials/dlp-to-datacatalog-tags/src/main/java/com/example/dlp/DlpDataCatalogTagsTutorial.java" rel="noopener ugc nofollow" target="_blank">检索列逻辑的代码</a></p></figure><p id="3be2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们设置数据目录<a class="ae kv" href="https://cloud.google.com/data-catalog/docs/quickstart-tagging#create_a_tag_template_and_attach_the_tag_to_your_table" rel="noopener ugc nofollow" target="_blank">标签模板</a>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qb"><img src="../Images/1d2e0aed1d14593998d495077d18a409.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*htJyeKeTg3CouS845hezYA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示从<a class="ae kv" href="https://github.com/GoogleCloudPlatform/community/blob/3ab1721969929ea18735a77fa84bc3283153cc65/tutorials/dlp-to-datacatalog-tags/src/main/java/com/example/dlp/DlpDataCatalogTagsTutorial.java" rel="noopener ugc nofollow" target="_blank">DlpDataCatalogTagsTutorial.java</a>创建模板逻辑的代码</p></figure><p id="a193" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还记得我们在标签心智模型中看到的大查询条目吗？我们需要构建条目<code class="fe pb pc pd pe b">linkedResource</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qc"><img src="../Images/3093144228731a8db13a0ba2a08dabe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*jnzDHPw128KhAvGjqoQc1A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示来自<a class="ae kv" href="https://github.com/GoogleCloudPlatform/community/blob/3ab1721969929ea18735a77fa84bc3283153cc65/tutorials/dlp-to-datacatalog-tags/src/main/java/com/example/dlp/DlpDataCatalogTagsTutorial.java" rel="noopener ugc nofollow" target="_blank">DlpDataCatalogTagsTutorial.java</a>的链接资源逻辑的代码</p></figure><p id="ca03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们创建标签请求:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qd"><img src="../Images/9b67bf74918fea2af9f8e1158dd6115c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*4HJJv55CmzfUUohP7sM4xw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示来自<a class="ae kv" href="https://github.com/GoogleCloudPlatform/community/blob/3ab1721969929ea18735a77fa84bc3283153cc65/tutorials/dlp-to-datacatalog-tags/src/main/java/com/example/dlp/DlpDataCatalogTagsTutorial.java" rel="noopener ugc nofollow" target="_blank">DlpDataCatalogTagsTutorial.java</a>的标签创建逻辑的代码</p></figure><p id="047f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">等一下！<code class="fe pb pc pd pe b">datacatalogBatchClient</code>？请注意，以编程方式访问Google Cloud APIs的推荐方式是使用<a class="ae kv" href="https://cloud.google.com/apis/docs/client-libraries-explained#google_cloud_client_libraries" rel="noopener ugc nofollow" target="_blank">客户端库</a>，在我们的例子中，我们要处理大量的标签，因此为了提高性能，我们正在批处理这些API调用。</p><blockquote class="mx my mz"><p id="6dda" class="kw kx na ky b kz la jr lb lc ld ju le nb lg lh li nc lk ll lm nd lo lp lq lr ij bi translated">关于其工作的更多细节，请看一下<a class="ae kv" href="https://github.com/GoogleCloudPlatform/community/blob/3ab1721969929ea18735a77fa84bc3283153cc65/tutorials/dlp-to-datacatalog-tags/src/main/java/com/example/dlp/DataCatalogBatchClient.java" rel="noopener ugc nofollow" target="_blank"> DataCatalogBatchClient </a>。</p></blockquote><h1 id="5819" class="ne nf iq bd ng nh qe nj nk nl qf nn no jw qg jx nq jz qh ka ns kc qi kd nu nv bi translated">脚本执行演练</h1><p id="244a" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">如果你已经到了这一步并且喜欢冒险，你可以执行运行<a class="ae kv" href="https://cloud.google.com/shell/docs/walkthroughs" rel="noopener ugc nofollow" target="_blank">云壳教程</a>的脚本，我已经自动完成了它的每一步，如果你想试试的话:</p><div class="qj qk gp gr ql qm"><a href="https://github.com/mesmacosta/dlp-to-datacatalog-tags-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="qn ab fo"><div class="qo ab qp cl cj qq"><h2 class="bd ir gy z fp qr fr fs qs fu fw ip bi translated">mesma Costa/DLP-to-data catalog-tags-教程</h2><div class="qt l"><h3 class="bd b gy z fp qr fr fs qs fu fw dk translated">它将指导您使用DLP结果创建数据目录标记。它比…的内容更广泛</h3></div><div class="qu l"><p class="bd b dl z fp qr fr fs qs fu fw dk translated">github.com</p></div></div><div class="qv l"><div class="qw l qx qy qz qv ra kp qm"/></div></div></a></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://console.cloud.google.com/cloudshell/open?git_repo=https://github.com/mesmacosta/dlp-to-datacatalog-tags-tutorial&amp;tutorial=TUTORIAL.md"><div class="gh gi rb"><img src="../Images/d0efc770430486f2201bb2c7f337327d.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*SvTkWblB7wtrLBzCcm0mhQ.png"/></div></a></figure><blockquote class="mx my mz"><p id="4983" class="kw kx na ky b kz la jr lb lc ld ju le nb lg lh li nc lk ll lm nd lo lp lq lr ij bi translated">我将跳过<strong class="ky ir">启用必需的API</strong>和<strong class="ky ir">设置您的服务帐户</strong>步骤，因为它们是常见的用例——完整的演练，请查看上面的GitHub库。</p></blockquote><h2 id="6cf7" class="ol nf iq bd ng om ph dn nk oo pi dp no lf pj or nq lj pk ot ns ln pl ov nu ow bi translated">创建大型查询表</h2><p id="3bea" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">首先，我们用假的<a class="ae kv" href="https://en.wikipedia.org/wiki/Personal_data" rel="noopener ugc nofollow" target="_blank"> PII </a>创建一些大的查询资源，以便稍后运行脚本。</p><pre class="kg kh ki kj gt rc pe rd re aw rf bi"><span id="b12e" class="ol nf iq pe b gy rg rh l ri rj"># Install bq-fake-pii-table-creator using PIP<br/>pip3 install bq-fake-pii-table-creator --user</span><span id="d9d7" class="ol nf iq pe b gy rk rh l ri rj"># Create the first table<br/>bq-fake-pii-table-creator --project-id $PROJECT_ID --bq-dataset-name dlp_to_datacatalog_tutorial --num-rows 5000</span><span id="9eeb" class="ol nf iq pe b gy rk rh l ri rj"># Create a second table<br/>bq-fake-pii-table-creator --project-id $PROJECT_ID --bq-dataset-name dlp_to_datacatalog_tutorial --num-rows 5000</span><span id="4fe4" class="ol nf iq pe b gy rk rh l ri rj"># Create a third table with obfuscated column names<br/>bq-fake-pii-table-creator --project-id $PROJECT_ID --bq-dataset-name dlp_to_datacatalog_tutorial --num-rows 5000 --obfuscate-col-names true</span></pre><h2 id="7850" class="ol nf iq bd ng om ph dn nk oo pi dp no lf pj or nq lj pk ot ns ln pl ov nu ow bi translated">创建检查模板</h2><p id="6244" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">其次，我们创建检查模板:</p><pre class="kg kh ki kj gt rc pe rd re aw rf bi"><span id="6caf" class="ol nf iq pe b gy rg rh l ri rj"># Generate your OAUTH 2.0 token with gcloud<br/>TOKEN=$(gcloud auth activate-service-account --key-file=$HOME/credentials/dlp-to-datacatalog-tags-sa.json &amp;&amp; gcloud auth print-access-token)</span><span id="f88a" class="ol nf iq pe b gy rk rh l ri rj"># Call API using Curl<br/>curl -X POST \  <a class="ae kv" href="https://dlp.googleapis.com/v2/projects/$PROJECT_ID/inspectTemplates" rel="noopener ugc nofollow" target="_blank">https://dlp.googleapis.com/v2/projects/$PROJECT_ID/inspectTemplates</a> \<br/>  -H "Authorization: Bearer ${TOKEN}" \<br/>  -H 'Content-Type: application/json' \<br/>  -d '{<br/>  "inspectTemplate":{<br/>    "displayName":"DLP 2 Datacatalog inspection Template",<br/>    "description":"Scans Sensitive Data on Data Sources",<br/>    "inspectConfig":{<br/>      "infoTypes":[<br/>        {<br/>          "name":"CREDIT_CARD_NUMBER"<br/>        },<br/>        {<br/>          "name":"EMAIL_ADDRESS"<br/>        },<br/>        {<br/>          "name":"FIRST_NAME"<br/>        },<br/>        {<br/>          "name":"IP_ADDRESS"<br/>        },<br/>        {<br/>          "name":"MAC_ADDRESS"<br/>        },<br/>        {<br/>          "name":"PHONE_NUMBER"<br/>        },<br/>        {<br/>          "name":"PASSPORT"<br/>        }<br/>      ],<br/>      "minLikelihood":"POSSIBLE",<br/>      "includeQuote":false<br/>    }<br/>  },<br/>  "templateId": "dlp-to-datacatalog-template"<br/>}'</span></pre><blockquote class="mx my mz"><p id="705f" class="kw kx na ky b kz la jr lb lc ld ju le nb lg lh li nc lk ll lm nd lo lp lq lr ij bi translated">在撰写本文时，<a class="ae kv" href="https://cloud.google.com/sdk/gcloud" rel="noopener ugc nofollow" target="_blank"> gcloud </a>不支持create inspect template API调用，所以我们使用的是<a class="ae kv" href="https://curl.haxx.se/" rel="noopener ugc nofollow" target="_blank"> Curl </a>。</p></blockquote><p id="d1d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在API调用中设置了一个DLP信息类型的预定义列表，您可以使用作为参考:<a class="ae kv" href="https://cloud.google.com/dlp/docs/infotypes-reference" rel="noopener ugc nofollow" target="_blank">内置信息类型</a>或通过创建自定义类型来更改它或添加新类型。</p><h1 id="56c8" class="ne nf iq bd ng nh qe nj nk nl qf nn no jw qg jx nq jz qh ka ns kc qi kd nu nv bi translated">执行脚本</h1><p id="e9d9" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">关于CLI参数的完整细节，以及如何构建下面的脚本，请查看<a class="ae kv" href="https://cloud.google.com/community/tutorials/dlp-to-datacatalog-tags" rel="noopener ugc nofollow" target="_blank">社区教程</a>。</p><pre class="kg kh ki kj gt rc pe rd re aw rf bi"><span id="f764" class="ol nf iq pe b gy rg rh l ri rj">java -cp target/dlp-to-datacatalog-tags-0.1-jar-with-dependencies.jar com.example.dlp.DlpDataCatalogTagsTutorial \<br/>-dbType "bigquery" \<br/>-limitMax 1000 \<br/>-dbName dlp_to_datacatalog_tutorial \<br/>-projectId $PROJECT_ID \<br/>-threadPoolSize 5 \<br/>-inspectTemplate "projects/$PROJECT_ID/inspectTemplates/dlp-to-datacatalog-template" \<br/>-minThreshold 100</span></pre><p id="0144" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这次执行中，我们只扫描了<code class="fe pb pc pd pe b">dlp_to_datacatalog_tutorial</code>数据集，用5个<code class="fe pb pc pd pe b">threads</code>运行，并使用我们之前创建的<code class="fe pb pc pd pe b">dlp-to-datacatalog-template</code>。</p><p id="e3fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们运行它并检查结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi rl"><img src="../Images/8f8ff71d8aa0a23b21c0d9f1f8f790be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8vp4NgqfkBqU5xR8x9EXyQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">脚本执行</p></figure><p id="f65b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">脚本完成后，我们可以去<a class="ae kv" href="https://console.cloud.google.com/datacatalog" rel="noopener ugc nofollow" target="_blank">数据目录</a>验证敏感数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi rm"><img src="../Images/c52dfaa4a216e4be00da805c26f92cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3QuFYoRTANFE9yiDs4abJQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据目录条目—模式和列标记</p></figure><p id="3231" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第一个表中，通过查看列名，可以清楚地看到我们拥有哪种敏感数据。无论如何，通过标记这些列，我们能够轻松地搜索我们的敏感数据。</p><p id="32f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你还记得那个愤怒的审计员敲你的门吗？</p><p id="c3b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，如果他来问我们，如果你存储任何PII，如信用卡号码…我们只是在数据目录中做一个简单的查询！我们甚至可以使用<a class="ae kv" href="https://cloud.google.com/iam" rel="noopener ugc nofollow" target="_blank"> IAM </a>并给他<code class="fe pb pc pd pe b">Data Catalog Viewer</code>角色，这样他就可以自己看，省去了我们的拜访。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi rn"><img src="../Images/ed05de795ea50eeabcad8fd4f1ea8997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RlSUEOJAjSctx34IGycOlA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">寻找信用卡号码的数据目录搜索</p></figure><p id="6d08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">玩笑归玩笑，数据目录<a class="ae kv" href="https://cloud.google.com/data-catalog/docs/how-to/search-reference" rel="noopener ugc nofollow" target="_blank">搜索语法</a>真的很强大，由支持Gmail和Drive的谷歌搜索技术驱动。所以检查他们的文档，看看所有的可能性。</p><p id="6b52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您还记得那个带有混乱的列名的表格吗:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ro"><img src="../Images/0ecee72e33b0daaa5a714f5826bac4c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*moBEX_RNfMAPdf1p4RPoig.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据目录条目—模式和列标记</p></figure><p id="5531" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">DLP来救援了！我们可以看到，我们标记了一些列，通过展开标记详细信息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi rp"><img src="../Images/9deab9552213ad75f086bf700802d21f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZUVDf0m882zHLTjrlJmnHA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据目录标签详细信息</p></figure><p id="606a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的天啊。DLP在那个列上找到303 <code class="fe pb pc pd pe b">CREDIT_CARD_NUMBERS</code>，有1000行样本，<strong class="ky ir">感谢DLP </strong>！</p><h1 id="86ee" class="ne nf iq bd ng nh qe nj nk nl qf nn no jw qg jx nq jz qh ka ns kc qi kd nu nv bi translated">结束语</h1><p id="a8da" class="pw-post-body-paragraph kw kx iq ky b kz nw jr lb lc nx ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">在本文中，我们看到了如何结合数据目录和DLP来发现Google Cloud项目中的敏感数据。</p><p id="22fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着GPDR、CCPA和其他监管法案成为现实，现在拥有一个结构化数据治理流程比以往任何时候都更加重要，该流程允许您了解您的公司存储了哪些数据、数据位于何处以及业务如何受到这些数据的影响。</p><p id="7efb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个领域，总是有改进的空间，如果我们可以扩展这个脚本，在发现敏感数据时自动阻止对敏感数据的访问，会怎么样？这当然是可能的，通过使用数据目录<a class="ae kv" href="https://cloud.google.com/bigquery/docs/column-level-security" rel="noopener ugc nofollow" target="_blank">策略标签</a>，所以请继续关注新的帖子，讨论这个问题！干杯！</p><h1 id="04c1" class="ne nf iq bd ng nh qe nj nk nl qf nn no jw qg jx nq jz qh ka ns kc qi kd nu nv bi translated">参考</h1><ul class=""><li id="0a11" class="mj mk iq ky b kz nw lc nx lf rq lj rr ln rs lr pm mp mq mr bi translated"><strong class="ky ir"> DLP文件</strong>:<a class="ae kv" href="https://cloud.google.com/dlp/" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/dlp</a></li><li id="7b60" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr pm mp mq mr bi translated"><strong class="ky ir">数据目录文档</strong>:<a class="ae kv" href="https://cloud.google.com/data-catalog" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/data-catalog</a></li><li id="a6c5" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr pm mp mq mr bi translated"><strong class="ky ir"> DLP转数据目录标签演练教程</strong>:<a class="ae kv" href="https://github.com/mesmacosta/dlp-to-datacatalog-tags-tutorial" rel="noopener ugc nofollow" target="_blank">https://github . com/mes macosta/DLP转数据目录标签教程</a></li><li id="9729" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr pm mp mq mr bi translated"><strong class="ky ir">社区博客教程</strong>:<a class="ae kv" href="https://cloud.google.com/community/tutorials/dlp-to-datacatalog-tags" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/Community/tutorials/DLP-to-data catalog-tags</a></li></ul></div></div>    
</body>
</html>