<html>
<head>
<title>How to convert DB2 queries to python scripts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将 DB2 查询转换成 python 脚本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-convert-db2-queries-to-python-scripts-f46960ed8df9?source=collection_archive---------29-----------------------#2020-08-16">https://towardsdatascience.com/how-to-convert-db2-queries-to-python-scripts-f46960ed8df9?source=collection_archive---------29-----------------------#2020-08-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="97a1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">提供一个简单的 3 步模板来提升技能并过渡到 python</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/205f8cc0beb76ba11bbfecb25a4f922b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T1tAElaHDl_mwUOSvdguTw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯蒂娜@ wocintechchat.com 在<a class="ae ky" href="https://unsplash.com/s/photos/server?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="ce1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多公司正在使用 python 脚本运行常见的数据分析任务。他们要求员工将目前可能存在于 SAS 或其他工具集中的脚本转换为 python。这个过程的一个步骤是能够用新技术获取相同的数据。本文是关于将 DB2 查询转换成 python 脚本的。</p><p id="3e64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如何将查询转换成 python？这听起来很难，但比你想象的要简单。一旦有了数据源的模板，您需要做的就是更改查询和输出文件名。</p><p id="e47e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有几种方法可以做到这一点，但是我将概述一个直观的模板，它允许您在本地笔记本电脑/台式机上运行 DB2 查询。</p><h2 id="4256" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">在 DiscoDonuts 使用您的 DB2 专业知识</h2><p id="d4cc" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">让我们假设你在一家大型甜甜圈公司工作，DiscoDonuts。您需要对 DB2 运行以下查询。通常，您可能会使用 DataStudio 之类的工具。很简单。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="77d9" class="lv lw it mu b gy my mz l na nb">SELECT store_id, donut_style, date, volume, net_sales<br/> FROM donutsdb.sales_data <br/> WHERE date = '2020-08-16'<br/> WITH UR;</span></pre><p id="b26b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您的经理要求您开始使用 python。深呼吸；没那么难。在设置好代码之后，您只需要更新两个字段，输出文件的名称和查询本身。然后你点击运行。这有多简单？</p><h2 id="5534" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">初始一次性设置</h2><p id="30f5" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果您还没有，您需要联系您的 IT 部门安装一个工具(“IDE”)(如 PyCharm、VSCode、Jupyter Notebooks)。</p><p id="0486" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要连接到 DB2，您需要输入您自己公司的数据库、主机名和端口 id。最有可能的是，您在当前使用的任何工具中都已经有了这些信息。</p><h2 id="b3fe" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">模板</h2><p id="ac94" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">首先，填写数据库连接信息。现在你可以保存这个模板，以备不时之需。</p><p id="95c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于您想要运行的每个查询，您需要更新输出文件名和实际的查询本身。该查询被传递给 DB2，因此它与您已经在使用的 DB2 格式相同。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0d94" class="lv lw it mu b gy my mz l na nb">import ibm_db<br/>import ibm_db_dbi<br/>import pandas as pd</span><span id="e6bf" class="lv lw it mu b gy nc mz l na nb"># name your output file (and path if needed)<br/>output_filename = "donut_sales.csv"</span><span id="8172" class="lv lw it mu b gy nc mz l na nb"># enter your query between the triple quotes<br/>query = """ SELECT store_id, donut_style, date, volume, net_sales<br/> FROM donutsdb.sales_data <br/> WHERE date = '2020-08-16'<br/> WITH UR; <br/> """</span><span id="4d63" class="lv lw it mu b gy nc mz l na nb"># one way to do credentialing<br/>import getpass as gp                                     <br/>uid=input('Enter uid:   ')                                                  <br/>pwd=gp.getpass('Enter password (hidden): ')</span><span id="b708" class="lv lw it mu b gy nc mz l na nb"># connect to your database<br/>db = (<br/>    "DRIVER = {IBM DB2 ODBC DRIVER - DB2COPY1};"<br/>    "DATABASE=&lt;your donut database&gt;;"<br/>    "HOSTNAME=&lt;your db2 hostname&gt;;"<br/>    "PORT=&lt;your db2 port ####&gt;;"<br/>    "PROTOCAL=TCPIP;"<br/>    'UID='+uid+';'<br/>    'PWD='+pwd+';')<br/>ibm_db_conn = ibm_db.connect(db, "", "")<br/>pconn = ibm_db_dbi.Connection(ibm_db_conn)</span><span id="2983" class="lv lw it mu b gy nc mz l na nb">#optional if you are using the accelerator #ibm_db.exec_immediate(ibm_db_conn, "SET CURRENT QUERY ACCELERATION = ALL") </span><span id="197e" class="lv lw it mu b gy nc mz l na nb">df = pd.read_sql(query, pconn)<br/>df.to_csv(output_filename,index=False)</span></pre><p id="57a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击运行。您将被要求输入您的凭证，您的查询将在 DB2 上运行，数据将被传输回您的脚本，您的文件将被创建！</p><p id="3608" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您愿意，所创建的数据框可作为您的数据在 python 脚本中进行进一步分析。</p><h2 id="6749" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">下一个查询的三个步骤</h2><ol class=""><li id="3b77" class="nd ne it lb b lc mo lf mp li nf lm ng lq nh lu ni nj nk nl bi translated">更新您的输出文件名</li><li id="d3f4" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">更新您的查询</li><li id="dc71" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">点击运行！</li></ol><h2 id="853f" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结论</h2><p id="dbd1" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">将 DB2 SQL 知识转移到 python 并不困难。这是一项很好的技能，可以与他人分享。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><p id="7aab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我总是欢迎反馈。如果你有另一种技巧，请在回复中分享。解决问题的方法有很多，我只介绍了其中一种。代码是不断发展的，所以今天有效的可能明天就无效了。</p></div></div>    
</body>
</html>