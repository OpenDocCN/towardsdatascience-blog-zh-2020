<html>
<head>
<title>PyMC3 and Bayesian Inference Towards Non-Linear Models: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">非线性模型的PyMC3和贝叶斯推理:第一部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pymc3-and-bayesian-inference-for-parameter-uncertainty-quantification-towards-non-linear-models-d1d50250f16a?source=collection_archive---------24-----------------------#2020-06-04">https://towardsdatascience.com/pymc3-and-bayesian-inference-for-parameter-uncertainty-quantification-towards-non-linear-models-d1d50250f16a?source=collection_archive---------24-----------------------#2020-06-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a372" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">参数和模型不确定性量化</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/32a0c5ef6700f12f1992a166b645c1fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SlGt6ph9wtK3ETYHPtp-Tw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">不确定的世界(作者图片)</p></figure></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><p id="af5d" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">像Stan这样的概率编程语言已经为科学家和工程师提供了进入贝叶斯统计世界的便利手段。作为一个熟悉Python编程的人，我一直在努力寻找完美的贝叶斯库来补充Python美妙而简洁的语法。</p><p id="d6fc" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">学习新材料和新图书馆的最大挑战之一是找到足够的资源和例子。我找不到一篇关于使用Python和贝叶斯推理对非线性模型进行参数和模型不确定性量化(UQ)的文章。因此，我希望这篇文章能帮助其他人将这些方法应用到他们自己的研究或工作中。</p><p id="e10c" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">这将是一篇由两部分组成的文章，目的是让更多的读者能够阅读它，同时也让浏览和阅读文章变得更加容易。</p><p id="136a" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">第1部分将快速讨论贝叶斯推理的两个公共库:PyStan和PyMC3。我们还将建立一个非线性函数用于贝叶斯推理。这将包括通过SciPy库进行参数优化。我们将使用最佳参数作为我们贝叶斯推理的起点，并检查我们的贝叶斯方法。如果你已经熟悉了参数优化，可以直接跳到<a class="ae ly" href="https://medium.com/p/a03c3303e6fa/edit" rel="noopener">第2部分</a>中的PyMC3部分。</p><p id="ced5" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">第2部分是我们开始使用PyMC3并深入研究语法和结果的地方。为了验证，我们还将看到贝叶斯方法如何与频率主义方法进行参数不确定性量化的比较。</p><p id="b9fe" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我不打算对Baye定理和整个贝叶斯框架进行过多的推测，有大量关于Medium的文章可以满足您的好奇心。本文的主要成果是让读者了解如何利用PyMC3来量化线性模型(尤其是非线性模型)中使用的参数和模型的不确定性。Jupyter笔记本可以在<a class="ae ly" href="https://github.com/adamcwatts/Statistic_and_Data_Science_Examples/blob/master/PyMC3/Newton_Bayesian.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="0e9d" class="lz ma iq bd mb mc md dn me mf mg dp mh ll mi mj mk lp ml mm mn lt mo mp mq mr bi translated">PyStan</h2><p id="f04c" class="pw-post-body-paragraph lc ld iq le b lf ms jr lh li mt ju lk ll mu ln lo lp mv lr ls lt mw lv lw lx ij bi translated">Stan以PyStan的形式提供给Python，但是语法相当令人不快。让我们看一个在PyStan中创建模型的例子，这个模型被分配给一个string类型的变量。然后这个模型会在PyStan的帮助下编译成C++。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="e9e9" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">上面是一个简单的二次模型示例，它有两个参数，α和β，响应为y。当开始使用更复杂的模型时，该模型非常冗长，很难调试。肯定有更Pythonic化的东西…</p><h1 id="ef0f" class="mz ma iq bd mb na nb nc me nd ne nf mh jw ng jx mk jz nh ka mn kc ni kd mq nj bi translated"><strong class="ak"> <em class="nk"> PyMC3 </em> </strong></h1><p id="6c47" class="pw-post-body-paragraph lc ld iq le b lf ms jr lh li mt ju lk ll mu ln lo lp mv lr ls lt mw lv lw lx ij bi translated">我相信PyMC3对于刚进入Python概率编程领域的人来说是一个完美的库。PyMC3使用原生Python语法，使得调试更容易，也更直观。让我们深入一个例子，看看这个库的威力。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们将使用的库</p></figure><p id="9612" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">在这个例子中，我将使用一个简单的非线性方程的日常例子，希望这些概念更容易理解和记忆。</p><p id="ed96" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">让我们从利用牛顿冷却定律来冷却一个热物体开始。我们假设物体中不存在热梯度(集总电容)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b33072077b839788ad70bbc73d16bed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2mt6gVUtGK4I1YXZQt1HA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">让我们假设热物体是一种饮料(图片由作者提供)</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/165b5f0db179dac794cafaa1e6c36378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a0x9eiPzdJfeoJabK-1Q7w.png"/></div></div></figure><p id="1f4f" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">对于那些对常微分方程(ODE)生疏的人来说，不用担心。解决方法如下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/c745066a1858ceb987cf34ab6e2fba77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-MNJSeyiZwbTqh5-HQtmw.png"/></div></div></figure><p id="1968" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">T(t)表示在给定时间t饮料的温度。τ是我们感兴趣的参数，它决定了这个问题的冷却速率。T_env是我们的环境温度，T_0是t=0时饮料的温度。我们假设T_env不随时间变化。</p><p id="78f8" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">在Python中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="7c3d" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">让我们也假设我们提前知道，<em class="nn">先验</em>，环境温度是30摄氏度，物体开始于100摄氏度。最后，我们假设未知参数τ=15。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/c0e83fe97291147cd06765a68adf9381.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BCXYzljv117_O0_Srwly3A.png"/></div></div></figure><p id="1c58" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们将首先绘制出热饮冷却的理论解，如蓝色实线所示。这里我们可以对方程和参数有一个直观的认识。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="66bb" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们还将生成一些带有人工噪声的数据来模拟现实生活中的数据，这里显示为红色散射点。我们将假设数据是<a class="ae ly" href="https://en.wikipedia.org/wiki/Independent_and_identically_distributed_random_variables" rel="noopener ugc nofollow" target="_blank"> IID </a>。饮料温度的响应是高斯型的，即T(t)~ N(μ，σ)。平均值μ将遵循上面的解。我们将很快解决从数据本身不知道τ的问题。响应中的标准偏差为σ=1.5。这就是我们如何产生假噪声的，我们也能够从数据中估计出来。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/2550b899498aeaafbbda0e8e2f11b1c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LIOR84RLPFYT6D9CpWCBAg.png"/></div></div></figure><p id="a271" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">根据这些模拟数据，我们想要估计冷却参数τ，并估计其值的不确定性。理想情况下，我们的估计参数和不确定性将封装真实值。同样，我们也希望模型标准误差中的不确定性包含σ。</p><p id="71fb" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">为了阐明术语“封装”的含义，假设我们估计一个参数γ= 100 ^ 10。我们希望真实参数在90–110的范围内，与100±10相同。</p><h2 id="666d" class="lz ma iq bd mb mc md dn me mf mg dp mh ll mi mj mk lp ml mm mn lt mo mp mq mr bi translated">优化:估计τ</h2><p id="6d2d" class="pw-post-body-paragraph lc ld iq le b lf ms jr lh li mt ju lk ll mu ln lo lp mv lr ls lt mw lv lw lx ij bi translated">在估算τ的不确定性之前，我们必须首先优化最符合数据的τ值。用更专业的术语来说，我们希望找到τ，使得残差平方和最小。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/8aad327026a326a3cd3a9b6764a0b10d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2oqaDbIzsZ4Fcl-3yU2n7A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">n是数据点的数量</p></figure><p id="9db9" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">其中括号左侧的函数是我们的数据，括号右侧的函数是我们的ODE的解。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="e003" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们发现τ_opt = 14.93，非常接近τ=15的真实参数的估计值。回到我们最初的问题，记住响应，饮料的温度，是高斯的，即T(t)~ N(μ，σ)。我们终于有了τ的估计，我们可以检验正态性。</p><p id="4d2f" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">请记住，如果我们的响应来自高斯分布，那么我们的残差(数据减去预测)也必须是高斯分布。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="d3f7" class="lz ma iq ns b gy nw nx l ny nz">residuals = T_data -  newton_cooling(tau_opt, T_0, T_env, time_data)</span></pre><p id="ad3d" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">想一想，线性变换，或者更基本的，Z值的变化。</p><p id="9c16" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">残差，o =数据和我们的模型之间的差异，看起来很大，平均值大约为0。它们看起来是随机的，同质的，大部分数据在两条红色虚线之间。</p><p id="4ff1" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">让我们看看我们是如何估算σ的</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="1832" class="lz ma iq ns b gy nw nx l ny nz">sigma_error_square = (1/(len(time_data)-1))*ss_min<br/>sigma_error = np.sqrt(sigma_error_square)<br/>print(sigma_error)</span></pre><p id="21b1" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们发现σ的估计值是1.42，非常接近1.5</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/50066fd5b15c9547cf53ec180fa8c06a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WyGPQGPqtHbtqX1NlfZZfg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">剩余剧情。两条红色虚线代表0 1.96*σ或95%的数据。</p></figure></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><h2 id="aa75" class="lz ma iq bd mb mc md dn me mf mg dp mh ll mi mj mk lp ml mm mn lt mo mp mq mr bi translated">不确定性量化</h2><p id="aec1" class="pw-post-body-paragraph lc ld iq le b lf ms jr lh li mt ju lk ll mu ln lo lp mv lr ls lt mw lv lw lx ij bi translated">如果你还和我在一起，太好了！现在我们已经有了τ和σ的估计值，我们终于可以开始研究贝叶斯统计和PyMC3了。点击查看该系列<a class="ae ly" href="https://medium.com/@aldburg/pymc3-and-bayesian-inference-for-parameter-uncertainty-quantification-towards-non-linear-models-a03c3303e6fa" rel="noopener">的第二部分。</a></p></div></div>    
</body>
</html>