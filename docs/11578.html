<html>
<head>
<title>Power Query tips for every Power BI Developer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向每位 Power BI 开发人员的 Power 查询技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/power-query-tips-for-every-power-bi-developer-da9ebd3dcd93?source=collection_archive---------28-----------------------#2020-08-11">https://towardsdatascience.com/power-query-tips-for-every-power-bi-developer-da9ebd3dcd93?source=collection_archive---------28-----------------------#2020-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6538" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用这些简单而强大的技术来加速您的 Power BI 开发</h2></div><p id="0285" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果有人让你定义幂查询，你该怎么说？如果您曾经使用过 Power BI，那么即使您没有意识到，也不可能没有使用过 Power Query。因此，可以很容易地说，权力质询是权力 BI 的<strong class="kk iu"><em class="le"/></strong></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/699253be9601733e683bf1f992c79f25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jl0n95sog0zz7fH0ZBxOBw.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">照片由 Amar Yashlaha 在 Unsplash 上拍摄</p></figure><p id="d264" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在更官方的措辞中，Power Query 是微软用于连接和转换来自多个来源的数据的技术。正如<a class="ae lv" href="https://docs.microsoft.com/en-us/power-query/power-query-what-is-power-query" rel="noopener ugc nofollow" target="_blank">微软的官方文档</a>所述，你可以连接到数百个不同的数据源，并对你的数据进行 300 多次转换。</p><p id="8b17" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Power Query 的关键优势在于，您只需很少或不需要任何编码技能就可以执行复杂的数据转换！此外，您在数据转换过程中应用的所有步骤都将被保存，因此每次刷新数据集时，这些步骤都将自动应用于形成您的数据，这是一种真正的时间节省。</p><p id="eceb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这 300 多种转换中，很难选择最有用的，但是我将分享我的与 Power Query(及其强大的 M 语言)相关的 3 个技巧。您还应该<a class="ae lv" rel="noopener" target="_blank" href="/5-tips-to-boost-your-power-bi-development-a44d7e782037">学习与电源查询无关的技巧，以促进电源 BI 开发</a>。</p><h2 id="2e8d" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">提示#1 —超级查询编辑器中的省时工具</h2><p id="1fe6" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">我需要立即说明:通过巧妙使用 Power Query Editor，您可以执行大量节省时间的操作，因此我将把我的建议缩小到我最常用的几个。</p><p id="290c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我敢打赌，您几乎每次为 Power BI 报告准备数据时都会遇到这种情况。您导入了一个包含许多列的宽表，并且需要删除其中的一些列。您从左向右滚动，选择要保留的列和要删除的列。</p><p id="975a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，有一种更复杂的方法可以实现这一点:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/4c744f89bc623339547c9f87f10bcd7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*4Q1lZ8BxAeIRQEFmKCzP8Q.gif"/></div></figure><p id="ed28" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如你在上面的插图中看到的，不需要费力的滚动，只需要打开选择列下拉菜单，选择选择列，然后选择你想要保留的列！太方便了！</p><p id="b22e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同一个下拉菜单下的另一个提示:选择 Go To Column，您将直接导航到该列，因此您可以对该特定列执行任何类型的转换，同样也不需要浪费时间试图在广泛的“30+列表”中找到它…</p><p id="df13" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一个隐藏的亮点是视图选项卡下的“查询依赖项”按钮。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/dff0501aa4c4d3dff0ebb1e79f669f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ix6YJgZTWSqricKD-5QVWg.png"/></div></div></figure><p id="22cc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这在处理复杂模型时非常有用，因为数据来自多个不同的来源，或者并非所有数据都加载到报表中。</p><p id="3e33" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用查询依赖项将使您快速直观地了解数据模型:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/150eb6734b29c51d8aa7bd324bbff1d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xZ-lI4_SpJk-lvDpRjyFdw.png"/></div></div></figure><p id="61b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不用点击数据模型中的每一个实体来检查其状态，您可以在一个地方得到所有这些，更好的是，它是可视化的！</p><p id="9154" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">想象一下，数据来自 CSV 文件、SQL Server 数据库和 Sharepoint 列表，而部分数据由于某种原因甚至没有加载到报告中。这是一个 huuuuge 时间节省！</p><h2 id="a895" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">技巧# 2——使用 M 语言执行频繁的计算</h2><p id="0b23" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">最常见的业务请求之一是计算不同事件之间的时差。例如，我想知道我的客户的年龄结构，所以我需要在每次数据刷新时计算他们的年龄。</p><p id="5475" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者，我需要检查客户延迟付款的天数。正如您所想的那样，这些数字需要动态计算，所以 M 语言来了！</p><p id="9346" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们演示一下如何计算客户的年龄。基本上，在 Power Query 中有两种方法可以实现这一点:第一种不需要任何编码，但需要应用多个步骤。所以，我更倾向于第二种方案，当你把整个计算一步到位！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/83b8fb5b5a1d9e7d55cb480fe776b66e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*rgJPr_hiETxzpuG8kHXi3Q.gif"/></div></figure><p id="ae24" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上述方法需要三个独立的步骤。首先，我们插入一个新列，并在日期下拉菜单中选择年龄选项。但是，Power Query 计算从出生日期到今天的天数。因此，我们需要将这个笨拙的数字转换为年，这是在 Duration 下拉菜单下选择 Total Years 来完成的。同样，我们得到了一个尴尬的结果，因为年龄显示为一个有多个小数位的十进制数(这是正确的，但不直观)。最后一步是向下舍入该数字，这是在舍入下执行的。</p><p id="041b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，这种方法没有任何问题，但是如果您正在进行多个计算，您的 Power Query Applied Steps 窗格将会被许多不必要的步骤所污染。</p><p id="5e43" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是为什么我更喜欢另一个选项:在“添加列”选项卡下，选择一个自定义列并输入以下公式:</p><pre class="lg lh li lj gt mw mx my mz aw na bi"><span id="8481" class="lw lx it mx b gy nb nc l nd ne">Number.RoundDown(Duration.TotalDays(Date.From(DateTime.LocalNow()) - [BirthDate])/365)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/2b4aa723b1f73a3eb31f947ff51517c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*984edtsZf-WutbKowrmsEA.png"/></div></div></figure><p id="4cb7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样，我们在一次运行中执行了先前版本的所有迭代，并且我们只应用了一个步骤！以更优雅的方式完成任务…</p><h2 id="3076" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">提示#3 —自定义弹性日期维度</h2><p id="a414" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">这张是我最喜欢的！首先，我想为此写一个单独的帖子，但最终，我决定把它放在这里，因为我已经写了关于正确处理日期维度的整个系列。</p><p id="8ea7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我不会花太多时间来解释拥有单独的日期维度的重要性(<a class="ae lv" rel="noopener" target="_blank" href="/tiq-part-1-how-to-destroy-your-power-bi-model-with-auto-date-time-8fec32b22aff">那是另一篇文章</a>的主题)——我只会简单地说:从技术上讲，Power BI 允许您在没有单独的日期维度的情况下“生存”，但不要这样做！只是不要…</p><p id="2c13" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在您的数据模型中创建单独的日期维度有<a class="ae lv" rel="noopener" target="_blank" href="/tiq-part-1-how-to-destroy-your-power-bi-model-with-auto-date-time-8fec32b22aff">多种解决方案，但是这里我将重点介绍使用 M 语言来实现这一点。</a></p><p id="c197" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">网上有很多现成的脚本来创建一个全功能的日期维度，但是我选择了来自雷扎·拉德的<a class="ae lv" href="https://radacad.com/create-a-date-dimension-in-power-bi-in-4-steps-step-1-calendar-columns" rel="noopener ugc nofollow" target="_blank">这个解决方案</a>(顺便说一下，在他的博客上你可以学到很多有用的东西)。</p><p id="4957" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">打开新的 Power BI 文件，并选择“获取数据”下的“空白查询”:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/a4f952790476ca6ea84872b0b060fe38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xuOrSpOQHQRvucMU8rXmbA.png"/></div></div></figure><p id="adc7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将引导您进入超级查询编辑器。为了获得高度定制的日期维度，下一步至关重要。</p><p id="4d25" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在“管理参数”下，选择“新参数”并将其格式化，如下图所示:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/36022e0ba75fc4b65b88cdaa858d16e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9I8VhizoU7ck-VwTKPmXSw.png"/></div></div></figure><p id="40ab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样，您就可以定义日期维度从哪一年开始。对年末做完全相同的操作:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/52ca7ed7845e78608987d8e64e164a7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k284AO7RYwl_fWykeIEL9g.png"/></div></div></figure><p id="2ba9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们已经定义了两个参数，我们可以切换到高级编辑器并粘贴整个 Reza 脚本来创建日期维度的特定列(当然，可以根据您的需要随意包含/排除更多的列)。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/456fc343b9d9d538512f4b04d5b85d5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mmAI4My1_XOVGLhMpatEEA.png"/></div></div></figure><p id="e053" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是整个脚本:</p><pre class="lg lh li lj gt mw mx my mz aw na bi"><span id="280f" class="lw lx it mx b gy nb nc l nd ne">let<br/>    StartDate = #date(StartYear,1,1),<br/>    EndDate = #date(EndYear,12,31),<br/>    NumberOfDays = Duration.Days( EndDate - StartDate ),<br/>    Dates = List.Dates(StartDate, NumberOfDays+1, #duration(1,0,0,0)),<br/>    #"Converted to Table" = Table.FromList(Dates, Splitter.SplitByNothing(), null, null, ExtraValues.Error),<br/>    #"Renamed Columns" = Table.RenameColumns(#"Converted to Table",{{"Column1", "FullDateAlternateKey"}}),<br/>    #"Changed Type" = Table.TransformColumnTypes(#"Renamed Columns",{{"FullDateAlternateKey", type date}}),<br/>    #"Inserted Year" = Table.AddColumn(#"Changed Type", "Year", each Date.Year([FullDateAlternateKey]), type number),<br/>    #"Inserted Month" = Table.AddColumn(#"Inserted Year", "Month", each Date.Month([FullDateAlternateKey]), type number),<br/>    #"Inserted Month Name" = Table.AddColumn(#"Inserted Month", "Month Name", each Date.MonthName([FullDateAlternateKey]), type text),<br/>    #"Inserted Quarter" = Table.AddColumn(#"Inserted Month Name", "Quarter", each Date.QuarterOfYear([FullDateAlternateKey]), type number),<br/>    #"Inserted Week of Year" = Table.AddColumn(#"Inserted Quarter", "Week of Year", each Date.WeekOfYear([FullDateAlternateKey]), type number),<br/>    #"Inserted Week of Month" = Table.AddColumn(#"Inserted Week of Year", "Week of Month", each Date.WeekOfMonth([FullDateAlternateKey]), type number),<br/>    #"Inserted Day" = Table.AddColumn(#"Inserted Week of Month", "Day", each Date.Day([FullDateAlternateKey]), type number),<br/>    #"Inserted Day of Week" = Table.AddColumn(#"Inserted Day", "Day of Week", each Date.DayOfWeek([FullDateAlternateKey]), type number),<br/>    #"Inserted Day of Year" = Table.AddColumn(#"Inserted Day of Week", "Day of Year", each Date.DayOfYear([FullDateAlternateKey]), type number),<br/>    #"Inserted Day Name" = Table.AddColumn(#"Inserted Day of Year", "Day Name", each Date.DayOfWeekName([FullDateAlternateKey]), type text)<br/>in<br/>    #"Inserted Day Name"</span></pre><p id="cc3c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">点击 Close &amp; Apply，现在我们的数据模型中就有了全功能的日期维度！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/0a7659df45d3ab9748d772b133354dbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aPIxRc_DidpJhpsUWEhRHA.png"/></div></div></figure><p id="b03f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以通过管理参数和切换年份值来轻松改变时间框架。</p><p id="4268" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在蛋糕上有冰块，作为额外的提示:把你的文件保存为。pbit (Power BI 模板文件)。这样，当您开始 Power BI 项目时，您不需要从头开始创建日期维度，浪费您的时间和精力—它已经为您准备好了！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/fc00b6f4931015cd8438b97dda6a9bca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AtAcMgRhaLUkLtrYkE8PjQ.png"/></div></div></figure><p id="6b96" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你还要吗？就在那里。打开模板文件后，系统会提示您输入起始年和结束年的值，这意味着您可以自定义报告之间的时间范围！多酷啊！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/8b3bf5d823a9eca4f041e337903dc467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HZWwLRofZhjMjtqzpuP03g.png"/></div></div></figure><p id="3578" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦您输入值，Power BI 将根据您定义的值自动为您创建日期维度！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/ed0c27849a76f2f6ae455164c78361da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AlqRJfjFGSRp6-8TCFa6oQ.png"/></div></div></figure><h2 id="fa3a" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">结论</h2><p id="b911" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">当涉及到数据检索，尤其是数据转换时，Power Query 提供了一系列的特性。描述它们需要一两本书，所以我想摘录其中几个，我认为它们在我日常使用 Power BI 的工作中最有用。</p><p id="e21b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你最喜欢的电量查询功能有哪些？欢迎在评论区分享它们。</p><p id="b7e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae lv" href="https://datamozart.medium.com/membership" rel="noopener">成为会员，阅读媒体上的每一个故事！</a></p><p id="53f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">订阅<a class="ae lv" href="http://eepurl.com/gOH8iP" rel="noopener ugc nofollow" target="_blank">这里</a>获取更多有见地的数据文章！</p></div></div>    
</body>
</html>