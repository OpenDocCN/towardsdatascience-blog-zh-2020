<html>
<head>
<title>Time Series Forecasting in Real Life: Budget forecasting with ARIMA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现实生活中的时间序列预测:用ARIMA进行预算预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-forecasting-in-real-life-budget-forecasting-with-arima-d5ec57e634cb?source=collection_archive---------3-----------------------#2020-01-31">https://towardsdatascience.com/time-series-forecasting-in-real-life-budget-forecasting-with-arima-d5ec57e634cb?source=collection_archive---------3-----------------------#2020-01-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b2c8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">关于如何使用ARIMA进行预测的深入示例</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c0431aeddb6d64529c47b6ff410f55a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pHGDsFygjdQsRylqMfuI_g.jpeg"/></div></div></figure><p id="d7f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们被可以用时间序列来描述的现象所包围。这是一种奇特的说法，许多事情或事件可以被描述为在某个时期发生的一系列观察结果。</p><p id="3b1a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这听起来仍然很复杂，所以这里有几个可以用时间序列表示的“事物”的例子</p><ul class=""><li id="dafa" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">股票价格</li><li id="f7b7" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">特定地区的天气状况</li><li id="43da" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">家庭用电量</li><li id="bbdc" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">心率监测</li><li id="2f43" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">商店的总销售额</li></ul><p id="99f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是时间序列不仅仅是随着时间推移而发生的事情。有几个因素造就了它们的现状:</p><ol class=""><li id="29c6" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm mb lt lu lv bi translated"><strong class="kt ir">趋势</strong>时间序列中的值是越来越高还是越来越低？</li><li id="e7f1" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm mb lt lu lv bi translated"><strong class="kt ir">季节性</strong>数据集中是否存在受季节影响的模式？例如，在线销售是在假期增加还是冰淇淋销售在夏天增加而在冬天减少？</li><li id="8381" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm mb lt lu lv bi translated"><strong class="kt ir">周期</strong>我们能看到独立于时间框架的某种变化模式吗？意义并不依附于某个季节。</li><li id="b53b" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm mb lt lu lv bi translated"><strong class="kt ir">不规则性</strong>还有哪些可能影响数据的随机因素？</li></ol><p id="71c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们了解这些组成部分，并有足够大的数据集，我们可以使用过去的观察，即历史数据，以及我们知道的关于时间序列的其他信息来预测它在未来的行为。比如天气预报，或者下个月的销量预测。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><p id="87ea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">新年决心是件大事，因为今年才刚刚开始，这是设定目标的最佳时机。</p><p id="14db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你的新年计划是更有理财意识，所以你决定制定一个月度预算。问题是，你不知道该在哪里划线。</p><p id="1a11" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当然，每月的开销并不总是恒定的，但有些模式可能会在一年中出现，比如在圣诞节期间和休假时花更多的钱。</p><p id="7720" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以把我们的月支出想象成一个时间序列，可以用时间来衡量。</p><p id="c08a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以你开始挖掘旧的银行对账单来创建你的支出数据集。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/4ef153ea2083e57bc39807222adc4ba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*3jZdyfZT_tTuihyPF3Qp0Q.png"/></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">美丽的虚拟数据</p></figure><p id="1fca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">厉害！一段时间内✅的每月费用✅值</p><p id="be8f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们预测一下！嗯…没那么快😁</p><h1 id="7959" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">慢下来，直到它停下来</h1><p id="bfcd" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">为了建立一个时间序列模型，一个可以用来预测未来值的模型，数据集需要是<a class="ae nl" href="https://en.wikipedia.org/wiki/Stationary_process" rel="noopener ugc nofollow" target="_blank">稳定的</a>。</p><p id="9867" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这意味着首先我们需要删除序列可能具有的任何趋势，这样数据集就具有以下属性:</p><ol class=""><li id="8fd5" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm mb lt lu lv bi translated"><strong class="kt ir">平均值为常数</strong></li><li id="3de8" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm mb lt lu lv bi translated"><strong class="kt ir">方差为常数</strong>，即时间序列中不同点的方差相同。这个性质通常被称为<a class="ae nl" href="https://en.wikipedia.org/wiki/Homoscedasticity" rel="noopener ugc nofollow" target="_blank">同质性</a></li><li id="7fa2" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm mb lt lu lv bi translated"><strong class="kt ir">两个数据点</strong>之间的自协方差<strong class="kt ir">不依赖于时间</strong>，一个在时间t1，另一个在时间t2。这些数据点之间的自协方差仅取决于t1和t2之间的差异</li></ol><h1 id="266b" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">我的时间序列是平稳的吗？</h1><p id="1103" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">和许多数据问题一样，这个问题的答案是一个两步过程:1)绘制数据，2)测试你的假设</p><h2 id="ddd1" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated"><strong class="ak">绘制数据</strong></h2><p id="99bd" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">在开始任何分析之前，抽查数据并更加熟悉它是非常重要和有价值的。如果您花一些时间查看数据，您会发现更容易发现应该删除或单独分析的数据质量问题或异常值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/4b071742c4ccacf2d98f9cdd3c71e23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zwQHY4araIz8JujhY5xB_Q.jpeg"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">每月费用数据集的图表</p></figure><h2 id="6ae2" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated"><strong class="ak">测试你的假设</strong></h2><p id="1e1d" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">您可能无法通过简单地查看数据集来判断它是否是静止的。这种情况下，真的不好说！</p><p id="3a13" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是迪基-富勒测试可以帮助我们的地方。这是一个统计检验，其中零假设表明<em class="nz">对于给定的序列</em>有一个单位根，而替代假设表明<em class="nz">序列是平稳的</em>。</p><p id="92a4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">像在任何其他统计测试中一样，如果p值小于或等于显著性水平(通常为1%、5%或10%)，我们将拒绝<em class="nz">零假设</em>。让我们将显著性水平设为1%，这样我们就可以99%的置信度拒绝零假设。</p><p id="68d2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了使我们的时间序列稳定，p值必须≤ 0.01。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/ff8fd16c6d40c25b1e2641053caed44a.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*PtwSnYZ7UVr4Wqkh6tBb4A.jpeg"/></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">测试时间序列是否平稳</p></figure><p id="3710" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">☹️却不是这样</p><p id="e14f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，我们必须转换数据集，并再次执行Dickey-Fuller测试。数学中常用的一种变换是对数变换，因为它不会影响数据的属性。这意味着我们将计算时间序列中每个数据点的对数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/e8d10c376a7341c91cde3ffda802a768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*2z7HS_45dMudlGgbjQWMnQ.jpeg"/></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">对数变换后测试时间序列是否平稳</p></figure><p id="5f7e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还没有到达那里，我们的时间序列不是静止的。</p><p id="646a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是我用来运行Dickey-Fuller测试的代码，带有进行对数变换的选项。</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="98d1" class="nm mp iq od b gy oh oi l oj ok"># log_dataset: boolean indicating if we want to log-transform the dataset before running Augmented Dickey-Fuller test</span><span id="cdbc" class="nm mp iq od b gy ol oi l oj ok">def adf_test(dataset, log_dataset):<br/>  ds = dataset</span><span id="53a9" class="nm mp iq od b gy ol oi l oj ok">if log_dataset:<br/>    ds = dataset.apply(lambda x: log(x))<br/>    ds.dropna(inplace=True)</span><span id="2a05" class="nm mp iq od b gy ol oi l oj ok">  result = adfuller(ds)</span><span id="354c" class="nm mp iq od b gy ol oi l oj ok">  print('Augmented Dickey-Fuller Test')<br/>  print('test statistic: %.10f' % result[0])<br/>  print('p-value: %.10f' % result[1])<br/>  print('critical values')</span><span id="8625" class="nm mp iq od b gy ol oi l oj ok">  for key, value in result[4].items():<br/>    print('\t%s: %.10f' % (key, value))</span></pre><h1 id="3962" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">我们的时间序列仍然不是稳定的</h1><p id="eb7e" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">我们已经测试了原始数据集和经过对数变换的数据集，但是我们的时间序列仍然不是静态的。</p><p id="0390" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还有其他选择吗？我们可以应用其他技术来转换数据，而不改变其属性:</p><ol class=""><li id="5566" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm mb lt lu lv bi translated"><strong class="kt ir">差分</strong>将每个数据点减去序列中特定时间点的值，例如，总是减去下一个周期的值</li><li id="a43f" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm mb lt lu lv bi translated"><a class="ae nl" href="https://en.wikipedia.org/wiki/Decomposition_of_time_series" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">分解</strong> </a>这种技术将分离出开始时提到的时间序列的每个组成部分(趋势、季节性、周期、不规则性)并提供残差</li></ol><p id="f717" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们的例子中，我们将尝试区分数据集。</p><h1 id="ddbe" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">区别</h1><p id="4f27" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">因为求差是减法，所以让我们保持简单，从求每个数据点与它之前的数据点的差开始，即求连续值的差。</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="2af0" class="nm mp iq od b gy oh oi l oj ok"># data: our dataset<br/># column_name: column to difference</span><span id="b68e" class="nm mp iq od b gy ol oi l oj ok">pd.DataFrame(data=np.diff(np.array(data[column_name])))<br/>n_diff_dataset.columns = [column_name]<br/>  <br/># dropping NAN values<br/>n_diff_dataset.dropna(inplace=True)</span></pre><p id="9d05" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">再次运行Dickey-Fuller检验，我们看到我们仍然不能以1%的显著性水平拒绝零假设。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/7da9508ca2fba2fe2137da10572e0956.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*a6f2qqmwSBhbMA9P0crx7w.jpeg"/></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">连续值差分后的Dickey-Fuller检验结果</p></figure><p id="6751" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">p值≤ 0.01。<strong class="kt ir">数据集是固定的</strong>🎉🎉🎉</p><p id="46cb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们来看看平稳的时间序列。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/e91c7f0a0c870a4dddec9f404d622e63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GFxNOCjn6vnwD_xvGjKWBQ.jpeg"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">二阶差分后的时间序列——终于平稳了！</p></figure><h1 id="7232" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">n阶差分和季节差分</h1><p id="5411" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">差分后，我们的时间序列最终是平稳的。但是如果情况不是这样，我们可以继续对时间序列进行差分。</p><blockquote class="on oo op"><p id="9deb" class="kr ks nz kt b ku kv jr kw kx ky ju kz oq lb lc ld or lf lg lh os lj lk ll lm ij bi translated">差异并不意味着你要减去n个前期的值，或者减去滞后值。这就是季节差异。</p></blockquote><h2 id="42cb" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated">季节性差异</h2><p id="5b62" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">这个名字透露了一点。如果您对数据集应用季节差异，您将减去同一季节的前一个数据点。</p><p id="d86b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们的示例中，我们处理的是月度数据，因此每年都对应于包含12个月的季节。因此，计算任何给定年份的一月份的季节性差异，意味着用当前值减去上一年一月份的值。</p><p id="2c12" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">概括地说，它看起来像这样</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/ba08e2dbf726eecca86004db2bf07e77.png" data-original-src="https://miro.medium.com/v2/resize:fit:514/format:webp/1*HFUMw7N-nQNzh-dBz1TzZA.jpeg"/></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">季节性差异</p></figure><p id="fc2f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在每月费用的例子中，一个季节是一年，所以<em class="nz"> n=12 </em>。</p><h2 id="4c54" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated">n阶差分</h2><p id="4385" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">这就是我们对数据集所做的，我们应用了一阶差分。这实际上意味着将时间序列中的每个数据点减去它之前的时间段中的数据点，如lag=1。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/25651ea8a8282f1b08f22ea9ab56272c.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*s8avINZ550_DWp8k-BWRrg.jpeg"/></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">一阶差分</p></figure><p id="2399" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是如果我们继续保持差异呢？嗯，我们实际上只是不断区分不同之处🤯🤯🤯</p><p id="8e59" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这种情况下，看数学实际上有帮助！让我们以二阶差分为例，这里我们差分两次。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/8f4b63a99bd096a95d3a20e8f2a48ed9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*15zC-kFlIioc1Aef5B3cCA.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">二阶差分</p></figure><p id="6c68" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过查看该公式，现在更有意义，并且更容易看出<em class="nz">n</em>-阶差分<em class="nz">并不意味着</em>n周期的滞后，而是实际执行差分运算<em class="nz"> n </em>次</p><p id="23f1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果需要对数据集进行任意次数的微分，可以使用numpy中的<a class="ae nl" href="https://docs.scipy.org/doc/numpy-1.10.0/reference/generated/numpy.diff.html" rel="noopener ugc nofollow" target="_blank"> diff方法</a>并设置参数<em class="nz"> n. </em></p><p id="d6b6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，回到预测📈</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="6102" class="mo mp iq bd mq mr ow mt mu mv ox mx my jw oy jx na jz oz ka nc kc pa kd ne nf bi translated">时间序列建模</h1><p id="f83e" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">有几种方法可以对时间序列进行建模，最常用的有:</p><h2 id="3117" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated">简单移动平均线</h2><p id="96e4" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">使用这种方法，你是说预测是基于<em class="nz"> n </em>个先前数据点的平均值。</p><h2 id="7880" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated">指数平滑法</h2><p id="01ff" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">它以指数方式降低了先前观测的权重，因此越来越老的数据点对预测的影响越来越小。</p><h2 id="96e8" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated">ARIMA:自回归综合移动平均数</h2><p id="ee67" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">这是我们将要使用的方法。</p><p id="3ca7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ARIMA模型可以分解成三个不同的部分，每个部分都有一个代表时间序列特征的参数。</p><h2 id="6d05" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated"><strong class="ak"> 1。自回归:AR(p) </strong></h2><p id="0024" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated"><a class="ae nl" href="https://en.wikipedia.org/wiki/Autoregressive_model" rel="noopener ugc nofollow" target="_blank">自回归模型</a>将随机过程解释为线性组合，因此输出变量线性依赖于其先前值和随机变量。</p><p id="21ba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">简而言之，这是一个基于先验值或<em class="nz">滞后</em>的模型。</p><p id="2920" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你在预测一只股票的未来价格，AR模型将会根据这只股票以前的价格做出预测。</p><p id="67da" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们看看数学，我们可以用参数<em class="nz"> p </em>来描述AR(p)模型:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/edfd893802de9c0bbfdef883166fcaf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aKrSXycxPjYCaoC8iI1bxw.jpeg"/></div></div></figure><p id="9ea8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">参数<em class="nz"> p </em>表示自回归项的数量，即线性组合中的项数。</p><h2 id="70dd" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated"><strong class="ak"> 2。综合:I(d) </strong></h2><p id="09a2" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">这个名字具有误导性，但这实际上与数据集被差分的次数有关，这由参数<em class="nz"> d </em>的值表示。</p><h2 id="814a" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated"><strong class="ak"> 3。移动平均线:MA (q) </strong></h2><p id="4ef6" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">与自回归模型相似，在<a class="ae nl" href="https://en.wikipedia.org/wiki/Moving-average_model" rel="noopener ugc nofollow" target="_blank">移动平均模型</a>中，输出变量被解释为线性，但这次是过去误差的平均值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/25d28091d5c3d6619b6f14e5ddfd77c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PA6K30cuTwQ9eS5rJ4oVsg.png"/></div></div></figure><p id="9b5e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">综上所述，<strong class="kt ir"> ARIMA(p，d，q) </strong>的公式如下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/f27a46c1f377b5a3c051bb6711aba0e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uaWPoUH1V9z_N4EUWK7edQ.jpeg"/></div></div></figure><p id="df3c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是现在的问题是<em class="nz">我们如何确定使用哪些参数？</em></p><h1 id="a7f4" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">ARIMA(p，d，q)的提货参数</h1><p id="3c4a" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">我们已经知道需要对数据集进行多少次差分，所以参数<em class="nz"> d </em>的值是1。</p><p id="96b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是我们还是要搞清楚<em class="nz"> p </em>和<em class="nz"> q </em>的值。为此，我们将寻找自相关、AR(p)和移动平均、MA(q)曲线。</p><h2 id="e01e" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated"><strong class="ak">自相关(AR)曲线</strong></h2><p id="b3dd" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">这是通过测试时间序列中的数据点在不同滞后(即，在时间上的<em class="nz">点</em>处)与其自身之间的相关性来完成的。</p><p id="cbf7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为此，我们将使用<a class="ae nl" href="https://www.statsmodels.org/stable/generated/statsmodels.graphics.tsaplots.plot_acf.html" rel="noopener ugc nofollow" target="_blank">自相关函数图</a>，简称ACF图。</p><p id="c131" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">利用ACF图，我们可以发现自相关(AR)曲线</p><ul class=""><li id="a523" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">ACF数据点是正弦或指数衰减的</li><li id="dd7a" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">PACF有一个尖峰信号，或几个连续的尖峰信号，然后突然切断</li></ul><h2 id="3b28" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated">移动平均(MA)曲线</h2><p id="cdc6" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">为了确定移动平均曲线，我们将使用ACF的子集，<a class="ae nl" href="https://www.statsmodels.org/stable/generated/statsmodels.graphics.tsaplots.plot_pacf.html" rel="noopener ugc nofollow" target="_blank">部分自相关函数图</a>，通常称为PACF图。</p><p id="ed64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">PACF表示不同滞后的自相关，但它移除了<em class="nz">低阶相关</em>，即1和滞后-1之间的所有相关，因为它们之间的一切都将是内在相关的。</p><p id="7966" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用ACF图，我们可以发现自相关(AR)曲线，当我们看到AR曲线描述的<em class="nz">反转</em>时:</p><ul class=""><li id="360c" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">PACF数据点是正弦或指数衰减的</li><li id="2f8b" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">ACF有一个尖峰，或几个连续的尖峰，然后突然切断</li></ul><p id="4c34" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最重要的是，图中的尖峰必须具有统计显著性，这意味着它们在置信区间的区域之外。这个<em class="nz">置信区间</em>要么用水平线表示，要么用面积图中的面积表示，这取决于您使用的软件。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><p id="3edc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们一起来看看ACF和PACF的情节。</p><div class="kg kh ki kj gt ab cb"><figure class="pe kk pf pg ph pi pj paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/ad5093793d2e57f8769538abd7d65b93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*4fGSfbkk6jygGepj06Gr_w.png"/></div></figure><figure class="pe kk pf pg ph pi pj paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/0d648fa834f13f12017e8ec07d6980ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*XF3VstWXMIotluPgWR-ENQ.png"/></div><p class="mk ml gj gh gi mm mn bd b be z dk pk di pl pm translated">数据集的自相关和偏自相关图</p></figure></div><p id="7145" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">滞后= 0时的ACF和PACF通常为1，因为每个数据点总是与其自身相关。</p><p id="aeb8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">分析ACF图，我们可以看到任何稍微超出置信带的尖峰，因此我们假设AR(2)。</p><p id="5fa0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">至于图，我们可以在<em class="nz">滞后=2 </em>处看到第一个尖峰，因此我们将选择MA(2)。</p><p id="aabf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们有自己的模型，ARIMA(2，1，2)🙌</p><p id="8f06" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了适应模型，我决定将数据集分为训练和测试子集，使用最后30%的观察值作为测试数据。</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="4eaa" class="nm mp iq od b gy oh oi l oj ok"># split dataset between training and testing<br/>cutoff_30pct = len(y) — int(len(y)*0.3)<br/>y_train = diff_dataset[y_col][:cutoff_30pct]<br/>y_test = diff_dataset[y_col][cutoff_30pct:] </span><span id="d2aa" class="nm mp iq od b gy ol oi l oj ok"># building the model with the parameters we've discovered and fitting it to the training set<br/>model = arima_model.ARIMA(y_train, order=(2,1,2)) <br/>arima_model_fit = model.fit(disp=-1)<br/>print(arima_model_fit.summary())</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pn"><img src="../Images/1a8432200732041eede353d0d52e896a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aB4JxRt9Jc6OL7xB6iHBMg.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">ARIMA的结果(2，1，2)</p></figure><p id="8b07" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae nl" href="https://en.wikipedia.org/wiki/Akaike_information_criterion" rel="noopener ugc nofollow" target="_blank"> AIC </a>和<a class="ae nl" href="https://en.wikipedia.org/wiki/Bayesian_information_criterion" rel="noopener ugc nofollow" target="_blank"> BIC </a>值用于比较不同模型应用于同一数据集时的拟合质量。在我们的例子中，我们没有比较多个模型，所以我们不会过多关注这些值。</p><p id="2adf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了理解这个特定模型的质量，我们需要使用工具箱中的其他指标。</p><h2 id="cbee" class="nm mp iq bd mq nn no dn mu np nq dp my la nr ns na le nt nu nc li nv nw ne nx bi translated">这个模型对我们的数据集有好处吗？</h2><p id="8dc9" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">为了评估模型的质量，我们首先将预测值与测试子集中的实际值进行比较。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi po"><img src="../Images/623bd11765b91b3dc9152844756d2fdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8MmuPO8njlYN2m8K28iGYg.jpeg"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">将实际值与预测值进行比较</p></figure><p id="9365" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从这里我们可以看到，绿色的预测值与橙色的实际值相比有些偏差。</p><p id="b849" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">根据整个数据集进行预测时，这一点变得更加清晰。</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="a8e3" class="nm mp iq od b gy oh oi l oj ok">fig, ax = plt.subplots(figsize=(15,7))<br/>model = arima_model.ARIMA(differenced_dataset, order=(2,1,2)) <br/>arima_model_fit = model_all.fit(disp=0)<br/># dynamic=False meaning in-sample lagged values are used for prediction<br/>arima_all_fit.plot_predict(dynamic=False)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/2cfb2bcdef5980d7ffe4d3144233e942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*unrsdLkVW5fk-O3_QPmTVw.png"/></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">针对整个数据集进行预测</p></figure><p id="ab6c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好吧，我们知道我们的预测有点偏差，但是偏差有多大呢？</p><p id="bf8d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了了解实际值和预测值之间的差异，我们可以使用平均绝对误差。</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="5bff" class="nm mp iq od b gy oh oi l oj ok">arima_mae = mean_absolute_error(y_test.values, forecast)<br/>print('Mean absolute error %.2f' % arima_mae)</span></pre><p id="bbb0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的ARIMA(2，1，2)的平均绝对误差为235.89，这意味着这些值平均相差235.89个单位。</p><p id="d736" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这可能意味着:</p><ul class=""><li id="8c72" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">没有足够的数据来做出准确的预测</li><li id="04f7" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">ARIMA参数可以进一步调整</li><li id="84a4" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">ARIMA可能不是这个问题的最佳模型，一个想法是尝试简单的线性回归或指数平滑，并比较AIC和BIC</li></ul><h1 id="36a6" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">结论</h1><p id="c886" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">在我们一直在做的例子中，数据是随机生成的，并做了一些调整来创建一个趋势，所以这个结果可能会稍微有些偏差。本文的主要目标是通过不同的步骤来拟合ARIMA模型。</p><p id="f0bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有了<em class="nz">真实数据</em>，你需要在你的问题的特定背景下观察平均绝对误差和残差。</p><p id="775f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这听起来可能有点模糊，但在数据科学中，上下文和您对该问题的了解非常重要。如果你预测一家价值数百万美元的公司的月收入，相差235美元可能并不重要。另一方面，如果你预测一个家庭的月预算是235美元，那就更令人担忧了。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><p id="3398" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望你喜欢阅读这个例子，并愉快的预测📈</p><p id="f2ff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nz">感谢阅读！</em></p></div></div>    
</body>
</html>