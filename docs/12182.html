<html>
<head>
<title>Represent your Geospatial Data using Folium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 leav 表示您的地理空间数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/represent-your-geospatial-data-using-folium-c2a0d8c35c5c?source=collection_archive---------24-----------------------#2020-08-22">https://towardsdatascience.com/represent-your-geospatial-data-using-folium-c2a0d8c35c5c?source=collection_archive---------24-----------------------#2020-08-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c044" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 python 可视化地图的过程</h2></div><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/9383e27e80d7496bca4b831d152afbf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hnZW1rPdyfsBCvCpUGF9Cg.jpeg"/></div></div><p class="lc ld gj gh gi le lf bd b be z dk translated">照片由<a class="ae lg" href="https://www.pexels.com/@valentinantonucci?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">瓦伦丁·安托努奇</a>从<a class="ae lg" href="https://www.pexels.com/photo/person-holding-compass-691637/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">派克斯</a>拍摄</p></figure><p id="40d7" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">作为数据科学社区的一部分，地理空间数据是最重要的数据类型之一。这些应用程序非常简单，比如“我的外卖订单现在在哪里？”和“送货员的最佳路径是什么？”一样复杂</p><h2 id="8857" class="md me it bd mf mg mh dn mi mj mk dp ml lq mm mn mo lu mp mq mr ly ms mt mu mv bi translated">是什么把我带到了叶城？</h2><p id="3b18" class="pw-post-body-paragraph lh li it lj b lk mw ju lm ln mx jx lp lq my ls lt lu mz lw lx ly na ma mb mc im bi translated">我最近在研究一个涉及大量 gps 坐标的数据科学问题。显然，这是一个非常基本的问题——我如何在我的 jupyter 笔记本上的地图上表示这些坐标？虽然我们知道<a class="ae lg" href="https://plotly.com/python/choropleth-maps/" rel="noopener ugc nofollow" target="_blank"> plotly </a>、<a class="ae lg" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> geopy </a>和<a class="ae lg" href="https://basemaptutorial.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">底图</a>完成了工作，但这是我第一次遇到<a class="ae lg" href="https://python-visualization.github.io/folium/" rel="noopener ugc nofollow" target="_blank">leaf</a>并决定试一试！</p><p id="9c43" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">本文是一个关于使用 folium 表示数据的分步教程。</p><h2 id="b408" class="md me it bd mf mg mh dn mi mj mk dp ml lq mm mn mo lu mp mq mr ly ms mt mu mv bi translated">介绍</h2><p id="d122" class="pw-post-body-paragraph lh li it lj b lk mw ju lm ln mx jx lp lq my ls lt lu mz lw lx ly na ma mb mc im bi translated">Folium 主要用于为浏览器生成交互式地图(在笔记本内或网站上)。它使用了<a class="ae lg" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank"> leaflet.js </a>，这是一个用于交互式地图的 javascript 库。</p><blockquote class="nb nc nd"><p id="f253" class="lh li ne lj b lk ll ju lm ln lo jx lp nf lr ls lt ng lv lw lx nh lz ma mb mc im bi translated">用一行程序实现它:<strong class="lj iu">用 Python 处理数据，然后通过 leav 在活页地图上可视化。</strong></p></blockquote><p id="ce3f" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj iu"> <em class="ne">第一步:</em> </strong> <em class="ne">在电脑上安装叶子，导入必要的包。</em></p><pre class="kr ks kt ku gt ni nj nk nl aw nm bi"><span id="7aeb" class="md me it nj b gy nn no l np nq">!pip install folium</span><span id="a262" class="md me it nj b gy nr no l np nq">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>from sklearn import preprocessing<br/>import scipy</span><span id="3de6" class="md me it nj b gy nr no l np nq">## for geospatial<br/>import folium<br/>import geopy</span></pre><p id="c47a" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们将使用<a class="ae lg" href="https://www.kaggle.com/carlosparadis/fires-from-space-australia-and-new-zeland" rel="noopener ugc nofollow" target="_blank">来自太空的火:澳大利亚</a>数据集。</p><p id="3b3b" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj iu"> <em class="ne">第二步:</em> </strong> <em class="ne">加载并检查数据集。</em></p><pre class="kr ks kt ku gt ni nj nk nl aw nm bi"><span id="cde1" class="md me it nj b gy nn no l np nq">df = pd.read_csv("fire_archive_M6_96619.csv")</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ns"><img src="../Images/289ace03c81093cd5d5695f62912f92c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWUWsF3xFuxIfFxPQmUVCg.png"/></div></div></figure><p id="fbcc" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj iu"> <em class="ne">第三步:</em> </strong> <em class="ne">找到坐标开始。</em></p><p id="90d7" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们可以从数据集本身选取一组坐标，也可以使用 geopy 来实现这一目的。在这里，我们正在谈论澳大利亚的野火，所以我从墨尔本开始参考。</p><pre class="kr ks kt ku gt ni nj nk nl aw nm bi"><span id="4349" class="md me it nj b gy nn no l np nq">city = "Melbourne"<br/># get location<br/>locator = geopy.geocoders.Nominatim(user_agent="My app") <br/>city = locator.geocode(city)<br/>location = [city.latitude, city.longitude]<br/>print(city, "\n[lat, long]:", location)</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nt"><img src="../Images/3e97738761873f0404bdafdad5e4aa05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tfg4tRfOE2SNt_N6389CZA.png"/></div></div></figure><p id="446f" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj iu"> <em class="ne">第四步:</em> </strong> <em class="ne">在地图上绘图。</em></p><p id="12ce" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在地图上绘制点就像盖房子一样。你奠定了基础(这是你的背景地图)，然后你在它的表面上添加点。</p><p id="35a0" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们将首先奠定基础。</p><pre class="kr ks kt ku gt ni nj nk nl aw nm bi"><span id="f481" class="md me it nj b gy nn no l np nq">map_ = folium.Map(location=location, tiles="cartodbpositron",<br/>                  zoom_start=8)<br/>map_</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nu"><img src="../Images/eba245f59b6782b3522cd16446339ca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E7atSRRheIuZX0eGBbm7Og.png"/></div></div></figure><p id="92db" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">你也可以通过参考<a class="ae lg" href="https://python-visualization.github.io/folium/modules.html" rel="noopener ugc nofollow" target="_blank">这里的</a>来玩 tileset 和 zoom。</p><p id="506c" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在我们在地图上标出这些点。我们将根据属性“类型”进行颜色编码，并根据火的“亮度”确定大小。所以让我们先把这些属性按顺序排好。</p><pre class="kr ks kt ku gt ni nj nk nl aw nm bi"><span id="a7de" class="md me it nj b gy nn no l np nq"># create color column to correspond to type<br/>colors = ["red","yellow","orange", "green"]<br/>indices = sorted(list(df["type"].unique()))<br/>df["color"] = df["type"].apply(lambda x: <br/>               colors[indices.index(x)])<br/>## scaling the size<br/>scaler = preprocessing.MinMaxScaler(feature_range=(3,15))<br/>df["size"] = scaler.fit_transform(<br/>               df['brightness'].values.reshape(-1,1)).reshape(-1)</span></pre><p id="5ca2" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们最后用叶子在地图上添加点。</p><pre class="kr ks kt ku gt ni nj nk nl aw nm bi"><span id="91e0" class="md me it nj b gy nn no l np nq">df.apply(lambda row: folium.CircleMarker(<br/>           location=[row['latitude'],row['longitude']], <br/>           popup=row['type'],<br/>           color=row["color"], fill=True,<br/>           radius=row["size"]).add_to(map_), axis=1)</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nv"><img src="../Images/39b33fba330b8a5c75fc73a4a0fcb6b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2f-eHidYLyGdFxZ8N2V5Fg.png"/></div></div></figure><p id="0292" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最后，我们向地图添加图例。我使用<a class="ae lg" href="https://www.thetopsites.net/article/52981290.shtml" rel="noopener ugc nofollow" target="_blank">这个</a>参考来添加一个图例。还有许多其他方法，但这是我发现的最简单的方法。</p><pre class="kr ks kt ku gt ni nj nk nl aw nm bi"><span id="02ea" class="md me it nj b gy nn no l np nq">legend_html = """&lt;div style="position:fixed; <br/>                    top:10px; right:10px; <br/>                    border:2px solid black; z-index:9999; <br/>                    font-size:14px;"&gt;&amp;nbsp;&lt;b&gt;"""+color+""":&lt;/b&gt;&lt;br&gt;"""<br/>for i in lst_elements:<br/>     legend_html = legend_html+"""&amp;nbsp;&lt;i class="fa fa-circle <br/>     fa-1x" style="color:"""+lst_colors[lst_elements.index(i)]+""""&gt;<br/>     &lt;/i&gt;&amp;nbsp;"""+str(i)+"""&lt;br&gt;"""<br/>legend_html = legend_html+"""&lt;/div&gt;"""<br/>map_.get_root().html.add_child(folium.Element(legend_html))</span><span id="1781" class="md me it nj b gy nr no l np nq">#plot<br/>map_</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nw"><img src="../Images/883384a440ae7f59604cbd9f52c9234a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J1HAONmKUKBD6nL660lC6g.png"/></div></div></figure><p id="38ab" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这是整段代码:</p><pre class="kr ks kt ku gt ni nj nk nl aw nm bi"><span id="44f5" class="md me it nj b gy nn no l np nq">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>from sklearn import preprocessing<br/>import scipy<br/>## for geospatial<br/>import folium<br/>import geopy</span><span id="0983" class="md me it nj b gy nr no l np nq">df = pd.read_csv("fire_archive_M6_96619.csv")</span><span id="cd1e" class="md me it nj b gy nr no l np nq">city = "Melbourne"<br/># get location<br/>locator = geopy.geocoders.Nominatim(user_agent="My app") <br/>city = locator.geocode(city)<br/>location = [city.latitude, city.longitude]<br/>print(city, "\n[lat, long]:", location)</span><span id="a85f" class="md me it nj b gy nr no l np nq">map_ = folium.Map(location=location, tiles="cartodbpositron",<br/>                  zoom_start=8)</span><span id="6cd1" class="md me it nj b gy nr no l np nq"># create color column to correspond to type<br/>colors = ["red","yellow","orange", "green"]<br/>indices = sorted(list(df["type"].unique()))<br/>df["color"] = df["type"].apply(lambda x: <br/>               colors[indices.index(x)])<br/>## scaling the size<br/>scaler = preprocessing.MinMaxScaler(feature_range=(3,15))<br/>df["size"] = scaler.fit_transform(<br/>               df['brightness'].values.reshape(-1,1)).reshape(-1)</span><span id="f67a" class="md me it nj b gy nr no l np nq">df.apply(lambda row: folium.CircleMarker(<br/>           location=[row['latitude'],row['longitude']], <br/>           popup=row['type'],<br/>           color=row["color"], fill=True,<br/>           radius=row["size"]).add_to(map_), axis=1)</span><span id="1fb7" class="md me it nj b gy nr no l np nq">legend_html = """&lt;div style="position:fixed; <br/>                    top:10px; right:10px; <br/>                    border:2px solid black; z-index:9999; <br/>                    font-size:14px;"&gt;&amp;nbsp;&lt;b&gt;"""+color+""":&lt;/b&gt;        &lt;br&gt;"""<br/>for i in lst_elements:<br/>     legend_html = legend_html+"""&amp;nbsp;&lt;i class="fa fa-circle <br/>     fa-1x" style="color:"""+lst_colors[lst_elements.index(i)]+""""&gt;<br/>     &lt;/i&gt;&amp;nbsp;"""+str(i)+"""&lt;br&gt;"""<br/>legend_html = legend_html+"""&lt;/div&gt;"""<br/>map_.get_root().html.add_child(folium.Element(legend_html))<br/>#plot<br/>map_</span></pre><p id="7bc8" class="pw-post-body-paragraph lh li it lj b lk ll ju lm ln lo jx lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">也可以在我的<a class="ae lg" href="https://github.com/slavvy-coelho/Folium-wildifires" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。希望这篇文章有所帮助。</p></div></div>    
</body>
</html>