<html>
<head>
<title>Put your Data Analysis in an R Package — Even if You Don’t Publish it</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">把你的数据分析放在一个R包里——即使你不发表它</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/put-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791?source=collection_archive---------14-----------------------#2020-02-28">https://towardsdatascience.com/put-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791?source=collection_archive---------14-----------------------#2020-02-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1087" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何利用R的软件包开发环境来组织、记录和测试您的工作</h2></div><p id="ef4a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated">一个数据分析项目由许多不同的文件组成:原始数据、脚本、降价报告和闪亮的应用程序。我们需要一个合理的项目文件夹结构来保持有序。为什么不利用R已经建立的包开发工作流程呢？</p><p id="4e26" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在R包中进行分析有四个好处:</p><ol class=""><li id="ddee" class="lk ll iq kh b ki kj kl km ko lm ks ln kw lo la lp lq lr ls bi translated">r包提供了一个标准化的文件夹结构来<strong class="kh ir">组织</strong>你的文件</li><li id="9b91" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">r包提供功能给<strong class="kh ir">文档</strong>的数据和功能</li><li id="f7f8" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">r包提供了一个框架来测试你的代码</li><li id="34cf" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">将精力放在第1-3点可以让你<strong class="kh ir">重用</strong>和<strong class="kh ir">共享</strong>你的代码</li></ol><p id="ab67" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将一步一步地在一个R包中完成一个数据分析例子。我们将看到这些好处几乎不需要任何开销。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><p id="976a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于数据分析示例，我们将:</p><ol class=""><li id="c182" class="lk ll iq kh b ki kj kl km ko lm ks ln kw lo la lp lq lr ls bi translated">下载和<strong class="kh ir">保存数据文件</strong></li><li id="58e3" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">编写一个脚本和一个R函数来处理数据</li><li id="18b4" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">创建一个最小的探索性数据分析报告</li><li id="899b" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">用Shiny开发一个最小交互R <a class="ae mf" href="https://rmarkdown.rstudio.com/flexdashboard/" rel="noopener ugc nofollow" target="_blank"> flexdashboard </a></li></ol><p id="f802" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最终结果可以在<a class="ae mf" href="https://github.com/gontcharovd/WineReviews.git" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><h2 id="a9a1" class="mg mh iq bd mi mj mk dn ml mm mn dp mo ko mp mq mr ks ms mt mu kw mv mw mx my bi translated">要求</h2><p id="ee46" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">我假设你用RStudio。建议<a class="ae mf" href="http://r-pkgs.had.co.nz/" rel="noopener ugc nofollow" target="_blank"/>有R包开发经验，但不是必需的。我们需要以下R包:</p><ul class=""><li id="6c5f" class="lk ll iq kh b ki kj kl km ko lm ks ln kw lo la ne lq lr ls bi translated">r包开发:<em class="nf"> devtools，usethis，roxygen2 </em></li><li id="cbf5" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la ne lq lr ls bi translated">r代码测试:<em class="nf"> assertive，testthat </em></li><li id="7595" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la ne lq lr ls bi translated">数据分析:<strong class="kh ir"><em class="nf"/></strong><em class="nf">gg plot 2，dplyr </em></li><li id="49a3" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la ne lq lr ls bi translated">R Markdown和闪亮:<em class="nf">针织机、rmarkdown、flexdashboard、闪亮</em></li></ul></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="e9be" class="ng mh iq bd mi nh ni nj ml nk nl nm mo jw nn jx mr jz no ka mu kc np kd mx nq bi translated">1.创建R包</h1><p id="0259" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">在RStudio中，导航到计算机上要创建包的文件夹。以下命令将打开一个新的RStudio会话，并创建一个名为“WineReviews”的准系统包。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="46fc" class="mg mh iq nw b gy oa ob l oc od">devtools::create("WineReviews")</span></pre><p id="45a5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意附加选项卡<em class="nf">构建</em>是如何变得可用的。</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/76cd8e0cf3c76948cc439fa79f0c149c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*cI2TRwwhMwjzqUj7FVZG2A.png"/></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">R包开发的附加工具</p></figure><p id="4528" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您在RStudio中配置了版本控制，导航至<em class="nf">工具、版本控制、项目设置</em>，并从下拉菜单中选择您的版本控制软件。我们将选择Git，它用一个<strong class="kh ir">初始化一个本地Git存储库。gitignore </strong>文件。</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div class="gh gi om"><img src="../Images/233cdfe01bc8a32c7de4be7df90277e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*betQt4WHU-8898dZfll9iA.png"/></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">为此项目启用Git</p></figure><p id="22f7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用R包<em class="nf"> roxygen2 </em>为我们的函数和数据自动生成文档。导航到<em class="nf">工具、项目选项、构建工具</em>，勾选“用Roxygen生成文档”前的复选框。我们将使用以下配置:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div class="gh gi on"><img src="../Images/48a463125bc3f3befb89d5b6148a9367.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*7CZNLgj4fa4UnypQY7UjXQ.png"/></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">配置Roxgen</p></figure><p id="2332" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<strong class="kh ir">描述</strong>文件中，我们写入项目的基本信息:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="b125" class="mg mh iq nw b gy oa ob l oc od">Package: WineReviews<br/>Title: Your data analysis project belongs in an R package<br/>Version: 0.1.0<br/>Authors@R:  person("Denis", "Gontcharov", role = c("aut", "cre"), <br/>                  email = "<a class="ae mf" href="mailto:gontcharovd@gmail.com" rel="noopener ugc nofollow" target="_blank">gontcharovd@gmail.com</a>")<br/>Description: Demonstrates how to leverage the R package workflow to organize a data science project.<br/>License: CC0<br/>Encoding: UTF-8<br/>LazyData: true</span></pre><p id="cd31" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们最初的包结构如下所示:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="d47f" class="mg mh iq nw b gy oa ob l oc od"><strong class="nw ir">.<br/></strong>├── .gitignore<br/>├── .Rbuildignore<br/>├── .Rhistory<br/>├── DESCRIPTION<br/>├── NAMESPACE<br/>├── <strong class="nw ir">R</strong><br/>└── WineReviews.Rproj</span></pre><p id="1abc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们检查一下我们的包构建，看看是否一切正常。我们将定期这样做，以确保我们整个工作项目的完整性。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="3650" class="mg mh iq nw b gy oa ob l oc od">devtools::check()</span></pre><figure class="nr ns nt nu gt of gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/e7ab174f03be93e6f02b4ffb9b737d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*RvfqFEEowTtJcAcoT1cHCg.png"/></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">我们的初始包结构通过了检查</p></figure></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="525f" class="ng mh iq bd mi nh ni nj ml nk nl nm mo jw nn jx mr jz no ka mu kc np kd mx nq bi translated">2.使用数据</h1><h2 id="ac1f" class="mg mh iq bd mi mj mk dn ml mm mn dp mo ko mp mq mr ks ms mt mu kw mv mw mx my bi translated">保存和访问原始数据</h2><p id="1518" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">在本例中，我们使用了来自<a class="ae mf" href="https://www.kaggle.com/zynicide/wine-reviews" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上葡萄酒评论数据集的两个csv文件。我们创建了一个文件夹<strong class="kh ir"> inst/ </strong>，其中包含一个子文件夹<strong class="kh ir"> extdata/ </strong>，我们在其中保存了两个csv文件。(包构建时，<strong class="kh ir"> inst/ </strong>的子文件夹是<a class="ae mf" href="https://stackoverflow.com/questions/13463103/inst-and-extdata-folders-in-r-packaging" rel="noopener ugc nofollow" target="_blank">安装的</a>。)</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="35b9" class="mg mh iq nw b gy oa ob l oc od"><strong class="nw ir">.<br/></strong>├── .gitignore<br/>├── .Rbuildignore<br/>├── .Rhistory<br/>├── DESCRIPTION<br/>├── <strong class="nw ir">inst</strong><br/>│   └── <strong class="nw ir">extdata</strong><br/>│       ├── winemag-data-130k-v2.csv<br/>│       └── winemag-data_first150k.csv<br/>├── NAMESPACE<br/>├── <strong class="nw ir">R</strong><br/>└── WineReviews.Rproj</span></pre><p id="6454" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使这些文件可用，我们必须<em class="nf">清理并重建</em>这个包。这将在您的计算机上安装R包。</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div class="gh gi op"><img src="../Images/7733c75c4e084f0d8a39fd46f6aae6fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*hIu4bQ8vmzQ8nomU_AUZVA.png"/></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">清理并重建以访问inst/文件夹中的文件</p></figure><p id="9506" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了在<strong class="kh ir"> inst/ </strong>中检索文件的路径，我们使用<code class="fe oq or os nw b">system.file()</code>如下:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="2c3a" class="mg mh iq nw b gy oa ob l oc od">system.file(<br/>  "extdata",<br/>  "winemag-data-130k-v2.csv",<br/>  package = "WineReviews"<br/>)</span></pre><h2 id="bb6c" class="mg mh iq bd mi mj mk dn ml mm mn dp mo ko mp mq mr ks ms mt mu kw mv mw mx my bi translated">操纵数据</h2><p id="218a" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">我们现在将把这些原始数据处理成有用的形式。葡萄酒评论分为两个csv文件。假设我们要把这两个文件合并成一个数据框，里面有四个变量:“国家”、“积分”、“价格”、“酒厂”。让我们称这个数据框架为“葡萄酒_数据”<strong class="kh ir">。</strong></p><p id="a86a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面的代码用脚本<strong class="kh ir"> wine_data创建了<strong class="kh ir"> data_raw/ </strong>文件夹。R </strong></p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="4ce5" class="mg mh iq nw b gy oa ob l oc od">usethis::use_data_raw(name = "wine_data")</span></pre><p id="aaa3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面的代码创建了我们想要的数据框。我们把它加到<strong class="kh ir"> wine_data里吧。R </strong>脚本并运行它。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="9755" class="mg mh iq nw b gy oa ob l oc od">## code to prepare `wine_data` dataset goes here</span><span id="250a" class="mg mh iq nw b gy ot ob l oc od"># retrieve paths to datafiles<br/>first.file &lt;- system.file(<br/>  "extdata",<br/>  "winemag-data-130k-v2.csv",<br/>  package = "WineReviews"<br/>)</span><span id="9eae" class="mg mh iq nw b gy ot ob l oc od">second.file &lt;- system.file(<br/>  "extdata",<br/>  "winemag-data_first150k.csv",<br/>  package = "WineReviews"<br/>)</span><span id="a696" class="mg mh iq nw b gy ot ob l oc od"># read the two .csv files<br/>data.part.one &lt;- read.csv(<br/>  first.file,<br/>  stringsAsFactors = FALSE,<br/>  encoding = "UTF-8"<br/>)</span><span id="088b" class="mg mh iq nw b gy ot ob l oc od">data.part.two &lt;- read.csv(<br/>  second.file,<br/>  stringsAsFactors = FALSE,<br/>  encoding = "UTF-8"<br/>)</span><span id="dbeb" class="mg mh iq nw b gy ot ob l oc od"># select 4 variables and merge the two files<br/>wine.variables &lt;- c("country", "points", "price", "winery")<br/>data.part.one &lt;- data.part.one[, wine.variables]<br/>data.part.two &lt;- data.part.two[, wine.variables]<br/>wine_data &lt;- rbind(data.part.one, data.part.two)</span><span id="b01c" class="mg mh iq nw b gy ot ob l oc od"># save the wine_data dataframe as an .rda file in WineReviews/data/<br/>usethis::use_data(wine_data, overwrite = TRUE)</span></pre><p id="2b01" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一行创建了<strong class="kh ir"> data/ </strong>文件夹，数据帧存储为<strong class="kh ir"> wine_data.rda </strong>。在我们<em class="nf">清理并再次重建</em><em class="nf"/>之后，该数据可以像任何其他R数据一样加载到全局环境中:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="b6c1" class="mg mh iq nw b gy oa ob l oc od">data(“wine_data”, package = "WineReviews")</span></pre><h2 id="6e39" class="mg mh iq bd mi mj mk dn ml mm mn dp mo ko mp mq mr ks ms mt mu kw mv mw mx my bi translated">记录数据</h2><p id="7508" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">记录您创建的数据是一个很好的做法。数据的所有文档应保存在一个单独的R脚本中，该脚本保存在<strong class="kh ir"> R/ </strong>文件夹中。让我们用下面的内容创建这个脚本，并将其命名为<strong class="kh ir"> data。R </strong>:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="b798" class="mg mh iq nw b gy oa ob l oc od">#' Wine reviews for 51 countries.<br/>#'<br/>#' A dataset containing wine reviews.<br/>#'<br/>#' <a class="ae mf" href="http://twitter.com/format" rel="noopener ugc nofollow" target="_blank">@format</a> A data frame with 280901 rows and 4 variables:<br/>#' \describe{<br/>#' \item{country}{The country that the wine is from.}<br/>#' \item{points}{The number of points rated by WineEnthusiast<br/>#' on a scale of 1–100.}<br/>#' \item{price}{The cost for a bottle of the wine.}<br/>#' \item{winery}{The winery that made the wine.}<br/>#' }<br/>#' <a class="ae mf" href="http://twitter.com/source" rel="noopener ugc nofollow" target="_blank">@source</a> \url{<a class="ae mf" href="https://www.kaggle.com/zynicide/wine-reviews" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/zynicide/wine-reviews</a>}<br/>"wine_data"</span></pre><p id="ed7c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了基于这个脚本创建文档，我们运行:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="d8be" class="mg mh iq nw b gy oa ob l oc od">devtools::document()</span></pre><p id="addf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Roxygen将上面的代码转换成一个a <strong class="kh ir"> wine_data。Rd </strong>文件，并将其添加到<strong class="kh ir"> man/ </strong>文件夹中。我们可以通过在R控制台中键入<code class="fe oq or os nw b">?winedata</code>在帮助窗格中查看该文档。</p><p id="aeb3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的包结构现在看起来像这样:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="82e1" class="mg mh iq nw b gy oa ob l oc od"><strong class="nw ir">.<br/></strong>├── .gitignore<br/>├── .Rbuildignore<br/>├── .Rhistory<br/>├── <strong class="nw ir">data</strong><br/>│   └── wine_data.rda<br/>├── <strong class="nw ir">data-raw</strong><br/>│   └── wine_data.R<br/>├── DESCRIPTION<br/>├── <strong class="nw ir">inst</strong><br/>│   └── <strong class="nw ir">extdata</strong><br/>│       ├── winemag-data-130k-v2.csv<br/>│       └── winemag-data_first150k.csv<br/>├── <strong class="nw ir">man</strong><br/>│   └── wine_data.Rd<br/>├── NAMESPACE<br/>├── <strong class="nw ir">R</strong><br/>│   └── data.R<br/>└── WineReviews.Rproj</span></pre></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="a178" class="ng mh iq bd mi nh ni nj ml nk nl nm mo jw nn jx mr jz no ka mu kc np kd mx nq bi translated">3.中间检查</h1><p id="a07f" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">通过运行以下命令来定期检查我们的包的完整性是一个很好的做法:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="f21d" class="mg mh iq nw b gy oa ob l oc od">devtools::check()</span></pre><p id="a499" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到一个警告和一张便条。</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="ov ow di ox bf oy"><div class="gh gi ou"><img src="../Images/febc249fa87090714491d3c2eef1160a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UWLvP3rHLyc8TPn8L9kfLw.png"/></div></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">定期检查你的包裹，尽早发现问题</p></figure><p id="b31d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于R版本依赖的警告是在调用<code class="fe oq or os nw b">usethis::use_data(wine_data, overwrite = TRUE)</code>之后引入的，并通过在<strong class="kh ir">描述</strong>文件中添加<code class="fe oq or os nw b">Depends: R (&gt;= 2.10)</code>来解决。</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/acbbb5e7e003eb7706a449bc8d703f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*0-PjvgOQPAqUKGauLRhO6Q.png"/></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">将第14行添加到描述文件中</p></figure><p id="a99f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为<strong class="kh ir"> inst/extdata </strong>中的数据超过1 MB，所以该注释警告我们关于包的大小。我们不想在<a class="ae mf" href="https://cran.r-project.org/" rel="noopener ugc nofollow" target="_blank"> CRAN </a>上发布这个R包，所以我们可以忽略它。但是，我们将通过将<strong class="kh ir"> inst/extdata/ </strong>文件夹添加到<strong class="kh ir">来解决这个问题。Rbuildignore </strong>。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="0888" class="mg mh iq nw b gy oa ob l oc od">^WineReviews\.Rproj$<br/>^\.Rproj\.user$<br/>^data-raw$<br/>^inst/extdata$</span></pre><p id="cc3a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在<code class="fe oq or os nw b">devtools::check()</code>显示一切正常:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/b04412bc49453498686647c8c4e72eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*isD_Bo-OHshFDHtLEOgCJg.png"/></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">第二次检查完美地通过了</p></figure></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="ad79" class="ng mh iq bd mi nh ni nj ml nk nl nm mo jw nn jx mr jz no ka mu kc np kd mx nq bi translated">4.插图中的数据分析</h1><p id="eca2" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">现在我们可以探索处理过的数据。我喜欢用R包插图写报告，因为它们有R用户熟悉的简洁布局。如果你不喜欢使用简介，你可以在一个标准的R Markdown文档中执行这些步骤，而不是简介，如第7章所示。</p><p id="3f6c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面的函数用<strong class="kh ir"> wine_eda创建了一个<strong class="kh ir"> vignettes/ </strong>文件夹。我们将用于探索性数据分析的Rmd </strong>插图。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="ddf6" class="mg mh iq nw b gy oa ob l oc od">usethis::use_vignette(name = “wine_eda”, title = “Wine Reviews EDA”)</span></pre><p id="c969" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用流行的<em class="nf"> dplyr </em> R包来操作数据。在<strong class="kh ir">描述</strong>文件中声明我们使用的每个R包很重要。别担心:如果你忘了这个<code class="fe oq or os nw b">devtools::check() </code>会丢一张纸条。用以下内容申报包裹:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="9d8a" class="mg mh iq nw b gy oa ob l oc od">usethis::use_package(“dplyr”)</span></pre><p id="857b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们向小插图添加一些代码来加载数据并显示摘要:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="c726" class="mg mh iq nw b gy oa ob l oc od">---<br/>title: “Wine Reviews EDA”<br/>output: rmarkdown::html_vignette<br/>vignette: &gt;<br/> %\VignetteIndexEntry{Wine Reviews EDA}<br/> %\VignetteEngine{knitr::rmarkdown}<br/> %\VignetteEncoding{UTF-8}<br/>---</span><span id="fa01" class="mg mh iq nw b gy ot ob l oc od">```{r, include = FALSE}<br/>knitr::opts_chunk$set(<br/> collapse = TRUE,<br/> comment = “#&gt;”<br/>)<br/>```</span><span id="4a6c" class="mg mh iq nw b gy ot ob l oc od">```{r setup}<br/>library(WineReviews)<br/>```</span><span id="f137" class="mg mh iq nw b gy ot ob l oc od">```{r}<br/># load the previously created wine_data data frame<br/>data(wine_data)<br/>```</span><span id="0d3d" class="mg mh iq nw b gy ot ob l oc od">```{r}<br/>summary(wine_data)<br/>```</span></pre><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="ov ow di ox bf oy"><div class="gh gi pb"><img src="../Images/b8603884c238d0646463bb4d67a9929b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EB1wVzPj5GvMbtpXmykD5A.png"/></div></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">winedata缺少22691个价格值</p></figure><p id="096e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">葡萄酒价格缺少22691个值。让我们转换数据来填充这些缺失的值。r是一种函数式编程语言:我们应该通过应用函数来转换我们的数据。</p><blockquote class="pc"><p id="f233" class="pd pe iq bd pf pg ph pi pj pk pl la dk translated">要理解R语言中的计算，有两个口号很有帮助:存在的一切都是对象。发生的一切都是函数调用。”</p><p id="6b5d" class="pd pe iq bd pf pg ph pi pj pk pl la dk translated">—约翰·钱伯斯</p></blockquote><p id="508a" class="pw-post-body-paragraph kf kg iq kh b ki pm jr kk kl pn ju kn ko po kq kr ks pp ku kv kw pq ky kz la ij bi translated">这是我们将分析放在R包中的决定将会得到回报的部分:包开发使得编写、记录和测试函数的过程变得非常顺利。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="3c4f" class="ng mh iq bd mi nh ni nj ml nk nl nm mo jw nn jx mr jz no ka mu kc np kd mx nq bi translated">5.使用函数</h1><p id="9df5" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">让我们用那个国家葡萄酒的平均价格来代替缺失的价格。从统计学的角度来说，这不一定是个好主意，但它将有助于证明这一点。</p><h2 id="3e84" class="mg mh iq bd mi mj mk dn ml mm mn dp mo ko mp mq mr ks ms mt mu kw mv mw mx my bi translated">编写和记录函数</h2><p id="7572" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">替换将由一个名为“fill_na_mean”的函数来完成。我们创建一个新的R脚本<strong class="kh ir">变量_计算。R </strong>并将其保存在<strong class="kh ir"> R/ </strong>文件夹中。请注意，我们可以如何方便地将函数的文档写在其代码之上。(保留@export标签，否则@examples将不起作用。)</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="669c" class="mg mh iq nw b gy oa ob l oc od">#' Replace missing values with the mean<br/>#'<br/>#' @param numeric.vector A vector with at least one numeric value.<br/>#'<br/>#' @return The input whose NAs are replaced by the input's mean.<br/>#'<br/>#' @export<br/>#'<br/>#' @examples fill_na_mean(c(1, 2, 3, NA, 5, 3, NA, 6))<br/>fill_na_mean &lt;- function(numeric.vector) {<br/>  ifelse(<br/>    is.na(numeric.vector),<br/>    mean(numeric.vector, na.rm = TRUE),<br/>    numeric.vector<br/>  )<br/>}</span></pre><p id="b30f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了创建文档，我们再次运行:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="ad3f" class="mg mh iq nw b gy oa ob l oc od">devtools::document()</span></pre><p id="741a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与记录数据的情况一样，Roxygen将把这个文档转换成一个文件<strong class="kh ir"> fill_na_mean。Rd </strong>并将其保存在<strong class="kh ir"> man/ </strong>文件夹中。我们可以通过在R控制台中键入<code class="fe oq or os nw b">?fill_na_mean</code>在帮助窗格中查看该文档。</p><p id="1155" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您希望在关闭或重启R会话后恢复工作，运行以下命令来加载您的函数以及在<strong class="kh ir">描述</strong>文件中声明的包:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="3687" class="mg mh iq nw b gy oa ob l oc od">devtools::load_all()<!-- --> </span></pre></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><p id="a356" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将为新创建的函数编写两个测试:</p><ol class=""><li id="7742" class="lk ll iq kh b ki kj kl km ko lm ks ln kw lo la lp lq lr ls bi translated">每次调用函数时运行的<strong class="kh ir">运行时测试</strong>警告<em class="nf">用户</em>输入错误。</li><li id="ba2d" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">一个<strong class="kh ir">开发时</strong> <strong class="kh ir">测试</strong>，它根据命令运行以警告<em class="nf">开发者</em>在编写或修改函数时的错误。</li></ol><h2 id="71ed" class="mg mh iq bd mi mj mk dn ml mm mn dp mo ko mp mq mr ks ms mt mu kw mv mw mx my bi translated">运行时测试</h2><p id="f65f" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">R包<em class="nf">断言</em>提供运行时测试<em class="nf">的功能。</em></p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="42e5" class="mg mh iq nw b gy oa ob l oc od">usethis::use_package(“assertive”)</span></pre><p id="c685" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的简单测试由一行代码组成，它检查输入是否是一个数字向量，如果不是，就抛出一个错误。注意，运行时测试不依赖于我们的包开发环境，因为它们是函数的一部分。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="dfdc" class="mg mh iq nw b gy oa ob l oc od">fill_na_mean &lt;- function(numeric.vector) {<br/> assertive::assert_is_numeric(numeric.vector)<strong class="nw ir"> # -&gt; </strong>the run-time test<br/> ifelse(<br/>   is.na(numeric.vector),<br/>   mean(numeric.vector, na.rm = TRUE),<br/>   numeric.vector<br/> )<br/>}</span></pre><h2 id="f2bd" class="mg mh iq bd mi mj mk dn ml mm mn dp mo ko mp mq mr ks ms mt mu kw mv mw mx my bi translated">开发时测试</h2><p id="1ab8" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">与运行时测试相反，使用<em class="nf">测试的开发时测试表明</em> R包需要一个活动的包开发环境。让我们为函数编写一个单元测试，测试<code class="fe oq or os nw b">fill_na_mean(c(2, 2, NA, 5, 3, NA))</code>是否返回向量<code class="fe oq or os nw b">c(2, 2, 3, 5, 3, 3)</code>。</p><p id="1d7f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先我们建立了<em class="nf">测试和</em>框架:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="9ffd" class="mg mh iq nw b gy oa ob l oc od">usethis::use_testthat()<!-- --> </span></pre><p id="109e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下命令创建脚本<strong class="kh ir"> test-variable_calculations。R </strong>包含对<strong class="kh ir"> variable_calculations中定义的函数的单元测试。R </strong>:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="0a1f" class="mg mh iq nw b gy oa ob l oc od">usethis::use_test("variable_calculations")</span></pre><p id="7521" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们修改了<strong class="kh ir">测试变量计算中的代码。R </strong>代表我们的测试:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="614b" class="mg mh iq nw b gy oa ob l oc od">context(“Unit tests for fill_na_mean”)<br/>test_that(“fill_na_mean fills the NA with 3”, {<br/> actual &lt;- fill_na_mean(c(2, 2, NA, 5, 3, NA))<br/> expected &lt;- c(2, 2, 3, 5, 3, 3)<br/> expect_equal(actual, expected)<br/>})</span></pre><p id="ffae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面的命令运行所有的测试并返回一个漂亮的报告:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="1af0" class="mg mh iq nw b gy oa ob l oc od">devtools::test()<!-- --> </span></pre><figure class="nr ns nt nu gt of gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/45a7452b53d934b85b80ed7778bc31e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*KWxLZ3CIcwWUakWK78PYzQ.png"/></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">我们的单元测试成功通过</p></figure></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="6388" class="ng mh iq bd mi nh ni nj ml nk nl nm mo jw nn jx mr jz no ka mu kc np kd mx nq bi translated">6.(重新)组织你的代码</h1><p id="d0ac" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">现在，我们可以填充我们的数据分析中缺少的值<strong class="kh ir"> wine_eda。Rmd </strong>。但是如果我们想在其他报表或应用程序中做同样的事情呢？我们应该在每个文件中重复这个过程吗？</p><p id="d264" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事实上，这个功能处理的是数据处理，而不是探索性分析。因此，它属于<strong class="kh ir">葡萄酒数据。生成<strong class="kh ir"> wine_data.rda </strong>的R </strong>文件。<strong class="kh ir"> </strong>将此代码放入<strong class="kh ir"> winedata。R </strong>而不是<strong class="kh ir"> wine_eda。Rmd </strong>有两个优点:</p><ol class=""><li id="5483" class="lk ll iq kh b ki kj kl km ko lm ks ln kw lo la lp lq lr ls bi translated">我们的代码变得模块化:用于数据处理的代码与我们的数据分析报告明显分离。</li><li id="d89e" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">只有一个脚本生成所有其他文件使用的已处理数据。</li></ol><p id="907f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">填充缺失值后，六个观察值仍然没有葡萄酒价格，因此我们选择删除它们。这是最终脚本的样子:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="c6aa" class="mg mh iq nw b gy oa ob l oc od">## code to prepare `wine_data` dataset goes here<br/># retrieve paths to datafiles<br/>first.file &lt;- system.file(<br/>  "extdata",<br/>  "winemag-data-130k-v2.csv",<br/>  package = "WineReviews"<br/>)<br/>second.file &lt;- system.file(<br/>  "extdata",<br/>  "winemag-data_first150k.csv",<br/>  package = "WineReviews"<br/>)<br/># read the two .csv files<br/>data.part.one &lt;- read.csv(<br/>  first.file,<br/>  stringsAsFactors = FALSE,<br/>  encoding = "UTF-8"<br/>)<br/>data.part.two &lt;- read.csv(<br/>  second.file,<br/>  stringsAsFactors = FALSE,<br/>  encoding = "UTF-8"<br/>)<br/># select 4 variables and merge the two files<br/>wine.variables &lt;- c("country", "points", "price", "winery")<br/>data.part.one &lt;- data.part.one[, wine.variables]<br/>data.part.two &lt;- data.part.two[, wine.variables]<br/>wine_data &lt;- rbind(data.part.one, data.part.two)</span><span id="63c8" class="mg mh iq nw b gy ot ob l oc od"># fill missing prices with the mean price per country<br/>wine_data &lt;- wine_data %&gt;%<br/>  dplyr::group_by(country) %&gt;%<br/>  dplyr::mutate(price = fill_na_mean(price))</span><span id="f5e9" class="mg mh iq nw b gy ot ob l oc od"># some countries don't have any non-missing price<br/># we omit these observations from the data<br/>wine_data &lt;- wine_data %&gt;%<br/>  dplyr::filter(!is.na(price))</span><span id="57c4" class="mg mh iq nw b gy ot ob l oc od"># save the wine_data dataframe as an .rda file in WineReviews/data/<br/>usethis::use_data(wine_data, overwrite = TRUE)</span></pre><p id="77ff" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我们改变了原始数据的处理方式，所以我们必须在<strong class="kh ir">数据中记录这些变化。<strong class="kh ir"> data-raw/ </strong>文件夹中的R </strong>文件:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="211b" class="mg mh iq nw b gy oa ob l oc od">#’ Wine reviews for 49 countries.<br/>#’<br/>#’ A dataset containing processed data of wine reviews.<br/>#’ Missing price values have been filled with the mean price for <br/>#’ that country<br/>#’ six observations coming from countries with no wine price were <br/>#’ deleted.<br/>#’<br/>#’ <a class="ae mf" href="http://twitter.com/format" rel="noopener ugc nofollow" target="_blank">@format</a> A data frame with 280895 rows and 4 variables:<br/>#’ \describe{<br/>#’ \item{country}{The country that the wine is from.}<br/>#’ \item{points}{The number of points WineEnthusiast<br/>#’ rated the wine on a scale of 1–100}<br/>#’ \item{price}{The cost for a bottle of the wine}<br/>#’ \item{winery}{The winery that made the wine}<br/>#’ }<br/>#’ <a class="ae mf" href="http://twitter.com/source" rel="noopener ugc nofollow" target="_blank">@source</a> \url{<a class="ae mf" href="https://www.kaggle.com/zynicide/wine-reviews" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/zynicide/wine-reviews</a>}<br/>“wine_data”</span></pre><p id="a48e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并更新文档:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="7045" class="mg mh iq nw b gy oa ob l oc od">devtools::document()</span></pre><p id="027a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们编织我们的小图案。请注意，即使我们没有更改插图中的代码，也不再有丢失的值。在<strong class="kh ir"> wine_data中删除缺失的值。R </strong>脚本。在插图中，我们只是加载处理过的<strong class="kh ir"> wine_data.rda </strong>。</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="ov ow di ox bf oy"><div class="gh gi ps"><img src="../Images/f3bd37e1d3c7bfd3d879a4c6e7c495a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TdmqcUUqV-GLUMg18sHFMA.png"/></div></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">wine_data摘要不包含缺失值</p></figure></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="c876" class="ng mh iq bd mi nh ni nj ml nk nl nm mo jw nn jx mr jz no ka mu kc np kd mx nq bi translated">7.使用R Markdown</h1><p id="f75b" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">我们可以将任何R Markdown文件添加到我们的包中。类似于原始数据，我们在<strong class="kh ir"> inst/ </strong>文件夹中创建一个子文件夹<strong class="kh ir"> rmd/ </strong>。让我们创建一个简单的仪表板来查看每个国家的葡萄酒价格分布。我们创建一个R Markdown文件<strong class="kh ir"> wine_dashboard。<strong class="kh ir"> rmd/ </strong>中的Rmd </strong>内容如下:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="f7f7" class="mg mh iq nw b gy oa ob l oc od">---<br/>title: "Wine dashboard"<br/>output: <br/> flexdashboard::flex_dashboard:<br/> orientation: columns<br/>runtime: shiny<br/>---</span><span id="666e" class="mg mh iq nw b gy ot ob l oc od">```{r setup, include=FALSE}<br/>library(flexdashboard)<br/>library(ggplot2)<br/>```</span><span id="a92f" class="mg mh iq nw b gy ot ob l oc od">```{r}<br/>data(wine_data, package = "WineReviews")<br/>```</span><span id="f829" class="mg mh iq nw b gy ot ob l oc od">Inputs {.sidebar data-width=150}<br/>-------------------------------------<br/>```{r}<br/>shiny::selectInput(<br/> "country",<br/> label = "select country",<br/> choices = sort(unique(wine_data$country))<br/>)<br/>```</span><span id="66fc" class="mg mh iq nw b gy ot ob l oc od">Column<br/>-------------------------------------</span><span id="e6b5" class="mg mh iq nw b gy ot ob l oc od">### Wine points versus price<br/> <br/>```{r}<br/>shiny::renderPlot(<br/> ggplot(wine_data[wine_data$country == input$country, ],<br/> aes(points, log10(price), group = points)) +<br/> geom_boxplot() +<br/> labs(x = "points scored by the wine on a 100 scale",<br/> y = "Base-10 logarithm of the wine price") +<br/> theme_bw()<br/>)<br/>```</span><span id="09f3" class="mg mh iq nw b gy ot ob l oc od">Column<br/>-------------------------------------<br/>### Wine price distribution<br/> <br/>```{r}<br/>shiny::renderPlot(<br/> ggplot(wine_data[wine_data$country == input$country, ], aes(price)) +<br/> geom_density() +<br/> labs(y = "Price density function") +<br/> theme_bw()<br/>)<br/>```</span></pre><p id="85fa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们用<em class="nf">运行文件</em>查看仪表板:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/bc90d5219f9c3ff207fe78c59b9023be.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*mIlU7kAwXi0JONzr23XxPA.png"/></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">按“运行文档”查看仪表板</p></figure><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="ov ow di ox bf oy"><div class="gh gi pu"><img src="../Images/3383cf389337873d43e948006b8d3c11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WChCelzUwvU8L-TdMLh4lw.png"/></div></div></figure></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="62a0" class="ng mh iq bd mi nh ni nj ml nk nl nm mo jw nn jx mr jz no ka mu kc np kd mx nq bi translated">8.使用版本控制</h1><p id="5e49" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">我们的数据分析示例现在已经完成。这是我们最终项目结构的样子:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="ba15" class="mg mh iq nw b gy oa ob l oc od"><strong class="nw ir">.<br/></strong>├── .gitignore<br/>├── .Rbuildignore<br/>├── .Rhistory<br/>├── DESCRIPTION<br/>├── <strong class="nw ir">data</strong><br/>│   └── wine_data.rda<br/>├── <strong class="nw ir">data-raw</strong><br/>│   └── wine_data.R<br/>├── <strong class="nw ir">inst</strong><br/>│   ├── <strong class="nw ir">extdata</strong><br/>│   │   ├── winemag-data-130k-v2.csv<br/>│   │   └── winemag-data_first150k.csv<br/>│   └── <strong class="nw ir">rmd</strong><br/>│       └── wine_dashboard.Rmd<br/>├── <strong class="nw ir">man</strong><br/>│   ├── fill_na_mean.Rd<br/>│   └── wine_data.Rd<br/>├── NAMESPACE<br/>├── <strong class="nw ir">R</strong><br/>│   ├── data.R<br/>│   └── variable_calculation.R<br/>├── <strong class="nw ir">tests</strong><br/>│   ├── <strong class="nw ir">testthat</strong><br/>│   │   └── test-variable_calculations.R<br/>│   └── testthat.R<br/>├── <strong class="nw ir">vignettes</strong><br/>│   └── wine_eda.Rmd<br/>└── WineReviews.Rproj</span></pre><p id="865a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种结构是合适的版本控制。跟踪有代码的文件，而不跟踪<strong class="kh ir"> inst/extdata </strong>中的原始数据和<strong class="kh ir"> data/ </strong>中的已处理数据。我们可以使用<strong class="kh ir"> data-raw/ </strong>中的R脚本从(重新)下载的原始数据中生成经过处理的数据。我建议将以下条目添加到<strong class="kh ir">中。gitignore </strong>:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="35c2" class="mg mh iq nw b gy oa ob l oc od">.Rproj.user<br/>.Rhistory<br/>data/<br/>inst/extdata/<br/>inst/doc</span></pre><h1 id="4b4f" class="ng mh iq bd mi nh pv nj ml nk pw nm mo jw px jx mr jz py ka mu kc pz kd mx nq bi translated">概述</h1><p id="eeb9" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">下面是我们如何利用R包组件的:</p><ul class=""><li id="0f84" class="lk ll iq kh b ki kj kl km ko lm ks ln kw lo la ne lq lr ls bi translated"><strong class="kh ir">描述:</strong>给出了项目及其依赖项的概述</li><li id="dfba" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la ne lq lr ls bi translated"><strong class="kh ir"> R/ </strong>:包含R脚本，其函数在整个包中使用</li><li id="b181" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la ne lq lr ls bi translated"><strong class="kh ir">测试/ </strong>:包含我们函数的开发时测试</li><li id="8788" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la ne lq lr ls bi translated"><strong class="kh ir"> inst/extdata/ </strong>:包含我们的原始数据文件</li><li id="9ddb" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la ne lq lr ls bi translated"><strong class="kh ir"> data-raw/ </strong>:包含将原始数据处理成整齐数据的R脚本</li><li id="a8d1" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la ne lq lr ls bi translated"><strong class="kh ir">数据/ </strong>:包含整齐的数据存储为。rda文件</li><li id="ea7d" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la ne lq lr ls bi translated"><strong class="kh ir"> man/ </strong> : <strong class="kh ir"> </strong>包含我们的对象和函数的文档</li><li id="385b" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la ne lq lr ls bi translated"><strong class="kh ir"> vignettes/ </strong>:包含数据分析报告作为包vignettes</li><li id="8e68" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la ne lq lr ls bi translated"><strong class="kh ir"> inst/rmd </strong>:包含报告或应用程序的R Markdown文件</li></ul></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><p id="d630" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望你喜欢这篇文章。你会考虑用R包来存储你的作品吗？你喜欢如何组织你的项目？<br/>在评论里告诉我吧！</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="ov ow di ox bf oy"><div class="gh gi qa"><img src="../Images/031a4c7b10e04603b62c56059f0ac153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ji9YlyGqz6Y_1dCss28fnA.jpeg"/></div></div><p class="oi oj gj gh gi ok ol bd b be z dk translated">照片由chuttersnap在Unsplash上拍摄</p></figure></div></div>    
</body>
</html>