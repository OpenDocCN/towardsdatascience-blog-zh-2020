<html>
<head>
<title>Logging Algorithmic Experiments in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中的日志算法实验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/logging-algorithmic-experiments-in-python-9ab1f0e55b89?source=collection_archive---------34-----------------------#2020-04-25">https://towardsdatascience.com/logging-algorithmic-experiments-in-python-9ab1f0e55b89?source=collection_archive---------34-----------------------#2020-04-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/3f3ddd157873da4f3aefc9e3d3553a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0mAi8wu2qZUJc-hz0zGYGg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">不要成为那样的人。阅读这篇文章并正确记录你的实验。</p></figure><div class=""/><div class=""><h2 id="1470" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">当你的大脑忙于思考聪明的解决方案时，你会忘记你正在尝试哪种聪明的解决方案。</h2></div><p id="8f0f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">研究难题的解决方案是一项充满挑战的任务。这篇文章的目标是消除其中的一个挑战——跟踪我们在所有这些研究中所处的位置。</p><p id="44bb" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在这篇文章中，我假设你正在编写一段代码，这段代码是你从头到尾运行的一段独立代码(我们称之为“实验”)，你的目标是跟踪你的研究进展。</p><p id="e270" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">为此，我们将使用一些有用的日志来丰富我们的代码。<br/>这些日志遵循三个指导原则，这些原则衍生出三个行动项目:</p><ol class=""><li id="41ea" class="lq lr jf kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">算法的输入对输出有很大的影响。<br/>👉🏾日志输入参数。</li><li id="c12b" class="lq lr jf kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">如果感觉花的时间太长，那可能就是花的时间太长了。<br/>👉🏾日志运行时间。</li><li id="2c6e" class="lq lr jf kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">日志不能避免错误，但是可以帮助控制它们。<br/>👉🏾日志 Git 修订版。</li></ol><div class="me mf mg mh gt ab cb"><figure class="mi is mj mk ml mm mn paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><img src="../Images/f640803177c30737e33c140bf6093e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*ujywnH7pbTpuqCke8IGl0Q.png"/></div></figure><figure class="mi is mo mk ml mm mn paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><img src="../Images/e3b11d2a2052749faead740f675bb627.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*fyZ8uCoIeQOumjiigbpSRg.png"/></div></figure><figure class="mi is mp mk ml mm mn paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><img src="../Images/c9388e81b8251043e2cd5610e312f269.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*QqFJxKMJ7-NysumQOoX1YA.png"/></div></figure></div><h1 id="c260" class="mq mr jf bd ms mt mu mv mw mx my mz na kl nb km nc ko nd kp ne kr nf ks ng nh bi translated">0.为每个实验打开一个记录文件夹</h1><p id="5e74" class="pw-post-body-paragraph ku kv jf kw b kx ni kg kz la nj kj lc ld nk lf lg lh nl lj lk ll nm ln lo lp ij bi translated">为了跟踪我们的实验，我们将把每次实验的所有日志保存在一个专用文件夹中，该文件夹将使用实验的开始时间来命名:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="2524" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我将假设您对代码使用了某种日志记录方案。例如，您可以使用<a class="ae np" href="https://codeburst.io/copy-pastable-logging-scheme-for-python-c17efcf9e6dc" rel="noopener" target="_blank">这种可复制粘贴的日志记录模式</a>。如果是这样，我们可以初始化我们的日志记录器，将日志文件保存到这个文件夹中。</p><h1 id="f6ac" class="mq mr jf bd ms mt mu mv mw mx my mz na kl nb km nc ko nd kp ne kr nf ks ng nh bi translated">1.日志输入参数</h1><p id="c2e1" class="pw-post-body-paragraph ku kv jf kw b kx ni kg kz la nj kj lc ld nk lf lg lh nl lj lk ll nm ln lo lp ij bi translated">如果您还没有这样做，我强烈建议您将所有的参数放在一个类中，并为每个参数取一个有意义的名称。</p><figure class="me mf mg mh gt is gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/e4ae9cc5b0cdfaa662246a1727e63730.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/0*Pa67oCe17qW8Y6lA"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">请记住:你的日志不只是为你而写的；它们是给每个人的(大部分是未来的你！).</p></figure><p id="ff34" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">现在我们可以创建一个专用文件来记录每个实验的输入参数:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="nn no l"/></div></figure><h1 id="4b09" class="mq mr jf bd ms mt mu mv mw mx my mz na kl nb km nc ko nd kp ne kr nf ks ng nh bi translated">2.日志运行时间</h1><p id="642e" class="pw-post-body-paragraph ku kv jf kw b kx ni kg kz la nj kj lc ld nk lf lg lh nl lj lk ll nm ln lo lp ij bi translated">当我在处理一个复杂的算法时，我会将管道分成有意义的模块。这种结构有助于我理解我的解决方案，它使代码更具可读性和可维护性，并使跟踪运行时和揭示瓶颈变得更容易。</p><p id="8e60" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">记录运行时有无数种方法。<br/>例如，偶尔运行一个像<code class="fe nr ns nt nu b">cProfile</code>这样的分析器，并用<a class="ae np" href="https://stackoverflow.com/a/49173782/2934048" rel="noopener ugc nofollow" target="_blank"> SnakeViz </a>来说明结果是很棒的。这种配置文件的缺点是，它们会带来计算开销，导致不准确，并且每次运行时需要花费太多精力。<br/>因此，我更喜欢维护我自己的精简和简单的运行时记录器:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="bc1f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">然后，在我的算法的<code class="fe nr ns nt nu b">main</code>中，我使用这个运行时记录器来跟踪全局和模块分离的运行时:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="nn no l"/></div></figure><h1 id="6406" class="mq mr jf bd ms mt mu mv mw mx my mz na kl nb km nc ko nd kp ne kr nf ks ng nh bi translated">3.日志 Git 版本</h1><p id="9e5d" class="pw-post-body-paragraph ku kv jf kw b kx ni kg kz la nj kj lc ld nk lf lg lh nl lj lk ll nm ln lo lp ij bi translated">为了确保我们知道我们运行的是哪种算法，我们应该尽可能地记录代码的当前状态。当然，我们可以将整个代码库保存到我们的日志文件夹中，但是… <br/>正如所料，我们将使用 Git 特性来实现这个目标。</p><blockquote class="nv nw nx"><p id="43d8" class="ku kv ny kw b kx ky kg kz la lb kj lc nz le lf lg oa li lj lk ob lm ln lo lp ij bi translated">注意:我知道许多算法专家避免使用版本控制。如果你是他们中的一员，我想指出的是，你偶然发现这篇文章的事实表明，你可能需要一些帮助来跟踪你的研究。Git 就是为此而发明的！我个人可以证明，与一个有组织的系统跟踪我的代码的好处相比，维护修订历史的开销是微不足道的。你相信了吗？从<a class="ae np" href="https://medium.com/@munniomer/an-intro-to-git-and-github-for-beginners-part-i-tutorial-9be4be9cac8d" rel="noopener">这个</a>可理解的教程开始学习基础知识，从<a class="ae np" href="https://medium.com/@daphnaregev/git-level-up-bfbd85444622" rel="noopener">这个</a>开始学习一些高级特性，如果你发现自己在想“该死的饭桶！？!"，就去<a class="ae np" href="https://ohshitgit.com/" rel="noopener ugc nofollow" target="_blank">hoshitgit.com</a>。</p></blockquote><p id="573e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我发现记录以下详细信息很有用:</p><ol class=""><li id="a9d4" class="lq lr jf kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">Git 分支。</li><li id="94c6" class="lq lr jf kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">最新提交的短哈希。</li><li id="d029" class="lq lr jf kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">工作目录和最近一次提交之间的差异。</li></ol><p id="d95c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在我们用 python 代码做这件事之前，让我们确保我们知道如何从终端获取我们需要的东西:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="8ffb" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">添加<code class="fe nr ns nt nu b">-C &lt;path/to/project&gt;</code>确保我们可以从任何地方获得想要的细节:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="886c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">现在我们准备看看如何在我们的 python 代码中做到这一点，使用<a class="ae np" href="https://docs.python.org/3/library/subprocess.html" rel="noopener ugc nofollow" target="_blank">子流程</a>内置包，以及<a class="ae np" href="https://docs.python.org/3/library/pathlib.html" rel="noopener ugc nofollow" target="_blank"> pathlib </a>提取我们的存储库的路径:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="e23a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">现在你手头已经有了所有的信息，我建议将<code class="fe nr ns nt nu b">git_branch</code>和<code class="fe nr ns nt nu b">git_commit_short_hash</code>添加到第一节的输入参数中，并将<code class="fe nr ns nt nu b">git_diff</code>保存到<a class="ae np" href="https://medium.com/transmute-techtalk/improve-your-commit-hygiene-with-git-add-patch-3b7dd9c117c4" rel="noopener">补丁</a>文件中:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="nn no l"/></div></figure><h1 id="c8d0" class="mq mr jf bd ms mt mu mv mw mx my mz na kl nb km nc ko nd kp ne kr nf ks ng nh bi translated">收场白</h1><p id="1054" class="pw-post-body-paragraph ku kv jf kw b kx ni kg kz la nj kj lc ld nk lf lg lh nl lj lk ll nm ln lo lp ij bi translated">如果到目前为止你遵循了说明，那么在每个实验的开始，你会生成一个新的文件夹，<code class="fe nr ns nt nu b">log_&lt;start_time&gt;</code>，在那里你会找到以下有用的文件:</p><pre class="me mf mg mh gt oc nu od oe aw of bi"><span id="147d" class="og mr jf nu b gy oh oi l oj ok">_ log_&lt;start_time&gt;<br/>  |_ git_diff.patch<br/>  |_ log.txt<br/>  |_ params.json<br/>  |_ runtime.json</span></pre><p id="1ccd" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这就是所有的人，我希望你发现这是有用的，并且所有这些日志记录的开销将很快值得。我保证，很快你就会发现你不再浪费时间和精力去绞尽脑汁考虑哪段代码是好的，相反，你将会把所有的精力放在开发令人敬畏的算法上！</p><figure class="me mf mg mh gt is gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/2d1ddf7e0ebb1f515fd719b31814069f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*wtpXMSyjT8QLGQs2eCOstQ.png"/></div></figure></div></div>    
</body>
</html>