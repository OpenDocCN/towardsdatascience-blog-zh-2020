<html>
<head>
<title>Cracking Blackjack — Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">破解 21 点——第四部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/cracking-blackjack-part-4-8b4a9caa38eb?source=collection_archive---------45-----------------------#2020-07-30">https://towardsdatascience.com/cracking-blackjack-part-4-8b4a9caa38eb?source=collection_archive---------45-----------------------#2020-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="f31e" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/Cracking-Blackjack" rel="noopener" target="_blank">破解二十一点</a></h2><div class=""/><div class=""><h2 id="318a" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">初访蒙特卡罗算法+编码吧！</h2></div><p id="32a4" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">嗨！</p><p id="a55f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如果您还没有这样做，请在继续之前阅读<a class="ae lk" href="https://medium.com/@ppalanic/cracking-blackjack-part-1-31da28aeb4bb?source=friends_link&amp;sk=ce1251c59477bf8a6977ef232fd1d234" rel="noopener">第 1 部分</a>、<a class="ae lk" rel="noopener" target="_blank" href="/cracking-blackjack-part-2-75e32363e38?source=friends_link&amp;sk=41bdbc0e16dddd80c172c7ddb039eb42">第 2 部分</a>和<a class="ae lk" rel="noopener" target="_blank" href="/cracking-blackjack-part-3-8fd3a5870efd?source=friends_link&amp;sk=98055a00e2e685239d7148524a2d0b17">第 3 部分</a>。本文的其余部分将假设您已经阅读并理解了前面的文章。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/a7978b05f97abdb221b52a213f2da86f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OpqWu7BFD2fhbHtq"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图片来自<a class="ae lk" href="https://unsplash.com/photos/P787-xixGio" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="dcac" class="mi mj iq bd mk ml mm dn mn mo mp dp mq kx mr ms mt lb mu mv mw lf mx my mz iw bi translated">这篇文章的大纲</h2><p id="c9ef" class="pw-post-body-paragraph ko kp iq kq b kr na ka kt ku nb kd kw kx nc kz la lb nd ld le lf ne lh li lj ij bi translated">在这篇文章中，我将解释首次访问蒙特卡罗(MC)算法是如何工作的，以及我们如何将其应用于 21 点，以教会人工智能代理最大化回报。下面是这篇文章的结构:</p><ol class=""><li id="be81" class="nf ng iq kq b kr ks ku kv kx nh lb ni lf nj lj nk nl nm nn bi translated">从高层次解释算法。</li><li id="7050" class="nf ng iq kq b kr no ku np kx nq lb nr lf ns lj nk nl nm nn bi translated">在第二部分的<a class="ae lk" rel="noopener" target="_blank" href="/cracking-blackjack-part-2-75e32363e38?source=friends_link&amp;sk=41bdbc0e16dddd80c172c7ddb039eb42">中的 OpenAI Gym Blackjack 环境中实现算法。</a></li></ol><p id="9311" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在阅读时，请记住，首次访问 MC 算法的主要影响是定义代理在某个给定状态下采取某个行动获得奖励后应该如何更新其策略。请参考下面的图表来帮助形象化这一点。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nt"><img src="../Images/c93862ffd54fc51e34dcc620c9b79430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R5uAOFbP1GSrOV3UGIAENw.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者制作的图像</p></figure><h1 id="9879" class="nu mj iq bd mk nv nw nx mn ny nz oa mq kf ob kg mt ki oc kj mw kl od km mz oe bi translated">首次访问 MC 算法的 10，000 英尺概述</h1><ol class=""><li id="bbbc" class="nf ng iq kq b kr na ku nb kx of lb og lf oh lj nk nl nm nn bi translated">从<a class="ae lk" rel="noopener" target="_blank" href="/cracking-blackjack-part-2-75e32363e38?source=friends_link&amp;sk=41bdbc0e16dddd80c172c7ddb039eb42">第 2 部分</a>初始化 21 点环境。</li><li id="6cd8" class="nf ng iq kq b kr no ku np kx nq lb nr lf ns lj nk nl nm nn bi translated">定义第三部分中解释的 Q 表、概率表、α、ε、ε衰减、ε最小和γ。</li><li id="0d1c" class="nf ng iq kq b kr no ku np kx nq lb nr lf ns lj nk nl nm nn bi translated">定义您希望您的代理学习多少集。更多的情节通常会产生更有利可图的政策。</li><li id="5e46" class="nf ng iq kq b kr no ku np kx nq lb nr lf ns lj nk nl nm nn bi translated">播放一集。记录剧集中所有的(<strong class="kq ja">状态→动作→奖励)</strong>元组。</li><li id="b853" class="nf ng iq kq b kr no ku np kx nq lb nr lf ns lj nk nl nm nn bi translated">剧集结束后，对ε应用ε-decay/ε-min。</li><li id="3b6d" class="nf ng iq kq b kr no ku np kx nq lb nr lf ns lj nk nl nm nn bi translated">然后，使用来自步骤 4 的(<strong class="kq ja">状态→动作→奖励)</strong>元组和相关公式更新 Q 表和概率表。</li><li id="7764" class="nf ng iq kq b kr no ku np kx nq lb nr lf ns lj nk nl nm nn bi translated">对于步骤 3 中定义的剧集数量，重复步骤 4-6。</li><li id="4173" class="nf ng iq kq b kr no ku np kx nq lb nr lf ns lj nk nl nm nn bi translated">在所有事件之后，产生的 Q 表和概率表代表了 AI 代理刚刚学习的 21 点的优化策略。</li></ol></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="2c75" class="nu mj iq bd mk nv oi nx mn ny oj oa mq kf ok kg mt ki ol kj mw kl om km mz oe bi translated">更详细的步骤 4-6</h1><p id="cdaf" class="pw-post-body-paragraph ko kp iq kq b kr na ka kt ku nb kd kw kx nc kz la lb nd ld le lf ne lh li lj ij bi translated">在上面的概述中，我故意对第 4、5 和 6 步解释不足。这些都需要代码和公式来正确解释，这就是我在这里要做的！我建议打开完整的笔记本，快速查阅我提到的、我没有深入研究的任何更小的功能。在这里找到它<a class="ae lk" href="https://github.com/adithyasolai/Monte-Carlo-Blackjack/blob/master/MC_Blackjack_Part_3_and_4/Monte%20Carlo%20Blackjack%20Part%203_and_4.ipynb" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="9fff" class="mi mj iq bd mk ml mm dn mn mo mp dp mq kx mr ms mt lb mu mv mw lf mx my mz iw bi translated">第 4 步:播放一集</h2><p id="fb7b" class="pw-post-body-paragraph ko kp iq kq b kr na ka kt ku nb kd kw kx nc kz la lb nd ld le lf ne lh li lj ij bi translated">我们将利用<a class="ae lk" rel="noopener" target="_blank" href="/cracking-blackjack-part-2-75e32363e38?source=friends_link&amp;sk=41bdbc0e16dddd80c172c7ddb039eb42">第 2 部分</a>中定义的 21 点环境的功能来模拟一集。我们还将利用 Q 表和概率表。</p><p id="1eb9" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">浏览下面<code class="fe on oo op oq b">play_game()</code>函数的代码片段。之后我会分解关键步骤。</p><figure class="lm ln lo lp gt lq"><div class="bz fp l di"><div class="or os l"/></div></figure><ul class=""><li id="d243" class="nf ng iq kq b kr ks ku kv kx nh lb ni lf nj lj ot nl nm nn bi translated">使用<a class="ae lk" rel="noopener" target="_blank" href="/cracking-blackjack-part-2-75e32363e38?source=friends_link&amp;sk=41bdbc0e16dddd80c172c7ddb039eb42">第二部分</a>中描述的<code class="fe on oo op oq b">env.reset()</code>功能开始一集二十一点。<code class="fe on oo op oq b">reset()</code>函数返回一个<code class="fe on oo op oq b">state</code>:代理必须做出决定的初始状态。这将在我们播放剧集时更新。当我们播放这一集时，一个列表<code class="fe on oo op oq b">episodes</code>将存储所有的(<strong class="kq ja">状态→动作→奖励)</strong>元组。</li></ul><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/8c8dce5ca56adbee9b765f87ed58ed9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:476/format:webp/1*kWIrVQlcFoJDYb6CmSNVQg.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者制作的图像</p></figure><ul class=""><li id="b6e1" class="nf ng iq kq b kr ks ku kv kx nh lb ni lf nj lj ot nl nm nn bi translated">播放一集的全部意义就是记录并返回我们的代理人通过做决定和拿回奖励而产生的(<strong class="kq ja">状态→动作→奖励)</strong>元组。我们的算法将使用这些元组来改变定义我们的代理策略的 Q 表和概率表。</li></ul><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/8acb0aef4bea1b8da8a44b9085068b16.png" data-original-src="https://miro.medium.com/v2/resize:fit:374/format:webp/1*nZs-HwkMNGti9ZS85Z-ZcQ.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者制作的图像</p></figure><ul class=""><li id="5c87" class="nf ng iq kq b kr ks ku kv kx nh lb ni lf nj lj ot nl nm nn bi translated">当<code class="fe on oo op oq b">env.done</code>变成<code class="fe on oo op oq b">True</code>时，我们这一集就结束了。这在第 2 部分的<a class="ae lk" rel="noopener" target="_blank" href="/cracking-blackjack-part-2-75e32363e38?source=friends_link&amp;sk=41bdbc0e16dddd80c172c7ddb039eb42">中有解释。</a></li></ul><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/c28318a9c4b6605733ff1a95ecc519fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*8EG3a1mn0o9zsMyR3c-8bA.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者制作的图像</p></figure><ul class=""><li id="3c89" class="nf ng iq kq b kr ks ku kv kx nh lb ni lf nj lj ot nl nm nn bi translated">如果给代理发了 21 点(21！)幸运的是，在这一集开始时，这一集被废弃了。我们的人工智能代理无法从这一事件中学到任何东西，因为它不需要做出任何决定。我们将返回一个空的<code class="fe on oo op oq b">episode</code>列表。(我们检查<code class="fe on oo op oq b">state[0] == 19</code>，而不是 21，因为我们将所有玩家手牌值减去 2，以满足我们的 21 点环境中的<code class="fe on oo op oq b">observation_space</code>。)(参见<a class="ae lk" rel="noopener" target="_blank" href="/cracking-blackjack-part-2-75e32363e38?source=friends_link&amp;sk=41bdbc0e16dddd80c172c7ddb039eb42">第二部分</a>或<a class="ae lk" href="https://github.com/adithyasolai/Monte-Carlo-Blackjack/blob/master/MC_Blackjack_Part_3_and_4/Monte%20Carlo%20Blackjack%20Part%203_and_4.ipynb" rel="noopener ugc nofollow" target="_blank">代码</a>。)</li></ul><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ox"><img src="../Images/0857871a7d12baeea861d19d48045ef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AqRaZOfe6oDRyuJErdAFYQ.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者制作的图像</p></figure><ul class=""><li id="4408" class="nf ng iq kq b kr ks ku kv kx nh lb ni lf nj lj ot nl nm nn bi translated">否则，代理必须决定一个行动:打或站。它使用 Q 表来确定对于给定的<code class="fe on oo op oq b">state</code>，哪个动作当前具有最高值(或 Q 值)。<strong class="kq ja">这个</strong> <code class="fe on oo op oq b"><strong class="kq ja">state</strong></code> <strong class="kq ja">的击中和站立的这些 Q 值将在本集之后在我们算法的步骤 6 中更新。</strong></li></ul><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi oy"><img src="../Images/3766ad55794aace63e6e7da9ae3dfdd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oEGHxcF6qogofKOzG0OOyw.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者制作的图像</p></figure><ul class=""><li id="114a" class="nf ng iq kq b kr ks ku kv kx nh lb ni lf nj lj ot nl nm nn bi translated">接下来，ε(出自<a class="ae lk" rel="noopener" target="_blank" href="/cracking-blackjack-part-3-8fd3a5870efd?source=friends_link&amp;sk=98055a00e2e685239d7148524a2d0b17">第三部</a>)和<strong class="kq ja">探索</strong>和<strong class="kq ja">开拓</strong>之间的微妙平衡就要发挥作用了。我们使用这个概率表来找出选择<code class="fe on oo op oq b">best_action</code>的概率。然后，我们使用这个分布随机决定一个动作。如果我们由于低ε而处于<strong class="kq ja">利用</strong>阶段，则<code class="fe on oo op oq b">best_action</code>极有可能被选中。如果我们由于高ε而处于<strong class="kq ja">探索</strong>阶段，我们的代理有更大的机会选择<code class="fe on oo op oq b">best_action</code>的反面。这是该算法如何利用随机策略和蒙特卡罗方法的一个完美例子:<em class="oz">它使用随机性来处理本质上确定性的问题</em>。<strong class="kq ja">这个</strong> <code class="fe on oo op oq b"><strong class="kq ja">state</strong></code> <strong class="kq ja">的这些击中和站立的概率将在本集之后在我们算法的步骤 6 中更新。</strong></li></ul><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi pa"><img src="../Images/224c4164a870abd68d91dce63137509b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TkYeaPYLBgce0hSXzh-5kQ.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者制作的图像</p></figure><ul class=""><li id="782d" class="nf ng iq kq b kr ks ku kv kx nh lb ni lf nj lj ot nl nm nn bi translated">接下来，代理使用<code class="fe on oo op oq b">env.step()</code>函数提交到<code class="fe on oo op oq b">action_to_take</code>(参见<a class="ae lk" rel="noopener" target="_blank" href="/cracking-blackjack-part-2-75e32363e38?source=friends_link&amp;sk=41bdbc0e16dddd80c172c7ddb039eb42">第 2 部分</a>了解更多关于<code class="fe on oo op oq b">env.step()</code>)。代理收到一个<code class="fe on oo op oq b">next_state</code>并因其动作获得奖励。<code class="fe on oo op oq b">env.done</code>也更新了。</li></ul><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi pb"><img src="../Images/1d9ee2bf9ddff1bae1c94e248606f276.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1CCUEfpDpqzGY23-MaslZQ.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者制作的图像</p></figure><ul class=""><li id="978c" class="nf ng iq kq b kr ks ku kv kx nh lb ni lf nj lj ot nl nm nn bi translated">我们仍然可以访问<code class="fe on oo op oq b">state</code>——我们开始时的状态。我们仍然可以访问<code class="fe on oo op oq b">action_to_take</code>——我们在<code class="fe on oo op oq b">state</code>采取的行动。我们也是刚刚收到<code class="fe on oo op oq b">state</code>里拿<code class="fe on oo op oq b">action_to_take</code>的<code class="fe on oo op oq b">reward</code>。所以我们有一个(<strong class="kq ja">状态→动作→奖励)</strong>元组要添加到<code class="fe on oo op oq b">episode</code>！</li></ul><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi pc"><img src="../Images/8f34fbb68a8b1555be962a3b7c4c52a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R4b1IhxKGejs8MIlbvEOtg.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者制作的图像</p></figure><ul class=""><li id="7209" class="nf ng iq kq b kr ks ku kv kx nh lb ni lf nj lj ot nl nm nn bi translated">最后，我们设置<code class="fe on oo op oq b">state = next_state</code>重复这个过程，直到<code class="fe on oo op oq b">env.done</code>变为<code class="fe on oo op oq b">True</code>。</li></ul></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="811e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja"> <em class="oz">我们将在这里停止这篇文章，因为我想让这些信息以更小的、一口大小的部分来消化！</em> </strong></p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="67ca" class="mi mj iq bd mk ml mm dn mn mo mp dp mq kx mr ms mt lb mu mv mw lf mx my mz iw bi translated">下一步是什么</h2><p id="e4fb" class="pw-post-body-paragraph ko kp iq kq b kr na ka kt ku nb kd kw kx nc kz la lb nd ld le lf ne lh li lj ij bi translated">在下一篇文章中，我们将直接深入讨论<strong class="kq ja">步骤 5 </strong>和<strong class="kq ja">步骤 6 </strong>，就像我们讨论<strong class="kq ja">步骤 4 </strong>一样。</p><p id="1c17" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在理解了<strong class="kq ja">步骤 5 </strong>和<strong class="kq ja">步骤 6 </strong>之后，你将了解这种强化学习算法的所有技术方面。然而，解决人工智能/人工智能问题既是一门科学又是一门艺术</p><p id="e9a1" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在之后的文章中，我们将更深入地探讨这个 21 点问题的<strong class="kq ja">艺术</strong>部分。我们将通过对α、ε和γ进行实验，展示如何优化该算法。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="f32f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">感谢您的阅读！</p><p id="6a50" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我真的很感激任何形式的反馈！我想成为一个更一致、更有效的内容创作者。</p><p id="f676" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">你学到什么了吗？我很难理解吗？</p><p id="3cbc" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">欢迎在下面留言或发电子邮件给我，地址是 adithyasolai7@gmail.com！</p><p id="8d63" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><a class="ae lk" href="https://github.com/adithyasolai/Monte-Carlo-Blackjack" rel="noopener ugc nofollow" target="_blank">本项目的 GitHub 回购。</a></p><p id="816b" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在这里阅读<a class="ae lk" href="https://medium.com/@ppalanic/cracking-blackjack-part-5-70bd2f726133?source=friends_link&amp;sk=d27caa3eb27b111aacade0f9dd5d41e6" rel="noopener">第五部分</a>。</p></div></div>    
</body>
</html>