<html>
<head>
<title>Mahalanobis Distance and Multivariate Outlier Detection in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R 中的马氏距离和多元异常检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mahalonobis-distance-and-outlier-detection-in-r-cb9c37576d7d?source=collection_archive---------4-----------------------#2020-05-12">https://towardsdatascience.com/mahalonobis-distance-and-outlier-detection-in-r-cb9c37576d7d?source=collection_archive---------4-----------------------#2020-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5afe" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">寻找破坏线性的异常值</h2></div><p id="452e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">马哈拉诺比斯距离(MD)是一种有效的距离度量，用于计算点和分布之间的距离(<a class="ae le" href="https://en.wikipedia.org/wiki/Mahalanobis_distance" rel="noopener ugc nofollow" target="_blank">参见</a>)。它对多元数据非常有效。MD 之所以对多元数据有效，是因为它利用变量之间的协方差来求两点的距离。换句话说，Mahalanobis 通过考虑标准差(P1 离 P2 有多少标准差)来计算“P1”点和“P2”点之间的距离。当异常值被认为是多元的时，MD 也给出可靠的结果。为了通过 MD 发现离群点，计算 n 维数据中每个点与中心的距离，并通过考虑这些距离来发现离群点。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/2debd9d0fcb1e1f18bcf8e7309b3cc5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xy89JzLoBXGGgZRFGXBBmg.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@will_myers?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">威尔·迈尔斯</a>在<a class="ae le" href="https://unsplash.com/s/photos/outliers?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h2 id="61b5" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">目录</h2><ul class=""><li id="506f" class="mo mp it kk b kl mq ko mr kr ms kv mt kz mu ld mv mw mx my bi translated">马氏距离和欧氏距离</li><li id="6b6f" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">用 MD 求两点间的距离</li><li id="488d" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">利用 R 中的马氏距离发现异常值</li><li id="7d3a" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">结论</li></ul><p id="a6f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您对如何使用 Python 中的 Mahalanobis 距离来检测异常值感兴趣，您可以查看我下面的另一篇文章。</p><div class="ne nf gp gr ng nh"><a rel="noopener follow" target="_blank" href="/multivariate-outlier-detection-in-python-e946cfc843b3"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">Python 中的多元异常检测</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">Python 中的多元异常值和马氏距离</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">towardsdatascience.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv lp nh"/></div></div></a></div><h2 id="43f0" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">马氏距离和欧氏距离</h2><p id="ae9a" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">欧几里德距离也通常用于寻找 2 维或 2 维以上空间中两点之间的距离。但是，与欧几里得不同，MD 使用协方差矩阵。正因为如此，当两个或多个变量高度相关时，即使它们的尺度不同，MD 也能很好地工作。但是，当两个或多个变量不在同一尺度上时，欧几里得距离结果可能会误导。因此，在找到这些点之间的距离之前，必须计算变量的 Z 得分。此外，如果变量高度相关，欧几里得就不够好。</p><p id="4b7b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们检查欧几里得和 MD 公式，</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nz"><img src="../Images/5378e78853d478a2cd9e771eeb978d64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zW036muuuO9GDnY_-qVEnA.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">n 维欧氏距离公式</p></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nz"><img src="../Images/09ae57006a964491f03535a18963f4db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6W62Im30H1a3L_oc36oUUw.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">马氏距离公式</p></figure><p id="ffd4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从公式中可以看出，与欧几里得不同，MD 使用协方差矩阵(位于 C ^(-1 的中间)。在欧几里得公式中，p 和 q 代表要计算距离的点。“n”代表多元数据中变量的个数。</p><p id="03ee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">通过 MD 寻找两点间的距离</strong></p><p id="2dda" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们有 5 行 2 列数据。正如您所猜测的，数据中的每一行都代表二维空间中的一个点。</p><pre class="lg lh li lj gt oa ob oc od aw oe bi"><span id="f48e" class="lv lw it ob b gy of og l oh oi">      V1    V2<br/>    ----- -----<br/> P1   5     7  <br/> P2   6     8  <br/> P3   5     6<br/> P4   3     2<br/> P5   9     11</span></pre><p id="ec9b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们画一个 V1 和 V2 的散点图，</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/aff05c915c5ef2997eeade622e975150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*oVIcQVwrmwxU79MicQcQuw.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">V1 和 V2 散点图</p></figure><p id="8573" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">橙色点表示这两个变量的中心(平均值),黑点表示数据框中的每一行。现在，让我们试着找出 P2 和 P5 之间的马氏距离；</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ok"><img src="../Images/d127af7a41e714ddaf37ea29e0823b05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fDMBb9rsOr1A1c8Hs_42sQ.jpeg"/></div></div></figure><p id="8489" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据上面的计算，P2 和 P5 之间的距离为 4.08。</p><h2 id="5756" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">利用 R 中的马氏距离发现异常值</h2><p id="4da1" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">如前所述，MD 对于发现多元数据的异常值非常有效。特别是，如果变量之间存在线性关系，MD 可以计算出哪些观察值破坏了线性关系。与另一个例子不同，为了找到异常值，我们需要找到每个点和中心之间的距离。中心点可以表示为多元数据中每个变量的平均值。</p><p id="71e8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个例子中，我们可以使用 R 中预定义的数据，称为“空气质量”。我们将“温度”和“臭氧”值作为我们的变量。这是我们需要遵循的步骤列表；</p><ul class=""><li id="eb40" class="mo mp it kk b kl km ko kp kr ol kv om kz on ld mv mw mx my bi translated">找到“臭氧”和“温度”的中心点。</li><li id="dc27" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">计算“臭氧”和“温度”的协方差矩阵。</li><li id="4483" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">求各点到中心的马氏距离。</li><li id="32f4" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">从卡方分布中寻找临界值</li><li id="901d" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">选择小于截止值的距离(这些值不是异常值)。</li></ul><p id="40df" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是计算中心和协方差矩阵的代码；</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="4d10" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在计算距离之前，让我们绘制数据，并通过考虑中心点和协方差矩阵绘制一个椭圆。我们可以通过使用“car”包中的椭圆函数来找到椭圆坐标。“椭圆”函数有 3 个重要参数；中心、形状和半径。中心代表变量的平均值，形状代表协方差矩阵，半径应该是具有 2 个自由度和 0.95 概率的卡方值的平方根。我们采用概率值 0.95，因为超出 0.95 将被视为异常值，自由度为 2，因为我们有两个变量“臭氧”和“温度”。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="a84b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">找到我们的椭圆坐标后，我们可以用“ggplot2”包创建我们的散点图；</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="a357" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面，代码片段将返回散点图下方；</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oq"><img src="../Images/5ba0002e90002f46a251ecc2f97c7646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UBwtHr6StsYgTGZfoWBbSg.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">臭氧和风变量散点图</p></figure><p id="2620" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">图上的蓝点表示中心点。黑点是臭氧——风变量的观测值。如您所见，点 30、62、117 和 99 位于橙色椭圆之外。这意味着这些点可能是异常值。如果我们认为这个椭圆是在协方差、中心和半径上绘制的，我们可以说我们可能已经找到了与 Mahalanobis 距离的异常值相同的点。在多维中，我们不画椭圆，但是我们计算每个点和中心之间的距离。找到距离后，我们使用卡方值作为截止值，以识别异常值(与上面示例中的椭圆半径相同)。</p><p id="a01c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">stats 包中 R 附带的“mahalanobis”函数返回每个点和给定中心点之间的距离。这个函数也有 3 个参数“x”、“center”和“cov”。你可以猜到，“x”是多元数据(矩阵或数据框)，“center”是变量中心点的向量，“cov”是数据的协方差矩阵。这一次，在获得卡方截止值时，我们不应该求平方根。因为，MD 已经返回了 D(平方)距离(从 MD 公式可以看出)。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="8280" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">终于！我们已经确定了多元数据中的异常值。发现异常值 30。62.99.117.观察值(行)与散点图中椭圆外的点相同。</p><h2 id="4fe5" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">结论</h2><p id="a64f" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">在这篇文章中，我们讨论了从理论到实践的“马哈拉诺比斯距离”。除了从公式计算两点之间的距离，我们还学习了如何使用它来发现 r 中的异常值。虽然 MD 在机器学习中不太常用，但它在定义多元异常值时非常有用。</p><p id="0066" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您有任何问题，请随时留下您的意见。但是，您可能会对我的另一篇文章感兴趣，这篇文章讲述了如何从头开始使用 Python 中的 Mahalonobis 距离来检测异常值。</p><div class="ne nf gp gr ng nh"><a rel="noopener follow" target="_blank" href="/multivariate-outlier-detection-in-python-e946cfc843b3"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">Python 中的多元异常检测</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">Python 中的多元异常值和马氏距离</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">towardsdatascience.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv lp nh"/></div></div></a></div></div></div>    
</body>
</html>