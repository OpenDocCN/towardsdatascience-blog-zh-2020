<html>
<head>
<title>Web Scraper with Search Tool for Los Angeles Apartments &amp; Neighborhoods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有洛杉矶公寓和社区搜索工具的网络搜索工具</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/web-scraper-with-search-tool-for-los-angeles-apartments-neighborhoods-4b1958ef7500?source=collection_archive---------40-----------------------#2020-01-09">https://towardsdatascience.com/web-scraper-with-search-tool-for-los-angeles-apartments-neighborhoods-4b1958ef7500?source=collection_archive---------40-----------------------#2020-01-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/dd91890a5fa48a88fa01356e90e0111a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fW3t9dxVbWU1Kd1XXS-9sw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">概念验证公寓和邻居指标</p></figure><div class=""/><p id="8df2" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">作为一名洛杉矶的常住居民，我发现在这个城市找到符合你要求的出租房可能会很棘手。在像Craigslist和apartments这样的网络数据库中，帖子包含了关于公寓本身的丰富信息。然而，<strong class="kh jj">缺少邻居数据… </strong>为了全面了解公寓邻居，用户必须建立单独的邻居数据库，并手动交叉引用公寓列表。另一个障碍是，像Craigslist和Apartments.com<strong class="kh jj">这样的网站不提供每套公寓的指标</strong>或邻居基准，这使得用户在选择他们在洛杉矶想要的公寓和邻居时，无法做出<strong class="kh jj">完全知情的</strong>决定</p><h2 id="78c7" class="ld le ji bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">拟议解决方案</h2><p id="b6c6" class="pw-post-body-paragraph kf kg ji kh b ki lw kk kl km lx ko kp kq ly ks kt ku lz kw kx ky ma la lb lc im bi translated">为了解决洛杉矶出租房屋信息的缺口，我创建了一个<strong class="kh jj"> Craigslist公寓搜索工具和增强的搜索工具</strong>。该项目使用Python &amp; SQLite构建，将洛杉矶Craigslist公寓与社区经济和无家可归者指标相结合。概念验证(POC)现已在我的Github页面上提供用户友好的指南- &gt; <a class="ae mb" href="https://github.com/mann-brinson/LA_Apartments_Scraper" rel="noopener ugc nofollow" target="_blank"> <strong class="kh jj">此处</strong> </a>。</p><p id="5099" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">POC目前包括:</p><ul class=""><li id="3a4a" class="mc md ji kh b ki kj km kn kq me ku mf ky mg lc mh mi mj mk bi translated"><strong class="kh jj">Python脚本的存储库</strong>，它执行web抓取、数据库生成和测试查询。</li><li id="b854" class="mc md ji kh b ki ml km mm kq mn ku mo ky mp lc mh mi mj mk bi translated"><strong class="kh jj"> Python Jupyter Notebook </strong>，它显示查询结果、一些简单的生成指标散点图，以及对这些指标的数据进行排序的可能性</li></ul><p id="55b4" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下面我将提供python代码每个组件设计背后的一些细节，突出优点和缺点。该项目基于2019年秋季南加州大学维特比工程学院应用数据科学硕士项目的一门课程的作业，由Jeremy Abramson教授提供建议。我也从Julio Malegria的<a class="ae mb" href="https://github.com/juliomalegria/python-craigslist" rel="noopener ugc nofollow" target="_blank"> python-craigslist模块</a>和<a class="mq mr ep" href="https://medium.com/u/9c5141816177?source=post_page-----4b1958ef7500--------------------------------" rel="noopener" target="_blank"> Riley Predum </a>的<a class="ae mb" rel="noopener" target="_blank" href="/web-scraping-craigslist-a-complete-tutorial-c41cea4f4981"> Craigslist网页抓取教程</a>中获得了灵感。我从这些已有的知识中学到了很多，并希望能在此基础上更上一层楼！</p><h2 id="f310" class="ld le ji bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">脚本驱动程序</h2><p id="a4b4" class="pw-post-body-paragraph kf kg ji kh b ki lw kk kl km lx ko kp kq ly ks kt ku lz kw kx ky ma la lb lc im bi translated">为了给python脚本和结果数据库创建一些组织，我用两个子文件夹构建了存储库:</p><ul class=""><li id="8e70" class="mc md ji kh b ki kj km kn kq me ku mf ky mg lc mh mi mj mk bi translated"><strong class="kh jj"> src </strong> —保存用于生成数据库的所有脚本，包括:驱动文件、python模块需求、公寓刮刀、邻居刮刀和测试查询</li><li id="4e0c" class="mc md ji kh b ki ml km mm kq mn ku mo ky mp lc mh mi mj mk bi translated"><strong class="kh jj">数据</strong> —保存SQLite数据库，该数据库包含公寓和邻居抓取脚本的结果</li></ul><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ms"><img src="../Images/7394e44a749c7e136b00ca38f1a0430c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ckBpYxM_u_RWN3GvFT0nEw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">python脚本、数据、查询和图形的报告结构</p></figure><h2 id="7a85" class="ld le ji bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">使用驱动程序获取数据</h2><p id="7f36" class="pw-post-body-paragraph kf kg ji kh b ki lw kk kl km lx ko kp kq ly ks kt ku lz kw kx ky ma la lb lc im bi translated">下载存储库并导航到终端内的“src”文件夹后，用户可以使用远程或本地数据调用驱动程序文件“LA_Apartment_Analysis.py”。可以输入的两个命令是:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="2fa9" class="ld le ji my b gy nc nd l ne nf">$ python3 LA_Apartment_Analysis.py local<br/>$ python3 LA_Apartment_Analysis.py remote</span></pre><ul class=""><li id="fab4" class="mc md ji kh b ki kj km kn kq me ku mf ky mg lc mh mi mj mk bi translated"><strong class="kh jj">本地</strong> —用本地数据库(缓存)运行程序，如果有的话。如果本地数据库不存在，您将需要远程运行程序，以便在分析(也称为查询)完成之前生成一个本地数据库。</li><li id="e514" class="mc md ji kh b ki ml km mm kq mn ku mo ky mp lc mh mi mj mk bi translated"><strong class="kh jj"> remote </strong> —首先从‘neighborhoods _ API . py’和‘apartments _ scrape . py’中的远程web源创建数据库，然后运行程序。</li></ul><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">从命令行调用的驱动程序文件“LA_Apartment_Analysis.py”，用于调用抓取器和查询</p></figure><h2 id="d599" class="ld le ji bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">Craigslist网页抓取</h2><p id="3cf1" class="pw-post-body-paragraph kf kg ji kh b ki lw kk kl km lx ko kp kq ly ks kt ku lz kw kx ky ma la lb lc im bi translated">司机调用公寓抓取器‘apartments _ scrape . py’后，Craigslist公寓抓取就开始了。代码被彻底地注释了，所以人们可以在那里回顾每一步，但是我在下面强调了scraper的主要步骤。这里使用的主要python库是:requests、BeautifulSoup、pandas和sqlite3。</p><p id="e395" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh jj">步骤1:创建一个craigslist公寓搜索查询，并获得所有公寓链接的列表。</strong></p><p id="79c4" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了验证概念，我的默认搜索是洛杉矶有照片的公寓，今天发布的租金价格在1800-2800美元之间，距离邮政编码90036(贝弗利-费尔法克斯区)3英里。如果用户的查询有超过120个结果，应该激活第201–212行，以便从包含许多公寓列表的多个页面中获取链接。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">get_link_list(url_query)生成包含嵌入公寓链接的html对象列表</p></figure><p id="caef" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh jj">步骤2:对于每个公寓链接，从链接的html对象中解析公寓属性，并存储在字典列表中。</strong></p><p id="eb12" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">名为‘process _ links(link _ list)’的函数获取每个链接，并发送一个对该链接的html对象的请求。请求成功完成后，代码提取嵌入在hmtl对象中的有意义的公寓属性，比如:卧室、浴室、价格、平方英尺、纬度和经度。</p><p id="f23b" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在当前代码中，大约70–80%的公寓列表的公寓抓取是成功的。如果一个单元属性不能被抓取，代码继续尝试抓取下一个单元。这就是为什么我们在处理请求时实现了大量的异常处理。在未来的迭代中，我希望将所有公寓房源的成功率提高到100%。</p><p id="bcb8" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">处理链接的速度可以接受，但是速度可以通过<a class="ae mb" href="https://realpython.com/python-concurrency/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh jj"> python并发</strong> </a>来提高。使用python实现并发性将允许在同一台计算机的多个处理器中同时执行任务。这应该是提高处理速度的可行途径，但我们也必须尊重Craigslist的限速政策，以避免该网站可能维持的任何IP禁止政策。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">process_links(link_list)接受一个链接列表，并为每个单元链接创建一个一行的单元属性表</p></figure><p id="e2a0" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh jj">步骤3:对于每个公寓纬度&amp;经度，获取人口普查区域ID。</strong></p><p id="41cc" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这一步对于实现到洛杉矶邻居表的连接至关重要。为此，我们必须在一个GET API请求中向geocoding.geo.census.gov发送每个公寓的纬度和经度。由于census提供的这个API的性能较慢，这个步骤比Craigslist抓取花费的时间要长得多…在未来的版本中，我将实现一些python并发来减少处理时间。这仍然不会对人口普查地理编码器API的缓慢产生影响。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">request _ tractid(apt _ tractid _ URL _ list)接受一个人口普查api urls列表，并返回具有apartment tract_id的相关json对象。</p></figure><p id="9961" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">步骤4:在SQLite表中存储公寓属性和人口普查区域id。</p><p id="8d6d" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了序列化收集的数据，代码获取字典列表，并将它们转换成pandas数据帧。接下来，代码移动到/data存储库中，并创建名为“la_apartments.db”的SQLite数据库和一个名为“apartment”的表。最后，公寓数据帧的每一行都被复制到“公寓”表中。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">存储熊猫数据帧中的公寓表</p></figure><h2 id="519b" class="ld le ji bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">洛杉矶邻里API</h2><p id="04c8" class="pw-post-body-paragraph kf kg ji kh b ki lw kk kl km lx ko kp kq ly ks kt ku lz kw kx ky ma la lb lc im bi translated">在这一步中，我们使用“neighborhoods_api.py”脚本构建一个邻域表。邻域表将包含每年每个人口普查区域ID的一行。邻域属性从两个独立的站点获取，都是通过<strong class="kh jj"> API功能</strong>。由于这些站点提供API服务来获取数据，因此创建“邻居”表所需的时间比创建“公寓”表要少得多。</p><p id="e7e0" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">用于收集邻域数据的两个来源如下:</p><ul class=""><li id="dd72" class="mc md ji kh b ki kj km kn kq me ku mf ky mg lc mh mi mj mk bi translated"><strong class="kh jj">洛杉矶市— </strong>该站点包含基本的社区属性，如TRACT_ID、COUNTY、YEAR、POPULATION。到数据集和API文档的链接是<a class="ae mb" href="https://geohub.lacity.org/datasets/enriched-la-county-census-tracts-2015/data?geometry=-118.704%2C33.941%2C-117.894%2C34.140" rel="noopener ugc nofollow" target="_blank"> <strong class="kh jj">这里是</strong> </a></li><li id="b9cb" class="mc md ji kh b ki ml km mm kq mn ku mo ky mp lc mh mi mj mk bi translated"><strong class="kh jj">南加州大学社会创新价格中心— </strong>该网站包含一系列不同的社区数据集，按人口普查区域ID排列。使用的主要数据集:平均租金价格数据集— <a class="ae mb" href="https://usc.data.socrata.com/Los-Angeles/Rent-Price-LA-/4a97-v5tx" rel="noopener ugc nofollow" target="_blank"> <strong class="kh jj">此处</strong></a>；无家可归数据集— <a class="ae mb" href="https://usc.data.socrata.com/Los-Angeles/Homelessness-LA-/e7n7-i6jm" rel="noopener ugc nofollow" target="_blank"> <strong class="kh jj">此处</strong> </a></li></ul><p id="e7cc" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">通过API收集邻域数据后,“neighborhoods_api.py”使用pandas来转换数据，以组合来自三个来源的属性。然后，该表作为“邻居”表写入SQLite数据库。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">存储熊猫数据帧中的邻居表</p></figure><h2 id="f023" class="ld le ji bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">查询和散点图</h2><p id="60bd" class="pw-post-body-paragraph kf kg ji kh b ki lw kk kl km lx ko kp kq ly ks kt ku lz kw kx ky ma la lb lc im bi translated">在数据库中创建了“公寓”和“邻居”表之后，驱动程序从“查询_来自_终端. py”中调用测试查询。结果显示在终端中，显示一些关于关系数据库的基本查询。</p><p id="8bc5" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果用户愿意，他们可以通过Jupyter笔记本“mann_mark.ipynb”查看查询结果和一些额外的散点图。查询和绘图提供了对公寓搜索过程至关重要的先前未回答的问题的洞察力。最终，这个数据库和查询可以构建到单页面web应用程序中的交互式搜索工具中。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ni"><img src="../Images/c1f0ccfe0a99e7c034827cf7cda2ae47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IgTRuX8HdLIPYAoE1Pfm_g.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来自Jupyter笔记本“mann_mark.ipynb ”,显示计算指标，如“价格每平方英尺”和“无家可归者每平方英尺”</p></figure><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nj"><img src="../Images/0322e637c24b6fa03948ed8cea42d9f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lDJZeja4bz8jsjs-bzMDHQ.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">散点图展示了如何根据计算出的指标可视化公寓数据</p></figure><h2 id="b8f3" class="ld le ji bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">未来版本</h2><p id="1906" class="pw-post-body-paragraph kf kg ji kh b ki lw kk kl km lx ko kp kq ly ks kt ku lz kw kx ky ma la lb lc im bi translated">将来，我希望创建一个连接到这个公寓和邻居数据库的web应用程序。在web应用程序中，用户可以查询他们自己对洛杉矶公寓的偏好。将有一个选项供用户设置重复工作(每天，每周，每月)和发送电子邮件时，数据被刷新。还可以选择从数据库下载标准化报告，或者公寓和邻居表本身。</p><p id="370a" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">突出显示人口普查区域和公寓位置的地图工具也会有所帮助。在这个工具中，用户可以根据邻居的度量标准，比如每平方英里无家可归的人数，来给邻居着色。下面是一个工具的例子，我想在未来创造。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nk"><img src="../Images/d7a3ad4210f65efa58abee9e5ee031d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SQjvywnWTGvf0xeyVnjVJQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">每平方英里的无家可归者地图，每个区域id。使用datawrapper [ <a class="ae mb" href="https://datawrapper.dwcdn.net/e1Wqn/1/" rel="noopener ugc nofollow" target="_blank">链接</a>创建的映射</p></figure><p id="83bd" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果你已经做到这一步，感谢你的阅读！我乐于接受问题、评论或反馈。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="dae6" class="pw-post-body-paragraph kf kg ji kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><em class="ns">原载于2020年1月9日</em><a class="ae mb" href="https://medium.com/@mann.brinson/web-scraper-with-search-tool-for-los-angeles-apartments-neighborhoods-c218835eff2a" rel="noopener"><em class="ns">【https://medium.com】</em></a><em class="ns">。</em></p></div></div>    
</body>
</html>