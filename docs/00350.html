<html>
<head>
<title>Scheduled Web Scraping with Django and Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django 和 Heroku 安排的网页抓取</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scheduled-web-scraping-with-django-and-heroku-e832e1363c7a?source=collection_archive---------3-----------------------#2020-01-11">https://towardsdatascience.com/scheduled-web-scraping-with-django-and-heroku-e832e1363c7a?source=collection_archive---------3-----------------------#2020-01-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="feeb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建一个 django 应用程序，每天抓取求职公告板</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4dc18307c953435a97f7d89e47acf3e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ra0Qe55vmUPjkxZ6ZnxIAg.png"/></div></div></figure><p id="1bbd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们经常需要大量的训练数据来进行机器学习，网页抓取可以是获取这些数据的一种方式。</p><p id="b4f3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但在过去，有一家公司是我非常想去工作的。他们目前没有数据科学的职位，但他们一有，我就想申请。</p><p id="1221" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">解决办法？每天查看他们的工作公告板，这样每当有新工作发布时，我都会得到通知。</p><p id="9b0c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们构建一个简单的 django 应用程序，部署到 Heroku，并每天创建一个工作公告板。</p><h1 id="cd9c" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">设置应用程序</h1><p id="77a9" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">为应用程序创建目录，并将<code class="fe mn mo mp mq b">cd</code>放入其中。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="6dc5" class="mv lr it mq b gy mw mx l my mz">mkdir jobs &amp;&amp; cd jobs</span></pre><p id="5b7f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在您喜欢的任何代码编辑器中打开它。我用的是 Sublime。</p><p id="d412" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建并启动我们的虚拟环境。然后安装我们需要的软件包。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="50a1" class="mv lr it mq b gy mw mx l my mz">python -m venv env<br/>source env/bin/activate<br/>pip3 install django psycopg2 django-heroku bs4 gunicorn</span></pre><p id="4e88" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建项目(django 版本的 web 应用程序)。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="55fe" class="mv lr it mq b gy mw mx l my mz">django-admin startproject jobs</span></pre><p id="0218" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mn mo mp mq b">cd</code>进入项目，创建一个 app 进行抓取。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="0b2e" class="mv lr it mq b gy mw mx l my mz">cd jobs<br/>django-admin startapp scraping</span></pre><h1 id="7b0f" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">创建工作模型</h1><p id="aad1" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">我们只需要在这个应用程序中定义一个模型，一个作业模型。这代表我们将收集的工作。</p><p id="1c0d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用以下内容覆盖<code class="fe mn mo mp mq b">/scraping/models.py</code>。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="166a" class="mv lr it mq b gy mw mx l my mz">from django.db import models<br/>from django.utils import timezone</span><span id="f3de" class="mv lr it mq b gy na mx l my mz">class Job(models.Model):<br/>    url = models.CharField(max_length=250, unique=True)<br/>    title = models.CharField(max_length=250)<br/>    location = models.CharField(max_length=250)<br/>    created_date = models.DateTimeField(default=timezone.now)</span><span id="4520" class="mv lr it mq b gy na mx l my mz">    def __str__(self):<br/>        return self.title</span><span id="99bb" class="mv lr it mq b gy na mx l my mz">    class Meta:<br/>        ordering = ['title']</span><span id="436b" class="mv lr it mq b gy na mx l my mz">    class Admin:<br/>        pass</span></pre><p id="bb8c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe mn mo mp mq b">/scraping/admin.py</code>中注册您的模型。这允许我们在 Django 的默认管理面板中查看记录(我们很快会谈到这一点)。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="d097" class="mv lr it mq b gy mw mx l my mz">from scraping.models import Job<br/>admin.site.register(Job)</span></pre><p id="f64d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将<code class="fe mn mo mp mq b">scraping</code>添加到<code class="fe mn mo mp mq b">/jobs/settings.py</code>中已安装的应用中。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="14bd" class="mv lr it mq b gy mw mx l my mz">INSTALLED_APPS = [<br/>    'django.contrib.admin',<br/>    'django.contrib.auth',<br/>    'django.contrib.contenttypes',<br/>    'django.contrib.sessions',<br/>    'django.contrib.messages',<br/>    'django.contrib.staticfiles',<br/>    'scraping'<br/>]</span></pre><h1 id="8f58" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">设置数据库</h1><p id="b122" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">设置数据库。我喜欢 postgres，所以我们要用它。</p><p id="adf7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此时，确保您之前已经在 mac 上用<code class="fe mn mo mp mq b">brew</code>安装了 postgres 并启动了它(这超出了本文的范围)。</p><p id="2adc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在命令行上为此项目创建一个数据库。您可以使用下面的命令打开 postgres 控制台。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="d2de" class="mv lr it mq b gy mw mx l my mz">psql -d template1</span></pre><p id="8fc0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建用户和数据库，然后退出。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="3c34" class="mv lr it mq b gy mw mx l my mz">create user django_user;<br/>create database django_jobs owner django_user;<br/>\q</span></pre><p id="b84d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe mn mo mp mq b">/jobs/settings.py</code>中，更新<code class="fe mn mo mp mq b">DATABASES</code>。在其他框架中，您可能希望专门针对开发环境来确定范围，但是在这里我们不会担心这个问题。不管怎样，它在 Heroku 上会起作用的(我们很快就会到达那里)。</p><p id="2b71" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意，这些是我们在上面创建的用户名和数据库名。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="20ee" class="mv lr it mq b gy mw mx l my mz">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.postgresql_psycopg2',<br/>        'NAME': 'django_jobs',<br/>        'USER': 'django_user',<br/>        'HOST': '',<br/>        'PORT': ''<br/>    }<br/>}</span></pre><p id="bdba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建迁移，并从命令行迁移数据库。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="07d8" class="mv lr it mq b gy mw mx l my mz">python manage.py makemigrations<br/>python manage.py migrate</span></pre><p id="0b7f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将创建一个名为<code class="fe mn mo mp mq b">scraping_job</code>的表。这是一个 django 名称空间约定，因为它属于<code class="fe mn mo mp mq b">scraping</code>应用程序。</p><p id="3186" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在创建一个超级用户，并在命令行中给它一个密码。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="8eb7" class="mv lr it mq b gy mw mx l my mz">python manage.py createsuperuser --email admin@example.com --username admin</span></pre><h1 id="c1bf" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated"><strong class="ak">测试当前应用</strong></h1><p id="7e55" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">到目前为止，我们已经做了一些工作，但我们不知道是否有任何工作。我们先测试一下，然后再进一步。</p><p id="9b43" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在命令行上。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="fd2b" class="mv lr it mq b gy mw mx l my mz">python manage.py runserver</span></pre><p id="276f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后在浏览器中导航至<a class="ae nb" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/admin</a>。使用您刚刚创建的超级用户登录。</p><p id="5366" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">登录后，点击“抓取”下的“作业”，然后点击右上方的“添加作业”。现在填写一些编造的信息，然后点击“保存”。如果您可以看到您创建的作业，那么到目前为止一切都正常！</p><h1 id="cba0" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">自定义 django-admin 命令</h1><p id="b729" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">我们将设置一个定制的 django-admin 命令来抓取工作板。这是我们将在基础架构级别自动安排的内容，以便实现自动抓取。</p><p id="0385" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe mn mo mp mq b">/scraping</code>模块中，创建一个名为<code class="fe mn mo mp mq b">/management</code>的目录，在<code class="fe mn mo mp mq b">/management</code>中创建一个名为<code class="fe mn mo mp mq b">/commands</code>的目录。然后在<code class="fe mn mo mp mq b">/commands</code>中创建 2 个 python 文件，<code class="fe mn mo mp mq b">_private.py</code>和<code class="fe mn mo mp mq b">scrape.py</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/93f84671c89ed33ee077200bd3145bbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*k97CLkssIcWJZ8A5AFubLA.png"/></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">不在此处显示所有内容</p></figure><p id="89a2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将此代码放入<code class="fe mn mo mp mq b">scrape.py</code>。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="067e" class="mv lr it mq b gy mw mx l my mz">from django.core.management.base import BaseCommand</span><span id="4758" class="mv lr it mq b gy na mx l my mz">from urllib.request import urlopen<br/>from bs4 import BeautifulSoup<br/>import json</span><span id="6b19" class="mv lr it mq b gy na mx l my mz">from scraping.models import Job</span><span id="f74a" class="mv lr it mq b gy na mx l my mz">class Command(BaseCommand):<br/>    help = "collect jobs"</span><span id="63e8" class="mv lr it mq b gy na mx l my mz">    # define logic of command<br/>    def handle(self, *args, **options):</span><span id="63d1" class="mv lr it mq b gy na mx l my mz">        # collect html<br/>        html = urlopen('<a class="ae nb" href="https://jobs.lever.co/opencare'" rel="noopener ugc nofollow" target="_blank">https://jobs.lever.co/opencare'</a>)</span><span id="017f" class="mv lr it mq b gy na mx l my mz">        # convert to soup<br/>        soup = BeautifulSoup(html, 'html.parser')</span><span id="0165" class="mv lr it mq b gy na mx l my mz">        # grab all postings<br/>        postings = soup.find_all("div", class_="posting")</span><span id="9578" class="mv lr it mq b gy na mx l my mz">        for p in postings:<br/>            url = p.find('a', class_='posting-btn-submit')['href']<br/>            title = p.find('h5').text<br/>            location = p.find('span', class_='sort-by-location').text</span><span id="af7b" class="mv lr it mq b gy na mx l my mz">            # check if url in db<br/>            try:<br/>                # save in db<br/>                Job.objects.create(<br/>                    url=url,<br/>                    title=title,<br/>                    location=location<br/>                )<br/>                print('%s added' % (title,))<br/>            except:<br/>                print('%s already exists' % (title,))</span><span id="c899" class="mv lr it mq b gy na mx l my mz">        self.stdout.write( 'job complete' )</span></pre><p id="bc2c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将代码放在这样的目录结构中，然后用一个<code class="fe mn mo mp mq b">handle</code>函数定义一个<code class="fe mn mo mp mq b">Command</code>类，告诉 django 这是一个定制的 django-admin 命令。</p><p id="2e1c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这里，我们使用美丽的汤刮杠杆工作板，然后保存在我们的数据库中。我没有附属机构，但我选择的工作板是为一家名为<a class="ae nb" href="https://www.opencare.com/" rel="noopener ugc nofollow" target="_blank"> Opencare </a>的出色公司设计的——如果他们发布了什么，你应该申请！</p><p id="3ce3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您现在可以从命令行运行它，如下所示。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="3ddf" class="mv lr it mq b gy mw mx l my mz">python manage.py scrape</span></pre><p id="c2e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你会看到这个输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/cd098f8bf8ceff06f2853fe66c938e4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VfK5LfKmVleKAuSC4ckWaA.png"/></div></div></figure><p id="7439" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">再运行一次，你会看到这个。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/e88938bc7e1e8917e392de912b2f4ee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QQZT2MTT-uSCTFIv4PStmQ.png"/></div></div></figure><p id="93b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是因为我们已经防止在上面的<code class="fe mn mo mp mq b">scrape.py</code>代码中添加重复的作业记录。</p><p id="c66d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您有一个数据库管理程序设置(如<a class="ae nb" href="https://dbeaver.io/" rel="noopener ugc nofollow" target="_blank"> dbeaver </a>，您还可以检查数据库中的行。我们不会在这里深入讨论，但它应该看起来像下面这样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/2e2df7ddac924a52d46787982138cf79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jeEjy_1EylZp0C7bKeV3KA.png"/></div></div></figure><h1 id="95fb" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">部署到生产</h1><p id="0058" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">现在让我们把这个放在 Heroku 上。</p><p id="bb49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">冻结您的需求，以便 Heroku 知道在部署时安装什么。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="95ea" class="mv lr it mq b gy mw mx l my mz">pip3 freeze &gt; requirements.txt</span></pre><p id="48a3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在命令行上，运行<code class="fe mn mo mp mq b">nano .gitignore</code>并添加如下。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="271c" class="mv lr it mq b gy mw mx l my mz">.DS_Store<br/>jobs/__pycache__<br/>scraping/__pycache__</span></pre><p id="68c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后<code class="fe mn mo mp mq b">ctrl+x</code>、<code class="fe mn mo mp mq b">y</code>、<code class="fe mn mo mp mq b">enter</code>保存并关闭(mac 上)。这可以防止部署不必要的文件。</p><p id="0fed" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在根目录下创建一个名为<code class="fe mn mo mp mq b">Procfile</code>的文件，并将下面的内容粘贴到里面。这告诉 heroku 启动一个 web dyno，第二个命令迁移 db。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="b3f7" class="mv lr it mq b gy mw mx l my mz">web: gunicorn jobs.wsgi<br/>release: python manage.py migrate</span></pre><p id="70fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">文件树将看起来像这样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/5330506fb4320affab4799821bad2fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qeud-NRZcpUvJLYLpMQNZA.png"/></div></div></figure><p id="c408" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">确保你有一个<a class="ae nb" href="http://heroku create flask-ml-api-123" rel="noopener ugc nofollow" target="_blank"> Heroku </a>账号，然后在命令行上用<code class="fe mn mo mp mq b">heroku login</code>登录。</p><p id="0c99" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用你想要的任何名字创建一个应用程序。但它需要在 Heroku 上的所有应用程序中是唯一的。我跑了<code class="fe mn mo mp mq b">heroku create django-scraper-879</code>，这里的 app 名字是<code class="fe mn mo mp mq b">django-scraper-879</code>。但是你需要自己选择。</p><p id="fcc4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在将这几行添加到 settings.py 的最底部。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="3ae6" class="mv lr it mq b gy mw mx l my mz">import django_heroku<br/>django_heroku.settings(locals())</span></pre><p id="d6ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在设置中更新<code class="fe mn mo mp mq b">DEBUG</code>。不想在调试模式下部署到 prod。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="baa7" class="mv lr it mq b gy mw mx l my mz">DEBUG = False</span></pre><p id="f56a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用下面的添加文件到 git。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="7bee" class="mv lr it mq b gy mw mx l my mz">git init<br/>git add . -A<br/>git commit -m 'first commit'</span></pre><p id="8aec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在用这个把我们的 app 推给 Heroku。</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="a736" class="mv lr it mq b gy mw mx l my mz">git push heroku master</span></pre><h1 id="999d" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">计划作业</h1><p id="f9b9" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">您可以使用<code class="fe mn mo mp mq b">heroku run python manage.py scrape</code>从本地命令行手动运行该作业，但是每天都必须手动运行它会很烦人。</p><p id="ed44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们自动化这一点。</p><p id="17b8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">登录你的 Heroku 控制台，点击“资源”，然后“查找更多附加组件”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/edc13de1d2587499aba3f3aad8cc000f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L-SloGjMuyBWo5ytclDifA.png"/></div></div></figure><p id="9302" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在找到并点击这个附加组件。尝试用“ctrl+f”来输入“schedule ”,以帮助找到它。Heroku 有一大堆潜在的附件。看起来像下面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/e9080dc5736e6efabb50ac226a7eb963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*ZLIIGdiQpgi3DTXH1bj08w.png"/></div></figure><p id="a6e1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在将它添加到您的应用程序中，这样您就有了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/c2206e369ad1a232fa06c937203914bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Vt9ZXzozsdxTM6T6PN9NQ.png"/></div></div></figure><p id="28ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">点击它，创建一个作业，<code class="fe mn mo mp mq b">everyday at…</code>，<code class="fe mn mo mp mq b">12am UTC</code>。不必要的 ping 网站是不好的！</p><p id="aaf4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">输入您的命令并保存。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/b517ec7081b931e0db6ed4484db3ca9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0JPDGSQcMlUxN-98XkmaPA.png"/></div></div></figure><p id="b5f3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">保存，我们就完成了！</p><p id="4a07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在只需等到 UTC 时间 12 点(或者你选择的任何时间),你的数据库就会被填充。</p><h1 id="c26f" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">结论</h1><p id="4459" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">我们在这里接触了很多东西。Django，Heroku，日程安排，网页抓取，Postgres。</p><p id="8944" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然我用了想知道一家公司何时发布新工作的例子，但是有很多理由你可能想抓取一个网站。</p><ul class=""><li id="ac40" class="np nq it kw b kx ky la lb ld nr lh ns ll nt lp nu nv nw nx bi translated">电子商务公司希望监控竞争对手的价格。</li><li id="86e4" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated">高管招聘人员可能想知道公司何时发布职位空缺。</li><li id="1d82" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated">你或我可能想知道 Kaggle 上什么时候增加了一个新的比赛。</li></ul><p id="00e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本教程只是为了说明什么是可能的。让我知道你是否已经用网络抓取在评论中建立了任何酷的东西。</p></div></div>    
</body>
</html>