<html>
<head>
<title>Visualization For Timeseries Exchange Data Using Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plotly实现时间序列交换数据的可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualization-for-timeseries-exchange-data-8c9f50d4d2d4?source=collection_archive---------17-----------------------#2020-03-01">https://towardsdatascience.com/visualization-for-timeseries-exchange-data-8c9f50d4d2d4?source=collection_archive---------17-----------------------#2020-03-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c670" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，我有机会处理crypto exchange公共数据，这使我能够使用最好的可视化工具之一的<a class="ae kl" href="https://plot.ly/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>库可视化地探索数据，因为它将使我们能够拥有通用的交互式图形，而不用担心编码部分——就像我过去使用Bokeh一样。</p><p id="175f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您使用笔记本进行分析，为了保持整洁，我建议您在一个. py文件中编写帮助函数，然后导入它。</p><p id="f6e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将分享代码，这样您将能够看到Plotly是如何工作的，并将其用于您的数据</p><p id="e8de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以让我们开始吧！</p><h2 id="8dd5" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">了解数据</h2><p id="43d7" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">像往常一样，首先要做的是获得对数据的直觉，这样我们可以更有效地采用哪种可视化。</p><p id="d9a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，数据是一组不同的文件，每天都包含关于订单深度的信息(<strong class="jp ir"> DOB文件</strong>)和交易(<strong class="jp ir">交易文件</strong>)。</p><p id="611d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一个操作是收集所有文件并将其聚合，构建一个包含某个时间范围内(在本例中为四个月)所有数据的数据框架。</p><p id="e889" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">DOB数据包含最好的5个要价和5个出价水平，包括价格和大小，从最好到最差以及时间戳数据。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/7141e2a61df67b6b451a3184cf8b84f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bV8_S-6nxPAM84z5tvdvcQ.png"/></div></div></figure><p id="c866" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">交易数据包含已执行交易的信息，包括价格、基数和接受方(买入或卖出)。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/8b115b4fc298b0190f0ce183fb3548c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*bOeM1k8rNe96rO3Nr__2ng.png"/></div></figure><p id="d863" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没有什么特别奇特的，所以让我们开始做一些EDA。</p><h2 id="7d78" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">DOB EDA</h2><p id="4f57" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">箱线图是可视化数据分布的最酷的方式之一，所以让我们从它们开始，看看大小和价格</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lx"><img src="../Images/4c2e8bc4925d97bb0e1a396b26b8bf89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zLFfxQkiyfDqdWzDI6fxRQ.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">尺寸盒图</p></figure><p id="030d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经可以看到数据是倾斜的，因为中值非常低，并且有明显的异常值。让我们放大，Plotly的一些东西，你可以直接在图形上做，同时有数字信息执行鼠标悬停。</p><p id="1441" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，只需点击图例，就可以进行过滤。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mc"><img src="../Images/d864e559af93bd041333bb31730e2004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*81APHHtcOJTKezOqFA4qpA.png"/></div></div></figure><p id="7b3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到中间值是0.45，最大值等于412，中间有很多异常值。</p><p id="f646" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码:</p><pre class="ll lm ln lo gt md me mf mg aw mh bi"><span id="bc3d" class="km kn iq me b gy mi mj l mk ml">import plotly.graph_objs as go</span><span id="9824" class="km kn iq me b gy mm mj l mk ml"># specific function<br/>def draw_dob_size_box_plots(df_dob):<br/>    _draw_dob_box_plots(df_dob, 'size')</span><span id="186a" class="km kn iq me b gy mm mj l mk ml"># generic "private" function<br/>def _draw_dob_box_plots(df_dob, size_or_price):<br/>    trace_asks0 = go.Box(<br/>        y=df_dob['asks[0].' + size_or_price],<br/>        name='asks[0]' + size_or_price,<br/>        marker=dict(<br/>            color='#3D9970'<br/>        )<br/>    )<br/>    trace_bids0 = go.Box(<br/>        y=df_dob['bids[0].' + size_or_price],<br/>        name='bids[0].' + size_or_price,<br/>        marker=dict(<br/>            color='#3D9970'<br/>        )<br/>    )<br/>    trace_asks1 = go.Box(<br/>        y=df_dob['asks[1].' + size_or_price],<br/>        name='asks[1].' + size_or_price,<br/>        marker=dict(<br/>            color='#6D9970'<br/>        )<br/>    )<br/>    trace_bids1 = go.Box(<br/>        y=df_dob['bids[1].' + size_or_price],<br/>        name='bids[1].' + size_or_price,<br/>        marker=dict(<br/>            color='#6D9970'<br/>        )<br/>    )<br/>    trace_asks2 = go.Box(<br/>        y=df_dob['asks[2].' + size_or_price],<br/>        name='asks[2].' + size_or_price,<br/>        marker=dict(<br/>            color='#9D9970'<br/>        )<br/>    )<br/>    trace_bids2 = go.Box(<br/>        y=df_dob['bids[2].' + size_or_price],<br/>        name='bids[2].' + size_or_price,<br/>        marker=dict(<br/>            color='#9D9970'<br/>        )<br/>    )<br/>    trace_asks3 = go.Box(<br/>        y=df_dob['asks[3].' + size_or_price],<br/>        name='asks[3].' + size_or_price,<br/>        marker=dict(<br/>            color='#BD9970'<br/>        )<br/>    )<br/>    trace_bids3 = go.Box(<br/>        y=df_dob['bids[3].' + size_or_price],<br/>        name='bids[3].' + size_or_price,<br/>        marker=dict(<br/>            color='#BD9970'<br/>        )<br/>    )<br/>    trace_asks4 = go.Box(<br/>        y=df_dob['asks[4].' + size_or_price],<br/>        name='asks[4].' + size_or_price,<br/>        marker=dict(<br/>            color='#ED9970'<br/>        )<br/>    )<br/>    trace_bids4 = go.Box(<br/>        y=df_dob['bids[4].' + size_or_price],<br/>        name='bids[4].' + size_or_price,<br/>        marker=dict(<br/>            color='#ED9970'<br/>        )<br/>    )</span><span id="8c72" class="km kn iq me b gy mm mj l mk ml">data = [trace_asks0, trace_bids0, trace_asks1, trace_bids1,                          trace_asks2, trace_bids2, \<br/>            trace_asks3, trace_bids3, trace_asks4, trace_bids4]<br/>    layout = go.Layout(<br/>        yaxis=dict(<br/>            title=size_or_price + 'Boxplot',<br/>            zeroline=False<br/>        )<br/>    )<br/>    fig = go.Figure(data=data, layout=layout)<br/>    fig.show()</span></pre><p id="e920" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您所看到的，代码很简单:您从特定的源构建不同的数据可视化，设置特定的可视化选项，然后将所有这些放在一起。所以，用相对较少的线条，就有可能构建一个具有多重数据和交互的图形。</p><p id="076d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在价格上做同样的事情</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lx"><img src="../Images/a452caf21e728e6dd21ced029af00ddd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B82tYvAo47N8M18qdhG3QQ.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">价格箱线图</p></figure><p id="2740" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，数据不那么倾斜，但是异常值清晰可见。</p><p id="f008" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想了解更多关于箱线图的知识，从这里的<a class="ae kl" href="https://en.wikipedia.org/wiki/Box_plot" rel="noopener ugc nofollow" target="_blank">开始</a>。</p><p id="0e3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们处理时间序列时，时间是一个相关的因素。让我们开始看看数据是如何随时间分布的。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lx"><img src="../Images/264d2ccd52078bd14f8eda79ca3d01f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Ym9mSUH8LCRj3Dv3Modwg.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">DOB数据直方图</p></figure><p id="d51c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以在一月份看到大量的元素，甚至在四月份看到一个峰值。</p><p id="5a8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了说明构建此图是多么容易，下面是使用的代码:</p><pre class="ll lm ln lo gt md me mf mg aw mh bi"><span id="92ae" class="km kn iq me b gy mi mj l mk ml">import plotly.express as px</span><span id="fbaa" class="km kn iq me b gy mm mj l mk ml">df = px.data.tips()<br/>fig = px.histogram(df_dob, x=”date_time_coinapi”)<br/>fig.show()</span></pre><p id="329f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看买卖价格是如何随时间变化的。为了简单起见，我只放第一层，但是代码会呈现所有层。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lx"><img src="../Images/e6d9ca243372573ca04f07f51e3ef7c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUFrJXDiIn6pwROQdH2B5w.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">要价和出价第一级</p></figure><p id="6d97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">放大查看一些数值超级简单。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mn"><img src="../Images/fa31ecfd6188ee163e42158c0f30af15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cie7zSubBCZwHj7xwbybqQ.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">放大第一级的要价和出价</p></figure><p id="2d14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码:</p><pre class="ll lm ln lo gt md me mf mg aw mh bi"><span id="2d2e" class="km kn iq me b gy mi mj l mk ml">import plotly.graph_objs as go<br/>def draw_dob_price_timeseries(df_dob):<br/>    elements0 = ['asks[0].price','bids[0].price']<br/>    elements1 = ['asks[1].price','bids[1].price']<br/>    elements2 = ['asks[2].price','bids[2].price']<br/>    elements3 = ['asks[3].price','bids[3].price']<br/>    elements4 = ['asks[4].price','bids[4].price']<br/>    elements = [elements0, elements1, elements2, elements3, elements4]<br/>    for el in elements:<br/>        _draw_dob_timeseries(df_dob, el, 'Price timeseries')</span><span id="2331" class="km kn iq me b gy mm mj l mk ml">def _draw_dob_timeseries(df_dob, elements, title):<br/>    trace_asks0 = go.Scatter(<br/>        x = df_dob.date_time_exchange,<br/>        y=df_dob[elements[0]],<br/>        name=elements[0],<br/>        line = dict(color = '#17BECF'),<br/>        opacity = 0.8 <br/>    )<br/>    trace_bids0 = go.Scatter(<br/>        x = df_dob.date_time_exchange,<br/>        y=df_dob[elements[1]],<br/>        name=elements[1],<br/>        line = dict(color = '#7F7F7F'),<br/>        opacity = 0.8    <br/>    )<br/>    data = [trace_asks0, trace_bids0]<br/>    layout = go.Layout(<br/>        yaxis=dict(<br/>            title=title,<br/>            zeroline=False<br/>        )<br/>    )<br/>    fig = go.Figure(data=data, layout=layout)<br/>    fig.show()<br/>        <br/>                <br/>def _draw_dob_box_plots(df_dob, size_or_price):<br/>    trace_asks0 = go.Box(<br/>        y=df_dob['asks[0].' + size_or_price],<br/>        name='asks[0]' + size_or_price,<br/>        marker=dict(<br/>            color='#3D9970'<br/>        )<br/>    )<br/>    trace_bids0 = go.Box(<br/>        y=df_dob['bids[0].' + size_or_price],<br/>        name='bids[0].' + size_or_price,<br/>        marker=dict(<br/>            color='#3D9970'<br/>        )<br/>    )<br/>    trace_asks1 = go.Box(<br/>        y=df_dob['asks[1].' + size_or_price],<br/>        name='asks[1].' + size_or_price,<br/>        marker=dict(<br/>            color='#6D9970'<br/>        )<br/>    )<br/>    trace_bids1 = go.Box(<br/>        y=df_dob['bids[1].' + size_or_price],<br/>        name='bids[1].' + size_or_price,<br/>        marker=dict(<br/>            color='#6D9970'<br/>        )<br/>    )<br/>    trace_asks2 = go.Box(<br/>        y=df_dob['asks[2].' + size_or_price],<br/>        name='asks[2].' + size_or_price,<br/>        marker=dict(<br/>            color='#9D9970'<br/>        )<br/>    )<br/>    trace_bids2 = go.Box(<br/>        y=df_dob['bids[2].' + size_or_price],<br/>        name='bids[2].' + size_or_price,<br/>        marker=dict(<br/>            color='#9D9970'<br/>        )<br/>    )<br/>    trace_asks3 = go.Box(<br/>        y=df_dob['asks[3].' + size_or_price],<br/>        name='asks[3].' + size_or_price,<br/>        marker=dict(<br/>            color='#BD9970'<br/>        )<br/>    )<br/>    trace_bids3 = go.Box(<br/>        y=df_dob['bids[3].' + size_or_price],<br/>        name='bids[3].' + size_or_price,<br/>        marker=dict(<br/>            color='#BD9970'<br/>        )<br/>    )<br/>    trace_asks4 = go.Box(<br/>        y=df_dob['asks[4].' + size_or_price],<br/>        name='asks[4].' + size_or_price,<br/>        marker=dict(<br/>            color='#ED9970'<br/>        )<br/>    )<br/>    trace_bids4 = go.Box(<br/>        y=df_dob['bids[4].' + size_or_price],<br/>        name='bids[4].' + size_or_price,<br/>        marker=dict(<br/>            color='#ED9970'<br/>        )</span><span id="e15f" class="km kn iq me b gy mm mj l mk ml">)</span><span id="f38f" class="km kn iq me b gy mm mj l mk ml">data = [trace_asks0, trace_bids0, trace_asks1, trace_bids1, trace_asks2, trace_bids2, \<br/>            trace_asks3, trace_bids3, trace_asks4, trace_bids4]<br/>    layout = go.Layout(<br/>        yaxis=dict(<br/>            title=size_or_price + 'Boxplot',<br/>            zeroline=False<br/>        )<br/>    )<br/>    fig = go.Figure(data=data, layout=layout)<br/>    fig.show()</span></pre><p id="c0d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里的代码多了一点，但结构是一样的。</p><h2 id="3b19" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">交易EDA</h2><p id="9659" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">让我们也从箱线图开始，关注买卖中的价格:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lx"><img src="../Images/df61bc6b054432a50375a9500ff5011d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3IcbiQWLk7h9NlXXkFsMGA.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">买入和卖出价格方框图</p></figure><p id="97bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后是一个条形图，显示买卖操作的数量:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lx"><img src="../Images/46fcef4bb35f098d646d0ed570784cdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O7k4FT-rVrOI_3W1x-AXgg.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">交易并排计算</p></figure><pre class="ll lm ln lo gt md me mf mg aw mh bi"><span id="22a7" class="km kn iq me b gy mi mj l mk ml">import plotly.graph_objs as go<br/>def draw_trades_bars(df_trades):<br/>    trace0 = <strong class="me ir">go.Bar</strong>(<br/>        x = np.array(df_trades[df_trades.taker_side ==  'BUY'].price.count()),<br/>        name = 'Number of buy',<br/>        marker=dict(<br/>            color='#009970')<br/>    )</span><span id="e5f1" class="km kn iq me b gy mm mj l mk ml">trace1 = <strong class="me ir">go.Bar</strong>(<br/>        x = np.array(df_trades[df_trades.taker_side == 'SELL'].price.count()), <br/>        name = 'Number of sell',<br/>        marker=dict(<br/>            color='#DD0000')<br/>    )<br/>    <br/>    data = [trace0, trace1]<br/>    layout = go.Layout(<br/>        yaxis=dict(<br/>            title='Trades Bar',<br/>            zeroline=False<br/>        )<br/>    )<br/>    fig = go.Figure(data=data, layout=layout)<br/>    fig.show()</span></pre><p id="1798" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所见，结构总是相同的，但是在这种情况下，我们使用go。Bar代替go.Scatter</p><p id="2cba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看交易柱状图:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lx"><img src="../Images/c08b638b3e340b47ddbdfd22a184d083.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aJVYT8ReWxQZbdXY2Q8e5Q.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">交易直方图</p></figure><p id="7185" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">二月后，活动减少，没有峰值。</p><h2 id="c5ee" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">组合EDA</h2><p id="54fb" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">让我们把所有的东西放在一起，看看我们是否能获得更多关于数据的直觉。</p><p id="c736" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了简化分析，我们将汇总两个数据，以1小时为间隔重新采样，并取5个值中的最大值。</p><pre class="ll lm ln lo gt md me mf mg aw mh bi"><span id="40b6" class="km kn iq me b gy mi mj l mk ml">RESAMPLE_TIME = '1H'<br/>df_dob_resampled = df_dob.copy()<br/>df_dob_resampled.index = df_dob_resampled['date_time_exchange'] <br/>df_dob_resampled = df_dob_resampled.<strong class="me ir">resample</strong>(RESAMPLE_TIME).max()<br/>df_dob_resampled.drop(columns=['date_time_exchange','date_time_coinapi'], inplace=True)</span><span id="f480" class="km kn iq me b gy mm mj l mk ml">df_dob_resampled['max_asks_size'] = df_dob_resampled[['asks[0].size','asks[1].size', 'asks[2].size', 'asks[3].size', 'asks[4].size']].<strong class="me ir">max</strong>(axis=1)<br/>df_dob_resampled['max_bids_size'] = df_dob_resampled[['bids[0].size','bids[1].size', 'bids[2].size', 'bids[3].size', 'bids[4].size']].<strong class="me ir">max</strong>(axis=1)<br/>df_dob_resampled['max_asks_price'] = df_dob_resampled[['asks[0].price','asks[1].price', 'asks[2].price', 'asks[3].price', 'asks[4].price']].<strong class="me ir">max</strong>(axis=1)<br/>df_dob_resampled['max_bids_price'] = df_dob_resampled[['bids[0].price','bids[1].price', 'bids[2].price', 'bids[3].price', 'bids[4].price']].<strong class="me ir">max</strong>(axis=1)</span><span id="0452" class="km kn iq me b gy mm mj l mk ml">df_dob_resampled.drop(columns=[<br/>                      'asks[0].size','asks[1].size', 'asks[2].size', 'asks[3].size', 'asks[4].size', \<br/>                      'bids[0].size','bids[1].size', 'bids[2].size', 'bids[3].size', 'bids[4].size', \<br/>                      'asks[0].price','asks[1].price', 'asks[2].price', 'asks[3].price', 'asks[4].price', \<br/>                      'bids[0].price','bids[1].price', 'bids[2].price', 'bids[3].price', 'bids[4].price'], inplace=True)</span></pre><p id="d60c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">得到这样的东西:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/be23e87af8b4d7b40fec40c6d679c9f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*69GhAosaKNX1OqikjMmVMQ.png"/></div></figure><p id="329d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们对交易数据做同样的处理，分为卖出和买入:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/b9f1eff078eb31b3bf41ac23ed32911f.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*95irr169hdqulf7CTcjVJw.png"/></div></figure><p id="afae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以建立一个时间序列图，将DOB和交易放在一起，看看是否发生了一些奇怪的事情:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lx"><img src="../Images/86075fb27dad4017a7f524836e425133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hR38nwZl9yZB7SA24dTweQ.png"/></div></div></figure><p id="84ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大约在一月中旬，有一个异常现象，让我们放大一下:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/73b5c8fcc7399c29a2916c99bfcd710e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*Pgtm6LNgfShwvbfby1abLg.png"/></div></figure><p id="97c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到要价突然上升，这可能是“欺骗”试探性的信号，这是一种非法行为，买家操纵市场支付更高的价格，并由于其他买家行为的累积效应而将价格推得更高。</p><pre class="ll lm ln lo gt md me mf mg aw mh bi"><span id="9d6e" class="km kn iq me b gy mi mj l mk ml">import plotly.graph_objs as go<br/>def draw_max_timeseries(df_dob_resampled, df_trades_resampled_buy, df_trades_resampled_sell, title):<br/>    trace0 = go.Scatter(<br/>        x = df_dob_resampled.index,<br/>        y = df_dob_resampled['max_asks_price'],<br/>        mode = 'lines+markers',<br/>        name='max_asks_price',<br/>        line = dict(color = '#dd0000', shape = 'linear'),<br/>        opacity = 0.3,<br/>        connectgaps=True<br/>    )<br/>    trace1 = go.Scatter(<br/>        x = df_dob_resampled.index,<br/>        y = df_dob_resampled['max_bids_price'],<br/>        name='max_bids_price',<br/>        mode = 'lines+markers',<br/>        marker = dict(<br/>            size = 10,<br/>            color = '#44dd00'),<br/>        opacity = 0.3    <br/>    )<br/>    trace2 = go.Scatter(<br/>        x = df_trades_resampled_buy.index,<br/>        y = df_trades_resampled_buy.price,<br/>        name='trades BUY price',<br/>        mode = 'markers',<br/>        marker = dict(<br/>            size = 10,<br/>            color = '#00dd00'),<br/>        opacity = 0.8    <br/>    )<br/>    trace3 = go.Scatter(<br/>        x = df_trades_resampled_sell.index,<br/>        y = df_trades_resampled_sell.price,<br/>        name='trades SELL price',<br/>        mode = 'markers',<br/>        marker = dict(<br/>            size = 10,<br/>            color = '#dd0000'),<br/>        opacity = 0.8    <br/>    )</span><span id="6845" class="km kn iq me b gy mm mj l mk ml">data = [trace0, trace1, trace2, trace3]<br/>    layout = go.Layout(<br/>        yaxis=dict(<br/>            title=title,<br/>            zeroline=True<br/>        )<br/>    )<br/>    fig = go.Figure(data=data, layout=layout)<br/>    fig.show()</span><span id="eda5" class="km kn iq me b gy mm mj l mk ml">draw_max_timeseries(df_dob_resampled, df_trades_resampled_buy, df_trades_resampled_sell, 'Max aggregated data timeseries')</span></pre><p id="88cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们将重采样时间设置为1小时时，如果我们想在该时间段内获得更多的粒度，我们必须对该间隔进行切片(让我们选择4小时)并进行重采样，例如使用60秒。我们开始吧！</p><pre class="ll lm ln lo gt md me mf mg aw mh bi"><span id="c538" class="km kn iq me b gy mi mj l mk ml">RESAMPLE_TIME = '60s'<br/>START_INTERVAL = '2018-01-15 22:00:00'<br/>END_INTERVAL = '2018-01-16 02:00:00'<br/>df_dob_resampled_interval = df_dob.copy()<br/>df_dob_resampled_interval.index = df_dob_resampled_interval['date_time_exchange']</span><span id="a371" class="km kn iq me b gy mm mj l mk ml">df_dob_resampled_interval = df_dob_resampled_interval[START_INTERVAL:END_INTERVAL]</span><span id="ea10" class="km kn iq me b gy mm mj l mk ml">df_dob_resampled_interval = df_dob_resampled_interval.resample(RESAMPLE_TIME).max()<br/>df_dob_resampled_interval.drop(columns=['date_time_exchange','date_time_coinapi'], inplace=True)</span><span id="1a60" class="km kn iq me b gy mm mj l mk ml">df_dob_resampled_interval['max_asks_size'] = df_dob_resampled_interval[['asks[0].size','asks[1].size', 'asks[2].size', 'asks[3].size', 'asks[4].size']].max(axis=1)<br/>df_dob_resampled_interval['max_bids_size'] = df_dob_resampled_interval[['bids[0].size','bids[1].size', 'bids[2].size', 'bids[3].size', 'bids[4].size']].max(axis=1)<br/>df_dob_resampled_interval['max_asks_price'] = df_dob_resampled_interval[['asks[0].price','asks[1].price', 'asks[2].price', 'asks[3].price', 'asks[4].price']].max(axis=1)<br/>df_dob_resampled_interval['max_bids_price'] = df_dob_resampled_interval[['bids[0].price','bids[1].price', 'bids[2].price', 'bids[3].price', 'bids[4].price']].max(axis=1)</span><span id="0494" class="km kn iq me b gy mm mj l mk ml">df_dob_resampled_interval.drop(columns=[<br/>                      'asks[0].size','asks[1].size', 'asks[2].size', 'asks[3].size', 'asks[4].size', \<br/>                      'bids[0].size','bids[1].size', 'bids[2].size', 'bids[3].size', 'bids[4].size', \<br/>                      'asks[0].price','asks[1].price', 'asks[2].price', 'asks[3].price', 'asks[4].price', \<br/>                      'bids[0].price','bids[1].price', 'bids[2].price', 'bids[3].price', 'bids[4].price'], inplace=True)</span><span id="ffee" class="km kn iq me b gy mm mj l mk ml">df_dob_resampled_interval.head()</span><span id="e830" class="km kn iq me b gy mm mj l mk ml">df_trades_resampled_interval = df_trades.copy()<br/>df_trades_resampled_interval.index = df_trades_resampled_interval['time_exchange'] <br/>df_trades_resampled_interval = df_trades_resampled_interval[START_INTERVAL:END_INTERVAL]<br/>df_trades_resampled_interval_buy = df_trades_resampled_interval[df_trades_resampled_interval.taker_side == 'BUY'].resample(RESAMPLE_TIME).max()<br/>df_trades_resampled_interval_buy.drop(columns=['time_exchange', 'time_coinapi','guid'], inplace=True)<br/>df_trades_resampled_interval_buy.head()</span><span id="baeb" class="km kn iq me b gy mm mj l mk ml">df_trades_resampled_interval = df_trades.copy()<br/>df_trades_resampled_interval.index = df_trades_resampled_interval['time_exchange']<br/>df_trades_resampled_interval = df_trades_resampled_interval[START_INTERVAL:END_INTERVAL]<br/>df_trades_resampled_interval_sell = df_trades_resampled_interval[df_trades_resampled_interval.taker_side == 'SELL'].resample(RESAMPLE_TIME).max()<br/>df_trades_resampled_interval_sell.drop(columns=['time_exchange', 'time_coinapi', 'guid'], inplace=True)<br/>df_trades_resampled_interval_sell.head()</span></pre><p id="77d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了这样的东西:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/96910aa130209162c76bb640f458ea7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*t1u5R8pCkXXAWMGhpcwdOg.png"/></div></figure><p id="e1c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有NaN值不是问题，会被Plotly忽略。</p><p id="66f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们画出来:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lx"><img src="../Images/2730af031f71d44c5333cf9cdaac3295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rYEVlptDhgx6X5OKktYUUw.png"/></div></div></figure><p id="7ef4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到，在22:45左右出现了峰值，一小时后情况恢复正常，但只有一笔交易价格上涨，因此不存在累积效应。</p><h1 id="36aa" class="ms kn iq bd ko mt mu mv kr mw mx my ku mz na nb kx nc nd ne la nf ng nh ld ni bi translated">结论</h1><p id="404b" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">EDA是对数据执行的基本活动，使用简单而强大的工具有效地执行EDA可以节省时间，从而可以专注于直觉而不是代码。</p><p id="1f0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有几个库可以用来做数据可视化，当然Plotly是其中一个更强大、更容易使用的库，尤其是最新版本，所以获取一些数据并尝试一下吧！</p></div></div>    
</body>
</html>