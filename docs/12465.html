<html>
<head>
<title>How to “Docker” for your computer science research project?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为你的计算机科学研究项目“Docker”？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-docker-for-your-computer-science-research-project-the-minimal-guide-for-using-docker-2ecd3e9280ac?source=collection_archive---------29-----------------------#2020-08-27">https://towardsdatascience.com/how-to-docker-for-your-computer-science-research-project-the-minimal-guide-for-using-docker-2ecd3e9280ac?source=collection_archive---------29-----------------------#2020-08-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c975" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">docker 使用指南。</h2></div><p id="41c4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当所有人都在讨论 dockers，谈论你的项目 dockerize 有多好的时候，因为它就像一个隔离的环境，人们可以直接运行你的 docker 映像，而不需要设置依赖关系。</p><p id="5f5d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我目前正在进行深度学习研究，我的老板让我将我的研究项目放入 docker。所以我花了一些时间去理解 docker 是什么，以及如何在最小理解的情况下使用它。</p><p id="067f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个最低限度的理解，因此它可能不是使用 docker 的正确方式，但我发现它适合我作为一名研究人员的用法，所以我决定分享它！</p><h2 id="614f" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">什么是码头工人？</h2><p id="8153" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">我是以我的经验来解释，而不是从谷歌的定义来解释。如果你知道什么是虚拟机，它就像你当前电脑中另一台电脑(如 ubuntu)的模拟器。Docker 就像一个类似的，只是它是一个更快更好的虚拟机(内心深处是相当不同和复杂的)。这是一个孤立的环境，一台新电脑！</p><h2 id="310d" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">如何安装？</h2><p id="d688" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">这个网站对于在你的 Ubuntu<a class="ae mc" href="https://phoenixnap.com/kb/how-to-install-docker-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">https://phoenix nap . com/kb/how-to-install-docker-on-Ubuntu-18-04</a>中安装 docker 有非常明确的说明。安装后，尝试运行“docker - version ”,如果显示输出，则说明您已成功安装！</p><h2 id="7461" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">我想在不安装任何包的情况下使用 docker！</h2><p id="708c" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">我在所有项目中使用 docker 的原因是，我不需要在新电脑中设置 CUDA(如你所知，CUDA 非常复杂，我曾几次搞砸我的 ubuntu)。当然，有些时候我懒得安装依赖项，docker 最适合我！</p><p id="49b6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你现在正在研究深度学习，你很可能会使用 PyTorch 或 Tensorflow。</p><p id="c17f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">没有 docker，可能需要安装 Anaconda3，python3，new ubuntu，设置 CUDA，pip install，conda install。但是用 docker，你需要做的只是两个命令。</p><blockquote class="md me mf"><p id="f7b8" class="ki kj mg kk b kl km ju kn ko kp jx kq mh ks kt ku mi kw kx ky mj la lb lc ld im bi translated">docker pull pytorch/pytorch:最新#将下载“镜像”,或者您可以在安装环境时获得它<br/>docker run-it-RM-GPU all py torch/py torch bash</p></blockquote><p id="de7e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果面临“权限错误”，就用 sudo 运行，因为我已经设置了不带 sudo 的 running docker。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mk"><img src="../Images/4834cab53fa64c5eb711894efb0dc950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lA-jL6iCv7iqtRtO7-TVNg.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">这是运行命令后的界面(我用名称“pt1.4”标记了原始图像)</p></figure><p id="0a7f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在你已经进入了“虚拟机”(它被称为“容器”，每当我谈到“容器”，它意味着我在谈论这个“虚拟机”)，注意到你是这个容器中的“root”，稍后我将谈论如何摆脱“root”。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi na"><img src="../Images/a2eecf1cef411020bbb68cebd386a2d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3Vd_jizdXtJ0fpuHULU1g.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">在这个“虚拟机”里，你可以像正常的 ubuntu 环境一样做任何事情。</p></figure><p id="7509" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其他版本的 pytorch 可以参考 Dockerhub 中的 pytorch 资源库:<a class="ae mc" href="https://hub.docker.com/r/pytorch/pytorch" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/r/pytorch/pytorch</a></p><p id="a9e5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果想要 tensorflow 版本(也可能是特定库版本)，只需尝试谷歌“dockerhub tensorflow”或“docker pull tensorflow”，或者在 dockerhub 中搜索即可。</p><p id="ef9f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想知道那是什么-it 和- rm，“-i”是交互的，“-t”是 TTY(类似于显示实时标准输出，你可以查看 docker 文档了解实际含义)，“- rm”是它会在你退出 docker 后删除“容器”(就像从存储中删除你的虚拟机，如果你已经熟悉 docker，你可以不用这个命令运行)。</p><p id="c2b2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最新的 docker 非常方便，你不必设置英伟达的东西。“-GPU ALL”是告诉 docker 你想把所有的 GPU 设备都映射到这个容器。如果您只想将 GPU 0 和 GPU 1 映射到这个容器中，您可以使用“-GPU \ " device = 0，1”运行，请注意，我使用\" \ "是因为它是单个设备的 docker 语法。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nb"><img src="../Images/7434e1ed563d0ed7d23a2152d80f8dc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wVIqrMK5qROlJBLrl9-OIA.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">如果你想知道为什么 GPU 内存用了 7GB 却看不到其他进程，那是因为那些进程不在这个容器里。该容器在您的原始计算机中是独立的，并与其他容器隔离</p></figure><h2 id="721d" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">将文件夹装入 Docker 容器</h2><blockquote class="md me mf"><p id="d9fa" class="ki kj mg kk b kl km ju kn ko kp jx kq mh ks kt ku mi kw kx ky mj la lb lc ld im bi translated">docker run-it-RM-GPU all-v/path/to/my/code:/path/in/docker-v/datasets:/data mypytorch bash</p></blockquote><p id="00f3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于您想要“挂载”到容器中的每个文件夹，您需要在上面的命令中添加“-v”和“/pathA:/pathB”。然后你的文件夹“/A”将被挂载(或映射)到容器中的“/B”中</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nc"><img src="../Images/c4170062af628eb3c58a862018b21943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RTkWtiFWzfyTxBFYQcod-A.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">DeepIPR 是我的项目之一【https://kamwoh.github.io/DeepIPR/ T2】</p></figure><p id="2c76" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如您从上面看到的，原始文件夹路径是“/data/Projects……”，然后我用命令“-v”将它挂载到容器中。在容器中，我挂载的文件夹在“/workspace/DeepIPR”中。注意:在挂载的文件夹中创建的所有文件都将出现在原始文件夹中。</p><h2 id="c7f5" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">记住用-u $(id -u):$(id -g)运行</h2><p id="2b86" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">在我知道这个命令之前，我通常只是运行 docker，将我的文件夹映射到容器的文件夹中，如下所示</p><blockquote class="md me mf"><p id="4eb8" class="ki kj mg kk b kl km ju kn ko kp jx kq mh ks kt ku mi kw kx ky mj la lb lc ld im bi translated">docker run-it-RM-v/path/to/my/code:/path/in/docker-u $(id-u):$(id-g)mypytorch bash</p></blockquote><p id="d852" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果不使用“-u”运行也没关系，但是由/path/to/my/code 中的容器创建的新文件夹将成为“根”访问。完成这一步后，在容器中挂载的文件夹中创建的新文件夹将再次成为您自己的用户名。你会看到“我没有名字”，不过没关系，不会影响任何用法，忽略就是因为我们没有设置好 docker(更高级的部分)</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nd"><img src="../Images/f929377803a2c56bd586a420d1a2b9c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HsG2XC6uVZdLXMYI27AVBg.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">请注意，6001 和 6000 是原始计算机环境的用户和组 id</p></figure><h2 id="11d9" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">直接运行您的代码</h2><p id="699d" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">我的 DevOps 朋友告诉我，我使用 docker 的方式不对，使用“bash”命令有点难看(所有程序员都喜欢处理他们代码的优雅方式)。</p><p id="9183" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在图像名称后的参数之后是将在容器中运行的命令。所以你可以像这样跑</p><blockquote class="md me mf"><p id="6e7e" class="ki kj mg kk b kl km ju kn ko kp jx kq mh ks kt ku mi kw kx ky mj la lb lc ld im bi translated">docker run-it-RM-v/path/to/my/code:/path/in/docker-GPU all mypy torch python/path/in/docker/xxxx . py</p></blockquote><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ne"><img src="../Images/be455414306ac17a7728dcc7035d3d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rnxAV6p6sM7r4MRSRy72Zw.png"/></div></div></figure><h2 id="bdcd" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">简单 Dockerfile 文件</h2><p id="8281" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">如果您需要安装一个原始 docker 映像没有的额外的包。</p><p id="1d7c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">比如你拉的 PyTorch 图片，不包含“jupyter notebook”。您可以创建自己的 docker 文件。(您会注意到一些“dockerized”的 github 项目有一个名为“Dockerfile”的文件)</p><p id="ec84" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个 Dockerfile 基本上就像一个设置你的映像的设置脚本(映像就像 ISO 文件，容器就像我们用 ISO 文件运行的内容)。比如你如何设置你的新 ubuntu 环境。</p><p id="4d1a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">记得把你的文件存为“Dockerfile”！！</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/82b7465fa3aab58831562d0ccd72250d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*Or6Ng0bl7tzQ08prSrQi5A.png"/></div></figure><p id="6cc7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从 xxxxx 开始，它是您要在其上构建的基础映像。</p><p id="7340" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行 xxxxx，它在映像构建期间运行命令。对于 apt-get，你必须小心，如果你想在安装其他包之前更新 apt-get，你必须运行&amp;就像我上面显示的那样，否则 docker 会在你用这个 docker 文件构建的第<strong class="kk iu">秒</strong>跳过它。</p><p id="07ca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ENV xxxxx，用于设置环境变量</p><p id="529c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你会注意到，每当我进入容器时，我都在“/workspace”中，这就是 WORKDIR 的作用。为您设置默认位置。</p><p id="3e61" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你会觉得奇怪，为什么我要为 jupyter 设置 chmod 777，这是我面临的权限错误，希望这个技巧可以帮助解决你面临的问题。(当然不是优雅的方式)</p><p id="98fd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">而且可以用自己的名字打造自己的 docker。</p><blockquote class="md me mf"><p id="bc57" class="ki kj mg kk b kl km ju kn ko kp jx kq mh ks kt ku mi kw kx ky mj la lb lc ld im bi translated">DOCKER_BUILDKIT=1 docker 构建标记 imagename。</p></blockquote><p id="f5cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">" DOCKER_BUILDKIT=1 "使 DOCKER 以更快的方式构建图像(可能是关于缓存的东西)，"- tag "后面的参数是图像名称，不要忘记那个点。"，表示当前目录中的“Dockerfile”。</p><p id="0f15" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">建立自己的图像后，您可以使用“docker 图像”来检查它</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ng"><img src="../Images/b5d106670354ce983b0553d43f3a0409.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WaIIuK0cJVsm_Mb8MnvvuA.png"/></div></div></figure><h2 id="e690" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">结论</h2><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/593defdcfd2a3a5cb40aac8448f13f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*PK-uX0SxDO0x4trd"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">如果你想在这篇文章中更多地了解 docker</p></figure><p id="540a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我实际上也跳过了许多有用的 docker 快捷方式，但我认为这些在这篇文章中相当复杂(至少在我第一次使用 docker 时是如此)。你可能会觉得设置 docker 很麻烦，但是相信我，麻烦只有一次。Docker 相当方便，因为你不需要在新电脑上重新设置。如果你真的需要了解更多关于 docker 或者真正优雅的使用 ocker 的方法，你应该谷歌一下 docker cheatsheet 或者别的什么。这篇文章是关于 docker 用法的最基本的理解。感谢阅读！！</p><h2 id="2986" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">额外收获:你可以参考的备忘单</h2><p id="617c" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">我想在这篇文章之后，你应该有一个直观的认识，阅读下面的小抄对你来说应该不再是一个问题了！！</p><ol class=""><li id="49a9" class="ni nj it kk b kl km ko kp kr nk kv nl kz nm ld nn no np nq bi translated"><a class="ae mc" href="https://www.docker.com/sites/default/files/d8/2019-09/docker-cheat-sheet.pdf" rel="noopener ugc nofollow" target="_blank">https://www.docker.com/sites/default/files/d8/2019-09/docker-cheat-sheet.pdf </a></li><li id="bbc6" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae mc" href="https://github.com/wsargent/docker-cheat-sheet" rel="noopener ugc nofollow" target="_blank">https://github.com/wsargent/docker-cheat-sheet </a></li><li id="624a" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae mc" href="http://dockerlabs.collabnix.com/docker/cheatsheet/" rel="noopener ugc nofollow" target="_blank">http://dockerlabs.collabnix.com/docker/cheatsheet/</a></li><li id="d8a9" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae mc" href="https://phoenixnap.com/kb/list-of-docker-commands-cheat-sheet" rel="noopener ugc nofollow" target="_blank">https://phoenixnap.com/kb/list-of-docker-commands-cheat-sheet </a></li></ol></div></div>    
</body>
</html>