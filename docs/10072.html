<html>
<head>
<title>How to Train a TensorFlow 2 Object Detection Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何训练 TensorFlow 2 对象检测模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-train-a-tensorflow-2-object-detection-model-25d4da64b817?source=collection_archive---------6-----------------------#2020-07-16">https://towardsdatascience.com/how-to-train-a-tensorflow-2-object-detection-model-25d4da64b817?source=collection_archive---------6-----------------------#2020-07-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3b29" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">注:我们还在博客上发布了<a class="ae ki" href="https://blog.roboflow.ai/train-a-tensorflow2-object-detection-model/" rel="noopener ugc nofollow" target="_blank"> Train TensorFlow 2 物体检测模型</a>。了解如何安装、加载自定义数据、训练和推断您的自定义 TensorFlow 2 <a class="ae ki" href="https://blog.roboflow.com/the-ultimate-guide-to-object-detection/" rel="noopener ugc nofollow" target="_blank">对象检测</a>模型，以检测世界上的任何对象。</h2></div><p id="b69e" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">随着最近<a class="ae ki" href="https://blog.roboflow.ai/the-tensorflow2-object-detection-library-is-here/" rel="noopener ugc nofollow" target="_blank">TensorFlow 2 对象检测 API </a>的发布，使用 tensor flow 训练和部署定制的最先进对象检测模型变得前所未有的简单。要构建自定义模型，您可以利用您自己的自定义数据集来检测您自己的自定义对象:食物、宠物、机械零件等等。</p><p id="522e" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">在这篇博客和<a class="ae ki" href="https://colab.research.google.com/drive/1sLqFKVV94wm-lglFq_0kGo2ciM0kecWD#scrollTo=fF8ysCfYKgTP&amp;uniqifier=1" rel="noopener ugc nofollow" target="_blank">tensor flow 2 Object Detection Colab 笔记本</a>中，我们将介绍如何在几分钟内通过为数据集导入更改一行代码来训练您自己的自定义对象检测器。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/25c3ddc85105e8d7bb641802d673375b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VPJYo00eGNF_qoN9al3fnw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">使用<a class="ae ki" href="https://blog.tensorflow.org/2020/07/tensorflow-2-meets-object-detection-api.html" rel="noopener ugc nofollow" target="_blank"> TensorFlow2 对象检测 API </a>训练您的自定义对象检测器</p></figure><p id="7d71" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">为了用 TensorFlow 2 对象检测 API 训练我们的<a class="ae ki" href="https://blog.roboflow.com/the-ultimate-guide-to-object-detection/" rel="noopener ugc nofollow" target="_blank">自定义对象检测器</a>，我们将在本教程中采取以下步骤:</p><ul class=""><li id="a941" class="lv lw it kl b km kn kp kq ks lx kw ly la lz le ma mb mc md bi translated">讨论<a class="ae ki" href="https://blog.roboflow.ai/the-tensorflow2-object-detection-library-is-here/" rel="noopener ugc nofollow" target="_blank">tensor flow 2 对象检测 API </a></li><li id="fa44" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated">获取<a class="ae ki" href="https://blog.roboflow.com/cvat/" rel="noopener ugc nofollow" target="_blank">标记物体检测数据</a></li><li id="5f58" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated">安装 TensorFlow 2 对象检测依赖项</li><li id="a9de" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated">下载自定义<a class="ae ki" href="https://public.roboflow.com/" rel="noopener ugc nofollow" target="_blank"> TensorFlow 2 对象检测数据集</a></li><li id="ada1" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated">编写自定义 TensorFlow 2 对象检测培训配置</li><li id="0d47" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated">训练自定义 TensorFlow 2 对象检测模型</li><li id="b010" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated">导出自定义 TensorFlow 2 对象检测权重</li><li id="7f97" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated">使用经过训练的 TensorFlow 2 对象检测对测试图像进行推断</li></ul><p id="4ef5" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">本教程中包含的资源:</p><ul class=""><li id="2276" class="lv lw it kl b km kn kp kq ks lx kw ly la lz le ma mb mc md bi translated"><a class="ae ki" href="https://colab.research.google.com/drive/1sLqFKVV94wm-lglFq_0kGo2ciM0kecWD#scrollTo=fF8ysCfYKgTP&amp;uniqifier=1" rel="noopener ugc nofollow" target="_blank"> TensorFlow 2 物体检测 Colab 笔记本</a></li><li id="bd2c" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated"><a class="ae ki" href="https://public.roboflow.ai/object-detection/bccd" rel="noopener ugc nofollow" target="_blank">公共血细胞物体检测数据集</a></li><li id="5634" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated"><a class="ae ki" href="https://github.com/tensorflow/models/tree/master/research/object_detection" rel="noopener ugc nofollow" target="_blank"> TF2 OD GitHub 知识库</a></li></ul><p id="d821" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们开始吧！</p><h1 id="20a2" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">什么是 TensorFlow 2 物体检测 API？</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/e9810df52910ffea301065131ef80554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*zD81-1JlKVl-uSoL.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated"><a class="ae ki" href="https://blog.tensorflow.org/2020/07/tensorflow-2-meets-object-detection-api.html" rel="noopener ugc nofollow" target="_blank"> TensorFlow2 物体检测 API </a></p></figure><p id="75b2" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">TensorFlow2 对象检测 API 是<a class="ae ki" href="https://blog.roboflow.ai/the-tensorflow2-object-detection-library-is-here/" rel="noopener ugc nofollow" target="_blank"> TensorFlow 对象检测 API </a>的扩展。<a class="ae ki" href="https://blog.roboflow.ai/the-tensorflow2-object-detection-library-is-here/" rel="noopener ugc nofollow" target="_blank"> TensorFlow2 对象检测 API </a>允许你在一个统一的框架下训练一个集合<a class="ae ki" href="https://models.roboflow.com/object-detection" rel="noopener ugc nofollow" target="_blank">艺术状态对象检测模型</a>，包括 Google Brain 的艺术状态模型<a class="ae ki" href="https://blog.roboflow.ai/breaking-down-efficientdet/" rel="noopener ugc nofollow" target="_blank"> EfficientDet </a>(此处实现)。</p><p id="dbea" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">更一般地说，<a class="ae ki" href="https://blog.roboflow.com/the-ultimate-guide-to-object-detection/" rel="noopener ugc nofollow" target="_blank">对象检测</a>模型允许你训练你的计算机用边界框和类标签来识别场景中的对象。有许多方法可以使用深度学习技术来建模这个问题，而<a class="ae ki" href="https://blog.roboflow.ai/the-tensorflow2-object-detection-library-is-here/" rel="noopener ugc nofollow" target="_blank"> TensorFlow2 对象检测 API </a>允许您部署各种不同的模型和策略来实现这个目标。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/c2054bd14521fb51cf6c532d335d497f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*92HfmcuF2yOMZb0k.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated"><a class="ae ki" href="https://blog.roboflow.com/the-ultimate-guide-to-object-detection/" rel="noopener ugc nofollow" target="_blank">物体探测任务草图</a></p></figure><p id="87a9" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">要深入了解<strong class="kl iu"> </strong> TensorFlow 2 对象检测 API <strong class="kl iu">、</strong>中的新功能，请参见我们的帖子<strong class="kl iu"> </strong> <a class="ae ki" href="https://blog.roboflow.ai/the-tensorflow2-object-detection-library-is-here/" rel="noopener ugc nofollow" target="_blank"> <strong class="kl iu">介绍 TensorFlow 2 对象检测 API </strong> </a> <strong class="kl iu">。</strong></p><p id="5bd7" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">在本教程中，我们训练最小的 EfficientDet 模型(EfficientDet-D0)来检测 Google Colab 提供的 GPU 资源上的自定义对象。也就是说，<a class="ae ki" href="https://blog.roboflow.ai/the-tensorflow2-object-detection-library-is-here/" rel="noopener ugc nofollow" target="_blank"> TensorFlow 2 对象检测库</a>在它们的<a class="ae ki" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md" rel="noopener ugc nofollow" target="_blank">模型动物园</a>中有许多可用的模型，所以除了在 TensorFlow 2 中训练 EfficientDet 之外，你还可以利用本教程做以下事情:</p><ul class=""><li id="8eb9" class="lv lw it kl b km kn kp kq ks lx kw ly la lz le ma mb mc md bi translated"><a class="ae ki" href="https://blog.roboflow.com/train-a-tensorflow2-object-detection-model/" rel="noopener ugc nofollow" target="_blank">如何在 TensorFlow 2 中训练 CenterNet 沙漏</a></li><li id="5c8a" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated"><a class="ae ki" href="https://blog.roboflow.com/train-a-tensorflow2-object-detection-model/" rel="noopener ugc nofollow" target="_blank">如何在 TensorFlow 2 中训练 CenterNet resnet 50</a></li><li id="4e57" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated"><a class="ae ki" href="https://blog.roboflow.com/train-a-tensorflow2-object-detection-model/" rel="noopener ugc nofollow" target="_blank">如何在 TensorFlow 2 中训练 efficient det D7</a></li><li id="0c90" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated"><a class="ae ki" href="https://blog.roboflow.com/train-a-tensorflow2-object-detection-model/" rel="noopener ugc nofollow" target="_blank">如何在 TensorFlow 2 中训练 MobileNet 2</a></li><li id="232c" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated"><a class="ae ki" href="https://blog.roboflow.com/train-a-tensorflow2-object-detection-model/" rel="noopener ugc nofollow" target="_blank">如何在 TensorFlow 2 中训练 resnet 50</a></li><li id="b3e7" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated"><a class="ae ki" href="https://blog.roboflow.com/train-a-tensorflow2-object-detection-model/" rel="noopener ugc nofollow" target="_blank">如何在 TensorFlow 2 中训练更快的 R-CNN</a></li><li id="150f" class="lv lw it kl b km me kp mf ks mg kw mh la mi le ma mb mc md bi translated"><a class="ae ki" href="https://blog.roboflow.com/train-a-tensorflow2-object-detection-model/" rel="noopener ugc nofollow" target="_blank">如何在 TensorFlow 2 中训练 ExtremeNet</a></li></ul><h1 id="eae9" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">获取标记对象检测数据</h1><p id="3359" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">如果您已经有一个<a class="ae ki" href="https://public.roboflow.com/" rel="noopener ugc nofollow" target="_blank">标记的对象检测数据集</a>，您可以跳过这一部分。</p><h1 id="3770" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">公共数据集</h1><p id="89af" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">如果你只是想感受一下 TensorFlow 对象检测 API 中可用的新深度学习技术，你可以考虑利用公共对象检测数据集，其中许多我们通过 Roboflow 随时提供。考虑将其中的任何一项存入你的账户。如果您希望直接跟随本教程，我们将使用公共血细胞检测数据集。</p><h1 id="6907" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">开源标签解决方案</h1><p id="9d00" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">如果你有未标记的图像，并想训练一个检测器来检测你的定制对象，我们建议免费试用，<a class="ae ki" href="https://blog.roboflow.ai/getting-started-with-cvat/" rel="noopener ugc nofollow" target="_blank">开源标记解决方案</a>。我们的首选是<a class="ae ki" href="https://blog.roboflow.ai/getting-started-with-cvat/" rel="noopener ugc nofollow" target="_blank">计算机视觉标注工具</a>、<a class="ae ki" href="https://blog.roboflow.ai/getting-started-with-cvat/" rel="noopener ugc nofollow" target="_blank"> CVAT </a>。参见本指南的<a class="ae ki" href="https://blog.roboflow.ai/getting-started-with-cvat/" rel="noopener ugc nofollow" target="_blank">如何开始使用 CVAT </a>。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d5d40b856743c4a370bd422a2f3568fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*PapX5M32FKJ16v-FU1EgXQ.gif"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">用<a class="ae ki" href="https://blog.roboflow.ai/getting-started-with-cvat/" rel="noopener ugc nofollow" target="_blank"> CVAT </a>注释数据集</p></figure><p id="6316" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">或者，您可以考虑其他解决方案来标记您自己的对象检测数据集，例如<a class="ae ki" href="https://blog.roboflow.ai/getting-started-with-labelimg-for-labeling-object-detection-data/" rel="noopener ugc nofollow" target="_blank"> LabelImg </a>。</p><p id="54c2" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">无论您使用哪种工具，我们都建议以<a class="ae ki" href="https://roboflow.com/formats/pascal-voc-xml" rel="noopener ugc nofollow" target="_blank"> <strong class="kl iu"> VOC XML </strong> </a>格式导出您的注释，您可以稍后<a class="ae ki" href="https://roboflow.com/formats" rel="noopener ugc nofollow" target="_blank">将其转换为您需要的任何格式</a>。我们发现 VOC XML 不容易出错。</p><h1 id="13bc" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">安装 TensorFlow 2 对象检测依赖项</h1><p id="c5c9" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">一旦你有了一个<a class="ae ki" href="https://public.roboflow.com/" rel="noopener ugc nofollow" target="_blank">标记的数据集，</a>你就可以开始训练程序了。</p><p id="8a41" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我推荐打开这本<a class="ae ki" href="https://colab.research.google.com/drive/1sLqFKVV94wm-lglFq_0kGo2ciM0kecWD#scrollTo=fF8ysCfYKgTP&amp;uniqifier=1" rel="noopener ugc nofollow" target="_blank"> Colab 笔记本训练 TensorFlow2 物体探测模型</a>，并和这篇博文一起研究它。打开并在 Drive 中保存一份副本，这样您就有了自己版本的 Colab 笔记本。</p><p id="33e2" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">Google Colab 还提供了免费的 GPU 资源用于培训，所以请确保通过选择运行时→更改运行时类型→ GPU 来打开它。</p><p id="faf7" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">然后，我们安装<code class="fe nj nk nl nm b">tensorflow_gpu=="2.2.0"</code>作为我们培训工作的骨干。</p><p id="74a4" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">之后，我们将对象检测库作为 python 包安装。</p><p id="581a" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><a class="ae ki" href="https://github.com/tensorflow/models/issues/8841" rel="noopener ugc nofollow" target="_blank"><strong class="kl iu"><em class="nn">Keras Bug</em></strong></a><em class="nn">:由于库太新，导出 TensorFlow2 对象检测模型时存在 Bug。我们通过重写一个 Keras utils 文件来解决这个问题。这应该在几天内消失，我们将相应地更新笔记本。</em></p><p id="6b19" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">接下来，我们运行 TF2 模型构建器测试，以确保我们的环境启动并运行。如果成功，您应该在单元执行输出的末尾看到以下输出。</p><pre class="lg lh li lj gt no nm np nq aw nr bi"><span id="609e" class="ns mk it nm b gy nt nu l nv nw">[       OK ] ModelBuilderTF2Test.test_create_ssd_models_from_config<br/>[ RUN      ] ModelBuilderTF2Test.test_invalid_faster_rcnn_batchnorm_update<br/>[       OK ] ModelBuilderTF2Test.test_invalid_faster_rcnn_batchnorm_update<br/>[ RUN      ] ModelBuilderTF2Test.test_invalid_first_stage_nms_iou_threshold<br/>[       OK ] ModelBuilderTF2Test.test_invalid_first_stage_nms_iou_threshold<br/>[ RUN      ] ModelBuilderTF2Test.test_invalid_model_config_proto<br/>[       OK ] ModelBuilderTF2Test.test_invalid_model_config_proto<br/>[ RUN      ] ModelBuilderTF2Test.test_invalid_second_stage_batch_size<br/>[       OK ] ModelBuilderTF2Test.test_invalid_second_stage_batch_size<br/>[ RUN      ] ModelBuilderTF2Test.test_session<br/>[  SKIPPED ] ModelBuilderTF2Test.test_session<br/>[ RUN      ] ModelBuilderTF2Test.test_unknown_faster_rcnn_feature_extractor<br/>[       OK ] ModelBuilderTF2Test.test_unknown_faster_rcnn_feature_extractor<br/>[ RUN      ] ModelBuilderTF2Test.test_unknown_meta_architecture<br/>[       OK ] ModelBuilderTF2Test.test_unknown_meta_architecture<br/>[ RUN      ] ModelBuilderTF2Test.test_unknown_ssd_feature_extractor<br/>[       OK ] ModelBuilderTF2Test.test_unknown_ssd_feature_extractor<br/>----------------------------------------------------------------------<br/>Ran 20 tests in 52.705s</span><span id="ef1b" class="ns mk it nm b gy nx nu l nv nw">OK (skipped=1)</span></pre><h1 id="c62b" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">准备 TensorFlow 2 对象检测训练数据</h1><p id="b09a" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">一旦我们的编程环境被正确安装，我们需要以<a class="ae ki" href="https://blog.roboflow.ai/how-to-create-to-a-tfrecord-file-for-computer-vision/" rel="noopener ugc nofollow" target="_blank"> TFRecord 格式</a>获取数据集的一个版本。</p><p id="281b" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">为此，我们建议对您的<a class="ae ki" href="https://blog.roboflow.com/tag/augmentation/" rel="noopener ugc nofollow" target="_blank">数据转换</a>使用 Roboflow。首先，<a class="ae ki" href="https://roboflow.ai/" rel="noopener ugc nofollow" target="_blank">注册一个免费账户</a>并上传你的数据集。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/f35d0cf95cdfc7a33bfad670f5ec3f06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*PfqdygpTKbazAGwJ5msu8g.gif"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">拖放以任何格式将数据上传到 Roboflow</p></figure><p id="ea23" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">上传后，系统会提示您选择版本化数据集的选项，包括<a class="ae ki" href="https://blog.roboflow.com/tag/preprocessing/" rel="noopener ugc nofollow" target="_blank">预处理</a>和<a class="ae ki" href="https://blog.roboflow.com/tag/augmentation/" rel="noopener ugc nofollow" target="_blank">增强</a>。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nz"><img src="../Images/af193985189bf4bc83c035735dc77282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WMf-pxZG7BvupDkH.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">我们的<a class="ae ki" href="https://public.roboflow.ai/object-detection/bccd" rel="noopener ugc nofollow" target="_blank"> BCCD 数据集</a>的增强和预处理选择</p></figure><p id="cebd" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">选择这些选项后，点击<code class="fe nj nk nl nm b">Generate</code>，然后点击<code class="fe nj nk nl nm b">Download</code>。系统将提示您选择导出的数据格式。选择<code class="fe nj nk nl nm b">Tensorflow TFRecord </code> <a class="ae ki" href="https://roboflow.com/formats/tensorflow-tfrecord" rel="noopener ugc nofollow" target="_blank">格式</a>。</p><p id="71b6" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><em class="nn">注意:除了在 Roboflow 中创建 TFRecords </em>  <em class="nn">之外，您还可以轻松地检查数据集及其注释</em>  <em class="nn">的健康状况，以及预处理和扩充数据以提高模型性能。</em></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oa"><img src="../Images/1588b801d58b96895e911b7381c83a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yrg5sBngK_zPLFvH.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">从 Roboflow 中选择<a class="ae ki" href="https://blog.roboflow.ai/how-to-create-to-a-tfrecord-file-for-computer-vision/" rel="noopener ugc nofollow" target="_blank"> TensorFlow TFRecord </a>导出格式</p></figure><p id="ba6b" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">导出后，您将收到一个<code class="fe nj nk nl nm b">curl</code>链接，将您的数据下载到我们的培训笔记本中。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/942f51401e0bf8ddcf208ee6d903b64d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/0*GEDJ96dlhVo9tkp8.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">下载我们的训练<a class="ae ki" href="https://blog.roboflow.ai/how-to-create-to-a-tfrecord-file-for-computer-vision/" rel="noopener ugc nofollow" target="_blank"> TFRecords </a>在<a class="ae ki" href="https://colab.research.google.com/drive/1sLqFKVV94wm-lglFq_0kGo2ciM0kecWD#scrollTo=QcHJuaurS_AO&amp;uniqifier=1" rel="noopener ugc nofollow" target="_blank"> TF2 物体检测 Colab 笔记本</a></p></figure><p id="4a00" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">最后，我们将训练数据文件映射到变量，以便在训练管道配置中使用。</p><h1 id="de92" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">编写自定义 TensorFlow 2 对象检测培训配置</h1><p id="4e4c" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">接下来，我们根据我们选择的对象检测模型编写专门的培训配置文件，以指导我们计划稍后在笔记本中运行的培训过程。</p><p id="c829" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">通过改变<code class="fe nj nk nl nm b">chosen_model</code>变量，您可以在可用的模型中进行选择。我们已经在<a class="ae ki" href="https://blog.roboflow.ai/breaking-down-efficientdet/" rel="noopener ugc nofollow" target="_blank"> EfficientDet 模型系列</a>的前几个模型中进行了编码，供您探索。如果你想使用更大的<a class="ae ki" href="https://blog.roboflow.ai/breaking-down-efficientdet/" rel="noopener ugc nofollow" target="_blank"> EfficientDet 模型</a>，你可能需要增加你的计算资源，而不仅仅是 Google Colab！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/2111783d7e92b44fb1e2cabfd7c18224.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/0*V486zQ3vbAcSy3Xt.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated"><a class="ae ki" href="https://arxiv.org/pdf/1911.09070.pdf" rel="noopener ugc nofollow" target="_blank"> EfficientDet 模型系列</a>是最先进的物体检测技术之一</p></figure><p id="050e" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">你也可以考虑在<a class="ae ki" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md" rel="noopener ugc nofollow" target="_blank"> TensorFlow 2 物体探测模型动物园</a>中添加任何你想要的模型。</p><p id="901a" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">每个型号都有一个<code class="fe nj nk nl nm b">model_name</code>，一个<code class="fe nj nk nl nm b">base_pipeline_file</code>，一个<code class="fe nj nk nl nm b">pretrained_checkpoint</code>，一个<code class="fe nj nk nl nm b">batch_size</code>。<code class="fe nj nk nl nm b">base_pipeline_file</code>是特定于每个模型类型的训练配置的外壳，由 TF2 OD 库的作者提供。<code class="fe nj nk nl nm b">pretrained_checkpoint</code>是在 COCO 数据集上预训练对象检测模型时保存的预训练权重文件的位置。我们将从这些权重开始，然后微调到我们特定的自定义数据集任务。通过使用预训练，我们的模型不需要从一开始就识别哪些特征可能对对象检测有用。</p><p id="35cd" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">定义了所有这些输入后，我们编辑<code class="fe nj nk nl nm b">base_pipeline_file</code>以指向我们的自定义数据<code class="fe nj nk nl nm b">pretrained_checkpoint</code>，并且我们还指定了一些训练参数。要训练更长时间，增加<code class="fe nj nk nl nm b">num_steps</code>，要训练更快，尝试增加<code class="fe nj nk nl nm b">batch_size</code>到你的 GPU 可以处理的水平。记住，用增加批量的相同因素来减少步骤数，以保持训练长度不变。</p><h1 id="f91e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">训练自定义 TensorFlow 2 对象检测器</h1><p id="5ddd" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">现在我们准备训练了！</p><p id="33e9" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们用以下命令开始训练:</p><pre class="lg lh li lj gt no nm np nq aw nr bi"><span id="fbfc" class="ns mk it nm b gy nt nu l nv nw">!python /content/models/research/object_detection/model_main_tf2.py <br/>    --pipeline_config_path={pipeline_file} \<br/>    --model_dir={model_dir} \<br/>    --alsologtostderr \<br/>    --num_train_steps={num_steps} \<br/>    --sample_1_of_n_eval_examples=1 \<br/>    --num_eval_steps={num_eval_steps}</span></pre><p id="25ef" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们的训练命令引用我们的<code class="fe nj nk nl nm b">pipeline_file</code>和<code class="fe nj nk nl nm b">model_dir</code>，我们希望模型在训练期间保存在那里。</p><p id="4fe0" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">在 Colab，即使有免费的 GPU，你也应该预料到训练是一个漫长的数小时的过程。请注意，Colab 会在一段时间(大约 45 分钟)不活动后停止您的内核会话，因此您可能需要在浏览器选项卡中保持交互。</p><h2 id="d721" class="ns mk it bd ml od oe dn mp of og dp mt ks oh oi mv kw oj ok mx la ol om mz on bi translated">培训评估</h2><p id="df0b" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">在撰写本文时，EfficientDet 的培训时间评估指标仍在构建中。代码就在那里，所以你可以尝试一下！如果你发现如何执行笔记本的这一部分，请<a class="ae ki" href="https://roboflow.ai/contact" rel="noopener ugc nofollow" target="_blank">给我们写信</a>！这不影响其他架构，TensorBoard eval 仍然有效。</p><h2 id="c327" class="ns mk it bd ml od oe dn mp of og dp mt ks oh oi mv kw oj ok mx la ol om mz on bi translated">张量板输出</h2><p id="1b9c" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">为了检验我们的训练成功，我们输出张量板，显示我们的模型损失函数在训练过程中是如何降低的。损失越低越好！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/f338163315a85b070fae7b01df42d24f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/0*YU-S2BMvWKGQ_G5S.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">TensorBoard 输出来可视化我们的训练程序</p></figure><h1 id="917d" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">导出经过训练的 TensorFlow 2 对象检测器权重</h1><p id="acf8" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">接下来，我们使用<code class="fe nj nk nl nm b">exporter_main_v2.py</code>将我们的模型从 TF2 OD 库检查点导出到一个<code class="fe nj nk nl nm b">.pb</code>冻结的图形文件中。对于我们来说,<code class="fe nj nk nl nm b">.pb</code>文件将更容易部署到应用程序和迁移到新的设置。请继续关注这方面的更多消息。</p><h1 id="c864" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">使用经过训练的 TensorFlow 2 对象检测对测试图像进行推断</h1><p id="4afc" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">现在我们有了一个训练好的 TensorFlow2 对象检测器，我们可以使用模型保存的权重对模型从未见过的 图像进行<a class="ae ki" href="https://blog.roboflow.com/train-test-split/" rel="noopener ugc nofollow" target="_blank">测试推断。</a></p><p id="5cd5" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><a class="ae ki" href="https://roboflow.com/formats/tensorflow-tfrecord" rel="noopener ugc nofollow" target="_blank"> TFRecord </a>不允许您访问底层图像，因此我们建议您在<code class="fe nj nk nl nm b"><a class="ae ki" href="https://roboflow.com/formats/coco-json" rel="noopener ugc nofollow" target="_blank">COCO JSON format</a></code>中再次导出数据集，以访问底层测试图像。</p><p id="8b55" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们从保存的检查点重建自定义对象检测器。通常，您希望选择最后一个检查点，但也可能希望选择对象检测器在验证集上表现最佳的检查点。</p><p id="34a3" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们从测试图像中随机抽取，并通过网络发送图像进行预测。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/b6f7b788c551d55722872d8f7b1fb0f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/0*m_5MIe5EOtLb-D3g.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">在我们的 EfficientDet 模型从未见过的图像上测试推论</p></figure><p id="6b2c" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们的模型在检测血流中不同类型的细胞方面做得非常好！</p><p id="397e" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">有了正确的数据集，你可以应用这项技术来教会模型识别世界上的任何物体。</p><h1 id="65d1" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结论</h1><p id="96d5" class="pw-post-body-paragraph kj kk it kl b km nd ju ko kp ne jx kr ks nf ku kv kw ng ky kz la nh lc ld le im bi translated">恭喜你！现在你知道如何使用<a class="ae ki" href="https://blog.roboflow.ai/the-tensorflow2-object-detection-library-is-here/" rel="noopener ugc nofollow" target="_blank"> TensorFlow 2 对象检测 API 工具包</a>训练自定义对象检测模型。</p><p id="916c" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><a class="ae ki" href="https://blog.roboflow.ai/the-tensorflow2-object-detection-library-is-here/" rel="noopener ugc nofollow" target="_blank"> TensorFlow 2 对象检测 API </a>允许您在最先进的计算机视觉技术之间切换，以检测您的定制对象。</p><p id="07b4" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们希望你喜欢！一如既往，愉快的调查。</p></div></div>    
</body>
</html>