<html>
<head>
<title>Pivot Tables — Data Aggregation Tool in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据透视表 Python 中的数据聚合工具</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pivot-tables-cross-tabulation-data-aggregation-tools-in-python-dd6791dbe3cd?source=collection_archive---------19-----------------------#2020-06-08">https://towardsdatascience.com/pivot-tables-cross-tabulation-data-aggregation-tools-in-python-dd6791dbe3cd?source=collection_archive---------19-----------------------#2020-06-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="86d4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 Python 中有效使用 pivot_table()函数的多种方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c8c3753b6430bfd52d37fc7c0dde3719.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ol4m2kahvJyzHeIY"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·温克勒在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="1586" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">探索性数据分析是机器学习项目的一个重要阶段。奇妙的熊猫图书馆为此配备了几个有用的功能。其中之一是<strong class="lb iu"> pivot_table </strong>，它在一个简洁的二维表格中总结了一个特性的值。数据分析软件中常见的数据汇总工具，提供了极大的灵活性。DataFrame 有一个 pivot_table 方法(<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pivot_table.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">熊猫)。DataFrame.pivot_table </strong>大多数情况下，我们最终会使用带有默认参数的 pivot_table。本文将通过优化使用默认参数来帮助您实现更多目标。</a></p><h1 id="1be6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据透视表()</h1><p id="d6fb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">pivot_table()方法返回一个<strong class="lb iu"> DataFrame </strong>，这是一个 Excel 风格的数据透视表。数据透视表通过一个或多个键聚合数据表，将数据排列在一个矩形中，其中一些组键沿行排列，一些组键沿列排列，形成一个二维表，提供数据的多维汇总。</p><h2 id="7830" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">句法</h2><p id="e513" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><code class="fe ne nf ng nh b"><strong class="lb iu">pandas.DataFrame.pivot_table()</strong></code></p><h2 id="6286" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">因素</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/8b7c95a2ee1dceeb4d83e033b9dcad4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xbudPIy4YgnkD9ejT0M-eg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pivot_table.html" rel="noopener ugc nofollow" target="_blank">https://pandas . pydata . org/pandas-docs/stable/reference/API/pandas。DataFrame.pivot_table.html </a></p></figure><h1 id="5be3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据透视表()的基本用法</h1><p id="a2bc" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们通过在数据集上应用这个方法来研究它的基本用法。<a class="ae ky" href="https://www.kaggle.com/tanyadayanand/online-shopping" rel="noopener ugc nofollow" target="_blank">文中用到的网购数据集</a>可以从 Kaggle 下载。为了直接进入代码，一个附带的<a class="ae ky" href="https://www.kaggle.com/tanyadayanand/multiple-ways-to-effectively-use-the-pivot-table" rel="noopener ugc nofollow" target="_blank">笔记本</a>发表在 Kaggle 上。</p><div class="nj nk gp gr nl nm"><a href="https://www.kaggle.com/tanyadayanand/multiple-ways-to-effectively-use-the-pivot-table" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">有效使用 pivot_table()的多种方法</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">使用 Kaggle 笔记本探索和运行机器学习代码|使用网上购物的数据</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">www.kaggle.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa ks nm"/></div></div></a></div><h2 id="e45a" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">导入数据集</h2><p id="43d3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们从导入必要的库和加载数据集开始。这是每个数据分析过程中必不可少的一步。</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="986e" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj"># Importing necessary libraries</em></strong></span><span id="d187" class="ms lw it nh b gy ok og l oh oi">import pandas as pd<br/>import numpy as np</span><span id="6451" class="ms lw it nh b gy ok og l oh oi"><strong class="nh iu"><em class="oj"># Importing and Loading the data into data frame</em></strong></span><span id="7b09" class="ms lw it nh b gy ok og l oh oi">market_df = pd.read_csv("../input/market.csv")<br/>customer_df = pd.read_csv("../input/customer.csv")<br/>product_df = pd.read_csv("../input/product.csv")<br/>shipping_df = pd.read_csv("../input/shipping.csv")<br/>orders_df = pd.read_csv("../input/order.csv")</span><span id="c9eb" class="ms lw it nh b gy ok og l oh oi"><strong class="nh iu"><em class="oj"># Merging the dataframes to create a master_df</em></strong></span><span id="f26f" class="ms lw it nh b gy ok og l oh oi">df_1 = pd.merge(market_df, customer_df, how='inner', on='Cust_id')<br/>df_2 = pd.merge(df_1, product_df, how='inner', on='Prod_id')<br/>df_3 = pd.merge(df_2, shipping_df, how='inner', on='Ship_id')<br/>master_df = pd.merge(df_3, orders_df, how='inner', on='Ord_id')</span></pre><h2 id="2930" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">提取前几行</h2><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="0049" class="ms lw it nh b gy of og l oh oi">master_df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/cb84cf39bb22126c0236a8c3dd09b22c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mTd9hh7WfEtZGDV4ECKT5Q.gif"/></div></div></figure><h2 id="9a83" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">计算空值的数量</h2><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="7290" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#Identifying Missing Values in Column</em></strong><br/>master_df.isnull().sum()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/98f270ac3792a248a52b2a89aca43ec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*GZDdwzOu42QdfzlHCfzfFQ.png"/></div></figure><p id="870e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，列<code class="fe ne nf ng nh b">Product_Base_Margin</code>具有空值。</p><p id="c630" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，我们对数据集的样子几乎没有任何概念。因此，现在让我们以多种不同的方式来研究 pivot_table()的用法，以进一步探索数据。</p><h1 id="2b67" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">1.在数据透视表中使用索引对数据进行分组</h1><p id="31dd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu">索引</strong>是我们用来对数据进行分组的列、分组器、数组或列表。最简单的数据透视表需要一个 dataframe 和一个<code class="fe ne nf ng nh b">index</code>。索引要素将显示在结果表的索引列中。默认情况下，如果没有指定 value 和 aggfunc 参数，它将对所有数值列数据进行平均。</p><p id="3865" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将使用<em class="oj"> Customer_Segment </em>列作为这里的<strong class="lb iu"> <em class="oj">索引</em> </strong>:</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="c244" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#a single index<br/>#Using </em></strong><a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pivot_table.html" rel="noopener ugc nofollow" target="_blank"><strong class="nh iu"><em class="oj">pandas.DataFrame.pivot_table</em></strong></a><strong class="nh iu"><em class="oj"><br/></em></strong>master_df.pivot_table(index = 'Customer_Segment')</span><span id="1deb" class="ms lw it nh b gy ok og l oh oi"><strong class="nh iu"><em class="oj">#Same as above - results in same output<br/>#Using </em></strong><a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html" rel="noopener ugc nofollow" target="_blank"><strong class="nh iu"><em class="oj">pandas.pivot_table</em></strong></a><strong class="nh iu"><em class="oj"><br/></em></strong>pd.pivot_table(master_df, index = 'Customer_Segment')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/d31d6c345c2e98e2eb0bf17b61f7c3cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NewVe81TdIwqdUlZlrUV7w.png"/></div></div></figure><p id="f1d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数返回一个以<em class="oj"> Customer_Segment </em>为索引的数据透视表，并对数字列进行平均。我们可以看到，数据透视表足够智能，可以根据<em class="oj"> Customer_Segment 开始聚合数据并进行汇总。</em></p><h2 id="dd82" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">运行具有多个索引的 pivot_table()</h2><p id="64c2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu"> <em class="oj"> pivot_tabl </em> e </strong>可以通过一个列表将多个特征作为索引。这增加了结果表中的粒度级别，我们可以获得更具体的结果:</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="a41c" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#multiple indexes</em></strong><br/>master_df.pivot_table(index =['Customer_Segment','Product_Category'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/8ee694e86634efe2de888bfd11001d88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b8Yv5HAFNAr0gXPZhKX2TQ.png"/></div></div></figure><p id="ccb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，pivot_table 将<em class="oj">产品类别</em>与<em class="oj">客户细分</em>组合在一起，并为我们提供了一个组合汇总表。现在我们开始了解数据透视表能为我们做些什么。</p><h1 id="1b0d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.用值聚合特定要素</h1><p id="4e80" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu"> <em class="oj"> </em>值</strong>参数是我们告诉函数要聚合哪些特性的地方。这是一个可选字段，如果我们不指定该值，那么该函数将聚合数据集的所有数字特征。在前面的索引示例中，我们看到对所有数字列进行了聚合。由于没有指定<em class="oj"> </em> value 参数，默认情况下，pivot_table 考虑所有数值列。</p><p id="0430" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下示例比较了<em class="oj">客户群</em>的<em class="oj">平均销售额</em></p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="51e3" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#Single value</em></strong><br/>master_df.pivot_table(values = 'Sales', index = 'Customer_Segment')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6de1e640552835fe65e77533f4340004.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*pXhZLbXbrIV-XDH6fdFWsw.png"/></div></figure><p id="79d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oj">销售</em>列自动对数据进行平均，但是我们也可以进行计数或求和(通过添加参数<code class="fe ne nf ng nh b">aggfunc</code>和<code class="fe ne nf ng nh b">np.sum </code>或<code class="fe ne nf ng nh b">count</code>)。</p><h2 id="9c70" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">聚合多个特征</h2><p id="f53c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">类似于<em class="oj">索引</em>参数，<em class="oj">值</em>参数也可以通过一个列表获取多个特征。</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="b6c4" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#multiple value</em></strong><br/>master_df.pivot_table(values = ['Order_Quantity','Sales'], index = 'Customer_Segment')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/2b3a8acd4af796c784de40848643b67f.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*_b8Xzq-KBt0Oaeee5STdBg.png"/></div></figure><p id="c2ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据透视表聚集了功能<em class="oj"> Order_Quantity </em>和<em class="oj"> Sales </em>的数据，并将其与<em class="oj"> Customer_Segment 分组。</em></p><h1 id="1ab4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.使用 aggfunc 操作数据</h1><p id="1a45" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如前所述，默认情况下，pivot_table 使用均值函数(<code class="fe ne nf ng nh b">numpy.mean</code>)来聚合或汇总数据。但是还有其他重要功能或功能列表需要考虑。<strong class="lb iu"> <em class="oj"> aggfunc </em> </strong>是<strong class="lb iu"> <em class="oj"> pivot_table </em> </strong>应用于我们分组数据的聚合函数。<code class="fe ne nf ng nh b">aggfunc</code>(可选)接受我们希望在群组中使用的功能或功能列表。聚集规范可以是诸如<code class="fe ne nf ng nh b">'sum'</code>、<code class="fe ne nf ng nh b">'mean'</code>、<code class="fe ne nf ng nh b">'count'</code>、<code class="fe ne nf ng nh b">'min'</code>、<code class="fe ne nf ng nh b">'max'</code>等字符串，或者是实现聚集的函数(例如<code class="fe ne nf ng nh b">np.sum()</code>、<code class="fe ne nf ng nh b">min()</code>、<code class="fe ne nf ng nh b">sum()</code>等)。现在是试验<code class="fe ne nf ng nh b">aggfunc</code>参数的时候了。</p><p id="3f42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个示例通过取平均值来聚合值:</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="aec6" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#Single aggrigate function(mean) and single value<br/></em></strong>master_df.pivot_table(values = 'Sales', index = 'Customer_Segment', aggfunc = 'mean')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6de1e640552835fe65e77533f4340004.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*pXhZLbXbrIV-XDH6fdFWsw.png"/></div></figure><p id="93c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个示例通过求和来聚合值。它比较各地区的订单总数。</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="c5f8" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#Single aggrigate function(sum) and single value<br/></em></strong>master_df.pivot_table(values = 'Order_Quantity', index = 'Region', aggfunc = 'sum')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/1e87db20576ea97971e22cd9a5d60927.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*APC-ZHPPTzyZrmLW00-McA.png"/></div></figure><p id="1cf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下示例通过对多列求和来进行聚合。</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="22d8" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#Sum aggregate function is applied to both the values</em></strong><br/>master_df.pivot_table(values = ['Order_Quantity','Sales'], index = 'Product_Category', aggfunc='sum')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/8141e7e229ce8a430871611dfe587b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*3Ivyu29Lc8G40VHJBZGQyw.png"/></div></figure><h2 id="c984" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">具有多重聚合功能的透视表</h2><p id="9b3d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们不仅可以指定我们想要的聚合函数，还可以指定多个聚合函数。例如，如果我们对<em class="oj">销售</em>的总数和计数都感兴趣，我们可以将函数指定为参数<strong class="lb iu"> aggfunc </strong>的列表。让我们试一试。</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="46c4" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#multiple Aggregating Function applied to single column</em></strong><br/>master_df.pivot_table(values = 'Sales', index = 'Product_Category', aggfunc=['sum', 'count'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/02217d14e72bb837a3837fe612a312ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*mPwfA5YyBIFyWbq4svAtnQ.png"/></div></figure><p id="2ac8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以提供一个集合函数列表来应用于每个值。下面是同样的例子。</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="c78c" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#Sum and Mean aggregate function is applied to both the values</em></strong><br/>master_df.pivot_table(values = ['Order_Quantity','Sales'], index = 'Product_Category', aggfunc=[np.sum, np.mean])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/eab11221f78e945e659695ef6cbb50bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*e-WWY1fkK-F9IJUm5rAtWQ.png"/></div></figure><h2 id="8ccd" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">不同的功能使用不同的聚合函数</h2><p id="b959" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们也可以对不同的特性使用不同的聚合函数。只需提供一个字典映射作为<strong class="lb iu"> aggfunc </strong>参数的输入，以特性名作为键，以相应的聚合函数作为值。</p><p id="7786" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，我将使用<strong class="lb iu"> <em class="oj"> sum </em> </strong>作为<strong class="lb iu"><em class="oj"/></strong><em class="oj">Order _ Quantity</em><strong class="lb iu"><em class="oj"/></strong>特性和<strong class="lb iu"> <em class="oj"> mean </em> </strong>作为<em class="oj"> Sales </em>特性。另外，请注意，我省略了关键字<code class="fe ne nf ng nh b">values</code>;为<code class="fe ne nf ng nh b">aggfunc</code>指定映射时，这是自动确定的。</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="6522" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#different aggregate applied to different values<br/></em></strong>master_df.pivot_table(index = 'Product_Category', aggfunc = {'Order_Quantity':sum, 'Sales':'mean'})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ov"><img src="../Images/c0a2d3d4c585c0ec72ed33a54d2e6b26.png" data-original-src="https://miro.medium.com/v2/format:webp/1*OS9c-r4lj3S7p5gtLydNHA.png"/></div></figure><p id="4f9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们给出多个聚集函数时，我们将得到一个多索引的数据帧作为输出。</p><h1 id="f4ff" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">4.特征与列参数之间的关系</h1><p id="77bf" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><em class="oj">列</em>参数在结果表的顶部水平显示数值。大多数时候，与使用<code class="fe ne nf ng nh b">columns</code>和<code class="fe ne nf ng nh b">values</code>相关的<code class="fe ne nf ng nh b">pivot_table</code>会被混淆。请记住，<code class="fe ne nf ng nh b">columns</code>是可选的，它们提供了一种补充方式来分割我们关心的实际值。聚合函数应用于我们列出的<code class="fe ne nf ng nh b">values</code>。</p><p id="8e85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们想查看按<em class="oj">客户细分</em>细分的<em class="oj">利润</em>，那么<code class="fe ne nf ng nh b">columns</code>参数允许我们定义一个或多个列。这里，我们比较了不同产品类别和不同客户群的总利润。</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="b901" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#Single column<br/>#Grouping by both rows and column<br/></em></strong>master_df.pivot_table(values = 'Profit', <br/>                      index = 'Product_Category', <br/>                      columns = 'Customer_Segment', <br/>                      aggfunc = 'sum')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/d5beab522509d9bfc79ceaa2eb2170c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*JUfzy12HS_2k4DSL20HZBw.png"/></div></figure><h2 id="359d" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">具有多列的 pivot_table()</h2><p id="65ed" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">使用多个特性作为索引没问题，但是使用一些特性作为列将帮助我们快速理解它们之间的关系。同样，通过合并<strong class="lb iu"> pivot_table </strong>的<strong class="lb iu">列</strong>参数，可以更好地查看结果表。</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="516f" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#multiple columns</em></strong><br/>master_df.pivot_table(values = 'Profit', <br/>                      index = 'Customer_Segment', <br/>                      columns = ['Product_Category','Ship_Mode'], <br/>                      aggfunc = 'count')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/f2157c9c61946ed282d8b67e6cbd7517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kwq9FxRV5BkCuOohl8PnNQ.png"/></div></div></figure><p id="eeca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">列</strong>和<strong class="lb iu">索引</strong>参数都是可选的，但是有效地使用它们将帮助我们直观地理解特征之间的关系。</p><h1 id="5d86" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">5.添加总行数/列数</h1><p id="57f0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有时计算每个分组的总数是很有用的。现在，如果我们想查看一些数据的总和，<code class="fe ne nf ng nh b">margins=True</code>会帮我们做到。<code class="fe ne nf ng nh b">margins</code>是将所有行和列相加的布尔类型(如小计/总计)，默认为“<strong class="lb iu"> <em class="oj"> False”。</em>T50】</strong></p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="319c" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#Margin</em></strong><br/>master_df.pivot_table(values = ‘Profit’, <br/> index = ‘Product_Category’, <br/> columns = ‘Customer_Segment’, <br/> aggfunc = ‘sum’, margins=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/f96dcea496016a5ead509922093a0310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*9pjIcomaBSvUtaJGQi6gtA.png"/></div></figure><p id="aeaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">边距标签可以用关键字<code class="fe ne nf ng nh b">margins_name</code>指定，默认为<code class="fe ne nf ng nh b">"All"</code>。<code class="fe ne nf ng nh b">margins_name</code>类型为 string，接受当 margins 等于 True 时包含总计的行/列的名称。</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="5a92" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#margins_name</em></strong><br/>master_df.pivot_table(values = 'Profit', <br/>                      index = 'Product_Category', <br/>                      columns = 'Customer_Segment', <br/>                      aggfunc = 'sum', <br/>                      margins=True,<br/>                      margins_name ='TOTAL')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/96d465a5ff502bcb48108ec0f16db64c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*GugA1Knmq8Fu6FjJ4fJQAQ.png"/></div></div></figure><p id="a577" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个参数都是可选的，通常有助于改善显示。</p><h1 id="440b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">6.处理缺失数据</h1><p id="6639" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">奶奶的有点让人分心。<strong class="lb iu"> <em class="oj"> pivot_table </em> </strong>通过参数<strong class="lb iu"> <em class="oj"> dropna </em> </strong>和<strong class="lb iu"> <em class="oj"> fill_value 帮助我们处理。</em> </strong>其中的两个选项<code class="fe ne nf ng nh b">fill_value</code>和<code class="fe ne nf ng nh b">dropna</code>与缺失数据有关，并且相当简单。</p><ul class=""><li id="64c6" class="oz pa it lb b lc ld lf lg li pb lm pc lq pd lu pe pf pg ph bi translated"><code class="fe ne nf ng nh b">dropna</code>是布尔类型，允许我们在条目都是<code class="fe ne nf ng nh b">NaN</code>的分组表中删除空值。它默认为 True。</li><li id="7145" class="oz pa it lb b lc pi lf pj li pk lm pl lq pm lu pe pf pg ph bi translated"><code class="fe ne nf ng nh b">fill_value</code>是标量类型，可用于用我们提供的值替换表中的 NaN 值。默认为无。</li></ul><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="69f4" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#Displaying NaN values in the table<br/>#These can be imputed using fill_value<br/></em></strong>master_df.pivot_table(values = 'Product_Base_Margin', <br/>                      index = 'Customer_Name', <br/>                     columns = 'Customer_Segment', <br/>                      aggfunc = 'mean')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/c1680eb948c91ae8944cd39abdaf32c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*hRfJnQmVp2uYX72gT_WALg.png"/></div></figure><p id="661a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将用来自<em class="oj"> Product_Base_Margin </em>列的平均值替换 NaN 值:</p><pre class="kj kk kl km gt ob nh oc od aw oe bi"><span id="aaee" class="ms lw it nh b gy of og l oh oi"><strong class="nh iu"><em class="oj">#imputing with mean using fill_value</em></strong><br/>master_df.pivot_table(values = 'Product_Base_Margin', <br/>                      index = 'Customer_Name', <br/>                     columns = 'Customer_Segment', <br/>                      aggfunc = 'mean', fill_value=np.mean(master_df['Product_Base_Margin']))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi po"><img src="../Images/5555a9ae3929e4cb58a8de901fa339dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*EypPgPkwmpw8cMgKbiZaHg.png"/></div></figure><p id="e517" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们没有所有条目都是<code class="fe ne nf ng nh b">NaN</code>的列，但是值得一提的是，如果我们有<code class="fe ne nf ng nh b">pivot_table</code>会根据<code class="fe ne nf ng nh b">dropna</code>的定义默认删除它们。</p><h1 id="791c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="d6c9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">因此，我们可以看到 pivot_table()是一个方便的工具，我们可以用这一行代码进行一些有趣的分析。当你构建数据透视表时，我认为一步一步来是最简单的。添加项目并检查每个步骤，以验证您是否获得了预期的结果，并查看哪种演示最符合您的需求。一旦您开始处理数据并慢慢添加项目，您就可以感受到它是如何工作的。</p><p id="1241" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经介绍了<code class="fe ne nf ng nh b">pivot_table</code>的强大参数，所以如果你在你的项目中使用这些方法进行实验，你会得到很多。</p></div><div class="ab cl pp pq hx pr" role="separator"><span class="ps bw bk pt pu pv"/><span class="ps bw bk pt pu pv"/><span class="ps bw bk pt pu"/></div><div class="im in io ip iq"><h1 id="87ac" class="lv lw it bd lx ly pw ma mb mc px me mf jz py ka mh kc pz kd mj kf qa kg ml mm bi translated">参考</h1><p id="9736" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">熊猫。DataFrame.pivot_table 文档</p></div></div>    
</body>
</html>