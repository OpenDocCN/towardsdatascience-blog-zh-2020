# ç†ŠçŒ«å°è´´å£«æˆ‘å¸Œæœ›æˆ‘ä»¥å‰å°±çŸ¥é“

> åŸæ–‡ï¼š<https://towardsdatascience.com/pandas-tips-i-wish-i-knew-before-ef4ea6a39e1a?source=collection_archive---------8----------------------->

## pivot æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿç†ŠçŒ«çš„ä¸»è¦æ„ä»¶æ˜¯ä»€ä¹ˆï¼Ÿè¿˜æœ‰æ›´å¤šâ€¦

![](img/9d85867082c21f878b734611c8f1c75c.png)

ä¼Šæ´›å¨œÂ·å¼—ç½—åˆ©å¸Œåœ¨ [Unsplash](https://unsplash.com/s/photos/panda-talk?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šçš„ç…§ç‰‡

æˆ‘æˆä¸ºç†ŠçŒ«è¶…çº§ç”¨æˆ·å·²ç»æœ‰å‡ å¹´äº†ã€‚æœ‰æ—¶å€™æˆ‘è®¤ä¸ºæˆ‘å·²ç»æŒæ¡äº†å®ƒï¼Œä½†æ˜¯å‡ ä¸ªæœˆåæˆ‘å‘ç°æˆ‘åƒä¸ªèœé¸Ÿä¸€æ ·ç¼–ç¨‹ã€‚æˆ‘ä»¬éƒ½ç»å†è¿‡ğŸ˜Šæˆ‘åœ¨è¿™é‡Œä¸ä½ åˆ†äº«çš„æŠ€å·§æ˜¯æˆ‘æœ€è¿‘å­¦åˆ°çš„ã€‚

è¦è¿è¡Œç¤ºä¾‹ï¼Œè¯·ä¸‹è½½è¿™ä¸ª [Jupyter ç¬”è®°æœ¬](https://romanorac.github.io/assets/notebooks/2020-04-01-pandas-tips-i-wish-i-knew.ipynb)ã€‚

**è¿™é‡Œæœ‰å‡ ä¸ªä½ å¯èƒ½ä¼šæ„Ÿå…´è¶£çš„é“¾æ¥:**

```
- [Complete your Python analyses 10x faster with Mito](https://trymito.io/) [Product]- [Free skill tests for Data Scientists & ML Engineers](https://aigents.co/skills) [Test]- [All New Self-Driving Car Engineer Nanodegree](https://imp.i115008.net/c/2402645/1116216/11298)[Course]
```

ä½ æ„¿æ„é˜…è¯»æ›´å¤šè¿™æ ·çš„æ–‡ç« å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œä½ å¯ä»¥ç‚¹å‡»ä¸Šé¢çš„ä»»ä½•é“¾æ¥æ¥æ”¯æŒæˆ‘ã€‚å…¶ä¸­ä¸€äº›æ˜¯é™„å±é“¾æ¥ï¼Œä½†ä½ ä¸éœ€è¦è´­ä¹°ä»»ä½•ä¸œè¥¿ã€‚

# è®©æˆ‘ä»¬ä»ä¸€ä¸ªçˆ†ç‚¸æ€§çš„æç¤ºå¼€å§‹ğŸ’¥

![](img/ffa46e4ebb7ed99f71dbab6c7c80ce50.png)

ä» [giphy](https://giphy.com/gifs/reactionseditor-l0IxYWDltdHEqujnO) ä¸‹è½½çš„ Gif

ç†ŠçŒ«æœ‰çˆ†ç‚¸çš„åŠŸèƒ½ã€‚åˆ«æ‹…å¿ƒï¼Œä½¿ç”¨å®ƒæ˜¯å®Œå…¨å®‰å…¨çš„ğŸ˜Šå½“ DataFrame åˆ—ä¸­å­˜å‚¨æœ‰åˆ—è¡¨æ—¶ï¼Œè¯¥å‡½æ•°éå¸¸æœ‰ç”¨ã€‚å®ƒè§£åŒ…åˆ—è¡¨ä¸­çš„å€¼ï¼Œå¹¶å¤åˆ¶æ‰€æœ‰å…¶ä»–å€¼ï¼Œå› æ­¤ä¼šçˆ†ç‚¸ğŸ’¥

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª DataFrameï¼Œå®ƒçš„ä¸€åˆ—åœ¨åˆ—è¡¨ä¸­æœ‰éšæœºæ•°é‡çš„å…ƒç´ ã€‚

```
n = 10
df = pd.DataFrame(
    {
        "list_col": [[random.randint(0, 10) for _ in range(random.randint(3, 5))] for _ in range(10)],
    }
)
df.shape(10, 1) # output
```

![](img/5234a8ea375f763593188cf3910806c1.png)

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ‰§è¡Œ explode å‡½æ•°ã€‚

```
df = df.explode("list_col")
df.shape(40, 1) #output
```

åœ¨ä¸‹è¡¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ç”±äºä»åˆ—è¡¨ä¸­è§£åŒ…å€¼ï¼Œç´¢å¼•è¢«é‡å¤ã€‚

![](img/1f7be639e0b3c225644092d03f891122.png)

# æ•°æ®å¸§ä¸æ˜¯ç†ŠçŒ«çš„ä¸»è¦æ„ä»¶

![](img/e977cc9bb3066c28ab5298961068e81b.png)

è¿·å› åˆ›é€ äº†[imgflip.com](https://imgflip.com/memegenerator)

Pandas å‡ ä¹æ˜¯ DataFrames çš„åŒä¹‰è¯ï¼Œä½†å¦‚æœæˆ‘å‘Šè¯‰ä½ å®ƒä¸æ˜¯å®ƒçš„ä¸»è¦æ„å»ºå—ï¼Œä½ å¯èƒ½ä¼šæ„Ÿåˆ°æƒŠè®¶ã€‚ç†ŠçŒ«æ•°æ®æ¡†æ¶æ˜¯å»ºç«‹åœ¨ç†ŠçŒ«ç³»åˆ—ä¹‹ä¸Šçš„ã€‚æ‰€ä»¥æ•°æ®å¸§ä¸­çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸€ä¸ªç³»åˆ—ã€‚æˆ‘ä»¬å¯ä»¥æ›´æ·±å…¥ï¼Œç†ŠçŒ«ç³»åˆ—æ˜¯åŸºäºä»€ä¹ˆï¼ŸNumpyï¼ä½†æ˜¯æˆ‘ä»¬ä¸è¦èµ°é‚£ä¹ˆè¿œã€‚

å½“æ”¶ç›Šè¶…è¿‡åœ¨é¡¹ç›®ä¸­å®‰è£… pandas çš„æˆæœ¬æ—¶ï¼Œæˆ‘ç”šè‡³å°† Python çš„ list åŒ…å«åœ¨ pandas ç³»åˆ—ä¸­â€”â€”æˆ‘è¿™é‡ŒæŒ‡çš„æ˜¯åç«¯ï¼Œè€Œä¸æ˜¯åˆ†æé¡¹ç›®ã€‚

è®©æˆ‘ä»¬ç”¨çª—å£ 2 è®¡ç®—ä¸€ä¸ªåˆ—è¡¨ä¸­å€¼çš„æ»šåŠ¨å’Œã€‚

```
values = [1, 2, 0, 0, 0, 0, 1, 2, 3]
sr = pd.Series(values)
sr.rolling(2).sum()
```

![](img/01463e6da630963f7b6bf055288c32f8.png)

è¿™æ ·ä»£ç å°±æ›´ç®€æ´äº†ã€‚

# Pivot â€”æ•°æ®ç§‘å­¦å®¶çš„å¿…å¤‡å·¥å…·

![](img/85bb757b7b1350089ed877a1384d09a7.png)

ä» [giphy](https://giphy.com/gifs/Friends-season-5-episode-113-the-one-with-cop-UrbnbuU24p1zgyDMUH) ä¸‹è½½çš„ Gif

ä»€ä¹ˆæ˜¯æ”¯ç‚¹ï¼Ÿæ•°æ®é€è§†è¡¨æ˜¯ä¸€ä¸ªç»Ÿè®¡è¡¨ï¼Œå®ƒæ±‡æ€»äº†ä¸€ä¸ªæ›´å¹¿æ³›çš„è¡¨ä¸­çš„æ•°æ®ã€‚å¬èµ·æ¥å¾ˆæœ‰ç”¨ï¼è®©æˆ‘ä»¬è¯•ä¸€è¯•ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€å®¶æ°´æœåº—å’Œå‡ ä¸ªé¡¾å®¢ã€‚

```
df = pd.DataFrame(
    {
        "fruit": ["apple", "orange", "apple", "avocado", "orange"],
        "customer": ["ben", "alice", "ben", "josh", "steve"],
        "quantity": [1, 2, 3, 1, 2],
    }
)
```

![](img/6ea5ba372066e89e74dc82ceddc1ae2f.png)

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨ fruit å’Œ customer åˆ—ä»¥åŠèšåˆæ•°é‡å€¼æ¥é€è§†è¡¨ã€‚æˆ‘ä»¬æœŸå¾…ä¸€å¼ æ¡Œå­ï¼Œæ°´æœåœ¨ä¸€ä¸ªè½´ä¸Šï¼Œé¡¾å®¢åœ¨å¦ä¸€ä¸ªè½´ä¸Šã€‚åº”åˆè®¡æ•°é‡å€¼

```
df.pivot(index="fruit", columns="customer", values="quantity")
```

![](img/9d6327384429483adaf4f055fd07a617.png)

æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªâ€œå€¼é”™è¯¯:ç´¢å¼•åŒ…å«é‡å¤æ¡ç›®ï¼Œæ— æ³•æ•´å½¢â€ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªä¸åŒçš„å‘½ä»¤(ä½†æ˜¯æ›´å®¹æ˜“è§£é‡Š)æ¥å°è¯• pivotï¼Œå®ƒä¸ pivot å‡½æ•°å…·æœ‰ç›¸åŒçš„æ•ˆæœã€‚

```
df.set_index(["fruit", "customer"])["quantity"].unstack()
```

è¯¥å‘½ä»¤è¿”å›ä¸ pivot å‡½æ•°ç›¸åŒçš„é”™è¯¯ï¼Œä½†æ˜¯æ›´æ¸…æ¥šå¹•åå‘ç”Ÿäº†ä»€ä¹ˆã€‚æ°´æœåˆ—å’Œå®¢æˆ·åˆ—ç»„åˆåœ¨ä¸€èµ·æ—¶ä¼¼ä¹æ²¡æœ‰å”¯ä¸€çš„ç´¢å¼•ã€‚

![](img/e446be87964fd241e00637aa3365f7f9.png)

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•ä½¿ç”¨ pivot_table å‡½æ•°ï¼Œè¿™ä¹Ÿæ˜¯æ¨èçš„æ–¹æ³•ã€‚æ³¨æ„ï¼Œè¯¥å‡½æ•°è¿˜æ”¯æŒ aggfuncï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ np.meanã€‚æˆ‘ä»¬åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ä½¿ç”¨ np.sumã€‚

```
df.pivot_table(index="fruit", columns="customer", values="quantity", aggfunc=np.sum)
```

![](img/a77da3ed230a1dce4fd100cd201728da.png)

# å¾ˆå°‘å€¼å¾—ä¸€æ

![](img/da023c8128277f7f7c93330d4013d463.png)

ä» [giphy](https://giphy.com/gifs/waynes-world-wayne-campbell-MUeQeEQaDCjE4) ä¸‹è½½çš„ Gif

## è®¿é—®å…ƒç´ 

è®¿é—®æ•°æ®å¸§ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ (å’Œæœ€åä¸€ä¸ªå…ƒç´ )éå¸¸ç®€å•:

```
df = pd.DataFrame({"col": [1, 2, 3, 4, 5]})df.iloc[0]df.iloc[-1] # the last element
```

ä½ å¯èƒ½ä¼šé—® loc å’Œ iloc æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå½“é€šè¿‡ç´¢å¼•è®¿é—®è¡Œæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ locï¼Œå…¶ä¸­ç´¢å¼•å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–å…¶ä»–ç±»å‹ã€‚

æˆ‘ä»¬è¿˜ä½¿ç”¨ loc åœ¨æŸä¸ªç´¢å¼•ä¸Šè®¾ç½®ä¸€ä¸ªæ–°çš„åˆ—å€¼(æˆ‘ä»¬ä¸èƒ½ç”¨ iloc è¿™æ ·åšâ€”å®ƒä¼šè¿”å› ValueError):

```
df.loc[0, "col"] = 1
```

## è¿½åŠ å€¼

Pandas æœ‰ä¸€ä¸ª append å‡½æ•°ï¼Œä½¿æ‚¨èƒ½å¤Ÿå°†å€¼è¿½åŠ åˆ°æ•°æ®å¸§ä¸­ã€‚ä½†æ˜¯æŠ€å·§æ˜¯é™„åŠ çš„å€¼ä¹Ÿéœ€è¦åœ¨æ•°æ®å¸§ä¸­ã€‚

```
df = df.append(pd.DataFrame({'col': [999]}))
df
```

![](img/1213d3d97a3400188153460c1bb8fff7.png)

## è¡Œåˆ°åˆ—

æˆ‘æœ€å–œæ¬¢çš„å°†è¡Œå˜æˆåˆ—çš„æ–¹æ³•æ˜¯ä½¿ç”¨è½¬ç½®ã€‚å®ƒåœ¨ numpy ä¸­ä¹Ÿæœ‰æ•ˆã€‚

```
df.T
```

![](img/46294bc77605beb2222203d94a2e466d.png)

# åœ¨ä½ èµ°ä¹‹å‰

åœ¨[æ¨ç‰¹](https://twitter.com/romanorac)ä¸Šå…³æ³¨æˆ‘ï¼Œåœ¨é‚£é‡Œæˆ‘å®šæœŸ[å‘å…³äºæ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ çš„æ¨ç‰¹](https://twitter.com/romanorac/status/1328952374447267843)ã€‚

![](img/b5d426b68cc5a21b1a35d0a157ebc4f8.png)

ç…§ç‰‡ç”±[Courtney hedge](https://unsplash.com/@cmhedger?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„