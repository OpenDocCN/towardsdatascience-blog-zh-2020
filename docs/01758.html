<html>
<head>
<title>Face Detection on Custom Dataset with Detectron2 and PyTorch using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 使用 Detectron2 和 PyTorch 在自定义数据集上进行人脸检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/face-detection-on-custom-dataset-with-detectron2-and-pytorch-using-python-23c17e99e162?source=collection_archive---------4-----------------------#2020-02-18">https://towardsdatascience.com/face-detection-on-custom-dataset-with-detectron2-and-pytorch-using-python-23c17e99e162?source=collection_archive---------4-----------------------#2020-02-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3e35" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在自定义人脸检测数据集上微调预训练对象检测模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/63eb8cc346088bd00c16c3078be58da1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YCg8feREW6dC7jI3uCTptA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原始照片由<a class="ae ky" href="https://unsplash.com/@chrisjoelcampbell" rel="noopener ugc nofollow" target="_blank">克里斯托弗·坎贝尔</a></p></figure><blockquote class="kz"><p id="49a5" class="la lb it bd lc ld le lf lg lh li lj dk translated"><em class="lk">TL；DR 了解如何为 Detectron2 和 PyTorch 准备自定义人脸检测数据集。微调预先训练的模型，以在图像中找到人脸边界。</em></p></blockquote><figure class="ll lm ln lo lp kn"><div class="bz fp l di"><div class="lq lr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">观看教程的视频版本</p></figure><p id="bea5" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">人脸检测是在图像中寻找人脸(边界)的任务。这对于以下方面很有用</p><ul class=""><li id="1e10" class="mn mo it lu b lv lw ly lz mb mp mf mq mj mr lj ms mt mu mv bi translated">安全系统(识别一个人的第一步)</li><li id="b7a4" class="mn mo it lu b lv mw ly mx mb my mf mz mj na lj ms mt mu mv bi translated">自动对焦和笑脸检测功能，让您拍出精彩照片</li><li id="2f9f" class="mn mo it lu b lv mw ly mx mb my mf mz mj na lj ms mt mu mv bi translated">检测年龄、种族和情绪状态进行标记(是的，我们已经生活在那个世界中)</li></ul><p id="a14f" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">从历史上看，这是一个很难解决的问题。大量的人工特征工程、新颖的算法和方法被开发出来，以提高艺术水平。</p><p id="1ba4" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">如今，几乎每个计算机视觉包/框架中都包含了人脸检测模型。一些表现最好的使用深度学习方法。例如，OpenCV 提供了多种工具，如<a class="ae ky" href="https://docs.opencv.org/4.2.0/db/d28/tutorial_cascade_classifier.html" rel="noopener ugc nofollow" target="_blank">级联分类器</a>。</p><ul class=""><li id="8323" class="mn mo it lu b lv lw ly lz mb mp mf mq mj mr lj ms mt mu mv bi translated"><a class="ae ky" href="https://colab.research.google.com/drive/1Jk4-qX9zdYGsBrTnh2vF52CV9ucuqpjk" rel="noopener ugc nofollow" target="_blank">在浏览器中运行完整的笔记本(Google Colab) </a></li><li id="a749" class="mn mo it lu b lv mw ly mx mb my mf mz mj na lj ms mt mu mv bi translated"><a class="ae ky" href="https://github.com/curiousily/Getting-Things-Done-with-Pytorch" rel="noopener ugc nofollow" target="_blank">阅读 Pytorch 书籍</a></li></ul><div class="nb nc gp gr nd ne"><a href="https://leanpub.com/getting-things-done-with-pytorch" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd iu gy z fp nj fr fs nk fu fw is bi translated">用 PyTorch 完成任务</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">“成功创造人工智能将是人类历史上最大的事件。不幸的是，这也可能是最后一次，除非…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">leanpub.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns ks ne"/></div></div></a></div><p id="6fbc" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">在本指南中，您将学习如何:</p><ul class=""><li id="6d7a" class="mn mo it lu b lv lw ly lz mb mp mf mq mj mr lj ms mt mu mv bi translated">使用 Detectron2 为人脸检测准备自定义数据集</li><li id="0759" class="mn mo it lu b lv mw ly mx mb my mf mz mj na lj ms mt mu mv bi translated">使用(接近)最先进的对象检测模型来查找图像中的人脸</li><li id="e340" class="mn mo it lu b lv mw ly mx mb my mf mz mj na lj ms mt mu mv bi translated">你可以把这项工作扩展到人脸识别。</li></ul><p id="165c" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">以下是本指南结尾部分的一个示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/194a5321d4ee2d5c80332d1305845689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qKb9tEbYs23jVPyf.png"/></div></div></figure><h1 id="5a36" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">检测器 2</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/f2322e36df2d20df1668a2878f95f1b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VbMjGBHMC6GnDKUp.png"/></div></div></figure><p id="a2ef" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated"><a class="ae ky" href="https://github.com/facebookresearch/detectron2" rel="noopener ugc nofollow" target="_blank"> Detectron2 </a>是一个用于构建最先进的对象检测和图像分割模型的框架。它是由脸书研究小组开发的。Detectron2 是对第一版的完全重写。</p><p id="e55d" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">在引擎盖下，Detectron2 使用 PyTorch(与最新版本兼容)，并允许<a class="ae ky" href="https://detectron2.readthedocs.io/notes/benchmarks.html" rel="noopener ugc nofollow" target="_blank">极快的训练</a>。你可以在脸书研究公司的介绍性博客文章中了解更多信息。</p><p id="1b9c" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">《侦探 2》的真正威力在于<a class="ae ky" href="https://github.com/facebookresearch/detectron2/blob/master/MODEL_ZOO.md" rel="noopener ugc nofollow" target="_blank">模型动物园</a>里有大量预先训练好的模型。但是如果你不能在你自己的数据集上进行微调，那又有什么好处呢？还好，那超级容易！我们将在本指南中了解如何做到这一点。</p><h1 id="784b" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">安装检测器 2</h1><p id="8cc3" class="pw-post-body-paragraph ls lt it lu b lv on ju lx ly oo jx ma mb op md me mf oq mh mi mj or ml mm lj im bi translated">在撰写本文时，Detectron2 仍处于 alpha 阶段。虽然有正式版本，我们将从主分支克隆和编译。这应该等于版本 0.1。</p><p id="0bb7" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">让我们从安装一些需求开始:</p><pre class="kj kk kl km gt os ot ou ov aw ow bi"><span id="a87f" class="ox nv it ot b gy oy oz l pa pb">!pip install -q cython pyyaml == 5.1 <br/>!pip install -q -U 'git+https://github.com/cocodataset/cocoapi.git#subdirectory=PythonAPI'</span></pre><p id="f755" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">并下载、编译和安装 Detectron2 软件包:</p><pre class="kj kk kl km gt os ot ou ov aw ow bi"><span id="b4f4" class="ox nv it ot b gy oy oz l pa pb">!git clone <a class="ae ky" href="https://github.com/facebookresearch/detectron2" rel="noopener ugc nofollow" target="_blank">https://github.com/facebookresearch/detectron2</a> detectron2_repo <br/>!pip install -q -e detectron2_repo</span></pre><blockquote class="pc pd pe"><p id="79f0" class="ls lt pf lu b lv lw ju lx ly lz jx ma pg mc md me ph mg mh mi pi mk ml mm lj im bi translated"><em class="it">此时，您需要重启笔记本运行时才能继续！</em></p></blockquote><pre class="kj kk kl km gt os ot ou ov aw ow bi"><span id="9ff9" class="ox nv it ot b gy oy oz l pa pb">%reload_ext watermark %watermark -v -p numpy,pandas,pycocotools,torch,torchvision,detectron2</span><span id="03bb" class="ox nv it ot b gy pj oz l pa pb">CPython 3.6.9<br/>IPython 5.5.0<br/>numpy 1.17.5<br/>pandas 0.25.3<br/>pycocotools 2.0<br/>torch 1.4.0<br/>torchvision 0.5.0<br/>detectron2 0.1</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><h1 id="c535" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">人脸检测数据</h1><p id="0059" class="pw-post-body-paragraph ls lt it lu b lv on ju lx ly oo jx ma mb op md me mf oq mh mi mj or ml mm lj im bi translated">数据集在公共领域可免费获得<a class="ae ky" href="https://dataturks.com/projects/devika.mishra/face_detection" rel="noopener ugc nofollow" target="_blank">。由</a><a class="ae ky" href="https://dataturks.com/" rel="noopener ugc nofollow" target="_blank"> Dataturks </a>提供，托管在<a class="ae ky" href="https://www.kaggle.com/dataturks/face-detection-in-images" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上。以下是描述的摘录:</p><blockquote class="pc pd pe"><p id="9165" class="ls lt pf lu b lv lw ju lx ly lz jx ma pg mc md me ph mg mh mi pi mk ml mm lj im bi translated"><em class="it">用边界框标记的图像中的人脸。大约有 500 张图片，大约有 1100 张脸通过边框手动标记。</em></p></blockquote><p id="6c92" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">我已经下载了包含注释的 JSON 文件，并上传到 Google Drive。让我们来看看:</p><pre class="kj kk kl km gt os ot ou ov aw ow bi"><span id="b911" class="ox nv it ot b gy oy oz l pa pb">!gdown --id 1K79wJgmPTWamqb04Op2GxW0SW9oxw8KS</span></pre><p id="b7ee" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">让我们将文件加载到熊猫数据框中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="29bf" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">每行包含一个面注释。注意，多条线可能指向单个图像(例如，每个图像有多个面)。</p><h1 id="7eb1" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">数据预处理</h1><p id="f25c" class="pw-post-body-paragraph ls lt it lu b lv on ju lx ly oo jx ma mb op md me mf oq mh mi mj or ml mm lj im bi translated">数据集只包含图像 URL 和注释。我们得下载图像。我们还将规范化注释，以便稍后在 Detectron2 中更容易使用它们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="bd8a" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">让我们将数据放入数据框中，以便更好地查看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><pre class="kj kk kl km gt os ot ou ov aw ow bi"><span id="5f4d" class="ox nv it ot b gy oy oz l pa pb">409 1132</span></pre><p id="65a4" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">我们总共有 409 张图片(比承诺的 500 张少很多)和 1132 条注释。让我们将它们保存到磁盘中(以便您可以重复使用):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><h1 id="e0e5" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">数据探索</h1><p id="0b7c" class="pw-post-body-paragraph ls lt it lu b lv on ju lx ly oo jx ma mb op md me mf oq mh mi mj or ml mm lj im bi translated">让我们看看一些带注释的数据示例。我们将使用 OpenCV 加载图像，添加边界框，并调整其大小。我们将定义一个助手函数来完成这一切:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="2c5e" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">让我们先展示一些带注释的图片:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/d1bbe19c71667bb16fdf6f549ace43ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NshuOAmmltPNhdqh.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/7a24c78ecb35d4195aef6763fbc23d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y6Rpv1NeqmQeKvHO.png"/></div></div></figure><p id="4dca" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">这些都是好的，注释清晰可见。我们可以用火炬视觉创建一个图像网格。请注意，这些图像有不同的大小，因此我们将调整它们的大小:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/a1ace499c6083899783c7578ac8cfd0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0Xi-BK_Vg5NoZAIO.png"/></div></div></figure><p id="50ba" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">您可以清楚地看到一些注释丢失了(第 4 列)。这对你来说是真实的数据，有时你必须以某种方式处理它。</p><h1 id="f79a" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">使用 Detectron 2 进行人脸检测</h1><p id="6075" class="pw-post-body-paragraph ls lt it lu b lv on ju lx ly oo jx ma mb op md me mf oq mh mi mj or ml mm lj im bi translated">现在是时候使用定制数据集来完成微调模型的步骤了。但是首先，让我们保存 5%的数据用于测试:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="1357" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">传统的火车<em class="pf">测试</em>分割在这里不起作用，因为我们想要在文件名之间进行分割。</p><p id="8cbf" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">接下来的部分以一种更通用的方式编写。显然，我们只有一张阶级脸。但是添加更多内容应该与向数据框添加更多注记一样简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="2935" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">接下来，我们将编写一个函数，将数据集转换为 Detectron2 使用的格式:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="65d1" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">我们将每个注释行转换成一个带有注释列表的记录。您可能还注意到，我们正在构建一个与边界框形状完全相同的多边形。这是 Detectron2 中的图像分割模型所必需的。</p><p id="aaa3" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">您必须将数据集注册到数据集和元数据目录中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="4790" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">不幸的是，默认情况下，测试集的评估器并不包含在内。我们可以通过编写自己的训练器来轻松解决这个问题:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="2411" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">如果没有提供文件夹，评估结果将存储在<code class="fe pm pn po ot b">coco_eval</code>文件夹中。</p><p id="bf84" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">微调 Detectron2 模型与编写 PyTorch 代码完全不同。我们将加载一个配置文件，更改一些值，然后开始训练过程。但是，嘿，如果你知道你在做什么，那真的很有帮助😂</p><p id="aee4" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">在本教程中，我们将使用屏蔽 R-CNN X101-FPN 模型。它在<a class="ae ky" href="http://cocodataset.org/#home" rel="noopener ugc nofollow" target="_blank"> COCO 数据集</a>上进行了预训练，取得了非常好的性能。缺点是训练慢。</p><p id="3195" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">让我们加载配置文件和预训练的模型权重:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="32be" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">指定我们将用于培训和评估的数据集(我们已注册这些数据集):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="113a" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">对于优化器，我们将施一点魔法来收敛一些好的东西:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="6719" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">除了标准的东西(批量大小、最大迭代次数和学习率)，我们还有几个有趣的参数:</p><ul class=""><li id="18fe" class="mn mo it lu b lv lw ly lz mb mp mf mq mj mr lj ms mt mu mv bi translated"><code class="fe pm pn po ot b">WARMUP_ITERS</code> -学习率从 0 开始，到预设的迭代次数</li><li id="a056" class="mn mo it lu b lv mw ly mx mb my mf mz mj na lj ms mt mu mv bi translated"><code class="fe pm pn po ot b">STEPS</code> -学习率将减少<code class="fe pm pn po ot b">GAMMA</code>的检查点(迭代次数)</li></ul><p id="3afb" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">最后，我们将指定在测试集上进行评估的类的数量和时间段:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="7196" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">使用我们的定制训练器进行训练:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><h1 id="f267" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">评估对象检测模型</h1><p id="d748" class="pw-post-body-paragraph ls lt it lu b lv on ju lx ly oo jx ma mb op md me mf oq mh mi mj or ml mm lj im bi translated">与评估标准分类或回归模型相比，评估对象检测模型稍有不同。</p><p id="10d2" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">你需要知道的主要指标是 IoU(交集除以并集)。它测量两个边界之间的重叠——预测边界和实际边界。它可以得到 0 到 1 之间的值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/0c0b2cc7eadfcb0df31dc970984dfbdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*nsUrrHmmOFDrGjkF07hRbA.png"/></div></figure><p id="ee9e" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">使用 IoU，可以定义阈值(例如&gt; 0.5)来分类预测是真阳性(TP)还是假阳性(FP)。</p><p id="463f" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">现在，您可以通过计算精确度-召回曲线下的面积来计算平均精确度(AP)。</p><p id="613f" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">现在 AP@X(例如 AP50)只是某个 IoU 阈值的 AP。这将使您对如何评估对象检测模型有一个实用的理解。</p><p id="aa75" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">如果你想了解更多有关该主题的信息，我建议你阅读 Jonathan Hui 的目标检测教程的<a class="ae ky" href="https://medium.com/@jonathan_hui/map-mean-average-precision-for-object-detection-45c121a31173" rel="noopener">图(平均精度)。</a></p><p id="9bf3" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">我已经为您准备了一个预培训模型，因此您不必等待培训完成。让我们下载它:</p><pre class="kj kk kl km gt os ot ou ov aw ow bi"><span id="93ed" class="ox nv it ot b gy oy oz l pa pb">!gdown --id 18Ev2bpdKsBaDufhVKf0cT6RmM3FjW3nL <br/>!mv face_detector.pth output/model_final.pth</span></pre><p id="7c1e" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">我们可以通过加载模型并设置 85%确定性的最小阈值来开始进行预测，在该阈值时，我们将认为预测是正确的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="2c32" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">让我们用训练好的模型运行评估器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><h1 id="2324" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">在图像中查找人脸</h1><p id="1b56" class="pw-post-body-paragraph ls lt it lu b lv on ju lx ly oo jx ma mb op md me mf oq mh mi mj or ml mm lj im bi translated">接下来，让我们创建一个文件夹，并将所有带有预测注释的图像保存在测试集中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk lr l"/></div></figure><p id="05b8" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">让我们来看看:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/d1446929494cf9db24df87cff72767e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qtLVAOfZLzQpUkQK.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/b14fdad92e0891b3488156d919deb4e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TN1qN2tjccMeNx_w.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/9f32262401021b024dc2a4387f236392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0iaHLGxk6RYdb-Tq.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/89200a3cbae6b4da950d7753ed8c5be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cnrpn5xZE8aPrBqY.png"/></div></div></figure><p id="9069" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">还不错。一点也不差。我建议你也自己探索更多的图像！</p><p id="73a5" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">请注意，一些面有多个确定度不同的边界框(在第二个图像上)。也许训练模型更长时间会有帮助？增加或扩充现有数据怎么样？</p><h1 id="8a00" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">结论</h1><p id="1d42" class="pw-post-body-paragraph ls lt it lu b lv on ju lx ly oo jx ma mb op md me mf oq mh mi mj or ml mm lj im bi translated">恭喜你！您现在已经了解了 Detectron2 用于物体检测的基础知识！鉴于我们的数据集很小，你可能会对结果感到惊讶。这就是大型预训练模型的力量😍</p><ul class=""><li id="2fc2" class="mn mo it lu b lv lw ly lz mb mp mf mq mj mr lj ms mt mu mv bi translated"><a class="ae ky" href="https://colab.research.google.com/drive/1Jk4-qX9zdYGsBrTnh2vF52CV9ucuqpjk" rel="noopener ugc nofollow" target="_blank">在你的浏览器(Google Colab)中运行完整的笔记本</a></li><li id="53b5" class="mn mo it lu b lv mw ly mx mb my mf mz mj na lj ms mt mu mv bi translated"><a class="ae ky" href="https://github.com/curiousily/Getting-Things-Done-with-Pytorch" rel="noopener ugc nofollow" target="_blank">阅读 Pytorch 书籍</a></li></ul><p id="5589" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated">您学习了如何:</p><ul class=""><li id="b243" class="mn mo it lu b lv lw ly lz mb mp mf mq mj mr lj ms mt mu mv bi translated">使用 Detectron2 为人脸检测准备自定义数据集</li><li id="b79b" class="mn mo it lu b lv mw ly mx mb my mf mz mj na lj ms mt mu mv bi translated">使用(接近)最先进的对象检测模型来查找图像中的人脸</li><li id="6d7d" class="mn mo it lu b lv mw ly mx mb my mf mz mj na lj ms mt mu mv bi translated">你可以把这项工作扩展到人脸识别。</li></ul><h1 id="7a51" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">参考</h1><ul class=""><li id="8697" class="mn mo it lu b lv on ly oo mb pt mf pu mj pv lj ms mt mu mv bi translated"><a class="ae ky" href="https://www.kaggle.com/dataturks/face-detection-in-images" rel="noopener ugc nofollow" target="_blank">图像中的人脸检测</a></li><li id="5c50" class="mn mo it lu b lv mw ly mx mb my mf mz mj na lj ms mt mu mv bi translated"><a class="ae ky" href="https://github.com/facebookresearch/detectron2/" rel="noopener ugc nofollow" target="_blank">GitHub 上的检测器 2</a></li><li id="8803" class="mn mo it lu b lv mw ly mx mb my mf mz mj na lj ms mt mu mv bi translated"><a class="ae ky" href="https://medium.com/@jonathan_hui/map-mean-average-precision-for-object-detection-45c121a31173" rel="noopener">用于物体检测的 mAP(平均精度)</a></li></ul></div><div class="ab cl pw px hx py" role="separator"><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb"/></div><div class="im in io ip iq"><div class="kj kk kl km gt ne"><a href="https://leanpub.com/getting-things-done-with-pytorch" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd iu gy z fp nj fr fs nk fu fw is bi translated">用 PyTorch 完成任务</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">“成功创造人工智能将是人类历史上最大的事件。不幸的是，这也可能是最后一次，除非…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">leanpub.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns ks ne"/></div></div></a></div></div><div class="ab cl pw px hx py" role="separator"><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb"/></div><div class="im in io ip iq"><p id="4ed2" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm lj im bi translated"><em class="pf">最初发表于</em><a class="ae ky" href="https://www.curiousily.com/posts/face-detection-on-custom-dataset-with-detectron2-in-python/" rel="noopener ugc nofollow" target="_blank"><em class="pf">【https://www.curiousily.com】</em></a><em class="pf">。</em></p></div></div>    
</body>
</html>