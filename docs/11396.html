<html>
<head>
<title>Forecasting Tesla’s Stock Price Using Autoregression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用自回归预测特斯拉的股价</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/forecasting-teslas-stock-price-using-autoregression-52e7908d34b6?source=collection_archive---------19-----------------------#2020-08-07">https://towardsdatascience.com/forecasting-teslas-stock-price-using-autoregression-52e7908d34b6?source=collection_archive---------19-----------------------#2020-08-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9049" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用 Python 将基本的时间序列建模技术应用于 Tesla 的股票价格。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6b28ec679fd4eed423213f6aff8d7369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pb5jjNowzXvUQNEubPGvVQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">资料来源:Bram Van Oost via Unsplash。</p></figure><p id="8e2e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">过去几个月里，特斯拉一直在金融市场兴风作浪。此前被评为美国最被卖空的股票[1]，特斯拉的股价此后飙升至 2780 亿美元的市值[2]。其最新的季度业绩表明，它现在可以加入标准普尔 500 了，尽管它是美国第 12 大公司，但它目前还不是其成员[3]。</p><p id="bf13" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在市场波动、各种交易策略和“FOMO”(害怕错过)感的背景下，预测特斯拉股票的回报是一项艰巨的任务。但是，我们将使用 Python，使用自回归来预测特斯拉的股价回报。</p><p id="b757" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">探索数据</strong></p><p id="2e3b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们需要导入数据。我们可以使用从雅虎财经下载的历史股票价格数据。我们将使用“接近”价格进行分析。</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="759c" class="lw lx iq ls b gy ly lz l ma mb">import pandas as pd</span><span id="fb29" class="lw lx iq ls b gy mc lz l ma mb">df = pd.read_csv("TSLA.csv", index_col=0, parse_dates=[0])<br/>df.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi md"><img src="../Images/e88a85e317c060cd855b4cb7191c22fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*11D-5aTR_r17dmfBAPPhjA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:雅虎财经。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi me"><img src="../Images/838b8da2dd2ae6d02e944d6607d14fd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*5gJDjalxmdVPt1YOSd8vJw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:雅虎财经。</p></figure><p id="2493" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了确定 ARMA 模型的阶数，我们可以首先绘制一个<em class="mf">偏自相关函数。</em>这给出了因变量和其自身滞后之间的相关量的图形解释，<em class="mf">未通过<em class="mf">所有</em>低阶滞后的相关来解释</em>。</p><p id="b61e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从下面的 PACF 中，我们可以看到滞后的显著性在滞后 1 之后消失，这表明我们应该使用自回归(AR)模型[4]。</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="f6f5" class="lw lx iq ls b gy ly lz l ma mb"># Plot PACF<br/>from statsmodels.tsa.stattools import acf, pacf<br/>plt.bar(x=np.arange(0,41), height=pacf(df.Close))<br/>plt.title("PACF")</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/63a34ab8170026ec8bbcaad97cf4bb8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*vYxvda55Udevr_0lRQcouQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">有限&amp;滞后 1 后截止，所以 AR。</p></figure><p id="16a4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当绘制自相关函数时，我们会得到一个稍微不同的结果。该系列是无限的，并慢慢衰减，这表明 AR 或 ARMA 模型[4]。考虑到 PACF 和 ACF，我们将使用 AR 模型。</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="c8fb" class="lw lx iq ls b gy ly lz l ma mb">#Plot ACF<br/>plt.bar(x=np.arange(0,41), height=acf(df.Close))<br/>plt.title("ACF")</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/d3f78d0fce1223a481d46893658e34ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*8x_m_3ZOR292JWdchJE3mQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">无限和阻尼所以 AR/ARMA。</p></figure><p id="743c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">数据预处理</strong></p><p id="6a88" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在运行模型之前，我们必须确保我们使用的是<em class="mf">静态数据</em>。平稳性是指数据移动的方式不会随时间而改变的特征。查看本文前面看到的原始股票价格，很明显该序列不是平稳的。我们可以看到，随着时间的推移，股票价格以看似指数的方式上涨。</p><p id="e4d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，为了使数列平稳，我们<em class="mf">差分</em>数列，这实质上意味着<strong class="kx ir">从明天的值中减去今天的值。</strong>这会导致序列围绕一个常数均值(0)旋转，从而给出<em class="mf">股票收益</em>而不是股票价格。</p><p id="cd3d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还将使差分序列滞后 1，这<strong class="kx ir">将昨天的值向前推至今天。</strong>这样我们就可以得到我们的 AR 期限(Yt-1)。</p><p id="dea7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将这些值放入同一个数据帧后，我们将数据分成训练集和测试集。在代码中，数据被大致分成 80:20。</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="5cae" class="lw lx iq ls b gy ly lz l ma mb"># Make the data stationary by differencing<br/>tsla = df.Close.diff().fillna(0)</span><span id="5020" class="lw lx iq ls b gy mc lz l ma mb"># Create lag<br/>tsla_lag_1 = tsla.shift(1).fillna(0)</span><span id="41bb" class="lw lx iq ls b gy mc lz l ma mb"># Put all into one DataFrame<br/>df_regression = pd.DataFrame(tsla)<br/>df_regression["Lag1"] = tsla_lag_1</span><span id="ee59" class="lw lx iq ls b gy mc lz l ma mb"># Split into train and test data<br/>df_regression_train = df_regression.iloc[0:200]<br/>df_regression_test = df_regression.iloc[200:]</span><span id="9c63" class="lw lx iq ls b gy mc lz l ma mb">tsla.plot()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/7d586d7594cffc5ed93f11dc0634f4c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*RZZGfirREGuOkL-61Coofg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">差分序列。来源:雅虎财经。</p></figure><p id="5dde" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">形成 AR 模型</strong></p><p id="547d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们应该用多少个值来预测下一个观察值呢？使用所有过去的 200 个值可能不会给出很好的估计，因为直观上，200 天前的股票价格活动不太可能对今天的价值产生重大影响，因为自那时以来许多因素可能已经发生了变化。这可能包括收入、竞争、季节等等。因此，要找到用于回归的最佳观察窗口，我们可以使用的一种方法是使用<em class="mf">扩展窗口运行回归。</em>下面的代码详细介绍了这种方法，它使用一个过去的观察值进行回归，记录 r 平方值(拟合优度)，然后重复这一过程，<strong class="kx ir">每次将过去的观察值扩展 1。</strong>从经济角度来看，我将窗口期限制在 30 天。</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="b296" class="lw lx iq ls b gy ly lz l ma mb"># Run expanding window regression to find optimal window</span><span id="6c59" class="lw lx iq ls b gy mc lz l ma mb">n = 0<br/>rsquared = []</span><span id="f7b2" class="lw lx iq ls b gy mc lz l ma mb">while n&lt;=30:<br/>    <br/>    y = df_regression_train["Close"].iloc[-n:]<br/>    x = df_regression_train["Lag1"].iloc[-n:]<br/>    x = sm.add_constant(x)</span><span id="d319" class="lw lx iq ls b gy mc lz l ma mb">model = sm.OLS(y,x)<br/>    results = model.fit()</span><span id="21db" class="lw lx iq ls b gy mc lz l ma mb">rsquared.append(results.rsquared)</span><span id="83c5" class="lw lx iq ls b gy mc lz l ma mb">n +=1</span></pre><p id="d5f4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">查看每次迭代的 r 平方图，我们可以看到它在 1–5 次迭代附近较高，并且在 13 个过去值处也有一个峰值。在 1 和 5 之间选择一个值似乎很诱人，但是，非常小的样本量可能意味着我们的回归在统计上有偏差，所以不会给我们最好的结果。因此，让我们选择 13 次观察的第二个峰，因为这是一个更充分的样本量，它给出了大约 0.437 的 r 平方(即模型解释了数据中 43%的变化)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/30cf489c08b4dce4f61ceb1a89788513.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*tPzzJnFsm3NtZWqxflpjeA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">r 平方图。</p></figure><p id="b193" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">对训练数据运行 AR 模型</strong></p><p id="36bb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下一步是使用我们过去 13 次观察的窗口来拟合 AR(1)模型。我们可以使用 statsmodels 中的 OLS 函数来实现这一点。以下代码:</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="a3e1" class="lw lx iq ls b gy ly lz l ma mb"># AR(1) model with static coefficients</span><span id="7172" class="lw lx iq ls b gy mc lz l ma mb">import statsmodels.api as sm<br/>y = df_regression_train["Close"].iloc[-13:]<br/>x = df_regression_train["Lag1"].iloc[-13:]<br/>x = sm.add_constant(x)</span><span id="f806" class="lw lx iq ls b gy mc lz l ma mb">model = sm.OLS(y,x)<br/>results = model.fit()<br/>results.summary()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/e94838bec2b5456987185585e341b50d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*nJAqyRF4YE4VBTlaKERvbg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">AR(1)模型的回归输出(训练数据)。</p></figure><p id="62b9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">正如我们在统计摘要中看到的，常数和第一个滞后的 p 值在 10%的显著性水平上是显著的。查看系数的符号，常数上的正号表明，在其他条件相同的情况下，<strong class="kx ir"> </strong>股票价格回报应该为正。此外，第一个滞后上的负号表明，在其他条件相同的情况下，股票回报的过去值低于今天值，这也<strong class="kx ir">维持了股票回报随着时间推移而增加的说法。</strong></p><p id="476f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">很好，现在让我们使用这些系数来找到特斯拉股票回报的拟合值，这样我们就可以根据原始数据绘制模型。我们的模型现在可以指定为:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mj"><img src="../Images/51b78a375dcf740a1148c7588cd60309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fieb8pn21wGA1ncl5WLtTQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的 AR(1)方程。</p></figure><p id="a308" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">绘制残差图(实际-拟合)</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/1ef80c5f4825ab79c19f4e3b2fc8c594.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*EUuuG5ijst7vf3IXhP1tgg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">残差(训练数据)</p></figure><p id="7f3b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">残差表明模型在 2019 年表现更好，但在 2020 年随着波动性增加，模型表现相当差(残差更大)。这很直观，因为 2020 年 3 月抛售经历的波动对美国股市产生了巨大影响，而科技股尤其感受到了快速而可观的反弹。这一点，加上 Robinhood 等平台上的散户投资者加大了对特斯拉股票的押注，加剧了价格波动，从而加大了预测难度。</p><p id="053e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">考虑到这些因素，以及我们之前 43%左右的 r 平方，我们不会期望我们的 AR(1)模型能够预测准确的股票回报。相反，我们可以通过计算其“命中率”<strong class="kx ir">来测试模型的准确性，即当我们的模型预测为正值而实际值也为正值时</strong>，反之亦然。总结真阳性和真阴性的实例，我们的模型的准确性达到 55%左右，对于这个简单的模型来说，这是相当好的。</p><p id="1ca1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">根据测试数据拟合模型</strong></p><p id="9473" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，让我们将同样的方法应用于测试数据，看看我们的模型如何执行样本外的<em class="mf">。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/ff191e52b42231789d08898d237abc4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JmEuvkbddGoiKpKf2GSi5Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">实际值与拟合值(测试数据)。</p></figure><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="0e08" class="lw lx iq ls b gy ly lz l ma mb"># Calculate hit rate<br/>true_neg_test = np.sum((df_2_test["Fitted Value"] &lt;0) &amp; (df_2_test["Actual"] &lt;0))<br/>true_pos_test = np.sum((df_2_test["Fitted Value"] &gt;0) &amp; (df_2_test["Actual"] &gt;0))</span><span id="fd0b" class="lw lx iq ls b gy mc lz l ma mb">accuracy = (true_neg_test + true_pos_test)/len(df_2_test)<br/>print(accuracy)</span><span id="ab94" class="lw lx iq ls b gy mc lz l ma mb"># Output: 0.6415</span></pre><p id="4f53" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在将模型应用于测试数据时，我们的命中率提高到了 64%，这是一个很有希望的改进！提高其准确性的下一步可能包括运行滚动回归，其中系数随着每次迭代而变化，或者可能将移动平均(MA)元素并入模型。</p><p id="b1da" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> <em class="mf">感谢阅读！</em> </strong> <em class="mf">如果你有什么见解，欢迎随时留下评论。包含我用来做这个项目的源代码的完整 Jupyter 笔记本可以在我的</em> <a class="ae ml" href="https://github.com/nathanwilthomas/tsla_ar_forecasting" rel="noopener ugc nofollow" target="_blank"> <em class="mf"> Github 资源库</em> </a> <em class="mf">中找到。</em></p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><p id="6c17" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">参考</p><p id="db56" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">[1]卡门·赖尼克(2020)。特斯拉再次成为美国(TSLA)被卖空最多的股票。市场内幕。可在:<a class="ae ml" href="https://markets.businessinsider.com/news/stocks/tesla-stock-most-shorted-us-beats-apple-highest-short-interest-2020-1-1028823046" rel="noopener ugc nofollow" target="_blank">https://markets . business insider . com/news/stocks/Tesla-stock-most-shorted-us-beats-apple-higher-short-interest-2020-1-1028823046</a></p><p id="13bb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">[2]雅虎财经，截至 2020 年 8 月 6 日。</p><p id="7f41" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">[3]史蒂文斯，皮帕(2020)。“特斯拉可能很快就会加入标准普尔 500 指数，但这并不是自动的，即使全年都有盈利”。见:<a class="ae ml" href="https://www.cnbc.com/2020/07/21/tesla-isnt-a-gurantee-for-the-sp-500-even-with-year-of-profits.html" rel="noopener ugc nofollow" target="_blank">https://www . CNBC . com/2020/07/21/Tesla-not-a-guarantee-for-s-p-500-even-with-year-of-profits . html</a></p><p id="1d78" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">[4]约翰逊法官，迪纳多法官(1997 年)。<em class="mf">《计量经济学方法》，第四版。</em></p><p id="e6c4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="mf">免责声明:本文表达的所有观点均为本人观点，与任何金融实体无关。我不是一个交易者，也没有用本文中的方法赚钱。这不是财务建议。</em></p></div></div>    
</body>
</html>