<html>
<head>
<title>BBAug: A Package for Bounding Box Augmentation in PyTorch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BBAug:py torch中的包围盒增强包</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/bbaug-a-package-for-bounding-box-augmentation-in-pytorch-e9b9fbf1504b?source=collection_archive---------37-----------------------#2020-04-13">https://towardsdatascience.com/bbaug-a-package-for-bounding-box-augmentation-in-pytorch-e9b9fbf1504b?source=collection_archive---------37-----------------------#2020-04-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/b97ce4cb48b3a833386cd5674fd0bd84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S8Cwmo2i7-cQz2O_HtlpfQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://www.flickr.com/photos/35468148654@N01/3248455087" rel="noopener ugc nofollow" target="_blank">股票图片来源</a></p></figure><div class=""/><div class=""><h2 id="1fbc" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">Google Research，Brain团队制定的增强政策的实施</h2></div><p id="88cf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">链接:</strong></p><ul class=""><li id="3d2c" class="lu lv jj la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated"><a class="ae jg" href="https://arxiv.org/pdf/1906.11172.pdf" rel="noopener ugc nofollow" target="_blank">论文</a></li><li id="b2e5" class="lu lv jj la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><a class="ae jg" href="https://github.com/tensorflow/tpu/blob/2264f53d95852efbfb82ea27f03ca749e1205968/models/official/detection/utils/autoaugment_utils.py" rel="noopener ugc nofollow" target="_blank">张量流策略</a></li><li id="36dc" class="lu lv jj la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><a class="ae jg" href="https://github.com/harpalsahota/bbaug" rel="noopener ugc nofollow" target="_blank"> BBAug </a></li></ul><p id="97e1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi mi translated"><span class="l mj mk ml bm mm mn mo mp mq di"> O </span>像许多神经网络模型一样的对象检测模型在对大量数据进行训练时效果最佳。通常情况下，可用数据有限，世界各地的许多研究人员都在寻找增强策略来增加可用数据量。其中一项研究是由谷歌的大脑团队进行的，并发表在一篇名为<a class="ae jg" href="https://arxiv.org/abs/1906.11172" rel="noopener ugc nofollow" target="_blank">学习对象检测的数据增强策略</a>的论文中。在这篇论文中，作者确定了一组称为策略的扩充，它们对于对象检测问题表现良好。通过搜索提高一般模型性能的扩充来获得策略。</p><p id="6b8e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作者将增强策略定义为一组子策略。当模型被训练时，这些子策略中的一个被随机选择并用于增强图像。在每个子策略中，是一个接一个地应用于图像的增强。每个变换也有两个超参数:概率和大小。概率陈述了这种增强将被应用的可能性，而幅度表示增强的程度。下面的代码快照显示了本文中使用的策略:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="c9f0" class="na nb jj mw b gy nc nd l ne nf">policy = [      <br/>  [('TranslateX_BBox', 0.6, 4), ('Equalize', 0.8, 10)],        <br/>  [('TranslateY_Only_BBoxes', 0.2, 2), ('Cutout', 0.8, 8)],     <br/>  [('Sharpness', 0.0, 8), ('ShearX_BBox', 0.4, 0)],      <br/>  [('ShearY_BBox', 1.0, 2), ('TranslateY_Only_BBoxes', 0.6, 6)], <br/>  [('Rotate_BBox', 0.6, 10), ('Color', 1.0, 6)],<br/>]</span></pre><p id="0b3e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该策略中有5个子策略，如果我们采用第一个子策略，它包含<em class="ng"> TranslateX_BBox </em>和<em class="ng">均衡</em>增强。<em class="ng"> TranslateX_BBox </em>操作将图像在x轴上平移4倍。在这种情况下，幅值不直接转换成像素，而是根据幅值换算成像素值。该增强还具有0.6的概率，这意味着如果选择该增强，则有60%的机会应用该增强。随着每个增强具有相关的概率，引入了随机性的概念，为训练增加了一定程度的随机性。总的来说，大脑团队总共提出了4个策略<a class="ae jg" href="https://github.com/tensorflow/tpu/blob/2264f53d95852efbfb82ea27f03ca749e1205968/models/official/detection/utils/autoaugment_utils.py" rel="noopener ugc nofollow" target="_blank"/>:v 0、v1、v2和v3。本文中显示了v0策略，其他三个策略包含更多的子策略，这些子策略具有几种不同的转换。总体而言，这些增强分为三类，作者将其定义为:</p><blockquote class="nh ni nj"><p id="0ee5" class="ky kz ng la b lb lc kk ld le lf kn lg nk li lj lk nl lm ln lo nm lq lr ls lt im bi translated"><strong class="la jk">颜色操作</strong>:扭曲颜色通道，不影响边界框的位置</p><p id="5050" class="ky kz ng la b lb lc kk ld le lf kn lg nk li lj lk nl lm ln lo nm lq lr ls lt im bi translated"><strong class="la jk">几何操作:</strong>几何扭曲图像，相应地改变边界框的位置和大小。</p><p id="c63a" class="ky kz ng la b lb lc kk ld le lf kn lg nk li lj lk nl lm ln lo nm lq lr ls lt im bi translated"><strong class="la jk">包围盒操作:</strong>仅扭曲包围盒注释中包含的像素内容</p></blockquote><h1 id="a940" class="nn nb jj bd no np nq nr ns nt nu nv nw kp nx kq ny ks nz kt oa kv ob kw oc od bi translated">BBAug</h1><p id="cc9b" class="pw-post-body-paragraph ky kz jj la b lb oe kk ld le of kn lg lh og lj lk ll oh ln lo lp oi lr ls lt im bi translated">那么，这与什么有关呢？BBAug是一个python包，它实现了Google Brain团队派生的所有策略。这个包是一个包装器，可以更容易地使用这些策略。实际的增强是由优秀的<a class="ae jg" href="https://imgaug.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> imgaug </a>包完成的。</p><p id="af6c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面显示的策略应用于一个示例图像，如下所示。每行是不同的子策略，每列是所述子策略的不同运行。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/b333b2cd587b750648957d4ea7e7d82e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cEKquqA-mRUbo1u4L2iB9g.png"/></div></div></figure><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/9cb472bc8b45c5e669a6ad00303d2c44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TACPH9lWMNWUWzFHo26ssA.png"/></div></div></figure><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/eedd8ece378bee987fb35f04e3a14699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R_DLXcxl_ySSoVtQfRti1Q.png"/></div></div></figure><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/6ff311f26cfba7726da0b520febd99ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LL0_AIy82ygySL1HmHjiiA.png"/></div></div></figure><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/25d31ddfab0cb588b5c9f37d354bb30c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hv351wJDlsgIpJ0Fl2ohCg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://www.flickr.com/photos/35468148654@N01/3248455087" rel="noopener ugc nofollow" target="_blank">股票图片来源</a></p></figure><p id="9a6b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，子策略的运行之间存在一定程度的差异，因此增加了训练的随机性。这只是BBAug实施的4项政策之一。要全面了解所有4项政策，请查看软件包的<a class="ae jg" href="https://github.com/harpalsahota/bbaug" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>。该软件包还提供了一些有用的功能，如自定义策略的可能性，以及位于图像外部的边界框(如果它们部分位于图像外部)会被自动删除或裁剪。例如，在下图中，应用了平移增强，将边界框部分推出图像。你可以看到新的边界框已经缩小，以适应这一点。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ok"><img src="../Images/0372ce9fc1611c9e1ba004d7baeddd49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3v8ilmkQRK_rx-G8GdEAyQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://www.flickr.com/photos/35468148654@N01/3248455087" rel="noopener ugc nofollow" target="_blank">股票图片来源</a></p></figure><p id="68e5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">也可以创建仅影响边界框区域的增强。在下图中，曝光增强仅应用于边界框区域:</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ol"><img src="../Images/2a9b9334b2d0704feb05ada68698e14d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*iTbla0ogmaUK14uJNBStNQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://www.flickr.com/photos/35468148654@N01/3248455087" rel="noopener ugc nofollow" target="_blank">股票图片来源</a></p></figure><p id="1ce2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想了解更多信息，这个包还附带了一个<a class="ae jg" href="https://github.com/harpalsahota/bbaug/blob/master/notebooks/custom_augmentations.ipynb" rel="noopener ugc nofollow" target="_blank">定制增强</a>笔记本。</p><p id="17a5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">用随机策略扩充单个映像有多容易？就像这样简单:</p><figure class="mr ms mt mu gt iv"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="2faf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您首先需要从BBAug包中导入策略模块。在本模块中，有4种不同的政策可供您选择。在上面的示例中，选择了策略集v0，因为这是本文中使用的策略集。该模块还附带了一个容器类，它将保存我们选择的策略，选择一个随机策略，并将随机选择的策略应用到图像。第7行用我们选择的增强策略实例化了策略容器。下一段代码选择了一个随机增强。最后，我们对图像进行放大。只需5行代码，我们就可以对图像进行增强。这是一个相当简单的例子，如何将其扩展到训练模型？幸运的是，这个包附带了一个笔记本<a class="ae jg" href="https://github.com/harpalsahota/bbaug/blob/master/notebooks/example_run.ipynb" rel="noopener ugc nofollow" target="_blank">来演示如何将BBAug整合到PyTorch培训管道中。</a></p><h2 id="bb41" class="na nb jj bd no oo op dn ns oq or dp nw lh os ot ny ll ou ov oa lp ow ox oc oy bi translated">结论</h2><p id="a5b8" class="pw-post-body-paragraph ky kz jj la b lb oe kk ld le of kn lg lh og lj lk ll oh ln lo lp oi lr ls lt im bi translated">这个包实现了由Google Brain团队导出的增强策略。目前，所有4项政策均已实施，该套件附带笔记本电脑，可帮助用户将这些政策整合到他们的PyTorch培训渠道中。我强烈推荐查看软件包的GitHub页面，以便更好地理解所有政策和例子。</p><p id="2acf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">快乐充实！</p></div></div>    
</body>
</html>