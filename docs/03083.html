<html>
<head>
<title>Accelerate Geospatial Data Science With These Tricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用这些技巧加速地理空间数据科学</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/accelerate-geospatial-data-science-with-these-tricks-752d8b4e5381?source=collection_archive---------18-----------------------#2020-03-24">https://towardsdatascience.com/accelerate-geospatial-data-science-with-these-tricks-752d8b4e5381?source=collection_archive---------18-----------------------#2020-03-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8b85" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于如何用代码加速地理空间数据处理的提示和技巧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3fb38c39f77a8e64dc8d4f5a2707262d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bCpi12uN0Lw48pcD"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马修·施瓦茨在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="797f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个大数据时代，大数据集无处不在，而不是例外。虽然您可以在数据科学中使用一些其他加速技术，但地理数据科学有特殊的技术来增强您的地理数据处理。在这篇文章中，我分享了一些我最喜欢的技巧和诀窍来加速 Python 中地理空间数据的处理。</p><p id="be80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在整个教程中，我们使用纽约市出租车出行数据集。该数据包含 140 万个点。我们还使用出租车区域数据集来执行一些地理处理任务。我们首先使用 Geopandas 读取数据进行基准测试。</p><p id="71d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们导入本教程中使用的库。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a877" class="ma mb it lw b gy mc md l me mf">import geopandas as gpd<br/>import matplotlib.pyplot as plt<br/>import geofeather<br/>import datashader as ds<br/>import holoviews as hv</span></pre><p id="747a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">读取数据需要相当长的时间，这取决于计算资源。在我这边，这花了 1 分 46 秒。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/147bffcb7ca381d9b9cd60488201f761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WYnraX9AYiNrAUOnetW6-g.png"/></div></div></figure><p id="4317" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过将数据格式(Shapefile)转换为 GeoFeather 格式来加快读取时间。</p><h2 id="27b9" class="ma mb it bd mh mi mj dn mk ml mm dp mn li mo mp mq lm mr ms mt lq mu mv mw mx bi translated">1.使用 GeoFeather 快速读取地理空间数据</h2><p id="5c3f" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在这将提高你的阅读速度，但只需要一行代码就可以将你的数据转换成 GeoFeather，这要感谢<a class="ae ky" href="https://github.com/brendan-ward/geofeather" rel="noopener ugc nofollow" target="_blank"> Geofeather 库</a>。让我们将数据转换为 GeoFeather。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="340c" class="ma mb it lw b gy mc md l me mf">geofeather.to_geofeather(gdf,'tutorialData/TaxiDataGeoFeather.feather')</span></pre><p id="139f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的例子中，转换为 GeoFeather 只需要 51 秒，但仅此而已，下次您可以使用 Geofeather 读取数据，这比从 shapefile 读取数据花费的时间更少。让我们看看。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a7bc" class="ma mb it lw b gy mc md l me mf">gdf = geofeather.from_geofeather(‘tutorialData/TaxiDataGeoFeather.feather’)</span></pre><p id="948c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 Geofeather 阅读只需要 26 秒，而使用 Shapefiles 需要 1 分 46 秒。这是一种很棒的技术，可以帮助您快速试验地理空间数据，而无需等待很长时间。</p><p id="752d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我也发现有时根据我的需要只阅读几何的一个子集。这在最近发布的 Geopandas 0.70 之前是不可能的。第二个技巧向您展示了如何读取大型数据集的子集几何。</p><h2 id="f89e" class="ma mb it bd mh mi mj dn mk ml mm dp mn li mo mp mq lm mr ms mt lq mu mv mw mx bi translated">2.读取带有几何图形的子集</h2><p id="d2ad" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">让我们先读一下滑行区域，并用我们在前面章节中读到的滑行点标出它们。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="96ec" class="ma mb it lw b gy mc md l me mf">zones = gpd.read_file(“tutorialData/taxizones.shp”)</span><span id="cb56" class="ma mb it lw b gy nd md l me mf">fig, ax = plt.subplots(figsize=(12,10))<br/>zones.plot(“borough”, ax=ax, legend=True)<br/>gdf.sample(5000).plot(ax=ax, markersize=2, color=”black”)</span></pre><p id="d861" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的地图显示了叠加在出租车区域上的出租车点示例(用行政区着色)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/784bd709ff03fe17249f8f85dcff5ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RSLUkjz9FJS2_JUGhbUAzQ.png"/></div></div></figure><p id="774d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，假设你只需要布鲁克林区，没有必要读取全部数据。在这种情况下，您只需读取带有几何图形的数据子集。您可以通过在使用 Geopandas 读取数据时提供一个掩码来实现这一点。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0fdd" class="ma mb it lw b gy mc md l me mf">gdf_subset = gpd.read_file(“tutorialData/taxidata.shp”, mask=zones[zones[“borough”].isin([“Brooklyn”])])</span></pre><p id="5b2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只花了 38 秒，而且你只得到你所需要的，仅在布鲁克林多边形内的出租车点数据的子集。</p><h2 id="5b69" class="ma mb it bd mh mi mj dn mk ml mm dp mn li mo mp mq lm mr ms mt lq mu mv mw mx bi translated">3.空间索引可能会促进地理处理</h2><p id="cb35" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">有时，空间索引可能有助于加快地理处理任务的速度。让我们看看多边形中的点(PIP)的空间索引和非空间索引实现之间的速度差异。我们首先将出租车区域分解成区多边形，然后在没有空间索引的情况下进行空间连接。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3340" class="ma mb it lw b gy mc md l me mf">boroughs = zones.dissolve(by=’borough’)</span><span id="4917" class="ma mb it lw b gy nd md l me mf">sjoined = gpd.sjoin(gdf, boroughs, op=”within”)</span></pre><p id="ed13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在没有空间索引的情况下，这个过程需要 2 分 50 秒。让我们看看空间索引是否可以提高性能速度。</p><p id="a048" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 Geopandas 中创建空间索引非常简单。让我们对两个数据集都这样做。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0d24" class="ma mb it lw b gy mc md l me mf">gdf_sindexed = gdf<br/>zones_sindexed = zones</span><span id="5fde" class="ma mb it lw b gy nd md l me mf">gdf_sindexed.sindex<br/>zones_sindexed.sindex</span></pre><p id="4e25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们用空间索引做 PIP 处理。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="af8c" class="ma mb it lw b gy mc md l me mf">sjoined = gpd.sjoin(gdf_sindexed, boroughs_sindexed, op="within")</span></pre><p id="80cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用空间索引，该过程需要 2 分 19 秒，与非空间索引处理相比，速度略有提高。空间索引并不总是有用，尤其是在点数据和面具有相同范围的情况下。你可以从这篇<a class="ae ky" href="https://geoffboeing.com/2016/10/r-tree-spatial-index-python/" rel="noopener ugc nofollow" target="_blank">博客文章</a>中读到关于空间索引何时有效何时无效的详细解释。</p><h2 id="a09a" class="ma mb it bd mh mi mj dn mk ml mm dp mn li mo mp mq lm mr ms mt lq mu mv mw mx bi translated">4.用 Datashader 绘图</h2><p id="e7d7" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">当使用其他绘图库，如 Folium 或 Plotly 时，绘制大型数据集通常会以失败告终。Datashader 专用于绘制大型数据集。</p><blockquote class="nf"><p id="e85b" class="ng nh it bd ni nj nk nl nm nn no lu dk translated">Datashader 是一个图形管道系统，用于快速灵活地创建大型数据集的有意义的表示。</p></blockquote><p id="e708" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">这使您可以在地图上绘制所有数据，而不会因为采集样本而受到影响。让我们用 Datashader 快速轻松地绘制所有 140 万个点。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b59f" class="ma mb it lw b gy mc md l me mf">agg = ds.Canvas().points(sjoined, ‘pickup_lon’, ‘pickup_lat’)<br/>img = tf.set_background(tf.shade(agg, cmap=fire),”black”)<br/>img</span></pre><p id="648c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你得到的是所有数据的美丽的点状图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/7550465824b6598fccac6eb7a5f52f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*3vZ8FnczKSJezAzsHgmDzA.png"/></div></figure><p id="8113" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在 Datashader 中创建带有漂亮底图的交互式地图。它还可以很好地工作 PyViz 数据可视化工具，如 Geoviews，并可以与 Panel 结合使用 Jupyter 笔记本创建漂亮的仪表板。</p><h2 id="0098" class="ma mb it bd mh mi mj dn mk ml mm dp mn li mo mp mq lm mr ms mt lq mu mv mw mx bi translated">结论</h2><p id="fc2b" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在这篇文章中，我分享了一些我最喜欢的使用 Python 进行地理空间数据科学提升的技术。您可以使用 Geofeather 或仅读取子集来加快读取时间。对于地理处理任务，值得尝试使用空间索引来加快处理时间。最后，在绘制大型数据集时，使用 Datashader 可以提高速度并获得漂亮的地图。</p><p id="c96c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程的笔记本在<a class="ae ky" href="https://github.com/shakasom/spatialjoin-python/blob/master/Accelerate%20Geospatial.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>中。</p></div></div>    
</body>
</html>