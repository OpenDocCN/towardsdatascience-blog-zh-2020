<html>
<head>
<title>The art of map visualization: Coloring Singapore island with datapoints</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地图可视化的艺术:用数据点给新加坡岛着色</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-art-of-map-visualization-coloring-singapore-island-with-datapoints-41c7414adfed?source=collection_archive---------39-----------------------#2020-04-02">https://towardsdatascience.com/the-art-of-map-visualization-coloring-singapore-island-with-datapoints-41c7414adfed?source=collection_archive---------39-----------------------#2020-04-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="90ed" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个简单的地图可视化指南！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9dc4e754ad2b4a6ca41896e5464bcb30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lLjrj9nCbq2ASamaOlENjQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新加坡岛的水彩地图</p></figure><p id="2282" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">新加坡无疑是亚洲最热门的旅游目的地之一。尽管这个城市比纽约小，但它有你需要或想体验的一切。丰富的食物选择、街头(和奢侈品)购物、拥抱生物多样性的绿色城市，应有尽有！</p><p id="3714" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我们将使用R来可视化新加坡地图上的空间数据。</p><h2 id="72d2" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">API设置和获取地图</h2><p id="da8e" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">首先，我们需要使用get_map函数获得一个地图背景。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="d4fa" class="lu lv it mt b gy mx my l mz na">#Load the R packages<br/>library(ggplot2)<br/>library(dplyr)<br/>library(sf);<br/>library(stringi)<br/>library(ggmap)</span><span id="0d9e" class="lu lv it mt b gy nb my l mz na">#Set your API Key<br/>ggmap::register_google(key = "<em class="nc">your google api key</em>")</span><span id="8bd7" class="lu lv it mt b gy nb my l mz na">#Get Singapore map as background<br/>map &lt;- get_map("singapore", maptype = "roadmap", zoom = 11, source = "google", color = "bw")</span><span id="2377" class="lu lv it mt b gy nb my l mz na"><em class="nc"># There are many map types in the ggmap package to play around with!</em></span></pre><h2 id="8c62" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">数据集上的免责声明</h2><p id="9328" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">本文只关注新加坡岛。其他较小的岛屿不包括在可视化中。</p><h2 id="6570" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">数据源</h2><p id="7b03" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">本文使用的所有数据集均来自<a class="ae nd" href="https://data.gov.sg/" rel="noopener ugc nofollow" target="_blank">data.gov.sg</a>。新加坡政府提供大量数据供公众使用。在本文中，我从源代码下载了KML (Keyhole markup language)文件，并使用r</p><p id="6baa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下载完KML文件后，将文件加载到R中进行处理。KML数据集需要转换成EPSG 3857格式，这是谷歌使用的伪墨卡托投影坐标系。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="b941" class="lu lv it mt b gy mx my l mz na"># Load the KML file paths<br/>cyclingPath &lt;- "<em class="nc">KML file path on your PC</em>"<br/>taxi &lt;- "<em class="nc">KML file path on your PC</em>"<br/>mrt &lt;- "<em class="nc">KML file path on your PC</em>"<br/>parks &lt;-"<em class="nc">KML file path on your PC</em>"</span><span id="7033" class="lu lv it mt b gy nb my l mz na">#Read the KML files in R<br/>cyclingPathData &lt;- st_read(cyclingPath)<br/>taxiData &lt;- st_read(taxi)<br/>mrtData &lt;- st_read(mrt)<br/>parksData &lt;- st_read(parks)</span><span id="22ff" class="lu lv it mt b gy nb my l mz na"># Transform KMLdata to EPSG 3857)<br/>cyclingPathData_3857 &lt;- st_transform(cyclingPathData, 3857)<br/>taxi_3857 &lt;- st_transform(taxiData, 3857)<br/>mrt_3857 &lt;- st_transform(mrtData, 3857)<br/>parks_3857 &lt;- st_transform(parksData, 3857)</span></pre><h2 id="0ecf" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">在新加坡地图上叠加EPSG 3857数据集</h2><p id="e122" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在获得我们想要的新加坡地图并将数据集转换为正确的格式后，我们需要将数据集属性(点和面)要素与基础地图结合起来。以下代码将允许我们准确地将数据集和新加坡地图的经纬度点叠加在一起。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="f523" class="lu lv it mt b gy mx my l mz na"># Define a function to fix the bbox to be in EPSG:3857<br/>ggmap_bbox &lt;- function(map) {<br/>  if (!inherits(map, "ggmap")) stop("map must be a ggmap object")<br/> <br/># Extract the bounding box (in lat/lon) from the ggmap to a numeric vector, and set the names to what sf::st_bbox expects:<br/>  map_bbox &lt;- setNames(unlist(attr(map, "bb")), <br/>                       c("ymin", "xmin", "ymax", "xmax"))<br/>  <br/># Convert the bbox to an sf polygon, transform it to 3857, and convert back to a bbox (convoluted, but it works)  bbox_3857 &lt;- st_bbox(st_transform(st_as_sfc(st_bbox(map_bbox, crs = 4326)), 3857))<br/>  <br/># Overwrite the bbox of the ggmap object with the transformed coordinates <br/>  attr(map, "bb")$ll.lat &lt;- bbox_3857["ymin"]<br/>  attr(map, "bb")$ll.lon &lt;- bbox_3857["xmin"]<br/>  attr(map, "bb")$ur.lat &lt;- bbox_3857["ymax"]<br/>  attr(map, "bb")$ur.lon &lt;- bbox_3857["xmax"]<br/>  map<br/>}</span><span id="aee5" class="lu lv it mt b gy nb my l mz na"># Use the function:<br/>map &lt;- ggmap_bbox(map)</span></pre><h2 id="45f5" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">使用ggmap函数映射数据集</h2><p id="27d0" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在这篇文章中，我使用了从data.gov.sg获得的十个数据集来可视化新加坡岛上的食品机构、交通系统和娱乐活动场所</p><ul class=""><li id="bcf3" class="ne nf it la b lb lc le lf lh ng ll nh lp ni lt nj nk nl nm bi translated">餐饮场所、小贩中心、超市</li><li id="f52b" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">出租车站，捷运出口</li><li id="46d3" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">公园、自行车道、健身房、水上运动场所</li><li id="30c3" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">旅游景点</li></ul><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="9d81" class="lu lv it mt b gy mx my l mz na">ggmap(map) + <br/>  coord_sf(crs = st_crs(3857)) + # force the ggplot2 map to be in 3857<br/>  geom_sf(data = nationalSurvey_3857, col = "#46425B",lwd = 0.5, fill = "#46425B", inherit.aes = FALSE, show.legend = FALSE)+ <br/>  geom_sf(data = nationalLine_3857, col = "#435A74",lwd = 0.2, inherit.aes = FALSE, show.legend = FALSE) +<br/>  #<strong class="mt iu">food</strong><br/>  geom_sf(data = eating_3857, col = "#219D98", lwd = 0.3, inherit.aes = FALSE, show.legend = FALSE) +<br/>  geom_sf(data = hawker_3857, col = "#219D98",lwd = 0.3, inherit.aes = FALSE, show.legend = FALSE) +<br/>  geom_sf(data = supermarket_3857, col = "#219D98",lwd = 0.2, inherit.aes = FALSE, show.legend = FALSE) +<br/>  #<strong class="mt iu">transportation</strong><br/>  geom_sf(data = taxi_3857, col = "#80DA83", lwd = 0.6,inherit.aes = FALSE, show.legend = FALSE) +<br/>  geom_sf(data = mrt_3857, col = "#80DA83", lwd =0.6,inherit.aes = FALSE, show.legend = FALSE) + <br/>  #<strong class="mt iu">workout locations</strong><br/>  geom_sf(data = gym_3857, col = "#CAF270",lwd = 0.5, inherit.aes = FALSE, show.legend = FALSE) +<br/>  geom_sf(data = waterSports_3857, col = "#CAF270",lwd = 0.5, inherit.aes = FALSE, show.legend = FALSE) +<br/>  geom_sf(data = Relaxparks_3857, col = "#CAF270",lwd = 0.5, inherit.aes = FALSE, show.legend = FALSE) +<br/>  geom_sf(data = parks_3857, col = "#CAF270",lwd = 0.5, inherit.aes = FALSE, show.legend = FALSE) +<br/>  geom_sf(data = cyclingPathData_3857, col = "#80DA83",lwd = 0.5, inherit.aes = FALSE, show.legend = FALSE) +<br/>  #<strong class="mt iu">tourism</strong><br/>  geom_sf(data = tourist_3857, col = "#EE8F58", lwd = 1, inherit.aes = FALSE, show.legend = FALSE)</span></pre><h2 id="f2d2" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">结果</h2><p id="4ee8" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在执行了上面的R代码之后，你应该能够得到一个新加坡地图，用所选的数据集着色！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/5f8838fe48a4e3e6f092e21300203406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OlJxGTC2wvQOxKg8QLnlsA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新加坡地图，用食物、交通和娱乐地点着色</p></figure><h2 id="7bb2" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">结论</h2><p id="5f02" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">大多数学院都位于新加坡海峡附近，新加坡海峡是市中心的核心区域。所以，如果你马上要去新加坡，你知道该去哪里！</p><p id="a2ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">R中的ggmap包是一个强大的空间数据可视化包。Google、Stamen和Openstreetmap有很多地图类型可以自己尝试！</p></div></div>    
</body>
</html>