<html>
<head>
<title>E-mails Notification Bot with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 的电子邮件通知机器人</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/e-mails-notification-bot-with-python-4efa227278fb?source=collection_archive---------17-----------------------#2020-04-24">https://towardsdatascience.com/e-mails-notification-bot-with-python-4efa227278fb?source=collection_archive---------17-----------------------#2020-04-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="f275" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">一个重要的 PYTHON 技巧</h2><div class=""/><div class=""><h2 id="69a2" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">教程—新冠肺炎案例的电子邮件通知示例</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/600a527bbdbe37f35870d98eaaaf18b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X-4pRR41sXoTncmKx1H9-w.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">插图作者:金彩云</p></figure><p id="c251" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di">在</span>数据科学中，项目的数据来源可能会随着时间而变化，分析结果也会随着时间快速变化。有时候结果的一点点变化可能不会让你感兴趣。但是自己一个人持续跟踪这种变化可能太累了…</p><p id="3cc2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本文展示了用 Python 编写电子邮件自动化机器人脚本的指南！</p><h2 id="56d6" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">我们开始吧💥</h2><h1 id="21e7" class="nf mo it bd mp ng nh ni ms nj nk nl mv ki nm kj my kl nn km nb ko no kp ne np bi translated">📧准备电子邮件发件人</h1><p id="7354" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">首先，让我们准备一个电子邮件发件人帐户。我推荐使用 G-mail，因为它易于注册，并且允许你手动调整安全选项。您可以使用您的个人电子邮件或您选择的其他电子邮件提供商。但是我建议为我们的电子邮件机器人创建一个新的电子邮件。🤖</p><p id="9944" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在 G-mail 帐户准备就绪后，通过进入<a class="ae lh" href="https://myaccount.google.com/security" rel="noopener ugc nofollow" target="_blank">帐户安全设置</a>并进行如下调整，降低帐户安全性以允许 Python 访问您的 G-mail 帐户并发送电子邮件:</p><ul class=""><li id="0aa4" class="nv nw it lk b ll lm lo lp lr nx lv ny lz nz md oa ob oc od bi translated">用手机取消<em class="oe">登录</em></li><li id="39b6" class="nv nw it lk b ll of lo og lr oh lv oi lz oj md oa ob oc od bi translated">通过两步验证取消<em class="oe">登录</em></li><li id="587b" class="nv nw it lk b ll of lo og lr oh lv oi lz oj md oa ob oc od bi translated">打开<em class="oe">不太安全的应用访问</em>选项</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ok"><img src="../Images/101ce16ca4f2a9e442159c29f26e9da2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8cU3sGPjUCPpi3ej0Ty8hQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在 G-mail 中进行设置以允许 Python 发送电子邮件。</p></figure></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><h1 id="782b" class="nf mo it bd mp ng os ni ms nj ot nl mv ki ou kj my kl ov km nb ko ow kp ne np bi translated">使用 Python 的✍Sending 电子邮件</h1><p id="542d" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">现在，我们开始一个有趣的部分，编写一个脚本来登录您的电子邮件帐户并发送电子邮件。我建议使用一个简单的模块<code class="fe ox oy oz pa b">smtplib</code>来完成这项工作。首先，让我们创建一个<code class="fe ox oy oz pa b">send_email.py</code>文件，开始导入模块，如下所示:</p><pre class="ks kt ku kv gt pb pa pc pd aw pe bi"><span id="37f5" class="mn mo it pa b gy pf pg l ph pi"><strong class="pa jd">import smtplib<br/>from email.mime.multipart import MIMEMultipart<br/>from email.mime.text import MIMEText</strong></span></pre><p id="8f7c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，让我们为您的电子邮件发件人和收件人信息以及电子邮件内容准备所有变量，如下所示。您可以在<code class="fe ox oy oz pa b">email_recipients</code>列表中输入几个电子邮件收件人。</p><pre class="ks kt ku kv gt pb pa pc pd aw pe bi"><span id="7d29" class="mn mo it pa b gy pf pg l ph pi">#Email Account<strong class="pa jd"><br/>email_sender_account = "</strong>&lt;Your Sender Account&gt;<strong class="pa jd">"<br/>email_sender_username = "</strong>&lt;Your Sender Username&gt;<strong class="pa jd">"<br/>email_sender_password = "</strong>&lt;Your Sender Password&gt;<strong class="pa jd">"<br/>email_smtp_server = "</strong>&lt;SMTP, eg smtp.gmail.com for gmail&gt;<strong class="pa jd">"<br/>email_smtp_port = </strong>&lt;SMTP Porf, eg 587 for gmail&gt;</span><span id="b14f" class="mn mo it pa b gy pj pg l ph pi">#Email Content<br/><strong class="pa jd">email_recepients = </strong>[<strong class="pa jd">"</strong>&lt;recepient1&gt;<strong class="pa jd">","</strong>&lt;recepient2&gt;<strong class="pa jd">",".."</strong>]<strong class="pa jd"><br/>email_subject = "</strong>&lt;Email Subject&gt;<strong class="pa jd">"<br/>email_body </strong>= "&lt;html of your body here&gt;"</span></pre><p id="30f2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">之后，我们只需要登录电子邮件服务器。然后，我们将使用<code class="fe ox oy oz pa b">for</code>循环来生成电子邮件并发送给所有收件人。</p><pre class="ks kt ku kv gt pb pa pc pd aw pe bi"><span id="6e48" class="mn mo it pa b gy pf pg l ph pi">#login to email server<strong class="pa jd"><br/>server = smtplib.SMTP(email_smtp_server,email_smtp_port)<br/>server.starttls()<br/>server.login(email_sender_username, email_sender_password)</strong></span><span id="6c4b" class="mn mo it pa b gy pj pg l ph pi">#For loop, sending emails to all email recipients<strong class="pa jd"><br/>for recipient in email_receivers:<br/>    print(f"Sending email to {recipient}")<br/>    message = MIMEMultipart('alternative')<br/>    message['From'] = email_sender_account<br/>    message['To'] = recipient<br/>    message['Subject'] = email_subject<br/>    message.attach(MIMEText(email_body, 'html'))<br/>    text = message.as_string()<br/>    server.sendmail(email_sender_account,recipient,text)</strong></span><span id="0424" class="mn mo it pa b gy pj pg l ph pi">#All emails sent, log out.<strong class="pa jd"><br/>server.quit()</strong></span></pre><p id="39cf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在此之前，您有一个 Python 脚本来向所有收件人发送电子邮件。现在，让我们将它应用到真实世界的用例中。</p></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><h1 id="add2" class="nf mo it bd mp ng os ni ms nj ot nl mv ki ou kj my kl ov km nb ko ow kp ne np bi translated">🌎真实世界的例子</h1><h2 id="4565" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">⚠新冠肺炎—电子邮件通知机器人</h2><p id="0cbe" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">在本例中，我将展示如何应用我们在上面创建的 Python 脚本向报告新新冠肺炎病例的收件人发送电子邮件。</p><p id="3e09" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我们需要获得最新的新冠肺炎数据。通过使用带有几行 Python 代码的<code class="fe ox oy oz pa b">BeautifulSoap4</code>和<code class="fe ox oy oz pa b">request</code>模块，我们可以很容易地从<a class="ae lh" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank"> Worldometers </a>中抓取这个数据集，如下所示:</p><pre class="ks kt ku kv gt pb pa pc pd aw pe bi"><span id="d349" class="mn mo it pa b gy pf pg l ph pi">#import module<strong class="pa jd"><br/>import requests, datetime<br/>from bs4 import BeautifulSoup<br/></strong>#Set the endpoint: Worldometers<strong class="pa jd"><br/>url = "https://www.worldometers.info/coronavirus/"<br/>req = requests.get(url)<br/>bsObj = BeautifulSoup(req.text, "html.parser")<br/>data = bsObj.find_all("div",class_ = "maincounter-number")<br/>num_confirmed = data[0].text.strip().replace(',', '')<br/>num_deaths = data[1].text.strip().replace(',', '')<br/>num_recovered = data[2].text.strip().replace(',', '')</strong></span></pre><p id="8e1c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">通过这个脚本，它找到了一个名为<code class="fe ox oy oz pa b">maincounter-number</code>的类的位置，该类表示新冠肺炎数据的数量:确诊病例、死亡病例和恢复病例。这些数据分别存储在<code class="fe ox oy oz pa b">num_confirmed, num_deaths, num_recovered</code>中。然后，我们也可以使用<code class="fe ox oy oz pa b">datetime</code>模块获取当前时间，并传递这些变量来为电子邮件正文创建一个 HTML 结构，如下所示:</p><pre class="ks kt ku kv gt pb pa pc pd aw pe bi"><span id="d969" class="mn mo it pa b gy pf pg l ph pi"><strong class="pa jd">TimeNow = datetime.datetime.now()<br/>email_body = '&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;'<br/>email_body += '&lt;style type="text/css"&gt;&lt;/style&gt;'<br/>email_body += f'&lt;h2&gt;Reporting COVID-19 Cases at {time}&lt;/h2&gt;'</strong><br/><strong class="pa jd">email_body += f'&lt;h1&gt;&lt;b&gt;Confirmed cases&lt;/b&gt;:  {confirmed_cases}&lt;/h1&gt;'<br/>email_body += f'&lt;h1&gt;&lt;b&gt;Recovered cases&lt;/b&gt;:  {recovered_cases}&lt;/h1&gt;'<br/>email_body += f'&lt;h1&gt;&lt;b&gt;Deaths &lt;/b&gt;:  {deaths}&lt;/h1&gt;'<br/>email_body += '&lt;br&gt;Reported By'<br/>email_body += '&lt;br&gt;COVID-19 BOT&lt;/body&gt;&lt;/html&gt;'</strong></span></pre><p id="e60d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们把所有的东西结合在一起，输入所有的电子邮件信息，然后运行<code class="fe ox oy oz pa b">python &lt;filename&gt;.py</code>，试试看是否可行，是的，可行！运行完脚本后，我的收件箱里直接收到了一封电子邮件，里面有实时更新的新冠肺炎案例:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pk"><img src="../Images/bfcd22a1ce1ef77eeccab347d5aef988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3cKv7pTK5gjMasVOcIytLw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">运行 Python 脚本后，我的 Outlook 收件箱中的屏幕截图。</p></figure><p id="7e7e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以看看下面完全组合的 Python 脚本:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pl pm l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">电子邮件通知</p></figure><h2 id="09fe" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">计划您的机器人</h2><p id="ec6c" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">现在，是时候让你的机器人每隔<em class="oe"> xx </em>分钟或<em class="oe"> yy </em>小时或<em class="oe"> zz </em>天定期运行一次了。另外，你应该添加一个发送消息的条件，因为你不需要在 10 分钟内收到 100 封举报邮件。所以你可以这样做:</p><ul class=""><li id="1b87" class="nv nw it lk b ll lm lo lp lr nx lv ny lz nz md oa ob oc od bi translated">设置阈值，以便仅在报告了新的 XXXX 病例时发送电子邮件通知。一个普通的<code class="fe ox oy oz pa b">if..else..</code>算法运行良好。</li><li id="f78c" class="nv nw it lk b ll of lo og lr oh lv oi lz oj md oa ob oc od bi translated">使用<code class="fe ox oy oz pa b">while true: .../ time.sleep()</code>安排您的机器人</li><li id="5bc5" class="nv nw it lk b ll of lo og lr oh lv oi lz oj md oa ob oc od bi translated">在 Mac/Linux 上使用<code class="fe ox oy oz pa b">CRON </code>或者在 Windows 上使用 Windows 任务调度器来调度你的机器人。</li><li id="00a3" class="nv nw it lk b ll of lo og lr oh lv oi lz oj md oa ob oc od bi translated">如果你想要一个替代的方法来管理你的脚本定期运行，我推荐使用 PM2 来完成。</li></ul></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><h1 id="5fad" class="nf mo it bd mp ng os ni ms nj ot nl mv ki ou kj my kl ov km nb ko ow kp ne np bi translated">结论</h1><p id="3de7" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">本文以新冠肺炎电子邮件通知机器人为例，给出了构建用于自动和定期发送电子邮件的 Python 脚本的演练。本教程中使用的电子邮件发送者是 G-mail，但是可以用任何电子邮件提供商来代替。本文的主要 Python 模块包括<code class="fe ox oy oz pa b"><strong class="lk jd">smtplib, request, datetime, bs4</strong></code> <strong class="lk jd"> </strong>，我的主要概念是使用最简单的方法来完成工作。✌</p></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><h1 id="14ec" class="nf mo it bd mp ng os ni ms nj ot nl mv ki ou kj my kl ov km nb ko ow kp ne np bi translated">作者消息</h1><p id="0273" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">我希望你喜欢这篇文章，并发现它对你的日常工作或项目有用。如果你有任何问题，请随时联系我。</p><p id="fe8a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">关于我&amp;查看我所有的博客内容:<a class="ae lh" href="https://joets.medium.com/about-me-table-of-content-bc775e4f9dde" rel="noopener">链接</a></p><p id="31bb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">平安健康！</strong> <br/> <strong class="lk jd">感谢阅读。👋😄</strong></p></div></div>    
</body>
</html>