<html>
<head>
<title>Deploying TensorFlow Models to the Web</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将张量流模型部署到Web</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-deploy-tensorflow-models-to-the-web-81da150f87f7?source=collection_archive---------15-----------------------#2020-06-06">https://towardsdatascience.com/how-to-deploy-tensorflow-models-to-the-web-81da150f87f7?source=collection_archive---------15-----------------------#2020-06-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="73b7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用基本的JavaScript在浏览器中运行Python构建的模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/07bdd355013b012940ab8c1d54ee5113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7XSY9YX41z5hfJj2"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Avi Richards 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ec43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated">用Python开发机器学习模型会是一种美妙的体验。Python对ML和数据科学的支持和社区是任何其他语言都无法比拟的。</p><p id="787f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管如此，与非Python用户共享这些模型的方法非常少——对于我们大多数人来说，这描述了我们的大多数同事和最终用户。</p><p id="15f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，世界上几乎每个拥有电脑的人都有一个互联网浏览器。</p><p id="f459" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，我们只需要一个网络浏览器。</p><p id="27d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将使用Python和TensorFlow创建一个简单的模型。我们将导出它，并将其部署到使用JavaScript和TensorFlow.js的web浏览器中——我们将保持它非常简单。要做到这一点，您不需要了解JavaScript。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="78a7" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">Python部分</h1><p id="8005" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">我们将使用一个基本的神经网络来告诉我们0-10之间的数字是奇数还是偶数。当然，我们不需要一个神经网络来做到这一点，但这意味着我们保持这个例子非常简单——没有任何错误。</p><p id="5143" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个模型需要一个数字作为输入，并产生一个数字作为输出。奇数会产生一个<code class="fe ni nj nk nl b">1</code>甚至一个<code class="fe ni nj nk nl b">0</code>。</p><p id="c3a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们创建训练数据:</p><pre class="kj kk kl km gt nm nl nn no aw np bi"><span id="2d13" class="nq mm it nl b gy nr ns l nt nu">x = []<br/>y = []<br/>for _ in range(10000):<br/>    num = np.random.randint(0, 101)  <em class="nv"># generate random integer</em><br/>    x.append(num)<br/>    y.append(num % 2)</span></pre><p id="0c8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ni nj nk nl b"><strong class="lb iu">x</strong> =<strong class="lb iu"> </strong>[2, 7, 4, 1, 9, ..., 0]</code></p><p id="8cc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ni nj nk nl b"><strong class="lb iu">y</strong> = [0, 1, 0, 1, 1, ..., 0]</code></p><p id="0fc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了数据，让我们建立模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/efec0991f4570049e64aa57f32c40803.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*CNW4mP3nTLZNmd54nnQaKw.png"/></div></div></figure><p id="0d90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实证明，模函数的表达具有惊人的挑战性。因此，神经网络确实包含合理数量的参数——训练后偶尔会告诉我们10是一个奇数——但它在大多数情况下是有效的。</p><p id="7b2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们保存它:</p><pre class="kj kk kl km gt nm nl nn no aw np bi"><span id="e10d" class="nq mm it nl b gy nr ns l nt nu">model.save('model_py/model.h5')</span></pre><p id="df3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将我们的模型保存为一个<code class="fe ni nj nk nl b">HDF5</code>文件——准备转换为<code class="fe ni nj nk nl b">TensorFlow.js</code> web格式。</p><p id="b1d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要转换模型，我们首先需要<code class="fe ni nj nk nl b">pip install tensorflowjs</code>。安装完成后，我们从命令行运行<code class="fe ni nj nk nl b">tensorflowjs_converter</code>(<code class="fe ni nj nk nl b">Command Prompt</code>、<code class="fe ni nj nk nl b">Terminal</code>、<code class="fe ni nj nk nl b">Bash</code>等)。).</p><p id="7176" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开命令行并导航到我们的项目文件夹(Windows上的<code class="fe ni nj nk nl b">cd &lt;directory_path&gt;</code>)。然后通过键入以下命令运行转换器:</p><pre class="kj kk kl km gt nm nl nn no aw np bi"><span id="0448" class="nq mm it nl b gy nr ns l nt nu">tensorflowjs_converter \<br/>     --input_format=keras \<br/>     model_py/model.h5 \<br/>     model_js</span></pre><p id="4a75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们告诉<code class="fe ni nj nk nl b">tensorflowjs_converter</code>期待<code class="fe ni nj nk nl b">keras</code>模型格式。然后我们指定模型路径<code class="fe ni nj nk nl b">model_py/model.h5</code>。最后，我们告诉转换器将转换后的模型保存在<code class="fe ni nj nk nl b">model_js</code>目录中。</p><p id="7ce5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们导航到<code class="fe ni nj nk nl b">model_js we</code>，会发现以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/0edf25e0ac5ceba8ebc5773bfc10f30a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3dtlFdrXgeUYeXovIM2A0A.png"/></div></div></figure><p id="66f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那个<code class="fe ni nj nk nl b">.json</code>文件是我们的支持web的模型，可以在JavaScript中使用。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="d68a" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">JavaScript部分</h1><h2 id="9306" class="nq mm it bd mn oa ob dn mr oc od dp mv li oe of mx lm og oh mz lq oi oj nb ok bi translated">服务器设置</h2><p id="74ff" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">首先，我们需要建立一个本地web服务器。由此，我们可以模拟一个网页的行为，它将包含我们的模型和用户前端。</p><p id="4c74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最简单的方法是使用Chrome网络服务器应用程序。这是超级轻量级的，易于使用。</p><p id="a106" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完成后，导航至<code class="fe ni nj nk nl b">chrome://apps/</code>并点击网络服务器图标:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/b51ad37c320553c6a6ce1b1c24b8bf32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yj6W2Zp3wPUlm_XpmSttNA.png"/></div></div></figure><p id="6617" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将启动web服务器，但可能不在正确的目录中。点击<code class="fe ni nj nk nl b">CHOOSE FOLDER</code>并导航到包含我们项目的目录:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/97edaae2e18685f54b54f89eaa3b23ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y8kTxdulaHRJzFgud-VqJw.png"/></div></div></figure><p id="66d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，输入<code class="fe ni nj nk nl b">localhost:8887</code>应该会显示chrome中的同一个目录:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/3e950b1f8ab18f64debe20bb530680db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b_cKuX97iJYqcQBaKt0KRA.png"/></div></div></figure><p id="e019" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着我们的服务器设置正确。如果<code class="fe ni nj nk nl b">localhost:8887</code>不工作，服务器很可能被托管在另一个端口上。要找到正确的地址，请查看Chrome Web服务器窗口中的<code class="fe ni nj nk nl b">Web Server URL(s)</code>列表，并单击给定的URL。</p><h2 id="6795" class="nq mm it bd mn oa ob dn mr oc od dp mv li oe of mx lm og oh mz lq oi oj nb ok bi translated">构建页面</h2><p id="63e2" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">接下来，我们需要一个网页。首先，创建名为<code class="fe ni nj nk nl b">index.html</code>的文件。在其中，我们创建了一个<code class="fe ni nj nk nl b">form</code>来为我们的模型提供输入，如下所示:</p><pre class="kj kk kl km gt nm nl nn no aw np bi"><span id="574f" class="nq mm it nl b gy nr ns l nt nu">&lt;input type="text"&gt;&lt;/input&gt;</span><span id="85b4" class="nq mm it nl b gy oo ns l nt nu">&lt;button&gt;Predict&lt;/button&gt;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/d4447c9799e5ece636745953487787d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqB11lg_gLYa1vtRlaANRw.png"/></div></div></figure><p id="0bff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这还没有做任何事情。我们需要添加一些JavaScript。</p><p id="1981" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将编写两个函数，一个用于加载模型，另一个用于进行预测:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="58e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该代码可以通过包装在<code class="fe ni nj nk nl b">&lt;script&gt;</code>标签中嵌入到<code class="fe ni nj nk nl b">index.html</code>中。我们还需要导入<code class="fe ni nj nk nl b">tensorflow.js</code>——同样可以使用<code class="fe ni nj nk nl b">&lt;script&gt;</code>标签来完成。</p><p id="27fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将所有这些都写入代码会给我们带来:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="b43a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一步是将我们在<code class="fe ni nj nk nl b">&lt;input&gt;</code>框中输入的内容连接到我们的模型。</p><p id="b94f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过在调用<code class="fe ni nj nk nl b">predict</code>时获取<code class="fe ni nj nk nl b">&lt;input&gt;</code>元素来做到这一点。为此，我们给<code class="fe ni nj nk nl b">&lt;input&gt;</code>一个惟一的标识符<code class="fe ni nj nk nl b">id="userInput"</code>，然后用这个标识符将元素拉进我们的带有<code class="fe ni nj nk nl b">document.getElementByID('userInput')</code>的函数中——这给了我们整个元素，所以我们通过在末尾添加<code class="fe ni nj nk nl b">.value</code>来指定值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="d1cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经将用户给定值连接到我们的<code class="fe ni nj nk nl b">predict</code>函数，我们只需要触发它。我们简单的把<code class="fe ni nj nk nl b">onclick="predict(model)"</code>加到<code class="fe ni nj nk nl b">&lt;button&gt;</code>上。所有这些给了我们完整的代码:</p><div class="kj kk kl km gt ab cb"><figure class="oq kn or os ot ou ov paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/7c021d87a54cb70c26d23480a3177fa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*tjPIIY0sqLi0fbWTYTC2nw.png"/></div></figure><figure class="oq kn ow os ot ou ov paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/12c48bad671fe5175c54ded138d36abd.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*PkyQkT_aSVaY4jgKT_KkXw.png"/></div></figure></div><p id="04fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们的NN，运行在一个世界上任何人都可以使用的浏览器中。当然，除了告诉我们一个数字是奇数还是偶数之外，我们可能还需要一些东西——但是我们都是从某个地方开始的。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="9db0" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">后续步骤</h1><p id="40b3" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在此基础上，您还可以做更多的事情。你已经知道最难的部分——教机器学习。在这之后，你需要的只是一点点时间，足够的激情，你就能创造出一些令人惊叹的东西。</p><p id="9d79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，像我们在本文中所做的那样快速而直接地编写东西并不是您处理真实项目的方式。为了学习和简洁，我们跳过了许多步骤和最佳实践。</p><p id="7456" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Angular或Node之类的框架(Python的替代方案包括Django和Flask)可以轻松构建交互式、快速、可伸缩的web应用程序。Bootstrap是另一个神奇的工具，它可以让我们看起来很糟糕的网站变得漂亮，而我们几乎不需要付出任何努力。</p><p id="5fbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不能代表所有人，但是以我个人的经验，学习<a class="ae ky" href="https://angular.io/start" rel="noopener ugc nofollow" target="_blank"> Angular </a>，用<a class="ae ky" href="https://getbootstrap.com/docs/4.4/getting-started/introduction/" rel="noopener ugc nofollow" target="_blank"> Bootstrap </a>设计web应用程序，会产生很好的效果——而且可以很快上手。</p><p id="4281" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果这是你想进一步探索的东西，我强烈推荐这两个。</p><p id="6bc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢这篇文章——如果你有任何问题或建议，请告诉我！</p><p id="afdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>