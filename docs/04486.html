<html>
<head>
<title>Netflix &amp; Window Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网飞和窗口功能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/netflix-window-functions-b6dfe60cf0f6?source=collection_archive---------55-----------------------#2020-04-21">https://towardsdatascience.com/netflix-window-functions-b6dfe60cf0f6?source=collection_archive---------55-----------------------#2020-04-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e75f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个窗口功能的快速介绍和一个非常真实的看看我实际上看了多少网飞。🙈</h2></div></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><p id="3c61" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">如果你和我一样，你会发现自己最近看了很多《网飞》。如果你更像我，你会渴望得到一些数据来证明这一点。</p><p id="8a82" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">幸运的是，你可以<a class="ae ll" href="https://count.co/n/nS97P4kEGwe" rel="noopener ugc nofollow" target="_blank">从网飞</a>下载你自己的观看历史，然后自己开一个数据派对！🥳</p><p id="ad63" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">更好的消息是:这是如何利用强大而难以捉摸的<strong class="kr iu">窗口功能</strong>的一个很好的例子。这一系列函数通常被认为是“高级”SQL，因此没有得到应有的广泛使用。</p><p id="95a0" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">在下面的分析中，您将了解更多关于窗口函数的知识，更重要的是，如何充分利用它们。</p><p id="7c21" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">因此，如果你正在寻找所有窗口功能宣传的内容，或者厌倦了向他人解释窗口功能，或者只是真的想知道我看了多少电视，这是给你的。</p><h2 id="b8ae" class="lm ln it bd lo lp lq dn lr ls lt dp lu ky lv lw lx lc ly lz ma lg mb mc md me bi translated">玩法:</h2><ol class=""><li id="ac16" class="mf mg it kr b ks mh kv mi ky mj lc mk lg ml lk mm mn mo mp bi translated">如果你是一个视觉型的人，像我一样，你可以在这里看我做分析</li></ol><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="b2a9" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kr iu"> 2。或者，如果你更喜欢阅读，你可以在这里查看最终分析</strong><a class="ae ll" href="https://count.co/n/0erWed0YsMF" rel="noopener ugc nofollow" target="_blank"><strong class="kr iu"/></a><strong class="kr iu">，或者我已经复制了下面的最终笔记本！</strong></p><p id="6d0a" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">在你开始之前，如果你需要一点关于<strong class="kr iu">窗口功能</strong>的入门知识，我们已经为你准备好了。以下指南写在<a class="ae ll" href="https://count.co" rel="noopener ugc nofollow" target="_blank"> Count </a>中，但内容适用于任何SQL工具！</p><div class="mx my gp gr mz na"><a href="https://count.co/n/0erWed0YsMF" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">我的网飞项目</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">最近我得知网飞将向你提供他们掌握的所有关于你的信息。好奇心得到了最好的…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">count.co</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no np na"/></div></div></a></div><p id="4cb4" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">很难找到实用的数据培训材料来帮助您和您的团队更好地使用数据。我们策划了最好的，并在我们的每周简讯中分享。如果你想了解这一切，请在这里注册。</p></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="063c" class="nq ln it bd lo nr ns nt lr nu nv nw lu jz nx ka lx kc ny kd ma kf nz kg md oa bi translated">目标</h1><blockquote class="ob oc od"><p id="fabf" class="kp kq oe kr b ks kt ju ku kv kw jx kx of kz la lb og ld le lf oh lh li lj lk im bi translated">确定我“狂看”网飞的频率，以及自2020年3月“就地安置”指令开始以来，这一频率是否有所增加。</p></blockquote><h2 id="7930" class="lm ln it bd lo lp lq dn lr ls lt dp lu ky lv lw lx lc ly lz ma lg mb mc md me bi translated">准备👩‍🍳</h2><p id="52e0" class="pw-post-body-paragraph kp kq it kr b ks mh ju ku kv mi jx kx ky oi la lb lc oj le lf lg ok li lj lk im bi translated">来自网飞的数据是这样的:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/3048294be7a5d64e2c5f779fc126e748.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*Mgtc1lkaH9IZV2az61QYhg.png"/></div><p class="on oo gj gh gi op oq bd b be z dk translated">来自网飞的原始格式或数据</p></figure><p id="3255" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kr iu">标题</strong>字段包含所有重要的位。所以，我决定在“:”上分开，从季节和剧集名称中分离出节目或电影名称。</p><p id="6f90" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">根据您使用的工具的不同，执行此操作的代码看起来会有所不同，但它们应该都有相同的结果。</p><p id="7196" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">根据你的目标，你可能想在这里花更多的时间，但对我来说，这已经足够了！</p><h2 id="2995" class="lm ln it bd lo lp lq dn lr ls lt dp lu ky lv lw lx lc ly lz ma lg mb mc md me bi translated">第二步:探索🧭</h2><blockquote class="ob oc od"><p id="66c1" class="kp kq oe kr b ks kt ju ku kv kw jx kx of kz la lb og ld le lf oh lh li lj lk im bi translated">在开始任何分析之前，花些时间了解您的数据总是一个好主意。</p></blockquote><p id="d0a6" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">通过这一步，我发现了一个非常关键的发现:</p><p id="c390" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kr iu">网飞只给你最近一次看每一个节目的时间</strong>😩。</p><p id="bc9f" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">非常失望。这使得对过去的观看活动建模变得很困难，实际上是不可能的，因为可能有很多我过去看过的(老友记)，现在还在看的(老友记)节目，这些都是最近才统计的。</p><p id="205f" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">尽管如此，我们坚持！💪</p><h2 id="080d" class="lm ln it bd lo lp lq dn lr ls lt dp lu ky lv lw lx lc ly lz ma lg mb mc md me bi translated">第三步:定义🎯</h2><p id="b761" class="pw-post-body-paragraph kp kq it kr b ks mh ju ku kv mi jx kx ky oi la lb lc oj le lf lg ok li lj lk im bi translated">因为我想了解我的狂看行为，我需要定义它到底是什么。</p><p id="b89f" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">我决定把狂看定义为:</p><ul class=""><li id="8c84" class="mf mg it kr b ks kt kv kw ky or lc os lg ot lk ou mn mo mp bi translated">同一电视节目的任何连续观看，</li><li id="8526" class="mf mg it kr b ks ov kv ow ky ox lc oy lg oz lk ou mn mo mp bi translated">对于我总共观看了超过6个单元的电视节目</li></ul><p id="59c9" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">那么，我们如何到达那里…</p><p id="74a7" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">现在，数据看起来像这样:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi pa"><img src="../Images/1b9217d3da4e25c8bbbae06fa4d2d0c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p2Vrr7K8aMaRYV9sWwz7Mg.png"/></div></div></figure><p id="133c" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">我需要它看起来像这样:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi pf"><img src="../Images/618a4d9871e80f80d325372ace58a630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*48hN12uKqA-6gVKzDcR--g.png"/></div></div></figure><p id="0e0b" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">为此我们需要<strong class="kr iu">窗口函数</strong>！这里有一个关于窗口函数的快速入门:</p><div class="mx my gp gr mz na"><a href="https://count.co/sql-resources/bigquery-standard-sql/window-functions-explained" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">窗口函数说明| BigQuery语法和示例|计数</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">关于SQL窗口函数你需要知道的一切。窗口函数，或称之为分析函数…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">count.co</p></div></div><div class="nj l"><div class="pg l nl nm nn nj no np na"/></div></div></a></div><p id="073a" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">为此，我采取的步骤是:</p><ol class=""><li id="6bdf" class="mf mg it kr b ks kt kv kw ky or lc os lg ot lk mm mn mo mp bi translated"><strong class="kr iu">通过比较每行中的电视节目和上一行中的电视节目，判断每行是否是正在进行的狂欢会话的一部分</strong></li></ol><pre class="mq mr ms mt gt ph pi pj pk aw pl bi"><span id="b607" class="lm ln it pi b gy pm pn l po pp">case when lag(first_watch.Show) over (order by first_watch.first_day_watch asc) = first_watch.Show then ‘streak’ else ‘new_streak’ end ‘is_streak’</span></pre><p id="9fea" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kr iu"> 2。使用行号或索引计算出有多少集</strong></p><pre class="mq mr ms mt gt ph pi pj pk aw pl bi"><span id="c473" class="lm ln it pi b gy pm pn l po pp">row_number() over (order by first_watch.first_day_watch asc)</span></pre><p id="68da" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kr iu"> 3。算出前一集的观看日期。对于连续开始行，这将等于前一个连续的结束日期</strong></p><pre class="mq mr ms mt gt ph pi pj pk aw pl bi"><span id="868f" class="lm ln it pi b gy pm pn l po pp">lag(first_watch.first_day_watch) over (order by first_watch.first_day_watch asc) last_watch_date</span></pre><p id="3a11" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">完成这三个步骤后，我离目标越来越近了:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi pq"><img src="../Images/874635afc6f4f6aa4322d81d698f8026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CgYG6pA6KFJKRzGsmmGxgg.png"/></div></div></figure><p id="335e" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kr iu"> 4。仅条纹过滤器启动</strong></p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi pr"><img src="../Images/f66beb436949b7bc1d219eec92557006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6xZLyM6ZotGhDuzYLWzuRA.png"/></div></div></figure><p id="11c3" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kr iu"> 5。从首行拉入行号和最后一次观察日期:</strong></p><pre class="mq mr ms mt gt ph pi pj pk aw pl bi"><span id="cee9" class="lm ln it pi b gy pm pn l po pp">lead(starts.row_number) over (order by starts.first_day_watch asc) end_row_num</span><span id="b3e8" class="lm ln it pi b gy ps pn l po pp">lead(starts.last_watch_date) over (order by starts.first_day_watch asc) binge_end_date</span></pre><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi pt"><img src="../Images/30ed6126840c0dd4f9b85dec89910a5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*STLb3qLCaJ5dQqaVvCl61w.png"/></div></div></figure><p id="0f09" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kr iu"> 6。最后一点数学知识:</strong></p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi pu"><img src="../Images/60dba19d74938a610c878dfa5ce9ab7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7KW5L7b1-2VtcoVb9tVrwg.png"/></div></div></figure><h2 id="83e0" class="lm ln it bd lo lp lq dn lr ls lt dp lu ky lv lw lx lc ly lz ma lg mb mc md me bi translated">第四步:分析📉</h2><p id="d20a" class="pw-post-body-paragraph kp kq it kr b ks mh ju ku kv mi jx kx ky oi la lb lc oj le lf lg ok li lj lk im bi translated">最后，有趣的部分！</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi pv"><img src="../Images/a599d7d94841beecc31fabc01cacc1b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lU3UeVDTwdoE-kfEP24e8A.png"/></div></div><p class="on oo gj gh gi op oq bd b be z dk translated">点击这里查看图表互动版本<a class="ae ll" href="https://count.co/n/r8jQNna2nOF" rel="noopener ugc nofollow" target="_blank"/>！</p></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi pw"><img src="../Images/0cab13a9632ab3066c4553966f78f38e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*83b2zeOA-YkwqKJdkj8y-w.png"/></div></div><p class="on oo gj gh gi op oq bd b be z dk translated">点击这里查看图表互动版本<a class="ae ll" href="https://count.co/n/r8jQNna2nOF" rel="noopener ugc nofollow" target="_blank"/>！</p></figure><p id="04e3" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">从这两张图表中，我可以说:</p><ol class=""><li id="10a4" class="mf mg it kr b ks kt kv kw ky or lc os lg ot lk mm mn mo mp bi translated">这个月(2020年3月)我看电视的时间确实比平时多(这并不奇怪)。</li><li id="f6b8" class="mf mg it kr b ks ov kv ow ky ox lc oy lg oz lk mm mn mo mp bi translated">一些节目(<em class="oe">总是阳光明媚……</em>)是在一个大型狂欢会上观看的，而其他的(<em class="oe">朋友</em>)是在更小、更分散的狂欢会上观看的。</li></ol><h1 id="bf7e" class="nq ln it bd lo nr px nt lr nu py nw lu jz pz ka lx kc qa kd ma kf qb kg md oa bi translated">那么，现在怎么办？</h1><p id="c30d" class="pw-post-body-paragraph kp kq it kr b ks mh ju ku kv mi jx kx ky oi la lb lc oj le lf lg ok li lj lk im bi translated">这就是我今天愿意分享的个人数据的范围，但是你可以想象如果你愿意(我希望你这样做)，你可以如何进一步分析。如果你对网飞的数据做了自己的分析，请在评论中告诉我们结果如何！</p><p id="6a49" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">很难找到实用的数据培训材料来帮助您和您的团队更好地使用数据。我们策划了最好的，并在我们的每周简讯中分享。如果你想了解它的全部内容，请在此注册。</p></div></div>    
</body>
</html>