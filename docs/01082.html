<html>
<head>
<title>A comprehensive guide to downloading stock prices in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 下载股票价格的综合指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-comprehensive-guide-to-downloading-stock-prices-in-python-2cd93ff821d4?source=collection_archive---------0-----------------------#2020-01-31">https://towardsdatascience.com/a-comprehensive-guide-to-downloading-stock-prices-in-python-2cd93ff821d4?source=collection_archive---------0-----------------------#2020-01-31</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><figure class="iu iv gp gr iw ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi it"><img src="../Images/a8680dafb39b0850ab4b7233aeb775e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ejyzp6CoqCnyfU_lR2i3A.jpeg"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">来源:<a class="ae ji" href="https://unsplash.com/photos/4fsCBcZt9H8" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><div class=""/><div class=""><h2 id="5396" class="pw-subtitle-paragraph ki jk jl bd b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dk translated">下载历史股票价格，只有一行代码！</h2></div><p id="0d88" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">这篇短文的目的是展示用 Python 下载股票价格(和股票相关的数据)是多么容易。在本文中，我介绍了两种方法，都使用 Yahoo Finance 作为数据源。有许多替代产品(Quandl、Intrinion、AlphaVantage、Tiingo、IEX 云等)。)，然而，雅虎财经可以被认为是最受欢迎的，因为它是最容易访问的(免费且无需注册)。</p><p id="0dbc" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">第一种方法使用一个名为<code class="fe lw lx ly lz b">yfinance</code>的库，这绝对是我所知道的最简单的方法。第二个是<code class="fe lw lx ly lz b">yahoofinancials</code>，稍微复杂一点，但是，由于我们在下载数据方面付出了额外的努力，我们收到了更多与股票相关的数据。</p><p id="34ad" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">让我们开始吧！</p><h1 id="5a9e" class="ma mb jl bd mc md me mf mg mh mi mj mk kr ml ks mm ku mn kv mo kx mp ky mq mr bi translated">设置</h1><p id="dd94" class="pw-post-body-paragraph la lb jl lc b ld ms km lf lg mt kp li lj mu ll lm ln mv lp lq lr mw lt lu lv io bi translated">我们需要加载以下库:</p><pre class="mx my mz na gt nb lz nc nd aw ne bi"><span id="6b6d" class="nf mb jl lz b gy ng nh l ni nj">import pandas as pd<br/>import yfinance as yf<br/>from yahoofinancials import YahooFinancials</span></pre><p id="d553" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">你可以<code class="fe lw lx ly lz b">pip install</code>你错过的图书馆:)</p><h1 id="ae1f" class="ma mb jl bd mc md me mf mg mh mi mj mk kr ml ks mm ku mn kv mo kx mp ky mq mr bi translated">使用 yfinance 下载股票价格</h1><p id="d709" class="pw-post-body-paragraph la lb jl lc b ld ms km lf lg mt kp li lj mu ll lm ln mv lp lq lr mw lt lu lv io bi translated"><code class="fe lw lx ly lz b">yfinance</code>是一个非常方便的库，是我下载股票价格的必去库。它以前被称为<code class="fe lw lx ly lz b">fix_yahoo_finance</code>。这个库的简短历史是作为对流行的<code class="fe lw lx ly lz b">pandas_datareader</code>库的修复而开始的。随着时间的推移，Yahoo Finance 改变了 API，相关的功能被弃用。这时候<code class="fe lw lx ly lz b">fix_yahoo_finance</code>被引入，再次使从雅虎财经下载数据成为可能。它既是<code class="fe lw lx ly lz b">pandas_datareader</code>的补丁，也是一个独立的库。</p><p id="ddfa" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">事不宜迟，下面我展示如何快速下载特斯拉的股票价格:</p><figure class="mx my mz na gt ix"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="323f" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">运行代码会产生下表:</p><figure class="mx my mz na gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi nm"><img src="../Images/6158873649092899876ce4fa62ec92a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2K4QJp-SiHgDP5VzV7jCoQ.png"/></div></div></figure><p id="ece2" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">默认情况下，该函数下载每日数据，但是我们可以将<code class="fe lw lx ly lz b">interval</code>指定为以下之一:1m、5m、15m、30m、60m、1h、1d、1wk、1mo 等等。下载数据的命令可以简化为一行:</p><pre class="mx my mz na gt nb lz nc nd aw ne bi"><span id="17ce" class="nf mb jl lz b gy ng nh l ni nj">tsla_df = yf.download('TSLA')</span></pre><p id="1d31" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">然而，我想展示如何使用函数的参数。我提供了所考虑的时间范围的开始和结束日期，并禁用了进度条(对于如此少量的数据，显示它没有意义)。我们可以通过提供一个列表(比如<code class="fe lw lx ly lz b">[‘TSLA', ‘FB', ‘MSFT']</code>)作为<code class="fe lw lx ly lz b">tickers</code>参数，一次性下载多种资产的股票价格。此外，我们可以设置<code class="fe lw lx ly lz b">auto_adjust = True</code>，这样所有显示的价格都会针对潜在的公司行为进行调整，比如拆分。</p><p id="be14" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">除了<code class="fe lw lx ly lz b">yf.download</code>函数，我们还可以使用<code class="fe lw lx ly lz b">Ticker()</code>模块。下面我给出一个下载特斯拉股票价格全部历史的简短例子:</p><figure class="mx my mz na gt ix"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="e7f2" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">运行代码会生成以下图形:</p><figure class="mx my mz na gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi nn"><img src="../Images/4bbf3a45e5205e7a1d1ea75c2845e22f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWCbCErsnE-w9QKxhKjUzw.png"/></div></div></figure><p id="23aa" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">使用<code class="fe lw lx ly lz b">Ticker</code>模块的好处是我们可以利用连接到它的多种方法。我们可以使用的方法包括:</p><ul class=""><li id="871d" class="no np jl lc b ld le lg lh lj nq ln nr lr ns lv nt nu nv nw bi translated"><code class="fe lw lx ly lz b">info</code> —打印出一个 JSON，其中包含许多有趣的信息，比如公司的全名、业务摘要、所处的行业、上市的交易所(还有国家、时区)等等。同样值得一提的是，JSON 包括一些财务指标，如<a class="ae ji" href="https://en.wikipedia.org/wiki/Beta_(finance)" rel="noopener ugc nofollow" target="_blank"> beta </a>系数。</li><li id="d393" class="no np jl lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated"><code class="fe lw lx ly lz b">recommendations</code> —包含分析师提出的建议的历史列表</li><li id="4838" class="no np jl lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated"><code class="fe lw lx ly lz b">actions</code> —显示股息和拆分等操作</li><li id="a115" class="no np jl lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated"><code class="fe lw lx ly lz b">major_holders</code> —顾名思义，显示主要持有人</li><li id="8de7" class="no np jl lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated"><code class="fe lw lx ly lz b">institutional_holders</code> —显示机构持有人，如下图所示:</li></ul><figure class="mx my mz na gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi oc"><img src="../Images/714cb385f8f0859c09372bc926c87c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCC_xjpukmVqX8leN7qKig.png"/></div></div></figure><ul class=""><li id="6d1a" class="no np jl lc b ld le lg lh lj nq ln nr lr ns lv nt nu nv nw bi translated"><code class="fe lw lx ly lz b">calendar</code> —显示传入事件，如收益。我写了一篇关于从雅虎下载完整收益日历的最简单方法的文章。金融。</li></ul><p id="505e" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">有关可用方法的更多信息，请务必查看<code class="fe lw lx ly lz b">yfinance</code>的<a class="ae ji" href="https://github.com/ranaroussi/yfinance" rel="noopener ugc nofollow" target="_blank"> GitHub 资源库</a>。</p><h1 id="268b" class="ma mb jl bd mc md me mf mg mh mi mj mk kr ml ks mm ku mn kv mo kx mp ky mq mr bi translated">使用 yahoofinancials 下载股价</h1><p id="abe7" class="pw-post-body-paragraph la lb jl lc b ld ms km lf lg mt kp li lj mu ll lm ln mv lp lq lr mw lt lu lv io bi translated">本文中我想提到的第二个<a class="ae ji" href="https://github.com/JECSand/yahoofinancials" rel="noopener ugc nofollow" target="_blank">库</a>是<code class="fe lw lx ly lz b">yahoofinancials</code>。虽然我发现使用这个库要求有点高，但是它提供了很多在<code class="fe lw lx ly lz b">yfinance</code>中没有的信息。让我们从下载特斯拉的历史股价开始:</p><figure class="mx my mz na gt ix"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="bafe" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们首先通过传递 Tesla 的 ticker 实例化了一个<code class="fe lw lx ly lz b">YahooFinancials</code>类的对象。这样做了之后，我们就可以用各种方法提取有用的信息。我们从历史股票价格开始。这个方法的用法是不言自明的。需要注意的一点是，结果是一个 JSON。这就是为什么我必须运行一系列操作来提取相关信息并将 JSON 转换成一个<code class="fe lw lx ly lz b">pandas</code>数据帧。运行该代码片段会导致:</p><figure class="mx my mz na gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi od"><img src="../Images/c4747181a07d80dc15056c8c19d4af5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xvZvNVkBoGildrMBk-raDg.png"/></div></div></figure><p id="6f96" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">获得历史股票价格的过程比<code class="fe lw lx ly lz b">yfinance</code>的情况要长一点。现在是时候展示<code class="fe lw lx ly lz b">yahoofinancials</code>的光芒了。我简要描述一下最重要的方法:</p><ul class=""><li id="3796" class="no np jl lc b ld le lg lh lj nq ln nr lr ns lv nt nu nv nw bi translated"><code class="fe lw lx ly lz b">get_stock_quote_type_data</code> —返回股票的大量一般信息，类似于<code class="fe lw lx ly lz b">yfinance</code>的<code class="fe lw lx ly lz b">info</code>。使用方法返回以下内容:</li></ul><figure class="mx my mz na gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi oe"><img src="../Images/5bda10976e74ac36af28e7b510132938.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iGFd7pzGB9zqaOsG_JOzNQ.png"/></div></div></figure><ul class=""><li id="f5e6" class="no np jl lc b ld le lg lh lj nq ln nr lr ns lv nt nu nv nw bi translated"><code class="fe lw lx ly lz b">get_key_statistics_data</code> / <code class="fe lw lx ly lz b">get_summary_data</code> —这两种方法返回许多统计数据(如 beta、市净率等。)</li><li id="d5b9" class="no np jl lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated"><code class="fe lw lx ly lz b">get_stock_earnings_data</code> —返回收益信息(年度和季度)以及公司将报告收益的下一个日期:</li></ul><figure class="mx my mz na gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi of"><img src="../Images/042f3e843c85672058cd8b3ebc7e1a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UulwBvVTy4w0LEJxga6CnQ.png"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">这种形式的 JSON 可能不是最易读的，但是它适合屏幕:)</p></figure><ul class=""><li id="f030" class="no np jl lc b ld le lg lh lj nq ln nr lr ns lv nt nu nv nw bi translated"><code class="fe lw lx ly lz b">get_financial_stmts</code> —获取公司财务报表信息的有用方法</li></ul><p id="a7fb" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我展示了一个使用这个库下载单个公司信息的例子。然而，我们可以很容易地提供一个公司列表，这些方法将返回适当的 JSONs，其中包含每个公司所请求的信息。让我们看一个下载多家公司调整后收盘价的示例:</p><figure class="mx my mz na gt ix"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="5d46" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">将数据放入<code class="fe lw lx ly lz b">pandas</code> DataFrame 需要多一点的努力，然而，代码可以很容易地重用(对于<code class="fe lw lx ly lz b">YahooFinancials</code>类的不同方法也有轻微的修改)。</p><h1 id="179c" class="ma mb jl bd mc md me mf mg mh mi mj mk kr ml ks mm ku mn kv mo kx mp ky mq mr bi translated">结论</h1><p id="fd42" class="pw-post-body-paragraph la lb jl lc b ld ms km lf lg mt kp li lj mu ll lm ln mv lp lq lr mw lt lu lv io bi translated">在本文中，我展示了如何轻松地从 Yahoo Finance 下载历史股票价格。我从使用<code class="fe lw lx ly lz b">yfinance</code>库的一行程序开始，然后逐渐深入提取更多关于股票(和公司)的信息。使用上面提到的库，我们可以在雅虎财经网站上下载几乎所有可用的信息。</p><p id="dcfd" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">您可以在我的<a class="ae ji" href="https://github.com/erykml/medium_articles/blob/master/Quantitative%20Finance/downloading_stock_prices.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到本文使用的代码。一如既往，我们欢迎任何建设性的反馈。你可以在<a class="ae ji" href="https://twitter.com/erykml1?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">推特</a>或评论中联系我。</p><p id="6691" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">喜欢这篇文章吗？成为一个媒介成员，通过无限制的阅读继续学习。如果你使用<a class="ae ji" href="https://eryk-lewinson.medium.com/membership" rel="noopener">这个链接</a>成为会员，你将支持我，而不需要额外的费用。提前感谢，再见！</p></div><div class="ab cl og oh hz oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="io ip iq ir is"><p id="c804" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我最近出版了一本关于使用 Python 解决金融领域实际任务的书。如果你有兴趣，我贴了一篇文章介绍这本书的内容。你可以在亚马逊或者 Packt 的网站上买到这本书。</p></div></div>    
</body>
</html>