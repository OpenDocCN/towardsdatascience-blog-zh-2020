<html>
<head>
<title>How to Solve the Real Big Data Problems - Load Huge Excel Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何解决真正的大数据问题——加载巨大的 Excel 文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-solve-the-real-big-data-problems-load-huge-excel-files-7e3ea6957126?source=collection_archive---------29-----------------------#2020-06-07">https://towardsdatascience.com/how-to-solve-the-real-big-data-problems-load-huge-excel-files-7e3ea6957126?source=collection_archive---------29-----------------------#2020-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="11f1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">提示:多线程。使用 PDI 和 PostgreSQL，我们可以在几分钟内加载一个巨大的 excel 文件。</h2></div><p id="8086" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">越来越多的公司开始意识到数据的重要性。因此，他们会要求将庞大的 CSV 或 Excel 文件从其传统系统或手动流程加载到数据库，以进行数据驱动的分析。我知道，我们现在有很多解决这个问题的方案，像<a class="ae lb" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a>、<a class="ae lb" href="https://dask.org/" rel="noopener ugc nofollow" target="_blank"> dask </a>、<a class="ae lb" href="https://pypi.org/project/vaex/" rel="noopener ugc nofollow" target="_blank"> vaex </a> python 库或 Informatica 等工具。</p><p id="9ba2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，学习不同的方法来解决问题陈述总是很有趣的。我们将使用 PDI 来解决这个问题，并使用 PostgreSQL 作为我们的数据库。这里的想法是优化利用我们的系统能力。我知道不是所有人都有内存优化服务器的特权。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/ae4a93ff606b8ad86ae2c35a5230f196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*swcNznmTvTf7KVRL"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated"><a class="ae lb" href="https://unsplash.com/@ev?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> ev </a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="502b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你是数据管道建设过程的新手，那么我会推荐你看下面的故事。</p><div class="ls lt gp gr lu lv"><a href="https://medium.com/swlh/build-your-first-data-pipeline-in-just-ten-minutes-2a490867b901" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">仅用 10 分钟构建您的第一条数据管道</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">通过使用 PDI 的真实用例，逐步构建您的第一个数据管道。</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">medium.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj lm lv"/></div></div></a></div><h1 id="629e" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">先决条件</h1><ul class=""><li id="156b" class="nc nd iq kh b ki ne kl nf ko ng ks nh kw ni la nj nk nl nm bi translated"><strong class="kh ir"> PDI: </strong> Pentaho 数据集成安装在您的系统上。您可以使用<a class="ae lb" href="https://medium.com/ai-in-plain-english/pentaho-data-integration-installation-guide-easy-yet-powerful-etl-tool-80930cff46c6" rel="noopener">链接</a>获得逐步安装指南。</li><li id="63f1" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated">PostgreSQL :我们可以根据自己的喜好使用任何关系或非关系数据库。如果您想跟随，请使用<a class="ae lb" href="https://www.enterprisedb.com/downloads/postgres-postgresql-downloads" rel="noopener ugc nofollow" target="_blank">链接</a>来安装。</li></ul><h1 id="ccd1" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">用户故事</h1><p id="d1ed" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated">我喜欢首先为我们的问题陈述定义用户故事。这有助于我设计数据管道的高级架构。我们需要将问题分解成简单的小块。</p><ol class=""><li id="aeda" class="nc nd iq kh b ki kj kl km ko nv ks nw kw nx la ny nk nl nm bi translated">我想读取包含数百万条记录的经济数据的巨大 CSV 文件。</li><li id="4cb8" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">我想用一个维度/主表对数据中的每个内容进行查找。</li><li id="69eb" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">我想清理数据并删除空字段。</li><li id="553a" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">我想添加一个行级条件。如果状态栏包含“修订”一词，我想添加“_R”。</li><li id="d6d4" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">我想在 PostgreSQL 数据库中加载相同的。</li></ol><p id="66a4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们试图通过增加一点复杂的数据操作来复制真实世界的场景。</p><h1 id="5f46" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">输入数据</h1><p id="80ec" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated">理解输入数据文件是一个很好的做法。现在，在我们的例子中，可能很难打开巨大的 CSV 文件并检查列和行。然而，我们可以通过一些方法来确定或检查样本数据。PDI 通过创建一个小的转换来读取样本数据和检查其他元数据。</p><p id="2da8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我谷歌了“csv 格式的巨大数据文件”这个词，并从第一个网站下载了这个文件。下面是<a class="ae lb" href="https://www.stats.govt.nz/assets/Uploads/Business-price-indexes/Business-price-indexes-March-2020-quarter/Download-data/business-price-indexes-march-2020-quarter-csv.csv" rel="noopener ugc nofollow" target="_blank">环节</a>。</p><p id="cbe3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我想让系统崩溃并创建巨大的文件；就像我们在处理大数据一样，对吗？下载的文件有<strong class="kh ir">66526 条记录</strong>，所以我多次追加相同的记录来创建一个巨大的文件，大约有<strong class="kh ir">11974697 条记录</strong>；是的，没那么大。</p><h1 id="5448" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">测试案例</h1><p id="bba0" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated">定义测试用例在这里很重要，因为我们不能手工检查整个数据。我们需要确保，我们检查了足够好的样本数据来交叉验证准确性。</p><ol class=""><li id="ae43" class="nc nd iq kh b ki kj kl km ko nv ks nw kw nx la ny nk nl nm bi translated">检查行数并与输入数据匹配。请注意，因为我们将删除空数据。存储这些空记录也很重要。</li><li id="257f" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">交叉验证至少 500 -1000 条记录的维度输出结果。</li><li id="7731" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">随机交叉验证计算结果，以检查准确性；至少一千张唱片。</li></ol></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><h1 id="bacf" class="mk ml iq bd mm mn og mp mq mr oh mt mu jw oi jx mw jz oj ka my kc ok kd na nb bi translated">步骤 1:项目的设置</h1><p id="9380" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated">我们为这个项目设置了一个非常简单的项目。只有一个目录和一个转换文件。</p><p id="b507" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我喜欢在一个名为“work”的项目目录中创建所有与工作相关的项目；我知道，多有创意啊！我们需要执行以下操作:你可以跳过这一步。</p><ol class=""><li id="930d" class="nc nd iq kh b ki kj kl km ko nv ks nw kw nx la ny nk nl nm bi translated">创建我们的项目目录- LoadData。</li><li id="05c8" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">在项目目录中创建一个目录“Input”。</li><li id="6536" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">在项目目录中创建一个名为“Main.ktr”的空转换。</li></ol><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ol"><img src="../Images/4e08abe2e03f2f326715ec7fd631288f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CVETNG2Ms-hvsgGX-aj3JQ.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">项目目录结构</p></figure><p id="4a8a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你不知道像转换或工作这样的词，那么我将推荐下面提到的故事。</p><div class="ls lt gp gr lu lv"><a href="https://medium.com/ai-in-plain-english/getting-started-with-pentaho-data-integration-kettle-and-its-components-ef1e71101323" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">Pentaho 数据集成(Kettle)及其组件入门。</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">了解勺子、平底锅、厨房等关键部件将使我们对 PDI 工具有更好的了解</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">medium.com</p></div></div><div class="me l"><div class="om l mg mh mi me mj lm lv"/></div></div></a></div><h1 id="6b42" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">步骤 2:创建数据库表</h1><p id="ec84" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated">我假设您已经在这里安装了数据库。我们使用 PostgreSQL。</p><p id="c30e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我更喜欢使用<a class="ae lb" href="https://docs.djangoproject.com/en/3.0/topics/db/models/" rel="noopener ugc nofollow" target="_blank"> Django 模型</a>创建表格。您不一定必须使用这种方法。</p><blockquote class="on oo op"><p id="85ba" class="kf kg oq kh b ki kj jr kk kl km ju kn or kp kq kr os kt ku kv ot kx ky kz la ij bi translated">话虽如此，但通过编写 Django 模型而不是手动创建表和列，我们的生活变得简单了。Django models 使用简单的 migrations 命令为我们做到了这一点，并且还获得了开箱即用的<a class="ae lb" href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete" rel="noopener ugc nofollow" target="_blank"> CRUD </a>(创建、读取、更新和删除)功能。</p></blockquote><p id="7cf0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以选择下面提到的两个选项来创建数据库和表。我已经创建了一个表 medium_db</p><ul class=""><li id="030d" class="nc nd iq kh b ki kj kl km ko nv ks nw kw nx la nj nk nl nm bi translated">PostgreSQL 创建脚本。</li></ul><pre class="ld le lf lg gt ou ov ow ox aw oy bi"><span id="8637" class="oz ml iq ov b gy pa pb l pc pd"> — Table: public.economic_data</span><span id="3d3d" class="oz ml iq ov b gy pe pb l pc pd"> — DROP TABLE public.economic_data;</span><span id="1975" class="oz ml iq ov b gy pe pb l pc pd">CREATE TABLE public.economic_data<br/>(</span><span id="c741" class="oz ml iq ov b gy pe pb l pc pd">id integer NOT NULL DEFAULT nextval(‘economic_data_id_seq’::regclass),series_reference character varying(255) COLLATE pg_catalog.”default” NOT NULL,</span><span id="e076" class="oz ml iq ov b gy pe pb l pc pd">indicator_name character varying(255) COLLATE pg_catalog.”default” NOT NULL,</span><span id="f2bc" class="oz ml iq ov b gy pe pb l pc pd">period character varying(45) COLLATE pg_catalog.”default” NOT NULL,</span><span id="889e" class="oz ml iq ov b gy pe pb l pc pd">indicator_value numeric(30,10) NOT NULL,</span><span id="bb10" class="oz ml iq ov b gy pe pb l pc pd">status character varying(255) COLLATE pg_catalog.”default” NOT NULL,<br/>indicator_unit character varying(255) COLLATE pg_catalog.”default” NOT NULL,</span><span id="6ef1" class="oz ml iq ov b gy pe pb l pc pd">group_name character varying(255) COLLATE pg_catalog.”default” NOT NULL,</span><span id="0d16" class="oz ml iq ov b gy pe pb l pc pd">series_name character varying(255) COLLATE pg_catalog.”default”,<br/> CONSTRAINT economic_data_pkey PRIMARY KEY (id)<br/>)</span><span id="d0bf" class="oz ml iq ov b gy pe pb l pc pd">TABLESPACE pg_default;</span><span id="e3c7" class="oz ml iq ov b gy pe pb l pc pd">ALTER TABLE public.economic_data<br/>OWNER to YOURUSER;</span></pre><ul class=""><li id="248c" class="nc nd iq kh b ki kj kl km ko nv ks nw kw nx la nj nk nl nm bi translated">运行迁移的 Django 模型脚本。</li></ul><pre class="ld le lf lg gt ou ov ow ox aw oy bi"><span id="133e" class="oz ml iq ov b gy pa pb l pc pd">from django.db import models</span><span id="bc5c" class="oz ml iq ov b gy pe pb l pc pd"># Create your models here.</span><span id="4eab" class="oz ml iq ov b gy pe pb l pc pd">class EconomicData(models.Model):</span><span id="3d27" class="oz ml iq ov b gy pe pb l pc pd"><strong class="ov ir">series_reference</strong> = models.CharField(</span><span id="7718" class="oz ml iq ov b gy pe pb l pc pd">db_column="series_reference",</span><span id="2f61" class="oz ml iq ov b gy pe pb l pc pd">max_length=255,</span><span id="7ca2" class="oz ml iq ov b gy pe pb l pc pd">help_text="Unique code to identify a particular record",</span><span id="7de1" class="oz ml iq ov b gy pe pb l pc pd">verbose_name="Series Reference",</span><span id="54b2" class="oz ml iq ov b gy pe pb l pc pd">)</span><span id="afb5" class="oz ml iq ov b gy pe pb l pc pd"><strong class="ov ir">indicator_name</strong> = models.CharField(</span><span id="2c7c" class="oz ml iq ov b gy pe pb l pc pd">db_column="indicator_name",</span><span id="c69d" class="oz ml iq ov b gy pe pb l pc pd">max_length=255,</span><span id="ca72" class="oz ml iq ov b gy pe pb l pc pd">verbose_name="Name of the indicators"</span><span id="d42f" class="oz ml iq ov b gy pe pb l pc pd">)</span><span id="1990" class="oz ml iq ov b gy pe pb l pc pd"><strong class="ov ir">period</strong> = models.CharField(</span><span id="86ed" class="oz ml iq ov b gy pe pb l pc pd">db_column="period",</span><span id="0f38" class="oz ml iq ov b gy pe pb l pc pd">max_length=45,</span><span id="911f" class="oz ml iq ov b gy pe pb l pc pd">verbose_name="Period"</span><span id="3b9a" class="oz ml iq ov b gy pe pb l pc pd">)</span><span id="cb13" class="oz ml iq ov b gy pe pb l pc pd"><strong class="ov ir">indicator_value</strong> = models.DecimalField(</span><span id="e2a2" class="oz ml iq ov b gy pe pb l pc pd">db_column="indicator_value",</span><span id="09eb" class="oz ml iq ov b gy pe pb l pc pd">max_digits=30,</span><span id="28dc" class="oz ml iq ov b gy pe pb l pc pd">decimal_places=10,</span><span id="0583" class="oz ml iq ov b gy pe pb l pc pd">verbose_name="Value of the Field"</span><span id="1999" class="oz ml iq ov b gy pe pb l pc pd">)</span><span id="a480" class="oz ml iq ov b gy pe pb l pc pd"><strong class="ov ir">status</strong> = models.CharField(</span><span id="be9f" class="oz ml iq ov b gy pe pb l pc pd">db_column="status",</span><span id="adb5" class="oz ml iq ov b gy pe pb l pc pd">max_length=255,</span><span id="62d8" class="oz ml iq ov b gy pe pb l pc pd">verbose_name="Status of the value For eg, Final or Revised"</span><span id="47e9" class="oz ml iq ov b gy pe pb l pc pd">)</span><span id="3126" class="oz ml iq ov b gy pe pb l pc pd"><strong class="ov ir">indicator_unit</strong> = models.CharField(</span><span id="2c88" class="oz ml iq ov b gy pe pb l pc pd">db_column="indicator_unit",</span><span id="0069" class="oz ml iq ov b gy pe pb l pc pd">max_length=255,</span><span id="4d95" class="oz ml iq ov b gy pe pb l pc pd">verbose_name="Unit of the indicators"</span><span id="8db0" class="oz ml iq ov b gy pe pb l pc pd">)</span><span id="7661" class="oz ml iq ov b gy pe pb l pc pd"><strong class="ov ir">group_name</strong> = models.CharField(</span><span id="bfd3" class="oz ml iq ov b gy pe pb l pc pd">db_column="group_name",</span><span id="fff6" class="oz ml iq ov b gy pe pb l pc pd">max_length=255,</span><span id="bf8e" class="oz ml iq ov b gy pe pb l pc pd">verbose_name="Group of the indicators"</span><span id="c31b" class="oz ml iq ov b gy pe pb l pc pd">)</span><span id="62a7" class="oz ml iq ov b gy pe pb l pc pd"><strong class="ov ir">series_name</strong> = models.CharField(</span><span id="7dc9" class="oz ml iq ov b gy pe pb l pc pd">db_column="series_name",</span><span id="b9ef" class="oz ml iq ov b gy pe pb l pc pd">max_length=255,</span><span id="07a0" class="oz ml iq ov b gy pe pb l pc pd">verbose_name="Series of the indicators"</span><span id="dce2" class="oz ml iq ov b gy pe pb l pc pd">null=True</span><span id="e489" class="oz ml iq ov b gy pe pb l pc pd">)</span><span id="7da0" class="oz ml iq ov b gy pe pb l pc pd">def __str__(self):</span><span id="4c0d" class="oz ml iq ov b gy pe pb l pc pd">return f"{self.indicator_name} - {self.value}"</span><span id="8bdc" class="oz ml iq ov b gy pe pb l pc pd">class Meta:</span><span id="9b83" class="oz ml iq ov b gy pe pb l pc pd">db_table = "economic_data"</span><span id="3463" class="oz ml iq ov b gy pe pb l pc pd">verbose_name = "Economic Data"</span><span id="cc98" class="oz ml iq ov b gy pe pb l pc pd">verbose_name_plural = "Economic Data"</span></pre><p id="7ab8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你有兴趣了解我们如何从 Django 的数据管道中获益，请在下面的回复部分告诉我。</p><p id="1ed1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们已经准备好桌子了。现在，让我们创造我们的转变。</p><h1 id="48f5" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">步骤 3:加载程序转换</h1><p id="ff16" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated">我们需要创建一个 loader 转换，它读取我们的输入 CSV，执行操作并将数据加载到数据库中。</p><p id="a0a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要打开 Main.ktr 文件并拖动一些插件，如下所述。</p><h2 id="89f7" class="oz ml iq bd mm pf pg dn mq ph pi dp mu ko pj pk mw ks pl pm my kw pn po na pp bi translated">步骤 1:拖动步骤</h2><ol class=""><li id="bf8c" class="nc nd iq kh b ki ne kl nf ko ng ks nh kw ni la ny nk nl nm bi translated">首先，让我们添加一个关于转换的小描述。文档是任何数据管道的关键。</li><li id="f120" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">将“CSV 文件输入”、“数据网格”、“连接行(笛卡尔乘积)”、“用户定义的 Java 表达式”、“过滤器行”、“文本文件输出”、“表格输出”插件从“设计”选项卡拖到画布上。</li><li id="df15" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">按照我们的命名约定重命名字段。</li></ol><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi pq"><img src="../Images/1acd0d71de765753bc5deefb76a1b754.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C7cd251ik5ZF8Zt4pag4hA.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">重命名后的主要转换</p></figure><h2 id="25c2" class="oz ml iq bd mm pf pg dn mq ph pi dp mu ko pj pk mw ks pl pm my kw pn po na pp bi translated">步骤 2:配置属性</h2><ol class=""><li id="4151" class="nc nd iq kh b ki ne kl nf ko ng ks nh kw ni la ny nk nl nm bi translated">我们需要为上述每个步骤配置属性。让我们配置 CSV 输入步骤，我们需要在<strong class="kh ir">文件名</strong>字段中浏览我们的输入文件，并点击<strong class="kh ir">获取字段</strong>。<strong class="kh ir"> </strong>我们可以根据内存可用性调整<strong class="kh ir"> NIO 缓冲区大小</strong>；它将分批处理文件，每批 50K 条记录。</li><li id="431f" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">我们需要在数据网格中添加数据(在这里复制一个表)。在这里，我们使用数据网格来表示数据。在真实的场景中，您将从一些维度表中获得这些数据。我们正在使组名标准化。你可以参考下面的数据截图。我们需要在<strong class="kh ir">元</strong>选项卡中添加列名，并在<strong class="kh ir">数据</strong>选项卡<strong class="kh ir">中添加实际数据。</strong></li><li id="0268" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">在 Join rows 步骤中，我们需要将输入中的字段映射到我们的维度表/网格中。因为我们在这里映射组，所以我们需要添加条件<strong class="kh ir">来映射相同的组。</strong></li><li id="4a46" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">在用户定义的 java 表达式中，我们将配置自定义的行级条件。我们需要将我们的<strong class="kh ir">新字段</strong>定义为‘Series _ reference _ flag ’,如果状态列为‘Revised ’,这里我们要更改‘Series _ reference’字段并附加‘R’。在我们的<strong class="kh ir"> Java 表达式</strong>中，我们将添加以下条件——‘status = =‘Revised’？Series _ reference+" _ R ":Series _ reference '；这是 java 代码。我们可以执行<a class="ae lb" href="https://wiki.pentaho.com/display/eai/user+defined+java+expression" rel="noopener ugc nofollow" target="_blank">类似</a>的条件或计算，<strong class="kh ir">功能强大！</strong>最后，我们需要将<strong class="kh ir">值类型</strong>添加到‘String’中。</li><li id="1e1c" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">在筛选行步骤中，我们需要定义传递没有空值的记录的条件。</li><li id="1776" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">在文本文件输出(错误报告)中，我们需要添加<strong class="kh ir">文件名</strong>为<strong class="kh ir"> ' </strong> ${Internal。entry . current . directory }/error _ report<strong class="kh ir">'</strong>并将<strong class="kh ir">扩展名</strong>改为‘CSV’。</li><li id="7902" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">在表格输出步骤中，我们需要创建一个新的<strong class="kh ir">连接</strong>来连接到我们的数据库。我们可以根据需要连接到任何数据库。我们在这里将连接到 PostgreSQL 有关连接的详细信息，请参考屏幕截图。我们需要浏览<strong class="kh ir">目标表</strong>到‘经济 _ 数据’。我们需要检查指定数据库字段的<strong class="kh ir">字段</strong>字段。然后，我们需要将输入/转换字段映射到表字段。</li></ol><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi pr"><img src="../Images/2b8498c545ab940496f8215c60082aa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XvWAUF7__CBPELLtbkGZUw.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">输入步骤配置</p></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ps"><img src="../Images/77259ef30c05338ae23b8c6ffb1b454c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yX5vHmxAdVO58Q7LwCShCQ.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">数据网格配置-维度</p></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi pt"><img src="../Images/42311efe5d0c575076b12455f85e0abd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a8zW0HE5bhgiR3i6bbHnjw.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">联接行配置</p></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi pu"><img src="../Images/4d6c06388e269f64d370fce5c52032b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sdbM7YnKzCxX_X18yT5c3Q.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">条件配置</p></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi pv"><img src="../Images/a6fa9c03efaeb39b60551787559ec213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mv3zGWnW_UkhjFEo8WvE3g.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">过滤空配置</p></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi pw"><img src="../Images/e7434dbfa8367cf8d8c67b537dd9cf6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m38Xh2CYmCe54koZ9IcIXw.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">数据库输出配置</p></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi px"><img src="../Images/b4a4e02e50cc3240e3c52afaadc6466a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VWVsWVb7X9jvK_smEiLTig.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">数据库映射</p></figure><h2 id="76d2" class="oz ml iq bd mm pf pg dn mq ph pi dp mu ko pj pk mw ks pl pm my kw pn po na pp bi translated">第四步:让我们加快进程</h2><p id="dcbb" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated">现在我们已经配置了属性，我们可以通过创建插入数据的多线程来加速这个过程。这将提高性能。PDI 为我们提供了按步骤配置多线程的工具。如果我们在输入步骤中使用它，它将成倍增加记录。然而，如果我们将它用于像数据库这样的输出步骤，它将分发记录。</p><p id="6074" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">PDI 为我们提供了许多优化性能的选项。我们可以执行以下步骤来提高性能。</p><ol class=""><li id="de9c" class="nc nd iq kh b ki kj kl km ko nv ks nw kw nx la ny nk nl nm bi translated">在我们的输入步骤中更改<strong class="kh ir"> NIO 缓冲区大小</strong>，定义我们的批处理大小。</li><li id="284a" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">改变<strong class="kh ir">最大值。高速缓存大小(行数)</strong>在查找步骤中，定义它将存储在高速缓存中的行数，而不是查询数据库。</li><li id="6bed" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">改变<strong class="kh ir">提交大小，</strong>类似于缓冲区大小改变批量大小来插入记录。</li><li id="4d46" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">使用多线程来执行活动，我们可以添加一个虚拟步骤，并在输出步骤之前，右键单击选择<strong class="kh ir">根据我们的要求，将启动</strong>的副本数从 1 更改为 1 以上的任何值。</li><li id="9dba" class="nc nd iq kh b ki nn kl no ko np ks nq kw nr la ny nk nl nm bi translated">请注意，如果我们想要在表输出步骤上执行多线程，那么我们不能使用第四点。然后，我们必须在输出之前添加一个<strong class="kh ir">虚拟</strong>步骤，并且<strong class="kh ir">在多个输出表步骤中分配</strong>记录。</li></ol><blockquote class="on oo op"><p id="86c4" class="kf kg oq kh b ki kj jr kk kl km ju kn or kp kq kr os kt ku kv ot kx ky kz la ij bi translated">哇！我们有这么多的选择，我们应该改变所有的性能优化器吗？简而言之，答案是否定的。我们需要用样本数据进行尝试，并对最适合我们的方法进行多次测试。</p></blockquote><h1 id="c8c2" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">第二步:评估</h1><p id="d603" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated">让我们在没有性能优化器的情况下运行这个流，然后通过应用优化器进行比较。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi py"><img src="../Images/44df9592a33333fc65f26260a0d6eeda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pag9QquA_OAnh_ERWjHMbA.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">成功</p></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi pz"><img src="../Images/d73213f01fa0522ed16b4708b5ea3b78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PAIoGk5D0yIZ4eUedzOP5w.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">步进矩阵——用了 8m 42s</p></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi qa"><img src="../Images/e94d56e0fb26e142e1e588dc93896952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mnVk0PnpPm3zQB5n2GpvOA.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">添加了简单的优化器—20 倍的 on 条件和两个输出线程</p></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi qb"><img src="../Images/ab70998607b43e6911791c85fd3efe05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k_eGyNkaUnApff-8bYy6oA.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">步骤矩阵——花了 4m 35s</p></figure><p id="0b23" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过添加一些简单的性能优化器，我们将执行相同活动的时间减少了近 50%。</p><p id="d4f1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们想读取多个文件，并创建一个循环来处理相同的文件，那么我会推荐你阅读下面的故事。</p><div class="ls lt gp gr lu lv"><a rel="noopener follow" target="_blank" href="/how-to-automate-multiple-excel-workbooks-and-perform-analysis-13e8aa5a2042"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">如何自动化多个 Excel 工作簿并执行分析</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">应用这个循序渐进的指南来解决问题，使用神奇的元数据注入 PDI。</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">towardsdatascience.com</p></div></div><div class="me l"><div class="qc l mg mh mi me mj lm lv"/></div></div></a></div><h1 id="8114" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">结论</h1><p id="1f93" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated">我们提出了一个问题陈述，并尝试使用多种方法解决它，还尝试优化它。理论上，您可以应用这个过程来满足您的需求，并尝试进一步优化它。PDI 也为我们提供了<strong class="kh ir"> PostgreSQL 批量加载器</strong>步骤；我也试过那一步。然而，这并没有提供任何显著的性能提升。</p><p id="2c9f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不能在一开始就优化代码/管道，必须执行多次测试才能获得理想的结果。然而，为了缩短学习曲线，你可以随时阅读我的经验，并通过使用下面的链接订阅我的电子邮件列表来找到问题陈述的解决方案。</p><div class="ls lt gp gr lu lv"><a href="https://wryteex.com/" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">WryteEx -使用真实世界用例寻找解决方案的平台</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">我写的博客涉及数据工程、金融、Python、Python Django、项目管理、Web 开发等等</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">wryteex.com</p></div></div><div class="me l"><div class="qd l mg mh mi me mj lm lv"/></div></div></a></div><h1 id="6f86" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">下一篇文章再见。快乐的 ETL</h1></div></div>    
</body>
</html>