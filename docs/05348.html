<html>
<head>
<title>Parsing XML Data in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python解析XML数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/parsing-xml-data-in-python-da26288280e1?source=collection_archive---------3-----------------------#2020-05-06">https://towardsdatascience.com/parsing-xml-data-in-python-da26288280e1?source=collection_archive---------3-----------------------#2020-05-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bb88" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在熊猫数据框架中存储XML数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1742e02d73f974087a8280d4ba19e970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Akt_uuKZ3G-N6YFCQOKzA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pexels.com/photo/close-up-photography-of-colorful-yarns-635002/" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="493d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可扩展标记语言(XML)是一种以人类和机器可读的格式编码数据的标记语言。XML在各种程序中用于构造、存储和传输数据。Python包含几个处理XML数据的接口。在本帖中，我们将讨论如何使用python“xml”库中的“ElementTree”模块来解析XML数据并将数据存储在Pandas数据框中。</p><p id="c5c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><p id="f0fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于我们的目的，我们将使用一个样本“xml”文件，“books.xml”，它可以在<a class="ae ky" href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/ms762271(v%3Dvs.85)" rel="noopener ugc nofollow" target="_blank">这里</a>找到。该文件包含各种书籍的信息，如书名、作者姓名和价格。</p><p id="5ac6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们从python“XML”库中的“ElementTree”模块导入“parse ”:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9d38" class="ma mb it lw b gy mc md l me mf">from xml.etree.ElementTree import parse</span></pre><p id="9dd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们看看“books.xml”中的文件标签:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/28b2b81737e074d4e0e48c91090e2ea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4p3bBTkXuoVEvOvaHevtnA.png"/></div></div></figure><p id="5e26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过将文件名传递给“parse()”方法来定义一个已解析的“XML”文档对象:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4b17" class="ma mb it lw b gy mc md l me mf">document = parse('books.xml')</span></pre><p id="86d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们打印对象，我们会看到在指定的内存地址有一个“ElementTree”对象:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="698f" class="ma mb it lw b gy mc md l me mf">print(document)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/921b8abf69a6c2d8837d31cb9bc9de06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7aFAo1APygEOmL0n-dfaFQ.png"/></div></div></figure><p id="5de4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用内置的“dir()”方法来看看该对象可用的方法和属性:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e055" class="ma mb it lw b gy mc md l me mf">print(dir(document))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/bdbe78b6f0bcb414f14d51bb1c3ba4c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p20TpO7jybwOUsT10KwYWg.png"/></div></div></figure><p id="450f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用方法“iterfind()”来返回一个生成器，我们可以在“for-loop”中对其进行迭代。我们需要在“iterfind()”方法中指定一个路径参数。让我们选择“图书”路径:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6f93" class="ma mb it lw b gy mc md l me mf">for item in document.iterfind(‘book’):<br/>    print(item)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/2a38206cb779659ea73a3e089e78ae02.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*VfgXsw_F_vaxA05rY7JXuQ.png"/></div></figure><p id="e1b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到，我们有几个“元素簿”对象存储在不同的内存地址。我们可以使用“findtext()”方法从这些对象中提取信息。让我们提取“作者”标签中的信息:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="778e" class="ma mb it lw b gy mc md l me mf">for item in document.iterfind('book'):<br/>    print(item.findtext('author'))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/d84c9a83d9e0a984fd37cb08ec6d0240.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*4oPeXbbzml13xvaZmEhdSQ.png"/></div></figure><p id="8a4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以提取标题:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="fb90" class="ma mb it lw b gy mc md l me mf">for item in document.iterfind('book'):<br/>    print(item.findtext('title'))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/3de2eb47b8db7d3c83d3b743c2628057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*l36fdAXSvbOG63im3TQlPg.png"/></div></figure><p id="1789" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看价格:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1bce" class="ma mb it lw b gy mc md l me mf">for item in document.iterfind('book'):<br/>    print(item.findtext('price'))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/0218ccf6a124912273eeb30dd6f5b24b.png" data-original-src="https://miro.medium.com/v2/resize:fit:176/format:webp/1*Yg1fxVlB8GHLnyJIE7wmHQ.png"/></div></figure><p id="ee0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们可以初始化用来存储这些值的列表:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4485" class="ma mb it lw b gy mc md l me mf">author = []<br/>title = []<br/>price = []</span></pre><p id="47e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在for循环中，我们可以追加值:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8da9" class="ma mb it lw b gy mc md l me mf">for item in document.iterfind('book'):<br/>    author.append(item.findtext('author'))<br/>    title.append(item.findtext('title'))<br/>    price.append(item.findtext('price'))</span></pre><p id="d60d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以将这些列表存储在一个数据框中。让我们首先导入熊猫库:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3b3b" class="ma mb it lw b gy mc md l me mf">import pandas as pd </span></pre><p id="94a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们定义一个包含每本书的“标题”、“作者”和“价格”的数据框:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f101" class="ma mb it lw b gy mc md l me mf">df = pd.DataFrame({'title': title, 'author':author, 'price':price})</span></pre><p id="1e94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们打印结果数据框:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="72ee" class="ma mb it lw b gy mc md l me mf">print(df)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/0c7313529b69f78b0319f3ae46c21416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*REgpZdAMQ-C1quOH39scmg.png"/></div></div></figure><p id="33fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以将“流派”、“发布日期”和“描述”添加到数据框中:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8b0a" class="ma mb it lw b gy mc md l me mf">genre = []<br/>description = []<br/>publish_date = []</span><span id="0ff3" class="ma mb it lw b gy mo md l me mf">for item in document.iterfind('book'):<br/>    ...<br/>    genre.append(item.findtext('genre'))<br/>    description.append(item.findtext('description'))<br/>    publish_date.append(item.findtext('publish_date'))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/20c4d563591ba5bf33cda07a1f534bac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m6wX_mnW3gcz1oafExnvHA.png"/></div></div></figure><p id="189e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们在数据框中有了所有的信息，我们可以做一些事情，例如将“价格”字符串转换为“浮点型”，并计算“价格”列的平均值:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d605" class="ma mb it lw b gy mc md l me mf">df['price'] = df['price'].astype(float)<br/>print("Mean price: ", df['price'].mean())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/a1c887690f509ec3d969ea6c36522427.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*3gRaVTI45Z8POTS1TO4GHQ.png"/></div></figure><p id="0b70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们也将“publish_date”转换为“datetime”对象，并提取年、月和日的值:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bb51" class="ma mb it lw b gy mc md l me mf">df['publish_date'] = pd.to_datetime(df['publish_date'])<br/>df['year'] = df['publish_date'].dt.year<br/>df['month'] = df['publish_date'].dt.month<br/>df['day'] = df['publish_date'].dt.day<br/>print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/69c92e2d99e570b2ba78cf7bd327ab0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J6iOV66396JnGsj_T5mT8Q.png"/></div></div></figure><p id="72ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用collections模块中的“Counter()”方法来查看作者和流派的分布情况:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8e95" class="ma mb it lw b gy mc md l me mf">from collections import Counter<br/>print(Counter(df['author']))<br/>print(Counter(df['genre']))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/219167087da8c81d8c751f2b0ba33d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a6LhS5KRHCWM5qUyp8EPgA.png"/></div></div></figure><p id="c686" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我就讲到这里，但是您可以随意使用数据并自己编码。</p><h1 id="0245" class="mt mb it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">结论</h1><p id="55e2" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">总之，在这篇文章中，我们讨论了如何使用python中的“xml”库解析XML数据。我们展示了如何使用“iterfind()”方法来定义一个生成器对象，我们可以在“for-loop”中迭代该对象。我们还展示了如何使用“findtext()”方法访问元素标记信息。然后，我们将XML信息存储在用于定义Pandas数据框的列表中。我希望你觉得这篇文章有用/有趣。这篇文章的数据和代码可以在<a class="ae ky" href="https://github.com/spierre91/medium_code/blob/master/xml_parsing/intro_to_xml_parsing.py" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。感谢您的阅读！</p></div></div>    
</body>
</html>