<html>
<head>
<title>Visualizing spatial data with geojson heatmaps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 geojson 热图可视化空间数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-spatial-data-with-geojson-heatmaps-1fbe2063ab86?source=collection_archive---------22-----------------------#2020-06-28">https://towardsdatascience.com/visualizing-spatial-data-with-geojson-heatmaps-1fbe2063ab86?source=collection_archive---------22-----------------------#2020-06-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ef59" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">热图是一种很好的可视化方式，但在地图上绘制它们可能是一个挑战。了解如何使用 geojsoncountour 创建自定义 geojson 数据来创建身临其境的地图。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/885a57dbe3155a2c7b97326a003158d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*T2k3kMg6wTTS3ZQ5L7fRew.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">华沙房地产价格[兹罗提/平方米]</p></figure><p id="187a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您是否曾经处理过空间数据，并面临过必须在过度拥挤的散点图或局限于行政边界(如地区)的等值线图之间做出选择的挑战？</p><p id="b05c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为一名房地产行业的数据科学家，我经常处理空间数据，但是，我一直在努力寻找可视化空间数据的最佳方式，以便能够轻松地从大型数据集中掌握关键的空间要素。</p><p id="270a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Plotly 或 Folium 提供的基本功能受到限制，所以我决定研究一下如何在地图上创建自定义热图，我想在本文中与您分享。从 2020 年 5 月起，我将致力于华沙超过 1 万个房地产报价的数据集，你可以通过下面的链接从我的 GitHub 下载。</p><p id="9b18" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">GitHub 上有完整的代码和数据来源:<a class="ae lq" href="https://github.com/Jan-Majewski/Project_Portfolio/blob/master/03_Real_Estate_pricing_in_Warsaw/03_02_Data_Vizualization.ipynb" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/Jan-Majewski/Project _ Portfolio/blob/master/03 _ Real _ Estate _ pricing _ in _ Warsaw/03 _ 02 _ Data _ viz ualization . ipynb</a></p><p id="ee63" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于交互式可视化，我推荐使用 nbviewer 链接:<a class="ae lq" href="https://nbviewer.jupyter.org/github/Jan-Majewski/Project_Portfolio/blob/12a5fd122c2f64830c4ec22de04b39406f02e10b/03_Real_Estate_pricing_in_Warsaw/03_02_Data_Vizualization.ipynb" rel="noopener ugc nofollow" target="_blank">https://nb viewer . jupyter . org/github/Jan-Majewski/Project _ Portfolio/blob/c 770 f 21 DC 410 b 1495 DBD F5 b 9 F4 f 443 ECD 4d 986 ba/03 _ Real _ Estate _ pricing _ in _ Warsaw/03 _ 02 _ Data _ viz ualization . ipynb</a></p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="4357" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">1.介绍</h1><p id="0a9f" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">使用的数据可以从 GitHub 下载</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="5322" class="na lz it mw b gy nb nc l nd ne">df = pd.read_excel(r"<a class="ae lq" href="https://raw.githubusercontent.com/Jan-Majewski/Project_Portfolio/master/03_Real_Estate_pricing_in_Warsaw/Warsaw_RE_data.xlsx" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/Jan-Majewski/Project_Portfolio/master/03_Real_Estate_pricing_in_Warsaw/Warsaw_RE_data.xlsx</a>")</span></pre><p id="1143" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于数据的特性比这个项目所需的要多得多，所以让我们只选择关键的 8 列。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="dec1" class="na lz it mw b gy nb nc l nd ne">key_columns=['Id', 'Area', 'Price', 'latitude', 'longitude',<br/>      'City','district']</span><span id="9512" class="na lz it mw b gy nf nc l nd ne">df<strong class="mw iu">=</strong>df[key_columns]</span><span id="e63d" class="na lz it mw b gy nf nc l nd ne">df.head(10)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/b2f9457d01377cd1805a44d5f3e6e40c.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*aowZPbE3Z3ngx6s7ts6J4Q.png"/></div></div></figure><p id="900c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，让我们探索使用基本 Plotly 要素可视化空间数据的最常见方法。</p><h2 id="e8d5" class="na lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated">1.1 .基本散点图框</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nw"><img src="../Images/481702ed13297178e47fc438c8e91e3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QXboJgYUpbWC7wFy-onZqQ.png"/></div></div></figure><p id="709b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">地图上的散点图可能是可视化空间数据的最常见和最简单的方式。你得到坐标，设置一个特征为颜色，这就是你的地图。乍一看，它甚至看起来非常有效，但是如果你正在处理一个更大的数据集，它会变得过于拥挤，你实际上看不到下面的地图。</p><h2 id="9df0" class="na lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated">1.2 网格散点图框</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nx"><img src="../Images/b7be22baf0fded0add6f35b64d24db14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ivou5U5mxSY3L-bp2lxwow.png"/></div></div></figure><p id="0bac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以通过舍入坐标并计算每个图块的平均值来创建网格，从而简化散布。它看起来更容易阅读，但我们也失去了很多细节。</p><p id="6183" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">格网图基于通过裁剪纬度和经度、创建纬度 _ 模式和经度 _ 模式要素以及对数据进行分组以创建测向图而汇总的数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/111acbf22975ee734c6a415de322044b.png" data-original-src="https://miro.medium.com/v2/resize:fit:376/format:webp/1*J36S_QbL7iUFhVK-tJdylA.png"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="5a4c" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">2.使用 geojson 定制热图</h1><p id="0f7a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">由于对之前的结果不满意，我决定寻找基于等高线图创建热图的方法。</p><p id="0492" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对我来说，最好的解决方案是一个 4 步过程:</p><ul class=""><li id="6e5b" class="ob oc it kw b kx ky la lb ld od lh oe ll of lp og oh oi oj bi translated">在 matplotlib 中创建等高线图</li><li id="baea" class="ob oc it kw b kx ok la ol ld om lh on ll oo lp og oh oi oj bi translated">使用 geojsoncountour 库将其转换为 geojson</li><li id="1a5e" class="ob oc it kw b kx ok la ol ld om lh on ll oo lp og oh oi oj bi translated">从 geojson 提取值到 df_contour</li><li id="6a95" class="ob oc it kw b kx ok la ol ld om lh on ll oo lp og oh oi oj bi translated">使用 plotly 创建 choropleth 地图</li></ul><h2 id="1252" class="na lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated">2.1 用 matplotlib 计算我们的图</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/810db3111a2910578ccc6997e03122b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*JmV4-PIfz1YPa5UGWw5HMQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">价格密度等值线图</p></figure><p id="866e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们得到了一个非常好的等高线图，现在我们需要做的就是把它转换成 geojson，这样它就可以和 plotly 兼容了。</p><p id="dc6a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">警告！为等值线图选择边界时，请确保每个图层至少有一个数据点。如果最大值和最小值太宽或者步长太小，并且其中一个图层为空，则可能会使整个 geojson 在 plotly 中根本不出现。</p><h2 id="b7a1" class="na lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated">2.2 .将等高线图转换为 geojson</h2><p id="608e" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">要将等高线图转换为 geojson，您需要 geojsoncontour 库。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="d94e" class="na lz it mw b gy nb nc l nd ne">pip install geojsoncontour</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h2 id="151c" class="na lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated">2.3.创建 viz 之前的最后一步是将 geojson 的价格提取到 DataFrame 中</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="3050" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于 plotly 需要一个数据帧，其中的值用于 geojson 中空间对象的填充颜色，我们需要通过迭代 geojson 字典中的“features”键来提取它们。该键包含一个字典列表，热图的每一层都有一个字典。该值作为“title”键存储在子字典的“properties”键中。让我们还将“id”键添加到列表中的每个字典，以将空间对象与数据帧行相匹配。</p><h2 id="8d1b" class="na lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated">2.4 最终创建热图</h2><p id="d8a0" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">现在我们有了创建一个漂亮的热图所需要的一切。我们来策划吧！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi oq"><img src="../Images/2725b80c37efa9eb20090ec7c8b6af83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nBDIQ3SZ6JZi9dNWKHHg1g.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">房地产价格密度的最终热图</p></figure><p id="863b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我建议参考页面顶部的 nbviewer 链接，以探索缩放和深入研究最有趣的情节区域的全部可能性。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="54e6" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">3.摘要</h1><p id="efad" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">我希望本教程能帮助你使你的空间可视化更有效，更容易一目了然地抓住关键的洞察力。</p><p id="a445" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这种类型的可视化适用于各种数据，其中空间要素是关键驱动因素之一。总结一下，享受一个类似的基于谷歌通勤数据的 viz。如果您对分析感兴趣，本文顶部引用的笔记本也使用 Google API 处理提取和处理驾驶时间数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi or"><img src="../Images/c54c8238e69a50040da50c705e85b5b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nzYDDuXklzcjUU-dZjRdGQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">华沙早晨通勤时间</p></figure></div></div>    
</body>
</html>