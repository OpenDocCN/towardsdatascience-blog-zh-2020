<html>
<head>
<title>Build an Open-Domain Question-Answering System With BERT in 3 Lines of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 3 行代码用 BERT 构建一个开放领域的问答系统</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-an-open-domain-question-answering-system-with-bert-in-3-lines-of-code-da0131bc516b?source=collection_archive---------21-----------------------#2020-04-15">https://towardsdatascience.com/build-an-open-domain-question-answering-system-with-bert-in-3-lines-of-code-da0131bc516b?source=collection_archive---------21-----------------------#2020-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7db1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">拥抱脸变形金刚的端到端问答</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/146b57d51766ce870df17288240f2485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j3JehfFUP9EfhvDa"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://www.pexels.com/photo/questions-answers-signage-208494/" rel="noopener ugc nofollow" target="_blank"> Pexels </a></p></figure><p id="53b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">开放领域问答(QA) </strong>系统接受自然语言问题作为输入，并从大型文本语料库(如维基百科)中的内容返回准确的答案。这与标准搜索引擎非常不同，标准搜索引擎只是返回与搜索查询中的关键字匹配的文档。</p><p id="8d85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为实际应用构建这样的系统在历史上是相当具有挑战性和复杂的。本文试图使这样的系统更容易实现和开发。在本教程中，我们将仅用<strong class="lb iu"> 3 行代码</strong>构建一个全功能、端到端的开放领域 QA 系统。为了实现这一点，我们将使用<strong class="lb iu"> ktrain </strong>，这是一个 Python 库和 TensorFlow 包装器，使深度学习和 AI 更容易访问和应用。ktrain 是免费的，开源的，这里有<a class="ae ky" href="https://github.com/amaiya/ktrain" rel="noopener ugc nofollow" target="_blank">的</a>。</p><p id="3bc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的基本思想是将涵盖许多不同主题的文档集视为一种知识库，我们可以向其提交问题并获得准确的答案。在本文中，我们将使用<a class="ae ky" href="http://qwone.com/~jason/20Newsgroups/" rel="noopener ugc nofollow" target="_blank"> 20 个新闻组数据集</a>作为知识库。作为包含大量观点、辩论和争论的新闻组帖子的集合，语料库远非理想的知识库。通常最好使用基于事实的文档，如维基百科文章，甚至新闻文章。然而，<strong class="lb iu"> 20 个新闻组</strong>数据集对于这个例子来说已经足够了，因为它提供了一个有趣且易于尝试的案例研究。它还强调了这样一个事实，即问答系统可以从任何文档集合中获得洞察力。</p><p id="0e80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先使用<strong class="lb iu"> scikit-learn </strong>将数据集加载到一个名为<code class="fe lv lw lx ly b">docs</code>的数组中，并导入一些<em class="lz"> ktrain </em>模块。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ma"><img src="../Images/f2a66ac8ba03cf8cb0885d9b0b010d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B4l_fFX-LrATOhIzhfGITA.png"/></div></div></figure><h1 id="5f49" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">步骤 1:创建搜索索引</h1><p id="7c67" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li mv lk ll lm mw lo lp lq mx ls lt lu im bi translated">有了数据集，我们首先需要创建一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Search_engine_indexing" rel="noopener ugc nofollow" target="_blank">搜索索引</a>。搜索索引将允许我们快速方便地检索包含问题中出现的单词的文档。这样的文档很可能包含答案，并且可以被进一步分析以提取候选答案。我们将首先初始化搜索索引，然后将 Python 列表中的文档添加到索引中。由于新闻组的帖子很小，可以放在主内存中，我们将把<code class="fe lv lw lx ly b">commit_every</code>设置为一个大的值，以加快索引过程。这意味着直到最后才会写出结果。如果您遇到问题，可以尝试降低该值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/67cb8c0009bfd536442251799e660818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LgK-4a6-rjI582RcagBpNA.png"/></div></div></figure><p id="544e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于太大而无法加载到 Python 列表中的文档集，您可以使用<code class="fe lv lw lx ly b">SimpleQA.index_from_folder</code>，它将抓取一个文件夹并索引所有找到的纯文本文档。</p><h1 id="1720" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">步骤 2:创建一个 QA 实例</h1><p id="68b4" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li mv lk ll lm mw lo lp lq mx ls lt lu im bi translated">接下来，我们将创建一个 QA 实例，它主要是来自优秀的<a class="ae ky" href="https://huggingface.co/transformers/model_doc/bert.html#tfbertforquestionanswering" rel="noopener ugc nofollow" target="_blank">变形金刚库的预训练<code class="fe lv lw lx ly b">BertForQuestionAnswering</code>模型的包装器。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/d3dbbeff0d045622cec9992ececaa571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kl4wsq1PozzkQUyyxBFVzg.png"/></div></div></figure><p id="6952" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！在大约 3 行代码中，我们构建了一个端到端的问答系统，可以随时接收问题。</p><h1 id="fc41" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">提问！</h1><p id="7293" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li mv lk ll lm mw lo lp lq mx ls lt lu im bi translated">我们将调用<code class="fe lv lw lx ly b">qa.ask</code>方法向我们索引的文本语料库发出问题并检索答案。<code class="fe lv lw lx ly b">ask</code>方法执行以下步骤:</p><ol class=""><li id="76a7" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">使用搜索索引查找问题中包含单词的文档</li><li id="8a8a" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">从这些文档中提取段落用作<strong class="lb iu">上下文</strong>，并使用在<a class="ae ky" href="https://rajpurkar.github.io/SQuAD-explorer/" rel="noopener ugc nofollow" target="_blank">小队数据集</a>上预先训练的 BERT 模型解析出候选答案</li><li id="df7b" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">根据可信度分数对候选答案进行排序和删减，并返回结果</li></ol><p id="b4af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还将使用<code class="fe lv lw lx ly b">qa.display</code>方法在我们的 Jupyter 笔记本中很好地格式化和显示前 5 个结果。由于模型正在对段落和句子进行梳理以寻找答案，因此可能需要一些时间来返回结果。</p><p id="6f5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还要注意的是，<strong class="lb iu"> 20 新闻组</strong>数据集涵盖了 20 世纪 90 年代早期到中期的事件，因此不存在对近期事件的引用。然而，数据集涵盖了许多不同的领域类别。例如，有<strong class="lb iu"> sci.space </strong>类别<strong class="lb iu"> </strong>涵盖了有关太空的主题。先说一个空间问题！</p><p id="46a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">太空问题:</strong></p><blockquote class="no np nq"><p id="3bf2" class="kz la lz lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated">卡西尼号探测器是什么时候发射的？</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/29ab60e4c3e9cbebeb8ede72a53d325e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3FJ78EIBofrA6XUBj4SFnQ.png"/></div></div></figure><p id="84f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，第一个候选答案表明卡西尼太空探测器于 1997 年 10 月发射，看起来是正确的。其上下文中的特定答案在列<strong class="lb iu">上下文</strong>下以红色突出显示。请注意，正确答案不会总是最佳答案，但在这种情况下是这样的。</p><p id="f79f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们使用了<code class="fe lv lw lx ly b">index_from_list</code>来索引文档，所以最后一列(由<code class="fe lv lw lx ly b">answers</code>字典中的<code class="fe lv lw lx ly b">reference</code>字段填充)显示了与包含答案的新闻组帖子相关的列表索引。此<code class="fe lv lw lx ly b">reference</code>字段可用于细读包含有<code class="fe lv lw lx ly b">print(docs[59])</code>答案的整个文档。如果使用<code class="fe lv lw lx ly b">index_from_folder</code>来索引文档，那么<code class="fe lv lw lx ly b">reference</code>字段将被替换为文档的相对文件路径。</p><p id="9115" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 20 个新闻组</strong>数据集也包含许多讨论和辩论基督教的帖子。让我们问一个关于这个主题的问题。</p><p id="778c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">宗教问题:</strong></p><blockquote class="no np nq"><p id="70ec" class="kz la lz lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated">耶稣基督是谁？</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/f001a6f1304fab7f37cd228a32c85e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a0Sdfb_Cq_yDkFAMTmAsVQ.png"/></div></div></figure><p id="81ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们看到不同的观点对耶稣基督，因为辩论和讨论，在这个文件集。</p><p id="698f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，<strong class="lb iu"> 20 新闻组</strong>数据集还包含几个关于计算主题的新闻组类别，如计算机图形和 PC 硬件和软件。让我们问一个技术支持问题。</p><p id="452e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">技术支持问题:</strong></p><blockquote class="no np nq"><p id="cc4c" class="kz la lz lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated">什么原因导致电脑图像太暗？</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/b52f76d069fc7ccd97c29281f4b74303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ku6yHwOf6SrbcgD67FvqVw.png"/></div></div></figure><p id="f611" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从候选答案来看，缺乏伽马校正的<strong class="lb iu">似乎至少是报告问题的原因之一。</strong></p><h1 id="f542" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">关于部署质量保证系统的说明</h1><p id="7669" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li mv lk ll lm mw lo lp lq mx ls lt lu im bi translated">要部署这个系统，唯一需要持久化的状态是我们在<strong class="lb iu">步骤 1 </strong>中初始化并填充的搜索索引。一旦搜索索引被初始化和填充，人们可以简单地从<strong class="lb iu">步骤 2 </strong>开始在生产环境中使用 QA 系统。</p><h1 id="45c6" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">本文的源代码</h1><p id="537c" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li mv lk ll lm mw lo lp lq mx ls lt lu im bi translated">本文的源代码有两种形式:</p><ol class=""><li id="3fae" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">GitHub repo 上提供的 Jupyter 笔记本<a class="ae ky" href="https://nbviewer.jupyter.org/github/amaiya/ktrain/blob/master/examples/text/question_answering_with_bert.ipynb" rel="noopener ugc nofollow" target="_blank"/></li><li id="cf9d" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">谷歌 Colab 笔记本<a class="ae ky" href="https://colab.research.google.com/drive/1tcsEQ7igx7lw_R0Pfpmsg9Wf3DEXyOvk" rel="noopener ugc nofollow" target="_blank">此处有售</a></li></ol><p id="c65e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在自己的文档集中随意试用一下<em class="lz"> ktrain </em> <strong class="lb iu"> QA </strong>模块。要了解更多信息，请访问我们的 GitHub 知识库:</p><blockquote class="nx"><p id="e035" class="ny nz it bd oa ob oc od oe of og lu dk translated">【https://github.com/amaiya/ktrain T4】</p></blockquote></div></div>    
</body>
</html>