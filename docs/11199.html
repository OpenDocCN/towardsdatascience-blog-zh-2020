<html>
<head>
<title>Accessing and Examining Covid-19 Data On Your Own</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自己访问和检查新冠肺炎数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/accessing-and-examining-covid-19-data-on-your-own-e9d9b4fbc09b?source=collection_archive---------64-----------------------#2020-08-03">https://towardsdatascience.com/accessing-and-examining-covid-19-data-on-your-own-e9d9b4fbc09b?source=collection_archive---------64-----------------------#2020-08-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="766f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建一个 choropleth 图，显示美国各县过去七天的人均新冠肺炎死亡人数</h2></div><p id="b206" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="le">编者按:</em> </strong> <em class="le"> </em> <a class="ae lf" href="http://towardsdatascience.com/" rel="noopener" target="_blank"> <em class="le">走向数据科学</em> </a> <em class="le">是一份以数据科学和机器学习研究为主的中型刊物。我们不是健康专家或流行病学家，本文的观点不应被解释为专业建议。想了解更多关于疫情冠状病毒的信息，可以点击</em> <a class="ae lf" href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports" rel="noopener ugc nofollow" target="_blank"> <em class="le">这里</em> </a> <em class="le">。</em></p><h1 id="daae" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">数据和疫情</strong></h1><p id="0aba" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">对于此时地球上的大多数人来说，经历一次全球性的疫情是一次前所未有的经历。有时，我会想到 1918 年至 1920 年的下一次全球疫情与今天之间的时期。这 100 年里，在你能想到的几乎所有领域，包括数据和技术，都发生了一些迄今为止世界上最引人注目的变化。我想知道那些生活在 1918 年的人是如何获得关于疫情及其传播的信息的？今天，我们有许多信息来源可用，并随时可以访问数据显示，包括预测模型，描述和预测疫情的轨迹。但是，作为一名数据科学家，您可能会发现，即使在查看了可用内容之后，您仍有一些问题没有得到解答，并且希望能够自己监控快速发展的情况。幸运的是，通过约翰·霍普金斯系统科学与工程中心(<a class="ae lf" href="https://systems.jhu.edu/research/public-health/ncov/" rel="noopener ugc nofollow" target="_blank">https://systems.jhu.edu/research/public-health/ncov/</a>)的深入研究，你可以获得全球范围内每日的新冠肺炎病例数和死亡人数，也可以获得美国各州、县或地区的数据。然后，您可以使用这些信息来设计数据报告和显示，以便更好地做出困难的决策。例如，在本报告中，我将向您展示如何:</p><p id="f344" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1.在 Github 上访问约翰霍普金斯大学的新冠肺炎数据，</p><p id="0def" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.执行一些简单的数据操作来转换数据，并且</p><p id="99d9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.使用 albersusa R 软件包构建一个 choropleth 图(<a class="ae lf" href="https://rud.is/b/2016/03/29/easier-composite-u-s-choropleths-with-albersusa/" rel="noopener ugc nofollow" target="_blank">https://rud . is/b/2016/03/29/easy-composite-u-s-choropleths-with-albers USA/</a>)，以显示美国各县过去七天的人均新冠肺炎死亡人数。</p><h1 id="c9ac" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">访问 Github 上的每日新冠肺炎数据</strong></h1><p id="5b00" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">您可以从加载下面的包开始。注意，如果没有安装 albersusa 包，可以使用 devtools 包中的 install_github()函数来安装。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="19a5" class="mm lh it mi b gy mn mo l mp mq"># Data on COVID-19 from Johns Hopkins Center for Systems Science and Engineering<br/># https://systems.jhu.edu/research/public-health/ncov/<br/># https://github.com/CSSEGISandData/COVID-19</span><span id="1b8c" class="mm lh it mi b gy mr mo l mp mq"># Blog post to demonstrate chloroplot package<br/>#https://rud.is/b/2016/03/29/easier-composite-u-s-choropleths-with-albersusa/</span><span id="7a87" class="mm lh it mi b gy mr mo l mp mq">rm(list = ls())<br/>library(tidyverse)<br/>library(rgeos)<br/>library(maptools)<br/>library(ggplot2)  <br/>library(ggalt)<br/>library(ggthemes)<br/>library(albersusa) # devtools::install_github("hrbrmstr/albersusa")<br/>library(scales)<br/>library(gtools)</span></pre><p id="c99e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以使用以下方法读取数据。请注意，在相同或相邻的目录中，还有美国病例、全球病例和死亡病例的数据集。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="9a72" class="mm lh it mi b gy mn mo l mp mq"># read time series data on US deaths by county<br/>urlfile='<a class="ae lf" href="https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv'</a><br/>cov19_us_dat&lt;-read_csv(url(urlfile))</span></pre><p id="047f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据每天更新。在本例中，我们只想使用最近 8 天的数据(因为我们需要减去——您将在下面看到)。我们还保存了 fips 代码(用于标识美国各县)和每个县的人口，以便我们可以计算人均值。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2ad5" class="mm lh it mi b gy mn mo l mp mq"># Collect data consisting of the last 8 days<br/>tot_days &lt;- ncol(cov19_us_dat)<br/>begin_day &lt;- tot_days - 7<br/>fips &lt;- cov19_us_dat$FIPS<br/>pop &lt;- cov19_us_dat$Population<br/>us_recent &lt;- cov19_us_dat[,begin_day:tot_days]</span></pre><p id="f470" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，这些文件中的数据是累积形式的，所以如果我们想要每天的计数，我们需要从前一天减去每天的总数。下面是一个简单的方法。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8888" class="mm lh it mi b gy mn mo l mp mq"># Convert cumulative data to new values each day<br/>us_daily &lt;- us_recent[,-1] — us_recent[,-8]<br/>us_fatal &lt;- data.frame(fips, pop, us_daily)<br/>colnames(us_fatal) &lt;- c(‘fips’, ‘population’,colnames(us_daily))</span></pre><p id="489a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，有几个数据处理步骤:</p><p id="8d6f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1.仅保存位于美国 50 个州或 DC 的县的 fips 代码。</p><p id="1afc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.处理一些实际上比前一天减少的累积计数(可能是由于数据澄清或调整)。</p><p id="daab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.将人口转换为每 10 万人的数量。</p><p id="8898" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.计算人均比率的十分位数。选择分组到 10 个箱中是一种判断，随着数据随时间的变化，可能会有更好的选择。请注意，前 5 个十分位数的县在过去 7 天内没有出现死亡病例，因此最终只有 5 组。</p><p id="3012" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">5.当读入 fips 代码时，除非您能始终如一地将它们存储为“字符”类型，否则它们可能会转换为“整数”类型并丢失前导零。str_pad 函数可以解决这个问题。</p><p id="a885" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">6.南达科塔州奥格拉拉拉科塔的 fips 代码显然发生了变化，需要手动解决，以避免在南达科他州中部的地块上出现大的白色方块。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="e943" class="mm lh it mi b gy mn mo l mp mq">us_fatal &lt;- us_fatal %&gt;%<br/>filter(fips %in% (1001:56045)) %&gt;%<br/>mutate(sum = rowSums(.[3:9]),<br/>       sum = ifelse(sum &gt; 0, sum, 0),<br/>       pop_100_000 = population/100000,<br/>       percap = sum/pop_100_000,<br/>       percap_quint = quantcut(percap, q=10, dig.lab = 3),<br/>       fips = as.character(fips),<br/>       fips = str_pad(fips, 5, 'left','0'))  <br/>  <br/># replace fips for Oglala Lakota, SD (formerly Shannon, SD)<br/>us_fatal$fips &lt;- replace(us_fatal$fips, us_fatal$fips == "46102", "46113")</span></pre><p id="56ab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">设置打印颜色的一个选项:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="d9ca" class="mm lh it mi b gy mn mo l mp mq"># Set up plot colors according to the number of levels of quintiles (many 0's)<br/>no_colors &lt;- length(unique(us_fatal$percap_quint))<br/>quin_colors &lt;- c("springgreen", "skyblue", "navy","violet","violetred")<br/>start_color &lt;- 5 - no_colors + 1<br/>plot_colors &lt;- quin_colors[start_color:5]</span></pre><p id="bc41" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，使用 ggplot()创建图形:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2b2e" class="mm lh it mi b gy mn mo l mp mq">cmap &lt;- fortify(counties_composite(), region=”fips”)</span><span id="8b2d" class="mm lh it mi b gy mr mo l mp mq">gg &lt;- ggplot()<br/>gg &lt;- gg + geom_cartogram(data=cmap, map=cmap,<br/> aes(x=long, y=lat,map_id=id),show.legend = FALSE,<br/> color=”#2b2b2b”, size=0.05, fill=NA)<br/>gg &lt;- gg + geom_cartogram(data=us_fatal, map=cmap,<br/> aes(fill=percap_quint, map_id=fips),<br/> color=”#2b2b2b”, size=0.05)<br/>gg &lt;- gg + scale_fill_manual(name=”per 100,000 pop”, values = plot_colors)<br/>gg &lt;- gg + labs(title=’Covid-19 Fatalities per capita by US County, Last 7 days’,<br/> subtitle=paste(‘Data source: Johns Hopkins Center for Systems Science and Engineering, ‘, Sys.Date(), sep=’’))<br/>gg &lt;- gg + theme_bw()<br/>gg &lt;- gg + xlab(NULL)<br/>gg &lt;- gg + ylab(NULL)<br/>gg &lt;- gg + theme(axis.ticks.x = element_blank())<br/>gg &lt;- gg + theme(axis.ticks.y = element_blank())<br/>gg &lt;- gg + theme(axis.text.x = element_blank())<br/>gg &lt;- gg + theme(axis.text.y = element_blank())<br/>gg &lt;- gg + theme(legend.position=c(0.85, 0.30))<br/>gg &lt;- gg + theme(plot.title=element_text(size=24, hjust = 0.5))<br/>gg &lt;- gg + theme(plot.subtitle=element_text(size=18, hjust = 0.5))<br/>gg &lt;- gg + theme(legend.text=element_text(size=14))<br/>gg &lt;- gg + theme(legend.title=element_text(size=18))</span><span id="b6ef" class="mm lh it mi b gy mr mo l mp mq">png(paste(“choro.png”, sep = “”), width = 1200, height = 800, units = “px”)<br/>gg</span></pre><figure class="md me mf mg gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi ms"><img src="../Images/bc2b8103215144da59d64c73d02bf534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XM0kNL0RmfT5birRypg7sQ.png"/></div></div></figure></div></div>    
</body>
</html>