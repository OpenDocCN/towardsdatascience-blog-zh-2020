<html>
<head>
<title>Predicting Hourly Energy consumption of San Diego — II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">圣地亚哥每小时能耗预测—ⅱ</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/part-2-time-series-analysis-predicting-hourly-energy-consumption-of-san-diego-ii-f09665796c9?source=collection_archive---------8-----------------------#2020-06-08">https://towardsdatascience.com/part-2-time-series-analysis-predicting-hourly-energy-consumption-of-san-diego-ii-f09665796c9?source=collection_archive---------8-----------------------#2020-06-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="83a0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">时间序列基础&amp;使用傅立叶级数处理多重季节性。使用ARIMA(X)与线性回归、随机森林、XGBoost和FBProphet+XGB进行预测。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/46801cf14afc6be6e5477700ef32fe7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u0ej0THfnD1TkWJQ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">卢卡斯·戴维斯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6761" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://medium.com/@Pratha_P/part-1-time-series-analysis-predicting-hourly-energy-consumption-of-san-diego-short-term-long-3a1dd1a589c9" rel="noopener">这篇文章的第1部分</a>讲述了能源(电力)消耗的基础知识，如何导入、重采样和合并从不同来源和EDA收集的数据集。从San Deigo的能源消耗数据以及温度和太阳能电池板安装数据中也提取了一些推论。</p><div class="ls lt gp gr lu lv"><a rel="noopener follow" target="_blank" href="/part-1-time-series-analysis-predicting-hourly-energy-consumption-of-san-diego-short-term-long-3a1dd1a589c9"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">预测圣地亚哥的每小时能源消耗(短期和长期预测)— I</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">在第1部分中，我们将介绍从不同来源导入和合并数据集、重采样、数据清理、EDA和…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">towardsdatascience.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div><p id="0c55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我将探讨一些时间序列模型，如持续预测(作为基线)，ARIMA和FB先知；然后扩展我的方法，包括线性回归、随机森林、XGBoost和一个集合模型，看看这些线性和非线性方法是否能准确地模拟我们的时间序列。</p><p id="2822" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">nbviewer上Jupyter笔记本的链接:<br/> 1。<a class="ae kv" href="https://nbviewer.jupyter.org/github/pratha19/Springboard_capstone_project_1/blob/master/SDGE_energy_EDA.ipynb#4" rel="noopener ugc nofollow" target="_blank">数据导入和EDA </a>(包含在第1部分中)<br/> 2。<a class="ae kv" href="https://nbviewer.jupyter.org/github/pratha19/Springboard_capstone_project_1/blob/master/SDGE_energy_ML.ipynb#8" rel="noopener ugc nofollow" target="_blank">构建ML模型和预测</a>(在本文中讨论)</p><p id="711d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想要一个非常详细的时间序列数据处理的解释，建模和有效地可视化时间序列数据，那么请参阅上面列出的第二个笔记本。说了这么多，我还是会尽量涵盖本帖的重要话题。</p><p id="012a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">整个项目的Github链接:<a class="ae kv" href="https://github.com/pratha19/Hourly_Energy_Consumption_Prediction" rel="noopener ugc nofollow" target="_blank">小时_能耗_预测</a>。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="8fa2" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">能耗数据</h1><p id="d836" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">以下是上一篇文章中的数据和一些新增功能:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="4f6e" class="nt ms iq np b gy nu nv l nw nx">#Import the 5 years of hourly energy consumption data previously #cleaned, explored, and stored as 'hourly1418_energy_temp_PV.csv' in # Part 1</span><span id="4c85" class="nt ms iq np b gy ny nv l nw nx">sdge = pd.read_csv('hourly1418_energy_temp_PV.csv', index_col = 'Dates', parse_dates=['Dates', 'Date'])</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/08853b655752d5e7a3c129249194e64e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SKaz0OXlls9z32yOLVWJaQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于预测的数据</p></figure><ul class=""><li id="9603" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated"><em class="oj"> SDGE:我们的目标变量，圣地亚哥的每小时能耗(MWh )(也是每小时负荷或需求)</em></li><li id="e2fa" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj">非工作日:如果当天是周末或假日，则为0(二进制)</em></li><li id="c82f" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj">每小时干球温度:在圣地亚哥机场测量的干球温度，单位为华氏度</em></li><li id="7968" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj"> cum_AC_kW:客户现场太阳能电池板的累计安装容量(直到索引栏中给出的日期),单位为kW </em></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/03b2a7925b19de282f9ed1e635dfb792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bGaWwwfLJdb7-ead.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">圣地亚哥能源消耗时间序列(y轴代表每小时的能源消耗，单位为兆瓦时)。有关交互式Plotly图和查看CAISO内所有公用设施的能耗图，请参见上面列出的EDA和ML笔记本。</p></figure><p id="226e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从前面第1部分的分析中观察到的一些情况:</p><ul class=""><li id="e53a" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated"><em class="oj"> 43824小时(行)的数据(2014-2018年5年)</em></li><li id="e57e" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj"> SDGE:最小值:1437.08，平均值:2364.92，中间值:2298.0，最大值:4867.0 </em></li><li id="18fe" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj">时间序列有多种季节模式——每天、每周和每年。</em></li><li id="8601" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj">略有下降趋势，与太阳能装机容量成反比</em></li><li id="b297" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj">能耗与温度高度相关。</em></li></ul><p id="ec3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="oj">我使用了从2014年1月1日到2018年3月31日的时间序列作为我的训练数据。并预测了2018年4月1日至12月31日的每小时能耗值(整个数据的约15%)。</em></p><h1 id="a375" class="mr ms iq bd mt mu oq mw mx my or na nb jw os jx nd jz ot ka nf kc ou kd nh ni bi translated">最终目标</h1><blockquote class="ov ow ox"><p id="ab81" class="kw kx oj ky b kz la jr lb lc ld ju le oy lg lh li oz lk ll lm pa lo lp lq lr ij bi translated">该项目的最终目标是:“电力公司可以利用开发的预测模型来有效地规划其发电运营，并通过适当的供应平衡需求。有效的预测对于电力公司规划其日常运营、满足其客户的能源需求以及避免任何过量发电非常有用。"</p></blockquote><p id="af3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="oj">基本上，我们希望将ML模型拟合到我们的每小时能源消耗时间序列中，并使用它来预测圣地亚哥未来的能源消耗。</em> </strong></p><p id="db6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">预测窗口<br/> </strong>在任何时间序列问题中，预先定义预测的窗口是非常重要的。在这里，我测试了未来1小时、1周和8个月的模型。</p><p id="1de2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">使用的误差指标<br/> </strong>我已经为训练集和测试集的每个模型计算了<em class="oj"> R2得分、MAE、RMSE和MAPE </em>。在这4个指标中，<a class="ae kv" href="https://en.wikipedia.org/wiki/Mean_absolute_percentage_error" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="oj">MAPE</em></strong></a>将被选中，选出最佳型号。MAPE帮助我们理解绝对值的%误差，并且对时间序列的绝对量级漠不关心。</p><p id="0484" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">假设<br/></strong></p><ul class=""><li id="c4f9" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated">未来的太阳能电池板安装和温度数据对我们来说很容易获得，我们不需要为它们运行单独的预测(我希望！).在现实世界中，我们需要使用这些独立变量的预测值(或者至少使用温度的平均期望值和基于过去数据的估计未来太阳能安装量)。但是为了简单起见，我在这个项目中使用了这些变量的实际观察值。</li></ul><p id="0d4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="oj">事不宜迟，让我们把精力集中在时间序列预测问题上。</em></p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="e7e8" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">那么，时间序列有什么特别之处呢</h1><p id="86c9" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">时间序列是按时间顺序进行的一系列观察。任何时间序列数据都有以下组成部分:<a class="ae kv" href="https://machinelearningmastery.com/time-series-forecasting/" rel="noopener ugc nofollow" target="_blank"> ref link </a></p><ul class=""><li id="7228" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated"><strong class="ky ir">级别:</strong>如果是直线，则为系列的基线值。</li><li id="933c" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><strong class="ky ir">趋势:</strong>系列随时间变化的可选且通常线性增加或减少的行为。</li><li id="e663" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><strong class="ky ir">季节性:</strong>行为随时间的可选重复模式或周期。</li><li id="aa7d" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><strong class="ky ir">噪声:</strong>模型无法解释的观测值的可选可变性。</li></ul><p id="4536" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大多数时间序列的另一个重要特征是，时间上接近的观测值往往是相关的(序列相关)。这种特征也被称为自相关，正如我们将在后面看到的，它构成了自回归综合移动平均(<a class="ae kv" href="https://www.machinelearningplus.com/time-series/arima-model-time-series-forecasting-python/#:~:text=ARIMA%2C%20short%20for%20'Auto%20Regressive,used%20to%20forecast%20future%20values." rel="noopener ugc nofollow" target="_blank"> ARIMA </a>)等传统时间序列建模技术的一个重要方面。</p><ul class=""><li id="364e" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated"><strong class="ky ir">平稳性:</strong>当均值、方差和自相关性随时间恒定时，时间序列是平稳的，并且没有季节性或周期性模式。在使用任何基于线性回归的模型如ARIMA(基于Y滞后值的回归)之前，使时间序列平稳是非常重要的。一个时间序列通常是平稳的，方法是将该序列与其自身进行差分。关于平稳性的两篇好文章— <a class="ae kv" href="https://machinelearningmastery.com/remove-trends-seasonality-difference-transform-python/#:~:text=Making%20Series%20Data%20Stationary&amp;text=Should%20you%20make%20your%20time,train%20models%20on%20the%20residuals." rel="noopener ugc nofollow" target="_blank"> 1 </a>、<a class="ae kv" href="https://www.analyticsvidhya.com/blog/2018/09/non-stationary-time-series-python/" rel="noopener ugc nofollow" target="_blank"> 2 </a>。</li></ul><p id="fa86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于以上所有的特点，时间序列建模涉及到的方法与常规的ML问题略有不同。<a class="ae kv" href="https://www.datascience.com/blog/time-series-forecasting-machine-learning-differences" rel="noopener ugc nofollow" target="_blank">这里的</a>是解释主要区别的一个很好的链接。</p><p id="fe7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/Yorko/mlcourse.ai/blob/master/jupyter_english/topic09_time_series/topic9_part1_time_series_python.ipynb" rel="noopener ugc nofollow" target="_blank">这里的</a>是深入研究时间序列预测建模技术的另一个好资源。</p><ul class=""><li id="3f80" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated"><strong class="ky ir">时间序列交叉验证:(</strong><a class="ae kv" href="https://github.com/Yorko/mlcourse.ai/blob/master/jupyter_english/topic09_time_series/topic9_part1_time_series_python.ipynb" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">Ref</strong></a><strong class="ky ir">)</strong><br/>时间序列的交叉验证有点不同，因为人们不能在保留时间结构的同时随机混合一个文件夹中的值。<em class="oj"> </em> <strong class="ky ir"> <em class="oj">随着随机化的进行，观测值之间的所有时间依赖关系都将丢失。这就是为什么我们必须在优化模型参数时使用更复杂的方法，例如“滚动交叉验证</em>”。这个想法相当简单——我们从开始直到某个<em class="oj"> t </em>的一小段时间序列上训练我们的模型，对下一个<em class="oj"> t+n </em>步骤进行预测，并计算误差。然后，我们将我们的训练样本扩展到<em class="oj"> t+n </em>值，从<em class="oj"> t+n </em>直到<em class="oj">t+2∫n</em>进行预测，并继续移动我们的时间序列测试段，直到我们遇到最后一个可用的观测值。这可以使用<em class="oj"> </em> <code class="fe pb pc pd np b"><em class="oj">sklearn.model_selection's</em></code> <code class="fe pb pc pd np b">TimeSeriesSplit</code>模块来建立。我们将使用这种技术来计算验证集误差。</strong></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/9157dd763c0d8f81e11ca5aac61381f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UjG2Z3jby7V0MYehF5m7dw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:<a class="ae kv" href="https://github.com/Yorko/mlcourse.ai/blob/master/jupyter_english/topic09_time_series/topic9_part1_time_series_python.ipynb" rel="noopener ugc nofollow" target="_blank"> Yorko/mlcourse.ai </a></p></figure><h1 id="6ce5" class="mr ms iq bd mt mu oq mw mx my or na nb jw os jx nd jz ot ka nf kc ou kd nh ni bi translated">比较我们的模型的基线模型</h1><ul class=""><li id="057a" class="oa ob iq ky b kz nj lc nk lf pf lj pg ln ph lr of og oh oi bi translated"><strong class="ky ir">短期提前一小时预测</strong></li></ul><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="4a4b" class="nt ms iq np b gy nu nv l nw nx"><strong class="np ir">""" Error metrics for hour ahead forecasts when simply repeating last hour's values """ </strong></span><span id="b15f" class="nt ms iq np b gy ny nv l nw nx"><strong class="np ir"><em class="oj"># </em>error_metrics(predicted_values, true_values) is a function that I <em class="oj"># </em>built to calculate the errors for a given model's predictions</strong></span><span id="d142" class="nt ms iq np b gy ny nv l nw nx">_ = error_metrics(sdge_lin.loc[X_test.index.shift(-1, freq='H'), 'SDGE'], y_test)</span><span id="6f96" class="nt ms iq np b gy ny nv l nw nx">&gt;&gt; RMSE or Root mean squared error: 122.27<br/>&gt;&gt; Variance score: 0.94<br/>&gt;&gt; Mean Absolute Error: 99.23<br/>&gt;&gt; Mean Absolute Percentage Error: 4.21 %</span></pre><ul class=""><li id="6ded" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated"><strong class="ky ir">未来约8个月的长期预测</strong></li></ul><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="4f73" class="nt ms iq np b gy nu nv l nw nx"><strong class="np ir">""" Error metrics on months ahead forecast when simply repeating last year's values """</strong></span><span id="249b" class="nt ms iq np b gy ny nv l nw nx"><strong class="np ir"><em class="oj"># the data is hourly and one year = 8760 hours</em></strong></span><span id="d812" class="nt ms iq np b gy ny nv l nw nx">_ = error_metrics(sdge_lin.loc[X_test.index.shift(-8760, freq='H'), 'SDGE'], y_test)</span><span id="9cc8" class="nt ms iq np b gy ny nv l nw nx">&gt;&gt; RMSE or Root mean squared error: 330.74<br/>&gt;&gt; Variance score: 0.55<br/>&gt;&gt; Mean Absolute Error: 224.89<br/>&gt;&gt; Mean Absolute Percentage Error: 9.23 %</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pi"><img src="../Images/a067bf943f7223cbb6921ec13f1a3741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2XLZj0YuIMRDntXEBXfiaA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">基准预测，其中能源消耗的预测值与去年相应的日、小时和月的值相同。</p></figure><p id="4415" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="oj">在能源预测领域，获得正确的每日最大需求更为重要，因为这可以决定电厂运营商是否需要启动调峰(主要是燃气)电厂。所以，也要计算误差。</em></p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="ea69" class="nt ms iq np b gy nu nv l nw nx"><em class="oj">"""</em><strong class="np ir"><em class="oj">Resampling both the y_test and predictions at a 24 hours period and using the max as the aggregate function</em></strong><em class="oj">"""</em></span><span id="a570" class="nt ms iq np b gy ny nv l nw nx">_ = error_metrics(sdge_lin.loc[X_test.index.shift(-8760, freq='H'), 'SDGE'].resample('24h').max(), y_test.resample('24h').max())</span><span id="f36f" class="nt ms iq np b gy ny nv l nw nx">&gt;&gt; RMSE or Root mean squared error: 389.37<br/>&gt;&gt; Variance score: 0.22<br/>&gt;&gt; Mean Absolute Error: 264.44<br/>&gt;&gt; Mean Absolute Percentage Error: 8.60 %</span></pre><blockquote class="pj"><p id="2832" class="pk pl iq bd pm pn po pp pq pr ps lr dk translated">“我们现在已经准备好建立预测未来的模型了。”</p></blockquote></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="a89b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="oj">注:通常用于时间序列预测的一些经典时间序列模型是自回归综合移动平均(ARIMA)、带外生回归量的季节自回归综合移动平均(SARIMAX)、带外生回归量的向量自回归移动平均(VARMAX)、简单指数平滑(SES)、霍尔特温特指数平滑(HWES)等等。你可以在</em> <a class="ae kv" href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/#:~:text=This%20cheat%20sheet%20demonstrates%2011,Autoregression%20(AR)&amp;text=Seasonal%20Autoregressive%20Integrated%20Moving%2DAverage,Average%20with%20Exogenous%20Regressors%20(SARIMAX)" rel="noopener ugc nofollow" target="_blank"> <em class="oj">这篇</em> </a> <em class="oj">中找到更多关于各款车型的细节。在本帖中，我们将只尝试SARIMAX，然后尝试传统的线性和非线性ML模型。</em></p><h1 id="5d14" class="mr ms iq bd mt mu oq mw mx my or na nb jw os jx nd jz ot ka nf kc ou kd nh ni bi translated">带滞后的简单回归模型(提前一小时预测)</h1><blockquote class="pj"><p id="de1b" class="pk pl iq bd pm pn pt pu pv pw px lr dk translated"><em class="py">那么，我们为什么还要考虑使用传统的ML回归模型进行时间序列预测呢？</em></p></blockquote><ul class=""><li id="dc8e" class="oa ob iq ky b kz pz lc qa lf qb lj qc ln qd lr of og oh oi bi translated">因为，在某些情况下，如销售预测或能源预测，<em class="oj"> y </em>变量强烈依赖于外部因素，如能源消耗情况下的<em class="oj">温度</em>。因此，与时间序列预测相比，它更像是一个回归问题，而且监督ML模型可以帮助我们在这种严重依赖外生变量的数据中找到更好的模式。</li><li id="8e65" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">像SARIMAX这样的传统时间序列模型无法处理多重季节性。它们还需要大量历史数据才能准确预测，并且在进行超参数调整时更加耗时。</li><li id="e9fa" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">传统ML回归模型用于销售预测的用例请参见<a class="ae kv" href="https://www.mdpi.com/2306-5729/4/1/15/htm" rel="noopener ugc nofollow" target="_blank">【3】</a>。</li><li id="3b98" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">此外，这篇<a class="ae kv" href="http://cs229.stanford.edu/proj2011/CarsonChenGlover-ElectricityDemandPredictionInCalifornia.pdf" rel="noopener ugc nofollow" target="_blank">【4】</a>论文证明了使用简单的基于回归的ML模型来预测电力需求是可能的，并且误差与更复杂的模型相当。</li></ul><p id="0cf8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">能源消耗值也可以预期依赖于其先前的<strong class="ky ir">滞后值</strong>，因为一个地区的能源消耗在接下来的几个小时内不应该有太大的变化，除非发生任何意外或不幸的事件。因此，我们将添加能耗的滞后值作为<em class="oj"> X </em>参数，并检查我们是否可以使用过去的值进行更好的预测(除了我们已经添加的变量)。</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="d486" class="nt ms iq np b gy nu nv l nw nx"><strong class="np ir"><em class="oj">""" Adding max 24 lags; lag1 is the value of the energy consumption in the previous hour, lag2 is the value of energy consumption</em><br/><em class="oj">2 hours before the current value and so on.</em></strong><em class="oj">"""</em><br/><br/><strong class="np ir"><em class="oj"># Creating the lag variables</em></strong></span><span id="db49" class="nt ms iq np b gy ny nv l nw nx"><strong class="np ir">for</strong> i <strong class="np ir">in</strong> range(24):<br/>    sdge1_lin['lag'+str(i+1)] = sdge1_lin['SDGE'].shift(i+1)</span><span id="8970" class="nt ms iq np b gy ny nv l nw nx"><strong class="np ir"><em class="oj">""" Since the first 24 values won't have any 24th lag, they will be NaN. So dropping the NaNs """</em></strong><br/>lag_sdge = sdge1_lin.dropna()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qe"><img src="../Images/f4f4233e78936a6e4ef94eb1a814316f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QZIS58BB9DGgDjG4zsEzUw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">请注意，我将小时划分为时间变量，将月份划分为季节，将工作日划分为非工作日或工作日。</p></figure><h2 id="ad55" class="nt ms iq bd mt qf qg dn mx qh qi dp nb lf qj qk nd lj ql qm nf ln qn qo nh qp bi translated">有滞后的弹性净回归</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qq qr l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qs"><img src="../Images/2c71175f88d12e6512f4b5a1533c2c8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JeqCs251w2FbZMcgiJw1YQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">对有滞后的数据进行拟合时，弹性网络回归模型的系数图。我们可以看到前一个小时的值有多重要。</p></figure><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="9c85" class="nt ms iq np b gy nu nv l nw nx">plot_predvstrue_reg(elastic_net_lag.predict(X_test_lag), y_test_lag)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qt"><img src="../Images/fd5970f202fc68cbeb445df1a7316013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*B8Kh6aEriOzeQhcpZb1TJQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">观察值与预测图</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qu"><img src="../Images/9e4393fd5e491538c71ad70bb23f0601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2OQ_CJGp6aucHCfmiKVhIQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用弹性网和随机森林回归分析观察到的与预测的能源需求值</p></figure><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="5777" class="nt ms iq np b gy nu nv l nw nx"><strong class="np ir">Error metrics for model Elastic net with all lags</strong><br/>&gt;&gt; RMSE or Root mean squared error: 50.75<br/>&gt;&gt; Variance score: 0.99<br/>&gt;&gt; Mean Absolute Error: 37.36<br/>&gt;&gt; Mean Absolute Percentage Error: 1.58 %</span></pre><p id="9238" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以从图表和误差中看到，与基线相比，弹性网络模型在所有误差指标上都表现得更好。</p><ul class=""><li id="7a11" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated">RMSE仅为50.75兆瓦，而基准型号为122兆瓦。</li><li id="e923" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">MAPE也从4.21%降至1.58%。</li><li id="1ef9" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">因此，这个模型表现非常好，但它有一个限制—我们只能用它来预测下一个小时的值。即它能准确预测的最大时间窗口是1小时。因此，如果这是应用情况，那么应该使用具有先前滞后值的弹性网络模型。</li></ul><h1 id="06ae" class="mr ms iq bd mt mu oq mw mx my or na nb jw os jx nd jz ot ka nf kc ou kd nh ni bi translated">长期预测:用傅立叶级数处理多重季节性</h1><ul class=""><li id="8bba" class="oa ob iq ky b kz nj lc nk lf pf lj pg ln ph lr of og oh oi bi translated">如前所述，像SARIMAX这样的传统时间序列模型无法处理多重季节性。</li><li id="c007" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">有两种有趣的时间序列预测方法，称为BATS和TBATS，能够模拟具有多个季节的时间序列，请查看<a class="ae kv" href="https://medium.com/intive-developers/forecasting-time-series-with-multiple-seasonalities-using-tbats-in-python-398a00ac0e8a" rel="noopener">链接</a>。但是，它们的计算速度很慢，而使用傅立叶级数处理多个季节性的SARIMAX模型的性能与TBATS模型一样好。</li></ul><blockquote class="ov ow ox"><p id="1b62" class="kw kx oj ky b kz la jr lb lc ld ju le oy lg lh li oz lk ll lm pa lo lp lq lr ij bi translated">这种特征转换背后的主要驱动点是，我们不能只将0，1，2，…22，23小时输入到模型中，因为我们需要让模型明白，0和23小时实际上与0小时和1小时一样接近。工作日和年份也一样。</p></blockquote><p id="36cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">添加小时、年和周周期的傅立叶循环序列</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qv"><img src="../Images/877ab4c9a5d7d6508d2003e2e0c02b00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*AJpFKbHorOYu_DSTtoCRmg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">m &amp; n可以是离散的。基于对训练集的一些试验和测试来选择m=n=5。每日-&gt; T = 24，每年-&gt; T = 365.25，每周-&gt; T= 7</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qq qr l"/></div></figure><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="b98b" class="nt ms iq np b gy nu nv l nw nx"><strong class="np ir"><em class="oj">""" as said above the k terms for each yearly, weekly and daily seasonalities could be chosen by optimizing on the AIC values..</em><br/><em class="oj">but after some research on energy consumption time series k= 5 was chosen for each seasonality """</em></strong></span><span id="c776" class="nt ms iq np b gy ny nv l nw nx">add_fourier_terms(lag_sdge, year_k= 5, week_k=5 , day_k=5)</span><span id="d47b" class="nt ms iq np b gy ny nv l nw nx"><strong class="np ir"><em class="oj"># Visualizing the new variables on week seasonality</em></strong></span><span id="61fa" class="nt ms iq np b gy ny nv l nw nx">_ = (1-lag_sdge.loc['01-01-2014':'01-09-2014', [col <strong class="np ir">for</strong> col <strong class="np ir">in</strong> lag_sdge <strong class="np ir">if</strong> col.startswith('week')]]).sum(axis = 1).plot()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qw"><img src="../Images/bc7ceccf461e59f97e290469bc7e2bd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*5b5jClKy7Zs4h3F_a420_Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd qx"> <em class="py">可视化新傅立叶变量对周的季节性。</em> </strong></p></figure><p id="12f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="oj">从上面的图中，我们可以看到离散的工作日值是如何转换成更连续的变量模式的。每小时和每年的变量也是如此。</em></p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="d8b8" class="nt ms iq np b gy nu nv l nw nx">sdgecyc.head(2)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qy"><img src="../Images/46181d59a653a3214f760c5b57d59262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m-1L7zJDCNuQvgfJ7YOQLQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将日、周和年变量作为傅立叶级数添加的数据</p></figure><h2 id="79c5" class="nt ms iq bd mt qf qg dn mx qh qi dp nb lf qj qk nd lj ql qm nf ln qn qo nh qp bi translated"><strong class="ak">上述傅立叶级数上的SARIMAX模型增加了数据集</strong></h2><ul class=""><li id="3039" class="oa ob iq ky b kz nj lc nk lf pf lj pg ln ph lr of og oh oi bi translated">用先前时间的相同序列的值计算的时间序列观测值的相关性被称为序列相关，或自相关(ACF)。它用于确定ARIMA(p，d，q)模型的移动平均(MA或q)项。</li><li id="c2c3" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">偏自相关(PACF)是时间序列中的观测值与先前时间步长的观测值之间关系的总结，其中插入的观测值之间的关系已被移除。它用于确定ARIMA(p，d，q)模型的自回归(AR或p)项。</li><li id="197e" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">ARIMA(p，d，q)中的d是使时间序列平稳所需的差分次数。</li><li id="839c" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">SARIMAX是ARIMA的扩展，用于处理季节性项(S)和外生变量(X)。SARIMAX模型的基本架构由SARIMAX(p，D，q)x(P，D，Q，s)给出，其中P，D，Q如上文所定义，而(P，D，Q，s)分别是AR参数、差异、MA参数和周期的模型的季节性组件。s是一个整数，表示周期(季节中的周期数)，对于季度数据，通常为4；对于月度数据，通常为12。默认情况下没有季节性影响。</li></ul><p id="5cc0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="oj">SARIMAX模型接受许多输入，需要进行一些调整才能选择最佳的模型参数。</em> <code class="fe pb pc pd np b"><em class="oj">pmdarima</em></code> <em class="oj"> package的</em> <code class="fe pb pc pd np b"><em class="oj">auto_arima</em></code> <em class="oj">模块自动完成这项任务，并通过接受一些输入范围给我们提供最佳模型，类似于gridsearchcv。</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qq qr l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qz"><img src="../Images/5d7abe2fc2291c84678741f9609a3092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aJxTrzoJGlvCKso6ebpWrA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们可以从分位数和直方图中看出拟合度很好，但不是很好。右下角的图，也称为ACF图，显示残差不自相关。任何自相关都意味着在模型中没有解释的残差中存在某种模式。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ra"><img src="../Images/b49c2621b95b5ad2f3134582e0f9e615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2zSUEvJQ66pyogAAhqCLgQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">测试集上的SARIMAX预测仅显示到第一周，因为该模型无法很好地预测此后的情况。</p></figure><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="fa90" class="nt ms iq np b gy nu nv l nw nx"><strong class="np ir">Error metrics for model SARIMAX(2,1,1)x(1,0,1,24) with Fourier terms 1 week ahead forecast on test set</strong><br/>RMSE or Root mean squared error: 150.46<br/>Variance score: 0.68<br/>Mean Absolute Error: 103.46<br/>Mean Absolute Percentage Error: 5.33 %</span></pre><ul class=""><li id="66b9" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated">我们看到，第一周的预测非常好，但即使在第一周结束时，预测性能也会下降，置信区间值会变得更大，超出能耗值的范围。因此，SARIMAX模型无法捕捉长期趋势，但在1周预测中表现良好。</li><li id="e115" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">前面没有使用(dynamic=True)为SARIMAX模型计算1小时提前预测的误差，因为我们使用滞后变量对1小时提前预测使用弹性网络回归得到了极好的结果，并且它比SARIMAX拟合速度快得多。</li></ul><h1 id="9d6a" class="mr ms iq bd mt mu oq mw mx my or na nb jw os jx nd jz ot ka nf kc ou kd nh ni bi translated">FB先知</h1><p id="a458" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">让我们尝试使用FBProphet解决我们的问题。FBProphet提供了一个分解回归模型，它是可扩展的，并且可以用可解释的参数进行配置。Prophet将预测问题框定为曲线拟合练习，而不是明确地查看时间序列内每个观察值的基于时间的相关性。与SARIMAX类似，我们也可以向模型中添加额外的回归项，如温度数据。(参考<a class="ae kv" href="https://www.digitalocean.com/community/tutorials/a-guide-to-time-series-forecasting-with-prophet-in-python-3" rel="noopener ugc nofollow" target="_blank">链接1 </a>、<a class="ae kv" href="https://dius.com.au/2018/09/04/time-series-forecasting-with-fbprophet/" rel="noopener ugc nofollow" target="_blank">链接2 </a>、<a class="ae kv" rel="noopener" target="_blank" href="/forecasting-with-prophet-d50bbfe95f91">链接3 </a>)</p><p id="044a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其核心是，Prophet是一个附加模型，包含以下组件:</p><blockquote class="pj"><p id="2dab" class="pk pl iq bd pm pn pt pu pv pw px lr dk translated">y(t)=g(t)+s(t)+h(t)+ϵₜy(t)=g(t)+s(t)+h(t)+ϵₜ</p></blockquote><p id="06b2" class="pw-post-body-paragraph kw kx iq ky b kz pz jr lb lc qa ju le lf rb lh li lj rc ll lm ln rd lp lq lr ij bi translated"><strong class="ky ir"><em class="oj">【g(t)</em></strong>模型趋势<br/> <strong class="ky ir"> s(t) </strong>模型季节性与傅立叶级数<br/> <strong class="ky ir"> h(t) </strong>模型节假日或大型活动的影响<br/> <strong class="ky ir"> ϵₜ </strong>代表不可约的误差项</p><ul class=""><li id="c3f7" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated"><em class="oj">在使用Prophet时，仅使用“SDGE”、“HourlyDryBulbTemperature”、“累计_AC_kW”、“非工作_工作”列，因为</em> <strong class="ky ir"> <em class="oj"> Prophet与SARIMAX不同，可以很好地处理多个季节。</em> </strong> <em class="oj">所以，我们不需要在傅立叶项中单独传递。</em></li><li id="65fa" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj"> FB Prophet可以通过假日功能传递，但是由于我们已经在‘non _ working _ working’列中捕获了假日和周末，所以我们不会将单独的假日列表传递给Prophet。</em></li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qq qr l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi re"><img src="../Images/92337de81f8a963984d7f8840abf1300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vOKUgsDX9rBZqcPd8H1bNQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">FB Prophet对训练集和测试集的预测</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi rf"><img src="../Images/f2a286be46886143d7f272dc09d7a865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*xtV0CJjF0V0Q0_J55HopKA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们数据的FB Prophet分解模型。它似乎很好地模拟了我们数据的多重季节性——每天、每周和每年。在最底部的图中，额外的回归变量附加项包括温度、non_working_working和cum_AC_kW变量。我们以波动的形式看到温度和工作日的影响，而累计AC kW的总体影响是能源的下降趋势(正如预期的那样，因为客户站点安装的光伏越多，对电网的需求就越低)。如果我们将这一趋势与第一行图的整体趋势相结合，那么整体趋势会下降。</p></figure><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="6e56" class="nt ms iq np b gy nu nv l nw nx"><strong class="np ir">Error metrics for FB Prophet w/ auto seasonality 1 week ahead</strong><br/>RMSE or Root mean squared error: 203.21<br/>Variance score: 0.76<br/>Mean Absolute Error: 164.76<br/>Mean Absolute Percentage Error: 7.66 %</span><span id="1f4a" class="nt ms iq np b gy ny nv l nw nx"><strong class="np ir">Error metrics for FB Prophet w/ auto seasonality 8 months ahead</strong><br/>RMSE or Root mean squared error: 262.74<br/>Variance score: 0.72<br/>Mean Absolute Error: 201.06<br/>Mean Absolute Percentage Error: 8.55 %</span></pre><p id="84a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="oj">因此，尽管该模型的误差高于其他模型，但无论是一周预测还是数月预测，看起来FB Prophet已经很好地捕捉到了我们数据的多重季节性和趋势。</em> </strong></p><h1 id="4559" class="mr ms iq bd mt mu oq mw mx my or na nb jw os jx nd jz ot ka nf kc ou kd nh ni bi translated">使用傅立叶项的回归模型(长期预测)</h1><h2 id="2354" class="nt ms iq bd mt qf qg dn mx qh qi dp nb lf qj qk nd lj ql qm nf ln qn qo nh qp bi translated"><strong class="ak">随机森林和弹性净回归(长期预测)</strong></h2><p id="ebb7" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">这里我只提一下随机森林的错误。弹性净回归在长期预测中表现不佳。</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="524a" class="nt ms iq np b gy nu nv l nw nx"><strong class="np ir">Error metrics for Tuned Random forest with fourier terms</strong><br/>RMSE or Root mean squared error: 196.99<br/>Variance score: 0.84<br/>Mean Absolute Error: 137.41<br/>Mean Absolute Percentage Error: 5.73 %</span></pre><ul class=""><li id="1ce3" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated"><em class="oj">添加傅立叶项后，随机森林表现良好。它很好地捕捉了多重季节性，并且给出了仅5.76%的MAPE，而基线MAPE为9.23%。</em></li><li id="e46b" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj">弹性网络回归没有随机森林那样捕捉到更高的能耗值。</em></li><li id="5e1c" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj"> Random forest更好的性能为在数据上尝试基于树的XGBoost模型铺平了道路。</em></li></ul><h2 id="0a58" class="nt ms iq bd mt qf qg dn mx qh qi dp nb lf qj qk nd lj ql qm nf ln qn qo nh qp bi translated"><strong class="ak">带傅立叶项的XGBoost(长期预测)</strong></h2><ul class=""><li id="03de" class="oa ob iq ky b kz nj lc nk lf pf lj pg ln ph lr of og oh oi bi translated">XGBoost(极限梯度增强)属于增强算法家族，其核心使用梯度增强(GBM)框架。它是一个优化的分布式梯度增强库。</li><li id="4d46" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">众所周知，XGBoost提供了比其他机器学习算法更好的解决方案。它通常不用于时间序列，特别是如果使用的基础是树木，因为很难捕捉树木的趋势，但由于我们的数据没有非常显著的趋势，而且由于它具有多个季节性(使用傅立叶级数建模)并显著依赖于外部变量，我们可以尝试XGboost，看看它在能源消耗的时间序列数据上的表现如何。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qq qr l"/></div></figure><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="2279" class="nt ms iq np b gy nu nv l nw nx"><strong class="np ir">Error metrics for Tuned XGBoost with Fourier terms</strong><br/>RMSE or Root mean squared error: 172.21<br/>Variance score: 0.88<br/>Mean Absolute Error: 121.19<br/>Mean Absolute Percentage Error: 5.08 %</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi rg"><img src="../Images/c08f02f94dc565f0debcdc1984e5396b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uCWvVnF-ZeP2pqM_-V5XTA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">XGBoost预测值和真实观察值一起绘制</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi rh"><img src="../Images/ece6fb923ad5cc7aa63dd8685143f2b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*DZYODnnhj19a770tfCKczA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">XGBoost预测值与真实观察值</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ri"><img src="../Images/b8c246017e8577e786983970fab849d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMIp_6uHpPfjlUZ5g65N0A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">XG增强参数重要性。正如所料，温度是最重要的预测因素。</p></figure><ul class=""><li id="019f" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated">整个模型在大约2分钟内被调整和适应。</li><li id="3d2d" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><strong class="ky ir"> <em class="oj">它似乎已经很好地学习了数据模式和多个季节。与9.23 %的基线相比，约8个月的预测误差仅为5.08%。此外，与基线的55%相比，R2拟合度为88%。</em>T11】</strong></li></ul><h1 id="58bb" class="mr ms iq bd mt mu oq mw mx my or na nb jw os jx nd jz ot ka nf kc ou kd nh ni bi translated">集合模型(XGBoost + FB Prophet趋势，长期预测)</h1><blockquote class="pj"><p id="2cf2" class="pk pl iq bd pm pn pt pu pv pw px lr dk translated"><em class="py">为什么要考虑这个？</em></p></blockquote><ul class=""><li id="df77" class="oa ob iq ky b kz pz lc qa lf qb lj qc ln qd lr of og oh oi bi translated">如前所述，要对时间序列数据建模，它需要是静态的。因此，理想的情况是取消数据趋势，然后将其输入ML模型，然后将趋势添加到预测结果中。尽管如此，由于2014年至2018年的能源消耗数据具有非常弱的趋势，并且傅立叶项很好地处理了多个季节性，因此在没有消除趋势的情况下获得了上述良好结果。</li><li id="604f" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">或者，可以使用FB Prophet对总体数据趋势以及<em class="oj"> cum_AC_kW </em>的影响(即迄今为止的累计光伏安装量)进行建模，然后与XGBoost的预测进行合并。任何像XGBoost这样的基于树的回归模型都不能轻松地处理像<em class="oj"> cum_AC_kW </em>这样的<em class="oj"> X </em>变量，因为它是一个不断增长的变量，并且测试数据总是具有模型在训练集中看不到的更高的量值。</li><li id="b985" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">我已经从<em class="oj"> FB Prophet </em>模型中提取了趋势和<em class="oj"> cum_AC_kW </em>对能源的影响，并从我们的主数据框架中减去了这两个分量和所有傅立叶项。然后，这种消除趋势的能耗数据被传递到<em class="oj"> XGBoost </em>模型，并将<em class="oj"> XGBoost </em>预测结果添加回总趋势，以获得最终预测。</li></ul><p id="a76e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是来自我们之前训练的FBProphet模型的cum_AC_kw的趋势和效果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi rj"><img src="../Images/15cfbe139f7514e51a4b6b9d9acd38f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*rOSzvB79r0Oo3wXmqUH-PQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自FBProphet的趋势信息</p></figure><p id="a3fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将采用以下架构来创建我们的新模型:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi rk"><img src="../Images/68b0156c5eab132d79ffaaa8aae26789.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KSeKvFc2tp6lsvmrKem4Qw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">XgBoost + FBProphet趋势</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qq qr l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi rl"><img src="../Images/7157826b8b36033bc89c511eaaf766de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8_F1-ET6T0KjCRK0iZ1msQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">XGBoost + FBProphet预测值与实际值的比较</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi rm"><img src="../Images/9cd3f39ec9426e7d50cb10dedfdf6222.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gNhRdgn7rx_N3C9eaCbOKg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">XGBoost + FBProphet预测值与实际值的比较</p></figure><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="8ef4" class="nt ms iq np b gy nu nv l nw nx"><strong class="np ir">Error metrics for XGBoost with detrend Prophet, Fourier terms</strong><br/>RMSE or Root mean squared error: 212.97<br/>Variance score: 0.81<br/>Mean Absolute Error: 170.77<br/>Mean Absolute Percentage Error: 7.30 %</span></pre><ul class=""><li id="8ebf" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated"><em class="oj">由于FB Prophet高估了趋势和cum_AC_kW对能耗的影响，特别是在时间尺度的末尾，组合模型的表现比单独的XGBoost差，从上面forecast . trend+forecast . cum _ AC _ kW的图中可以看出，该图显示了末尾的突然下降。这似乎会导致能源消耗预测不足，并影响总体结果。但是，与基线相比，该模型的表现仍然很好，由于上面讨论的原因，就稳定性而言，该模型是比单独使用XGboost更好的时间序列模型。</em></li></ul><h1 id="8d0e" class="mr ms iq bd mt mu oq mw mx my or na nb jw os jx nd jz ot ka nf kc ou kd nh ni bi translated">结论</h1><ul class=""><li id="74f6" class="oa ob iq ky b kz nj lc nk lf pf lj pg ln ph lr of og oh oi bi translated">尝试了不同的模型来预测加利福尼亚州圣地亚哥煤气和电力(SDGE)公用事业区每小时的能源需求，以兆瓦为单位。</li><li id="a5b6" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">能源消耗高度依赖于外部温度，并具有强烈的多重季节性——每天、每周和每年。该地区越来越多的PV(光伏)装置(<em class="oj"> cum_AC_kW </em>)似乎带来了能源消耗的下降趋势，因为客户设施中更多的可再生能源意味着电力公司的负荷减少。请注意，可能有其他因素导致这种下降趋势，如客户设施中的储能装置、家用和商用设备的电力效率提高、人们越来越意识到它们的使用(道德上或通过公用事业激励)等。</li><li id="5ebb" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">捕捉趋势的最佳方式是让模型在很长一段时间内学习趋势，这是上述所有因素的组合，也许更多。季节性是预测一个地区能源消耗的重要组成部分，因此正确预测这一部分对于提高模型的性能也至关重要(这是通过使用傅立叶级数实现的)。</li><li id="a4df" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">测试集上提前一小时预测的误差项</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi rn"><img src="../Images/c9371d5ae6b16190e3c080a36fde1bd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hoZy9NDFHB1RrXS2xMWn3A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">测试集上的误差项短期提前一小时预测</p></figure><ul class=""><li id="e9d2" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated">测试集上未来几个月预测的误差项</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ro"><img src="../Images/7aa480fc32624fde98d929d7b06085d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RkkUD44re6-Az5xEYQFdvA.png"/></div></div></figure><ul class=""><li id="ed9a" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated">具有傅立叶项的XGBoost模型表现非常好，预测了未来8个月的预测窗口。对于具有多个季节性的每小时数据，这是一个相当令人印象深刻的结果。</li><li id="1d72" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">对于长期预测，大多数模型的表现优于基线持续性模型，最佳模型(<em class="oj"> XGBoost </em>)给出了5.08%的MAPE，而测试集的基线误差为9.23%。RMSE、R2和MAE值也大大低于基线模型。例如，RMSE与基线模型的差异几乎是160 MW，这是非常显著的。为了帮助人们更好地理解这一点，燃气联合循环电厂的平均规模是<a class="ae kv" href="https://www.eia.gov/todayinenergy/detail.php?id=38312#:~:text=Since%202014%2C%20the%20average%20size,of%20820%20MW%20in%202017." rel="noopener ugc nofollow" target="_blank">500兆瓦</a>。</li><li id="28bc" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated">FB Prophet在识别数据的趋势和多重季节性方面做得非常好。它可以与XGBoost配合使用，从而获得更可靠的长期预测。</li></ul><p id="8b8d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">谢谢！如果您有任何问题或想要提出任何改进或更正的建议，请随时联系我。</strong></p><p id="e6d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">节约能源，拯救地球。</p></div></div>    
</body>
</html>