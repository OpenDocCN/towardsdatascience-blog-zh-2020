<html>
<head>
<title>Data Cleaning and Preprocessing — Modelling Subscription for Bank Deposits</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据清理和预处理—为银行存款的订阅建模</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-cleaning-and-preprocessing-modelling-subscription-for-bank-deposits-e810bd1ab5da?source=collection_archive---------21-----------------------#2020-08-29">https://towardsdatascience.com/data-cleaning-and-preprocessing-modelling-subscription-for-bank-deposits-e810bd1ab5da?source=collection_archive---------21-----------------------#2020-08-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f239" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索数据以获得洞察力</h2></div><p id="c237" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对数据的探索一直让我着迷。可以隐藏在原始数据中的见解和信息令人振奋地发现和交流。在这篇文章中，我选择探索来自 UCI 机器学习知识库的银行营销数据，以揭示暗示客户是否会订阅定期存款的见解。所以，是的！你猜对了！这是一个分类问题。数据已经被清理了，至少在某种程度上，没有丢失值，所以不需要太多的数据清理，因此我的重点将放在探索性数据分析(EDA)上。</p><p id="10db" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在下面概述了我计划遵循的步骤:</p><p id="27ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1.电子设计自动化(Electronic Design Automation)</p><p id="442e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">a.单变量分析</p><p id="b933" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">b.双变量分析</p><p id="c1b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">c.洞察力探索</p><p id="29e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.预处理</p><p id="fa59" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">a.数据转换</p><p id="1c8c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">b.特征工程</p><p id="b555" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.系统模型化</p><p id="f689" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">a.模型开发</p><p id="6a54" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">b.模型评估</p><p id="5bfd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">c.模型比较</p><h2 id="37a1" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">步骤 1:探索性数据分析(EDA)</h2><p id="b88a" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">数据来源于<a class="ae mc" href="https://archive.ics.uci.edu/ml/datasets.php" rel="noopener ugc nofollow" target="_blank"> UCI 机器学习库</a>。该数据代表一家葡萄牙银行机构营销活动(电话)的结果，包括 41188 个观察(行)和 21 个特征(列)，其中包括客户的年龄、工作、教育等数据。、经济和社会属性，如就业变化率、雇员人数等。因变量(目标)用“y”表示，它表示营销活动的结果，无论被调查者订购押金是“是”还是“否”。功能的详细描述可以在<a class="ae mc" href="https://archive.ics.uci.edu/ml/datasets/Bank%2BMarketing" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><p id="1677" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们从探索开始——首先加载所有将要使用的库</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8f02" class="le lf it mi b gy mm mn l mo mp"># Ignore warnings</span><span id="1ff7" class="le lf it mi b gy mq mn l mo mp">import warnings</span><span id="1a32" class="le lf it mi b gy mq mn l mo mp">warnings.filterwarnings('ignore')</span><span id="bae3" class="le lf it mi b gy mq mn l mo mp"># Handle table-like data and matrices</span><span id="ed6c" class="le lf it mi b gy mq mn l mo mp">import numpy as np</span><span id="b56d" class="le lf it mi b gy mq mn l mo mp">import pandas as pd</span><span id="3a19" class="le lf it mi b gy mq mn l mo mp"># Modelling Algorithms</span><span id="2100" class="le lf it mi b gy mq mn l mo mp">from sklearn.tree import DecisionTreeClassifier</span><span id="aa1f" class="le lf it mi b gy mq mn l mo mp">from sklearn.svm import SVC</span><span id="6d3d" class="le lf it mi b gy mq mn l mo mp">from sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier</span><span id="dc78" class="le lf it mi b gy mq mn l mo mp">from sklearn.neural_network import MLPClassifier</span><span id="921a" class="le lf it mi b gy mq mn l mo mp">from xgboost import XGBClassifier</span><span id="aeb5" class="le lf it mi b gy mq mn l mo mp">from sklearn.metrics import accuracy_score, confusion_matrix, classification_report</span><span id="d7c1" class="le lf it mi b gy mq mn l mo mp"># Modelling Helpers</span><span id="ae6d" class="le lf it mi b gy mq mn l mo mp">from sklearn.preprocessing import StandardScaler</span><span id="37d1" class="le lf it mi b gy mq mn l mo mp">from sklearn.model_selection import train_test_split</span><span id="ba50" class="le lf it mi b gy mq mn l mo mp"># Visualisation</span><span id="43a4" class="le lf it mi b gy mq mn l mo mp">import matplotlib as mpl</span><span id="efb6" class="le lf it mi b gy mq mn l mo mp">import matplotlib.pyplot as plt</span><span id="e0b1" class="le lf it mi b gy mq mn l mo mp">import matplotlib.pylab as pylab</span><span id="48b2" class="le lf it mi b gy mq mn l mo mp">import seaborn as sns</span><span id="7a6c" class="le lf it mi b gy mq mn l mo mp"># read in the data</span><span id="f30d" class="le lf it mi b gy mq mn l mo mp">df = pd.read_csv('data/bank-additional-full.csv', sep=';')</span><span id="72f2" class="le lf it mi b gy mq mn l mo mp">df.head()</span></pre><p id="c60a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看看使用 pandas 库中的 describe 方法对数据的描述。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="defb" class="le lf it mi b gy mm mn l mo mp">data.select_dtypes(include=[“int64”, “float64”]).describe().T</span></pre><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/e258bb7675b21a53095d8a45c9d1f3db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*BjiW0Kn12Ah6iTVnEjzZ2g.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">数据描述</p></figure><p id="716d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从数据中，我们可以观察到平均年龄为 40 岁，最大年龄为 98 岁，最小年龄为 17 岁。余额是以欧元表示的年平均余额。试着理解剩下的数据描述。在试图理解数据的同时，您可以尝试回答以下问题:</p><h2 id="1490" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">单变量分析</h2><p id="0310" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">为了使这一步和下一步更容易和可重复，我创建了一个类来可视化数据。这个类有不同的功能来使探索和洞察力的交流变得容易。下面是我是如何做到的:</p><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/3ceda90ccdf9974eac724f7ab5e0c233.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*1PvT1wv8-mxzMalq52Pvvw.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">目标分布</p></figure><p id="828c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">似乎有更多的客户没有申请定期存款。这当然是一个不平衡的阶级问题。</p><p id="3be1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1.这个类不平衡的问题如何影响你的模型性能？</p><p id="c77c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.哪些数据技术方法可能有用？</p><p id="8590" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">注意:</strong>关于如何处理这些问题的更多细节将在转换步骤中提供。</p><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi na"><img src="../Images/9b88d41931ece7ffda9e3f53b48dd648.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*e8DVM4DZONzUiu_JW4IEzg.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">婚姻状况分布</p></figure><p id="19d1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">生成了更多的可视化效果，以了解数据集中每个要素的分布情况。</p><h2 id="b82e" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">双变量分析</h2><p id="6529" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">比较一个特征相对于另一个特征的分布对于分类任务，目标是主要特征，而另一个特征可以被选择来观察它们的关系</p><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/316372abd34527f4a1083de2f7e03bf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*xSk-r6RVm2rPiLK7JWIoHA.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">按目标分列的婚姻状况分布 y</p></figure><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/5cc9899c1d23ea71245aaa148c014b1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*LsQ4Gh9iM6Iz2EexG9a0dA.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">按目标分列的教育分布 y</p></figure><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/86200022be1750641d049f03f7a22450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*kEL3gwl2lAtleMgYDo6FOA.png"/></div></figure><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/c78a9b0c04701da8323e5a70c8673724.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*Fcj0fBuC12jUITDY9fbbnA.png"/></div></figure><h2 id="6994" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">洞察力探索</h2><p id="91ec" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">根据上述单变量和双变量分析的结果，可以推断:</p><p id="0838" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1.在一列中有一些类似的值，如婚姻状况和 basic.4y、basic.6y 和 basic.9y 的离婚和单身类别，它们可以替换为 basic，因为它们都指同一事物。</p><p id="d4ce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.婚姻状况的分布在已婚和单身(单身+离异)之间相对均衡</p><p id="e9ed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.近似的 90%的目标对定期订阅说不，留给我们的任务是为一个好的模型平衡数据</p><p id="206b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.大多数受访者没有个人贷款。</p><p id="1b50" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">5.大多数回答者都有大学学位</p><p id="c0b2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">6.电话在周末没有接通，一周中每天记录的电话数量相对相等</p><p id="76d5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">7.近似的 65%的受访者是通过手机联系的</p><p id="96c5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">8.大多数电话发生在 5 月。前几次竞选活动在夏季的不均衡可能会影响未来竞选活动的结果。</p><h2 id="1a78" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">步骤 2:预处理(数据转换)</h2><p id="b97f" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">为了准备建模数据，我们将执行以下操作:</p><p id="6a7d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1.复制原始数据，以便所有转换都在重复数据上完成</p><p id="734f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.指定目标列并从数据中删除</p><p id="8284" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.将一些相似的特征映射到一个中以进行适当的编码</p><p id="7020" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.使用 One Hot 编码技术将对象数据类型列转换为整数</p><p id="022d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">5.使用健壮的 scaler 算法缩放数据:之所以选择这个算法，是因为它不太容易受到离群值的影响。</p><p id="6979" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">6.修正不平衡部分的数据更多信息<a class="ae mc" href="https://machinelearningmastery.com/smote-oversampling-for-imbalanced-classification/" rel="noopener ugc nofollow" target="_blank">此处</a></p><p id="034c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">7.使用主成分分析进行降维</p><p id="d0f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">8.将目标列添加回数据中</p><p id="a03e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">9.返回转换后的数据框</p><p id="451b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了使这些步骤更容易，我使用了一个类，其中所有的步骤都相应地实现了。下面是一个截图，展示了如何做到这一点</p><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/9816f01437c8a9d0b4bab6fc7a377c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*-ZM2uJfKzzzwe5ilgqiPGA.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">数据转换代码</p></figure><p id="eaec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每一步都有一个功能，使其更具可重复性。将列的相似类别映射在一起，以进一步提高预测模型的性能；使用 imblearn smote 模块对少数类(在我们的案例中是对定期存款订阅说“是”的回答者的数量)进行过采样，从而处理一个热编码数据不平衡；然后进行降维，以降低由一位热编码技术引起的数据复杂性。</p><h2 id="c292" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">特征工程</h2><p id="04ed" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">这是向数据集中现有要素添加更多要素的过程。这可以通过特征转换和/或特征聚合来完成。下面显示了一个示例</p><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/523650577636db4fdacbea4d0de28bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*wqz3Qxaz8nDhMwg8jE_MEA.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">特征工程</p></figure><p id="0e05" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在一线时代，一个数字特征被转换成包括年轻人、中年人和老年人的类别。年龄也通过一些分类列(如婚姻)进行汇总，并使用平均值进行转换，以获得每个平均年龄的教育额外特征。</p><h2 id="24ee" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">第三步:建模</h2><p id="0a18" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">模型开发</p><p id="74d2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个阶段，建立了机器学习模型。预测分类变量“y”的最简单和最易解释的模型是逻辑回归。因此，它被用作有待改进的基准模型。在拟合模型时，使用了分层的 5 折交叉验证，因为它对每个折进行采样，使得每个折都是整个数据的良好代表。StratifiedKFold 将数据打乱并分割一次，因此测试集不会重叠，这是执行交叉验证的好方法。</p><p id="260d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">实施逻辑回归模型</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8903" class="le lf it mi b gy mm mn l mo mp">################ LOGISTIC REGRSSION #########################</span><span id="ac0c" class="le lf it mi b gy mq mn l mo mp">def run_logistic_regression(self, X_train, X_val, Y_train, Y_val):</span><span id="6ccb" class="le lf it mi b gy mq mn l mo mp">model_name = '26-08-2020-20-32-31-00-log-reg.pkl'</span><span id="84e1" class="le lf it mi b gy mq mn l mo mp"># initialze the kfold</span><span id="8c3c" class="le lf it mi b gy mq mn l mo mp">kfold, scores = KFold(n_splits=5, shuffle=True, random_state=221), list()</span><span id="290f" class="le lf it mi b gy mq mn l mo mp"># split data index to train and test</span><span id="eefe" class="le lf it mi b gy mq mn l mo mp">for train, test in kfold.split(X_train):</span><span id="ed94" class="le lf it mi b gy mq mn l mo mp"># specify train and test sets</span><span id="0314" class="le lf it mi b gy mq mn l mo mp">x_train, x_test = X_train[train], X_train[test]</span><span id="0580" class="le lf it mi b gy mq mn l mo mp">y_train, y_test = Y_train[train], Y_train[test]</span><span id="4994" class="le lf it mi b gy mq mn l mo mp"># initialize the model</span><span id="510c" class="le lf it mi b gy mq mn l mo mp">model = LogisticRegression(random_state=27,  solver='lbfgs')</span><span id="92cd" class="le lf it mi b gy mq mn l mo mp"># train</span><span id="d5eb" class="le lf it mi b gy mq mn l mo mp">model.fit(x_train, y_train)</span><span id="1335" class="le lf it mi b gy mq mn l mo mp"># predict for evaluation</span><span id="e5a9" class="le lf it mi b gy mq mn l mo mp">preds = model.predict(x_test)</span><span id="35cb" class="le lf it mi b gy mq mn l mo mp"># compute f1-score</span><span id="bdbf" class="le lf it mi b gy mq mn l mo mp">score = f1_score(y_test, preds)</span><span id="c26c" class="le lf it mi b gy mq mn l mo mp">scores.append(score)</span><span id="e568" class="le lf it mi b gy mq mn l mo mp">test_pred = model.predict(X_val)</span><span id="eb76" class="le lf it mi b gy mq mn l mo mp">print('f1-score: ',score)</span><span id="4298" class="le lf it mi b gy mq mn l mo mp">print("Average: ", sum(scores)/len(scores))</span></pre><p id="6c6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">建立的其他模型包括 XGBoost、多层感知器、支持向量机、随机森林。</p><figure class="md me mf mg gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/5b5d6084ecfdf65c1b00a1cc18213769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*syL5awqg_azOjSAf8JnzxQ.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated">实现 xgboost 模型</p></figure><p id="04cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">选择这些模型是因为它们在检测数据中的隐藏模式和非线性相关性/关系方面的复杂方法。</p><h2 id="54cf" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">模型评估</h2><p id="6f7b" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">用于该数据的评估指标是 recall_score、f1_score 和受试者操作特征(ROC)曲线。他们被选中是因为:</p><p id="b04c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1.数据高度不平衡，偏向公司的负面，即亏损，因此 f1_score 将有助于检测敏感性和特异性之间的调和平均值。</p><p id="2d95" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.在这里，较高的召回分数比较高的精确度更好，因为召回分数 aka(敏感度)是在所有相关实例中检索到的实例的分数。在我们的情况下，识别将订阅定期存款的客户比识别可能订阅或可能不订阅的客户更重要。</p><p id="3881" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.ROC 曲线有助于解释每个模型如何很好地解释数据中的方差。越接近 1 越好，并且应该高于 0.5，这比随机猜测要好。</p><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/55206fc7831aa15e17359f6ef34eb153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*-5QHRrAdIfeHIW4rPOugUg.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">模型评估</p></figure><p id="f1ae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">评估模型的代码</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="649c" class="le lf it mi b gy mm mn l mo mp">def eval_model(self, target_test_data, prediction):</span><span id="9c83" class="le lf it mi b gy mq mn l mo mp">from sklearn.metrics import accuracy_score,confusion_matrix,recall_score, f1_score, precision_score</span><span id="8853" class="le lf it mi b gy mq mn l mo mp">from sklearn.metrics import classification_report</span><span id="b356" class="le lf it mi b gy mq mn l mo mp">confusion_matrix = confusion_matrix(target_test_data, prediction)</span><span id="b655" class="le lf it mi b gy mq mn l mo mp">print('Accuracy Score: ', accuracy_score(target_test_data, prediction))</span><span id="570a" class="le lf it mi b gy mq mn l mo mp">print('F1-Score: ', f1_score(target_test_data, prediction))</span><span id="00a7" class="le lf it mi b gy mq mn l mo mp">print('Recall: ', recall_score(target_test_data, prediction))</span><span id="e155" class="le lf it mi b gy mq mn l mo mp">print('Precision: ', precision_score(target_test_data, prediction))</span><span id="508f" class="le lf it mi b gy mq mn l mo mp">print(confusion_matrix)</span><span id="bde8" class="le lf it mi b gy mq mn l mo mp">print(classification_report(target_test_data, prediction))</span><span id="27b4" class="le lf it mi b gy mq mn l mo mp">def plot_auc_curve(self, model, model_name, test_data, target_test_data):</span><span id="e087" class="le lf it mi b gy mq mn l mo mp">from sklearn.metrics import roc_auc_score</span><span id="467f" class="le lf it mi b gy mq mn l mo mp">from sklearn.metrics import roc_curve</span><span id="4fef" class="le lf it mi b gy mq mn l mo mp">logit_roc_auc = roc_auc_score(target_test_data, model.predict(test_data))</span><span id="c854" class="le lf it mi b gy mq mn l mo mp">fpr, tpr, thresholds = roc_curve(target_test_data, model.predict_proba(test_data)[:,1])</span><span id="d186" class="le lf it mi b gy mq mn l mo mp">plt.figure()</span><span id="64e9" class="le lf it mi b gy mq mn l mo mp">plt.plot(fpr, tpr, label=f'{model_name} (area under curve = %0.2f)' % logit_roc_auc)</span><span id="33a1" class="le lf it mi b gy mq mn l mo mp">plt.plot([0, 1], [0, 1],'r--')</span><span id="bb5d" class="le lf it mi b gy mq mn l mo mp">plt.xlim([0.0, 1.0])</span><span id="ef3f" class="le lf it mi b gy mq mn l mo mp">plt.ylim([0.0, 1.05])</span><span id="28aa" class="le lf it mi b gy mq mn l mo mp">plt.xlabel('False Positive Rate')</span><span id="2250" class="le lf it mi b gy mq mn l mo mp">plt.ylabel('True Positive Rate')</span><span id="155f" class="le lf it mi b gy mq mn l mo mp">plt.title(f'Receiver operating characteristic ({model_name})')</span><span id="3cb5" class="le lf it mi b gy mq mn l mo mp">plt.legend(loc="lower right")</span><span id="b989" class="le lf it mi b gy mq mn l mo mp">plt.savefig(f'{model_name}_ROC')</span><span id="b139" class="le lf it mi b gy mq mn l mo mp">plt.show()</span></pre><p id="59ae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">评估模型</p><p id="b489" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">准确度分数:0.84676465465</p><p id="838e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">f1-得分:0.41941391337</p><p id="c5bb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">召回:0 . 48667 . 38686868661</p><p id="82c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">精度:0.36466868665</p><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/a9882d71a0addcd031d40275f4487049.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*pF5iz3W_mxUm_UG7bbFrjA.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">分类报告</p></figure><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/63d63a7d97fe91f88960d8f538e251e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*ajpx6Db9DvMTx5wZEWi6Fw.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">受试者工作特征曲线</p></figure><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/796824a00dffa0fa3f7af8423d61f9f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*zOJ9JK3Dj_Coz9xUHU7Dkw.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">xgboost roc 曲线</p></figure><figure class="md me mf mg gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nk"><img src="../Images/7e5c2d7a7fcc9d68c7479cf81fe0fb4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*JXqDWwAM4BGSsm0ZhRwoqg.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated">分类报告</p></figure><p id="425a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该模型对于类别 0(没有订阅押金的回答者)的预测和召回率较高，但是对于类别 1(订阅的回答者)的预测和召回率较低。0 班的 F1 分数很高，而 1 班的 F1 分数低于 0.5。总的来说，该模型似乎不能很好地预测定期存款的受访者。曲线下的面积为 0.72，大大高于随机猜测的概率面积(0.5)。给定上述分类报告的结果，可以假设对 ROC 曲线下面积的最大贡献来自正确识别的 0 级。</p><h2 id="c38b" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">模型比较</h2><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/41af7b861edb296d77df9a6049b85a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*jgU7uRiXhsKSBRMRYS537Q.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">建造的模型</p></figure><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/84d4dbfc92668b002b43fb46bb541c8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*fSxxV1YWjAZSR9TlE2Pw7A.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">在所有模型中，逻辑回归具有最高的回忆得分值。</p></figure><figure class="md me mf mg gt ms gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/dc82be3289f7f0624eab5ab4f559c02a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*fRng0qNiuzaEsxeEBMtlQg.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">就 f1-得分而言，梯度推进模型具有最高的性能。</p></figure><p id="5bf1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">结论</p><p id="398d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">支持向量机为 F1 分数和回忆分数给出了稳定和可靠的模型性能。较高的 F1 分数表明，该模型可以很好地预测现有客户的存款订阅活动是否成功。这是在<a class="ae mc" href="http://10academy.org" rel="noopener ugc nofollow" target="_blank"> 10 academy training </a>中每周挑战的一部分。</p><p id="34ff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有详细分析代码的笔记本可以在<a class="ae mc" href="https://github.com/Abuton/Modelling-Subscription-for-Bank-Deposits" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p></div></div>    
</body>
</html>