<html>
<head>
<title>Elevate Your Dashboard Interactivity In Dash</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">提升仪表板在Dash中的交互性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/elevate-your-dashboard-interactivity-in-dash-b655a0f45067?source=collection_archive---------20-----------------------#2020-02-10">https://towardsdatascience.com/elevate-your-dashboard-interactivity-in-dash-b655a0f45067?source=collection_archive---------20-----------------------#2020-02-10</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><figure class="it iu gq gs iv iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj is"><img src="../Images/25ffb7ec93e72727778464424d849b64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3woYjcIFVfnsUDWNrAMQFQ.jpeg"/></div></div><p class="jd je gk gi gj jf jg bd b be z dk translated">海崖桥|君摄</p></figure><div class=""/><div class=""><h2 id="3a9d" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">在dash代码中实现“回调”的初学者协会</h2></div><p id="b94d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">上周，我和大家分享了如何在python中使用Dash制作一个<a class="ae lu" href="https://dash-coronavirus-2020.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">仪表盘</a>来跟踪冠状病毒的传播，从中可以实时了解全球冠状病毒病例的数量，包括确诊、痊愈和死亡病例，以及它们在世界地图上的分布。</p><div class="it iu gq gs iv lv"><a rel="noopener follow" target="_blank" href="/build-a-dashboard-to-track-the-spread-of-coronavirus-using-dash-90364f016764"><div class="lw ab fp"><div class="lx ab ly cl cj lz"><h2 class="bd jk gz z fq ma fs ft mb fv fx ji bi translated">使用Dash构建一个仪表板来跟踪冠状病毒的传播</h2><div class="mc l"><h3 class="bd b gz z fq ma fs ft mb fv fx dk translated">全球冠状病毒(2019-nCoV)患者确诊、康复和死亡的实时视图</h3></div><div class="md l"><p class="bd b dl z fq ma fs ft mb fv fx dk translated">towardsdatascience.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj jb lv"/></div></div></a></div><p id="ede7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">对于第一个版本，我们实现了基本的dash功能，并获得了一个静态应用程序接口。换句话说，除了<code class="fe mk ml mm mn b">plotly</code> ( <em class="mo">提供的本地交互，例如悬停文本显示和图形上的地图探索</em>，一旦应用程序在用户的浏览器上启动，屏幕上显示的所有内容都将被设置。用户可能会在几秒钟内使用完仪表板，然后弹开。</p><p id="5de0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">一般来说，作为一个web应用程序，其整体健康状况的一个主要指标是参与度，它表示在一段定义的时间内，在您的应用程序中保持活跃的用户的百分比。这对于依赖稳定的用户流来产生收入的商业web应用程序来说尤其重要(<em class="mo">当然这不是我的dashboard应用程序的目的，但是，为了引出本文的主题，让我们假设我们现在正在构建一个“商业应用程序”</em>)。提高web应用程序参与度的一个简单而有效的方法是提高它与用户的交互性。</p><p id="434c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">大家可以看到，相比于第一个版本(<a class="ae lu" rel="noopener" target="_blank" href="/build-a-dashboard-to-track-the-spread-of-coronavirus-using-dash-90364f016764"> <em class="mo">标题图</em> </a> <em class="mo">在我上一篇</em>中)，在最新版本的<a class="ae lu" href="https://dash-coronavirus-2020.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> 2019-nCoV跟踪仪表盘</a>中的地图旁边放置了一个数据表(图1)。随着该数据表添加了两种类型的交互性，</p><ol class=""><li id="723f" class="mp mq jj la b lb lc le lf lh mr ll ms lp mt lt mu mv mw mx bi translated">用户可以根据四列中的任意一列(<em class="mo">即国家/地区、确诊、康复和死亡</em>)对行进行排序；</li><li id="f8a8" class="mp mq jj la b lb my le mz lh na ll nb lp nc lt mu mv mw mx bi translated">一旦用户选择表格中的一行，地图将自动更新为国家/地区的放大视图(<em class="mo">例如，当选择“Mainland China”时，地图将放大到中国并显示每个省的病例数</em>)。</li></ol><figure class="ne nf ng nh gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj nd"><img src="../Images/df81b1b1b7d01c9d300d93869c5b46c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N84bSrrKj5gpRo2gPXfUDg.png"/></div></div><p class="jd je gk gi gj jf jg bd b be z dk translated">图1 |仪表板中的两个函数和数据表</p></figure><p id="a3db" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">这两个功能可能有助于将用户保留在仪表板中更长时间，因为地图上显示的结果可以基于他们自己的兴趣和选择。</p><p id="2be4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">在本帖中，我将与你分享如何在dash中使用<strong class="la jk">回调</strong>来实现前述的交互性。像往常一样，您可以从<a class="ae lu" href="https://github.com/Perishleaf/data-visualisation-scripts/blob/master/dash-2019-coronavirus/dashboard-callback-virus.ipynb" rel="noopener ugc nofollow" target="_blank"> my Github </a>访问所有需要的数据和jupyter笔记本。</p></div><div class="ab cl ni nj hy nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="in io ip iq ir"><h2 id="df6e" class="np nq jj bd nr ns nt dn nu nv nw dp nx lh ny nz oa ll ob oc od lp oe of og oh bi translated">dash中的回调是什么</h2><p id="f8f7" class="pw-post-body-paragraph ky kz jj la b lb oi kk ld le oj kn lg lh ok lj lk ll ol ln lo lp om lr ls lt in bi translated">在dash中，<code class="fe mk ml mm mn b">callback</code>可以理解为python函数和应用程序之间链接的双向隧道。</p><p id="1e37" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">具体来说，<code class="fe mk ml mm mn b">Input</code>和<code class="fe mk ml mm mn b">Output</code>两种货物在一个<code class="fe mk ml mm mn b">callback</code>内从两个方向交付，<code class="fe mk ml mm mn b">Input</code>是从<code class="fe mk ml mm mn b">app</code>到<code class="fe mk ml mm mn b">function</code>交付的货物，通过用户在<code class="fe mk ml mm mn b">app</code> ( <em class="mo">中的动作生成，例如输入一个值，选择一行，从下拉菜单中选择一个项目，将光标悬停在一个分散点上等。</em>)。相反，<code class="fe mk ml mm mn b">Output</code>是从<code class="fe mk ml mm mn b">function</code>到<code class="fe mk ml mm mn b">app</code>的货物，由<code class="fe mk ml mm mn b">function</code>根据<code class="fe mk ml mm mn b">Input</code>返回。</p><p id="3146" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated"><code class="fe mk ml mm mn b">Input</code>和<code class="fe mk ml mm mn b">Output</code>都有两个自变量<code class="fe mk ml mm mn b">component_id</code>和<code class="fe mk ml mm mn b">component_property</code>。<code class="fe mk ml mm mn b">component_id</code>确保<code class="fe mk ml mm mn b">callback</code>识别正确的发送者和接收者，而<code class="fe mk ml mm mn b">component_property</code>是货物的实体。也就是说，基于这些<code class="fe mk ml mm mn b">component_id</code> , <code class="fe mk ml mm mn b">callback</code>知道哪个组件的<code class="fe mk ml mm mn b">component_property</code>作为<code class="fe mk ml mm mn b">Input</code>应该被监控，从<code class="fe mk ml mm mn b">function</code>返回的<code class="fe mk ml mm mn b">component_property</code>作为<code class="fe mk ml mm mn b">Output</code>应该被分配给哪个组件。</p><p id="47e8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">在下面取自<a class="ae lu" href="https://dash.plot.ly/getting-started-part-2" rel="noopener ugc nofollow" target="_blank"> Dash教程</a>的例子中，我们可以看到<code class="fe mk ml mm mn b">html.Div()</code>容器中的两个组件(<em class="mo">即</em> <code class="fe mk ml mm mn b"><em class="mo">dcc.Input()</em></code> <em class="mo">和</em> <code class="fe mk ml mm mn b"><em class="mo">html.Div()</em></code>)各有一个<code class="fe mk ml mm mn b">id</code>。这两个id分别分配给<code class="fe mk ml mm mn b">callback</code>中的<code class="fe mk ml mm mn b">Output</code>和<code class="fe mk ml mm mn b">Input</code>。因此，用户输入的值( <code class="fe mk ml mm mn b"><em class="mo">dcc.Input</em></code> <em class="mo">的<code class="fe mk ml mm mn b"><em class="mo">value</em></code> <em class="mo">属性，其中</em> <code class="fe mk ml mm mn b"><em class="mo">id</em></code> <em class="mo">为‘my-id’</em>)将被传递给<code class="fe mk ml mm mn b">update_output_div(input_value)</code>，返回的结果将被赋给<code class="fe mk ml mm mn b">html.Div()</code>的<code class="fe mk ml mm mn b">children</code>属性，其中<code class="fe mk ml mm mn b">id</code>为‘my-div’。</em></p><figure class="ne nf ng nh gu iw"><div class="bz fq l di"><div class="on oo l"/></div><p class="jd je gk gi gj jf jg bd b be z dk translated">样本破折号</p></figure><p id="1b62" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">最重要的是，<code class="fe mk ml mm mn b">callback</code>实时监控<code class="fe mk ml mm mn b">input</code>的货物流量。如上例所示，一旦输入框内发生变化，就会触发<code class="fe mk ml mm mn b">update_output_div(input_value)</code>，并且<code class="fe mk ml mm mn b">children</code>内容会立即更新(图2)。这一特性使用户能够在采取行动后立即看到来自应用程序的反馈。</p><figure class="ne nf ng nh gu iw gi gj paragraph-image"><div class="gi gj op"><img src="../Images/df229a6c53a3b074f0a0ce757e21a14e.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*hhSMBCgrLaIXq4Af7Uvz5A.png"/></div><p class="jd je gk gi gj jf jg bd b be z dk translated">图2 |示例应用程序</p></figure><p id="b54d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">您可能会注意到<code class="fe mk ml mm mn b">component_property</code>只是给定组件的属性，这意味着我们可以通过回调函数返回组件的任何属性。</p><p id="71b2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">一旦我们理解了dash中回调的概念，让我们深入到我的仪表板的代码中。</p><h2 id="fa65" class="np nq jj bd nr ns nt dn nu nv nw dp nx lh ny nz oa ll ob oc od lp oe of og oh bi translated">此仪表板中的回拨</h2><figure class="ne nf ng nh gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj oq"><img src="../Images/bea012588ff5ad3a858f0ef56170002d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xiocF1q8-DnhN_4QcoP5Lw.png"/></div></div><p class="jd je gk gi gj jf jg bd b be z dk translated">图3 |地图容器的代码</p></figure><p id="6940" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">这里我先在地图驻留的容器里面多加了一个<code class="fe mk ml mm mn b">html.Div()</code> ( <em class="mo">图3 </em>，<em class="mo"> line523-line563 </em>)子容器。在这个子容器中，有两个组件，<code class="fe mk ml mm mn b">html.H5()</code>用于标题，<code class="fe mk ml mm mn b">dash_tale.DataTable()</code>(<a class="ae lu" href="https://dash.plot.ly/datatable" rel="noopener ugc nofollow" target="_blank"><em class="mo">Dash DataTable</em></a><em class="mo">是一个交互式表格组件，设计用于查看、编辑和探索数据表的大型数据集</em>。</p><p id="2284" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">还记得第一种交互性，排序功能吗？这个很简单，可以直接用<code class="fe mk ml mm mn b">sort_action</code> ( <em class="mo"> line536，</em> <em class="mo">)设置，可以让数据按列排序，接受DataTable组件中</em> <code class="fe mk ml mm mn b"><em class="mo">none</em></code> <em class="mo">、</em> <code class="fe mk ml mm mn b"><em class="mo">native</em></code> <em class="mo">、</em> <code class="fe mk ml mm mn b"><em class="mo">custom</em></code>的任意一个值。这里我们只使用了<code class="fe mk ml mm mn b">native</code>，它根据数据的类型对数据进行排序(例如<em class="mo">升序表示数字，字母表表示字符串</em>)。</p><p id="8a27" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">为了能够选择数据表中的行，我们还需要设置<code class="fe mk ml mm mn b">row_selectable='single'</code> ( <em class="mo"> line534 </em>)，选择界面将显示在每一行数据的前面。</p><p id="eeae" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">对于地图组件(<em class="mo">即</em> <code class="fe mk ml mm mn b"><em class="mo">dcc.graph()</em></code>)，你可以发现它的<code class="fe mk ml mm mn b">id</code>是‘数据表-交互-地图’(<em class="mo">line 519</em>)，而带有‘数据表-交互-位置’<code class="fe mk ml mm mn b">id</code>的数据表组件(<em class="mo"> line529 </em>)。这是回调中使用的两个id。我喜欢使用有意义的id名称，这有助于将来维护代码。</p><p id="643f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">好了，app端的一切都准备好了，现在让我们进入回调部分。在我们的例子中，作为<code class="fe mk ml mm mn b">Input</code> cargo，我们有<code class="fe mk ml mm mn b">derived_virtual_selected_rows</code> ( <em class="mo">这不是一个任意的名字，它是一个从数据表中选择</em> <code class="fe mk ml mm mn b"><em class="mo">dash_table.DataTable</em></code> <em class="mo">组件</em>的行的索引列表)，cargo然后将传递给函数为<code class="fe mk ml mm mn b">dcc.graph()</code>返回一个<code class="fe mk ml mm mn b">figure</code>属性。</p><p id="6ab9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">因此，如图4所示，我们给<code class="fe mk ml mm mn b">Output</code>和<code class="fe mk ml mm mn b">Input</code>分配了相应的‘id ’,同时，标记了正确的属性以便回调到monitor。注意<code class="fe mk ml mm mn b">Input</code>必须在列表中。</p><figure class="ne nf ng nh gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj or"><img src="../Images/815ffe27dbf5115feb11286a1ae8889c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Cu71A_B7bnunV9dF_JRaw.png"/></div></div><p class="jd je gk gi gj jf jg bd b be z dk translated">图4 |回调装饰器</p></figure><p id="e96e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">最后，让我们完成功能方面。我们想要的交互性是让用户从数据表中选择一行，地图将自动移动到和放大所选的国家/地区。此外，在应用程序开始时，初始中心点和缩放级别应该显示整个世界地图。</p><p id="371d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">第一次启动应用程序时，将调用回调及其函数。然而，当第一次呈现应用程序时，没有选择任何行，因此<code class="fe mk ml mm mn b">derived_virtual_selected_rows</code>将是<code class="fe mk ml mm mn b">None</code>。这可能会导致依赖于<code class="fe mk ml mm mn b">derived_virtual_selected_rows</code>的函数出现问题。这就是为什么你可以从第590行到第591行(图5)看到，在函数的开始，我们将<code class="fe mk ml mm mn b">derived_virtual_selected_rows</code>设置为一个空列表。一旦用户做出选择，数据表中被选择行的索引将被存储在<code class="fe mk ml mm mn b">derived_virtual_selected_rows</code>中。由于我们只启用了单一选择，它将只包含一个项目。为了访问这个索引，我们只需要调用<code class="fe mk ml mm mn b">derived_virtual_selected_rows[0]</code>。</p><figure class="ne nf ng nh gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj os"><img src="../Images/ebe21733e079ff374ebb7f50c6df2bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1grJHNNgSVBUao7uwD_bJA.png"/></div></div><p class="jd je gk gi gj jf jg bd b be z dk translated">图5 |回调包装的函数</p></figure><p id="c49d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">通过使用<code class="fe mk ml mm mn b">go.layout.mapbox.Center()</code>(图5，<em class="mo">line 639–641</em>，我们可以指定地图应该居中的坐标及其放大级别。因此，当应用程序第一次启动并且<code class="fe mk ml mm mn b">derived_virtual_selected_rows</code>是一个空列表时，我们将使用预定义的坐标和放大级别。一旦<code class="fe mk ml mm mn b">derived_virtual_selected_rows</code>内有选择，callback会用相应的坐标和放大级别更新地图。</p><pre class="ne nf ng nh gu ot mn ou ov aw ow bi"><span id="d75f" class="np nq jj mn b gz ox oy l oz pa">lat=3.684188 if len(derived_virtual_selected_rows)==0 else <strong class="mn jk">dff['lat'][derived_virtual_selected_rows[0]]</strong><br/>lon=148.374024 if len(derived_virtual_selected_rows)==0 else <strong class="mn jk">dff['lon'][derived_virtual_selected_rows[0]]</strong></span><span id="9794" class="np nq jj mn b gz pb oy l oz pa">zoom=1.2 if len(derived_virtual_selected_rows)==0 else <strong class="mn jk">4</strong></span></pre><p id="2ebe" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">万岁，我们现在使用回调为仪表板添加两种类型的交互性。我希望你觉得这篇文章很有用，并且现在对dash中的回调有了一个想法。</p><p id="3ecc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">以下是我用来学习破折号回调的列表:</p><ul class=""><li id="087d" class="mp mq jj la b lb lc le lf lh mr ll ms lp mt lt pc mv mw mx bi translated"><a class="ae lu" href="https://dash.plot.ly/getting-started-part-2" rel="noopener ugc nofollow" target="_blank">基本仪表板回调</a></li><li id="2da1" class="mp mq jj la b lb my le mz lh na ll nb lp nc lt pc mv mw mx bi translated"><a class="ae lu" href="https://dash.plot.ly/faqs" rel="noopener ugc nofollow" target="_blank">破折号问题</a></li><li id="ba69" class="mp mq jj la b lb my le mz lh na ll nb lp nc lt pc mv mw mx bi translated"><a class="ae lu" href="https://dash.plot.ly/datatable/interactivity" rel="noopener ugc nofollow" target="_blank">仪表板交互性</a></li></ul></div><div class="ab cl ni nj hy nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="in io ip iq ir"><p id="c5da" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">和往常一样，我欢迎反馈、建设性的批评以及听到关于您的数据科学项目的信息。你可以在Linkedin上找到我，也可以在我的网站上找到我。</p></div></div>    
</body>
</html>