<html>
<head>
<title>My Top 5 Pandas Data Manipulation Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的 5 大熊猫数据操作功能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/my-top-5-pandas-data-manipulation-function-680e346809c7?source=collection_archive---------13-----------------------#2020-04-04">https://towardsdatascience.com/my-top-5-pandas-data-manipulation-function-680e346809c7?source=collection_archive---------13-----------------------#2020-04-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="954a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">作为数据科学家，了解您的熊猫图书馆功能库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/08464866f1d37c3db510f88b6b713244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jsgh5noRcRaSmR0Y"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">沙哈达特·拉赫曼在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a579" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名使用 Python 作为主要语言的数据科学家，我们知道熊猫图书馆在我们的日常生活中是不可分割的。从你开始使用 Python 学习数据科学直到你的职业生涯，了解熊猫提供的每一件小事都不会伤害你。虽然，有一些函数我比其他的更经常使用来操作我的数据。</p><p id="2363" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，DataFrame 和 Series 函数甚至会在应用数据操作函数之前使用，所以我不会解释这些函数。</p><p id="e805" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是我在日常工作中经常使用的 5 个熊猫功能。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4e03" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">熊猫功能</h1><p id="1712" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">根据你工作的需要，有许多熊猫的功能是有用的，尽管有些可能比其他的用得更多。在这里，为了向您展示我经常使用的函数，我将使用 seaborn 模块(可视化库，但我只使用它来获取数据)中的 mpg 数据集。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="dc08" class="ne md it na b gy nf ng l nh ni">import pandas as pd<br/>import seaborn as sns</span><span id="0bb4" class="ne md it na b gy nj ng l nh ni">mpg = sns.load_dataset('mpg')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/cd4759ab17b1aa57e5ec14d66b2d1b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zZZSjxsOqUNqCwIwVSZ3QA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自 seaborn 模块的 mpg 数据集</p></figure><p id="6a11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们进入要点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="d18e" class="ne md it bd me nl nm dn mi nn no dp mm li np nq mo lm nr ns mq lq nt nu ms nv bi translated">1.交叉表</h2><p id="592b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">crosstab 是一个熊猫函数，用于计算两个(或更多)因素的交叉列表。如果你不知道什么是交叉列表，让我用一个例子给你看。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8732" class="ne md it na b gy nf ng l nh ni">pd.crosstab(index = mpg['origin'], columns = mpg['model_year'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/2bf87d41feee7474abae8a4415a3a494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*mXPIbpBa4QZY0x9titdoUg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">双因素交叉列表示例</p></figure><p id="bcef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上是交叉列表的一个例子。数据本身仍然是 DataFrame 对象。我们从数据集的类别变量中指定表的索引和列；在我的例子中，我使用“origin”和“model_year”类别变量。默认情况下，crosstab 函数会计算因子的频率，并显示在交叉表中。虽然，我们可以通过引入另一个因素来改变它，这个因素通常是一个连续变量。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d2ad" class="ne md it na b gy nf ng l nh ni">pd.crosstab(index = mpg['origin'], columns = mpg['model_year'], values = mpg['mpg'], aggfunc = 'mean')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/36a27c3368a92b8ffd38c8e355a92e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gCQzGpZspqRG68elMv2rg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">以连续变量为另一因素的交叉制表</p></figure><p id="57db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面，如果我们将“mpg”变量添加到值中，并将 aggfunc 参数设置为“mean ”,我们将获得交叉列表，其中“mpg”的平均值由类别分隔。它类似于我们称之为数据透视表的熊猫函数 pivot_table 可以实现类似的结果。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="c7a2" class="ne md it bd me nl nm dn mi nn no dp mm li np nq mo lm nr ns mq lq nt nu ms nv bi translated">2.切口</h2><p id="07c0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Pandas cut 函数用于将连续值宁滨成离散区间。当我们需要对连续值进行分段和分类时，我们使用 cut。你不知道宁滨是什么；是把连续值放入某个范围区间的过程。最好用直方图来描述。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="26c3" class="ne md it na b gy nf ng l nh ni">mpg['mpg'].hist()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/28b84f24a73aabe37329145377264d2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*U_Ftgvhb-HA0AqfzT3MUTw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">直方图示例</p></figure><p id="0f1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们将连续值输入到某个范围间隔中，并创建箱。每个条形显示落入这些区间的值，条形越高，频率越大。</p><p id="a69f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">范围间隔取决于箱的数量。例如，如果我们有一个最小值为 10、最大值为 45 的连续变量，并且我们想要创建 10 个区间，那么范围间隔将是<strong class="lb iu">(最大-最小)/区间</strong>。这意味着(45–10)/10 = 3.5。因此，第一个容器将由 10 到 13.5 之间的连续值填充，依此类推。</p><p id="d592" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个函数对于从连续变量到分类变量也很有用。例如，cut 函数可以将年龄转换为年龄范围组。让我们用一个数据集例子来展示这个函数。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2269" class="ne md it na b gy nf ng l nh ni">pd.cut(x = mpg['mpg'], bins = 4, labels = [1,2,3,4])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/7e1cc5935d8739879762917e2f68ef9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*6p7SqBkjtNr_F2yLkLxwjg.png"/></div></figure><p id="f54f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的函数中，我将 bins 参数设置为 4，因为我希望获得 4 个类别，标签设置为 1、2、3 和 4。cut 函数的输出将是一个包含所有连续值的序列，这些连续值已被入库并转换为可接受的类别。这是我将它放入数据框后的样子。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="187f" class="ne md it na b gy nf ng l nh ni">mpg['mpg_bin'] = pd.cut(x = mpg['mpg'], bins = 4, labels = [1,2,3,4])<br/>mpg[['mpg', 'mpg_bin']]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/1c286d1a2e4ba7142e298ef030b8351b.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*GS9yl3GCAwwEoVlkPNp3hw.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="bd24" class="ne md it bd me nl nm dn mi nn no dp mm li np nq mo lm nr ns mq lq nt nu ms nv bi translated">3.qcut</h2><p id="0786" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在熊猫身上，我们有 cut 功能，我们也有 qcut 功能。与 cut 函数类似，我们将宁滨作为连续变量，但在 qcut 函数中，基于等级或基于样本分位数，仓位大小将相等。分位数基本上是一种以相等方式划分连续值的除法技术。例如，如果我们将连续值分为 4 部分；它将被称为四分位数，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/88a7905aa73fe1b56ea76c9940a7ac8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*8z_qdZ3nnhw1e-sRzFRhpA.png"/></div></figure><p id="1ff3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我用一个代码示例向您展示。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="6ee0" class="ne md it na b gy nf ng l nh ni">pd.qcut(x = mpg['mpg'], q = 4, labels = [1,2,3,4])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/2dc187b9956c1a3b779483f7b0a8afa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*WyIlkGHCN3EQQzBTWBI_4Q.png"/></div></figure><p id="9d1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上是 qcut 函数的输出。这里我将 q 参数输入为 4，将连续值分成四分位数，并用 1、2、3 和 4 标记它们。与 cut 函数相比，结果是不同的，因为它们的计算已经不同。让我也把它放到数据框中，这样我们就可以看到结果的不同。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="6ed3" class="ne md it na b gy nf ng l nh ni">mpg['mpg_qcut'] = pd.qcut(x = mpg['mpg'], q = 4, labels = [1,2,3,4])<br/>mpg[['mpg', 'mpg_bin','mpg_qcut']]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/a958c081d6a2015062470083f017f5a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*BkfsPTJwZQTBmamwKbfUqw.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="71cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 4。get_dummies </strong></p><p id="6c3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数用于通过对分类变量进行一次热编码，将分类变量转换为数字变量。对于不知道 One-Hot-Encode 是什么的人来说，这是一个从我们的分类变量创建新列的过程，其中每个类别都成为一个新列，值为 0 或 1 (0 表示不存在，1 表示存在)。</p><p id="6fc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么我们要把分类变量转换成数值变量？这是因为许多统计技术或机器学习方程只接受数值而不是类别值。</p><p id="75e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我用一个代码示例向您展示我所说的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/2c4f7659682eaae30902a1022032d552.png" data-original-src="https://miro.medium.com/v2/resize:fit:266/format:webp/1*_JYDB_OmxbaBZaNjRYUP_A.png"/></div></figure><p id="f16f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面是 mpg 数据集中的“原点”变量。它是具有 3 个基数的分类变量(“美国”、“欧洲”和“日本”)。这里我将使用 get_dummies 函数对这个变量进行一次热编码。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="368d" class="ne md it na b gy nf ng l nh ni">origin_dummies = pd.get_dummies(mpg['origin'])<br/>origin_dummies</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/fc6f6aa78639f42300a72e40f48c8fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*lVjug1nh-_9Q9GsWyxjVyA.png"/></div></div></figure><p id="56a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像这样，我们已经得到了 3 个新列，每个类别成为一个新列，值为 0 或 1。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="ed10" class="ne md it bd me nl nm dn mi nn no dp mm li np nq mo lm nr ns mq lq nt nu ms nv bi translated">5.串联</h2><p id="b724" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我最常用的数据操作函数是 concat 函数。这个函数就像它所调用的那样；它串联起来。但是，这个函数连接了什么呢？它连接 pandas 对象(系列或数据帧)。让我给你看一个例子。比方说，我只想让“mpg”列显示我刚才创建的 origin_dummies 变量。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c554" class="ne md it na b gy nf ng l nh ni">pd.concat(objs = [mpg['mpg'], origin_dummies], axis = 1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/d3d4369e74055dc97f50f0c767300903.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*AeKMCY0DqL8xjvowGqZ96w.png"/></div></figure><p id="8073" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 concat 函数，我只是将两个 pandas 对象(系列和数据帧)组合成一个数据帧。在函数中，我将轴参数指定为 1，因为我想组合熊猫对象，使列看起来像并排粘在一起。这个轴参数只接受 2 个东西；0 或 1。根据您想要连接 pandas 对象的方式，如果您想要像堆叠对象一样连接 Pandas 对象(像添加新行一样连接对象),请将它设置为 0；如果您想要对象相对于索引并排，请将它设置为 1。</p><p id="2abc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们将轴设为 0，会发生以下情况。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9e04" class="ne md it na b gy nf ng l nh ni">pd.concat([mpg['mpg'], origin_dummies], axis = 0)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/e5d1563ec91ae1a66278135a41b7cda6.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*9DXUZXSpjtC7dSzGWe7X5g.png"/></div></figure><p id="2b7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以看到，我们的数据框中有 796 行和许多 NaN 对象。发生这种情况是因为我们连接了 Pandas 对象，但是当我们设置它时，我们堆叠了该对象，不是所有的列名都存在于任一对象中，所以它用 NaN 值填充了先前不存在的列。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fc2c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="c948" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这篇文章向你展示了我经常使用的前 5 个熊猫的数据操作功能。这些功能是:</p><ol class=""><li id="90db" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated">交叉表</li><li id="6160" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">切口</li><li id="6905" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">qcut</li><li id="cb73" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">获取 _ 假人</li><li id="ddc4" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">串联</li></ol><p id="172a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望有帮助！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ef2e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如果您喜欢我的内容，并希望获得更多关于数据或数据科学家日常生活的深入知识，请考虑在此订阅我的<a class="ae ky" href="https://cornellius.substack.com/welcome" rel="noopener ugc nofollow" target="_blank">简讯。</a></h1><blockquote class="ow"><p id="f292" class="ox oy it bd oz pa pb pc pd pe pf lu dk translated">如果您没有订阅为中等会员，请考虑通过<a class="ae ky" href="https://cornelliusyudhawijaya.medium.com/membership" rel="noopener">我的介绍</a>订阅。</p></blockquote></div></div>    
</body>
</html>