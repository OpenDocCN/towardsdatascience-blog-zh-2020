<html>
<head>
<title>Effectively visualize data across time to tell better stories</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">随着时间的推移有效地可视化数据，以讲述更好的故事</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/effectively-visualize-data-across-time-to-tell-better-stories-2a2c276e031e?source=collection_archive---------15-----------------------#2020-03-06">https://towardsdatascience.com/effectively-visualize-data-across-time-to-tell-better-stories-2a2c276e031e?source=collection_archive---------15-----------------------#2020-03-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="141e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python和Plotly构建清晰易读的时序数据可视化，以支持您的叙述。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0e6618d0c8431cdf7880dd879357f17f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0jq2aZmvZNvGPPUziujjwQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">2018-2019 NBA常规赛</p></figure><p id="0153" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不言而喻，时间是我们所做的几乎每一件事情不可或缺的一部分，包括构建我们对周围世界理解的叙事。当谈到基于数据的T2讲故事时，情况也是如此，我们经常需要将数据可视化。无论是公司的股票价格、候选人的选举民调数据，还是一个国家的人口数量，数据随时间的变化都是叙事的关键要素。</p><p id="011d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是可视化时间序列数据可能是一个具有挑战性的命题。当有多个数据系列时尤其如此，这些数据系列在小空间内相互交错，就像一群第一次踢足球的不守规矩的6岁儿童。</p><p id="2b5d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看看下面的图表，它是由StackOverFlow用户发布的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/ae9b132ccff9c617c7342c7ac0780680.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hwXAyWScp-QFoJptIbnLLw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">你能看懂这张图表吗？(来自<a class="ae lw" href="https://stackoverflow.com/questions/38264623/visualizing-multiple-time-series-observation/38265162#38265162" rel="noopener ugc nofollow" target="_blank">斯塔克伟福</a></p></figure><p id="9095" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如你可能想象的那样，发帖人正在寻求帮助，如何使图表更清晰易读。甚至很难识别出图中的单个痕迹，更不用说弄清楚任何可能存在的模式了。</p><p id="88f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我注意到这个图表只包括<em class="lu">四个</em>轨迹。</p><p id="1e51" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一方面，在FiveThirtyEight看一看这位来自Andrew Flowers的美女。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lx"><img src="../Images/740365a04eed7fc34d652daeedadf4ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eGpnHy2nYFkV5TjzGqZVfw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">那更好！(<a class="ae lw" href="https://fivethirtyeight.com/features/the-national-parks-have-never-been-more-popular/" rel="noopener ugc nofollow" target="_blank">五三八</a>)</p></figure><p id="965e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该图表包括了不到60(！)痕迹。但是FiveThirtyEight对饱和度、颜色和标签的明智使用彻底改变了游戏。即使在这60个数据系列之外，关键的10个系列也清楚地显示出来，使读者能够识别每个系列，并随着时间的推移跟踪它，以支持所写的散文。</p><p id="ffed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">显然，我们都希望我们的图表看起来更像后者，而不是前者。所以在这篇文章中，我想谈谈如何做到这一点，使用我常用的数据可视化工具(Plotly)来可视化数据。至于数据，让我们用2018–2019 NBA赛季数据来尝试重新讲述它的故事；当然，我们可以很容易地使用股票、城镇人口或我的体重数据。我们走吧。</p><h1 id="0936" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">在开始之前</h1><h2 id="b0de" class="mq lz it bd ma mr ms dn me mt mu dp mi lh mv mw mk ll mx my mm lp mz na mo nb bi translated">数据</h2><p id="398e" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">我把代码和数据放在我的<a class="ae lw" href="https://gitlab.com/jphwang/online_articles" rel="noopener ugc nofollow" target="_blank"> GitLab repo这里</a> ( <code class="fe nh ni nj nk b">nba_storytime</code>目录)。所以请随意使用它/改进它。</p><h2 id="a44f" class="mq lz it bd ma mr ms dn me mt mu dp mi lh mv mw mk ll mx my mm lp mz na mo nb bi translated"><code class="fe nh ni nj nk b">Packages</code></h2><p id="458d" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">我假设您熟悉python。即使你相对较新，这个教程也不应该太难。</p><p id="f4f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你需要<code class="fe nh ni nj nk b">pandas</code>和<code class="fe nh ni nj nk b">plotly</code>。用一个简单的<code class="fe nh ni nj nk b">pip install [PACKAGE_NAME]</code>安装每一个(在您的虚拟环境中)。</p><h1 id="2e61" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">获取您的数据</h1><p id="3d50" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">我选择的数据集是每个NBA球队比赛结果的集合。用以下内容加载<code class="fe nh ni nj nk b">csv</code>文件:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="8c0d" class="mq lz it nk b gy np nq l nr ns">all_records_df = pd.read_csv('srcdata/2018_2019_season_records.csv', index_col=0)</span></pre><p id="0cff" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">数据集包括每一场比赛，包括季后赛。数据集包括字符串形式的比赛日期，因此我们可以按日期过滤它们:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="346e" class="mq lz it nk b gy np nq l nr ns">records_df = all_records_df[pd.to_datetime(all_records_df.date) &lt; pd.to_datetime('2019-04-12')]</span></pre><p id="7801" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看起来是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="c977" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些数据包括每支球队在这些比赛日期的累计净得分、比赛次数、胜败情况。</p><p id="d5fc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">换句话说，随着时间的推移，这些数据讲述了每个球队的赛季故事。我们来看看如何最好地讲述每个团队的故事，如何突出关键时刻，通过数据发现什么有趣的故事。</p><h1 id="662f" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">用数据讲故事</h1><h2 id="9737" class="mq lz it bd ma mr ms dn me mt mu dp mi lh mv mw mk ll mx my mm lp mz na mo nb bi translated">介绍</h2><p id="76bf" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">让我们把数据绘制成散点图。我们可以生成图表来查看每场比赛的累积胜率:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="0d71" class="mq lz it nk b gy np nq l nr ns">import plotly.express as px<br/>fig = px.scatter(records_df, x='date', y='wins', color='team')<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/7dfa2769bef0ef12c7e23b438e4f70d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dTc4MKBIwnOzeB0lbdc3Hg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">赢与玩的游戏——分散</p></figure><p id="9feb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个很好的开始，但这是一个相当拥挤的图表，尤其是在赛季初。一些颜色在这里和那里很突出，但对我来说，似乎有太多的重叠，挑选出特定的数据集或注意数据中的模式是很清楚的。</p><p id="3050" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们来看看其他一些可视化数据的方法。</p><h2 id="d1e5" class="mq lz it bd ma mr ms dn me mt mu dp mi lh mv mw mk ll mx my mm lp mz na mo nb bi translated">整理数据</h2><p id="2b7d" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">如果我们把散点图的点连接起来，把它转换成线图，会怎么样？</p><p id="7e6d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">(代码方面，这将做到:<code class="fe nh ni nj nk b">fig.update_traces(mode=’markers+lines’)</code>)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/7d9bb357b986a3352f16f24438543a5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lVZLma0GBbJNKMd4lFggDw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">赢与玩的游戏—带标记的折线图</p></figure><p id="4cfd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧，还不错。因为我们想讲述一个团队发展的故事，所以折线图可能是比散点图更好的选择。(如果您不想看到这些点，请指定:<code class="fe nh ni nj nk b">fig.update_traces(mode=’lines’)</code>)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/1c725581323e059803d74726f251e47a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c5Al3T--EHYXLJG-4FKaTQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">赢与玩的游戏—仅折线图</p></figure><p id="8c04" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不过，这里有30条跟踪，很难分辨出哪条跟踪在做什么。此外，我们的边上的传说似乎是在一个随机的顺序，使发现困难。让我们解决这个问题。</p><p id="9aad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们所要做的就是传递一个类别参数值的实参，以你喜欢的任何顺序作为一个列表。我只是将数据按字母顺序排序，然后像这样传递:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="b9fd" class="mq lz it nk b gy np nq l nr ns">tm_names = [i for i in records_df.team.unique()]<br/>tm_names.sort()<br/>fig = px.scatter(records_df, x='games', y='wins', color='team', category_orders={'team': tm_names})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/d3b68665e5dc24631ba5338a516f5b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BYPhOTg4YWVm548jNiT35A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用有序名称</p></figure><p id="d13c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">右边的图例现在按字母顺序排列，使我们能够更容易地找到并隔离正确的轨迹。</p><p id="bc6f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">说到寻找痕迹——你注意到每条痕迹的颜色都变了吗？那是因为这些颜色是任意分配的。(当然是——我们还没有指定任何颜色映射！)这在某些情况下没问题，但我们可以做得更好。通常，一个数据源会有一种颜色，读者会将这种颜色与它联系起来。在这种情况下，为什么我们不给每条赛道分配颜色呢？</p><h2 id="11c2" class="mq lz it bd ma mr ms dn me mt mu dp mi lh mv mw mk ll mx my mm lp mz na mo nb bi translated">丰富多彩的语言</h2><p id="9b40" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">我包含了一个我整理好的字典文件，格式为<code class="fe nh ni nj nk b">{teamname: teamcolour}</code>。加载它:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="329f" class="mq lz it nk b gy np nq l nr ns">import pickle<br/>with open('srcdata/teamcolor_dict.pickle', 'rb') as f:<br/>    team_col_dict = pickle.load(f)</span></pre><p id="b05c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们使用列表理解来构建一个颜色列表，其顺序与我们上面使用的团队列表(<code class="fe nh ni nj nk b">tm_names</code>)的顺序相同:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="9b9e" class="mq lz it nk b gy np nq l nr ns">team_cols_list=[team_col_dict[tm] for tm in tm_names]</span></pre><p id="3642" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">简单地传递这个列表作为<code class="fe nh ni nj nk b">color_discrete_sequence</code>的一个参数:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="c0a5" class="mq lz it nk b gy np nq l nr ns">fig = px.scatter(records_df, x='games', y='wins', color='team', category_orders={'team': tm_names}, color_discrete_sequence=team_cols_list)<br/>fig.update_traces(mode='markers+lines')<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/83c36df0866c257a6b5dc6737be686a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U_0rdfGb2ssAFcbixBcpDw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">现在用队服！</p></figure><p id="361c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这并不完美——太多的队服颜色是深绿色和红色的变体。但是，至少现在更容易知道哪个跟踪可能指向哪个团队。</p><p id="fed9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还记得我们在上面看到的538图表吗？该图以去饱和灰色显示了大部分轨迹，有助于突出彩色轨迹。让我们试试类似的东西。</p><p id="11a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最简单的方法是修改我们传递的颜色列表。只需保持我们感兴趣的痕迹的颜色，并将所有其他颜色改为灰色。有很多方法可以做到这一点，但我通过构建一个全新的列表来做到这一点:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="543d" class="mq lz it nk b gy np nq l nr ns">base_col = '#C0C0C0'<br/>team_cols_list = list()<br/>for i in range(len(tm_names)):<br/>    tm = 'TORONTO_RAPTORS'<br/>    if tm_names[i] == tm:<br/>        team_cols_list.append(team_col_dict[tm])<br/>    else:<br/>        team_cols_list.append(base_col)</span></pre><p id="9ab9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以完全相同的方式绘制图表，您会看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/a7e7a7e0c9480b2409e536945fe93c30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VBd5U2xs8QZyLbC9s0s5IA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">特别强调一条线索(在这种情况下，是最终的NBA冠军)</p></figure><p id="f482" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">想突出多个痕迹？这很容易做到。再加上猛龙的赛区对手。</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="e94a" class="mq lz it nk b gy np nq l nr ns">base_col = '#C0C0C0'<br/>hero_teams = ['TORONTO_RAPTORS', 'PHILADELPHIA_76ERS', 'BOSTON_CELTICS', 'BROOKLYN_NETS', 'NEW_YORK_KNICKS']<br/>team_cols_list = list()<br/>for i in range(len(tm_names)):<br/>    if tm_names[i] in hero_teams:<br/>        tm = tm_names[i]<br/>        team_cols_list.append(team_col_dict[tm])<br/>    else:<br/>        team_cols_list.append(base_col)<br/>fig = px.scatter(records_df, x='games', y='wins', color='team', category_orders={'team': tm_names}, color_discrete_sequence=team_cols_list)<br/>fig.update_traces(mode='markers+lines')<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/ba6f65b79f8c5ea05234aa9e2852eea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sKs4sI-cHH1zYblJG2UqYA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">大西洋赛区记录(抱歉，尼克斯球迷)</p></figure><p id="1a0c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太好了，但是还有一个小问题。一些痕迹(像黑色的布鲁克林篮网的痕迹)被灰色的痕迹掩盖了。我理解这是由于Plotly渲染散点图的方式。轨迹实际上是在图例上从上到下呈现的。因为网队的名字出现在顶部，它被埋在底部。</p><p id="ab26" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以让我们改变一下我们队名的顺序。我们通过以不同的方式构造我们的团队名称列表来做到这一点——之后可以使用相同的剩余代码。</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="c814" class="mq lz it nk b gy np nq l nr ns">hero_teams = ['TORONTO_RAPTORS', 'PHILADELPHIA_76ERS', 'BOSTON_CELTICS', 'BROOKLYN_NETS', 'NEW_YORK_KNICKS']<br/>tm_names = [i for i in records_df.team.unique() if i not in hero_teams]<br/>tm_names.sort()<br/>tm_names = tm_names + hero_teams</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/5ce489f30339bb82bea376aa06880e85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCupoDJmm6lfC2ARCaqp6w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更好，对吗？(还是对不起尼克斯球迷)</p></figure><h1 id="f37a" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">收尾</h1><h2 id="b2e0" class="mq lz it bd ma mr ms dn me mt mu dp mi lh mv mw mk ll mx my mm lp mz na mo nb bi translated">支线剧情</h2><p id="8524" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">我们的情节开始看起来相当不错——所以让我们对它们做一些最后的润色。第一，我想比较一下联盟中的两个“联盟”，并强调一下西部的西南赛区。</p><p id="b29d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将分队添加到我们的列表中，并将<code class="fe nh ni nj nk b">‘conference’</code>传递给我们的<code class="fe nh ni nj nk b">facet_col</code>参数来创建两个支线剧情:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="9e08" class="mq lz it nk b gy np nq l nr ns"># Separate Conferences, and add highlights for<br/>hero_teams = [<br/>    'TORONTO_RAPTORS', 'PHILADELPHIA_76ERS', 'BOSTON_CELTICS', 'BROOKLYN_NETS', 'NEW_YORK_KNICKS',<br/>    'HOUSTON_ROCKETS', 'SAN_ANTONIO_SPURS', 'DALLAS_MAVERICKS', 'MEMPHIC_GRIZZLIES', 'NEW_ORLEANS_PELICANS'<br/>]<br/>tm_names = [i for i in records_df.team.unique() if i not in hero_teams]<br/>tm_names.sort()<br/>tm_names = tm_names + hero_teams<br/>team_cols_list = list()<br/>for i in range(len(tm_names)):<br/>    if tm_names[i] in hero_teams:<br/>        tm = tm_names[i]<br/>        team_cols_list.append(team_col_dict[tm])<br/>    else:<br/>        team_cols_list.append(base_col)<br/>fig = px.scatter(records_df, x='games', y='wins', color='team',<br/>                 category_orders={'team': tm_names}, color_discrete_sequence=team_cols_list, facet_col='conference')<br/>fig.update_traces(mode='markers+lines')<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/4b9b49997caa901b11b37953421ec444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asCj5EJyyU-PP3tusX-0cw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">支线剧情</p></figure><p id="557b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过将两组数据分成次要情节，我们可以立即看出两次会议之间有趣的对比。很明显，右边的支线剧情(西部联盟)包括更多的轨迹，这些轨迹以更高的比分结束，表明更多的球队赢得了更高的总比分。除了一个异常点，这张图表表明2018-19赛季联盟最差的球队主要在东部联盟。</p><h2 id="7572" class="mq lz it bd ma mr ms dn me mt mu dp mi lh mv mw mk ll mx my mm lp mz na mo nb bi translated">绘图主题/模板</h2><p id="d090" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">这真是太棒了，我刚刚才知道，所以我想在这里简单地分享一下——尽管我正在学习如何使用它们。Plotly包括一个“主题/模板”功能，允许您快速更改绘图的外观。</p><p id="ae07" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我可能会在另一篇文章中深入研究更多的细节，但是现在，请注意，传递模板参数将允许您改变许多绘图格式，例如:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="f80b" class="mq lz it nk b gy np nq l nr ns">fig = px.scatter(records_df, x='games', y='wins', color='team', category_orders={'team': tm_names},<br/>                 color_discrete_sequence=team_cols_list, facet_col='conference', <strong class="nk iu">template="plotly_white"</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/e051cbcf7b77c457ecf11ffb1d2e107c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FkPYgUIcyb8O825wQsxHgw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有“plotly_white”主题</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/79bf8dea5373acc2711f47663b0f2673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*po5weXnfyS60eVWbt2PAFg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“plotly_black”主题</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/714ac06b683def54c0cd5c9812e4f3b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VCNY44O1mIKmBiyyT_2urw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">也许你更像是一个ggplot2的人</p></figure><p id="d5c1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于我指定了轨迹的团队颜色，轨迹颜色没有改变，但是主题化也会改变默认的颜色图。点击查看<a class="ae lw" href="https://plot.ly/python/templates/" rel="noopener ugc nofollow" target="_blank">文档。</a></p><h2 id="16a9" class="mq lz it bd ma mr ms dn me mt mu dp mi lh mv mw mk ll mx my mm lp mz na mo nb bi translated">标题和字体大小</h2><p id="ee09" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">为了完整起见，这里有一个版本的图，标题、支线剧情名称和轴标题都经过了格式化处理——以产生一些接近我将在分析文章中使用的内容。</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="4dab" class="mq lz it nk b gy np nq l nr ns">fig = px.scatter(records_df, x='games', y='wins', color='team', category_orders={'team': tm_names},<br/>                 color_discrete_sequence=team_cols_list, facet_col='conference', template="ggplot2",<br/>                 title='2018-19 NBA Regular season wins',<br/>                 labels={'games': 'Games played', 'wins': 'Season Wins'}<br/>                 )<br/>fig.for_each_annotation(lambda t: t.update(text=t.text.replace('conference=', 'Conference: ')))<br/>fig.update_traces(mode='markers+lines')<br/>fig.show()</span></pre><p id="13d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">除了<code class="fe nh ni nj nk b">.for_each_annotation</code>方法之外，上述所有方法可能都非常简单。</p><p id="c2ef" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在这里做的是用我认为可读性更好的<code class="fe nh ni nj nk b">‘Conference: ‘</code>替换部分自动生成的支线剧情标题文本(比如<code class="fe nh ni nj nk b">‘conference=Eastern’</code>)。</p><p id="6d3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是由lambda函数完成的，其中Plotly的。for_each_annotation负责遍历每个注释对象并应用lambda。</p><p id="97ce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/fcb54d6c6c188ebf0920407aac78c535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xx-CU10umDLYEA8Z2wDx5A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这是我之前做的一个</p></figure><p id="5dd4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这看起来是非常简单的数据，但在这种形式下，数据比我们的第一个图更容易消化。如果你不相信我——只需向上滚动，看看我们生成的前两个图。我可以等。</p><p id="a755" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对吗？</p><p id="3964" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过突出个人的痕迹，我们不仅可以快速展示这些特定的团队是如何在会议的背景下被放置的，还可以展示他们自己的部门的海洋。每个轨迹的梯度显示了它们在季节的不同阶段经历的热(陡)或冷(平)条纹。</p><p id="e7a8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，在线Plotly图表提供了与鼠标悬停数据的交互性，这为用户提供了很好的服务，使他们不必在图表和图例之间来回切换。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/20ff1422c15368cac59c2453b25ee33e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3pCG9Beq7Q_5Mq6WIr8ctw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不要忘记交互性</p></figure></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><p id="b985" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于时间序列数据，我们几乎可以<em class="lu">做</em>无限多的事情，因此很难将数据跨时间可视化。如果做得不好，看起来实际上有无限的数据点和数据系列要绘制并传达给我们的读者。</p><p id="c4b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，能够从噪音中获取关键细节或信息是很重要的，对我来说，简单的东西会帮助你做到这一点——无论是颜色、比例、支线剧情还是其他什么。事实上，我经常发现一个关键的区别是不要让读者被信息淹没。事实证明，越少往往越多！</p><p id="a6a3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是我今天的全部内容——感谢您的阅读，如果您有任何建议或要求，请告诉我。</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><p id="7183" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢这个，比如说👋/关注<a class="ae lw" href="https://twitter.com/_jphwang" rel="noopener ugc nofollow" target="_blank">推特</a>，或点击此处获取更新。ICYMI:我还写了这篇关于用Plotly Dash构建web数据仪表板的文章。</p><div class="of og gp gr oh oi"><a rel="noopener follow" target="_blank" href="/build-a-web-data-dashboard-in-just-minutes-with-python-d722076aee2b"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">使用Python在几分钟内构建一个web数据仪表板</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">通过将您的数据可视化转换为基于web的仪表板，以指数方式提高功能和可访问性…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ks oi"/></div></div></a></div><p id="3b46" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另外，这是我写的另一篇关于可视化类别变量的文章:</p><div class="of og gp gr oh oi"><a rel="noopener follow" target="_blank" href="/processing-and-visualizing-multiple-categorical-variables-with-python-nbas-schedule-challenges-b48453bff813"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">用Python处理和可视化多个分类变量——NBA的赛程挑战</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">使用平行分类图和树形图来可视化、识别和比较多个输入变量在…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="ox l ot ou ov or ow ks oi"/></div></div></a></div></div></div>    
</body>
</html>