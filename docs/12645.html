<html>
<head>
<title>Using The Predictive Power Score in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 R 中的预测能力评分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-the-predictive-power-score-in-r-26c43d05dc01?source=collection_archive---------41-----------------------#2020-08-31">https://towardsdatascience.com/using-the-predictive-power-score-in-r-26c43d05dc01?source=collection_archive---------41-----------------------#2020-08-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="081c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">最近一个关于预测能力得分的帖子吸引了许多数据科学家的注意。让我们看看它是什么以及如何在 R 中使用它</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/bb6be1eca4b54ab8933c3ec31c5ee255.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*P_mRpc2KDdIuD5VJtIiteg.png"/></div></figure><p id="0600" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">最近几个月<a class="lm ln ep" href="https://medium.com/u/6ed760f28120?source=post_page-----26c43d05dc01--------------------------------" rel="noopener" target="_blank"> Florian Wetschoreck </a>在《走向数据科学》的媒体频道上发表了一篇文章，由于其极具煽动性的标题:<a class="ae lo" rel="noopener" target="_blank" href="/rip-correlation-introducing-the-predictive-power-score-3d90808b9598">“RIP correlation”，这篇文章在 LinkedIn </a>上吸引了许多数据科学家<a class="ae lo" href="https://www.linkedin.com/posts/florianwetschoreck_datascience-python-correlation-activity-6659121450919698432-TIRw" rel="noopener ugc nofollow" target="_blank">的注意。介绍预测能力评分"</a>。让我们看看它是什么，以及如何在 r 中使用它。</p><h1 id="06ba" class="lp lq it bd lr ls lt lu lv lw lx ly lz jz ma ka mb kc mc kd md kf me kg mf mg bi translated">预测能力得分的定义</h1><p id="30bb" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz mj lb lc ld mk lf lg lh ml lj lk ll im bi translated"><em class="mm">预测能力得分</em> (PPS)是一个标准化指数(范围从 0 到 1)，它告诉我们有多少变量<em class="mm"> x </em>(无论是数字还是分类)可用于预测变量<em class="mm"> y </em>(数字还是分类)。PPS 指数越高，变量<em class="mm"> x </em>在预测变量<em class="mm"> y </em>时越具有决定性。</p><p id="eee7" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">PPS 与相关系数在概念上的相似性是显而易见的，尽管存在以下差异:</p><ul class=""><li id="a540" class="mn mo it ks b kt ku kw kx kz mp ld mq lh mr ll ms mt mu mv bi translated">PPS 还检测<em class="mm"> x </em>和<em class="mm">y</em>之间的非线性关系</li><li id="3e40" class="mn mo it ks b kt mw kw mx kz my ld mz lh na ll ms mt mu mv bi translated">PPS 不是对称指数。这就意味着 PPS( <em class="mm"> x </em>、<em class="mm"> y </em> ) ≠ PPS( <em class="mm"> y </em>、<em class="mm"> x </em>)。换句话说，并不是说如果<em class="mm"> x </em>预测<em class="mm"> y </em>，那么<em class="mm"> y </em>也预测<em class="mm"> x </em>。</li><li id="f3ab" class="mn mo it ks b kt mw kw mx kz my ld mz lh na ll ms mt mu mv bi translated">PPS 允许数字和分类变量。</li></ul><p id="fd11" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">基本上，PPS 是一个非对称的非线性指数，适用于所有类型的变量进行预测。</p><p id="3a1e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在幕后，它实现决策树作为学习算法，因为它们对异常值和糟糕的数据预处理具有鲁棒性。</p><p id="a488" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">分数是在 sci kit-learn<a class="ae lo" href="https://scikit-learn.org/stable/modules/cross_validation.html" rel="noopener ugc nofollow" target="_blank"><em class="mm">cross _ val _ score</em></a>函数给出的默认 4 重交叉验证的测试集上计算的，并根据目标变量定义的问题类型(<em class="mm">回归</em>或<em class="mm">分类</em>)由不同的度量给出:</p><ul class=""><li id="be30" class="mn mo it ks b kt ku kw kx kz mp ld mq lh mr ll ms mt mu mv bi translated"><strong class="ks iu">回归</strong>:给定<em class="mm"> y </em>的“原始”值基线，将平均绝对误差(MAE)归一化为目标变量的中值。</li><li id="5077" class="mn mo it ks b kt mw kw mx kz my ld mz lh na ll ms mt mu mv bi translated"><strong class="ks iu">分类</strong>:给定作为目标变量最常见值或随机值计算的<em class="mm"> y </em>的“原始”值基线(有时，随机值比最常见值具有更高的 F1)，归一化到[0，1]区间的加权 F1。</li></ul><p id="0da7" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">你可以深入了解 Python 代码的细节，这要归功于预测能力评分项目在 Github 上作为<a class="ae lo" href="https://github.com/8080labs/ppscore" rel="noopener ugc nofollow" target="_blank">开源发布的事实。</a></p><h1 id="951c" class="lp lq it bd lr ls lt lu lv lw lx ly lz jz ma ka mb kc mc kd md kf me kg mf mg bi translated">皮尔逊相关与 PPS</h1><p id="8cc5" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz mj lb lc ld mk lf lg lh ml lj lk ll im bi translated">这两个指数来自不同的领域，必须进行基本区分:</p><ul class=""><li id="a523" class="mn mo it ks b kt ku kw kx kz mp ld mq lh mr ll ms mt mu mv bi translated"><strong class="ks iu">皮尔逊相关性</strong>由两个数值变量之间的归一化协方差给出。协方差取决于两个变量相对于各自均值的偏差，因此它是一种统计度量。给定两个数值变量，Pearson correlation 是一个描述性指标<em class="mm">在数学上得到很好的定义</em>，它给出了描述变量之间关系的最佳线性函数的拟合优度。</li><li id="7b10" class="mn mo it ks b kt mw kw mx kz my ld mz lh na ll ms mt mu mv bi translated"><strong class="ks iu"> PPS </strong>试图通过应用决策树估计来解决相关性分析中仅测量线性相关性和仅测量数字变量的问题。它来源于该评估的性能指标。在撰写本文时(版本 1.1.0)，默认情况下，它从输入数据集中获得一个 5000 行的随机样本(如果需要，可以分层)，以加快计算速度(样本的大小可以使用适当的参数进行修改)。没有进行任何调整来获得决策树的最佳模型参数。因此，存在过度配合或配合不足的可能性。此外，由于算法固有的随机性(随机种子可用于保证结果的可重复性)，在同一数据集上每次运行时，PPS 结果可能不同。所以，PPS 可能不准确。但是它的目的不是给出一个精确的分数，而是给出依赖的一般概念和一个快速的结果。</li></ul><p id="2092" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这两个索引都应该在勘探数据分析阶段使用。正如同一位作者所说:</p><blockquote class="nb"><p id="0cd9" class="nc nd it bd ne nf ng nh ni nj nk ll dk translated">对于<strong class="ak">在数据中寻找预测模式</strong>而言，PPS 明显优于相关性。然而，一旦发现了模式，相关性仍然是<strong class="ak">传达发现的线性关系的一个很好的方式</strong>。</p></blockquote><h1 id="1c2f" class="lp lq it bd lr ls lt lu lv lw lx ly lz jz nl ka mb kc nm kd md kf nn kg mf mg bi translated">PPS 使用案例</h1><p id="4eea" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz mj lb lc ld mk lf lg lh ml lj lk ll im bi translated">作者在他的文章中列出了几个 PPS 可能增加价值的用例<a class="ae lo" rel="noopener" target="_blank" href="/rip-correlation-introducing-the-predictive-power-score-3d90808b9598">:</a></p><ul class=""><li id="6d79" class="mn mo it ks b kt ku kw kx kz mp ld mq lh mr ll ms mt mu mv bi translated">查找关联找到的每一个关系，甚至更多</li><li id="2de0" class="mn mo it ks b kt mw kw mx kz my ld mz lh na ll ms mt mu mv bi translated">特征选择</li><li id="4b26" class="mn mo it ks b kt mw kw mx kz my ld mz lh na ll ms mt mu mv bi translated">检测信息泄漏</li><li id="08ea" class="mn mo it ks b kt mw kw mx kz my ld mz lh na ll ms mt mu mv bi translated">通过将 PPS 矩阵解释为有向图，找到数据中的实体结构。</li></ul><h1 id="c56c" class="lp lq it bd lr ls lt lu lv lw lx ly lz jz ma ka mb kc mc kd md kf me kg mf mg bi translated">如何在自己的研发项目中使用 PPS</h1><blockquote class="no np nq"><p id="06a9" class="kq kr mm ks b kt ku ju kv kw kx jx ky nr la lb lc ns le lf lg nt li lj lk ll im bi translated">【https://github.com/paulvanderlaken/ppsr】更新:2020 年 12 月下旬研发出 R 专用包:<a class="ae lo" href="https://github.com/paulvanderlaken/ppsr" rel="noopener ugc nofollow" target="_blank"/></p></blockquote><p id="fe99" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如前所述，项目<em class="mm"> ppscore </em>是开源的，它是用 Python 开发的。R 中目前没有<em class="mm"> ppscore </em>的移植项目，那么如何在 R 脚本中使用<em class="mm"> ppscore </em>函数呢？由于为 Python 和 R 之间的互操作性而创建的一些库，可以将 R 的强大功能与 Python 的编程能力结合起来使用，反之亦然。在其他库中，有两个库使用最广泛:</p><ul class=""><li id="efc3" class="mn mo it ks b kt ku kw kx kz mp ld mq lh mr ll ms mt mu mv bi translated"><strong class="ks iu"> rpy2: </strong>嵌入在 Python 进程中的 R running 接口</li><li id="d55c" class="mn mo it ks b kt mw kw mx kz my ld mz lh na ll ms mt mu mv bi translated"><strong class="ks iu"> reticulate: </strong>由于在 R sessions 中嵌入了 Python 会话，这是一套用于 Python 和 R 之间互操作性的综合工具</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi nu"><img src="../Images/f96d6f0b77beb9c54a15186da64aa94f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MzKABRg30nB86O96M4mqVg.png"/></div></div><p class="nz oa gj gh gi ob oc bd b be z dk translated">图 1——得益于 rpy2 和 reticulate，Python 和 R 之间的互操作性</p></figure><p id="e6d6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在我们的场景中，<em class="mm"> reticulate </em>将允许从 R 脚本中调用<em class="mm"> ppscore </em>函数。</p><h2 id="4f77" class="od lq it bd lr oe of dn lv og oh dp lz kz oi oj mb ld ok ol md lh om on mf oo bi translated">为 ppscore 准备单独的 Python 环境</h2><p id="acd6" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz mj lb lc ld mk lf lg lh ml lj lk ll im bi translated">首先，如果你没有在你的机器上安装 Python，我建议安装<a class="ae lo" href="https://docs.conda.io/en/latest/miniconda.html" rel="noopener ugc nofollow" target="_blank"><em class="mm">Miniconda</em></a>(Anaconda 的一个小的引导版本，只包括 conda、Python 和少数其他有用的包)，如果是 Windows 机器，让安装程序将 Python 安装路径添加到你的 path 环境变量中。</p><p id="438b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Python 开发者通常使用虚拟环境。虚拟环境是一种工具，通过创建包含特定 Python 版本的 Python 安装以及许多附加包的自包含目录树，有助于将不同项目所需的依赖关系分开。Conda 是一个帮助管理环境和包的工具。</p><p id="4535" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在这种情况下，将创建一个新的 Python 环境，以便在其上安装<em class="mm"> ppscore </em>所需的包。您可以使用下面的 R 脚本为<em class="mm"> ppscore </em>库准备一个新的 Python 环境:</p><pre class="kj kk kl km gt op oq or os aw ot bi"><span id="2a10" class="od lq it oq b gy ou ov l ow ox"># Install reticulate<br/>if( !require(reticulate) ) {<br/>  install.packages("reticulate")<br/>}</span><span id="d0bc" class="od lq it oq b gy oy ov l ow ox"># Load reticulate<br/>library(reticulate)</span><span id="eb1c" class="od lq it oq b gy oy ov l ow ox"># List current python environments<br/>conda_list()</span><span id="fe9a" class="od lq it oq b gy oy ov l ow ox"># Create a new environemnt called 'test_ppscore'<br/>conda_create(envname = "test_ppscore")</span><span id="d304" class="od lq it oq b gy oy ov l ow ox"># Install the ppscore package and its dependencies using pip into the test_ppscore environment.<br/># Requirements are listed here: <a class="ae lo" href="https://github.com/8080labs/ppscore/blob/master/requirements.txt" rel="noopener ugc nofollow" target="_blank">https://github.com/8080labs/ppscore/blob/master/requirements.txt</a><br/>conda_install(envname = "test_ppscore", packages = "pandas", pip = TRUE)<br/>conda_install(envname = "test_ppscore", packages = "scikit-learn", pip = TRUE)<br/>conda_install(envname = "test_ppscore", packages = "ppscore", pip = TRUE)</span><span id="727d" class="od lq it oq b gy oy ov l ow ox"># Check if the new environment is now listed<br/>conda_list()</span><span id="1542" class="od lq it oq b gy oy ov l ow ox"># Make sure to use the new environment<br/>use_condaenv("test_ppscore")</span><span id="4814" class="od lq it oq b gy oy ov l ow ox"># Import the ppscore Python module in your R session<br/>pps &lt;- import(module = "ppscore")</span></pre><p id="1d23" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Python 模块和类中的函数和其他数据可以通过<code class="fe oz pa pb oq b">$</code>操作符访问(以及与 R 列表交互)。导入的 Python 模块支持代码完成和内联帮助。例如，<em class="mm"> pps </em>模块中的<code class="fe oz pa pb oq b">matrix</code>功能可通过以下方式访问:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/22ba0d5dcf8cfa61bb1fd994c90f15f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*fLSSs4McHkclAyld6r0C3w.png"/></div><p class="nz oa gj gh gi ob oc bd b be z dk translated">图 2 — pps 模块的矩阵功能</p></figure><p id="d7fb" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你想了解更多关于<em class="mm">网纹</em>的信息，你可以通过<a class="ae lo" href="https://rstudio.github.io/reticulate/index.html" rel="noopener ugc nofollow" target="_blank">它的主页</a>。</p><h2 id="76a9" class="od lq it bd lr oe of dn lv og oh dp lz kz oi oj mb ld ok ol md lh om on mf oo bi translated">《泰坦尼克号》预测因子和可变重要性的 PPScore 热图</h2><p id="ef9f" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz mj lb lc ld mk lf lg lh ml lj lk ll im bi translated">从作者包含在资源库中的<a class="ae lo" href="https://github.com/8080labs/ppscore/blob/master/examples/titanic_dataset.py" rel="noopener ugc nofollow" target="_blank">示例</a>开始，可以使用<code class="fe oz pa pb oq b">matrix</code>函数复制 Titanic PPScore 热图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi pd"><img src="../Images/23092eda2f95b899d8f2048763a0a570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gMmtTcwvoonr2bvAzm1mBw.png"/></div></div><p class="nz oa gj gh gi ob oc bd b be z dk translated">图 3 — PPScore 热图</p></figure><p id="c25a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">给定目标“幸存”的变量重要性可通过适当过滤由<code class="fe oz pa pb oq b">matrix</code>函数给出的输出(预测器之间的完全相互作用)获得。但是也可以直接使用<code class="fe oz pa pb oq b">predictor</code>函数直接得到相同的结果，注意在两个函数中使用相同的<code class="fe oz pa pb oq b">random_seed</code>参数，以避免得到不同的结果。</p><p id="746b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">给定目标变量“存活”的变量重要性图如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi pd"><img src="../Images/663c997a8ae5d8a42fba2e9e8cc0bd43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*diSCLdy2r8tXTQvoSl_qIg.png"/></div></div><p class="nz oa gj gh gi ob oc bd b be z dk translated">图 4 —使用 PPS 的可变重要性图</p></figure><p id="887e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">用于获得上述图的 R 代码如下:</p><pre class="kj kk kl km gt op oq or os aw ot bi"><span id="0eed" class="od lq it oq b gy ou ov l ow ox">library(reticulate)<br/>library(readr)<br/>library(dplyr)<br/>library(ggplot2)</span><span id="20ea" class="od lq it oq b gy oy ov l ow ox">heatmap &lt;- function(df, x, y, value,<br/>                    main_title = "Heatmap", legend_title = "Value",<br/>                    x_title = "feature", y_title = "target") {<br/>  <br/>  x_quo &lt;- enquo(x)<br/>  y_quo &lt;- enquo(y)<br/>  value_quo &lt;- enquo(value)<br/>  <br/>  res &lt;- ggplot( df, aes(x = !!x_quo, y = !!y_quo, fill = !!value_quo) ) +<br/>    geom_tile(color = "white") +<br/>    scale_fill_gradient2(low = "white", high = "steelblue",<br/>                         limit = c(0,1), space = "Lab", <br/>                         name="PPScore") +<br/>    theme_minimal()+ # minimal theme<br/>    # theme(axis.text.x = element_text(angle = 45, vjust = 1, <br/>    #                                  size = 12, hjust = 1)) +<br/>    coord_fixed() +<br/>    geom_text(aes(x, y, label = round(!!value_quo, 2)), color = "black", size = 4) +<br/>    theme(<br/>      axis.text.x = element_text(angle = 45, vjust = 1, <br/>                                 size = 12, hjust = 1),<br/>      axis.text.y = element_text(size = 12),<br/>      panel.grid.major = element_blank(),<br/>      panel.border = element_blank(),<br/>      panel.background = element_blank(),<br/>      axis.ticks = element_blank()<br/>    ) +<br/>    xlab(x_title) +<br/>    ylab(y_title) +<br/>    labs(fill = legend_title) +<br/>    guides(fill = guide_colorbar(barwidth = 1, barheight = 10,<br/>                                 title.position = "top", title.hjust = 1)) +<br/>    ggtitle(main_title)<br/>  <br/>  return(res)<br/>  <br/>}</span><span id="f764" class="od lq it oq b gy oy ov l ow ox">lollipop &lt;- function(df, x, y,<br/>                     main_title = "Variable Importance",<br/>                     x_title = "PPScore", y_title = "Predictors",<br/>                     caption_title = "Data from Titanic dataset") {<br/>  <br/>  x_quo &lt;- enquo(x)<br/>  y_quo &lt;- enquo(y)<br/>  <br/>  <br/>  res &lt;- ggplot(df, aes(x=!!x_quo, y=forcats::fct_reorder(!!y_quo, !!x_quo, .desc=FALSE))) +<br/>    geom_segment( aes(x = 0,<br/>                      y=forcats::fct_reorder(!!y_quo, !!x_quo, .desc=FALSE),<br/>                      xend = !!x_quo,<br/>                      yend = forcats::fct_reorder(!!y_quo, !!x_quo, .desc=FALSE)),<br/>                  color = "gray50") +<br/>    geom_point( color = "darkorange" ) +<br/>    labs(x = x_title, y = y_title,<br/>         title = main_title,<br/>         #subtitle = "subtitle",<br/>         caption = caption_title) +<br/>    theme_minimal() +<br/>    geom_text(aes(label=round(!!x_quo, 2)), hjust=-.5, size = 3.5<br/>    ) +<br/>    theme(panel.border = element_blank(), <br/>          panel.grid.major = element_blank(),<br/>          panel.grid.minor = element_blank(), <br/>          axis.line = element_blank(),<br/>          axis.text.x = element_blank())<br/>  <br/>  return(res)<br/>  <br/>}</span><span id="e111" class="od lq it oq b gy oy ov l ow ox">df &lt;- read_csv("<a class="ae lo" href="https://raw.githubusercontent.com/8080labs/ppscore/master/examples/titanic.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/8080labs/ppscore/master/examples/titanic.csv</a>")</span><span id="c5b1" class="od lq it oq b gy oy ov l ow ox">df &lt;- df %&gt;% <br/>  mutate( Survived = as.factor(Survived) ) %&gt;% <br/>  mutate( across(where(is.character), as.factor) ) %&gt;% <br/>  select(<br/>    Survived,<br/>    Class = Pclass,<br/>    Sex,<br/>    Age,<br/>    TicketID = Ticket,<br/>    TicketPrice = Fare,<br/>    Port = Embarked<br/>  )</span><span id="fbd3" class="od lq it oq b gy oy ov l ow ox">use_condaenv("test_ppscore")</span><span id="17ab" class="od lq it oq b gy oy ov l ow ox">pps &lt;- import(module = "ppscore")</span><span id="6b25" class="od lq it oq b gy oy ov l ow ox"># PPScore heatmap<br/>score &lt;- pps$matrix(df = df, random_seed = 1234L)</span><span id="b21b" class="od lq it oq b gy oy ov l ow ox">score %&gt;% heatmap(x = x, y = y, value = ppscore,<br/>                  main_title = "PPScore for Titanic's predictors", legend_title = "PPScore")</span><span id="d69d" class="od lq it oq b gy oy ov l ow ox"># Variable importance<br/>vi &lt;- pps$predictors( df = df, y = "Survived", random_seed = 1234L)</span><span id="762c" class="od lq it oq b gy oy ov l ow ox">vi %&gt;%<br/>  mutate( x = as.factor(x) ) %&gt;%<br/>  lollipop( ppscore, x,<br/>            main_title = "Variable Importance for target = 'Survived'",<br/>            x_title = "PPScore", y_title = "Predictors",<br/>            caption_title = "Data from Titanic dataset")</span></pre><h2 id="e776" class="od lq it bd lr oe of dn lv og oh dp lz kz oi oj mb ld ok ol md lh om on mf oo bi translated">PPS 和与各种分布的相关性</h2><p id="2620" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz mj lb lc ld mk lf lg lh ml lj lk ll im bi translated">Denis Boigelot 在 Wikimedia Commons 上发布了一张关于<a class="ae lo" href="https://commons.wikimedia.org/w/index.php?curid=15165296" rel="noopener ugc nofollow" target="_blank"> Pearson 关联示例</a>的非常著名的图片，并分享了用于获得这张图片的 R 代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi pe"><img src="../Images/b69fae9082d4690b45ba9a8a99b0b4a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6qRv8H3gpKuzPHfw.png"/></div></div><p class="nz oa gj gh gi ob oc bd b be z dk translated">图 Boigelot 分布的皮尔逊相关性</p></figure><p id="750f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">从这段代码开始，可以计算相同分布的 PPScore。这里是 X→Y 的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi pe"><img src="../Images/4ab79a924ae02a2bf3322f828518a1f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R_YL9xWbJnbeNWgJJtvhRQ.png"/></div></div><p class="nz oa gj gh gi ob oc bd b be z dk translated">图 Boigelot 分布中“x 预测 y”的 PPScore</p></figure><p id="f2bb" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这里是 Y→X 的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi pe"><img src="../Images/584e0eb7b9f17016b61b4929b878e7b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e7vbNaFMg9ixLWj8uYCzVw.png"/></div></div><p class="nz oa gj gh gi ob oc bd b be z dk translated">图 Boigelot 分布中“y 预测 x”的 PPScore</p></figure><p id="f02d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">很明显，在写这篇文章的时候</p><blockquote class="nb"><p id="69ab" class="nc nd it bd ne nf ng nh ni nj nk ll dk translated">PPScore 很难在原点线存在最小离散点的情况下确定线性关系(如前面图片中黄色和红色突出显示的)。</p></blockquote><p id="452e" class="pw-post-body-paragraph kq kr it ks b kt pf ju kv kw pg jx ky kz ph lb lc ld pi lf lg lh pj lj lk ll im bi translated">这些案例表明</p><blockquote class="nb"><p id="2c1d" class="nc nd it bd ne nf ng nh ni nj nk ll dk translated">为了避免得出错误的结论，使用相关指数来检查线性是多么重要。</p></blockquote><p id="3ca1" class="pw-post-body-paragraph kq kr it ks b kt pf ju kv kw pg jx ky kz ph lb lc ld pi lf lg lh pj lj lk ll im bi translated">我与作者分享了这些结果，他证实他们正在研究解决线性关系问题的解决方案。他还在这个环节分享了为什么 PPScore 1.1.0 不能很好地处理线性关系<a class="ae lo" href="https://github.com/8080labs/ppscore/issues/37" rel="noopener ugc nofollow" target="_blank">的原因。</a></p><p id="866e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">相反，PPScore 在 Pearson 相关性不足的一些分布上提供了良好的结果(如前面图片中绿色突出显示的)。</p><p id="8004" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">用于获得上述 Boigelot 发行版的 R 代码如下:</p><pre class="kj kk kl km gt op oq or os aw ot bi"><span id="8321" class="od lq it oq b gy ou ov l ow ox"># Install packages<br/>pkgs &lt;- c("dplyr","ggplot2","ggpubr","mvtnorm")</span><span id="6251" class="od lq it oq b gy oy ov l ow ox">for (pkg in pkgs) {<br/>  if (! (pkg %in% rownames(installed.packages()))) { install.packages(pkg) }<br/>}</span><span id="8af2" class="od lq it oq b gy oy ov l ow ox"># Load packages<br/>library(mvtnorm)<br/>library(dplyr)<br/>library(ggplot2)<br/>library(ggpubr)<br/>library(reticulate)</span><span id="6d14" class="od lq it oq b gy oy ov l ow ox"># Functions<br/>MyPlot &lt;- function(xy, xlim = c(-4, 4), ylim = c(-4, 4), eps = 1e-15,<br/>                    metric = c("cor", "ppsxy", "ppsyx")) {<br/>  <br/>  metric &lt;- metric[1]<br/>  <br/>  df &lt;- as.data.frame(xy)<br/>  names(df) &lt;- c("x", "y")<br/>  <br/>  <br/>  if (metric == "cor") {<br/>    <br/>    value &lt;- round(cor(xy[,1], xy[,2]), 1)<br/>    <br/>    if (sd(xy[,2]) &lt; eps) {<br/>      <br/>      #title &lt;- bquote("corr = " * "undef") # corr. coeff. is undefined<br/>      title &lt;- paste0("corr = NA") # corr. coeff. is undefined<br/>      <br/>    } else {<br/>      #title &lt;- bquote("corr = " * .(value))<br/>      title &lt;- paste0("corr = ", value)<br/>    }<br/>    <br/>    subtitle &lt;- NULL<br/>    <br/>  } else if (metric == "ppsxy") {<br/>    <br/>    pps_df &lt;- pps$matrix(df = df, random_seed = 1111L)<br/>    <br/>    value &lt;- pps_df %&gt;% <br/>      filter( x == "x" &amp; y == "y" ) %&gt;% <br/>      mutate( ppscore = round(ppscore, 1) ) %&gt;% <br/>      pull(ppscore)<br/>    <br/>    title &lt;- bquote("pps"[X%-&gt;%Y] * " = " * .(value))<br/>    <br/>    subtitle &lt;- NULL<br/>    <br/>  } else if (metric == "ppsyx") {<br/>    <br/>    pps_df &lt;- pps$matrix(df = df, random_seed = 1111L)<br/>    <br/>    value &lt;- pps_df %&gt;% <br/>      filter( x == "y" &amp; y == "x" ) %&gt;% <br/>      mutate( ppscore = round(ppscore, 1) ) %&gt;% <br/>      pull(ppscore)<br/>    <br/>    title &lt;- bquote("pps"[Y%-&gt;%X] * " = " * .(value))<br/>    <br/>    subtitle &lt;- NULL<br/>    <br/>  }<br/>  <br/>  ggplot(df, aes(x, y)) +<br/>    geom_point( color = "darkblue", size = 0.2 ) +<br/>    xlim(xlim) +<br/>    ylim(ylim) +<br/>    labs(title = title,<br/>         subtitle = subtitle) +<br/>    theme_void() +<br/>    theme( plot.title = element_text(size = 10, hjust = .5) )<br/>  <br/>}</span><span id="dd88" class="od lq it oq b gy oy ov l ow ox">MvNormal &lt;- function(n = 1000, cor = 0.8, metric = c("cor", "ppsxy", "ppsyx")) {<br/>  <br/>  metric &lt;- metric[1]<br/>  <br/>  res &lt;- list()<br/>  j &lt;- 0<br/>  <br/>  for (i in cor) {<br/>    sd &lt;- matrix(c(1, i, i, 1), ncol = 2)<br/>    x &lt;- rmvnorm(n, c(0, 0), sd)<br/>    j &lt;- j + 1<br/>    name &lt;- paste0("p", j)<br/>    res[[name]] &lt;- MyPlot(x, metric = metric)<br/>  }<br/>  <br/>  return(res)<br/>}</span><span id="7af1" class="od lq it oq b gy oy ov l ow ox">rotation &lt;- function(t, X) return(X %*% matrix(c(cos(t), sin(t), -sin(t), cos(t)), ncol = 2))</span><span id="dfc1" class="od lq it oq b gy oy ov l ow ox">RotNormal &lt;- function(n = 1000, t = pi/2, metric = c("cor", "ppsxy", "ppsyx")) {<br/>  <br/>  metric &lt;- metric[1]<br/>  <br/>  sd &lt;- matrix(c(1, 1, 1, 1), ncol = 2)<br/>  x &lt;- rmvnorm(n, c(0, 0), sd)<br/>  <br/>  res &lt;- list()<br/>  j &lt;- 0<br/>  <br/>  for (i in t) {<br/>    j &lt;- j + 1<br/>    name &lt;- paste0("p", j)<br/>    res[[name]] &lt;- MyPlot(rotation(i, x), metric = metric)<br/>  }<br/>  <br/>  return(res)</span><span id="de15" class="od lq it oq b gy oy ov l ow ox">}</span><span id="1063" class="od lq it oq b gy oy ov l ow ox">Others &lt;- function(n = 1000, metric = c("cor", "ppsxy", "ppsyx")) {<br/>  <br/>  metric &lt;- metric[1]<br/>  <br/>  res &lt;- list()<br/>  <br/>  x &lt;- runif(n, -1, 1)<br/>  y &lt;- 4 * (x^2 - 1/2)^2 + runif(n, -1, 1)/3<br/>  res[["p1"]] &lt;- MyPlot(cbind(x,y), xlim = c(-1, 1), ylim = c(-1/3, 1+1/3), metric = metric)<br/>  <br/>  y &lt;- runif(n, -1, 1)<br/>  xy &lt;- rotation(-pi/8, cbind(x,y))<br/>  lim &lt;- sqrt(2+sqrt(2)) / sqrt(2)<br/>  res[["p2"]] &lt;- MyPlot(xy, xlim = c(-lim, lim), ylim = c(-lim, lim), metric = metric)<br/>  <br/>  xy &lt;- rotation(-pi/8, xy)<br/>  res[["p3"]] &lt;- MyPlot(xy, xlim = c(-sqrt(2), sqrt(2)), ylim = c(-sqrt(2), sqrt(2)), metric = metric)<br/>  <br/>  y &lt;- 2*x^2 + runif(n, -1, 1)<br/>  res[["p4"]] &lt;- MyPlot(cbind(x,y), xlim = c(-1, 1), ylim = c(-1, 3), metric = metric)<br/>  <br/>  y &lt;- (x^2 + runif(n, 0, 1/2)) * sample(seq(-1, 1, 2), n, replace = TRUE)<br/>  res[["p5"]] &lt;- MyPlot(cbind(x,y), xlim = c(-1.5, 1.5), ylim = c(-1.5, 1.5), metric = metric)<br/>  <br/>  y &lt;- cos(x*pi) + rnorm(n, 0, 1/8)<br/>  x &lt;- sin(x*pi) + rnorm(n, 0, 1/8)<br/>  res[["p6"]] &lt;- MyPlot(cbind(x,y), xlim = c(-1.5, 1.5), ylim = c(-1.5, 1.5), metric = metric)<br/>  <br/>  xy1 &lt;- rmvnorm(n/4, c( 3,  3))<br/>  xy2 &lt;- rmvnorm(n/4, c(-3,  3))<br/>  xy3 &lt;- rmvnorm(n/4, c(-3, -3))<br/>  xy4 &lt;- rmvnorm(n/4, c( 3, -3))<br/>  res[["p7"]] &lt;- MyPlot(rbind(xy1, xy2, xy3, xy4), xlim = c(-3-4, 3+4), ylim = c(-3-4, 3+4), metric = metric)<br/>  <br/>  return(res)<br/>}</span><span id="6672" class="od lq it oq b gy oy ov l ow ox">output &lt;- function( metric = c("cor", "ppsxy", "ppsyx") ) {<br/>  <br/>  metric &lt;- metric[1]<br/>  <br/>  plots1 &lt;- MvNormal( n = 800, cor = c(1.0, 0.8, 0.4, 0.0, -0.4, -0.8, -1.0), metric = metric );<br/>  plots2 &lt;- RotNormal(200, c(0, pi/12, pi/6, pi/4, pi/2-pi/6, pi/2-pi/12, pi/2), metric = metric);<br/>  plots3 &lt;- Others(800, metric = metric)<br/>  <br/>  ggarrange(<br/>    plots1$p1, plots1$p2, plots1$p3, plots1$p4, plots1$p5, plots1$p6, plots1$p7,<br/>    plots2$p1, plots2$p2, plots2$p3, plots2$p4, plots2$p5, plots2$p6, plots2$p7,<br/>    plots3$p1, plots3$p2, plots3$p3, plots3$p4, plots3$p5, plots3$p6, plots3$p7,<br/>    <br/>    ncol = 7, nrow = 3<br/>  )<br/>  <br/>}</span><span id="d7ad" class="od lq it oq b gy oy ov l ow ox">#-- Main -------------------------------------<br/>use_condaenv("test_ppscore")</span><span id="ebc1" class="od lq it oq b gy oy ov l ow ox">pps &lt;- import(module = "ppscore")</span><span id="36f5" class="od lq it oq b gy oy ov l ow ox">output( metric = "cor" )<br/>output( metric = "ppsxy" )<br/>output( metric = "ppsyx" )</span></pre><h1 id="7535" class="lp lq it bd lr ls lt lu lv lw lx ly lz jz ma ka mb kc mc kd md kf me kg mf mg bi translated">结论</h1><p id="c6a7" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz mj lb lc ld mk lf lg lh ml lj lk ll im bi translated">Florian Wetschoreck 提出的预测能力得分(PPS)指数试图帮助数据科学家给出提示，在项目的 EDA 阶段找到两个变量之间的任何类型的关系，无论它们是数字还是类别。PPS 可能不准确，但它的目的不是给出一个精确的分数，而是给出两个变量之间依赖关系的一般概念和一个快速的结果。</p><p id="4eb2" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">使用 Boigelot 分布表明，PPS(当前版本为 1.1.0)能够识别相关性指数无法识别的非线性关系。相反，PPS 似乎很难识别线性关系，即使这些点与原点线的离散度很小。</p><p id="fffe" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">虽然 PPScore 是用 Python 开发的，但由于有了<em class="mm"> reticulate </em>，它的函数也可以用在 R 脚本中。</p><p id="d992" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="ks iu">更新</strong>。<em class="mm">一个 R 专用的包已经在 2020 年 12 月下旬开发出来，你可以在这里找到:</em><a class="ae lo" href="https://github.com/paulvanderlaken/ppsr" rel="noopener ugc nofollow" target="_blank"><em class="mm">https://github.com/paulvanderlaken/ppsr</em></a></p><p id="8e68" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">所有的代码都可以在<a class="ae lo" href="https://github.com/lucazav/ppscore-in-r" rel="noopener ugc nofollow" target="_blank">这个 Github 库</a>上找到。</p></div></div>    
</body>
</html>