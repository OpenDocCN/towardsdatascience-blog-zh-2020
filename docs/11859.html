<html>
<head>
<title>How to build a search engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何建立一个搜索引擎</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-a-search-engine-9f8ffa405eac?source=collection_archive---------3-----------------------#2020-08-17">https://towardsdatascience.com/how-to-build-a-search-engine-9f8ffa405eac?source=collection_archive---------3-----------------------#2020-08-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8df0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用几行代码在 Python 中创建健壮的全文搜索</h2></div><p id="ee94" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章概述了当今使用的最重要的搜索算法之一，并展示了如何用几行代码用 Python 实现它。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/232f489843ad71dc6a325183aa7abe43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S7KyjW15fbG1O6Z6j-0prw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">来源:作者</p></figure><h2 id="8473" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">搜索的价值</h2><p id="4f3c" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">我们认为搜索数据的能力是理所当然的。现代搜索引擎现在如此复杂，以至于我们的大部分搜索“刚刚好”。事实上，我们经常只注意到网站或应用程序上的搜索没有执行。我们对这一领域的期望从未如此之高。</p><p id="db1e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">搜索引擎的智能一直在增长，原因很简单，一个有效的搜索工具能给企业带来的价值是巨大的；一项重要的知识产权。搜索栏通常是客户和企业之间的主要界面。因此，一个好的搜索引擎可以通过改善用户体验来创造竞争优势。</p><p id="0a5f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">MckKinsey 估计，2009 年这一价值在全球范围内总计达到 7800 亿美元。这将使每次搜索的价值为 0.50 美元[1]。当然，自 2009 年以来，这一数值无疑有了大幅增长…</p><p id="6b4b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">考虑到这一点，创建一个现代搜索引擎超出了大多数开发团队的能力，需要大量的资源和复杂的算法，这是可以理解的。然而，有点令人惊讶的是，大量的企业业务搜索引擎实际上是由非常简单和直观的规则驱动的，这些规则可以使用开源软件轻松实现。</p><p id="6381" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，优步、Udemy Slack 和 Shopify(以及 3000 家其他企业和组织[2])都在使用 Elasticsearch。直到 2016 年，这个搜索引擎都是由极其简单的<em class="le">词频、逆文档频率</em>(或 tf-idf)单词分数驱动的。[3](关于这是什么的更多细节，我已经在这里和这里写了关于 tf-idf <a class="ae mt" rel="noopener" target="_blank" href="/supercharging-word-vectors-be80ee5513d">。</a></p><p id="81eb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这之后，它切换到更复杂(但仍然非常简单)的 BM25，这种 BM25 一直沿用至今。这也是 Azure 认知搜索中实现的算法[4]。</p><h2 id="dc1d" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">BM25:你从未听说过的最重要的算法</h2><p id="b1d7" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">那么 BM25 是什么呢？它代表“最佳匹配 25”(其他 24 次尝试显然不太成功)。它是在 1994 年第三届文本检索会议上发布的，是的，的确有一个致力于文本检索的会议…</p><p id="fb8d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它可能被认为是 tf-idf 的“兴奋剂”，实现了两个关键的改进:</p><ul class=""><li id="f5a9" class="mu mv it kk b kl km ko kp kr mw kv mx kz my ld mz na nb nc bi translated"><strong class="kk iu">项频率饱和</strong>。BM25 为与文档匹配的术语数量提供递减的回报。这是相当直观的，如果你想搜索一个在文档中非常常见的特定术语，那么这个术语的出现次数对搜索来说就变得不那么有用了。</li><li id="a437" class="mu mv it kk b kl nd ko ne kr nf kv ng kz nh ld mz na nb nc bi translated"><strong class="kk iu">公文长度。</strong> BM25 在匹配过程中考虑文档长度。同样，这是直观的；如果一篇较短的文章包含与一篇较长的文章相同数量的匹配项，那么这篇较短的文章可能更相关。</li></ul><p id="f62c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些改进还引入了两个超参数来调整这些项目对排名函数的影响。“k”用于调整术语饱和的影响,“b”用于调整文档长度。</p><p id="900d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">综上所述，BM25 的计算公式为:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ni"><img src="../Images/0afbc8f5d11492648f98830c5ba612a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V8zEF3m21WkJ-UYzME6cKA.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">简化的 BM25 算法。来源:作者</p></figure><h2 id="1b00" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">实施 BM25，一个成功的例子</h2><p id="3218" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">实现 BM25 非常简单。多亏了<em class="le"> rank-bm25 </em> Python 库，这可以用几行代码实现。</p><p id="7127" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们的示例中，我们将创建一个搜索引擎来查询英国公共部门组织发布的合同通知。</p><p id="7d6b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的起点是一个 dateset，它包含合同通知的标题、描述以及通知本身的链接。为了简单起见，我们将标题和描述组合在一起，在数据集中创建“文本”列。我们将使用该列进行搜索。我们想要搜索 50，000 个文档:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nj"><img src="../Images/59b164f43b6c238e3cf3ab3b048e3639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j8rmiXHHge01JhAI6JmG4w.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">要在搜索引擎中使用的数据格式(50，000 行中的前两行)。来源:作者</p></figure><p id="c1fd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文的底部可以找到数据和代码的链接。</p><p id="7903" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本练习的第一步是提取该数据集的“文本”列中的所有单词，以创建一个由每个文档及其单词组成的“列表列表”。这被称为标记化，可以由优秀的空间库来处理:</p><pre class="lg lh li lj gt nk nl nm nn aw no bi"><span id="e14d" class="lv lw it nl b gy np nq l nr ns">import spacy<br/>from rank_bm25 import BM25Okapi<br/>from tqdm import tqdm<br/>nlp = spacy.load("en_core_web_sm")</span><span id="a7fb" class="lv lw it nl b gy nt nq l nr ns">text_list = df.text.str.lower().values<br/>tok_text=[] # for our tokenised corpus</span><span id="f4c4" class="lv lw it nl b gy nt nq l nr ns">#Tokenising using SpaCy:<br/>for doc in tqdm(nlp.pipe(text_list, disable=["tagger", "parser","ner"])):<br/>   tok = [t.text for t in doc if t.is_alpha]<br/>   tok_text.append(tok)</span></pre><p id="ee40" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">构建 BM25 索引只需一行代码:</p><pre class="lg lh li lj gt nk nl nm nn aw no bi"><span id="0c8b" class="lv lw it nl b gy np nq l nr ns">bm25 = BM25Okapi(tok_text)</span></pre><p id="8b4d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">查询这个索引只需要一个已经标记化的搜索输入:</p><pre class="lg lh li lj gt nk nl nm nn aw no bi"><span id="ed92" class="lv lw it nl b gy np nq l nr ns">query = "Flood Defence"</span><span id="d52e" class="lv lw it nl b gy nt nq l nr ns">tokenized_query = query.lower().split(" ")</span><span id="3899" class="lv lw it nl b gy nt nq l nr ns">import time</span><span id="9d41" class="lv lw it nl b gy nt nq l nr ns">t0 = time.time()<br/>results = bm25.get_top_n(tokenized_query, df.text.values, n=3)<br/>t1 = time.time()</span><span id="c289" class="lv lw it nl b gy nt nq l nr ns">print(f'Searched 50,000 records in {round(t1-t0,3) } seconds \n')</span><span id="fc47" class="lv lw it nl b gy nt nq l nr ns">for i in results:<br/>   print(i)</span></pre><p id="3fa2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将返回与搜索查询“防洪”高度相关的前 3 个结果:</p><pre class="lg lh li lj gt nk nl nm nn aw no bi"><span id="e700" class="lv lw it nl b gy np nq l nr ns"><em class="le">Searched 50,000 records in 0.061 seconds:</em></span><span id="f7f2" class="lv lw it nl b gy nt nq l nr ns">Forge Island Flood Defence and Public Realm Works Award of Flood defence and public realm works along the canal embankment at Forge Island, Market Street, Rotherham as part of the Rotherham Renaissance Flood Alleviation Scheme. </span><span id="a19d" class="lv lw it nl b gy nt nq l nr ns">Flood defence maintenance works for Lewisham and Southwark College **AWARD** Following RfQ NCG contracted with T Gunning for Flood defence maintenance works for Lewisham and Southwark College </span><span id="1050" class="lv lw it nl b gy nt nq l nr ns">Freckleton St Byrom Street River Walls Freckleton St Byrom Street River Walls, Strengthening of existing river wall parapets to provide flood defence measures</span></pre><p id="cb3e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以根据执行搜索的用户的预期偏好来微调“k”和“b”的值，但是默认的 k=1.5 和 b=0.75 在这里似乎也很好。</p><h2 id="e810" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">最后</h2><p id="cc53" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">希望这个例子突出了用 Python 实现健壮的全文搜索是多么简单。这可以很容易地用来驱动一个简单的 web 应用程序或智能文档搜索工具。还有很大的空间来进一步提高这方面的性能，这将在下面的后续帖子中介绍！</p><div class="nu nv gp gr nw nx"><a rel="noopener follow" target="_blank" href="/how-to-build-a-smart-search-engine-a86fca0d0795"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd iu gy z fp oc fr fs od fu fw is bi translated">如何建立一个智能搜索引擎</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">用 Python 创建智能搜索服务</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">towardsdatascience.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol lp nx"/></div></div></a></div><p id="b0d8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">参考文献:</strong></p><p id="caed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章的代码和数据可以在这个<a class="ae mt" href="https://colab.research.google.com/drive/1vtBleNUwj4a29vCjzFMKheaBO1Du0fwq?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Colab 笔记本</a>中找到。</p><p id="0571" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[1]麦肯锡对网络搜索的评论:<a class="ae mt" href="https://www.mckinsey.com/~/media/mckinsey/dotcom/client_service/High%20Tech/PDFs/Impact_of_Internet_technologies_search_final2.aspx" rel="noopener ugc nofollow" target="_blank">https://www . McKinsey . com/~/media/McKinsey/dot com/client _ service/High % 20 tech/pdf/Impact _ of _ Internet _ technologies _ search _ final 2 . aspx</a></p><p id="828e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[2] <a class="ae mt" href="https://stackshare.io/elasticsearch#:~:text=Who%20uses%20Elasticsearch%3F&amp;text=3034%20companies%20reportedly%20use%20Elasticsearch,Uber%2C%20Udemy%2C%20and%20Shopify." rel="noopener ugc nofollow" target="_blank">据 StackShare 报道，2020 年 8 月。</a></p><p id="51bc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[3]从 Elasticsearch v5.0 开始，BM25 成为默认搜索:<a class="ae mt" href="https://www.elastic.co/blog/elasticsearch-5-0-0-released" rel="noopener ugc nofollow" target="_blank">https://www.elastic.co/blog/elasticsearch-5-0-0-released</a></p><p id="917a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[4]<a class="ae mt" href="https://docs.microsoft.com/en-us/azure/search/index-ranking-similarity" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/search/index-ranking-similarity</a></p></div></div>    
</body>
</html>