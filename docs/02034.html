<html>
<head>
<title>Answering Business Questions with SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 SQL 回答业务问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/answering-business-questions-with-sql-fd0315707980?source=collection_archive---------14-----------------------#2020-02-26">https://towardsdatascience.com/answering-business-questions-with-sql-fd0315707980?source=collection_archive---------14-----------------------#2020-02-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="6967" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">SQL 变得简单</h2><div class=""/><div class=""><h2 id="0f5a" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">惊讶于你的询问的力量！</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/54aa0a6681434f392be8e10d2b3dd478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VUomqKvfhJlcEAp2"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">让 SQL 打开您的数据抽屉！<a class="ae lh" href="https://unsplash.com/photos/lRoX0shwjUQ" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="9fdd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">大多数与数据科学相关的工作都需要你有很强的 SQL 技能，这是有意义的，因为你最基本的任务之一就是准确地操作数据。我们将 SQL 用于许多目的，包括探索性数据分析、创建数据的过滤数据集，甚至是发现关于业务本身的见解。</p><p id="fcbf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">许多 SQL 课程将为您提供如何设计基本查询的概述，但您很少有机会练习编写基于真实问题的查询，使用多个表并再现我们作为数据分析师通常会做的事情，因此我在本教程中的目标是向您展示如何使用流行的 SQL 函数来完成这些工作，例如:</p><ul class=""><li id="afd8" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated"><strong class="lk jd">格当；</strong></li><li id="b572" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated"><strong class="lk jd">子查询；</strong></li><li id="5b93" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated"><strong class="lk jd">窗口功能；</strong></li><li id="378c" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated"><strong class="lk jd">临时表</strong>。</li></ul><p id="8518" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们开始之前，您可以在这里找到数据集<a class="ae lh" href="https://github.com/olist/work-at-olist-data/tree/master/datasets" rel="noopener ugc nofollow" target="_blank">，并且跟随教程的 SQL 文件是</a><a class="ae lh" href="https://github.com/lucasmoratof/sql-projects/blob/master/Queries%20for%20article%20-%20Answering%20Business%20Questions%20with%20SQL.sql" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h2 id="3df5" class="ms mt it bd mu mv mw dn mx my mz dp na lr nb nc nd lv ne nf ng lz nh ni nj iz bi translated">理解数据</h2><p id="3c80" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">第一步是要很好地了解我们手中有什么样的数据。今天，我们将使用一家巴西网店的交易数据。让我们看看数据库是如何组织的:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi np"><img src="../Images/15bf8da4cbfa533e5511c9434d6ba9a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XcaLcJInWDmqrnf8.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">数据库模式。<a class="ae lh" href="https://github.com/olist/work-at-olist-data/blob/master/images/schema.png" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="b497" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有 8 个表，都由至少一个字段连接。这些数据包含大约 10 万笔交易，包括关于客户、支付、产品和订单的信息。有很多可能性的空间，但我们将把重点放在关于销售额的问题上。假设您的经理问了您 3 个问题:</p><ul class=""><li id="3adc" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">每个州的顶级买家是谁，他们花了多少钱？</li><li id="ed2e" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">留下差评的人平均花费多少？正面评价呢？</li><li id="0907" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">在 2017 年的几个月里，销售额增加或减少了多少，按百分比计算？</li></ul><p id="8f8c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了回答这些问题，我使用了最流行的 SQL 管理系统之一的 SQL Server。还有许多其他可用的变体，如<a class="ae lh" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>、<a class="ae lh" href="https://www.sqlite.org/index.html" rel="noopener ugc nofollow" target="_blank"> SQLite </a>和<a class="ae lh" href="https://www.mysql.com/" rel="noopener ugc nofollow" target="_blank"> MySQL </a>。语法可能会稍有变化，但主要概念在不同的语言中保持不变。</p><p id="3628" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">作为参考，下面是我们今天要用的四个表格的第一行。花点时间检查字段以及表是如何连接的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/5bc493a3b07316a23719c93c28f2020b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w7LjGygh7_I1RGFb0GHoGQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">表的第一行是客户、订单和订单项目。</p></figure><h2 id="c656" class="ms mt it bd mu mv mw dn mx my mz dp na lr nb nc nd lv ne nf ng lz nh ni nj iz bi translated">每个州的顶级买家是哪些？</h2><p id="32df" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">对于这个查询，我们需要选择每个州中总购买量最高的客户。我们需要的数据在<strong class="lk jd"> <em class="nr">客户</em> </strong>和<strong class="lk jd"> <em class="nr">订单项目</em> </strong>表中，我们需要使用<strong class="lk jd"> <em class="nr">订单</em> </strong>作为连接器。我们在这种情况下使用的方法是在一个<a class="ae lh" href="https://en.wikipedia.org/wiki/SQL_window_function" rel="noopener ugc nofollow" target="_blank">窗口函数</a>中生成一个子查询，按照州聚集结果，并只选择价格最高的行。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="8e76" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该查询返回巴西 27 个州中的最佳买家，您可以查看下面的前五行:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nu"><img src="../Images/5d3af5d1a484dac157b9af29660f3b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*qrR8EFE4yn0foYsFm2oISA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按州列出的最佳买家，前 5 行。<a class="ae lh" href="https://github.com/lucasmoratof/sql-projects/blob/master/Queries%20for%20article%20-%20Answering%20Business%20Questions%20with%20SQL.sql" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><h2 id="539d" class="ms mt it bd mu mv mw dn mx my mz dp na lr nb nc nd lv ne nf ng lz nh ni nj iz bi translated">按情感划分的平均费用</h2><p id="0fca" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">情感分析是数据科学中的热门话题之一，因此您可能需要对其进行分类以执行分析。我们有一个评论分数栏，范围从 1 到 5。对于这个例子，我们将假设评分等于 4 或 5 的评论是正面的，其他任何评论都是负面的。接下来，我们将计算每组的平均值，为此，我们需要使用三个表:<strong class="lk jd"><em class="nr">order _ reviews</em></strong>、<strong class="lk jd"> <em class="nr"> order_items </em> </strong>和<strong class="lk jd"> <em class="nr"> orders </em> </strong>(再次作为连接符)。我们将在这里使用一个<a class="ae lh" href="https://docs.microsoft.com/en-us/sql/t-sql/queries/with-common-table-expression-transact-sql?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">公共表表达式</a> (CTE)，它的作用就像一个临时表，我们可以从这个表中使用计算字段进行查询，因为我们不能直接使用 average 函数。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="0058" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们得到的结果表明，这两种情绪之间的价格相差不大。很有趣，不是吗？</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/50ae25f70b210f82989621ff483c2148.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*Kyo8FZD_pLdyYmcDNUgCiQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">查询结果。快乐的人和消极的人只有 0.61 美分的差距。<a class="ae lh" href="https://github.com/lucasmoratof/sql-projects/blob/master/Queries%20for%20article%20-%20Answering%20Business%20Questions%20with%20SQL.sql" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><h2 id="a212" class="ms mt it bd mu mv mw dn mx my mz dp na lr nb nc nd lv ne nf ng lz nh ni nj iz bi translated">2017 年月销售额</h2><p id="eb53" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">对于最后一个查询，我们需要表<strong class="lk jd"> <em class="nr">订单</em> </strong>和<strong class="lk jd"> <em class="nr">订单 _ 项目</em> </strong>。挑战在于获得前几个月的总销售额，然后将差额与实际月份进行比较。我们需要的步骤是:</p><ul class=""><li id="86c2" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">创造一个 CTE；</li><li id="8b5a" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">使用<a class="ae lh" href="https://www.techonthenet.com/sql_server/functions/lag.php" rel="noopener ugc nofollow" target="_blank"> LAG() </a>创建一个包含上月销售额的列；</li><li id="d2c3" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">在外部查询中，执行计算，使用<a class="ae lh" href="https://docs.microsoft.com/en-us/sql/t-sql/functions/format-transact-sql?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank"> FORMAT() </a>以一种良好的方式获得结果</li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="1cc0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">结果看起来很容易理解。在这里，你可以看到 2017 年的销售波动有多大:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/abb570d7421054644a3b28af7f255fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*Q8KlyA7sJEhpNlGYPK9y_w.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">2 月和 11 月的销售额大幅增长，这些信息可用于计划库存水平，甚至预测未来的收入。<a class="ae lh" href="https://github.com/lucasmoratof/sql-projects/blob/master/Queries%20for%20article%20-%20Answering%20Business%20Questions%20with%20SQL.sql" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="0c32" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">今天就到这里吧！在本教程中，您已经看到了 3 个简单的问题是如何需要 SQL 为您提供的各种函数的。查询设计是一个令人惊奇的探索主题，其中许多变体可以产生强烈的影响，因此它总是一个很好的研究主题。</p><p id="ec99" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你会做出不同的查询吗？我们都是来学习的，所以请在评论中留下你的评论或其他问题。我希望你喜欢这篇文章！</p></div></div>    
</body>
</html>