<html>
<head>
<title>DBSCAN Clustering for Trading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于交易的DBSCAN聚类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dbscan-clustering-for-trading-4c48e5ebffc8?source=collection_archive---------9-----------------------#2020-02-12">https://towardsdatascience.com/dbscan-clustering-for-trading-4c48e5ebffc8?source=collection_archive---------9-----------------------#2020-02-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="d820" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">金融中的人工智能</h2><div class=""/><div class=""><h2 id="7ae2" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">发展配对交易策略</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/d9663a3a23006a79c9ff2e37addf9bb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*tNXKFcgOE9B66r1ZKSCjgg.jpeg"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图片来源:<a class="ae la" href="https://stock.adobe.com/11556619?as_campaign=TinEye&amp;as_content=tineye_match&amp;epi1=11556619&amp;tduid=aff1df247d987defa4e98feaca981780&amp;as_channel=affiliate&amp;as_campclass=redirect&amp;as_source=arvato" rel="noopener ugc nofollow" target="_blank">锐拍</a></p></figure><p id="49dd" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">由摩根斯坦利的量化分析师在80年代首创的pairs trading是一种交易策略，允许交易者在几乎任何市场条件下获利。这种策略包括监控两种历史上相关的证券。一旦发现相关性差异，如一只股票上涨，而另一只股票停滞不前，投资者就会做多表现不佳的证券，做空表现出色的证券，希望证券回到其历史相关性。在这种情况下，投资者从价格趋同中获利。</p><p id="71ed" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">例如，通用汽车公司和福特汽车公司生产类似的产品(汽车)，因此它们基于整个汽车市场分享类似的股票价格变动。如果通用汽车公司的股票价格大幅上涨，而福特汽车公司的股票价格保持不变，那么实施配对交易策略的人会做空通用汽车公司的股票，并买入福特汽车公司的股票，假设价格将回到其历史平衡点。如果通用汽车的股票下跌，投资者获利，如果福特的股票上涨，投资者也获利。然而，过去的价格并不总是未来趋势的指标，所以这种策略仍然有风险。为了帮助我们找到历史上相关的证券，我们可以使用DBSCAN聚类。</p><h1 id="e027" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">DBSCAN聚类:简要说明</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/3e15f9016d9fdc535ca6f81cf5be653a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*vcqUisaXNFDxPc7IKEwRHA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">通过谷歌图片搜索的图片，标记为重复使用</p></figure><p id="06db" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">机器学习可以用于许多交易策略，配对交易也不例外。基于密度的带噪声应用空间聚类(DBSCAN)可用于对股票进行聚类，并排除不适合聚类的股票。DBSCAN的两个参数是eps(被视为聚类一部分的点之间的距离)和minPoints(形成密集区域的最小点数)。根据这些参数，DBSCAN算法然后从我们提供给它的一组点中创建聚类。位于低密度区域的点被归类为异常值。K-means是另一种流行的聚类算法，但它对异常值更敏感，这就是我们使用DBSCAN的原因。现在我们已经了解了pairs trading和DBSCAN，让我们开始实现吧。</p><h1 id="e615" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">进口/数据</h1><p id="6450" class="pw-post-body-paragraph lb lc iq ld b le mq ka lg lh mr kd lj lk ms lm ln lo mt lq lr ls mu lu lv lw ij bi translated">我们从必要的进口开始。值得注意的是，从量子平台进口的产品将用于<a class="ae la" href="https://www.quantopian.com/docs/user-guide/environments/algo-ide" rel="noopener ugc nofollow" target="_blank">量子平台IDE </a>。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="a064" class="na ly iq mw b gy nb nc l nd ne">import matplotlib.pyplot as plt<br/>import matplotlib.cm as cm</span><span id="e04c" class="na ly iq mw b gy nf nc l nd ne">import numpy as np<br/>import pandas as pd</span><span id="3682" class="na ly iq mw b gy nf nc l nd ne">from sklearn.cluster import DBSCAN<br/>from sklearn.decomposition import PCA<br/>from sklearn.manifold import TSNE<br/>from sklearn import preprocessing</span><span id="b5e1" class="na ly iq mw b gy nf nc l nd ne">from statsmodels.tsa.stattools import coint</span><span id="0345" class="na ly iq mw b gy nf nc l nd ne">from scipy import stats</span><span id="19ce" class="na ly iq mw b gy nf nc l nd ne">from quantopian.pipeline.data import morningstar<br/>from quantopian.pipeline.filters.morningstar import Q500US, Q1500US, Q3000US<br/>from quantopian.pipeline import Pipeline<br/>from quantopian.research import run_pipeline</span></pre><p id="11b2" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">我们将使用的预定义宇宙是Q1500，它是一个大的流动股票集合。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="9787" class="na ly iq mw b gy nb nc l nd ne">study_date = "2019-12-31"<br/>universe = Q1500US()</span></pre><p id="7fbb" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">为了创建我们的渠道，我们使用了来自晨星的信息。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="4755" class="na ly iq mw b gy nb nc l nd ne">pipe = Pipeline(columns = {<br/>'Market Cap': morningstar.valuation.market_cap.latest.quantiles(5),<br/>'Industry':morningstar.asset_classification.morningstar_industry_group_code.latest,<br/>'Financial Health':morningstar.asset_classification.financial_health_grade.latest}, <br/>screen = universe)</span><span id="4754" class="na ly iq mw b gy nf nc l nd ne">res = run_pipeline(pipe, study_date, study_date)<br/>res.index = res.index.droplevel(0)  # drop the single date from the multi-index</span></pre><p id="93cd" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">让我们来看看我们的数据。我们看到它包含了1486只股票，以及对财务健康、行业和市值的描述。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="2882" class="na ly iq mw b gy nb nc l nd ne">print res.shape<br/>res.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/bf60a1e256afc142c5afbb575c3eadaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jz7dmGgWT1CeUc0ktQvIlg.png"/></div></div></figure><p id="ead0" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">我们不能处理没有财务健康等级的股票，所以我们删除了它们。两只股票缺乏财务健康等级，因此被剔除。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="5c9f" class="na ly iq mw b gy nb nc l nd ne">res = res[res['Financial Health']!= None]<br/>print res.shape</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/72ce6f6744911499a7ec0b8c410151c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*N4JrctnYDnXeLEAbBVGuwA.png"/></div></figure><p id="f223" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">现在，我们将创建一个字典，用数字分数替换财务健康的分类数据。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="80ff" class="na ly iq mw b gy nb nc l nd ne">res['Financial Health'] = res['Financial Health'].astype('object')<br/>health_dict = {u'A': 0.1,<br/>               u'B': 0.3,<br/>               u'C': 0.7,<br/>               u'D': 0.9,<br/>               u'F': 1.0}<br/>res = res.replace({'Financial Health': health_dict})</span></pre><p id="5c2b" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">为了更好地理解我们的数据，我们使用。描述()以查看一些基本指标，如平均值和标准差。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="63cc" class="na ly iq mw b gy nb nc l nd ne">res.describe()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/3dde2506773d4f8f2ef82a6d586f05a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*B0ZtrJ2awEuYC4yajmI5dg.png"/></div></figure><h1 id="939f" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">每日回报</h1><p id="1fe2" class="pw-post-body-paragraph lb lc iq ld b le mq ka lg lh mr kd lj lk ms lm ln lo mt lq lr ls mu lu lv lw ij bi translated">获取每日回报(股票价格的美元变化占前一天收盘价的百分比)用于我们的策略。然后我们以苹果公司的日回报率为例。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="4ac4" class="na ly iq mw b gy nb nc l nd ne">pricing = get_pricing(<br/>    symbols=res.index,<br/>    fields='close_price',<br/>    start_date=pd.Timestamp(study_date) - pd.DateOffset(months=24),<br/>    end_date=pd.Timestamp(study_date)<br/>)</span><span id="c9bd" class="na ly iq mw b gy nf nc l nd ne">returns = pricing.pct_change()<br/>returns[symbols(['AAPL'])].plot()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nm"><img src="../Images/2044936ff398726a0747346d06fcb59f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h8YW0H7VjO4YBN_HmJorgQ.png"/></div></div></figure><p id="1b82" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">类似于我们对缺乏财务健康等级的股票所做的，我们将不得不删除没有完整回报系列的股票。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="b67c" class="na ly iq mw b gy nb nc l nd ne">returns = returns.iloc[1:,:].dropna(axis=1)<br/>print returns.shape</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/be4ba1fb1542442dd2804c9b534be3c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*lpvBtTPy5hgLUsVAcqQ8Pg.png"/></div></figure><h1 id="b8f3" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">PCA和DBSCAN</h1><p id="91fd" class="pw-post-body-paragraph lb lc iq ld b le mq ka lg lh mr kd lj lk ms lm ln lo mt lq lr ls mu lu lv lw ij bi translated">我们的下一步是使用主成分分析来降低回报数据的维度，提取每只股票的历史潜在公共因子负载，添加市值/财务健康值，并使用DBSCAN。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="610d" class="na ly iq mw b gy nb nc l nd ne">prin_components = 50 <br/>pca = PCA(n_components=prin_components)<br/>pca.fit(returns)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi no"><img src="../Images/b29ee89acb0c206eaef227a0d6da8d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i3L8m4pUOGgh4Wm9SkfT1g.png"/></div></div></figure><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="c584" class="na ly iq mw b gy nb nc l nd ne">X = np.hstack(<br/>    (pca.components_.T,<br/>     res['Market Cap'][returns.columns].values[:, np.newaxis],<br/>     res['Financial Health'][returns.columns].values[:, np.newaxis])<br/>)</span><span id="f76c" class="na ly iq mw b gy nf nc l nd ne">X = preprocessing.StandardScaler().fit_transform(X)</span><span id="3352" class="na ly iq mw b gy nf nc l nd ne">clf = DBSCAN(eps=1.9, min_samples=3)<br/>print clf</span><span id="a0cd" class="na ly iq mw b gy nf nc l nd ne">clf.fit(X)<br/>labels = clf.labels_<br/>n_clusters_ = len(set(labels)) - (1 if -1 in labels else 0)<br/>print "\nClusters discovered: %d" % n_clusters_</span><span id="2f51" class="na ly iq mw b gy nf nc l nd ne">clustered = clf.labels_</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi np"><img src="../Images/b24f7e05e5fd0499a005d3647116a46f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WRpiwVcLpMs6rAWgjloS4Q.png"/></div></div></figure><p id="1fb7" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">可能的配对总数超过900，000个，所以我们将大大减少这个数字，只对我们的配对交易策略中更好的候选配对。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="753f" class="na ly iq mw b gy nb nc l nd ne">ticker_count = len(returns.columns)<br/>print "Total pairs possible in universe: %d " % (ticker_count*(ticker_count-1)/2)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/4128cf8c10e5063c4c7d8c987258478d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*36nq9E066tZzmRZ40kRB2w.png"/></div></figure><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="8c8f" class="na ly iq mw b gy nb nc l nd ne">clustered_series = pd.Series(index=returns.columns, data=clustered.flatten())<br/>clustered_series_all = pd.Series(index=returns.columns, data=clustered.flatten())<br/>clustered_series = clustered_series[clustered_series != -1]</span><span id="40f2" class="na ly iq mw b gy nf nc l nd ne">CLUSTER_SIZE_LIMIT = 9999<br/>counts = clustered_series.value_counts()<br/>ticker_count_reduced = counts[(counts&gt;1) &amp; (counts&lt;=CLUSTER_SIZE_LIMIT)]<br/>print "Clusters formed: %d" % len(ticker_count_reduced)<br/>print "Pairs to evaluate: %d" % (ticker_count_reduced*(ticker_count_reduced-1)).sum()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/c17ed8b269acce2915e8f2243febcebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*WO0vxbaIdd8CAE6CfOuAMQ.png"/></div></figure><h1 id="efbe" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">形象化</h1><p id="7bbb" class="pw-post-body-paragraph lb lc iq ld b le mq ka lg lh mr kd lj lk ms lm ln lo mt lq lr ls mu lu lv lw ij bi translated">由于数据目前聚集在52个维度中，我们可以使用T-SNE算法来可视化2D的数据，并查看15个集群。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="4eb5" class="na ly iq mw b gy nb nc l nd ne">X_tsne = TSNE(learning_rate=1000, perplexity=25, random_state=1337).fit_transform(X)</span><span id="66ee" class="na ly iq mw b gy nf nc l nd ne">plt.figure(1, facecolor='white')<br/>plt.clf()<br/>plt.axis('off')</span><span id="c52e" class="na ly iq mw b gy nf nc l nd ne">plt.scatter(<br/>    X_tsne[(labels!=-1), 0],<br/>    X_tsne[(labels!=-1), 1],<br/>    s=100,<br/>    alpha=0.85,<br/>    c=labels[labels!=-1],<br/>    cmap=cm.Paired<br/>)</span><span id="9549" class="na ly iq mw b gy nf nc l nd ne">plt.scatter(<br/>    X_tsne[(clustered_series_all==-1).values, 0],<br/>    X_tsne[(clustered_series_all==-1).values, 1],<br/>    s=100,<br/>    alpha=0.05<br/>)</span><span id="b58e" class="na ly iq mw b gy nf nc l nd ne">plt.title('T-SNE of all Stocks with DBSCAN Clusters Noted')</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nr"><img src="../Images/f2a00cbca49c357234c04744394a4c0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ggUyyFpf5cu_WMfp0vt3AA.png"/></div></div></figure><p id="0791" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">让我们画出每个聚类中的股票数量。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="820e" class="na ly iq mw b gy nb nc l nd ne">plt.barh(<br/>    range(len(clustered_series.value_counts())),<br/>    clustered_series.value_counts()<br/>)<br/>plt.title('Cluster Member Counts')<br/>plt.xlabel('Stocks in Cluster')<br/>plt.ylabel('Cluster Number')</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nr"><img src="../Images/6274d490ba2dac2194397efd6f6ea6fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8OK10w0VZ5ck3VhySJS4cA.png"/></div></div></figure><p id="a5c6" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">我们将可视化较小的集群以获得历史相关性，从而查看DBSCAN是否正确地完成了它的工作。正如我们所看到的，聚类中的股票价格确实有很高的相关性。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="370e" class="na ly iq mw b gy nb nc l nd ne">counts = clustered_series.value_counts()</span><span id="586c" class="na ly iq mw b gy nf nc l nd ne">cluster_vis_list = list(counts[(counts&lt;20) &amp; (counts&gt;1)].index)[::-1]</span><span id="d147" class="na ly iq mw b gy nf nc l nd ne">for clust in cluster_vis_list[0:min(len(cluster_vis_list), 3)]:<br/>    tickers = list(clustered_series[clustered_series==clust].index)<br/>    means = np.log(pricing[tickers].mean())<br/>    data = np.log(pricing[tickers]).sub(means)<br/>    data.plot(title='Stock Time Series for Cluster %d' % clust)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ns"><img src="../Images/dc9611893de4d304196934d534154869.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v3Wbj-vuhAPS9ToQhsVZjQ.png"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ns"><img src="../Images/041f588f0dadd7445953e8b8b2663e25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYOFDY0TIVSaba_5Ewwfgg.png"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ns"><img src="../Images/fc51d515ff504b42113ceb076a1603b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vUWzeQOMfYD26ixjL9ZRIw.png"/></div></div></figure><h1 id="18cd" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">获得对子</h1><p id="ecf5" class="pw-post-body-paragraph lb lc iq ld b le mq ka lg lh mr kd lj lk ms lm ln lo mt lq lr ls mu lu lv lw ij bi translated">为了验证协整关系，我们可以使用Quantopian提供给我们的函数。然后，我们可以得到我们的配对列表。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="4f5f" class="na ly iq mw b gy nb nc l nd ne">def find_cointegrated_pairs(data, significance=0.05):<br/>    # This function is from <a class="ae la" href="https://www.quantopian.com/lectures/introduction-to-pairs-trading" rel="noopener ugc nofollow" target="_blank">https://www.quantopian.com/lectures/introduction-to-pairs-trading</a><br/>    n = data.shape[1]<br/>    score_matrix = np.zeros((n, n))<br/>    pvalue_matrix = np.ones((n, n))<br/>    keys = data.keys()<br/>    pairs = []<br/>    for i in range(n):<br/>        for j in range(i+1, n):<br/>            S1 = data[keys[i]]<br/>            S2 = data[keys[j]]<br/>            result = coint(S1, S2)<br/>            score = result[0]<br/>            pvalue = result[1]<br/>            score_matrix[i, j] = score<br/>            pvalue_matrix[i, j] = pvalue<br/>            if pvalue &lt; significance:<br/>                pairs.append((keys[i], keys[j]))<br/>    return score_matrix, pvalue_matrix, pairs</span><span id="99f2" class="na ly iq mw b gy nf nc l nd ne">cluster_dict = {}<br/>for i, which_clust in enumerate(ticker_count_reduced.index):<br/>    tickers = clustered_series[clustered_series == which_clust].index<br/>    score_matrix, pvalue_matrix, pairs = find_cointegrated_pairs(<br/>        pricing[tickers]<br/>    )<br/>    cluster_dict[which_clust] = {}<br/>    cluster_dict[which_clust]['score_matrix'] = score_matrix<br/>    cluster_dict[which_clust]['pvalue_matrix'] = pvalue_matrix<br/>    cluster_dict[which_clust]['pairs'] = pairs</span><span id="9e4f" class="na ly iq mw b gy nf nc l nd ne">pairs = []<br/>for clust in cluster_dict.keys():<br/>    pairs.extend(cluster_dict[clust]['pairs'])</span><span id="e293" class="na ly iq mw b gy nf nc l nd ne">pairs</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nt"><img src="../Images/c4c74cde84e242d503fb6414a6b97b81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K1Sdlk7ruW8gErKuGPudww.png"/></div></div></figure><p id="2c40" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">我们留下了一个包含118对和88个独特代码的列表。作为我们的最后一步，我们将再次使用T-SNE可视化我们的验证对。</p><pre class="kp kq kr ks gt mv mw mx my aw mz bi"><span id="f292" class="na ly iq mw b gy nb nc l nd ne">stocks = np.unique(pairs)<br/>X_df = pd.DataFrame(index=returns.T.index, data=X)<br/>in_pairs_series = clustered_series.loc[stocks]<br/>stocks = list(np.unique(pairs))<br/>X_pairs = X_df.loc[stocks]</span><span id="99df" class="na ly iq mw b gy nf nc l nd ne">X_tsne = TSNE(learning_rate=50, perplexity=3, random_state=1337).fit_transform(X_pairs)</span><span id="24ef" class="na ly iq mw b gy nf nc l nd ne">plt.figure(1, facecolor='white')<br/>plt.clf()<br/>plt.axis('off')<br/>for pair in pairs:<br/>    ticker1 = pair[0].symbol<br/>    loc1 = X_pairs.index.get_loc(pair[0])<br/>    x1, y1 = X_tsne[loc1, :]</span><span id="50ea" class="na ly iq mw b gy nf nc l nd ne">ticker2 = pair[0].symbol<br/>    loc2 = X_pairs.index.get_loc(pair[1])<br/>    x2, y2 = X_tsne[loc2, :]<br/>      <br/>    plt.plot([x1, x2], [y1, y2], 'k-', alpha=0.3, c='gray');<br/>        <br/>plt.scatter(X_tsne[:, 0], X_tsne[:, 1], s=220, alpha=0.9, c=[in_pairs_series.values], cmap=cm.Paired)<br/>plt.title('T-SNE Visualization of Validated Pairs');</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nu"><img src="../Images/534a552cef18466db879e67c1448df56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1k65ew1UgLR9mtI4FZDnnA.png"/></div></div></figure><p id="3fc6" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">最后，我们完成了寻找配对交易策略的目标。</p><p id="0b68" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja"> <em class="nv">注来自《走向数据科学》的编辑:</em> </strong> <em class="nv">虽然我们允许独立作者根据我们的</em> <a class="ae la" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="nv">规则和指导方针</em> </a> <em class="nv">发表文章，但我们不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae la" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="nv">读者术语</em> </a> <em class="nv">。</em></p><h1 id="a63e" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">参考</h1><p id="1e1a" class="pw-post-body-paragraph lb lc iq ld b le mq ka lg lh mr kd lj lk ms lm ln lo mt lq lr ls mu lu lv lw ij bi translated">[1]乔纳森·拉金，<a class="ae la" href="https://github.com/marketneutral/pairs-trading-with-ML/blob/master/Pairs%2BTrading%2Bwith%2BMachine%2BLearning.ipynb" rel="noopener ugc nofollow" target="_blank">用机器学习进行配对交易</a>，Github</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="51cd" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja">先别走</strong>！</p><p id="13f3" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">我是Roshan，16岁，对人工智能和金融的交叉领域充满热情。关于人工智能在金融领域的广泛观点，请查看这篇文章:<a class="ae la" rel="noopener" target="_blank" href="/artificial-intelligence-and-its-application-in-finance-9f1e0588e777">https://towards data science . com/artificial-intelligence-and-its-application-in-finance-9f1e 0588 e 777</a>。</p><p id="b1b2" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">在Linkedin上联系我:<a class="ae la" href="https://www.linkedin.com/in/roshan-adusumilli-96b104194/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/roshan-adusumilli-96b104194/</a></p></div></div>    
</body>
</html>