<html>
<head>
<title>ML in Production-1 : Amazon Sagemaker - AWS, setup, train and deploy!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ML in Production-1:Amazon sage maker-AWS，设置、培训和部署！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/ml-in-production-1-amazon-sagemaker-aws-setup-train-and-deploy-896086848cde?source=collection_archive---------29-----------------------#2020-07-29">https://towardsdatascience.com/ml-in-production-1-amazon-sagemaker-aws-setup-train-and-deploy-896086848cde?source=collection_archive---------29-----------------------#2020-07-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq jr js"><p id="ae25" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">"那些像生命流动一样流动的人知道他们不需要其他力量."老子</p></blockquote><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/11d5990e341cc5cdd158099637a7ce92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4CUVOYl5clRdmsv_lYG8Mw.jpeg"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">浮冰，斯瓦尔巴特群岛~ Roshini Johri(图片由作者提供)</p></figure><p id="c5a4" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">将大规模的机器学习系统投入生产，并建立一个漂亮的流线型基础设施，其中的功能库只是流动，这已经成为我的一个新的困扰(也许这就是作为一个 10 年的机器学习老手对你所做的..你只是想狗屎工作)</p><p id="538a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">最近，我与伦敦<a class="ae ll" href="https://www.meetup.com/London-Women-in-Machine-Learning-and-Data-Science/events/271800385/" rel="noopener ugc nofollow" target="_blank">women in machine learning</a>社区一起开始了一个关于学习和教授如何做到这一点的系列，分为三部分，以实现不同的机器学习工作流程。这是我演讲后写的文章。这篇文章假设了机器学习模型的基本知识，并更多地关注于在生产中设置工作流和部署。在这个系列的第一部分，我们将在<a class="ae ll" href="https://aws.amazon.com/sagemaker/" rel="noopener ugc nofollow" target="_blank">亚马逊 Sagemaker </a>上进行设置。我们将使用<a class="ae ll" href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_boston.html" rel="noopener ugc nofollow" target="_blank"> sklearn 的波士顿住房</a>数据集。</p></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="deb1" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">机器学习生命周期</h1><p id="5736" class="pw-post-body-paragraph jt ju it jw b jx mr jz ka kb ms kd ke li mt kh ki lj mu kl km lk mv kp kq kr im bi translated">让我们花点时间来看一下机器学习的生命周期。简化的机器学习生命周期看起来像:</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi mw"><img src="../Images/8fcaa2a803168a5ecaa776e19a835102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSmnbNPPAaLCKybSHWvI4A.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">机器学习生命周期</p></figure><p id="c06d" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">现在是第一部分，数据准备，实际上应该是生产工作流程的数据预处理和特征工程。</p><ul class=""><li id="b285" class="mx my it jw b jx jy kb kc li mz lj na lk nb kr nc nd ne nf bi translated"><strong class="jw iu">获取数据:</strong>这是一个过程，您将从 repos、ETL 等中读入数据，将数据移动到一个位置，以形成您的训练数据的原始版本。</li><li id="37b1" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated"><strong class="jw iu">清理数据:</strong>这个阶段主要是做一些基本的清理工作，比如类型转换、空处理、确保字符串/类别等的一致性</li><li id="80dc" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated"><strong class="jw iu">准备/转换:</strong>特征转换、衍生、高阶特征，如交互特征、编码等。</li></ul><p id="44a2" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">下一阶段涉及建模和评估阶段:</p><ul class=""><li id="73a1" class="mx my it jw b jx jy kb kc li mz lj na lk nb kr nc nd ne nf bi translated"><strong class="jw iu">训练模型:</strong>在这个阶段你的数据应该以特征向量和标签的形式分割成训练、验证和测试。在这个阶段，您将读取这些数据，<strong class="jw iu"> <em class="jv">在您的训练集上训练您的模型，调整到验证集并在测试集上测试</em> </strong>！这也是您保存模型工件以进行评估和记录的阶段。</li><li id="1185" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated"><strong class="jw iu">评估模型:</strong>评估阶段，“我的模型做得对吗”阶段是最重要的阶段之一，我觉得我们从来没有在这个阶段花足够的时间。特征工程和模型评估将帮助您了解模型性能。句号。多注意你的模型评估指标，并选择正确的指标。</li></ul><p id="8118" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">最后但同样重要的是，我们阅读这篇文章的真正原因是部署！万岁。</p><ul class=""><li id="4ac0" class="mx my it jw b jx jy kb kc li mz lj na lk nb kr nc nd ne nf bi translated"><strong class="jw iu">部署到生产:</strong>这是您准备将您的模型发布到野外的阶段。添加所需的调度，并注意<strong class="jw iu">概念漂移和模型衰减</strong>(由于底层分布的变化而导致的性能变化)</li><li id="0653" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated"><strong class="jw iu">监控/收集/评估数据:</strong>模型性能、输入/输出路径、错误度量、日志、模型工件等都将被打上时间戳并记录下来，应该为完美的管道建立围绕模型选择的监控度量和警报/报告！</li></ul><p id="b90e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">以上，是一个简化但漂亮的机器学习管道。激动吗？欣喜若狂？你应该害怕。在我看来，组织应该把这作为一句口头禅。现在让我们看看如何用 Amazon Sagemaker 设置一个。</p></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="9b34" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">亚马逊 Sagemaker</h1><p id="e378" class="pw-post-body-paragraph jt ju it jw b jx mr jz ka kb ms kd ke li mt kh ki lj mu kl km lk mv kp kq kr im bi translated">现在，第一步从创建一个<a class="ae ll" href="https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/)" rel="noopener ugc nofollow" target="_blank"> AWS 账户</a>开始。如果您已经熟悉 Amazon 提供的实例类型(ec2 实例)，这会有所帮助。如果没有，请从<a class="ae ll" href="https://aws.amazon.com/sagemaker/pricing/instance-types/" rel="noopener ugc nofollow" target="_blank">这里</a>开始。Sagemaker 实例针对运行机器学习(ML)算法进行了优化。实例的类型也取决于区域和<a class="ae ll" href="https://docs.aws.amazon.com/general/latest/gr/rande.html#sagemaker_region" rel="noopener ugc nofollow" target="_blank">可用区域</a>。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nl"><img src="../Images/ac1c3fc0302570f8472e8cd4cc6d40d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ou_pvQhvvv9rf-9_"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated"><a class="ae ll" href="https://aws.amazon.com/sagemaker/pricing/instance-types/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/sagemaker/pricing/instance-types/</a></p></figure><p id="2efc" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">如果您觉得阅读太多关于实例类型的细节令人厌烦，那么开始吧:</p><p id="8cd2" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">开始 ML 的好实例:<strong class="jw iu"> ml.m4.xlarge(非自由)</strong></p><p id="644e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">开始 DL 的好实例:<strong class="jw iu"> ml.p2.xlarge(非自由)</strong></p><p id="1d89" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">AWS Sagemaker EC2 实例具有与之关联的默认配额。你可能不总是得到 20，这也因地区而异。根据您可能需要请求和增加的用例。这可以通过与 AWS 支持中心一起创建案例来完成。请在这里查看更多<a class="ae ll" href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html" rel="noopener ugc nofollow" target="_blank">信息</a></p><h2 id="ff92" class="nm lu it bd lv nn no dn lz np nq dp md li nr ns mh lj nt nu ml lk nv nw mp nx bi translated">Sagemaker 笔记本实例</h2><p id="bace" class="pw-post-body-paragraph jt ju it jw b jx mr jz ka kb ms kd ke li mt kh ki lj mu kl km lk mv kp kq kr im bi translated">现在要启动 sagemaker 笔记本实例，请转到 aws 帐户服务来搜索 sagemaker。进入 sagemaker 页面后，单击 create notebook instance。这将如下所示:</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ny"><img src="../Images/6c89b29f440cd0dff3ac6568993dd0e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tfZ8c-pS9-ldtw2zMx2UMQ.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">笔记本实例:命名笔记本并选择实例类型</p></figure><p id="6f5b" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">下一步是选择 IAM 角色。简单的第一次尝试就是创建一个新的角色并选择 none 作为 s3 存储桶，除非有一个您想要读取的 s3 存储桶。此外，此时应该有一个选择 git 存储库的可选选项。向下滚动并点击创建笔记本实例。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nz"><img src="../Images/5e82a7509e94c52d66aca7512f1055a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7tbWCo1iz-FQD0jdgYZ_4A.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">笔记本实例:选择 IAM 角色</p></figure><p id="31b7" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">您可以看到正在创建的笔记本的状态，一旦准备就绪，您可以选择 jupyter 或 jupyter lab。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oa"><img src="../Images/4f747df5c0a8fb47dee01c9944c89e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OeVEZeaoLlgukAo0C-KM-g.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">笔记本实例已创建！选择 Jupyter/JypyterLab</p></figure><p id="48e6" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">如果您需要克隆您的 git 存储库，从 jupyter 树的右上角打开终端，在那里显示 new，然后执行以下操作:</p><pre class="kt ku kv kw gt ob oc od oe aw of bi"><span id="f9dc" class="nm lu it oc b gy og oh l oi oj">cd SageMaker</span><span id="6043" class="nm lu it oc b gy ok oh l oi oj">git clone myFunSagemakerRepo</span></pre><p id="5afd" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">太好了！这应该为您设置了一个笔记本实例和一个 git hub 存储库。我们现在可以开始有趣的部分了！</p><h2 id="5d94" class="nm lu it bd lv nn no dn lz np nq dp md li nr ns mh lj nt nu ml lk nv nw mp nx bi translated">Sagemaker 会话和角色</h2><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ol"><img src="../Images/be9355e8ab4b527e8c255c22c241f81e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g6EV51CckZ9-miV9IeCZ7Q.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">初始化 sagemaker 会话和角色</p></figure><p id="4442" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">我们将使用 load_boston()方法从 sklearn 获取数据集。然后，我们将把这个数据集分成训练、验证和测试。</p><pre class="kt ku kv kw gt ob oc od oe aw of bi"><span id="14da" class="nm lu it oc b gy og oh l oi oj">#load the data<br/>boston_data = load_boston()</span><span id="32c1" class="nm lu it oc b gy ok oh l oi oj">#Training data<br/>X_bos_pd = pd.DataFrame(boston_data.data, columns=boston_data.feature_names)</span><span id="cf67" class="nm lu it oc b gy ok oh l oi oj">#Target<br/>Y_bos_pd = pd.DataFrame(boston_data.target)</span><span id="9c9f" class="nm lu it oc b gy ok oh l oi oj">#Train/Test split<br/>X_train, X_test, Y_train, Y_test = sklearn.model_selection.train_test_split(X_bos_pd, Y_bos_pd, test_size=0.20)</span><span id="8dbf" class="nm lu it oc b gy ok oh l oi oj">#Train/Validation split<br/>X_train, X_val, Y_train, Y_val = sklearn.model_selection.train_test_split(X_train, Y_train, test_size=0.33)</span></pre><p id="ac75" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">一旦创建了训练、验证和测试数据集，就需要将它们上传到 s3(简单存储服务)桶，以便 sagemaker 容器可以在执行训练作业时访问它们。最好用前缀指定位置，最好是型号名称和版本，以确保路径整洁。上传后，您可以从您的控制台转到 s3 服务并进行检查。</p><pre class="kt ku kv kw gt ob oc od oe aw of bi"><span id="a490" class="nm lu it oc b gy og oh l oi oj">prefix = 'boston-xgboost-example'</span><span id="1be6" class="nm lu it oc b gy ok oh l oi oj"><strong class="oc iu">test_location</strong> = session.upload_data(os.path.join(data_dir, 'test.csv'), key_prefix=prefix)<br/><strong class="oc iu">val_location</strong> = session.upload_data(os.path.join(data_dir, 'validation.csv'), key_prefix=prefix)<br/><strong class="oc iu">train_location</strong> = session.upload_data(os.path.join(data_dir, 'train.csv'), key_prefix=prefix)</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nl"><img src="../Images/62c0e086f78686e605a1693194cb498a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Iz2OA16wfD-kqUcR"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">检查 s3 中的存储桶创建</p></figure><h2 id="2ebe" class="nm lu it bd lv nn no dn lz np nq dp md li nr ns mh lj nt nu ml lk nv nw mp nx bi translated">Sagemaker 培训工作</h2><p id="15a3" class="pw-post-body-paragraph jt ju it jw b jx mr jz ka kb ms kd ke li mt kh ki lj mu kl km lk mv kp kq kr im bi translated">在 sagemaker 中训练机器学习模型涉及到创建一个训练作业。我们将使用<a class="ae ll" href="https://docs.aws.amazon.com/sagemaker/latest/dg/xgboost.html" rel="noopener ugc nofollow" target="_blank"> xgboost 模型</a>。请检查此处链接的文档，以确保您查看了 sagemaker 的要求和语法。</p><p id="a526" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">培训工作组件</p><p id="979d" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">要培训 sagemaker 模型，第一项任务是创建一个培训作业，包括以下内容:</p><ul class=""><li id="f7e5" class="mx my it jw b jx jy kb kc li mz lj na lk nb kr nc nd ne nf bi translated">培训/验证的 S3 位置(注意:这应该是 csv 文件)</li><li id="c317" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated">模型的计算资源(这不同于我们用于笔记本电脑的资源)</li><li id="a959" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated">输出 S3 位置(模型工件)</li><li id="f34c" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated">内置模型的停靠路径(<a class="ae ll" href="https://docs.aws.amazon.com/sagemaker/latest/dg/sagemaker-algo-docker-registry-paths.html" rel="noopener ugc nofollow" target="_blank">见此)</a></li></ul><p id="1104" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">模型估计器</p><ul class=""><li id="0cd7" class="mx my it jw b jx jy kb kc li mz lj na lk nb kr nc nd ne nf bi translated">为了训练一个模型，我们需要创建一个模型估计器。这将包含关于如何训练模型的信息(配置)。更多详情请看这里:<a class="ae ll" href="https://sagemaker.readthedocs.io/en/latest/estimators.html" rel="noopener ugc nofollow" target="_blank">估算器</a></li><li id="27cc" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated">我们将使用名为 get_image_uri 的 SageMaker 实用程序方法来获取内置算法的容器路径</li><li id="7173" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated">估计器初始化如下所示。这里我用了一个付费的例子。</li></ul><pre class="kt ku kv kw gt ob oc od oe aw of bi"><span id="eb91" class="nm lu it oc b gy og oh l oi oj">container = get_image_uri(session.boto_region_name, 'xgboost')</span><span id="d43a" class="nm lu it oc b gy ok oh l oi oj">#xgboost estimator<br/>xgb_estimator = sagemaker.estimator.Estimator(<br/>container, <br/>role,      <br/>train_instance_count=1,                                                                            train_instance_type='ml.m4.xlarge',                                                 output_path='s3://{}/{}/output'.format(session.default_bucket(), prefix),<br/>sagemaker_session=session<br/>)</span></pre><p id="bef8" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">模型超参数</p><ul class=""><li id="2d33" class="mx my it jw b jx jy kb kc li mz lj na lk nb kr nc nd ne nf bi translated">任何模型训练方法的关键部分，在我们开始训练之前，我们需要调用估计器的<strong class="jw iu"> set_hyperparameters </strong>方法。xgboost 超参数见此:<a class="ae ll" href="https://docs.aws.amazon.com/sagemaker/latest/dg/xgboost_hyperparameters.html" rel="noopener ugc nofollow" target="_blank">xgboost _ 超参数</a></li><li id="509f" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated">当估计器都设置好了，下一个开始训练的方法是 fit</li></ul><pre class="kt ku kv kw gt ob oc od oe aw of bi"><span id="e60f" class="nm lu it oc b gy og oh l oi oj">xgb_estimator.set_hyperparameters(max_depth=5,<br/>                        eta=0.2,<br/>                        gamma=4,<br/>                        min_child_weight=6,<br/>                        subsample=0.8,<br/>                        objective='reg:linear',<br/>                        early_stopping_rounds=10,<br/>                        num_round=200)</span><span id="87c3" class="nm lu it oc b gy ok oh l oi oj">train_s3 = sagemaker.s3_input(s3_data=train_location, content_type='csv')<br/>validation_s3 = sagemaker.s3_input(s3_data=val_location, content_type='csv')</span><span id="07d0" class="nm lu it oc b gy ok oh l oi oj">xgb_estimator.fit({'train': train_s3, 'validation': validation_s3})</span></pre><p id="8a06" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">模型评估</p><ul class=""><li id="9f7a" class="mx my it jw b jx jy kb kc li mz lj na lk nb kr nc nd ne nf bi translated">SageMaker 使用一个 transformer 对象来评估模型。(<a class="ae ll" href="https://sagemaker.readthedocs.io/en/latest/transformer.html" rel="noopener ugc nofollow" target="_blank">文档</a>)</li><li id="5d2f" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated">transformer 对象像 estimator 对象一样，需要知道实例计数以及它需要转换的测试数据的类型和格式。为了让 transformer 以批处理的方式评估测试数据，我们需要让它知道将文件分解成块的行的分割类型。</li></ul><pre class="kt ku kv kw gt ob oc od oe aw of bi"><span id="03a4" class="nm lu it oc b gy og oh l oi oj">xgb_transformer = xgb_estimator.transformer(instance_count = 1, instance_type = 'ml.m4.xlarge')</span><span id="a908" class="nm lu it oc b gy ok oh l oi oj">xgb_transformer.transform(test_location, content_type='text/csv', split_type='Line')</span><span id="1f65" class="nm lu it oc b gy ok oh l oi oj">xgb_transformer.wait()</span></pre><p id="2182" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">现在，为了将我们的数据从 s3 移回我们的笔记本进行分析，我们复制了它(我在 udacity 上学到的一个小技巧)</p><pre class="kt ku kv kw gt ob oc od oe aw of bi"><span id="a310" class="nm lu it oc b gy og oh l oi oj">!aws s3 cp --recursive $xgb_transformer.output_path $data_dir</span></pre><p id="d17c" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">现在我们来评估！</p><pre class="kt ku kv kw gt ob oc od oe aw of bi"><span id="81c7" class="nm lu it oc b gy og oh l oi oj">Y_pred = pd.read_csv(os.path.join(data_dir, 'test.csv.out'), header=None)</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi om"><img src="../Images/3ed2bcd66ab7698ad9e28620146ccc41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xD0zw92RZTcJEjbkYd7Zgw.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">y_pred 对 y_test</p></figure><h2 id="5d6f" class="nm lu it bd lv nn no dn lz np nq dp md li nr ns mh lj nt nu ml lk nv nw mp nx bi translated">模型部署</h2><p id="8aae" class="pw-post-body-paragraph jt ju it jw b jx mr jz ka kb ms kd ke li mt kh ki lj mu kl km lk mv kp kq kr im bi translated">通过高级 api 的模型部署非常简单。我将展示一个如何部署我们刚刚培训过的上述模型的示例。</p><pre class="kt ku kv kw gt ob oc od oe aw of bi"><span id="b31a" class="nm lu it oc b gy og oh l oi oj">#call deploy method to start an endpoint instance </span><span id="a929" class="nm lu it oc b gy ok oh l oi oj">xgb_predictor = xgb_estimator.deploy(initial_instance_count=1, instance_type='ml.m4.xlarge')</span><span id="df48" class="nm lu it oc b gy ok oh l oi oj">xgb_predictor.content_type = 'text/csv'<br/>xgb_predictor.serializer = csv_serializer</span><span id="7872" class="nm lu it oc b gy ok oh l oi oj">Y_pred = xgb_predictor.predict(X_test.values).decode('utf-8')</span><span id="8fed" class="nm lu it oc b gy ok oh l oi oj">#DON'T FORGET TO SHUT DOWN/CLEAN UP WHEN YOU ARE DONE!</span></pre><ul class=""><li id="b945" class="mx my it jw b jx jy kb kc li mz lj na lk nb kr nc nd ne nf bi translated">与我们评估 transformer 对象的方式类似，我们可以对部署的模型做同样的事情，这是我们在生产环境中真正想要做的事情，以保存能力日志并比较不同运行的结果以及<strong class="jw iu"> <em class="jv">概念漂移</em> </strong>(可能导致模型衰退的底层数据分布的变化)。</li><li id="7581" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated">根据测试集的大小，我们可以决定数据应该一次发送还是分块发送。</li><li id="7950" class="mx my it jw b jx ng kb nh li ni lj nj lk nk kr nc nd ne nf bi translated">Xgb predictor 需要知道文件的格式以及要使用的序列化程序的类型。</li></ul><p id="88f0" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">这是在 AWS Sagemaker 上尝试建立第一个 ml 工作流的非常简单的方法。我建议在转向复杂之前坚持超级简单！我们将在稍后的帖子中处理较低级别的 api，并真正进入细节，但为了获得基本的理解并建立对新框架的舒适感，请使用一些简单的数据集尝试这些设置，并尝试不同的可用模型。</p><h2 id="78f2" class="nm lu it bd lv nn no dn lz np nq dp md li nr ns mh lj nt nu ml lk nv nw mp nx bi translated">家政</h2><p id="7017" class="pw-post-body-paragraph jt ju it jw b jx mr jz ka kb ms kd ke li mt kh ki lj mu kl km lk mv kp kq kr im bi translated">请记住:</p><p id="f84c" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">&gt;删除端点和端点配置</p><p id="3258" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">&gt;删除模型</p><p id="bc38" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">&gt;删除 s3 存储桶</p><p id="fcf0" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">&gt;如果不使用笔记本实例，请将其停止</p><p id="60f6" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">SageMaker 文档:</p><p id="39ea" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated"><strong class="jw iu">开发者文档</strong>可以在这里找到:<a class="ae ll" href="https://docs.aws.amazon.com/sagemaker/latest/dg/" rel="noopener ugc nofollow" target="_blank"><strong class="jw iu">https://docs.aws.amazon.com/sagemaker/latest/dg/</strong></a></p><p id="7988" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated"><strong class="jw iu"> Python SDK 文档</strong>(也称高层方法)可以在这里找到:【https://sagemaker.readthedocs.io/en/latest/】<strong class="jw iu"/></p><p id="2d05" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated"><strong class="jw iu"> Python SDK 代码</strong>可以在 github 上找到这里:<a class="ae ll" href="https://github.com/aws/sagemaker-python-sdk" rel="noopener ugc nofollow" target="_blank"><strong class="jw iu">https://github.com/aws/sagemaker-python-sdk</strong></a></p><p id="76f7" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke li kg kh ki lj kk kl km lk ko kp kq kr im bi translated">一如既往地乐于助人，回答问题并渴望反馈！请让我知道你是否喜欢这个流程，简单/复杂等等。</p></div></div>    
</body>
</html>