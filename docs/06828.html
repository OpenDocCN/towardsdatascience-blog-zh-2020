<html>
<head>
<title>Obey the Testing Goat! Do Nothing Until You Have a Test</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">服从试验山羊！在你有测试之前什么都不要做</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/obey-the-testing-goat-do-nothing-until-you-have-a-test-5f17c714c0f9?source=collection_archive---------58-----------------------#2020-05-27">https://towardsdatascience.com/obey-the-testing-goat-do-nothing-until-you-have-a-test-5f17c714c0f9?source=collection_archive---------58-----------------------#2020-05-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div class="gh gi ir"><img src="../Images/2907c9392c91eb096062c0994b73cec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DMxsI_JiAAFvD8KAKF0vHg.png"/></div><p class="iy iz gj gh gi ja jb bd b be z dk translated">图片作者。</p></figure><div class=""/><div class=""><h2 id="d8f9" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">测试驱动的开发周期是 Django 应用程序向生产环境迁移的重要部分。在这篇简介中学习 TDD 的基础知识。</h2></div><p id="eacb" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我经历了惨痛的教训，比如数据库操作、登录或注册等功能部件在您没有注意到的情况下发生了故障。然而，你的用户<em class="lp">会注意到</em>。测试是的生产过程中至关重要的一部分，在这个故事中，我们将简要介绍如何测试您的 Django 应用程序。</p><p id="620e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这个故事包括:</p><ul class=""><li id="a7bc" class="lq lr je kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">测试驱动的开发周期</li><li id="af4b" class="lq lr je kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">单元测试简介</li><li id="7c68" class="lq lr je kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">用 Django 的<code class="fe me mf mg mh b">TestCase</code>进行单元测试</li><li id="e457" class="lq lr je kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">功能测试简介</li><li id="b454" class="lq lr je kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">功能测试登录页面</li></ul></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="8145" class="mp mq je bd mr ms mt mu mv mw mx my mz kk na kl nb kn nc ko nd kq ne kr nf ng bi translated">测试驱动的开发周期</h1><figure class="ni nj nk nl gt iv gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/9af4494c1771e649add47d08fd8fbfd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*LH3pImUzDsDuNJ2gq93_SA.png"/></div><p class="iy iz gj gh gi ja jb bd b be z dk translated"><a class="ae nm" href="https://www.obeythetestinggoat.com/" rel="noopener ugc nofollow" target="_blank"> TDD 周期</a></p></figure><blockquote class="nn"><p id="edb6" class="no np je bd nq nr ns nt nu nv nw lo dk translated">首先我们编写测试；然后我们运行它，检查它是否如预期的那样失败。只有这样，我们才能继续开发我们的应用程序。</p></blockquote><p id="adb2" class="pw-post-body-paragraph kt ku je kv b kw nx kf ky kz ny ki lb lc nz le lf lg oa li lj lk ob lm ln lo im bi translated">TDD 由<em class="lp">单元测试</em>组成，这是一种软件测试方法，通过这种方法，单个单元的源代码和<em class="lp">功能测试</em>。<strong class="kv jf">功能测试</strong>使用 Selenium，让我们驱动一个真正的 web 浏览器，这样我们就可以从用户的角度与应用程序的功能进行交互！功能测试的其他术语有<strong class="kv jf">验收测试</strong>、<strong class="kv jf">端到端测试、</strong>和<strong class="kv jf">黑盒测试</strong>。</p><p id="3523" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一些有用的 TDD 概念是<em class="lp">用户故事</em>和<em class="lp">预期失败</em>。</p><ul class=""><li id="6c7f" class="lq lr je kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated"><em class="lp">用户故事</em>:应用程序如何为用户工作的描述。用于构建功能测试。</li><li id="3736" class="lq lr je kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">预期失败:当一个测试以我们预期的方式失败。我们不打算明确地涵盖这一点，但是在传统的 TDD 周期中，你编写一个测试<em class="lp">期望它失败</em>，然后只重构它以便它不会失败。这样，您就知道当它失败时会发生什么，比如返回哪个错误消息，以及您是否希望对其进行更改以提供更多信息。</li></ul><p id="19e1" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们将在一个单独的文件<code class="fe me mf mg mh b">test.py</code>中编写单元测试，在一个单独的文件<code class="fe me mf mg mh b">functional_tests.py</code>中编写功能测试，我们将把它们放在我们的项目结构中，如下所示。</p><pre class="ni nj nk nl gt oc mh od oe aw of bi"><span id="18ca" class="og mq je mh b gy oh oi l oj ok">[projectname]/<br/>├── [projectname]/<br/>│   ├── __init__.py<br/>│   ├── forms.py<br/>│   ├── models.py<br/>│   ├── settings.py<br/>│   ├── templates/<br/>│   │   ├── home_page.html<br/>│   ├── <strong class="mh jf">tests.py<br/></strong>│   ├── urls.py<br/>│   ├── views.py<br/>│   ├── wsgi.py<br/>└── manage.py<br/>└── <strong class="mh jf">functional_tests.py</strong></span></pre><p id="b945" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">然后，我们可以使用以下命令行命令运行我们的测试:</p><pre class="ni nj nk nl gt oc mh od oe aw of bi"><span id="78eb" class="og mq je mh b gy oh oi l oj ok">-- unit tests --<br/>$ cd projectname<br/>$ python3 manage.py test</span><span id="bd36" class="og mq je mh b gy ol oi l oj ok">-- functional tests --<br/>$ cd projectname/projectname<br/>$ python3 functional_tests.py</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="f379" class="mp mq je bd mr ms mt mu mv mw mx my mz kk na kl nb kn nc ko nd kq ne kr nf ng bi translated">单元测试简介</h1><p id="6fb5" class="pw-post-body-paragraph kt ku je kv b kw om kf ky kz on ki lb lc oo le lf lg op li lj lk oq lm ln lo im bi translated">对于我们的第一个单元测试，我们将尝试解析<code class="fe me mf mg mh b">home_page</code>视图 URL，并检查它是否映射到正确的视图函数。我们应用程序的<code class="fe me mf mg mh b">home_page</code>的网址是<code class="fe me mf mg mh b">'/'</code>。<code class="fe me mf mg mh b">home_page()</code>必须是我们的视图中的一个函数，在我们的<code class="fe me mf mg mh b">urls.py</code>中有一个这样的 URL 映射</p><pre class="ni nj nk nl gt oc mh od oe aw of bi"><span id="7e70" class="og mq je mh b gy oh oi l oj ok">url(r'^$', views.home_page, name='home_page')  # Windows<br/>url('', views.home_page, name='home_page')  # Macintosh/Linux</span></pre><figure class="ni nj nk nl gt iv"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="df1a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在我们希望在运行命令<code class="fe me mf mg mh b">$ python3 manage.py test</code>时能够正确解决这个问题，事实也确实如此！</p><figure class="ni nj nk nl gt iv gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/d370b4bf64bfe4f7aeaf041949dccc0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*2ByELI5Nkfag0QMwXwajlA.png"/></div><p class="iy iz gj gh gi ja jb bd b be z dk translated">单元测试</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="0d4b" class="mp mq je bd mr ms mt mu mv mw mx my mz kk na kl nb kn nc ko nd kq ne kr nf ng bi translated">用 Django 的<code class="fe me mf mg mh b">TestCase</code>进行单元测试</h1><p id="95cc" class="pw-post-body-paragraph kt ku je kv b kw om kf ky kz on ki lb lc oo le lf lg op li lj lk oq lm ln lo im bi translated">对于我们的下一个单元测试，我们将尝试检查主页是否返回正确的 HTML 模板。</p><figure class="ni nj nk nl gt iv"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="60e5" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">然而，我们在这里做的事情非常幼稚。我们通过检查 HTML 代码和文本来检查 HTML 模板的内容。然而，如果我们改变<code class="fe me mf mg mh b">&lt;title&gt;</code>文本会发生什么？我们的测试会失败，因为文本现在不同了。</p><p id="c8d6" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一般来说，单元测试的一个规则就是<strong class="kv jf"> <em class="lp">不要测试常量</em> </strong>，测试 HTML 为文本很像测试常量。单元测试实际上是关于测试逻辑、流程控制和配置的。断言 HTML 字符串中的字符序列并不能做到这一点。</p><p id="85dd" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们可以使用 Django 的内置<code class="fe me mf mg mh b">TestCase</code>工具<code class="fe me mf mg mh b">assertTemplateUsed</code>来检查我们的模板，而不用检查常量！Django 模板放在我们项目的<code class="fe me mf mg mh b">templates</code>文件夹中(参见项目结构)，我们可以自动检查<code class="fe me mf mg mh b">home_page</code>的渲染模板。</p><figure class="ni nj nk nl gt iv"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="434e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">另外，<code class="fe me mf mg mh b">test_root_url_resolves_to_home_page_view(self)</code>功能隐含在<code class="fe me mf mg mh b">assertTemplateUsed</code>功能中。重构我们的单元测试现在只需要两行代码！</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="3213" class="mp mq je bd mr ms mt mu mv mw mx my mz kk na kl nb kn nc ko nd kq ne kr nf ng bi translated">功能测试简介</h1><p id="1eff" class="pw-post-body-paragraph kt ku je kv b kw om kf ky kz on ki lb lc oo le lf lg op li lj lk oq lm ln lo im bi translated">既然我们已经断言一些视图和功能的独立单元工作，我们将使用一个<em class="lp">用户故事</em>来构建一个使用 Selenium 的功能测试。</p><p id="b2b0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">Selenium 是一个使用 Selenium WebDriver 编写功能/验收测试的简单 API。它所做的是打开一个网络浏览器并阅读其内容来测试模拟用户体验。Selenium 的其他用例是 web 抓取动态网站。</p><p id="b510" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">使用 Selenium，您可以访问用于形成网页的源代码，并找到您想要访问的元素。这使我们能够自动填写数据库操作、登录用户或注册的表单。</p><p id="5f0a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为了在本地运行功能测试，我们需要两个终端。一个是用<code class="fe me mf mg mh b">$ python3 manage.py runserver</code>运行应用，一个是用<code class="fe me mf mg mh b">$ python3 functional_tests.py</code>运行应用。</p><p id="8741" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在下面的功能测试中，我们模拟了一个用户体验:用户将如何看到主页并声明它的信息。用户故事在评论中有详细描述。</p><figure class="ni nj nk nl gt iv"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="0b8f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe me mf mg mh b">setUp()</code>和<code class="fe me mf mg mh b">tearDown()</code>是打开网络驱动程序，然后关闭的功能。我们使用的是 Chrome webdriver，但是 Firefox 也可以使用，一旦安装，就可以在虚拟 Python 环境的 bin 路径中访问。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="2ad3" class="mp mq je bd mr ms mt mu mv mw mx my mz kk na kl nb kn nc ko nd kq ne kr nf ng bi translated">功能测试登录页面</h1><figure class="ni nj nk nl gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="ov ow di ox bf oy"><div class="gh gi ou"><img src="../Images/7b9173a8cd6a0b4385c118bd9bca26bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8-fDNEymd1D6ns9Bwo1PEQ.gif"/></div></div><p class="iy iz gj gh gi ja jb bd b be z dk translated">登录页面的功能测试</p></figure><p id="c5ac" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">正如你所看到的，这是一个非常简单的例子，用户检查了<code class="fe me mf mg mh b">title</code>文本和<code class="fe me mf mg mh b">header</code>文本。但是我们也可以使用 Selenium 来自动化表单提交。对于我们的下一个用户故事，我们将检查登录页面，看看它是否如我们预期的那样工作。</p><figure class="ni nj nk nl gt iv"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="373e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们使用<code class="fe me mf mg mh b">Keys</code>在登录表单中输入用户名和密码。由于该应用程序已经用 Google 的 RECAPTCHA 保护了表单提交，我们无法登录，但确实收到了一条错误消息，我们可以对其进行测试。</p><p id="7b4f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><strong class="kv jf">注意</strong>在我们的功能测试中，我们<em class="lp">是</em>测试常量，比如标题文本，或者错误消息文本，更好的做法是包含一个元素属性，比如<code class="fe me mf mg mh b">id="recaptcha_error"</code>并验证它。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="7488" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这个故事的灵感来自《用 Python 进行测试驱动的开发》一书。如果你想通过 Django 和 Selenium 了解更多关于 TDD 的信息，请查看<a class="ae nm" href="https://www.obeythetestinggoat.com/" rel="noopener ugc nofollow" target="_blank">！相信我，这只是冰山一角:还有很多东西要学。</a></p><figure class="ni nj nk nl gt iv gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/b38bfb3fc32e8c70647442a5ddc8bc70.png" data-original-src="https://miro.medium.com/v2/resize:fit:336/format:webp/1*zKFq5XaFAKhFlcebT5eadA.jpeg"/></div><p class="iy iz gj gh gi ja jb bd b be z dk translated">用 Python 进行测试驱动开发</p></figure></div></div>    
</body>
</html>