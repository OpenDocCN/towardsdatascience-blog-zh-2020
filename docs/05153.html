<html>
<head>
<title>How To Change DataTypes In Pandas in 4 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 4 分钟内改变熊猫的数据类型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-change-datatypes-in-pandas-in-4-minutes-677addf9a409?source=collection_archive---------10-----------------------#2020-05-03">https://towardsdatascience.com/how-to-change-datatypes-in-pandas-in-4-minutes-677addf9a409?source=collection_archive---------10-----------------------#2020-05-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fef2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 pandas 中有几个改变数据类型的选项，我将向您展示最常见的选项</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4fe35e3dac822177d8233bd1f92c37c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GbXnu3Tv9-1RhI_ILGmAyA.png"/></div></div></figure><p id="7233" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi lq translated">当我第一次使用 pandas 时，我一开始并没有对不同的数据类型有一个总体的了解，也没有进一步考虑它们。最迟当你想做第一个算术运算时，你会收到警告和错误信息，所以你必须处理数据类型。我们将看看以下命令:</p><blockquote class="lz"><p id="43c1" class="ma mb it bd mc md me mf mg mh mi lp dk translated">1.to _ numeric()-将非数字类型转换为数字类型(另请参见 to_datetime())</p><p id="aaeb" class="ma mb it bd mc md me mf mg mh mi lp dk translated">2.astype()-将几乎任何数据类型转换为任何其他数据类型</p></blockquote><p id="c47b" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我们将首先看一下用于转换非数字数据的<code class="fe mo mp mq mr b">to_numeric()</code>。<code class="fe mo mp mq mr b">astype()</code>是瑞士军刀，几乎可以把任何东西变成任何东西。我们开始吧！</p><h2 id="7d4c" class="ms mt it bd mu mv mw dn mx my mz dp na ld nb nc nd lh ne nf ng ll nh ni nj nk bi translated">to_numeric()的使用</h2><p id="8540" class="pw-post-body-paragraph ku kv it kw b kx nl ju kz la nm jx lc ld nn lf lg lh no lj lk ll np ln lo lp im bi translated">我们从创建数据帧开始:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="3911" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; amount_list = [1,2,'3',2,'4',5]<br/>&gt;&gt;&gt; cost_list = [1,2,'3',2,'4',5]<br/>&gt;&gt;&gt; date_list = ['2020-01-03', '2020-02-03','2019-12-12','2019-11-14','2020-01-02','2020-02-03']<br/>&gt;&gt;&gt; category_list = ['XZ',1,3,'PT','LM',4]<br/>&gt;&gt;&gt; df = pd.DataFrame({'Date':date_list,'Items': 'Car Saxophone Curler Car Slingshot Duff'.split(),<br/> 'Customer': 'Homer Lisa Marge Lisa Bart Homer'.split(),<br/> 'Amount': amount_list, 'Costs': cost_list, 'Category':category_list})</span><span id="7bd9" class="ms mt it mr b gy ny nv l nw nx">&gt;&gt;&gt; df<br/>         Date      Items Customer Amount Costs Category<br/>0  2020-01-03        Car    Homer      1     1       XZ<br/>1  2020-02-03  Saxophone     Lisa      2     2        1<br/>2  2019-12-12     Curler    Marge      3     3        3<br/>3  2019-11-14        Car     Lisa      2     2       PT<br/>4  2020-01-02  Slingshot     Bart      4     4       LM<br/>5  2020-02-03       Duff    Homer      5     5        4</span></pre><p id="4bb5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的数据框架中有六列。第一列包含<strong class="kw iu">日期</strong>，第二和第三列包含<strong class="kw iu">文本信息</strong>，第四和第五列包含<strong class="kw iu">数字信息</strong>，第六列<strong class="kw iu">字符串和数字</strong>。</p><p id="cee9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们检查第四和第五列的数据类型:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="7c53" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; df.dtypes<br/>Date        object<br/>Items       object<br/>Customer    object<br/>Amount      object<br/>Costs       object<br/>Category    object<br/>dtype: object</span></pre><p id="c5a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如我们所看到的，数据集的每一列都有数据类型 Object。当有文本或文本和非数字值的混合列时，使用此数据类型。我们现在用<code class="fe mo mp mq mr b">pd.to_numeric()</code>改变金额列的数据类型:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="85e2" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; pd.to_numeric(df['Amount'])<br/>0 1<br/>1 2<br/>2 3<br/>3 2<br/>4 4<br/>5 5<br/>Name: Amount, dtype: int64</span></pre><p id="505b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所需的列可以简单地作为函数的参数，输出是新生成的数据类型为 int64 的列。如果我们有相应的小数位，Pandas 将输出数据类型 float。重要的是，转换后的列必须用旧列替换，或者必须创建一个新列:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="f11d" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; df['Amount'] = pd.to_numeric(df['Amount'])<br/>&gt;&gt;&gt; df.dtypes<br/>Date        object<br/>Items       object<br/>Customer    object<br/>Amount       int64<br/>Costs       object<br/>Category    object<br/>dtype: object</span></pre><p id="93ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用<code class="fe mo mp mq mr b">.apply</code>方法，也可以一次转换多个列:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="358d" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; df[['Amount','Costs']] = df[['Amount','Costs']].apply(pd.to_numeric)<br/>&gt;&gt;&gt; df.dtypes<br/>Date        object<br/>Items       object<br/>Customer    object<br/>Amount       int64<br/>Costs        int64<br/>Category    object<br/>dtype: object</span></pre><p id="5309" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很简单，对吧？不过，你可能注意到我们漏掉了最后一栏。这里显然有非数字值，它们也不容易转换。如果我们像以前一样尝试，我们会得到一条错误消息:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="4255" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; pd.to_numeric(df['Category'])<br/>Traceback (most recent call last):<br/>  File "pandas\_libs\lib.pyx", line 1897, in pandas._libs.lib.maybe_convert_numeric<br/>ValueError: Unable to parse string "XZ"</span><span id="4493" class="ms mt it mr b gy ny nv l nw nx"><strong class="mr iu">During handling of the above exception, another exception occurred: [...]<br/>ValueError: Unable to parse string "XZ" at position 0</strong></span></pre><p id="53ef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">to_numeric()</code>接受错误论点。我们可以用<code class="fe mo mp mq mr b">corce</code>和<code class="fe mo mp mq mr b">ignore</code>。使用强制时，所有不可转换的值都存储为 nan，而使用忽略时，原始值将被保留，这意味着我们的列仍将具有混合数据类型:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="6117" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; pd.to_numeric(df['Category'], errors='coerce')<br/>    <br/>0    NaN<br/>1    1.0<br/>2    3.0<br/>3    NaN<br/>4    NaN<br/>5    4.0<br/>Name: Category, dtype: float64<br/>&gt;&gt;&gt; pd.to_numeric(df['Category'], errors='ignore')<br/>    <br/>0    XZ<br/>1     1<br/>2     3<br/>3    PT<br/>4    LM<br/>5     4<br/>Name: Category, dtype: object</span></pre><p id="1d1b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可能已经注意到，Pandas 会自动选择数值数据类型。在大多数情况下，这当然就足够了，在整数和浮点之间做出决定就足够了。然而，有时我们有非常大的数据集，我们应该优化内存使用。这可以通过向下浇铸来实现:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="44c3" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; pd.to_numeric(df['Amount'],downcast='integer')<br/>         <br/>0    1<br/>1    2<br/>2    3<br/>3    2<br/>4    4<br/>5    5<br/>Name: Amount, dtype: int8</span></pre><p id="0990" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个例子中，熊猫选择了可以容纳所有值的最小整数。</p><h2 id="a2c3" class="ms mt it bd mu mv mw dn mx my mz dp na ld nb nc nd lh ne nf ng ll nh ni nj nk bi translated">astype()的使用</h2><p id="3e44" class="pw-post-body-paragraph ku kv it kw b kx nl ju kz la nm jx lc ld nn lf lg lh no lj lk ll np ln lo lp im bi translated">使用<code class="fe mo mp mq mr b">astype()</code>方法。您可以详细指定该列应该转换为哪种数据类型。参数可以简单地附加到列中，Pandas 将尝试转换数据。我们可以再举一次之前的例子:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="7097" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; df['Amount'].astype(int)<br/>         <br/>0    1<br/>1    2<br/>2    3<br/>3    2<br/>4    4<br/>5    5<br/>Name: Amount, dtype: int32<br/>&gt;&gt;&gt; df['Amount'].astype(float)<br/>         <br/>0    1.0<br/>1    2.0<br/>2    3.0<br/>3    2.0<br/>4    4.0<br/>5    5.0<br/>Name: Amount, dtype: float64</span><span id="ee0a" class="ms mt it mr b gy ny nv l nw nx">df['Amount'].astype(str)<br/> <br/>0    1<br/>1    2<br/>2    3<br/>3    2<br/>4    4<br/>5    5<br/>Name: Amount, dtype: object</span></pre><p id="9534" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以专门定义数据类型:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="0d0b" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; df['Amount'].astype(np.int64)<br/>         <br/>0    1<br/>1    2<br/>2    3<br/>3    2<br/>4    4<br/>5    5<br/>Name: Amount, dtype: int64</span></pre><p id="b9c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样使用 astype()我们可以像以前一样一次改变几列:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="2725" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; df[['Amount','Costs']].astype(int)<br/> <br/>   Amount  Costs<br/>0       1      1<br/>1       2      2<br/>2       3      3<br/>3       2      2<br/>4       4      4<br/>5       5      5</span></pre><p id="9d3b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">与<code class="fe mo mp mq mr b">to_numeric</code>的不同之处在于，我们只能使用<code class="fe mo mp mq mr b">raise</code>和<code class="fe mo mp mq mr b">ignore</code>作为错误处理的参数。Raise 是默认选项:显示错误，不执行任何转换。With ignore 错误将被忽略，无法转换的值将保持其原始格式:</p><pre class="kj kk kl km gt nq mr nr ns aw nt bi"><span id="7a13" class="ms mt it mr b gy nu nv l nw nx">&gt;&gt;&gt; df['Category'].astype(int, errors='ignore')<br/> <br/>0    XZ<br/>1     1<br/>2     3<br/>3    PT<br/>4    LM<br/>5     4<br/>Name: Category, dtype: object</span></pre><h2 id="69c3" class="ms mt it bd mu mv mw dn mx my mz dp na ld nb nc nd lh ne nf ng ll nh ni nj nk bi translated">结论</h2><p id="d413" class="pw-post-body-paragraph ku kv it kw b kx nl ju kz la nm jx lc ld nn lf lg lh no lj lk ll np ln lo lp im bi lq translated"><span class="l lr ls lt bm lu lv lw lx ly di">我们</span>已经看到了如何用 to_numeric()和 astype()将列转换成熊猫。To_numeric()具有更强大的错误处理功能，而 astype()在转换方式上提供了更多的可能性。了解非数值会发生什么并明智地使用错误参数是很重要的。</p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><p id="07d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae og" href="https://medium.com/@droste.benedikt/membership" rel="noopener">如果您喜欢中级和高级数据科学，并且还没有注册，请随时使用我的推荐链接加入社区。</a></p></div></div>    
</body>
</html>