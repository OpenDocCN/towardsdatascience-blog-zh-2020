<html>
<head>
<title>COVID-19 Data Collection: A Python &amp; API Story.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新冠肺炎数据收集:Python 和 API 的故事。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/covid-19-data-collection-a-python-api-story-347aafa95e69?source=collection_archive---------33-----------------------#2020-04-20">https://towardsdatascience.com/covid-19-data-collection-a-python-api-story-347aafa95e69?source=collection_archive---------33-----------------------#2020-04-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b3b22d5cde657ce69ce8e26682c2117d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-37UG_UguY6HZKG0"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">图像来源</a></p></figure><p id="0966" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文将简要讨论使用 python 从 API 收集数据。这方面的议程如下。</p><ol class=""><li id="3f6b" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated"><em class="ln">使用 python 连接 API</em></li><li id="a7f4" class="le lf it ki b kj lo kn lp kr lq kv lr kz ls ld lj lk ll lm bi translated">将收集的数据解析为 CSV 格式</li><li id="33a7" class="le lf it ki b kj lo kn lp kr lq kv lr kz ls ld lj lk ll lm bi translated">一点点蟒蛇熊猫的味道</li></ol><p id="baf8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> API-应用编程接口:</strong></p><p id="be94" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设你想在你的程序中使用其他网站数据。你有不同的选择。你可以使用 BeautifulSoup 和 Scrapy 来抓取网站，也可以使用一个界面来帮助你和你的程序交流。那个接口就是 API。</p><p id="6f9d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">更详细地说，如果网站有 API，你可以将你的 connect 应用程序连接到互联网，它会将数据发送到服务器。然后，服务器检索数据，并根据您的应用程序执行某些操作。这主要是通过 API 实现的</p><h2 id="e101" class="lt lu it bd lv lw lx dn ly lz ma dp mb kr mc md me kv mf mg mh kz mi mj mk ml bi translated">那么安全问题呢？</h2><p id="9677" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">现代 API 具有多层安全特性。当您的应用程序向服务器发送请求时，当目标网站发送响应时，它们永远不会完全暴露在互联网上。这两种通信都是通过小数据包和按需共享的信息进行的。这是如此的可信，以至于很多大公司都是通过 API 来获得收入的。下面是关于 API 为什么有用的几点。</p><ol class=""><li id="653e" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">现代的 API 遵循 HTTP 和 REST 的标准，对开发人员友好。</li><li id="cfbc" class="le lf it ki b kj lo kn lp kr lq kv lr kz ls ld lj lk ll lm bi translated">这些不仅仅是一段代码，而且是为特定受众的消费而构建的。</li><li id="a234" class="le lf it ki b kj lo kn lp kr lq kv lr kz ls ld lj lk ll lm bi translated">API 的构建遵循适当的安全性、治理。它在 SDLC 中开发，并受到全面监控。</li></ol><p id="ab6d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个博客致力于使用 python 连接一个 API，同时我也会让你知道熊猫库的一些技术。这里我将使用新冠肺炎 API。你可以从 rapid-api 网站得到那个 API。这些人在制作不同的 API 方面做得很好。我会推荐访问网站或者你可以做一个自己用的 API。这个网站的好处是，你可以得到不同编程语言的样本代码。</p><p id="e1b2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">先决条件:</p><ol class=""><li id="dffa" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">python 3 的本地开发环境</li><li id="557c" class="le lf it ki b kj lo kn lp kr lq kv lr kz ls ld lj lk ll lm bi translated">API URL 和密钥</li></ol><p id="66f0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，密钥被用作第一安全措施来识别所请求的数据是真实的。它用于防止不道德地使用原料药。</p><blockquote class="mr"><p id="88c4" class="ms mt it bd mu mv mw mx my mz na ld dk translated">让我们开始编码吧。</p></blockquote><p id="24e2" class="pw-post-body-paragraph kg kh it ki b kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">步骤 1-导入这些必要的库</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="b949" class="lt lu it nl b gy np nq l nr ns">import json <br/>import pandas as pd<br/>import requests</span></pre><p id="89d9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">步骤 2-获取 API URL 和密钥并发送请求</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="4d10" class="lt lu it nl b gy np nq l nr ns">url = “<a class="ae kf" href="https://corona-virus-world-and-india-data.p.rapidapi.com/api_india" rel="noopener ugc nofollow" target="_blank">y</a>our url"</span><span id="3250" class="lt lu it nl b gy nt nq l nr ns">headers = {<br/> ‘x-rapidapi-host’: “api host”,<br/> ‘x-rapidapi-key’: “api token”<br/> }</span><span id="aaab" class="lt lu it nl b gy nt nq l nr ns">response = requests.request("GET", url, headers=headers)<br/>print(response)</span></pre><p id="c83f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果响应为 200，则表示请求成功。</p><p id="4764" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通常，API 有关于 API 细节及其用途的文档。一些 API 服务有 API 包装器，需要安装在你的电脑上才能访问 API。</p><p id="9f3c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">API 可能包含 JSON、XML 或任何定制格式的数据。为了解析数据，你可以在 python 中使用不同的库。请求和响应头通常包括请求头和密钥。这是关于您使用 API 服务的当前信息。</p><blockquote class="mr"><p id="ee10" class="ms mt it bd mu mv mw mx my mz na ld dk translated">瞧啊。！！你拿到结果了。</p></blockquote><figure class="nv nw nx ny nz ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/6bf51bb17d36bbb7f77c41f039842dd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DzaGFsswyEGmjq39eobXoQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">版权所有 Somesh</p></figure><p id="8f10" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是我得到的数据就像一个嵌套的 JSON 数据结构。让我们进一步处理它。</p><p id="ecec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">步骤 3-解析 JSON 数据</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="ae73" class="lt lu it nl b gy np nq l nr ns">parsed_data = json.loads(response.text)<br/>print(parsed_data)</span></pre><figure class="ng nh ni nj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/d5ea4d83bb3daa5d5b76bf9b9bc6f19d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*qfnpEhI3E4XhtUVHacizhA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">版权所有 Somesh</p></figure><p id="e0a4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">JSON 数据似乎更有条理。但是这些仍然是嵌套形式。让我们来弄平这个 JSON</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="c27c" class="lt lu it nl b gy np nq l nr ns">def flatten_json(json):<br/>   dict1 = {}</span><span id="4195" class="lt lu it nl b gy nt nq l nr ns">   def flatten(i, name=’’):</span><span id="78ca" class="lt lu it nl b gy nt nq l nr ns">      if type(i) is dict:<br/>         for a in i:<br/>             flatten(i[a], name + a + ‘_’)<br/>      else:<br/>         dict1[name[:-1]] = i</span><span id="9b68" class="lt lu it nl b gy nt nq l nr ns">   flatten(json)<br/>   return dict1</span><span id="9e87" class="lt lu it nl b gy nt nq l nr ns">df = pd.DataFrame.from_dict(flatten_json(parsed_data), orient=’index’)</span></pre><p id="e5e8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">flatten_json()将帮助您在单个 json 结构中制作嵌套的 json。</p><figure class="ng nh ni nj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/01e79b0af28954a8238d4c8805e5202e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*XLhvLFWcpwOlygv-3vb3Lw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">版权所有 Somesh</p></figure><p id="a7bc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个 JSON 很容易转换成 DataFrame。你得到的 csv 格式的数据是一列数字值。你看到的按字母顺序排列的数据实际上是索引。</p><blockquote class="mr"><p id="6558" class="ms mt it bd mu mv mw mx my mz na ld dk translated"><strong class="ak">让我们在数据集</strong>中应用一些熊猫技术</p></blockquote><ol class=""><li id="a220" class="le lf it ki b kj nb kn nc kr oc kv od kz oe ld lj lk ll lm bi translated"><strong class="ki iu">全州确诊病例</strong></li></ol><figure class="ng nh ni nj gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/c837b8b7c615cb116c61fade8ce5bdbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*gVY7sBrhmAKnY-yf8pErbQ.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">版权所有 Somesh</p></figure><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="163f" class="lt lu it nl b gy np nq l nr ns">states = [‘Andhra Pradesh’,’Arunachal Pradesh’, ‘Assam’, ‘Bihar’, ‘Chhattisgarh’, ‘Goa’, ‘Gujarat’, ‘Haryana’,<br/> ‘Himachal Pradesh’, ‘Jharkhand’, ‘Karnataka’, ‘Kerala’, ‘Madhya Pradesh’, ‘Maharashtra’, ‘Manipur’,<br/> ‘Meghalaya’, ‘Mizoram’, ‘Nagaland’, ‘Odisha’, ‘Punjab’, ‘Rajasthan’, ‘Sikkim’, ‘Tamil Nadu’,<br/> ‘Telangana’, ‘Tripura’, ‘Uttar Pradesh’, ‘Uttarakhand’, ‘West Bengal’, ‘Andaman and Nicobar Islands’,<br/> ‘Chandigarh’, ‘Dadra and Nagar Haveli’, ‘Daman and Diu’, ‘Delhi’, ‘Lakshadweep’, ‘Puducherry’,<br/> ‘Jammu and Kashmir’, ‘Ladakh’]<br/>list1 = []<br/>list2 = []<br/>for i in states:<br/> list1.append(df.at[‘state_wise_{}_confirmed’.format(i), 0])<br/> list2.append(i)<br/>df1 = pd.DataFrame(list(zip(list2,list1)), columns=[‘state’,’state_value’])</span></pre><p id="53ca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将有助于您根据各州获得已确认的案例详情</p><p id="820a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> 2 .重置 _ 索引()</strong></p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="f40e" class="lt lu it nl b gy np nq l nr ns">df.reset_index()</span></pre><figure class="ng nh ni nj gt ju gh gi paragraph-image"><div class="gh gi og"><img src="../Images/f8757b586a66ae9f03b6b527ed9f0bd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*yEXXkS63ZWvcZWj8YPpeLQ.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">版权所有 Somesh</p></figure><p id="2eb6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此处索引已更改。数据帧中的前一个索引已被转换为列。</p><p id="5078" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> 3。df.rename()-重命名列名</strong></p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="e4d9" class="lt lu it nl b gy np nq l nr ns">df = df.rename(columns={“index”: “Statewise_details”, 0 : “Values”})</span></pre><figure class="ng nh ni nj gt ju gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/69944e4ad17c1756de638a8dbc9de592.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*RejtcI4pr2Ujpy7_kFBHrw.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">版权所有 Somesh</p></figure><p id="c0b5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> 4。在[] </strong></p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="31d7" class="lt lu it nl b gy np nq l nr ns">print(df.at[4,’Statewise_details’],”:”,df.at[4,’Values’])</span></pre><p id="fbb6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">at[]可帮助您随时访问单元格值。输出如下所示</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="fc48" class="lt lu it nl b gy np nq l nr ns">total_values_deltaconfirmed : 1370</span></pre><p id="763e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> 5。根据状态为治愈、康复、死亡和确诊病例创建单独的数据帧，并将其合并</strong></p><p id="09fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您扩展案例 1 的逻辑(<strong class="ki iu">状态确认案例</strong>，您将得到以下结果</p><figure class="ng nh ni nj gt ju gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/8d58e3c4d463515d3f7f889d679930be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*mwqUAC1W3EucllPFNfzIaQ.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">版权所有 Somesh</p></figure><p id="980e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以使用熊猫来执行不同的操作。稍后，您可以使用 matplotlib、seaborn 和许多其他库和工具来可视化数据。</p><p id="2830" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个博客是一种收集数据的方式，这些数据在服务器中不断产生。很快我将带着另一个网络抓取的故事回来。</p><p id="f60f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望你喜欢自然语言处理<a class="ae kf" rel="noopener" target="_blank" href="/natural-language-processing-a-beginners-guide-part-i-1a5880cc3bdc">第一部分</a> &amp; <a class="ae kf" rel="noopener" target="_blank" href="/natural-language-processing-a-beginners-guide-part-ii-54a1bf8c0497">第二部分</a>。在<a class="ae kf" href="https://medium.com/@somesh.routray11" rel="noopener"> <strong class="ki iu"> Medium </strong> </a>关注我，或者订阅我的博客了解他们。一如既往，我欢迎反馈和建设性的批评，可以通过 Twitter @RoutraySomesh 联系。</p></div></div>    
</body>
</html>