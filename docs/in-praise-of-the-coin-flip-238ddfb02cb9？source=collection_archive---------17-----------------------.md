# 为了赞美抛硬币

> 原文：<https://towardsdatascience.com/in-praise-of-the-coin-flip-238ddfb02cb9?source=collection_archive---------17----------------------->

## 统计数字

## 不起眼的抛硬币如何帮助解决数据科学中的问题

![](img/92f5206d33bd3b26216a109c55377584.png)

来源:[像素](https://www.pexels.com/photo/close-up-of-coins-on-table-332304/)

1953 年，卡尔·巴克斯创作的一部名为[《翻转决定》](https://scrooge-mcduck.fandom.com/wiki/Flip_Decision)的唐老鸭漫画，提出了一种伪哲学，叫做*翻转主义。前提很简单:对于人生中每个需要做出决定的十字路口，选择一张硬币的正面(正面或反面)，投掷硬币，然后根据掷硬币的结果做出决定。作为哲学的发明者，巴蒂教授宣称:*

> “人生不过是一场赌博！让 flipism 图表你的漫谈！”

现在，不幸的是，在漫画中，对唐纳德来说，flipism 并不奏效。每个决定都要掷硬币，这给可怜的唐纳德带来了一连串的不幸。然而具有讽刺意味的是，为了得到应有的惩罚，唐纳德通过抛硬币找到了正确的门背后的欺诈行为，成功地追捕到了骗子教授巴蒂，所以也许这种哲学确实有一些价值(或者更有可能，只是证明了作者的力量)。

虽然我不一定主张过基于抛硬币的生活，但事实证明，抛硬币和管理抛硬币的基本统计原则在应用于数据中经常面临的一些问题时特别有效。

我们来看三个例子。

## 基准模型

想象一下，现在你已经训练了你的机器学习模型，比方说，在给定一些用户上下文信息的情况下，预测网页上广告的点击率。你使用一些关于你的用户的信息，例如，他们来自哪个国家，他们的人口统计信息，他们来自的登陆页面和一系列其他功能。如果他们在你的平台上工作，你可以使用基于他们在使用平台时所做的特性来提高你的模型的性能。

然后你训练你的模型。现在，

> 您可以使用什么样的最简单的基准来了解您的模型是否是高性能的？

值得注意的是，在这种情况下，任何训练有素的模型都必须以简单的抛硬币为基准。

如果我们以 50%的概率为广告的点击和非点击分别指定正面和反面，然后通过投掷硬币随机指定正面和反面来预测广告点击，我们得到一个*随机分类器*。现在，任何经过训练的模型的目标都很简单:**它必须至少击败随机预测器**。这就是为什么测量模型的准确性很重要，然后将其与随机预测值的准确性进行比较(平均而言，准确性为 50%)。

我们甚至可以更进一步:假设我们知道广告的历史基础点击率是 30%。然后，使用上面的硬币方法，我们现在模拟一个有偏向的硬币，正面有 30%的概率，反面没有。任何预测模型都必须击败这个新的随机预测基准。请注意，准确性不是衡量性能的唯一标准；其他如[假阳性率](https://en.wikipedia.org/wiki/False_positive_rate)，以及[精度和召回率](https://en.wikipedia.org/wiki/Precision_and_recall)也可以使用。

我们可以看到这如何应用于任何类型的二元类预测场景，随机预测器作为一个简单的健全性检查:**如果一个模型不能击败基准，那么是时候回到绘图板**。相反，如果它确实超过了基准，那么我们想量化多少。通过这个简单的比较，我们可以很容易地做到这一点，确信我们的模型不是出于随机的机会，而是比那更好。

## 计算大数

自计算的早期以来，计数一直是计算机科学的一个标准焦点。一个值得注意且重要的问题是大数的计数，以及确定大量项目的大小(基数)的相关问题，这是每个现代数据库系统都面临的问题。

假设你有一个有限的内存空间，但是必须计算非常大的数字。更具体地说，考虑这样一个场景，您受限于一个 32 位寄存器，并且需要计数到大于 2 -1= 65，535 的数。这种情况在高速网络路由器中很普遍，其中计数需要在非常短的时间窗口内在快速但昂贵的[静态随机存取存储器](https://en.wikipedia.org/wiki/Static_random-access_memory)上执行。

一个技巧是近似地计数*，即放松**必须精确计数的要求，而不是以一些小的误差幅度计数**。这里的基本原理是，一旦您处理大数字，与 1 亿的值相比，相差几百的小误差对某些应用程序来说并不是什么大问题，尤其是那些大致的数字已经足够可行的应用程序。*

*计算大数的简单算法如下:*

> *要增加计数器，掷一枚等于计数器当前值乘以数字的公平硬币。如果硬币每次都正面朝上，计数器加 1，否则什么都不做。*

*这就是众所周知的*莫里斯算法*，它是由贝尔实验室的罗伯特·莫里斯于 1977 年发明的。*

*看起来很简单，但是它是如何工作的呢？*

*假设计数器当前处于数字 2。现在，为了增加，我们连续两次投掷一枚公平的、无偏见的硬币，所以我们可以得到的排列是*

> *HH，HT，TH，TT*

*其中 *H* 代表正面， *T* 代表反面。按照上面的说明，我们只在 *HH* 上递增，实际上只以 0.25 的概率递增。因为下一个计数器状态将是 3，所以由计数器表示的数字范围在 4 和 8 之间(包括 8)。*

*随着计数器值变大，我们可以看到算法只是存储数字范围的以 2 为底的对数，*即* 1，2，4，8，…无限。由于任何数字 *N* 都可以用对数来表示，即 *log* ₂ *N，*那么莫里斯计数器所做的就是只**保留 *log* ₂ *N，*** 的第一个数字，换句话说就是数字 *N* 的**指数。***

*Phillipe Flajolet 对 Morris 算法进行了更彻底的分析，通过将其增量建模为离散时间生灭过程(他还在论文中创造了术语*近似计数*)。我们可以进一步扩展 Morris 算法(如果我们愿意的话),为更大的数字保留指数的指数**!***

*另一个有趣的花絮来自信息论分析。如果我们想要一个数字 *N* 的精确计数，我们将需要*对数* ₂ *N* 位。莫里斯提出了一种计数器，它使用*对数* ₂ *对数* ₂ *N* 位，因此只保留数字的指数。我们现在可以看到，内存增长的规模将比我们想要一个确切的数字要慢得多。*

*如今，Morris 算法已经被改进的算法所取代，例如现代数据库系统中使用的[*hyperlog log*](https://en.wikipedia.org/wiki/HyperLogLog)*算法，以及 SQL 方言中的近似不同计数函数，例如 [Presto](https://prestodb.io/docs/current/functions/hyperloglog.html) 和[雪花](https://docs.snowflake.net/manuals/user-guide/querying-approximate-cardinality.html)。然而，Morris 算法仍然是现代概率计数算法的先驱，并且是最容易实际实现的算法之一。**

## **伯努利多臂强盗**

**多臂土匪问题涉及在一组竞争选项中最大化期望回报的问题，其中每个选项的回报最初是未知的，但随着时间的推移是可发现的。这个术语暗指赌场中的一排排老虎机，也称为*独臂强盗*。**

**![](img/24605a7763aab5f10caabd069a735217.png)**

**一排独臂土匪。(来源:[派克斯](https://www.pexels.com/photo/slot-machines-3021120/))**

**在多臂土匪的情况下，一个赌徒必须玩一套吃角子老虎机，以找出随着时间的推移哪台机器将提供最高的预期奖励。当游戏者第一次开始时，游戏者不知道随着时间的推移哪台机器将提供最高的预期回报；如果游戏者这么做了，那么问题就变成了**通过独自在上面玩来利用**正确的吃角子老虎机。由于游戏者没有预先的知识，那么游戏者将不得不**探索**一组机器，随着时间的推移，确定产生最高预期回报的机器。**

**因此，在回报最初未知的环境中，我们有一个*探索对开发*的常见案例。你应该采取什么样的策略，你需要做多少探索和开发？开发得太快，你就有陷入局部最大值的风险；探索太多，你将永远无法最大化你的预期回报，因为你会从一个选项跳到另一个选项。**

**现实世界中的许多问题都会出现这种情况:投资组合分配、推荐系统、优化显示给用户的广告、搜索结果排名和约会。虽然有人可能会在最后一次申请时生气。**

**有趣的是，许多这样的问题都符合抛硬币的框架。让我们考虑我们想要向用户展示的广告的两种变体，目标是最大化点击率。我们在我们的平台上部署广告的两种变体，50%的用户群看到变体 A，而其余的看到变体 b。然后，随着时间的推移，我们希望分配更多比例的用户来查看表现最佳的变体。**

**我们可以对这个场景建模如下:当每个用户看到一个广告时，一次点击，比如说*头*头，就是一个奖励。广告 A 和 B 都可以被建模为具有不同翻转概率的硬币。然后，我们的任务是推断每个广告的点击率，这实质上是推断广告 A 和 B 的掷硬币概率。我们还想知道基于这些概率哪个是表现最好的变体(这可以用作[贝叶斯 A/B 测试](https://medium.com/convoy-tech/the-power-of-bayesian-a-b-testing-f859d2219d5)的基础)。**

**一旦我们做到了这一点，我们就可以计算出如何将用户比例分配给表现最好的广告。分配策略的主题仍然是一个活跃的研究领域，有一些著名的解决方案，如置信上限算法和 Thompson 抽样。点击这里，查看 Lilian Weng 对这些算法[的实现。](https://github.com/lilianweng/multi-armed-bandit)**

**我们可以将这个框架扩展到多种广告。多臂 bandit 公式已被各公司用作经典 A/B 测试的替代品，如[网飞](https://netflixtechblog.com/artwork-personalization-c589f074ad76)。**

**最好的部分是，它可以应用于广告以外的其他东西！您当然可以将它扩展到推荐商品和对一组搜索结果进行排名；对这两种情况的警告是，在 UI 中向用户显示项目时，您必须考虑位置偏差。其中一个版本用于在 [Canva](https://www.canva.com/) 对图片搜索结果进行排名，它已经投入生产有一段时间了。此后，它被更强大的算法所取代，但却是一个令人惊讶的难以推翻的基准！**

**虽然唐老鸭可能在抛硬币决定其人生道路方面运气不佳，但抛硬币解决数据科学中的问题确实非常有用。**

**不起眼的抛硬币是这样一个通用的框架，它可以作为二元选择情况下的一个有用的心理模型。下次你遇到问题的时候，想想你可以如何使用抛硬币！只是…不要做唐纳德做过的事。**

## **参考**

**[1]菲利普·弗莱约莱。“近似计数:详细分析”。[http://algo.inria.fr/flajolet/Publications/Flajolet85c.pdf](http://algo.inria.fr/flajolet/Publications/Flajolet85c.pdf)**

**[2]彼得·奥尔。“使用置信界限进行开发-探索权衡”，《机器学习研究杂志》第 3 期，2002 年，第 397–422 页。[http://www.jmlr.org/papers/volume3/auer02a/auer02a.pdf](http://www.jmlr.org/papers/volume3/auer02a/auer02a.pdf)**

**[3]威廉·r·汤普森。“根据两个样本的证据，一个未知概率超过另一个未知概率的可能性”。《生物计量学》, 25(3–4)，1933 年，第 285–294 页。[https://www.dropbox.com/s/yhn9prnr5bz0156/1933-thompson.pdf](https://www.dropbox.com/s/yhn9prnr5bz0156/1933-thompson.pdf)**