<html>
<head>
<title>Analysis of BiciMAD trips</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">双模态出行分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analysis-of-bicimad-trips-88ee2d0f7cdf?source=collection_archive---------57-----------------------#2020-04-06">https://towardsdatascience.com/analysis-of-bicimad-trips-88ee2d0f7cdf?source=collection_archive---------57-----------------------#2020-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="3f32" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">在</strong> <a class="ae ko" rel="noopener" target="_blank" href="/lets-analyze-e-bike-sharing-stations-of-madrid-e06b1c5af596"> <strong class="js iu">上一篇文章</strong> </a> <strong class="js iu">中，我分析了BiciMAD车站的位置和特征，现在是时候继续分析以了解用户要去哪里以及最受欢迎的路线是什么，根据他们的类别<em class="kp"> user_type </em>(订户、临时用户……)进行聚类。</strong></p><p id="5d9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，本文中讨论的图表、数据集、Tableau报告和Python笔记本可以在<a class="ae ko" href="https://github.com/simboli/Analysis-of-BiciMAD" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到(免费)。</p><h1 id="fe13" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">资料组</h1><p id="2ce3" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">为了对路线进行分析，我使用了马德里市交通局在其开放数据网站上提供的数据。从2017年4月到2018年9月，路线数据在18个存档中可用，JSON文件也一样多。该文件的每一行都是一个首尾相连的JSON，包含每次从底座上移除一辆电动自行车的信息(包括EMT雇主何时移除)。<br/>总的来说，这些文件包含了超过500万次提款的详细信息，每个存档大小为500到1500 Mb(压缩时)，值得注意的一点是，不幸的是，有17个压缩存档和1个RAR存档，这并不好，因为整个数据集太大，无法解压缩并导入到单个Pandas数据帧中。<br/>出于这个原因，我选择走一条不同的路:我确定了一些要提取的信息，然后编程Python来提取每个月的JSON文件，打开它们并一次保存想要的信息。该脚本一次处理25，000行，然后将这些行汇总到几个CSV文件中。</p><p id="34f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">EMT公司还提供了一个简短的指南来理解每个字段的含义，该指南有西班牙语版本，可从<a class="ae ko" href="http://opendata.emtmadrid.es/Documentos/Servicios-y-estructuras-Bicimad-V1-1.aspx" rel="noopener ugc nofollow" target="_blank">此链接</a>下载。</p><h1 id="8ac3" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">缺失数据</h1><p id="5f9f" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">乍一看，我们可以看到两个有趣的字段丢失了:自行车ID和用户ID。缺少用户ID很可能是因为隐私原因，但我无法理解自行车缺少唯一标识符的原因。提取站点之间每辆自行车的使用信息(由用户和EMT雇主)会非常有趣。</p><h1 id="1d6c" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">分析目标</h1><p id="a018" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">这项分析的目标是:</p><ul class=""><li id="3f18" class="lt lu it js b jt ju jx jy kb lv kf lw kj lx kn ly lz ma mb bi translated">了解BiciMAD用户的习惯，特别是他们何时使用自行车以及出于何种目的；</li><li id="e24d" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">了解用户是否有明显的细分；</li><li id="53ad" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">了解BiciMAD用户骑自行车最频繁的旅行。</li></ul><h1 id="21e5" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">探索性数据分析</h1><p id="1832" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">首先，我们评估我们所掌握的数据的数量和主要统计参数。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><pre class="mh mi mj mk gt mo mp mq mr aw ms bi"><span id="d01b" class="mt kr it mp b gy mu mv l mw mx">5478168</span></pre><p id="7251" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，我们验证插入和拔出工作站的id是否都存在于上一篇文章生成的注册表中。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi my"><img src="../Images/ab0889e42ad0fdee270e3214db97d51b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*mVsQuV8NH5QW0hTzcorHlQ.png"/></div></figure><p id="6a55" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个显而易见的方面是，站点的最大值是2008年。从上一篇文章中，我们知道这些站是由一个从1到175的ID来标识的，所以2008是一个异常值。</p><h2 id="5021" class="mt kr it bd ks nb nc dn kw nd ne dp la kb nf ng le kf nh ni li kj nj nk lm nl bi translated">2008站</h2><p id="4b9f" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">由于数据帧是由我制作的脚本生成的，我检查了EMT提供的原始数据中是否有转移到2008站的线路，以确保这不是我的错误。我取2017年12月的月份，因为(作为冬季月份)该文件肯定比其他月份小。<br/>2008年的值作为站点ID也出现在最初提供的数据中，因此它不是与我的数据汇总脚本相关的错误的结果。</p><p id="a9a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">直观地说，2008可能是一个逻辑站的ID，在那里放置有一些异常的自行车，例如，那些正在维修或被盗的自行车。对我来说，很难证实这一事实，但考虑到这些线只是总数中的几条，我可以将它们从数据框中删除，而不会对最终结果产生明显的伪造影响。</p><h2 id="1d98" class="mt kr it bd ks nb nc dn kw nd ne dp la kb nf ng le kf nh ni li kj nj nk lm nl bi translated">22号站</h2><p id="110b" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">路线中的另一个车站不在上一篇文章中创建的车站注册表中:车站编号22。<br/>通过两个简单的查询，我了解到该站可能仅在“2017-05-01”和“2017-12-01”之间活跃，现在它已经不存在了，但是EMT提供的关于该站的公开数据仅涵盖2018年7月至9月之间的几个月。</p><p id="0d5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了解决这个问题，我搜索了一些BiciMAD站的2017年地图，但没有获得有用的信息，因为地图上的站是用“数字”字段而不是“ID”标识的。</p><p id="d83a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为最后一次检查，我查看了ID为22的车站的上下两个车站。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/c36793791d5e9dedb60822956c99e69f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qbz0YO0j9CuLMN2qjM5Z9w.png"/></div></div></figure><p id="7c59" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从数据中，我们可以看到有一个站20a。通常当EMT用字母表字母识别一个站时，这是因为至少有两个附近的站，但是在这种情况下，站20b丢失了:很可能我正在寻找的ID=22站实际上是数字22b。</p><p id="0398" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些信息足以限制我的搜索范围:</p><ul class=""><li id="5297" class="lt lu it js b jt ju jx jy kb lv kf lw kj lx kn ly lz ma mb bi translated">ID=20之间的一个站</li><li id="7303" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">它从2017年5月1日到2017年12月1日一直在那里</li></ul><p id="9006" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从谷歌地图上，我终于可以找到ID=22的车站，这是20b车站，直到几个月前还位于<em class="kp">卡莱阿尔卡兰49 </em>。<br/>由于22号站确实存在于过去，我决定不从文件中删除它的台词。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/a93a3b09c128d4b3447177d20bc1cd39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1nDD0VJOd0VBN0njiWuXNA.png"/></div></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/43935f7752f96ff074f7f713579b15be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YvDr5VxMN0oM-zNgP34O9g.png"/></div></div></figure><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><h1 id="80de" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">trips分析</h1><p id="da14" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">在下图中，颜色<strong class="js iu">红色</strong>标识年度会员用户，颜色<strong class="js iu">蓝色</strong>标识临时用户，颜色<strong class="js iu">绿色</strong>，最终标识EMT雇主。</p><p id="dd28" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我将EMT提供的全部数据以月为粒度绘制在时间轴上，以了解自行车租赁数量是否存在季节性。</p><p id="3d5a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">结果(如图所示)是这项服务有很大的季节性。我们可以看到，除了8月份红线(年度会员用户)下降之外，这两条线路在夏季都有一个高峰，这可能是因为在8月份，由于假期，许多办公室的工作量较轻，因此可以证明<em class="kp"> user_type=1 </em>使用自行车从家到工作场所往返。</p><p id="7e23" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从这个图表我们可以得出更多的结论:</p><ul class=""><li id="cfc8" class="lt lu it js b jt ju jx jy kb lv kf lw kj lx kn ly lz ma mb bi translated">在冬季，马德里的气温非常寒冷，因此两个用户类型<em class="kp">都喜欢少骑自行车出行，而不喜欢其他交通工具；</em></li><li id="e4b0" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">从<em class="kp"> user_type=1 </em>到<em class="kp"> user_type=2 </em>的行程数之间有巨大的差距:它们是一起绘制的，但是检查y轴上左边和右边的刻度…它们有不同的数量级！</li></ul><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi ns"><img src="../Images/605b8c67540cc0d66089415afef017bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3wTWbm2nu9HuhVfarzYpIw.png"/></div></div></figure><p id="27e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该图显示了EMT提供的整个月份中一周内每天的行程，因此从2017年5月到2018年9月。显然，年度用户在一周的第一个和最后一个工作日有一个使用高峰，而临时用户几乎有一个补充使用。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/566969ac457b983c9681ba5483a20e6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-zeyVznPjmbWcLAD8LIy9g.png"/></div></div></figure><p id="f738" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这张图表中，我们可以看到一天中几个小时的行程变化。我认为红线支持这样的论点，即每年有很大一部分用户使用BiciMAD的电动自行车往返于家和办公室之间，我们可以很容易地看到用户从家通勤到工作场所(上午7-9点)，出去吃午饭(下午2-3点)，晚上5-7点回家。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/ab4720a123ed01400c326b647dbb228e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aq_Tugsi0RnqA0qpAxR_Lw.png"/></div></div></figure><p id="1c56" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在一系列的情节之后，我决定更进一步，看看EMT提供的整整一年半的时间，看看我是否能了解更多关于用户习惯的信息。出于这个原因，我决定制作3张<em class="kp">地图图</em>来了解工作日和整个时间线上的旅行分布。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/58a15659b92b39c81a0a4ee803251653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5aZJr-3ZmuCOeo5GNWYtdw.png"/></div></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/1615cd6f1fd4a210460e387a70b33e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BLDEoOVgL3qtcCtm4bzoJA.png"/></div></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/ead174ebc750476b21bb269241225114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UnYL8qot8u4x_2Nxn8pBEQ.png"/></div></div></figure><p id="cf47" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些图表向我展示了一些意想不到的数据，如果可能的话，这将是一个非常有趣的研究，可能会在未来的博客上发布:</p><ul class=""><li id="67fe" class="lt lu it js b jt ju jx jy kb lv kf lw kj lx kn ly lz ma mb bi translated">在五月、六月和八月，有几天几乎没有来自<em class="kp"> user_type=1 </em>(年度订户)的旅行，以及user_type=2(临时用户)和user_type=3(雇主)的爆炸式增长。这是非常可疑的！这可能是数据收集过程中的一个错误，或者可能是一些技术问题，阻止了年度用户使用他们的卡来租赁自行车，所以他们不得不作为临时用户进行租赁(许多EMT雇主正在努力解决这个问题)。</li><li id="4ecd" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">在周末有一个令人惊讶的EMT雇主使用自行车的高峰，如果他们在即将开始的一周内维护自行车或移动车队，这将是很有意思的。</li><li id="275b" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">2017年5月第一周的前几天，没有一个user_type=2次出行…对吗？</li><li id="9951" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">在2017年10月期间，在user_type=2的图表中有深蓝色的日子，这意味着在这段时间内有大量的旅行，比之前和之后的几周都多。了解这一高峰的原因会很有趣，这可能是一些关于BiciMAD服务的营销活动。</li></ul><p id="09ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于这个分析，我研究的最后一点是总的环行程数。环形旅行是在同一个车站开始和结束的旅行。考虑到租赁自行车的价格，用户不太可能拔掉自行车的插头，例如去超市而不把自行车插到另一个底座上，然后回来，除非这是一个非常快速的差事。在<em class="kp"> user_type=2 </em>之间进行环形旅行的可能性更大，因为他们可以骑自行车游览马德里市和一些有趣的景点(例如<em class="kp"> Retiro park </em>)，比步行更快。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><pre class="mh mi mj mk gt mo mp mq mr aw ms bi"><span id="5049" class="mt kr it mp b gy mu mv l mw mx">user_type <br/>0     5.336718 <br/>1     2.444495 <br/>2    10.882962 <br/>3    31.754358 <br/>Name: count, dtype: float64</span></pre><p id="8cbb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如我们可以看到的，组2的用户比组1的用户有更多的环行程。第三组(EMT雇主)的环形行程也有令人惊讶的31%，这可能表明大约31%的“行程”是为了维护电动自行车，而不仅仅是为了移动车队！</p><p id="a1c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们看看<em class="kp"> user_type=1 </em>最频繁的旅行</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/f603dfe61e9344c45690152c9eae29b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*4x0RU_Ob58Lpewx5d6GG7A.png"/></div></figure><p id="8add" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并且<em class="kp">用户类型=2 </em></p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/f3dbe6d940d544e0ad05f994a988dd8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*p7qsoRogctVAjgWTVTgYsw.png"/></div></figure><p id="7cbe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以对环形旅行得出同样的结论。</p></div></div>    
</body>
</html>