<html>
<head>
<title>Weather Forecasting: A Deep Learning Approach</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">天气预报:深度学习方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/weather-forecasting-a-deep-learning-approach-7ecddff0fa71?source=collection_archive---------16-----------------------#2020-05-25">https://towardsdatascience.com/weather-forecasting-a-deep-learning-approach-7ecddff0fa71?source=collection_archive---------16-----------------------#2020-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ff6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用印尼 10 年的数据集和 LSTM 模式预测天气</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/41cb8361b430504043e5a7b87b64ce6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r4MOjE_Sq-k0bb8YajESEw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@drjay93?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> SHAH Shah </a>在<a class="ae ky" href="https://unsplash.com/s/photos/raining?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3063" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">天气不仅与我们息息相关，而且对我们的生存至关重要。不利的天气可能会摧毁我们吃的食物、我们依赖的商业和我们依赖的福祉。因此，必须准确及时地预报天气，以便我们能够采取必要的预防措施，最大限度地减少与天气相关的风险。</p><p id="ac61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将了解如何利用印度尼西亚遍布群岛的 70 多个气象站的 10 年每日降水记录来提前预测天气，特别是降雨量。我们将建立一个基于<strong class="lb iu">长短期网络(LSTM)的模型。</strong></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="564a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">LSTM:概述</h1><p id="34cc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">LSTM 通常适用于时间序列数据(如我们的降水数据集)，因为它能够“记住”来自称为<strong class="lb iu">单元状态</strong>的特征的长期相关性/信息。这种细胞状态在整个网络中运行，并向下(或向上)传递信息，例如，来自一个序列的早期信息可以影响后来输入的预测。这种信息传递对于时间序列天气数据至关重要，因为每个输入都依赖于不同时间点的其他输入。</p><p id="cf1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">存储、删除、修改和传递的信息由<strong class="lb iu">门</strong>控制。下面的图 1 展示了 LSTM 模型的一般架构。本文假设读者熟悉 LSTM，但不会涉及网络架构的具体细节。如果你想了解更多，你可以访问这本简明扼要的 LSTM 简介。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/cace770db820b756504598221c2c97d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J5W8FrASMi93Z81NlAui4w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 1: LSTM 单个细胞的架构</p></figure><h1 id="d93a" class="mc md it bd me mf nb mh mi mj nc ml mm jz nd ka mo kc ne kd mq kf nf kg ms mt bi translated">天气预报:数据准备</h1><p id="b9a8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">既然我们已经解释了基本网络，让我们开始导入数据集。你可以在这里找到我们的雨量 CSV 数据<a class="ae ky" href="https://drive.google.com/open?id=1CL1l38xkg9NJTxUpq-i7CeMNjkp3BKIh" rel="noopener ugc nofollow" target="_blank">的清理版本。</a></p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="baa8" class="nl md it nh b gy nm nn l no np">import numpy as np<br/>import matplotlib.pyplot as plt<br/>import pandas as pd<br/>from keras.models import Sequential<br/>from keras.layers import LSTM, Dense, Dropout, Bidirectional</span><span id="ea12" class="nl md it nh b gy nq nn l no np">DATA_DIR = './dataset/rainfall.csv'<br/>dataset = pd.read_csv(DATA_DIR)<br/>rainfall_df = dataset[['rainfall']]</span><span id="2d95" class="nl md it nh b gy nq nn l no np">rainfall_df</span></pre><p id="f125" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CSV 的摘要可以在下面的<em class="mz">图 2 </em>中看到。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/6d21b603945e11f0378a2ff9ec7e58eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:286/format:webp/1*ieN_-tOChMcvbqn1ebVsIw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 2:降雨量数据框汇总</p></figure><p id="59de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们将按照 90:10 的比例分割训练集和测试集。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="5bb1" class="nl md it nh b gy nm nn l no np">train_split= 0.9<br/>split_idx = int(len(rainfall_df) * 0.9)</span><span id="5c1e" class="nl md it nh b gy nq nn l no np">training_set = rainfall_df[:split_idx].values<br/>test_set = rainfall_df[split_idx:].values</span></pre><p id="4376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的想法是利用过去 30 天的数据，预测未来 5 天的<strong class="lb iu">。为此，我们需要创建一个训练数据集，其中 x 值是 30 天的窗口化数据，相应的 y 值是未来 5 天的后续降雨量数据。</strong></p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="ba62" class="nl md it nh b gy nm nn l no np"># 5-day prediction using 30 days data</span><span id="fc9c" class="nl md it nh b gy nq nn l no np">x_train = []<br/>y_train = []<br/>n_future = 5 #Next 5 days rainfall forecast<br/>n_past = 30 #Past 30 days</span><span id="84e9" class="nl md it nh b gy nq nn l no np">for i in range(0, len(training_set) - n_past - n_future + 1):<br/> x_train.append(training_set[i : i + n_past, 0])<br/> y_train.append(training_set[i + n_past : i + n_past + n_future, 0])</span></pre><p id="4e81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在为训练集生成 x 和 y 之后，我们将确保数据类型是正确的，并且形状符合模型的要求。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="397c" class="nl md it nh b gy nm nn l no np">x_train , y_train = np.array(x_train), np.array(y_train)<br/>x_train = np.reshape(x_train, (x_train.shape[0] , x_train.shape[1], 1))</span></pre><h1 id="d360" class="mc md it bd me mf nb mh mi mj nc ml mm jz nd ka mo kc ne kd mq kf nf kg ms mt bi translated">天气预报:模型定义</h1><p id="b06b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们已经有了我们的训练集，我们将利用 LSTM 架构来定义我们的预测器。我们有以下内容:</p><ol class=""><li id="bae6" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated"><strong class="lb iu">双向</strong>:确保序列前一部分的信息对后一部分可用，反之亦然。</li><li id="609b" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated"><strong class="lb iu"> LSTM </strong> <strong class="lb iu"> (x3)层</strong>:30 个单元代表 30 天窗口化的历史数据集，而<em class="mz"> return_sequences </em>参数<em class="mz"> </em>指定每个单元的输出将作为下一层的输入。</li><li id="bbfc" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated"><strong class="lb iu"> Dropout (p=0.2) </strong>:用于正则化效果，防止网络过拟合训练集。</li><li id="241f" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated"><strong class="lb iu">密集层</strong>:有 5 个预测神经元，每个神经元代表未来的一天。</li></ol><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="b562" class="nl md it nh b gy nm nn l no np">EPOCHS = 500<br/>BATCH_SIZE = 32</span><span id="1c6e" class="nl md it nh b gy nq nn l no np">regressor = Sequential()</span><span id="f92f" class="nl md it nh b gy nq nn l no np">regressor.add(Bidirectional(LSTM(units=30, return_sequences=True, input_shape = (x_train.shape[1], 1))))<br/>regressor.add(Dropout(0.2))<br/>regressor.add(LSTM(units= 30, return_sequences=True))<br/>regressor.add(Dropout(0.2))<br/>regressor.add(LSTM(units= 30, return_sequences=True))<br/>regressor.add(Dropout(0.2))<br/>regressor.add(LSTM(units= 30))<br/>regressor.add(Dropout(0.2))<br/>regressor.add(Dense(units = n_future, activation=’relu’))</span><span id="f51d" class="nl md it nh b gy nq nn l no np">regressor.compile<br/>(<br/>optimizer=’adam’, <br/>loss=’mean_squared_error’, <br/>metrics=[‘acc’]<br/>)</span><span id="5e58" class="nl md it nh b gy nq nn l no np">regressor.fit<br/>(<br/>x_train, <br/>y_train, <br/>epochs=EPOCHS, <br/>batch_size=BATCH_SIZE<br/>)</span></pre><h1 id="8196" class="mc md it bd me mf nb mh mi mj nc ml mm jz nd ka mo kc ne kd mq kf nf kg ms mt bi translated">天气预报:推论</h1><p id="9a5c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">既然模型已经被训练了 500 个时期，我们就可以在准备好的测试集上进行推论了。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="f25a" class="nl md it nh b gy nm nn l no np">x_test = test_set[: n_past, 0]<br/>y_test = test_set[n_past : n_past + n_future, 0]</span><span id="1d02" class="nl md it nh b gy nq nn l no np">x_test, y_test = np.array(x_test), np.array(y_test)<br/>x_test = np.reshape(x_test, (1, x_test.shape[0], 1))</span><span id="4544" class="nl md it nh b gy nq nn l no np">predicted_temperature = regressor.predict(x_test)</span><span id="243f" class="nl md it nh b gy nq nn l no np">print('Predicted temperature {}'.format(predicted_temperature))<br/>print('Real temperature {}'.format(y_test))</span></pre><p id="5fff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们对样本数据集中的 30 天进行采样，预测结果及其对应的实际温度将打印如下:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="a9dc" class="nl md it nh b gy nm nn l no np">Predicted temperature <br/>[[47.51087   11.603558   2.5133722  0.         2.019637 ]]</span><span id="3c4a" class="nl md it nh b gy nq nn l no np">Real temperature <br/>[9.8 6.6 0.2 0.  0. ]</span></pre><h1 id="2688" class="mc md it bd me mf nb mh mi mj nc ml mm jz nd ka mo kc ne kd mq kf nf kg ms mt bi translated">讨论和结论</h1><p id="c96e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们的初始预测器似乎对极端降水水平(如 47 毫米)表现不佳。可以通过以下方式进行一些改进:</p><ol class=""><li id="ff6d" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">调整历史窗口期以说明季节性(如 120 天而不是 30 天)。</li><li id="251b" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">通过增加更多的 LSTM 层、改变损失函数和增加丢失概率来改进架构，以更好地正则化训练数据。</li></ol><p id="abb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总之，在天气预报(一般来说，时间序列数据集)的情况下，使用 LSTM 作为改进的基于 RNN 的架构是有趣的。并且能够以及时有效的方式进行天气预报不仅是有益的，而且对于直接或间接依赖好天气的大众来说是至关重要的。</p><p id="db4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:本文提供的数据已经被清理并合并成一个 CSV 文件。如果你想获得 70+印度尼西亚的天气信息，你可以随时 PM 我！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="e9de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="mz">做订阅我的邮件简讯:</em></strong><a class="ae ky" href="https://tinyurl.com/2npw2fnz" rel="noopener ugc nofollow" target="_blank"><em class="mz">https://tinyurl.com/2npw2fnz</em></a><em class="mz"/><strong class="lb iu"><em class="mz">在这里我定期用通俗易懂的语言和漂亮的可视化方式总结 AI 研究论文。</em> </strong></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5717" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><p id="bc01" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">[1] <a class="ae ky" href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/" rel="noopener ugc nofollow" target="_blank">了解 https://colah.github.io/posts/2015-08-Understanding-LSTMs/ LSTM 网</a></p><p id="1d60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2]【https://www.bmkg.go.id/ T2】印尼气象局:印尼</p></div></div>    
</body>
</html>