<html>
<head>
<title>How To Visualise Sydney’s Temperature Change Using Matplotlib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Matplotlib 可视化悉尼的温度变化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-visualise-sydneys-temperature-change-from-1859-to-2019-using-matplotlib-79b2dc7308c2?source=collection_archive---------31-----------------------#2020-01-12">https://towardsdatascience.com/how-to-visualise-sydneys-temperature-change-from-1859-to-2019-using-matplotlib-79b2dc7308c2?source=collection_archive---------31-----------------------#2020-01-12</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><figure class="it iu gq gs iv iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj is"><img src="../Images/a64e3c9fbaa0711786cda9484074b821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UtKTOx10jwqrLynbRE3oHA.gif"/></div></div><p class="jd je gk gi gj jf jg bd b be z dk translated">matplotlib 的动画情节</p></figure><div class=""/><div class=""><h2 id="c1d1" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">制作动画情节的详细指南</h2></div><p id="ca21" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">我相信你读过的主要时事之一一定是澳大利亚森林大火危机。这场毁灭性的灾难影响了超过 1000 万公顷的土地，这与葡萄牙的土地面积相当，估计有 10 亿只野生哺乳动物、鸟类和爬行动物被杀害(来源<a class="ae lu" href="https://www.nature.com/articles/d41586-020-00043-2" rel="noopener ugc nofollow" target="_blank">此处</a>)。越来越多的证据表明气候变化/全球变暖与今年的森林大火之间的联系，例如极端温度(高于平均温度 1.5 摄氏度)和长期干旱(来源<a class="ae lu" href="https://www.theguardian.com/australia-news/2020/jan/02/2019-australia-hottest-year-record-temperature-15c-above-average-temperature" rel="noopener ugc nofollow" target="_blank">此处</a>)。孤立地阅读这些数字，你可能看不到气候变化是如何随着时间的推移而演变的。从数据可视化的角度来看，使用时间序列图可能更有吸引力和信息量，而不是使用单个值来描述变化范围，时间序列图可以显示变量在大范围时间段内的动态趋势。因此，我借此机会利用悉尼的长期气温数据在<code class="fe lv lw lx ly b">matplotlib</code>中练习<code class="fe lv lw lx ly b">ax.xxx()</code>方法。如果你想知道<code class="fe lv lw lx ly b">matplotlib</code>中的<code class="fe lv lw lx ly b">ax.xxx()</code>方法是什么，请看一下<a class="ae lu" rel="noopener" target="_blank" href="/plt-xxx-or-ax-xxx-that-is-the-question-in-matplotlib-8580acf42f44">我的上一篇帖子</a>。这将有助于你理解这个职位，并进一步了解<code class="fe lv lw lx ly b">matplotlib</code>。</p><p id="05a8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">在这篇文章中，我将向你展示我是如何制作悉尼 160 年间年最高气温的动画时间序列图(如本文开头所示)的。在我们深入研究代码之前，这里有一些要点:</p><ol class=""><li id="73f7" class="lz ma jj la b lb lc le lf lh mb ll mc lp md lt me mf mg mh bi translated">1920 年前后，年最高气温超过 40°C 的年数从 13%增加到 30%。</li><li id="2cb6" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated">悉尼有史以来最高的日最高气温是 2013 年的 45.8 摄氏度。</li><li id="420b" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated">在 1920 年前后，经历长时间高温天气(定义为一年中日最高温度超过 30°C 的总天数)的几率分别为 12%和 24%。</li><li id="3d7f" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated">2019 年，与所有其他有记录的年份相比，我们经历了最多的高温日数(34 天)。</li></ol></div><div class="ab cl mn mo hy mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="in io ip iq ir"><h2 id="cdd9" class="mu mv jj bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">情节的结构和主题</h2><figure class="no np nq nr gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj nn"><img src="../Images/c7a1e6898b89001bd593288e28c29774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eB4O1FCRZ5L-E38bDX23FQ.png"/></div></div><p class="jd je gk gi gj jf jg bd b be z dk translated">图 1，静态版本</p></figure><p id="abd6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">作为一个独立的图形(图 1)，它至少应该包含三个部分，即标题、情节和脚注。前两部分很容易理解。至于脚注，通常用来表示该图的数据来源和特别说明。</p><p id="6cf7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">剧情无疑是整个人物最重要的部分。在这种情况下，我用两个不同的 y 轴分别表示<em class="ns">温度</em>和<em class="ns">日</em>，它们共用同一个 x 轴，即<em class="ns">年。</em> <code class="fe lv lw lx ly b">matplotlib</code>提供了创建<em class="ns">双</em>轴:<code class="fe lv lw lx ly b">ax.twinx()</code> / <code class="fe lv lw lx ly b">ax.twiny()</code>的简单方法。具体来说，<code class="fe lv lw lx ly b">ax.twinx()</code>创建一个新的<code class="fe lv lw lx ly b">axes</code>，它与<code class="fe lv lw lx ly b">ax</code>共享 x 轴，但可以有不同的 y 轴。同样，<code class="fe lv lw lx ly b">ax.twiny()</code>返回一个共享 y 轴的<code class="fe lv lw lx ly b">axes</code>，但是使用不同的 x 轴。在构建了人物框架后，我设置了一个未来色彩主题，灵感来自<a class="ae lu" href="https://d23.com/a-to-z/tron-legacy-film/" rel="noopener ugc nofollow" target="_blank"> Tron Legancy </a>。在<code class="fe lv lw lx ly b">matplotlib</code>中，我们可以通过<code class="fe lv lw lx ly b">plt.rc()</code>轻松配置体形样式。<code class="fe lv lw lx ly b">rc</code>代表<strong class="la jk"> C </strong>启动时自动<strong class="la jk"> R </strong> un 的配置文件。</p><figure class="no np nq nr gu iw"><div class="bz fq l di"><div class="nt nu l"/></div><p class="jd je gk gi gj jf jg bd b be z dk translated">使用 plt.rc()的 Tron 主题</p></figure><h2 id="0a83" class="mu mv jj bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">创建用于静态绘图的函数</h2><p id="c19d" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh nx lj lk ll ny ln lo lp nz lr ls lt in bi translated">我们来看看<code class="fe lv lw lx ly b">matplotlib</code>中创建动画剧情的 lite 函数。</p><pre class="no np nq nr gu oa ly ob oc aw od bi"><span id="04d4" class="mu mv jj ly b gz oe of l og oh">animation.FuncAnimation(<em class="ns">fig</em>, <em class="ns">func</em>, <em class="ns">frames=None</em>)</span></pre><p id="a839" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">从本质上来说，动画<code class="fe lv lw lx ly b">fig</code>只是<code class="fe lv lw lx ly b">func</code>用不同的值(<code class="fe lv lw lx ly b">frames</code>)获得的静态<code class="fe lv lw lx ly b">axes</code>的集合。这非常像动画书动画。以我为例，<code class="fe lv lw lx ly b">axes</code>(从 1859 年到 2019 年，即<code class="fe lv lw lx ly b">range(1859, 2020, 1)</code>)总共有 160 帧。解决了这个问题后，我创建了一个可以普遍应用于不同<code class="fe lv lw lx ly b">year</code>值的函数。</p><figure class="no np nq nr gu iw"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="17ec" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">这个函数的原理是一层一层的绘制元素(或者我也可以说是<code class="fe lv lw lx ly b">matplotlib</code>绘图中的原理)。我来一节一节的解释一下上面的函数。</p><ul class=""><li id="a6c2" class="lz ma jj la b lb lc le lf lh mb ll mc lp md lt oi mf mg mh bi translated"><code class="fe lv lw lx ly b">ax.clear()</code>和<code class="fe lv lw lx ly b">ax2.clear()</code>，之前的<code class="fe lv lw lx ly b">axes</code>应该在绘制新的之前被擦除，否则<code class="fe lv lw lx ly b">axes</code>中的旧内容仍会留在<code class="fe lv lw lx ly b">fig</code>上并记录在动画中。这也是为什么我没有把<code class="fe lv lw lx ly b">fig, ax = plt.subplots(figsize=(12,4), dpi=300)</code>和<code class="fe lv lw lx ly b">ax2 = ax.twinx()</code>包含在函数体中，而是在<code class="fe lv lw lx ly b">animation.FuncAnimation()</code>之前分别调用。绘图空间(即<code class="fe lv lw lx ly b">fig</code>、<code class="fe lv lw lx ly b">ax</code>、<code class="fe lv lw lx ly b">ax2</code>)只需设置一次，就像一个可重复使用的白板。</li><li id="bf9a" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt oi mf mg mh bi translated"><code class="fe lv lw lx ly b">df_tmp=df_sydney.loc[df_sydney[‘Year’] &lt;= Num_Year]</code>，标绘输入应为数据。新的<code class="fe lv lw lx ly b">axes</code>应该包含当前年度及其所有以前年度的数据(即<code class="fe lv lw lx ly b">&lt;=</code>)。因此，当<code class="fe lv lw lx ly b">animation.FuncAnimation</code>在任一给定年份使用<code class="fe lv lw lx ly b">Num_Year</code>调用<code class="fe lv lw lx ly b">draw_linechart</code>时，静态图中的线应该从开始(即 1859 年)跨越到被调用的年份(图 2)。</li></ul><figure class="no np nq nr gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj oj"><img src="../Images/3f1a61ae21738a191847f3cb4e20826c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bu4wryyFkUOUZqzwTtpRow.png"/></div></div><p class="jd je gk gi gj jf jg bd b be z dk translated">图 2，一个静态图形</p></figure><ul class=""><li id="7914" class="lz ma jj la b lb lc le lf lh mb ll mc lp md lt oi mf mg mh bi translated"><code class="fe lv lw lx ly b">ax.plot(df_sydney.Year, df_sydney.max_tmp_year*0, label=’_1', color=’#222222', zorder=1)</code>，这是第一行剧情。注意，这里使用的数据不是<code class="fe lv lw lx ly b">df_tmp</code>而是完整的数据帧<code class="fe lv lw lx ly b">df_sydney</code>。本节将为每个<code class="fe lv lw lx ly b">df_tmp</code>的<code class="fe lv lw lx ly b">axes</code>创建一个从起始年(1859)到结束年(2020)的框架。这保证了每个<code class="fe lv lw lx ly b">axes</code>的 x 轴具有相同的年份范围(即 1860–2020)，而不是随着<code class="fe lv lw lx ly b">df_tmp</code>的年份范围(即 1860- <code class="fe lv lw lx ly b">Num_Year</code>)而变化。此外，我只需要框架和线应该隐藏这一层，所以我为 y 轴的每个值(<code class="fe lv lw lx ly b">df_sydney.max_tmp_year</code>)计时 0。您可能会注意到分配给<code class="fe lv lw lx ly b">label</code>的值包含一个下划线，这是为了防止该层被稍后的自动图例元素选择(<code class="fe lv lw lx ly b">ax.legend()</code>)显示。这里用的另一个自变量是<code class="fe lv lw lx ly b">zorder</code>，可以认为是沿 z 轴的层序列，1 表示底层。</li><li id="f328" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt oi mf mg mh bi translated">从<code class="fe lv lw lx ly b">ax.plot()</code>到<code class="fe lv lw lx ly b">ax2.plot()</code>，这些增加了两条水平线，方便观众估算每年最高气温和累计天数的数值。</li><li id="4e67" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt oi mf mg mh bi translated">从<code class="fe lv lw lx ly b">ax.plot()</code>到<code class="fe lv lw lx ly b">ax.text()</code>这是<code class="fe lv lw lx ly b">fig</code>中绘制大部分元素(线条、头点、带头点的文字)的部分。这很容易理解。我唯一想再次强调的是<code class="fe lv lw lx ly b">ax.xxx()</code>的威力，它让每个<code class="fe lv lw lx ly b">axes</code>的操作变得足够简单。</li></ul><p id="5416" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">设置好<code class="fe lv lw lx ly b">draw_linechart</code>函数后，我们通过输入具体年份来画一个静态图。如果一切顺利，您将看到图 2。</p><pre class="no np nq nr gu oa ly ob oc aw od bi"><span id="5df4" class="mu mv jj ly b gz oe of l og oh"># run one frame to test the function<br/>fig, ax = plt.subplots(figsize=(12,4), dpi=300)<br/>ax2 = ax.twinx()<br/>draw_linechart(1987)</span></pre><h2 id="0e23" class="mu mv jj bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">动画图形摘要</h2><p id="7ea3" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh nx lj lk ll ny ln lo lp nz lr ls lt in bi translated">运行下面的代码将生成所有的帧并将它们分配给对象<code class="fe lv lw lx ly b">animator</code>。然后这个对象就可以通过<code class="fe lv lw lx ly b">animator.save()</code>保存成你想要的任何格式。我个人的偏好是另存为<code class="fe lv lw lx ly b">mp4</code>。最后要注意的是<code class="fe lv lw lx ly b">fig</code>背景颜色要用<code class="fe lv lw lx ly b">savefig_kwargs={‘facecolor’:’#222222'}</code>指定，否则会保存为白色，与<code class="fe lv lw lx ly b">Tron legancy</code>主题不一致。</p><pre class="no np nq nr gu oa ly ob oc aw od bi"><span id="7802" class="mu mv jj ly b gz oe of l og oh">import matplotlib.animation as animation</span><span id="ac07" class="mu mv jj ly b gz ok of l og oh">fig, ax = plt.subplots(figsize=(12,4), dpi=300)<br/>ax2 = ax.twinx()</span><span id="9924" class="mu mv jj ly b gz ok of l og oh">animator = animation.FuncAnimation(fig, draw_linechart, <br/>                                   frames=np.arange(df_sydney.Year.values.min(),df_sydney.Year.values.max(),1), interval=300)</span><span id="d1d2" class="mu mv jj ly b gz ok of l og oh">animator.save('./animation5.mp4', savefig_kwargs={'facecolor':'#222222'}) </span></pre><p id="f856" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">在这里，我从设计到代码演示了如何使用<code class="fe lv lw lx ly b">matplotlib</code>创建一个动画图表，这有助于我们更好地理解悉尼 160 年来的温度变化。你可以从我的<a class="ae lu" href="https://github.com/Perishleaf/data-visualisation-scripts/tree/master/matplotlib_sydney_temp" rel="noopener ugc nofollow" target="_blank"> Github </a>下载数据、动画、图表和 jupyter 笔记本。</p></div><div class="ab cl mn mo hy mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="in io ip iq ir"><p id="a4cc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">和往常一样，我欢迎反馈、建设性的批评以及听到关于您的数据科学项目的信息。你可以在 Linkedin 上找到我，现在也可以在我的网站上找到我。</p></div></div>    
</body>
</html>