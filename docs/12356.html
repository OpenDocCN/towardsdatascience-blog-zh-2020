<html>
<head>
<title>Machine Learning: Hidden Technical Debts and Solutions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习:隐藏的技术债务和解决方案</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-hidden-technical-debts-and-solutions-407724248e44?source=collection_archive---------44-----------------------#2020-08-25">https://towardsdatascience.com/machine-learning-hidden-technical-debts-and-solutions-407724248e44?source=collection_archive---------44-----------------------#2020-08-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f6db1cccc75fd5e7b61928bd0fa22574.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AdoZkKwmi8CZ-CKgU9mO1Q.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://www.shutterstock.com/image-photo/businessman-high-interest-debt-business-concept-720830461" rel="noopener ugc nofollow" target="_blank">埃尔努尔</a>在<a class="ae kf" href="https://www.shutterstock.com/" rel="noopener ugc nofollow" target="_blank">摄影站</a>拍摄的照片</p></figure><p id="c4a9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated"><span class="l lf lg lh bm li lj lk ll lm di">随着机器学习系统被广泛采用，解决各种行业(汽车、BFSI、娱乐、医疗、农业……)的复杂现实问题，随着时间的推移，改进和维护这些系统变得比开发和部署更加昂贵和困难。由于数据和其他特定 ML 问题的额外挑战，这些 ML 系统的长期维护比传统系统更加复杂[1]。在本文中，我们讨论了 ML 系统的一些隐藏的技术缺陷，下表总结了一些可能的缓解策略。</span></p><figure class="lo lp lq lr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ln"><img src="../Images/ae9fb7f2ebada083856d72ec0dfd5a2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7BBiRXpYUh3pE7ZhVvyd9Q.png"/></div></div></figure><p id="eb65" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated">软件工程中的抽象是可维护系统的最佳实践之一。严格的抽象边界有助于表达给定软件组件的输入和输出的不变量和逻辑一致性。但是很难在 ML 系统中实施如此严格的抽象边界，因为系统的预期行为是使用数据学习的，并且几乎没有办法将抽象与数据的异常分开。[3]</p><figure class="lo lp lq lr gt ju gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/249d20ec3aa39adaa6c8afd06ac20e8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*kNcTvEbrXDAR2fJgSpDAeg.png"/></div></figure><h1 id="c5a9" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">纠缠</strong></h1><p id="732d" class="pw-post-body-paragraph kg kh it ki b kj mr kl km kn ms kp kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">具体来说，假设我们有一个在模型中使用 f1，…，fn 特性的 ML 系统。因为特征分布的改变或添加新特征或删除现有特征改变了所有特征的重要性权重以及目标输出。这被称为<strong class="ki iu">改变任何东西都会改变一切(CACE) </strong>现象，不仅适用于输入特征，还适用于超参数、学习设置、采样方法、收敛阈值、数据选择以及基本上所有其他可能的调整[2]。</p><p id="bed8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了<strong class="ki iu">减轻</strong>这种情况，一种可能的解决方案是在预测变化发生时检测预测变化并诊断变化的原因，这种预测变化的一个原因可能是特征分布(漂移)的变化，这可以使用类似于<a class="ae kf" href="https://www.tensorflow.org/tfx/guide/tfdv" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> TensorFlow 数据验证</strong> </a> <strong class="ki iu"> </strong>的工具来发现，该工具支持模式偏斜、特征偏斜和分布偏斜检测。例如，如下图所示，通过可视化特征值的分布，我们可以捕捉到特征分布的这些问题。</p><figure class="lo lp lq lr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mw"><img src="../Images/0d261d96593c223ac62f283833063a83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BPckOzHzWPFE37hYI_8pxQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">来自<a class="ae kf" href="https://www.tensorflow.org/tfx/guide/tfdv#skewdetect" rel="noopener ugc nofollow" target="_blank"> TensorFlow 扩展数据可视化指南</a>的图像显示了特征分布</p></figure><p id="3bce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">未充分利用的数据依赖关系</strong></p><p id="3f46" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些依赖是由于<strong class="ki iu">遗留</strong>功能、<strong class="ki iu">ε</strong>功能、<strong class="ki iu">相关</strong>功能和<strong class="ki iu">捆绑</strong>功能造成的。</p><p id="c998" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">传统</strong>特性是早期模型开发中包含的特性，随着时间的推移，这些特性会因新特性而变得多余。</p><p id="49b0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">捆绑</strong>功能，当一组功能被评估并发现有益时，由于时间压力或类似的影响，在没有仔细调查所有功能的情况下，添加了捆绑中的所有功能，以提高衡量标准。</p><p id="7f3a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"><em class="mx">ε</em></strong>特征是包含在模型中的特征，因为它们在准确性或其他度量方面提供了非常小的增益。</p><p id="cce7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">相关</strong>特征是与其他特征具有高度相关性的特征。</p><p id="0448" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了<strong class="ki iu">减轻</strong>这些未充分利用的依赖性，人们可以依靠留一特征评估、<a class="ae kf" href="https://www.tensorflow.org/tfx/transform/api_docs/python/tft/pca" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">主成分分析、</strong> </a>、<a class="ae kf" href="https://en.wikipedia.org/wiki/Lasso_(statistics)" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">套索</strong> </a> <strong class="ki iu">规则化</strong>、<a class="ae kf" href="https://www.tensorflow.org/tutorials/generative/autoencoder" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">自动编码器</strong> </a>，使用类似<a class="ae kf" href="https://github.com/slundberg/shap" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu">【SHAP</strong></a>的可解释工具，或者使用<a class="ae kf" href="https://www.tensorflow.org/api_docs/python/tf/estimator/BoostedTreesEstimator" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">提升树估计器</strong> </a></p><p id="edd9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，SHAP 汇总图可以帮助我们确定特征的重要性以及特征值分布及其对预测的影响。下图显示了波士顿房价数据集的增强回归树模型的汇总图。</p><p id="8934" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1.LSTAT 是影响模型预测的最重要的特征，并且较低的特征值正有助于预测，而较高的特征值负有助于预测。</p><p id="fe8e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.CHAS 和 ZN 特征没有预测能力，可以安全地从模型中移除。</p><p id="f70a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">SHAP python 包还支持单个预测解释图、依赖图等。这也可以用于诊断预测变化。</p><figure class="lo lp lq lr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/c9916b6470e73a743abcda7e13ba358e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NI-cH03TnBwbcM_kMkGy_Q.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">图片来自<a class="ae kf" href="https://github.com/slundberg/shap" rel="noopener ugc nofollow" target="_blank"> SHAP Git 仓库</a>，Xgboost Boston 模型的汇总图</p></figure><h1 id="7ef5" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">反馈回路</h1><p id="494a" class="pw-post-body-paragraph kg kh it ki b kj mr kl km kn ms kp kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">这种债务主要存在于活的 ML 系统中，如果 ML 系统随着时间的推移得到更新，这通常最终会影响它们自己的行为。这些环可以以许多不同的形式(直接或间接)存在，并且不容易被检测到。</p><p id="efcf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，推荐系统经常根据用户活动持续推荐来自相似演员、流派等的项目。这种<strong class="ki iu">信念</strong>被放大或强化的现象被称为<a class="ae kf" href="https://en.wikipedia.org/wiki/Echo_chamber_(media)" rel="noopener ugc nofollow" target="_blank">回音室。</a>常见的<strong class="ki iu">缓解</strong>策略是通过收集显式反馈，包括搜索行为等，使这些闭环推荐系统开环。</p><h1 id="1adb" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">反模式</h1><p id="25de" class="pw-post-body-paragraph kg kh it ki b kj mr kl km kn ms kp kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">ML 系统中的实际学习或推理代码只占整个系统代码的一小部分，如下图所示，在 ML 系统中出现许多反模式是很常见的，应该避免。</p><figure class="lo lp lq lr gt ju gh gi paragraph-image"><div class="ab gu cl mz"><img src="../Images/ddabeda24244b911775bde96eb75df5f.png" data-original-src="https://miro.medium.com/v2/format:webp/0*LJYC56yi1aq0uHwI.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">真实世界 ML 系统的构建模块。图片来自<a class="ae kf" href="https://cloud.google.com/solutions/machine-learning/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning" rel="noopener ugc nofollow" target="_blank"> MLOps </a>解决方案</p></figure><ol class=""><li id="6866" class="na nb it ki b kj kk kn ko kr nc kv nd kz ne ld nf ng nh ni bi translated"><strong class="ki iu">粘合代码:</strong>这种反模式是由于支持代码使数据适合使用特定的 ML 模型/库而产生的，这可以通过使用标准预处理库<strong class="ki iu">来减轻</strong>，如<a class="ae kf" href="https://www.tensorflow.org/tfx/transform/get_started" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu">tensor flow Transform</strong></a><strong class="ki iu"/>，它使用<a class="ae kf" href="https://beam.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> Apache Beam </strong> </a>进行分布式计算，使用<a class="ae kf" href="https://arrow.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> Apache Arrow </strong> </a>进行矢量化<a class="ae kf" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> NumPy</strong></a></li><li id="abd5" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><strong class="ki iu">管道丛林:</strong>随着新的数据源被增量地添加到模型中，这导致代码充满了连接、采样步骤等。这可以通过一种<strong class="ki iu">全新的方法</strong>来<strong class="ki iu">减轻</strong>，即在模型开发冻结后从零开始开发管道代码，或者更全面地考虑数据收集和特征提取。</li><li id="e43e" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><strong class="ki iu">死的实验代码路径:</strong>作为胶合代码或管道丛林的结果，很多时候实验是通过实现实验代码路径来执行的，然而随着时间的推移，这些代码路径难以保持向后兼容性。通常的标准做法是审查并删除这些代码路径，以<strong class="ki iu">减轻</strong>这种债务。</li></ol><h1 id="736d" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">配置债务</h1><p id="a9c2" class="pw-post-body-paragraph kg kh it ki b kj mr kl km kn ms kp kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">由于机器学习系统每一步的可配置选项的范围，如使用哪些功能、如何选择数据、特定于模型的参数、预处理或后处理、模型部署等，这种债务可能会累积。这些配置错误可能代价高昂，导致严重的时间损失、计算资源浪费或生产问题。</p><p id="9e0d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了<strong class="ki iu">减轻</strong>的配置负担，通常的做法是将与模型、超参数搜索、预处理或后处理相关的参数保存在<a class="ae kf" href="https://yaml.org/" rel="noopener ugc nofollow" target="_blank"> YAML </a>文件、模块化模板、Jinja2 模板、基础设施代码等中。</p><p id="2078" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇博客中，我们看到了一些 ML 方面，如模型纠缠、数据(发现、来源、管理、版本)，以及这些数据和 ML 特定方面如何导致比传统系统更多的隐藏技术债务。此外，我们如何使用可视化、端到端机器学习框架(如<strong class="ki iu"> TensorFlow Extended </strong>)和最佳软件工程实践来缓解这些问题。在 ML 系统中存在更多的 ML 债务，涉及<strong class="ki iu">服务、监控、测试、再现性、过程管理</strong>等。我们将在以后的文章中讨论它们的缓解策略。</p><h1 id="2278" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">参考</h1><ol class=""><li id="c5c0" class="na nb it ki b kj mr kn ms kr no kv np kz nq ld nf ng nh ni bi translated"><a class="ae kf" href="https://papers.nips.cc/paper/5656-hidden-technical-debt-in-machine-learning-systems.pdf" rel="noopener ugc nofollow" target="_blank">https://papers . nips . cc/paper/5656-hidden-technical-debt-in-machine-learning-systems . pdf</a></li><li id="8796" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><a class="ae kf" href="https://www.microsoft.com/en-us/research/uploads/prod/2019/03/amershi-icse-2019_Software_Engineering_for_Machine_Learning.pdf" rel="noopener ugc nofollow" target="_blank">https://www . Microsoft . com/en-us/research/uploads/prod/2019/03/amershi-icse-2019 _ Software _ Engineering _ for _ Machine _ learning . pdf</a></li><li id="81a2" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><a class="ae kf" href="https://storage.googleapis.com/pub-tools-public-publication-data/pdf/43146.pdf" rel="noopener ugc nofollow" target="_blank">https://storage . Google APIs . com/pub-tools-public-publication-data/pdf/43146 . pdf</a></li><li id="653c" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><a class="ae kf" href="https://cloud.google.com/solutions/machine-learning/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning#characteristics" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/solutions/machine-learning/mlops-continuous-delivery-and-automation-pipeline-in-machine-learning</a></li><li id="54c7" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated">https://christophm.github.io/interpretable-ml-book/<a class="ae kf" href="https://christophm.github.io/interpretable-ml-book/" rel="noopener ugc nofollow" target="_blank"/></li><li id="1606" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><a class="ae kf" href="https://www.kaggle.com/reisel/how-to-handle-correlated-features" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/reisel/how-to-handle-correlated-features</a></li><li id="c639" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><a class="ae kf" href="https://matthewmcateer.me/blog/machine-learning-technical-debt/" rel="noopener ugc nofollow" target="_blank">https://matthewmcateer . me/blog/machine-learning-technical-debt/</a></li></ol></div></div>    
</body>
</html>