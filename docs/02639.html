<html>
<head>
<title>Musical Genre Classification with Convolutional Neural Networks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于卷积神经网络的音乐流派分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/musical-genre-classification-with-convolutional-neural-networks-ff04f9601a74?source=collection_archive---------4-----------------------#2020-03-14">https://towardsdatascience.com/musical-genre-classification-with-convolutional-neural-networks-ff04f9601a74?source=collection_archive---------4-----------------------#2020-03-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/fbd2a6d5537954a4a574df697c913762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J6B7sKVLB0hiDmKg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">阿德里安·科特在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="0461" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为音乐和数据的爱好者，将两者结合起来的想法听起来很诱人。Spotify 和 Shazam 等创新公司已经能够以巧妙的方式利用音乐数据为用户提供令人惊叹的服务！我想尝试处理音频数据，并尝试建立一个模型，可以根据歌曲的流派自动对歌曲进行分类。我的项目代码可以在这里找到<a class="ae kf" href="https://github.com/lelandroberts97/Musical_Genre_Classification" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="3e1f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">自动流派分类算法可以大大提高音乐数据库(如 AllMusic)的效率。它还可以帮助 Spotify 和 Pandora 等公司使用的音乐推荐系统和播放列表生成器。如果你热爱音乐和数据，这也是一个非常有趣的问题！</p><p id="fff5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个问题有两个主要挑战:</p><ol class=""><li id="97ac" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">音乐流派的定义很宽泛。以至于人们经常为歌曲的风格争论不休。</li><li id="8b61" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">从可以输入模型的音频数据中提取区别特征是一项艰巨的任务。</li></ol><p id="21db" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一个问题我们无法控制。这是音乐类型的本质，也是一种限制。第二个问题已经在音乐信息检索(MIR)领域进行了大量研究，该领域致力于从音频信号中提取有用信息的任务。</p><p id="add5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你花时间认真思考一下，这是一个很难的问题！<em class="ls">我们如何将气压振动转化为我们可以从中获得洞察力的信息？</em></p><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lt"><img src="../Images/1bfd193d7deb1101a6fb5f5fa3d280e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NBwHkeXoOu4fwA4dFdpyKw.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">在<a class="ae kf" href="https://www.pexels.com/" rel="noopener ugc nofollow" target="_blank">像素上找到的照片</a></p></figure><p id="71d3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我花了很多时间研究这个问题。为了建立一个模型，可以根据歌曲的流派对其进行分类，我需要找到好的特征。不断出现的一个有趣的特征是 mel 光谱图。</p><h1 id="4321" class="ly lz it bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">梅尔光谱图</h1><p id="38a1" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">mel 频谱图可以被认为是音频信号视觉表示。具体来说，它代表了频谱如何随时间变化。如果你想了解更多，我写了一篇文章(<a class="ae kf" href="https://medium.com/analytics-vidhya/understanding-the-mel-spectrogram-fca2afa2ce53" rel="noopener">这里</a>)深入探讨了这个话题。对于 TL；各位博士，这里有一个简短的总结:</p><p id="9fb7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">傅立叶变换是一种数学公式，允许我们将音频信号转换到频域。它给出了每个频率的振幅，我们称之为<strong class="ki iu">频谱</strong>。由于频率成分通常会随时间变化，我们对信号的重叠窗口段执行傅里叶变换，以获得频谱随时间的变化情况。这被称为<strong class="ki iu">声谱图</strong>。最后，由于人类不会在线性标度上感知频率，我们将频率映射到 mel 标度(音高的一种度量)，这使得音高距离相等时，人耳听到的声音距离相等。我们得到的是<strong class="ki iu">梅尔的光谱图。</strong></p><p id="845a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最精彩的部分？只用几行 Python 代码就可以生成。</p><pre class="lu lv lw lx gt nb nc nd ne aw nf bi"><span id="92ff" class="ng lz it nc b gy nh ni l nj nk">import librosa</span><span id="b582" class="ng lz it nc b gy nl ni l nj nk">y, sr = librosa.load('./example_data/blues.00000.wav')</span><span id="e0e8" class="ng lz it nc b gy nl ni l nj nk">mel_spect = librosa.feature.melspectrogram(y=y, sr=sr, n_fft=2048, hop_length=1024)<br/>mel_spect = librosa.power_to_db(spect, ref=np.max)</span><span id="90a6" class="ng lz it nc b gy nl ni l nj nk">librosa.display.specshow(mel_spect, y_axis='mel', fmax=8000, x_axis='time');</span></pre><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/4bd5e3f3504a88c956e8f38542b27c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ltpp_B9A0JYwYCsLuopwYA.png"/></div></div></figure><p id="0517" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很神奇，是吧？我们现在有了一种视觉上表现歌曲的方法。让我们来看一些不同流派歌曲的梅尔谱图。</p><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/8df7eda2faae5b73686e33c18ef18896.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L4vUyaY0Nh_0dHSmyBMoBg.png"/></div></div></figure><p id="21ed" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这太棒了。mel 声谱图中捕捉到了流派中的一些特质差异，这意味着它们可以制作出色的功能。</p><p id="0143" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们本质上所做的是将问题转化为图像分类任务。这很棒，因为有一个专门为这项任务制作的模型:卷积神经网络(CNN)。这让我想到了我项目的主要问题:<strong class="ki iu">卷积神经网络使用 mel 频谱图识别音乐流派的准确度有多高？</strong></p><p id="284d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们开始吧！</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h1 id="896f" class="ly lz it bd ma mb nv md me mf nw mh mi mj nx ml mm mn ny mp mq mr nz mt mu mv bi translated">收集和预处理数据</h1><p id="0676" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">我使用的数据集是 GTZAN 流派集合(在这里找到<a class="ae kf" href="http://marsyas.info/downloads/datasets.html" rel="noopener ugc nofollow" target="_blank"/>)。这个数据集在 2002 年的一篇关于体裁分类的著名论文中使用过。该数据集包括 10 种不同的流派(布鲁斯、古典、乡村、迪斯科、嘻哈、爵士、金属、流行、雷鬼和摇滚)，每种流派有 100 首歌曲(每个 30 秒样本)。因为他们都是。wav 文件，我可以使用 librosa 库将它们加载到 Jupyter 笔记本中。</p><p id="6d39" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如上所述，使用 librosa 计算 mel 谱图相当简单。我能够编写一个函数来计算每个音频文件的 mel 声谱图，并将它们存储在一个 numpy 数组中。它返回该数组以及带有相应流派标签的数组。</p><p id="9e03" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们已经有了我们的特性和目标，我们可以创建一个维持集，或者说验证集。我选择拿出 20%进行测试。</p><p id="6878" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在构建模型之前，必须采取几个步骤:</p><ol class=""><li id="2005" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">为了计算效率，mel 光谱图的值应该被缩放，使得它们在 0 和 1 之间。</li><li id="00c6" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">数据目前是 1000 行 128 x 660 的 mel 光谱图。我们需要将它调整为 1000 行 128 x 660 x 1，以表示有一个单一的颜色通道。如果我们的图像有三个颜色通道，RGB，我们将需要这个额外的维度为 3。</li><li id="18f5" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">目标值必须进行一次热编码，以便输入神经网络。</li></ol><p id="275b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">重要的是，我们必须在创建维持集后完成这些步骤，以防止数据泄漏。现在我们准备做一些建模！</p><h1 id="bb56" class="ly lz it bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">CNN 做的怎么样？</h1><p id="3fcf" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">在运行 CNN 之前，我想训练一个前馈神经网络(FFNN)进行比较。CNN 具有用于边缘检测的附加层，这使得它们非常适合于图像分类问题，但是它们往往比 FFNNs 在计算上更昂贵。如果 FFNN 也能做得一样好，就没有必要使用 CNN 了。由于这篇文章的主要焦点是 CNN，所以我不会在这里详细介绍模型，但最好的 FFNN 模型取得了 45%的测试分数。</p><p id="a2b2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如所怀疑的，CNN 模式做得更好！最好的 CNN 模型(基于测试分数准确度)取得了 68%的分数。这还不算太寒酸，尤其是考虑到问题的难度，但还是不算太大。训练分数为 84%，因此模型过拟合。这意味着它很好地适应了训练数据，但不能很好地推广到新数据。即便如此，这当然是学习。</p><p id="ec66" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我尝试了几种不同的架构来尝试改进模型，其中大多数都达到了 55%到 65%之间的精度，但我无法再提高了。大多数模型在大约 15 个时期后变得越来越过拟合，因此增加时期的数量似乎不是一个好的选择。</p><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/3efc70f2d36dedc6d53e9548d0e25200.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0W06C4J38t6eRn4sjSynkw.png"/></div></div></figure><p id="5d18" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是最终架构的总结:</p><ol class=""><li id="2dcc" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">输入层:128 x 660 个神经元(128 个梅尔标度和 660 个时间窗口)</li><li id="3886" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">卷积层:16 种不同的 3 x 3 滤波器</li><li id="3a2e" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">最大池层:2 x 4</li><li id="1aed" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">卷积层:32 种不同的 3 x 3 滤波器</li><li id="ac0e" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">最大池层:2 x 4</li><li id="0aab" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">致密层:64 个神经元</li><li id="a9ac" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">输出层:10 种不同风格的 10 个神经元</li></ol><p id="e86d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有隐藏层使用 RELU 激活函数，输出层使用 softmax 函数。使用分类交叉熵函数计算损失。辍学也被用来防止过度拟合。</p><h2 id="4e95" class="ng lz it bd ma ob oc dn me od oe dp mi kr of og mm kv oh oi mq kz oj ok mu ol bi translated">更深入的观察</h2><p id="a442" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">为了更深入地了解模型发生了什么，我计算了一个混淆矩阵，以可视化模型对实际值的预测。我发现的真的很有意思！</p><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/11f61b450a7b6351d6c7bbfb25ab6414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S1qM1sJzs9v0Kvt95SCVDA.png"/></div></div></figure><h2 id="f898" class="ng lz it bd ma ob oc dn me od oe dp mi kr of og mm kv oh oi mq kz oj ok mu ol bi translated">蓝调还是爵士？</h2><p id="477b" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">该模型几乎从未预测过蓝调，只正确分类了 35%的蓝调歌曲，但大多数错误分类都是爵士乐和摇滚乐。这很有道理！爵士乐和蓝调是非常相似的音乐风格，摇滚乐深受蓝调音乐的影响，并真正从蓝调音乐中走出来。</p><h2 id="964f" class="ng lz it bd ma ob oc dn me od oe dp mi kr of og mm kv oh oi mq kz oj ok mu ol bi translated">雷鬼还是嘻哈？</h2><p id="d861" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">这个模特也很难区分雷鬼和嘻哈。雷鬼一半的错误分类是 hiphop，反之亦然。再一次，这是有道理的，因为雷鬼音乐对 hiphop 音乐有很大的影响，并且有相似的特征。</p><h2 id="a143" class="ng lz it bd ma ob oc dn me od oe dp mi kr of og mm kv oh oi mq kz oj ok mu ol bi translated">这是石头吗？</h2><p id="210d" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">该模型将几种流派错误地归类为摇滚，尤其是蓝调和乡村音乐。这并不奇怪，因为摇滚音乐有如此多的分支，分成其他流派。布鲁斯摇滚和受乡村音乐影响的南方摇滚都很受欢迎。</p><h2 id="d6ee" class="ng lz it bd ma ob oc dn me od oe dp mi kr of og mm kv oh oi mq kz oj ok mu ol bi translated">这告诉我们什么？</h2><p id="63e0" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">这其实真的是个好消息！我们的模型遇到了和人类一样的困难。很明显，它正在学习音乐流派的一些区别因素，但它在与其他流派有共同特征的流派上遇到了麻烦。这又回到了第一个问题，那就是音乐流派的本质。他们很难区分！</p><p id="0521" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">即便如此，我还是要说，对于一台电脑来说，68%的准确率并不算太差，但我确实相信还有改进的空间。我可以自信地说，CNN 比 FFNN 做得更好，它能够相当准确地学习和预测歌曲的风格。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h2 id="842e" class="ng lz it bd ma ob oc dn me od oe dp mi kr of og mm kv oh oi mq kz oj ok mu ol bi translated">一个自然的问题</h2><p id="685a" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">如果我们去掉一些和其他流派有共同特征的流派，会发生什么？模型的表现会更好吗？它是如何处理二元分类的？这些是我脑海中仍然挥之不去的一些问题。如果你想深入这些问题，请关注我的下一篇文章。</p><p id="0726" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ls">未完待续……</em></p></div></div>    
</body>
</html>