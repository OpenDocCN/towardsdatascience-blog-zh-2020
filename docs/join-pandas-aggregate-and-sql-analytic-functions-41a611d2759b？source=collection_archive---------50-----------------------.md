# 连接熊猫聚合和 SQL 分析函数

> 原文：<https://towardsdatascience.com/join-pandas-aggregate-and-sql-analytic-functions-41a611d2759b?source=collection_archive---------50----------------------->

## 我们使用聚合函数 sum、average、min 和 max 实现移动平均、等级项目、累积和

![](img/09763ef32c80d6365bd1d8b46a912464.png)

[Naven Krcmarek : unsplash](https://unsplash.com/photos/HWbxSLvmSww)

SQL 分析函数用于将大型数据集汇总成一个简单的报告。这些功能产生的数据汇总可以很容易地可视化。这些功能有助于数据分析专家轻松分析复杂的数据。

在本文中，我们结合 pandas 聚合和分析函数来实现 SQL 分析函数。

SQL 分析函数有许多种类。我们将逐一介绍这些功能。但首先，让我们了解一下本文中使用的数据。

# 零售数据集

我们将使用 [Kaggle 数据集](https://www.kaggle.com/manjeetsingh/retaildataset)。以下是对数据集每一列的解释。

该数据集的销售日期从 2010 年 2 月 5 日到 2012 年 11 月 1 日。

商店——商店编号

部门——部门编号

日期—代表一周

Weekly_Sales —每个部门的商店每周销售额

IsHoliday 表示一周内的假期

这里是零售数据集的几行。

现在，让我们从 SQL 分析函数开始。

# 1.秩和稠密秩函数

秩和密秩提供了有序数据集的秩。这两个函数有一个小的区别。通过这个例子，我们可以很容易地理解这种差异，我将在本节的最后解释这一点。

**等级和密集等级的用例**

1.您可以使用这些函数来查找世界、大洲或国家的前 N 名亿万富翁。

2.计算商店中前 N 件商品在一天、一周、一月或一年中的销售额。

3.计算一家公司在世界不同地区的增长和业绩。

4.根据 GDP、饥饿指数、人口等对国家进行排名。

**SQL 秩和密集秩函数的 Pandas 等价物**

*   由等级和密集等级函数分配给索引 5314 和 6214 的等级是 141。并且由等级和密集等级函数分配给索引 2794 的等级是 143 和 142。这种类型的等级分配将等级函数与密集等级函数区分开来。
*   将总和替换为中值。agg 函数计算平均每周销售排名和密集排名。
*   使用 groupby 函数中的其他列可以更好地理解数据和 rank/dense rank 函数。

# 2.百分比等级函数

Percent rank 函数考虑一组行来计算一行的百分位值。其值范围在 0 到 1 之间。

**百分比等级的用例**

1.我们在竞争性考试中使用这个函数来根据考生的分数计算他们的百分位数。

2.这些公司使用这种方法计算每个员工的收入，同时考虑其他员工的收入。

**SQL 百分位等级函数的 Pandas 等价物**

*   在 2011 年 11 月 25 日，商店 4 的销售额最高，商店 10 的销售额次之。索引 1404 处的 Percent_weekly_sales 值表示商店 10 的销售额超过该商店的 97%。
*   将平均值替换为中的和。agg 函数根据每周销售总额计算百分比。

# 3.滚动功能

滚动函数计算指定时间范围内数据的平均值。它添加一个旧的数据点，并添加一个新的数据点来计算平均值和均值。但是指定的时间框架是不变的。

**滚动功能使用案例**

1.这种方法将帮助你找到股票的 50、100、200 天移动平均线。均线是股票交易者的重要技术指标。这将有助于他们预测股票价格的走向。

2.你可以用这种方法追踪蔬菜的价格。你可以查一下，淡季蔬菜的移动价格是多少。

**SQL 滚动功能的熊猫等价物**

*   的。滚动功能输入 5 表示，当前行+ 4 个先前行。的。mean()函数将取 5 行的平均值，并将结果存储在当前行中。也被称为 5 移动平均线周销售量。
*   若要避免 Weekly_Sales_rolling5 列的起始行为空值，请使用 min_period=1。
*   第 4 行的 Weekly_Sales_rolling5 列值表示第 0、1、2、3、4 行的 Weekly_Sales 值的平均值。

# 4.行数函数

行号函数为聚合组的每一行分配一个唯一的编号。

**行号功能的用例**

1.此函数将有助于查找组织中员工的第五大或倒数第二个薪金值。

2.您可以使用此函数计算一个组中数据点的总数。

**Pandas 等价于 SQL 行号函数**

*   熊猫。cumcount 函数为存储组中的每一行提供一个唯一的编号。由于行的编号从 0 开始，因此，我们使用。累计()+1。
*   此功能将帮助您找出商店 1 中销售额第五高的日期。

# 结论

SQL 分析函数看起来很难理解和实现。但是，你可以很容易地理解或掌握这些分析功能。还有其他类型的分析函数可用于数据分析。但是大多数情况下，我们在数据分析任务中使用上面的 SQL 函数。

使用这些函数深入研究数据并发现数据中的模式。