<html>
<head>
<title>A Classical Least Squares Method for Quantitative Spectral Analysis with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python实现定量光谱分析的经典最小二乘法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/classical-least-squares-method-for-quantitative-spectral-analysis-with-python-1926473a802c?source=collection_archive---------19-----------------------#2020-04-13">https://towardsdatascience.com/classical-least-squares-method-for-quantitative-spectral-analysis-with-python-1926473a802c?source=collection_archive---------19-----------------------#2020-04-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/7eb887223644e54443e0d61d797de1f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/1*6pF9hUhqO5JQcidQTeYWQg.gif"/></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">用经典最小二乘法寻找光谱成分</p></figure><p id="a980" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">摘要</strong>。在这个简短的教程中，将解释计算光谱之间相似性的经典最小二乘法。这种方法也称为比尔法，可用于估算未知光谱中不同组分的浓度。首先，将介绍物理背景和朗伯-比尔定律，然后是经典的最小二乘理论方法和正规方程的推导。最后，将使用Python实现来展示一个应用程序示例，说明如何计算样品光谱中不同组分的浓度。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="66f2" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">介绍</h1><p id="b120" class="pw-post-body-paragraph kb kc it kd b ke me kg kh ki mf kk kl km mg ko kp kq mh ks kt ku mi kw kx ky im bi translated">光谱学是研究固体、液体或气体发射、反射或散射光与波长的函数关系[1]。大多数光谱学方法因此被分类为吸收、发射或散射光谱学。一些例子是吸收、X射线、红外和拉曼光谱等。</p><p id="2ca7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有时，光谱研究中的物质是未知的。如果需要知道这种物质的成分，可以将其测量光谱(查询光谱)与已知物质(成分)的光谱库进行比较，以便进行识别。为此，使用搜索算法来搜索未知光谱，该算法基于相似性度量来计算分数，从而提供最接近匹配或浓度的列表。相似性度量是量化两个对象之间的相似性的函数。在某种意义上，这种度量与距离度量相反:对于相似的对象，它们返回一个大值，而对于不相似的对象，则返回零或负值。规范化后，相似度的范围在1(完全相似，表示对象相等)和0(完全不相似)之间。相似性度量也是推荐系统、聚类、分类或异常检测等其他活动的非常基本的构件。<br/>关于光谱学，有几种基于不同相似性度量的标准光谱搜索算法【2】。在下文中，经典的最小二乘法将用于识别未知物质的光谱，并获得混合物中已知物质的浓度。这种方法也称为直接最小二乘法、K矩阵校准算法或比尔法，因为它是基于比尔-朗伯定律。</p><h1 id="38b4" class="lg lh it bd li lj mj ll lm ln mk lp lq lr ml lt lu lv mm lx ly lz mn mb mc md bi translated">物理背景与经典最小二乘法——比尔法</h1><p id="f5a1" class="pw-post-body-paragraph kb kc it kd b ke me kg kh ki mf kk kl km mg ko kp kq mh ks kt ku mi kw kx ky im bi translated">比尔-朗伯定律将光的衰减与光穿过的材料的性质联系起来。它通常应用于物理和化学分析测量，并用于理解物理光学中的光衰减。比尔-朗伯定律表明，在任何给定的波长I下，吸光度(<em class="mo"> A </em>)与所选波长I下纯物质(k)的吸光度系数和纯物质(c)的浓度成正比:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/2f588cb374c4c13d3af33868c549d8c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:200/format:webp/1*qSrMpgfQVAU0SYgws9jbeg.png"/></div></figure><p id="539f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中吸收系数(kᵢ = aᵢL)是光通过材料的路径长度(l)与纯物质在选定波长I下的摩尔衰减系数或吸收率(a)的乘积，这是构成这种分子“光谱”的分子特性。</p><p id="0cd2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Aᵢ = kᵢc公式适用于样品中的单一纯物质或成分。当有多种吸收成分时，任何波长下的总吸光度是混合物中所有成分在该波长下的吸光度之和:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/6209fd8e1b44546bccbf5ceaa9e343d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:302/format:webp/1*evkDLLWh_xbU3sgt-iyLiQ.png"/></div></figure><p id="a35b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果我们记录的不是给定波长I的单个值A，而是具有w个点的整个吸收光谱，则最好用矩阵符号表示:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/fb958acaaa2fff4c2e45235da22e8f55.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*dquiYT4oTEEoGistxJQvgQ.png"/></div></figure><p id="1384" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">或者以更紧凑的方式</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/b1ab129413163ec020553f79bd8046df.png" data-original-src="https://miro.medium.com/v2/resize:fit:142/format:webp/1*mYZWBqkCoIBzomylKcMy2Q.png"/></div></figure><p id="f322" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在哪里</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/5d69a55f0d7b4c1acd548d19a2723968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*3MaMF69HqN73WGymHhY8SQ.png"/></div></figure><p id="f5a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，A是我们记录的吸收光谱(也称为查询光谱，或未知光谱，因为我们还不知道它包含什么)，K是纯组分光谱的矩阵(其中这些组分的光谱值排列在列中)，c是n种纯物质浓度的向量。</p><p id="e8b5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，有了我们测得的未知光谱Aᵢ的值，并知道组成混合物的纯组分光谱Kᵢⱼ的值，我们可以找到最佳确定混合物吸光度的浓度cⱼ<em class="mo">a。然而，</em>因为测得的光谱和纯物质光谱包含噪声，所以一般来说，方程A = Kc没有精确解。但是我们仍然可以找到c，使得乘积Kc尽可能接近A，如欧几里德范数所测量的:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi my"><img src="../Images/59887fa6cadcc3c6276849a6046c64a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:234/format:webp/1*1hbO5OCX8mOto8YdKBk7dw.png"/></div></figure><p id="a48c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">换句话说，我们希望找到c，使得误差A-Kc的平方和最小。误差定义为测得的光谱A与通过乘以K和c计算的光谱之间的差值，c将是等式A = Kc的最佳最小二乘解。</p><p id="cfd1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">利用这个事实</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/bac7dffc0f0a840d110d59ed25401b74.png" data-original-src="https://miro.medium.com/v2/resize:fit:264/format:webp/1*zLhig48LbzKFtUwMYj2qsg.png"/></div></figure><p id="c0cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们误差的欧几里德范数是</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi na"><img src="../Images/36babb87dbb44f72a3c5e4b185bcd7ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*KYtAb4ENjqpOnOOzPtH3-Q.png"/></div></figure><p id="f910" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了找到此类函数的最小值，我们只需对其进行推导，将结果表达式设置为零，并求解c。为此，我们将利用属性</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/8d7e6696a8d9f95b1f66a0a8267ecf34.png" data-original-src="https://miro.medium.com/v2/resize:fit:392/format:webp/1*18M5bK7mt_IhOlt_imLs5w.png"/></div></figure><p id="2034" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中x是向量，M是对称矩阵[4]。</p><p id="810d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以，</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/b6c626596abb2d5c07ae944b964d68b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*Y7zJfLRmelt52LrIgqglow.png"/></div></figure><p id="bda2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将该表达式设置为0，我们得到正规方程:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/033860827b7fe67e4221c47460dd5a38.png" data-original-src="https://miro.medium.com/v2/resize:fit:304/format:webp/1*m_4KbNgFPxjcEb6JY_lltg.png"/></div></figure><p id="8616" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其可以被求解以最终获得测量光谱和库中已知光谱之间的相似性分数，或者同样地，未知混合物中纯物质的浓度:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/4296e6327c69c4a24cd8ecdf10e23657.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*nVMcV0iOEyQkRUpnTnRfoA.png"/></div></figure><p id="134c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，A-Kc的平方和的二阶导数是一个半正定矩阵，这意味着解c是全局最小值(而不是最大值或鞍点)。</p><p id="9f9d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">关于这种方法的更详细的信息可以在《用于定量分析的化学计量技术》一书中找到[5]或者在spectroscopyonline网页上关于CLS的专栏[6]。</p><h1 id="5960" class="lg lh it bd li lj mj ll lm ln mk lp lq lr ml lt lu lv mm lx ly lz mn mb mc md bi translated"><strong class="ak">用Python实现的代码和示例</strong></h1><p id="e4b4" class="pw-post-body-paragraph kb kc it kd b ke me kg kh ki mf kk kl km mg ko kp kq mh ks kt ku mi kw kx ky im bi translated">首先，加载所需的Python包:</p><pre class="mq mr ms mt gt nf ng nh ni aw nj bi"><span id="7ce3" class="nk lh it ng b gy nl nm l nn no">import numpy as np<br/>import matplotlib.pyplot as plt<br/>from numpy.linalg import inv</span></pre><p id="3381" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">获得未知混合物中纯物质浓度的最小二乘公式定义为:</p><pre class="mq mr ms mt gt nf ng nh ni aw nj bi"><span id="e657" class="nk lh it ng b gy nl nm l nn no">def least_sq(sample_spectrum, components):</span><span id="5f1c" class="nk lh it ng b gy np nm l nn no">   # sample_spectrum (unknown spectrum): array of w values.<br/>   # components (known spectra): array of n (number of components) columns with w values.<br/>   # This def returns an array of n values. Each value is the similarity score for the sample_spectrum and a component spectrum.</span><span id="b310" class="nk lh it ng b gy np nm l nn no">   similarity = np.dot(inv(np.dot(components, components.T)) , np.dot(components, sample_spectrum))<br/></span><span id="258a" class="nk lh it ng b gy np nm l nn no">    return similarity</span></pre><p id="2f49" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们制作了一些光谱。这些光谱将由高斯峰组成。因此高斯函数被定义为:</p><pre class="mq mr ms mt gt nf ng nh ni aw nj bi"><span id="d3e6" class="nk lh it ng b gy nl nm l nn no">def Gauss(x, mu, sigma, intensity = 1):</span><span id="e0a1" class="nk lh it ng b gy np nm l nn no"># x is an array<br/># mu is the expected value<br/># sigma is the square root of the variance<br/># intensity is a multiplication factor<br/># This def returns the Gaussian function of x</span><span id="e873" class="nk lh it ng b gy np nm l nn no">    return intensity/(sigma * np.sqrt(2*np.pi)) * np.exp(-0.5*((x-mu)/sigma)**2</span></pre><p id="5595" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">并用它来创建三个不同的组件:</p><pre class="mq mr ms mt gt nf ng nh ni aw nj bi"><span id="ed0c" class="nk lh it ng b gy nl nm l nn no"># X-axis (Wavelengths)<br/>x_range =  np.linspace(100, 200, 1000)</span><span id="d316" class="nk lh it ng b gy np nm l nn no"># Let's create three different components</span><span id="8d82" class="nk lh it ng b gy np nm l nn no"># Component A<br/>mu_a1 = 120<br/>sigma_a1 = 2<br/>intensity_a1 = 1</span><span id="d7c2" class="nk lh it ng b gy np nm l nn no">mu_a2 = 185<br/>sigma_a2 = 2<br/>intensity_a2 = 0.2</span><span id="9b5a" class="nk lh it ng b gy np nm l nn no">gauss_a =  Gauss(x_range, mu_a1, sigma_a1, intensity_a1) + Gauss(x_range, mu_a2, sigma_a2, intensity_a2)</span><span id="8b28" class="nk lh it ng b gy np nm l nn no"># Component B<br/>mu_b = 150<br/>sigma_b = 15<br/>intensity_b = 1<br/>gauss_b = Gauss(x_range, mu_b, sigma_b, intensity_b)</span><span id="5de1" class="nk lh it ng b gy np nm l nn no"># Component C<br/>mu_c1 = 110<br/>sigma_c1 = 2<br/>intensity_c1 = 0.05</span><span id="0430" class="nk lh it ng b gy np nm l nn no">mu_c2 = 160<br/>sigma_c2 = 10<br/>intensity_c2 = 1</span><span id="9a41" class="nk lh it ng b gy np nm l nn no">gauss_c = Gauss(x_range, mu_c1, sigma_c1, intensity_c1) + Gauss(x_range, mu_c2, sigma_c2, intensity_c2)</span><span id="a507" class="nk lh it ng b gy np nm l nn no"># Spectra normalization:<br/>component_a = gauss_a/np.max(gauss_a)<br/>component_b = gauss_b/np.max(gauss_b)<br/>component_c = gauss_c/np.max(gauss_c)</span><span id="38ee" class="nk lh it ng b gy np nm l nn no"># How do they look?<br/>plt.plot(x_range, component_a, label = 'Component 1')<br/>plt.plot(x_range, component_b, label = 'Component 2')<br/>plt.plot(x_range, component_c, label = 'Component 3')<br/>plt.title('Known components in our mixture', fontsize = 15)<br/>plt.xlabel('Wavelength', fontsize = 15)<br/>plt.ylabel('Normalized intensity', fontsize = 15)<br/>plt.legend()<br/>plt.show()</span></pre><p id="c9e9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这导致接下来的三个不同的组件:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/b800dd06d8892c41a2033a0510f3bdc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*tXCIPECsnWtTz4stAQ3yCA.png"/></div></figure><p id="dbe0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这三个光谱将构成我们的分量矩阵或K矩阵，其中光谱按行排列。</p><p id="a308" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了生成查询谱，这三个分量将被乘以一个浓度并加在一起。为了让它更真实一点，将会添加一些噪声。</p><pre class="mq mr ms mt gt nf ng nh ni aw nj bi"><span id="3843" class="nk lh it ng b gy nl nm l nn no"># What concentrations we want them to have in our mixture:<br/>c_a = 0.5<br/>c_b = 0.3<br/>c_c = 0.2</span><span id="2b2b" class="nk lh it ng b gy np nm l nn no"># Let's build the spectrum to be studied: The mixture spectrum<br/>query_spectra = c_a * component_a + c_b * component_b + c_c *component_c<br/># Let's add it some noise for a bit of realism:<br/>query_spectra = query_spectra +  np.random.normal(0, 0.02, len(x_range))</span><span id="07c1" class="nk lh it ng b gy np nm l nn no">plt.plot(x_range, query_spectra, color = 'black', label = 'Mixture spectrum with noise')<br/>plt.title('Mixture spectrum', fontsize = 15)<br/>plt.xlabel('Wavelength', fontsize = 15)<br/>plt.ylabel('Intensity',  fontsize = 15)<br/>plt.show()</span></pre><p id="fbc5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">得到的混合光谱看起来像:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/7d51d43cacf6369b774c4fbf60c42de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*HwqeEWGZrogVTDWCIOFIXg.png"/></div></figure><p id="8083" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们的查询谱由三个已知成分(n=3)组成。因此，对于这个例子，矩阵形式的方程组看起来像:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/72cae0577fd81deaf5947f2822526fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*30m5FIShgfguwBA6Kip8fg.png"/></div></figure><p id="c141" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中w = 1000(波长轴有1000个值)。因此，A是由1000个值组成的向量，c是由3个值(三种成分浓度)组成的向量，K是3×1000矩阵。</p><p id="c954" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">已知A和K，现在可以重新计算“未知”混合物中3种成分的浓度:</p><pre class="mq mr ms mt gt nf ng nh ni aw nj bi"><span id="9148" class="nk lh it ng b gy nl nm l nn no"># Generate the components matrix or K matrix<br/>components = np.array([component_a, component_b, component_c])</span><span id="3c50" class="nk lh it ng b gy np nm l nn no"># Apply Least squares<br/>cs = least_sq(query_spectra, components)</span><span id="9448" class="nk lh it ng b gy np nm l nn no"># And plot the result:</span><span id="63ff" class="nk lh it ng b gy np nm l nn no">plt.plot(x_range, query_spectra, color = 'black', label = 'Mix spectrum' ) # Plot the unknown spectrum</span><span id="0821" class="nk lh it ng b gy np nm l nn no">plt.plot(x_range, np.dot(cs,components), color = 'red', linewidth = 2, label = 'Calculation') # Plot the calculated spectrum</span><span id="8a26" class="nk lh it ng b gy np nm l nn no">for i in np.arange(len(cs)):<br/>    plt.plot(x_range, cs[i]*components[i], label = 'c' + str(i)+ ' =               ' + str(np.round(cs[i], 3)))</span><span id="c7f8" class="nk lh it ng b gy np nm l nn no">plt.title('Mixture spectrum and calculated components', fontsize = 15)<br/>plt.xlabel('Wavelength', fontsize = 15)<br/>plt.ylabel('Intensity', fontsize = 15)<br/>plt.legend()<br/>plt.show()</span></pre><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/0ce4e3afa6d517346a9c937a147dc929.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*buRjuDP-o28cOgqeyjxPfQ.png"/></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">图:混合光谱(黑色)、计算光谱(红色)和计算成分光谱(蓝色、橙色和绿色)</p></figure><p id="7283" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">图中图例所示的计算浓度与设定值完全一致。<br/>注意混合物光谱没有归一化。在混合物光谱被归一化的情况下，这种归一化常数的倒数应该应用于所获得的浓度，以便具有正确的值。</p><p id="d4c7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下图显示了另外三个例子，其中计算的浓度与之前设定的值一致(参见图的标题)。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi nu"><img src="../Images/0f1813ea51de65ed89b2d7724de1360b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b0MVAQe96BvmMW1WqFbUBQ.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">再举三个例子。查询光谱是使用第一光谱的浓度= (0，0.5，0.5)、第二光谱的浓度c = (0.1，0.5，0.4)和第三光谱的浓度c = (0.2，0.2，0.6)生成的。用最小二乘法计算的曲线以蓝色、橙色和绿色显示，其计算的浓度写在图例框中。</p></figure><p id="2f91" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">使用Python库的最小二乘法:SciPy和Skit-learn </strong></p><p id="5065" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">或者，最小二乘问题也可以使用一些Python的库来解决。</p><p id="4a5a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以SciPy为例:</p><pre class="mq mr ms mt gt nf ng nh ni aw nj bi"><span id="05f8" class="nk lh it ng b gy nl nm l nn no">import scipy.optimize as optimization</span><span id="ba7a" class="nk lh it ng b gy np nm l nn no">x0 = np.array([1,1,1])</span><span id="e095" class="nk lh it ng b gy np nm l nn no">def func(params, xdata, ydata):<br/>    return (ydata - np.dot(xdata.T, params))**2</span><span id="74d5" class="nk lh it ng b gy np nm l nn no">optimization.leastsq(func, x0, args=(components, query_spectra))[0]</span></pre><p id="f1e9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">或使用Scikit-learn:</p><pre class="mq mr ms mt gt nf ng nh ni aw nj bi"><span id="7cfb" class="nk lh it ng b gy nl nm l nn no">import sklearn.linear_model as linear_model</span><span id="47a1" class="nk lh it ng b gy np nm l nn no">linear_model.LinearRegression().fit(components.T, query_spectra).coef_</span></pre><p id="c667" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">导致组分A、B和C的浓度分别为0.48、0.30、0.20。</p><h1 id="f1c1" class="lg lh it bd li lj mj ll lm ln mk lp lq lr ml lt lu lv mm lx ly lz mn mb mc md bi translated">总结和进一步的考虑</h1><p id="2568" class="pw-post-body-paragraph kb kc it kd b ke me kg kh ki mf kk kl km mg ko kp kq mh ks kt ku mi kw kx ky im bi translated">在这个简短的教程中，使用了一种经典的最小二乘法来计算光谱之间的相似性，并展示了这种方法如何用于估算吸收光谱中不同组分的浓度(比尔法)。给出了用Python实现这一点的三种不同方法(基于正规方程并使用SciPy和Scikit-learn包)。重要的是，这种方法不仅可以应用于吸收光谱，还可以应用于任何种类的光谱数据，例如拉曼光谱、红外光谱等。然而，由于某些伪像和副作用的存在，在应用任何相似性度量之前，需要几个光谱预处理步骤来清理光谱[2，7]。这些步骤包括光谱的裁剪和插值、尖峰去除(见我以前的帖子)、基线扣除、平滑和光谱归一化，这些在处理弱信号(例如拉曼光谱)时特别重要。但这将是另一篇文章的主题。</p><p id="1557" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Jupyter的原版笔记本可以在<a class="ae nz" href="https://github.com/nicocopez" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><p id="2457" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">致谢。</strong>我要感谢<a class="oa ob ep" href="https://medium.com/u/9fd2702e9b85?source=post_page-----1926473a802c--------------------------------" rel="noopener" target="_blank">豪尔赫·路易斯·希塔博士</a>、<a class="oa ob ep" href="https://medium.com/u/931dc03d0fba?source=post_page-----1926473a802c--------------------------------" rel="noopener" target="_blank">阿维纳什·米什拉</a>和<a class="oa ob ep" href="https://medium.com/u/eb06b41f4c3e?source=post_page-----1926473a802c--------------------------------" rel="noopener" target="_blank">安娜·索拉古伦-比斯科博士</a>花时间校对这些笔记。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="e2af" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">参考资料:</h1><p id="37f8" class="pw-post-body-paragraph kb kc it kd b ke me kg kh ki mf kk kl km mg ko kp kq mh ks kt ku mi kw kx ky im bi translated">[1]光谱学。维基百科。<a class="ae nz" href="https://en.wikipedia.org/wiki/Spectroscopy" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Spectroscopy</a></p><p id="00ca" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[2] Khan，S. S .，&amp; Madden，M. G. (2012年)。拉曼光谱的新相似性度量。<em class="mo">化学计量学和智能实验室系统</em>，<em class="mo"> 114 </em>，99–108。</p><p id="673a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[3]在Python中实现五个最流行的相似性度量。<a class="ae nz" href="https://dataaspirant.com/2015/04/11/five-most-popular-similarity-measures-implementation-in-python/" rel="noopener ugc nofollow" target="_blank">https://data aspirant . com/2015/04/11/five-most-popular-similarity-measures-implementation-in-python/</a></p><p id="4e0a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[4]济科·科尔特，Chuong Do(2015年9月30日)。线性代数复习和参考笔记。<a class="ae nz" href="http://cs229.stanford.edu/section/cs229-linalg.pdf" rel="noopener ugc nofollow" target="_blank">http://cs229.stanford.edu/section/cs229-linalg.pdf</a></p><p id="5ffd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[5] Kramer，R. (1998年)。定量分析的化学计量学技术。CRC出版社。</p><p id="de57" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[6]沃克曼和马克(2010年)。光谱学中的化学计量学:经典最小二乘法，第一部分:数学理论<br/><a class="ae nz" href="http://www.spectroscopyonline.com/classical-least-squares-part-i-mathematical-theory?id=&amp;pageID=1&amp;sk=&amp;date=" rel="noopener ugc nofollow" target="_blank">http://www . spectroscopyonline . com/classic-Least-Squares-Part-I-Mathematical-Theory？id =&amp;pageID = 1&amp;sk =&amp;date =</a></p><p id="84a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[7] Bocklitz，T. W .，Guo，s .，Ryabchykov，o .，n .，&amp; Popp，J. (2016)。基于拉曼的分子成像和分析:生物医学应用的灵丹妙药！？。<em class="mo">分析化学</em>，<em class="mo"> 88 </em> (1)，133–151。</p></div></div>    
</body>
</html>