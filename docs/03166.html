<html>
<head>
<title>How to Make a GPT2 Twitter Bot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何制作一个 GPT2 Twitter 机器人</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-make-a-gpt2-twitter-bot-8669df60e60a?source=collection_archive---------12-----------------------#2020-03-26">https://towardsdatascience.com/how-to-make-a-gpt2-twitter-bot-8669df60e60a?source=collection_archive---------12-----------------------#2020-03-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b0e7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它只有大约 100 行代码，但是 tweets 是无限的。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/2656bcf3e81d6e20e88d6b55700e6148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mCXx5mjKjqdozeBNAJfjuQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者对推特机器人的演绎</p></figure><h1 id="1fe2" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">介绍</h1><p id="b7f6" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我喜欢生成模型。向一台机器展示一堆数据，并让它画一幅画或写一个与原始材料相同的小故事，这是一件神奇的事情。如果我们不能正确地与他人分享，这些愚蠢的小模型有什么用？这毕竟是信息时代。在本帖中，我们将:</p><ol class=""><li id="0ba2" class="mi mj it lo b lp mk ls ml lv mm lz mn md mo mh mp mq mr ms bi translated">从头开始创建一个 Twitter 机器人</li><li id="5d41" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh mp mq mr ms bi translated">训练一个最先进的语言模型来为我们生成文本</li><li id="b1c3" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh mp mq mr ms bi translated">使用 Twitter API 来制作您的机器人 tweet！</li></ol><p id="edcb" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">当你完成教程后，你将能够创建一个像这样的机器人<a class="ae nb" href="https://twitter.com/deepproverbs" rel="noopener ugc nofollow" target="_blank"> one </a>来发布生成的谚语。这个项目的所有代码都可以在<a class="ae nb" href="https://github.com/nbertagnolli/DeepProverbs" rel="noopener ugc nofollow" target="_blank">这个资源库</a>中找到。开始吧:)。</p><h1 id="ddcd" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">设置</h1><p id="a4f1" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">本教程将使用 Python3。我们将使用<a class="ae nb" href="https://github.com/minimaxir/gpt-2-simple" rel="noopener ugc nofollow" target="_blank">gp T2-简单库</a>来训练我们的模型。它依赖于 tensorflow.contrib，后者在 tensorflow 2.0 中已被删除，因此您需要使用早期版本:/。很抱歉。为了简单起见，我把 docker 容器和 Makefile 放在一起，以便在<a class="ae nb" href="https://github.com/nbertagnolli/DeepProverbs" rel="noopener ugc nofollow" target="_blank">库</a>中运行。您可以通过构建 docker 容器来加载一个工作环境进行游戏:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="baeb" class="nh kv it nd b gy ni nj l nk nl">make build</span></pre><p id="b64c" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">然后跑步</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="31af" class="nh kv it nd b gy ni nj l nk nl">make run</span></pre><p id="1358" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">如果 Jupyter 更适合你，你也可以做</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="8266" class="nh kv it nd b gy ni nj l nk nl">make run-jupyter</span></pre><p id="dc09" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">请注意，端口设置为 8989，而不是通常的 8888。</p><h1 id="fda1" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">设置 Twitter</h1><p id="3b72" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">用 Twitter 建立一个机器人只需要你申请一个开发者账户，并把凭证和你想运行的任何代码链接起来。下一节将详细介绍如何设置开发人员帐户。这有点无聊，所以如果你已经有了，就跳到下一部分。</p><p id="897f" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">首先登录 Twitter，然后前往他们的<a class="ae nb" href="https://developer.twitter.com/" rel="noopener ugc nofollow" target="_blank">开发者网站</a>。您应该会看到类似下图的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/4f03f6bb9f7a3145282cc11850077699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VfVqHs_Atp22uARuYSD6ZQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">Twitter 开发者页面</p></figure><p id="9bd4" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">单击右上角的应用按钮。这将带你到一个新的页面，你需要点击“申请一个开发者帐户。”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/5a836d48133e8357ad1294ced77e012b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KuzJYI0APqn461N2Vo1pMw.png"/></div></div></figure><p id="fbaa" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">这将把你带到一个页面，询问你将如何使用开发者账户。我们正在制作一个机器人，所以选择那个，但是如果你感觉辣并且想要做其他事情，也标记那些。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi ns"><img src="../Images/408b00fde54f05da61a9c02f5d9cb8b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ETHU_BERmQxntYdXdSAyHw.png"/></div></div></figure><p id="508f" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">然后填写下一页的所有信息，并添加一个电话号码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/1ce71c3e3a3c389b1739267cf1faf2dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S2vjHZ8MrDREWrBtFI4EeQ.png"/></div></div></figure><p id="3c81" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">最后一页涉及两个需要回答的问题。下面我概述了我对每个获得批准的问题的回答。如果你打算像我一样使用这个机器人，只是为了有时发推文，请随意复制它们。您可以将其他内容标记为与此 bot 无关。</p><p id="6cb8" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">请用英语描述您计划如何使用 Twitter 数据和/或 API。回复越详细，就越容易审核和批准。</p><p id="d554" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated"><em class="nt">“我计划建造一个小机器人，它将使用 GPT2、马尔可夫链或 RNN 的某种变体，每天就给定的主题发布简单的推文。目的是通过 Twitter 平台分享这些模型生成的有趣文本。”</em></p><p id="3b43" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated"><strong class="lo iu">你的应用会使用推文、转发、赞、关注或直接消息功能吗？</strong></p><p id="6e71" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">该应用程序将使用 tweepy Python 库每天更新机器人的 twitter 状态。Python 脚本将从我电脑上的 cron 作业中运行，并将只使用 Tweet 功能。”</p><p id="449c" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">你需要等待他们批准你的申请。在这一点上，我们很高兴填写另一个表格描述我们的应用程序！通过单击您的姓名，然后单击应用程序下拉字段，导航至应用程序页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nu"><img src="../Images/f5661d2ceed982ff2dc4c5557af47eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KsOuDQ3pAQwiuxu9D1IYuQ.png"/></div></div></figure><p id="a51a" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">单击创建应用程序</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nv"><img src="../Images/fc182b1e411d4af98fe6f3fa5b192432.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ndp_N1znXKhY_tn285H2lA.png"/></div></div></figure><p id="28be" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">填写另一张表格…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nu"><img src="../Images/f056ccbbef624d7025563b9b1293ea7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5pLZJpEkMRpJtS_1j4nMPw.png"/></div></div></figure><p id="a3e1" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">一旦所有这些都填好并提交，你就可以开始了。您将在应用页面中看到您的新应用。当你点击细节，你可以得到你的 API 密匙。您只能查看您的访问令牌一次，因此请务必记下它们。我把我的保存在一个 JSON 文件中。这使得我可以很容易地以编程方式访问这些令牌。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="f559" class="nh kv it nd b gy ni nj l nk nl">{"consumer_key": aaaa<br/>"consumer_secret": "bbbb"<br/>"access_key": "cccc"<br/>"access_secret": "dddd"}</span></pre><p id="1a7d" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">就是这样！我们终于准备好写一些代码了！</p><h1 id="01dc" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">获取一些数据</h1><p id="c56a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我要让我的推特机器人写一些有趣的谚语。你可以在这里找到我用来训练我的模型<a class="ae nb" href="https://github.com/nbertagnolli/DeepProverbs/tree/master/Data" rel="noopener ugc nofollow" target="_blank">的数据。对于你的，看看你是否能找到一个数据集，其中的主要思想是简短的，并且有相当多的数据。一些想法可能是</a><a class="ae nb" href="https://twitter.com/kanyewest_bot" rel="noopener ugc nofollow" target="_blank">坎耶·韦斯特的推文</a>，现任<a class="ae nb" href="https://twitter.com/deepdrumpf?lang=en" rel="noopener ugc nofollow" target="_blank">和前任</a>总统的推文，甚至是<a class="ae nb" href="https://twitter.com/roborosewater?lang=en" rel="noopener ugc nofollow" target="_blank">魔法卡片</a>。</p><p id="469c" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">我们将使用的 GPT2 简单模型作用于一个文本文件，所以我们需要做的就是将我们感兴趣的任何文本源编译成一个文本文件。我在培训 GPT2 时喜欢做的一件事是在不同的部分之间添加分隔符，这些分隔符不会出现在文本中。例如，您可以将《箴言》中的所有内容放入一个文件中，或者您可以用“\n==========\n”分隔每个谚语。然后，模型可以了解谚语的开始和结束位置，您可以更容易地解析输出。我已经按照我喜欢的方式设置了谚语文本的格式，其中有一个“\ n = = = = = = = = = = \ n”来分隔每个谚语的结尾，所有多余的字符都已被删除。</p><h1 id="c328" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">建造大脑</h1><p id="889f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">创建世界级的文本生成模型从未如此简单。当我制作第一个生成模型时，我必须编写大量代码来构建模型、训练模型、从模型中提取合理的预测等等。现在，我们可以在 GPT2 上进行一点迁移学习，并获得比几年前想象的更好的结果。</p><p id="f005" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">Max Woolf 创建了一个<a class="ae nb" href="https://github.com/minimaxir/gpt-2-simple" rel="noopener ugc nofollow" target="_blank">惊人的库</a>，使得微调<a class="ae nb" href="https://openai.com/blog/better-language-models/" rel="noopener ugc nofollow" target="_blank"> GPT2 </a>变得超级容易。我们将采用他所有的优秀成果，并使用该界面进行培训。以下 30 行代码是微调同类最佳生成模型所需的全部内容。gpt2_simple <strong class="lo iu"> finetune </strong>函数接受几个值得解释的参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">微调 GPT2 模型的代码</p></figure><ul class=""><li id="a6b7" class="mi mj it lo b lp mk ls ml lv mm lz mn md mo mh ny mq mr ms bi translated"><strong class="lo iu">会话</strong>该会话只是当前的 Tensorflow 会话</li><li id="4197" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh ny mq mr ms bi translated"><strong class="lo iu">数据集</strong>这是加载并用于训练的文本文件的路径，稍后将详细介绍。</li><li id="ca45" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh ny mq mr ms bi translated"><strong class="lo iu">型号名称</strong>要使用的 GPT2 型号名称可以是 117M、124M 或 355M。124M 在我的 1080Ti GPU 上很好用。</li><li id="10f4" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh ny mq mr ms bi translated"><strong class="lo iu">步数</strong>模型要走的步数。这个数字应该足够大，至少可以遍历整个数据集一次，但也不能大到让你无法适应。当在相对较小的数据集上微调 GPT2 时，我喜欢做一到两个时期。然后我进行测试，以确保它生成的内容不是直接来自训练集。</li></ul><p id="bf32" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">我们可以通过使用<code class="fe nz oa ob nd b">wc</code>实用程序查看文本中的总字数来计算步骤数:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="2053" class="nh kv it nd b gy ni nj l nk nl">wc Data/proverbs_clean.txt</span></pre><p id="de0c" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">生产</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="5266" class="nh kv it nd b gy ni nj l nk nl">1816   15984   93056 Data/proverbs_clean.txt</span></pre><p id="75e4" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">我们可以看到这个文件有 1，816 行，15，984 个单词和 93，056 个字符。步骤中传递给模型的默认字数由<strong class="lo iu"> sample_length </strong>参数设置，默认为 1023。所以 15984 / 1023 = 15.6。所以每 16 步我们都要检查一次所有的数据。这意味着我们应该训练我们的模型走 33 到 66 步。以避免过度拟合。</p><p id="94a1" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">要生成给定模型的新文本，我们可以使用 gpt2_simple.generate 函数，如下所示:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="2f52" class="nh kv it nd b gy ni nj l nk nl">sess = gpt2.start_tf_sess()<br/>gpt2.load_gpt2(sess, checkpoint_dir=checkpoint_dir)<br/>text = gpt2.generate(<br/>    sess,<br/>    checkpoint_dir=checkpoint_dir,<br/>    length=length,<br/>    temperature=temperature,<br/>    destination_path=destination_path,<br/>    prefix=prefix,<br/>    return_as_list=True<br/>)</span></pre><p id="0248" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">让我们再次分解这些论点。</p><ul class=""><li id="ec88" class="mi mj it lo b lp mk ls ml lv mm lz mn md mo mh ny mq mr ms bi translated"><strong class="lo iu"> sess </strong>是我们想要使用的 tensorflow 会话</li><li id="00db" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh ny mq mr ms bi translated"><strong class="lo iu"> checkpoint_dir </strong>是从我们的微调到保存的检查点的路径</li><li id="62ed" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh ny mq mr ms bi translated"><strong class="lo iu">温度</strong>是大于 0 的值，我喜欢在 0.8 到 2 之间玩。温度越低，你的输出就越稳定和可预测；温度越高，它们就越狂野、有趣，甚至可能是荒谬的。</li><li id="d7ec" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh ny mq mr ms bi translated"><strong class="lo iu"> destination_path </strong>是保存文本的路径。如果你只是想内联返回它，让这个<strong class="lo iu"> None </strong></li><li id="ba49" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh ny mq mr ms bi translated"><strong class="lo iu">前缀</strong>是个好玩的。它可以是用于播种模型的文本字符串。因此，如果你以“你不应该”开始，那么模型将写下接下来的单词，就好像它以“你不应该”开始一样。</li><li id="0d8a" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh ny mq mr ms bi translated"><strong class="lo iu"> return_as_list </strong>将使函数返回文本，而不只是打印出来。</li></ul><p id="d5fe" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">运行这段代码，我们可以生成一些谚语！</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="9ef9" class="nh kv it nd b gy ni nj l nk nl">for he that taketh away his beret also with food, and as a disorderly child, so hath a man a very strange prayer<br/>==========<br/>for though it seem good to us to be taken, yet a man that hath it in his heart never cometh out of it<br/>==========<br/>he that hath his substance with him seeketh out knowledge and hath neither toy with his heart<br/>==========<br/>for a stranger cometh when i talk with him, and delivereth him, so that i may give to him even as the blood I drink, and a spare change my food</span></pre><h1 id="50ae" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">建造机器人</h1><p id="3b8e" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们有数据，一个根据我们的数据训练的模型，和一个 Twitter 开发者账户，剩下的就是把它们连接起来。我们的机器人需要做三件事。</p><ol class=""><li id="67e7" class="mi mj it lo b lp mk ls ml lv mm lz mn md mo mh mp mq mr ms bi translated">使用 Twitter API 进行身份验证</li><li id="0db5" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh mp mq mr ms bi translated">产生一句谚语</li><li id="9cfe" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh mp mq mr ms bi translated">把这句谚语发到推特上。</li></ol><p id="039a" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">幸运的是 Tweepy 让第一和第三部分变得非常简单，我们已经完成了第二部分！</p><h2 id="e2ab" class="nh kv it bd kw oc od dn la oe of dp le lv og oh lg lz oi oj li md ok ol lk om bi translated">证明</h2><p id="62d8" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">首先，我们需要将我们的凭证放入 Python。正如我前面提到的，我把我的保存在一个小的 JSON 文件中，所以用 Python 加载它非常容易。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="b1b8" class="nh kv it nd b gy ni nj l nk nl"># Parse the credentials for the twitter bot<br/>with open("twitter.json", "r") as json_file:<br/>    twitter_creds = json.load(json_file)<br/><br/># Set the credentials based on the credentials file<br/>CONSUMER_KEY = twitter_creds['consumer_key']<br/>CONSUMER_SECRET = twitter_creds['consumer_secret']<br/>ACCESS_KEY = twitter_creds['access_key']<br/>ACCESS_SECRET = twitter_creds['access_secret']</span></pre><p id="83e3" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">有了所有这些凭证，我们可以使用 Tweepy 通过 Twitter API 进行身份验证。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="056c" class="nh kv it nd b gy ni nj l nk nl"># Authenticate with the Twitter API<br/>auth = tweepy.OAuthHandler(CONSUMER_KEY, CONSUMER_SECRET)<br/>auth.set_access_token(ACCESS_KEY, ACCESS_SECRET)<br/>api = tweepy.API(auth)</span></pre><h2 id="e7a7" class="nh kv it bd kw oc od dn la oe of dp le lv og oh lg lz oi oj li md ok ol lk om bi translated">文本生成</h2><p id="172e" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在，我们可以使用之前编写的代码生成新的文本。我将所有这些打包成一个名为<strong class="lo iu"> generate_text </strong>的小函数。生成文本后，我们要确保不要抓取任何超过 280 个字符的文本，因为这是 Twitter 的 tweet 限制。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="28c9" class="nh kv it nd b gy ni nj l nk nl"># Generate some text<br/>generated_text = generate_text(checkpoint_dir, length, temperature, None, prefix)<br/><br/># Parse out all "sentences" by splitting on "\n———————\n"<br/>split_text = generated_text.split("\n———————\n")<br/><br/># Filter out all examples which are longer than 140 characters<br/>valid_text = [x for x in split_text if len(x) &lt;= 140]</span></pre><h2 id="62b3" class="nh kv it bd kw oc od dn la oe of dp le lv og oh lg lz oi oj li md ok ol lk om bi translated">推特！</h2><p id="a611" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">微博现在只有两行了！随机选择一个谚语，然后使用 Tweepy 更新机器人状态！</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="fe15" class="nh kv it nd b gy ni nj l nk nl">tweet = np.random.choice(valid_text, 1)<br/>api.update_status(tweet[0])</span></pre><p id="4841" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">就在那里！</p><h1 id="1342" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">包扎</h1><p id="df45" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们有代码来生成圣经谚语风格的推文，也有技术来处理任何文本语料库！我通常只是在我的服务器上安排一个 cron 作业，每天运行一到两次。我已经在<a class="ae nb" href="https://github.com/nbertagnolli/DeepProverbs" rel="noopener ugc nofollow" target="_blank">库</a>中包含了一个 Makefile，使得用一个命令就能让机器人发布 tweet 变得容易。只需运行:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="8eaf" class="nh kv it nd b gy ni nj l nk nl">make CHECKPOINT_DIR="deepproverbs" TWITTER_CREDS="twitter.json" tweet</span></pre><p id="bd3e" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">我把我们今天写的所有代码都打包成了一些漂亮的点击函数，所以应该很容易从命令行运行。</p></div></div>    
</body>
</html>