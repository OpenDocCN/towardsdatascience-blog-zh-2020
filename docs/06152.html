<html>
<head>
<title>Counting people on your webcam using GluonCV and MxNet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GluonCV和MxNet计算网络摄像头上的人数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/counting-people-on-your-webcam-using-gluoncv-and-mxnet-d1a9f05c427d?source=collection_archive---------56-----------------------#2020-05-18">https://towardsdatascience.com/counting-people-on-your-webcam-using-gluoncv-and-mxnet-d1a9f05c427d?source=collection_archive---------56-----------------------#2020-05-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="21dd" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" rel="noopener" target="_blank" href="https://towardsdatascience.com/data-science-in-the-real-world/home?gi=ea0e55878a54">现实世界中的数据科学</a></h2><div class=""/><div class=""><h2 id="c317" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">基于YOLOv3目标检测模型</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/a25d8c3cada6e349c183dca593709bd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oip10T3V6wlbKKyg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@stephanebernardphotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯蒂芬·伯纳德</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="5891" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated"><strong class="ak">简介</strong></h2><p id="9303" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">在图像中计数是计算机视觉最常见的任务之一，有许多用例。在本教程中，我们使用了GluonCV工具包来支持我们这样做。GluonCV在计算机视觉任务中提供了深度学习模型的前沿实现。它由用于图像分类、对象检测、语义分割、实例分割、姿态估计、对象跟踪和动作识别的最先进的预训练模型组成。你可以在格鲁恩科夫模型动物园看看其他模型。</p><pre class="ks kt ku kv gt mw mx my mz aw na bi"><span id="579a" class="li lj it mx b gy nb nc l nd ne"><a class="ae lh" href="https://gluon-cv.mxnet.io/model_zoo/index.html" rel="noopener ugc nofollow" target="_blank">https://gluon-cv.mxnet.io/model_zoo/index.html</a></span></pre><p id="41df" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">通常，在对象检测任务中，我们有要检测的类、每个类的置信度得分以及图像中检测到的对象的边界框。</p><h2 id="bb15" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated"><strong class="ak">检测</strong></h2><p id="b339" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">例如，考虑包含狗、自行车和类似卡车的汽车作为突出对象的给定图像。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nk"><img src="../Images/fac8fd38847862595d0fcdaa57712253.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nf0WWc_58nL7y67Xt6iDZA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">我的colab笔记本截图</p></figure><p id="68be" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">当我们对图像应用对象检测模型时，我们的网络检查图像中的对象，将它们与地面真实标签进行比较，并返回置信度得分。边界框坐标是元组的形式，包括边界框的左上坐标、框的高度和宽度。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nl"><img src="../Images/4f1c2721cadf0eac383dcd42e58da3d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_qteoVK113HDMYVMfrDv1A.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">我的colab笔记本截图</p></figure><p id="fb64" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">为了检测图像中的人，我们在COCO(上下文中的公共对象)类的集合中检查person类。COCO <a class="ae lh" href="http://mscoco.org/" rel="noopener ugc nofollow" target="_blank">数据集</a>是一个奇妙的对象检测数据集，有80个类、80，000幅训练图像和40，000幅验证图像。我们的模型“yolo3_darknet53_coco”在该数据集上进行了预训练。</p><p id="9320" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">为了流式传输我们的网络摄像头数据，我们使用开源计算机视觉库OpenCV</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/4f3ea8cbb731de56ff7f0dc89b399a0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*4gKsiOYn9VRnefXNvBVD3Q.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">OpenCV是一个用于计算机视觉任务的开源机器学习库，来源:“OpenCV”，via: wikipedia</p></figure><h2 id="3340" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated"><strong class="ak">先决条件</strong></h2><p id="dfee" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">在安装以下软件之前，在Anaconnda中创建一个虚拟环境(首选)</p><ol class=""><li id="77a4" class="nn no it mf b mg nf mj ng lr np lv nq lz nr mv ns nt nu nv bi translated">OpenCV</li></ol><p id="0044" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">要在您的系统中安装OpenCV，请在您的终端或命令提示符中键入<strong class="mf jd">pip install OpenCV-python</strong>。我已经在Anaconda中使用了Spyder来完成这个任务，所以我已经在conda虚拟环境中安装了依赖项。</p><pre class="ks kt ku kv gt mw mx my mz aw na bi"><span id="73fa" class="li lj it mx b gy nb nc l nd ne">pip install opencv-python</span></pre><p id="7778" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">2.MXNet和胶子</p><p id="4d76" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">要安装mxnet和gluon，请在您的终端或提示符中键入<strong class="mf jd">pip install mxnet-Cu 101 gluonvv</strong>。我在我的虚拟环境中也做了同样的事情。如果您的虚拟环境中没有CUDA，您可以安装不基于CUDA的mxnet</p><pre class="ks kt ku kv gt mw mx my mz aw na bi"><span id="01b8" class="li lj it mx b gy nb nc l nd ne">pip install mxnet-cu101 </span><span id="404b" class="li lj it mx b gy nw nc l nd ne">pip install gluoncv</span></pre><h2 id="de66" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">开源代码库</h2><p id="fa1b" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">如果您熟悉GitHub，请查看下面的资源库。</p><div class="nx ny gp gr nz oa"><a href="https://github.com/sid0312/people_counter" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jd gy z fp of fr fs og fu fw jc bi translated">sid 0312/人_计数器</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">这个库是作为我的中型博客git克隆https://github.com/sid0312/people_counter…的源代码维护的</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo lb oa"/></div></div></a></div><p id="6829" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">让我们看看我给定的对象检测任务的源代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><ul class=""><li id="7f32" class="nn no it mf b mg nf mj ng lr np lv nq lz nr mv or nt nu nv bi translated"><strong class="mf jd">导入我们的依赖关系</strong></li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><ul class=""><li id="ebbb" class="nn no it mf b mg nf mj ng lr np lv nq lz nr mv or nt nu nv bi translated"><strong class="mf jd">定义要使用的型号</strong></li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><ul class=""><li id="44ae" class="nn no it mf b mg nf mj ng lr np lv nq lz nr mv or nt nu nv bi translated"><strong class="mf jd">添加实用功能</strong></li></ul><p id="56db" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">a)将我们的帧从一个NumPy ndarray转换成一个mxnet ndarray</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="0b29" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">b)将变换应用于mxnet阵列，以将其提供给网络</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="97ca" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">c)通过将网络应用于数据来获得class _ ids、置信度得分和边界框</p><pre class="ks kt ku kv gt mw mx my mz aw na bi"><span id="26d7" class="li lj it mx b gy nb nc l nd ne">def detect(network,data):<br/>  prediction = network(data)<br/>  class_ids, scores, bounding_boxes = prediction<br/>  return class_ids, scores, bounding_boxes</span></pre><p id="6717" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">count _ object函数，其对给定对象标签中超过给定阈值的对象数量进行计数</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><ul class=""><li id="7e56" class="nn no it mf b mg nf mj ng lr np lv nq lz nr mv or nt nu nv bi translated"><strong class="mf jd">创建一个People_Counter类，依次使用所有的效用函数和返回预测，以及People，在单独的函数中计数</strong></li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="e9ff" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">__init__方法从GluonCV model zoo中导入预训练为‘true’的网络，因为我们使用的是预训练模型。使用hybridize()加快网络速度。</p><p id="66e2" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">set_threshold方法设置对象置信度得分的阈值。置信度低于阈值的检测将不予考虑。</p><p id="907b" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">count_people方法在实用函数的帮助下计算一帧中的人数</p><p id="8396" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">detect_people方法返回对帧的检测。</p><p id="d562" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">class_names返回COCO数据集中的所有80个类，这些类也是网络的类，因为它是在该数据集中预先训练的。</p><ul class=""><li id="3ee8" class="nn no it mf b mg nf mj ng lr np lv nq lz nr mv or nt nu nv bi translated"><strong class="mf jd">为People_Counter类创建一个对象，并将阈值设置为0.5。置信度低于0.5的检测将被考虑。</strong></li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><ul class=""><li id="721d" class="nn no it mf b mg nf mj ng lr np lv nq lz nr mv or nt nu nv bi translated"><strong class="mf jd">加载网络摄像头处理程序，让网络摄像头自动对焦一秒钟</strong></li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><ul class=""><li id="148e" class="nn no it mf b mg nf mj ng lr np lv nq lz nr mv or nt nu nv bi translated"><strong class="mf jd">使用gluoncv.utils.viz库</strong>设置循环，对每一帧进行检测和计数，并在窗口中显示结果</li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="1ca3" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">video.read()返回两个值，第一个被丢弃，第二个成为我们的帧。</p><p id="0471" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">使用计数器对象的count()和detect_people()</p><p id="668c" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">获得预测，并在每一帧上绘制边界框。将计数文本放在框架上。使用cv2.imshow()显示帧</p><p id="266d" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated">如果在窗口上下文中按下“q”键，则退出循环。</p><ul class=""><li id="aeec" class="nn no it mf b mg nf mj ng lr np lv nq lz nr mv or nt nu nv bi translated"><strong class="mf jd">释放网络摄像头，销毁所有窗口</strong></li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="5565" class="pw-post-body-paragraph md me it mf b mg nf kd mi mj ng kg ml lr nh mn mo lv ni mq mr lz nj mt mu mv im bi translated"><strong class="mf jd">结果</strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi os"><img src="../Images/07047e2896bb26e8d6a5b4fb2b5049c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*N27BYe-fRMW4MhccmUVvQw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">检测的单个帧</p></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/dc0e5a8e06ac14e33d7ad0d3ac3474b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*TXKJCGJUqEV-yaiLWJQ1EA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在我按下“q”之前的特定时间内的一些日志</p></figure><blockquote class="ou ov ow"><p id="8a60" class="md me ox mf b mg nf kd mi mj ng kg ml oy nh mn mo oz ni mq mr pa nj mt mu mv im bi translated">非常感谢您的耐心。快乐的计算机视觉和快乐的深度学习。T3】</p></blockquote></div></div>    
</body>
</html>