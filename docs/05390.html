<html>
<head>
<title>Creating a map of house sales</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建房屋销售地图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-a-map-of-house-sales-42ba1f2c4e7e?source=collection_archive---------45-----------------------#2020-05-06">https://towardsdatascience.com/creating-a-map-of-house-sales-42ba1f2c4e7e?source=collection_archive---------45-----------------------#2020-05-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bad4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我将指导你一步一步地创建一个使用散景显示房屋销售的地图，并用彩色地图显示销售价格。我想让观众一眼就能分辨出哪个街区的生活成本最高。这也是价格预测建模目的的一个有用的可视化，以了解位置有多重要，以及与位置相关的新功能是否对工程师有用。</p><p id="0dc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用国王郡地区销售价格的数据集，该数据集可以在<a class="ae kl" href="https://www.kaggle.com/harlfoxem/housesalesprediction" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上找到，但是这些原则也可以应用于您选择的数据集。</p><p id="944a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是最终结果:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/ca47abae3614cf10d4ac4f706fda06dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgEeZsloatb5E3CSBLAykg.png"/></div></div></figure><p id="4945" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们确保我们的数据集符合目的。请注意，散景需要墨卡托坐标来绘制地图上的数据点。我们的数据集有纬度和经度坐标，所以需要一个函数来转换这些坐标。假设所有数据清理步骤(例如，缺失值)都已完成，数据应该是这样的。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="6322" class="ld le iq kz b gy lf lg l lh li">df.head() </span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lj"><img src="../Images/77c8f82098172df28aa3c0741d92fc2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sp0BmdFeDQSWJoitmS4x3Q.png"/></div></div><p class="lk ll gj gh gi lm ln bd b be z dk translated">包含邮政编码、墨卡托x、墨卡托y和价格列的熊猫数据框架</p></figure><p id="e189" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是时候策划了！</p><p id="3028" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将分解代码并解释每个元素的作用。</p><p id="1a30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从从Bokeh进口必要的工具开始。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="ffa2" class="ld le iq kz b gy lf lg l lh li">from bokeh.io import output_notebook, show<br/>from bokeh.plotting import figure, ColumnDataSource<br/>from bokeh.tile_providers import get_provider, CARTODBPOSITRON<br/>from bokeh.palettes import Turbo256<br/>from bokeh.transform import linear_cmap<br/>from bokeh.layouts import row, column<br/>from bokeh.models import ColorBar, NumeralTickFormatter</span></pre><p id="eba8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">散景的突出特点之一是内置的地图拼贴集合。虽然你可以使用谷歌地图，但这需要获得一个API密钥。我们将使用Carto DB。让我们用<code class="fe lo lp lq kz b">get_provider()</code>功能选择这个图块。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="c388" class="ld le iq kz b gy lf lg l lh li">chosentile = get_provider(CARTODBPOSITRON)</span></pre><p id="dcd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们将选择一个调色板的颜色映射。我们希望确保我们的可视化能够有效地辨别出最昂贵的房子在哪里。Bokeh拥有丰富的预定义调色板选项，根据您希望的粒度，您可以从调色板中选择使用多少种颜色。还有一些具有更大频谱的扩展调色板，这就是我们在这里要做的。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="769f" class="ld le iq kz b gy lf lg l lh li">palette = Turbo256</span></pre><p id="0725" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还将定义要使用的数据源，即数据的来源。最常见的类型是<code class="fe lo lp lq kz b">ColumnDataSource</code>，它接受一个数据参数。一旦创建了<code class="fe lo lp lq kz b">ColumnDataSource</code>,就可以将它传递给绘图方法的<code class="fe lo lp lq kz b">source</code>参数，让我们传递一个列的名称作为数据值的替代。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="467f" class="ld le iq kz b gy lf lg l lh li">source = ColumnDataSource(data=df)</span></pre><p id="4801" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，让我们定义我们的颜色映射器。这是一个线性彩色地图，应用于价格领域。我们将低和高参数分别设置为最低和最高价格。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="fe75" class="ld le iq kz b gy lf lg l lh li">color_mapper = linear_cmap(field_name = ‘price’, palette = palette, low = df[‘price’].min(),high = df[‘price’].max())</span></pre><p id="7e3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个简洁的功能是当用户将鼠标悬停在数据点上时包含附加信息。这是使用工具提示定义的。我们选择显示房子的价格和邮政编码。@符号表示该值来自源。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="6625" class="ld le iq kz b gy lf lg l lh li">tooltips = [(“Price”,”@price”), (“Zipcode”,”@zipcode”)]</span></pre><p id="36a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们准备创建实际的图形。姑且称之为<code class="fe lo lp lq kz b">p</code>。我们将给它一个标题，并将x和y轴类型设置为墨卡托，以便在渲染时显示我们更习惯的纬度和经度刻度。为了完整起见，我们还将定义我们的轴标签。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="fa74" class="ld le iq kz b gy lf lg l lh li">p = figure(title = ‘King County House Sales 2014–2015’,<br/>x_axis_type=”mercator”, y_axis_type=”mercator”, <br/>x_axis_label = ‘Longitude’, y_axis_label = ‘Latitude’, tooltips = tooltips)</span></pre><p id="b7a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们使用<code class="fe lo lp lq kz b">add_tile()</code>函数添加我们选择的地图标题。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="7ab1" class="ld le iq kz b gy lf lg l lh li">p.add_tile(chosentile)</span></pre><p id="9127" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过将x和y指定为墨卡托坐标<code class="fe lo lp lq kz b">x_merc</code>和<code class="fe lo lp lq kz b">y_merc</code>，每栋房屋将被绘制成一个圆。圆圈的颜色将由我们上面定义的线性颜色图决定。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="09f2" class="ld le iq kz b gy lf lg l lh li">p.circle(x = ‘mercator_x’, y = ‘mercator_y’, color = color_mapper, source=source)</span></pre><p id="d83b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们添加一个颜色条，它将有助于理解我们的颜色映射。默认情况下，散景在适当的地方使用科学符号，但在这种情况下，我认为对价格使用普通符号看起来更好。默认导致价格标签与颜色条重叠，所以我们需要给<code class="fe lo lp lq kz b">label_standoff</code>添加一个值。不幸的是，没有直接的方法来添加一个标题到颜色栏，所以现在，我们凑合着没有。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="17a0" class="ld le iq kz b gy lf lg l lh li">color_bar = ColorBar(color_mapper=color_mapper[‘transform’],                     formatter = NumeralTickFormatter(format=”0,0"),<br/>label_standoff = 13, width=8, location=(0,0))</span></pre><p id="d8cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们通过创建一个布局来指定颜色条应该在图的右边。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="add1" class="ld le iq kz b gy lf lg l lh li">p.add_layout(color_bar, ‘right’)</span></pre><p id="1c5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们希望地图显示在笔记本和展示。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="0beb" class="ld le iq kz b gy lf lg l lh li">output_notebook()<br/>show(p)</span></pre><p id="9853" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哒哒！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/ca47abae3614cf10d4ac4f706fda06dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgEeZsloatb5E3CSBLAykg.png"/></div></div><p class="lk ll gj gh gi lm ln bd b be z dk translated">带有房屋销售标记的金县地图</p></figure><p id="dfa6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从这个图像中，很明显最昂贵的房子位于海滨，尤其是在麦地那、克莱德希尔和默瑟岛。南北之间也有明显的差异，北方要求更高的价格。</p><p id="aa74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还可以放大以深入了解特定的街区。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/539f42fb7acbe74a0b743dc94deac439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*sDHuCFr0rHUMU7Cr-egwEA.png"/></div><p class="lk ll gj gh gi lm ln bd b be z dk translated">克莱德希尔街区房屋销售</p></figure><p id="f829" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你知道了！我希望这个简短的教程对你有用。如果你想进一步调整，我建议你深入Bokeh的<a class="ae kl" href="https://docs.bokeh.org/en/latest/docs/user_guide.html#userguide" rel="noopener ugc nofollow" target="_blank">文档</a>。即使你像我一样是初学者，也很容易理解。我也希望你能给我任何反馈。</p><p id="8ee3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要查看我的项目，包括使用线性回归的数据探索和预测建模，<a class="ae kl" href="https://github.com/nadinezab/kc-house-prices-prediction" rel="noopener ugc nofollow" target="_blank">这里的</a>是GitHub链接。</p></div></div>    
</body>
</html>