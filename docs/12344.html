<html>
<head>
<title>This Virtual Machine is Saving my Time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这个虚拟机节省了我的时间</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/this-virtual-machine-is-saving-my-time-23076f592b94?source=collection_archive---------32-----------------------#2020-08-25">https://towardsdatascience.com/this-virtual-machine-is-saving-my-time-23076f592b94?source=collection_archive---------32-----------------------#2020-08-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e6c9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 Google 云平台之上的 Linux 虚拟机中部署您的 Python 脚本，以便与您的投资保持联系</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5a12f7cde0cdf11986cce1e26bcf37ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jwRWm9HKJaCy7ANC"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@altumcode?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> AltumCode </a>拍摄的照片</p></figure><p id="afc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本地运行 Python 脚本时，您有没有遇到过困难？很一般吧？下面让我列举一些苦苦挣扎的例子:</p><ul class=""><li id="01fd" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">局部存储器</li><li id="8a4b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">网络可用性</li><li id="d315" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">电脑始终开启</li></ul><p id="bb56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我一直在从事一个需要频繁执行的<strong class="lb iu"> Python 项目</strong>，上面的例子是鼓励我寻找如何摆脱本地处理的主要例子。</p><p id="dd77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是为什么呢？因为我并不总是登录我的计算机，即使如此，我也不想每 15 分钟(或任何其他频率)执行一次我的 Python 脚本。</p><p id="d35c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个场景让我定义了以下项目结构:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/398b9b57f2992b5a2343b9115011fb0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLJVJVcHgx52B6QG7BWosA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">项目设计—作者</p></figure><p id="585b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了做到这一点，我邀请您查看以下课程，在这些课程中，我介绍了有关每个项目要素的步骤和主要信息:</p><ul class=""><li id="b00b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">谷歌表单(1)和 API (2)</li><li id="3036" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">谷歌云平台(3)和 Linux 虚拟机(4)</li></ul><p id="df23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mk"> PS:我将不同的元素分组如上，因为我认为这样更容易跟踪流程。第一组向您展示我们的目标是什么，并预测我们的 API 支持。后一组涵盖了 Google 平台上所需的操作，然后是 Linux VM 本身(包括 Python 脚本)。</em></p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="0c95" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">1.谷歌工作表</h1><p id="b813" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">就像刚才说的，我们来看看这个 Python 项目是什么。目标是每 15 分钟更新一次所拥有股票的当前价格(来自巴西市场)。</p><p id="c76b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如会议的标题所示，最初的数据可以在 Google Sheets 上找到。下面，您可以看到该项目中考虑的数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/2e28d4de52f547c70b4da69255494ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6XvM1D_WdrlZHLhlmV_8dg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Google Sheets 的原始数据</p></figure><p id="7920" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们检查每一列:</p><ul class=""><li id="7e4b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">股票:公司的交易代码(截至 8 月 25 日，它被认为是 IBOV 中涉及最多的谈判股票)</li><li id="9741" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">数量:拥有的数量</li><li id="07bb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">账面价格:资产在购买时的价格(被认为是 7 月 31 日收盘时的股票价格)</li><li id="c4f9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">价格:当前价格(每次执行应用程序时)</li><li id="f885" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">单位损益:“账面价格”-“价格”</li><li id="e5f9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">总损益:“单位损益“*”数量”</li><li id="83cc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">总损益(%):"损益"/("账面价格" * "数量")</li></ul><p id="4377" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能会问自己 Python 在这里会做什么。答案是:更新“价格”一栏。通过这样做，从属列将相应地更新。</p><p id="3c9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他字段是:</p><ul class=""><li id="7cac" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">上次更新:Python 将在每次运行时更新这个单元。这有助于我们检查 Python 是否正在“触及”Google Sheets</li><li id="7211" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">IBOV:这是巴西最重要的金融市场指数。被用作 Python 脚本的参考(将在后面进一步解释)；</li><li id="f998" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">总计:汇总总结果。</li></ul><p id="558b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mk">直到这里，本地存储的挣扎点才得以解决。</em></p><h1 id="fd64" class="ms mt it bd mu mv nq mx my mz nr nb nc jz ns ka ne kc nt kd ng kf nu kg ni nj bi translated">2.应用程序接口</h1><p id="c6e2" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">正如在上一节课中简要提到的，Python 需要“触及”Google Sheets。这是通过启用一些 Google APIs 来实现的，以便授权和认证 Python 应用程序在 Google Sheets 上“访问、读取和写入数据”。</p><p id="fac6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的文章中，我介绍了启用上述 API 的一步一步。我邀请你检查那里的详细步骤。</p><div class="nv nw gp gr nx ny"><a href="https://medium.com/better-programming/how-to-enable-pythons-access-to-google-sheets-e4264cdb545b" rel="noopener follow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">如何让 Python 访问 Google Sheets</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">继续使用 Python 管理在线电子表格内容</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">medium.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om ks ny"/></div></div></a></div><p id="d705" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经完成了第一部分，这使您能够了解将要管理的数据。</p><p id="8dbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们看看部署应用程序本身所需的操作。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="80da" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">3.谷歌云平台</h1><p id="380f" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated"><a class="ae ky" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>被用作这个项目的云基础设施服务。像其他云服务一样，谷歌的平台为你提供<strong class="lb iu">计算资源</strong>即服务。</p><p id="f1d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使用这些计算资源，您需要:</p><p id="489c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.1.在谷歌云平台上创建一个项目；</p><p id="9298" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.2.实例化虚拟机。</p><p id="e51d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们逐一检查一下。</p><h2 id="5c54" class="on mt it bd mu oo op dn my oq or dp nc li os ot ne lm ou ov ng lq ow ox ni oy bi translated">3.1.在谷歌云平台上创建一个项目</h2><p id="72f8" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">您可以通过一个步骤创建项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/4fef6341d682abb0a649ae36f46c2ead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*H_qAeeEAJYX1K7bTdYpJ8A.png"/></div></figure><h2 id="9faf" class="on mt it bd mu oo op dn my oq or dp nc li os ot ne lm ou ov ng lq ow ox ni oy bi translated">3.2.实例化虚拟机</h2><p id="8289" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">单击左侧栏菜单中的“计算引擎”&gt;“虚拟机实例”。然后，单击“创建实例”并选择一些可用的参数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/a778292e438178d40ce7d36fb3828ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*rz0pzSJv2lZIUL3TasWEOg.png"/></div></figure><p id="6e98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您从上图中看到的，有一些参数与您的虚拟机资源的物理位置以及您正在考虑的 vCPUs 数量有关。请评估这对于你的情况是否合理。对于这个项目来说，下面这些已经足够了。值得一提的是，谷歌目前正在提供一些积分来使用这项云服务，然而，这是一项收费服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/433d9a2792aadf5970ed35c5795464e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*Q2QEDSAs_LXUYM78kVnSow.png"/></div></figure><p id="5809" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图很重要，因为它定义了这个项目(Debian)正在考虑的一个特定的 Linux 发行版。</p><p id="6948" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">定义这些参数并单击“Create”后，您应该能够在您的虚拟机实例页面上看到以下条目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/52d4218761851a7db41ea8a245938cca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oCNp3OlHkEGFqZfMTEYdgQ.png"/></div></div></figure><p id="b9f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过按启动 SSH 连接，Linux 终端将被打开。</p><h1 id="417f" class="ms mt it bd mu mv nq mx my mz nr nb nc jz ns ka ne kc nt kd ng kf nu kg ni nj bi translated">4.Linux 虚拟机</h1><p id="086c" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">由于 Infra 和 API 都已启用，现在是时候设置您刚刚实例化的 Linux VM 了。</p><p id="4aa6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">主要步骤是:</p><p id="dfbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.1.部署 Python 脚本</p><p id="84aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.2.设置执行周期。</p><p id="ef99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们是如何工作的？</p><h2 id="cde2" class="on mt it bd mu oo op dn my oq or dp nc li os ot ne lm ou ov ng lq ow ox ni oy bi translated">4.1.部署 Python 脚本</h2><p id="ad42" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">重要的事情先来。让我们检查一下您的环境中是否已经安装了任何 Python 版本。</p><p id="b89b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以导航到<code class="fe pd pe pf pg b">/usr/bin</code> <strong class="lb iu"> </strong>并检查是否已经安装了 Python 版本。然而，更简单的方法是只输入<code class="fe pd pe pf pg b">python3</code>并检查环境是否将它识别为一个<em class="mk">系统命令:</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/2c15987a0417beeb81bd2181ac5b6487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0hZpONU-cu8gVeShCdevRw.png"/></div></div></figure><p id="1a9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面可以看出，已经安装了 python3(版本 3.5.3)。然而，pip3，这个用于新软件包安装的命令，还没有被识别。所以，让我们使用<code class="fe pd pe pf pg b">sudo apt install python3-pip</code> <strong class="lb iu">来安装它(确保在安装过程中按下 Y 键)。</strong></p><p id="f5a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过键入<code class="fe pd pe pf pg b">pip3 --version</code>来检查它是否已经安装:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/19a7a99e25c858294d52fdc06cb516c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GneYlBPfzqW4KkuH01ueBA.png"/></div></div></figure><p id="2df1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在一切都好了。</p><p id="2ef9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们导航到要创建的目录。py 文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/725177ab718b1d514ab27f99d49fc93c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*04OG5rJyw0BFsdMPorGgLg.png"/></div></figure><p id="b51a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，我在<code class="fe pd pe pf pg b">/home/lucasnunesfe9</code>上创建了一个名为 pythonScript 的新目录(在这个例子中，“lucasnunesfe9”是云服务用户名。一定要用你的)。</p><p id="53e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">访问这个新目录并创建您的。py 文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/fa8cf3eeab93bad9e63613e1b1f06232.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*cqNJCUv7xbnCShbuTe_2XA.png"/></div></figure><p id="4ac7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">键入<code class="fe pd pe pf pg b">nano myScript.py</code>之后，您应该编写 Python 脚本本身:</p><pre class="kj kk kl km gt pl pg pm pn aw po bi"><span id="4ecc" class="on mt it pg b gy pp pq l pr ps">import gspread<br/>from oauth2client.service_account import ServiceAccountCredentials<br/>from datetime import datetime</span></pre><p id="28a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们从导入所需的库开始:</p><ul class=""><li id="6e4f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe pd pe pf pg b"><a class="ae ky" href="https://gspread.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">gspread</a></code>用于处理 Google Sheets 中的数据；</li><li id="1663" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe pd pe pf pg b"><a class="ae ky" href="https://pypi.org/project/oauth2client/" rel="noopener ugc nofollow" target="_blank">oauth2client</a></code>需要通过 API 进行认证和授权；</li><li id="ae33" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe pd pe pf pg b"><a class="ae ky" href="https://docs.python.org/3/library/datetime.html" rel="noopener ugc nofollow" target="_blank">datetime</a></code>脚本运行时需要打印。</li></ul><pre class="kj kk kl km gt pl pg pm pn aw po bi"><span id="7d87" class="on mt it pg b gy pp pq l pr ps">scope = ['https://www.googleapis.com/auth/drive']</span><span id="92a0" class="on mt it pg b gy pt pq l pr ps">#this variable reads the json file that holds your credentials <br/>credentials = ServiceAccountCredentials.from_json_keyfile_name('<strong class="pg iu">/home/lucasnunesfe9/pythonScript/your_file_name.json</strong>', scope)</span><span id="317c" class="on mt it pg b gy pt pq l pr ps">gc = gspread.authorize(credentials)</span><span id="4744" class="on mt it pg b gy pt pq l pr ps">#spreadsheet file named "example"<br/>sps = gc.open('example')</span><span id="00e3" class="on mt it pg b gy pt pq l pr ps">#first worksheet = 0<br/>wks = sps.get_worksheet(0)</span></pre><p id="86b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上部分足以确保您可以连接到 Google Sheets。请确保给出指向您的的完整路径。json 文件(这个文件还需要创建)。</p><pre class="kj kk kl km gt pl pg pm pn aw po bi"><span id="42b4" class="on mt it pg b gy pp pq l pr ps">#updates current time<br/>dt_string = datetime.now().strftime("%d/%m/%Y %H:%M:%S")<br/>wks.update_cell(2,1,dt_string)</span><span id="9149" class="on mt it pg b gy pt pq l pr ps">#this function will loop through the column reference until it finds "IBOV" cell value<br/>def getLastRow(reference):<br/>    #i = reference cell's position<br/>    i = wks.find(reference).row</span><span id="1e2c" class="on mt it pg b gy pt pq l pr ps">    #loops i trough a static column (reference)<br/>    while wks.cell(i, wks.find(reference).col).value != "IBOV":<br/>        i += 1</span><span id="5e42" class="on mt it pg b gy pt pq l pr ps">    #subtract the last iteration<br/>    return (i - 1)</span><span id="d45b" class="on mt it pg b gy pt pq l pr ps">#this function writes the Google Finance API's formula in each cell of the column "Price"<br/>def currentPrice (reference):</span><span id="84f8" class="on mt it pg b gy pt pq l pr ps">    #loops i from the reference row to the referece value until getLastRow value<br/>    for i in range(wks.find(reference).row+1,getLastRow("Stock")+1):</span><span id="96b9" class="on mt it pg b gy pt pq l pr ps">        #writes current Stock price available from Google Finance API according to colum 1 ("Stock" column)<br/>        #preserve needed Google Finance's syntax<br/>        wks.update_cell(i,wks.find(reference).col,"=GOOGLEFINANCE<br/>("+"\""+wks.cell(i,1).value+"\""+")")</span><span id="4e82" class="on mt it pg b gy pt pq l pr ps">#running both functions<br/>currentPrice("Price")</span></pre><p id="69c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的部分是真正执行我们需要的部分。总之，它更新脚本执行的时间，并遍历所有股票以更新它们的当前价格。为了实现后者，我们使用了 Google Finance API。</p><p id="94ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">写完脚本后，按 Ctrl + Shift，再按 Y，再按 Enter。这将保存您的 myScript.py 文件。</p><p id="4015" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们创建。json 文件，就像刚刚用。py 文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/f3e52c27aca6e0d1aefd26036b196270.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VmUUwT_T95sEG3sOzYv1SA.png"/></div></div></figure><p id="84fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一定要遵循我在本文开头分享的教程。你可以查看更多关于这方面的详细内容。json 文件(很简单)。然后，将内容粘贴到。json 文件，Ctrl + Shift，然后 Y，然后回车。</p><p id="d585" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们设置您将要执行 Python 脚本的重复周期。</p><h2 id="1cb6" class="on mt it bd mu oo op dn my oq or dp nc li os ot ne lm ou ov ng lq ow ox ni oy bi translated">4.2.设置执行周期</h2><p id="9824" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">对于这个任务，我们将使用<a class="ae ky" href="https://manpages.debian.org/jessie/cron/crontab.5.en.html" rel="noopener ugc nofollow" target="_blank"> crontab 作业</a>。</p><p id="41cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，进行一次理智检查。让我们看看是否已经为您的用户使用<code class="fe pd pe pf pg b">crontab -l</code>创建了任何 crontab 作业:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/7b40300280da0052fdbce19d7d1ade9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bxyfvgyxgSXDN-anXTthBw.png"/></div></div></figure><p id="0ad4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">什么都没有…让我们用<code class="fe pd pe pf pg b">crontab -e</code>创建一个新的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/4f3fb8be96e90adfb221bd83510becdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e0inZtiGQ7gVyhvFm9eyVQ.png"/></div></div></figure><p id="6779" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类型<code class="fe pd pe pf pg b">1</code>。将会打开以下窗口。直接跳到最后一行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pw"><img src="../Images/6fe1165358c9044fe5aa71edd4a54e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*Pj1xpH-8bB33QpPwjAG0ZQ.png"/></div></figure><p id="58a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一行是什么意思？</p><p id="951a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如屏幕上给出的解释，每个部分表示一个时间单位:</p><ul class=""><li id="0cee" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe pd pe pf pg b">*/15</code>:每 15 分钟一次</li><li id="cb30" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe pd pe pf pg b">13-20</code>:世界协调时 13 时至 20 时。该范围涵盖巴西金融市场开放期间(巴西的时区为 UTC - 3)</li><li id="bc5b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe pd pe pf pg b">*</code>:一个月中的每一天(dom)</li><li id="dded" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe pd pe pf pg b">*</code>:每月(周一)</li><li id="764a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe pd pe pf pg b">MON-FRI</code>:周一至周五</li></ul><p id="60de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，每 15 分钟的工作日，在 13 和 20 之间，我位于<code class="fe pd pe pf pg b">/home/lucasnunesfe9/pythonScript/myscript.py</code>的脚本将由<code class="fe pd pe pf pg b">python3</code>执行。再说一次，保存文件。</p><p id="246a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">等待，直到您的脚本应该被执行，然后，键入<code class="fe pd pe pf pg b">sudo service cron status | tail -n 1</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi px"><img src="../Images/9e5a2ed03a97360ec7173f32e355b737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lPAoQ1ra1f13TTHLsSwozQ.png"/></div></div></figure><p id="ae56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到 crontab 已经执行(注意，这并不一定意味着 Python 脚本已经正确执行)。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="778b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，Google Sheets 发生了什么？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi py"><img src="../Images/83b9ec83c408d5b00f0a314d69a5f6e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6BT2Pm6WeCFF1GgSUlAZzQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">第一次执行 Python 后的“Google Sheets ”( 15 小时 45 分)</p></figure><p id="9b26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看起来不错…再来一次:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/89b1b16e3ba564816bced6031d5e6108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rx_CWeLeI5ed1hAS4WuVag.png"/></div></div></figure><p id="6c67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/bbea1885a541971f61da1aea5a0689f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FogZ5DU7Y18RnznpcdPPOw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">第二次执行 Python 后的“Google Sheets ”( 16h 00)</p></figure><p id="c4cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">工作正常！</p><p id="efd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mk">现在，剩下的问题，网络可用性和保持电脑始终开机的需要，也都解决了。</em></p></div></div>    
</body>
</html>