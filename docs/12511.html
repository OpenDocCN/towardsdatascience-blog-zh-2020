<html>
<head>
<title>Recipe Guru, a recipe recommendation web app based on NLP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">食谱大师，一个基于自然语言处理的食谱推荐网站</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/recipe-guru-a-recipe-recommendation-web-app-based-on-nlp-a3290d79da2f?source=collection_archive---------35-----------------------#2020-08-28">https://towardsdatascience.com/recipe-guru-a-recipe-recommendation-web-app-based-on-nlp-a3290d79da2f?source=collection_archive---------35-----------------------#2020-08-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="826c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在这篇博文中，我将回顾一下我的食谱推荐网络应用<a class="ae ki" href="https://recipe-guru-rec.herokuapp.com/main" rel="noopener ugc nofollow" target="_blank">“食谱大师”</a>的流程和技术细节，以及一些代码片段。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/00d974664f90adfffaf01be61e2435a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OueutWAv7hZ-nqEP"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated"><a class="ae ki" href="https://unsplash.com/@beccatapert?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">贝卡·泰普特</a>在<a class="ae ki" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a4c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“食谱大师”使用 NLP 技术来推荐人们可能喜欢的相似食谱，目前基于食谱 1M+中的 18000 个食谱。在引擎盖下，这个网络应用程序使用 Recipe 1M+数据和自然语言处理(NLP)模型，根据用户喜欢的食谱推荐食谱。</p><p id="cd4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它使用相似性矩阵来记录基于标题、成分和说明的食谱之间的相似性。单词袋(BoW)、Doc2Vec 和 BERT(来自变压器的双向编码器表示)模型用于估计配方之间的相似度，并提供配方推荐。(这是我的<a class="ae ki" href="https://medium.com/@zxiao2015/understanding-language-using-xlnet-with-autoregressive-pre-training-9c86e5bea443" rel="noopener">中型博客文章</a>，谈论 BERT 和其他最近的 NLP 技术，包括 XLNet。)</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lv"><img src="../Images/64ffca38c012858d7dfe49e0253f39f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-j20Q-E4ZPuxKMW8DJhUQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">“食谱大师”的主页，基于三种 NLP 技术提供不同的厨师推荐选项。</p></figure><h1 id="d6b6" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">关于数据集</h1><p id="5652" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">对于这个项目，我使用了来自麻省理工学院研究人员的<a class="ae ki" href="http://pic2recipe.csail.mit.edu/" rel="noopener ugc nofollow" target="_blank"> Recipe 1M+数据集</a>:一个新的大规模结构化语料库，包含超过 100 万份烹饪食谱和 1300 万张食物图片。数据集可用于 NLP 和 CV 项目。这里，我们将重点放在包含以下信息的文本菜谱(来自 JSON)上:菜谱 URL、标题、id、配料和说明。</p><p id="3111" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">预处理步骤将 1M+食谱中的每一个的标题、配料和指令组合成一个字符串，并且在干净的数据集上应用不同的自然语言处理技术来生成嵌入和余弦相似性矩阵。</p><h1 id="00db" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">余弦相似矩阵</h1><p id="3954" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">由于余弦相似性矩阵的大小很大，我没有使用 sklearn 函数“metrics.pairwise_distances”和 scipy 的“spatial.distance.cosine”来获得成对余弦相似性，而是使用 TensorFlow 和 GPU 来加速余弦相似性矩阵计算，并尝试使用 Spark 分布式计算。</p><h2 id="247f" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated"><strong class="ak"> 1。用张量流得到余弦相似矩阵:</strong></h2><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="5afd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于存储大的余弦相似性矩阵(对于具有 20k 食谱信息的 20k * 20k 矩阵来说需要几个 GB)，有效存储它的一种方式是通过将矩阵转换成稀疏矩阵来保持非零条目的索引。您可以在<a class="ae ki" href="https://docs.scipy.org/doc/scipy/reference/sparse.html#usage-information" rel="noopener ugc nofollow" target="_blank"> SciPy 文档</a>中查看更多关于处理稀疏矩阵的信息。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/f5298a25a17f759bd9b27317c618aeb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*cMeDPjrwxx5ZrQiQT1SAMg.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">保存稀疏矩阵的一个例子</p></figure><p id="5987" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我将部署 web 应用程序以及腌余弦相似性矩阵，我担心大文件大小(1–2gb)。因此，在转换为 csr_matrix 之前，如果得分不在前 10 名，我将菜谱与目标菜谱的相似性得分设置为 0。那么我们只需要 pickle ~recipe_num * 10 个压缩稀疏行格式化矩阵中的元素。文件大小从 1.67 GB 到 2 MB :D。顺便说一下，我今天在他处理大型 NLP 数据文件的旅程中遇到了这个<a class="ae ki" rel="noopener" target="_blank" href="/deploying-an-nlp-web-app-with-heroku-the-pickle-problem-f50113ed2367">中型帖子</a>，希望它也可以帮助你，如果你正面临类似的部署问题。</p><pre class="kk kl km kn gt ni nj nk nl aw nm bi"><span id="fb23" class="mt lx it nj b gy nn no l np nq">sparse.csr_matrix(sim_matrix)<br/># &lt;18000x18000 sparse matrix of type '&lt;class 'numpy.float32'&gt;'  with 202073252 stored elements in Compressed Sparse Row format&gt;</span><span id="f9fd" class="mt lx it nj b gy nr no l np nq"># Let's keep top 10 elements of each row whose indices are of the recipes to be recommended.</span><span id="35bf" class="mt lx it nj b gy nr no l np nq">for i in range(len(sim_matrix)):</span><span id="1610" class="mt lx it nj b gy nr no l np nq">    row = sim_matrix[i]</span><span id="077a" class="mt lx it nj b gy nr no l np nq">    # cos sim of top 10th element</span><span id="6e89" class="mt lx it nj b gy nr no l np nq">    threshold = heapq.nlargest(10, row)[-1]<br/>    row[row &lt; threshold] = 0</span><span id="0d4e" class="mt lx it nj b gy nr no l np nq">sparse.csr_matrix(sim_matrix)<br/># &lt;18000x18000 sparse matrix of type '&lt;class 'numpy.float32'&gt;'  with 202070 stored elements in Compressed Sparse Row format&gt;</span></pre><h2 id="2007" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated"><strong class="ak"> 2。使用 PySpark 计算余弦相似度:</strong></h2><p id="5c0d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在 Colab 中使用 PySpark 进行分布式计算，使用以下代码:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="2df8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了获得相似性矩阵，使用三种不同的 NLP 方法来表示配方:</p><ol class=""><li id="51bd" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">一堆话。</li><li id="d344" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">Doc2Vec。</li><li id="29ee" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">伯特。</li></ol><p id="2601" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在下一节讨论这三种方法。</p><p id="7b0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们先来看看“食谱大师”的主要功能:</p><p id="e821" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">主应用首先提供从 Recipe 1M+数据集中随机选择的 10 个食谱。用户可以选择一个或多个食谱并要求推荐。他或她也可以要求其他食谱收藏，直到看到那些有趣的。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi og"><img src="../Images/52766433c2fb471fd23a03935b96e309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4Nw6qbc2uzTh5kANEnqiQ.png"/></div></div></figure><p id="1112" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，如果我们选择“红烧鸡肉”，单词包模型将为我们带来以下选择，您可以继续选择，基于这些，web 应用程序将推送新的食谱推荐。如你所见，建议的食谱与最初的选择相似。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/0b53c81ae6732b4b5686aee611453efc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*PtY61e5wjVRgf1kEB8SIng.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">基于词汇袋模型的建议</p></figure><p id="b3f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，我将挑选 3 个我喜欢的食谱，看看我们会得到什么:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/cca115af98805117c2b23f8483555419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*bY-9gErkDLEOISFhYlNgNw.png"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/2d7ebb817ecaec897e5a6dc5b9dfa98e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*ITn3mSFK4-F7Exk8Hyoapw.png"/></div></figure><p id="b1fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不错，推荐的食谱也大多是甜点。BoW 在使用 BoW 向量表示来测量来自不同食谱的短文本的相似性方面是简单且有效的。特别地，计数矢量器方法用于表示配方。然而，BoW 的一个缺点是它丢失了关于词序的信息。由于数据稀疏和高维数，我没有使用可以帮助捕获局部词序的 n-grams 模型的包。</p><p id="92ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ki" href="https://cs.stanford.edu/~quocle/paragraph_vector.pdf" rel="noopener ugc nofollow" target="_blank"> Doc2Vec </a>是使用无监督学习来测量两个文档之间的相似性的另一个选项。它将每个文档表示为一个向量，并提供文本文档的数字表示。与表示单词概念的 word2vec 不同，doc2vec 为每个文档生成试图使用固定长度向量来表示文档概念的向量。这里，使用的配方 1M+数据子集不同于 Doc2Vec 使用的子集，也包括 18k 配方。该方法也相当简单。我使用<a class="ae ki" href="https://radimrehurek.com/gensim/models/doc2vec.html#gensim.models.doc2vec.Doc2Vec" rel="noopener ugc nofollow" target="_blank"> Gensim 的 Doc2Vec 类</a>在数据集上训练并获得嵌入，训练期间隐藏层大小为 512。得到的矩阵具有 1028702 * 512 的维度。对于这个项目，我从矩阵中取出前 18k 行，作为 Doc2Vec 食谱推荐器中包含的食谱的嵌入。</p><p id="f759" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不像 BoW 的推荐在菜谱名称中显示相似或相同的单词，Doc2Vec 的推荐更加多样化。这里有一个例子:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ok"><img src="../Images/f04a30dd39e834e71a9deb6cbfefa193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TmYQAAgIH0RvPxJyX0SDvg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">由 Doc2Vec 提供支持</p></figure><p id="29c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是基于“火腿、羊乳酪和桃子沙拉”和“四种奶酪烤蔬菜”的推荐。我们可以在食谱上下文/语义方面找到更多的相似之处。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ol"><img src="../Images/8e220712c0814b6afa9bb56998ccc539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QwF3ldNMVAxy86-glSEf7g.png"/></div></div></figure><p id="732f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多关于伯特来，而我正在完成应用程序:D..</p></div><div class="ab cl om on hx oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="im in io ip iq"><h2 id="0209" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">工作流程的一些注意事项</h2><p id="c416" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">下面的标准 Lang 类用于根据原始食谱创建单词字典。这在预处理配方语句数据时很有用。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="e7a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个项目，使用来自 Recipe 1M+的 Layer1.json 文件。初步探索性分析显示有 1029720 个食谱，下图显示了食谱字数的直方图。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/3ac99e7fffbf19cc221f87eb179e76dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*GZhPXq9mr6ZaWQyhnm1gmA.png"/></div></figure><p id="f194" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了便于分析，在下游处理中使用了 1029662 个小于 300 字的食谱。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/fcb20fbf75b9444e6445854167009d86.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*56QaGSe6QYv-C1QaEEjbwg.png"/></div></figure><p id="cf69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“det_ingrs.json”提供了 51213 个食谱的营养信息，我将在 web 应用程序的下一步中加入这些信息，因此用户可以根据营养要求筛选食谱。</p><p id="e51d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“食谱大师”网络应用程序是使用 Flask 构建的。</p></div></div>    
</body>
</html>