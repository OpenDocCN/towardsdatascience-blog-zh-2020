<html>
<head>
<title>An Introduction To SQLite Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 的 SQLite 简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/did-you-know-you-can-get-rid-of-excel-sheets-csv-files-when-working-with-python-3cf8164a57c4?source=collection_archive---------39-----------------------#2020-07-11">https://towardsdatascience.com/did-you-know-you-can-get-rid-of-excel-sheets-csv-files-when-working-with-python-3cf8164a57c4?source=collection_archive---------39-----------------------#2020-07-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0607" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">电子表格的免费替代品</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cf5d6bb71df72a14cdc094a3560f6b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RReFvUlcWo-K6uHn"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">米利安·耶西耶在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="33b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在信息报告领域，我们主要依靠<strong class="ky ir"> <em class="ls"> Excel 表格</em>和<em class="ls"> CSV </em>文件</strong>来满足我们的数据存储需求。随着<em class="ls"> Excel </em>和<em class="ls"> CSV </em>文件数量的增加，这些文件的管理成为一个真正的挑战。对于这样的场景，拥有数据库软件似乎是一个合适的解决方案。但是，由于成本和上线时间等因素，该解决方案被搁置一旁。</p><p id="270e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我们将向您介绍<strong class="ky ir"> <em class="ls"> SQLite3。</em> </strong>它是一个 Python 模块，创建了一个免费的、磁盘上的关系数据库管理系统。</p><h1 id="8676" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">1.)关于<em class="ml"> SQLite </em> DB 和 SQLite3 模块的简要说明</h1><p id="60a1" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls"> SQLite </em> </strong>是一个<strong class="ky ir">独立的</strong>和<strong class="ky ir">无服务器</strong> <em class="ls"> C </em>应用程序库，它提供了一个<strong class="ky ir">磁盘关系数据库管理系统(RDBMS) </strong>。无服务器使得<em class="ls"> SQLite </em>成为原型开发、移动应用和游戏开发的完美候选。</p><p id="ca65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls"> SQLite3 </em> </strong>是一个 Python 模块，在标准 Python 安装中默认可用。它提供了一个使用 SQLite 数据库的接口，并确保数据库管理成为标准 Python 代码的一部分。</p><h1 id="28f2" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">2.)如何创建数据库？</h1><p id="d785" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">创建一个<em class="ls"> SQLite </em>数据库就像执行一个<em class="ls"> SQLite3 </em>下面的代码块演示了同样的情况。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="e8fe" class="mw lu iq ms b gy mx my l mz na"><strong class="ms ir">import </strong>sqlite3 <strong class="ms ir">as </strong>db<br/>con = db.connect(<strong class="ms ir">"Folder_Location/sample.db"</strong>)</span></pre><p id="a824" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果文件夹位置中已经存在具有所需名称的数据库，库将建立新的连接。否则，它创建一个新的数据库。</p><p id="97fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要查看该数据库、其相关表以及这些表中的数据，可以使用基于第三方 GUI 的应用程序<a class="ae kv" href="https://sqlitebrowser.org/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">SQLitebrowser</em></strong></a><strong class="ky ir">。</strong>下面是应用程序界面截图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/652402fbd649933741e69dcdd2591ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1yggbfnfLmN5vmqJGt9F4g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">屏幕截图— Sqlite 浏览器(图片由作者提供)</p></figure><h1 id="c386" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">3.)PEP 249 和光标</h1><p id="7648" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">在我们学习使用<em class="ls"> SQLite3 </em>执行<em class="ls"> SQL </em>查询之前，让我们先来看看<strong class="ky ir"> PEP 249 </strong>和<strong class="ky ir">游标</strong>。</p><p id="f1ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> PEP 249 </strong>是设计数据库接口的 Python 标准指南(像<em class="ls"> SQLite3 </em>模块)。它确保使用 Python 代码执行<em class="ls"> SQL </em>查询的方法在数据库之间保持一致，并且<strong class="ky ir">支持可移植性</strong>。PEP 249 <strong class="ky ir">推荐使用游标</strong>来执行<em class="ls"> SQL </em>查询。</p><p id="fb92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">光标</strong>是对象的<strong class="ky ir">类</strong>，其方法定义为<strong class="ky ir">支持<em class="ls"> SQL </em>查询执行</strong>。我们可以使用<strong class="ky ir">连接对象</strong>的<strong class="ky ir">光标方法</strong>创建这个类的一个实例。下面的代码块演示了光标对象的创建。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="7131" class="mw lu iq ms b gy mx my l mz na">### Previous Python Statements<br/><strong class="ms ir">import </strong>sqlite3 <strong class="ms ir">as </strong>db<br/>con = db.connect(<strong class="ms ir">"Folder_Location/sample.db"</strong>)</span><span id="0f11" class="mw lu iq ms b gy nc my l mz na">### Creating a cursor<br/>cur = con.cursor()</span></pre><h1 id="4690" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">4.)游标方法和 SQL 查询</h1><p id="1c30" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">创建游标对象后，我们可以使用它的方法来执行<em class="ls"> SQL </em>查询。游标对象支持多种方法来执行<em class="ls"> SQL </em>查询。其中一个清单如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/c7c75339130b5c19622012f9eff79c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ja4J5jSdxakFnhNPtT8mYQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">光标方法(图片由作者提供)</p></figure><p id="5801" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于本教程，我们将主要使用<strong class="ky ir">执行方法</strong>。<strong class="ky ir"> </strong>关于<em class="ls"> Sqlite3 </em>模块的详细文档可以在 Python <a class="ae kv" href="https://www.sqlite.org/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">官网</strong> </a> <strong class="ky ir"> : </strong>获得</p><h2 id="3345" class="mw lu iq bd lv ne nf dn lz ng nh dp md lf ni nj mf lj nk nl mh ln nm nn mj no bi translated"><strong class="ak">表格创建</strong></h2><p id="d832" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">我们可以将<strong class="ky ir"> create table <em class="ls"> SQL </em>查询作为字符串</strong>传递给 execute 方法来创建新表。我们可以保持表格结构与我们想要存储在数据库中的<em class="ls"> Excel 表</em>或<em class="ls"> CSV 文件</em>相同。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="e3f1" class="mw lu iq ms b gy mx my l mz na">#### Creating table using cursor<br/><strong class="ms ir">cur.execute</strong>('''CREATE TABLE IF NOT EXISTS <strong class="ms ir">dept</strong> <br/>(id text PRIMARY KEY, dept_name text NOT NULL,<br/>dept_head text);''')</span></pre><h2 id="6dd2" class="mw lu iq bd lv ne nf dn lz ng nh dp md lf ni nj mf lj nk nl mh ln nm nn mj no bi translated"><strong class="ak">加载数据</strong></h2><p id="8d39" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">为了将数据加载到数据库中，我们将<strong class="ky ir">使用 Pandas 库</strong>的内置函数。下面的代码块<strong class="ky ir">假设导入的<em class="ls"> Excel </em>文件与<em class="ls"> SQLite </em>数据库表</strong>中的列名相同。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="677f" class="mw lu iq ms b gy mx my l mz na">#### Using Pandas builtin function to push the excel data<br/>#### Importing pandas<br/>import pandas as pd</span><span id="b0da" class="mw lu iq ms b gy nc my l mz na">#### Importing CSV file as a dataframe<br/>df = pd.read_csv("file location/name.csv")</span><span id="5ead" class="mw lu iq ms b gy nc my l mz na">#### Pushing the dataframe in to the SQLite database<br/>df.to_sql(table_name, con, if_exists = "append", index = False)</span></pre><p id="b633" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">描述</strong> : —我们使用了<strong class="ky ir">‘to _ SQL’</strong>data frame 方法的 4 个不同参数:</p><ul class=""><li id="3527" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr nu nv nw nx bi translated"><strong class="ky ir"> Table_name </strong> —我们正在推送数据的表</li><li id="bf8b" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><strong class="ky ir"> Con </strong> —连接到数据库时初始化的连接对象</li><li id="98b1" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><strong class="ky ir"> If_exists </strong> —该参数<strong class="ky ir">检查<em class="ls"> SQLite </em>数据库中是否存在表格</strong>。如果该表存在，数据框中的数据将追加到现有表中。另一个选项是用“<strong class="ky ir">代替</strong>作为参数实参。它将用数据框中的新数据替换历史数据。</li><li id="fb25" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><strong class="ky ir">索引</strong>-这将确保数据框索引不会被添加到表中。</li></ul><p id="4c48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用上面的函数，可以很容易地将<em class="ls"> Excel </em> / <em class="ls"> CSV </em>数据导入到他们的<em class="ls"> SQLite </em>数据库中。如果<strong class="ky ir">情况允许插入手动记录</strong>，我们可以使用下面的<strong class="ky ir"> insert 语句</strong>:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="bd7c" class="mw lu iq ms b gy mx my l mz na">#### Insert statement to insert a specific value in a database table<br/><strong class="ms ir">cur.execute</strong>('''INSERT INTO <strong class="ms ir">dept</strong>(id, dept_name,dept_head) VALUES (1, "Analytics", "Department Head");''')</span></pre><p id="fd92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的语句中，我们将数据插入到部门表中。</p><ul class=""><li id="6b2f" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr nu nv nw nx bi translated">表名后提供的<strong class="ky ir">列列表</strong>是可选的</li><li id="6373" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">在列列表后，使用关键字值，然后是<strong class="ky ir">值列表</strong></li><li id="dee7" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">值列表中值的数量应该与列列表中列的数量相同</li><li id="d2cf" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">值列表中的元素数应该与表中的列数相同</li></ul><h2 id="b675" class="mw lu iq bd lv ne nf dn lz ng nh dp md lf ni nj mf lj nk nl mh ln nm nn mj no bi translated"><strong class="ak">选择数据</strong></h2><p id="7bf2" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">一旦数据在<em class="ls"> SQLite </em>表中可用，将它用于您的报告或分析目的是一个人将执行的关键活动。使用<strong class="ky ir">选择查询来</strong>完成工作<strong class="ky ir">。</strong></p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="06a5" class="mw lu iq ms b gy mx my l mz na">#### Selecting data from the table<br/><strong class="ms ir">for </strong>rows <strong class="ms ir">in </strong>cur.execute(<strong class="ms ir">'''select * from dept'''</strong>):<br/>    print(rows)</span></pre><p id="b297" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:在上面的例子中，<strong class="ky ir">光标对象被视为一个 iterable 对象，它循环</strong>以获取所有选中的记录。或者，可以使用<strong class="ky ir">获取一个、获取多个或获取所有</strong>方法来选择特定数量的记录。</p><h2 id="a7ec" class="mw lu iq bd lv ne nf dn lz ng nh dp md lf ni nj mf lj nk nl mh ln nm nn mj no bi translated"><strong class="ak">删除记录</strong></h2><p id="6856" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">通常，在后期阶段，我们会发现表中的数据记录包含一些错误的值。使用标准的<strong class="ky ir">删除查询，</strong>我们可以删除特定的记录。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="dad3" class="mw lu iq ms b gy mx my l mz na">#### Deleting data in table<br/>cur.execute('''<strong class="ms ir">delete from dept where id in (3,4)</strong>''')<br/>con.commit()</span></pre><p id="a3e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>我们应该在每次插入、删除或更新操作<strong class="ky ir">之后执行一个<strong class="ky ir">提交方法</strong>。</strong>它确保数据更改成功地反映在数据库中。</p><h1 id="11bb" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结束语</h1><p id="b529" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">在创建<strong class="ky ir">应用程序原型</strong>、<strong class="ky ir">设计概念证明</strong>和<strong class="ky ir">处理多个<em class="ls"> CSV </em>文件</strong>时，我们大多数人都希望有一个<strong class="ky ir">服务器免费和轻量级</strong>版本的关系数据库。有了<em class="ls"> SQLite </em>和它的 Python 接口的知识，我希望我们现在可以跨越这个鸿沟。</p><p id="a834" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这篇教程是有启发性的，并且你学到了一些新的东西。</p><p id="39ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我会在未来的教程中尝试引入更多有趣的话题。在此之前:</p><p id="a515" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">快乐学习！！！！</p></div></div>    
</body>
</html>