<html>
<head>
<title>24x5 AI Stock Trading agent to predict stock prices | Live trading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">24x5人工智能股票交易代理预测股票价格|实时交易</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/24x5-stock-trading-agent-to-predict-stock-prices-with-deep-learning-with-deployment-c15570720ae9?source=collection_archive---------4-----------------------#2020-04-18">https://towardsdatascience.com/24x5-stock-trading-agent-to-predict-stock-prices-with-deep-learning-with-deployment-c15570720ae9?source=collection_archive---------4-----------------------#2020-04-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi jx"><img src="../Images/bdfb18bf5a1d660dd304c553d3e64246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DB4VGp2gnxrAKnV3"/></div></div><p class="kj kk gj gh gi kl km bd b be z dk translated"><a class="ae kn" href="https://unsplash.com/@whitfieldjordan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乔丹·怀特菲尔德</a>在<a class="ae kn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="d335" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你最近关注股票市场，你会注意到新冠肺炎带来的剧烈波动。它一天涨一天跌，这是人工智能很容易预测的。如果有一个拥有人工智能能力的股票交易代理人来买卖股票，而不需要每小时监控，那岂不是很棒？</p><p id="62eb" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">所以我决定创造一个机器人来交易。你会看到许多从CSV读取并创建神经网络的模型，LSTM，或深度强化模型(DRL)。然而，这些模型最终会出现在沙盒环境中，并且在真实环境中使用起来往往很棘手。所以我创造了人工智能管道，实时交易。毕竟，谁不想在股市里赚钱呢？所以让我们开始吧。下面是我们将遵循的实施流程。</p><ol class=""><li id="f7e7" class="lm ln it kq b kr ks kv kw kz lo ld lp lh lq ll lr ls lt lu bi translated">羊驼经纪人账户</li><li id="27d4" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">用于API交易的羊驼毛python包</li><li id="34ff" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">收集数据、EDA、特征工程</li><li id="234e" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">人工智能模型与训练</li><li id="29cc" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">AWS云托管代码并获得预测</li><li id="6842" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">创建一个lambda函数和API</li><li id="4f84" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">自动交易股票</li></ol><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi ma"><img src="../Images/a58428184be2949abfa360b2a694ef96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Isw_N2kp0Gpt4yAJvE6_xg.png"/></div></div><p class="kj kk gj gh gi kl km bd b be z dk translated">工作流程</p></figure><h1 id="353b" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">羊驼经纪人账户:</h1><p id="9aac" class="pw-post-body-paragraph ko kp it kq b kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh nd lj lk ll im bi translated">目前，大多数经纪公司提供零交易费。然而，并不是所有的经纪公司都有API选项来交易。<a class="ae kn" href="http://alpaca.markets" rel="noopener ugc nofollow" target="_blank">羊驼</a>提供免费交易用python API进行交易。一旦您创建了一个帐户，您将有纸交易和现场交易的选择。我们可以在纸上交易中测试策略，并在现场交易中实施。这只是实时交易的一个关键变化。</p><h1 id="5721" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">用于API交易的羊驼毛python包:</h1><p id="db0d" class="pw-post-body-paragraph ko kp it kq b kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh nd lj lk ll im bi translated">如果能有本地环境，可以安装<a class="ae kn" href="https://pypi.org/project/alpaca-trade-api/" rel="noopener ugc nofollow" target="_blank"> pip包</a>。安装后，您可以选择纸上交易或现场交易。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/d5c3e4f4b4255060173ad1afe9106616.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*3uR9MW223osA2HlV8_CKdA.png"/></div></figure><p id="f1e3" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">基于您的选择，您可以获得API和密钥。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi nf"><img src="../Images/a52ad5fcc2f1ac757bef2e1485b52b45.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*Zgl5qgr1sDUTFYhdGoeexA.png"/></div></div></figure><p id="4043" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在，这些键将在我们的代码中使用。</p><pre class="jy jz ka kb gt ng nh ni nj aw nk bi"><span id="579f" class="nl mc it nh b gy nm nn l no np">import alpaca_trade_api as tradeapi</span><span id="16e7" class="nl mc it nh b gy nq nn l no np">api = tradeapi.REST('xxxxxxxx', 'xxxxxxxxxx',base_url='<a class="ae kn" href="https://paper-api.alpaca.markets'" rel="noopener ugc nofollow" target="_blank">https://paper-api.alpaca.markets'</a>, api_version='v2',)</span></pre><h1 id="e2db" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">收集数据并转换</h1><p id="fc39" class="pw-post-body-paragraph ko kp it kq b kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh nd lj lk ll im bi translated"><strong class="kq iu">获取数据</strong></p><p id="ae8c" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">使用羊驼的一个好处是你可以从多边形API中获得历史数据。时间范围可以是分钟、小时、天等。创建数据框后，图表应如下所示。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi nr"><img src="../Images/e06a6074ef25c2f34417e7240640fce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*boc9DE9qporgo0Q3TgpTRQ.png"/></div></div></figure><p id="b206" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="kq iu">特征工程</strong></p><p id="db58" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">像任何数据科学项目一样，我们需要创建与数据集相关的要素。实现的某些部分是从<a class="ae kn" rel="noopener" target="_blank" href="/stock-market-action-prediction-with-convnet-8689238feae3">这篇文章</a>中引用的。我从上面的数据集中建立了大约430多个技术指标。特征包括动量，趋势，波动，RSI等。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi ns"><img src="../Images/4b8df5d75b585355ffc580721f6f58f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-wujy6eSuRdNtdgsGNaBIA.png"/></div></div></figure><p id="871a" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">已经为每一天创建了特征。它可以很容易地创建为每小时或任何其他时间段。对于我们将要创建的一些模型，如DRL LSTM，我们可能需要使用原始数据集。</p><p id="8c2b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">创建标签和特征是我们必须创建逻辑来训练模型的地方。目前，我使用了本文中<a class="ae kn" href="https://www.researchgate.net/publication/324802031_Algorithmic_Financial_Trading_with_Deep_Convolutional_Neural_Networks_Time_Series_to_Image_Conversion_Approach" rel="noopener ugc nofollow" target="_blank">的逻辑。</a></p><p id="203f" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">然而，创建逻辑可以根据您的需要进行更改。执行无监督学习时，不需要创建标签。</p><figure class="jy jz ka kb gt kc"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="1e00" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">最后，需要对数据进行缩放。神经网络在缩放数据中工作得更好。第一个函数将使用训练数据拟合scaler对象，下一个函数用于缩放任何数据集。</p><pre class="jy jz ka kb gt ng nh ni nj aw nk bi"><span id="cab8" class="nl mc it nh b gy nm nn l no np"># scale train and test data to [-1, 1]<br/>def transform_scale(train):<br/>    # fit scaler<br/>    <br/>    print(len(train.columns))<br/>    scaler = MinMaxScaler(feature_range=(-1, 1))<br/>    scaler = scaler.fit(train)<br/>    # transform train<br/>    return scaler</span><span id="b22d" class="nl mc it nh b gy nq nn l no np"># scale train and test data to [-1, 1]<br/>def scale(dataset, scaler):<br/>    # transform train<br/>    dataset = scaler.transform(dataset)<br/>    print(dataset.shape)<br/>    return dataset</span></pre><p id="4c8e" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一旦我们创建了模型，我们必须准备好数据作为数据加载器。下面的函数将执行它。</p><pre class="jy jz ka kb gt ng nh ni nj aw nk bi"><span id="05c5" class="nl mc it nh b gy nm nn l no np">def _get_train_data_loader(batch_size, train_data):<br/>    print("Get train data loader.")<br/>    <br/>    train_X =    torch.from_numpy(train_data.drop(['labels'],axis=1).values).float()<br/>    <br/>    train_Y = torch.from_numpy(train_data['labels'].values).float()<br/>    <br/>    train_ds = torch.utils.data.TensorDataset(train_X,train_Y)</span><span id="a5cc" class="nl mc it nh b gy nq nn l no np">return torch.utils.data.DataLoader(train_ds,shuffle=False, batch_size=batch_size)</span></pre><h1 id="736f" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">人工智能模型</h1><p id="627f" class="pw-post-body-paragraph ko kp it kq b kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh nd lj lk ll im bi translated">在本节中，我们将创建不同类型的模型。但是，这些模型对于时间序列数据集来说可能并不完美。我想展示如何使用具有完整管道的深度学习模型。</p><p id="6504" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="kq iu">全连接深度NN </strong></p><blockquote class="nv nw nx"><p id="8890" class="ko kp ny kq b kr ks kt ku kv kw kx ky nz la lb lc oa le lf lg ob li lj lk ll im bi translated">这里我们将创建一个完全连接的深度神经网络。<strong class="kq iu">模型本身并不花哨，我也不指望它能表现得更好。此外，它也不是一个适合时间序列数据的模型。我使用这个模型只是为了使用我们所有的功能，并且为了简单起见。</strong></p></blockquote><p id="f1f7" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">然而，我们正从一个基本模型开始，以完善我们的管道。在下一节中，我将展示如何创建其他类型的模型。我们的model.py看起来像下面这个。</p><pre class="jy jz ka kb gt ng nh ni nj aw nk bi"><span id="8950" class="nl mc it nh b gy nm nn l no np">import torch.nn as nn<br/>import torch.nn.functional as F</span><span id="e68a" class="nl mc it nh b gy nq nn l no np"># define the CNN architecture<br/>class Net(nn.Module):<br/>    def __init__(self, hidden_dim, dropout =0.3):<br/>        <br/>        super(Net, self).__init__()<br/>        # Number of features<br/>        self.fc1 = nn.Linear(427, hidden_dim)<br/>        <br/>        self.fc2 = nn.Linear(hidden_dim, hidden_dim*2)<br/>        <br/>        self.fc3 = nn.Linear(hidden_dim*2, hidden_dim)<br/>        <br/>        self.fc4 = nn.Linear(hidden_dim, 32)<br/>        <br/>        self.fc5 = nn.Linear(32, 3)<br/>        <br/>        self.dropout = nn.Dropout(dropout)<br/>        <br/>    def forward(self, x):<br/>        <br/>        out = self.dropout(F.relu(self.fc1(x)))<br/>        <br/>        out = self.dropout(F.relu(self.fc2(out)))<br/>        <br/>        out = self.dropout(F.relu(self.fc3(out)))<br/>        <br/>        out = self.dropout(F.relu(self.fc4(out)))<br/>        <br/>        out = self.fc5(out)<br/>        <br/>        return out</span></pre><p id="e54f" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在创建了模型和所需的转换之后，我们将创建我们的训练循环。</p><figure class="jy jz ka kb gt kc"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="fd58" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们将在AWS Sagemaker中训练我们的模型。这完全是一个可选步骤。模型可以在本地训练，模型输出文件可以用于预测。如果你在云端训练它，下面的代码可以用来训练。</p><figure class="jy jz ka kb gt kc"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="b8fa" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您还需要一个具有Sagemaker设置的AWS帐户。如果你需要更多的信息或帮助，请查看我以前的文章，<a class="ae kn" rel="noopener" target="_blank" href="/train-a-gan-and-generate-faces-using-aws-sagemaker-pytorch-4d4c07ed0c38">使用AWS Sagemaker | PyTorch </a>设置部分训练GAN并生成人脸。</p><p id="7756" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一旦您拥有了所有需要的访问权限，您就可以开始拟合模型了，如下所示。下面的命令将把所有必要的代码和数据打包，用所需的容器创建一个EC2服务器，并训练模型。</p><pre class="jy jz ka kb gt ng nh ni nj aw nk bi"><span id="a2ae" class="nl mc it nh b gy nm nn l no np">from sagemaker.pytorch import PyTorch</span><span id="84bd" class="nl mc it nh b gy nq nn l no np">#Check the status of dataloader<br/>estimator = PyTorch(entry_point="train.py",<br/>                    source_dir="train",<br/>                    role=role,<br/>                    framework_version='1.0.0',<br/>                    train_instance_count=1,<br/>                    train_instance_type='ml.p2.xlarge',<br/>                    hyperparameters={<br/>                        'epochs': 2,<br/>                        'hidden_dim': 32,<br/>                    },)</span></pre><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi oc"><img src="../Images/f331cea5c53e17ec0e02377d6d956be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DfRehX6eV4SgssqIiqutyw.png"/></div></div></figure><p id="e65a" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一旦您训练了模型，所有相应的文件将在您的S3桶。如果您在本地训练您的模型，确保您在相应的S3存储桶位置有文件。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi od"><img src="../Images/3279e7d5cc138e59f10eb4eb9fc79ed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tMh2bJT9yvlqSqKh4iwolA.png"/></div></div></figure><h1 id="9d39" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">AWS云托管代码并获得预测</h1><p id="6774" class="pw-post-body-paragraph ko kp it kq b kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh nd lj lk ll im bi translated">作为我们的下一个设置，我们将在AWS Sagemaker中部署模型。在SageMaker中部署PyTorch模型时，您需要提供SageMaker推理容器将使用的四个函数。</p><ul class=""><li id="50ae" class="lm ln it kq b kr ks kv kw kz lo ld lp lh lq ll oe ls lt lu bi translated">这个函数和我们在训练脚本中使用的是同一个函数，它告诉SageMaker如何从S3桶中加载我们的模型。</li><li id="a232" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll oe ls lt lu bi translated"><code class="fe of og oh nh b">input_fn</code>:这个函数接收发送到模型端点的原始序列化输入，它的工作是反序列化输入，使输入可用于推理代码。在这里，我们将每天或每小时从羊驼API创建新数据。</li><li id="76bf" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll oe ls lt lu bi translated"><code class="fe of og oh nh b">output_fn</code>:这个函数获取推理代码的输出，它的工作是序列化这个输出，并将其返回给模型端点的调用者。这就是我们交易的逻辑。</li><li id="943c" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll oe ls lt lu bi translated"><code class="fe of og oh nh b">predict_fn</code>:推理脚本的核心是进行实际预测的地方，也是您需要完成的功能。将使用基础数据进行预测。它有三种结果买入、卖出和持有。</li></ul><p id="3e4d" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">下面是加载模型和准备输入数据的代码</p><figure class="jy jz ka kb gt kc"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="0d46" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">以上代码中需要注意的几点:</p><ol class=""><li id="8f71" class="lm ln it kq b kr ks kv kw kz lo ld lp lh lq ll lr ls lt lu bi translated">模型和缩放对象需要在S3桶中。</li><li id="c0a7" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">我们已经收集了许多天或几个小时的数据。这是LSTM类型网络所必需的。</li><li id="f80c" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">输入内容是股票代码。我们可以调整多个符号的代码。</li></ol><p id="8a82" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在下面的代码部分，我们将创建输出并预测函数。</p><figure class="jy jz ka kb gt kc"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="8cfe" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">上述代码中需要注意的几点</p><ol class=""><li id="d627" class="lm ln it kq b kr ks kv kw kz lo ld lp lh lq ll lr ls lt lu bi translated">我们有三个等级购买、出售或持有。预测需要是这三者之一。</li><li id="03e2" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">我们需要关注预测和返回的内容。</li><li id="f737" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">只有在资金充足(或资金有限)且数量有限的情况下才交易。</li></ol><p id="310f" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">部署类似于训练模型。</p><pre class="jy jz ka kb gt ng nh ni nj aw nk bi"><span id="88eb" class="nl mc it nh b gy nm nn l no np">from sagemaker.predictor import RealTimePredictor<br/>from sagemaker.pytorch import PyTorchModel</span><span id="4a1b" class="nl mc it nh b gy nq nn l no np">class StringPredictor(RealTimePredictor):<br/>    def __init__(self, endpoint_name, sagemaker_session):<br/>        super(StringPredictor, self).__init__(endpoint_name, sagemaker_session, content_type='text/plain')</span><span id="18b7" class="nl mc it nh b gy nq nn l no np">model = PyTorchModel(model_data=estimator.model_data,<br/>                     role = role,<br/>                     framework_version='1.0.0',<br/>                     entry_point='predict.py',<br/>                     source_dir='../serve',<br/>                     predictor_cls=StringPredictor,)</span><span id="6de2" class="nl mc it nh b gy nq nn l no np"># Deploy the model in cloud server</span><span id="c6de" class="nl mc it nh b gy nq nn l no np">predictor = model.deploy(initial_instance_count=1, instance_type='ml.m5.large')</span></pre><p id="6024" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你想测试这个模型，你可以执行下面的代码。这表示工作流程正在运行，你可以输出你的预测，并在发行的股票行情自动收报机上交易股票。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi oi"><img src="../Images/170ffe952b602ac6b23b515b567246f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WtI4T790tpzVjCzIcbF8Cg.png"/></div></div><p class="kj kk gj gh gi kl km bd b be z dk translated">预测端点名称</p></figure><p id="30fd" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您也可以从截图中的上述代码中获得端点名称。</p><h1 id="06a5" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">创建一个Lambda函数和API</h1><p id="f9e7" class="pw-post-body-paragraph ko kp it kq b kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh nd lj lk ll im bi translated">这里将通过创建Lamda函数和API来完成管道。</p><p id="db1b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="kq iu">创建一个λ函数</strong></p><p id="3639" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在AWS lambda服务中创建lambda函数。记得从上面的截图中更新端点名称。</p><figure class="jy jz ka kb gt kc"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="342b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="kq iu"> API网关</strong></p><p id="3de0" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">从AWS API网关服务中，创建一个Rest API。然后命名并创建API。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi oj"><img src="../Images/edd740ddb3da6165ba2a6f3f3dc361e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rOOW1yibqRyxModj1UwXAg.png"/></div></div></figure><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi ok"><img src="../Images/b40e2efc40625a7985af2814495cc286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54bzfDER-M918bG8aa069w.png"/></div></div></figure><p id="b036" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">从操作下拉列表中创建帖子并部署。一旦创建好了，API就准备好了。如果需要，您可以在任何UI中使用它。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi ol"><img src="../Images/83c1079398e60a09bd289b611c65e8f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MUbPCP_CZIZek1iE_iP6eA.png"/></div></div></figure><p id="6453" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">最后，我们有Rest端点，在这里我们可以创建post请求。可以用Postman或任何其他工具测试端点。如果不需要端点，可以通过跟随<a class="ae kn" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/RunLambdaSchedule.html" rel="noopener ugc nofollow" target="_blank">这个链接</a>来调度lambda函数。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi om"><img src="../Images/b67b588c905263e0e035aaf947aaaf06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aH1M0HeP9scKlzlWAuzgTQ.png"/></div></div></figure><p id="5a87" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">干杯！你可以在羊驼门户看到股票的买卖。预测是从我们的模型中预测出来的，实时数据被输入到模型中。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi on"><img src="../Images/f35158427dcee4cbbed70cefca063a5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MZAB5XCOdIQzfESX"/></div></div><p class="kj kk gj gh gi kl km bd b be z dk translated">由<a class="ae kn" href="https://unsplash.com/@imagefactory?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">科林·沃茨</a>在<a class="ae kn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><h1 id="f662" class="mb mc it bd md me oo mg mh mi op mk ml mm oq mo mp mq or ms mt mu os mw mx my bi translated">结论</h1><p id="fe33" class="pw-post-body-paragraph ko kp it kq b kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh nd lj lk ll im bi translated">我们已经训练了一个深度学习模型，并实时使用该模型的输出进行股票交易。我还是觉得有提升的空间。</p><ol class=""><li id="dac3" class="lm ln it kq b kr ks kv kw kz lo ld lp lh lq ll lr ls lt lu bi translated">我在这里使用了深度神经网络模型。你在这里不需要任何模型。您可以简单地使用您的逻辑并创建管道。</li><li id="6600" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">可以执行更好的特征工程和那些特征的选择。</li><li id="35db" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">不同的模型架构(如LSTM或DRL)需要针对时间序列数据集进行测试。</li><li id="040d" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">需要对训练数据进行回溯测试。在本文中，我没有涉及回测。</li><li id="ca65" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated">该模型可以以频繁的间隔重新训练。AWS Sagemaker提供了一个没有太多麻烦的选项。</li></ol><blockquote class="nv nw nx"><p id="fabe" class="ko kp ny kq b kr ks kt ku kv kw kx ky nz la lb lc oa le lf lg ob li lj lk ll im bi translated">如果对本文有足够的兴趣，我将写一篇后续文章，通过回溯测试实时添加对特定股票的情绪分析，并添加其他模型架构。</p></blockquote><p id="a530" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="kq iu"> <em class="ny">来自《走向数据科学》编辑的提示:</em> </strong> <em class="ny">虽然我们允许独立作者根据我们的</em> <a class="ae kn" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="ny">规则和指南</em> </a> <em class="ny">发表文章，但我们并不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae kn" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="ny">读者术语</em> </a> <em class="ny">。</em></p><h1 id="6324" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">放弃</h1><p id="f5a4" class="pw-post-body-paragraph ko kp it kq b kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh nd lj lk ll im bi translated">这篇文章完全是信息性的。本笔记本中的任何内容都不构成任何特定安全性的建议。所有交易策略使用风险自担。</p><p id="b6e6" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">有问题吗？评论？请在评论区留下您的反馈。</p><p id="03b0" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="kq iu">查看其他文章</strong></p><ol class=""><li id="aff2" class="lm ln it kq b kr ks kv kw kz lo ld lp lh lq ll lr ls lt lu bi translated"><a class="ae kn" href="https://medium.com/make-money-with-code/24x7-live-crypto-trading-buy-doge-or-crypto-using-sentiment-151400dfaaa3?sk=60cd35de6529f24fdbafa3a35ed22082" rel="noopener"> 24x7实时加密交易|购买Doge或任何使用情绪加密的产品</a></li><li id="e27c" class="lm ln it kq b kr lv kv lw kz lx ld ly lh lz ll lr ls lt lu bi translated"><a class="ae kn" href="https://medium.com/make-money-with-code/make-money-using-nft-ai-gan-image-generation-ea43989a08f6?sk=859e99c1b663e14f967f7276aed07448" rel="noopener">利用赚钱+ AI |甘形象生成</a></li></ol></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><h1 id="e505" class="mb mc it bd md me oo mg mh mi op mk ml mm oq mo mp mq or ms mt mu os mw mx my bi translated">获取代码</h1><p id="0e2f" class="pw-post-body-paragraph ko kp it kq b kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh nd lj lk ll im bi translated"><em class="ny">请订阅我的</em> <a class="ae kn" href="https://codesprout.substack.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq iu"> <em class="ny">简讯</em> </strong> </a> <em class="ny">获取我的文章和其他更新的免费工作代码。</em></p></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><p id="f951" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="kq iu">如果您喜欢，请:</strong></p><div class="jy jz ka kb gt ab cb"><figure class="ot kc ou ov ow ox oy paragraph-image"><a href="https://codesprout.substack.com/welcome"><img src="../Images/1ac397b2c5fe72e1c9a6eda135e7c99a.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*N0LI27sdmGurCI4vuR89ew.png"/></a></figure><figure class="ot kc ou ov ow ox oy paragraph-image"><a href="https://twitter.com/intent/follow?user_id=94995010"><img src="../Images/3ab49a50f9340e2bfe2f2fe2ce194c1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*nLk3RYdsZ1Xj-5eJZq2njA.png"/></a></figure><figure class="ot kc ou ov ow ox oy paragraph-image"><a href="https://www.linkedin.com/in/shyambv/"><img src="../Images/6a166f793235ee1c9f389f5fcef45a32.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*yhLN-khdjiroWjY-onojDQ.png"/></a></figure></div></div></div>    
</body>
</html>