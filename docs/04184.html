<html>
<head>
<title>End to End Deep Learning Tutorial using Azure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure的端到端深度学习教程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/end-to-end-deep-learning-tutorial-using-azure-f7bb524f7277?source=collection_archive---------27-----------------------#2020-04-16">https://towardsdatascience.com/end-to-end-deep-learning-tutorial-using-azure-f7bb524f7277?source=collection_archive---------27-----------------------#2020-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/a9e2893337232810dbdd304b604ead0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wAOCmNtYW5FKNUKGF-B0aw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">在Azure上学习深度学习</p></figure><div class=""/><div class=""><h2 id="9a45" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">了解如何设置深度学习工作区，构建自定义数据集，使用azure pipelines通过持续部署来培训和部署模型。</h2></div><h2 id="8ad4" class="ku kv jf bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">简介:</h2><p id="9ad1" class="pw-post-body-paragraph lq lr jf ls b lt lu kg lv lw lx kj ly ld lz ma mb lh mc md me ll mf mg mh mi ij bi translated">本文的目标是在azure上建立一个深度学习工作区，在azure上构建和部署端到端的深度学习项目。我们将首先构建一个定制的图像数据集，以在生产中部署模型。本文是由<a class="ae mj" href="https://studentpartners.microsoft.com" rel="noopener ugc nofollow" target="_blank">微软学生合作伙伴</a>(印度)项目发起的MSP开发者故事的一部分。</p><h2 id="ef9b" class="ku kv jf bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">我们将会建造什么？</h2><p id="c255" class="pw-post-body-paragraph lq lr jf ls b lt lu kg lv lw lx kj ly ld lz ma mb lh mc md me ll mf mg mh mi ij bi translated">我们将构建一个口袋妖怪图像分类器来分类令人敬畏的新手皮卡丘、小火龙、杰尼龟和妙蛙种子。</p><p id="0786" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">mini-pokedex.azurewebsites.net<a class="ae mj" href="https://mini-pokedex.azurewebsites.net/" rel="noopener ugc nofollow" target="_blank">的现场演示</a></p><figure class="mp mq mr ms gt is"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="90a0" class="ku kv jf bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">我们将遵循的步骤:</h2><ol class=""><li id="26d3" class="mv mw jf ls b lt lu lw lx ld mx lh my ll mz mi na nb nc nd bi translated">使用Bing图像搜索API构建自定义图像数据集</li><li id="a64b" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi na nb nc nd bi translated">使用azure Data Science VM设置我们的深度学习工作区</li><li id="6226" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi na nb nc nd bi translated">使用快速人工智能在Azure数据科学虚拟机中构建和训练模型。</li><li id="6d69" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi na nb nc nd bi translated">构建一个web应用程序，通过API和dockerizing使用我们的模型。</li><li id="ac8c" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi na nb nc nd bi translated">将web应用程序的Docker映像推送到azure容器注册表。</li><li id="c18a" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi na nb nc nd bi translated">从azure容器注册表在Linux容器VM中部署web应用程序。</li><li id="841d" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi na nb nc nd bi translated">使用azure管道设置连续部署。</li></ol><h2 id="5b08" class="ku kv jf bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">注意:</h2><p id="1193" class="pw-post-body-paragraph lq lr jf ls b lt lu kg lv lw lx kj ly ld lz ma mb lh mc md me ll mf mg mh mi ij bi translated">开始之前，请确保您在Azure上拥有一个有效订阅的帐户。如果你是STEM的学生，你可以使用<a class="ae mj" href="https://azure.microsoft.com/en-in/free/students/" rel="noopener ugc nofollow" target="_blank"> Azure for Student </a> s免费订阅，或者你可以使用<a class="ae mj" href="https://azure.microsoft.com/en-in/free/" rel="noopener ugc nofollow" target="_blank"> Azure免费帐户</a>。</p><h2 id="e62f" class="ku kv jf bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">步骤1:使用Bing图像搜索api构建自定义图像数据集</h2><p id="3f73" class="pw-post-body-paragraph lq lr jf ls b lt lu kg lv lw lx kj ly ld lz ma mb lh mc md me ll mf mg mh mi ij bi translated">我们将使用Bing图像搜索API，转到<a class="ae mj" href="https://azure.microsoft.com/en-in/services/cognitive-services/bing-image-search-api/" rel="noopener ugc nofollow" target="_blank"> Bing图像搜索API页面</a>，点击尝试Bing图像搜索并登录。然后通过填写必填字段来激活您的服务，如下所示:</p><p id="5a3e" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">给它一个名字，我把它命名为<strong class="ls jg"><em class="nj">dataset-search-API</em></strong>，你可以根据它的可用性尝试任何不同的东西。选择您合适的订阅。对于<strong class="ls jg"> <em class="nj">定价层，F1 </em> </strong>将是合适的，因为它每月提供1000笔免费交易。创建一个<strong class="ls jg"> <em class="nj">资源组搜索-API </em> </strong>，你可以给它起任何名字，但是在Azure中工作时要记住的重要一点是给资源组起一个合适的名字，因为你以后会使用资源组的名字来跟踪费用和删除资源。<strong class="ls jg"> <em class="nj">为资源组选择一个位置</em> </strong>，<strong class="ls jg"> <em class="nj">接受条件</em> </strong>，<strong class="ls jg"> <em class="nj">点击创建</em> </strong>。然后<strong class="ls jg"> <em class="nj">等待</em> </strong>创建您的资源。一旦创建了<strong class="ls jg"> <em class="nj">，点击转到资源</em> </strong>。</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/2b335cd7acbea13f7b1b298077797ee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JKZ2BY-vFiD32FiVy1yMOw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">创建阿炳图像搜索资源</p></figure><ul class=""><li id="e4ac" class="mv mw jf ls b lt mk lw ml ld nl lh nm ll nn mi no nb nc nd bi translated">你可以找到bing图片搜索资源页面的API键。</li><li id="dff7" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">然后git克隆这个repo:<a class="ae mj" href="https://github.com/Akshay090/image-dataset-bing-api" rel="noopener ugc nofollow" target="_blank">image-dataset-bing-API</a></li><li id="cfde" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">在VS代码中打开它，并创建一个名为。并将文件<a class="ae mj" href="https://github.com/Akshay090/image-dataset-bing-api/blob/master/.env.example" rel="noopener ugc nofollow" target="_blank"> .env.example </a>的内容粘贴到其中。</li><li id="c607" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">然后从你的资源页面复制你的bing图片搜索API密匙并粘贴到。env文件放在适当的位置。</li><li id="6504" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">用<strong class="ls jg"><em class="nj">python-m venv venv</em></strong>创建一个虚拟环境</li><li id="091d" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">使用<strong class="ls jg"><em class="nj">venv \ Scripts \ activate . bat</em></strong>(windows中)或<strong class="ls jg"><em class="nj">source venv/bin/activate</em></strong>(Linux中)激活它</li><li id="842f" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">使用<strong class="ls jg"><em class="nj">pip install-r requirements . txt</em></strong>安装依赖项</li><li id="a6b7" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">使用python search_bing_api.py这样的脚本—查询“妙蛙种子”</li><li id="bcdb" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">对杰尼龟小火龙的皮卡丘重复上述过程。</li><li id="3ecc" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">现在你有了一个名为dataset的文件夹，里面有每个口袋妖怪的图像。</li><li id="9526" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">浏览图片，删除那些你觉得不相关的。</li><li id="2a2d" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">像我在这里做的那样，将文件夹(数据集)添加到一个新的git repo中<a class="ae mj" href="https://github.com/Akshay090/pokemon-image-dataset" rel="noopener ugc nofollow" target="_blank"> pokemon-image-dataset </a></li></ul><p id="4c15" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">现在GitHub中有了一个带有自定义图像的repo，让我们开始下一步:</p><h2 id="afd8" class="ku kv jf bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">第二步:使用azure Data Science VM建立我们的深度学习工作区</h2><p id="7309" class="pw-post-body-paragraph lq lr jf ls b lt lu kg lv lw lx kj ly ld lz ma mb lh mc md me ll mf mg mh mi ij bi translated">我们将制作一个NC6宣传片，这是一个带有1个K80 NVIDIA GPU (1/2物理卡)的Linux虚拟机，它是12 GB GPU和6个CPU内核。</p><p id="a993" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">你可以在这里了解更多关于虚拟机的信息。</p><p id="1179" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">如果你需要一个详细的安装程序，你可以参考<a class="ae mj" href="https://course.fast.ai/start_azure.html" rel="noopener ugc nofollow" target="_blank">快速人工智能azure页面</a>，否则你可以遵循以下说明。</p><ul class=""><li id="8e0b" class="mv mw jf ls b lt mk lw ml ld nl lh nm ll nn mi no nb nc nd bi translated">我们将使用fast ai团队创建的模板来设置虚拟机:<a class="ae mj" href="http://aka.ms/dsvm/fastai" rel="noopener ugc nofollow" target="_blank">单击此链接</a>将带您进入虚拟机创建页面。</li><li id="8df4" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">创建一个名为<strong class="ls jg"> DSVM </strong>的<strong class="ls jg">新资源组</strong>，根据您的喜好设置位置。</li><li id="f10e" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated"><strong class="ls jg">设置</strong>管理员<strong class="ls jg">用户名</strong>(小写或Jupyter Hub登录失败，出现500内部服务器错误)，设置<strong class="ls jg">密码</strong></li><li id="31cb" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">设置适当的虚拟机名称，我将其命名为<strong class="ls jg"> <em class="nj"> DSVM-DL </em> </strong>并在虚拟机大小中选择NC6 Promo</li><li id="e6a0" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">选择接受条款，然后单击购买。</li></ul><p id="edbe" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">现在等待，直到资源被创建。单击通知图标以了解它是否已创建，并在创建时单击转到资源组。</p><p id="65b1" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">在“resource，group”页面中，单击您在上面为其命名的虚拟机。并单击您的公共IP，如下图所示</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/9184e05e3d34fc0dd696b4d40bcf3cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vDRc82M04qGkVmEMer9Mgg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">单击ip将其设置为静态</p></figure><p id="3da3" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">点击IP将带您到一个配置为您的公共IP，现在改变分配为静态从动态，你也可以设置一个DNS名称标签。由于这一步，您的虚拟机IP将不会改变后，重新启动。该页面将如下图所示</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/0bba97656f970063fd465bb9aa385bf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZbAaq1gmUXHvvU6axQbOkA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">设置静态IP</p></figure><p id="10ce" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">现在我们已经完成了DSVM的设置，让我们进入下一步</p><h2 id="8201" class="ku kv jf bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">步骤3:使用快速人工智能在Azure数据科学虚拟机中构建和训练模型。</h2><p id="8767" class="pw-post-body-paragraph lq lr jf ls b lt lu kg lv lw lx kj ly ld lz ma mb lh mc md me ll mf mg mh mi ij bi translated">由于你已经设置了一个带GPU的DSVM，你可以通过ssh将带<strong class="ls jg"> azure笔记本</strong>或<strong class="ls jg">使用到DSVM中并使用</strong>。我推荐第二种方法，因为它给你更多的灵活性。首先，让我向您展示azure notebooks方法，然后我们将开始使用带有SSH的VM。</p><p id="d103" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated"><strong class="ls jg">在Azure笔记本上使用Azure DSVM。</strong></p><ul class=""><li id="0dc4" class="mv mw jf ls b lt mk lw ml ld nl lh nm ll nn mi no nb nc nd bi translated">前往<a class="ae mj" href="https://notebooks.azure.com/" rel="noopener ugc nofollow" target="_blank">notebooks.azure.com</a>，登录并创建一个用户id。</li><li id="d711" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">然后单击我的笔记本并创建一个新笔记本。</li><li id="6830" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">现在，要在azure笔记本中使用带有GPU的VM，请将选项Run on Free Compute更改为Run on Direct Compute。</li><li id="d982" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">现在你可以开始在带有GPU的DSVM上使用azure笔记本了。</li></ul><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nq"><img src="../Images/502247fe7c0ece5b7a584fd384baab18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vbpCMRxDQbuYJHil5i9ROw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">更改计算步骤的屏幕</p></figure><p id="1756" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated"><strong class="ls jg"> SSH进入DSVM，从那里使用</strong></p><p id="881f" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">这种方法比上面的方法更灵活。对于<strong class="ls jg"> windows用户，</strong>我推荐<strong class="ls jg">使用wsl </strong>在这一步之前，只需<strong class="ls jg">在当前shell </strong>中键入wsl即可启动。</p><p id="809d" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">要连接到您的虚拟机，请使用:</p><pre class="mp mq mr ms gt nr ns nt nu aw nv bi"><span id="5d2f" class="ku kv jf ns b gy nw nx l ny nz">ssh &lt;username&gt;@&lt;VM Public IP&gt; and enter password</span></pre><p id="556b" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">用下面的命令设置Jupyter笔记本并启动Jupyter</p><pre class="mp mq mr ms gt nr ns nt nu aw nv bi"><span id="a2d3" class="ku kv jf ns b gy nw nx l ny nz">jupyter notebook password<br/>// Enter password:<br/>// Verify password:</span><span id="ce6c" class="ku kv jf ns b gy oa nx l ny nz">jupyter notebook --port 8888</span></pre><p id="80ba" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">创建从虚拟机到localhost:9999的ssh隧道</p><pre class="mp mq mr ms gt nr ns nt nu aw nv bi"><span id="79ab" class="ku kv jf ns b gy nw nx l ny nz">ssh -L 9999:127.0.0.1:8888 &lt;username&gt;@&lt;VM Public IP&gt;</span></pre><p id="5b5f" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">现在进入<a class="ae mj" href="http://localhost:9999/" rel="noopener ugc nofollow" target="_blank"> localhost:9999 </a>使用jupyter笔记本，输入密码开始使用。</p><p id="e3b5" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">你可以创建一个文件夹，制作一个名为pokedex-dl的笔记本，然后开始工作。</p><p id="674e" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated"><strong class="ls jg">注意:</strong>请参考<a class="ae mj" href="https://github.com/Akshay090/Pokedex-DL/blob/master/pokedex.ipynb" rel="noopener ugc nofollow" target="_blank"> pokedex.ipynb </a>训练并将您的模型导出到outputs文件夹。我已经在笔记本上解释了每一个步骤，如果你有任何疑问，请在下面评论。</p><p id="58c1" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">跟随<a class="ae mj" href="https://github.com/Akshay090/Pokedex-DL/blob/master/pokedex.ipynb" rel="noopener ugc nofollow" target="_blank"> pokedex.ipynb </a>之后，您将有一个名为poke_predictor_resnet34的输出文件夹，从Jupyter笔记本下载。<strong class="ls jg"> <em class="nj">上传模型到Dropbox</em></strong><strong class="ls jg"><em class="nj">获取可共享链接</em> </strong>。</p><h2 id="3786" class="ku kv jf bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">步骤4:构建一个web应用程序，通过API使用我们的模型，并对其进行dockerizing。</h2><p id="b848" class="pw-post-body-paragraph lq lr jf ls b lt lu kg lv lw lx kj ly ld lz ma mb lh mc md me ll mf mg mh mi ij bi translated">第一个git克隆:<a class="ae mj" href="https://github.com/Akshay090/pokedex-deploy" rel="noopener ugc nofollow" target="_blank">pokedex-在本地部署</a>。用你的共享链接替换<a class="ae mj" href="https://github.com/Akshay090/pokedex-deploy/blob/master/app/server.py" rel="noopener ugc nofollow" target="_blank"> server.py </a>中的dropbox链接。你也应该根据你的喜好改变index.html。</p><p id="a192" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">您可以在docker中运行<a class="ae mj" href="https://github.com/Akshay090/pokedex-deploy" rel="noopener ugc nofollow" target="_blank"> pokedex-deploy </a>,使用</p><pre class="mp mq mr ms gt nr ns nt nu aw nv bi"><span id="46dc" class="ku kv jf ns b gy nw nx l ny nz">docker build -t poke-image . &amp;&amp; docker run --rm -it -p 5000:5000 poke-image</span></pre><p id="32f3" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">也可以用自己喜欢的图像名称替换<code class="fe ob oc od ns b">poke-image</code>。</p><p id="96d4" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">现在我们已经准备好了docker图像，我们可以进入下一步了</p><h2 id="5a40" class="ku kv jf bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">第五步:将web应用的Docker映像推送到azure容器注册表。</h2><p id="8b9f" class="pw-post-body-paragraph lq lr jf ls b lt lu kg lv lw lx kj ly ld lz ma mb lh mc md me ll mf mg mh mi ij bi translated">首先我们需要设置azure CLI，请咨询<a class="ae mj" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest" rel="noopener ugc nofollow" target="_blank">docs.microsoft.com/en-us/cli/azure/install-azure</a>。给Windows用户的提示:-试试<a class="ae mj" href="http://chocolatey.org/" rel="noopener ugc nofollow" target="_blank"> Chocolatey </a>你可以参考<a class="ae mj" href="https://chocolatey.org/packages/azure-cli" rel="noopener ugc nofollow" target="_blank">chocolatey.org/packages/azure-cli</a>进行安装。</p><p id="7fe0" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">别忘了<code class="fe ob oc od ns b">az login</code></p><p id="d954" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated"><strong class="ls jg"> <em class="nj">现在我们将使用Azure CLI </em> </strong>创建一个私有容器注册表。容器注册表基本上是docker图像的GitHub，docker hub是一个公共容器注册表。</p><p id="865a" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">如果您需要以下步骤的更多细节，请参考<a class="ae mj" href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-azure-cli" rel="noopener ugc nofollow" target="_blank">容器-注册表-入门-azure-CLI </a></p><pre class="mp mq mr ms gt nr ns nt nu aw nv bi"><span id="b88a" class="ku kv jf ns b gy nw nx l ny nz"># create a resource group named container_registry_rg<br/>az group create - name container_registry_rg - location eastus</span><span id="9efc" class="ku kv jf ns b gy oa nx l ny nz"># create container registry named pokeRegistry<br/>az acr create --resource-group container_registry_rg --name pokeRegistry --sku Basic</span><span id="9528" class="ku kv jf ns b gy oa nx l ny nz"># Login to your container registry<br/>az acr login --name pokeregistry</span><span id="d696" class="ku kv jf ns b gy oa nx l ny nz"># tag your container registry in following format,<br/>docker tag poke-image pokeregistry.azurecr.io/poke-image:v1</span><span id="efad" class="ku kv jf ns b gy oa nx l ny nz"># Push image to container registry, it will take a while<br/>docker push pokeregistry.azurecr.io/poke-image:v1</span><span id="2ed0" class="ku kv jf ns b gy oa nx l ny nz"># You can verify if it's uploaded by <br/>az acr repository list --name pokeregistry --output table</span><span id="a243" class="ku kv jf ns b gy oa nx l ny nz"># Important Please don't forget this,important for deployment<br/>az acr update -n pokeregistry --admin-enabled true</span></pre><h2 id="025c" class="ku kv jf bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">步骤6:从azure容器注册中心在Linux容器VM中部署web应用程序。</h2><p id="f8e5" class="pw-post-body-paragraph lq lr jf ls b lt lu kg lv lw lx kj ly ld lz ma mb lh mc md me ll mf mg mh mi ij bi translated">在portal.azure.com<a class="ae mj" href="https://portal.azure.com/" rel="noopener ugc nofollow" target="_blank">去天蓝色</a>。并选择<strong class="ls jg">创建资源</strong>、<strong class="ls jg"> Web </strong>，然后选择<strong class="ls jg"> Web App for Containers </strong>或者你可以直接<a class="ae mj" href="https://portal.azure.com/#blade/Microsoft_Azure_Marketplace/MarketplaceOffersBlade/selectedMenuItemId/home/searchQuery/Web%20App%20for%20Containers" rel="noopener ugc nofollow" target="_blank">点击这个链接去那里。</a></p><p id="7ef4" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">点击create，在页面中填写详细信息并创建一个新的资源组。请<strong class="ls jg">更改</strong> <strong class="ls jg"> <em class="nj"> Sku和尺寸</em>默认选项:B1基本</strong>在开发/测试中，因为它将足以满足基本需求。不要忘记在Docker标签中将图像源设置为Azure容器注册表。</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/e50dbbfd45a247e4f312f591ec8f50b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9aU5ZWEilccTHRo2FbWTkQ.gif"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">使用容器的Web应用程序进行部署</p></figure><p id="131c" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">完成后，点击“转到资源”,您可以在<strong class="ls jg"> URL </strong>找到您的网络应用程序URL</p><p id="d668" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">恭喜你现在已经部署了你的深度学习模型🚀</p><h2 id="81cb" class="ku kv jf bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">步骤7:使用azure管道设置连续部署。</h2><p id="2e63" class="pw-post-body-paragraph lq lr jf ls b lt lu kg lv lw lx kj ly ld lz ma mb lh mc md me ll mf mg mh mi ij bi translated">现在在azure的web应用页面上，你会发现一个叫做<strong class="ls jg">部署中心的东西，</strong>这是azure中最酷的东西之一。它将帮助我们在Azure中创建CI/CD管道。</p><ul class=""><li id="18cb" class="mv mw jf ls b lt mk lw ml ld nl lh nm ll nn mi no nb nc nd bi translated">单击部署中心</li><li id="e8df" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">选择源代码位置(Github)并授权它</li><li id="e965" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">选择您的存储库</li><li id="e530" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">它会自动检测docker文件，只需点击下一步</li><li id="153d" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">创建Azure DevOps组织并选择使用容器注册表中的现有组织，单击完成</li><li id="214f" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">完成页面后，单击“在中发布管道”</li></ul><p id="a0e5" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">以上步骤可以在下面的gif中看到:</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/95f9c143358afe98ca42396b93089db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nz18C1nlhCiWwovJnIzgEw.gif"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">azure部署中心</p></figure><p id="9c00" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">现在你必须在<a class="ae mj" href="https://dev.azure.com" rel="noopener ugc nofollow" target="_blank">dev.azure.com</a>如果不去那里，在dev.azure.com<a class="ae mj" href="https://dev.azure.com" rel="noopener ugc nofollow" target="_blank">的组织内部找到你的项目</a>。</p><p id="c549" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">通过当前的设置，我们已经为我们的项目建立了CI/CD管道，这要感谢部署中心。</p><p id="dfc5" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">如果你对你的代码做了任何修改，并把它推送到GitHub，它会构建一个新的镜像，把它添加到你的容器注册表中并进行部署。</p><p id="8ad5" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">但是我们现在有两个问题需要解决</p><ul class=""><li id="e1ad" class="mv mw jf ls b lt mk lw ml ld nl lh nm ll nn mi no nb nc nd bi translated">想象一下，你不断地修改你的代码，你的容器注册表(10 GB)将被所有未使用的图片使用</li><li id="c59d" class="mv mw jf ls b lt ne lw nf ld ng lh nh ll ni mi no nb nc nd bi translated">如果您编辑您的Readme.md，它将构建一个新的映像并部署它。</li></ul><p id="cd1d" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">要解决这两个问题，请访问您在dev.azure.com<a class="ae mj" href="https://dev.azure.com" rel="noopener ugc nofollow" target="_blank">的组织内部的项目页面，并观看下面的视频。</a></p><figure class="mp mq mr ms gt is"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="a7d8" class="pw-post-body-paragraph lq lr jf ls b lt mk kg lv lw ml kj ly ld mm ma mb lh mn md me ll mo mg mh mi ij bi translated">哇哦。如果你到了这里，恭喜你🎉。如果你有任何疑问，请在评论区发表。</p></div></div>    
</body>
</html>