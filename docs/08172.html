<html>
<head>
<title>How to use APIs to get spatial features for your models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 API 获取模型的空间要素</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-apis-to-get-spatial-features-for-your-models-da729785f132?source=collection_archive---------81-----------------------#2020-06-15">https://towardsdatascience.com/how-to-use-apis-to-get-spatial-features-for-your-models-da729785f132?source=collection_archive---------81-----------------------#2020-06-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a1ca" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过使用 API 中基于位置的功能，而不是另起炉灶，快速提高数据科学模型的性能。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e60b8ccb98b2d3dd6c522459e0501a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*roNHQiF0Ay698pHYX49kIA.png"/></div></div></figure><p id="17c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我将向您展示如何使用 API 快速获取空间数据集的许多要素，以构建更好的数据科学模型。</p><p id="e1a4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我成为数据科学家的过程中，以及随后作为数据科学家的工作中，我建立了几个基于空间数据的模型，例如，预测房价，或者最近预测电动汽车充电站的预期用途。我很快发现，这些模型的性能(至少对于较小的数据集而言)并没有从模型的复杂性或广泛的参数搜索中受益，而是从良好的空间要素的可用性中受益。</p><p id="86ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我还意识到，提取这些空间特征可能相当麻烦:你需要识别和评估数据源，设置一套新的工具，如 PostGIS 数据库、OpenStreetMap 工具(如 transition、nomist 等。)，并学习许多新的东西，如地图投影、空间索引、特定查询语言等，这会大大降低您的特征提取速度。</p><p id="f79a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，还有一种更简单快捷的方法来获取您的空间要素集:使用一个处理所有这些任务的 API，这样您就不必这么做了。</p><p id="780c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你刚开始接触数据科学，或者不是来自计算机科学家教育背景的人，那么 API 一开始可能会让人望而生畏(专业术语有资源、端点、基本身份验证等。).至少对我来说是这样，这在某种程度上阻止了我使用它们。</p><p id="ec09" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是，通过学习更多关于 API 的一般知识和使用提供免费帐户的 API，您将很快熟悉使用 API，并能够将它们作为一种新的有用资源集成到您的建模工作流中。由于大多数 API 都是以类似的方式构建的(这是它们如此受欢迎的一个原因)，知道如何使用一个 API 也将有助于您理解其他 API 是如何工作的。</p><h1 id="3e5d" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated"><strong class="ak">用于空间特征的 API</strong></h1><p id="459d" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">我目前正在 features4.com<a class="ae mn" href="https://features4.com" rel="noopener ugc nofollow" target="_blank"/>(现已公开测试)构建一个新的 API，它提供了对丰富的空间特征的免费和便捷的访问，例如 500 米半径内的餐馆数量或到最近医生的距离。我将使用 Features4 API 作为如何使用 API 的例子。</p><p id="9496" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么，我们如何使用 Featurees4 API 来获取您的空间要素呢？</p><p id="b910" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">鸟瞰图</strong></p><blockquote class="mo mp mq"><p id="6029" class="ku kv mr kw b kx ky ju kz la lb jx lc ms le lf lg mt li lj lk mu lm ln lo lp im bi translated">从鸟瞰的角度来看，使用 API 很像调用一个普通的函数。您需要函数名，向它传递参数，然后返回一个结果。这与 API 基本相同(只是名称不同):你需要一个 URL，向它发送一些数据，然后得到一个响应。</p></blockquote><p id="a0a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">网址</strong></p><p id="beb1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最重要的区别是，当你的函数托管在你的计算机上时，API 托管在 web 服务器上。因此，API“函数名”将总是包含它所在的地址，通常是一个 URL(就像您在浏览器中输入以检索网站一样)。例如，features4 API 的所有 URL 都以 https://api.features4.com/v1 的<a class="ae mn" href="https://api.features4.com/v1." rel="noopener ugc nofollow" target="_blank">开始，因为这是 API 在服务器上可以到达的地方。例如<em class="mr">号</em>“功能”位于</a><a class="ae mn" href="https://api.features4.com/v1/number." rel="noopener ugc nofollow" target="_blank">https://api.features4.com/v1/number.</a></p><p id="c97d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">传递参数</strong></p><p id="1687" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦知道了 URL，就需要指定要发送给它的参数。你如何找出一个函数需要哪些参数？你只要看看它的文档就知道了。对于 API，您可以做同样的事情:为了知道 API 端点接受哪些参数，您可以查看一下<a class="ae mn" href="https://apidocs.features4.com" rel="noopener ugc nofollow" target="_blank"> API 参考</a>。在这样的参考中，您通常会找到关于参数的所有信息，包括它们的类型、描述和允许值。</p><p id="197a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我还没有提到的一点是，一般来说，API 比典型函数更加灵活。通常情况下，您可以用不同的方式发送参数值。一种常见的方法是以下面的形式传递它们(所谓的表单 urlencoded，因为您可以像这样将它们附加到 URL):</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="d184" class="na lr it mw b gy nb nc l nd ne">param1=value&amp;param2=300&amp;param4=true</span></pre><p id="829d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">指定参数的另一种常见方式是发送 JSON 编码的参数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="df14" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">JSON 的好处是它支持嵌套参数和不同的数据类型，比如字符串、数字和列表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="29b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">方法</strong></p><p id="105c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您需要向 API 提供一条信息:请求方法告诉服务器您希望服务器采取什么样的动作。这又使得 API 更加灵活，因此同一个 URL 可以服务于多个不同的响应。例如，<code class="fe nh ni nj mw b">GET</code>表示应该获取一个项目，或者<code class="fe nh ni nj mw b">POST</code>表示将数据推送到服务器(创建一个资源，或者生成一个临时文档发送回来)。</p><p id="9a28" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该方法还告诉服务器在哪里查找您传递的参数。使用<code class="fe nh ni nj mw b">GET</code>方法，您可以将参数值附加到 URL，而使用<code class="fe nh ni nj mw b">POST</code>方法，参数值将作为请求的一部分发送。</p><p id="3b0f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">与传递参数一样，API 文档将让您确切地知道服务器接受什么方法，以及它将给出什么响应。为了一致性和简单性，特性 4 API 目前只使用 POST 方法，这样所有对 API 的调用都可以用同样的方式进行。</p><p id="3e9d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">回应</strong></p><p id="f729" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">API 非常可靠。除非无法访问他们的 web 服务器，否则无论您的请求是成功还是失败，他们都会给您返回一个响应。为了让你知道是否一切顺利，或者是否出了差错，它会给你发回一个 3 位数的数字(例如 200)，即所谓的状态码。每个状态代码都有特定的含义，并且有一个具有标准化含义的状态代码的大列表。别担心，你不必把它们都背下来，或者一开始就记住这一点:</p><p id="8369" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果状态代码以下列开头:</p><ul class=""><li id="a21c" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">2 一切都好</li><li id="5d59" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">4 您可能犯了一个错误(比如遗漏了一个参数)</li><li id="c862" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">API 出错(所以，你对此无能为力)</li></ul><p id="63ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果一切正常，并且您收到了状态代码为 200 的响应，那么您还将收到您向 API 请求的数据。例如，Features4 API 将返回您所请求的空间特征，例如 500 米半径范围内的餐馆数量。响应的格式取决于 API，但您经常会收到 JSON 格式的响应，您已经通过传递参数知道了这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="d755" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您收到一个状态代码以 4 开始的响应，这意味着您这边出了问题，一个好的 API 会告诉您更多关于您所犯错误的类型，以便您能够快速修复它。例如，如果您省略了一个名为“半径”的参数，Features4 API 会告诉您哪里出错了:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="8d34" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以，这是一个关于 API 一般如何工作的非常简短的介绍。关于它和 HTTP 协议还有很多要学习的，例如,<a class="ae mn" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages" rel="noopener ugc nofollow" target="_blank"> Mozilla </a>提供了一个很好的信息来源。</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="7fa6" class="lq lr it bd ls lt of lv lw lx og lz ma jz oh ka mc kc oi kd me kf oj kg mg mh bi translated"><strong class="ak">一个具体的例子</strong></h1><p id="9843" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">让我们继续看一个具体的例子，看看如何使用<a class="ae mn" href="https://features4.com" rel="noopener ugc nofollow" target="_blank"> Features4 API </a>来检索一个位置的空间特征。我们将使用 Python 作为一种语言，但是基本上所有的语言都提供了向 API 发出请求的库。</p><p id="3b79" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">假设你正在建立一个预测房价的模型，你认为中心性将是它的一个重要方面。假设酒吧和餐馆位于城市中心，密度较高，您希望获得给定位置周围 500 米半径范围内的餐馆数量。</p><p id="0ff6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">获取访问权限</strong></p><p id="a812" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">几乎所有的 API 都要求您提供一些凭证来访问它，比如用户名和密码。特性 4 允许你在注册一个<a class="ae mn" href="https://features4.com/signup" rel="noopener ugc nofollow" target="_blank">免费账户</a>后，用一个测试用户名<code class="fe nh ni nj mw b">API_TEST_KEY</code>和没有密码或你的私有 API 密钥来试用 API(包括更多特性)。</p><p id="84f0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">获得您的第一个功能</strong></p><p id="7b58" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先要做的是在 API 参考中找出 Radius 中元素的特征号的 URL、方法和参数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/7d094d351226658d369fbb33e6066d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gPX3s2LHwmH8RnCxJjS_0w.png"/></div></div><p class="ol om gj gh gi on oo bd b be z dk translated">半径特征中元素数量的 API 参考</p></figure><p id="010e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在右上角找到网址和方法，上面说你要对<code class="fe nh ni nj mw b">/number</code>网址使用 POST 方法。点击网址将显示完整的网址<code class="fe nh ni nj mw b">https://api.features4.com/v1/number</code>。</p><p id="f22d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在文档的中心部分，您可以看到 API 为此特性采用的所有参数，它们是:</p><ul class=""><li id="b946" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated"><code class="fe nh ni nj mw b">lat</code>:所在位置的纬度</li><li id="c5ec" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><code class="fe nh ni nj mw b">lng</code>:所在地的经度</li><li id="4ea1" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><code class="fe nh ni nj mw b">element</code>:您感兴趣的地图元素(如餐厅)</li><li id="1bad" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><code class="fe nh ni nj mw b">radius</code>:该位置周围的半径，以米为单位(如 500)</li></ul><p id="7a9b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，您可以使用这个<a class="ae mn" href="https://www.latlong.net" rel="noopener ugc nofollow" target="_blank">网站</a>来获取某个位置的纬度和经度。</p><p id="6635" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦有了 URL、方法、凭证和参数，就可以使用请求库来检索特性。为了方便起见，API 参考提供了不同语言的代码示例，您只需复制和粘贴即可获得基本结构，然后您只需根据需要更改参数。因此，在示例中，只需将<code class="fe nh ni nj mw b">bar</code>替换为<code class="fe nh ni nj mw b">restaurant</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><p class="ol om gj gh gi on oo bd b be z dk translated">如何使用 python 向 Features4 API 发出请求</p></figure><p id="750f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很好:您可以看到，在某个地点(慕尼黑市中心)500 米半径范围内的餐馆数量为 153 家。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><p class="ol om gj gh gi on oo bd b be z dk translated">对 Features4 API 的请求结果</p></figure><p id="abca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">类似地，您可以检索另一个特征:到最近地图元素的距离。例如，对于房价，到最近的幼儿园的距离可能是感兴趣的。获得此功能的过程与之前相同:</p><ul class=""><li id="2f77" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">查看 API 参考中相应的<a class="ae mn" href="https://apidocs.features4.com/#operation/Distance%20to%20element" rel="noopener ugc nofollow" target="_blank">部分</a></li><li id="9a1d" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">识别这些信息:URL <code class="fe nh ni nj mw b">/distance</code>、方法<code class="fe nh ni nj mw b">POST</code>和参数<code class="fe nh ni nj mw b">lat, lng, element</code></li><li id="9529" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">提出请求</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="dc49" class="na lr it bd ls op oq dn lw or os dp ma ld ot ou mc lh ov ow me ll ox oy mg oz bi translated">结论</h2><p id="dba4" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">通过使用新的<a class="ae mn" href="https://features4.com" rel="noopener ugc nofollow" target="_blank"> Features4 API </a>，您已经了解了如何使用 API 为数据科学模型检索空间要素的一些基础知识。</p><p id="d299" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">随意探索<a class="ae mn" href="https://apidocs.features4.com" rel="noopener ugc nofollow" target="_blank"> API 参考</a>以获得更多特性，或者查看<a class="ae mn" href="https://features4.com/docs/home" rel="noopener ugc nofollow" target="_blank">文档</a>以了解哪些地图元素可用于这些特性。</p><p id="9909" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为一名数据科学家，掌握 API 知识将对你有很大帮助，因为对于许多事情，你不必重新发明轮子，而是可以使用别人已经为你做的工作。因此，利用现有的 API 将让您更快地提高工作效率。</p><p id="0e38" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我希望这篇文章能帮助你开始使用 API。</p></div></div>    
</body>
</html>