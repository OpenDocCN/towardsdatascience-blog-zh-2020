# 以下是如何在 Jupyter 笔记本中运行 SQL

> 原文：<https://towardsdatascience.com/heres-how-to-run-sql-in-jupyter-notebooks-f26eb90f3259?source=collection_archive---------0----------------------->

## Jupyter 笔记本作为 SQL IDE？

让我们面对现实——数据库无处不在。即使在学习数据科学时，您只处理过 CSV，这也很难与现实相吻合，因为大多数公司都倾向于将数据存储到数据库中。

![](img/9cd2c4cc60e7f763b0c5b1344a0784e0.png)

在今天的文章中，我想快速回顾一下将 Jupyter 笔记本或 **JupyterLab** 用作 SQL IDE 的概念。在此之前，我已经使用了各种 Python 库来连接数据库，但是这个漂亮的小技巧将为您节省大量的时间和输入。

阅读完本文后，您将能够直接通过笔记本执行任何 SQL 查询/过程，还可以将任何查询的结果存储到一个变量中，以便在以后的分析中使用。

我不想再纠缠于介绍，让我们直接进入正题吧。

# 一点设置

首先，您需要安装一个库，以确保您可以直接在笔记本上运行 SQL，因此将以下内容粘贴到任何 Jupyter 单元格中:

`!pip install ipython-sql`

在写这篇文章的时候，我正在处理 Oracle 数据库。如果你也是，确保安装了`cx_Oracle`。如果没有，就在网上快速查找所需的库。在我看来，这些应该是:

*   `pyodbc` —适用于 SQL Server
*   `mysql` —适用于 MySQL
*   `psycopg2` —用于 PostgreSQL

现在我们将使用`sqlalchemy`库来创建一个连接到数据库所需的引擎。每个连接字符串只需要这样做一次——这意味着在建立连接时不必每次都这样做。

以下是各种数据库的一些常见连接字符串:

*   **PostgreSQL** : `postgresql://scott:tiger@localhost/mydatabase`
*   **MySQL** : `mysql://scott:tiger@localhost/foo`
*   **甲骨文** : `oracle://scott:tiger@127.0.0.1:1521/sidname`
*   **SQL Server:** `mssql+pyodbc://scott:tiger@mydsn`
*   **SQLite:**

以下是 Oracle 数据库的一个示例:

![](img/d57a9f271aa086f26b92f1ed9b62e15e.png)

现在，我们可以加载先前安装的 SQL 模块:

![](img/962d6c0fe5691e0183c8bfc43637a803.png)

并使用前面指定的连接字符串连接到数据库。注意列内容是如何以百分比符号作为前缀的:

![](img/397aad4c6fbdda12b1132c3e593b44eb.png)

如果你得到了和我一样的输出，这意味着一切都很顺利，你可以继续了！

# 我们开始吧

好了，现在你可以走了。首先，我将展示如何将一个多行 SQL 查询传递给一个 Juypter 单元格。如果没有这个神奇的命令，您将不得不导入各种库，连接到数据库，用括号将查询括起来，然后执行它，但现在只是在代码前面加上`%%sql`或`%sql`的问题，我将在下面演示。

## 将整个单元格标记为 SQL 块

让我们从这个开始，因为它允许您输入多行 SQL 语句。唯一的要求是在开头加一个`%%sql`前缀。我决定从某个表中选择前五行:

![](img/15b28a98d68170215751557153e00690.png)

是的，就是这样！如果您要执行这个单元格，您将得到以下输出:

![](img/a875050479d01deb25299327bdfc6089.png)

它看起来有点像熊猫数据框，但它不是，它只是展示了桌子的样子。

## 单行语句—将结果存储到变量中

不限于多行语句，还可以将 SQL 查询的结果存储到变量中。这里你将只有一个百分号，而不是两个:`%sql`

让我们来看看实际情况——我将从一个`phone_number`列中选择一个值:

![](img/87b06f6a08ee8683d3ea3b79c8845c77.png)

您可以看到，如果我打印它，输出不是您所期望的，下面是解决这个问题的方法:

![](img/4907616fd767017ce023eef3ba4bd266.png)

这只是一个简单的索引问题，没什么可担心的。

# 你还能做什么？

到目前为止都是有趣的游戏，但是你可能想知道`ipython-sql`还能为我们提供什么。嗯，很多，我要讲两件事。这不会让你大吃一惊，但知道这一点是件好事。我们开始吧。

## 转换为熊猫数据框架

这只是`ipython-sql`的一个很好的附加功能，可以节省你一点时间，这样你就不必手动转换了。我将从数据库中选择一些数据集，然后调用它的`.DataFrame()`方法:

![](img/befe9700315138b1acdd19954129cb48.png)

我们现在可以检查数据帧及其类型，只是为了验证一切都符合预期:

![](img/7448d243fd03e863eca5c17782332873.png)

是的，数据看起来没错，类型没问题，所以我们可以继续。

## 测绘

假设您很着急，想要快速从数据库中获取一些数据，并制作一个条形图。为了演示，我将导入`matplotlib`并使一切都变大一点，然后将某个 SQL 查询的结果存储到一个变量中。

一旦完成，就可以调用`.bar()`方法来制作条形图:

![](img/cf2041c7958eeb82df99f65586ba9634.png)

相应的图应该是这样的:

![](img/d85ceec6723395fb480dd09a46bce684.png)

就绘图而言，这对于一行代码来说已经很不错了。请注意，您也可以使用`.pie()`来显示饼图——您可以自己随意寻找其他选项。

# 在你走之前

我不认为这篇文章中的任何内容会让您惊叹，但是我也希望您能够欣赏以这种格式执行数据库查询的简单性。

如果您只需要执行查询，并且不需要任何更高级的东西，这也可以是标准 SQL IDE 的一种替代方法。

无论如何，我希望你已经设法从这篇文章中得到了一些有用的东西。感谢阅读。

喜欢这篇文章吗？成为 [*中等会员*](https://medium.com/@radecicdario/membership) *继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。*

[](https://medium.com/@radecicdario/membership) [## 通过我的推荐链接加入 Medium-Dario rade ci

### 作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…

medium.com](https://medium.com/@radecicdario/membership)