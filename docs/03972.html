<html>
<head>
<title>Turning location data into geographical information</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将位置数据转化为地理信息</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/turning-location-data-into-geographical-information-2ebbc080f040?source=collection_archive---------33-----------------------#2020-04-12">https://towardsdatascience.com/turning-location-data-into-geographical-information-2ebbc080f040?source=collection_archive---------33-----------------------#2020-04-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="45e7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">纽约星巴克的位置、人口密度和家庭收入</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/04d60c6b46732ffb721de79bd7c76892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*avEPvNW5iMcFaz27"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">丹尼尔·冯·阿彭在Unsplash<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a></p></figure><h1 id="9247" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="b6e0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果你搜索“我附近的杂货店”，谷歌地图会显示附近商店的位置。谷歌地图使用位置数据在地图上显示附近的商店。这些数据可能包含其他信息，如商店详细信息、地址、电话号码，但地理位置本身是关键。位置数据的使用有很多原因-就像查找杂货店一样简单，但也可以用于更复杂的决策，例如在哪里新开一家餐馆。</p><p id="0b4f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这篇文章是对<a class="ae ky" rel="noopener" target="_blank" href="/point-pattern-analysis-of-location-data-1346f318865d">上一篇关于点模式分析的文章</a>的补充，目的是演示一些人可以用位置数据做的基本事情。没有太多复杂的分析，但我将重点关注如何在地图上显示位置数据，并解释这些数据点对于周围和潜在变量(如人口和收入)的意义。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/d488cf921d5e19c447b5c9c234306013.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*OWp7e3sBJp581OFu5TQuaA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“我附近的杂货店”的谷歌地图搜索结果</p></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="5179" class="kz la it bd lb lc na le lf lg nb li lj jz nc ka ll kc nd kd ln kf ne kg lp lq bi translated">星巴克选址:案例研究</h1><p id="fbd9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这个案例研究中，我使用的是<a class="ae ky" href="https://raw.githubusercontent.com/libjohn/mapping-with-R/master/data/All_Starbucks_Locations_in_the_US_-_Map.csv" rel="noopener ugc nofollow" target="_blank">星巴克的位置</a>数据。这些数据有点过时了，但我怀疑这些年来地点有很大变化。</p><p id="6007" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，我使用县级人口普查数据中的一些变量来理解可能与星巴克位置相关的潜在过程:</p><ul class=""><li id="3cea" class="nf ng it lt b lu mn lx mo ma nh me ni mi nj mm nk nl nm nn bi translated">家庭收入</li><li id="38f7" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated">总人口</li><li id="999b" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated">人口密度</li></ul><p id="5261" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">目的是看这些变量中的哪一个与星巴克店的位置相关(没有暗示相关性)。我们没有进行任何花哨的地质统计分析，只是在数据层上叠加数据层，并观察它们以发现是否有任何有趣的模式出现。</p><h1 id="858c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">位置与底层流程的关联</strong></h1><p id="d4fc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了映射位置数据和人口普查变量，我用r实现了这个练习。Python有很好的库来做这种工作，但是我想利用<code class="fe nt nu nv nw b">tidycensus</code>包来处理人口普查数据。首先，我们需要安装一些库。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="481d" class="ob la it nw b gy oc od l oe of"># To access census variables and polygons<br/>library(tidycensus)</span><span id="beb8" class="ob la it nw b gy og od l oe of"># To work with spatial polygons<br/>library(sf)</span><span id="af16" class="ob la it nw b gy og od l oe of"># To work with the dataframe associated with the spatial data<br/>library(tidyverse)</span><span id="f85b" class="ob la it nw b gy og od l oe of"># To make maps<br/>library(mapview)</span></pre><p id="df4e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要使用人口普查局API访问数据，您需要一个API密钥。这是一个简单的过程，只需<a class="ae ky" href="https://api.census.gov/data/key_signup.html" rel="noopener ugc nofollow" target="_blank">去人口普查局网站</a>申请一个API密匙，并把它发送到你的邮箱。一旦有了密钥，就将它加载到您的环境中。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="8f75" class="ob la it nw b gy oc od l oe of"># load API key<br/>census_api_key("YOUR API KEY")</span></pre><p id="3aa5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们可以加载星巴克的位置数据了。该数据集包含全国范围的星巴克位置，您可以过滤您感兴趣的任何州/地理位置。我在过滤纽约州。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="40b6" class="ob la it nw b gy oc od l oe of"># load data<br/>data = read_csv("<a class="ae ky" href="https://raw.githubusercontent.com/libjohn/mapping-with-R/master/data/All_Starbucks_Locations_in_the_US_-_Map.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/libjohn/mapping-with-R/master/data/All_Starbucks_Locations_in_the_US_-_Map.csv</a>")</span><span id="36e9" class="ob la it nw b gy og od l oe of"># filter Starbucks locations in New York State<br/>df = filter(data, State == "NY")</span><span id="e2fc" class="ob la it nw b gy og od l oe of"># plot the locations <br/>mapview(df, xcol = "Longitude", ycol = "Latitude", crs = 4269, grid = FALSE, legend = FALSE, alpha = 0.5, cex = 1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/3308afaca2a810a7fee32d961837722f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*FtkoMetyz3bGIvTultdFrg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">纽约的星巴克店</p></figure><p id="2411" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下一步是通过感兴趣的变量的<code class="fe nt nu nv nw b">tidycensus</code>从人口普查局导入人口普查数据。我正在获取家庭收入和人口变量。</p><p id="0287" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们先来看看纽约州的家庭收入是如何分布的。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="bf2d" class="ob la it nw b gy oc od l oe of"># get income data via `tidycensus`` <br/>income = get_acs(geography = "county", variables = "B19013_001", state = "NY", geometry = TRUE)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/40ade9d60e381d3dc7f28219baf1dcd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*X2AbcWF8fxfhOAXBZ38j5w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">纽约州各县的家庭收入分布情况</p></figure><p id="945c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">毫不奇怪，一些收入最高的家庭位于纽约市附近的县。我会放大那个区域。</p><p id="8256" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">但是让我们先得到其他变量。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="64df" class="ob la it nw b gy oc od l oe of"># get population data via `tidycensus`` <br/>pop = get_acs(geography = "county", variables = "B01003_001", state = "NY", geometry = TRUE)</span><span id="17e4" class="ob la it nw b gy og od l oe of"># add population density<br/>dens = as_Spatial(pop) # convert `sf` object (pop) to SpatialPolygonDataFrame </span><span id="2bd6" class="ob la it nw b gy og od l oe of"># add area column<br/>dens$Area_sqmile &lt;- area(dens)/2.59e+6</span><span id="73e6" class="ob la it nw b gy og od l oe of"># add population density columns<br/>dens$popdensity = dens$estimate/dens$Area_sqmile</span></pre><h1 id="454f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">绘图和解释</strong></h1><p id="287b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">首先，让我们将星巴克的位置放在收入数据的顶部，看看高收入的县是否有大量的星巴克门店。我再一次放大了纽约市的区域。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="adae" class="ob la it nw b gy oc od l oe of"># map starbucks on income<br/>mapview(income, zcol = "estimate") + <br/>  mapview(df, xcol = "Longitude", ycol = "Latitude", crs = 4269, grid = FALSE,legend = FALSE, alpha = 0.5, cex = 1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/17dcebfef2ef159256bf1e668f4c5a12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*IVdFkhPxdp7970RxdixKOQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">纽约市各县(多边形)和星巴克所在地(圆点)的家庭收入</p></figure><p id="b467" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">所以大多数星巴克店都位于曼哈顿地区。但这并不是家庭收入最高的地方，收入最高的家庭在拿骚县(黄色多边形)。我们可以推断，星巴克的门店不一定位于富人区，意味着存在一种微弱的(如果有的话)关联。</p><p id="153c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在让我们试一下总人口，看看人口多的县是否有很多星巴克店。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="e19e" class="ob la it nw b gy oc od l oe of"># map starbucks on population<br/>mapview(pop, zcol = "estimate") + <br/>  mapview(df, xcol = "Longitude", ycol = "Latitude", crs = 4269, grid = FALSE,legend = FALSE, alpha = 0.5, cex = 1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/ea51a5066894c004505d05f70f7417d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*5jHr675YmWF-dxSTOoMbgw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">纽约市各县(多边形)和星巴克所在地(圆点)周围的总人口</p></figure><p id="8d97" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">就人口而言，金斯县(黄色多边形)和皇后县是纽约市人口最多的县，但这也不是大多数星巴克店的所在地。这意味着，像收入一样，总人口似乎也是星巴克门店位置的一个弱预测因素。</p><p id="1333" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我们来看看人口密度是否有关系。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="b0d5" class="ob la it nw b gy oc od l oe of"># map starbucks on population density<br/>mapview(dens, zcol = "popdensity") + <br/>  mapview(df, xcol = "Longitude", ycol = "Latitude", crs = 4269, grid = FALSE,legend = FALSE, alpha = 0.5, cex = 1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/1b1e9855d541e7faee72162bceaf8392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*a0EWlZxUVUB-HRu275SOEQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">纽约市各县(多边形)和星巴克所在地(圆点)周围的人口密度</p></figure><p id="1879" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这就对了。</p><p id="86ab" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">人口密度最高的是曼哈顿地区，那里也是星巴克店最多的地方。因此，地理位置和人口密度之间似乎存在某种联系，这种联系强于各县的总人口或家庭收入。</p><h2 id="82e4" class="ob la it bd lb oi oj dn lf ok ol dp lj ma om on ll me oo op ln mi oq or lp os bi translated">结论</h2><p id="9713" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">从这些关联分析中，我们发现人口密度是一个更好的预测因素，可以预测附近是否有星巴克，而收入则不是一个因素。然而，作出这样的概括是相当简单的，因为还有我没有考虑的其他因素，如人口的年龄，大学生的数量，种族等等。此外，我们还可以测试这种关联在美国的其他州和地区是否成立。</p><p id="d0e7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本例中，您学习了如何绘制位置数据和使用人口普查地图。你还学会了如何提出问题，测试一个假设，甚至产生一个新的假设。在以后的文章中，我将进一步分析点数据，敬请关注。</p></div></div>    
</body>
</html>