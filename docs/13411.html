<html>
<head>
<title>Automate Data Preparation using Google Colab: Read and Process Citi Bike Data in Zip File</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Google Colab 自动准备数据:读取和处理 Zip 文件中的 Citi Bike 数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automate-data-preparation-using-google-colab-read-and-process-citi-bike-data-in-zip-file-2ab34dd33205?source=collection_archive---------49-----------------------#2020-09-14">https://towardsdatascience.com/automate-data-preparation-using-google-colab-read-and-process-citi-bike-data-in-zip-file-2ab34dd33205?source=collection_archive---------49-----------------------#2020-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/535ca6983c73c870d52a1819b45024d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ctKq2DOjk-te_k0a"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">安东尼·福明在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="a9a5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我不时会收到同事的请求，要求我处理一些大型数据文件，并从数据中报告一些统计数据。由于他们依靠<strong class="ki iu"> Excel </strong>作为主要的数据处理/分析工具，而不使用<strong class="ki iu"> Python </strong>、<strong class="ki iu"> R </strong>或<strong class="ki iu"> SQL </strong>，读取和处理超过 1048576 行的数据文件(Excel<strong class="ki iu">的行容量</strong>)成为一个问题。</p><p id="6cc4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了处理 zip 文件中的数据，通常我会下载 zip 文件，解压缩得到 CSV 文件，然后将 CSV 文件导入 SQL、R 或 Python 进行处理。得到结果后，我需要将结果输出到 CSV 文件中，并将文件发送给请求这项工作的同事。当我每个月都有新数据进来时，我必须重复这个过程，这整个过程可能会变得很麻烦。</p><h1 id="2929" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">谷歌 Colab 让自动化成为可能</strong></h1><p id="41c7" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><strong class="ki iu"> Google Colab </strong>(即 Google Colaboratory)提供了一个共享 Python 代码并在 web 浏览器中运行的平台。与非 Python 用户分享您的 Python 解决方案尤其有用。</p><p id="fc00" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里有一个 Python 程序的例子，它使用<strong class="ki iu"> Google Colab </strong>来自动准备每月<strong class="ki iu">花旗自行车</strong>的数据。该程序可以直接从 Citi Bike online 门户网站读取 zip 文件，并处理数据以报告每个日历日的 Citi Bike 行程总数。用户只需要提供他们想要处理的数据文件的 URL，并最终将结果下载/保存到他们的本地计算机。</p><h1 id="8080" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">花旗自行车数据</h1><p id="752e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">Citi Bike 网站每月都会发布用户使用数据，并维护回溯至 2013 年 6 月的历史数据。这是分析纽约大都市区微观流动趋势的良好数据源。</p><p id="ee3a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">花旗自行车数据文件中的记录数量可能非常大。例如，2020 年 8 月的数据包含超过 200 万条记录，超过了<strong class="ki iu"> Excel </strong>的行容量。</p><h1 id="5b17" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">用于处理花旗自行车数据的 Python 程序</strong></h1><p id="8b97" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">首先进入<strong class="ki iu">花旗自行车旅行数据门户</strong>并复制您想要处理的文件的<strong class="ki iu">链接地址</strong>:</p><p id="369c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://s3.amazonaws.com/tripdata/index.html" rel="noopener ugc nofollow" target="_blank">https://s3.amazonaws.com/tripdata/index.html</a></p><p id="d324" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要运行代码，你需要<strong class="ki iu">登录你的谷歌账户</strong>。一旦登录，你可以通过点击代码窗口左上角的箭头<strong class="ki iu">来运行 Python 代码。</strong></p><p id="1298" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将数据文件链接地址粘贴到<strong class="ki iu">输入框“数据 URL:”</strong>，点击“回车”。代码将从文件地址下载 zip 文件，并逐行读入数据，并将数据保存到一个<strong class="ki iu"> DataFrame </strong>中。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="5692" class="mq lf it mm b gy mr ms l mt mu">data_address = input('Data url: ')<br/>url = urllib.request.urlopen(data_address)<br/>data = []<br/>df = pd.DataFrame()<br/><strong class="mm iu">with</strong> ZipFile(BytesIO(url.read())) <strong class="mm iu">as</strong> my_zip_file:<br/>    <strong class="mm iu">for</strong> contained_file <strong class="mm iu">in</strong> my_zip_file.namelist():<br/>        <strong class="mm iu">for</strong> line <strong class="mm iu">in</strong> my_zip_file.open(contained_file).readlines():<br/>            s=str(line,'utf-8')<br/>            s = re.sub(r"\n", "", s)<br/>            s = re.sub(r"<strong class="mm iu">\"</strong>", "", s)<br/>            line_s = s.split(",")<br/>            data.append(line_s)<br/>                       <br/>df = pd.DataFrame(data)</span></pre><p id="113c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们将数据存储到一个数据框架中，事情就变得简单有趣了。原始数据中的第一行包含变量名(或列名)。使用第一行中的数据作为数据帧的列名，然后从数据帧中删除第一行。然后根据每次旅行的“开始时间”合计数据帧，以计算每个日历日的旅行次数，并将结果打印到输出控制台。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="dfb3" class="mq lf it mm b gy mr ms l mt mu">col_name = df.iloc[0].astype(str)<br/>df.columns = col_name<br/>df = df.drop([0])<br/>df['startdate']=df['starttime'].astype('datetime64[ns]').dt.date<br/>date_count = df.groupby('startdate').count()[['bikeid']]<br/>date_count.columns = ['count']<br/>print(date_count)</span></pre><p id="3bc8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦结果输出到控制台，<strong class="ki iu">通过在控制台底部的<strong class="ki iu">输入框“输出文件名:”</strong>中指定输出文件名，将结果</strong>下载到您的本地计算机。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="54c3" class="mq lf it mm b gy mr ms l mt mu">output_file_name = input('Output File Name: ')<br/>date_count.to_csv(output_file_name+'.csv') <br/>files.download(output_file_name+'.csv')</span></pre><p id="e007" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完整的代码如下:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="0e72" class="mq lf it mm b gy mr ms l mt mu"><strong class="mm iu">from</strong> <strong class="mm iu">io</strong> <strong class="mm iu">import</strong> BytesIO<br/><strong class="mm iu">from</strong> <strong class="mm iu">zipfile</strong> <strong class="mm iu">import</strong> ZipFile<br/><strong class="mm iu">import</strong> <strong class="mm iu">pandas</strong> <strong class="mm iu">as</strong> <strong class="mm iu">pd</strong><br/><strong class="mm iu">import</strong> <strong class="mm iu">urllib.request</strong><br/><strong class="mm iu">import</strong> <strong class="mm iu">re</strong><br/><strong class="mm iu">from</strong> <strong class="mm iu">google.colab</strong> <strong class="mm iu">import</strong> files<br/><br/>data_address = input('Data url: ')<br/>url = urllib.request.urlopen(data_address)<br/>data = []<br/>df = pd.DataFrame()<br/><strong class="mm iu">with</strong> ZipFile(BytesIO(url.read())) <strong class="mm iu">as</strong> my_zip_file:<br/>    <strong class="mm iu">for</strong> contained_file <strong class="mm iu">in</strong> my_zip_file.namelist():<br/>        <strong class="mm iu">for</strong> line <strong class="mm iu">in</strong> my_zip_file.open(contained_file).readlines():<br/>            s=str(line,'utf-8')<br/>            s = re.sub(r"\n", "", s)<br/>            s = re.sub(r"<strong class="mm iu">\"</strong>", "", s)<br/>            line_s = s.split(",")<br/>            data.append(line_s)<br/>                       <br/>df = pd.DataFrame(data)<br/>col_name = df.iloc[0].astype(str)<br/>df.columns = col_name<br/>df = df.drop([0])<br/>df['startdate']=df['starttime'].astype('datetime64[ns]').dt.date<br/>date_count = df.groupby('startdate').count()[['bikeid']]<br/>date_count.columns = ['count']<br/>print(date_count)<br/><br/>output_file_name = input('Output File Name: ')<br/>date_count.to_csv(output_file_name+'.csv') <br/>files.download(output_file_name+'.csv')</span></pre></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><div class="mh mi mj mk gt nc"><a href="https://huajing-shi.medium.com/membership" rel="noopener follow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">用我的推荐链接-华景石加入媒体</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">huajing-shi.medium.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq jz nc"/></div></div></a></div><p id="42a8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">链接到 Google Colab 笔记本:</p><p id="18d5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://colab.research.google.com/drive/1SpTToe6sL9OnB5-LhAPpOwGCIPe1miHw#scrollTo=kRMFFxaW30Rc" rel="noopener ugc nofollow" target="_blank">https://colab . research . Google . com/drive/1 sptto E6 sl 9 on b5-lhappowgcipe 1 mihw # scroll to = krmffxaw 30 RC</a></p><p id="dc17" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">GitHub 链接:</p><p id="905c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://github.com/shi093/CitiBike-Monthly-Report/blob/master/citiBike_dailyCount.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/Shi 093/Citi bike-Monthly-Report/blob/master/Citi bike _ daily count . ipynb</a></p></div></div>    
</body>
</html>