<html>
<head>
<title>Explore Your Activity on Youtube With R: How to Analyze and Visualize Your Personal Data History</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 R 探索你在 Youtube 上的活动:如何分析和可视化你的个人数据历史</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/explore-your-activity-on-youtube-with-r-how-to-analyze-and-visualize-your-personal-data-history-b171aca632bc?source=collection_archive---------18-----------------------#2020-09-14">https://towardsdatascience.com/explore-your-activity-on-youtube-with-r-how-to-analyze-and-visualize-your-personal-data-history-b171aca632bc?source=collection_archive---------18-----------------------#2020-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0e57" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解您如何使用您的个人数据副本使用 Youtube</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/84b567c4c11185d26592bc7c830f5637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sw8Z6e3IT4mkAqdSzNZ15w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">YouTube 上数据的分析和可视化-基于 YouTube 类别的绘图</p></figure><p id="69eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们面对现实吧，亲爱的读者，我们经常访问并成为我们生活一部分的网站之一，无论是为了娱乐还是寻找答案，在那里我们可以花上几个小时，那就是 YouTube。就像我们花费大量时间在其他事情上一样，我很好奇我们的消费习惯到底发生了怎样的变化。有了谷歌外卖和 YouTube API，分析你的个人 YouTube 历史就很容易了。</p><h1 id="d21e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">如何获得我的数据的副本？</h1><p id="da84" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">你可以通过<strong class="la iu">谷歌外卖</strong>获得你在 YouTube 上的历史记录，这是谷歌提供的一个工具，可以查询你使用过的任何产品的历史记录和存储数据。你必须输入 https://takeout.google.com/settings/takeout 的网址<a class="ae mr" href="https://takeout.google.com/settings/takeout" rel="noopener ugc nofollow" target="_blank">并用你的个人账户登录。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/50397b83106a81a371f440653b75b331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_NvenXj5xWNhfvDB8ZwbNg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图:谷歌外卖网站</p></figure><p id="6b2e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在那里，你会发现有可能要求一个完整的副本，或副产品，甚至只选择产品的一些特征。我们目前只对 YouTube 感兴趣。即使您链接了多个帐户，您也可以通过点击右上角的个人资料图片在它们之间切换。如果您上传了视频，我建议您确保取消选中它将生成的文件的视频选项，这将减少其重量和交付时间。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/5d473d0fd2a3855a0bd0e4f7664b16b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hzi_pAFgrO7dRG167E9o-w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">屏幕截图:生成 YouTube 帐户数据的副本</p></figure><p id="eb50" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">文件生成后，您将会收到一封通知电子邮件，您可以从这里下载该文件。出于安全考虑，该文件有一个截止日期，因此您必须在电子邮件中指明的日期之前完成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/6f26deded9d1228983e1946e2024e47d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rd0756Sudv5uRVDglGJ2Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图:谷歌外卖的数据复制下载通知邮件</p></figure><p id="3be0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当你下载这个文件时，你会得到一个. zip 文件，解压后会创建一个文件夹和文件的结构，这取决于你最初从 Google 外卖中请求了什么。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/0fe82fcdfcd6afcf0e40687b8960b264.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*ov9o0InbAoM4AirorMGLcA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图:解压后的文件夹结构。活力</p></figure><p id="671f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">目前，与您在 YouTube 上的搜索和观看历史相对应的生成文件仅导出为 HTML。可以使用<strong class="la iu">“rvest”</strong>包解析生成的 HTML。是的，我知道，不要评价我，《el canaca》和《dios eolo》永远是经典(墨西哥的病毒模因)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/997599c29628e242b4f6451e912dd0b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMjCdXxTDGY-fRJTFC5PoA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图:YouTube 搜索历史</p></figure><h1 id="686e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">处理导出的数据</h1><p id="9674" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">现在您可以继续创建一个 R 脚本了。首先，您必须包含所有必需的包并设置搜索历史读数，它包含在“history”文件夹中的<strong class="la iu">“search-history . html”</strong>文件中。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="2124" class="nc lv it my b gy nd ne l nf ng"># REQUIRED PACKAGES<br/>library(stringr)<br/>library(rvest) <br/>library(tidyverse) <br/>library(jsonlite) <br/>library(tidytext)<br/>library(lubridate) <br/>library(wordcloud)<br/>library(httr)<br/>library(ggplot2)<br/>library(wordcloud2)<br/>library(RCurl)<br/>library(curl)<br/>library(pbapply)<br/>library(ggthemes)</span><span id="62fe" class="nc lv it my b gy nh ne l nf ng"># READ SEARCH HISTORY<br/>youtubeSearchHistory &lt;- read_html("Takeout/YouTube and YouTube Music/history/search-history.html")</span></pre><p id="fea3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要使用<strong class="la iu"> "rvest" </strong>解析 HTML 中的文本，您可以指定对应于特定部分的 CSS 类。比如说，<strong class="la iu">这条线。标题-单元格+。content-cell &gt; a </strong>在内容中查找超链接，对应于您所做的搜索。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="dbb8" class="nc lv it my b gy nd ne l nf ng"># SCRAPING SEARCH HISTORY<br/>youtubeSearch &lt;- youtubeSearchHistory %&gt;%<br/>  html_nodes(".header-cell + .content-cell &gt; a") %&gt;%<br/>  html_text()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/ddf01ccf1717338942a8b1defe80b2da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X1y6Sr1ud8sTHhBcBV_0Hg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图:YouTube 搜索历史 HTML 元素检查器</p></figure><p id="abc4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，您可以通过同样的方式获得您需要的信息，例如时间戳。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="c880" class="nc lv it my b gy nd ne l nf ng"># SCRAPING TIMESTAMP<br/>youtubeSearchContent &lt;- youtubeSearchHistory %&gt;%<br/>  html_nodes(".header-cell + .content-cell")<br/>youtubeSearchTimeStr &lt;- str_match(youtubeSearchContent, "&lt;br&gt;(.*?)&lt;/div&gt;")[,2]<br/>youtubeSearchTime &lt;- mdy_hms(youtubeSearchTimeStr)</span></pre><p id="2dd0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在您已经有了搜索和时间戳数据，您可以用它们创建一个数据框。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="63e3" class="nc lv it my b gy nd ne l nf ng"># CREATING DATA FRAME SEARCH + TIMESTAMP<br/>youtubeSearchDataFrame &lt;- data.frame(search = youtubeSearch, <br/>                                time = youtubeSearchTime,<br/>                                stringsAsFactors = FALSE)</span></pre><h1 id="422e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">观看历史</h1><p id="45e8" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">您将在另一个名为<strong class="la iu">“watch-history . HTML”</strong>的 HTML 中找到的观看历史也包含在“历史”文件夹中。首先，您必须读取文件，并像以前一样通过 web 抓取获取每个条目。你必须用正则表达式来分析信息。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="c400" class="nc lv it my b gy nd ne l nf ng"># READ WATCH HISTORY <br/>watchHistory &lt;- read_html("Takeout/YouTube and YouTube Music/history/watch-history.html")</span><span id="a168" class="nc lv it my b gy nh ne l nf ng">watchedVideoContent &lt;-  watchHistory %&gt;%<br/>  html_nodes(".header-cell + .content-cell")</span><span id="299d" class="nc lv it my b gy nh ne l nf ng"># POSSIBLE TIME CHARACTERS<br/>watchVideoTimes &lt;- str_match(watchedVideoContent, <br/>                             "&lt;br&gt;([A-Z].*)&lt;/div&gt;")[,2]</span><span id="5322" class="nc lv it my b gy nh ne l nf ng"># POSSIBLE ID VALUES <br/>watchedVideoIDs &lt;- str_match(watchedVideoContent, <br/>                             "watch\\?v=([a-zA-Z0-9-_]*)")[,2]</span><span id="6d11" class="nc lv it my b gy nh ne l nf ng"># VIDEO TITLE<br/>watchedVideoTitles &lt;- str_match(watchedVideoContent, <br/>                                "watch\\?v=[a-zA-Z0-9-_]*\"&gt;(.*?)&lt;/a&gt;")[,2]</span></pre><p id="b8c8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，您可以将所有内容放回数据框中。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="8987" class="nc lv it my b gy nd ne l nf ng"># DATA FRAME WATCH HISTORY<br/>watchedVideosDataFrame &lt;- data.frame(id = watchedVideoIDs, <br/>                                     scrapedTitle = watchedVideoTitles, <br/>                                     scrapedTime = watchVideoTimes, <br/>                                     stringsAsFactors = FALSE)</span><span id="8903" class="nc lv it my b gy nh ne l nf ng">watchedVideosDataFrame$time &lt;- mdy_hms(watchedVideosDataFrame$scrapedTime)</span></pre><h1 id="2e7b" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">使用 YouTube API 获取更多视频数据</h1><p id="6b01" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我几乎可以肯定你会说到这一点…好吧萨乌尔，这没什么大不了的，还有什么！当您与 YouTube API 集成以获取更多数据时，这变得更加有趣。你可以获得更多的信息，而不是仅仅看到标题和时间戳这样的基本数据。通过这种方式，您可以查看您的视频浏览量的受欢迎程度、描述、类别等。</p><p id="de04" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果这是你第一次获得使用<strong class="la iu"> YouTube API </strong>的凭证，请遵循 YouTube 官方文档提供给你的简单步骤:<a class="ae mr" href="https://developers.google.com/youtube/v3/getting-started" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/youtube/v3/getting-started</a>。</p><p id="6dce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦你建立了一个谷歌项目，你将需要生成一个<strong class="la iu"> API 键</strong>并启用<strong class="la iu"> YouTube 数据 API v3 </strong>，在侧边栏菜单中创建你的凭证。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/baef8fcff774da890eb0ff85287cf61c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nQ7mzZhxXdZtk0D6oiweWg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图:Google API 控制台，设置 YouTube API</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/61d700825b31ca36d3a30554898eed75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KsU7uZTjMAQniJQSBgywlA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图:Google API 控制台，生成一个新的 API 密钥</p></figure><p id="ebd3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦完成，现在就可以通过将 API 键赋给一个新变量来使用它了。您还必须将到 youtube API 的连接赋给一个新变量。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="08cd" class="nc lv it my b gy nd ne l nf ng"># ESTABLISH API KEY AND CONNECTION<br/>youtubeAPIKey &lt;- "HERE_YOUR_API_KEY"<br/>connectionURL &lt;- '<a class="ae mr" href="https://www.googleapis.com/youtube/v3/videos'" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/youtube/v3/videos'</a></span></pre><p id="07d6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以做一个测试，比如我从我的 YouTube 频道里取一个 ID 为“SG2pDkdu5kE”的视频，给你一个概述。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="103c" class="nc lv it my b gy nd ne l nf ng"># TRYIING QUERY RESPONSE<br/>videoID &lt;- "SG2pDkdu5kE"<br/>queryParams &lt;- list()<br/>queryResponse &lt;- GET(connectionURL,<br/>                     query = list(<br/>                       key = youtubeAPIKey,<br/>                       id = videoID,<br/>                       fields = "items(id,snippet(channelId,title,categoryId))",<br/>                       part = "snippet"<br/>                     ))<br/>parsedData &lt;- content(queryResponse, "parsed")<br/>str(parsedData)</span></pre><p id="1ac0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你会发现两个重要的参数是<strong class="la iu">【字段】</strong>和<strong class="la iu">【零件】</strong>。您在查询时必须小心，因为您可能会超出请求配额，或者对请求的响应可能会变得非常慢。您可以在官方文档中找到关于这些参数的更多信息:<a class="ae mr" href="https://developers.google.com/youtube/v3/docs/videos" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/youtube/v3/docs/videos</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/f0bac1910bea6e3245c7bbd5ea3e9d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RYiab8JnwsTjGowYlTAuiA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">屏幕截图:测试查询响应</p></figure><h1 id="8d4b" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">获取视频类别:准备请求</h1><p id="4a6e" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">要获得更多像视频类别这样的元数据，您可以使用从文件中获得的视频 id，并向 YouTube 请求每个视频的更多信息。您将向 YouTube API 发出几千个请求，因此您必须为这些请求做额外的准备。</p><p id="95ea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">发出 web 请求最流行的库是<strong class="la iu">“httr”</strong>(一次只支持一个请求)。还有<strong class="la iu">【卷毛】</strong><strong class="la iu">【卷毛】</strong>。为了确保尽可能快地获得数据，请尝试这三种方法，根据已建立的查询，速度可能会有所不同。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="52cd" class="nc lv it my b gy nd ne l nf ng"># REQUESTS OPTIONS<br/>testConnection &lt;- "<a class="ae mr" href="https://www.google.com/" rel="noopener ugc nofollow" target="_blank">https://www.google.com/</a>"<br/>testCount &lt;- 100</span><span id="dbe9" class="nc lv it my b gy nh ne l nf ng"># HTTR TEST<br/>system.time(for(i in 1:testCount){ <br/>  result &lt;- GET(testConnection)<br/>})</span><span id="a1ff" class="nc lv it my b gy nh ne l nf ng"># RCURL Test<br/>uris = rep(testConnection, testCount)<br/>system.time(txt &lt;-  getURIAsynchronous(uris))</span><span id="c04f" class="nc lv it my b gy nh ne l nf ng"># CURL TEST<br/>pool &lt;- new_pool()<br/>for(i in 1:testCount){curl_fetch_multi(testConnection)}<br/>system.time(out &lt;- multi_run(pool = pool))</span></pre><p id="d429" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">至少在我的例子中，使用“curl”的速度要快得多，不像其他两个选项。</p><h1 id="2f50" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">获取视频类别:格式化请求</h1><p id="5df7" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">您需要为每个请求创建一个连接字符串，并消除重复以减少请求的数量。您还需要一个函数来解析请求-响应数据。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="6d69" class="nc lv it my b gy nd ne l nf ng"># CREATE REQUEST AND REMOVE DUPLICATES<br/>createRequest  &lt;- function(id){<br/>  paste0(connectionURL,<br/>         "?key=",youtubeAPIKey,<br/>         "&amp;id=",id,<br/>         "&amp;fields=","items(id,snippet(channelId,title,description,categoryId))",<br/>         "&amp;part=","snippet")<br/>}<br/>uniqueWatchedVideoIDs &lt;- unique(watchedVideosDataFrame$id)<br/>requests &lt;- pblapply(uniqueWatchedVideoIDs, createRequest )</span><span id="4e35" class="nc lv it my b gy nh ne l nf ng"># PARSE OUT RESPONSE<br/>getMetadataDataFrame &lt;- function(response){<br/>  rawchar &lt;- rawToChar(response$content)<br/>  parsedData &lt;- fromJSON(rawchar)<br/>  data.frame &lt;- cbind(id = parsedData$items$id, parsedData$items$snippet)<br/>  return(data.frame)<br/>}</span></pre><p id="4881" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以配置请求成功或失败时要做的事情。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="b13e" class="nc lv it my b gy nd ne l nf ng">videoMetadataDataFrame &lt;- data.frame(id = c(), <br/>                                       channelId = c(), <br/>                                       title = c(), <br/>                                       description = c(), <br/>                                       categoryId = c()<br/>                                       )</span><span id="4948" class="nc lv it my b gy nh ne l nf ng"># SUCCESS<br/>addToMetadataDataFrame &lt;- function(response){<br/>  .GlobalEnv$videoMetadataDataFrame &lt;- rbind(.GlobalEnv$videoMetadataDataFrame,getMetadataDataFrame(response))<br/>}</span><span id="5603" class="nc lv it my b gy nh ne l nf ng"># FAIL<br/>failFunction &lt;- function(request){<br/>  print("fail")<br/>}</span></pre><p id="b098" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一种方法是从内存中获取数据，并配置我们的多个请求，这种方法虽然较慢，但更可靠。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="79e4" class="nc lv it my b gy nd ne l nf ng"># GRAB REQUEST RESPONSE FROM MEMORY<br/>fetchMetadataFromMemory &lt;- function(request){<br/>  return(getMetadataDataFrame(curl_fetch_memory(request)))<br/>}</span><span id="8ad7" class="nc lv it my b gy nh ne l nf ng">system.time(out &lt;- multi_run(pool = pool)) <br/>saveRDS(videoMetadataDataFrame, file = "videoMetadataDataframeAsync1.rds")</span><span id="120d" class="nc lv it my b gy nh ne l nf ng">length(requests)<br/>nrow(videoMetadataDataFrame)</span><span id="b660" class="nc lv it my b gy nh ne l nf ng">listMetadata &lt;- pblapply(requests, fetchMetadataFromMemory)</span></pre><p id="363d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦完成，根据你的互联网连接速度和数据帧的大小，你可以准备一杯咖啡，一杯茶，或开一瓶啤酒，只要指标达到 100%就可以等待。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/cf2c48d025e1cc187df3f01918827905.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*fxzKv1tLfoBvPgI7c0basQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图:列表元数据控制台预览</p></figure><p id="da13" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您还将使用<strong class="la iu"> "bind_rows" </strong>函数将列表组合成一个有序的数据帧。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="4ac1" class="nc lv it my b gy nd ne l nf ng"># COMBINE LIST INTO A DATA FRAME<br/>videoMetadataDataFrame &lt;- bind_rows(listMetadata)<br/>saveRDS(videoMetadataDataFrame, file = "videoMetadataDataFrame_memory.rds")</span></pre><h1 id="799a" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">获取视频类别:格式化类别</h1><p id="b62f" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">每个类别都有一个唯一的 ID。您需要发出另一个请求来获取它们，并将数据添加到新的列中。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="3746" class="nc lv it my b gy nd ne l nf ng"># CATEGORY ID REQUEST<br/>categoryListURL &lt;- "<a class="ae mr" href="https://www.googleapis.com/youtube/v3/videoCategories" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/youtube/v3/videoCategories</a>"</span><span id="185d" class="nc lv it my b gy nh ne l nf ng">categoryResponse &lt;- GET(url = categoryListURL,<br/>                         query = list(<br/>                           key = youtubeAPIKey,<br/>                           regionCode = "us",<br/>                           part = "snippet"<br/>                         ))<br/>parsedCategoryResponse &lt;- content(categoryResponse, "parsed")</span><span id="607a" class="nc lv it my b gy nh ne l nf ng">categoryDataFrame &lt;- data.frame(categoryId=c(), category=c())<br/>for(item in parsedCategoryResponse$items){<br/>  categoryDataFrame &lt;&lt;-rbind(categoryDataFrame, <br/>                             data.frame(categoryId = item$id, category=item$snippet$title))<br/>}</span><span id="eff5" class="nc lv it my b gy nh ne l nf ng">categoryDataFrame<br/>videoMetadata &lt;- merge(x = videoMetadataDataFrame, y = categoryDataFrame, by = "categoryId")<br/>head(videoMetadata)</span></pre><p id="e7f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以将新的数据框与观看历史相结合，以获取视频元数据及其播放时间。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="8462" class="nc lv it my b gy nd ne l nf ng"># COMBINE WITH WATCH HISTORY<br/>watchedVideos &lt;- merge(watchedVideosDataFrame , videoMetadata, by="id")<br/>str(watchedVideos)</span></pre><h1 id="007e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">随着时间的推移，你对在 YouTube 上观看的内容的品味有所改变吗？</h1><p id="cf07" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">有了搜索历史、观看历史和类别元数据，你现在可以回答这个问题了。你可以看到你玩得最多的视频类别，以及这些类别是如何随着时间的推移而变化的。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="81cf" class="nc lv it my b gy nd ne l nf ng"># VISUALIZE VIDEO CATEGORIES WATCHED <br/>watchedVideos %&gt;% <br/>  group_by(category) %&gt;% <br/>  summarise(count = n()) %&gt;% <br/>  arrange(desc(count))</span><span id="68c3" class="nc lv it my b gy nh ne l nf ng">watchedVideos %&gt;% <br/>  ggplot(aes(x = time, fill = category)) + <br/>  labs(x= "Year", y= "Count") + <br/>  ggtitle("How much have your genre tastes changed over time?", "Most played categories")+<br/>  geom_area(stat = "bin") + <br/>  theme_economist_white()</span></pre><p id="19f6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，在我的例子中，肯定会有很多人喜欢的东西，比如音乐类的视频。当然，电影和动画类别的存在是有意义的，我通过许多渠道了解即将上映的电影、预告片和评论。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/84b567c4c11185d26592bc7c830f5637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sw8Z6e3IT4mkAqdSzNZ15w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">对 YouTube 上的数据进行分析和可视化——根据类别及其随时间变化的行为绘制图表</p></figure><h1 id="2759" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">你一天中什么时候花最多时间在 YouTube 上看视频？</h1><p id="d28b" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">把你宝贵的时间贡献给 YouTube，看看你最活跃的时候会很有趣。您可以通过创建一个自定义函数来查看它，该函数允许您将它作为一个时钟来查看。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="22ec" class="nc lv it my b gy nd ne l nf ng"># VISUALIZE CLOCK WATCHES PER HOUR<br/>clockPlot &lt;- function (x, col = heat.colors(n), ...) {<br/>  if( min(x)&lt;0 ) x &lt;- x - min(x)<br/>  if( max(x)&gt;1 ) x &lt;- x/max(x)<br/>  n &lt;- length(x)<br/>  if(is.null(names(x))) names(x) &lt;- 0:(n-1)<br/>  m &lt;- 1.05<br/>  plot(0, type = 'n', xlim = c(-m,m), ylim = c(-m,m), <br/>       axes = F, xlab = '', ylab = '', ...)<br/>  fig &lt;- pi/2 - 2*pi/200*0:200<br/>  polygon( cos(fig), sin(fig) )<br/>  f2 &lt;- .02<br/>  fig &lt;- pi/2 - 2*pi/n*0:n<br/>  segments( (1+f2)*cos(fig), (1+f2)*sin(fig), (1-f2)*cos(fig), (1-f2)*sin(fig) )<br/>  segments( cos(fig), sin(fig),0, 0, col = 'light grey', lty = 3)<br/>  f1 &lt;- -2*pi/n*(0:50)/50<br/>  for (i in 1:n) {<br/>    fig &lt;- pi/2 - 2*pi/n*(i-1)<br/>    b &lt;- pi/2 - 2*pi/n*i<br/>    polygon( c(0, x[i]*cos(fig+f1), 0), c(0, x[i]*sin(fig+f1), 0), col=col[i] )<br/>    f2 &lt;- .1<br/>    text((1+f2)*cos(fig), (1+f2)*sin(fig), names(x)[i])<br/>  }<br/>}</span><span id="d30f" class="nc lv it my b gy nh ne l nf ng">clockDataFrame &lt;- watchedVideos %&gt;% <br/>  mutate(hour = hour(time)) %&gt;% <br/>  group_by(hour) %&gt;% <br/>  summarise(count = n()) %&gt;% <br/>  arrange(hour)</span><span id="0718" class="nc lv it my b gy nh ne l nf ng">clockPlot(clockDataFrame$count, main = "What hours do you spend the most time watching YouTube?")</span></pre><p id="6ceb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">举起手来，这里有多少人像我一样，能够克服失眠有时在黎明时分花几个小时看 YouTube？在我的情况下，很明显，从凌晨 2 点到 3 点，我把我宝贵的时间都给了平台。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/08ecf5b7e16554e3670adf882b11baf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IC_-tznLjxvOQelCFlnwEw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">YouTube 上数据的分析和可视化——YouTube 上最活跃的时间图</p></figure><h1 id="4eb3" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">有哪些视频是你反复看得最多的？</h1><p id="6a9e" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">你可以获得的另一个有趣的信息是你反复播放次数最多的前 10 个视频。您可以用一个简单的表格来形象化这一点，用包<strong class="la iu">“kable extra”</strong>并按照复制次数降序排列。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="b90c" class="nc lv it my b gy nd ne l nf ng"># TABLE MOST RE-WATCHED VIDEOS<br/>w1 &lt;- watchedVideos %&gt;%<br/>  mutate(year = year(time)) %&gt;% <br/>  group_by(year, title) %&gt;% <br/>  summarise(count = n()) %&gt;% <br/>  arrange(year, desc(count)) %&gt;% <br/>  top_n(5)</span><span id="d364" class="nc lv it my b gy nh ne l nf ng">mostReWatched &lt;- knitr::kable(x = head(arrange(w1, desc(count)) %&gt;%<br/>                                      select(year, title, ,count), 10),<br/>                                      col.names = c('Year', 'Video Title', 'Count'))<br/>kable_styling(mostReWatched, "striped", position = "left", font_size = 12)</span></pre><p id="f581" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您将得到如下所示的表格。就我而言，我很好奇从 2016 年到 2019 年，一些视频没有出现在我的前 10 名中。我想原因是 Spotify 进入了我的生活，在此之前我主要使用 YouTube 来播放音乐。顺便说一下，是的，我是“Vicentico”和“Los Fabulosos Cadillacs”的粉丝(西班牙有史以来最具标志性的摇滚/ska 乐队的前歌手和乐队之一)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/8154a1ff490ece620dec2ed63c95176f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CE0HTCFwyXssmKw1mzWOsQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分析并可视化您在 YouTube 上的数据——反复观看的 10 大热门视频</p></figure><h1 id="49fa" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">YouTube 上搜索次数最多的词语是什么？</h1><p id="4fa2" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">你可以用<strong class="la iu">“word cloud”</strong>软件包更好地想象这一点。当然，这取决于你的历史有多长。例如，你可以建立至少重复 25 次的单词。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="2013" class="nc lv it my b gy nd ne l nf ng"># WORDCLOUD MOST SEARCHED WORDS<br/>myWords &lt;- youtubeSearchDataFrame %&gt;%<br/>  unnest_tokens(word, search) %&gt;%<br/>  anti_join(stop_words) %&gt;%<br/>  count(word, sort = TRUE)</span><span id="95ff" class="nc lv it my b gy nh ne l nf ng">myWordcloud &lt;- myWords %&gt;%<br/>  group_by(word) %&gt;%<br/>  summarize(count = sum(n)) %&gt;%<br/>  anti_join(stop_words)</span><span id="7ea2" class="nc lv it my b gy nh ne l nf ng">wordcloud(words = myWordcloud$word, freq = myWordcloud$count, min.freq = 25, <br/>          max.words = 100, random.order =FALSE, rot.per =.35,<br/>          colors=brewer.pal(9, "Set1"))</span></pre><p id="eda4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结果你会得到一个如下的图，在那里你会发现与你的口味相吻合。如果你想知道，答案是肯定的，我相信 UFO 现象(西班牙语 OVNI)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/8d41c00fa95a693770267d8eeb6f01b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*8qkyn5ZbNoAxvjCRheGaOA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">对你在 YouTube 上的数据进行分析和可视化——Wordcloud 搜索次数最多的词</p></figure><h1 id="1a76" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">在你看过的视频描述中，出现频率最高的术语是什么？</h1><p id="13a6" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">要回答这个问题，您可以像上一个示例一样进行操作，但是这次使用视频描述，利用我们的数据框中有这些信息这一事实。通过制作广告，很多视频在其描述中包含 URL，这是非常常见的，除了不能给我们相关信息的词，如文章、代词等，我们将过滤这些(或尽可能多的过滤)。这次我们将用<strong class="la iu">【单词云 2】</strong>和至少重复 250 次以上的单词来做。</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="de7f" class="nc lv it my b gy nd ne l nf ng"># WORDCLOUD MOST FREQUENT WORDS IN VIDEO DESCRIPTIONS<br/>descriptionsWordcloud &lt;- watchedVideos %&gt;%<br/>  unnest_tokens(word, description) %&gt;%<br/>  anti_join(stop_words) %&gt;%<br/>  count(word, sort = TRUE) %&gt;%<br/>  filter(! word %in% c("www.instagram.com", "gmail.com", "www.twitter.com", "youtu.be", "como", "instagram", "instagram.com", "tú", "watch", "aquí", "pero", "su", "http", "al","se","si","goo.gl","smarturl.it","facebook","video","más", "twitter", "te","lo","este","tu", "para", "por", "con", "es", "del", "las", "una", "mi", "de", "en", "la", "el", "los", "https", "bit.ly" , "â", "www.youtube.com")) %&gt;%<br/>  filter(n &gt; 250)</span><span id="18f1" class="nc lv it my b gy nh ne l nf ng">wordcloud2(descriptionsWordcloud)</span></pre><p id="b807" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如你所看到的，正如你所料，许多词指的是订阅他们的频道或关注他们的社交网络</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/b8becda3692ecf551e85e21dc6535a97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D78hOmySAHVgy0alVMZt8A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">对你在 YouTube 上的数据进行分析和可视化——视频描述中最常见的词</p></figure><p id="1813" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢您的友好阅读。在这里可以找到完整的代码:<a class="ae mr" href="https://github.com/cosmoduende/r-youtube-personal-history-analysis" rel="noopener ugc nofollow" target="_blank">https://github . com/cosmoduende/r-YouTube-personal-history-analysis</a></p><p id="0189" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我感谢你走了这么远，我希望你有一个快乐的分析，你可以把它付诸实践，并像我一样对结果感到惊讶和有趣！</p></div></div>    
</body>
</html>