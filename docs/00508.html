<html>
<head>
<title>Chinese Zodiac Sign Classification Challenge with Pytorch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pytorch挑战中国十二生肖分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/chinese-zodiac-sign-classification-challenge-with-pytorch-d89a8897d00b?source=collection_archive---------13-----------------------#2020-01-15">https://towardsdatascience.com/chinese-zodiac-sign-classification-challenge-with-pytorch-d89a8897d00b?source=collection_archive---------13-----------------------#2020-01-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="c72f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在贝塔斯曼AI Udacity奖学金(Bertelsmann AI Udacity Scholarship)中，学者们不仅要完成AI uda city课程，而且还要相互挑战，以应用他们在课程期间收集和实践的技能和知识。这些挑战之一是中国十二生肖分类挑战。在，你知道，中国农历新年的时候。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/109a01c21e8d599d4a84753a2d19b638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*WKUVfwUL0GyYJ1BT_W5D4A.jpeg"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated"><a class="ae la" href="https://www.farmersalmanac.com/" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="f3c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">中国的十二生肖被分为十二个年度周期，每一年都由一种特定的动物来标识。</p><p id="6750" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我认为这将是一个有趣的挑战，所以我一头扎了进去。</p><p id="a704" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于那些想尝试这个挑战的人，你可以在这里得到数据<a class="ae la" href="https://drive.google.com/file/d/1Bjope31ZX9p4jXyaYK6CazIOGcYhOjI6/view" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="52d0" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">设置环境</h1><p id="ed33" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">最重要的是。使用GPU会使任务更容易，所以我尝试使用Google Colab和Kaggle Notebook来构建这个模型。但是因为我喜欢能够编辑(添加、更改、移动或删除)我的数据，我更喜欢使用Google Colab，因为数据存储在我的Google Drive中。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ml"><img src="../Images/6a6a6881dd1b237e26349513c4ca12cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgd4u4i5W1G751bSyw0yiQ.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated"><a class="ae la" href="https://medium.com/@bhadreshpsavani/how-to-use-kaggle-dataset-on-google-colab-910164234d05" rel="noopener">来源</a></p></figure><h1 id="ca18" class="li lj it bd lk ll mq ln lo lp mr lr ls lt ms lv lw lx mt lz ma mb mu md me mf bi translated">加载并检查数据</h1><p id="eac3" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">我们有12类图像，我们希望我们的Pytorch模型进行分类。将数据分为三组是一个好主意——训练数据，用于训练我们的模型；验证和测试数据，用于确保我们的模型不会过度拟合。</p><p id="afa2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们先来看看这些数据的分布情况。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mx"><img src="../Images/dae7ed47769591112d148300369d3e27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oOCSV8hhrOlCeBWYZpQX-w.jpeg"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">十二生肖图像分布</p></figure><p id="de16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好的，所以对于每个训练，我们有600个训练图像(一个是<code class="fe my mz na nb b">goat</code>的缩写)，54个验证图像(一个是<code class="fe my mz na nb b">goat</code>的额外图像，这可能是因为一个图像放错了位置)，以及54-55个测试图像。</p><p id="0349" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我觉得不错。</p><p id="2f97" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们来看看这些图片的样本。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nc"><img src="../Images/e36b1a83618617ff58896bdfc84c1c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BEodt8MLcHfBF5GaZH_57w.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">样本图像</p></figure><p id="85c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我也觉得不错。我们还可以看到，我们正在纳入绘图图像以及(因为龙并不存在)。</p><h1 id="0738" class="li lj it bd lk ll mq ln lo lp mr lr ls lt ms lv lw lx mt lz ma mb mu md me mf bi translated">使用Pytorch创建模型</h1><p id="e30b" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">Pytorch(以及其他机器学习/深度学习框架)的一个好处是，它为我们提供了简化的样板代码。其中之一是加载列车值测试数据。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="b6e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在来建立模型。</p><p id="7e5a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将使用预训练的Resnet34模型来转移它的学习，以构建这个分类模型。我还尝试了其他预训练的模型，如Resnet101和VGG 19与BatchNorm，但Resnet34给我一个相当好的性能，所以我要用它。Resnet34要求输入图像的宽度和高度为224。</p><p id="7714" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">全模型架构如下。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="b904" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里我不会用什么很复杂的东西。只有两个额外的FC层，每个层有512个神经元，一个输出层有12个神经元(当然，每个十二星座类一个)。</p><p id="d760" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">训练模型</strong></p><p id="f090" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在是第一个令人兴奋的部分，训练模型。</p><p id="364c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们只需要迭代训练数据加载器，同时(a)对模型进行向前和向后传递，以及(b)测量模型的当前/运行性能。我选择每100个小批量做点(b)。</p><p id="3f5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我选择在7-15个时期内训练模型。你会在下面的图表中看到原因。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nd"><img src="../Images/9b37b0a62b2c648efac3c554c0ce8a97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FqTi0NkNUMZmkgFsKOeIJQ.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">训练和验证损失和精确度(Resnet50 try 1)</p></figure><p id="73e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在每100次迷你批次传递中，该模型在训练数据集上肯定会随着时间而改进。但是当我们查看验证数据集的性能时，它似乎并没有提高太多(虽然随着时间的推移，准确性似乎提高了一点点，但我认为这还不够)。</p><p id="404a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是当我们看一看具有不同架构的其他模型时，同样的事情发生了。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nd"><img src="../Images/891d2686b5f4ee7adb3f9789c56560b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DK0yDsGkMLhFPx_lLneRtQ.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">训练和验证损失和精确度(Resnet50 try 2)</p></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nd"><img src="../Images/321382c838941c437dadab580db4e11c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*37tlU7saco5XB98T-crjvQ.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">培训和验证损失和准确性(VGG协议19和批次标准)</p></figure><p id="8b64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第二个模型是Resnet50，除了我把学习率从0.001改为0.003之外，与第一个模型基本相同。三是使用VGG 19，批量常模，学习率0.001。</p><p id="bb75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">三个不同的模型+参数讲述了相同的故事——在多个历元之后，验证的准确性性能并没有像训练一样显著提高(特别是对于最后两个模型)。</p><p id="d2ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们并不太关心模型的损失，因为这是对模型表现的“自信”程度的衡量，我们更关注准确性。</p><h1 id="7ce6" class="li lj it bd lk ll mq ln lo lp mr lr ls lt ms lv lw lx mt lz ma mb mu md me mf bi translated">测试模型</h1><p id="a91a" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">让我们看看模型实际上是好的，还是满足测试数据集。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mv mw l"/></div></figure><ul class=""><li id="ae11" class="ne nf it js b jt ju jx jy kb ng kf nh kj ni kn nj nk nl nm bi translated">ResNet (lr 0.001) —损失:0.355 acc: 90.5%</li><li id="2faa" class="ne nf it js b jt nn jx no kb np kf nq kj nr kn nj nk nl nm bi translated">ResNet (lr 0.003) —损失:0.385 acc: 90.6%</li><li id="f03f" class="ne nf it js b jt nn jx no kb np kf nq kj nr kn nj nk nl nm bi translated">VGG 19批次标准—损失:0.586 acc: 90.8%</li></ul><p id="e9be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从精确度来看，它们基本相同。对于损失，具有0.001 lr的ResNet至高无上。这些数字与我们的训练和验证几乎相同，所以我们可以说我们的模型没有过度拟合(或者至少我们在它与我们的小纪元发生之前停止了它)，并且在分类中国十二生肖方面工作得相当好。</p><p id="78d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我很好奇，哪张图片的问题最大。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ns"><img src="../Images/b29fc766413a40c12743f8eeecf5009f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NEsaCfc6R0vClVl9UipZKA.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">混淆矩阵</p></figure><p id="9be2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">喜欢混乱矩阵中的数字。</p><p id="0308" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以看到，模型很少会弄错一个<code class="fe my mz na nb b">goat</code>，如果弄错了，也总是带着<code class="fe my mz na nb b">ox</code>(喇叭)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/9e707528070d9e1157ef91f2fe115654.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*nV470XTQc3o72Sid32LFKA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">被模特误认为是公牛的山羊图像</p></figure><p id="7867" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还可以看到，这个模型在区分<code class="fe my mz na nb b">dragon</code>和其他星座时有一点困难。最显著的是<code class="fe my mz na nb b">oxes </code>(角)和<code class="fe my mz na nb b">snake</code>(身体)。</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="58e4" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">最后的话</h1><p id="33eb" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">在贝塔斯曼AI Udacity奖学金期间参加中国十二生肖分类挑战赛非常棒，令人耳目一新。它推动并激励我做我热爱的事情——在人工智能/机器学习/深度学习领域进行实验和建设。</p><p id="9478" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更多的挑战会到来，我已经等不及了。</p><p id="1847" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在我的<a class="ae la" href="https://github.com/mrakelinggar/zodiac_animal_classification" rel="noopener ugc nofollow" target="_blank"> Github页面</a>查看我的笔记本。请回顾并关注:)</p></div></div>    
</body>
</html>