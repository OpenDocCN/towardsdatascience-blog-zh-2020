<html>
<head>
<title>Data Viz using Python and Tableau: from API call to Hosted Dashboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据即使用 Python 和 Tableau:从 API 调用到托管仪表板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-viz-using-python-and-tableau-from-api-call-to-hosted-dashboard-46195bc335ca?source=collection_archive---------31-----------------------#2020-08-02">https://towardsdatascience.com/data-viz-using-python-and-tableau-from-api-call-to-hosted-dashboard-46195bc335ca?source=collection_archive---------31-----------------------#2020-08-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4a40" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">互动图表是视觉叙事的关键。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/ef71d6ed5c2bb1c78baff44958f149cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qdTxtJnyGha-MzES9KxmDw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">Tableau 仪表板，我们将在本文中创建。</p></figure><p id="706b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建信息图通常在您第一次浏览数据时就开始了。<strong class="lb iu"> Matplotlib、Seaborn 和 ggplot2 </strong>是经典的编程图表，而<strong class="lb iu"> Plotly </strong>也大受欢迎。但对我来说，没有什么比得上<strong class="lb iu">画面</strong>的干净专业美感。在本文中，我们将抛开内联 Jupyter 笔记本图表，学习如何使用 Tableau Public 创建<strong class="lb iu">托管的交互式图表。</strong></p><p id="2d71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">本文由三部分组成:</strong></p><ol class=""><li id="2fee" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">研究</strong> — <strong class="lb iu">你的主题是什么，你将如何提取数据？</strong>在本文中，我们将了解<strong class="lb iu">BLS 劳工统计局的 API。</strong>我们能够使用带有参数的<strong class="lb iu"> HTTP POST 请求</strong>来检索数据，这些参数包括每个 BLS 查询的查询 id。我们需要的数据是各州的失业数据。</li><li id="fdb5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">数据清理</strong> —使用 python，我们将调用 BLS API，并使用<strong class="lb iu"> Pandas </strong>将数据清理成<strong class="lb iu">整齐的垂直格式。这可以用 Jupyter 笔记本或 Python 脚本来完成。数据将保存到 CSV 文件和 SQLite 数据库中。</strong></li><li id="b06b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> Tableau </strong> —创建一个 choropleth(地理)地图和一个树形地图，并将图表发布给 Tableau Public。我们将能够共享带有嵌入链接的图表。</li></ol><p id="a203" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以遵循我的 GitHub repo 中的查询和清理数据部分！这是一篇来自新冠肺炎疫情的失业分析的姊妹篇。</p><div class="mk ml gp gr mm mn"><a href="https://github.com/rchardptrsn/COVID-Employment-Analysis" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd iu gy z fp ms fr fs mt fu fw is bi translated">rchardptrsn/COVID-就业-分析</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">这个笔记本描述了几个查询美国劳工统计局 API 的例子，并把数据整理成一个…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">github.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb kt mn"/></div></div></a></div><h1 id="ec62" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">第 1 部分:研究和查询数据</h1><p id="534b" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated"><a class="ae mj" href="https://www.bls.gov/developers/" rel="noopener ugc nofollow" target="_blank"> Bureau of Labor Statistics API 是一个 REST API </a>，它基于惟一的查询 id 提供数据。BLS 查询 id 基于许多因素，如州和行业。要找到查询 ID，您需要浏览到<a class="ae mj" href="https://www.bls.gov/data/" rel="noopener ugc nofollow" target="_blank"> BLS 数据库、表格&amp;计算器</a>并找到与您的数据相关的类别。各州的失业情况可以在“本地失业统计——一屏搜索”中找到。您会注意到每个查询都有一个惟一的 ID。如果您可以确定模式，您可以通过编程方式生成这些 id，而不是复制和粘贴。</p><h1 id="4fbe" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">第 2 部分:查询 API 和清理数据</h1><p id="7438" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">在<a class="ae mj" href="https://github.com/rchardptrsn/COVID-Employment-Analysis" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中，有一个名为<strong class="lb iu"> blspandas.py </strong>的模块，它具有包装器函数，用于清理和执行检索数据的<strong class="lb iu"> HTTP POST 请求</strong>(<a class="ae mj" href="https://www.bd-econ.com/blsapi.html" rel="noopener ugc nofollow" target="_blank">Credit:BD Economics</a>)。下面的脚本调用这些函数来创建一个查询 id 列表，执行 HTTP 请求，并将结果保存为 pandas 数据帧。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="9e68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> blspandas.py </strong>模块的一个关键部分是<code class="fe ob oc od oe b">clean_bls_data(combined_queries)</code>函数。在我们运行<code class="fe ob oc od oe b">df = blspandas.clean_bls_data(combined_queries)</code>之前，我们的数据是这样的:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi of"><img src="../Images/4d49b8934227d47af992fc6869768f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fRycs3663QOUJSdZ-9eMgw.png"/></div></div></figure><p id="5bdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要像《T2》一样的整齐垂直格式的数据。熊猫<strong class="lb iu">融化</strong>对于这种转变来说再合适不过了。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="ae76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行<code class="fe ob oc od oe b">df = blspandas.clean_bls_data(combined_queries)</code>后，数据如下所示:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi og"><img src="../Images/2e6cb7ea68c9575307c39dd82f027e9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BReKKJwM8H9o4FWax_1zZA.png"/></div></div></figure><h2 id="5fea" class="oh nd it bd ne oi oj dn ni ok ol dp nm li om on no lm oo op nq lq oq or ns os bi translated">清理数据的目标</h2><p id="d315" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">为此，让我们思考一下我们最终需要什么。我们的目标是创建一个 choropleth 图和一个树形图，显示从 2020 年 1 月到 2020 年 6 月的失业率变化。这将描述新冠肺炎疫情对劳动力市场的影响，并显示哪些州没有反弹。</p><p id="c2bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要做的是找出每个州两个日期之间的失业率差异。我们将通过定位包含这两个日期的所有日期行，并从六月份的失业人数中减去一月份的失业人数。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="30f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">产生的<code class="fe ob oc od oe b">chg_emp</code>数据帧如下所示:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ot"><img src="../Images/94a6210ab059e9c19b34313a218ecf3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-LBCaR5jo25GdFhjFbXGdw.png"/></div></div></figure><p id="4acb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们创造画面视觉效果所需要的一切！只需通过运行以下命令将<code class="fe ob oc od oe b">chg_emp</code>数据帧写入 CSV 文件:</p><pre class="kk kl km kn gt ou oe ov ow aw ox bi"><span id="9954" class="oh nd it oe b gy oy oz l pa pb">chg_emp.to_csv('Change in unemployment by state.csv', index=False)</span></pre><h1 id="d0be" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">第三部分:画面</h1><p id="0cd2" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">此时，要么注册 Tableau Public，要么购买该软件。作为一名学生，我可以免费注册并获得完整的桌面版本。</p><h2 id="8133" class="oh nd it bd ne oi oj dn ni ok ol dp nm li om on no lm oo op nq lq oq or ns os bi translated">Choropleth 图</h2><p id="2f0e" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">通过将 CSV 文件导入工作簿来加载数据。单击新工作表，并按如下方式进行配置:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pc"><img src="../Images/b81c9d94c441f6ee294cf334f09bb5de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-HWC54W3DXSVvcMlgPFYlw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">你会注意到在“标记”下面还有其他选项来显示每个州的名称和失业情况。</p></figure><h2 id="aa72" class="oh nd it bd ne oi oj dn ni ok ol dp nm li om on no lm oo op nq lq oq or ns os bi translated">树形地图</h2><p id="0069" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">对于树形图，我们将显示相同的数据，但是以一种允许更多细节的方式，包括州名和失业率的变化。在标记下，您需要:</p><ol class=""><li id="4840" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">状态标签</li><li id="925c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">失业百分比的颜色</li><li id="bf99" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">失业百分比标签</li></ol><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pc"><img src="../Images/bf980af500f665168ee389b15ca574b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*76afASNOwQ_Xbv1xR1V89w.png"/></div></div></figure><h2 id="9465" class="oh nd it bd ne oi oj dn ni ok ol dp nm li om on no lm oo op nq lq oq or ns os bi translated"><strong class="ak">创建仪表板</strong></h2><p id="8f89" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">您可以通过单击“仪表板 1”并拖动两个工作表来创建仪表板。在这里，我将 Choropleth 排列在树状图的顶部。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/ef71d6ed5c2bb1c78baff44958f149cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qdTxtJnyGha-MzES9KxmDw.png"/></div></div></figure><h2 id="4f47" class="oh nd it bd ne oi oj dn ni ok ol dp nm li om on no lm oo op nq lq oq or ns os bi translated">推送到 Tableau Public</h2><p id="c515" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">最后，我们将把 Tableau 工作簿推送到 Tableau Public。</p><p id="69f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们需要<strong class="lb iu">提取我们的 CSV 数据源</strong>。这将允许工作簿作为单个捆绑文件上传到 Tableau Public。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pd"><img src="../Images/399d3a420d5494b97c073f47ae5b005f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h27MwuYbh5wZxwS6bzJJXQ.png"/></div></div></figure><p id="63ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦摘录完成，我们可以<strong class="lb iu">将我们的工作簿</strong>发布到 Tableau Public。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pe"><img src="../Images/75116ff5c0696888ea11a08b7ad81dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3_1gfmyWEuxVkG9LVuhTmw.png"/></div></div></figure><p id="832d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上传到 Tableau 后，它将在您的浏览器窗口中打开。此时，您只需点击右下角的“共享”按钮，将链接发送给您的朋友，即可共享您的仪表盘！点击这里查看我的<a class="ae mj" href="https://public.tableau.com/views/IncreaseinUnemploymentbyState/Dashboard?:language=en&amp;:display_count=y&amp;publish=yes&amp;:origin=viz_share_link" rel="noopener ugc nofollow" target="_blank">托管仪表板版本！</a></p><p id="c27d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">嵌入式仪表盘</strong></p><p id="e20b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您有几个选择:</p><ol class=""><li id="c5a9" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">嵌入脚本—这可以嵌入到 html 中，以提供 Tableau Public 的实时仪表板版本。这篇文章演示了如何将动态仪表盘嵌入到 WordPress 博客文章中。</li><li id="b92e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">不幸的是，您不能在中型文章中嵌入 live dashboard。</li><li id="f37c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">另一个不错的选择是<a class="ae mj" href="https://www.zuar.com/blog/embedded-analytics-how-to-embed-tableau-dashboards-into-a-web-page/" rel="noopener ugc nofollow" target="_blank">在一个简单的 python web 服务器上嵌入仪表板。</a></li></ol><p id="d516" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读，我希望您和我一样发现 python+Tableau 堆栈很有吸引力！</p></div></div>    
</body>
</html>