<html>
<head>
<title>Persistently storing and retrieving data from R Shiny Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从 R 闪亮的应用程序中持久地存储和检索数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/persistently-storing-and-retrieving-data-from-r-shiny-apps-de56b996277e?source=collection_archive---------29-----------------------#2020-05-16">https://towardsdatascience.com/persistently-storing-and-retrieving-data-from-r-shiny-apps-de56b996277e?source=collection_archive---------29-----------------------#2020-05-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8e85" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 R Shiny 中处理文件的高级指南(包括 pdf)</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5942dcb9a937b946e478d032676ab8ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5jKQYTnAOT3kJTmZ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@iammrcup?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Cup 先生/杨奇煜·巴拉</a>拍摄</p></figure><p id="64fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">我的</span> <a class="ae ky" rel="noopener" target="_blank" href="/creating-an-exam-archive-system-with-a-data-scientists-toolkit-a080d497a9a0?source=friends_link&amp;sk=510d86233ad78639bc201243db31adc1">上一篇帖子</a>引起了相当多的人的兴趣，因为<a class="ae ky" href="https://studentsofiiitbh.team/examarchive/" rel="noopener ugc nofollow" target="_blank">我的上一个 R 闪亮应用</a>的新颖和创新性质。Shiny 的这个用例几乎是闻所未闻的，因为这根本不是 R Shiny 的设计初衷。然而，由于一些个人和专业原因，我决定在 R Shiny 中承担“为我的大学考试资源创建一个集中平台”的项目，在本文中，我将分享使用 R Shiny 处理文件时可能面临的最大障碍的解决方案。</p><h1 id="ca36" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">问题:R Shiny 中的持久数据</h1><p id="3589" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">每当你在 R Shiny 应用中处理持久数据存储时，你一定会看到 Dean Attali 的文章，尤其是这篇文章。本文涵盖了各种可能的场景。然而，我还想要更多，因为它仍然不符合我的要求。</p><blockquote class="nb nc nd"><p id="7f20" class="kz la ne lb b lc ld ju le lf lg jx lh nf lj lk ll ng ln lo lp nh lr ls lt lu im bi translated">我想要的是让用户上传任意数量的文件，然后让其他用户能够下载这些文件的功能。</p></blockquote><p id="e466" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你使用 R Shiny 时，你会碰到函数<code class="fe ni nj nk nl b">fileInput()</code>和<code class="fe ni nj nk nl b">downloadHandler()</code>。这些函数只能帮助您处理临时文件(只要“会话”不变，这些文件就会保留)。为了持久地存储数据，我尝试将“临时”上传的文件导出到一个“<strong class="lb iu"><em class="ne"/></strong>”的“配置文件中，并借助“<strong class="lb iu"> <em class="ne"> rdrop2 </em> </strong>”，但这个过程非常缓慢。此外，由于我在处理 PDF 文件，连接 MongoDB 服务器或 MySQL 服务器并不是一个可行的选择。</p><h1 id="c863" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">解决方案:本地存储</h1><p id="238d" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">这整个磨难让我痛苦地明白了一件事。远程存储无法用于我的项目，而本地存储是可行的方法。</p><p id="8d3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，如果你在互联网上寻找可用的资源，你最接近实现这一点的方法就是遵循<a class="ae ky" href="https://deanattali.com/blog/shiny-persistent-data-storage/#local" rel="noopener ugc nofollow" target="_blank">迪安的例子</a>。但是，这里他只是简单地使用了函数<code class="fe ni nj nk nl b">write.csv()</code>并在函数的 path 参数中提供了本地存储路径名。这仍然让我们弄清楚如何将 PDF 文件“写入”到本地存储中的特定位置(www 文件夹)。</p><p id="5384" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在网上搜索处理 pdf 的 R 包，偶然发现了包“<a class="ae ky" href="https://cran.r-project.org/web/packages/pdftools/pdftools.pdf" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="ne">pdf tools</em></strong></a>”和<strong class="lb iu"><em class="ne"/></strong><a class="ae ky" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=2&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwjP9rfCirfpAhWhyDgGHVR-BMQQFjABegQIBBAB&amp;url=https%3A%2F%2Fcran.r-project.org%2Fweb%2Fpackages%2Fqpdf%2Fqpdf.pdf&amp;usg=AOvVaw261vHa3S4ICgNTl2-eiSwi" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="ne">qpdf</em></strong></a><strong class="lb iu"><em class="ne"/></strong>。因为“qpdf”是“<strong class="lb iu"> <em class="ne"> pdftools </em> </strong>”包的一个要求，所以我决定只安装“<strong class="lb iu"> <em class="ne"> pdftools </em> </strong>”包。不幸的是，这个函数也没有为我们提供在给定的文件路径上“写 PDF”的功能。提供的功能“<strong class="lb iu"><em class="ne">【pdf tools】</em></strong>如下。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/8c421e10d1399d034388705f1c28e649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8QjG9-u0Isnv98Pnb9jwhw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“pdf tools”R 软件包的描述</p></figure><p id="cbc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"><em class="ne">【qpdf】</em></strong>包提供的功能如下。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/7cb4d28305ed9946dea53c46b7a4afa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sFCASebz5zHzIefd6uBakw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“qpdf”R 包的描述</p></figure><p id="bb7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这些函数中，引起我注意的是函数<code class="fe ni nj nk nl b">pdf_subset()</code>，因为它有一个名为<strong class="lb iu"> <em class="ne">输出</em> </strong>的参数。因此，这可能意味着通过输出参数将特定 PDF 文件的子集存储在指定的文件路径中。“<strong class="lb iu"> <em class="ne">页面</em> </strong>”参数是使用上述<code class="fe ni nj nk nl b">pdf_info()</code>函数(<code class="fe ni nj nk nl b">pdf_info$pages</code>更具体)指定的。</p><p id="e194" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊。！！我的这个小实验成功了，我获得了我想要的功能。下面是我实际部署的应用程序的代码片段，突出了我如何在我的应用程序中管理上传部分<a class="ae ky" href="https://studentsofiiitbh.team/examarchive/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="e5ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://gist.github.com/hinduBale/5356a228372b3ec8fe08ea04c1802b71" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/Hindu bale/5356 a 228372 B3 EC 8 Fe 08 ea 04 c 1802 b 71</a></p><pre class="kj kk kl km gt no nl np nq aw nr bi"><span id="8a15" class="ns mf it nl b gy nt nu l nv nw">output$upload_questionSet_button &lt;- renderUI({                           validate(                             <br/>need(input$display_name_ques != "", "Please enter the display name of the uploader")                           <br/> )                           <br/>fileInput( inputId = "multi_sol_id",                                      label = "Please upload the question set available with you :) (PDFs only)",                                                       multiple = TRUE,                                                accept = c(".pdf"),                                        buttonLabel = "Upload Papers")       <br/>})  <br/>                                                observeEvent(input$multi_sol_id, {                           fileName_set &lt;- sprintf("www/%s/questionSet_%s_%s.pdf", input$sem_select_mul,input$exam_select_mul, input$display_name_ques)                           pages_set &lt;- pdf_info(input$multi_sol_id$datapath)$pages                           pdf_subset(input$multi_sol_id$datapath, <br/>           pages = 1:pages_set, <br/>           output = fileName_set)<br/>})</span></pre><p id="c6d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在文件被成功上传后，我需要一种方法来使用 R Shiny 从我的本地存储中下载资源。为此，我四处寻找，阅读官方文件，但毫无结果。在鼓捣了所有可用的选项并如饥似渴地阅读了互联网上的相关资料后，我从<a class="ae ky" href="https://stackoverflow.com/questions/33416557/r-shiny-download-existing-file?noredirect=1&amp;lq=1" rel="noopener ugc nofollow" target="_blank">这个堆栈溢出答案</a>中得到了一点提示。因此，我使用了<code class="fe ni nj nk nl b">file.copy()</code>函数，并将“<strong class="lb iu"> <em class="ne">文件名</em> </strong>”和“<strong class="lb iu"> <em class="ne">内容</em> </strong>”参数转换为函数来完成我的任务。</p><p id="a714" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我实际部署的应用程序<a class="ae ky" href="https://studentsofiiitbh.team/examarchive/" rel="noopener ugc nofollow" target="_blank">的代码片段，展示了我如何处理应用程序的下载部分。</a></p><p id="1feb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://gist.github.com/hinduBale/eddf858962865f43f4ac152116dc84e3" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/Hindu bale/eddf 858962865 f 43 F4 AC 152116 DC 84 e 3</a></p><pre class="kj kk kl km gt no nl np nq aw nr bi"><span id="0f88" class="ns mf it nl b gy nt nu l nv nw">output$download_single_qp_button &lt;- renderUI({<br/>    downloadBttn(<br/>      outputId = "qp_down_sin", <br/>      label = "Download Question Paper :)", <br/>      style = "float", <br/>      color = "warning", <br/>      size = "lg", <br/>      no_outline = FALSE)                <br/>  })<br/>  <br/>  output$qp_down_sin &lt;- downloadHandler(<br/>    filename &lt;- function(){<br/>      search_ques_fileName &lt;- sprintf("www/%s/%s",<br/>                                      input$sem_select_solution,<br/>                                      input$avail_paper)<br/>      return (search_ques_fileName)<br/>    },<br/>    content &lt;- function(file) {<br/>      file.copy(filename(), file)<br/>    },<br/>    contentType = "application/pdf"<br/>  )</span></pre><h1 id="81e1" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">结论:</h1><p id="c937" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">因此，我们实际上已经能够完成我们计划要做的事情。当你解决一个问题时，它确实是令人兴奋的，不是吗！！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/407759ef20651f4dd8622cffeaf05b73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*G8krcFRYtcfnJr9g"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">布鲁克·卡吉尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="e199" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我解决这个问题的时候，我真的很想打我的屏幕很多次，因此我写了这篇文章，这样它可以挽救一个宝贵的生命，或者至少是一个宝贵的显示器😜</p><p id="cb8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里需要注意的一点是，在编写本文时，https://www.shinyapps.io/的<a class="ae ky" href="https://www.shinyapps.io/" rel="noopener ugc nofollow" target="_blank"/>没有提供本地存储的功能(至少在他们的空闲层中没有)。所以，如果你想获得本地存储的好处，你必须在你选择的云服务提供商上建立你自己的 R 服务器。</p><p id="8a30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你也可以请我喝杯咖啡来支持我的工作。</p><p id="a76c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢谢你，祝你成功。</p></div></div>    
</body>
</html>