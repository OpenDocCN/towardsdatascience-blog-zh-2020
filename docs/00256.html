<html>
<head>
<title>Spatial Autocorrelation: Neighbors Affecting Neighbors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">空间自相关:邻居影响邻居</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/spatial-autocorrelation-neighbors-affecting-neighbors-ed4fab8a4aac?source=collection_archive---------22-----------------------#2020-01-08">https://towardsdatascience.com/spatial-autocorrelation-neighbors-affecting-neighbors-ed4fab8a4aac?source=collection_archive---------22-----------------------#2020-01-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a434" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解值和事件的空间聚类</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a514b011d33b903e4bc2fc512bb80f91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3NT_pexUYM6HueYr"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安德鲁·斯图特斯曼在 Unsplash<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">上的照片</a></p></figure><p id="c1ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文的目的是介绍地理空间分析中的一个重要概念——“空间自相关”，重点介绍以下内容:(1)自相关的关键概念；(二)行业应用和(三)在<code class="fe lv lw lx ly b">R</code>中的实施</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><blockquote class="mg mh mi"><p id="5bd6" class="kz la mj lb b lc ld ju le lf lg jx lh mk lj lk ll ml ln lo lp mm lr ls lt lu im bi translated">“一切都与其他一切相关。但是近处的东西比远处的东西更有联系”。<a class="ae ky" href="https://en.wikipedia.org/wiki/Tobler%27s_first_law_of_geography" rel="noopener ugc nofollow" target="_blank">瓦尔多·托布勒(1969)的地理第一定律</a></p></blockquote><p id="56b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了理解上面的托布勒定律，我们来做一个思维实验。</p><p id="183d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从诸如<a class="ae ky" href="https://www.zillow.com/" rel="noopener ugc nofollow" target="_blank"> Zillow </a>的列表网站中随机挑选一所房子，假设该房子的列表价格为 40 万美元。接下来说，旁边的房子也挂牌出售。现在，如果你要预测第二套房子的价格，给你两个选择，45 万美元和 120 万美元，你会选哪个？</p><p id="2c6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你选择了 45 万美元，那么你已经潜意识地知道什么是空间自相关。确实是两个邻居在一些共同特征上的相关性(比如房价)。“Auto”表示自我，“correlation”表示关联。因此，用一种更正式的说法来说，自相关是相邻观测值之间相似性的一种度量，它描述了在给定的空间尺度上某个变量(如人口密度)的观测值彼此相似的程度。或者简单地说，“莫兰 I 统计量是一个变量(比如收入)与其周围值之间关系的相关系数”(<a class="ae ky" href="https://mgimond.github.io/Spatial/spatial-autocorrelation.html" rel="noopener ugc nofollow" target="_blank">来源</a>)。</p><blockquote class="mg mh mi"><p id="4cda" class="kz la mj lb b lc ld ju le lf lg jx lh mk lj lk ll ml ln lo lp mm lr ls lt lu im bi translated">请注意，有一个类似的概念称为时间自相关，其中观察(例如，身高，体重等。)与前一时间点的观察值相关。这种时间自相关在<a class="ae ky" rel="noopener" target="_blank" href="/time-series-forecasting-from-naive-to-arima-and-beyond-ef133c485f94">时间序列预测</a>中是一个有用的概念。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/2ac54159456319ddb3fc57e1643a62a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*ZG0IuzIkXiOTx903doTUmw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在这些图中，几何图形在两个方面不同:形状和颜色。左边的块的位置是可预测的，因为相似的东西彼此邻近，因此空间自相关，而右边的形状是不可预测的，因为它们或多或少是随机分布的。</p></figure><h2 id="03a7" class="mo mp it bd mq mr ms dn mt mu mv dp mw li mx my mz lm na nb nc lq nd ne nf ng bi translated"><strong class="ak"> <em class="nh">如何量化自相关(The Moran's I) </em> </strong></h2><p id="c51a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">只需查看地图，我们就能对某些要素的空间自相关有所预感。然而，有一个正式的方法来定量测量它，莫兰的 I T8 就是一个用于这个目的的统计量。它取-1 和+1 之间的值(如正态相关系数，<em class="mj"> r，</em> would)，同时提供相关的<em class="mj">p</em>-值作为显著性测试(下面讨论)。正的 Moran's I 表示相似的观察值彼此更接近，而负值表示不相似的值聚集在一起。0 左右的值表示没有自相关，相反，观察值是随机分布的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/df984f91c9d8d9f7da2b5f522bfa5d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*DKH_UkvG-fyIu0WV1eFJMQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">i <em class="nh"> ncome </em>与 i <em class="nh"> ncome 的滞后散点图。回归线的</em>斜率代表莫兰 I 统计量。(<a class="ae ky" href="https://mgimond.github.io/Spatial/spatial-autocorrelation.html" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></figure><h2 id="adae" class="mo mp it bd mq mr ms dn mt mu mv dp mw li mx my mz lm na nb nc lq nd ne nf ng bi translated"><strong class="ak">衡量莫兰 I(蒙特卡罗模拟)的显著性</strong></h2><p id="5b4d" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">一旦对特定数据集测量了莫兰的 I，在观测值随机分布的零假设下，如何知道它是否显著？</p><p id="a47a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">测量显著性的一种方法是执行蒙特卡罗测试。该过程分三步完成:(I)首先，观察值(如房价)随机分布在不同的空间单位(如县多边形、栅格像元等)，(ii)然后，计算该随机数据集的莫兰氏 I，(iii)最后，将模拟的莫兰氏 I 与观察到的莫兰氏 I 进行比较。这三步过程重复多次。运行所有模拟后，概率<em class="mj"> p </em>计算如下:</p><p id="ae90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">((大于观察到的莫兰 I +1 的模拟莫兰 I 的数量)/(模拟 ran + 1 的数量)</p><p id="d51c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">比如说，</p><p id="4788" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b"><em class="mj">number of simulations = 200</em></code></p><p id="5cc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b"><em class="mj">number of simulated Moran's I that are higher than observed value = 2</em></code></p><p id="dc7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mj">然后根据上面的等式，零假设为真的概率:</em></p><p id="76c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b"><em class="mj">p = (1+1)/(200+1) = 0.009</em></code></p><p id="3353" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<em class="mj"> p &lt; 0.01 </em>因此，可以拒绝观测值(如人口、房价)在空间上随机分布的零假设。换句话说，观察到的房价自相关性非常显著。</p><h2 id="51fb" class="mo mp it bd mq mr ms dn mt mu mv dp mw li mx my mz lm na nb nc lq nd ne nf ng bi translated"><strong class="ak">自相关的行业应用</strong></h2><p id="4765" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">自相关是空间分析中的一个关键概念，具有广泛的行业应用。其中一些如下:</p><ul class=""><li id="bb4d" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated"><strong class="lb iu">空间不平等/多样性的衡量标准</strong>:收入、人口、种族等。聚集或均匀分布在某些区域—可以使用 Moran 的 I。</li><li id="a137" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">它已经被用于识别伦敦城市土壤中稀土元素的污染热点</li><li id="267a" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">已用于演示感兴趣的变量的不同<a class="ae ky" href="https://link.springer.com/chapter/10.1007/978-3-642-01976-0_10" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">距离衰减函数</strong> </a> <strong class="lb iu"> </strong>(例如，房价作为距市中心距离的函数下降多远？).</li><li id="a011" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">自相关经常用于许多其他机器学习算法(例如空间回归、分类、聚类分析)以及作为 EDA 一部分的空间数据可视化(例如热图、热点分析)</li></ul></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="6f00" class="oc mp it bd mq od oe of mt og oh oi mw jz oj ka mz kc ok kd nc kf ol kg nf om bi translated">R 中的 5 步实现</h1><p id="33fb" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated"><em class="mj">步骤 1:安装依赖关系</em></p><pre class="kj kk kl km gt on ly oo op aw oq bi"><span id="2271" class="mo mp it ly b gy or os l ot ou">library(sf)<br/>library(spdep)<br/>library(tigris)<br/>library(acs)<br/>library(tidyverse)<br/>library(tmap)</span></pre><p id="a80d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mj">第二步:获取数据</em></p><p id="8251" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在这个演示中使用的数据是从<a class="ae ky" href="https://www.census.gov/data/developers/data-sets/acs-1year.html" rel="noopener ugc nofollow" target="_blank">美国社区调查</a>中检索的县/人口普查区级别的家庭收入中值数据集。要访问数据，用户必须发出一个针对 API 密钥的<a class="ae ky" href="https://api.census.gov/data/key_signup.html" rel="noopener ugc nofollow" target="_blank">请求。在我的情况下，一旦提出要求，处理速度相当快。</a></p><pre class="kj kk kl km gt on ly oo op aw oq bi"><span id="e818" class="mo mp it ly b gy or os l ot ou">api="MY API KEY"<br/>api.key.install(key=api)<br/>acs.tables.install()</span><span id="6e76" class="mo mp it ly b gy ov os l ot ou">set.seed(1234) # because we are randomizing part of the process</span><span id="591d" class="mo mp it ly b gy ov os l ot ou"># Access the shapefile<br/>s &lt;- get_acs(geography = "tract", variables = "B19013_001", <br/>                state = c("VA"), geometry = TRUE)<br/># remove NA values is any<br/>s &lt;- na.omit(s)</span><span id="bb61" class="mo mp it ly b gy ov os l ot ou"># select column to work with<br/>s &lt;- subset(s, select=c("estimate"))</span></pre><p id="6a23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mj">第三步:探索性数据分析</em></p><pre class="kj kk kl km gt on ly oo op aw oq bi"><span id="f546" class="mo mp it ly b gy or os l ot ou"># check data skewness<br/>hist(s$estimate, main=NULL)</span><span id="d65c" class="mo mp it ly b gy ov os l ot ou"># check for outliers<br/>boxplot(s$estimate, horizontal = TRUE)</span><span id="1acb" class="mo mp it ly b gy ov os l ot ou"># plot variable<br/>tm_shape(s) + tm_fill(col="estimate", style="quantile", n=5, palette="Greens") +<br/>tm_legend(outside=TRUE)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/a0557aad061bc96eafb91b62ca1705c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*cT16fw3HIw0sBmXfznJ0nw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我感兴趣的变量不完全是我需要的形状，因为似乎有一些异常值。但是这应该适用于这个演示。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/0246e36ebf1f723638062bf99db3baec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*hfe2Mlm79I4zxeikQpgmkA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这显示了弗吉尼亚州人口普查区的家庭收入中位数的分布情况。收入差异非常明显，可以直观地识别出来。应该有很高的自相关性，但是我们会看到的！</p></figure><p id="5834" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mj">第四步:建模</em></p><pre class="kj kk kl km gt on ly oo op aw oq bi"><span id="d4fa" class="mo mp it ly b gy or os l ot ou"># define neighbor<br/>nb &lt;- poly2nb(s, queen=TRUE) # here nb list all ID numbers of neighbors;</span><span id="17e1" class="mo mp it ly b gy ov os l ot ou"># assign weights to neighbors<br/>lw &lt;- nb2listw(nb, style="W", zero.policy=TRUE) # equal weights</span><span id="2391" class="mo mp it ly b gy ov os l ot ou"># compute neighbor average<br/>inc.lag &lt;- lag.listw(lw, s$estimate)</span><span id="27d2" class="mo mp it ly b gy ov os l ot ou"># plot polygons vs lags<br/>plot(inc.lag ~ s$estimate, pch=16, asp=1)<br/>M1 &lt;- lm(inc.lag ~ s$estimate)<br/>abline(M1, col="blue")</span><span id="7d3f" class="mo mp it ly b gy ov os l ot ou"># access Moran's coeff<br/>coef(M1)[2]</span><span id="400c" class="mo mp it ly b gy ov os l ot ou"># calculating Moran coeff with one line<br/>I &lt;- moran(s$estimate, lw, length(nb), Szero(lw))[1]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/040490874dadd8b6d17cdd91e849b497.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*EVeONsJ5_qM_QIMnJaa1JQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这只是一个有空间滞后的家庭收入散点图</p></figure><p id="6722" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mj">第五步:假设检验</em></p><pre class="kj kk kl km gt on ly oo op aw oq bi"><span id="ae0c" class="mo mp it ly b gy or os l ot ou"># hypothesis test with moran.test function<br/>moran.test(s$estimate,lw, alternative="greater")</span><span id="ad0c" class="mo mp it ly b gy ov os l ot ou"># using Monte-Carlo simulation<br/>MC&lt;- moran.mc(s$estimate, lw, nsim=999, alternative="greater")</span><span id="ec34" class="mo mp it ly b gy ov os l ot ou"># View results (including p-value)<br/>MC</span><span id="cc11" class="mo mp it ly b gy ov os l ot ou"># plot Null distribution<br/>plot(MC)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/d5a5c4b27266fcc43d015db55f93f57a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*L_G4krIKNtdhWHR3878uQQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">正如所料，莫兰的 I 统计值(0.72)相当高，表明弗吉尼亚州中等家庭收入的空间自相关性显著(见 p 值)</p></figure><h2 id="42e1" class="mo mp it bd mq mr ms dn mt mu mv dp mw li mx my mz lm na nb nc lq nd ne nf ng bi translated"><strong class="ak">结束注释</strong></h2><p id="35d7" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">了解空间自相关是空间数据分析中的一个重要概念-不仅用于了解数据的空间模式和变化，还用于业务决策。它也是为高级空间显式统计和机器学习算法提供输入的关键统计数据。就实现而言，一旦有了数据，实现起来就相当容易了。我在<code class="fe lv lw lx ly b">R</code>环境中实现，但是也有一些<code class="fe lv lw lx ly b">Python</code>库(例如<code class="fe lv lw lx ly b">geopandas</code>)，然而，在我的经验中，R 更加用户友好，因为使用现有的包可以方便地访问县/人口普查区域规模的数据集。</p></div></div>    
</body>
</html>