# 如何计算 Keras 模型中的参数个数

> 原文：<https://towardsdatascience.com/how-to-calculate-the-number-of-parameters-in-keras-models-710683dae0ca?source=collection_archive---------8----------------------->

## 了解您的顺序 Keras 模型的摘要

![](img/ab6bfe1f50e75f9ca9fbbe12bf187ae3.png)

照片由[戈登·威廉姆斯](https://unsplash.com/@artifactflash?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

# 介绍

尽管新的 ML 框架正在出现，keras 模型仍然是许多数据科学家的最爱。对于新的学习者来说，他们可能有的一个主要问题是通过遵循特定的教程来理解他们正在构建的模型。为了将我们的讨论放在一个环境中，让我们假设我们正在使用 MNIST 数据集构建一个 Conv2D 模型。以下代码向您展示了 Python 代码。

Keras Conv2D 模型

*   如果你不熟悉 MNIST 数据集，它是由 0-9 位数字组成的图像集合。这些图像是灰度级的，因此每个图像可以用 28×28×1 的输入形状来表示，如第 5 行所示。
*   请注意，本文的目的不是向您介绍卷积网络的工作原理，因此对这些主题的覆盖范围将是最小的。正如你所见，我们的模型包括一个堆栈的 2D 卷积网络层和最大池层。
*   在模型的末尾，我们创建了一个密集层，最后输出 10 个激活了 softmax 的节点。节点数对应于模型预测的位数。
*   `summary()`函数将为模型创建一个摘要，这是本文的重点。

## 模型摘要

下图显示了`summary()`函数的输出。每一行代表一个层，每个层都有唯一的名称，这样我们可以毫无歧义地引用这些层。正如您所看到的，我们在前面的代码片段中添加到模型中的层都包含在下图中。

模型摘要

*   每个层都有一个输出，其形状显示在“输出形状”列中。每一层的输出成为下一层的输入。
*   “Param #”列显示了为每层训练的参数数量。
*   参数总数显示在最后，等于可训练和不可训练参数的数量。在这个模型中，所有的层都是可训练的。为了不使文章复杂化，我们不打算操纵某些层的可训练性。出于好奇，在 Keras 中，我们可以选择不训练特定的层，这样做的话，一定数量的参数将不可训练。

# 参数计算

## **MaxPooling2D 层**

先说简单的。您可以注意到，所有 MaxPooling2D 层的参数数量都是 0。原因是这一层什么都不学。它的作用是降低模型的复杂性，并通过找到每个 2×2 池的最大值来提取局部特征。

如前所述，MaxPooling2D 层使用前一层的输出。因此，`max_pooling2d`层的输入具有从`conv2d`层输出的(26，26，32)形状。最大池应用于形状为(26，26)的每个过滤器(n=32)。在模型中，对于`max_pooling2d`层，池的大小是 2×2，因此数据的形状将变成(13，13)，也就是(26 / 2，26 / 2)。

同样，对于第二个 MaxPooling2D 层(即`max_pooling2d_1`)，输入形状为(11，11，64)。通过应用 2 x 2 池，产生的输出形状变为(5，5，64)，如“输出形状”列所示。

## Conv2D 层

在我们的模型中，我们有三个 Conv2D 层，这些层的参数计算遵循相同的原则，如下式所示。数字 1 表示与我们正在学习的每个滤波器相关的偏差。

```
param_number = output_channel_number * (input_channel_number * kernel_height * kernel_width + 1)
```

将此公式应用于第一个 Conv2D 层(即`conv2d`，我们可以用 32 * (1 * 3 * 3 + 1) = 320 计算出参数个数，与模型总结一致。输入通道号是 1，因为输入数据形状是 28 x 28 x 1，数字 1 是输入通道。

对于第二个 Conv2D 层(即`conv2d_1`)，我们有如下计算:64 * (32 * 3 * 3 + 1) = 18496，与该层的模型摘要中显示的数字一致。这里需要注意的两件事是，输出通道号是 64，如模型构建中所指定的，输入通道号是来自先前 MaxPooling2D 层的 32(即`max_pooling2d`)。

以类似的方式，我们可以计算第三 Conv2D 层的参数数量(即`conv2d_2` ): 64 * (64 * 3 * 3 + 1) = 36928，与模型摘要一致。

## 展平图层

展平的层不学习任何东西，因此参数的数量是 0。然而，知道如何确定输出是很有趣的。如你所见，`flatten`层的输入具有(3，3，64)的形状。展平层只是展平输入数据，因此输出形状是通过使用 3 * 3 * 64(即 576，与`flatten`层的输出形状中显示的数字一致)连接所有现有参数来使用它们。

## 致密层

我们的模型中有两个密集层。参数数值的计算使用以下公式。

```
param_number = output_channel_number * (input_channel_number + 1)
```

应用这个公式，我们可以计算致密层的参数数目。对于第一密集层(即`dense`)，输入通道数是 576，而输出通道数是 64，因此参数数是 64 * (576 + 1) = 36928。

对于第二密集层(即`dense_1`)，输入和输出通道数分别为 64 和 10。因此，参数的数量是 10 * (64 + 1) = 650，与模型摘要中显示的数量一致。

# 结论

在本文中，我们回顾了如何理解 Keras 模型中的参数数量。具体来说，我们使用 Conv2D 模型进行演示。虽然您的模型可能不同，但计算参数数量的原则是相同的-公式应该连接输入和输出数据，并定位模型的定型位置。