<html>
<head>
<title>Python for Finance — Stock Price Trend Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向金融的Python股票价格趋势分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-python-for-finance-stock-price-trend-analysis-9111afc29259?source=collection_archive---------7-----------------------#2020-02-25">https://towardsdatascience.com/python-python-for-finance-stock-price-trend-analysis-9111afc29259?source=collection_archive---------7-----------------------#2020-02-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ff14" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建一个强大的Python工具来执行股票价格趋势分析</h2></div><p id="5d7b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将构建一个非常强大的Python工具来执行<strong class="kh ir">股票价格趋势分析</strong>。一旦脚本准备就绪，Python将为我们生成下图，显示不同股票随时间的价格趋势。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/0fc7e81998b55c922a1f06002a0876a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*lEEv9vhw5SYs1drlWnMuUA.png"/></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">用于金融股票价格分析的Python</p></figure><p id="572a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个用于金融分析的很酷的<strong class="kh ir">Python</strong>脚本将股票列表作为输入，然后它将:</p><ul class=""><li id="51bd" class="ln lo iq kh b ki kj kl km ko lp ks lq kw lr la ls lt lu lv bi translated"><strong class="kh ir">下载每家所需公司近年来的每日股票价格</strong>。</li><li id="5c28" class="ln lo iq kh b ki lw kl lx ko ly ks lz kw ma la ls lt lu lv bi translated">将所有股票价格合并到一个单一的熊猫数据框架中。</li><li id="811e" class="ln lo iq kh b ki lw kl lx ko ly ks lz kw ma la ls lt lu lv bi translated">以基准日期(即我们获得数据的第一天)的百分比显示结果。</li><li id="84fc" class="ln lo iq kh b ki lw kl lx ko ly ks lz kw ma la ls lt lu lv bi translated"><strong class="kh ir">使用Matplotlib绘制每家公司的股价走势图</strong>。</li></ul><h1 id="52c3" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">设置Python for Finance脚本</h1><p id="dc58" class="pw-post-body-paragraph kf kg iq kh b ki mt jr kk kl mu ju kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">为了开始构建我们的<strong class="kh ir">股价趋势分析</strong>脚本，我们需要导入几个包。</p><p id="0311" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们将向一个免费的财务API发出http请求，在那里我们将获得股票每日价格。然后，我们将使用<a class="ae mz" href="https://pandas.pydata.org/pandas-docs/stable/index.html" rel="noopener ugc nofollow" target="_blank"> Pandas </a>合并API返回的财务数据，并将它们合并到一个Pandas数据框架中。最后，我们将使用<a class="ae mz" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> matplotlib </a>将我们的数据转换成图形。</p><p id="ce89" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在导入所有必需的包之后，我们将有一个我们想要检索价格的每家公司的<a class="ae mz" href="https://en.wikipedia.org/wiki/Ticker_symbol" rel="noopener ugc nofollow" target="_blank">股票</a> <a class="ae mz" href="https://en.wikipedia.org/wiki/Ticker_symbol" rel="noopener ugc nofollow" target="_blank">报价器</a>列表。作为一个想法，你也可以使用Python获得标准普尔500指数中所有公司的股票列表，并将其作为你分析的基础，而不是手动输入股票代码。你可以在我的另一篇文章中找到答案。</p><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="7340" class="nf mc iq nb b gy ng nh l ni nj">import requests<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/><br/>#Enter the ticker of the companies that you want to analyse<br/>companies = ['AAPL','FB','GOOG','F','TSLA']</span><span id="379b" class="nf mc iq nb b gy nk nh l ni nj">#empty list to add each of the companies<br/>listofdf = []</span></pre><p id="1248" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们有了初始设置，我们可以进入有趣的部分了。我们的最初目标是发送一个<em class="my"> http </em>请求到<a class="ae mz" href="https://financialmodelingprep.com/api/v3/historical-price-full/aapl?serietype=line" rel="noopener ugc nofollow" target="_blank"> API端点来下载每日股票价格</a>。</p><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="c95f" class="nf mc iq nb b gy ng nh l ni nj">#API end point request<br/>requests.get(f"https://financialmodelingprep.com/api/v3/historical-price-full/aapl?serietype=line")<br/><br/>#outcome<br/>{<br/>"symbol": "AAPL",<br/>"historical": [<br/>{<br/>"date": "1989-09-19",<br/>"close": 1.54<br/>},<br/>{<br/>"date": "1989-09-20",<br/>"close": 1.59<br/>},<br/>{<br/>"date": "1989-09-21",<br/>"close": 1.6<br/>},</span></pre><p id="52cd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如你在上面的url中看到的，我们传递了<strong class="kh ir"> <em class="my"> aapl </em> </strong>作为<em class="my">参数</em>(即在上面的例子中是<em class="my"> aapl </em>是苹果的股票代码)。该参数向API指示我们正在请求哪只股票的股价数据。因此，通过将url参数<em class="my"> appl </em>更改为任何其他公司股票，我们将获得其他公司的价格。</p><p id="8fa1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过查看响应，我们看到列表中的每个元素都是一个字典，包含一天的股票价格。</p><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="0617" class="nf mc iq nb b gy ng nh l ni nj">for item in companies:<br/>    histprices = requests.get(f"https://financialmodelingprep.com/api/v3/historical-price-full/{item}?serietype=line")<br/>#convert response to json<br/>    histprices = histprices.json()<br/><br/>#Parse the API response and select only last 600 days of prices<br/>    histprices = histprices['historical'][-600:]<br/><br/>#Convert from dict to pandas datafram<br/>    histpricesdf = pd.DataFrame.from_dict(histprices)<br/><br/>#rename column from close to the name of the company<br/>    histpricesdf = histpricesdf.rename({'close': item}, axis=1)<br/>    <br/>#append all dfs to list<br/>    listofdf.append(histpricesdf)</span></pre><p id="a6a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">For循环将让我们遍历<em class="my">公司</em>列表中的每个</strong>公司。这样，在每次循环迭代中，我们将为列表中包含的每只股票发出一个新的http请求。</p><p id="076b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意，我们将单词<strong class="kh ir"> <em class="my"> item </em> </strong>作为url的参数传递，该单词表示股票代码，并将随着每次循环迭代而改变。</p><p id="ce76" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们对熊猫数据帧进行切片，只保留最近的600天。最后，我们可以使用<a class="ae mz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.from_dict.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="my"> pd。data frame . from _ dict()</em></strong></a>to<strong class="kh ir">将我们的字典</strong>与股票价格和日期转换成一个熊猫数据框架。</p><p id="a824" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们有了一个名为listofdf的列表。列表中的每个元素都包含每只股票的熊猫数据帧。然而，将我们所有的股票放在不同的熊猫数据框架中对我们的分析没有太大的帮助。因此，<strong class="kh ir">我们将使用Pandas类方法<a class="ae mz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html" rel="noopener ugc nofollow" target="_blank"> <em class="my"> pd.concat </em> </a>将</strong>合并为一个。</p><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="71fa" class="nf mc iq nb b gy ng nh l ni nj">#set index of each DataFrame by common column before concatinatinghtem<br/>dfs = [df.set_index('date') for df in listofdf]<br/><br/>histpriceconcat = pd.concat(dfs,axis=1)</span></pre><p id="54ec" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了，现在我们将所有股票价格合并到一个熊猫数据框架中:</p><p id="6ebf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在开始绘制每只股票的价格趋势之前的最后一步，我们将<strong class="kh ir">将数据框中的每一行除以第一行。</strong>这将允许跨股票比较，因为所有股票价格将显示为一段时间内的百分比差异。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nl"><img src="../Images/0180aadea7249b0cf74cc7260763c148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5f0zidTkHi0-MuRO"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">面向金融的Python股票价格</p></figure><p id="b8dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">低于1的值表示与基准日(即2017-10-04)相比，股价有所下跌。大于1的值表示价格上涨。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nq"><img src="../Images/9ec731bffffc5217cd1ae1132be655ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b7IXExyhZD8JLucj_ztgew.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">由<a class="ae mz" href="https://unsplash.com/@austindistel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">奥斯汀·迪斯特尔</a>在<a class="ae mz" href="https://unsplash.com/s/photos/analysis?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="5184" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">绘制股票价格趋势</h1><p id="1686" class="pw-post-body-paragraph kf kg iq kh b ki mt jr kk kl mu ju kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">我们的脚本几乎准备好了，唯一悬而未决的部分是Python <strong class="kh ir">图</strong> <strong class="kh ir">显示股票价格随时间的趋势</strong>。我们可以使用matplotlib轻松实现这一点。</p><p id="57d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们将循环遍历每个串联的熊猫数据帧，以便<strong class="kh ir">绘制每个列</strong>。然后，我们可以通过<strong class="kh ir">添加标题</strong>、<strong class="kh ir">旋转棒并显示图例</strong>来稍微改变一下图表的布局:</p><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="4643" class="nf mc iq nb b gy ng nh l ni nj">for i, col in enumerate(histpriceconcat.columns):<br/>    histpriceconcat[col].plot()<br/><br/>plt.title('Price Evolution Comparison')<br/><br/>plt.xticks(rotation=70)<br/>plt.legend(histpriceconcat.columns)<br/><br/>#Saving the graph into a JPG file<br/>plt.savefig('foo1.png', bbox_inches='tight')</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/0fc7e81998b55c922a1f06002a0876a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*lEEv9vhw5SYs1drlWnMuUA.png"/></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">用于金融股票价格分析的Python</p></figure><h1 id="108b" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">包扎</h1><p id="0cf8" class="pw-post-body-paragraph kf kg iq kh b ki mt jr kk kl mu ju kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">就这样，我们构建了一个很好的Python脚本来执行<strong class="kh ir">股票价格趋势分析</strong>。由于价格显示为第一个数据点的百分比，该图对于比较不同公司的价格趋势特别有用。例如，我们可以看到<strong class="kh ir"> <em class="my">特斯拉</em> </strong>在过去几周经历了大幅增长，而<strong class="kh ir">苹果股价</strong>自2017年以来一直在稳步上涨。</p><p id="df1f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随意改变绘图天数和公司数量。为了您的方便，请参阅下面的整个脚本。</p><p id="6032" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好好享受吧！</p><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="a274" class="nf mc iq nb b gy ng nh l ni nj">import requests import pandas as pd import matplotlib.pyplot as plt companies = ['AAPL','FB','GOOG','F','TSLA'] listofdf = [] for item in companies: histprices = requests.get(f"https://financialmodelingprep.com/api/v3/historical-price-full/{item}?serietype=line") histprices = histprices.json() #Parse the API response and select only last 600 days of prices histprices = histprices['historical'][-600:] #Convert from dict to pandas datafram histpricesdf = pd.DataFrame.from_dict(histprices) #rename column histpricesdf = histpricesdf.rename({'close': item}, axis=1) #append all dfs to list listofdf.append(histpricesdf) #set index of each DataFrame by common column before concatinatinghtem dfs = [df.set_index('date') for df in listofdf] histpriceconcat = pd.concat(dfs,axis=1) #divide all dataframe by first line of data to enable comparison histpriceconcat = histpriceconcat/histpriceconcat.iloc[0] for i, col in enumerate(histpriceconcat.columns): histpriceconcat[col].plot() plt.title('Price Evolution Comparison') plt.xticks(rotation=70) plt.legend(histpriceconcat.columns) plt.savefig('foo1.png', bbox_inches='tight')</span></pre></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="8a30" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="my">原载于2020年2月25日https://codingandfun.com</em><em class="my">T21</em><a class="ae mz" href="https://codingandfun.com/python-for-finance-stock-price-trend-analysis/" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="e40c" class="nf mc iq nb b gy ng nh l ni nj">import requests<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/><br/><br/><br/>companies = ['AAPL','FB','GOOG','F','TSLA']<br/>listofdf = []<br/>for item in companies:<br/>    histprices = requests.get(f"https://financialmodelingprep.com/api/v3/historical-price-full/{item}?serietype=line")<br/>    histprices = histprices.json()<br/><br/>#Parse the API response and select only last 600 days of prices<br/>    histprices = histprices['historical'][-600:]<br/><br/>#Convert from dict to pandas datafram<br/><br/>    histpricesdf = pd.DataFrame.from_dict(histprices)<br/><br/>#rename column<br/>    histpricesdf = histpricesdf.rename({'close': item}, axis=1)<br/>    <br/>#append all dfs to list<br/>    listofdf.append(histpricesdf)<br/><br/>#set index of each DataFrame by common column before concatinatinghtem<br/>dfs = [df.set_index('date') for df in listofdf]<br/><br/>histpriceconcat = pd.concat(dfs,axis=1)<br/><br/>#divide all dataframe by first line of data to enable comparison<br/>histpriceconcat = histpriceconcat/histpriceconcat.iloc[0]<br/><br/><br/><br/>for i, col in enumerate(histpriceconcat.columns):<br/>    histpriceconcat[col].plot()<br/><br/>plt.title('Price Evolution Comparison')<br/><br/>plt.xticks(rotation=70)<br/>plt.legend(histpriceconcat.columns)<br/>plt.savefig('foo1.png', bbox_inches='tight')</span></pre></div></div>    
</body>
</html>