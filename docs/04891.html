<html>
<head>
<title>AI vs COVID-19. Does it really work?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">人工智能对新冠肺炎。真的管用吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/ai-vs-covid-19-does-it-really-work-a001c8da990a?source=collection_archive---------39-----------------------#2020-04-28">https://towardsdatascience.com/ai-vs-covid-19-does-it-really-work-a001c8da990a?source=collection_archive---------39-----------------------#2020-04-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3566" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">弄清楚我们能用现有的数据做什么，不能做什么</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/12f6ac55c52b1b14be5dcd28771c5f66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EI_HlOcXFBnPiBtAWPiNIA.jpeg"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">艾丽莎·埃克特女士和丹·希金斯女士在菲尔上的照片</p></figure><h2 id="ff19" class="ks kt iq bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">内容:</h2><ol class=""><li id="1991" class="lo lp iq lq b lr ls lt lu lb lv lf lw lj lx ly lz ma mb mc bi translated">介绍</li><li id="3089" class="lo lp iq lq b lr md lt me lb mf lf mg lj mh ly lz ma mb mc bi translated">制作我们的胸部x光新冠肺炎分类器<br/> 2.1。数据准备<br/> 2.2。训练<br/> 2.3。结果</li><li id="236d" class="lo lp iq lq b lr md lt me lb mf lf mg lj mh ly lz ma mb mc bi translated">真的管用吗？<br/> 3.1。进一步分析<br/> 3.2。讨论和要点</li></ol><h1 id="533a" class="mi kt iq bd ku mj mk ml kx mm mn mo la jw mp jx le jz mq ka li kc mr kd lm ms bi translated">1.介绍</h1><p id="3602" class="pw-post-body-paragraph mt mu iq lq b lr ls jr mv lt lu ju mw lb mx my mz lf na nb nc lj nd ne nf ly ij bi translated">今天，每个人都知道疫情。专业人士尽最大努力帮助应对这一问题:防止感染的快速传播、开发诊断方法、药物发现、病人护理策略、疫苗开发、死亡率预测、全球经济的建模影响以及许多其他问题。</p><p id="8b31" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">数据科学家也不例外。没有必要让任何人相信人工智能在医疗应用中非常有用。你可能已经看到出版物(甚至科学论文)声称已经开发出某种模型，可以预测患者是否患有新冠肺炎。一些出版物声称，当将深度学习应用于胸部X射线图像时，预测准确率达到90%以上，这提出了许多问题。</p><p id="ae1d" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">这就是为什么:在<a class="ae kr" href="http://futuremed.systems" rel="noopener ugc nofollow" target="_blank"> Futuremed </a>我们与医生密切合作，处理医疗数据。放射科医生说，胸部x光片中几乎没有新冠肺炎特有的模式。有时候，人工智能能够找到任何人类医生都无法找到的特征。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">使用视网膜照片进行性别分类。</p></figure><p id="2e2d" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">也许新冠肺炎的胸部x光片也是如此？让我们找出答案。</p><h1 id="712a" class="mi kt iq bd ku mj mk ml kx mm mn mo la jw mp jx le jz mq ka li kc mr kd lm ms bi translated">2.制作我们的胸部x光新冠肺炎分类器</h1><p id="eff0" class="pw-post-body-paragraph mt mu iq lq b lr ls jr mv lt lu ju mw lb mx my mz lf na nb nc lj nd ne nf ly ij bi translated">这不是一个“如何训练神经网络”的教程，但我会添加所有必要的信息来重现所描述的工作。</p><h2 id="8429" class="ks kt iq bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">2.1.数据准备</h2><p id="ca97" class="pw-post-body-paragraph mt mu iq lq b lr ls jr mv lt lu ju mw lb mx my mz lf na nb nc lj nd ne nf ly ij bi translated">对于在胸部X射线图像上分类新冠肺炎的任务，我们的数据集应该至少有两个类:“新冠肺炎”和“其他”。<br/>我们将使用四个数据源进行训练:<br/> 1。<a class="ae kr" href="https://github.com/ieee8023/covid-chestxray-dataset" rel="noopener ugc nofollow" target="_blank">著名的GitHub回购</a>带有新冠肺炎的图片。<br/> 2。来自意大利数据库<a class="ae kr" href="https://www.sirm.org/category/senza-categoria/covid-19/" rel="noopener ugc nofollow" target="_blank">和新冠肺炎病例</a>的图片。<br/> 3。胸部x光肺炎数据集。<br/> 4。<a class="ae kr" href="https://www.kaggle.com/nih-chest-xrays/data" rel="noopener ugc nofollow" target="_blank"> NIH ChestXRay-14数据集</a>。</p><p id="8b82" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">为了获得尽可能多的新冠肺炎图像，让我们结合前两个来源。意大利数据库中的大部分图片已经包含在GitHub repo中。但有些不是，所以我们只是手动添加。通过这种方式，我们可以获得目前(2020年4月7日)新冠肺炎的所有可用图像，以及一些没有该图像的图像(如果有其他病理或“无发现”，它们将被用作“其他”类别样本)。这里要注意一点:每个患者在数据集的那个部分可以有多个图像，所以<em class="nl"> n_patients ≤ n_images </em>。</p><p id="77aa" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">为了获得“其他”类的更多图像，使用最后两个源。</p><ul class=""><li id="6bab" class="lo lp iq lq b lr ng lt nh lb no lf np lj nq ly nr ma mb mc bi translated">从胸部X射线肺炎数据集中随机选取450幅图像，每类以<em class="nl">平衡</em>的方式。不考虑患者id。这样我们得到:<br/>149例无发现患者的150幅图像，<br/>144例病毒性肺炎患者的150幅图像，<br/>144例细菌性肺炎患者的150幅图像。</li><li id="320b" class="lo lp iq lq b lr md lt me lb mf lf mg lj mh ly nr ma mb mc bi translated">从NIH ChestXRay-14数据集中随机挑选450张图像:<br/>每14种病理状态30张图像，另外30张图像带有“未发现”标签。具有一种目标病理的图像也可能包含其他病理。所以这部分数据集<em class="nl">几乎平衡</em>。<br/>图像的采集方式使得该子数据集可能仅包含某个患者的一幅图像。换句话说，我们得到了450个独特的病人图像。</li></ul><p id="cc9a" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">接下来，我们把所有的数据结合起来。以下是生成的数据集统计数据:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nn l"/></div></figure><p id="1028" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">所有图像的尺寸都调整为564x564。计算数据集中图像的平均值和标准偏差。</p><h2 id="b86b" class="ks kt iq bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">2.2.培养</h2><p id="1e2e" class="pw-post-body-paragraph mt mu iq lq b lr ls jr mv lt lu ju mw lb mx my mz lf na nb nc lj nd ne nf ly ij bi translated">让我们使用DenseNet-121作为模型的主干(它几乎成为处理2D医学图像的默认选择)。由于我们的新冠肺炎数据集太小，无法从头开始训练模型，让我们首先在ChestXRay-14上训练我们的模型，然后使用预训练的模型进行权重初始化。<br/>处理医学图像时，确保同一患者的不同图像不会进入训练/验证/测试集至关重要。为了解决这个问题，由于新冠肺炎图像的缺乏，我们决定对患者使用10倍交叉验证<em class="nl">进行训练。<br/>为培训进行了以下数据扩充:</em></p><ul class=""><li id="7d59" class="lo lp iq lq b lr ng lt nh lb no lf np lj nq ly nr ma mb mc bi translated">随机旋转(&lt;15°),</li><li id="94fa" class="lo lp iq lq b lr md lt me lb mf lf mg lj mh ly nr ma mb mc bi translated">Random crop (512x512),</li><li id="7102" class="lo lp iq lq b lr md lt me lb mf lf mg lj mh ly nr ma mb mc bi translated">Random intensity shift.</li></ul><p id="775b" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">For evaluation, we used only center crops (no TTA).<br/>计算的平均值和标准差用于增强后标准化图像。</p><p id="5def" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">对网络进行了修改，以便为这些类生成两个逻辑(“新冠肺炎”和“其他”)。数据是不平衡的，所以我们选择加权二进制交叉熵作为损失函数。还使用了软标记:一键编码标记平滑0.05。当我们对患者进行交叉验证<em class="nl">时，两个类别的图像数量会从一个折叠到另一个折叠发生变化，因此我们会实时计算每个折叠的每个类别权重。</em></p><p id="ea49" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">使用带有AMSGrad的Adam optimizer来训练网络。其他超参数和代码可以在项目报告<a class="ae kr" href="https://github.com/futuremed-ru/covid/tree/master/lungs-covid-19-classifier" rel="noopener ugc nofollow" target="_blank">这里</a>找到。ROC AUC模型验证集上的最佳值保存在每个折叠中。</p><h2 id="213f" class="ks kt iq bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">2.3.结果</h2><p id="0fe1" class="pw-post-body-paragraph mt mu iq lq b lr ls jr mv lt lu ju mw lb mx my mz lf na nb nc lj nd ne nf ly ij bi translated">所得到的模型形成了用于进一步分析的集合。所有验证倍数指标的平均值:<br/> ROC AUC: 0.99387，<br/>准确性:0.95046。</p><p id="f98b" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">为了进行测试，我们使用了来自GitHub repo(2020年4月7日至22日添加的)的新正面(PA或AP视图)X射线图像。<br/>和需要平衡(“新冠肺炎”和“其他”)类别的图像数量是从从ChestXRay-14中随机选取的未用于训练的患者图像中添加的(由于它们是随机选取的，从统计上看，它们中的大多数都带有“无发现”标签)。所有这些带有相应标签的图像组成一个测试集。</p><p id="96e8" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">测试集上的每个标签统计信息:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nn l"/></div></figure><p id="8499" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">常见的指标有:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nn l"/></div></figure><p id="7321" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">还不错！看起来我们有了一个坚实的胸部x光新冠肺炎分类器。</p><p id="3516" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">对于一些读者来说，结果可能看起来令人信服，但其他人可能会有“这里有问题”的感觉。</p><h1 id="30db" class="mi kt iq bd ku mj mk ml kx mm mn mo la jw mp jx le jz mq ka li kc mr kd lm ms bi translated">3.真的管用吗？</h1><p id="bfa9" class="pw-post-body-paragraph mt mu iq lq b lr ls jr mv lt lu ju mw lb mx my mz lf na nb nc lj nd ne nf ly ij bi translated">让我们使用更多的数据来评估我们的分类器的性能。</p><h2 id="dc27" class="ks kt iq bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">3.1.进一步分析</h2><p id="42ea" class="pw-post-body-paragraph mt mu iq lq b lr ls jr mv lt lu ju mw lb mx my mz lf na nb nc lj nd ne nf ly ij bi translated"><strong class="lq ir">首先</strong>，让我们看看分类器在<strong class="lq ir"> ChestXRay-14数据集</strong>的其余部分(未在训练中使用)上的性能统计:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nn l"/></div></figure><p id="e794" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">由于在该数据集中没有新冠肺炎病例，那么我们唯一可以声称的是，我们的分类器在该数据集上具有相当好的特异性(0.99235) <em class="nl">。<br/>此外，您可以看到，在“肺炎”和“浸润”等类别上没有假阳性峰值，这些类别可能与新冠肺炎x光照片类似。这是否意味着人工智能算法可以将新冠肺炎病与其他类似的疾病区分开来？</em></p><p id="e8c2" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated"><strong class="lq ir">其次</strong>，让我们来看看分类器在<em class="nl">不可见</em> <strong class="lq ir">专有数据</strong>上的表现。使用的数据集只有“正常”和“异常”标签。该数据集中没有新冠肺炎阳性患者图像。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nn l"/></div></figure><p id="a08c" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">特异性显著下降(至0.69333)。分类器现在好像不太好。发生了什么事？</p><p id="5410" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated"><strong class="lq ir">第三</strong>，我们来看看<strong class="lq ir"> GitHub repo </strong>关于<strong class="lq ir">新图片</strong>(2020年4月7-22日)的详细结果，有新冠肺炎案例。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nn l"/></div></figure><p id="bf1c" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">综上所述，我们得到:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nn l"/></div></figure><p id="e358" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">重新计算指标后，我们已经可以看到一些东西:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nn l"/></div></figure><p id="cd51" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">已经不是“还不错”了。我们现在可以看到真相:我们的分类器是垃圾。让我们好好想想。</p><h2 id="ecd0" class="ks kt iq bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">3.2.讨论和要点</h2><p id="1c35" class="pw-post-body-paragraph mt mu iq lq b lr ls jr mv lt lu ju mw lb mx my mz lf na nb nc lj nd ne nf ly ij bi translated">正如前面提到的，结果精度表明分类器无法区分图像中的新冠肺炎特定模式(记得放射科医生说，在胸部X射线图像中没有多少<em class="nl">特定的</em>到新冠肺炎模式)。但是分类器学到了什么，为什么它在GitHub repo和ChestXRay-14数据上表现良好？</p><p id="e524" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">分类器学习从“其他”类的数据集中挑选的图像看起来如何。它还了解到，任何病理模式都意味着它是“新冠肺炎”，“T2”，因为图像看起来不像是来自“其他”数据集。</p><blockquote class="nt"><p id="453b" class="nu nv iq bd nw nx ny nz oa ob oc ly dk translated">所以，一般来说，分类器学会了区分一些病态的和看起来不像“其他”图像的东西。</p></blockquote><figure class="oe of og oh oi kk gh gi paragraph-image"><div role="button" tabindex="0" class="oj ok di ol bf om"><div class="gh gi od"><img src="../Images/2d072cd9cd5f1c98aa9a1c320175fd86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCA9OlKewtlz5quLaal2bQ.jpeg"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">患者的原始图像，带有分类器对新冠肺炎的预测(左)，对应的GradCAM(右)。</p></figure><p id="7fd6" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">这就是为什么它在我们的专有数据集(包含看起来不像“其他”图像的图像)上将几乎每三张图像标记为“新冠肺炎”。<br/>分类器知道<em class="nl">正常和异常图像之间的一些</em>差异。每隔3个异常图像和每隔5个正常图像标记为“新冠肺炎”。至少我们的努力没有白费:)</p><p id="d30b" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">尽管在训练时进行了强大的数据扩充，仔细的患者k倍交叉验证，以及加权损失函数，分类器在真实世界的数据上表现不佳。</p><p id="ccdd" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">我们鼓励任何感兴趣的人重复我们的实验。实际上，你不需要任何专有数据，你可以只从“其他”类中排除一个数据集，并将其作为“不可见”使用。</p><blockquote class="on oo op"><p id="6f3f" class="mt mu nl lq b lr ng jr mv lt nh ju mw oq ni my mz or nj nb nc os nk ne nf ly ij bi translated"><em class="iq">我想指出两个要点:</em></p><p id="32fd" class="mt mu nl lq b lr ng jr mv lt nh ju mw oq ni my mz or nj nb nc os nk ne nf ly ij bi translated"><em class="iq">任何神经网络总会试图找到</em>解决任务的最简单方法<em class="iq">。</em></p><p id="92a3" class="mt mu nl lq b lr ng jr mv lt nh ju mw oq ni my mz or nj nb nc os nk ne nf ly ij bi translated">仔细查看验证模型性能的数据<em class="iq">。不仅仅是光秃秃的数字。</em></p></blockquote><p id="bc17" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">在这一点上，我并不是说绝对不可能在胸部x光片上找到任何新冠肺炎特有的模式。有可能某种特定的东西确实存在，人工智能能够捕捉到它。但在以下情况下，这是绝对不可能的:</p><ol class=""><li id="43bc" class="lo lp iq lq b lr ng lt nh lb no lf np lj nq ly lz ma mb mc bi translated">神经网络是根据少量数据训练的</li><li id="f12b" class="lo lp iq lq b lr md lt me lb mf lf mg lj mh ly lz ma mb mc bi translated">当某个特定类别的图像与数据集的其余部分存在显著差异时</li></ol><p id="4da7" class="pw-post-body-paragraph mt mu iq lq b lr ng jr mv lt nh ju mw lb ni my mz lf nj nb nc lj nk ne nf ly ij bi translated">所有的源代码都可以在我们<a class="ae kr" href="https://github.com/futuremed-ru/covid" rel="noopener ugc nofollow" target="_blank">项目的GitHub repo </a>获得。如果你有任何问题，请随时联系我。</p></div></div>    
</body>
</html>