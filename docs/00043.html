<html>
<head>
<title>One of the most common mistakes when running an ANOVA in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在R中进行方差分析时最常见的错误之一</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/one-of-the-most-common-unintentional-mistakes-when-running-an-anova-in-r-cfa55d332a?source=collection_archive---------14-----------------------#2020-01-02">https://towardsdatascience.com/one-of-the-most-common-unintentional-mistakes-when-running-an-anova-in-r-cfa55d332a?source=collection_archive---------14-----------------------#2020-01-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6e5f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">或者:为什么OLS回归(lm)和方差分析(aov)函数有时会不同，以及如何使用car软件包解决这个问题。</h2></div><p id="1f59" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">想象一下这个场景:你在R中运行ANOVA，同时控制其他变量(技术上来说，是ANCOVA)。然而，结果看起来很奇怪:独立变量的顺序很重要并影响结果——怎么会这样呢？如果你尝试输入相同的模型作为线性回归，结果也完全不同。再说一遍，这怎么可能呢？</p><p id="b0c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章旨在阐明这个共同的问题。首先，让我们从重现这个问题开始。如果你正在寻找关于ANOVAs的更全面的介绍，可以看看我关于这个主题的文章。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/65f9dae2008187c5cb016f1dce852d7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUWFiKfJXsoZPVFX2VMORw.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">许多人没有注意到他们的ANOVAs是错误的。(图片由<a class="ae le" href="https://unsplash.com/@imagoiq?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">loc fürhoff</a>在<a class="ae le" href="https://unsplash.com/s/photos/university?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure><p id="00fb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用base R中包含的薪水数据集重新创建这个问题。它包含教授薪水和其他变量的数据，这些变量会直观地影响教授的薪水，如学科和资历。您可以使用以下命令来访问它。</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="38e5" class="ma mb it lw b gy mc md l me mf">df=Salaries</span></pre><p id="a020" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，假设我们感兴趣的是，在控制其他直观上重要的自变量时，教授的性别是否会影响他们的工资。人们可以使用方差分析来分析这些差异。因此，让我们用ANOVA分析数据集中两组之间的差异。</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="309c" class="ma mb it lw b gy mc md l me mf">aov1.1=aov(salary~sex+rank+yrs.since.phd+yrs.service+discipline,df)</span><span id="8544" class="ma mb it lw b gy mg md l me mf">summary(aov1.1)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mh"><img src="../Images/8eb8a84e427f0fa8fc7c7f8f8ae1170e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oLqufN8bWB9duKGaxtZSng.png"/></div></div></figure><p id="2c9f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个方差分析似乎暗示性别对教授的工资有显著影响。但是，如果你运行与线性回归模型相同的分析，就会得出不同的结论。</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="51a0" class="ma mb it lw b gy mc md l me mf">lm1.1=lm(salary~sex+rank+yrs.since.phd+yrs.service+discipline,df)</span><span id="8c56" class="ma mb it lw b gy mg md l me mf">summary(lm1.1)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mi"><img src="../Images/4400d0e9ae89f84bdfa1d69c37f60ab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eBay37DPkJb6ZuoLSp2xrw.png"/></div></div></figure><p id="0ade" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，性别对教授工资的影响似乎微不足道。那是什么呢？性别到底有没有影响教授的工资？另一件奇怪的事情出现了:如果你重新运行ANOVA 1.1，但改变了自变量的顺序，它也会显示不同的结果。在下面的例子中，我们改变了独立变量性别和等级的位置。</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="fecb" class="ma mb it lw b gy mc md l me mf">aov1.2=aov(salary~rank+sex+yrs.since.phd+yrs.service+discipline,df)</span><span id="a449" class="ma mb it lw b gy mg md l me mf">summary(aov1.2)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mj"><img src="../Images/07f64c89658098d5498c8199840922c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LcO2FEij_DApWFJCItcD9w.png"/></div></div></figure><p id="061d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，不同的结果。现在我们有三组结果和终极困惑。性别对于回归是不显著的，但是，例如，yrs.since.phd也是不显著的，这与回归结果不同。这是怎么回事？哪个自变量影响教授的工资？为什么所有的结果都不一样？</p><p id="33a4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">原因是<em class="mk">类平方和</em>。它描述了R如何将误差项合并到回归模型中，以及合并误差的不同方式导致不同的拟合模型。默认情况下，R使用类型I(“一”)方差分析的平方和，类型1非常适合只有一个自变量的方差分析。然而，当你添加更多的自变量(技术上是ANCOVA)时，I型将产生<em class="mk">不正确的</em>结果。对于回归(当使用lm()函数时)，R默认使用类型III(“三”)平方和。</p><p id="51c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的例子中，所有的ANOVAs都是错误的，只有lm()函数产生了正确的结果<em class="mk">。</em>虽然我不会解释不同类型平方和之间的区别，但可以说你应该<em class="mk">几乎总是使用第三类平方和。</em>如果你想了解更多关于不同类型平方和的信息，请查看<a class="ae le" href="https://amzn.to/2t2Tf9l" rel="noopener ugc nofollow" target="_blank">安迪·菲尔德的书《使用R </a>发现统计学》中的<a class="ae le" href="https://books.google.ch/books?id=wd2K2zC3swIC&amp;lpg=PP1&amp;hl=de&amp;pg=PA475#v=onepage&amp;q&amp;f=false" rel="noopener ugc nofollow" target="_blank">这一页</a></p><p id="849e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">因此，如果我们运行一个具有多个自变量的ANOVA(技术上是ANCOVA)，我们需要覆盖R的默认设置，并告诉它必须使用类型III平方和。</strong></p><p id="f944" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于aov()函数不允许我们修改平方和的类型，我们需要使用另一个不同包中的ANOVA函数来指定这一点。我们将使用<em class="mk">赛车</em>套件。运行下面的命令来安装<em class="mk"> car </em>包，如果你还没有安装的话。</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="240a" class="ma mb it lw b gy mc md l me mf">install.packages("car")</span></pre><p id="56c8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后加载包。</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="9898" class="ma mb it lw b gy mc md l me mf">library(car)</span></pre><p id="f06d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，在我们的<em class="mk">原始ANOVA </em>对象(aov1.1)上运行<em class="mk"> car Anova </em>命令，指定我们希望使用III类误差。</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="0873" class="ma mb it lw b gy mc md l me mf">Anova(aov1.1, type=”III”)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ml"><img src="../Images/e3776c2f5e7032560a8ee59a4467d4a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xgqDRV1vwC2lv1knL18Vvg.png"/></div></div></figure><p id="0623" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在查看结果，您可以看到它们与回归输出一致。</p></div></div>    
</body>
</html>