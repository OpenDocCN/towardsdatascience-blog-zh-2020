<html>
<head>
<title>How Scraping NBA Stats is cooler than Michael Jordan</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何刮 NBA 的统计数据比迈克尔乔丹更酷</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-scraping-nba-stats-is-cooler-than-michael-jordan-49d7562ce3ef?source=collection_archive---------19-----------------------#2020-08-26">https://towardsdatascience.com/how-scraping-nba-stats-is-cooler-than-michael-jordan-49d7562ce3ef?source=collection_archive---------19-----------------------#2020-08-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ac45" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">寻找 API 端点和客户端 web 抓取</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ff7fbaf17c8a553f541a68de0685995c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rNwXSHbf0dAxa3bA"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">瓦列里·塞索耶夫在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="c8e1" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="b724" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">今年夏天，我有了一个跟踪 NBA 的新爱好，作为一个数据爱好者，我想了解这个赛季的 NBA 在理论上与前几个赛季有什么不同，因为这是在没有任何球迷的泡沫中进行的。</p><p id="1e76" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了获取相关数据，我开始使用 python 库 beautiful soup。然而，令我惊讶的是，数据并没有存储在 HTML 源页面上。经过一番挖掘，我发现 NBA stats 网站是用 AngularJS 构建的，这意味着该网站是在客户端而不是服务器端呈现的。</p><h2 id="07d2" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">什么是客户端渲染</h2><p id="8d1b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">呈现的 HTML 只是一个模板，它不包含任何数据，服务器响应中的 Javascript 从 API 获取数据，并使用它来创建客户端页面。</p><p id="9b90" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">基本上，当你查看网页源代码时，你不会发现数据，而只是网页的一个模板。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/6a7116d54046947f5f673ca341bb37e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ay35LCsJn_9UJr6OuSsHg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://stats.nba.com/players/traditional/?SeasonType=Regular%20Season&amp;sort=PTS&amp;dir=-1&amp;Season=2019-20" rel="noopener ugc nofollow" target="_blank"> NBA 各州网站</a></p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/5950d42c1bbae6a5346d735e352cc878.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pGIksJJN5pAu6wTg2_hVtQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Ctrl + U 带您到页面源</p></figure><h1 id="bb9f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">我们开始吧</h1><p id="1331" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在本文中，我们将从 NBA 统计网站上搜集<a class="ae kv" href="https://stats.nba.com/players/traditional/?SeasonType=Regular%20Season&amp;sort=PTS&amp;dir=-1&amp;Season=2019-20" rel="noopener ugc nofollow" target="_blank">联盟球员的统计数据。经过几个小时的研究，我决定采用一种比美丽的汤更简单的方法。</a></p><h2 id="24ba" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">从网站查找 API 端点</h2><p id="672e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">第一步，在你的网页浏览器(最好是谷歌 chrome 或者火狐)上打开你想要抓取的网页，打开开发者工具。为此，只需右键单击选择检查。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/5cad87144ed5459a6629ad5b516e81f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*jG_Fmj6ERa_r_joh1bWceg.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">右键单击，然后检查</p></figure><p id="5539" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这将在页面的右侧或底部打开一个面板，选择网络和 XHR，然后重新加载页面。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/6e3c8d63a8083c7b77b8b34ce9d3cf55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ex45rW_LWZVAG7fu2YehIg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">检查面板</p></figure><p id="3133" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">一旦我们重新加载页面，页面中的所有请求都将可见。此时，您应该做一些挖掘工作来找到您想要的请求。最有可能的是，端点会以你正在浏览的网页命名。</p><p id="c876" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">由于我们正在查看联盟球员的统计页面，端点可能会被命名为类似的名称。选择每个选项并预览结果以找到正确的端点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/fa2e106f7d4a02129d7ec314556f37f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sRbHnULuPeJjQ2EM0CEGkQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择并预览</p></figure><p id="69eb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">一旦你找到了正确的终点，你就可以进入下一步了。</p><h2 id="e45b" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">调用 API 端点来获取数据</h2><p id="9978" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了调用 API，我们将利用<a class="ae kv" href="https://requests.readthedocs.io/en/master/user/quickstart/#custom-headers" rel="noopener ugc nofollow" target="_blank">请求</a> python 包。为此，我们需要 3 个组件作为下面请求语法的一部分。</p><p id="7c6b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">第一部分是 URL，在我们的例子中，因为我们正在访问联赛球员统计数据，所以我们可以从上一步获得它。</p><p id="90f9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在 Header 选项卡下，选择 general 并复制请求 URL 的第一部分。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/ff0b87b134a232d7262aea1f4146358d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fxWr9AiFQkdXS6Y3p0eKRw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">请求 URL</p></figure><p id="1c5b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">接下来，我们需要请求标题，它也可以在同一个标题选项卡下找到，但是在“请求标题”子部分下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/3b747c6db85b4246b340b59f30f3d810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FWkHO5B8A_0yf9Xwswp_ng.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">请求标题</p></figure><p id="2a92" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">作为字典的页眉</p><p id="8239" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们需要的最后一个组件是参数，可以在 Header 选项卡下的“查询字符串参数”小节中找到。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/a76a2cb1c7940b050765a4fdd0bb001c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JESvDtNXW7-MsbLGyLSkwQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">因素</p></figure><p id="9d4d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">因素</p><p id="9e84" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在我们有了所有的三个部分，调用 API 就很简单了。然后，可以将响应处理到数据框架中进行分析。</p><p id="6c79" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">获取请求</p><p id="9dc9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最终的请求看起来像这样，</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/7aa5d6cbb49753ace241ffad80a2738f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDoJGRdnXbEsrI1PwuDmiw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据帧</p></figure><h1 id="f827" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">谢谢大家！！</h1><p id="27c2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">恭喜👏！！我们成功地抓取了 NBA 统计数据网站。</p><p id="d4ac" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">PS:这个过程对 stats.nba.com 的<a class="ae kv" href="https://stats.nba.com/" rel="noopener ugc nofollow" target="_blank">绝对管用。这可能也适用于任何其他使用 AngularJS 等语言构建的客户端 web 框架的网站。如果你的目标网站是用服务器端框架和像 Django 或 Ruby on Rails 这样的语言构建的，那么我们的朋友 Beautiful Soup 会帮你一把。</a></p><p id="6e72" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">祝你的网络抓取之旅好运！希望这个帖子有帮助。</p><p id="004e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你有任何问题，请随时通过<a class="ae kv" href="https://twitter.com/AshwinMuru" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae kv" href="https://www.linkedin.com/in/ashwinmuthiah/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>联系我。</p></div></div>    
</body>
</html>