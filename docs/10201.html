<html>
<head>
<title>Detectron2 &amp; Python Wheels Cache</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Detectron2 和 Python Wheels 缓存</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/detectron2-python-wheels-cache-bfb94a0267ef?source=collection_archive---------29-----------------------#2020-07-18">https://towardsdatascience.com/detectron2-python-wheels-cache-bfb94a0267ef?source=collection_archive---------29-----------------------#2020-07-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="254a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 Windows 上构建一个 Detectron2 wheel 包并缓存它</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/048a5f76ec3a1bd0d9e4c7e824d6ef7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l5L1icOs1-mJ7HPzeDaCIA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.flickr.com/photos/barneymoss?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">巴尼·莫斯</a>在<a class="ae ky" href="https://www.flickr.com/photos/barneymoss/14898532020/" rel="noopener ugc nofollow" target="_blank"> Flickr </a>上的原始照片</p></figure><h2 id="55da" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">检测器 2</h2><p id="0a71" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我最近在做一些定制的<a class="ae ky" href="https://github.com/facebookresearch/detectron2" rel="noopener ugc nofollow" target="_blank">探测器 2 </a>模型的工作。我一直在云中的 Linux VM 上训练我的模型，但是我想在 Windows 环境中使用这个训练过的模型。脸书研究公司关于 Detectron2 的官方说法是它在 Windows 上不受支持。但我不会让这阻止我去尝试！好消息是我能够做到，这篇文章描述了我使用的过程。</p><h2 id="0fc3" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">初始设置</h2><p id="25ae" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在解释我是如何做到这一点的过程中，我将假设您熟悉/熟悉以下内容:</p><ul class=""><li id="efcc" class="mo mp it lx b ly mq mb mr li ms lm mt lq mu mn mv mw mx my bi translated">Python 虚拟环境</li><li id="5c97" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn mv mw mx my bi translated">GIT 命令行</li></ul><p id="9e11" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">首先要创建一个虚拟环境，然后激活它:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="5758" class="kz la it ni b gy nm nn l no np">virtualenv detectron2<br/>detectron2\Scripts\activate</span></pre><p id="1432" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">从您的虚拟环境安装 PyTorch 和 torchvision(仅限 CPU 版本):</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="f268" class="kz la it ni b gy nm nn l no np">pip install torch==1.5.1+cpu torchvision==0.6.1+cpu -f https://download.pytorch.org/whl/torch_stable.html</span></pre><p id="ec04" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">或许还值得安装<strong class="lx iu"> fvcore </strong>和 windows 版本的 pycocotools，即<strong class="lx iu"> pycocotools-windows </strong>:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="e32a" class="kz la it ni b gy nm nn l no np">pip install fvcore<br/>pip install pycocotools-windows</span></pre><h2 id="67a7" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">下载并安装检测器 2</h2><p id="838c" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">为了下载 Detectron2 源代码，我们将使用 GIT 命令行克隆一个特定的标记版本(这里的标记是“v0.1”)。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="6fc2" class="kz la it ni b gy nm nn l no np">git clone --depth 1 --branch v0.1 https://github.com/facebookresearch/detectron2.git</span></pre><p id="3fa0" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">将发布变更克隆到刚刚在虚拟环境(不是 GIT 命令行)中用这个克隆创建的 detectron2 文件夹之后。例如，如果您将 GIT 克隆到文件夹<strong class="lx iu">D:\ Source \ Python \ detectron 2</strong>中，则切换到该目录并发出以下命令:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="5724" class="kz la it ni b gy nm nn l no np">pip install -U .</span></pre><p id="18a0" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">不要忘记结尾的句号，这真的很重要！</p><p id="82fb" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">这应该会构建 detectron2 包，如果一切顺利，您应该会在最后看到如下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/ec0c44bc4718f69715082cc302a5dcb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pu0SMM2NThaKkOei20JeuA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">构建检测器 2 包</p></figure><p id="6a51" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">因为我们克隆了 v0.1 标签，所以您会看到它是由 detectron 2–0.1 构建的</p><h2 id="3ab6" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">缓存车轮</h2><p id="6cff" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">你会注意到，当你安装一个 python 包时，它会检查它的本地轮缓存，看看它过去是否下载过这个包，如果下载过，它就使用缓存的版本。要创建您自己的车轮缓存，您需要首先安装车轮包:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="2a4f" class="kz la it ni b gy nm nn l no np">pip install wheel</span></pre><p id="f192" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">完成后，我们要列出当前为我们的虚拟环境安装的包，并将它们放入一个文件中(这里称为 requirements.txt):</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="1768" class="kz la it ni b gy nm nn l no np">pip freeze &gt; requirements.txt</span></pre><p id="2c13" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">要为当前安装的包复制/创建所有的轮子，并把它们放在一个缓存文件夹中(这里我使用的是<strong class="lx iu"> D:\wheels_cache </strong>)，请执行以下操作:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="7466" class="kz la it ni b gy nm nn l no np">pip wheel --wheel-dir=D:\wheels_cache -r requirements.txt</span></pre><h2 id="3299" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">车轮缓存的优势</h2><p id="a1e3" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">使用 wheels 缓存的好处之一是，将来您可以使用缓存的 wheels 直接安装，而不必再次构建一个包。如果你想在一台不同的电脑上做这件事，这是很有用的，因为你可能没有所有的依赖项。你可以这样做:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="ec4c" class="kz la it ni b gy nm nn l no np">pip install D:\wheels_cache\detectron2-0.1-cp38-cp38-win_amd64.whl</span></pre><p id="fb4e" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">这种方法需要注意的一点是轮子依赖于目标平台和 Python 版本。这个是针对 Windows 64 位和 Python 3.8 的。</p><p id="d582" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">你甚至可以安装来自<strong class="lx iu"> requirements.txt </strong>文件的所有东西，告诉它在你的缓存文件夹中寻找轮子:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="bc1f" class="kz la it ni b gy nm nn l no np">pip install --no-index --find-links=D:\wheels_cache -r requirements.txt</span></pre><p id="8d87" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">有一次，我必须在客户处安装一台电脑，而这台电脑是隔离的，即不允许连接到互联网或本地网络。我必须能够在这台机器上安装 Python 和所有需要的包，以运行我实现的机器学习软件。我采用的方法是为机器构建一个包含所有需要的包的 wheels 缓存。这样，安装可以从缓存中进行。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><h2 id="0a25" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">参考</h2><ul class=""><li id="9b12" class="mo mp it lx b ly lz mb mc li ny lm nz lq oa mn mv mw mx my bi translated"><strong class="lx iu">侦察兵 2</strong>:【https://github.com/facebookresearch/detectron2】T4</li><li id="ac4d" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn mv mw mx my bi translated"><strong class="lx iu">py torch</strong>:<a class="ae ky" href="https://pytorch.org/get-started/locally/" rel="noopener ugc nofollow" target="_blank">https://pytorch.org/get-started/locally/</a></li></ul></div></div>    
</body>
</html>