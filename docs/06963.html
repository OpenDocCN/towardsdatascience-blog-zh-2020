<html>
<head>
<title>Step by step bar-charts using Plotly Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Plotly Express 的逐步条形图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/step-by-step-bar-charts-using-plotly-express-bb13a1264a8b?source=collection_archive---------25-----------------------#2020-05-29">https://towardsdatascience.com/step-by-step-bar-charts-using-plotly-express-bb13a1264a8b?source=collection_archive---------25-----------------------#2020-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3eff" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">回答“我在看什么？”</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/a8ecff52b4916b64666b512f8168b4ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bWq-7vCopJei8upIGh5J5A.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@bmowinkel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">布兰登·莫温克尔</a>在<a class="ae kz" href="https://unsplash.com/s/photos/columns?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="d542" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">作为一名有抱负的数据科学家，我喜欢摆弄数据集，解开隐藏在行和列背后的故事。我做的第一件事就是用条形图来显示数据。这让我熟悉了信息，并制定了未来分析的游戏计划。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="e2ba" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您还不是会员，请在此获得您的中级会员资格<a class="ae kz" href="https://medium.com/@alejandra.vlerick/membership" rel="noopener"/>！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="7007" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">数据集</h1><p id="bf7d" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">我决定找一个简单的数据集，让我可以专注于绘图而不是清理。我发现“一见钟情结婚”数据集符合我的需求，因为它有一个健康的组合<strong class="lc iu">数字</strong>和<strong class="lc iu">分类数据</strong>。这个电视节目已经成为一种隔离的罪恶快感。在这个系列中，两个人被随机配对，他们可以在一个梦想的地方度假三周后决定结婚与否。数据集可以在<a class="ae kz" href="https://www.kaggle.com/mrisdal/married-at-first-sight" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="6fce" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">导入库</h1><p id="cb1c" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">第一步是导入我将使用的所有库。是一个用于在 Python 中创建静态、动画和交互式可视化的库。<strong class="lc iu"> Plotly Express </strong>是 Plotly v.4 的一个新的高级 Python 可视化库，允许使用简单的语法绘制复杂的图表。</p><p id="64c2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">一旦库被导入，我就使用<strong class="lc iu"> <em class="nf"> read_csv() </em> </strong>函数加载我的文件，并将其转换成熊猫数据帧。</p><pre class="kk kl km kn gt ng nh ni nj aw nk bi"><span id="3eec" class="nl me it nh b gy nm nn l no np">import pandas as pd<br/>import plotly.express as px<br/>from plotly.subplots import make_subplots</span><span id="ca9f" class="nl me it nh b gy nq nn l no np">df = pd.read_csv("Data/mafs.csv")</span></pre><h1 id="97e0" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">让我们来看看数据框</h1><p id="9925" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">当我有了我的熊猫数据框架后，我会做两件事。首先，我查看标题名和存储在每一列中的变量类型。</p><pre class="kk kl km kn gt ng nh ni nj aw nk bi"><span id="6f2c" class="nl me it nh b gy nm nn l no np">print(df.info())</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nr"><img src="../Images/73972e137d1c9583df7390eb3cacb96e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-p2i8Jkpp6cDrAeRIB-Jxg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图由作者提供</p></figure><p id="6e89" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这告诉我，在我的数据集中有 17 列，一些存储'<strong class="lc iu"> <em class="nf">对象</em> </strong>'类型，我喜欢把它们看作字符串，还有'<strong class="lc iu"> <em class="nf"> int64 </em> </strong>'类型，它们是简单的 64 位整数存储。</p><p id="a3df" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">其次，我查看数据帧的第一行。</p><pre class="kk kl km kn gt ng nh ni nj aw nk bi"><span id="b42f" class="nl me it nh b gy nm nn l no np">print(df.iloc[0])</span></pre><p id="8006" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">通过将 index [0]改为任意整数，我也可以找到任意行的信息。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ns"><img src="../Images/3c0a8156f634e971144509213ef21c0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F4kIhuQTt1THNs0OY66_5g.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图由作者提供</p></figure><p id="dd9a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这告诉我，在这个电视节目中，参赛者杰米·奥蒂斯-赫纳在比赛时 27 岁，职业是护士。<strong class="lc iu">更重要的是，这位选手在电视节目中决定结婚，至今仍是已婚。幸运的女孩！</strong></p><h1 id="22cc" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated"><em class="ki">“是对否”</em>简单条形图</h1><p id="c015" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">我的第一反应是绘制出同意结婚的人和愿意保持单身的人的数量。该信息可在“决策”栏中找到，该栏中的值为“是”或“否”。</p><pre class="kk kl km kn gt ng nh ni nj aw nk bi"><span id="690d" class="nl me it nh b gy nm nn l no np">df1 = df.groupby(["Decision"]).count().reset_index()<br/><br/>fig = px.bar(df1<strong class="nh iu">,<br/>             </strong>y=df.groupby(["Decision"]).size()<strong class="nh iu">,<br/>             </strong>x="Decision"<strong class="nh iu">,<br/>             </strong>color='Decision')<br/>fig.show()</span></pre><p id="e2b7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">通过使用<strong class="lc iu"> <em class="nf"> groupby() </em> </strong>函数，我能够对数据集中的行进行洗牌，以便按照决策结果对它们进行组织。剩下要做的唯一一件事就是选择 x 轴和 y 轴来产生所需的信息。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nt"><img src="../Images/ae1f057a83d28ed0d5d8b647d40621b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NHZuvg3PMcdrvkMqmk3_Fg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图由作者提供</p></figure><p id="7113" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">从图表中可以清楚地看到，70%的参赛者在三周后决定结婚，这是一个惊人的高成功率。也许这就是这部剧已经播了 10 季的原因吧！</p><h1 id="88f3" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">“每个地点的婚姻”堆积条形图</h1><p id="46ab" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">我想做的第二件事是看看地理位置是否会影响成功夫妇的数量。为此，我在 x 轴上标出了位置，在 y 轴上标出了“是”和“否”的数量。</p><pre class="kk kl km kn gt ng nh ni nj aw nk bi"><span id="4e31" class="nl me it nh b gy nm nn l no np">df2 = df.groupby(['Location'<strong class="nh iu">,</strong>'Decision']).size().reset_index(name='Decision_qt')<br/>df2_yes = df2[df2['Decision']=='Yes']<br/>df2_yes.set_index('Location'<strong class="nh iu">, </strong>inplace=True)<br/><br/>fig = px.bar(df2<strong class="nh iu">,<br/>             </strong>x="Location"<strong class="nh iu">,<br/>             </strong>y="Decision_qt"<strong class="nh iu">,<br/>             </strong>color='Decision'<strong class="nh iu">,<br/>             </strong>barmode='stack')<br/>fig.show()</span></pre><p id="0407" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">同样，使用<strong class="lc iu"> <em class="nf"> groupby() </em> </strong>函数，我首先根据位置对我的行进行分组，然后进行决策，本质上是在一个组内创建一个组。我还创建了一个名为<strong class="lc iu"> Decision_qt </strong>的附加列，它保存每个位置的“是”和“否”答案的数量。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nu"><img src="../Images/e6e869578cb8d05b82258909b89a82d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFbWKC8u5ZLVL_xbSSc_-Q.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图由作者提供</p></figure><p id="8cb7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">除了芝加哥和达拉斯(所有参赛者都决定在那里结婚！)我们可以看到，地点对情侣的成功率影响不大。在这一点上，我要补充的是，我们只在每个地点调查大约 6 到 12 个人，更大的样本量会产生更可靠的信息…</p><h1 id="269b" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">已婚与离异比率条形图</h1><p id="3d13" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">现在，接下来我想调查的是在节目中结婚后离婚的人数。为了绘制这个比率，我需要遵循三个简单的步骤。</p><h2 id="1fa0" class="nl me it bd mf nv nw dn mj nx ny dp mn lj nz oa mp ln ob oc mr lr od oe mt of bi translated">准备第一个数据集</h2><p id="dfc2" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">我创建了一个 dataframe ' <strong class="lc iu"> df_married' </strong>，它根据位置和状态对行进行分组。我还创建了一个额外的列‘Maried _ Qt ’,每行包含已婚人口的总数。最后，我修改这个数据集，只保留已婚参与者的行。</p><pre class="kk kl km kn gt ng nh ni nj aw nk bi"><span id="44ef" class="nl me it nh b gy nm nn l no np">df_married = df.groupby(['Location'<strong class="nh iu">,</strong>'Status']).size().reset_index(name='Married_qt')<br/>df_married = df_married[df_married['Status']=='Married']</span></pre><h2 id="d68c" class="nl me it bd mf nv nw dn mj nx ny dp mn lj nz oa mp ln ob oc mr lr od oe mt of bi translated">准备第二个数据集</h2><p id="e8ea" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">现在我想统计每个地点的参与者总数。这也是通过使用<strong class="lc iu"> <em class="nf"> groupby() </em> </strong>函数并使用<strong class="lc iu"> size() </strong>函数对每个组中的行求和来实现的。</p><pre class="kk kl km kn gt ng nh ni nj aw nk bi"><span id="2259" class="nl me it nh b gy nm nn l no np">df3 = df.groupby(['Location']).size().reset_index(name='Participants_qt')</span></pre><h2 id="6e5b" class="nl me it bd mf nv nw dn mj nx ny dp mn lj nz oa mp ln ob oc mr lr od oe mt of bi translated">执行除法和绘图</h2><p id="91e5" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">为了执行分割，我们首先必须将两个数据帧的索引设置为位置(比率是在同一城市结婚和离婚的夫妇之间取得的)。除法的结果保存在名为“<strong class="lc iu"> ratio_Married </strong>”的列中</p><pre class="kk kl km kn gt ng nh ni nj aw nk bi"><span id="89aa" class="nl me it nh b gy nm nn l no np"># Division<br/>df_married.set_index('Location'<strong class="nh iu">, </strong>inplace=True)<br/>df3.set_index('Location'<strong class="nh iu">, </strong>inplace=True)</span><span id="f7d0" class="nl me it nh b gy nq nn l no np">df3['ratio_Married'] = (df_married['Married_qt'] / df3['Participants_qt'])</span><span id="4d91" class="nl me it nh b gy nq nn l no np"># Plotting<br/>df_married.reset_index(inplace = True)<br/>df3.reset_index(inplace = True)<br/>fig = px.bar(df3<strong class="nh iu">,<br/>             </strong>x='Location'<strong class="nh iu">,<br/>             </strong>y='ratio_Married'<strong class="nh iu">,<br/>             </strong>color='Location'<strong class="nh iu">,<br/>             </strong>barmode='stack')<br/># fig.show()</span></pre><p id="e0a1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">绘图时，从数据帧<strong class="lc iu"> df3 </strong>中分别在 x 轴和 y 轴选择数据帧对应的位置和比率列。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi og"><img src="../Images/6c73976ed2541e23e85dddd35434706d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jZaUaQcvIzNWn9FT-CjS4g.png"/></div></div></figure><p id="51e8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这个剧情没有前两个乐观。超过 50%同意结婚的夫妇后来离婚了。在亚特兰大和南佛罗里达，没有一个参赛者仍然和他/她的对手结婚…</p><h1 id="e68a" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">分步子情节特征</h1><p id="0ba8" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">这花了我一点时间才弄明白，这就是为什么我超级兴奋地分享！当试图比较和对比图或条形图时，创建支线剧情会非常有用。当东西放在一起时，潜在的关系可以很容易地显现出来。</p><p id="e417" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了制作一个有多个支线剧情的图形，第一步是指定支线剧情的数量和它们的位置。在我的例子中，我选择让我的数据在同一行不同列(并排)。类型<em class="nf">“xy”</em>表示坐标系(例如也可以是极坐标)。</p><pre class="kk kl km kn gt ng nh ni nj aw nk bi"><span id="7abf" class="nl me it nh b gy nm nn l no np">subfig = make_subplots(rows=<strong class="nh iu">1, </strong>cols=<strong class="nh iu">2,<br/>                    </strong>specs=[[{"type": "xy"}<strong class="nh iu">, </strong>{"type": "xy"}]])</span></pre><p id="60ee" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们创建两个子图，指定它们的轴和值。</p><h2 id="2312" class="nl me it bd mf nv nw dn mj nx ny dp mn lj nz oa mp ln ob oc mr lr od oe mt of bi translated">第一个副情节</h2><p id="fe1b" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">这和文章开头的<strong class="lc iu">是对否</strong>条形图一样。需要注意的是，plotly express 只支持 series。这意味着我需要使用<strong class="lc iu"> <em class="nf"> pd 将我想要绘制的信息从熊猫数据帧转换成一个系列。系列()</em> </strong>功能<strong class="lc iu"> <em class="nf">。</em>T15】</strong></p><pre class="kk kl km kn gt ng nh ni nj aw nk bi"><span id="4406" class="nl me it nh b gy nm nn l no np">df4 = df.groupby(["Decision"]).size().reset_index(name='Total_YesNo')<br/>y1=pd.Series(df4['Total_YesNo'])<br/><br/>subfig.add_bar(row=<strong class="nh iu">1, </strong>col=<strong class="nh iu">1,<br/>             </strong>y=y1<strong class="nh iu">,<br/>             </strong>x=["Yes"<strong class="nh iu">, </strong>"No"])</span></pre><h2 id="a2b9" class="nl me it bd mf nv nw dn mj nx ny dp mn lj nz oa mp ln ob oc mr lr od oe mt of bi translated">第二副情节</h2><p id="dbd7" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">在第二张图中，我绘制了每个位置的<strong class="lc iu">是对</strong>否的<strong class="lc iu">比率。x 轴和 y 轴值被转换成序列，并传递到子图上进行绘制。</strong></p><pre class="kk kl km kn gt ng nh ni nj aw nk bi"><span id="1da4" class="nl me it nh b gy nm nn l no np">df5 = df.groupby(['Location']).size().reset_index(name='Participants_qt')<br/>x2=pd.Series(df5['Location'])<br/>y2=pd.Series(df3['ratio_YesNo'])<br/><br/>subfig.add_bar( row=<strong class="nh iu">1, </strong>col=<strong class="nh iu">2,<br/>                </strong>x=x2<strong class="nh iu">,<br/>                </strong>y=y2)<br/>subfig.show()</span></pre><h2 id="8c61" class="nl me it bd mf nv nw dn mj nx ny dp mn lj nz oa mp ln ob oc mr lr od oe mt of bi translated">结果！</h2><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oh"><img src="../Images/ad57f97285f7c56aafe9ccc3e67a8a6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V-wz2ndkC6rwTkKFN4JAZA.png"/></div></div></figure><h1 id="49df" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">Github 知识库</h1><p id="7638" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">所有代码都可以在 Github <a class="ae kz" href="https://github.com/alejandra-gutierrez/Grad_Placements.git" rel="noopener ugc nofollow" target="_blank">上的<strong class="lc iu"> Married.py </strong>文件中找到</a>！</p><h1 id="d9ae" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">非常感谢你的阅读！</h1><p id="29b2" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">如果你喜欢我的作品，如果你能在这里跟随我，我将不胜感激。</p><p id="5b9b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您对如何改进有任何问题、建议或想法，请在下面留下评论或通过 LinkedIn <a class="ae kz" href="https://www.linkedin.com/in/alejandra-g-283595b8" rel="noopener ugc nofollow" target="_blank">这里</a>取得联系。</p></div></div>    
</body>
</html>