<html>
<head>
<title>Managing CUDA dependencies with Conda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Conda 管理 CUDA 依赖性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/managing-cuda-dependencies-with-conda-89c5d817e7e1?source=collection_archive---------1-----------------------#2020-05-14">https://towardsdatascience.com/managing-cuda-dependencies-with-conda-89c5d817e7e1?source=collection_archive---------1-----------------------#2020-05-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3f27" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在下一个数据科学项目中管理 CUDA 依赖性的“最佳实践”</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a8961a6af46358adc9116b11730ee324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Z17-1cWhO9wsx9eC9aRIA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Conda 大大简化了启动新的 GPU 加速数据科学项目。来源:作者</p></figure><p id="a469" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将数据科学项目从 CPU 转移到 GPU 似乎是一项艰巨的任务。特别是有相当多不熟悉的附加软件，比如<a class="ae lu" href="https://developer.nvidia.com/cuda-toolkit" rel="noopener ugc nofollow" target="_blank">英伟达 CUDA Toolkit </a>、<a class="ae lu" href="https://developer.nvidia.com/nccl" rel="noopener ugc nofollow" target="_blank">英伟达集体通信库(NCCL) </a>、<a class="ae lu" href="https://developer.nvidia.com/cudnn" rel="noopener ugc nofollow" target="_blank">英伟达深度神经网络库(cuDNN </a>)下载安装。</p><p id="6d8b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你去 NVIDIA 开发者网站，你会找到大量关于如何在系统范围内安装这些库的文档和说明。但是，如果您需要这些新库的不同版本用于不同的项目，您该怎么办呢？你<em class="lv">可以</em>在系统范围内安装一堆不同版本的 NVIDIA CUDA Toolkit、NCCL 和 cuDNN，然后使用环境变量来控制每个项目的“活动”版本，但这很麻烦且容易出错。幸运的是有更好的方法！</p><p id="4e68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇文章中，我将向你展示如何使用<a class="ae lu" href="https://docs.conda.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> Conda </a>管理 NVIDIA CUDA Toolkit、NCCL 和 cuDNN 的项目特定版本。我假设您对 Conda 有基本的了解，所以如果您还没有听说过 Conda 或者刚刚入门，我鼓励您阅读我的其他文章<a class="ae lu" rel="noopener" target="_blank" href="/managing-project-specific-environments-with-conda-b8b50aa8be0e"><em class="lv">Conda 入门</em> </a>和<a class="ae lu" rel="noopener" target="_blank" href="/managing-project-specific-environments-with-conda-406365a539ab"> <em class="lv">使用 Conda </em> </a> <em class="lv">管理您的数据科学项目。</em></p><h1 id="14a8" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">NVIDIA 库可以通过 Conda 获得吗？</h1><p id="84f3" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">没错。您可以使用<code class="fe mt mu mv mw b">conda search</code>命令查看默认渠道中有哪些版本的 NVIDIA CUDA Toolkit 可用。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="a222" class="nb lx it mw b gy nc nd l ne nf">$ conda search cudatoolkit</span><span id="1e94" class="nb lx it mw b gy ng nd l ne nf">Loading channels: done</span><span id="7848" class="nb lx it mw b gy ng nd l ne nf"># Name                       Version           Build  Channel<br/>cudatoolkit                      9.0      h13b8566_0  pkgs/main<br/>cudatoolkit                      9.2               0  pkgs/main<br/>cudatoolkit                 10.0.130               0  pkgs/main<br/>cudatoolkit                 10.1.168               0  pkgs/main<br/>cudatoolkit                 10.1.243      h6bb024c_0  pkgs/main<br/>cudatoolkit                  10.2.89      hfd86e86_0  pkgs/main<br/>cudatoolkit                  10.2.89      hfd86e86_1  pkgs/main</span></pre><p id="5b05" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">NVIDIA 实际上维护着自己的 Conda 通道，默认通道中可用的 CUDA Toolkit 版本与 NVIDIA 通道中的版本相同。如果您有兴趣确认这一点，您可以运行命令<code class="fe mt mu mv mw b">conda search --channel nvidia cudatoolkit</code>，然后将构建号与上面列出的默认通道中的构建号进行比较。</p><p id="8158" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">默认或 NVIDIA Conda 渠道提供的 NVIDIA CUDA 工具包版本的一个重要限制是它们<a class="ae lu" href="https://stackoverflow.com/questions/56470424/nvcc-missing-when-installing-cudatoolkit" rel="noopener ugc nofollow" target="_blank">不包括 NVIDIA CUDA 编译器(NVCC) </a>。</p><h2 id="db57" class="nb lx it bd ly nh ni dn mc nj nk dp mg lh nl nm mi ll nn no mk lp np nq mm nr bi translated">cuDNN 呢？</h2><p id="644d" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">您还可以从默认渠道找到各种版本的 cuDNN。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="19d4" class="nb lx it mw b gy nc nd l ne nf">$ conda search cudnn</span><span id="a16a" class="nb lx it mw b gy ng nd l ne nf">Loading channels: done</span><span id="bab4" class="nb lx it mw b gy ng nd l ne nf"># Name                       Version           Build  Channel<br/>cudnn                          7.0.5       cuda8.0_0  pkgs/main<br/>cudnn                          7.1.2       cuda9.0_0  pkgs/main<br/>cudnn                          7.1.3       cuda8.0_0  pkgs/main<br/>cudnn                          7.2.1       cuda9.2_0  pkgs/main<br/>cudnn                          7.3.1      cuda10.0_0  pkgs/main<br/>cudnn                          7.3.1       cuda9.0_0  pkgs/main<br/>cudnn                          7.3.1       cuda9.2_0  pkgs/main<br/>cudnn                          7.6.0      cuda10.0_0  pkgs/main<br/>cudnn                          7.6.0      cuda10.1_0  pkgs/main<br/>cudnn                          7.6.0       cuda9.0_0  pkgs/main<br/>cudnn                          7.6.0       cuda9.2_0  pkgs/main<br/>cudnn                          7.6.4      cuda10.0_0  pkgs/main<br/>cudnn                          7.6.4      cuda10.1_0  pkgs/main<br/>cudnn                          7.6.4       cuda9.0_0  pkgs/main<br/>cudnn                          7.6.4       cuda9.2_0  pkgs/main<br/>cudnn                          7.6.5      cuda10.0_0  pkgs/main<br/>cudnn                          7.6.5      cuda10.1_0  pkgs/main<br/>cudnn                          7.6.5      cuda10.2_0  pkgs/main<br/>cudnn                          7.6.5       cuda9.0_0  pkgs/main<br/>cudnn                          7.6.5       cuda9.2_0  pkgs/main</span></pre><h2 id="fdaa" class="nb lx it bd ly nh ni dn mc nj nk dp mg lh nl nm mi ll nn no mk lp np nq mm nr bi translated">NCCL 怎么样？</h2><p id="768f" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">默认频道有一些旧版本的 NCCL，但这些版本不会有用(除非你被迫使用非常旧版本的 TensorFlow 或类似软件)。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="760a" class="nb lx it mw b gy nc nd l ne nf">$ conda search nccl</span><span id="033f" class="nb lx it mw b gy ng nd l ne nf">Loading channels: done</span><span id="c1f2" class="nb lx it mw b gy ng nd l ne nf"># Name                       Version           Build  Channel<br/>nccl                           1.3.5      cuda10.0_0  pkgs/main<br/>nccl                           1.3.5       cuda9.0_0  pkgs/main<br/>nccl                           1.3.5       cuda9.2_0  pkgs/main</span></pre><p id="c1ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不要担心！<a class="ae lu" href="https://conda-forge.org/" rel="noopener ugc nofollow" target="_blank">康达锻造</a>来救援。Conda Forge 是一个由社区主导的食谱、构建基础设施和 Conda 包管理器发行版的集合。当我在默认频道上找不到我需要的节目时，我总是会检查频道。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="8c1b" class="nb lx it mw b gy nc nd l ne nf">$ conda search -c conda-forge nccl</span><span id="51e7" class="nb lx it mw b gy ng nd l ne nf">Loading channels: done</span><span id="fdc4" class="nb lx it mw b gy ng nd l ne nf"># Name                       Version           Build  Channel<br/>nccl                           1.3.5      cuda10.0_0  pkgs/main<br/>nccl                           1.3.5       cuda9.0_0  pkgs/main<br/>nccl                           1.3.5       cuda9.2_0  pkgs/main<br/>nccl                         2.4.6.1      h51cf6c1_0  conda-forge<br/>nccl                         2.4.6.1      h7cc98d6_0  conda-forge<br/>nccl                         2.4.6.1      hc6a2c23_0  conda-forge<br/>nccl                         2.4.6.1      hd6f8bf8_0  conda-forge<br/>nccl                         2.4.7.1      h51cf6c1_0  conda-forge<br/>nccl                         2.4.7.1      h7cc98d6_0  conda-forge<br/>nccl                         2.4.7.1      hd6f8bf8_0  conda-forge<br/>nccl                         2.4.8.1      h51cf6c1_0  conda-forge<br/>nccl                         2.4.8.1      h51cf6c1_1  conda-forge<br/>nccl                         2.4.8.1      h7cc98d6_0  conda-forge<br/>nccl                         2.4.8.1      h7cc98d6_1  conda-forge<br/>nccl                         2.4.8.1      hd6f8bf8_0  conda-forge<br/>nccl                         2.4.8.1      hd6f8bf8_1  conda-forge<br/>nccl                         2.5.6.1      h51cf6c1_0  conda-forge<br/>nccl                         2.5.6.1      h7cc98d6_0  conda-forge<br/>nccl                         2.5.6.1      hc6a2c23_0  conda-forge<br/>nccl                         2.5.6.1      hd6f8bf8_0  conda-forge<br/>nccl                         2.5.7.1      h51cf6c1_0  conda-forge<br/>nccl                         2.5.7.1      h7cc98d6_0  conda-forge<br/>nccl                         2.5.7.1      hc6a2c23_0  conda-forge<br/>nccl                         2.5.7.1      hd6f8bf8_0  conda-forge<br/>nccl                         2.6.4.1      h51cf6c1_0  conda-forge<br/>nccl                         2.6.4.1      h7cc98d6_0  conda-forge<br/>nccl                         2.6.4.1      hc6a2c23_0  conda-forge<br/>nccl                         2.6.4.1      hd6f8bf8_0  conda-forge</span></pre><h1 id="7252" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">一些示例 Conda 环境文件</h1><p id="bdcf" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">现在你已经知道如何找出各种 NVIDIA CUDA 库的哪些版本在哪些频道上可用，你已经准备好编写你的<code class="fe mt mu mv mw b">environment.yml</code>文件了。在本节中，我将提供 PyTorch、TensorFlow 和 NVIDIA RAPIDS 的一些示例 Conda 环境文件，以帮助您开始下一个 GPU 数据科学项目。</p><h2 id="ffbf" class="nb lx it bd ly nh ni dn mc nj nk dp mg lh nl nm mi ll nn no mk lp np nq mm nr bi translated">PyTorch</h2><p id="6aec" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated"><a class="ae lu" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>是基于 Torch 库的开源机器学习库，用于计算机视觉、自然语言处理等应用。它主要由脸书人工智能研究实验室开发。Conda 其实就是<a class="ae lu" href="https://pytorch.org/get-started/locally/" rel="noopener ugc nofollow" target="_blank">推荐的安装 PyTorch 的方式</a>。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="0304" class="nb lx it mw b gy nc nd l ne nf">name: null</span><span id="845b" class="nb lx it mw b gy ng nd l ne nf">channels:<br/>  - pytorch<br/>  - conda-forge<br/>  - defaults</span><span id="280c" class="nb lx it mw b gy ng nd l ne nf">dependencies:<br/>  - cudatoolkit=10.1<br/>  - mpi4py=3.0 # installs cuda-aware openmpi<br/>  - pip=20.0<br/>  - python=3.7<br/>  - pytorch=1.5<br/>  - torchvision=0.6</span></pre><p id="ef58" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">官方的 PyTorch 二进制文件附带了 NCCL 和 cuDNN，所以没有必要在你的<code class="fe mt mu mv mw b">environment.yml</code>文件中包含这些库(除非其他一些包也需要这些库！).还要注意频道优先级:官方<code class="fe mt mu mv mw b">pytorch</code>频道必须优先于<code class="fe mt mu mv mw b">conda-forge</code>频道，以确保官方 PyTorch 二进制文件(包括 NCCL 和 cuDNN)将被安装(否则你将在<code class="fe mt mu mv mw b">conda-forge</code>获得一些非官方版本的 PyTorch)。</p><h2 id="9604" class="nb lx it bd ly nh ni dn mc nj nk dp mg lh nl nm mi ll nn no mk lp np nq mm nr bi translated">张量流示例</h2><p id="b960" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated"><a class="ae lu" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a>是一个免费的开源软件库，用于数据流和跨一系列任务的差异化编程。它是一个符号数学库，也用于机器学习应用，如神经网络。</p><p id="1acd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过 Conda 可以获得 TensorFlow 的很多版本和构建(<code class="fe mt mu mv mw b">conda search tensorflow</code>的输出太长，无法在此分享！).如何决定哪个版本是“正确的”版本？如何确保你得到一个包含 GPU 支持的构建？</p><p id="0a1c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用<code class="fe mt mu mv mw b">tensorflow-gpu</code>元包为您的操作系统选择合适的 TensorFlow 版本和版本。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="90be" class="nb lx it mw b gy nc nd l ne nf">name: null<br/><br/>channels:<br/>  - conda-forge<br/>  - defaults<br/><br/>dependencies:<br/>  - cudatoolkit=10.1<br/>  - cudnn=7.6<br/>  - cupti=10.1<br/>  - mpi4py=3.0 # installs cuda-aware openmpi<br/>  - nccl=2.4<br/>  - pip=20.0<br/>  - python=3.7<br/>  - tensorflow-gpu=2.1 # installs tensorflow=2.1=gpu_py37h7a4bb67_0</span></pre><h2 id="3f39" class="nb lx it bd ly nh ni dn mc nj nk dp mg lh nl nm mi ll nn no mk lp np nq mm nr bi translated">BlazingSQL + NVIDIA RAPIDS 示例</h2><p id="55bf" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">作为最后一个例子，我想告诉你如何开始与<a class="ae lu" href="https://rapids.ai/index.html" rel="noopener ugc nofollow" target="_blank">英伟达急流</a>(和朋友！).</p><p id="81fb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">NVIDIA RAPIDS 是一套开源软件库和 API，让您能够完全在 GPU 上执行端到端的数据科学和分析管道(想想<a class="ae lu" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫</a> + <a class="ae lu" href="https://scikit-learn.org/stable/index.html" rel="noopener ugc nofollow" target="_blank"> Scikit-learn </a>，但针对的是 GPU 而不是 CPU)。</p><p id="904e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我还在这个示例环境文件中包含了<a class="ae lu" href="https://www.blazingsql.com/" rel="noopener ugc nofollow" target="_blank"> BlazingSQL </a>。BlazingSQL 是一个开源的 SQL 接口，可以使用 NVIDIA RAPIDS 将海量数据集直接提取-转换-加载(ETL)到 GPU 内存中进行分析。安装 BlazingSQL 以便它能与 NVIDIA RAPIDS 一起正常工作比大多数 Conda 软件包安装要稍微复杂一些，所以我决定在这里包含一个工作示例。</p><p id="6635" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，上面的环境还包括<a class="ae lu" href="https://datashader.org/" rel="noopener ugc nofollow" target="_blank"> Datashader </a>，这是一个图形管道系统，用于快速灵活地创建大型数据集的有意义的表示，可以通过 GPU 加速。如果你打算在 GPU 上进行所有的数据分析，你也可以在 GPU 上进行数据可视化。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="5b96" class="nb lx it mw b gy nc nd l ne nf">name: null </span><span id="6932" class="nb lx it mw b gy ng nd l ne nf">channels:  <br/>  - blazingsql<br/>  - rapidsai<br/>  - nvidia<br/>  - conda-forge<br/>  - defaults</span><span id="3588" class="nb lx it mw b gy ng nd l ne nf">dependencies:  <br/>  - blazingsql=0.13<br/>  - cudatoolkit=10.1<br/>  - datashader=0.10<br/>  - pip=20.0<br/>  - python=3.7<br/>  - rapids=0.13</span></pre><h1 id="f739" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">但是如果我需要 NVIDIA CUDA 编译器呢？</h1><p id="2913" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">在本文的开头，我提到了默认渠道提供的 NVIDIA CUDA Toolkit 版本不包括 NVIDIA CUDA 编译器(NVCC)。然而，如果您的数据科学项目有需要编译自定义 CUDA 扩展的依赖项，那么您几乎肯定会需要 NVIDIA CUDA 编译器(NVCC)。</p><p id="a315" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您如何知道您的项目依赖项需要 NVCC？很有可能你会尝试上面的标准方法，而 Conda 将无法成功地创建环境，并可能抛出一堆编译器错误。一旦你知道你需要 NVCC，有几种方法可以安装 NVCC 编译器。</p><h2 id="018d" class="nb lx it bd ly nh ni dn mc nj nk dp mg lh nl nm mi ll nn no mk lp np nq mm nr bi translated">试试 cudatoolkit-dev 包</h2><p id="2eab" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">从<code class="fe mt mu mv mw b">conda-forge</code>渠道获得的<code class="fe mt mu mv mw b">cudatoolkit-dev</code>包包括 GPU 加速库、调试和优化工具、C/C++编译器和运行时库。这个包包含一个安装后脚本，用于下载和安装完整的 CUDA 工具包(NVCC 编译器和库，但不包括 CUDA 驱动程序)。</p><p id="f774" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然<code class="fe mt mu mv mw b">conda-forge</code>提供的<code class="fe mt mu mv mw b">cudatoolkit-dev</code>包确实包括 NVCC，但我很难让这些包持续正确地安装。</p><ul class=""><li id="53f0" class="ns nt it la b lb lc le lf lh nu ll nv lp nw lt nx ny nz oa bi translated">一些可用的构建需要手动干预来接受许可协议，这使得这些构建不适合安装在远程系统上(这是关键的功能)。</li><li id="9c28" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">其他一些版本似乎可以在 Ubuntu 上运行，但不能在其他版本的 Linux 上运行，比如 CentOS。</li><li id="ddd6" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">其他依赖 CUDA 的 Conda 包通常会安装<code class="fe mt mu mv mw b">cudatoolkit</code>包，即使这个包中包含的所有东西都已经通过<code class="fe mt mu mv mw b">cudatoolkit-dev</code>安装了。</li></ul><p id="3cf3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">也就是说，首先尝试<code class="fe mt mu mv mw b">cudatoolkit-dev</code>方法总是值得的。也许对你的用例有用。</p><p id="1a22" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是一个使用通过<code class="fe mt mu mv mw b">cudatoolkit-dev</code>包安装的 NVCC 来编译来自<a class="ae lu" href="https://github.com/rusty1s/pytorch_cluster" rel="noopener ugc nofollow" target="_blank"> PyTorch 集群</a>的定制扩展的例子，PyTorch 集群是一个高度优化的图形集群算法的小型扩展库，用于与<a class="ae lu" href="http://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>一起使用。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="9432" class="nb lx it mw b gy nc nd l ne nf">name: null<br/><br/>channels:<br/>  - pytorch<br/>  - conda-forge<br/>  - defaults<br/><br/>dependencies:<br/>  - cudatoolkit-dev=10.1<br/>  - cxx-compiler=1.0<br/>  - matplotlib=3.2<br/>  - networkx=2.4<br/>  - numba=0.48<br/>  - pandas=1.0<br/>  - pip=20.0<br/>  - pip:<br/>    - -r file:requirements.txt<br/>  - python=3.7<br/>  - pytorch=1.4<br/>  - scikit-image=0.16<br/>  - scikit-learn=0.22<br/>  - tensorboard=2.1<br/>  - torchvision=0.5</span></pre><p id="9344" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面引用的<code class="fe mt mu mv mw b">requirements.txt</code>文件包含 PyTorch 集群和相关包，如<a class="ae lu" href="https://pytorch-geometric.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> PyTorch Geometric </a>。这是该文件的样子。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="de1f" class="nb lx it mw b gy nc nd l ne nf">torch-scatter==2.0.*<br/>torch-sparse==0.6.*<br/>torch-spline-conv==1.2.*<br/>torch-cluster==1.5.*<br/>torch-geometric==1.4.*</span><span id="3d98" class="nb lx it mw b gy ng nd l ne nf"># make sure the following are re-compiled if environment is re-built<br/>--no-binary=torch-scatter<br/>--no-binary=torch-sparse<br/>--no-binary=torch-spline-conv<br/>--no-binary=torch-cluster<br/>--no-binary=torch-geometric</span></pre><p id="0ea8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里使用的<code class="fe mt mu mv mw b">--no-binary</code>选项确保了无论何时重建环境，都将重建带有自定义扩展的包，这有助于在从工作站移植到可能具有不同操作系统的远程集群时，提高环境构建过程的可重复性。</p><h2 id="bc2f" class="nb lx it bd ly nh ni dn mc nj nk dp mg lh nl nm mi ll nn no mk lp np nq mm nr bi translated">一般来说，使用 nvcc_linux-64 元包</h2><p id="acd0" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">获得 NVCC 并仍然使用 Conda 管理所有其他依赖项的最可靠方法是在您的系统上安装 NVIDIA CUDA Toolkit，然后安装来自<code class="fe mt mu mv mw b">conda-forge</code>的元包<code class="fe mt mu mv mw b"><a class="ae lu" href="https://anaconda.org/nvidia/nvcc_linux-64" rel="noopener ugc nofollow" target="_blank">nvcc_linux-64</a></code>，该元包配置您的 Conda 环境，以使用安装在您系统上的 NVCC 以及安装在 Conda 环境中的其他 CUDA Toolkit 组件。虽然我发现这种方法比依靠<code class="fe mt mu mv mw b">cudatoolkit-dev</code>更健壮，但这种方法更复杂，因为它需要首先在您的系统上安装特定版本的 NVIDIA CUDA Toolkit。</p><p id="011a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要查看这种方法的完整示例，请看我最近的文章<a class="ae lu" rel="noopener" target="_blank" href="/building-a-conda-environment-for-horovod-773bd036bf64"> <em class="lv">为 Horovod </em> </a> <em class="lv">构建 Conda 环境。</em></p><h1 id="113b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">摘要</h1><p id="a923" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我在这篇文章中涉及了很多内容。我向您展示了如何使用<code class="fe mt mu mv mw b">conda search</code>来查看哪些版本的 NVIDIA CUDA Toolkit 和相关库(如 NCCL 和 cuDNN)可通过 Conda 获得。然后，我向您介绍了几个可以使用 GPU 的流行数据科学框架的示例 Conda 环境文件。希望这些想法能帮助你在下一个数据科学项目中从 CPU 跳到 GPU！</p></div></div>    
</body>
</html>