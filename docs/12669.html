<html>
<head>
<title>Solving Multiclass Classification Problem with Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用机器学习解决多类分类问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-to-help-water-crisis-24f40b628531?source=collection_archive---------65-----------------------#2020-08-31">https://towardsdatascience.com/machine-learning-to-help-water-crisis-24f40b628531?source=collection_archive---------65-----------------------#2020-08-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="44fe" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用 Python 预测坦桑尼亚的水点状况</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ad4565004616d004f3777bc0e0cd5700.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*evwVzStPxIWaEOy4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">玛格达莱娜·库拉·曼切在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9b7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据 Water.org<a class="ae ky" href="https://water.org/" rel="noopener ugc nofollow" target="_blank">和国际生命之水</a>的数据，在坦桑尼亚 5700 万人口中，有 2500 万人无法获得安全的饮用水。妇女和儿童必须每天多次前往取水，而水源的安全甚至没有保障。2004 年，坦桑尼亚 12%的死亡是由水传播疾病造成的。</p><p id="cd62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管为解决坦桑尼亚的水危机付出了多年努力和大量资金，但问题依然存在。使用可收集的数据预测坦桑尼亚供水点状况的能力将使我们能够制定计划，有效地利用资源来发展可持续的基础设施，这将影响许多人的生活。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6dee" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">数据</h1><p id="ccfa" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">作为解决这一问题的一项举措，<a class="ae ky" href="https://www.drivendata.org/competitions/" rel="noopener ugc nofollow" target="_blank"> DrivenData </a>利用开源平台<a class="ae ky" href="http://taarifa.org/" rel="noopener ugc nofollow" target="_blank"> Taarifa </a>从坦桑尼亚水利部收集的数据，发起了一场基于勘探的竞赛。该项目的目标是预测三种不同类别的每个供水点的状态:功能正常、不正常和需要修复。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/fdc8a731f592cded0ae6f6a5dfa10965.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*8Omw60KIL1XFEZNPYMM7cA.png"/></div></figure><p id="b244" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的数据集显示，59，400 个供水点中有 62%有功能，而 38%没有功能。在这些功能性供水点中，12%需要维修。</p><h1 id="3375" class="mc md it bd me mf na mh mi mj nb ml mm jz nc ka mo kc nd kd mq kf ne kg ms mt bi translated">探索性数据分析</h1><p id="c1b7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在清理了数据并处理了缺失值和异常值之后，我们研究了单个要素如何与水点的状况相关联。以下是我们探索性数据分析的一些观察结果。</p><h2 id="8dee" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">旧的供水点没有得到维护</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/b6146aec7b6644d0daceb36e4ec7babc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*BHw5Xz8FfsLy9E5Sqq6QuQ.png"/></div></figure><p id="f97d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是不同建设年份的用水点分布。我们可以看到，大多数可以使用的供水点都是最近建成的，这可能是因为近年来投入了大量资金。但是，事实上，即使是最近建成的核电站也有可能不像旧的核电站那样发挥作用，这是非常令人担忧的。</p><h2 id="2762" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">付款事宜。</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/fab6ae0fe9497d1931e98531f3d79e59.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*DaHItPFlNpYDmr3xlMPjKg.png"/></div></figure><p id="26dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">稳定的付款计划似乎是一个强有力的指标，表明供水点是否会得到维持。问题是，虽然维护供水点的责任留给了每个社区，但坦桑尼亚的大多数社区没有足够的钱来维护这些供水点。</p><h2 id="d72f" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">位置很重要</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/e1855ba99a6dcf8262e7fe0c1eacb7c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SXdvHSMsIQcBB-4XYT5ZyA.png"/></div></div></figure><p id="a43c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据坦桑尼亚的这张地图，我们可以看到水点条件往往集中在不同的区域。这告诉我们，位置是这个问题的重要预测因素。</p><h1 id="9c08" class="mc md it bd me mf na mh mi mj nb ml mm jz nc ka mo kc nd kd mq kf ne kg ms mt bi translated">特征工程</h1><p id="ed9e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">基于我们的探索性数据分析，我们决定扩展包含位置信息的特性。首先，我们根据它的名字找到了盆地的位置，并计算了从水点到盆地的距离。</p><p id="c674" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<a class="ae ky" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> Geopy </a>的<a class="ae ky" href="https://nominatim.org/" rel="noopener ugc nofollow" target="_blank">的</a>包找到位置，该包使用 OpenStreetMap 数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="e7a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们使用<a class="ae ky" href="https://geopy.readthedocs.io/en/stable/#module-geopy.distance" rel="noopener ugc nofollow" target="_blank">测地线</a>距离 Geopy 计算距离。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="9e49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们还设计了其他几个特征，包括位置是在城市还是农村地区，以及村里其他井的总数。</p><h1 id="03bb" class="mc md it bd me mf na mh mi mj nb ml mm jz nc ka mo kc nd kd mq kf ne kg ms mt bi translated">预处理</h1><h2 id="ddd3" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">重采样</h2><p id="6eb7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们的数据有一个等级不平衡的问题，这意味着功能水点比需要修复的水点多得多。这可能会使预测偏向多数类，因此我们使用 SMOTE(合成少数过采样技术)对数据进行重新采样。简而言之，通过合成与同一类中现有样本距离较近的新样本，对过采样进行 SMOTE。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="635d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了重采样之外，我们还将分类特征转换为二元虚拟特征，并对所有特征进行标准化。</p><h2 id="b39d" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">特征选择</h2><p id="2682" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们的原始数据有许多分类特征，这导致在对分类特征进行一次热编码后产生相对大量的特征。为了优化计算，我们决定运行基于树的特征选择。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3d17" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">模型评估</h1><h2 id="0348" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">评估指标</h2><p id="b585" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">决定与项目目标一致的评估指标是非常重要的(如果您需要复习，请参见这里的<a class="ae ky" rel="noopener" target="_blank" href="/evaluation-metrics-for-classification-cdea775c97d4"/>)。我们处理这个问题有两个主要目的，一个是建立一个具有最高整体精度的模型，另一个是建立一个成功预测维修需求的模型。后者很重要，因为准确预测维修需求与影响坦桑尼亚许多人生活的变化直接相关。但是在这篇文章中，我将从整体准确性的角度来评估模型。</p><h2 id="4cdc" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">虚拟分类器</h2><p id="5465" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，我们首先安装一个虚拟分类器作为基线模型。我们的虚拟分类器使用分层方法，这意味着它根据每个类别的比例进行预测。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="d01c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">请注意，这段代码中的 X_test 指的是我们的验证集。我们已经搁置了维持集，以便在最后测试最终模型。</em></p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="319a" class="nf md it nx b gy ob oc l od oe"><strong class="nx iu"># Dummy result: Accuracy:  0.33</strong></span></pre><p id="0dc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的假人表现出大约 33%的准确性，这是假人对三个类别进行分类的预期性能。</p><h2 id="404f" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">k-最近邻</h2><p id="3a3a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们测试的第一个模型是 K 近邻(KNN)。KNN 基于第<em class="nv"> k </em>个最接近观测值的类别进行分类。超参数调谐是通过<a class="ae ky" href="https://optuna.org/" rel="noopener ugc nofollow" target="_blank"> Optuna </a>实现的。我们测试了 GridSearchCV 和 Optuna 的性能，发现 Optuna 更加通用和高效。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="285f" class="nf md it nx b gy ob oc l od oe"><strong class="nx iu"># KNN Result - Accuracy: 0.752</strong></span></pre><h2 id="35fe" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">随机森林分类器</h2><p id="cdcd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">接下来，我们用 Optuna 超调测试了随机森林分类器。随机森林在数据子集上同时拟合多个决策树，然后聚合结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="309e" class="nf md it nx b gy ob oc l od oe"><strong class="nx iu"># Random Forest Results - Accuracy : 0.74</strong></span></pre><p id="3948" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个问题，KNN 的性能优于随机森林分类器。但是，尽管这里没有报道，随机森林分类器在对少数民族分类方面比 KNN 分类器做得好得多。</p><h2 id="a22a" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">XGBoost</h2><p id="02f0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">因为我们测试了一个打包方法，所以我们也使用 XGBoost 测试了一个增强方法。这是一个梯度推进模型的实现，它根据预测误差迭代训练弱学习者。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="942c" class="nf md it nx b gy ob oc l od oe"><strong class="nx iu"># XGBoost Results - Accuracy: 0.78</strong></span></pre><p id="3d71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">XGboost 在准确性得分方面有所提高，其预测少数民族类别的敏感性也高于其他两个模型。</p><h2 id="50ab" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">投票分类器</h2><p id="2942" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后，我们将所有之前的模型进行投票。当使用投票分类器时，我们可以结合每个模型对每个类别概率的预测(软)或使用其对每个类别的二元选择(硬)。在这里，我们使用软投票。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="b716" class="nf md it nx b gy ob oc l od oe"><strong class="nx iu"># Voting Classifier - Accuracy: 0.79</strong></span></pre><p id="2ea6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">投票分类器为少数类返回稍高的准确度和相似的召回率。我们决定继续使用投票分类器作为我们的最终模型，并测试维持测试集。</p><h1 id="01dc" class="mc md it bd me mf na mh mi mj nb ml mm jz nc ka mo kc nd kd mq kf ne kg ms mt bi translated">最终模型性能</h1><p id="24b5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们的最终模型显示<strong class="lb iu">对维持组的预测准确率</strong>为 80%(基线为 45%),对少数类的召回率接近 50%,比基线模型的 6%召回率有了显著提高。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/0d8a97d43457e999080ff869b53c065e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gw78TiZ0AL8Dm_P3"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@ngoziassata?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> ngozi Assata </a>拍摄</p></figure><h1 id="7ca9" class="mc md it bd me mf na mh mi mj nb ml mm jz nc ka mo kc nd kd mq kf ne kg ms mt bi translated">额外奖励:口译</h1><p id="5a19" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">因为我们的最终模型涉及在距离算法和基于树的集成之间投票，所以很难解释我们模型的特征重要性。但是，使用弹性网络正则化和 SGD 训练的逻辑回归的附加分析表明，足够的水量、公共竖管的使用和最近建成是功能性供水点的重要预测因素。</p><p id="5ec8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，位置是非功能性供水点的重要预测因素。尤其是靠近维多利亚湖的一些北部地区，与无法运行的供水点高度相关。最后，非功能性和需要修复的水点之间的 GPS 高度显示出不同的模式。有必要进行进一步的调查，以确定 GPS 高度的重要性，无论它是否与特定的政府区域相关，或者可访问性的差异，或者它是否对某些提取类型有任何技术影响。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="a8a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个项目是与我的同事 dolcikey 合作完成的。</p></div></div>    
</body>
</html>