<html>
<head>
<title>I’m going on a (data) adventure! — Hobbit text analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我要去(数据)冒险了！—霍比特文本分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/im-going-on-a-data-adventure-hobbit-text-analysis-a0a5cb116ed1?source=collection_archive---------50-----------------------#2020-04-21">https://towardsdatascience.com/im-going-on-a-data-adventure-hobbit-text-analysis-a0a5cb116ed1?source=collection_archive---------50-----------------------#2020-04-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5c57" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">解释自然语言处理技术的整本书的数据分析。</h2></div><p id="8e28" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我分析了J. R. R .托尔金的书《霍比特人》的全文。我主要关注的是提取关于书籍情感的信息，以及熟悉NLP的技术之一——文本分块。我们将回答谁是这本书的主角，情绪如何随着每一章而变化，以及-哪一对矮人在一起出现的次数最多！</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi le"><img src="../Images/dc61e8f0ea88bdc0b7517d8a88f514ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*qNBtrK0as98fXyFuAXMTQw.png"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated"><a class="ae lq" href="https://www.warnerbros.com/movies/hobbit-unexpected-journey/" rel="noopener ugc nofollow" target="_blank"> <em class="lr">《霍比特人:意外之旅》</em> </a></p></figure><h1 id="4769" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">探索性分析</h1><p id="4f8e" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">快速浏览一下数据总是应该的。它有助于了解我们在处理什么，验证数据质量，但也允许一些初步的见解。通过对句子进行分词，我得到它们的总数是4915。它们分为18章。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mp"><img src="../Images/a56c3b3f5fad8d49c14f4d47a2fc0fb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P9glIm70Ycv6_JMTCxxwcg.png"/></div></div></figure><p id="36e4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每章的句子数量变化很大。最短的一章有150个句子长，最长的一章有三倍多。我们可以看到，当章节从第三章到第十章变得更长时，“情节变得越来越复杂”。然后，随着两个急剧的变化，它们的长度逐渐变短。从句子长度来看，稳定性要高得多。最低平均句子长度和最高平均句子长度的最大差异在30%左右(句子最短的章节平均在45左右，最长的在60字左右)。如果我们仔细观察，细微的差别显示了一个类似的章节长度模式——最长的句子在第八章到第十章。最短的——第三、第十一、第十四和最后一个。我对散文的句子长度做了一个小小的研究，建议(例如这里的<a class="ae lq" href="http://countwordsworth.com/blog/what-is-a-good-average-sentence-length/" rel="noopener ugc nofollow" target="_blank"/>)平均长度应该在15-20个单词之间。如果我们把这作为一个参考，托尔金的写作风格是明显不同的。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mu"><img src="../Images/07aff835348599f401f1107dbe6926d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IHO35vIYLK6oeEqQ0KWZrA.png"/></div></div></figure><h1 id="da7c" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">情感分析</h1><p id="c972" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">我开始为文本中的每一个句子获得一个情感分数。为了这个目的，我使用了一种叫做VADER的方法，它可以在nltk . perspective包中找到。通过调用<em class="mv">sentimentintensitiyanalysizer</em>上的<em class="mv"> polarity_scores </em>，我们得到4个分数:复合、正、负和新。复合分数是一个一维的标准化句子分数，基于<a class="ae lq" href="https://github.com/cjhutto/vaderSentiment/blob/master/vaderSentiment/vader_lexicon.txt" rel="noopener ugc nofollow" target="_blank">词典</a>中单词的等级。它的取值范围是-1到1。根据标准，一个句子被认为是中性的，复合得分在-0.05到0.05之间——高于0.05的都是积极的，低于0.05的都是消极的。Pos、neg和neu是可以被分配到每个类别中的文本的比例，并且总和为1。</p><p id="ca8d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">出于这个分析的目的，我将使用复合分数，但在分析之前，让我们看看它在Hobbit文本上是如何工作的(这四个数字分别是:复合分数、正分数、负分数和新分数):</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mw"><img src="../Images/bf0d6b2ae7ddca51fa708819dfa24213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xG89a47tuokielyjYy26jw.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">《霍比特人》中最多的肯定句和否定句</p></figure><p id="f0f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我觉得下面的配乐很搞笑:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mx"><img src="../Images/af6b57e842b0c42559e44c3ff817af98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bp-LKGno1NGQ3tZTRobfJA.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">句子及其复合词、词性、否定词和neu分值。</p></figure><p id="6703" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我完全支持，每个人都应该有选择。但另一方面，它显示了这种方法的缺陷。似乎因为这个句子太短，所以它受到了“不”的严重影响，而句子本身是一个完全中立的陈述。知道这些句子平均至少有40个单词长，我有足够的信心在分析中使用这种方法。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi my"><img src="../Images/180a7a2a0c826e41a2a1fea36b512a96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YOFgIcW1Wa4ouWCdqTzD_g.png"/></div></div></figure><p id="b1c2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看上面的情节，我们可以看到小说以积极的情绪开始，可能是对开始旅程的兴奋。然后，它大部分保持在中性范围内，只达到一次负分，然后再次以正数结束。</p><p id="4310" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们更详细地看看每一章和句子的百分比。一般来说，肯定句占所有句子的25%到40%，否定句占30%左右。虽然每一个情绪组按章节划分的比例没有强烈的波动，但我在肯定句的百分比中发现了一个有趣的模式。除了一个例外，每一次增加都伴随着肯定句百分比的下降，反之亦然。会不会是整本书不断变化的氛围在戏弄读者？这是一个很长的镜头，但情节讲述了一个很好的故事。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mz"><img src="../Images/e31c916c9b77922bd21fbe8e7484228e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*G-fJMgCMpcTWZCWZ"/></div></div></figure><h1 id="3640" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">文本分块</h1><p id="51b3" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">根据定义，组块需要多音序列来分割和标记它们。这个想法变得简单时，显示了一个例子。</p><h1 id="0fa6" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">1.命名实体</h1><p id="5e7e" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">在第一次尝试中，我们将以自动方式从文本中提取命名实体——我知道书中的人物，并且可以列出他们，但是很容易错过一些重要的东西。这个任务变得更加简单，因为在库中提供了一个<em class="mv"> nltk.ne_chunk() </em>函数来实现这个目的。</p><p id="57d1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于输入，我们需要准备一个句子，其中每个单词都转化为一个单词及其词性标签的元组，例如:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi na"><img src="../Images/47247620df0213e47a090c0353efeb41.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/0*g3qrBJ32xlFvshJO"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">多音标记句</p></figure><p id="3c25" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当把句子的每个单词输入到<em class="mv"> nltk.ne_chunk() </em>时，我们得到一个nltk。树对象，它以清晰的图形方式显示了哪个部分匹配块标准。在这个例子中，这意味着成为一个NNP——单数专有名词，由“Oin”和“Gloin”满足。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mz"><img src="../Images/f792cdaef90a2c1fd0a7cb979b99c590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oW-az5xDQ3FfEMmj"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">nltk。树对象</p></figure><p id="5037" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我发现<em class="mv"> nltk.ne_chunk </em>能够很好地处理我的数据。尽管还需要做更多的工作。许多常用词被认为是命名实体，因为它们是用大写字母书写的，例如“Hill”。我限制列表的想法是删除英语单词语料库中包含的所有以小写字母书写的单词词条。</p><p id="5c41" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此我使用了<em class="mv">nltk . corpus . words . words()</em>。这仍然有点棘手，需要一些领域知识(当然是阅读这本书)，例如，这种方法会将比尔博从命名实体中排除。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nb"><img src="../Images/49b8fdf8ce222dad7c6d9b26d82f8864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NuyNIPMur4JA43LC"/></div></div></figure><p id="7876" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当时只有几个词，我决定手动删除，例如:“Tralalalally”和“Blimey”。整本书中前15个命名实体的结果列表(基于它们的出现次数)如下所示。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nc"><img src="../Images/5199e4c31af12696f88d5c92a54f61df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dbH3FvdvVvH5Ss-7"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">《霍比特人》中的15大命名实体</p></figure><p id="16d5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以更进一步，按章节分析出现次数最多的主要人物。三个主要角色——比尔博、索林和甘道夫，毫无疑问，贯穿了整个故事。虽然在第一章中甘道夫的出现肯定更多。咕鲁是一个独一无二的角色。另一方面，史矛革在书的结尾得到了最多的关注，我们仍然可以看到他已经在第一章被宣布了。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nd"><img src="../Images/b51375259eac2a39ba59367ebcd4a237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ezlnAnbG6YL1amka"/></div></div></figure><p id="5e7b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以将提取的命名实体与前面分析部分的句子情感得分进行匹配，并查看某些字符是否在肯定句中出现的次数多于否定句。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mz"><img src="../Images/7a80f0574b0be8d3c255e2fd10fe52c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qt57NMxr5xMJQ05x"/></div></div></figure><p id="3f73" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了埃尔隆德，情绪的分布在人物之间没有很大的不同。从前面的情节中，我们知道埃尔隆德在书中出现的次数相对较少，所以他的结果可能会有偏差。</p><p id="7d47" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">事实证明，这并不一定意味着性格是好是坏。这也是有意义的，因为情感分数是根据角色自己说的话以及他被描述的时候来计算的。一个快乐的坏人可能不会在这样的情节中浮出水面。不过我们确实知道，没有一个霍比特人的角色仅仅被放在好/坏的环境中。</p><h1 id="72e8" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">2.命名实体之间的关系</h1><p id="255c" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">出于学习的目的，我想定义我自己的组块规则。在第一次尝试中，它是由已经存在的函数<em class="mv"> nltk.ne_chunks </em>自动完成的，但是我们可以选择任何配置的任何词性标签集来从文本中提取。</p><p id="814f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的语法由4个nnp组成——单数专有名词。中间的两个是必需的，剩下的两个是可选的，用“？”表示。它们都由可选的CC(并列连词)、TO、VBD(动词、过去式)或IN(介词或从属连词)连接。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mz"><img src="../Images/68d36f8a523aa5686339fef2d9844a10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9x-_NObWmIBZEamb"/></div></div></figure><p id="bdb5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的目标是让任何一组实体通过动词“talked to”以及简单的“and”连接起来。实际上，它导致从下面的句子中提取这样的4个组块:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/57ddf6bd59a6a4a8cb37b600c0d499d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/0*w5kCByMLn-dAWvjq"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">列表中提取的块</p></figure><blockquote class="nf ng nh"><p id="4e71" class="ki kj mv kk b kl km ju kn ko kp jx kq ni ks kt ku nj kw kx ky nk la lb lc ld im bi translated">很快，德瓦林躺在巴林旁边，菲利和基利躺在一起，多丽、诺里和奥里躺在一起，欧因、格洛因、比弗、博弗和邦布尔不舒服地堆在火边。</p></blockquote><p id="f431" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">“lay”在词性方面被认为是一个NN，这就是为什么Dwalin不幸被这个逻辑遗漏的原因。我计算了这些命名实体块一起出现的数量。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/21ba11201e851147b02e3a94f605d035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/0*OxXJobcDPTYgwIhS"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">命名实体对及其出现次数</p></figure><p id="8951" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在知道哪对矮人在一起出现的次数最多了——是基利和菲利，没有接近的亚军！我们也看到只有一组矮人和非矮人角色——比尔博和巴林。同样的角色也有成对的名和姓(例如比尔博·巴金斯)，这是因为在我上面的定义中，名词之间的任何单词都是可选的。</p><h1 id="98f0" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">摘要</h1><p id="457b" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">借助一些工具，我们可以对整本书有一个有趣的了解。虽然它们可能不太准确——我认为用数据分析来总结艺术是非常困难的——但这是学习新技术的一个好方法。</p><p id="defa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">分析的代码可以在<a class="ae lq" href="https://github.com/dorotamierzwa/ministryofdata/blob/master/Hobbit%20Or%20There%20And%20Back%20Again%20-%20Text%20analysis.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="4f9a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章主要发表在<a class="ae lq" href="https://ministryofdata.fandom.com/wiki/I%27m_going_on_a_%28data%29_adventure%21" rel="noopener ugc nofollow" target="_blank">数据部维基</a>上。</p></div></div>    
</body>
</html>