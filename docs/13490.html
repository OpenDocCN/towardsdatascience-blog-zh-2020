<html>
<head>
<title>Data Cleaning Using Python Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python Pandas 清理数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-cleaning-using-python-pandas-f6fadc433535?source=collection_archive---------12-----------------------#2020-09-16">https://towardsdatascience.com/data-cleaning-using-python-pandas-f6fadc433535?source=collection_archive---------12-----------------------#2020-09-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9762" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用内置 Pandas 函数在分析前清理数据的综合指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a6922821a53e587a8b25d3b1b994b042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RaVr3oPosFT0v0-i"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@stanyw?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯坦 Y </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h1 id="ba94" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="649d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">随着时间的推移，公司会产生和收集大量数据，根据公司的不同，这些数据可能以多种不同的形式出现，如用户生成的内容、求职者数据、博客帖子、传感器数据和工资单交易。由于可以生成数据的源系统数量巨大，以及参与数据生成的人数众多，我们永远无法保证我们接收到的数据是干净的记录。这些记录可能由于缺少属性而不完整，它们可能在用户输入的文本字段中有不正确的拼写，或者它们可能有不正确的值，例如将来的出生日期。</p><p id="4824" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">作为一名数据科学家，在探索阶段尽早发现这些数据质量问题，并在进行任何分析之前进行清理，这一点非常重要。由于允许未经清理的数据通过我们的分析工具，我们可能会因基于不正确的数据得出质量低劣的调查结果而承担错误地代表公司或用户数据的风险。今天我们将使用<a class="ae ky" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>和<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/index.html#" rel="noopener ugc nofollow" target="_blank"> Pandas </a>来探索一些可用于清理数据集的内置函数。</p><h1 id="1967" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">入门指南</h1><p id="bcc2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">对于今天的文章，我们使用的是为 Python 构建的集成开发环境<a class="ae ky" href="https://www.jetbrains.com/pycharm/" rel="noopener ugc nofollow" target="_blank"> PyCharm </a>。对于初学者来说，这是一个非常好的工具，因为它简化了虚拟环境的创建和特定 Python 包(如 Pandas)的安装。使用虚拟环境允许您管理项目依赖性，而不会影响操作系统的默认 Python 安装。</p><p id="3001" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先打开 Pycharm 并从导航栏中选择<code class="fe ms mt mu mv b">File &gt; New Project</code>。在这里，您可以使用<code class="fe ms mt mu mv b">Location</code>命名您的项目，或者创建一个新的虚拟环境，或者引用一个现有的虚拟环境。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/6e629fbb14cfbb8e901f7a0b9197a0cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0PkDrP9C7CZ_1lTljqhd_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PyCharm 的“新项目”对话框显示了命名项目的位置和虚拟环境创建路径。</p></figure><p id="76d9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了让你开始，我们在下面创建了一个基本的 Python 脚本和一个<a class="ae ky" href="https://gist.github.com/deanjamesss/f8f5781fb682fb728e9674dda9813982" rel="noopener ugc nofollow" target="_blank"> CSV 文件</a>，这两个文件在整篇文章中都将被引用。这两个文件都可以下载并保存到您的项目根目录下。最终的剧本可以在<a class="ae ky" href="https://gist.github.com/deanjamesss/3ccb847193ed93c22f7a1df61181d6ff" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Python 代码片段读取 CSV 文件，将特定列转换为默认数据类型，并重命名列。</p></figure><p id="e191" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面的脚本演示了在将文件读入内存后的一些数据帧操作。在第 5–7 行，我们覆盖了许多 Pandas 的默认配置，这些配置在处理较大的文件时会在打印时截断控制台输出。为了将数据读入内存，我们在第 10 行使用 Pandas 内置函数<code class="fe ms mt mu mv b">read_csv()</code>,它将一个文件名作为参数。在第 13–15 行，我们设置了三列的数据类型，这有很多好处。首先，通过减少内存占用，设置数据类型可以提高处理数据帧行的性能。其次，丰富了我们在运行 Pandas <code class="fe ms mt mu mv b">.describe()</code>内置函数时得到的描述性统计输出。在第 18 行，我们执行了一个列重命名，这是一个将通用列名转换成更有意义的名称的常用方法。</p><h1 id="e0a4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">清理数据帧</h1><p id="15f0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了了解数据集的哪些方面需要清理，我们首先需要了解我们正在处理哪些数据。最好的方法是使用熊猫内置函数<code class="fe ms mt mu mv b">.info()</code>和<code class="fe ms mt mu mv b">.describe()</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/027adb92ba5e43fcabfb80f2dd1d29ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*ecemMCddlubtZoQh5KLWqQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">调用熊猫内置函数后的控制台输出。信息()。</p></figure><p id="bf75" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面的<code class="fe ms mt mu mv b">.info()</code>的结果清楚地显示了非空元素的数量，因此可以使用第一行的 RangeIndex 推导出空元素的数量。总结这一点的一个快速方法是调用<code class="fe ms mt mu mv b">df.isnull().sum()</code>，它对每一列中的空元素的数量进行求和。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/33ac34df105bce7a744b40a4635cffe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:402/format:webp/1*6nTIFkmhm0jFabwyogP0RA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">调用熊猫内置后的控制台输出。isnull()。sum()函数。</p></figure><p id="e618" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果我们需要知道空元素占整个数据集的百分比，那么我们可以做以下事情。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用于计算缺失元素占整个数据集的百分比的 Python 代码片段。</p></figure><h2 id="dbbc" class="nb la it bd lb nc nd dn lf ne nf dp lj ma ng nh ll me ni nj ln mi nk nl lp nm bi translated">删除列</h2><p id="efdc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">调用<code class="fe ms mt mu mv b">.info()</code>和<code class="fe ms mt mu mv b">.isnull().sum()</code>后跳出的一个元素是跨越 1000 条记录有 1000 个空值的<code class="fe ms mt mu mv b">tax_file_no</code>。移除这些类型的行最简单的方法是使用 Pandas <code class="fe ms mt mu mv b">.dropna()</code>。<code class="fe ms mt mu mv b">.dropna()</code>功能采用<code class="fe ms mt mu mv b">.dropna(axis=0, how='any', thresh=None, subset=None, inplace=False)</code>的形式。<code class="fe ms mt mu mv b">axis</code>参数决定该函数是应用于行<code class="fe ms mt mu mv b">axis='index'</code>还是列<code class="fe ms mt mu mv b">axis='columns'</code>。<code class="fe ms mt mu mv b">how</code>参数可以是<code class="fe ms mt mu mv b">how='any'</code>或<code class="fe ms mt mu mv b">how='all'</code>，这意味着如果<em class="nn">任何</em>或<em class="nn">所有</em>元素都为空值，则可以删除该列或行。<code class="fe ms mt mu mv b">thresh</code>参数允许您设置列或行中所需的非空元素的最小数量，否则将被删除。<code class="fe ms mt mu mv b">subset</code>参数是可选的，可以接收列名列表，如果列表为空，那么<code class="fe ms mt mu mv b">.dropna()</code>函数将应用于所有列或行。<code class="fe ms mt mu mv b">inplace</code>可以是<code class="fe ms mt mu mv b">True</code>也可以是<code class="fe ms mt mu mv b">False</code>，如果是<code class="fe ms mt mu mv b">True</code>则返回<code class="fe ms mt mu mv b">None</code>。对于我们的例子，我们将使用<code class="fe ms mt mu mv b">df.dropna(axis='columns', how='all', inplace=True)</code>。执行<code class="fe ms mt mu mv b">.dropna()</code>并将数据帧信息打印到控制台后，您会注意到<code class="fe ms mt mu mv b">tax_file_no</code>列不再包含在内。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/b66a45cda1932a15401e126615851dc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*hlHpm4ZtA7X_UmhL9hv_1g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自的控制台输出。执行后的 info()。显示 tax_file_no 列的 dropna()已被删除。</p></figure><h2 id="c397" class="nb la it bd lb nc nd dn lf ne nf dp lj ma ng nh ll me ni nj ln mi nk nl lp nm bi translated">删除行</h2><p id="a2e0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在检查完完全为空的列之后，有必要检查是否有任何行没有包含足够的可用元素。我们可以通过使用<code class="fe ms mt mu mv b">.dropna(thresh=2)</code>删除任何少于两个元素的行来实现这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Python 代码片段显示了如何检查将被移除的少于两个元素的行。</p></figure><p id="b4b1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在第 2 行，我们删除所有少于两个元素的行。然后，第 3 行返回原始数据帧中其索引不存在于<code class="fe ms mt mu mv b">under_threshold_removed</code>中的任何行，即被删除的行。它通过否定<code class="fe ms mt mu mv b">~</code>熊猫内置的<code class="fe ms mt mu mv b">.index.isin()</code>功能来实现这一点。在我们的示例中，返回一条只包含雇员编号的记录。</p><h2 id="1692" class="nb la it bd lb nc nd dn lf ne nf dp lj ma ng nh ll me ni nj ln mi nk nl lp nm bi translated">填充缺失值</h2><p id="9960" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在某些情况下，我们可能希望保留包含缺失值的行，而不是在缺失时给它们一个默认值。对于这个例子，我们将把性别列中的空值映射到未知的<em class="nn"> U </em>。熊猫提供了一个内置功能，可以实现这个<code class="fe ms mt mu mv b">.fillna(value=None, method=None, axis=None, inplace=False, limit=None, downcast=None)</code>。</p><p id="6018" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">熊猫<code class="fe ms mt mu mv b">.fillna()</code>在清理数据或操作数据帧时是一个非常强大的功能。<code class="fe ms mt mu mv b">value</code>参数可以接受一个字典，该字典允许您指定将在特定列上用来填充空值的值。这样做的好处是当您不希望对数据帧中的所有空元素应用相同的空填充值时。<code class="fe ms mt mu mv b">method</code>参数允许您根据序列中的其他值填充空值。您可以将方法设置为<code class="fe ms mt mu mv b">ffill</code>，它将使用序列中存在的最后一个有效值来填充空值。<code class="fe ms mt mu mv b">bfill</code>方法选项执行类似的功能，但填充值取自系列中出现的下一个有效值。<code class="fe ms mt mu mv b">axis</code>和<code class="fe ms mt mu mv b">inplace</code>参数获得与上述<code class="fe ms mt mu mv b">.dropna()</code>功能相同的结果。如果您已经设置了<code class="fe ms mt mu mv b">method</code>参数，您可以使用<code class="fe ms mt mu mv b">limit</code>参数告诉<code class="fe ms mt mu mv b">.fillna()</code>向前/向后检查连续空值的最大数量，以达到有效值。如果<code class="fe ms mt mu mv b">method</code>参数为<code class="fe ms mt mu mv b">None</code>，则<code class="fe ms mt mu mv b">limit</code>参数可用于设置系列中空值的最大数量，该数量将由传递的值填充。</p><p id="85ff" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">由于<code class="fe ms mt mu mv b">gender</code>列具有分类数据类型，在我们将缺失值映射到<em class="nn"> U </em>之前，我们首先需要在序列中创建一个新的类别。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Python 代码片段显示了如何在映射系列中缺失的值之前添加新类别。</p></figure><p id="655c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要添加一个新的类别，我们需要将<code class="fe ms mt mu mv b">gender</code>列隔离为一个系列，并调用<code class="fe ms mt mu mv b">.add_categories()</code>。这将允许你使用接受列表的<code class="fe ms mt mu mv b">new_categories=[]</code>来传递新的类别。一旦创建了新类别，您就可以使用<code class="fe ms mt mu mv b">.fillna()</code>并引用新类别。要查看所做的更改，您可以调用<code class="fe ms mt mu mv b">df['gender'].value_counts()</code>，这将隔离<code class="fe ms mt mu mv b">gender</code>列，并为系列中的每个类别提供一个值计数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/b429fc82b7943f255de89c33f6eb7c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*MLy-m0Sic16wsUrQhqykTQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示 206 个缺失值的控制台输出现在映射到性别列中的新类别 U。</p></figure><h2 id="6707" class="nb la it bd lb nc nd dn lf ne nf dp lj ma ng nh ll me ni nj ln mi nk nl lp nm bi translated">提高可读性</h2><p id="333d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这种情况下，我们理解类别 M、F 和 U 背后的含义，但是，接收数据的利益相关者可能不理解。为了提高分析的可读性，我们可以将类别重命名为更有意义的名称。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Python 代码片段显示了如何重命名性别列中的类别。</p></figure><p id="c56f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面的代码片段使用了内置函数<code class="fe ms mt mu mv b">.rename_categories()</code>，该函数接受一个将当前类别映射到新类别的字典。下面显示了重命名的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/5e2f67357a531c7025cbcb8ccf757e8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*-BeZZ91TfOsVn8CVhj1PsA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示性别列中新重命名的类别的值计数的控制台输出。</p></figure><h1 id="c8aa" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">摘要</h1><p id="ede7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">作为一名数据科学家，在你的职业生涯中，你会遇到不完整和质量差的数据集。为了生成高质量的分析，我们需要确保我们正在清理数据，以便准确地表示数据集。Pandas 提供了各种各样的内置功能，可用于在分析之前清理和操作数据集。它允许您删除不完整的行和列，填充缺失的值，并通过类别重命名提高数据集的可读性。</p><p id="3ac6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">感谢您花时间阅读我们的故事，我们希望您觉得它很有价值。</p></div></div>    
</body>
</html>