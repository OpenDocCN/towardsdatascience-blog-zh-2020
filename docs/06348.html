<html>
<head>
<title>Multimodal deep learning to predict movie genres</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多模态深度学习预测电影类型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/multimodal-deep-learning-to-predict-movie-genres-e6855f814a8a?source=collection_archive---------23-----------------------#2020-05-21">https://towardsdatascience.com/multimodal-deep-learning-to-predict-movie-genres-e6855f814a8a?source=collection_archive---------23-----------------------#2020-05-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="040b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">多模态深度学习模型的PyTorch实现。它使用电影海报和概述来尝试和预测电影的类型。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8baf1b238aa69f2b63960f158eca800f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-yWsCHUc_8Xwti2k9sW2Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">黑暗骑士。图片来自<a class="ae ky" href="https://www.themoviedb.org/movie/155-the-dark-knight?language=en-US" rel="noopener ugc nofollow" target="_blank"> TMDB </a>。</p></figure><blockquote class="kz la lb"><p id="249e" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">“蝙蝠侠提高了他打击犯罪的赌注。在中尉吉姆·戈登和地方检察官哈维·登特的帮助下，蝙蝠侠着手摧毁困扰街头的剩余犯罪组织。这种伙伴关系被证明是有效的，但他们很快发现自己陷入了混乱的统治，这种混乱是由一个崛起的犯罪主谋引发的，这个犯罪主谋被惊恐的哥谭市民称为小丑。”——<a class="ae ky" href="https://www.themoviedb.org/movie/155-the-dark-knight?language=en-US" rel="noopener ugc nofollow" target="_blank">TMDB</a></p></blockquote><p id="83bf" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">《黑暗骑士》——我最喜欢的电影之一。<a class="ae ky" href="https://www.themoviedb.org/?language=en-US" rel="noopener ugc nofollow" target="_blank"> TMDB </a>将这部电影分为四类——剧情片、动作片、犯罪片、惊悚片。我训练的一个多模态深度学习模型将这部电影分类为——动作片、剧情片、惊悚片。让我们来看看这个模型是如何做到这一点的。</p><h2 id="d2e0" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">什么是多模态深度学习？</h2><p id="691a" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">情态是做或经历某事的一种特殊方式。我们生活在一个多模态的环境中。我们看到东西，听到声音，闻到气味，感觉纹理。与此类似，多模态深度学习涉及一起使用的多个模态来预测一些输出。在这个项目中，我分别使用卷积神经网络(CNN)和长短期记忆(LSTM)网络连接从图像和文本序列中提取的特征。这些特征被用来尝试和预测电影类型。</p><h2 id="ae7f" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">数据集</h2><p id="6cb0" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">为了这个项目，我使用了Kaggle的电影数据集。它包括40，000多部电影的概述，TMDB的海报链接和来自TMDB网站的流派。拆分数据集后，训练集由26864个例子组成；测试集包括7463个样本，验证集包括2986个案例。</p><h2 id="eae4" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">探索性数据分析</h2><p id="96ed" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">在对数据进行预处理之前，有必要了解每种体裁的类别分布情况。诸如“Aniplex”、“BROSTA TV”的一些类型似乎在整个数据集中只出现一次。因此，我删除了这些。除此之外，一些类似“电视电影”和“外国”的流派，海报和电影摘要也不容易让人察觉。因此，这些也被删除。下面的片段显示了从数据集中删除的流派列表。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="659d" class="mc md it nb b gy nf ng l nh ni">invalid_genres = ['Aniplex', 'BROSTA TV', 'Carousel Productions', 'GoHands', 'Mardock Scramble Production Committee', 'Odyssey Media', 'Pulser Productions', 'Rogue State', 'Sentai Filmworks', 'Telescene Film Group Productions', 'The Cartel', 'Vision View Entertainment', 'TV Movie', 'Foreign']</span></pre><p id="1cee" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我还扫描了数据集中没有指定流派的行。超过2471行在genre_list列中没有任何值。所以这些行被删除了。</p><p id="0115" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">除此之外，从流派标签的角度来看，了解数据集的平衡程度也很重要。从下图中可以清楚地看出，数据集中存在阶级不平衡。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/fe8fa30ed24e320d60de718d74d5fc5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AfQ27Uy7Xu4x2ap5ReTJJA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="8735" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">文本清洗和预处理</h2><p id="cc50" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">数据清理和预处理允许我们从数据中移除不相关的信息，比如URL。这些熟悉的单词出现得非常频繁，但没有添加太多的语义，如英语中的冠词。文本处理包括以下步骤:</p><ol class=""><li id="071f" class="nk nl it lf b lg lh lj lk lz nm ma nn mb no ly np nq nr ns bi translated">从文本中删除所有标点符号。</li><li id="172c" class="nk nl it lf b lg nt lj nu lz nv ma nw mb nx ly np nq nr ns bi translated">将文本转换为小写，删除非字母输入和所有NLTK停用词。</li><li id="a88b" class="nk nl it lf b lg nt lj nu lz nv ma nw mb nx ly np nq nr ns bi translated">使用NLTK的单词词汇化。变元化的目标是将一个词的屈折形式，有时是派生相关形式简化为一个共同的基本形式。例如，“查找”可以替换为“查找”。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="0a3a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">使用Keras Tokenizer API对清理后的文本进行标记化。这个记号赋予器用于将所有文本转换成要输入到LSTM网络中的序列。通过用零填充，所有的序列都具有相同的长度。这样做是为了确保所有输入具有相同的尺寸。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h2 id="dc71" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">下载和预处理海报</h2><p id="b3ad" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">模型的输入之一是电影海报。因此，我必须下载对应于数据集中每部电影的一张海报。原始数据集还包含一个存储在TMDB的海报的URL。然而，大多数链接似乎过时了，所以我不得不临时利用TMDB API。我使用了python的<a class="ae ky" href="https://pypi.org/project/tmdbv3api/" rel="noopener ugc nofollow" target="_blank"> tmdbv3api </a>，它包装了TMDB API。使用原始数据集中的电影id，我找到了对应于一部电影的单个海报。需要注意的一点是，有些电影可能没有TMDB的海报。</p><p id="e593" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">“电影”对象允许我们根据TMDB ID搜索电影。通过一个简单的GET请求下载海报，并保存到我的Google Drive中。对应于电影海报的路径保存在列表中，该列表作为列添加到数据集中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="ec2f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">如果下载海报时出现任何错误或电影的poster_path不存在，则该电影将从数据集中删除。</p><p id="09fb" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">这是最终数据集的一瞥。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/4157d2b21952ddcc77f4d59486360e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mVMr0deEq92NW3xFvfkviQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3b34" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">最后的预处理步骤是调整海报的大小，并将它们附加到一个NumPy数组中。保存这个NumPy数组是为了更容易以有效的输入格式访问海报。这个过程需要很长时间，输出的NumPy数组大约为2–3gb。需要大量的RAM来保存这个数组。我建议在整个过程中使用Google colab。下面是将图像转换成NumPy数组的代码片段。如果在数据集中的指定路径找不到任何海报，则会删除相应的行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="1b3a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">所以我最终预处理了文本输入和图像输入。现在，开始训练模型。</p><h2 id="390d" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">预处理标签</h2><p id="a0f6" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">每部电影都与数据集中一定数量的流派相关联。然而，这需要被制成一个独热编码向量，其中每个对应于一个流派标签。为此，我使用了scikit-learn库的MultilabelBinarizer类。它产生一个稀疏矩阵，其中每个行向量是一位热编码的。这意味着行向量在与其被分类的标签相关联的索引中具有1，而在所有其他地方具有0。因此，这是一个多标签分类问题。如下所示，数据集中总共有18个类。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h2 id="0811" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">模型架构</h2><p id="d152" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">该模型由两个网络组成——一个堆叠的LSTM和一个CNN。文本序列被输入到嵌入层。我用的是谷歌预先训练好的Word2Vec嵌入。然而，为了微调模型，我允许嵌入层是可训练的。嵌入层之后是两个堆叠的LSTMs，其输出馈入全连接层。</p><p id="79f5" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">这些图像被输入到CNN。CNN由连续的2D卷积层和最大池层组成。最后一个max-pooling层的输出被展平并馈入完全连接的层。</p><p id="23ac" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">LSTM和CNN的全连接层然后被连接并被前馈，直到最后的全连接层。最后一层的输出大小为18，每个层对应一个流派。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/8c5f34622b294a6b64a0598b3710c2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4MoSHYfA9U8nPFTXAb4xg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型的架构。图片由作者提供。</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h2 id="fef1" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">训练模型</h2><p id="9e3c" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">DataLoader对象初始化时的批处理大小为64，它将输入传递给模型。TensorDataset对象用于包装数据集输入和标签。然后，将每个TensorDataset提供给DataLoader对象。这将允许我们将数据集批量发送到模型进行训练、验证和测试。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="5a13" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我使用的损失是<strong class="lf iu">二元交叉熵</strong>和<strong class="lf iu">亚当优化器</strong>。梯度剪辑也被用来防止爆炸梯度。该模型被训练了20个时期。在训练期间，我计算了每个时期的准确度和损失，作为所有批次的准确度和损失的平均值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="ef60" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">最终历元的精度和损失如下:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="6f68" class="mc md it nb b gy nf ng l nh ni">Epoch 20: train_loss: 0.1340 train_acc: 0.9200 | val_loss: 0.3431 val_acc: 0.8726</span></pre><p id="8d2e" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在训练和保存模型之后，我在测试集上评估了准确性和损失:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="f6df" class="mc md it nb b gy nf ng l nh ni">acc: 0.8737 loss: 0.3406</span></pre><h2 id="dc66" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">评估指标</h2><p id="263d" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">准确性和损失似乎表明该模型表现得相当好。然而，由于数据集中的类别不平衡，一些更好的评估指标将是精确度、召回率、<a class="ae ky" href="https://en.wikipedia.org/wiki/F1_score" rel="noopener ugc nofollow" target="_blank"> F1得分</a>和受试者操作特征曲线下的计算面积(ROC AUC)得分。由属于一个流派的电影的非阈值概率组成的输出被转换成具有独热编码行向量的稀疏矩阵，以计算精确度、召回率和F1分数。这是使用0.5的任意阈值完成的。这个值可以通过使用马修的<a class="ae ky" href="https://en.wikipedia.org/wiki/Matthews_correlation_coefficient" rel="noopener ugc nofollow" target="_blank">相关系数</a>进一步提高。还可以通过绘制每个类别的ROC曲线来增强。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="8d4d" class="mc md it nb b gy nf ng l nh ni">Precision on test set: 0.5732<br/>Recall on test set: 0.5210<br/>F1 score on test set: 0.5080</span></pre><p id="1a2a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">使用模型的非阈值输出计算ROC AUC得分。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="266b" class="mc md it nb b gy nf ng l nh ni">roc auc macro score: 0.8021</span></pre><p id="150f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">使用的另一个评估指标是汉明损耗。汉明损失给出了标签总数中错误标签的一部分。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="165b" class="mc md it nb b gy nf ng l nh ni">Hamming loss on the test set: 0.1078</span></pre><p id="a6e2" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">从上面的评估指标可以明显看出，该模型在测试集上表现良好。通过为每个标签取一个优化的阈值而不是0.5的任意值，可以进一步提高精确度、召回率和f1值。改进模型的另一个方法是分别评估CNN和LSTM，以判断两者的改进范围。</p><h2 id="d60a" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">结论</h2><ol class=""><li id="f299" class="nk nl it lf b lg mv lj mw lz oc ma od mb oe ly np nq nr ns bi translated">该项目探索了一种多模态深度学习方法，以解决从电影海报和概述中预测电影类型的多标签分类问题。</li><li id="e736" class="nk nl it lf b lg nt lj nu lz nv ma nw mb nx ly np nq nr ns bi translated">测试集上的模型精度和损失都很好。然而，对于这个问题有更适合的评估指标——精确度、召回率、f1分数和ROC AUC分数。</li><li id="a088" class="nk nl it lf b lg nt lj nu lz nv ma nw mb nx ly np nq nr ns bi translated">这种模型可能能够区分喜剧电影的海报和概述的特征与恐怖电影的海报和摘要的特征。</li></ol><p id="48ce" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">感谢阅读这篇文章！这个项目的完整代码可以在<a class="ae ky" href="https://github.com/dh1105/Multi-modal-movie-genre-prediction" rel="noopener ugc nofollow" target="_blank">https://github . com/DH 1105/Multi-modal-movie-genre-prediction</a>找到。</p></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="de91" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu">参考文献</strong></p><ol class=""><li id="4012" class="nk nl it lf b lg lh lj lk lz nm ma nn mb no ly np nq nr ns bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/multimodal-deep-learning-ce7d1d994f4">https://towards data science . com/multimodal-deep-learning-ce 7d 1d 994 f 4</a></li><li id="dc82" class="nk nl it lf b lg nt lj nu lz nv ma nw mb nx ly np nq nr ns bi translated"><a class="ae ky" href="https://www.kaggle.com/rounakbanik/the-movies-dataset" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/rounakbanik/the-movies-dataset</a></li><li id="2328" class="nk nl it lf b lg nt lj nu lz nv ma nw mb nx ly np nq nr ns bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/understanding-auc-roc-curve-68b2303cc9c5">https://towards data science . com/understanding-AUC-roc-curve-68b 2303 cc9 C5</a></li><li id="82ed" class="nk nl it lf b lg nt lj nu lz nv ma nw mb nx ly np nq nr ns bi translated"><a class="ae ky" href="https://medium.com/@kunalgupta4595/predicting-movie-genres-based-on-plot-summaries-bae646e70e04" rel="noopener">https://medium . com/@ kunalgupta 4595/predicting-movie-genders-based-on-plot-summaries-BAE 646 e 70 e 04</a></li></ol></div></div>    
</body>
</html>