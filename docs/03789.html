<html>
<head>
<title>Faster Video Processing in Python using Parallel Computing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用并行计算加快Python中的视频处理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/faster-video-processing-in-python-using-parallel-computing-25da1ad4a01?source=collection_archive---------10-----------------------#2020-04-09">https://towardsdatascience.com/faster-video-processing-in-python-using-parallel-computing-25da1ad4a01?source=collection_archive---------10-----------------------#2020-04-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ebb6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">python中的多重处理</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a1eefe7c02a049314f48d37e3750ec4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pg1qP7UNWP_-kVBgwuH01A.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">服务器(照片由<a class="ae kv" href="https://unsplash.com/@ianjbattaglia?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">伊恩·巴塔格利亚</a>在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure><p id="9a9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果要处理大量视频文件，可能需要几分钟到几小时，具体取决于视频的大小、帧数和帧尺寸。</p><blockquote class="ls"><p id="0c85" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">怎样才能加快视频处理速度？</p><p id="8c5e" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">并行处理就是答案！</p></blockquote><p id="ce1e" class="pw-post-body-paragraph kw kx iq ky b kz mc jr lb lc md ju le lf me lh li lj mf ll lm ln mg lp lq lr ij bi translated">如果您正在批量处理图像，您可以利用并行处理的强大功能来加速任务。</p><p id="ad3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我们将看看如何使用python对视频进行并行处理。</p><p id="8b2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将从磁盘读取视频，执行人脸检测，并将带有人脸检测输出(边界框)的视频写回磁盘。</p><p id="a484" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们开始吧。</p><h2 id="0421" class="mh mi iq bd mj mk ml dn mm mn mo dp mp lf mq mr ms lj mt mu mv ln mw mx my mz bi translated">安装依赖项</h2><p id="ee6e" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">我们将需要以下包:</p><p id="e390" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> OpenCV: </strong>是一个常用的计算机视觉库。在本帖中，我们将使用OpenCV来读写视频文件。</p><p id="bcdd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要在您的设备上安装OpenCV，您可以使用<em class="nf"> pip </em>命令或<em class="nf"> apt-get </em>命令。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="0584" class="mh mi iq nh b gy nl nm l nn no">pip3 install opencv-python</span></pre><p id="6519" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="4fff" class="mh mi iq nh b gy nl nm l nn no">sudo apt-get install -y python3-opencv</span></pre><p id="3ed8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> FFmpeg: </strong>是一个跨平台的解决方案，用于录制、转换和流式传输音频和视频。在这篇文章中，我们将使用FFmpeg来连接多个视频文件。</p><p id="1188" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要安装ffmpeg，使用下面的<em class="nf"> apt-get </em>命令:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="682b" class="mh mi iq nh b gy nl nm l nn no">sudo apt-get install -y ffmpeg</span></pre><h2 id="eddf" class="mh mi iq bd mj mk ml dn mm mn mo dp mp lf mq mr ms lj mt mu mv ln mw mx my mz bi translated">导入python库</h2><p id="83f5" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">让我们导入所需的python库。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="39a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所用库的详细信息:</p><p id="60d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://opencv.org" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> cv2: </strong> </a> OpenCV库读写视频文件。</p><p id="99e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">时间:</strong>获取计算代码执行时间的当前时间。</p><p id="8f68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://docs.python.org/3/library/subprocess.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">子进程</strong> </a> <strong class="ky ir"> : </strong>启动新进程，连接到它们的输入/输出/错误管道，获取它们的返回代码。</p><p id="9ab1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://docs.python.org/2/library/multiprocessing.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">多重处理</strong> </a> <strong class="ky ir"> : </strong>跨多个输入值并行执行一个函数，将输入数据分布到多个进程中</p><p id="4d55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://sdk.xailient.com" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"/></a><strong class="ky ir">:</strong>人脸检测库</p><h2 id="da64" class="mh mi iq bd mj mk ml dn mm mn mo dp mp lf mq mr ms lj mt mu mv ln mw mx my mz bi translated">使用单个进程的视频处理流水线</h2><p id="2c0f" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">我们将首先定义一种使用单个进程处理视频的方法。这就是我们通常读取视频文件、处理每一帧并将输出帧写回磁盘的方式。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="abe8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们创建另一个调用视频处理器的函数，记录开始和结束时间，并计算执行管道所用的时间和每秒处理的帧数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><h2 id="4e81" class="mh mi iq bd mj mk ml dn mm mn mo dp mp lf mq mr ms lj mt mu mv ln mw mx my mz bi translated">使用多进程的视频处理流水线</h2><p id="b686" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">现在，让我们定义另一个利用多重处理来处理视频的函数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="c115" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上述功能的工作原理是，通常使用一个进程完成的视频处理工作现在在执行设备上可用的处理器总数中平均分配。</p><p id="034d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果有4个进程，并且要处理的视频中的总帧数是1000，则每个进程得到250个要处理的帧，它们是并行执行的。这意味着每个过程将创建一个单独的输出文件，因此当视频处理完成时，有4个不同的输出视频。</p><p id="4e52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了组合这些输出视频，我们将使用ffmpeg。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="66e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个管道来运行视频的多重处理，并计算执行时间和每秒处理的帧数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><h2 id="e0f4" class="mh mi iq bd mj mk ml dn mm mn mo dp mp lf mq mr ms lj mt mu mv ln mw mx my mz bi translated">结果</h2><p id="38f3" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">我在搭载Ubuntu18.04操作系统的联想Yoga 920上运行了这个实验。该设备上可用的逻辑处理器数量为8。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/dcf2c01ae966eda0d83fac1119c3c1af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hSlCUuZWFMq79iEKlNiFmQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/c392871303ee8ca1d7e3e03c42acd89a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PitiiGsUgM544WN0zvhdnw.png"/></div></div></figure><p id="fe5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从这个实验中，我们可以观察到，当使用所有内核处理视频时，每秒多处理2倍的帧。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="889f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">发现这篇文章有用吗？ <strong class="ky ir"> <em class="nf">在下面留下你的想法作为评论。</em> </strong></p><p id="090c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原载于<em class="nf"/><a class="ae kv" href="https://www.xailient.com/post/multiprocessing-video-in-python" rel="noopener ugc nofollow" target="_blank"><em class="nf"/></a><em class="nf">。</em></p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="b58d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="nf">关于作者</em> </strong></p><p id="905e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nf"> Sabina Pokhrel在Xailient工作，这是一家计算机视觉初创公司，已经建立了世界上最快的边缘优化物体探测器。</em></p></div></div>    
</body>
</html>