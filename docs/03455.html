<html>
<head>
<title>Vespa.ai and the CORD-19 public API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vespa.ai 和 CORD-19 公共 API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/vespa-ai-and-the-cord-19-public-api-a714b942172f?source=collection_archive---------48-----------------------#2020-04-01">https://towardsdatascience.com/vespa-ai-and-the-cord-19-public-api-a714b942172f?source=collection_archive---------48-----------------------#2020-04-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d6e7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">体验 Vespa 的功能</h2></div><p id="30bd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Vespa 团队一直在马不停蹄地工作，以由<a class="ae le" href="https://allenai.org/" rel="noopener ugc nofollow" target="_blank">艾伦人工智能研究所</a>发布的新冠肺炎开放研究数据集(CORD-19)为基础，组装<a class="ae le" href="https://cord19.vespa.ai/" rel="noopener ugc nofollow" target="_blank"> cord19.vespa.ai </a>搜索应用。前端的<a class="ae le" href="https://github.com/vespa-engine/cord-19/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">和后端的</a><a class="ae le" href="https://github.com/vespa-engine/sample-apps/tree/master/vespa-cloud/cord-19-search" rel="noopener ugc nofollow" target="_blank">都是 100%开源的。后端基于</a><a class="ae le" href="https://vespa.ai/" rel="noopener ugc nofollow" target="_blank"> vespa.ai </a>，一个强大的开源计算引擎。由于一切都是开源的，你可以以多种方式为项目做贡献。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/89bdf27789b7a8dd4863cbff68492c91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-nNU_KY1-UUii_EVDx-QeQ.png"/></div></div></figure><p id="52dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为用户，您可以使用<a class="ae le" href="http://cord19.vespa.ai" rel="noopener ugc nofollow" target="_blank">前端</a>搜索文章，或者使用<a class="ae le" href="https://github.com/vespa-engine/cord-19/blob/master/cord-19-queries.md" rel="noopener ugc nofollow" target="_blank">公共搜索 API </a>执行高级搜索。作为一名开发者，你可以通过向<a class="ae le" href="https://github.com/vespa-engine/sample-apps/tree/master/vespa-cloud/cord-19-search" rel="noopener ugc nofollow" target="_blank">后端</a>和<a class="ae le" href="https://github.com/vespa-engine/cord-19/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">前端</a>发送请求来改进现有的应用程序，或者你可以派生并创建你自己的应用程序，无论是在本地<a class="ae le" href="https://docs.vespa.ai/documentation/vespa-quick-start.html" rel="noopener ugc nofollow" target="_blank">还是通过</a><a class="ae le" href="https://cloud.vespa.ai/getting-started.html" rel="noopener ugc nofollow" target="_blank"> Vespa Cloud </a>，来试验<a class="ae le" rel="noopener" target="_blank" href="/learning-from-unlabelled-data-with-covid-19-open-research-dataset-cded4979f1cf?source=friends_link&amp;sk=44fd9519db937036659d0e43c87310c5">不同的方式来匹配和排列 CORD-19 文章</a>。我写这篇文章的目的是给你一个概述，通过使用 cord19 搜索应用程序公共 API，Vespa 可以完成什么。这只是皮毛，但我希望它能帮助你找到正确的地方，了解更多的可能性。</p><h1 id="ddc8" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">简单查询语言</h1><p id="8ede" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">cord19.vespa.ai 查询接口支持 Vespa <a class="ae le" href="https://docs.vespa.ai/documentation/reference/simple-query-language-reference.html" rel="noopener ugc nofollow" target="_blank">简单查询语言</a>，允许您快速执行简单查询。示例:</p><ul class=""><li id="ee17" class="mp mq it kk b kl km ko kp kr mr kv ms kz mt ld mu mv mw mx bi translated"><a class="ae le" href="https://cord19.vespa.ai/search?query=%2Bcovid-19+%2Btemperature+impact+on+viral+transmission" rel="noopener ugc nofollow" target="_blank">+新冠肺炎+温度对病毒传播的影响</a>:如果你点击这个链接，你将会搜索到包含<em class="lf">新冠肺炎、温度</em>和短语<em class="lf">对病毒传播的影响</em>的文章。</li><li id="49e2" class="mp mq it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated"><a class="ae le" href="https://cord19.vespa.ai/search?query=%2Btitle%3A%22reproduction+number%22+%2Babstract%3AMERS" rel="noopener ugc nofollow" target="_blank">+title:" reproduction number "+abstract:MERS</a>:该链接将返回标题中包含短语<em class="lf"> reproduction number </em>和摘要中包含单词<em class="lf"> MERS </em>的文章。</li><li id="d7cb" class="mp mq it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated"><a class="ae le" href="https://cord19.vespa.ai/search?query=authors.last%3Aknobel" rel="noopener ugc nofollow" target="_blank"> +authors.last:knobel </a>:返回至少有一个作者姓<em class="lf"> knobel 的文章。</em></li></ul><p id="d140" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其他资源:</p><ul class=""><li id="6b6c" class="mp mq it kk b kl km ko kp kr mr kv ms kz mt ld mu mv mw mx bi translated">更多 cord19 的具体例子可以在<a class="ae le" href="https://github.com/vespa-engine/cord-19/blob/master/cord-19-queries.md" rel="noopener ugc nofollow" target="_blank"> cord19 API 文档</a>中找到。</li><li id="d3f5" class="mp mq it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">简单查询语言文档是查询语法的地方。</li></ul><h1 id="1fd8" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">Vespa 搜索 API</h1><p id="f275" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">除了简单的查询语言，Vespa 还有一个更强大的<a class="ae le" href="https://docs.vespa.ai/documentation/search-api.html" rel="noopener ugc nofollow" target="_blank">搜索 API </a>，它通过名为 YQL 的<a class="ae le" href="https://docs.vespa.ai/documentation/query-language.html" rel="noopener ugc nofollow" target="_blank"> Vespa 查询语言</a>来完全控制搜索体验。然后，我们可以通过向搜索端点<em class="lf"> cord19.vespa.ai </em>发送 POST 请求来发送广泛的查询。以下是说明该 API 的 python 代码:</p><pre class="lh li lj lk gt nd ne nf ng aw nh bi"><span id="6b34" class="ni lt it ne b gy nj nk l nl nm">import requests # Install via 'pip install requests'</span><span id="07a5" class="ni lt it ne b gy nn nk l nl nm">endpoint = 'https://api.cord19.vespa.ai/search/'<br/>response = requests.post(endpoint, json=<strong class="ne iu">body</strong>)</span></pre><h2 id="3f1b" class="ni lt it bd lu no np dn ly nq nr dp mc kr ns nt me kv nu nv mg kz nw nx mi ny bi translated">按查询术语搜索</h2><p id="5080" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">让我们分解一个例子来提示您使用 Vespa 搜索 API 可以做些什么:</p><pre class="lh li lj lk gt nd ne nf ng aw nh bi"><span id="3a64" class="ni lt it ne b gy nj nk l nl nm"><strong class="ne iu">body</strong> = {<br/>  'yql': 'select title, abstract from sources * where userQuery() and has_full_text=true and timestamp &gt; 1577836800;',<br/>  'hits': 5,<br/>  'query': 'coronavirus temperature sensitivity',<br/>  'type': 'any',<br/>  'ranking': 'bm25'<br/>}</span></pre><p id="4c3b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">匹配阶段</strong>:上面的 body 参数将为所有匹配<code class="fe nz oa ob ne b">'query'</code>项中的任何一个(<code class="fe nz oa ob ne b">'type': 'any'</code>)的文章选择标题和摘要字段，这些文章具有可用的全文(<code class="fe nz oa ob ne b">has_full_text=true</code>)和大于 1577836800 的时间戳。</p><p id="dfbe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">排名阶段</strong>:根据上述标准匹配文章后，Vespa 将根据文章的<a class="ae le" href="https://docs.vespa.ai/documentation/reference/bm25.html" rel="noopener ugc nofollow" target="_blank"> BM25 分数</a> ( <code class="fe nz oa ob ne b">'ranking': 'bm25'</code>)对其进行排名，并根据该排名标准返回前 5 篇文章(<code class="fe nz oa ob ne b">'hits': 5</code>)。</p><p id="72d4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的例子仅仅给出了搜索 API 的一点尝试。我们可以根据自己的需要定制匹配阶段和排名阶段。例如，我们可以使用更复杂的匹配操作符，如 Vespa weakAND，我们可以通过在上面的<em class="lf">正文</em>中添加<code class="fe nz oa ob ne b">'default-index': 'abstract'</code>来限制搜索，只在摘要中查找匹配。我们可以通过将<code class="fe nz oa ob ne b">'ranking'</code>参数更改为<a class="ae le" href="https://github.com/vespa-engine/sample-apps/blob/master/vespa-cloud/cord-19-search/src/main/application/searchdefinitions/doc.sd" rel="noopener ugc nofollow" target="_blank">搜索定义文件</a>中可用的<a class="ae le" href="https://docs.vespa.ai/documentation/ranking.html" rel="noopener ugc nofollow" target="_blank">等级配置文件</a>之一，在查询时试验不同的等级函数。</p><p id="5702" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其他资源:</p><ul class=""><li id="cd37" class="mp mq it kk b kl km ko kp kr mr kv ms kz mt ld mu mv mw mx bi translated">Vespa 文本搜索教程展示了如何逐步创建文本搜索应用程序。<a class="ae le" href="https://docs.vespa.ai/documentation/tutorials/text-search.html" rel="noopener ugc nofollow" target="_blank">第 1 部分</a>展示了如何从头开始创建一个基本的应用程序。<a class="ae le" href="https://docs.vespa.ai/documentation/tutorials/text-search-ml.html" rel="noopener ugc nofollow" target="_blank">第 2 部分</a>展示了如何从 Vespa 收集训练数据，并改进 ML 模型的应用。<a class="ae le" href="https://docs.vespa.ai/documentation/tutorials/text-search-semantic.html" rel="noopener ugc nofollow" target="_blank">第 3 部分</a>展示了如何通过使用预先训练的句子嵌入开始语义搜索。</li><li id="e7e1" class="mp mq it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">更多特定于 cord19 应用的 YQL 示例可以在<a class="ae le" href="https://github.com/vespa-engine/cord-19/blob/master/cord-19-queries.md" rel="noopener ugc nofollow" target="_blank"> cord19 API 文档</a>中找到。</li></ul><h2 id="7a82" class="ni lt it bd lu no np dn ly nq nr dp mc kr ns nt me kv nu nv mg kz nw nx mi ny bi translated">按语义相关性搜索</h2><p id="b59f" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">除了通过查询词进行搜索，Vespa 还支持语义搜索。</p><pre class="lh li lj lk gt nd ne nf ng aw nh bi"><span id="8a93" class="ni lt it ne b gy nj nk l nl nm"><strong class="ne iu">body</strong> = {<br/>    'yql': 'select * from sources * where  ([{"targetNumHits":100}]nearestNeighbor(title_embedding, vector));',<br/>    'hits': 5,<br/>    'ranking.features.query(vector)': embedding.tolist(),<br/>    'ranking.profile': 'semantic-search-title',<br/>}</span></pre><p id="18a9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">匹配阶段</strong>:在上面的查询中，我们通过使用<a class="ae le" href="https://docs.vespa.ai/documentation/reference/query-language-reference.html#nearestneighbor" rel="noopener ugc nofollow" target="_blank">最近邻操作符</a>来匹配至少 100 篇文章(<code class="fe nz oa ob ne b">[{"targetNumHits":100}]</code>)，这些文章在<code class="fe nz oa ob ne b">title_embedding</code>和查询嵌入<code class="fe nz oa ob ne b">vector</code>之间具有最小(欧几里德)距离。</p><p id="a520" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">排序阶段</strong>:匹配后我们可以用多种方式对文档进行排序。在这种情况下，我们使用一个名为<code class="fe nz oa ob ne b">'semantic-search-title'</code>的特定 rank-profile，它是预定义的，根据标题和查询嵌入之间的距离对匹配的文章进行排序。</p><p id="7c5c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">标题嵌入是在将文档提供给 Vespa 时创建的，而查询嵌入是在查询时创建的，并通过<code class="fe nz oa ob ne b">ranking.features.query(vector)</code>参数发送给 Vespa。这个<a class="ae le" href="https://www.kaggle.com/jkb123/semantic-search-using-vespa-ai-s-cord19-index" rel="noopener ugc nofollow" target="_blank"> Kaggle 笔记本</a>演示了如何通过使用<a class="ae le" href="https://huggingface.co/gsarti/scibert-nli" rel="noopener ugc nofollow" target="_blank">塞伯特-NLI 模型</a>在 cord19 应用中执行语义搜索。</p><p id="eb14" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其他资源:</p><ul class=""><li id="9897" class="mp mq it kk b kl km ko kp kr mr kv ms kz mt ld mu mv mw mx bi translated"><a class="ae le" href="https://docs.vespa.ai/documentation/tutorials/text-search-semantic.html" rel="noopener ugc nofollow" target="_blank">文本搜索教程的第 3 部分</a>展示了如何通过使用预先训练的句子嵌入开始语义搜索。</li><li id="286d" class="mp mq it kk b kl my ko mz kr na kv nb kz nc ld mu mv mw mx bi translated">进入<a class="ae le" href="https://docs.vespa.ai/documentation/ranking.html" rel="noopener ugc nofollow" target="_blank">排名页面</a>了解更多关于排名的一般情况，以及如何在 Vespa 中部署 ML 模型(包括 TensorFlow、XGBoost 等)。</li></ul></div></div>    
</body>
</html>