# 使用 IBM Watson 和 OpenScale 部署和解释神经网络

> 原文：<https://towardsdatascience.com/deploy-and-explain-neural-networks-using-ibm-watson-and-openscale-87288d46e6f3?source=collection_archive---------25----------------------->

![](img/27f82bdb8df5fe900f556c6cadc6c196.png)

图片由 [xresch](https://pixabay.com/users/xresch-7410129/) 通过[pix abay](https://pixabay.com/)

在进入如何使用 Watson Studio 部署机器学习模型并使用 OpenScale 解释结果的分步教程之前，我想讲一个**的小故事**，我想解释一下为什么我们实际上需要 AI，为什么 AI 是人类进化的下一步。如果您仅对技术部分感兴趣，那么可以随意跳到第二部分，名为 **IBM Watson** 。

# 为什么我们需要像人工智能这样的工具

大多数人，如果他们听到像人工智能或机器学习这样的术语，他们会想到机器人。这是因为大预算电影将人工智能呈现为一个类似人类的机器，具有毁灭人类的潜力的超能力。实际上 AI 并不真的需要胳膊和腿来毁灭人类，但这是另一个故事了。

**人工智能**基于这样一种想法，即人类的智能、行为、人类思维可以以这样一种方式建模，即机器(或算法)可以模仿人类，可以执行迄今为止需要人类干预的任务，即类似人类的推理。在我看来，我们**不应该模仿类似人类的行为，人类非常容易出错**，我们应该创造更好的机器/算法，它们可以为我们执行重复的任务，这样我们就可以专注于更重要的事情，也许是需要更多创造力、更多想象力、情感和其他类似人类品质的任务。

**进步、创新、进化需要越来越好的工具，没有工具我们的身体和心理能力都非常有限，浅薄**。如果你想想“现代”人类的历史，每个时代都是由工具定义的。如果我们从史前时代开始，所谓的史前史就已经被工具所定义，它被工具所划界。顾名思义，史前时期是从第一批石器的使用到书写系统的发明之间的时期。如你所见，在这个时代的定义中，我们已经有了工具，它被工具所界定。这两个事件之间有多个“时代”，像青铜时代或铁器时代，这些都是由工具定义的。

想想看，我们的现代历史也是由工具定义的，过去几十年最重要的事件是由新工具/机器/设备的发明定义的。是的，我说的是四次工业革命。如果我们思考这些革命，这些革命的原因是什么？答案是工具！

在第一次工业革命期间，最大的变化出现在机械化形式的工业中。机械化是农业开始被工业取代成为社会经济支柱的原因。

继第一次工业革命之后，近一个世纪后，我们看到世界经历了第二次**。它始于 19 世纪末，工业领域的巨大技术进步帮助出现了一种新的能源、电力、天然气和石油。第二次工业革命的重点是钢铁需求的发展、化学合成以及电报和电话等通讯方式。**

****第三次革命**带来了电子、电信，当然还有计算机的崛起。通过新技术，第三次工业革命打开了太空探险、研究和生物技术的大门。**

**第四次工业革命或所谓的工业 4.0 正在发生，它被一件事所定义，那就是互联网。我们可以看到从植根于技术现象的第一次工业革命一直到发展虚拟现实世界的工业 4.0 的转变，这使我们能够弯曲物理定律。**

**正如你所看到的，我们历史上所有这些重大事件都是由工具定义的，人工智能是另一个强大的工具，它可以并将重塑我们的世界。在我看来， **AI 是人类进化过程中绝对必要的一步**(也许这将是人类历史上最后一次革命，但这是后话，另文)。如果我们想进行更高级的研究(例如以光速旅行或发明一种传送方式)，我们需要更强大的工具，其中之一就是人工智能。另一个大事件将是**量子计算机**的发明，然后是**量子计算和人工智能的结合。从这一点来看，发明没有限制，从这一点来看，我们可以想象未来的研究人员将是人工智能算法，而不是人类，但这是一个非常遥远和非常脆弱的未来。我们就紧扣当下，说说我们现在有什么样的 AI/ML 的工具。****

**如今，我们有许多设备连接到互联网(第四次工业革命),每个设备都会产生数据。因为我们想要**智能的**和**个性化的** **设备**，可以猜测我们的需求，所以我们需要处理这些数据。处理如此巨大数量的数据是一项非常艰巨的任务，并且它**不能手动完成**。所以对数据的自动推理是绝对必要的。这就是人工智能来救援的地方。但是在自动推理之后，我们还想了解 AI 算法的动作的原因。这就是对可解释性的大肆宣传是如何产生的。要阅读更多关于可解释人工智能的当前趋势，你可以阅读我的文章[**解释可解释人工智能**](https://medium.com/swlh/explaining-explainable-ai-b3ca0f8b357b) 。**

# **IBM 沃森**

**IBM**开发的平台**名为 **Watson Studio，结合了机器学习服务和**Watson open scale**是一个全面的组合，旨在使开发、训练、管理模型和部署人工智能应用**变得容易。这是一个在 IBM Cloud 上交付的 SaaS 解决方案。它为您的数据科学家、工程师、开发人员和领域专家提供了协作所需的工具，以推动其业务创新。**

****Watson Studio** 加速机器和深度学习工作流，将人工智能注入您的业务，以推动创新。它为数据科学家、应用程序开发人员和主题专家提供了一套工具，允许他们协作连接数据、讨论数据并使用数据来构建、培训和部署大规模模型。成功的人工智能项目需要**算法+数据+团队**的组合，以及**非常强大的计算基础设施**。**

**这个平台的唯一问题是**文档可能很难理解**并且来自社区的支持不是那么先进，关于如何使用 Watson 的文章**很少，关于使用 Watson** 创建应用的文章**很少(几乎没有)。所以我决定我们应该缩小这个差距，Watson 是一个伟大的工具，由一个非常强大的基础设施支持，除了创建和部署模型，它还为人工智能模型提供开箱即用的解释能力。为了解释模型的结果，他们使用了在[解释可解释 AI](https://medium.com/swlh/explaining-explainable-ai-b3ca0f8b357b) 中提出的 LIME 算法。****

**在下一节中，您将看到一个示例，说明如何构建一个**神经网络**来预测**糖尿病**，然后如何使用上面提到的工具**部署**模型、**设置持续学习**、**漂移检测**以及**解释神经网络**的结果。**

# **沃森中的糖尿病预测**

**在此示例中，我们将使用神经网络通过 Pima 糖尿病数据集来预测糖尿病。我们将使用 **Keras** 包来快速构建和训练一个神经网络。我们将使用 **Watson Studio** 来**构建**、**训练**和**部署**网络和 **OpenScale** 来设置**漂移检测**、**持续学习**并向**解释模型的结果**。**

**本例中使用的数据集可以从 [Diabetes.csv](https://www.kaggle.com/uciml/pima-indians-diabetes-database/data) 下载。数据集包括几个医学预测变量和一个目标变量，结果。预测变量包括患者的怀孕次数、身体质量指数、胰岛素水平、年龄等。数据集的列可以描述为:**

1.  **怀孕次数**
2.  **口服葡萄糖耐量试验中 2 小时的血浆葡萄糖浓度**
3.  **舒张压(毫米汞柱)**
4.  **三头肌皮褶厚度(毫米)**
5.  **2 小时血清胰岛素(微单位/毫升)**
6.  **体重指数(体重公斤/(身高米) )**
7.  **糖尿病谱系功能**
8.  **年龄(岁)**
9.  **类别变量(0 或 1)**

**为了解决这个问题，首先让我们设置我们的 IBM 帐户并准备糖尿病预测所需的服务。**

# **IBM Cloud — Watson 逐步部署**

**首先要做的是在 [IBM Cloud](https://developer.ibm.com/) 上创建一个账户，并登录你的账户。**

****重要提示**:为了获得最佳性能和兼容性，**每个资源应该在同一个区域**。在本教程中，我将使用**法兰克福**作为每个资源的选定区域。您可以根据您的帐户类型和您当前的位置选择其他地区。**

**从这里开始，请遵循以下步骤:**

1.  **在屏幕的右上角，单击您的帐户图片，然后单击 My IBM。**

**![](img/e7fd5795a3aae2c5c8b940262118f968.png)**

**这将把您带到 IBM 仪表板**

**2.在您的 IBM 仪表板上，您将看到您的产品。从产品部分启动 IBM Cloud**

**![](img/d85840dfaf3c26e3388530b0a700a583.png)**

**这将带您进入 IBM Cloud Dashboard，在这里我们可以开始创建所需的服务。**

**或者，您可以使用[https://cloud.ibm.com/](https://cloud.ibm.com/)直接访问 IBM Cloud**

**3.下一步是向您的云帐户添加新资源。在您的 IBM Cloud 帐户上，单击 Create Resource 按钮。**

**![](img/6476ec8b907a5ddbd35e8caaaa4a5da5.png)**

**4.向下滚动并选择 Watson Studio 资源。**

**![](img/01a69e6408ac8b6f193290dcd5c6c114.png)**

**5.选择地区(我将选择法兰克福)，确保您已经选择了 Lite 计划(如果您不想支付)，然后单击创建。**

**![](img/72d5627235b57c063eb78ed88d86effe.png)**

**6.在 Watson Studio 资源准备就绪之后，单击 Get Started。**

**![](img/f83b79f7dccab43f2b76a3ca255f2e1e.png)**

**7.在沃森工作室，我们将创建我们的第一个项目，称为糖尿病。为此，请单击“创建项目”按钮。**

**![](img/3a2609036b09ae860681ddd46ef3f746.png)**

**8.然后点击创建空项目按钮**

**![](img/f51ba83eba74d6931b39808f9a315bfb.png)**

**10.为项目选择一个名称(此处为糖尿病)。下一步是将这个项目链接到一个对象存储(我们将在这里存储与项目相关的文件，如。用于训练数据、笔记本和由笔记本创建的资源等的 csv 文件)。要创建新的对象存储，请单击“添加”按钮。**

**![](img/d3e808f8c1b3a6f1dde0b7bfbfba5fbf.png)**

**11.选择 Lite 计划(如果您不想付费),然后单击创建**

**![](img/83ea5866e5f3820a8f1bd3293d7b82ac.png)**

**12.在弹出窗口中，为对象存储帐户命名，然后单击创建**

**![](img/542163492ae2df1481404377b0869053.png)**

**13.刷新项目创建页面，您应该看到您创建的对象存储名称链接到项目。单击 Create 创建新的 Watson Studio 项目。**

**![](img/59662dd857ae62a43c040ebf2fd7e81d.png)**

**14.该项目将自动打开(如果没有，则在 Watson Studio 主页中单击该项目的名称)。现在，我们将在项目中添加一个 jupyter 笔记本文件，它将用于创建我们的神经网络，训练它，保存它并将其部署到 IBM Cloud。为此，请单击“添加到项目”按钮。**

**![](img/51cf978bab3e75a85e7f57e12a5d6e1f.png)**

**15.选择笔记本按钮。**

**![](img/d1aec3081e5cfb434caae9845347bff5.png)**

**16.给它起一个名字(比如糖尿病预测),对于运行时，选择默认的 Python 3.6 免费运行时。单击“创建笔记本”并等待笔记本初始化。**

**![](img/cf5813b2ef658f52636f586d22235579.png)**

**17.下一步是上传笔记本将使用的培训。为此，单击操作栏中的小矩阵图标，单击浏览并选择培训数据。csv 文件。**

**![](img/5d1c3c46cd36e9a485e49aae7028bea8.png)**

**18.下一步是从上传的中读取数据。csv 文件。为此，单击 Insert to code 链接，这将自动向笔记本添加一段代码。如果您运行这个单元格(选择单元格并按 Shift+Enter ),它将连接到对象存储，读取 csv 文件并显示文件的前 5 行。**

**![](img/c7758352dd22c9ad9ef36f943fd102a7.png)**

**19.现在，我们将创建神经网络，训练它并将其保存到对象存储中**

**a.定义全局变量**

**b.导入必要的包**

**c.用于将数据拆分为特征变量和目标或标签变量，创建和训练模型，以及将模型加载到内存中的函数**

**d.因为我们将使用 zip deploy，所以我们必须压缩 NN 模型并创建一个. tgz 文件**

**20.现在我们有了压缩文件中的训练模型，下一步是将它部署到 IBM Cloud。对于这个部署，我们需要将 Watson 机器学习服务与糖尿病项目关联起来。为此，回到沃森工作室，点击汉堡包菜单，选择服务，然后沃森服务**

**![](img/df8a4b0fab431bc3211c51ec0bd61aa3.png)**

**21.点击添加服务**

**![](img/3bef97877ccf6248a71b6daa98fc9d55.png)**

**22.选择机器学习服务**

**![](img/d1a82845f59da9b8607d3c06ff9e9d06.png)**

**23.在弹出菜单中选择地区(我将选择法兰克福)，给它命名并点击确认**

**![](img/8e3523d213d31cbba5e795885594e23a.png)**

**24.将创建一个新的机器学习服务。单击服务的名称。**

**![](img/c90352a720751392224a7471352c5144.png)**

**25.为了使用这个服务来部署我们的模型，我们需要凭证来访问这个服务。在“服务凭据”选项卡上，单击“新建凭据”按钮。**

**![](img/a23fd3449ed1bf135048867fb12de550.png)**

**26.在弹出窗口中给 ti 一个名称，为服务 ID 选择 Auto Generate，然后单击 Add**

**![](img/8138941bdf078382640da859279b4592.png)**

**27.复制服务凭据，因为我们将在笔记本中使用它进行部署**

**![](img/833d92c19a3833b6e86c848e415215b6.png)**

**28.现在回到笔记本，因为我们将使用新创建的机器学习服务编写代码来部署模型**

**a.导入并创建 Watson 机器学习服务客户端**

**[https://gist.github.com/cdc56c5f4ee03c9201b9e6d6ff842f8c](https://gist.github.com/cdc56c5f4ee03c9201b9e6d6ff842f8c)**

**b.设置模型的属性，并将其发布到存储库中**

**c.我们将阅读新模型的指南，以确保它是成功生成的**

**d.创建部署**

**e.列出所有部署，以确保一切顺利**

**f.用于访问我们模型的 API 是自动生成的。我们将阅读这个的 url，来测试我们的模型。**

**g.从代码中测试模型。**

**29.如果我们想用 Postman 测试我们的模型，我们需要一个访问令牌。这可以用我们的笔记本来阅读:**

**a.安装 ibm-watson python 包**

**b.设置令牌管理器—您必须在 [IBM Cloud IAM](https://cloud.ibm.com/iam/overview) 中创建一个新的 API 密钥(或者在 IBM Cloud 主页上，单击 hamburger 菜单，选择 Security，选择 Manage，Identity and Access，这将为 IAM 打开一个新的选项卡)—单击 API 密钥，然后单击 Create an IBM Cloud API Key 按钮，复制密钥并插入令牌管理器。**

**d.在 Postman 头部分添加令牌**

**![](img/9860cd5313c6f75650776003e801537e.png)**

**e.将测试数据添加到请求的正文中，然后单击 Send**

**![](img/c41375d91351cd2775dc30a31dbeec1e.png)**

**30.现在，在你的名为糖尿病的沃森项目中，你应该有下图所示的资产**

**![](img/2cc803e68e7afc74bffbf1f58b6f1f67.png)**

**现在我们有了**工作模型和 API 端点来安全地访问它**(基于令牌的认证)，我们可以继续使用 OpenScale 建立**持续学习**、**漂移检测**和**可解释性管道。****

**在接下来的步骤中，我们将使用 **Watson OpenScale** 来解释结果，它使用 **LIME** 算法来解释模型(有关 LIME，请参见 [**解释可解释的 AI**](https://medium.com/swlh/explaining-explainable-ai-b3ca0f8b357b) )。**

# **IBM Cloud — OpenScale 逐步配置**

1.  **在 IBM Cloud Resource 列表中，单击 Create resource 并选择 Watson OpenScale，为其命名，选择区域，选择 Lite 计划并单击 Create**

**![](img/4dd0b5156a234543233cbdfd3eba12e9.png)**

**2.启动 OpenScale 平台后，选择使用免费的 lite 计划数据库**

**![](img/7c79a222fee1d445bd0a978a96e5903f.png)**

**3.下一步是添加机器学习提供者**

**![](img/aa8461f12e1ba28a7b254ca657d1eb0c.png)**

**4.你可以从多个提供商中选择，如沃森机器学习、Azure 或亚马逊服务，但我们有一个定制模型，因为我们的模型是手工构建的，由我们自己构建并手动部署。然后选择手动输入部署。**

**![](img/b10c1966bdfb9e45127981838f9597f5.png)**

**5.转到 Insights 仪表板，然后单击添加**

**![](img/6276e8c6ffe4f75850662427dbfdc1a6.png)**

**6.在弹出窗口中，选择您部署的模型名称。**

**![](img/99dc1cae3152fbb7b308dcaed3f32c76.png)**

**7.下一步是指定输入和输出数据模式。为此，我们必须创建一个新的 Jpyter 笔记本，并运行如下所示的代码:**

**8.下一步是配置模型细节:**

**a.选择存储桶名称和数据集名称**

**![](img/14f7d6f5a4d2d45c23c4861f9e7376b2.png)**

**b.配置对象存储连接。为此，您应该进入 IBM Cloud 主页，单击“hamburger”按钮，单击“所有资源”、“存储”,选择您的存储，然后选择存储对象，在菜单中，您可以找到“配置”选项卡。在这里，您将找到建立连接的所有内容。**

**![](img/201b403303dd389fcb63a99a04cd0a8e.png)****![](img/fa6b3431bdcef58349bc56c7dbd2096a.png)**

**c.选择目标类的列名**

**![](img/33f63fef4177440b6ebd6e679fb9b680.png)**

**d.选择功能列名称**

**![](img/329463315dbd453305e5d9c751f23e07.png)**

**e.选择包含分类数据文本的列(在本例中，我们没有任何分类数据)**

**![](img/e109fec02e57bb8dd0d030b3a6abafe8.png)**

**f.选择输出变量名(这是自动创建的)**

**![](img/ec4fa66ed0d579eb60538a590ca68142.png)**

**9.配置持续学习和漂移检测非常简单，您只需为评估指标(如准确性)设置一个阈值。**

**10.在所有的配置步骤(有效载荷记录、模型细节、质量、公平性、可解释性(这将被自动配置)、漂移)之后，你可以选择你的模型。**

**![](img/d50bca876fe8dc9521c79cd5c09be11b.png)**

**11.在“操作”下拉列表中，您可以上传测试数据并评估模型。如上图所示，生成了 10 份解释报告。如果您单击该数字，将出现一个弹出窗口，您可以在其中找到每个解释报告的 id。**

**12.您可以使用解释报告 id 来查看解释。**

**![](img/492e8729c119b100acdfe85ed3a82a6c.png)**

**13.这将为您提供一个如下图所示的报告。例如，在这个报告中，您可以看到特征重要性、置信度等。**

**![](img/7f28132cb508beb7f68102c6fa23ec9c.png)**

# **结论**

**在这篇文章中，我们了解到:**

*   **如何使用**沃森工作室**和**沃森 OpenScale****
*   **如何在沃森工作室使用 **Jupyter 笔记本****
*   **如何**在 Watson Studio 中创建、训练和测试神经网络****
*   **如何**将**模型部署到 **Watson 机器学习服务**并设置**具有安全连接**的测试端点(基于令牌的安全性)**
*   **如何**调用** **我们的模型使用** **邮递员****
*   **如何使用**云对象存储**以及如何将其连接到 Watson Studio 项目**
*   **如何建立一个 **Watson OpenScale 部署模型**并使用它来**解释部署的神经网络的结果****

**在下一篇文章中，我们将继续我们在**可解释 AI** 世界的旅程，我们将继续 [**的**第二部分解释可解释 AI****](https://medium.com/swlh/explaining-explainable-ai-b3ca0f8b357b) 。未来，我们将讨论其他云提供商，我们将向您展示如何**在 Google Cloud、Amazon 和 Azure 中部署模型和设置 API**。如果你有兴趣，那么请**跟着我上媒**。**

**感谢阅读这篇长文！**

****成为媒介上的作家:**[https://czakozoltan08.medium.com/membership](https://czakozoltan08.medium.com/membership)**

****我真的很喜欢咖啡，因为它给我精力去写更多的文章。如果你喜欢这篇文章，那么你可以给我买杯咖啡来表达你的欣赏和支持！****

**[![](img/0f03dd542bf76f1125912312a7c936ba.png)](https://ko-fi.com/zozoczako)**