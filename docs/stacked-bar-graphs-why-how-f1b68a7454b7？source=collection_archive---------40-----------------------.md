# 堆积条形图，为什么和如何

> 原文：<https://towardsdatascience.com/stacked-bar-graphs-why-how-f1b68a7454b7?source=collection_archive---------40----------------------->

# 讲故事和警告

![](img/7b64212e707e347429df1a6be9706efc.png)

图片由来自 Unsplash 的 Deniz Altindas 提供

**又名**:堆积条形图，分段，复合，成分，复合[条形图]

**为什么**:堆积条形图(SBG)显示了主类别和其子类别之间的数量关系。每个条形代表一个主要类别，它被分成代表第二分类变量的**子类别的段。该图表不仅显示了不同子类别之间的数量关系，而且还显示了与整个主要类别之间的数量关系。它们还用于显示子类别的组成如何随时间变化。**

这种图表使我们能够显示比标准条形图更复杂的关系([https://medium . com/nightingale/bar-graphs-why-how-8c 031 c 224 c 9 f](https://medium.com/nightingale/bar-graphs-why-how-8c031c224c9f))。堆积条形图应用于比较和比例，但重点是**构成。**这种**成分分析**可以是静态的-对于某一时刻-或者是动态的-对于确定的时间段。

请记住，成分分析与可分为单个部分的整体相关，以及每个部分如何(以相对或绝对方式)与总量相关。它也被称为整个分析的**部分。**

**如何**:堆积条形图是二维的，有两个轴:一个轴显示类别，另一个轴显示数值。指示类别的轴没有刻度(*)来强调它是指离散的(互斥的)组。带有数值的轴必须有一个带有相应测量单位的刻度。

SBG 由矩形条表示，可以像标准条形图一样**水平或垂直**定向。每个主要类别被分成代表第二分类变量的子类别的段。每个子类别的数量由横向或纵向首尾相连堆叠的矩形段的长度或高度表示。每个条形的最终高度或长度代表每个主要类别的总量(百分比堆积条形图除外)。

同等子类别在每个条中必须有相同的颜色，以免混淆观众。主线条之间通常留有一些空间，以清楚地表明它们指的是离散的组。

(*):刻度是图表中的标记，显示可视化中指示的数据值范围。它们通常表示为具有相应测量单位的间隔。

有两种不同类型的 SBG:

1.  - **简单堆叠条形图**将每个子类别的**绝对值**放置在前一个子类别之后或之上。数轴具有数值的刻度。该图显示了每个子类别的绝对值，这些值的总和表示该类别的总数。通常，主杆具有不同的最终高度或长度。

![](img/495026b68e2d243a28ed197034878f67.png)

作者使用 Matplotlib 制作的图形

2.- **100%堆积条形图**将每个子类别的**百分比**放置在前一个子类别之后或之上。数轴具有百分比数字的刻度。该图显示了每个细分市场占整个类别的百分比。所有的主杆都有相同的高度。

![](img/fb4f33d169c9f279059a4e1c774d7129.png)

作者使用 Matplotlib 制作的图形

不同的区段或子类别必须有不同的颜色或阴影，以便于识别。使用标签或图例来正确识别类别和子类别。为了便于比较，应该在每个子类内或之上标明数值，但是要注意明智地使用这些注释以避免视觉混乱。

堆积条形图用于显示调查中的响应频率。下面的例子是基于在爱尔兰进行的一项调查，该调查旨在找出三个不同级别的教育机构中教师的性别差异。100%堆积条形图显示，女性在小学教师中占 85%,在中学教师中占 62 %,在大学教师中仅占 38%。请注意数字轴上的百分比刻度，并且所有条形都具有相同的高度。教育机构的类型是主要类别，而性别是第二个分类变量。

![](img/315c8d7ae4abf07a6822b048bae77179.png)

下图显示了年度学生调查后杜克大学法学院图书馆资源和服务的使用频率。资源和服务列表符合主类别。使用水平符合第二个分类变量，答案分为三个子类:从不；偶尔；经常。它是一个水平方向的 100%堆积条形图，百分比刻度位于数字水平轴上。

![](img/cb7a9c3c52092d5d088f13bdf3b6516a.png)

来源:#1

讲述故事:简单堆积条形图的主要目的是按类别显示总数，同时指出哪些部分(子类别)在这些总数中至关重要。在 100%堆积条形图中，重点是每个子类别的百分比构成，因为不显示按类别划分的总和；换句话说，当关键信息是组成的百分比而不是类别中的总数时，使用它们。只有当**相对差异**很重要时，我们才使用 100%堆积条形图，而当**相对差异和绝对差异**很重要时，我们才使用简单堆积条形图。

恰当地确定哪个分类变量是主要变量，哪个是次要变量是至关重要的。首先，决策必须始终基于消息的性质，但请记住，主要变量将显示总量(百分比堆积条形图除外)，而次要变量将显示其绝对或相对组成。主要变量的一些提示(非强制):时间段[天、周、月、年、时间范围等。];数字范围[150–300，年龄范围，收入范围等。];数字或文字排名分数[低，中，中高，高]；最大数量的可能分段(以避免视觉混乱)。

SBG 用于动态构成分析，显示子类别的构成如何随时间变化。下图显示了 1997 年至 2016 年期间卢旺达议会性别构成的变化。50%的水平虚线清楚地表明，2008 年是议会中女性人数首次超过男性的一年。具有两个以上子类别的动态合成分析的 SBG 必须非常小心地使用，因为它们非常难以阅读。

![](img/5bf4c442bdb72164c2b6b94bb6603ef0.png)

来源:#2

讲故事可以通过用线连接连续的片段来改进，但应该注意的是，这种比较只适用于下一小节和上一小节之间。

![](img/625cbb9873d9a6885efe5bd20a289bb3.png)

来源:#3

**警告**

尽量不要添加太多的子类别。堆叠超过四或五层可能会使观众迷惑；

基线从 0 开始:如果条形被截断，实际值将不能正确反映。如果你的一些数据有负值，把它们画在突出显示的零基线的下面或左边；

当第二个分类变量中没有隐含的顺序时(当它们不是有序分类变量时),执行堆叠的顺序应该是明智的，以便于讲故事；

更好的比较是在 0 基线附近的子类别中进行的。随着我们越往上走，子类别之间的差异或贡献就越难理解。条形之间的对应部分无法进行严格的比较，因为它们偏离了不同的基线；

如果其中一个分类变量与时间(年、月、日、时间范围)相关，则始终将其设置为主要类别，并绘制在横轴上；

当长时间有太多的条形或者超过三个子类别时，它们也很难阅读。在这些情况下，最好使用**叠加面积图**或**叠加密度图**；

有时讲故事建议使用调色板来赋予你的图表更多的含义:**顺序**单一颜色从最少到最多；**分叉**两种配色方案，具有临界中点值；**改变颜色**以突出高于或低于阈值的值，或者突出特定的段；

永远记住，多达 10%的男性观众可能有色彩不足的问题；

当主要分类变量有很长的名字时，水平 SBG 是优选的；

避免所有 3D 效果。尽管它们在美学上令人愉悦，但是它们违背了适当的数据可视化的所有规则；

最后，永远记住矩形是非常沉重的视觉标记。

下图强调了之前警告中指出的一些想法:使用不超过五个子类别；用负数值突出显示 0 处的基线；主要范畴与时间有关；最好的比较对象是德国，这个分类更接近基线；通过适当的调色板可以清楚地看到各个部分。

![](img/f7c9d252fdbce5c97d871584d7f2c6d2.png)

来源:#4

一些作者(#5)认为 SBG 不方便、无用甚至有害。他们认为，这种图表只有在特定棒线分段之间或棒线之间对应分段之间的数字差异相当大时才有用。如果这些差异相对接近，则几乎有必要在每个子类别内或之上用数值来表示，以阐明故事情节。

综上所述， **SBG 应用广泛但读起来并不简单**。我们的建议是，当你需要对一个二级分类变量进行部分到整体的分析，而不需要对该变量水平之间的实际数值差异做出精确的声明时，使用它们作为第一眼。当时态数据量相对较少且每个堆栈不超过两个或三个段(子类别)时，它们也可以很好地显示组成随时间的变化。

如果你对这篇文章感兴趣，请阅读我以前的:

直方图、为什么和如何、讲故事、技巧和扩展

[](/histograms-why-how-431a5cfbfcd5) [## 直方图，为什么和如何

### 讲故事、技巧和扩展

towardsdatascience.com](/histograms-why-how-431a5cfbfcd5) 

*参考文献*

*# 1:*[*https://law.duke.edu/lib/survey-results/*](https://law.duke.edu/lib/survey-results/)

*# 2:*[*https://serial mentor . com/dataviz/visualizing-proportions . html*](https://serialmentor.com/dataviz/visualizing-proportions.html)

*# 3:*[*https://www.ahapitch.com/bar-chart/*](https://www.ahapitch.com/bar-chart/)

*#4: Leo，s .，错误，我们画了几个，中，经济学人，2019 年 3 月 27 日*

*#5: Kosara，r，堆叠棒线最差 2016 年 8 月 24 日，*[*https://eagereyes.org/techniques/stacked-bars-are-the-worst*](https://eagereyes.org/techniques/stacked-bars-are-the-worst)