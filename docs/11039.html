<html>
<head>
<title>Deep Learning End to End Pipelines made easy with Fluent Tensorflow Extended</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">借助 Fluent Tensorflow Extended 简化深度学习端到端管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-learning-end-to-end-pipelines-made-easy-with-fluent-tensorflow-extended-2a26f5d5817?source=collection_archive---------50-----------------------#2020-07-31">https://towardsdatascience.com/deep-learning-end-to-end-pipelines-made-easy-with-fluent-tensorflow-extended-2a26f5d5817?source=collection_archive---------50-----------------------#2020-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ae8e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">快速 api 概述和 fluent-tfx 的自包含示例</h2></div><p id="a15a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果这种生产 e2e ML 管道的事情对你来说似乎是新的，<a class="ae le" href="https://www.tensorflow.org/tfx" rel="noopener ugc nofollow" target="_blank">请先阅读 TFX 指南。</a></p><p id="22f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一方面，如果你以前用过 TFX，或者计划部署一个机器学习模型，那你就找对地方了。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/ad4e01efe48322451815778a3d30fbe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6vjxiN8YMZS2fjWmp2c5PA.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图片由<a class="ae le" href="https://pixabay.com/users/jarmoluk-143740/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=264778" rel="noopener ugc nofollow" target="_blank">米歇尔·贾莫卢克</a>从<a class="ae le" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=264778" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>拍摄</p></figure><h2 id="8c88" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">但是 Tensorflow Extended 已经完全有能力自己建设 e2e 管道，为什么还要麻烦使用另一个 API 呢？</h2><ul class=""><li id="582c" class="mo mp it kk b kl mq ko mr kr ms kv mt kz mu ld mv mw mx my bi translated">冗长的代码定义。实际的预处理和训练代码可能与实际的管道组件定义一样长。</li><li id="8826" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">缺乏合理的违约。您必须手动指定所有东西的输入和输出。这一方面提供了最大的灵活性，但在其他 99%的情况下，大多数 io 都可以自动连接。<em class="ne">例如，您的预处理组件可能会读取您的第一个输入组件的输入，并将输出传递给培训。</em></li><li id="6910" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">太多样板代码。通过 TFX CLI 搭建可在 4-5 个目录中生成 15-20 个文件。</li></ul><h2 id="a11d" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">更易于使用的 API 层的优势</h2><ul class=""><li id="6d53" class="mo mp it kk b kl mq ko mr kr ms kv mt kz mu ld mv mw mx my bi translated">流畅紧凑的管道定义和运行时配置。不再需要在构建管道的 300 多行庞大的函数中滚动</li><li id="ccc3" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">没有脚手架，很容易通过使用几行代码来设置</li><li id="3feb" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">额外的有用的工具，以加快常见的任务，如数据输入，TFX 组件建设和布线</li><li id="dcef" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">合理的默认值和 99% —合适的组件 IO 接线</li></ul><blockquote class="nf ng nh"><p id="3d35" class="ki kj ne kk b kl km ju kn ko kp jx kq ni ks kt ku nj kw kx ky nk la lb lc ld im bi translated"><em class="it">声明:我是</em><a class="ae le" href="https://github.com/ntakouris/fluent-tfx" rel="noopener ugc nofollow" target="_blank"><em class="it">fluent-tfx</em></a>的作者</p></blockquote><h1 id="8edb" class="nl lw it bd lx nm nn no ma np nq nr md jz ns ka mg kc nt kd mj kf nu kg mm nv bi translated">通过示例进行 API 概述</h1><p id="8d75" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated"><em class="ne">这本质上是</em><a class="ae le" href="https://github.com/ntakouris/fluent-tfx/blob/master/examples/usage_guide/simple_e2e.py" rel="noopener ugc nofollow" target="_blank"><em class="ne">fluent-tfx/examples/usage _ guide/simple _ e2e . py</em></a><em class="ne">，但是请继续读下去。</em></p><p id="48ac" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你已经了解 TFX 的基本情况，滚动到<strong class="kk iu">管道建设</strong>。</p><h2 id="1b35" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">数据输入</h2><p id="c5a3" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">文件<code class="fe nz oa ob oc b">data/data.csv</code>实质上是 4 列:<code class="fe nz oa ob oc b">a, b, c, lbl</code>。<code class="fe nz oa ob oc b">a</code>和<code class="fe nz oa ob oc b">b</code>是随机采样的浮点，<code class="fe nz oa ob oc b">c</code>是二进制特征(<code class="fe nz oa ob oc b">0</code>或<code class="fe nz oa ob oc b">1)</code>)<code class="fe nz oa ob oc b">lbl</code>是二进制标签(值<code class="fe nz oa ob oc b">0</code>或<code class="fe nz oa ob oc b">1</code>)。那是个玩具问题，只是为了演示。</p><h2 id="e48f" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">模型代码</h2><p id="84e4" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">工程师或“用户”提供预处理、模型构建、超参数搜索和保存带有正确签名的模型的功能。我们将展示如何在另一个文件中轻松定义这些函数(比如<a class="ae le" href="https://github.com/ntakouris/fluent-tfx/blob/master/examples/usage_guide/model_code.py" rel="noopener ugc nofollow" target="_blank"> model_code.py </a>)</p><p id="5162" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将利用 TFX 的所有优势来完成大部分工作。</p><p id="daa6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://www.tensorflow.org/tfx/transform/get_started" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">预处理的张量流变换</strong> </a> <strong class="kk iu"> : </strong></p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="78b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://www.tensorflow.org/guide/data" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">【tensor flow】数据集，为模型提供有效的输入:</strong> </a></p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="6c72" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://keras-team.github.io/keras-tuner/" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">keras Tuner</strong></a><strong class="kk iu">和</strong> <a class="ae le" href="https://www.tensorflow.org/tfx/guide/tuner" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> TFX 调谐器——用于超参数搜索和建模的训练器:</strong> </a></p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="od oe l"/></div></figure><h2 id="c28a" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">管道建设</h2><p id="f9b9" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">构建管道并不简单:提供一些带有<a class="ae le" href="https://www.tensorflow.org/tfx/tutorials/model_analysis/tfma_basic" rel="noopener ugc nofollow" target="_blank"> Tensorflow 模型分析</a>的评估配置，只需使用<a class="ae le" href="https://github.com/ntakouris/fluent-tfx/blob/master/examples/usage_guide/simple_e2e.py" rel="noopener ugc nofollow" target="_blank"><em class="ne">fluent-tfx</em></a>；</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="od oe l"/></div></figure><h2 id="bb27" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">滑行装置</h2><p id="6d1d" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">在 TFX 支持的<a class="ae le" href="https://beam.apache.org/documentation/runners/capability-matrix/" rel="noopener ugc nofollow" target="_blank">不同管道上运行管道不需要额外的努力</a>，也不需要额外的依赖:<code class="fe nz oa ob oc b">PipelineDef</code>生产一个普通的 TFX 管道。</p><p id="0f03" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，如果您在管道函数中使用<code class="fe nz oa ob oc b">ftfx</code>工具，<a class="ae le" href="https://beam.apache.org/documentation/sdks/python-pipeline-dependencies/" rel="noopener ugc nofollow" target="_blank">请确保将这个包包含在 requirements.txt beam 参数</a>中。</p></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><h1 id="a100" class="nl lw it bd lx nm om no ma np on nr md jz oo ka mg kc op kd mj kf oq kg mm nv bi translated">附录:自由度和限制</h1><p id="965b" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">自定义组件在很大程度上受到支持，但是仍然会有一些边缘情况，这些情况只适用于冗长简单的旧 TFX api。</p><p id="5f67" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设与组件 DAG 布线、路径和命名相关。</p><h2 id="9f91" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated"><strong class="ak">路径</strong></h2><ul class=""><li id="3544" class="mo mp it kk b kl mq ko mr kr ms kv mt kz mu ld mv mw mx my bi translated"><code class="fe nz oa ob oc b">PipelineDef</code>需要一个<code class="fe nz oa ob oc b">pipeline_name</code>和一个可选的<code class="fe nz oa ob oc b">bucket</code>路径。</li><li id="6a32" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">二进制/临时/暂存工件存储在<code class="fe nz oa ob oc b">{bucket}/{name}/staging</code>下</li><li id="72d7" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">除非另有说明，否则默认 ml 元数据 sqlite 路径设置为<code class="fe nz oa ob oc b">{bucket}/{name}/metadata.db</code></li><li id="57a9" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated"><code class="fe nz oa ob oc b">bucket</code>默认为<code class="fe nz oa ob oc b">./bucket</code></li><li id="c7c6" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">推进者的<code class="fe nz oa ob oc b">relative_push_uri</code>将模型发布到<code class="fe nz oa ob oc b">{bucket}/{name}/{relative_push_uri}</code></li></ul><h2 id="4f9d" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated"><strong class="ak">组件 IO 和名称</strong></h2><ul class=""><li id="d0a2" class="mo mp it kk b kl mq ko mr kr ms kv mt kz mu ld mv mw mx my bi translated">一个输入，或者一个<code class="fe nz oa ob oc b">example_gen</code>组件提供<code class="fe nz oa ob oc b">.tfrecord</code>给下一个组件(可能是 gzipped 格式)</li><li id="015f" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">流畅的 TFX 遵循 TFX 命名的默认组件的一切。当提供定制组件时，确保输入和输出与 TFX 相同。</li><li id="351a" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">例如，您的定制<code class="fe nz oa ob oc b">example_gen</code>组件应该有一个<code class="fe nz oa ob oc b">.outputs['examples']</code>属性</li><li id="0987" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">当使用来自<code class="fe nz oa ob oc b">input_builders</code>的额外组件时，确保您提供的名称不会覆盖默认值，例如标准 tfx 组件名称<code class="fe nz oa ob oc b">snake_case</code>和<code class="fe nz oa ob oc b">{name}_examples_provider</code>、<code class="fe nz oa ob oc b">user_{x}_importer</code>。</li></ul><h2 id="1bbc" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated"><strong class="ak">元件接线默认</strong></h2><ul class=""><li id="2f56" class="mo mp it kk b kl mq ko mr kr ms kv mt kz mu ld mv mw mx my bi translated">如果提供了用户提供的模式 uri，它将用于数据验证、转换等。如果声明的话，生成的模式组件仍然会生成工件</li><li id="e54c" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">如果用户没有提供模型评估步骤，它将不会被连线到推送器</li><li id="97f0" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">默认训练输入源是转换输出。用户可以指定他是否想要原始 tf 记录</li><li id="a3ee" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">如果指定了超参数并声明了 tuner，tuner 仍将测试配置并生成超参数工件，但将使用提供的超参数</li></ul></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="2aac" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谢谢你一直读到最后！如果这种生产 ML 管道的事情对你来说似乎是新的，请阅读 TFX 指南。</p></div></div>    
</body>
</html>