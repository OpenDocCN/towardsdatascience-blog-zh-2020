# 利用机器学习预测住院患者的急性肾损伤

> 原文：<https://towardsdatascience.com/predicting-acute-kidney-injury-in-hospitalized-patients-53ca07525e67?source=collection_archive---------32----------------------->

## 通过使用机器学习算法预测肌酐值来预测住院患者的急性肾损伤。

![](img/f19e332c2496755607f512b90b66c355.png)

[来源](https://unsplash.com/photos/-szKjHyPq28):肾脏模型，横断面

K 肾脏是你体内过滤血液的重要器官。他们负责清除废物，维持和控制身体的体液平衡，保持电解质的正确水平等。

生病和住院的病人发生肾损伤的风险很高。

> ***急性肾损伤(AKI):***
> 
> [“…是在几小时或几天内发生的肾衰竭或肾损害的突然发作。”](https://www.kidney.org/atoz/content/AcuteKidneyInjury)

AKI 由 2012 年发布的 [KDIGO 标准](https://kdigo.org/wp-content/uploads/2016/10/KDIGO-2012-AKI-Guideline-English.pdf)更精确地定义。

简而言之，当肾脏受损时，会出现以下问题:

1.  身体的液体平衡和电解质逐渐变得紊乱，最终威胁生命。在严重的情况下，医生可能会对患者进行透析——这需要几个小时的准备，需要一个特殊的程序来建立血液与透析机的人工连接。更不用说，紧急透析是非常昂贵的，一次治疗通常要花费 10，000 美元左右。
2.  大多数药物通过肾脏排出体外。受伤的肾脏无法迅速将药物清除出体外，体内的药物浓度会累积，导致用药过量。这通常是医生可能改变药物剂量或完全改变药物的原因。

![](img/a1c05243daae8fde532929ee67b84235.png)

血清肌酸酐通过血液测试来测量

医生测量肌酸酐，肌酸酐是肌肉产生的一种生物标志物，由肾脏从体内过滤到尿液中。它在你血液中的浓度可以作为肾脏健康/功能的代表。如果你的肾脏过滤血液的能力因为受伤而恶化，那么肌酐值就会上升。

然而，当肌酐上升时，对肾脏的损害已经发生了。理想的情况是能够在肾脏损伤发生之前预测到它的迫近。

# 模型假设

由于体内的器官系统是相互依赖的，我推断肌酐值(肾脏健康的代表)可能依赖于心脏和肝脏等其他器官的健康。这些其他器官的“健康状况”可以通过针对这些器官系统的不同实验室测试来测量。

我开发了一个预测性临床计算器，使用各种实验室测试和患者人口统计数据作为输入特征，以便预测第二天的肌酐值。肌酐预测值恶化表明 24 小时内即将发生急性肾损伤(AKI)。

![](img/c38451df3d9ffed99683693f298319e2.png)

**示意图**:输入输出，评估 AKI 风险

# 获取数据

为了制作这个计算器，我使用了一个名为 MIMIC-III 的可免费访问的去身份病人医疗数据库。关于访问数据库的信息可在[生理网网站](https://mimic.physionet.org/gettingstarted/access/)上找到。

![](img/59bb7f2d0f2d60cd2db4c0547129f510.png)

MIMIC-III 数据库的[概览页面](https://mimic.physionet.org/gettingstarted/overview/)

在获得对 MIMIC-III 数据库的访问权后，我按照 [Physionet 的指令](https://doi.org/10.5281/zenodo.821872)将数据传输到 PostgreSQL 的本地实例中。数据库中提供了 25 个表格，我针对我的具体项目查询了其中的`[ADMISSIONS](https://mimic.physionet.org/mimictables/admissions/)`、`[CHARTEVENTS](https://mimic.physionet.org/mimictables/chartevents/)`、`[D_ITEMS](https://mimic.physionet.org/mimictables/d_items/)`、`[D_LABITEMS](https://mimic.physionet.org/mimictables/d_labitems/)`、`[INPUTEVENTS_MV](https://mimic.physionet.org/mimictables/inputevents_mv/)`、`[LABEVENTS](https://mimic.physionet.org/mimictables/labevents/)`、`[PATIENTS](https://mimic.physionet.org/mimictables/patients/)`。我咨询了一位医生，以确定我应该在我的模型中包括哪些实验室测试——我最终得到了 78 个特征。

# 数据清理和处理

![](img/13acda2892e18aa17966c78cebc35a9f.png)

**示意图**:数据是如何获得、提取和清理的，以及一些数据混乱的例子

来自医院使用的真实电子健康记录的临床健康数据是混乱的。为了处理数据，我首先使用`HADM_ID`、`ITEMID`、`SUBJECT_ID`将必要的表(上面列出的表)连接起来。

*   `HADM_ID`:“代表单个患者入院”
*   `SUBJECT_ID`:“指定单个患者的唯一标识符”
*   `ITEMID`:“表示数据库中的测量值”

单个`SUBJECT_ID`下的患者可以在不同的时间点多次入院，每次新入院都列在`HADM_ID`下。出于这个项目的目的，我将每个`HADM_ID`视为一个独特的事件，并没有将它们归入`SUBJECT_ID`下(尽管如果我有时间，我会这样做以说明历史健康数据——这可能会改进我的模型)。

利用 PANDAS 数据框架，我将表格转换成一种格式，这样，实验室值就可以按照获得它们的日期和时间以`YYYY-MM-DD HH:MM:SS`格式进行索引。这样做的原因是，许多患者在一天内进行了多个实验室检查，但在一天中的许多不同时间点进行。这将被证明在我后面解释的数据处理管道中是有用的。

年龄等信息需要通过减去住院时间和出生日期来计算。然后我用整数编码分类变量，比如性别和种族。我还必须规范化实验室值及其对应的单元类型，因为它们在数据集中以混合类型存在。

健康数据很少，所以我在每个病人身上插入了任何缺失的实验室数据。

![](img/f8a6c06ba5a5aa60a7e484050d98254f.png)

**示意图**:心形表示记录实验室数值的日期。x 表示没有实验室值。

每次住院的实验室可以在时间线上进行概念上的“绘制”。我将该时间线的每个 24 小时时间窗内的所有实验室作为输入特征，并将下一个 24 小时的肌酐作为输出“目标”，我将尝试对其进行预测。

![](img/b77e974926a0943767daee88f7f7a27b.png)![](img/2eb72f03cd39be48b84610fc0b07372c.png)

**示意图**:抓取输入数据`X`和输出次日值`Y`的滑动窗口方法

结果是一个输入矩阵`X`，其中每行代表 1 天，每列是我用作特性的 78 个实验室之一。目标向量`Y`包含第二天的肌酸酐。缺失的特征被赋值为`NaN`。

![](img/3cc2cefe109ba716a1865ce89956a849.png)

**示意图**:加工清洗后的数据表。X_matrix 包含输入特征，其中每个特征都是一种不同的实验室测试。Y 向量包括第二天的肌酸酐值。

# 型号选择和性能

我最初用线性回归做了一些探索性的数据分析。虽然线性回归似乎在预测第二天的值方面做得不错，但 AKI 中的肌酐趋势通常不是线性的。

我决定使用 [XGBoost](https://xgboost.ai/) (极端梯度提升)来提高计算速度、准确性和可伸缩性。XGBoost 是[陈天琦](https://tqchen.com/)和[卡洛斯·盖斯特林](https://homes.cs.washington.edu/~guestrin/)对梯度增强树的应用——你可以在这里阅读更多关于它的详细信息[。简而言之，它结合了梯度增强和决策树的概念，梯度增强迭代地建立在先前预测器的伪残差上。它的准确性来自于在它的`log loss`度量中使用二阶导数和内置的正则化参数。我发现这篇文章](https://arxiv.org/pdf/1603.02754.pdf)的答案有助于解释 XGBoost 的一些方面。

由于 XGBoost 无法处理缺失的数据，我用每个实验室测试的中值填充了所有的`NaN`,并咨询了医生，以验证这是模型开发的合理临床假设。

我以 80/10/10 的比例将数据集分为训练集、验证集和测试集。

![](img/c6649a930f37769568cea5436def49d6.png)

每次分割的数据大小。超过 3400 万个数据点！

XGBoost 在获取高维实验室数据并从中推断关系方面被证明是不可思议的。下面是我的最终模型的性能和附带的超参数的可视化。

![](img/19ff9bf93d2b512c5238907fbb9aaf8c.png)

**图**:通过绘制真实肌酐值与测试集中预测肌酐值的对比图，可视化模型性能。试验了超过 45 个超参数变量，这是表现最好的模型，r 值达到 0.9377。完美模型的 r 为 1.0，预测值将沿着斜率为 1 的直线排列。

![](img/d5cadcbf7d92169e320e547ee85e8384.png)

**图**:将训练和验证的回归误差设置为模型训练，并迭代添加估计量。RMSE 是均方根误差，MAE 是平均绝对误差，RMSLE 是均方根对数误差。模型训练了多达 1000 个估计量，此时误差值达到了稳定水平，表明额外的估计量对模型性能的改善很小。

# **总结思路**

总之，我使用 XGBoost 建立了一个模型来预测第二天的肌酐值。我希望像这样的模型有一天可以集成到电子健康记录(EHR)中，以动态预测未来的肌酐(和 AKI 风险)。这将为医生提供实时临床决策支持，使他们能够提前解决肾损伤问题，而不是治疗它。

# 参考

1.  MIMIC-III，一个免费的重症监护数据库。Johnson AEW，Pollard TJ，Shen L，Lehman L，Feng M，Ghassemi M，Moody B，Szolovits P，LA 和 Mark RG。科学数据(2016)。DOI: 10.1038/sdata.2016.35。可在:【http://www.nature.com/articles/sdata201635[获得](http://www.nature.com/articles/sdata201635)
2.  约翰逊，阿利斯泰尔 EW，大卫 j .斯通，利奥 a .切利和汤姆 j .波拉德。"模拟代码库:在危重病研究中实现再现性."美国医学信息学协会杂志(2017): ocx084。