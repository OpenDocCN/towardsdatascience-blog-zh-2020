<html>
<head>
<title>VPC, Subnet and Router in AWS Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS云中的VPC、子网和路由器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/vpc-subnet-and-router-in-aws-cloud-17c8f421af21?source=collection_archive---------39-----------------------#2020-06-07">https://towardsdatascience.com/vpc-subnet-and-router-in-aws-cloud-17c8f421af21?source=collection_archive---------39-----------------------#2020-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8e9e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何在AWS cloud中设置VPC和子网，以及路由器的作用。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/ff14daea6c796b6a4c04c6a2bbfea23d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*VKTHtHwo3pUxeDP0ZmrOoA.jpeg"/></div></figure><blockquote class="kq kr ks"><p id="8b38" class="kt ku kv kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">指导——在每一步，我都给出了如何执行该步骤的指导，然而，在下面的描述中，我解释了我自己对整个过程的评估，这可能因人而异。(可以的话请指正)</p><p id="a35b" class="kt ku kv kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为一个旁注，如果下面的文章看起来太脱节，只需打开AWS控制台，开始动手实践，这将是小菜一碟。</p></blockquote></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="4929" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi translated">VPC是一种虚拟私有云，它允许我们创建一个网络逻辑单元，其中的硬件和资源由供应商或服务提供商管理。作为用户，我们负责网络的配置和逻辑设置。</p><p id="eb52" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi translated">一个VPC只能在一个区域内定义，每个VPC可以有多个子网。子网用于提供VPC内部的粒度。我为这个博客创建了三个子网。每个子网的IP地址范围都必须在its IP的范围内，并且每个子网的IP都不能与其他子网冲突。我们使用CIDR块来设置这些IP范围。</p><p id="d3f4" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi translated">每个子网可以是公共子网，也可以是私有子网。公共子网可以直接访问互联网，而私有子网不能直接访问互联网。</p><p id="81c0" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi translated">一旦建立了VPC，我们就需要创建一个互联网网关来允许VPC的流量进出互联网。拥有一个因特网网关并不能使每个子网对因特网公开，而是允许路由表做出决定。</p><p id="61f2" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi translated">路由表将来自网关的流量转移到VPC内部，并在子网之间进行分配。每个VPC都有一个连接到每个子网的默认路由表。另一方面，我们可以创建自己的路由表来定义VPC内部的流量。因此，我创建了一个单独的路由表，然后将它连接到IP为0.0.0.0/0的internet网关，然后将两个子网关联到这个自制的路由表。这样，我使我的两个子网(三个中的两个)具有公共访问权限，而第三个子网只连接到默认路由表(仍然是私有的)。</p><p id="22b5" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi translated">需要注意的一点是，每个VPC只能有一个互联网网关。当我试图连接另一个网关时，系统不允许我这样做。</p><p id="0fbb" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi translated">正如AWS中的其他服务需要一个安全组来定义入站和出站流量一样，VPC也需要这样做。因此，我提供了HTTP入站流量和完整的出站流量。这意味着来自互联网网关的任何HTTP请求都将被允许到达网络内部，SSH也是允许的。但是，每种输出流量都将被允许流向互联网。</p><p id="eaab" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi translated">网络建立后，出于安全原因，监控任何更改都至关重要。因此，我们必须设置一个日志流来跟踪我们的VPC内部的每一个活动，并将其发送到所需的目的地。我们可以将其发送到s3，然后使用数据进行分析，也可以将其发送到cloud watch。我已经将我的流日志设置为使用适当的IAM角色发送到CloudWatch。</p><ol class=""><li id="5eb2" class="ma mb it kw b kx ky la lb lx mc ly md lz me lp mf mg mh mi bi translated">创建了VPC →去控制台搜索VPC。然后点击启动VPC向导，并选择正确的模板。提供必要的详细信息，然后点击创建。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/8257d405763f425f823a43f0a897ca9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1neFpzTLDcOxTXJL4PM3-g.png"/></div></div></figure><p id="e9ee" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi mw translated"><span class="l mj mk ml bm mm mn mo mp mq di"> 2。</span> <strong class="kw iu"> </strong>创建三个具有不同可用性区域的子网。转到左侧面板上的子网，然后单击创建子网。为子网提供名称，并将其连接到相关VPC。重复该步骤三次，创建三个子网，每个子网具有不同的可用性分区，如下图快照中突出显示的那样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/fa12e1712db74ca42365cf762a681566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*88KkTB59ZmtzdBJz0YkC5w.png"/></div></div></figure><p id="bbda" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi mw translated"><span class="l mj mk ml bm mm mn mo mp mq di"> 3。</span> <strong class="kw iu"> </strong>创造了一个互联网网关，并将其连接到VPC。单击左侧面板上的互联网网关，提供一个名称，然后单击创建。我把它命名为实验室互联网网关。创建后，选择网关并单击操作下拉菜单。将有一个选项将其附加到特定的VPC。一旦附上，回到你的VPC菜单。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mx"><img src="../Images/52572c89767c8ae2d7b112f80e74aed9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1L-a98CP5uqFFtYuBHPQUQ.png"/></div></div></figure><p id="f004" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi mw translated"><span class="l mj mk ml bm mm mn mo mp mq di"> 4。</span> <strong class="kw iu"> </strong>创建了另一个互联网网关，并试图将其连接到同一个VPC。再次遵循上述相同的步骤，可以看到我们只能将一个网关连接到一个VPC。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi my"><img src="../Images/53f71bc787a8a0a5009139e4cd371bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u-0yzX_3xjulQy7HbgCYeg.png"/></div></div></figure><p id="cb13" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi mw translated"><span class="l mj mk ml bm mm mn mo mp mq di"> 5。</span> <strong class="kw iu"> </strong>创建公共访问路由表后，三个子网中有2个是公共访问，剩下1个是私有访问。首先，创建一个路由表，然后附上有关VPC。连接VPC并创建路由表后，单击路由器选项卡并编辑路由表。在路由表中，单击添加路由并输入0.0.0.0/0，这是一个公共访问IP。现在，将该IP与我们在上述步骤中创建的VPC网关连接起来。现在，要使我们的两个子网具有公共访问权限，请转到“subnet associated”选项卡，编辑子网关联，选择两个子网，然后单击“save”按钮。这样，我们就创建了一个连接到VPC网关的路由表，并且我们已经将两个子网连接到该路由表，可以通过连接的网关进行公共访问。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mx"><img src="../Images/4244b4a6178be2bb331b4be98f42d168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XFJIvje7B_HVSNNgojf2dg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mx"><img src="../Images/4d801b8a6ac91a94d9c2efe24fe95288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*salbmkiDYSZ-ClVphlWNvw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi my"><img src="../Images/85541e4b95d1718aeede713283bb4c2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZg7AlMMFrMBrmzLrbhw0A.jpeg"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mx"><img src="../Images/6cc9bf126620c4942a17be4c9c025902.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jMOE-y3-HbbIigfZ6xg5uA.jpeg"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mz"><img src="../Images/7ff7fbc503febc5f0bc3c1a603e73b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hbqM8DZQaqXfovYGphBj4Q.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi my"><img src="../Images/e5496345e16d8eccef7147de0eb2f6f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gryLX0IoHbwndq9Lfz6JPw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/06830157a37c1c2fa8d257e68ca623a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*chAMey4xYkWtAM6r7OJ7BQ.jpeg"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mx"><img src="../Images/7905e317713ad2017e651f1b9c740cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NY9Uts-XYosWESfeHmaFtw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/c040d046648766b4527c5d9fc4450ba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xmobM__e9z5lj6B2Ic0CLw.jpeg"/></div></div></figure><p id="1b49" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi mw translated"><span class="l mj mk ml bm mm mn mo mp mq di"> 6。</span>现在，我们已经将子网连接到VPC，将路由表连接到网关，我正在连接安全组。安全小组将允许交通进出我们的VPC。对于入站流量，我允许HTTP和SSH，对于出站流量，我允许完全访问。这意味着只有HTTP和SSH元素可以进入VPC，但是VPC内部的所有内容都可以不受任何限制地发送到外部。首先，单击左侧面板上的安全组，然后单击“创建安全组”，然后为安全组提供一个新名称，提供一个描述并附上相关的VPC。然后提供入站和出站流量规则，如快照所示。完成后，单击创建安全组，它将被附加到VPC。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi na"><img src="../Images/a4819be8bfaf8f53629cf7e6f56286c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qFs2w5s41IY6CKO0Ov5GAw.jpeg"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mx"><img src="../Images/691fc234e2a7d5125baa1c6b0e435195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EhuWf41m5RsXqZqgCFv3Fg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mx"><img src="../Images/1a1abf7be472ace54aed934a947900d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H1F9CavWDfsFAwqLfqitLg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mx"><img src="../Images/81885f331ab666c2e07055511e97dbff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WSOPecfUwq0L4VjDsbMk6Q.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mx"><img src="../Images/3ec9b543fa47a7fb0c1939574ec7023b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z-8kqHc2tMWTRMcDYwYtmg.png"/></div></div></figure><p id="3ee4" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi mw translated"><span class="l mj mk ml bm mm mn mo mp mq di"> 7。</span>现在我们已经建立了整个环境，跟踪我们网络内部的每一项活动非常重要。为此，我们必须创建一个VPC流量日志。首先，单击我们创建的VPC，然后单击“流量日志”选项卡，然后单击蓝色的“创建流量日志”按钮，然后选择过滤器，通知流量日志监控特定类型的活动。例如，如果我们希望只监控网络中被拒绝的请求，或者只监控网络中被允许的请求，或者两者都监控。我选择了全部。现在创建一个目标日志组，该日志组将包含来自我们网络的所有日志信息，此外，用户还可以将日志发送到s3存储桶。为了访问日志组，我们还必须附加IAM策略，以允许流日志访问云观察日志组。最后，我们点击保存。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/1dd44e08defa8ec19828e2fc55c1d5f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tyncTUnMcpMM8qcYsIHAYA.jpeg"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/acbac0757e6ad45d179871dc2c057924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HajcfcABMCbor-uvIr1S1g.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mx"><img src="../Images/e77b5e5d27c1696e0cdb7a11fcdda4c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vepRhtKihfhyWMemz9nyrw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mz"><img src="../Images/61bad1d2f5be4ad578d229d4305996ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qjx9GDuw_HuhgvOOJr_Ixg.png"/></div></div></figure><p id="62af" class="pw-post-body-paragraph kt ku it kw b kx ky ju kz la lb jx lc lx le lf lg ly li lj lk lz lm ln lo lp im bi translated">我们到此为止，我们的网络设置完毕。如果你有任何意见，请分享你的想法。谢谢大家！</p></div></div>    
</body>
</html>