<html>
<head>
<title>Make your own Rick Sanchez (bot) with Transformers and DialoGPT fine-tuning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用变形金刚和DialoGPT微调制作你自己的Rick Sanchez(机器人)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/make-your-own-rick-sanchez-bot-with-transformers-and-dialogpt-fine-tuning-f85e6d1f4e30?source=collection_archive---------10-----------------------#2020-06-08">https://towardsdatascience.com/make-your-own-rick-sanchez-bot-with-transformers-and-dialogpt-fine-tuning-f85e6d1f4e30?source=collection_archive---------10-----------------------#2020-06-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dc99" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">教GPT-2像一个疯狂的科学家一样写作</h2></div><p id="99c5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我是'<a class="ae le" href="https://en.wikipedia.org/wiki/Rick_and_Morty" rel="noopener ugc nofollow" target="_blank"> Rick和Morty </a>'和NLP(自然语言处理)的忠实粉丝。在看了《疯狂科学家和他孙子的冒险》的最后一集后，我意识到我必须应用我在NLP和机器学习方面的知识来创造我自己的Rick(至少目前是以聊天机器人的形式)。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/9b2a159d532171ae99c37494a12f0725.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*t75wxMkidc4GFYxR.gif"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图片来自<a class="ae le" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><p id="7912" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创造虚拟瑞克的道路并不容易。我尝试了许多模型和方法，但虚拟里克在很长一段时间内都不想与我找到共同语言。瑞克对我的问候的第一个反应是“我不是你的伙伴”(说实话，一开始，他只知道这句话)。但我没有放弃，在优秀的变形金刚库和微软的大规模预训练响应生成模型(DialoGPT)的帮助下，我成功地与Rick进行了推心置腹的交谈。这是我们的一次对话:</p><blockquote class="lr ls lt"><p id="60a7" class="ki kj lu kk b kl km ju kn ko kp jx kq lv ks kt ku lw kw kx ky lx la lb lc ld im bi translated"><strong class="kk iu">用户</strong>:嘿，瑞克，给我做个时光机<br/> <strong class="kk iu">瑞克伯特</strong>:你是个怪物！<br/> <strong class="kk iu">用户</strong>:不，我只是想穿越时空<br/> <strong class="kk iu"> RickBot </strong>:回到过去。<br/> <strong class="kk iu">用户</strong>:是<br/> <strong class="kk iu"> RickBot </strong>:请不要时光机。<br/> <strong class="kk iu">用户</strong>:但是我需要<br/> <strong class="kk iu"> RickBot </strong>:你不需要，莫蒂。去做吧。<br/> <strong class="kk iu">用户</strong>:我想看古希腊<br/> <strong class="kk iu"> RickBot </strong>:哎呀。</p></blockquote><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/ce96b64e780daa06163e79b72384ebeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*fKL_VMeQ4NjLpjcO.gif"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图片来自<a class="ae le" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><h1 id="555d" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">一点理论</h1><p id="d66b" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">在这篇文章中，我将告诉你如何创建一个虚拟角色，其陈述将基于我最喜欢的动画科幻情景喜剧的脚本。你可以使用你选择的角色和情景喜剧。我添加了代码，将带有对话框的常规文本文件转换成模型能够理解的格式。</p><p id="6651" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我已经提到的，<a class="ae le" href="https://huggingface.co/transformers/" rel="noopener ugc nofollow" target="_blank">变形金刚</a>库，其中包含最新的NLP模型(如<a class="ae le" href="https://huggingface.co/transformers/model_doc/bert.html" rel="noopener ugc nofollow" target="_blank">伯特</a>、<a class="ae le" href="https://huggingface.co/transformers/model_doc/xlnet.html" rel="noopener ugc nofollow" target="_blank"> XLNet </a>、<a class="ae le" href="https://huggingface.co/transformers/model_doc/gpt2.html" rel="noopener ugc nofollow" target="_blank"> GPT-2 </a>)将帮助我们完成任务。你可以在Jay Alammar的一篇插图精美的文章<a class="ae le" href="http://jalammar.github.io/illustrated-transformer/" rel="noopener ugc nofollow" target="_blank">中读到更多关于变形金刚的内容。</a></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/224fec2932bddd9db3210eea8a27a833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KM7q7Ybzmmnlz3SV.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图片来自<a class="ae le" href="http://jalammar.github.io/illustrated-transformer/" rel="noopener ugc nofollow" target="_blank">http://jalammar . github . io</a></p></figure><p id="3906" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不久前，微软的<a class="ae le" href="https://huggingface.co/transformers/model_doc/dialogpt.html" rel="noopener ugc nofollow" target="_blank"> DialoGPT </a>被添加到变形金刚模型集合中。DialoGPT是GPT-2的模型，接受了来自Reddit讨论线程的1.47亿次多回合对话的训练(你可以在这里了解更多关于GPT-2的信息)。这个模型非常适合为一个有趣的对话创建一个虚拟角色，即使在小的实现选项中，它也可以保持连贯的对话，我们现在将看到这一点。</p><h1 id="af27" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">与DialoGPT的第一次对话</h1><p id="e73a" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">我们将在<a class="ae le" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank"> Google Colab </a>中进行所有的实验，它的资源足以训练小型DialoGPT模型。首先，我们将连接到Google Drive并安装必要的模块。</p><pre class="lg lh li lj gt na nb nc nd aw ne bi"><span id="44ef" class="nf lz it nb b gy ng nh l ni nj">from google.colab import drive<br/>drive.mount('/content/drive/')</span><span id="506b" class="nf lz it nb b gy nk nh l ni nj">! pip -q install transformers</span></pre><p id="cb21" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们移动到所需的文件夹，我们将在其中存储所有的数据。</p><pre class="lg lh li lj gt na nb nc nd aw ne bi"><span id="328e" class="nf lz it nb b gy ng nh l ni nj">import os</span><span id="256d" class="nf lz it nb b gy nk nh l ni nj">os.chdir("/content/drive/My Drive/Colab Notebooks")</span></pre><p id="5cb8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">尽量用DialoGPT聊天，不要微调。</p><pre class="lg lh li lj gt na nb nc nd aw ne bi"><span id="de68" class="nf lz it nb b gy ng nh l ni nj">from transformers import AutoModelWithLMHead, AutoTokenizer<br/>import torch</span><span id="c2ed" class="nf lz it nb b gy nk nh l ni nj">tokenizer = AutoTokenizer.from_pretrained("microsoft/DialoGPT-small")<br/>model = AutoModelWithLMHead.from_pretrained("microsoft/DialoGPT-small")</span></pre><p id="36b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们聊5行</p><pre class="lg lh li lj gt na nb nc nd aw ne bi"><span id="3acb" class="nf lz it nb b gy ng nh l ni nj">for step in range(5):<br/>    # encode the new user input, add the eos_token and return a tensor in Pytorch<br/>    new_user_input_ids = tokenizer.encode(input("&gt;&gt; User:") + tokenizer.eos_token, return_tensors='pt')</span><span id="ab28" class="nf lz it nb b gy nk nh l ni nj"># append the new user input tokens to the chat history<br/>    bot_input_ids = torch.cat([chat_history_ids, new_user_input_ids], dim=-1) if step &gt; 0 else new_user_input_ids</span><span id="8361" class="nf lz it nb b gy nk nh l ni nj"># generated a response while limiting the total chat history to 1000 tokens    <br/>    chat_history_ids = model.generate(<br/>    bot_input_ids, max_length=1000,<br/>    pad_token_id=tokenizer.eos_token_id<br/>    )</span><span id="54fd" class="nf lz it nb b gy nk nh l ni nj"># pretty print last ouput tokens from bot<br/>    print("DialoGPT: {}".format(tokenizer.decode(chat_history_ids[:, bot_input_ids.shape[-1]:][0], skip_special_tokens=True)))</span></pre><blockquote class="lr ls lt"><p id="58c2" class="ki kj lu kk b kl km ju kn ko kp jx kq lv ks kt ku lw kw kx ky lx la lb lc ld im bi translated"><strong class="kk iu">用户:</strong>嗨里克<br/> <strong class="kk iu">对话PT: </strong>嗨里克<br/> <strong class="kk iu">用户:</strong>你好吗？<br/> <strong class="kk iu"> DialoGPT: </strong>我很好，你好吗？<br/> <strong class="kk iu">用户:</strong>我没事。莫蒂在哪里？他在地下室。<br/> <strong class="kk iu">用户:</strong>莫蒂是谁？对话:他是个毛头小子。<br/> <strong class="kk iu">用户:</strong>你是谁？<br/> <strong class="kk iu">对话:</strong>我是毛蒂。</p></blockquote><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/89560c178560d24add66caf4098be8ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*M4GKteqV_Kl-yAaa.gif"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图片来自<a class="ae le" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><p id="9cb8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还不错，但不太令人印象深刻。我们将通过微调来修复它。</p><h1 id="535f" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">模型初始配置</h1><p id="6812" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">让我们训练我们自己的瑞克聊天机器人。首先，我们需要基本的配置和一个数据集。配置和训练脚本大多基于Huggingface的这个<a class="ae le" href="https://github.com/huggingface/transformers/blob/master/examples/language-modeling/run_language_modeling.py" rel="noopener ugc nofollow" target="_blank">脚本</a>和Nathan Cooper的伟大<a class="ae le" href="https://nathancooper.io/i-am-a-nerd/chatbot/deep-learning/gpt2/2020/05/12/chatbot-part-1.html" rel="noopener ugc nofollow" target="_blank">教程</a>。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6d6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将Python脚本参数转换为Colab notebook的类参数。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h1 id="d998" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">准备数据集</h1><p id="5aa5" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">我们的对话数据集将基于安德拉达·奥尔特亚努的<a class="ae le" href="https://www.kaggle.com/andradaolteanu/sentiment-analysis-rick-and-morty-scripts/" rel="noopener ugc nofollow" target="_blank">文章</a>中使用的关于里克和莫蒂情绪分析的数据集。非常感谢她的工作，也感谢Gabriel Hernandes，原始文本数据集<a class="ae le" href="https://github.com/ghhernandes/rickmorty-gan/tree/master/data" rel="noopener ugc nofollow" target="_blank">的作者！</a></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/c5001ab584b2d919afb9b4d9ad9ee58b.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*AuVQEU4bGTvYlKdz.gif"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图片来自<a class="ae le" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><p id="94d7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们将使用一个<strong class="kk iu"> Kaggle </strong>模块来下载需要的数据集。你可以通过这个<a class="ae le" href="https://github.com/Kaggle/kaggle-api" rel="noopener ugc nofollow" target="_blank">链接</a>阅读关于这个模块以及如何获得Kaggle API令牌的更多细节。或者您可以从这篇文章<a class="ae le" href="https://www.kaggle.com/andradaolteanu/sentiment-analysis-rick-and-morty-scripts/" rel="noopener ugc nofollow" target="_blank">中下载RickAndMortyScripts.csv文件，并将该文件放在您的工作目录中。</a></p><pre class="lg lh li lj gt na nb nc nd aw ne bi"><span id="2d21" class="nf lz it nb b gy ng nh l ni nj">!pip install kaggle</span><span id="2994" class="nf lz it nb b gy nk nh l ni nj">!mkdir ~/.kaggle<br/>!cp kaggle.json ~/.kaggle/kaggle.json</span><span id="e02f" class="nf lz it nb b gy nk nh l ni nj">!kaggle datasets download andradaolteanu/rickmorty-scripts -f RickAndMortyScripts.csv <br/>!mv datasets%2F506221%2F935855%2FRickAndMortyScripts.csv RickAndMortyScripts.csv</span></pre><p id="0e3d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看原始数据集。</p><pre class="lg lh li lj gt na nb nc nd aw ne bi"><span id="8687" class="nf lz it nb b gy ng nh l ni nj">all_rick = pd.read_csv('RickAndMortyScripts.csv')<br/>all_rick.head(10)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nn"><img src="../Images/491b4e2321ad8cf4a4c864be5ee5c03e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cdMw77_y34WJdxccvguL5g.png"/></div></div></figure><p id="0d3d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将以这样一种方式转换该数据集，即每个响应行将包含<strong class="kk iu"> n </strong>个以前的响应作为上下文。就我们的目的而言，之前的七个回复就足够了。</p><pre class="lg lh li lj gt na nb nc nd aw ne bi"><span id="08d8" class="nf lz it nb b gy ng nh l ni nj">contexted = []</span><span id="718c" class="nf lz it nb b gy nk nh l ni nj">n = 7</span><span id="0918" class="nf lz it nb b gy nk nh l ni nj">for i in range(n, len(all_rick['line'])):<br/>  row = []<br/>  prev = i - 1 - n # we additionally subtract 1, so row will contain current response and 7 previous responses  <br/>  for j in range(i, prev, -1):<br/>    row.append(all_rick['line'][j])<br/>  contexted.append(row)</span><span id="8ba9" class="nf lz it nb b gy nk nh l ni nj">columns = ['response', 'context'] <br/>columns = columns + ['context/'+str(i) for i in range(n-1)]</span><span id="c437" class="nf lz it nb b gy nk nh l ni nj">df = pd.DataFrame.from_records(contexted, columns=columns)<br/>df.head(5)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi no"><img src="../Images/1aafa88866ed6510d916f69d9dd3bd20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NIDy3Jt0VW5jBb4EvXI1nQ.png"/></div></div></figure><p id="f55b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将我们的数据集分成训练和测试部分。</p><pre class="lg lh li lj gt na nb nc nd aw ne bi"><span id="0554" class="nf lz it nb b gy ng nh l ni nj">trn_df, val_df = train_test_split(df, test_size = 0.1)</span></pre><p id="9cd7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们将把数据集转换成适合我们模型的格式。基本上，我们将在每行的一个字符串中连接响应(此外，我们将在响应之间添加特殊的“字符串结束”标记，因此模型将理解字符串中每个响应的结束)。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h1 id="e812" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">培训和评估</h1><p id="bfb0" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">训练我们的模型将需要相当多的代码，但不要担心，一切都应该按原样工作，主要的事情是以正确的格式给模型数据集。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/998ffa45e6859966ff551a9e0a35c773.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*G-wEeBAEIc7GfMH1.gif"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图片来自<a class="ae le" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="ab8b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是主要的跑步者代码。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0639" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是时候训练我们的模特了！</p><pre class="lg lh li lj gt na nb nc nd aw ne bi"><span id="ebc1" class="nf lz it nb b gy ng nh l ni nj">main(trn_df, val_df)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/e7bfeda090ae8077597bda013c3d0c1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*aYc0OMKAI9hdLksT.gif"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图片来自<a class="ae le" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank">吉菲</a></p></figure><p id="adc8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的数据集很小，所以训练不会花很多时间(通常大约半小时)。</p><h1 id="8a39" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">和瑞克聊天</h1><p id="2fec" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">模型做好了，该和Rick聊聊了。但是别忘了，我警告过你，瑞克可能会很粗鲁。</p><p id="1d4a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在响应生成中可以使用多种方法。你可以通过这个<a class="ae le" href="https://huggingface.co/blog/how-to-generate" rel="noopener ugc nofollow" target="_blank">链接</a>找到关于这些方法的更多细节。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/bdb3c28cdcba7640e1a43873ee26a2ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*iWP2O6V20kdqWLlv.gif"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图片来自<a class="ae le" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><pre class="lg lh li lj gt na nb nc nd aw ne bi"><span id="f3dd" class="nf lz it nb b gy ng nh l ni nj">tokenizer = AutoTokenizer.from_pretrained('microsoft/DialoGPT-small')<br/>model = AutoModelWithLMHead.from_pretrained('output-small')</span><span id="657b" class="nf lz it nb b gy nk nh l ni nj"># Let's chat for 5 lines<br/>for step in range(5):<br/>    # encode the new user input, add the eos_token and return a tensor in Pytorch<br/>    new_user_input_ids = tokenizer.encode(input("&gt;&gt; User:") + tokenizer.eos_token, return_tensors='pt')<br/>    # print(new_user_input_ids)</span><span id="7cc8" class="nf lz it nb b gy nk nh l ni nj"># append the new user input tokens to the chat history<br/>    bot_input_ids = torch.cat([chat_history_ids, new_user_input_ids], dim=-1) if step &gt; 0 else new_user_input_ids</span><span id="0e81" class="nf lz it nb b gy nk nh l ni nj"># generated a response while limiting the total chat history to 1000 tokens, <br/>    chat_history_ids = model.generate(<br/>        bot_input_ids, max_length=200,<br/>        pad_token_id=tokenizer.eos_token_id,  <br/>        no_repeat_ngram_size=3,       <br/>        do_sample=True, <br/>        top_k=100, <br/>        top_p=0.7,<br/>        temperature = 0.8<br/>    )<br/>    <br/>    # pretty print last ouput tokens from bot<br/>    print("RickBot: {}".format(tokenizer.decode(chat_history_ids[:, bot_input_ids.shape[-1]:][0], skip_special_tokens=True)))</span></pre><blockquote class="lr ls lt"><p id="acd3" class="ki kj lu kk b kl km ju kn ko kp jx kq lv ks kt ku lw kw kx ky lx la lb lc ld im bi translated"><strong class="kk iu">用户</strong>:瑞克，你好吗？<br/> <strong class="kk iu"> RickBot </strong>:我没事。<br/> <strong class="kk iu">用户</strong>:莫蒂在哪里？里克波特:他在医院里。<br/> <strong class="kk iu">用户</strong>:为什么？那要看谁先崩溃——我还是医院。我是说，那个一直给我吃药的人。<br/> <strong class="kk iu">用户</strong>:我不懂<br/> <strong class="kk iu"> RickBot </strong>:哇！哇哦。<br/> <strong class="kk iu">用户</strong>:我明白了，你吃药了<br/> <strong class="kk iu"> RickBot </strong>:嘿，我——我并不以此为荣。</p></blockquote><p id="c014" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还不错。我会再举几个对话的例子来说明里基现在是我们的里基。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/59251a5f1229d974ebe3c73e43db37b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*kka6WW6bP-V8fLV_.gif"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图片来自<a class="ae le" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><blockquote class="lr ls lt"><p id="7c0e" class="ki kj lu kk b kl km ju kn ko kp jx kq lv ks kt ku lw kw kx ky lx la lb lc ld im bi translated"><strong class="kk iu">用户</strong>:你是谁？<br/> <strong class="kk iu"> RickBot </strong>:音乐人，我不是音乐人，但我跟你挺亲近的。<br/> <strong class="kk iu">用户</strong>:你是哪种音乐人？<br/> <strong class="kk iu"> RickBot </strong>:谁在乎？我是一个音乐家。<br/> <strong class="kk iu">用户</strong>:好，给我放一首<br/> <strong class="kk iu"> RickBot </strong>:闭嘴听我说，莫蒂。听我说。听着！我是一群不同死亡世界的领袖，我只是想组建一个乐队。我会把它做成一体，你会成为其中的一部分。<br/> <strong class="kk iu">用户</strong> :ok <br/> <strong class="kk iu"> RickBot </strong>:哇，哇，嘿，这是谁？<br/> <strong class="kk iu">用户</strong>:这是Morty <br/> <strong class="kk iu"> RickBot </strong>:哎呀！！！</p></blockquote><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/fc74084f20430862fd73b17961fd583f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/0*U4Vtq4QjYXcJLSIJ.jpg"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图片来自<a class="ae le" href="https://news.knowyourmeme.com/news/elon-musks-rick-and-morty-cameo-is-a-meme-reference" rel="noopener ugc nofollow" target="_blank">news.knowyourmeme.com</a></p></figure><blockquote class="lr ls lt"><p id="2522" class="ki kj lu kk b kl km ju kn ko kp jx kq lv ks kt ku lw kw kx ky lx la lb lc ld im bi translated"><strong class="kk iu">用户</strong>:你怎么看待埃隆·马斯克？<br/><strong class="kk iu"/>:我经常想起他。<br/> <strong class="kk iu">用户</strong>:但是你到底是怎么想的？他不是一个坏人。他只是…不是一个很有魅力的人。<br/> <strong class="kk iu">用户</strong>:我觉得他很有魅力<br/> <strong class="kk iu"> RickBot </strong>:他是。<br/> <strong class="kk iu">用户</strong>:你还能说他什么？T21:你什么都不用说。他是你们班的领导。<br/> <strong class="kk iu">用户</strong>:好的，谢谢<br/> <strong class="kk iu"> RickBot </strong>:！！！</p></blockquote><h1 id="63d0" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">结论</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/1f307313c52196256c90198c97a09c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*f1q9qlmvJGqFnr8z.gif"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图片来自<a class="ae le" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><p id="312a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">恭喜你！我们的虚拟瑞克(几乎)还活着！借助于在小数据集上对DialoGPT模型的微调，我们能够创建一个虚拟角色，我们可以与他进行大量的mad对话。</p><p id="ddd4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用所提出的方法，我们可以基于任意的对话数据集创建许多有趣的虚拟角色(只是一个包含角色演讲的csv文件，每行一个演讲)。</p><p id="91ed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有提到的代码都可以作为<a class="ae le" href="https://colab.research.google.com/drive/15wa925dj7jvdvrz8_z3vU7btqAFQLVlG" rel="noopener ugc nofollow" target="_blank"> Google Colab笔记本</a>访问。</p></div></div>    
</body>
</html>