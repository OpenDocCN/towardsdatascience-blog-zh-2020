<html>
<head>
<title>Pytest Plugins to Love ❤️</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">爱上❤️的 Pytest 插件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pytest-plugins-to-love-%EF%B8%8F-9c71635fbe22?source=collection_archive---------6-----------------------#2020-08-23">https://towardsdatascience.com/pytest-plugins-to-love-%EF%B8%8F-9c71635fbe22?source=collection_archive---------6-----------------------#2020-08-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="12ef" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我的前 5 名和 700+插件中的 50 名，以获得更好的输出和更快的执行速度</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d22e4a3209c00b8895afbc99f2f3570a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dK-I-F06_yZgYxBYnNeyVQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">插件可以修改和扩展 pylint 的很多方面，包括输出是如何完成的。这个用 pytest-sugar 运行 pytest 的截图是由 Martin Thoma 拍摄的。</p></figure><p id="8430" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Pytest 是可扩展的，有很多插件。你不需要使用它们中的任何一个，但你可能会发现一些非常有用。我喜欢这一点，因为你有一个简单的时间<a class="ae lu" href="https://medium.com/swlh/unit-testing-in-python-basics-21a9a57418a0" rel="noopener">开始单元测试</a>，当你更有经验的时候，仍然会发现令人惊奇的东西🤩</p><p id="ee46" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇文章中，我将向你展示我使用的插件的例子和我在写这篇文章时发现的插件。你可能想先介绍单元测试的基础知识，或者刷新测试细节，比如 fixtures。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="51de" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何添加插件？</h1><p id="6acc" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">本文介绍的所有插件都可以通过<code class="fe mz na nb nc b">pip</code>安装。他们中的大多数已经开始活动了。例如，当您通过</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="189c" class="nh md it nc b gy ni nj l nk nl">pip install pytest-sugar</span></pre><p id="47f6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你只要执行<code class="fe mz na nb nc b">pytest</code>插件就会自动工作。其他的需要更直接的使用。例如，安装完<code class="fe mz na nb nc b">pytest-timeout</code>后，您需要指定想要使用的超时参数:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="1850" class="nh md it nc b gy ni nj l nk nl">pytest --timeout=1</span></pre><p id="dfe8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">别担心，我稍后会解释这两个插件🙂</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7d4d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">存在多少 Pytest 插件？</h1><p id="78fa" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在 pypi.org 上搜索 trove 分类器<code class="fe mz na nb nc b">Framework :: Pytest</code>，我找到了 668 个包。一个惊人的 1053 个包的名字中有“pytest”。461 包都有，名字和 trove 分类器。</p><p id="2f7a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了这篇文章，我查阅了 700 多个 pytest 插件。我跳过了那些认为自己处于计划阶段、前 alpha 阶段或 alpha 阶段的插件。我也跳过了在自述文件中看到<code class="fe mz na nb nc b">TODO</code>的包，或者在 GitHub 上少于 10 颗星的包。</p><p id="2166" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我发现的包使 pytest 闪耀✨，提高速度🏎，是专门针对特定的包，或者只是在他们的行为独特的❄️</p><p id="7ab1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后但同样重要的是，有些插件我不确定它们是不是很棒，或者是不是个坏主意。让我们直接跳进去自己看一看吧！</p><blockquote class="nm nn no"><p id="97a1" class="ky kz np la b lb lc ju ld le lf jx lg nq li lj lk nr lm ln lo ns lq lr ls lt im bi translated"><strong class="la iu">旁注</strong>:可能你还记得我的<a class="ae lu" rel="noopener" target="_blank" href="/static-code-analysis-for-python-bdce10b8d287#9026">错别字蹲坑的旁注</a>？在写这篇文章的时候，我在 PyPI 上发现了一个可以修复的问题，希望可以提高社区的安全性🎉</p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6478" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">闪亮的那些</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/a9c35df56a856a0d950fe18215cba7b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OpomvR1ltJczEJe1"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@jeremythomasphoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰瑞米·托马斯</a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="5906" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">pytest 的默认输出已经很好了，但是一些插件让它变得很神奇。<code class="fe mz na nb nc b"><a class="ae lu" href="https://github.com/Teemu/pytest-sugar" rel="noopener ugc nofollow" target="_blank">pytest-sugar</a></code>是那些 plugins❤中的一个</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/73e6fbfde3d06591aa68e10816cee4fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q62Md6QW-AnMkguTUtNJQQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Pytest sugar 将圆点变为对勾，百分比变为条形。图片由马丁·托马斯提供。</p></figure><p id="f593" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果这些圆点或勾号对你来说太体面了，试试<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-emoji/" rel="noopener ugc nofollow" target="_blank">pytest-emoji</a></code>和<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-emoji-output/" rel="noopener ugc nofollow" target="_blank">pytest-emoji-out</a></code>😃</p><p id="c72c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">汇总输出现在看起来不错，但是期望值和实际值之间的差异还可以改进。<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-icdiff/" rel="noopener ugc nofollow" target="_blank">pytest-icdiff</a></code>是我在研究这篇文章时发现的一个插件——它是🥰❤的一见钟情</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/53603c948c5c91b8b407a581ad556465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uI2P9CCWR8wVXzAsB9CO2Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者:马丁·托马斯</p></figure><p id="d070" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">非常相似的是<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-clarity/" rel="noopener ugc nofollow" target="_blank">pytest-clarity</a></code>——注意，pytest-clarity 仅在您执行<code class="fe mz na nb nc b">pytest -vv</code>时激活:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/c90003791c2572b17de185ef9871c3ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-cw3U9-O2tVweTHSFIr8w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马丁·托马斯截图</p></figure><p id="93c8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦您对终端输出感到满意，您可能会考虑在浏览器中获取报告。一旦你不得不看很多东西，想要滚动和搜索，这可能会有所帮助。那么<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-html/" rel="noopener ugc nofollow" target="_blank">pytest-html</a></code>就是你的朋友。它会生成这样的报告:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/d5e75bdd845bc90aee9332a0ff6676f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_89UcLrGkqgqwU70YHaC8g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马丁·托马斯截图</p></figure><p id="9140" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">既然我们对输出结果感到满意，我们想让它快如闪电！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="caee" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">我们需要速度！</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/3d564a715798790b96c4d343d1a2cc73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wMgNzXte3J1AcUqF"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">丘特尔斯纳普</a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="f102" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">插件可以加快速度。例如，您可以使用<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-instafail/" rel="noopener ugc nofollow" target="_blank">pytest-instafail</a></code>让 pytest 立即失败，而不是执行所有剩余的测试。对于那些可能需要很长时间甚至在出错时导致无限循环的测试，我使用<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-timeout/" rel="noopener ugc nofollow" target="_blank">pytest-timeout</a></code> ❤.当您应用<a class="ae lu" href="https://medium.com/analytics-vidhya/unit-testing-in-python-mutation-testing-7a70143180d8" rel="noopener">突变测试</a>时，这尤其有用。</p><p id="3f88" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们也想通过使用<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-xdist/" rel="noopener ugc nofollow" target="_blank">pytest-xdist</a></code>来正确使用我们的机器。安装它，执行<code class="fe mz na nb nc b">pytest -n auto</code>，你的测试就可以并行运行了！<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-parallel/" rel="noopener ugc nofollow" target="_blank">pytest-parallel</a></code>或许也值得一试。</p><p id="bf06" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最极端的加速是不执行你不需要的东西。<code class="fe mz na nb nc b"><a class="ae lu" href="https://github.com/anapaulagomes/pytest-picked" rel="noopener ugc nofollow" target="_blank">pytest-picked</a></code>执行与未分级文件相关的测试，这些文件可能远少于您的完整测试套件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="83f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">换个方向，我们想确保算法有一些速度行为。通过<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-benchmark/" rel="noopener ugc nofollow" target="_blank">pytest-benchmark</a></code>，我们可以使用<code class="fe mz na nb nc b">benchmark</code> fixture 来注释我们想要进行基准测试的测试部分:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="ab53" class="nh md it nc b gy ni nj l nk nl">def test_argmax(benchmark):<br/>    assert benchmark(mpu.math.argmax, [1, 2, 3]) == 2</span></pre><p id="e8cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">运行<code class="fe mz na nb nc b">pytest</code>也会给出这个输出，在这里你可以看到我已经添加了基准的三个函数。其中两个测试一个因式分解函数。因式分解 3072 比因式分解 1024 花费的时间更长，这并不奇怪，但是数字增长的速度之快总是让我吃惊。3 个例子的 argmax 非常快，但是因式分解需要更多的计算:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/879e9f8f7d5269c8cf9b20cb6ce5b8eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BQNaV3U0rYXTiaXJmBNMsQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">最小、平均和最大执行时间，以及标准偏差和四分位数范围，让您对执行时间分布有所了解。图片作者:马丁·托马斯</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eb47" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">独一无二的</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/48d71772df52e7d8cef385a101903514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*23ekZB3SBbonMR17"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@dariuscotoi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Darius Cotoi </a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="5554" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有些插件是独特的，不适合任何其他类别:</p><ul class=""><li id="162d" class="ob oc it la b lb lc le lf lh od ll oe lp of lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-cov" rel="noopener ugc nofollow" target="_blank">pytest-cov</a></code>:获取测试覆盖报告😍❤:我喜欢两个都生成，一个 HTML 报告和一个到终端的输出。在某些情况下，XML 报告也很有帮助。</li><li id="ce97" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-socket/" rel="noopener ugc nofollow" target="_blank">pytest-socket</a></code>:确保不要查询任何非本地的东西。非常好的❤</li><li id="6605" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://github.com/pytest-dev/pytest-randomly" rel="noopener ugc nofollow" target="_blank">pytest-randomly</a></code>和<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-rng/" rel="noopener ugc nofollow" target="_blank">pytest-rng</a></code>:如果你使用<code class="fe mz na nb nc b">random.random</code>，那么结果取决于随机种子。这个插件改变种子。</li><li id="06a6" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-random-order/" rel="noopener ugc nofollow" target="_blank">pytest-random-order</a></code>:以随机的顺序执行测试，以确保您看到测试何时以不同的状态离开系统。</li><li id="7b4d" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-lazy-fixture/" rel="noopener ugc nofollow" target="_blank">pytest-lazy-fixtures</a></code>:使用<code class="fe mz na nb nc b">@pytest.mark.parametrize</code>中的夹具。</li><li id="95ba" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-freezegun/" rel="noopener ugc nofollow" target="_blank">pytest-freezegun</a></code>:冻结时间！这也是我在<a class="ae lu" href="https://levelup.gitconnected.com/unit-testing-in-python-mocking-patching-and-dependency-injection-301280db2fed" rel="noopener ugc nofollow" target="_blank">我的补丁文章</a>中提到过的。</li><li id="11d6" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-leaks/" rel="noopener ugc nofollow" target="_blank">pytest-leaks</a></code>:发现资源泄露。这需要一个调试版的 Python！</li><li id="b462" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://github.com/tholo/pytest-flake8" rel="noopener ugc nofollow" target="_blank">pytest-flake8</a></code>:通过 pytest 运行 flake8。我这样做了很长时间，但是当我了解到如何更有效地使用持续集成管道时，我就停止了。还是可以直接执行 flake8。</li><li id="82ed" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-mypy/" rel="noopener ugc nofollow" target="_blank">pytest-mypy</a></code>和<code class="fe mz na nb nc b">pytest-mccabe</code>:与 flake8 相同。对了，<a class="ae lu" href="https://medium.com/analytics-vidhya/type-annotations-in-python-3-8-3b401384403d" rel="noopener">类型标注很牛逼</a>！我喜欢在 CI 管道的 linter 步骤中使用那些静态代码分析工具。</li><li id="c3f1" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-deadfixtures/" rel="noopener ugc nofollow" target="_blank">pytest-deadfixtures</a></code>:指出哪些灯具没有被使用或复制。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="438a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">17 个专用插件—如果您需要，您会知道的</h1><p id="2f30" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">下面的插件只有在你使用为其编写的应用程序时才会引起你的兴趣。他们通常提供固定装置/模型。</p><ul class=""><li id="0612" class="ob oc it la b lb lc le lf lh od ll oe lp of lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-cookies/" rel="noopener ugc nofollow" target="_blank">pytest-cookie</a></code>:支持<a class="ae lu" href="https://github.com/cookiecutter/cookiecutter" rel="noopener ugc nofollow" target="_blank"> cookiecutter </a>模板的测试。</li><li id="b09e" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-plt/" rel="noopener ugc nofollow" target="_blank">pytest-plt</a></code>和<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-mpl/" rel="noopener ugc nofollow" target="_blank">pytest-mpl</a></code>:为 matplotlib 提供夹具。</li><li id="8d58" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-responses/" rel="noopener ugc nofollow" target="_blank">pytest-responses</a></code>:为<code class="fe mz na nb nc b"><a class="ae lu" href="https://requests.readthedocs.io/en/master/" rel="noopener ugc nofollow" target="_blank">requests</a></code>提供夹具。</li><li id="c076" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-asyncio/" rel="noopener ugc nofollow" target="_blank">pytest-asyncio</a></code>:在开发异步函数时使用它。</li><li id="129f" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-qt/" rel="noopener ugc nofollow" target="_blank">pytest-qt</a></code>:通过 Qt / PySide / PySide2 进行 GUI 开发。</li></ul><h2 id="fe54" class="nh md it bd me op oq dn mi or os dp mm lh ot ou mo ll ov ow mq lp ox oy ms oz bi translated">Web 开发</h2><ul class=""><li id="eff5" class="ob oc it la b lb mu le mv lh pa ll pb lp pc lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-djangoapp/" rel="noopener ugc nofollow" target="_blank">pytest-djangoapp</a></code> / <code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-django-queries/" rel="noopener ugc nofollow" target="_blank">pytest-djangoqueries</a></code>:为 Django 应用程序开发人员提供工具，以方便测试创作，包括设置覆盖、模板标签测试和用户创建。</li><li id="e3a5" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-flask/" rel="noopener ugc nofollow" target="_blank">pytest-flask</a></code>和<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-flask-sqlalchemy/" rel="noopener ugc nofollow" target="_blank">pytest-flask-sqlalchemy</a></code>:为使用 Flask-SQLAlchemy 在事务中运行测试提供 fixtures。</li><li id="1541" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-seleniumbase/" rel="noopener ugc nofollow" target="_blank">pytest-seleniumbase</a></code> / <code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-sbase/" rel="noopener ugc nofollow" target="_blank">pytest-sbase</a></code> / <code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-selenium/" rel="noopener ugc nofollow" target="_blank">pytest-selenium</a></code></li></ul><h2 id="490b" class="nh md it bd me op oq dn mi or os dp mm lh ot ou mo ll ov ow mq lp ox oy ms oz bi translated">AWS 的模拟和固定装置</h2><ul class=""><li id="c28c" class="ob oc it la b lb mu le mv lh pa ll pb lp pc lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/moto/" rel="noopener ugc nofollow" target="_blank">moto</a></code>:boto 3 的模拟——AWS 的东西。我不太喜欢这个，但是当你想测试使用 S3 的代码时，它肯定是你能做的最好的了。</li><li id="9d2e" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-aws/" rel="noopener ugc nofollow" target="_blank">pytest-aws</a></code>:测试 AWS 资源配置</li><li id="c9fb" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-localstack/" rel="noopener ugc nofollow" target="_blank">pytest-localstack</a></code>:通过 Localstack Docker 容器创建 AWS 集成测试</li></ul><h1 id="e32d" class="mc md it bd me mf pd mh mi mj pe ml mm jz pf ka mo kc pg kd mq kf ph kg ms mt bi translated">我不确定的插件</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/db95f75dce48db14702d0a60d6d90a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_TjwL9qWSI0YPxUk"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">布鲁斯·马尔斯在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2049" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我第一次读到以下插件时，它们听起来很酷，但由于各种原因，我不确定它们是否真的是个好主意:</p><ul class=""><li id="fdbe" class="ob oc it la b lb lc le lf lh od ll oe lp of lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://github.com/okken/pytest-check" rel="noopener ugc nofollow" target="_blank">pytest-check</a></code>:允许每次测试多次失败。起初，我喜欢这个想法。然后我意识到这可能会导致更糟糕的测试，因为测试开始做很多事情。另一方面，您可能想要测试一次“工作流”——所以不是单元测试，而是集成测试或者甚至是端到端测试。但是你也需要中间结果。</li><li id="b4d8" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest_docker_tools/" rel="noopener ugc nofollow" target="_blank">pytest-docker-tools</a></code>和<code class="fe mz na nb nc b"><a class="ae lu" href="https://github.com/pytest-docker-compose/pytest-docker-compose" rel="noopener ugc nofollow" target="_blank">pytest-docker-compose</a></code>:我只是构建 Docker 映像并执行其中的内容。</li><li id="db36" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-mock/" rel="noopener ugc nofollow" target="_blank">pytest-mock</a></code>:提供了一个 mocker fixture，它是模拟包提供的补丁 API 的一个瘦包装器。它通过使 mock 成为一个固定设备来减少样板代码。</li><li id="249f" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-spec/" rel="noopener ugc nofollow" target="_blank">pytest-spec</a></code>、<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-pspec/" rel="noopener ugc nofollow" target="_blank">pytest-pspec</a></code>和<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-testdox/" rel="noopener ugc nofollow" target="_blank">pytest-testdox</a></code>修改 pytest 输出。它们显示了测试的内容。测试应该以这样一种方式编写，即它们代表软件规范——所以测试是针对规范的一部分。</li><li id="c448" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated">它应该通过 VCR.py 记录网络交互，但我没有让它工作。</li><li id="01ec" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated"><code class="fe mz na nb nc b"><a class="ae lu" href="https://github.com/RKrahl/pytest-dependency" rel="noopener ugc nofollow" target="_blank">pytest-dependency</a></code>允许您指定哪些测试需要成功，其他人才能成功。单元测试应该是独立的，依赖的代码应该被嘲笑…也许吧。我对此没有把握。</li></ul><h1 id="4cd5" class="mc md it bd me mf pd mh mi mj pe ml mm jz pf ka mo kc pg kd mq kf ph kg ms mt bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="87a2" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated"><code class="fe mz na nb nc b">pytest</code>是用 Python 运行测试的首选工具。虽然它有合理的默认值，但它广泛的插件系统允许你定制它，使它变得更好。</p><p id="8fa2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我喜欢<code class="fe mz na nb nc b"><a class="ae lu" href="https://github.com/Teemu/pytest-sugar" rel="noopener ugc nofollow" target="_blank">pytest-sugar</a></code>和<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-icdiff/" rel="noopener ugc nofollow" target="_blank">pytest-icdiff</a></code>，因为它们使 pytest 的输出更容易阅读。<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-cov/" rel="noopener ugc nofollow" target="_blank">pytest-cov</a></code>生成线覆盖和分支覆盖，因此是发现需要更好测试的点的有价值的工具。下一步是运行测试。你真的不想不小心撞到生产环境。这就是<code class="fe mz na nb nc b"><a class="ae lu" href="https://pypi.org/project/pytest-socket/" rel="noopener ugc nofollow" target="_blank">pytest-socket</a></code>发挥作用的地方。它只是屏蔽一切并向你报告。另一类问题是长期运行的测试，这些测试可能会陷入无限循环。<code class="fe mz na nb nc b">pytest-timeout</code>在指定的时间后终止那些测试。</p><p id="e031" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">其他插件那么多；许多人为特定的包添加了固定装置，这些包通常很难测试。您现在应该对 pytest 插件增加的许多可能性有了很好的了解——使用它们吧！</p><h1 id="f18f" class="mc md it bd me mf pd mh mi mj pe ml mm jz pf ka mo kc pg kd mq kf ph kg ms mt bi translated">下一步是什么？</h1><p id="83d7" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在这个系列中，我们已经有了:</p><ul class=""><li id="d9d4" class="ob oc it la b lb lc le lf lh od ll oe lp of lt og oh oi oj bi translated">第 1 部分:<a class="ae lu" href="https://medium.com/swlh/unit-testing-in-python-basics-21a9a57418a0" rel="noopener">Python 中单元测试的基础知识</a></li><li id="3d83" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated">第 2 部分:<a class="ae lu" href="https://levelup.gitconnected.com/unit-testing-in-python-mocking-patching-and-dependency-injection-301280db2fed" rel="noopener ugc nofollow" target="_blank">补丁、模拟和依赖注入</a></li><li id="2a61" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated">第 3 部分:<a class="ae lu" href="https://medium.com/analytics-vidhya/how-to-test-flask-applications-aef12ae5181c" rel="noopener">如何用数据库、模板和受保护的页面测试 Flask 应用程序</a></li><li id="846f" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated">第 4 部分:<a class="ae lu" href="https://medium.com/python-in-plain-english/unit-testing-in-python-tox-and-nox-833e4bbce729" rel="noopener"> tox 和 nox </a></li><li id="c009" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated">第 5 部分:<a class="ae lu" href="https://medium.com/python-in-plain-english/unit-testing-in-python-structure-57acd51da923" rel="noopener">结构化单元测试</a></li><li id="5816" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated">第 6 部分:<a class="ae lu" href="https://levelup.gitconnected.com/ci-pipelines-for-python-projects-9ac2830d2e38" rel="noopener ugc nofollow" target="_blank">CI-管道</a></li><li id="e69d" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated">第 7 部分:<a class="ae lu" href="https://levelup.gitconnected.com/unit-testing-in-python-property-based-testing-892a741fc119" rel="noopener ugc nofollow" target="_blank">基于属性的测试</a></li><li id="f1ac" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated">第 8 部分:<a class="ae lu" href="https://medium.com/analytics-vidhya/unit-testing-in-python-mutation-testing-7a70143180d8" rel="noopener">突变检测</a></li><li id="88cd" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated">第 9 部分:<a class="ae lu" rel="noopener" target="_blank" href="/static-code-analysis-for-python-bdce10b8d287">静态代码分析</a> — Linters、类型检查和代码复杂性</li><li id="6beb" class="ob oc it la b lb ok le ol lh om ll on lp oo lt og oh oi oj bi translated">第 10 部分:<a class="ae lu" rel="noopener" target="_blank" href="/pytest-plugins-to-love-️-9c71635fbe22"> Pytest 插件到爱</a></li></ul><p id="3292" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您对使用 Python 测试的其他主题感兴趣，请告诉我。</p></div></div>    
</body>
</html>