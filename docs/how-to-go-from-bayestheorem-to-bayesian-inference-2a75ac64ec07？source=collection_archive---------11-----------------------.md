# 如何从贝叶斯定理到贝叶斯推理

> 原文：<https://towardsdatascience.com/how-to-go-from-bayestheorem-to-bayesian-inference-2a75ac64ec07?source=collection_archive---------11----------------------->

当我还是一名统计学新手并试图学习贝叶斯统计时，我经常发现开始时非常混乱，因为大多数在线内容通常以贝叶斯公式开始，然后直接跳到贝叶斯推理的 R/Python 实现，而没有给出多少关于我们如何从贝叶斯定理到概率推理的直觉。因此，我希望这篇文章能够真正填补我们在简单公式和完全不同层次的贝叶斯研究之间的空白，用尽可能少的数学。具体来说，我想谈谈

*   一个经典贝叶斯公式例子背后的直觉，以及为什么**在理解贝叶斯推理中没有用**
*   贝叶斯推理在实践中是如何工作的
*   概率分布和似然之间有什么区别，这是贝叶斯推理中的两个主要组成部分(因此我们将知道先验和似然之间的区别)
*   我们如何能够忽略计算的分母和命名的贝叶斯公式在实践中的大部分时间与一个简单的现实生活中的例子在后验模型，以估计股票市场的回报。

# 一个经典贝叶斯公式示例背后的直觉

我想再次重申，在这里我将专注于直觉而不是数学。

贝叶斯定理通常从癌症检测中的一个例子开始。在这篇文章中，没有例外。高中/本科学习这个公式的时候，总会给你一些事件的概率，计算另一些事件的概率。

![](img/514f4a8a0876ef5bc0b3f14515da23d8.png)

你经常看到的贝叶斯公式

比如我们会提前知道某人得癌症的概率，像 *P(癌症)=0.1* 。这意味着如果我们从这个国家随机抽取一个人，10%的人会得癌症。有了新的癌症检测技术，它可以提供更准确的信息，更新我们对一个人是否患有癌症的信念。幸运的是，有了贝叶斯公式，我们可以量化我们在确定一个人是否患有癌症方面有多少把握。

![](img/41c91e9fa3448ca948ed5b23c2d1a921.png)

以前，如果我们对一个人进行随机抽样，我们只有 10%的把握确定他患有癌症，这是我们的先验信念。借助新的测试技术和数据(可能性)，我们将确定性提高到 66%。这是获得贝叶斯定理背后的直觉的一个很好的开端，但有可能你这辈子再也学不到这个了，因为这个公式毫无用处，原因有二。

**1。公式的每一部分都有不确定性**

首先，先验、似然、分母在现实生活中都是不确定的。我们永远无法确切知道我们的人口中有多少%患有癌症，我们所能做的最好的事情就是做出一个有根据的猜测。

在统计领域，每当我们试图对不确定性建模时，我们称之为概率过程(相对于确定性过程)。我们将用**概率分布**对事件建模。

> 因此，对于先验(又名多少人患有癌症)，**为了量化我们的信念，我们将不对概率本身设定一定的值，而是对产生概率分布的参数设定一定的值**。

我们使用的概率分布取决于我们试图估计的变量/参数。如果我们要估计某件事情发生的概率(也称为离散变量)，我们可以使用二项式或泊松分布。另一方面，如果我们要估计股票收益(也称为连续变量)，我们可以使用正态/学生 t 分布。

> 因此，在现实生活中，我们不会说 P(stock_up)=0.1，在贝叶斯统计中，我们会说“作为一名金融专家，我根据经验猜测，未来 12 个月的股票回报将遵循均值为 30%、方差为 5%的正态分布，我希望用我们后来获得的新数据来更新这一经验(先验)。

然后，你就有了理解贝叶斯推理的良好开端。

**2。贝叶斯统计是关于概率函数的乘法，而不是实数**

我们确定先验总是被建模为概率分布。概率分布总是有一个概率质量函数(对于离散变量)或概率密度函数(对于连续变量)。在我们的股票回报的例子中，先验分布是一个正态分布，一个已知的均值和方差作为我们的猜测。

![](img/18f5c4cfadbd5f9e201d2aca87782180.png)

正态分布的概率密度函数，这将作为我们的先验分布

在现实生活的贝叶斯统计中，我们经常忽略分母(上式中的 P(B )),不是因为它不重要，而是因为它在大多数情况下无法计算。我将跳过为什么计算它如此困难的讨论，但请记住，即使没有分母，我们也有不同的方法来计算/估计后验概率。

这使得我们的“现实生活”贝叶斯统计只有两个组成部分，可能性和先验。

![](img/7b7787af1b3f366c9e4d2657d741cbf4.png)

> 似然函数也遵循与先前相似的方式。我们还将假设可能性函数的概率分布。但是，我们不是对参数进行猜测，而是让数据来确定将用于生成似然函数的参数值。生成似然函数后，我们可以将似然函数与先验函数相乘，得到后验函数。

![](img/a503b8397145f522082c13ec4cb0a490.png)

正态分布的似然函数

> 在现实生活中，与教科书中的癌症例子不同，在贝叶斯统计中，我们不是对我们的可能性概率有一个确定的值，而是说“我作为一名数据分析师，从股票市场收集了许多数据，并得出股票回报遵循正态分布的结论。根据我收集的数据，最有可能的是均值为 10，方差为 2。我们将利用这一点来更新我们先前的信念”

为了有一个短暂的停顿和总结，我们可以看到，在实践中，我们将两个概率函数相乘并产生一个后验概率函数，它被证明是一个概率分布，它代表了对我们先验知识的更新信念。在股票市场回报的例子中，这意味着我们对关于股票市场回报的参数(也称为均值和方差)有一个初始的信念(先验)。有了额外的数据，我们收集并量化为可能性，我们进一步更新我们对均值和方差(后验)的信念。

但是当我研究这个问题的时候，上面的解释只是给出了更多的问题而不是答案。似然和概率分布有什么区别？上面显示的公式看起来很复杂，我如何推导后验分布的公式/概率密度函数？这是否意味着我需要成为一名概率专家才能实现哪怕是一个基本的贝叶斯模型？

我向你保证，我们就快到了。让我们继续吧。

# 概率和可能性之间的差异

让我们退一步，再来谈谈高中数学。当我们开始学习概率的时候，我们会有一个抛硬币的例子。假设我们有一个公平的硬币，我们假设 P(头)=0.5。这意味着伯努利分布，参数`p`已知为 0.5。

这个例子非常适合我们之前的组件，我们将假设某个值作为我们的参数(在正态分布中，参数是平均值和方差，以防您不将它们联系在一起)。

在高中数学中，我们知道参数，我们试图计算某些数据出现的概率。但是在现实生活中，我们很可能想做相反的事情。通常我们对自己的参数一无所知，会有满手的数据，想要**对自己的参数值做出推断**(估计)。似然函数正是为此目的而设计的。

让我们再次以抛硬币为例。我们没有事先知道抛硬币是否公平，而是不做任何假设，一直把硬币抛 100 次。结果正好是硬币有头的 50 倍，有尾的 50 倍。然后我们得出结论，通过设置 P(head)=0.5，将最大化这种数据模式出现的概率。

> 直观的说，而**概率**设置参数 fix，估计数据的概率，是可变的。在**似然度**中，我们设置数据修正，并改变参数，直到我们找到最佳参数，该参数提供生成这种数据集的最佳模型。

这就是为什么当我们处理概率和可能性时，它们会在函数中表现出相似的形式。但是用数学术语来说，它们具有完全不同的性质。

稍作停顿和总结，我们可以看到，在实践中，我们有一个固定参数的先验和一个参数完全由(1)我们选择的概率分布和(2)我们拟合到概率分布中的数据决定的可能性。

贝叶斯统计更棒的是，我们可以将一个离散(连续)先验乘以一个连续(离散)似然。我们在 prior 和 likelihood 中选择的概率分布可以是随机的，并根据我们的使用情况进行调整，这要归功于它们都有一个概率密度函数，我们可以用纸张或计算统计来相乘和求解。

说到解数学方程，让我们再来看看股票回报的例子。我们有一个单变量正态先验和一个单变量正态似然，当我们试图将它们的函数相乘时，实际上有一个很好的解，它是一个正态反卡方分布，均值和方差等于

![](img/bde17407317b22a286a15c89a8078627.png)

【https://en.wikipedia.org/wiki/Conjugate_prior 

如果我们访问维基百科，我们可以看到不同概率和可能性的不同可能组合的列表。以及我们如何能够使用不同的概率分布来模拟最终的后验概率。基本上，我们只需要使用 wiki 中显示的后验分布，并插入我们从可能性和先验中获得的参数值，就会生成作为后验分布的更新信念。这种技术被称为**共轭先验**。这将节省我们在纸上解决数学问题的大量时间。

但是共轭先验只能处理最基本的概率分布模型。如果我们有一个 100 多元的正态分布作为我们的先验呢？在这种情况下，不可能推导出后验概率的数学形式解。

# 在实践中，我们如何能够忽略贝叶斯公式的分母和分母的计算

事实证明，我们真的不需要在我们的命名符中计算乘法，也不需要计算分母。

因为我们有计算给定数据集(X = x1，x2 … xt)的先验和似然性所需的一切，所以我们可以从数据集(x1)中随机选取一个样本，计算似然性和先验值，并将它们相乘以生成随机样本后验密度。

> 作为一个提醒，我已经简单地提到了后验概率保证是一个概率分布(成熟的数学，老实说，我并不完全理解，但它是经过验证的)，因此当我们说计算后验概率时，我们指的是概率密度的计算，它描述了一个参数(例如股票回报的平均值)在给定数据集的情况下出现的可能性。

如果我们对可能性和先验无限量的时间进行采样，我们生成的后验密度值将形成真实后验概率分布的非常好的近似。

这种抽样技术被称为**马尔可夫链蒙特卡罗** ( **MCMC** )方法。在 MCMC 上有几种实现，包括随机游走 metropolis 和哈密顿蒙特卡罗。类似于深度学习，其中某些激活功能通常优于其他功能。在 MCMC 中，已知无 U 形转弯采样器(从哈密尔顿蒙特卡罗得到)是最好的实现。

因此，MCMC 不会帮助我们解决贝叶斯统计中的所有问题，而只是在我们无法计算后验分布的情况下实现后验分布。为了有一个实际的用例，我们仍然需要确定先验和似然的概率分布，并自己拟合数据。

这实际上是使用贝叶斯统计的一个优势，我们通过显示我们选择的先验和似然概率分布，预先使我们的假设非常清楚，这些假设可以帮助我们更好地理解模型的不确定性。

更好的是，得到的后验分布是一个概率分布，这意味着我们可以尽可能地从字面上理解它，并得出某个事件在未来发生的概率很大的结论，而不是使用一些令人困惑的评估方法，如置信区间。

在 python 中，P [ystan](https://pystan.readthedocs.io/en/latest/) 和 [PyMC](https://docs.pymc.io/) 都旨在为我们运行 MCMC。我们唯一需要提供的是先验和似然函数，以及用于似然估计的先验参数和数据。

# 股票回报的全面检查

再次假设，我作为一名金融专家，知道在过去几年中，未来 12 个月的整体股市回报总是遵循均值等于 30%、方差等于 5%的正态分布。然而，对于 covid19，这一假设是不可靠的，我的同事是一名数据专家，他不同意我的观点，但温和地承认，我先前的观点对于估计 covid 情况稳定后未来 12 个月的股票回报是有用的。

我的同事花了几天时间收集银行和科技等不同行业的股票回报数据，他也使用正态分布来描述 covid 19 下的股票回报，均值等于 10%，方差也等于 10%。

使用共轭先验或 MCMC(假设我们有一个多元正态分布，它将股票收益进一步细分到每个部门，那么 MCMC 将是必要的)，我们能够计算后验概率分布。

![](img/88ee867dd05cf9ec74414e41b34c0eb1.png)

我们可以看到，在 covid 情况稳定后，平均回报率约为 22–23%。

由于后验也是一种概率分布，我们可以根据给定的概率，对均值和方差的取值范围进行有根据的猜测。然后，你的团队老板可以考虑发生几率不同的情况，并为未来可能出现的负面风险做好准备。

我希望这可以很好地总结贝叶斯统计背后的直觉，以及为了在实践中使用它或详细研究它而需要做的所有准备工作。