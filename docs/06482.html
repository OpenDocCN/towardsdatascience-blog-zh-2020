<html>
<head>
<title>From DataFrame to Named-Entities</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从数据帧到命名实体</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/from-dataframe-to-named-entities-4cfaa7251fc0?source=collection_archive---------15-----------------------#2020-05-23">https://towardsdatascience.com/from-dataframe-to-named-entities-4cfaa7251fc0?source=collection_archive---------15-----------------------#2020-05-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="d747" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据科学/ Python NLP片段</h2><div class=""/><div class=""><h2 id="33ec" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用spaCy从Pandas数据帧中提取命名实体的快速入门指南。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/37cbf61d453373693d3d6549bc04a37e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mCSb2wzQGNQOZs-2qy0u8A.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@wesleyphotography?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">韦斯利·廷吉</a>在<a class="ae lh" href="https://unsplash.com/s/photos/organizations?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="230e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">很久以前，在一个遥远的星系，我在分析客户留下的评论时，注意到他们似乎更多地提到了特定的公司。这给了我一个想法。也许有一种方法可以从评论中提取公司的名称，我可以量化它们并进行进一步的分析。</p><p id="0518" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有！输入:<em class="me">命名实体识别</em>。</p><h1 id="f58a" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">命名实体识别</h1><p id="a4e6" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">根据维基百科，命名实体识别或NER“是信息提取的子任务，旨在定位非结构化文本中提到的命名实体并将其分类为预定义的类别，如人名、组织、位置、医疗代码、时间表达式、数量、货币值、百分比等。”换句话说，NER试图提取归类为专有名词甚至数字实体的单词。</p><p id="4b58" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这篇文章中，我将分享让我们使用spaCy从Pandas数据帧中提取命名实体的代码，spaCy是一个开源库，提供Python中工业级的自然语言处理，是为生产使用而设计的。</p><p id="dc25" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，让我们使用以下pip命令安装spaCy:</p><pre class="ks kt ku kv gt nc nd ne nf aw ng bi"><span id="1a99" class="nh mg it nd b gy ni nj l nk nl">pip install -U spacy</span></pre><p id="02f3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">之后，让我们下载英语的预训练模型:</p><pre class="ks kt ku kv gt nc nd ne nf aw ng bi"><span id="d9d6" class="nh mg it nd b gy ni nj l nk nl">python -m spacy download en</span></pre><p id="a113" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">解决了这个问题，让我们打开Jupyter笔记本，开始吧！</p><h1 id="a6bb" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">进口</h1><p id="f26d" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">将下面的代码块运行到一个单元格中，以将所有必需的导入内容导入到我们的Python环境中。</p><pre class="ks kt ku kv gt nc nd ne nf aw ng bi"><span id="7890" class="nh mg it nd b gy ni nj l nk nl"># for manipulating dataframes<br/>import pandas as pd</span><span id="f027" class="nh mg it nd b gy nm nj l nk nl"># for natural language processing: named entity recognition<br/>import spacy<br/>from collections import Counter<br/>import en_core_web_sm<br/>nlp = en_core_web_sm.load()</span><span id="e03a" class="nh mg it nd b gy nm nj l nk nl"># for visualizations<br/>%matplotlib inline</span></pre><p id="36ed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个块中重要的一行是<code class="fe nn no np nd b">nlp = en_core_web_sm.load()</code>,因为这是我们稍后将用来从文本中提取实体的。</p><h1 id="0cae" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">获取数据</h1><p id="eb2c" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">首先，让我们获取数据并将其加载到dataframe中。如果你想跟进，请在这里下载样本数据集<a class="ae lh" href="https://github.com/ecdedios/named-entity-recognition-quick-start" rel="noopener ugc nofollow" target="_blank"/>或从<a class="ae lh" href="http://www.trumptwitterarchive.com/archive" rel="noopener ugc nofollow" target="_blank"> Trump Twitter档案</a>创建你自己的数据集。</p><pre class="ks kt ku kv gt nc nd ne nf aw ng bi"><span id="c54e" class="nh mg it nd b gy ni nj l nk nl">df = pd.read_csv('ever_trump.csv')</span></pre><p id="1ba5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在单元中运行<code class="fe nn no np nd b">df.head()</code>将使我们快速熟悉数据集。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/db075ce1077b46034b64b8bb6c98fb59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UNixom4qJj9PBClqJsJG0A.png"/></div></div></figure><h1 id="2100" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">获取代币</h1><p id="f0c1" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">其次，让我们创建将作为spaCy输入的令牌。在下面一行中，我们创建了一个变量<code class="fe nn no np nd b">tokens</code>，它包含了<code class="fe nn no np nd b">df</code>数据帧的<code class="fe nn no np nd b">'text'</code>列中的所有单词。</p><pre class="ks kt ku kv gt nc nd ne nf aw ng bi"><span id="07fc" class="nh mg it nd b gy ni nj l nk nl">tokens = nlp(''.join(str(df.text.tolist())))</span></pre><p id="83e7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">第三，我们要提取实体。我们现在只能提取最常见的实体:</p><pre class="ks kt ku kv gt nc nd ne nf aw ng bi"><span id="d325" class="nh mg it nd b gy ni nj l nk nl">items = [x.text for x in tokens.ents]<br/>Counter(items).most_common(20)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/a8dce10d0c2a56197b0935af6af8cf88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*g8w3GF7sol49G_PcrplY-w.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者截图</p></figure><h1 id="ed50" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">提取命名实体</h1><p id="3303" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">接下来，我们将根据类别提取实体。我们有几个选择，从人到事件甚至组织。要获得spaCy提供的所有内容的完整列表，请查看他们关于<a class="ae lh" href="https://spacy.io/api/annotation#named-entities" rel="noopener ugc nofollow" target="_blank">命名实体</a>的文档。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ns"><img src="../Images/222599010b62ea7b3ad10a5e13e3a6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2PwJZe-vJai58wTuWt9CXA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者截图</p></figure><p id="843d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我们将使用<code class="fe nn no np nd b">PERSON</code>类型提取人(真实的和虚构的)。</p><pre class="ks kt ku kv gt nc nd ne nf aw ng bi"><span id="c8ae" class="nh mg it nd b gy ni nj l nk nl">person_list = []</span><span id="a908" class="nh mg it nd b gy nm nj l nk nl">for ent in tokens.ents:<br/>    if ent.label_ == 'PERSON':<br/>        person_list.append(ent.text)<br/>        <br/>person_counts = Counter(person_list).most_common(20)</span><span id="b45a" class="nh mg it nd b gy nm nj l nk nl">df_person = pd.DataFrame(person_counts, columns =['text', 'count'])</span></pre><p id="41fa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上面的代码中，我们用<code class="fe nn no np nd b">person_list = []</code>创建了一个空列表。</p><p id="314a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我们利用一个for循环来遍历在带有<code class="fe nn no np nd b">tokens.ents</code>的令牌中找到的实体。之后，我们创建了一个条件，如果实体标签等于<code class="fe nn no np nd b">PERSON</code>类型，它将追加到先前创建的列表中。</p><p id="c056" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们想知道某个<code class="fe nn no np nd b">PERSON</code>类型的实体在令牌中出现了多少次，所以我们对<code class="fe nn no np nd b">person_counts = Counter(person_list).most_common(20)</code>进行了处理。这一行将给出这种类型的前20个最常见的实体。</p><p id="e36a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我们创建了<code class="fe nn no np nd b">df_person</code>数据帧来存储结果，这是我们得到的结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/d5645d655333eba9eb7e269f9918136c.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/1*xEXu4VHuDO1d747YAdZ83Q.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者截图</p></figure><p id="a7c1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将为识别国籍、宗教和政治团体的<code class="fe nn no np nd b">NORP</code>类型重复相同的模式。</p><pre class="ks kt ku kv gt nc nd ne nf aw ng bi"><span id="3f4d" class="nh mg it nd b gy ni nj l nk nl">norp_list = []</span><span id="21c7" class="nh mg it nd b gy nm nj l nk nl">for ent in tokens.ents:<br/>    if ent.label_ == 'NORP':<br/>        norp_list.append(ent.text)<br/>        <br/>norp_counts = Counter(norp_list).most_common(20)</span><span id="3485" class="nh mg it nd b gy nm nj l nk nl">df_norp = pd.DataFrame(norp_counts, columns =['text', 'count'])</span></pre><p id="ee7e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是我们得到的结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nt"><img src="../Images/421c410a086121adae6b0312a91ea44d.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/1*Bb4pVDxcGh_66sIOnNlE8g.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者截图</p></figure><h1 id="c213" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">奖励回合:可视化</h1><p id="b8ec" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">让我们创建一个<code class="fe nn no np nd b">df_norp</code>数据帧的水平条形图。</p><pre class="ks kt ku kv gt nc nd ne nf aw ng bi"><span id="9e8b" class="nh mg it nd b gy ni nj l nk nl">df_norp.plot.barh(x='text', y='count', title="Nationalities, Religious, and Political Groups", figsize=(10,8)).invert_yaxis()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nu"><img src="../Images/37094e1a3693306a39b679180ec2d845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A0UHpxjn_CPV3h9xbE106A.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者截图</p></figure><p id="1c37" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">瞧，就是这样！</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="a98d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望你喜欢这个。自然语言处理是一个巨大的话题，但是我希望这个温和的介绍将鼓励你探索更多，扩展你的技能。</p><p id="fb9a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me">敬请期待！</em></p><p id="6ba8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以在Twitter或LinkedIn上找到我。</p><p id="823b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">[1]:维基百科。(2020年5月22日)。<em class="me">命名实体识别</em><a class="ae lh" href="https://en.wikipedia.org/wiki/Named-entity_recognition" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Named-entity_recognition</a></p><p id="5416" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">[2]: spaCy。(2020年5月22日)。【https://spacy.io/】工业级自然语言处理中的PythonT23</p></div></div>    
</body>
</html>