<html>
<head>
<title>Time Series Modeling for Atmospheric CO2 Concentration(ppm), 1958–2019</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大气 CO2 浓度(ppm)的时间序列建模，1958–2019</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-modeling-for-atmospheric-co2-concentration-ppm-1958-2019-8425fadcb927?source=collection_archive---------14-----------------------#2020-01-05">https://towardsdatascience.com/time-series-modeling-for-atmospheric-co2-concentration-ppm-1958-2019-8425fadcb927?source=collection_archive---------14-----------------------#2020-01-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2526" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">R +中季节性 ARIMA 建模的分步方法(源代码)</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/a67d366f9a9a4bff085216828845f24e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/0*l2CPJ610IfHqT0aL"/></div></figure><p id="b952" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在本帖中，我将介绍历史二氧化碳浓度(1958 年至 2019 年)的时间序列建模。季节性 ARIMA 建模将用于建立模型。Rmarkdown 格式的源代码可以在作者的 GitHub 链接<a class="ae lj" href="https://github.com/Peymankor/Data-Science_Portfolio/tree/master/Time%20Series%20Analysis-Historical%20Co2" rel="noopener ugc nofollow" target="_blank">这里</a>找到。知道<a class="ae lj" href="https://doi.org/10.1093/reep/rer022" rel="noopener ugc nofollow" target="_blank">人们常说</a>二氧化碳浓度应该在本世纪下半叶开始之前达到 460 ppm 以下，具体来说，这篇文章试图回答这个问题:</p><ul class=""><li id="56bd" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li lp lq lr ls bi translated">如果二氧化碳浓度的当前趋势继续下去(一切照旧)，那么在本世纪下半叶达到 460 ppm 的可能性有多大？</li></ul><p id="3e50" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">好，我们开始吧！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="0a86" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">初始化</h1><p id="0960" class="pw-post-body-paragraph kn ko iq kp b kq ms jr ks kt mt ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">首先要做的是导入这个分析中需要的包(如果您还没有安装它们，请预先在 R 中安装这些包):</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="ad61" class="nc mb iq my b gy nd ne l nf ng">library(tidyverse)<br/>library(forecast)<br/>library(lubridate)<br/>library(car)<br/>library(scales)<br/>library(patchwork)<br/>library(kableExtra)</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="e2ee" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">数据导入:</h1><p id="a655" class="pw-post-body-paragraph kn ko iq kp b kq ms jr ks kt mt ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">本分析将使用在夏威夷莫纳罗亚天文台测量的“1960/3–2019/12”期间的月 CO2 浓度(ppm)数据。此数据的链接可从以下网址获得:</p><p id="a1de" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">【https://www.esrl.noaa.gov/gmd/ccgg/trends/data.html T4】</p><p id="276f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，要读取 R 中的数据，必须考虑几点:</p><ul class=""><li id="e2ae" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li lp lq lr ls bi translated">数据有注释，这不是我们分析的兴趣。因此，我们用*comment.char = '#' *，</li><li id="ae12" class="lk ll iq kp b kq nh kt ni kw nj la nk le nl li lp lq lr ls bi translated">数据有 7 列，但其中一些列(如年和月标签)尚未写入数据，因此在导入时，我们分配以下列名(年、月、时间、Co2_con、插值、趋势、天)。</li><li id="a5fb" class="lk ll iq kp b kq nh kt ni kw nj la nk le nl li lp lq lr ls bi translated">使用空格分隔列，因此 sep =“”将被添加到代码中。</li><li id="bd35" class="lk ll iq kp b kq nh kt ni kw nj la nk le nl li lp lq lr ls bi translated">因为我们包含了列名，所以可以包含 header = F。</li></ul><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="6354" class="nc mb iq my b gy nd ne l nf ng">data &lt;- read.delim('ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt', comment.char = '#', header = F, sep = '', col.names = c('Year','Month','Time','Co2_Concentration','Interpolated','Trend','Days'))</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="1f6d" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">使数据整洁:</h1><p id="70d0" class="pw-post-body-paragraph kn ko iq kp b kq ms jr ks kt mt ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">查看任何 NA 值:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="3683" class="nc mb iq my b gy nd ne l nf ng">which(is.na(data))</span><span id="a725" class="nc mb iq my b gy nm ne l nf ng">## integer(0)</span></pre><p id="97a3" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">好，我们有完整的测量数据！但是，在读取数据时我们看到一些-99.99 的值！—注意，如注释中所述，这些值是在测量不可用时的值，因此对于这些点(741 次测量中的 7 次)，我们使用<em class="nn">插值</em>列:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="e020" class="nc mb iq my b gy nd ne l nf ng">data_cc &lt;- data %&gt;% <br/>    mutate(<br/>        Co2_Con = case_when(<br/>            Co2_Concentration == -99.99 ~ Interpolated,<br/>            TRUE ~ Co2_Concentration<br/>        )<br/>    )</span></pre><p id="ff04" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">让我们看看列类型:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="d470" class="nc mb iq my b gy nd ne l nf ng">sapply(data_cc, class)</span><span id="c654" class="nc mb iq my b gy nm ne l nf ng">##              Year             Month              Time Co2_Concentration <br/>##         "integer"         "integer"         "numeric"         "numeric" <br/>##      Interpolated             Trend              Days           Co2_Con <br/>##         "numeric"         "numeric"         "integer"         "numeric"</span></pre><p id="4361" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们可以看到列类型采用了适当的格式，但是我们可以添加名为<em class="nn"> Date </em>的新列，它以标准的时间序列格式给出测量日期。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="df3b" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">数据转换</h1><p id="d684" class="pw-post-body-paragraph kn ko iq kp b kq ms jr ks kt mt ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">这里<em class="nn"> Lubridate </em>包提供了一个简单的方法来转换我们的<em class="nn">年</em>和<em class="nn">月</em>列到日期:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="7fa8" class="nc mb iq my b gy nd ne l nf ng">data_cc$Date &lt;- ymd(paste0(data$Year, " ", data$Month, " ", "15"))</span></pre><p id="f714" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">此外，我们可以在我们想要做的分析中看到，我们不需要所有的列，因此我们可以选择我们分析中需要的列:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="8811" class="nc mb iq my b gy nd ne l nf ng">data_cc_sel &lt;- data_cc %&gt;% <br/>    select(Year, Month, Date, Co2_Con )</span></pre><p id="2043" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">此外，我们需要有一部分数据，以测试我们基于训练数据开发的模型-因此，在这里，我们认为 2017 年、<em class="nn"> 2018 年</em>和<em class="nn"> 2019 年</em>的数据是测试数据，其余的是训练数据。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="f8a5" class="nc mb iq my b gy nd ne l nf ng">data_cc_sel_test &lt;- data_cc_sel %&gt;% <br/>    filter(Year &gt; 2016)<br/>data_cc_sel_train &lt;- data_cc_sel %&gt;% <br/>    filter(Year &lt;= 2016)</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="5707" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">数据可视化</h1><p id="5bd9" class="pw-post-body-paragraph kn ko iq kp b kq ms jr ks kt mt ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">现在，让我们先把数据可视化，</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="821e" class="nc mb iq my b gy nd ne l nf ng">ggplot(data_cc_sel,aes(Date, Co2_Con)) +<br/>    geom_line(color='blue') +<br/>    xlab("Year, Month") +<br/>    scale_x_date(date_labels = "%Y-%m", date_breaks = "5 year") +<br/>    theme(axis.text.x = element_text(face = "bold", color = "#993333", <br/>                           size = 12, angle = 45, hjust = 1)) +<br/>    ylab("CO2 Concentration (ppm)") +<br/>    #scale_x_continuous(breaks = trans_breaks(identity, identity, n = 10))<br/>    scale_y_continuous() +<br/>    theme(axis.text.y = element_text(face = "bold", color = "#993333", <br/>                           size = 10, hjust = 1),axis.title.y = element_text(size = 10))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/cce937e6d6c82f587b1379ece618fd75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/0*MHF_GDPRNygF22um"/></div></figure><p id="dec8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，有时使用“拼凑”包将所有总数据集、训练和测试一个接一个地绘制出来也很好:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="f88c" class="nc mb iq my b gy nd ne l nf ng">p1 &lt;- ggplot(data_cc_sel,aes(Date, Co2_Con)) +<br/>    geom_line(color='blue') +<br/>    xlab("Year, Month") +<br/>    scale_x_date(date_labels = "%Y-%m", date_breaks = "5 year") +<br/>    theme(axis.text.x = element_text(face = "bold", color = "#993333", <br/>                           size = 12, angle = 45, hjust = 1)) +<br/>    ylab("CO2 Concentration (ppm)") +<br/>    #scale_x_continuous(breaks = trans_breaks(identity, identity, n = 10))<br/>    scale_y_continuous() +<br/>    theme(axis.text.y = element_text(face = "bold", color = "#993333", <br/>                           size = 10, hjust = 1),axis.title.y = element_text(size = 8))<br/></span><span id="8914" class="nc mb iq my b gy nm ne l nf ng">p2 &lt;- ggplot(data_cc_sel_train,aes(Date, Co2_Con)) +<br/>    geom_line(color='blue') +<br/>    xlab("Year, Month") +<br/>    scale_x_date(date_labels = "%Y-%m", date_breaks = "5 year") +<br/>    theme(axis.text.x = element_text(face = "bold", color = "#993333", <br/>                           size = 12, angle = 45, hjust = 1)) +<br/>    ylab("CO2 Concentration (ppm)") +<br/>    #scale_x_continuous(breaks = trans_breaks(identity, identity, n = 10))<br/>    scale_y_continuous() +<br/>    theme(axis.text.y = element_text(face = "bold", color = "#993333", <br/>                           size = 10, hjust = 1), axis.title.y = element_text(size = 8))<br/></span><span id="825e" class="nc mb iq my b gy nm ne l nf ng">p3 &lt;- ggplot(data_cc_sel_test,aes(Date, Co2_Con)) +<br/>    geom_line(color='blue') +<br/>    xlab("Year, Month") +<br/>    scale_x_date(date_labels = "%Y-%m", date_breaks = "1 year") +<br/>    theme(axis.text.x = element_text(face = "bold", color = "#993333", <br/>                           size = 12, angle = 45, hjust = 1)) +<br/>    ylab("CO2 Concentration (ppm)") +<br/>    #scale_x_continuous(breaks = trans_breaks(identity, identity, n = 10))<br/>    scale_y_continuous() +<br/>    theme(axis.text.y = element_text(face = "bold", color = "#993333", <br/>                           size = 10, hjust = 1), axis.title.y = element_text(size = 8))<br/></span><span id="4023" class="nc mb iq my b gy nm ne l nf ng">(p2 | p3 ) /<br/>      p1</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/9525e78e1b6dc30ad07548d034fba502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/0*cDNzTK51y2jmWE-v"/></div></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="d20c" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">建模:</h1><p id="73c7" class="pw-post-body-paragraph kn ko iq kp b kq ms jr ks kt mt ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">在时间序列分析中，关于趋势，我们需要知道的前三件事是:</p><ul class=""><li id="44a9" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li lp lq lr ls bi translated">数据是静态的吗？</li><li id="c786" class="lk ll iq kp b kq nh kt ni kw nj la nk le nl li lp lq lr ls bi translated">回答:不是，我们在图中看到了清晰的趋势，因此 CO2 浓度的特性取决于时间(例如，数据的平均值取决于时间，是非平稳的)。</li><li id="d08c" class="lk ll iq kp b kq nh kt ni kw nj la nk le nl li lp lq lr ls bi translated">数据有季节性吗？</li><li id="dd3a" class="lk ll iq kp b kq nh kt ni kw nj la nk le nl li lp lq lr ls bi translated">回答:是的，我们在数据中肯定能看到季节性。现在，知道了数据的非平稳性和季节性，它建议使用季节性差异来建模数据。要回答，</li><li id="9a6e" class="lk ll iq kp b kq nh kt ni kw nj la nk le nl li lp lq lr ls bi translated">自相关函数和偏相关是怎样的？</li></ul><p id="cf82" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这是来自<em class="nn">预测</em>包的 ACF 和 PACF 的图:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="0a26" class="nc mb iq my b gy nd ne l nf ng">Co2_train &lt;- ts(data_cc_sel_train$Co2_Con, start = c(1958,3), frequency = 12)<br/>Co2_train %&gt;% ggtsdisplay()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/ee9d2ae99a7d675a87b1ba944a2b2148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/0*4m9tNnvH0Y67_VU-"/></div></figure><p id="e513" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">很明显，数据显示需要差分(因为 ACF 不会下降到零)，现在我们对进行普通差分，滞后时间为 12:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="a1d3" class="nc mb iq my b gy nd ne l nf ng">Co2_train %&gt;% diff(lag=12) %&gt;% diff() %&gt;% ggtsdisplay()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi no"><img src="../Images/7723782d2cfba2acc7b117eedd8d5a2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pAqm1_bplkg9nMgcRkaYpA.png"/></div></div></figure><p id="1ed5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，情况有所好转，我们基本上消除了这种趋势。我们以 ARIMA(p，D，q)(P，D，Q)[12]中的 d=D = 1 开始模型(原因是我们在上面的图中区分了季节性和非季节性部分。)</p><p id="55ae" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，我们必须有一些 P，Q，P，Q 的起始参数。所以，让我们看看上面的 ACF 和 PACF:</p><ul class=""><li id="a384" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li lp lq lr ls bi translated">在季节性滞后中，ACF 中有一个显著的尖峰，表明可能存在 MA(1)项。所以，起点是 Q = 1</li><li id="f2b2" class="lk ll iq kp b kq nh kt ni kw nj la nk le nl li lp lq lr ls bi translated">在非季节性差异数据的图中，ACF 图有三个尖峰，这可能暗示季节性 MA(3)项，q=3。</li></ul><p id="f8a0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">因此，我们开始使用 ARIMA(0，1，3)(3，1，1)[12]并在 AR 和 MA 项中进行变化。这里，在保持阶常数(D，D)的同时，我们使用 AICs 值来判断模型的质量。(尽量减少 AIC)</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="f74c" class="nc mb iq my b gy nd ne l nf ng">aicsvalue &lt;- function(p,q,P,Q) {<br/>  fit &lt;- Arima(Co2_train, order=c(p,1,q),seasonal=list(order=c(P,1,Q),period=12),<br/>                  lambda = "auto"<br/>              )<br/>  return(fit$aicc)<br/>}</span><span id="eb2b" class="nc mb iq my b gy nm ne l nf ng">model_eva &lt;- data.frame(Model_name=c("ARIMA(0,1,3)(3,1,1)[12]","ARIMA(0,1,1)(3,1,1)[12]","ARIMA(1,1,0)(1,1,0)[12]",<br/>                                     "ARIMA(1,1,2)(1,1,0)[12]","ARIMA(1,1,3)(0,1,1)[12]","ARIMA(1,1,1)(1,1,0)[12]",<br/>                                     "ARIMA(1,1,1)(1,1,0)[12]","ARIMA(1,1,0)(1,1,1)[12]","ARIMA(1,1,1)(0,1,1)[12]" ), AICc=c(aicsvalue(0,3,3,1),aicsvalue(0,1,3,1),aicsvalue(1,0,1,0),                                                            aicsvalue(1,2,1,0),aicsvalue(1,3,0,1),aicsvalue(1,1,1,0),                                                           aicsvalue(1,1,1,0),aicsvalue(1,0,1,1), aicsvalue(1,1,0,1)))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi nt"><img src="../Images/2a6adc6ce55aff434ded8d724d67b6c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g3vGd_uuAqlHVMCe7iWVsg.png"/></div></div></figure><p id="4d60" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">基于以上分析，将选择<em class="nn">A</em><strong class="kp ir"><em class="nn">R</em></strong><em class="nn">I</em><strong class="kp ir"><em class="nn">M</em></strong><em class="nn">A</em>(1，1，1)(0，1，1)[12]，但是我们需要检查残差以避免任何过拟合和欠拟合，以查看 Ljung-Box 测试残差是否类似白噪声。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="d9ea" class="nc mb iq my b gy nd ne l nf ng">(fit_minaicc &lt;- Arima(Co2_train, order=c(1,1,1),seasonal=list(order=c(0,1,1),period=12),<br/>                  lambda = "auto"<br/>              ))<br/>checkresiduals(fit_minaicc, lag=36)<br/>fit_minaicc$aicc</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi no"><img src="../Images/11b1c9fdb972ee8f9b0ef90354fb1e89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KJIJbWmjhchTsG91Xvuh0w.png"/></div></div></figure><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="dbca" class="nc mb iq my b gy nd ne l nf ng">## <br/>##  Ljung-Box test<br/>## <br/>## data:  Residuals from ARIMA(2,0,1)(1,1,1)[12] with drift<br/>## Q* = 32.406, df = 30, p-value = 0.3489<br/>## <br/>## Model df: 6.   Total lags used: 36</span></pre><p id="b939" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，我们可以看到残差非常类似于白噪声，p 值也很高，模型通过了 Ljong-Box 测试。(然而，必须提到的是，一些 ACF 刚刚达到蓝线的边界，然而，我不认为它会对预测产生实质性影响——有时很难让模型通过所有测试。)</p><p id="f168" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然而，这并不是模型选择的终点。这里比较一下模型在<em class="nn">测试</em>数据上的表现。我们寻求最小化 RMSE 的模型。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="058b" class="nc mb iq my b gy nd ne l nf ng">Co2_test &lt;- ts(data_cc_sel_test$Co2_Con, start = c(2017,1), frequency = 12)<br/>mm &lt;- accuracy(forecast(fit_minaicc,h=35)$mean, Co2_test )</span></pre><p id="a87d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">本节比较了上一节中提供的 9 种车型的<em class="nn"> RMSE </em>值。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="5499" class="nc mb iq my b gy nd ne l nf ng">rmse_eva &lt;- function(p,d,q,P,D,Q) {<br/>  fit &lt;- Arima(Co2_train, order=c(p,d,q),seasonal=list(order=c(P,D,Q),period=12),<br/>                  lambda = "auto", include.drift = T<br/>              )<br/>  mm &lt;- accuracy(forecast(fit,h=35)$mean, Co2_test)<br/>  return(mm[2])</span><span id="7aff" class="nc mb iq my b gy nm ne l nf ng">}</span><span id="c30d" class="nc mb iq my b gy nm ne l nf ng">rmse_eva &lt;- data.frame(Model_name=c(<br/>"ARIMA(0,1,3)(3,1,1)[12]","ARIMA(0,1,1)(3,1,1)[12]","ARIMA(1,1,0)(1,1,0)[12]",<br/>"ARIMA(1,1,2)(1,1,0)[12]","ARIMA(1,1,3)(0,1,1)[12]","ARIMA(1,1,1)(1,1,0)[12]",<br/>"ARIMA(1,1,1)(1,1,0)[12]","ARIMA(1,1,0)(1,1,1)[12]","ARIMA(1,1,1)(0,1,1)[12]"<br/> ), RMSE=c(                        <br/>rmse_eva(0,1,3,3,1,1),rmse_eva(0,1,1,3,1,1),rmse_eva(1,1,0,1,1,0),                                                  rmse_eva(1,1,2,1,1,0),rmse_eva(1,1,3,0,1,1),rmse_eva(1,1,1,1,1,0),                                                  rmse_eva(1,1,1,1,1,0),rmse_eva(1,1,0,1,1,1),rmse_eva(1,1,1,0,1,1)))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi nt"><img src="../Images/4c00003d464b9464541a10b9dea33162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iojOwfQwlSdO2Ge21HCIbQ.png"/></div></div></figure><p id="ebc5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">结果表明，模型 ARIMA(1，1，1)(0，1，1)[12]没有最小 RMSE 值，但它非常接近最小值，但它在 AICc 值中是最小的。最后，已知模型残差遵循白噪声，选择模型 ARIMA(1，1，1)(0，1，1)[12]来预测包装，因为它的参数较少且简单，同时保持最小的 AIC。(注意:如果标准被设置为 RMSE，这可能会导致我们的模型非常复杂，有许多参数)</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="285e" class="nc mb iq my b gy nd ne l nf ng">Co2_train %&gt;%<br/>  Arima(order=c(1,1,1),seasonal=list(order=c(0,1,1),period=12),<br/>                lambda = "auto"<br/>              ) %&gt;%<br/>  forecast(h=400) %&gt;%<br/>  autoplot() +<br/>    ylab("H02 sales (million scripts)") + xlab("Year") +<br/>  autolayer(Co2_test)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi no"><img src="../Images/93993fda0634beb796bc5bd71ee75a36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VH41p5E671puvMIYQyQB8g.png"/></div></div></figure><p id="f9cb" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">让我们放大模型预测和测试数据，以直观地查看模型性能:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="80aa" class="nc mb iq my b gy nd ne l nf ng">prediction &lt;- forecast(fit_minaicc,h=35) <br/>data_cc_sel_test$prediction &lt;- prediction$mean<br/>data_test_pre_tidy &lt;- gather(data_cc_sel_test, "type", "Co2", -Year,-Month,-Date)</span><span id="f6b8" class="nc mb iq my b gy nm ne l nf ng">## Warning: attributes are not identical across measure variables;<br/>## they will be dropped</span><span id="7a97" class="nc mb iq my b gy nm ne l nf ng">ggplot(data_test_pre_tidy,aes(Date, Co2,color=type)) +<br/>    geom_line() +<br/>    xlab("Year, Month") +<br/>    scale_x_date(date_labels = "%Y-%m", date_breaks = "1 year") +<br/>    theme(axis.text.x = element_text(face = "bold", color = "#993333", <br/>                           size = 12, angle = 45, hjust = 1)) +<br/>    ylab("CO2 Concentration (ppm)") +<br/>    #scale_x_continuous(breaks = trans_breaks(identity, identity, n = 10))<br/>    scale_y_continuous() +<br/>    theme(axis.text.y = element_text(face = "bold", color = "#993333", <br/>                           size = 10, hjust = 1), axis.title.y = element_text(size = 8))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/66cba7d9902d3cbcb4802ffda2d93493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/0*PnbNtkIfdRJ8Q8-0"/></div></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="095c" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">洞察力:</h1><p id="109b" class="pw-post-body-paragraph kn ko iq kp b kq ms jr ks kt mt ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">现在，给定开发的模型，我们想要回答的问题是:</p><p id="c17b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">给定开发的模型，2050 年达到 460 ppm 的几率有多大？要回答这个问题，我们首先需要建立 2050 年二氧化碳浓度的累积分布:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="26c5" class="nc mb iq my b gy nd ne l nf ng">prediction1 &lt;- forecast(fit_minaicc,h=396, level = c(80,90)) <br/>p10 &lt;- prediction1$upper[396,2]<br/>p50 &lt;- prediction1$mean[396]<br/>sd_calc &lt;- (p10-p50)/1.28</span><span id="558f" class="nc mb iq my b gy nm ne l nf ng">Co2_con_2050 &lt;- rnorm(10^6,p50,sd_calc)<br/>cdf_co2_con_2050 &lt;- ecdf(Co2_con_2050)<br/>cdf_co2_con_2050_data &lt;- data.frame(Co2_con_2050)<br/>ggplot(cdf_co2_con_2050_data, aes(Co2_con_2050)) + stat_ecdf(geom = "step", color='blue') +<br/>  geom_vline(xintercept = 460, color='red') +<br/>  geom_hline(yintercept = cdf_co2_con_2050(460), color='red') +<br/>  theme(axis.text.x = element_text(face = "bold", color = "#993333", <br/>                           size = 12, angle = 0, hjust = 1)) +<br/>  scale_x_continuous(breaks=c(400,425,450, 460,475,500,525, 550), limits = c(425,525)) +<br/>  scale_y_continuous(breaks=c(seq(0,1,0.1)), limits = c(0,1)) +<br/>  ylab('Cumulative Distribution') +<br/>  xlab("Co2 Concentraion(ppm) at 2050")</span><span id="8e0d" class="nc mb iq my b gy nm ne l nf ng">## Warning: Removed 238 rows containing non-finite values (stat_ecdf).</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/a8b4e499e962367394fadf937b83ca1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*qaY96A8tVur0Q71blQCZDw.png"/></div></figure><p id="fa2d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，有了累积分布，我们可以问这个问题:</p><ul class=""><li id="2cad" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li lp lq lr ls bi translated">到 2050 年，二氧化碳浓度(ppm)保持在 460 以下的概率有多大？</li></ul><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="6985" class="nc mb iq my b gy nd ne l nf ng">cdf_co2_con_2050(460)<br/>## [1] 0.089823</span></pre><p id="4ce1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">可以看到，答案是 9%左右。</p></div></div>    
</body>
</html>