<html>
<head>
<title>Painting and Sketching with OpenCV in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 中的 OpenCV 进行绘画和素描</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/painting-and-sketching-with-opencv-in-python-4293026d78b?source=collection_archive---------20-----------------------#2020-07-20">https://towardsdatascience.com/painting-and-sketching-with-opencv-in-python-4293026d78b?source=collection_archive---------20-----------------------#2020-07-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5722" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">制作油画和水彩画之类的艺术，画素描，用 Python 中的 OpenCV 创作点彩艺术。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ca8b33427f2c18a154341fb6a2b79972.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3mquHrlLd-A5wd92"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@geordannatheartist?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乔丹娜·科德罗</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="4af3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">OpenCV 是一个强大的计算机视觉库，具有强大的图像处理工具包。在本文中，我们将利用它来创建绘图和绘画，其中大多数将使用内置函数！让我们简短地介绍一下，直接进入激动人心的部分。</p><h1 id="4e7d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">目录</h1><ul class=""><li id="6b86" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu mu mv mw mx bi translated">要求</li><li id="6739" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">油画效果</li><li id="bcde" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">水彩效果</li><li id="6768" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">黑白和彩色铅笔素描</li><li id="3be9" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">点彩艺术</li></ul></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><h1 id="1101" class="lv lw it bd lx ly nk ma mb mc nl me mf jz nm ka mh kc nn kd mj kf no kg ml mm bi translated">要求</h1><p id="b267" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">油画效果需要 OpenCV Contrib 模块，而其他效果可以使用 OpenCV 的标准发行版来实现。除此之外，点彩艺术需要 Sklearn 和 Scipy。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="43a8" class="nx lw it nt b gy ny nz l oa ob">pip install opencv-contrib-python==4.3.0.36<br/>pip install scikit-learn<br/>pip install scipy</span></pre><h1 id="99ac" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">油画效果</h1><p id="de5a" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">它包含在<code class="fe oc od oe nt b">cv2.xphoto()</code>中，它还具有其他几个很酷的功能，如图像修复、白平衡、图像去噪等。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="1d2f" class="nx lw it nt b gy ny nz l oa ob">import cv2</span><span id="1e11" class="nx lw it nt b gy of nz l oa ob">img = cv2.imread('img.jpg')<br/>res = cv2.xphoto.oilPainting(img, 7, 1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/9d35504d6c71195c429b21e65700acef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ocu_kf2v3yJjP525QcZPAQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原象</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/65cd317e9f49b691fa1c437f78d1ffcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J3NN9vUzZfooWpWNkPX3pg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">油画效果</p></figure><h1 id="1bd0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">水彩效果</h1><p id="c7ba" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">像油画效果一样，水彩效果也可以用一行代码完成，不包括导入和图像读取。由<code class="fe oc od oe nt b">cv2.stylization()</code>完成。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="df14" class="nx lw it nt b gy ny nz l oa ob">import cv2</span><span id="68bc" class="nx lw it nt b gy of nz l oa ob">img = cv2.imread('img.jpg')<br/>res = cv2.stylization(img, sigma_s=60, sigma_r=0.6)</span><span id="eb06" class="nx lw it nt b gy of nz l oa ob"># sigma_s controls the size of the neighborhood. Range 1 - 200</span><span id="48e4" class="nx lw it nt b gy of nz l oa ob"># sigma_r controls the how dissimilar colors within the neighborhood will be averaged. A larger sigma_r results in large regions of constant color. Range 0 - 1</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/2a2d7662acdd32071c0bc87d0ee5f107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f0PWNmyWVuJDCrAypuiFNA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">水彩效果</p></figure><h1 id="5d61" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">黑白和彩色铅笔素描</h1><p id="89b3" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">同样，只需要一行代码，我们就可以得到灰度和彩色的草图。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="fddd" class="nx lw it nt b gy ny nz l oa ob">import cv2 </span><span id="7fc9" class="nx lw it nt b gy of nz l oa ob">img = cv2.imread('img.jpg')<br/>dst_gray, dst_color = cv2.pencilSketch(img, sigma_s=60, sigma_r=0.07, shade_factor=0.05) </span><span id="1ea9" class="nx lw it nt b gy of nz l oa ob"># sigma_s and sigma_r are the same as in stylization.</span><span id="886f" class="nx lw it nt b gy of nz l oa ob"># shade_factor is a simple scaling of the output image intensity. The higher the value, the brighter is the result. Range 0 - 0.1</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/944d811b73ea677800efa8add0fdaeac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FRmbYF06oV3N7E27GLhuTw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">黑白素描</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/d7dcebdc75a5b17f9f94a95834c5c967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T7BOkG6mjpYZOVtvTsf0xw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">彩色素描</p></figure><h1 id="85c9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">点彩艺术</h1><p id="509f" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">根据<a class="ae ky" href="https://en.wikipedia.org/wiki/Pointillism" rel="noopener ugc nofollow" target="_blank">维基百科</a>，点彩艺术可以定义为:</p><blockquote class="oh oi oj"><p id="9f5d" class="kz la ok lb b lc ld ju le lf lg jx lh ol lj lk ll om ln lo lp on lr ls lt lu im bi translated">点彩是一种绘画技巧，在这种技巧中，小的、不同的颜色点被应用到图案中以形成图像</p></blockquote><p id="2fee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在 Python 中做到这一点，我们的第一步是计算使用 Kmeans 最多的颜色。我使用了 20 的调色板，这意味着点将由 20 个最常用的颜色在图像中出现。根据图像尺寸为点计算合适的半径尺寸。然后我们在图像上循环，找到最接近圆点的颜色，用它来画圆。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="800c" class="nx lw it nt b gy ny nz l oa ob">import scipy.spatial<br/>import numpy as np<br/>import random<br/>import cv2<br/>import math<br/>from sklearn.cluster import KMeans</span><span id="ab27" class="nx lw it nt b gy of nz l oa ob">def compute_color_probabilities(pixels, palette):<br/>    distances = scipy.spatial.distance.cdist(pixels, palette)<br/>    maxima = np.amax(distances, axis=1)</span><span id="37e8" class="nx lw it nt b gy of nz l oa ob">distances = maxima[:, None] - distances<br/>    summ = np.sum(distances, 1)<br/>    distances /= summ[:, None]<br/>    return distances</span><span id="d4ca" class="nx lw it nt b gy of nz l oa ob">def get_color_from_prob(probabilities, palette):<br/>    probs = np.argsort(probabilities)<br/>    i = probs[-1]<br/>    return palette[i]</span><span id="9f45" class="nx lw it nt b gy of nz l oa ob">def randomized_grid(h, w, scale):<br/>    assert (scale &gt; 0)<br/>    r = scale//2</span><span id="3280" class="nx lw it nt b gy of nz l oa ob">    grid = []<br/>    for i in range(0, h, scale):<br/>        for j in range(0, w, scale):<br/>            y = random.randint(-r, r) + i<br/>            x = random.randint(-r, r) + j</span><span id="42f7" class="nx lw it nt b gy of nz l oa ob">    grid.append((y % h, x % w))</span><span id="666d" class="nx lw it nt b gy of nz l oa ob">    random.shuffle(grid)<br/>    return grid</span><span id="de76" class="nx lw it nt b gy of nz l oa ob">def get_color_palette(img, n=20):</span><span id="3e2d" class="nx lw it nt b gy of nz l oa ob">    clt = KMeans(n_clusters=n)<br/>    clt.fit(img.reshape(-1, 3))</span><span id="52ab" class="nx lw it nt b gy of nz l oa ob">return clt.cluster_centers_</span><span id="4819" class="nx lw it nt b gy of nz l oa ob">def complement(colors):<br/>    return 255 - colors</span><span id="a76c" class="nx lw it nt b gy of nz l oa ob">def create_pointillism_art(image_path, primary_colors):<br/>        <br/>    img = cv2.imread(image_path)<br/>    radius_width = int(math.ceil(max(img.shape) / 1000))<br/>    palette = get_color_palette(img, primary_colors)<br/>    complements = complement(palette)<br/>    palette = np.vstack((palette, complements))<br/>    canvas = img.copy()</span><span id="f87a" class="nx lw it nt b gy of nz l oa ob">    grid = randomized_grid(img.shape[0], img.shape[1], scale=3)<br/>    <br/>    pixel_colors = np.array([img[x[0], x[1]] for x in grid])<br/>    <br/>    color_probabilities = compute_color_probabilities(pixel_colors, palette)</span><span id="2d1b" class="nx lw it nt b gy of nz l oa ob">for i, (y, x) in enumerate(grid):<br/>        color = get_color_from_prob(color_probabilities[i], palette)<br/>        cv2.ellipse(canvas, (x, y), (radius_width, radius_width), 0, 0, 360, color, -1, cv2.LINE_AA)</span><span id="3b79" class="nx lw it nt b gy of nz l oa ob">    return canvas</span><span id="d603" class="nx lw it nt b gy of nz l oa ob">res = create_pointillism_art('img.jpg', 20)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/e1cf41decb756bdc71211b5246767d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vYq4E630xTAM0fjmhVixgw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原象</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/584b634b6f8757019ca9441f7cb2946a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XRsHW59VlDC3fFjYsyQvCg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">结果</p></figure><p id="3f54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点彩艺术的代码受到这个<a class="ae ky" href="https://github.com/atriwal/Points_Art" rel="noopener ugc nofollow" target="_blank"> GitHub 库</a>的启发，做了一些修改。</p></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><p id="86f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我们看到用 OpenCV 制作艺术是小菜一碟，尤其是使用内置函数。如果你想看到使用 OpenCV 的图像编辑操作，你可以参考这篇文章:</p><div class="op oq gp gr or os"><a href="https://medium.com/dataseries/designing-image-filters-using-opencv-like-abode-photoshop-express-part-1-8765e3f4495b" rel="noopener follow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">使用 OpenCV 设计图像滤镜(第 1 部分)</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">我们都编辑过我们的图像，也许是为了改善白平衡，增加温暖，使用不同的滤镜，甚至…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">medium.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div></div></div>    
</body>
</html>