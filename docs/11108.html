<html>
<head>
<title>Create an Image Classification Web App using PyTorch and Streamlit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 PyTorch 和 Streamlit 创建影像分类 Web 应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-an-image-classification-web-app-using-pytorch-and-streamlit-f043ddf00c24?source=collection_archive---------22-----------------------#2020-08-02">https://towardsdatascience.com/create-an-image-classification-web-app-using-pytorch-and-streamlit-f043ddf00c24?source=collection_archive---------22-----------------------#2020-08-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d36524ddaf0a180ffdc855622ec83dcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jqvp6wKOJw0s5cGM"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@linkedinsalesnavigator?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> LinkedIn 销售导航员</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="ec12" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你刚刚开发了一个很酷的 ML 模型。</p><p id="e114" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你以此为荣。您希望通过 web 演示向您的朋友展示它，以便他们可以与您的模型进行交互并提供反馈。</p><p id="8840" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，你并不熟悉常见的框架，如<a class="ae kf" href="https://ddi-dev.com/blog/programming/django-vs-flask-which-better-your-web-app/" rel="noopener ugc nofollow" target="_blank"> Django 和 Flask </a>。</p><p id="65b1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你开始问自己:有没有一种方法可以用最少的框架构建一个快速的 web 演示？</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="33a2" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">古玩目录</h1><ol class=""><li id="7d6a" class="mj mk it ki b kj ml kn mm kr mn kv mo kz mp ld mq mr ms mt bi translated"><a class="ae kf" href="#b382" rel="noopener ugc nofollow">什么是细流？</a></li><li id="9804" class="mj mk it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><a class="ae kf" href="#68e1" rel="noopener ugc nofollow">如何制作 UI？</a></li><li id="ac99" class="mj mk it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><a class="ae kf" href="#1d5c" rel="noopener ugc nofollow">如何创建图像分类模型？</a></li><li id="790c" class="mj mk it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><a class="ae kf" href="#2b4c" rel="noopener ugc nofollow">结果是什么样的？</a></li><li id="4da2" class="mj mk it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><a class="ae kf" href="#3e3d" rel="noopener ugc nofollow">接下来我们能做什么？</a></li></ol></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="b382" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">概观</h1><p id="b0e1" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">在这篇文章中，我将通过一个简单的例子来展示如何使用<strong class="ki iu"> Streamlit </strong>来构建一个简单的 web 应用程序。</p><p id="0149" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>是一个开源的 Python 库，可以轻松构建用于机器学习和数据科学的定制 web 应用[1]。点击查看它的图库<a class="ae kf" href="https://www.streamlit.io/gallery" rel="noopener ugc nofollow" target="_blank">来看看其他人创建的一些应用程序。</a></p><p id="df60" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在这里选择图像分类作为一个例子，因为计算机视觉(CV)是目前人工智能中最受欢迎的领域之一，由深度学习算法驱动。它还有广泛的应用，比如对医学图像进行分类，帮助医生进行疾病诊断[2]。在这里了解更多关于深度学习模型<a class="ae kf" href="https://www.researchgate.net/publication/325116934_Image_classification_using_Deep_learning" rel="noopener ugc nofollow" target="_blank">的图像分类。</a></p><p id="78ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">出于演示的目的，我将使用 PyTorch 的预训练 ResNet 模型，对于相同的任务，您可以随时使用其他库(TensorFlow、Keras 等)。)，其他架构，甚至定制自己的模型。</p><p id="1020" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要查看我的完整 Python 代码，请查看我的<a class="ae kf" href="https://github.com/terryz1/Image_Classification_App" rel="noopener ugc nofollow" target="_blank"> Github 页面</a>。</p><p id="10cd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在事不宜迟，让我们开始吧！</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="b4c0" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="ak">安装 Streamlit </strong></h1><p id="c182" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">第一步是安装 Streamlit 库，您可以使用 pip 命令来完成。我建议您使用 Python 虚拟环境来分别保存每个项目的依赖关系。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="6b6d" class="nl lm it nh b gy nm nn l no np">$ pip install streamlit</span></pre><p id="4d1c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">成功安装后，您可以使用一个简单的“Hello World”应用程序进行快速检查:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="6cfa" class="nl lm it nh b gy nm nn l no np">$ streamlit hello</span></pre></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="68e1" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">用户界面</h1><p id="4171" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">对于我们的应用程序，一个关键要素是使用户能够为模型上传图像以进行预测，这可以通过'<strong class="ki iu"> file_uploader </strong>'函数来完成:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="3f02" class="nl lm it nh b gy nm nn l no np">import streamlit as st<br/>file_up = st.file_uploader("Upload an image", type="jpg")</span></pre><p id="ab35" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请确保指定适当的文件类型，以便它能与分类模型一起正常工作。</p><p id="42fb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以显示这个图像:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="3d37" class="nl lm it nh b gy nm nn l no np">from PIL import Image<br/>image = Image.open(file_up)<br/>st.image(image, caption='Uploaded Image.', use_column_width=True)</span></pre><p id="346d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除此之外，我们还将使用“set_title”为应用程序创建一个标题，并使用“write”显示预测结果。</p><h1 id="1d5c" class="ll lm it bd ln lo nq lq lr ls nr lu lv lw ns ly lz ma nt mc md me nu mg mh mi bi translated">分类模型</h1><p id="f253" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">要使用 PyTorch 的预训练模型，请确保安装了“Torch”和“torchvision”库。现在我们可以创建一个 ResNet 模型:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="3571" class="nl lm it nh b gy nm nn l no np">from torchvision import models, transforms<br/>import torch<br/>resnet = models.resnet101(pretrained=True)</span></pre><p id="940c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">简单来说，残差网络(ResNet)是一种改进的卷积神经元网络(CNN)，在知名的<a class="ae kf" href="https://en.wikipedia.org/wiki/ImageNet" rel="noopener ugc nofollow" target="_blank"> ImageNet </a>数据库中训练，在图像分类、物体检测等 CV 任务中取得了<a class="ae kf" rel="noopener" target="_blank" href="/review-resnet-winner-of-ilsvrc-2015-image-classification-localization-detection-e39402bfa5d8">的优异性能</a>。这个特殊的模型“resnet101”意味着它有 101 层(深！).点击阅读更多关于 ResNet 及其变种<a class="ae kf" rel="noopener" target="_blank" href="/an-overview-of-resnet-and-its-variants-5281e2f56035">的信息。</a></p><p id="6d24" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们创建这个模型之后，我们需要通过调整大小、标准化等来转换输入图像。这里我们利用了“火炬视觉”中的“变换”模块:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="0b25" class="nl lm it nh b gy nm nn l no np">transform = transforms.Compose([<br/>    transforms.Resize(256),<br/>    transforms.CenterCrop(224),<br/>    transforms.ToTensor(),<br/>    transforms.Normalize(<br/>    mean=[0.485, 0.456, 0.406],<br/>    std=[0.229, 0.224, 0.225]<br/>    )])</span></pre><p id="820d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意，图像根据其平均值和标准偏差进行归一化。详见<a class="ae kf" href="https://pytorch.org/docs/stable/torchvision/models.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="ac9d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们能够加载图像、预处理图像并进行预测:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="1a96" class="nl lm it nh b gy nm nn l no np">img = Image.open(image_path)<br/>batch_t = torch.unsqueeze(transform(img), 0)</span><span id="122e" class="nl lm it nh b gy nv nn l no np">resnet.eval()<br/>out = resnet(batch_t)</span></pre><p id="e7b9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们可以返回按最高概率排序的前 5 个预测。确保 ImageNet 中 1000 个类别的名称可用，以便我们可以通过索引输出预测:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="075a" class="nl lm it nh b gy nm nn l no np">prob = torch.nn.functional.softmax(out, dim=1)[0] * 100<br/>_, indices = torch.sort(out, descending=True)<br/>return [(classes[idx], prob[idx].item()) for idx in indices[0][:5]]</span></pre></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="2b4c" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">结果</h1><p id="a6a6" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">现在，我们可以通过在命令提示符/终端中键入“streamlit run <the python="" file="" containing="" ui="">”来运行应用程序。让我们尝试两个例子，看看结果是什么样的。</the></p><p id="390e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一个例子:</p><figure class="nc nd ne nf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/df6a7e8acb7508d8451c33aeebf8ad3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kmOWg5PpFQkVqOQike_arg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">图片来源:<a class="ae kf" href="https://unsplash.com/@wildlittlethingsphoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">海伦娜在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上修剪</a></p></figure><p id="e1ee" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">太好了！金毛位居榜首，置信度很高(~97)。</p><p id="44a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们试试另一个例子:</p><figure class="nc nd ne nf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/888aba409c9c81de221cea1e71021ab6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ca5_ZYJTEFuttbq0WqeZ6w.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">图片来源:<a class="ae kf" href="https://www.pexels.com/@zdenek-rosenthaler-1395581" rel="noopener ugc nofollow" target="_blank">兹德内克·罗森塔尔</a>上<a class="ae kf" href="https://www.pexels.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">像素</a></p></figure><p id="d588" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">青蛇高居榜首！再次，它的置信度得分相当高。</p><p id="fa9b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里需要注意的一点是，由于该模型是在 ImageNet 上训练的，因此对于 1000 个类别之外的图像，它的性能可能没有那么好。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="3e3d" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">后续步骤</h1><p id="a3e9" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">创建 web 应用程序后，下一步自然是部署和托管它。例如，我通过 Heroku 部署了一个虹膜分类应用程序，你可以通过这个<a class="ae kf" href="https://github.com/terryz1/Iris_Classification" rel="noopener ugc nofollow" target="_blank"> Github 页面</a>查看。</p><p id="1e4d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，如果你对其他神经网络模型感兴趣(VGG，Densenet 等。)，你可以尝试上传不同的图像，然后比较它们的性能。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="8f64" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">摘要</h1><p id="cdc7" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">让我们快速回顾一下。</p><p id="c595" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们通过 Streamlit 构建了一个简单的 web 应用程序，在这个应用程序中，用户可以上传图像来查看模型的顶级预测以及置信度得分。我们还介绍了如何通过 PyTorch 构建预训练 ResNet 模型。</p><p id="70e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望你喜欢这篇博文，并请分享你的任何想法:)</p><p id="3be7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看看我的另一篇关于使用逻辑回归对 Yelp 评论进行情感分类的文章:</p><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/sentiment-classification-with-logistic-regression-analyzing-yelp-reviews-3981678c3b44"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">基于逻辑回归的情感分类 Yelp 评论分析</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">情感分析:特征提取、N-gram、过采样/欠采样、TF-IDF 等等…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op jz ob"/></div></div></a></div></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="7524" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">参考</h1><p id="2723" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">【1】<a class="ae kf" href="https://docs.streamlit.io/en/stable/" rel="noopener ugc nofollow" target="_blank">https://docs.streamlit.io/en/stable/</a><br/>【2】<a class="ae kf" href="https://www.hindawi.com/journals/cin/2018/2061516/" rel="noopener ugc nofollow" target="_blank">https://www.hindawi.com/journals/cin/2018/2061516/</a></p></div></div>    
</body>
</html>