<html>
<head>
<title>A Simple Way to Gather all Coronavirus Related Data with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 收集所有冠状病毒相关数据的简单方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/gather-all-the-coronavirus-data-with-python-19aa22167dea?source=collection_archive---------3-----------------------#2020-03-13">https://towardsdatascience.com/gather-all-the-coronavirus-data-with-python-19aa22167dea?source=collection_archive---------3-----------------------#2020-03-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5d27" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简单是关键。</h2></div><p id="1a22" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">*注:我最近出版了本教程的</em> <strong class="kk iu"> <em class="le"> R 版</em> </strong> <em class="le">，你可以在这里找到</em><a class="ae lf" rel="noopener" target="_blank" href="/a-simple-way-to-gather-all-coronavirus-related-data-with-r-b1e7ecb74346"><em class="le"/></a><em class="le">。</em></p><p id="2118" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">冠状病毒在全球的传播令人担忧。截至今日(2020 年 7 月 15 日)，冠状病毒  <strong class="kk iu">确诊病例<strong class="kk iu">超 1300 万。</strong></strong></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/12bdf747998d8d43eef657a9701e76d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3_xAp3uYR9c02gs3meC8A.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">约翰·霍普斯金地图</p></figure><h1 id="5824" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">目标</h1><p id="bd20" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">这篇文章的目的是<strong class="kk iu">获得研究所需的数据</strong>，并通过将所有相关数据收集到一个<strong class="kk iu">Pandas</strong>T30】数据框架中<strong class="kk iu">获得关于新冠肺炎的主动可见性</strong>。</p><h1 id="2e15" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">步伐</h1><ul class=""><li id="c72c" class="mt mu it kk b kl mo ko mp kr mv kv mw kz mx ld my mz na nb bi translated">步骤 1:设置技术<strong class="kk iu">先决条件</strong></li><li id="3dbd" class="mt mu it kk b kl nc ko nd kr ne kv nf kz ng ld my mz na nb bi translated">第二步:聚集<strong class="kk iu">新冠肺炎</strong>确诊病例</li><li id="eec3" class="mt mu it kk b kl nc ko nd kr ne kv nf kz ng ld my mz na nb bi translated">第三步:收集 COVID 的<strong class="kk iu">消息</strong></li><li id="8a3f" class="mt mu it kk b kl nc ko nd kr ne kv nf kz ng ld my mz na nb bi translated">第四步:收集<strong class="kk iu">财务</strong>和其他<strong class="kk iu">指标</strong></li><li id="5ff7" class="mt mu it kk b kl nc ko nd kr ne kv nf kz ng ld my mz na nb bi translated">第五步:<strong class="kk iu">将所有的数据混合在一起</strong></li></ul><h1 id="b5ed" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第一步。先决条件</h1><ul class=""><li id="bc39" class="mt mu it kk b kl mo ko mp kr mv kv mw kz mx ld my mz na nb bi translated">安装 Python 2.6+或 3.1+版本</li><li id="86a8" class="mt mu it kk b kl nc ko nd kr ne kv nf kz ng ld my mz na nb bi translated">安装 pandas，matplotlib，openblender 和 wordcloud(带 pip)</li></ul><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="b451" class="nm lx it ni b gy nn no l np nq">$ pip install pandas OpenBlender matplotlib wordcloud</span></pre><h1 id="7435" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第二步。收集新冠肺炎确诊病例</h1><p id="fb5d" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">CSSE 正在做惊人的工作<strong class="kk iu">上传每日数据</strong> <a class="ae lf" href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_daily_reports" rel="noopener ugc nofollow" target="_blank">这里</a>。然而，它非常杂乱<strong class="kk iu">并且在许多不同的数据集上</strong>，所以<strong class="kk iu">我将它分类并上传为一个单独的</strong> OpenBlender <a class="ae lf" href="https://www.openblender.io/#/dataset/explore/5e7a0d5d9516296cb86c6263/or/35" rel="noopener ugc nofollow" target="_blank">数据集</a>:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nr"><img src="../Images/ceecf10d40ad97d93944ce63ee462703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t2g-FUui-3rNhqQ82MBLZg.png"/></div></div></figure><p id="9e8b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们通过运行以下脚本将数据<strong class="kk iu">拉入熊猫数据帧</strong>:</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="f9e3" class="nm lx it ni b gy nn no l np nq">from matplotlib import pyplot as plt<br/>import OpenBlender<br/>import pandas as pd<br/>import json<br/>%matplotlib inline<br/></span><span id="3e19" class="nm lx it ni b gy ns no l np nq">action = 'API_getObservationsFromDataset'</span><span id="dcf5" class="nm lx it ni b gy ns no l np nq">parameters = { <br/> 'token':'<strong class="ni iu">YOUR_TOKEN_HERE</strong>',<br/> 'id_dataset':'5e7a0d5d9516296cb86c6263',<br/> 'date_filter':{<br/>               "start_date":"2020-01-01T06:00:00.000Z",<br/>               "end_date":"2020-03-11T06:00:00.000Z"},<br/> 'consumption_confirmation':'on',<br/> 'add_date' : 'date'<br/>}<br/><br/>df_confirmed = pd.read_json(json.dumps(OpenBlender.call(action, parameters)['sample']), convert_dates=False, convert_axes=False).sort_values('timestamp', ascending=False)<br/>df_confirmed.reset_index(drop=True, inplace=True)<br/>df_confirmed.head(10)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nt"><img src="../Images/fe5dc178f94d37f244f1347945b579fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3R9GdV6NI3FGMZ9Zh_MFXA.png"/></div></div></figure><ul class=""><li id="e547" class="mt mu it kk b kl km ko kp kr nu kv nv kz nw ld my mz na nb bi translated"><strong class="kk iu">注意</strong>:要获得令牌，您<em class="le">需要</em>在<a class="ae lf" href="https://www.openblender.io/#/welcome/or/35" rel="noopener ugc nofollow" target="_blank"> openblender.io </a>(免费)上创建一个帐户，您可以在您个人资料图标的“帐户”选项卡中找到它。</li></ul><p id="bce4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，现在我们有了按日期和地点汇总的确诊病例数、死亡人数和康复人数。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nx"><img src="../Images/f6bbbb6a9c7795afbbc6504c5e4996b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pdbwvPfsv6qeLiG_.png"/></div></div></figure><p id="af4d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里我们可以看到伊朗、意大利和韩国确诊病例的爆发。我们还可以看到西班牙、法国和德国开始<strong class="kk iu">崛起</strong>。</p><h1 id="37be" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第三步。收集新冠肺炎的消息</h1><p id="1223" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">我们将从这些来源收集<strong class="kk iu"> COVID 新闻</strong>和文本:<a class="ae lf" href="https://www.openblender.io/#/dataset/explore/5e2ef74e9516294390e810a9" rel="noopener ugc nofollow" target="_blank">华尔街日报</a>、<a class="ae lf" href="https://www.openblender.io/#/dataset/explore/5e1ded6b9516290a010e03ea" rel="noopener ugc nofollow" target="_blank"> CNN 新闻</a>、<a class="ae lf" href="https://www.openblender.io/#/dataset/explore/5d8852059516294231c596c0" rel="noopener ugc nofollow" target="_blank"> ABC 新闻</a>和<a class="ae lf" href="https://www.openblender.io/#/dataset/explore/5e32fd289516291e346c1726" rel="noopener ugc nofollow" target="_blank">今日美国推特</a>(你可以寻找其他来源)</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ny"><img src="../Images/563a8f785870e4c53fb6d2aa54cf1aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zYZo9zT0N0VtI8S0.png"/></div></div></figure><p id="fe0a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以让我们获取数据。</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="2883" class="nm lx it ni b gy nn no l np nq">action = 'API_getOpenTextData'</span><span id="0e91" class="nm lx it ni b gy ns no l np nq">parameters = {<br/>    'token':'<strong class="ni iu">YOUR_TOKEN_HERE</strong>',<br/>    'consumption_confirmation':'on',<br/>    'date_filter':{"start_date":"2020-01-01T06:00:00.000Z", <br/>                   "end_date":"2020-03-10T06:00:00.000Z"},<br/>    'sources':[<br/>                # Wall Street Journal<br/>               {'id_dataset' : '5e2ef74e9516294390e810a9', <br/>                 'features' : ['text']},<br/>                # ABC News Headlines<br/>               {'id_dataset':"5d8848e59516294231c59581", <br/>                'features' : ["headline", "title"]},<br/>                # USA Today Twitter<br/>               {'id_dataset' : "5e32fd289516291e346c1726", <br/>                'features' : ["text"]},<br/>                # CNN News<br/>               {'id_dataset' : "5d571b9e9516293a12ad4f5c", <br/>                'features' : ["headline", "title"]}<br/>    ],<br/>    'aggregate_in_time_interval' : {<br/>              'time_interval_size' : 60 * 60 * 24<br/>    },<br/>    'text_filter_search':['covid', 'coronavirus', 'ncov'],<br/>    'add_date' : 'date'    <br/>}<br/>df_news = pd.read_json(json.dumps(OpenBlender.call(action, parameters)['sample']), convert_dates=False, convert_axes=False).sort_values('timestamp', ascending=False)</span><span id="3a4c" class="nm lx it ni b gy ns no l np nq">df_news.reset_index(drop=True, inplace=True)</span></pre><p id="be5e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以上，<strong class="kk iu">我们指定了</strong>以下内容:</p><ul class=""><li id="3a9c" class="mt mu it kk b kl km ko kp kr nu kv nv kz nw ld my mz na nb bi translated">我们选择了 4 个来源来收集数据。具体来说，带有文本的功能列</li><li id="ff86" class="mt mu it kk b kl nc ko nd kr ne kv nf kz ng ld my mz na nb bi translated">我们指定要从 1 月 1 日到今天(3 月 10 日)的数据</li><li id="e1e8" class="mt mu it kk b kl nc ko nd kr ne kv nf kz ng ld my mz na nb bi translated">我们要求将新闻汇总成 24 小时小组或观察</li><li id="abda" class="mt mu it kk b kl nc ko nd kr ne kv nf kz ng ld my mz na nb bi translated">我们<strong class="kk iu">过滤了提及“冠状病毒”、“冠状病毒”或“ncov”的新闻</strong></li></ul><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="e042" class="nm lx it ni b gy nn no l np nq"># Let's take a look<br/>df_news.head(20)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nz"><img src="../Images/b906fca82cb43ad6a6cf0366d5459c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*r6ClacVLOG28Dz8N.png"/></div></div></figure><p id="27ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个观察都是按天对新闻的<strong class="kk iu">聚合，我们有<strong class="kk iu"> source </strong>和<strong class="kk iu"> source_lst </strong>，前者是所有新闻的串联，后者是该时段的新闻列表。</strong></p><p id="8ebf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">时间戳</strong>(返回为<a class="ae lf" href="https://www.epochconverter.com/" rel="noopener ugc nofollow" target="_blank"> unix 时间戳</a>)是指从前一个时间戳到当前时间戳(严格来说是之前)的间隔内发生的新闻:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi oa"><img src="../Images/ef98a48f3a3a0918407df31e2fab4b25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*98xbzdshiNlsnjtB.png"/></div></div></figure><p id="8aab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们来看看一些感兴趣的<em class="le">国家</em>的<strong class="kk iu">提及次数</strong>。</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="6b41" class="nm lx it ni b gy nn no l np nq">interest_countries = ['China', 'Iran', 'Korea', 'Italy', 'France', 'Germany', 'Spain']</span><span id="1357" class="nm lx it ni b gy ns no l np nq">for country in interest_countries:<br/>    df_news['count_news_' + country] = [len([text for text in daily_lst if country.lower() in text]) for daily_lst in df_news['source_lst']]</span><span id="282e" class="nm lx it ni b gy ns no l np nq">df_news.reindex(index=df_news.index[::-1]).plot(x = 'timestamp', y = [col for col in df_news.columns if 'count' in col], figsize=(17,7), kind='area')</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ob"><img src="../Images/f9994b4aed7fa68848887f4a848421af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RHagVzkChsA6ekHn.png"/></div></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/699cb77546831e20139b3fe3fa8f9e26.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*3J-jyEGSbM49Lrwb"/></div></figure><p id="1213" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们来看一个来自<strong class="kk iu">最近 20 天</strong>新闻的词云。* <em class="le">可选步骤(如果要安装 wordcloud </em>):</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="7c2e" class="nm lx it ni b gy nn no l np nq">from os import path<br/>from PIL import Image<br/>from wordcloud import WordCloud, STOPWORDS, ImageColorGenerator</span><span id="81dd" class="nm lx it ni b gy ns no l np nq">plt.figure()<br/>plt.imshow(WordCloud(max_font_size=50, max_words=80, background_color="white").generate(' '.join([val for val in df['source'][0: 20]])), interpolation="bilinear")<br/>plt.axis("off")<br/>plt.show()</span><span id="6383" class="nm lx it ni b gy ns no l np nq">plt.figure()<br/>plt.imshow(WordCloud(max_font_size=50, max_words=80, background_color="white").generate(' '.join([val for val in df['source'][0: 20]])), interpolation="bilinear")<br/>plt.axis("off")<br/>plt.show()</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi od"><img src="../Images/1600378263b31e204740a20f44cf5c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5YMPESvAE6rHtf8g.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">*上面的代码生成了图像的最后一个 wordcloud。</p></figure><p id="623c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">早期新闻中的关键词如“神秘”、“正在调查”、“几十个”<strong class="kk iu">与后期关键词</strong>如“中国”、“冠状病毒”、“全球”形成对比。<strong class="kk iu">更有</strong>最近的:“新型冠状病毒”、“冠状病毒流行”、“爆发”、“巡航”、“新型冠状病毒”等..</p><h1 id="edc2" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第四步。收集财务和其他指标</h1><p id="6a95" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">为此，我们可以从道琼斯数据集中分离出来，混合其他几个数据，比如<strong class="kk iu">汇率</strong>(日元、欧元、英镑)<strong class="kk iu">材料价格</strong>(原油、玉米、铂、锡)，或者<strong class="kk iu">股票</strong>(可口可乐、道琼斯)。</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="2f88" class="nm lx it ni b gy nn no l np nq">action = 'API_getObservationsFromDataset'<br/>        <br/>parameters = {<br/> 'token':'<strong class="ni iu">YOUR_TOKEN_HERE</strong>',<br/> 'id_dataset':'5d4c14cd9516290b01c7d673',</span><span id="b337" class="nm lx it ni b gy ns no l np nq"> 'aggregate_in_time_interval':{"output":"avg","empty_intervals":"impute","time_interval_size":86400},</span><span id="6158" class="nm lx it ni b gy ns no l np nq"> 'blends':[<br/>        #Yen vs USD              <br/>{"id_blend":"5d2495169516290b5fd2cee3","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="3766" class="nm lx it ni b gy ns no l np nq">        # Euro Vs USD<br/>{"id_blend":"5d4b3af1951629707cc1116b","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="1dfb" class="nm lx it ni b gy ns no l np nq">        # Pound Vs USD              <br/>{"id_blend":"5d4b3be1951629707cc11341","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="9e88" class="nm lx it ni b gy ns no l np nq">        # Corn Price    <br/>{"id_blend":"5d4c23b39516290b01c7feea","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="8de9" class="nm lx it ni b gy ns no l np nq">        # CocaCola Price     <br/>{"id_blend":"5d4c72399516290b02fe7359","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="e0e5" class="nm lx it ni b gy ns no l np nq">        # Platinum price             <br/>{"id_blend":"5d4ca1049516290b02fee837","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="da9d" class="nm lx it ni b gy ns no l np nq">        # Tin Price<br/>{"id_blend":"5d4caa429516290b01c9dff0","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="7b25" class="nm lx it ni b gy ns no l np nq">        # Crude Oil Price<br/>{"id_blend":"5d4c80bf9516290b01c8f6f9","restriction":"None","blend_type":"ts","drop_features":[]}],</span><span id="0d06" class="nm lx it ni b gy ns no l np nq">'date_filter':{"start_date":"2020-01-01T06:00:00.000Z","end_date":"2020-03-10T06:00:00.000Z"},<br/>'consumption_confirmation':'on' <br/>}</span><span id="cca8" class="nm lx it ni b gy ns no l np nq">df = pd.read_json(json.dumps(OpenBlender.call(action, parameters)['sample']), convert_dates=False, convert_axes=False).sort_values('timestamp', ascending=False)<br/>df.reset_index(drop=True, inplace=True)</span><span id="a5b3" class="nm lx it ni b gy ns no l np nq">print(df.shape)<br/>df.head()</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi oe"><img src="../Images/ea2a31936d6f32ddbd4961657a68c63a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cDLr6DCpBWovjMR-UaNBGA.png"/></div></div></figure><p id="f581" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以现在我们有了一个单独的数据集,其中包含每日观察到的价格随时间的变化。如果我们想要比较它们，我们最好将它们归一化到 0 到 1 之间，这样我们就可以更好地欣赏这些模式:</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="3d49" class="nm lx it ni b gy nn no l np nq"># Lets compress all into the (0, 1) domain<br/>df_compress = df.dropna(0).select_dtypes(include=['int16', 'int32', 'int64', 'float16', 'float32', 'float64']).apply(lambda x: (x - x.min()) / (x.max() - x.min()))<br/>df_compress['timestamp'] = df['timestamp']</span><span id="5903" class="nm lx it ni b gy ns no l np nq"># Now we select the columns that interest us<br/>cols_of_interest = ['timestamp', 'PLATINUM_PRICE_price', 'CRUDE_OIL_PRICE_price', 'COCACOLA_PRICE_price', 'open', 'CORN_PRICE_price', 'TIN_PRICE_price', 'PLATINUM_PRICE_price']<br/>df_compress = df_compress[cols_of_interest]<br/>df_compress.rename(columns={'open':'DOW_JONES_price'}, inplace=True)</span><span id="7fe4" class="nm lx it ni b gy ns no l np nq"># An now let's plot them<br/>from matplotlib import pyplot as plt<br/>fig, ax = plt.subplots(figsize=(17,7))<br/>plt = df_compress.plot(x='timestamp', y =['PLATINUM_PRICE_price', 'CRUDE_OIL_PRICE_price', 'COCACOLA_PRICE_price', 'DOW_JONES_price', 'CORN_PRICE_price', 'TIN_PRICE_price', 'PLATINUM_PRICE_price'], ax=ax)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi of"><img src="../Images/18baac948fd59a51b8a5b73f06a2caac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oTzJVZt4m-i1I5mvo3IaAw.png"/></div></div></figure><p id="6923" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有趣的是，几乎所有的<strong class="kk iu"/>(除了锡价)都遵循<strong class="kk iu">相似的模式</strong>。</p><h1 id="7119" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第五步。将所有数据混合在一起</h1><p id="8e10" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">现在，我们将把<strong class="kk iu">新冠肺炎确诊病例</strong>、<strong class="kk iu">冠状病毒新闻</strong>和<strong class="kk iu">经济指标</strong>数据排列成按照时间混合的<strong class="kk iu">单一数据集</strong>。</p><p id="4198" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了混合数据，让我们将创建的数据集上传到 OpenBlender:</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="5fcb" class="nm lx it ni b gy nn no l np nq"># First the News Dataset</span><span id="0a52" class="nm lx it ni b gy ns no l np nq">action = 'API_createDataset'</span><span id="a5a1" class="nm lx it ni b gy ns no l np nq">parameters = { <br/> 'token':'<strong class="ni iu">YOUR_TOKEN_HERE</strong>',<br/> 'name':'Coronavirus News',<br/> 'description':'YOUR_DATASET_DESCRIPTION',<br/> 'visibility':'private',<br/> 'tags':[],<br/> 'insert_observations':'on',<br/>    'select_as_timestamp' : 'timestamp',<br/> 'dataframe':df_news.to_json() <br/>}<br/>        <br/>OpenBlender.call(action, parameters)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi og"><img src="../Images/0b781b003fa62050db5d9d45d0206199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SG88vgqmc-J6-t3K4QnTnQ.png"/></div></div></figure><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="1015" class="nm lx it ni b gy nn no l np nq"># And now the Financial Indicators</span><span id="6883" class="nm lx it ni b gy ns no l np nq">action = 'API_createDataset'</span><span id="604f" class="nm lx it ni b gy ns no l np nq">parameters = { <br/> 'token':'<strong class="ni iu">YOUR_TOKEN_HERE</strong>',<br/> 'name':'Financial Indicators for COVID',<br/> 'description':'YOUR_DATASET_DESCRIPTION',<br/> 'visibility':'private',<br/> 'tags':[],<br/> 'insert_observations':'on',<br/> 'select_as_timestamp' : 'timestamp',<br/> 'dataframe':df_compress.to_json() <br/>}<br/>        <br/>OpenBlender.call(action, parameters)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi oh"><img src="../Images/136ad745105ed318927abd07f9731b3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZVXoQxZ_dNkbfTepkhrqcQ.png"/></div></div></figure><p id="8a98" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">*注意:您将希望在下面使用每个数据集的“id_dataset”。</em></p><p id="1612" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们只需提取初始新冠肺炎数据集，并通过将来自我们创建的数据集<strong class="kk iu">的“id _ dataset”s</strong>放置在“id _ blend”字段上，来混合我们创建的新数据集。</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="a47c" class="nm lx it ni b gy nn no l np nq">action = 'API_getObservationsFromDataset'</span><span id="524e" class="nm lx it ni b gy ns no l np nq"># ANCHOR: 'COVID19 Confirmed Cases'<br/># BLENDS: 'Coronavirus News', 'Financial Indicators for COVID'<br/>        <br/>parameters = { <br/> 'token':'<strong class="ni iu">YOUR_TOKEN_HERE</strong>',<br/> 'id_dataset':'5e7a0d5d9516296cb86c6263',<br/> 'date_filter':{<br/>               "start_date":"2020-01-01T06:00:00.000Z",<br/>               "end_date":"2020-03-11T06:00:00.000Z"} ,</span><span id="1310" class="nm lx it ni b gy ns no l np nq">'filter_select' : {'feature' : 'country_region', 'categories' : ['Italy']},</span><span id="090c" class="nm lx it ni b gy ns no l np nq">'aggregate_in_time_interval':{"output":"avg","empty_intervals":"impute","time_interval_size":86400},</span><span id="2e84" class="nm lx it ni b gy ns no l np nq"> 'blends':[{"id_blend":"<strong class="ni iu">YOUR_CORONA_NEWS_ID</strong>","restriction":"None","blend_type":"ts","drop_features":[]},<br/>            {"id_blend":"<strong class="ni iu">YOUR_FINANCIAL_INDICATORS_ID</strong>","restriction":"None","blend_type":"ts","drop_features":[]}] <br/>}</span><span id="ba2a" class="nm lx it ni b gy ns no l np nq">df = pd.read_json(json.dumps(OpenBlender.call(action, parameters)['sample']), convert_dates=False, convert_axes=False).sort_values('timestamp', ascending=False)<br/>df.reset_index(drop=True, inplace=True)</span></pre><p id="01eb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面我们<strong class="kk iu">选择了“意大利”</strong>、<strong class="kk iu">的观测值，按天</strong>以秒为单位(8640)进行聚合，<strong class="kk iu">混合了新数据</strong>。</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="01ab" class="nm lx it ni b gy nn no l np nq">df.head()</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi oi"><img src="../Images/33ed94d09564bc7a8bf74b59cd26f7e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cOHStEBs8c7I8pS6H1GB-A.png"/></div></div></figure><p id="3883" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们有了一个数据集，它包含了所有数据按时间混合的<strong class="kk iu">日常信息！</strong></p><p id="7cf7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这有很大的发展空间。</p><p id="b27c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请发布进一步的发现。</p></div></div>    
</body>
</html>