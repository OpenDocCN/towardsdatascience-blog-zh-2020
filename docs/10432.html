<html>
<head>
<title>Modern CI/CD Pipeline: Github Actions with AWS Lambda Serverless Python Functions and API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代 CI/CD 管道:带有 AWS Lambda 无服务器 Python 函数和 API 网关的 Github 动作</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/modern-ci-cd-pipeline-git-actions-with-aws-lambda-serverless-python-functions-and-api-gateway-9ef20b3ef64a?source=collection_archive---------9-----------------------#2020-07-22">https://towardsdatascience.com/modern-ci-cd-pipeline-git-actions-with-aws-lambda-serverless-python-functions-and-api-gateway-9ef20b3ef64a?source=collection_archive---------9-----------------------#2020-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8875" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使 web 应用程序开发和部署现代化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6d53057b5aaef1109006d0a6a6dbcf6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ozv2ZdmGQgahL8ZM"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@morningbrew?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">晨酿</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="750a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">云已经存在，越来越多的开发人员正在寻找有效整合云的方法。无论您是一家认识到本地硬件和本地机器局限性的初创企业，还是一家对如何缓慢卸载本地工作负载感到好奇的大型企业，本教程都很有见地。我描述了第 1 阶段的 AWS 架构，包括 Github、API Gateway 和 AWS Lamba python 函数。这是向开发人员展示 AWS 云采用学习曲线的初始教程。</p><h1 id="d353" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">大纲:</h1><ol class=""><li id="e079" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu mu mv mw mx bi translated">概念建筑</li><li id="77d4" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">目的和目标</li><li id="1b25" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">如何设置</li><li id="0245" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">自动气象站 Lambda 的局限性和问题</li><li id="8c87" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">想法和结论</li></ol><h2 id="2b11" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">概念架构:</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/3c9dc0dd58c7bad046811f9381c2a37b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1C1gBpPhHpaK0w1XM5a4ug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">架构图</p></figure><p id="0791" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的架构描述了使用 AWS Lambda 部署 python 函数的基本 CI/CD 管道。上面提到的开发人员可以使用 git 将他们的 git 存储库拉入和推送至 github。我们配置了 github actions YAML 文件，一旦一个拉请求被合并到主分支，它就会自动更新 AWS Lambda 函数。API 网关代表一个触发器，它运行 AWS Lambda python 函数并返回结果。通过这种方式，数据科学家(或分析师、前端开发人员或其他开发人员)可以快速简洁地触发和访问结果。</p><blockquote class="nq nr ns"><p id="e8f2" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">N <!-- -->注意:AWS Lambda 函数存在于开发人员无法访问的计算资源 AWS Lambda 中。</p></blockquote><h2 id="b258" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">目的和目标</h2><p id="b719" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">这个架构代表了团队为应用程序开发和部署构建健壮的 CI/CD 管道的有效方式。尽管这种架构相对于成熟的 web 应用程序来说是“不完整的”，但这种设计可以代表构建 web 应用程序的第一阶段。对于任何对卸载本地计算资源感兴趣的人来说，AWS Lambda 无服务器功能是以经济高效的方式利用云的有效方式(AWS Lambda 功能是 AWS always free 层的一部分)。很多时候，开发团队为应用程序部署(或迁移)设计了一个崇高的基于云的架构，却失败了。进行概念验证并慢慢引入云是更谨慎的做法。</p><h2 id="1fc8" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">如何设置</h2><p id="e2fa" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">主要挑战是理解 YAML 文件并正确格式化在 AWS Lambda 中执行的“main.py”文件。要设置一个新的工作流，开发人员可以在其中为功能部署配置 YAML 文件，请在 github 存储库中单击“actions”。这将提供创建新工作流或从与部署架构一致的现有工作流中进行选择的说明。我创建了一个默认的工作流，然后搜索其他工作流来找到一个部署到 AWS Lambda 的模板(但是可能有一种更简单的方法来利用 AWS Lambda 的预配置工作流)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><blockquote class="nq nr ns"><p id="1885" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">注意:第 57 行实际上是将 github repo 压缩到一个名为“test-dep-dev”的 zip 文件中。理想情况下，要组织一个 Lambda 函数部署，我建议在 repo 中创建一个文件夹，并压缩该文件夹以进行部署。例如，您可以创建一个名为“Lambda _ Function _ Scrapping _ Data”的文件夹，其中包含部署您的函数所需的所有依赖项。第 57 行将类似于“zip -r test-dep-dev.zip。/Lambda _ functions _ screwing _ Data "</p></blockquote><p id="205d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您配置了 YAML 文件，请检查 AWS Lambda 函数页面，查看该函数是否已经更新。为了排除故障，<a class="ae ky" href="https://docs.aws.amazon.com/lambda/latest/dg/getting-started-create-function.html" rel="noopener ugc nofollow" target="_blank">在 AWS Lambda 函数中创建一个测试用例</a>。我首先面临的问题是 python 返回值的语法不正确(<a class="ae ky" href="https://aws.amazon.com/premiumsupport/knowledge-center/malformed-502-api-gateway/" rel="noopener ugc nofollow" target="_blank">这里有一些文档可能对</a>有帮助)。下面是一个 AWS Lambda Python 函数的简单示例。响应格式是最重要的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><blockquote class="nq nr ns"><p id="8f99" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">注意:在 AWS Lambda 函数中，处理程序被定义为 file_name.function_name。例如，如果文件名为 main.py，函数为 my_serverless_function，则句柄应定义为 main.my_serverless_function。</p></blockquote><p id="fa43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不是重新创建轮子，而是演示如何为 AWS Lambda 函数创建 API 网关的精彩视频:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc ob l"/></div></figure><h2 id="2531" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">AWS Lambda 的局限性和问题以及可能的替代方案</h2><p id="4acd" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">在决定使用 AWS Lambda 之前，考虑其局限性是很重要的。AWS Lambda 函数将在 15 分钟后超时，这已经足够了，但是对于更复杂的企业级工作负载，这可能还不够。更重要的是，你打包的函数被限制为 250mb 解压缩和 50mb 压缩，这包括包的大小、编码的函数和其他依赖项。这些只是特别适用于我正在处理的用例的一些限制。你可以在这里找到其他限制<a class="ae ky" href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="9927" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">鉴于 AWS Lambda 本质上是一个运行容器化功能的共享计算实例，为了更加灵活，您可以提供一个 EC2 实例。显然，这导致了更高的成本。如果您担心高可用性，我不确定 SLA 为 AWS Lambda 提供了什么，但通常情况下，AWS 计算实例用户应该假设 90%的可用性。</p><h2 id="61ba" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">结论</h2><p id="0736" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">对 AWS Lambda 和无服务器函数有一点学习曲线，但是考虑到它们在大多数现代 web 应用程序开发中的普遍适用性，我认为这是值得的时间投资。如果你正在做一个项目，并且想要结合一些云，从过程和成本的角度来看，AWS Lambda 是相当值得的。最终用户可以轻松地调用端点并检索数据。似乎有大量的文档和教程可以解决几乎所有的用例。总体来说，我会推荐 AWS Lambda。为了提高计算实例的灵活性，我推荐 Oracle 云计算实例。它们是免费的(不到 1 OCPU)，但是文档可能很难找到和理解。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://www.buymeacoffee.com/arshyasharifian"><div class="gh gi od"><img src="../Images/9feb2f59889762b163b5adb2600d8f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e7fPIkcYCVESpBrkCPdEuQ.png"/></div></a></figure><h2 id="5fee" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">子堆栈:</h2><p id="b9b4" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">我最近创建了一个<a class="ae ky" href="https://arysharifian.substack.com/" rel="noopener ugc nofollow" target="_blank">子栈</a>来学习如何用 Python 编程和解决 LeetCode 问题。</p></div></div>    
</body>
</html>