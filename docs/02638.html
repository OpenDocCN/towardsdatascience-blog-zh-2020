<html>
<head>
<title>Visualize COVID-19 case data in a blink of an eye — using R, Shiny &amp; Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 R，Shiny &amp; Plotly，一眨眼的功夫就能看到新冠肺炎案例数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-a-coronavirus-app-using-r-shiny-and-plotly-6a6abf66091d?source=collection_archive---------3-----------------------#2020-03-14">https://towardsdatascience.com/create-a-coronavirus-app-using-r-shiny-and-plotly-6a6abf66091d?source=collection_archive---------3-----------------------#2020-03-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9c6f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建并发布一个 web 应用程序来可视化冠状病毒的数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/93af426da9eb5d570e43ddbf5ad7ecae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z1VFvqfNm-Sg96ZloGK1Ow.png"/></div></div></figure><p id="c57c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">自冠状病毒新冠肺炎成为疫情以来，世界上至少有一半人在关注这一病例统计数据。我也是。作为一名数据科学家，我很好奇，所以我访问了案例统计数据并创建了一些可视化。通过这篇报道，我将告诉你如何自己做同样的事情。没有魔法！</p><blockquote class="lq lr ls"><p id="8c85" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated">测试一下:【https://go.aws/3aoYsIW T2】</p></blockquote><p id="a3e8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本演练解释如何创建 web 应用程序和交互式绘图。基于<strong class="kw iu"> R &amp; Shiny </strong>的<strong class="kw iu">开源技术</strong>栈非常单薄。大约 120 行代码就足够了。</p><p id="e62e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">代码也可以从 GitHub </strong>下载。链接可以在本文的底部找到。</p><h2 id="c53b" class="ly lz it bd ma mb mc dn md me mf dp mg ld mh mi mj lh mk ml mm ll mn mo mp mq bi translated">目标</h2><p id="fe17" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">本文的目标是能够创建一个运行 web 应用程序的<strong class="kw iu">，它每 30 分钟更新一次数据，并在仪表板上显示这些数据。该应用程序的特点是:</strong></p><ul class=""><li id="62d0" class="mw mx it kw b kx ky la lb ld my lh mz ll na lp nb nc nd ne bi translated">冠状病毒官方可用数据的下载和解析。</li><li id="5d15" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">下拉菜单选择国家和州。</li><li id="a7c7" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">显示所选国家新的和累积的病例统计数据的两个图。可以显示确诊病例、痊愈病例和死亡病例。</li></ul><h2 id="8b7e" class="ly lz it bd ma mb mc dn md me mf dp mg ld mh mi mj lh mk ml mm ll mn mo mp mq bi translated">任务</h2><ol class=""><li id="b325" class="mw mx it kw b kx mr la ms ld nk lh nl ll nm lp nn nc nd ne bi translated">设置 R &amp; RStudio。</li><li id="0a9f" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nn nc nd ne bi translated">设置 R 项目及其文件夹结构。</li><li id="5f4e" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nn nc nd ne bi translated">使用 Shiny 创建用户界面。</li><li id="fcc1" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nn nc nd ne bi translated">添加加载和预处理数据的逻辑。</li><li id="01c3" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nn nc nd ne bi translated">添加服务器逻辑。</li><li id="5b10" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nn nc nd ne bi translated">[可选]将应用程序上传到云。</li></ol></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h1 id="5225" class="nv lz it bd ma nw nx ny md nz oa ob mg jz oc ka mj kc od kd mm kf oe kg mp of bi translated">设置 R &amp; RStudio</h1><p id="698d" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">首先从<a class="ae lx" href="https://rstudio.com/products/rstudio/download/#download" rel="noopener ugc nofollow" target="_blank">https://rstudio.com/products/rstudio/download/#download</a>下载<strong class="kw iu"> R </strong>的<strong class="kw iu"> base </strong>版本，启动安装程序并通过。</p><p id="e63d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，从<a class="ae lx" href="https://rstudio.com/products/rstudio/download/#download" rel="noopener ugc nofollow" target="_blank">https://rstudio.com/products/rstudio/download/#download</a>下载<strong class="kw iu"> RStudio 桌面</strong>的<strong class="kw iu">免费</strong>版本。再次启动安装程序并完成步骤。</p><p id="b9dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在安装我们需要的包。启动 RStudio 应用程序并进入控制台(通常位于左下方的窗口)。通过键入以下命令安装软件包:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="4480" class="ly lz it oh b gy ol om l on oo">&gt; install.packages("shiny")<br/>&gt; install.packages("dplyr")<br/>&gt; install.packages("tidyr")<br/>&gt; install.packages("plotly")</span></pre><h1 id="3714" class="nv lz it bd ma nw op ny md nz oq ob mg jz or ka mj kc os kd mm kf ot kg mp of bi translated">设置 R 项目及其文件夹结构</h1><p id="4320" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">在 RStudio 中，单击右上方的下拉菜单“项目:(无)”，然后选择“新建项目…”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/5638947ec6247a8503c0199c0ce37900.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*kJjD1uNlOKu9TeSesFF-Kg.png"/></div></figure><p id="49e7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">点击“新目录”，然后点击“闪亮的网络应用”。现在为您的项目选择一个任意的新目录名，例如“<em class="lt"> corona-app </em>”。此外，选择您希望应用程序所在的子目录。点击“创建项目”按钮，创建包含 2 个文件的文件夹:</p><ul class=""><li id="e49c" class="mw mx it kw b kx ky la lb ld my lh mz ll na lp nb nc nd ne bi translated">项目文件:<em class="lt"> corona-app。Rproj </em>(可能有另一个名字)</li><li id="69d9" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">一个我们不需要的 app 模板文件:<em class="lt"> app。R </em></li></ul><h1 id="b34f" class="nv lz it bd ma nw op ny md nz oq ob mg jz or ka mj kc os kd mm kf ot kg mp of bi translated">使用 Shiny 创建用户界面</h1><p id="2d63" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">闪亮的框架允许 R 用户用最少的编码工作创建反应式 web 应用程序。小 app 只需要 2 个文件:<em class="lt"> ui。R </em>为用户界面布局，而<em class="lt">为服务器。R </em>用于服务器和渲染逻辑。</p><p id="effe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">转到<em class="lt"> RStudio </em>。在用户界面的左上方，有一个创建新文件的加号按钮。点击它，并选择“R 脚本”。创建一个文件，并将其命名为"<em class="lt"> ui。R </em>"通过保存它，并开始编辑。</p><p id="e2d5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先加载我们需要的包:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="4bd0" class="ly lz it oh b gy ol om l on oo">library(shiny)<br/>library(plotly)</span></pre><p id="e88e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，使用 bootstrap 方案建立一个空白页面(每行 12 列)，并使用元素<em class="lt"> titlePanel </em>创建标题:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="3dff" class="ly lz it oh b gy ol om l on oo">shinyUI(fluidPage(<br/>  titlePanel("Case History of the Coronavirus (COVID-19)"),<br/>))</span></pre><p id="05fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">总之，屏幕被分成不同的行(<em class="lt">fluid row</em>s)。带控件的<em class="lt">流体行</em>由三个宽度为 4 的<em class="lt">列</em>组成，加起来又是 12。地块占据整个宽度(12):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/8725eb538f0de4113502354d29ac56d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jB2Bv1GJwAAyh1ovhidy0A.jpeg"/></div></div></figure><p id="500e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在添加控件的代码。在定义<em class="lt">标题面板</em>的行之后立即插入以下代码(在两个右括号之前！):</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="0070" class="ly lz it oh b gy ol om l on oo">  fluidRow(<br/>    column(<br/>      width=4, <br/>      selectizeInput(<br/>        "country", label=h5("Country"), choices=NULL, width="100%")<br/>    ),<br/>    column(<br/>      width=4, <br/>      selectizeInput(<br/>        "state", label=h5("State"), choices=NULL, width="100%")<br/>    ),<br/>    column(<br/>      width=4, <br/>      checkboxGroupInput(<br/>        "metrics", label=h5("Selected Metrics"), <br/>        choices=c("Confirmed", "Deaths", "Recovered"), <br/>        selected=c("Confirmed", "Deaths", "Recovered"), <br/>        width="100%")<br/>    )<br/>  ), </span></pre><p id="f6e7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，有一个<em class="lt">流体行</em>有 3 个<em class="lt">列</em>元素，每个元素的宽度为 4。前两列包含下拉菜单元素(<em class="lt"> selectizeInput </em>)，让用户选择国家和州。</p><p id="c70f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第三列包含一组复选框元素(<em class="lt"> checkboxGroupInput </em>)。这允许用户选择在两个图中显示哪些指标。</p><p id="0b2b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于这两个图，我们使用<em class="lt"> R </em>包<em class="lt"> plotly </em> ( <a class="ae lx" href="https://plot.ly/r/" rel="noopener ugc nofollow" target="_blank">文档</a>)。以下代码行在接下来的两个<em class="lt">流体行</em>中各添加一个<em class="lt"> plotly </em>样式的绘图:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="3242" class="ly lz it oh b gy ol om l on oo">  fluidRow(<br/>    plotlyOutput("dailyMetrics")<br/>  ),<br/>  fluidRow(<br/>    plotlyOutput("cumulatedMetrics")<br/>  )</span></pre><h1 id="9a2a" class="nv lz it bd ma nw op ny md nz oq ob mg jz or ka mj kc os kd mm kf ot kg mp of bi translated">添加加载和预处理数据的逻辑</h1><p id="2410" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">该应用程序需要一些逻辑来下载和解析数据。这发生在服务器上。再次创建一个新文件，并将其命名为"<em class="lt"> server。R </em>并添加这些行来加载各自的<em class="lt"> R </em>包:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="9402" class="ly lz it oh b gy ol om l on oo">library(dplyr)<br/>library(tidyr)</span></pre><p id="3444" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后定义一个<em class="lt"> baseURL </em>，我们从其中按国家和地区下载冠状病毒的病例数据。<strong class="kw iu">数据</strong>位于<strong class="kw iu">约翰霍普金斯系统科学与工程中心(JHU/CSSE) </strong>的服务器上。此外，定义一个稍后使用的字体(<em class="lt"> f1 </em>)，加上一个测量文件有多长时间的速记函数(以避免过多的重新加载):</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="a4a0" class="ly lz it oh b gy ol om l on oo">baseURL = "<a class="ae lx" href="https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series</a>"</span><span id="4e9f" class="ly lz it oh b gy ow om l on oo">f1 = list(family="Courier New, monospace", size=12, <br/>       color="rgb(30,30,30)")</span><span id="de43" class="ly lz it oh b gy ow om l on oo">minutesSinceLastUpdate = function(fileName) {<br/>  (as.numeric(as.POSIXlt(Sys.time())) -  <br/>   as.numeric(file.info(fileName)$ctime)) / 60<br/>}</span></pre><p id="3d87" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，定义主函数来加载特定数据集(例如，按日期和国家列出的确诊病例数)。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="049b" class="ly lz it oh b gy ol om l on oo">loadData = function(fileName, columnName) {<br/>  if(!file.exists(fileName) || <br/>     minutesSinceLastUpdate(fileName) &gt; 10) {<br/>    data = read.csv(file.path(baseURL, fileName), <br/>      check.names=FALSE, stringsAsFactors=FALSE) %&gt;%<br/>      select(-Lat, -Long) %&gt;% <br/>      pivot_longer(-(1:2), names_to="date", values_to=columnName)%&gt;%<br/>      mutate(<br/>        date=as.Date(date, format="%m/%d/%y"),<br/>        `Province/State`=<br/>          if_else(`Province/State` == "", "&lt;all&gt;", `Province/State`)<br/>      )<br/>    save(data, file=fileName)  <br/>  } else {<br/>    load(file=fileName)<br/>  }<br/>  return(data)<br/>}</span></pre><p id="63eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该函数首先检查数据是否已经可用，并且不超过 10 分钟。如果不是这样，<em class="lt"> read.csv </em>从网络上下载文件。地理坐标被省略，然后<em class="lt"> pivot_longer </em>(来自包<em class="lt"> tidyr </em>)将<em class="lt"> data.frame </em>从宽格式转换为长格式。方法<em class="lt"> mutate </em>解析日期并插入文本<em class="lt"> &lt; all &gt; </em>如果没有可用的地区(适用于美国、加拿大、中国和澳大利亚以外的国家)。</p><p id="9e74" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下一个块在应用程序启动时立即被调用。如上所述，它从 web 或缓存加载数据:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="1172" class="ly lz it oh b gy ol om l on oo">allData = <br/>  loadData(<br/>    "time_series_covid19_confirmed_global.csv", "CumConfirmed") %&gt;%<br/>  inner_join(loadData(<br/>    "time_series_covid19_deaths_global.csv", "CumDeaths")) %&gt;%<br/>  inner_join(loadData(<br/>    "time_series_covid19_recovered_global.csv","CumRecovered"))</span></pre><p id="c4a7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">代码块加载确诊病例、恢复病例和死亡病例，并连接这 3 个数据集以获得一个大数据集。</p><p id="4a9d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">更新[2020-3-27]:文件名已更改，以反映约翰霍普金斯大学的新数据结构(见<a class="ae lx" href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series" rel="noopener ugc nofollow" target="_blank">链接</a>)。</p><h1 id="ba6b" class="nv lz it bd ma nw op ny md nz oq ob mg jz or ka mj kc os kd mm kf ot kg mp of bi translated">添加服务器逻辑</h1><p id="2810" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">最后一节介绍了服务器上的静态代码。现在开始主要部分，即反应式服务器代码。本节中添加的所有代码都位于<em class="lt">服务器</em>函数的括号内:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="6576" class="ly lz it oh b gy ol om l on oo">server = function(input, output, session) {<br/>  ## ...<br/>}</span></pre><h2 id="a454" class="ly lz it bd ma mb mc dn md me mf dp mg ld mh mi mj lh mk ml mm ll mn mo mp mq bi translated">数据</h2><p id="f3ca" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">首先让我们添加一个<a class="ae lx" href="https://shiny.rstudio.com/articles/reactivity-overview.html" rel="noopener ugc nofollow" target="_blank">反应函数</a>，它返回全部数据的一个子集，即只返回一个指定的国家和地区。每当用户更改选择时，都会调用该函数并更新过滤器:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="ed0b" class="ly lz it oh b gy ol om l on oo">  data = reactive({<br/>    d = allData %&gt;%<br/>      filter(`Country/Region` == input$country)<br/>    if(input$state != "&lt;all&gt;") {<br/>      d = d %&gt;% <br/>        filter(`Province/State` == input$state) <br/>    } else {<br/>      d = d %&gt;% <br/>        group_by(date) %&gt;% <br/>        summarise_if(is.numeric, sum, na.rm=TRUE)<br/>    }<br/>    d %&gt;%<br/>      mutate(<br/>        dateStr = format(date, format="%b %d, %Y"),<br/>        NewConfirmed=CumConfirmed - lag(CumConfirmed, default=0),<br/>        NewRecovered=CumRecovered - lag(CumRecovered, default=0),<br/>        NewDeaths=CumDeaths - lag(CumDeaths, default=0)<br/>      )<br/>  })</span></pre><p id="6d36" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，如果用户为有州的国家(如美国)选择<em class="lt"> &lt;【所有&gt; </em>，则该函数会汇总数据(使用<em class="lt">summary _ if</em>)。此外，根据累积的统计数据，计算差异并保存到新列中，以“<em class="lt">New”</em>为前缀。</p><h2 id="c0d4" class="ly lz it bd ma mb mc dn md me mf dp mg ld mh mi mj lh mk ml mm ll mn mo mp mq bi translated">下拉菜单</h2><p id="3246" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">接下来，服务器观察国家选择的变化。如果发生这种情况，服务器必须更新可选状态。另外，<em class="lt">&lt;&gt;</em>全部作为选项添加到状态下拉菜单中:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="d1b9" class="ly lz it oh b gy ol om l on oo">  observeEvent(input$country, {<br/>    states = allData %&gt;%<br/>      filter(`Country/Region` == input$country) %&gt;% <br/>      pull(`Province/State`)<br/>    states = c("&lt;all&gt;", sort(unique(states)))<br/>    updateSelectInput(session, "state", choices=states, <br/>      selected=states[1])<br/>  })</span></pre><p id="bbf6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来的两行没有反应。相反，它们在应用程序启动时被调用。第一行按字典顺序提取所有国家。另一行在下拉菜单中选择意大利(<em class="lt"> selectizeInput </em>):</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="17c0" class="ly lz it oh b gy ol om l on oo">  countries = sort(unique(allData$`Country/Region`))<br/>  <br/>  updateSelectInput(session, "country", choices=countries, <br/>    selected="Italy")</span></pre><h2 id="7dd6" class="ly lz it bd ma mb mc dn md me mf dp mg ld mh mi mj lh mk ml mm ll mn mo mp mq bi translated">情节</h2><p id="a082" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">对于情节，我们使用了 R 包<em class="lt"/>的<a class="ae lx" href="https://plot.ly/r/bar-charts/" rel="noopener ugc nofollow" target="_blank">条形图。以下代码定义了用于两个图(新的和累积的情况)的函数。该函数的第一部分定义了条形图的基础(样式、轴、图例)。第二部分遍历选定的指标(如恢复的指标等)并添加条形。使用<em class="lt">var prefix</em>(“<em class="lt">New</em>”或“<em class="lt"> Cum </em>”)和<em class="lt"> metric </em>)的列名的组成有点复杂。</a></p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="7fd6" class="ly lz it oh b gy ol om l on oo">      <br/>  renderBarPlot = function(varPrefix, legendPrefix, yaxisTitle) {<br/>    renderPlotly({<br/>      data = data()<br/>      plt = data %&gt;% <br/>        plot_ly() %&gt;%<br/>        config(displayModeBar=FALSE) %&gt;%<br/>        layout(<br/>          barmode='group', <br/>          xaxis=list(<br/>            title="", tickangle=-90, type='category', <br/>            ticktext=as.list(data$dateStr), <br/>            tickvals=as.list(data$date)), <br/>          yaxis=list(title=yaxisTitle),<br/>          legend=list(x=0.1, y=0.9,bgcolor='rgba(240,240,240,0.5)'),<br/>          font=f1<br/>        )<br/>      for(metric in input$metrics) <br/>        plt = plt %&gt;%<br/>          add_trace(<br/>            x=~date, y=data[[paste0(varPrefix, metric)]],type='bar', <br/>            name=paste(legendPrefix, metric, "Cases"),<br/>            marker=list(<br/>              color=switch(metric, <br/>                Deaths='rgb(200,30,30)', <br/>                Recovered='rgb(30,200,30)', <br/>                Confirmed='rgb(100,140,240)'),<br/>              line=list(color='rgb(8,48,107)', width=1.0)<br/>            )<br/>          )<br/>      plt<br/>    })<br/>  }</span></pre><p id="7499" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后几行代码使用前面定义的函数。这两个图通过以下方式分配给用户界面元素:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="0aa9" class="ly lz it oh b gy ol om l on oo">  output$dailyMetrics = renderBarPlot(<br/>    "New", legendPrefix="New", yaxisTitle="New Cases per Day")</span><span id="5818" class="ly lz it oh b gy ow om l on oo">  output$cumulatedMetrics = renderBarPlot(<br/>    "Cum", legendPrefix="Cumulated", yaxisTitle="Cumulated Cases")</span></pre><p id="9000" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">瞧啊。</p><p id="e780" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是全部，你可以通过点击编辑器窗口右上角的“运行应用”按钮来运行代码。</p><h1 id="b067" class="nv lz it bd ma nw op ny md nz oq ob mg jz or ka mj kc os kd mm kf ot kg mp of bi translated">GITHUB 代码</h1><p id="7719" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">以上所有代码都可以在<em class="lt"> GitHub </em>上找到。毕竟，它只有两个文件，加上项目文件:</p><p id="5640" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lx" href="https://github.com/ploner/coronavirus-r" rel="noopener ugc nofollow" target="_blank">https://github.com/ploner/coronavirus-r</a></p><h1 id="fb78" class="nv lz it bd ma nw op ny md nz oq ob mg jz or ka mj kc os kd mm kf ot kg mp of bi translated">[可选]将应用程序上传到云</h1><p id="3f90" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">将闪亮的应用程序发布到 web 服务器的最简单方法是使用<a class="ae lx" href="https://www.shinyapps.io" rel="noopener ugc nofollow" target="_blank"> shinyapps </a>。在<em class="lt"> shinyapps </em>上创建账户后，进入 RStudio，点击右上角的发布图标，然后点击“发布应用程序…”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/eff6bbf848e6380dbffac8995f1188c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*o8WVYs6yTbOdauwL13f4TQ.png"/></div></figure><p id="b03e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用你的账号连接，然后选择你需要的文件(仅限<em class="lt"> ui。R </em>和<em class="lt">服务器。R </em>！):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/99dcef21269a53f36a5c0c2744d7647e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*tE5qVyaweEhulxUyxPYHng.png"/></div></figure><p id="d55a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就是这样！你的应用程序<strong class="kw iu">运行在网络服务器</strong>上，你可以通过互联网访问它。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><blockquote class="lq lr ls"><p id="8293" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated">[2020 年 3 月 19 日更新]有一篇<strong class="kw iu">后续文章</strong>是关于同一个用例的。相反，如果 R + Shiny + Plotly，它会通过基于 Python 的堆栈:</p><p id="77e1" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated"><strong class="kw iu"> Python + Dash + Plotly </strong></p><p id="daff" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated">链接:<a class="ae lx" href="https://medium.com/@meinhard.ploner/visualise-covid-19-case-data-using-python-dash-and-plotly-e58feb34f70f" rel="noopener">用 Python 可视化新冠肺炎数据，破折号&amp; Plotly </a></p></blockquote></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="5eda" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我叫梅哈德·普洛纳。我对统计学和数据科学并不陌生，但这是我第一篇关于媒体的文章。我希望你喜欢阅读它，并欢迎任何反馈。</p><p id="d3f1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lt">更多 R 在行动的例子，查看</em><a class="ae lx" href="http://www.r-bloggers.com" rel="noopener ugc nofollow" target="_blank"><em class="lt">R-bloggers</em></a><em class="lt">。</em></p></div></div>    
</body>
</html>