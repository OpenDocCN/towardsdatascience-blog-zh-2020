<html>
<head>
<title>Must-have-on-finger-tips Datetime functions for Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 必备的日期时间函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/must-have-on-finger-tips-datetime-functions-for-python-31cc76b17d07?source=collection_archive---------46-----------------------#2020-07-14">https://towardsdatascience.com/must-have-on-finger-tips-datetime-functions-for-python-31cc76b17d07?source=collection_archive---------46-----------------------#2020-07-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ae9d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从蟒蛇和熊猫</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7a9830aa7be075370204f0c24638f741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*syZezd6jA96T0BXJ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@hngstrm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亨利&amp;公司</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5b5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python 提供了一整套用于处理日期时间数据的函数和库。我经常使用:</p><ul class=""><li id="3e63" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu"> Python 的日期时间</strong></li><li id="3755" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">熊猫的时间戳</strong></li></ul><p id="295d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在处理某种数据一段时间后，我们会比其他人更频繁地使用一些函数。虽然功能的选择完全取决于个人的经验和舒适度，但了解自己的选择是有好处的。如果您正在处理带有原始时间戳的时间序列或由各种系统和设备提供的某种形式的 DateTime 对象，那么本文应该复习一下将会派上用场的流行的 DateTime 函数。</p><h1 id="2990" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">1.日期和日期格式的字符串</h1><p id="79a3" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这里我们讨论一下 python <strong class="lb iu">。strftime() </strong>函数和 pandas <strong class="lb iu"> date_format </strong>选项在 excel 和 CSV 中编写 pandas。</p><p id="204c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，如果您将 pandas 数据帧保存到 excel 或文本文档中，您会对 pandas 生成的 yyyy-mm-dd hh:mm:ss 默认格式不满意。这是我控制这些输出的方法。</p><p id="17d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们以一个包含随机日期和字符串代码的数据框为例。下面是我们将使用的玩具数据框:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="a922" class="nl mk it nh b gy nm nn l no np">start = datetime.datetime(2020,2,1)</span><span id="3bcf" class="nl mk it nh b gy nq nn l no np">end = datetime.datetime(2020,2,10)</span><span id="4ab5" class="nl mk it nh b gy nq nn l no np">dates = pd.date_range(start = start, end = end,freq=’D’).to_list()</span><span id="c349" class="nl mk it nh b gy nq nn l no np">codes = [ "".join(choice(ascii_lowercase) for i in range(10)) for j   <br/>        in range(10)]</span><span id="7e0c" class="nl mk it nh b gy nq nn l no np">df = pd.DataFrame(columns=['date','code'])</span><span id="f42d" class="nl mk it nh b gy nq nn l no np">df.date  = dates</span><span id="7fcd" class="nl mk it nh b gy nq nn l no np">df.code = codes</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/4057b5087677929d3c80d44823f3a0b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:386/format:webp/1*QsxnTWwLMMLDGBuc8JUAfg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例数据</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/6da714a2bc78b5ce17d74f95271947fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/format:webp/1*pN3I6VPydnosuldWFRbVTA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Excel 输出</p></figure><p id="3d58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，日期列提供了很多信息，但不一定好看。我们不希望我们的输出报告中有这么大的日期，我们只需要知道日期的格式，比如日期/月/年。</p><h2 id="efea" class="nl mk it bd ml nt nu dn mp nv nw dp mt li nx ny mv lm nz oa mx lq ob oc mz od bi translated">战斗支援车</h2><p id="0e1a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果 csv 或文本输出是你的目标，这很容易改变。只需在您的 to_csv 函数中用 kwarg date_format 指定输出的格式。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="2b50" class="nl mk it nh b gy nm nn l no np">df.to_csv(‘C:/location/slash_dates.txt’,date_format=’%M/%D/%Y’)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/b4d4b9b246174d54345ba830c7da31d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*vC-IjghhmNmrMmMzwAv6EA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用斜线分隔的输出在 CSV 中很容易。</p></figure><h2 id="a75b" class="nl mk it bd ml nt nu dn mp nv nw dp mt li nx ny mv lm nz oa mx lq ob oc mz od bi translated">擅长</h2><p id="9238" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">当使用 excel 时，你必须要小心一点，因为 Excel 在格式化日期时有自己的想法。</p><p id="2b79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，您可以右键单击您的格式单元格，将格式更改为您想要的任何格式。但是一提到斜线，excel 就很固执。它不是 excel 必须提供的格式选项之一(可能是因为它看起来很丑，咄！).而且，值得一提的是，当 python 提供这么多功能时，不必每次都干扰 excel 中的输出。</p><p id="e446" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> python。strftime()方式:</strong></p><p id="07a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现与 to_csv 中的 date_format 等效的灵活性，我们“欺骗”excel，使用。strftime()并将其传递给 excel。(因为我们有一个 Series 对象，所以我们需要一个. dt 来访问它的值)</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="cbf2" class="nl mk it nh b gy nm nn l no np">df.date = df.date.dt.strftime(“%d/%m/%y”)</span></pre><p id="bcf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哒哒！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/2eddd9755a427d572b17aadcdcb9f1c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*8rSF8ww2hk6hKqEQPqlEsg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">斜线分隔的日期</p></figure><p id="f50e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哒哒！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/f9bebb34804414fe8b79d67a65f870fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:314/format:webp/1*iFChwVRSwTbuBm0bM3HVNQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">excel 输出</p></figure><p id="abca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，</p><p id="99b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">熊猫道:</strong></p><p id="da1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 pandas excel writer 并指定格式，如 to_csv(并为您的工作表命名作为额外的奖励。)</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="6905" class="nl mk it nh b gy nm nn l no np">writer = pd.ExcelWriter(‘C:/location/writer_datetime.xlsx’,  <br/>         date_format=”%D/%M/%Y”)</span><span id="3253" class="nl mk it nh b gy nq nn l no np">df.to_excel(writer, sheet_name=’xl_slashes’)</span><span id="5e36" class="nl mk it nh b gy nq nn l no np">writer.save()<br/></span></pre><p id="11a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哒哒！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/bdb34bf0a5cb5c4dedf6aedc7ca0f9f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:430/format:webp/1*E4lIyrq9uUAt7NbKz-0hPg.png"/></div></figure><h1 id="bf26" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">2.字符串中的日期</h1><p id="8744" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这里我们讨论一下<strong class="lb iu">。strptime( ) </strong>和<strong class="lb iu"> to_datetime( ) </strong>函数，基本上是我们前面所做的姊妹函数。</p><p id="c8e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过上面的步骤，您现在已经将带有一组时间戳属性的 datetime64 对象转换为一个字符串序列。(Pandas 数据类型是字符串或混合序列的“对象”)</p><p id="90ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之前。strftime():</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/3039452162205dcbaec080440fcf0d1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*j8zlyFIwM8XGs_Yer9AdCw.png"/></div></figure><p id="b558" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后。strftime():</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/7e97dbe41d095778bf43fadd16a2b8f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*10MyAO1Q6Ijr8NTPlOIakA.png"/></div></figure><p id="1776" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于某种原因，你想要回你的约会。假设您想要获取日期是几月几号或属于哪个日历周。使用内置的 datetime 函数比解析看起来像 DateTime 的字符串要好。</p><p id="0497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们使用了。strftime()，也就是<strong class="lb iu">。strptime( ) </strong>或 pandas <strong class="lb iu"> to_datetime( ) </strong>函数，如果这是您更喜欢的。</p><p id="bb25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">熊猫的 to_datetime()方式:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/c7dbd364996262a067335193d05cbc10.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*ZJoC5ABihbKZXbPHYQBuwA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">日期对象从日期列中返回</p></figure><p id="7179" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意它们所表达的意思的格式和相应的简短形式。假设您的日期字符串看起来不同，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/cc5e178b356ae08664022f6fc3b5dd72.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*wm9QO22i0ecCzORiElDajA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">日期字符串的不同格式</p></figure><p id="0176" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你有没有注意到%B 代表这个月的扩张？</p><p id="d219" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将这个日期字符串转换成一个 DateTime 对象，从中获得日历周。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="0f2e" class="nl mk it nh b gy nm nn l no np">df['date_month'] = pd.to_datetime(df.date_month, format=’%d-%B-%y’)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/6dc71c40e49f565505b54df6ecb989c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*xCM41gD1hDgo-G6kLObPsg.png"/></div></figure><p id="ce81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了 datetime 对象，让我们使用 pandas datetime 函数来获取日历周。周</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="1134" class="nl mk it nh b gy nm nn l no np">df['calender_week'] = df.date_month.dt.week</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/ca6de5eac50322c655c15e1d9401112e.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*AEBpV0iFh056gBC2ASXGGw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在这里，日历周，熊猫之路。</p></figure><p id="3936" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> Python 的 strptime()方式:</strong></p><p id="739e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas 不赞成使用 Timestamp.strptime()，而是用一个非常有效的 to_datetime()代替，可以使用. dt 访问器将它应用于整个系列。</p><p id="d651" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您有单独的时间戳实体需要在系列之外进行格式化。strptime()是一个有效的 python 函数。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="ee8c" class="nl mk it nh b gy nm nn l no np">import datetime</span><span id="cec8" class="nl mk it nh b gy nq nn l no np">date_string = “2 March, 2020”</span><span id="4c99" class="nl mk it nh b gy nq nn l no np">dttime_obj = datetime.datetime.strptime(date_string, “%d %B, %Y”)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/fa9e386b28df8d06a954f00cb1964005.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*fc4PHoxhEeDs1VRxuA7wYg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们有一个来自字符串的日期、时间对象</p></figure><p id="11b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">datetime 的 isocalendar()方法是一个元组，包含位置 1 处的日历周。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="a8d9" class="nl mk it nh b gy nm nn l no np">dttime_obj.isocalendar()[1]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/5fc1f878f479005bfe2269bb4768890e.png" data-original-src="https://miro.medium.com/v2/resize:fit:430/format:webp/1*wM52nypzpehinqpdJcSvnw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">日历周，python 方式。</p></figure><p id="a730" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是 Python 中熊猫内外的一些有用的日期时间对象函数。希望这有所帮助！</p></div></div>    
</body>
</html>