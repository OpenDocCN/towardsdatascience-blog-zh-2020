<html>
<head>
<title>Power BI: Add Category ‘Other’ to Charts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Power BI:向图表添加类别“其他”</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/power-bi-add-category-other-to-charts-354267ec1809?source=collection_archive---------1-----------------------#2020-02-08">https://towardsdatascience.com/power-bi-add-category-other-to-charts-354267ec1809?source=collection_archive---------1-----------------------#2020-02-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/92aab690ac13209992f73d822265f469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CvMzLwyu68xl4Iyx_WxUHw.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">资料来源:Pexels.com</p></figure><h1 id="c3d3" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">问题是</h1><p id="582c" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">微软一直在以更快的速度改进Power BI。每当我遇到缺点时，我的第一个想法是等待，并假设它会很快被新的更新解决。然而，等待仪表板的客户并不总是分享我的乐观和耐心，因此，我经常需要有创造力。</p><p id="3eae" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">我前阵子遇到的一个问题是有一个分类太多的饼状图；当你有一个饼状图，比如说20个不同的百分比(显然总和为100%)时，这个图表可能会变得难以阅读。当然，您可以使用Power BI的top-N特性，但是这将不可避免地排除剩余的数据。这意味着100%将只包含可见的分区，这可能会造成混乱。</p><p id="9f7d" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">对此的解决方案是将某个百分比设置为阈值，并将低于该阈值的所有部分一起分组到名为“其他”的分区中。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mg"><img src="../Images/49189175e467926e870b124df781cc55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SO_uwGqv5-AfX3n5cNKSiQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">将截止值设置为10%之前和之后</p></figure><p id="b052" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">更好的方法是添加一个可以动态改变阈值的切片器。在尝试了一些度量和查询之后，我想到了下面的解决方案。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/fbbe50534da8f61340506a5390ccddb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*MsLruIoZFRa1Z3gXhmk-2g.gif"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">结果呢</p></figure><p id="0a5c" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">让我向您介绍一下我的方法，这样您就可以自己尝试了…</p><h1 id="f495" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">蓝图</h1><h2 id="e9e7" class="mm kg it bd kh mn mo dn kl mp mq dp kp lo mr ms kt ls mt mu kx lw mv mw lb mx bi translated">数据</h2><p id="d182" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">在动手之前，了解您的数据非常重要。对于这个例子，我使用了洛杉矶湖人队2015-2016赛季的统计数据，这是科比·布莱恩特的告别赛季。在本例中，我们将只使用两列图表；球员的名字和他们在整个赛季中的得分。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div class="gh gi my"><img src="../Images/abb83f17c487a7e20f2da83ff1e4f9ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*f6gPsftAF5y36bQn-dz8pQ.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">我们将使用的数据</p></figure><p id="5a73" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">既然你理解了数据，我们可以开始工作了。</p><h2 id="8d66" class="mm kg it bd kh mn mo dn kl mp mq dp kp lo mr ms kt ls mt mu kx lw mv mw lb mx bi translated">添加类别“其他”</h2><p id="77a0" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">如果您想绘制一个功率BI值，应该有一行或一个度量值。假设在您的数据中没有名为“<em class="mz"> Other </em>”的没有值的行，您有两个选择；创建新行或使用度量。度量看起来是最佳选择，但是这意味着您必须将它与您已经拥有的行结合起来。因此，添加新行对我来说似乎是最好的选择。</p><p id="d522" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">在Power BI中，您不能简单地向已经加载的表中添加新行，而是可以创建自己的表并追加新行。通过一些简单的步骤，你可以添加一个名为“<em class="mz">其他玩家</em>”的新玩家。因为他的分数会随着他所代表的玩家数量而变化，我们会给这个玩家零分，至少现在是这样。</p><ol class=""><li id="b821" class="na nb it lf b lg mb lk mc lo nc ls nd lw ne ma nf ng nh ni bi translated">手动创建一个具有相同列标题的新表格(<em class="mz">‘输入数据’</em>)</li><li id="8a3a" class="na nb it lf b lg nj lk nk lo nl ls nm lw nn ma nf ng nh ni bi translated">仅创建一行。该表应该如下所示:</li></ol><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/eeb27984152a3d005e4cd643ab2b40d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xlPmzyiqypsN_z0l"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">为额外的“其他玩家”行创建表格。</p></figure><p id="5bd2" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">3.将该表追加到包含分数的主表中。(<em class="mz">编辑查询/转换数据—主页—合并—追加查询</em>)</p><p id="4f48" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">好了，数据准备好了。但是在我们开始衡量之前，我们需要做更多的准备。</p><h2 id="8bd4" class="mm kg it bd kh mn mo dn kl mp mq dp kp lo mr ms kt ls mt mu kx lw mv mw lb mx bi translated">创建动态阈值</h2><p id="1bd8" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated"><strong class="lf iu">注意</strong>:如果对动态百分比不感兴趣，可以跳过这一步。如果您想使用一个固定的阈值(例如10%)，您可以跳到下一节“编写度量”。如果您希望用户动态更改百分比，您必须遵循另一个步骤:</p><p id="5f96" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">准备工作非常简单。您只需手动创建另一个表，如下所示:</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/e4a1f7b2da7b498be5fd9684354c46d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-fZvJEiHrkY3GjXb"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">为百分比切片器值创建一个表。</p></figure><p id="8186" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">对于这个例子，我创建了0到15%之间的值，但是您当然可以使用您喜欢的任何范围和步长。</p><p id="e5c2" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">注意:确保该表没有以任何方式连接到数据集中的其他表。设置好表格后，您可以向报告中添加一个切片器，从中可以选择所需的分界点。</p><h2 id="dbea" class="mm kg it bd kh mn mo dn kl mp mq dp kp lo mr ms kt ls mt mu kx lw mv mw lb mx bi translated">写度量</h2><p id="4e55" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">准备工作到此为止。是时候写解决方案的核心了；衡量标准。<br/>为了让我的代码更具可读性和可调整性，我倾向于使用很多变量。让我们从定义一些关键值开始:我们在切片器中选择的截止百分比和我们将要计算的玩家的名字。</p><pre class="mh mi mj mk gt nq nr ns nt aw nu bi"><span id="963d" class="mm kg it nr b gy nv nw l nx ny">Points_calculation =</span><span id="4776" class="mm kg it nr b gy nz nw l nx ny">VAR percentage = MAX(Threshold[Percentage]) -- can also be fixed <br/>VAR current_player = MAX(‘Season total’[Name])</span></pre><p id="1a71" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">注意:如果您不想要前面提到的动态百分比，您可以将百分比变量设置为0到1之间的固定值。</p><p id="cf88" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">现在我们来计算一下球队的总得分。</p><pre class="mh mi mj mk gt nq nr ns nt aw nu bi"><span id="ed2f" class="mm kg it nr b gy nv nw l nx ny">VAR total_points = CALCULATE(<br/>    SUM(‘Season total’[PTS]),<br/>    ALL(‘Season total’)<br/>    )</span></pre><p id="169a" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">根据上面的信息，我们可以计算出一个临界值。假设这个团队总共得了2000分，你将百分比设置为10%，截止数将是200。任何低于200分的玩家都应该被归类到分区“<em class="mz">其他玩家</em>”中。</p><pre class="mh mi mj mk gt nq nr ns nt aw nu bi"><span id="a2d1" class="mm kg it nr b gy nv nw l nx ny">VAR cutoff_number = total_points * percentage</span></pre><p id="7c89" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">使用这个截止点，我们现在可以计算阈值之上和之下的点的总和。</p><pre class="mh mi mj mk gt nq nr ns nt aw nu bi"><span id="2034" class="mm kg it nr b gy nv nw l nx ny">VAR sum_above_cutoff = SUMX(<br/>    FILTER(<br/>        ALL(‘Season total’),<br/>        ‘Season total’[PTS] &gt; cutoff_number),<br/>    (‘Season total’[PTS])<br/>    )</span><span id="9272" class="mm kg it nr b gy nz nw l nx ny">VAR remainder = total_points-sum_above_cutoff</span></pre><p id="eb7c" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">在代码的最后一部分，对于每个玩家，如果他通过了阈值，我们将返回他的点数，如果他没有通过阈值，我们将什么也不返回(<em class="mz"> BLANK() </em>)。对于类别“<em class="mz">其他玩家</em>”我们将返回那些没有达到截止的玩家的总和(VAR余数)。</p><pre class="mh mi mj mk gt nq nr ns nt aw nu bi"><span id="dfb9" class="mm kg it nr b gy nv nw l nx ny">VAR filter_points = IF(<br/>    MAX(‘Season total’[PTS]) &lt; cutoff_number,<br/>    BLANK(),<br/>    MAX(‘Season total’[PTS])<br/>    )</span><span id="e716" class="mm kg it nr b gy nz nw l nx ny">VAR result = IF(<br/>    current_player = “Other players”,<br/>    remainder,<br/>    filter_points)</span><span id="6765" class="mm kg it nr b gy nz nw l nx ny">RETURN result</span></pre><p id="4145" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">这就是你需要的所有代码。现在剩下的就是绘制结果了。但是首先，让我用一段代码总结一下整个措施:</p><pre class="mh mi mj mk gt nq nr ns nt aw nu bi"><span id="12cb" class="mm kg it nr b gy nv nw l nx ny">Points_calculation =</span><span id="175b" class="mm kg it nr b gy nz nw l nx ny">VAR percentage = MAX(Threshold[Percentage])<br/>VAR current_player = MAX(‘Season total’[Name])</span><span id="2f19" class="mm kg it nr b gy nz nw l nx ny">VAR total_points = CALCULATE(<br/>    SUM(‘Season total’[PTS]),<br/>    ALL(‘Season total’)<br/>    )</span><span id="df64" class="mm kg it nr b gy nz nw l nx ny">VAR cutoff_number = total_points * percentage</span><span id="2c9d" class="mm kg it nr b gy nz nw l nx ny">VAR sum_above_cutoff = SUMX(<br/>    FILTER(<br/>        ALL(‘Season total’),<br/>        ‘Season total’[PTS] &gt; cutoff_number),<br/>    (‘Season total’[PTS])<br/>    )</span><span id="d344" class="mm kg it nr b gy nz nw l nx ny">VAR remainder = total_points-sum_above_cutoff</span><span id="d7c9" class="mm kg it nr b gy nz nw l nx ny">VAR filter_points = IF(<br/>    MAX(‘Season total’[PTS]) &lt; cutoff_number,<br/>    BLANK(),<br/>    MAX(‘Season total’[PTS])<br/>    )</span><span id="fc9d" class="mm kg it nr b gy nz nw l nx ny">VAR result = IF(<br/>    current_player = “Other players”,<br/>    remainder,<br/>    filter_points)</span><span id="4cb5" class="mm kg it nr b gy nz nw l nx ny">RETURN result</span></pre><h2 id="7969" class="mm kg it bd kh mn mo dn kl mp mq dp kp lo mr ms kt ls mt mu kx lw mv mw lb mx bi translated">剧情</h2><p id="bb15" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">绘制结果非常简单，您所要做的就是绘制一个饼图(或您选择的任何其他可视化工具)，并像这样设置字段:<br/>-Legend:' Season total '[Name]<br/>-Values:Points _ calculation</p><p id="ff50" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">结果应该是这样的:</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/eec52307e5e02e71c2f9ca735c4271eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/0*0v63JMA4xOPfrCQy"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">决赛成绩</p></figure><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/c99b73ffa75031f99304e19a7ab04875.png" data-original-src="https://miro.medium.com/v2/resize:fit:366/1*W4Ac2Pl2gelr1oWojBv_DQ.gif"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">来源:<a class="ae oc" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank">https://giphy.com/</a></p></figure><h1 id="81c4" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">结论</h1><p id="f307" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">正如您所看到的，在您的可视化中创建一个动态的“<em class="mz"> other </em>”分区是相当简单的。然而，我在这里写的手册实际上是我之前创建的包含类别选择、指示器和行聚合的更复杂版本的改编版本。</p><p id="d867" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">我非常有信心，微软将很快创造出一个解决方案，不需要一个hacky解决方案，以及他们目前可能有的其他缺点。但是只要我们发现了没有被解决的需求，除了保持创造力和自己写更多的代码之外，我们别无选择。</p><p id="ea18" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">请随意查看我创建的一些其他工具或教程，以改进您的Power BI仪表盘或其他数据应用程序。</p><p id="ec7f" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated"><em class="mz">关于我:我叫布鲁诺，是总部位于荷兰的人工智能技术纵向扩展公司</em> <a class="ae oc" href="http://www.dashmote.com/" rel="noopener ugc nofollow" target="_blank"> <em class="mz"> Dashmote </em> </a> <em class="mz">的数据科学家。我们的目标是借助基于人工智能的解决方案，弥合图像和数据之间的鸿沟。<br/>查看我在</em> <a class="ae oc" href="https://www.zhongtron.me/" rel="noopener ugc nofollow" target="_blank">上的其他作品https://www.zhongtron.me </a>。</p></div></div>    
</body>
</html>