<html>
<head>
<title>Creating Real-Time Cohorts using Python, SQL, and Tableau</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python、SQL和Tableau创建实时群组</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-design-real-time-cohort-analysis-in-python-sql-tableau-1df527c19b7e?source=collection_archive---------31-----------------------#2020-05-05">https://towardsdatascience.com/how-to-design-real-time-cohort-analysis-in-python-sql-tableau-1df527c19b7e?source=collection_archive---------31-----------------------#2020-05-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/3a224aa82118cb975c48c80dcbce09d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5xkxzc3fVKcRT-yPkShkPg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://en.saype-artiste.com/istanbul-2020" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="de80" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">队列是在选定时期内具有共同特征的一群人，如2019年6月毕业的硕士生或在美国出现首例新冠肺炎后报名参加网飞免费试用的用户。</p><p id="c4de" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有几个队列变异，但假设只有两个队列。在三月或四月注册网飞的用户。随着时间的推移，在分析群组中用户的行为之后，我们可以了解群组的“质量”，例如订阅、客户终身价值或每个用户每天观看的平均时间。</p><p id="23dc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然《网飞》的下载和订阅数量因爆发而增加，但群组分析有助于我们进行比较，并提供更多关于用户“享受”或哪部电影有助于留住客户的见解。</p><blockquote class="le lf lg"><p id="47ad" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated">群组分析对于理解几代人在特定时期的行为也很重要，比如像新冠肺炎这样的外部冲击。</p></blockquote><p id="5d99" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在社会隔离时期，人们花更多的时间在社交媒体上。下面你会看到在互联网上消费内容时，不同代人(群体)之间的差异。</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ll"><img src="../Images/50f3af96aa95032c76c28254411f5c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pT2svx9IPD_0MMSe.jpg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://2oqz471sa19h3vbwa53m33yj-wpengine.netdna-ssl.com/wp-content/uploads/2020/04/Supp-1-Activities-Covid-Media-1.jpg" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="0063" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将分析一个来自UCI的著名在线零售数据集，并了解如何在离线(Python)和在线(SQL-Tableau stack)中设计群组分析。</p><p id="5a49" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">【http://archive.ics.uci.edu/ml/datasets/Online+Retail/ T4】</p><p id="b0c9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> Python部分(离线)</strong></p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="lx ly l"/></div></figure><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lz"><img src="../Images/e85224e5056e781d69c5778b5beeb8be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GJmIWQLHVqkSjwgmK98fqQ.png"/></div></div></figure><p id="5d76" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据集包含客户id、国家、价格、数量等，但我们只需要customer id和InvoiceDate列。</p><p id="fe30" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们丢弃重复的值并删除缺失的值。然后，我们使用transform函数找到每个用户的第一个订单日期，并计算下一个订单日期之间的日期差。</p><p id="3728" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">我们将999设置为第一个订单日期的虚拟</strong>，因为这些订单不计入<strong class="ki iu">留存</strong>而计入<strong class="ki iu">流失</strong>。</p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="lx ly l"/></div></figure><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ma"><img src="../Images/6f1f9b9c89955799e8558ef0ef126436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ONlfay9x84-s6rHEQF1oQ.png"/></div></div></figure><p id="819e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以很容易地使用数据透视表创建群组，并在右侧添加“总计”列。根据客户第一次购买或注册的时间对他们进行分组是很常见的。</p><p id="e60b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(对于Tableau中的离线分析，我们将数据框保存为excel格式。)</p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="lx ly l"/></div></figure><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mb"><img src="../Images/07297abbcf7788fa1b969037104b6b32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WKyXDaIiRegTi8F5WgxyrQ.png"/></div></div></figure><p id="da2b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">478名客户在2011年11月下了第一笔订单。其中144名用户在同一个月再次订购，13名用户在下个月(2011-12年)再次订购。</p><p id="58fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">321%的顾客不再订购。这就是为什么我们把999作为第一批订单的虚拟订单。</p><p id="1405" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们<strong class="ki iu">根据用户数量来标准化</strong>群组表，因为更常见的是以百分比来分析群组。</p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="lx ly l"/></div></figure><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/68cdd5c140931259ded6a3552f357cea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w8Fs7xTGeGEGc0i8iIvKAQ.png"/></div></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="fc9b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> SQL部分(在线)</strong></p><p id="e71e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们假设online_retail模式下的“orders”表中的数据集和每个用户购买的一条记录。我们在Python部分中使用SQL中的first_value函数计算第一个订单日期。</p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="46b8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们使用datediff()函数计算订单日期之间的日期差，并使用case when为第一个订单设置999。现在，我们准备连接到Tableau中的数据源，并在下面的Tableau视频之后分析群组。</p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="c37b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">画面部分(在线)</strong></p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="md ly l"/></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="b8e5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您有任何问题，可以通过<a class="ae kf" href="https://twitter.com/hkaansimsek" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae kf" href="https://www.linkedin.com/in/hakkikaansimsek" rel="noopener ugc nofollow" target="_blank"> LinkedIn联系我。</a></p></div></div>    
</body>
</html>