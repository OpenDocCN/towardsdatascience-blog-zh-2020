<html>
<head>
<title>The (Unofficial) Yahoo Finance API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">(非官方的)雅虎财经API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-unofficial-yahoo-finance-api-32dcf5d53df?source=collection_archive---------5-----------------------#2020-05-12">https://towardsdatascience.com/the-unofficial-yahoo-finance-api-32dcf5d53df?source=collection_archive---------5-----------------------#2020-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5f0e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个Python接口，可以处理无限量的数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/026813c199346bd928509490ae9a82ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*taWnk8HMnoN2WY7q"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">肖恩·波洛克在Unsplash<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">上的照片</a></p></figure><h2 id="506f" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">背景</h2><p id="356b" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我在金融服务行业担任数据分析经理。我的职责是支持我的组织满足任何与数据相关的需求。我们正在做的一个项目是一个非常依赖财务数据的内部应用程序；我的工作是找到提供相关数据的方法。</p><h2 id="ba88" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">走运了</h2><p id="9d88" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">如果你在互联网上搜索足够长的时间，你将能够找到让你达到(或部分达到)目标的解决方案。我玩了一下<a class="ae ky" href="http://iexcloud.io" rel="noopener ugc nofollow" target="_blank"> IEX云</a>、<a class="ae ky" href="https://www.quandl.com/" rel="noopener ugc nofollow" target="_blank"> Quandl </a>和其他一些服务，它们都很棒，但不免费。所以，像任何寻找解决方案的开发者一样，我开始搜索StackOverflow。我经常看到<a class="ae ky" href="http://finance.yahoo.com" rel="noopener ugc nofollow" target="_blank">雅虎财经</a>作为一个可能的解决方案，尽管下面的注释位于<a class="ae ky" href="https://stackoverflow.com/questions/tagged/yahoo-finance?tab=Newest" rel="noopener ugc nofollow" target="_blank">雅虎财经</a>搜索结果页面的顶部:</p><blockquote class="mo"><p id="91a1" class="mp mq it bd mr ms mt mu mv mw mx mn dk translated">请注意:这个API已经被雅虎终止。雅虎！金融是雅虎的一项服务！提供金融信息。它是美国顶级的金融新闻和研究网站。</p></blockquote><p id="d389" class="pw-post-body-paragraph lv lw it lx b ly my ju ma mb mz jx md li na mf mg lm nb mi mj lq nc ml mm mn im bi translated">不过，看起来人们仍然在使用这项服务，要么是通过网络抓取，要么是通过你只能通过搜索XHR请求才能找到的网址。我知道我不想要网络抓取解决方案，所以我开始在Chrome的开发者工具中搜索网络标签，寻找任何类似数据的东西。幸运的是，我偶然发现了一些。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="b806" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">包:<a class="ae ky" href="https://github.com/dpguthrie/yahooquery" rel="noopener ugc nofollow" target="_blank"> YahooQuery </a></h2><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="0d61" class="kz la it ng b gy nk nl l nm nn">pip install <strong class="ng iu">yahooquery</strong></span></pre><p id="11f6" class="pw-post-body-paragraph lv lw it lx b ly no ju ma mb np jx md li nq mf mg lm nr mi mj lq ns ml mm mn im bi translated">该包提供了三个不同的类，可以高效快速地检索您可以通过前端查看的数据。可以检索大部分数据的主类是<code class="fe nt nu nv ng b">Ticker</code>类。</p><h2 id="5c44" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">心脏</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="62bc" class="pw-post-body-paragraph lv lw it lx b ly no ju ma mb np jx md li nq mf mg lm nr mi mj lq ns ml mm mn im bi translated">很简单，对吧？只需传递一个符号或符号列表，就可以通过雅虎财经检索大部分可用数据。不过，在我们继续之前，重要的是要知道您可以提供额外的关键字参数来修改某些行为:</p><ul class=""><li id="451d" class="nw nx it lx b ly no mb np li ny lm nz lq oa mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">asynchronous, default False, optional</code>:当设置为<code class="fe nt nu nv ng b">True</code>时，对雅虎财经的请求将异步进行。<em class="of">只有在使用多个符号时才有必要。</em></li><li id="9c9b" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">backoff_factor, default 0.3, optional</code>:第二次尝试后，在两次尝试之间应用的系数，以秒为单位。例如，如果补偿因子是0.1，那么<code class="fe nt nu nv ng b">sleep()</code>将在重试之间休眠[0.0s，0.2s，0.4s，…]</li><li id="6bf0" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">country, default United States, optional</code>:更改每个请求用作查询参数的语言、地区和域名。<em class="of">这个功能还没有经过彻底的测试，但是当使用</em> <code class="fe nt nu nv ng b">news</code> <em class="of">方法时，你会看到不同之处。将返回该国家特定语言的数据。</em></li><li id="766d" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">formatted, default False, optional</code>:当<code class="fe nt nu nv ng b">formatted=True</code>时，来自API的大部分数值数据将以字典的形式返回:</li></ul><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="7d77" class="kz la it ng b gy nk nl l nm nn">"totalCash": {<br/>    "raw": 94051000320,<br/>    "fmt": "94.05B",<br/>    "longFmt": "94,051,000,320"<br/>}</span></pre><ul class=""><li id="43cd" class="nw nx it lx b ly no mb np li ny lm nz lq oa mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">max_workers, default 8, optional</code>:定义用于发出异步请求的工作线程数量。<em class="of">这仅在</em>和<code class="fe nt nu nv ng b">asynchronous=True</code>时相关</li><li id="0344" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">proxies, default None, optional</code>:用代理发出每个请求。只需传递一个字典，将URL方案映射到代理的URL。您还可以通过设置环境变量<code class="fe nt nu nv ng b">HTTP_PROXY</code>和<code class="fe nt nu nv ng b">HTTPS_PROXY</code>来配置代理。</li><li id="bef6" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">retry, default 5, optional</code>:重试失败请求的次数。</li><li id="8817" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">status_forcelist, default [429, 500, 502, 503, 504], optional</code>:我们应该强制重试的一组整数HTTP状态码。</li><li id="da1e" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">timeout, default 5, optional</code>:给定秒数后停止等待响应。</li><li id="c5ac" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">user_agent, random selection, optional</code>:浏览器的用户代理字符串，在每个请求的头中发送。</li><li id="887e" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">validate, default False, optional</code>:在实例化过程中验证符号的存在。无效符号将被删除，但您可以通过<code class="fe nt nu nv ng b">invalid_symbols</code>属性查看它们。</li><li id="b00e" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">verify, default True, optional</code>:布尔值，在这种情况下，它控制我们是否验证服务器的TLS证书，或者字符串，在这种情况下，它必须是要使用的CA包的路径。</li><li id="0095" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><code class="fe nt nu nv ng b">username</code>和<code class="fe nt nu nv ng b">password</code>:如果你订阅了雅虎财经高级版，通过你的<code class="fe nt nu nv ng b">username</code>和<code class="fe nt nu nv ng b">password</code>。您将登录，现在可以访问高级属性/方法。所有高级属性/方法都以<code class="fe nt nu nv ng b">p_</code>开头。<strong class="lx iu">禁用双因素身份验证以使其工作。</strong></li></ul><p id="e4c2" class="pw-post-body-paragraph lv lw it lx b ly no ju ma mb np jx md li nq mf mg lm nr mi mj lq ns ml mm mn im bi translated">Ticker类可以分为几个不同的类别:模块、选项、历史定价和溢价数据。</p><h2 id="6f10" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">模块</h2><p id="b189" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">这些模块(通常)对应于Yahoo Finance前端的一个选项卡或各个选项卡中的数据。例如，要从“Summary”选项卡中检索数据，可以使用<code class="fe nt nu nv ng b">Ticker</code>类的<code class="fe nt nu nv ng b">summary_detail</code>属性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/11c857c321f7586b371ecba7299f2e7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*D8LvAgYepPO9PplidzrOuw.gif"/></div></figure><p id="4a52" class="pw-post-body-paragraph lv lw it lx b ly no ju ma mb np jx md li nq mf mg lm nr mi mj lq ns ml mm mn im bi translated">或者在“Statistics”选项卡中查找数据，可以使用属性<code class="fe nt nu nv ng b">valuation_measures</code>和<code class="fe nt nu nv ng b">key_stats</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="b6e6" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">选择</h2><p id="8a4f" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">所有选项的到期日期都可以用一个简单的命令行程序检索到:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="ff5c" class="kz la it ng b gy nk nl l nm nn">faang = Ticker('fb aapl amzn nflx goog', asynchronous=True)<br/>options = faang.option_chain</span></pre><p id="f9dd" class="pw-post-body-paragraph lv lw it lx b ly no ju ma mb np jx md li nq mf mg lm nr mi mj lq ns ml mm mn im bi translated">变量<code class="fe nt nu nv ng b">options</code>将是一个熊猫数据帧。数据帧将包含由符号、到期日和期权类型(看跌或看涨)组成的多重指数。</p><h2 id="8bc4" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">历史定价</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0ed782cfe99382d6fe55d79980eff6bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WY1-lB4_KQ_WZqnx"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@m_b_m?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> M. B. M. </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5d79" class="pw-post-body-paragraph lv lw it lx b ly no ju ma mb np jx md li nq mf mg lm nr mi mj lq ns ml mm mn im bi translated">这个非常简单:检索一个符号或符号列表的历史OHLC数据:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="7861" class="kz la it ng b gy nk nl l nm nn">faang = Ticker('fb aapl amzn nflx goog', asynchronous=True)<br/>history = faang.history()</span></pre><p id="b2c0" class="pw-post-body-paragraph lv lw it lx b ly no ju ma mb np jx md li nq mf mg lm nr mi mj lq ns ml mm mn im bi translated">上面的代码将返回每日的YTD数据。但是，可以向该方法提供其他参数:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="84e2" class="kz la it ng b gy nk nl l nm nn">yahooquery.ticker.<strong class="ng iu">history</strong>(self, period='ytd', interval='1d', start=None, end=None)</span><span id="5ef9" class="kz la it ng b gy om nl l nm nn">Historical pricing data</span><span id="1a49" class="kz la it ng b gy om nl l nm nn">Pulls historical pricing data for a given symbol(s)</span><span id="84eb" class="kz la it ng b gy om nl l nm nn"><strong class="ng iu">Parameters </strong><br/>---------- <br/><strong class="ng iu">period</strong>: str, default ytd, optional<br/>    Length of time</span><span id="219a" class="kz la it ng b gy om nl l nm nn"><strong class="ng iu">interval</strong>: str, default 1d, optional<br/>    Time between data points</span><span id="b183" class="kz la it ng b gy om nl l nm nn"><strong class="ng iu">start</strong>: str or datetime.datetime, default None, optional<br/>    Specify a starting point to pull data from.  Can be expressed as           a string with the format YYYY-MM-DD or as a datetime object </span><span id="ce1f" class="kz la it ng b gy om nl l nm nn"><strong class="ng iu">end</strong>: str of datetime.datetime, default None, optional<br/>    Specify a ending point to pull data from.  Can be expressed as a         string with the format YYYY-MM-DD or as a datetime object.</span><span id="001b" class="kz la it ng b gy om nl l nm nn"><strong class="ng iu">adj_timezone: </strong>bool, default True, optional<br/>    Specify whether or not to apply the GMT offset to the timestamp received from the API. If True, the datetimeindex will be adjusted to the specified ticker's timezone.</span><span id="8d7c" class="kz la it ng b gy om nl l nm nn"><strong class="ng iu">adj_ohlc: </strong>bool, default False, optional<br/>    Calculates an adjusted open, high, low and close prices according to split and dividend information</span><span id="8778" class="kz la it ng b gy om nl l nm nn"><strong class="ng iu">Returns </strong><br/>-------<br/>pandas.DataFrame<br/>    historical pricing data</span></pre><h2 id="d282" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">优质数据</h2><p id="95c4" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">还可以为Yahoo Finance Premium订户检索数据。这个包利用Selenium，特别是chromedriver登录雅虎财经。登录后，用户将能够利用高级方法和属性来检索数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="9f3b" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">与yfinance的比较</h2><p id="8309" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">yahooquery的另一种选择是yfinance。这是一个软件包，提供类似的功能，从雅虎财经检索数据。目前，它在GitHub上有近2500颗星，这是从雅虎财经搜索提供数据检索的python包时的最高数量。那么，为什么应该使用yahooquery而不是yfinance呢？</p><ul class=""><li id="fe79" class="nw nx it lx b ly no mb np li ny lm nz lq oa mn ob oc od oe bi translated"><strong class="lx iu">维护:</strong> yfinance似乎没有在创建forks的外部开发者之外进行维护。</li><li id="1427" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><strong class="lx iu">固执己见:</strong>在yfinance中，除了一对夫妇，每个属性调用都会调用相同的私有方法，<code class="fe nt nu nv ng b">_get_fundamentals</code>。这意味着用户必须检索所有可能的数据，即使他们只对一件事感兴趣。但是，另一方面，使用该私有方法的每个后续调用几乎不需要花费时间，因为数据已经存储在Ticker实例中。</li><li id="a986" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><strong class="lx iu">数据来源</strong> : yfinance通过抓取每个Ticker页面中的一个javascript变量来检索大部分数据(历史定价和期权之外的数据)。Yahooquery为用户可用的每个属性/方法使用API端点。</li><li id="624a" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><strong class="lx iu">准确性</strong>:损益表、资产负债表和现金流量表使用不同的端点。yahooquery中使用的方法可以检索更多数据，并且在查看美国以外的公司时是准确的。</li><li id="fe93" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><strong class="lx iu">简单:</strong>从检索多个符号的历史价格返回的数据帧在yahooquery中是长格式，而在yfinance中是宽格式。</li><li id="1636" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><strong class="lx iu">配置:</strong>关键字参数允许很多不同的配置。此外，异步请求在整个库中都是可用的，而不仅仅是像yfinance这样的历史定价。</li><li id="0d01" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated"><strong class="lx iu">更快:</strong>不同的例子见下面的Jupyter笔记本。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="db00" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">更多信息</h2><ul class=""><li id="9140" class="nw nx it lx b ly lz mb mc li on lm oo lq op mn ob oc od oe bi translated">查看文档以深入了解软件包的使用</li></ul><div class="oq or gp gr os ot"><a href="https://yahooquery.dpguthrie.com" rel="noopener  ugc nofollow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd iu gy z fp oy fr fs oz fu fw is bi translated">yahooquery</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">非官方雅虎财经API文档的Python包装:https://yahooquery.dpguthrie.com互动演示…</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">yahooquery.dpguthrie.com</p></div></div></div></a></div><ul class=""><li id="456f" class="nw nx it lx b ly no mb np li ny lm nz lq oa mn ob oc od oe bi translated">查看GitHub上的源代码</li></ul><div class="oq or gp gr os ot"><a href="https://github.com/dpguthrie/yahooquery" rel="noopener  ugc nofollow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd iu gy z fp oy fr fs oz fu fw is bi translated">dpguthrie/yahooquery</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">非官方雅虎财经API文档的Python包装:https://yahooquery.dpguthrie.com互动演示…</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">github.com</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph ks ot"/></div></div></a></div><ul class=""><li id="3d88" class="nw nx it lx b ly no mb np li ny lm nz lq oa mn ob oc od oe bi translated">观看Heroku上的互动演示</li><li id="b0d4" class="nw nx it lx b ly og mb oh li oi lm oj lq ok mn ob oc od oe bi translated">如果您有任何问题、意见或改进方案的方法，请联系我们</li></ul></div></div>    
</body>
</html>