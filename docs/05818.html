<html>
<head>
<title>Can we really run AI in the browser?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们真的可以在浏览器中运行 AI 吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/can-we-really-run-ai-in-the-browser-aaf8a5c17d0?source=collection_archive---------65-----------------------#2020-05-13">https://towardsdatascience.com/can-we-really-run-ai-in-the-browser-aaf8a5c17d0?source=collection_archive---------65-----------------------#2020-05-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d85c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们用 tensorflow.js 来探索一下</h2></div><blockquote class="kf kg kh"><p id="d04a" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">这篇文章的目的是看看如何在浏览器中运行深度学习模型，以及这种方法的利弊。要复制的代码可以在<a class="ae lf" href="https://github.com/tdetry/tensorflowJS-in-React" rel="noopener ugc nofollow" target="_blank"> github </a>上找到。</p></blockquote><p id="c594" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">如果我们把人工智能定义为一个经过训练的大模型。这个模型是一个函数<em class="kk"> f() </em>，它接受输入并以结果的形式产生输出，</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lj"><img src="../Images/b5e65ca5b6c9ef3880af23b464f30951.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kam5kW82tG_UpmwnW_XY9w.png"/></div></div></figure><p id="d05c" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">其中<em class="kk"> f() </em>可以表示为下列之一:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lv"><img src="../Images/1de2f0de8e5d1d6badfaf993bf61ca85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Of1g0t-RMAYD6im7tca2DQ.png"/></div></div><p class="lw lx gj gh gi ly lz bd b be z dk translated">神经网络的图形表示。</p></figure><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi ma"><img src="../Images/8450fa3dd23436f920308bf0dfee8f2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RBqqRh7bdYuMr88clyiogA.png"/></div></div><p class="lw lx gj gh gi ly lz bd b be z dk translated">神经网络的抽象。</p></figure><p id="41fc" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">…在我们的浏览器中运行这种<strong class="kl ir">模型有多容易？</strong>这种方法的<strong class="kl ir">优点</strong>和<strong class="kl ir">缺点</strong>是什么？让我们通过尝试来探索。</p><h2 id="1c1e" class="mb mc iq bd md me mf dn mg mh mi dp mj lg mk ml mm lh mn mo mp li mq mr ms mt bi translated">实验</h2><p id="5154" class="pw-post-body-paragraph ki kj iq kl b km mu jr ko kp mv ju kr lg mw ku kv lh mx ky kz li my lc ld le ij bi translated">为此，我使用了<a class="ae lf" href="https://www.tensorflow.org/js" rel="noopener ugc nofollow" target="_blank"> tensorflow.js </a>。我想使用一个预先训练好的模型，这意味着有人已经调整了函数并向其输入数据以获得参数。这些参数可以被视为一个大的数字列表，它将决定如何将输入转换为输出。这个人是好心分享参数和功能。就 Tensorflow 而言，这种情况可能发生在 TensorHub 中。之后，我可以决定改进模型，这将被视为迁移学习，或将其用于手头的任务。</p><p id="8c55" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">让我们采取三个步骤的方法在我们的浏览器中运行这个模型。</p><ol class=""><li id="ec90" class="mz na iq kl b km kn kp kq lg nb lh nc li nd le ne nf ng nh bi translated">理解 Python 中的模型，并将其导出到 Javascript</li></ol><p id="ec37" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">我想尝试用<a class="ae lf" href="https://tfhub.dev/see--/bert-uncased-tf2-qa/1" rel="noopener ugc nofollow" target="_blank">伯特问题&amp;回答</a>，但是我遇到了一些问题。第一个是模型的大小。我不认为我的用户会等待 1gb 的<strong class="kl ir">参数来下载</strong>。在这方面，看起来正在用<a class="ae lf" href="https://www.tensorflow.org/lite/" rel="noopener ugc nofollow" target="_blank"> Tensorflow Lite </a>缩小模型的尺寸。它通过使用<a class="ae lf" href="https://www.tensorflow.org/lite/guide/get_started#quantization" rel="noopener ugc nofollow" target="_blank">量化技术</a>，专注于尺寸/性能优化。</p><p id="a574" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">其次，记号化器是将字母、单词、句子转换成函数可以理解的输入的一段代码。它依靠的是<a class="ae lf" href="https://huggingface.co/" rel="noopener ugc nofollow" target="_blank"> HuggingFace </a>，一个用 Python 写的库。我不太赞成用 Javascript 重写它。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi ni"><img src="../Images/295fbd1131567f6c0d0ee8862edfce8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0CCYgdrCDbOrLagnFxdXw.png"/></div></div><p class="lw lx gj gh gi ly lz bd b be z dk translated">来自<a class="ae lf" href="https://tfhub.dev/see--/bert-uncased-tf2-qa/1" rel="noopener ugc nofollow" target="_blank"> TensorHub </a>的打印屏幕。</p></figure><p id="18b6" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">所以我决定不依靠 TensorHub，而是依靠这个<a class="ae lf" href="https://www.tensorflow.org/tutorials/keras/text_classification" rel="noopener ugc nofollow" target="_blank">教程</a>。我按照所有的步骤从零开始快速训练了一个<em class="kk">小</em>模型。该模型的任务是执行情感分析，并将短句转化为从 0(负面情感)到 1(正面情感)的情感得分。事后，我将其转换为 tensorflow.js 模型。</p><pre class="lk ll lm ln gt nj nk nl nm aw nn bi"><span id="6e27" class="mb mc iq nk b gy no np l nq nr">// Python - save model</span><span id="21af" class="mb mc iq nk b gy ns np l nq nr">import tensorflowjs as tfjs<br/>tfjs.converters.save_keras_model(model, tfjs_target_dir)</span></pre><p id="1a15" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">然后按照文档，在 Javascript 代码中“简单地”这样做来加载模型。</p><pre class="lk ll lm ln gt nj nk nl nm aw nn bi"><span id="5545" class="mb mc iq nk b gy no np l nq nr">// JavaScript - import model<br/><br/>import * as tf from '@tensorflow/tfjs';<br/><br/>const model = await tf.loadLayersModel('https://foo.bar/tfjs_artifacts/model.json');</span></pre><p id="2065" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">然而，在这个过程中我遇到了很多问题(版本控制、层命名、tensorflow.js 中不支持的层等等)。如果你<a class="ae lf" href="https://github.com/tdetry/tensorflowJS-in-React/blob/master/src/index.js#L23" rel="noopener ugc nofollow" target="_blank">钻研代码</a>，你会发现我决定依赖相同的模型，但是被 Google 转换成 Javascript。</p><p id="c26e" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">所以 tensorflow.js 是存在的，但是它没有我们在 tensorflow 中找到的所有功能。</p><p id="6ec2" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">2.用 Javascript 试试这个模型</p><p id="42b2" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">一旦你在浏览器中得到你的模型，还有一些工作要做。您需要确保您收到的输入符合模型的预期，并处理其结果。在那里我得到了 ml5 库的帮助。我没有使用这个库，但它极大地帮助了我理解，为了得到结果，你需要经历这些步骤。</p><pre class="lk ll lm ln gt nj nk nl nm aw nn bi"><span id="9a1e" class="mb mc iq nk b gy no np l nq nr">// <!-- -->JavaScript - get prediction</span><span id="f731" class="mb mc iq nk b gy ns np l nq nr">const predictOut = model.predict(input);</span><span id="4dc8" class="mb mc iq nk b gy ns np l nq nr">const score = predictOut.dataSync()[0];</span><span id="8253" class="mb mc iq nk b gy ns np l nq nr">predictOut.dispose();</span><span id="68de" class="mb mc iq nk b gy ns np l nq nr">input.dispose();</span></pre><p id="61b6" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">这与 Tensorflow 关于将数字转换成 tensors 的故事有关，反之亦然。</p><p id="9cc4" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">3.构建一个小 UI 并公开它</p><p id="082a" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">一旦模型的 Javascript 部分被破解。我将它打包成一个小的 React 应用程序，并使用<a class="ae lf" href="http://surge.sh/" rel="noopener ugc nofollow" target="_blank"> surge.sh </a>让它快速服务。这是结果，一个 Tensorflow 模型直接在你的浏览器中运行，对预测的后端调用为零。</p><div class="nt nu gp gr nv nw"><a href="https://tensorflow-browser.surge.sh/" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">情感检查器</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">使用 Tensorflow 的情感检查器</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">tensorflow-browser.surge.sh</p></div></div><div class="of l"><div class="og l oh oi oj of ok lt nw"/></div></div></a></div><p id="40eb" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">为了繁殖:</p><pre class="lk ll lm ln gt nj nk nl nm aw nn bi"><span id="ec79" class="mb mc iq nk b gy no np l nq nr">// bash</span><span id="4403" class="mb mc iq nk b gy ns np l nq nr"># clone the repository and cd to directory<br/>git clone <a class="ae lf" href="https://github.com/tdetry/tensorflowJS-in-React" rel="noopener ugc nofollow" target="_blank">https://github.com/tdetry/tensorflowJS-in-React</a><br/>cd tensorflowJS-in-React/</span><span id="32b9" class="mb mc iq nk b gy ns np l nq nr"># install the dependancies and build the application<br/>npm i<br/>npm run build</span><span id="7c85" class="mb mc iq nk b gy ns np l nq nr"># expose the build to the internet thanks to surge<br/>cd build<br/>surge</span></pre><h2 id="1667" class="mb mc iq bd md me mf dn mg mh mi dp mj lg mk ml mm lh mn mo mp li mq mr ms mt bi translated">回顾的</h2><p id="1137" class="pw-post-body-paragraph ki kj iq kl b km mu jr ko kp mv ju kr lg mw ku kv lh mx ky kz li my lc ld le ij bi translated">理论上，只要模型不包含太多的参数，它应该可以在浏览器中工作。然而，我们看到<strong class="kl ir">模型的规模</strong>越来越大，例如，新<a class="ae lf" href="https://ai.facebook.com/blog/state-of-the-art-open-source-chatbot" rel="noopener ugc nofollow" target="_blank">脸书聊天机器人</a>的 94 亿个参数。下载所有参数所需的时间将是一个问题。但是对于如此庞大的模型，及时获得预测也将很快成为一个问题，因为输入需要与所有这些参数“相乘”才能获得输出。在这方面，与 Javascript 相比，Web 组装等技术可以用来加快计算速度。正如谷歌地球已经<a class="ae lf" href="https://blog.chromium.org/2019/06/webassembly-brings-google-earth-to-more.html" rel="noopener ugc nofollow" target="_blank">的情况一样。</a></p><p id="0e66" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">问题是，它能否克服网络延迟问题(让计算在后端执行，然后发送到前端)？</p><p id="06ae" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">最后是<strong class="kl ir">隐私和知识产权</strong>部分。从隐私的角度来看，让模型在浏览器中运行对用户来说很棒，因为他不必发送他的个人数据。这些都保存在他的浏览器里。我看到了两个不错的应用。例如，检查你是否有资格获得某些东西(贷款？)而不发送您的完整身份。此外，您可以使用一种模型，允许您通过眼睛或手的移动来浏览，而无需发送您的面部和背景。</p><p id="140c" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">然而，我看到了一个知识产权的风险，因为完整的模型将被发送给用户，用户可能会越过模型许可并将其用于其他目的。</p><h2 id="b2db" class="mb mc iq bd md me mf dn mg mh mi dp mj lg mk ml mm lh mn mo mp li mq mr ms mt bi translated">结论</h2><p id="6195" class="pw-post-body-paragraph ki kj iq kl b km mu jr ko kp mv ju kr lg mw ku kv lh mx ky kz li my lc ld le ij bi translated">让我们回顾一下。</p><p id="7c4d" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">优点:</p><ul class=""><li id="bb9a" class="mz na iq kl b km kn kp kq lg nb lh nc li nd le ol nf ng nh bi translated">数据隐私。你不需要发送你的数据来得到一个预测。</li><li id="97f8" class="mz na iq kl b km om kp on lg oo lh op li oq le ol nf ng nh bi translated">运行时的网络延迟。你不需要依赖网络来接收预测。除了先下载模型。</li></ul><p id="462c" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">缺点:</p><ul class=""><li id="722f" class="mz na iq kl b km kn kp kq lg nb lh nc li nd le ol nf ng nh bi translated">获取模型的网络延迟。模型越大，下载的时间就越多。</li><li id="f6e8" class="mz na iq kl b km om kp on lg oo lh op li oq le ol nf ng nh bi translated">型号 IP。你的完整模型暴露了。</li><li id="821a" class="mz na iq kl b km om kp on lg oo lh op li oq le ol nf ng nh bi translated">预测性能。模型越大，在浏览器中运行的计算就越多。</li><li id="450a" class="mz na iq kl b km om kp on lg oo lh op li oq le ol nf ng nh bi translated">有很好的框架来服务于端点之上的模型，比如服务于的<a class="ae lf" href="https://www.tensorflow.org/tfx/guide/serving" rel="noopener ugc nofollow" target="_blank"> TensorFlow。</a></li><li id="9a90" class="mz na iq kl b km om kp on lg oo lh op li oq le ol nf ng nh bi translated">Javascript 对 ML 的支持相当有限。</li></ul><p id="79fd" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">我希望你喜欢阅读，如果你有问题，评论，我会很乐意在评论中回答。</p><p id="7d5b" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated"><a class="ae lf" href="http://tdetry.net/" rel="noopener ugc nofollow" target="_blank">托马斯</a></p></div></div>    
</body>
</html>