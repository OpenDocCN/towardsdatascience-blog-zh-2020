<html>
<head>
<title>The Crossover: A Profitable Intersection of Asset Prices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">交叉:资产价格的有利可图的交叉点</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/implementing-ma-strategy-a6457f3ebbb9?source=collection_archive---------51-----------------------#2020-06-23">https://towardsdatascience.com/implementing-ma-strategy-a6457f3ebbb9?source=collection_archive---------51-----------------------#2020-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="13f7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python创建移动平均线交易策略</h2></div><p id="9bcb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为一个经济学出身的人，我不禁从金融的角度来看待这个世界。当我决定转向技术分析时，我仍然希望将我的金融领域知识融入到技术部分。交易中的技术分析对我这个位置的很多人来说是一个非常热门的领域，所以我想建立一个带回溯测试的量化交易策略来结合这两个领域。这个项目的完整存储库可以在这里找到。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/bc61cb47e435e0f280ca1fff42102d88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ci8BxmTduBC5x_mL"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@jsnbrsc?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰森·布里斯科</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><ul class=""><li id="a4cb" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated"><em class="me">*免责声明:本博客和交易策略用于教育目的，我不建议用于专业投资** </em></li></ul><h1 id="251e" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated"><strong class="ak">建立投资组合</strong></h1><p id="0c81" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">我们的交易策略将采用各种版本的移动平均线公式，使我们的交易决策适应投资组合中资产价格的行为。我们将从选择多样化的资产组合开始:特斯拉(TSLA)、强生(JNJ)和苹果(AAPL)。这三种资产是蓝筹股，分别是汽车、医疗保健和科技行业的主要驱动力。我们首先使用<em class="me"> yfinance </em>库从一个确定的起点和终点收集历史价格数据。这些作为单独的序列引入，然后合并到一个具有日期时间索引的数据帧中。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nc"><img src="../Images/2201c4350829c7a7bf01483d6e0ba187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4jGJ7D3-htb5aetXPBQUHQ.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/51c16207442e2caf3e1bcc19c9989938.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*9gueHzgmBV48-_9lN67tJg.png"/></div></figure><p id="bdaa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在有超过五年的收盘价(1377个条目)用于我们的策略。</p><h1 id="3736" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">简单移动平均线</h1><p id="eb59" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">因为这是我建立的第一个技术交易策略，我想从一个最古老和直接的方法开始，我们将使用价格的移动平均时间序列来对抗实际价格的趋势。通过对一个时间序列进行移动平均，我们能够大大减少序列中的噪声或方差。这将允许我们以更简单的方式理解资产的长期行为。</p><p id="c94c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用高频算法，交易可以在几分之一秒内发生，或者以长期方式持续多年。我们将采用短期和长期的移动平均线。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ne"><img src="../Images/c3a83a010f36621e43ad4c4c463ee923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y9-Zov9RYCaQTSmPXUhClw.png"/></div></div></figure><p id="8e86" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看看，对于我们投资组合中的一种资产:特斯拉，同一时间序列的这些变化是如何随着时间的推移而变化的。注意简单移动平均线(SMA)是如何随着时间的增长而变得平滑的，这表明价格变动的可变性减少了。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nf"><img src="../Images/3f32d952579d38b1b7d5161226f44e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQyEf9YL_4HuTZBVhzmVZg.png"/></div></div></figure><p id="166d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">重要的是要记住，当我们使用SMA时间序列时，我们实际上落后于原始价格序列。注意橙色的20天SMA是如何在灰色的TSLA价格线的01/15开始日期之后开始的。蓝绿色100天SMA开始得更晚。滞后是由于简单移动平均线的数学本质，但我们不能简单地忽略这种滞后的存在，因为当谈到交易时，时间是最敏感的。那么我们如何解释这种滞后呢？指数移动平均线(EMA)。</p><h1 id="1d02" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">指数移动平均线</h1><p id="2e23" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">EMA和SMA非常相似，除了它有一个额外的衰减参数，α (alpha)。均线有助于限制滞后，因为它更重视最近的观察。SMA只是对观察值进行平均加权。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ng"><img src="../Images/efb5273e564a0dbd9b44b627711f0347.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mVnR0fBaniGW91DIfCK-iQ.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nh"><img src="../Images/f656a0a2acd6f16559fb8daee5a148d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8--dr0mH4U11afe9FyDPg.png"/></div></div></figure><p id="f2ee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到，使用均线可以更同步、更精确地捕捉方差减少的时间序列。现在我们有了一个好的数据结构，我们将继续发展我们的交易策略。</p><h1 id="39df" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">制定贸易战略</h1><p id="56d7" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">如上所述，均线和均线都滞后于资产的实际价格。换句话说，资产的<strong class="kk iu">实际</strong>价格比移动平均价格变化快得多。因为实际价格更敏感，我们可以用两者的交叉点(实际价格和均线)来表示做空(卖出)或做多(买入)。</p><ul class=""><li id="05f0" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated">当原始资产价格从低于的<strong class="kk iu">穿过均线系列时，我们将卖出所有空头头寸，买入一个单位的多头头寸</strong></li><li id="38d1" class="lv lw it kk b kl ni ko nj kr nk kv nl kz nm ld ma mb mc md bi translated">当原始资产从上方的<strong class="kk iu">穿过均线系列时，我们会平仓，通过卖出一个单位的资产来做空</strong></li></ul><p id="4ccc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">注意:</strong>我们不考虑仓位大小。我们假设我们的可用资本被完全使用，并且在我们投资组合的三种资产中平均分配(1/3)。在多头条件下，每项资产的权重为1/3，而空头条件下的权重为-1/3。</p><p id="0f87" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们用原始价格和均线序列之间的差异来表示我们所有的资金都被使用了，不管是多头还是空头。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nn"><img src="../Images/b21cbb2ac203e77dfcda024898f42a03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-df88ZecdkRCHO8A8uXVcg.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi no"><img src="../Images/4e139a0d496e1774a4c9d75e1a589ace.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*b_notTyV7GEy5fE3FODqjw.png"/></div></div></figure><p id="7c92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将为我们提供一个包含价格差异的新数据框架，但我们确实希望将价格差异反映为“买入”或“卖出”的信号。我们可以使用一个<em class="me"> numpy </em>方法来分配这些。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nn"><img src="../Images/d2ec5c9ad5b838482af84e0dad3dfa85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lGBvfxtIepSAIOzxRjbeSg.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/44e47b76b116659b3066afe8c64ce06b.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*4gHpM-FyGJfuDNlCat6AkQ.png"/></div></figure><p id="4eb4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">重要提示:</strong>因为我们使用的是原始时间序列中资产的“收盘”价格，我们实际上并不知道该价格高于均线价格。假设我们有一个多头头寸实际上与我们模型的数学不一致。只能假设收盘时我们<strong class="kk iu">会</strong>做多，也就是说明天的开仓也会做多。明天做多可以通过将我们的头寸向前移动一天来表示。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nq"><img src="../Images/5de273db05cfb8837e1692967e3be235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eXH2paTMlQL2Pn-9HmP_yw.png"/></div></div></figure><p id="7a83" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看我们的均线和原始资产价格是什么样的。我们还将绘制信号的时间序列，看看我们的头寸在日期窗口的过程中是如何变化的。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nr"><img src="../Images/5e31aad62cc3fe549173bfea11d3afc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IEYapIUFmPxOj0HOuvw5Yg.png"/></div></div></figure><p id="e615" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">记住，我们的多头买入头寸用正的1/3 (0.333)来表示，而我们的卖出头寸用负的1/3(0.333)来表示(T2)。我们现在有了整个系列的投资组合交易头寸的可视化表示。</p><h1 id="49c5" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">回溯测试我们的策略</h1><p id="f153" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">我们的策略独立对待每项资产，我们对一项资产的头寸不会影响其他资产的头寸。我们将使用这些信息，通过连续对数观测值的差异来获得我们的投资组合回报。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nn"><img src="../Images/50fff06fcf15cc769586649244a9530c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1qjnAXQMRzRIqp-Dhe2Eig.png"/></div></div></figure><p id="be6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在整个时间段的总回报要求我们将持仓数据框架乘以资产的对数回报数据框架。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ns"><img src="../Images/3e7b30b84078b615da190fb5ad297e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xHOFVoVERo-82geIYVBoJw.png"/></div></div></figure><p id="ee73" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的数据框架现在包含了每个单个条目的回报，但是我们必须使用累计总和来查看总回报。然后，我们使用<em class="me"> numpy </em>将这些回报转换成相对回报。然后，我们将绘制出我们每项资产的累积对数收益以及它们的相对收益。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nq"><img src="../Images/df5a707b6bdedf28244dd269032dc6c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FuZUdh7U0Jr_W3UZUdw2tg.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nt"><img src="../Images/42e8ccb4844eefe80aa24d42de9078c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Tk2PpSr-lfsjp3hfgu7Dw.png"/></div></div></figure><p id="a8d0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将把所有的对数收益相加，然后把它们转换成相对收益，从而得到一个统计上精确的收益近似值。绘制时，请记住这些值代表百分比，因此不要忘记将系列y值乘以100以获得准确的数字。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nu"><img src="../Images/33d4f526c632b211c9d2720efabfef18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DTpTEZ0hxinwZZxc-NEC1w.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nv"><img src="../Images/3fe37082e627b289727759ae6fc8648f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uEq3qu-u_ljGxfontz3geg.png"/></div></div></figure><h1 id="d0a0" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">决赛成绩</h1><p id="0ccb" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">现在我们有了回报，我们现在可以使用复合回报假设来返回我们的终身投资组合回报以及我们的平均年回报。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nw"><img src="../Images/3c824869f5a61b17fed8c3c5a9aba5b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j21kouGHy4FAXjNsJ8Knyg.png"/></div></div></figure><ul class=""><li id="e04d" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated"><strong class="kk iu">终身投资组合回报率= </strong> 79.31%</li><li id="967b" class="lv lw it kk b kl ni ko nj kr nk kv nl kz nm ld ma mb mc md bi translated"><strong class="kk iu">平均。年回报率= </strong> 11.66%</li></ul><p id="5235" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">自1962年以来，美国股票的平均年回报率约为11%。这意味着我们的移动平均策略将允许您的投资组合每年获得“平均”回报。现在，这些只是市场上市值最大的三只股票。一个真正的投资组合将更加多样化，并需要尽职调查来保证高回报。我们的交易策略也做了很多假设，可以改进，但希望这是对金融工具进行技术分析的一个强有力的起点。</p><p id="f6b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="me">来自《走向数据科学》编辑的提示:</em> </strong> <em class="me">虽然我们允许独立作者根据我们的</em> <a class="ae le" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="me">规则和指导方针</em> </a> <em class="me">发表文章，但我们并不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae le" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="me">读者术语</em> </a> <em class="me">。</em></p></div></div>    
</body>
</html>