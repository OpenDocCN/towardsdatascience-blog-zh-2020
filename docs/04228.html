<html>
<head>
<title>Urban Logistics Network Simulation in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Python的城市物流网络仿真</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/urban-logistics-network-simulation-in-python-60b0132375f9?source=collection_archive---------17-----------------------#2020-04-17">https://towardsdatascience.com/urban-logistics-network-simulation-in-python-60b0132375f9?source=collection_archive---------17-----------------------#2020-04-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c8d6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">使用SimPy、OSMnx和fleet . js构建Anylogic的GIS功能</em></h2></div><p id="2781" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><a class="ae lf" href="https://www.anylogic.com/" rel="noopener ugc nofollow" target="_blank"> Anylogic </a>可能是目前最流行的物流应用模拟软件包之一。一个非常好而且非常独特的特性是可以将GIS地图包含到模拟模型中。它允许在地图上放置模拟元素，并根据真实的空间信息沿现有路线移动它们。这很酷，因为它可以用来模拟整个供应链，包括为复杂的问题提供一个伟大的，有形的可视化的手段。例如，<a class="ae lf" href="https://fladdimir.github.io/publication/i3m2017/" rel="noopener ugc nofollow" target="_blank">项目</a>使用<em class="lg"> Anylogic </em>评估法国格勒诺布尔市中心更可持续的城市物流网络的不同设计和交付方案。数据驱动的模拟模型允许计算多层供应链网络中各种转运节点位置和不同类型运输设备的KPI。</p><p id="c029" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">随着该功能的成功，Anylogic的家伙们甚至构建了<a class="ae lf" href="https://www.anylogistix.com/" rel="noopener ugc nofollow" target="_blank">anylistix</a>，将预先构建的&amp;可定制模拟模型与商业求解器相结合，用于集成供应链规划&amp;优化。</p><p id="01c3" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">显然，那些商业特性是有代价的，所以我们来看看这种模式是否也可以用不同的手段来实现。</p><p id="10a2" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><a class="ae lf" href="https://github.com/fladdimir/csa-streetmap" rel="noopener ugc nofollow" target="_blank"> <em class="lg">从github获取回购。</em>T13】</a></p></div><div class="ab cl lh li hx lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="im in io ip iq"><h1 id="19ae" class="lo lp it bd lq lr ls lt lu lv lw lx ly jz lz ka ma kc mb kd mc kf md kg me mf bi translated">场景和范围</h1><p id="0b9e" class="pw-post-body-paragraph kj kk it kl b km mg ju ko kp mh jx kr ks mi ku kv kw mj ky kz la mk lc ld le im bi translated">这个职位的模拟模型将基于一个小型的案例研究。</p><p id="d854" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">面对人类越来越习惯于甚至是日常必需品的送货上门这一事实，汉堡阿尔托纳的法国面包店<a class="ae lf" href="http://www.die-patisserie.de/de_DE" rel="noopener ugc nofollow" target="_blank"> Die Patisserie </a>想要为附近的顾客提供甜点。</p><p id="36e8" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">确定了3个主要购买者:失物招领处<a class="ae lf" href="https://www.hamburg.de/altona/fundbuero/" rel="noopener ugc nofollow" target="_blank">中央基金会</a>、<a class="ae lf" href="https://www.monkeys-hamburg.de/" rel="noopener ugc nofollow" target="_blank">猴子音乐俱乐部</a>和出版社<a class="ae lf" href="https://www.carlsen.de/node/18749" rel="noopener ugc nofollow" target="_blank">卡尔森出版社</a>。</p><p id="9c96" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">不同位置的坐标(纬度、经度):</p><ol class=""><li id="182c" class="ml mm it kl b km kn kp kq ks mn kw mo la mp le mq mr ms mt bi translated">法式蛋糕店(53.55668，9.92815)</li><li id="dac4" class="ml mm it kl b km mu kp mv ks mw kw mx la my le mq mr ms mt bi translated">中央公园(53.55817，9.92829)</li><li id="c56f" class="ml mm it kl b km mu kp mv ks mw kw mx la my le mq mr ms mt bi translated">猴子音乐俱乐部(53.55706，9.93161)</li><li id="a412" class="ml mm it kl b km mu kp mv ks mw kw mx la my le mq mr ms mt bi translated">卡尔森出版社(53.55703，9.92684)</li></ol><p id="e407" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">为了简单起见，假设访问节点的顺序是固定的。旅游的起点和终点都在蛋糕店(1。):</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/70d360a0cb32155f924823a1d905712b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*33hXrWg4Cro3yATsG9qXfw.jpeg"/></div><p class="nh ni gj gh gi nj nk bd b be z dk translated">作为旅程的一部分要访问的节点</p></figure></div><div class="ab cl lh li hx lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="im in io ip iq"><h1 id="e5c0" class="lo lp it bd lq lr ls lt lu lv lw lx ly jz lz ka ma kc mb kd mc kf md kg me mf bi translated">仿真模型</h1><p id="7b95" class="pw-post-body-paragraph kj kk it kl b km mg ju ko kp mh jx kr ks mi ku kv kw mj ky kz la mk lc ld le im bi translated">简单场景的模拟模型是通过以下方式创建的:</p><ul class=""><li id="0b01" class="ml mm it kl b km kn kp kq ks mn kw mo la mp le nl mr ms mt bi translated">用于检索地理信息和计算最短路径的OS mnx/networkx(Python)</li><li id="8cbc" class="ml mm it kl b km mu kp mv ks mw kw mx la my le nl mr ms mt bi translated">SimPy/Casymda用于模拟游览(Python)</li><li id="14c6" class="ml mm it kl b km mu kp mv ks mw kw mx la my le nl mr ms mt bi translated">基于浏览器的动画(JavaScript)的传单. js</li></ul><h1 id="740a" class="lo lp it bd lq lr nm lt lu lv nn lx ly jz no ka ma kc np kd mc kf nq kg me mf bi translated">1.OSMnx</h1><p id="7192" class="pw-post-body-paragraph kj kk it kl b km mg ju ko kp mh jx kr ks mi ku kv kw mj ky kz la mk lc ld le im bi translated">令人惊叹的OS mnx T1包提供了从OpenStreetMap获取街道网络的T2网络图T3的可能性。通过指定要包括的OSM节点的中心和距离，可以获得我们场景的相关部分:</p><pre class="na nb nc nd gt nr ns nt nu aw nv bi"><span id="7442" class="nw lp it ns b gy nx ny l nz oa">CENTER = (53.55668, 9.92815)  <br/>DISTANCE = 300<br/>G = ox.graph_from_point(CENTER, distance=DISTANCE, network_type='drive')</span></pre><p id="8b02" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">OSMnx让我们为旅游的4个地点中的每一个选择最近的OSM节点，并且还提供了绘制网络的方便方法。蓝点代表由边连接的OSM节点。4个相关位置以红色显示:</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/a108c293a90ad867f757446c504aab9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*taCOLEnlAoeRmPtXyQ-OMw.jpeg"/></div><p class="nh ni gj gh gi nj nk bd b be z dk translated">提取的街道网络的OSMnx图</p></figure><p id="8746" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">为了准备仿真模型所需的所有信息，现在使用networkx计算网络中4个相关节点之间的所有最短路径，并且包括每条路线的所有分段线性段的详细信息。结果被保存到磁盘上，以避免每次运行模型时进行提取和重新计算(当然，这也是为了尽可能降低OSM服务器的负载)。</p><p id="b107" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">上述方法可以被改进，例如，通过从给定的相关位置自动确定要加载的区域。不是为每个相关位置选择最近的OSM节点，而是首先寻找网络中最近的边会更精确。随着网络规模的增长，从OSM服务器直接查询相关节点之间的最短路径可能是一个更好的主意，而不是获取整个网络(Anylogic似乎就是这样做的)。</p><h1 id="7c7b" class="lo lp it bd lq lr nm lt lu lv nn lx ly jz no ka ma kc np kd mc kf nq kg me mf bi translated">2.Casymda/SimPy</h1><p id="290a" class="pw-post-body-paragraph kj kk it kl b km mg ju ko kp mh jx kr ks mi ku kv kw mj ky kz la mk lc ld le im bi translated"><a class="ae lf" href="https://pypi.org/project/casymda/" rel="noopener ugc nofollow" target="_blank"> Casymda </a>在<a class="ae lf" href="https://pypi.org/project/simpy/" rel="noopener ugc nofollow" target="_blank"> SimPy </a>之上提供了基于块的离散事件模拟模型建模。<br/>我们的模型可以用一个简单的流程来描述:</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/d5f1a6ae941cdb71091342b4bb8c74b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*jfHxTYSKAyQIXIZgZFtiZg.png"/></div><p class="nh ni gj gh gi nj nk bd b be z dk translated">模拟的流程模型</p></figure><p id="1be5" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">卡车实体在参数化的<code class="fe od oe of ns b">Source</code>中创建，然后在自定义的<code class="fe od oe of ns b">DriveTour</code>模块中处理，该模块包含根据路线长度和卡车移动速度计算时间的逻辑。它还提供了为动画计算中间实体位置的选项(时间间隔取决于模拟运行的实时因子)。模拟模型也可以在不调度任何动画相关行为的情况下运行，以最小化执行时间。要访问的节点及其顺序通过文本注释<code class="fe od oe of ns b">stops=["ZFB", "MMC", "CAV"]</code>指定。</p><p id="d7bc" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">动画是通过<a class="ae lf" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank"> flask </a>暴露信息和资源实现的(类似于<a class="ae lf" href="https://fladdimir.github.io/post/casymda/" rel="noopener ugc nofollow" target="_blank">本帖</a>中描述的基于<em class="lg"> tile-map </em>的<em class="lg"> </em>动画)。</p><h1 id="5ccb" class="lo lp it bd lq lr nm lt lu lv nn lx ly jz no ka ma kc np kd mc kf nq kg me mf bi translated">3.传单. js</h1><p id="af6a" class="pw-post-body-paragraph kj kk it kl b km mg ju ko kp mh jx kr ks mi ku kv kw mj ky kz la mk lc ld le im bi translated">为了可视化地图上节点和实体的位置，<a class="ae lf" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank">传单</a>只需要几行。为了设置旋转角度，有一个<a class="ae lf" href="https://github.com/bbecquet/Leaflet.RotatedMarker" rel="noopener ugc nofollow" target="_blank">旋转。标记插件</a>满足我们的需求。</p><pre class="na nb nc nd gt nr ns nt nu aw nv bi"><span id="c9f6" class="nw lp it ns b gy nx ny l nz oa">marker = L.marker(element.coords, { icon: new L.Icon({iconUrl: element.icon_path}) }).addTo(map);<br/>marker.bindPopup(element.text);<br/>marker.setRotationAngle(element.direction);</span></pre></div><div class="ab cl lh li hx lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="im in io ip iq"><h1 id="cc23" class="lo lp it bd lq lr ls lt lu lv lw lx ly jz lz ka ma kc mb kd mc kf md kg me mf bi translated">结果</h1><p id="de5e" class="pw-post-body-paragraph kj kk it kl b km mg ju ko kp mh jx kr ks mi ku kv kw mj ky kz la mk lc ld le im bi translated">从克隆的存储库中通过<a class="ae lf" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>运行模拟:</p><pre class="na nb nc nd gt nr ns nt nu aw nv bi"><span id="65e3" class="nw lp it ns b gy nx ny l nz oa">docker-compose up geo-web-animation</span></pre><p id="9a0c" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">下面的截屏显示了一辆卡车按照定义的顺序(<em class="lg"> Patisserie —失物招领—Monkey ' s—Carlsen Publishing—Patisserie</em>)访问所有节点的完整旅程。单行道被正确地考虑在内，例如当从<em class="lg">猴子音乐俱乐部</em> (3。，最右边的节点)到<em class="lg">卡尔森出版社</em> (4。最左边的节点)沿着<em class="lg">线。</em></p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi og"><img src="../Images/0069777e54dae9b9763c454e19683391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ifSSSXO7xpUrDGznZWFSXg.gif"/></div></div><p class="nh ni gj gh gi nj nk bd b be z dk translated">基于浏览器的动画的屏幕截图</p></figure></div></div>    
</body>
</html>