<html>
<head>
<title>Time series anomaly detection with “anomalize” library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于“异常化”库的时间序列异常检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-anomaly-detection-with-anomalize-library-67472003c003?source=collection_archive---------23-----------------------#2020-09-17">https://towardsdatascience.com/time-series-anomaly-detection-with-anomalize-library-67472003c003?source=collection_archive---------23-----------------------#2020-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="19ea" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">时间序列异常检测的 3 个简单步骤</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/15329b97d2ae2223bdb416fae5d6c5ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M7DXGBDG6crlr9dz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@srosinger3997?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Samantha Gades </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="6b48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列数据具有广泛的应用案例，从跟踪关键绩效指标(KPI)和了解业务趋势到高级建模和预测。异常检测就是这样一种有用的应用。信用卡欺诈检测等业务应用需要强大的技术，这些技术可以将时间序列数据作为输入，并实时识别异常情况。</p><p id="0cd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">异常检测是一个经过充分研究的领域，有许多可用的工具和技术。有很多用于异常检测的 R 包，例如<code class="fe lv lw lx ly b">tsoutlier</code>和<code class="fe lv lw lx ly b">AnomalyDetection.</code>,但是，我最近开始相信<code class="fe lv lw lx ly b"><a class="ae ky" href="https://cran.r-project.org/web/packages/anomalize/index.html" rel="noopener ugc nofollow" target="_blank">anomalize</a></code>是最直观、最易于使用的库——对于新手和高级数据科学家都是如此。</p><p id="7119" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以今天这篇文章的目的是用三个简单的步骤来演示<code class="fe lv lw lx ly b">anomalize</code>异常检测库的实现。</p><p id="bf51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始吧。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="364d" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">步骤 1:安装库并准备数据</h1><p id="dee2" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">就像任何其他机器学习算法一样，准备数据可能是异常检测中最重要的一步。但是从积极的方面来看，您可能一次只使用一列。因此，与其他机器学习技术中的数百个特征不同，您可以只关注用于建模的一列。</p><p id="8b4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保您完成了通常的数据清理和准备程序，例如处理丢失的值等。一个重要的步骤是确保数据集最终在一个<em class="nd">tible</em>或<em class="nd"> tbl_time </em>对象中。</p><p id="2a3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先安装我们将需要的库:</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="68fa" class="ni mh it ly b gy nj nk l nl nm"># install libraries<br/>library(anomalize)<br/>library(tidyverse)<br/>library(tibbletime)<br/>library(tidyquant)</span></pre><p id="0126" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个演示，我们运气不错，不需要数据处理。我们将使用<code class="fe lv lw lx ly b">tidyquant</code>库获取股票价格数据。</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="d1e5" class="ni mh it ly b gy nj nk l nl nm"># fetch data<br/>data &lt;- tq_get('AAPL',<br/>               from = "2019-09-01",<br/>               to = "2020-02-28",<br/>               get = "stock.prices")</span><span id="3af0" class="ni mh it ly b gy nn nk l nl nm"># take a peek<br/>head(data)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/46f7955b13ec07393049867a074d1896.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*zgyLCjxQ7D8ZtR3gFlsxTQ.png"/></div></figure><h1 id="d667" class="mg mh it bd mi mj np ml mm mn nq mp mq jz nr ka ms kc ns kd mu kf nt kg mw mx bi translated">第二步:执行<code class="fe lv lw lx ly b">anomalize</code></h1><p id="231b" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">首先，让我们用刚刚获取的数据实现<code class="fe lv lw lx ly b">anomalize</code>,然后讨论发生了什么。</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="8991" class="ni mh it ly b gy nj nk l nl nm"># anomalize <br/>anomalized &lt;- data %&gt;% <br/>  time_decompose(close) %&gt;%<br/>  anomalize(remainder) %&gt;%<br/>  time_recompose()</span></pre><p id="a109" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里很少发生什么事情，库接收输入数据并对其应用三个独立的函数。</p><p id="fb46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，<code class="fe lv lw lx ly b">time_decompose()</code>函数将时间序列数据的“收盘”列分解为“观察”、“季节”、“趋势”和“余数”分量。</p><p id="714b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其次，<code class="fe lv lw lx ly b">anomalize()</code>函数对“余数”列执行异常检测，并在 3 列中给出输出:“余数 _l1”、“余数 _l2”和“异常”。这里的最后一列是我们想要的，如果观察结果是异常的，那么它是“是”,对于正常的数据点，它是“否”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/e2d3d895ebce0b60eff954425852dda6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*hFRo4ifw7XihNn6aFsnBTA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">异常实现的输出</p></figure><p id="45ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一个函数<code class="fe lv lw lx ly b">time_recompose()</code>通过重新组合之前创建的“trend”和“season”列，将所有内容重新整理好。</p><h1 id="2acb" class="mg mh it bd mi mj np ml mm mn nq mp mq jz nr ka ms kc ns kd mu kf nt kg mw mx bi translated">步骤 3:绘制异常数据</h1><p id="1cc3" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">实际上，我们的异常检测已经在前一步完成了。但是我们仍然需要将数据和异常现象可视化。让我们这样做，并直观地检查出异常值。</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="4881" class="ni mh it ly b gy nj nk l nl nm"># plot data with anomalies<br/>anomalized %&gt;%<br/>  plot_anomalies(time_recomposed = TRUE, ncol = 3, alpha_dots = 0.25) + labs(title = "AAPL Anomalies")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/98cffe3a2cb7212f664074445cc52786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-xq3rwP5_lXuO2UsOO4XA.png"/></div></div></figure><p id="dcd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个图非常直观。每个点是数据集中观察到的数据点，红色圆圈是模型识别的异常。阴影区域是余数的上限和下限。</p><h1 id="df93" class="mg mh it bd mi mj np ml mm mn nq mp mq jz nr ka ms kc ns kd mu kf nt kg mw mx bi translated">下一步是什么？</h1><p id="16c1" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如果到目前为止，您已经通过三个简单的步骤成功地实现了复杂的异常检测技术。这很简单，因为我们使用了默认参数，没有做任何改变。正如我们在上图中看到的，这个<em class="nd">开箱即用</em>模型在检测异常值方面表现得非常好。但是，您可能会遇到复杂的时间序列数据，这需要通过在步骤 2 中调整参数来提高模型性能。您可以阅读<a class="ae ky" href="https://cran.r-project.org/web/packages/anomalize/index.html" rel="noopener ugc nofollow" target="_blank">模型文档</a>和<a class="ae ky" href="https://business-science.github.io/anomalize/articles/anomalize_quick_start_guide.html" rel="noopener ugc nofollow" target="_blank">快速入门指南</a>来了解参数、它们的作用以及如何&amp;何时改变它们。</p><p id="1ce1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这篇文章，你可以在 Twitter 或 LinkedIn 上关注我。</p></div></div>    
</body>
</html>