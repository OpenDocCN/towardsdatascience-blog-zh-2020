<html>
<head>
<title>Regression on Sparks MLlib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Sparks MLlib上的回归</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/regression-on-sparks-mllib-8107e8390253?source=collection_archive---------51-----------------------#2020-05-07">https://towardsdatascience.com/regression-on-sparks-mllib-8107e8390253?source=collection_archive---------51-----------------------#2020-05-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="33df" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用MLlib API的简短示例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f6ce3ce5431831354523317a4544ecfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZDBLl7aaZUQPoyWy"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@thisisengineering?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> ThisisEngineering RAEng </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a>【1】上拍摄</p></figure><p id="ccc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想分享一个关于在Spark + Scala上使用MLlib的PoC(概念验证)的(非常)小的开发。在这种情况下，我们希望使用MLlib对一些数据执行一些机器学习算法。我们将使用一个(非常)小的数据集，例如，kaggle.com上<a class="ae ky" href="https://www.kaggle.com/leonardopena/top50spotify2019" rel="noopener ugc nofollow" target="_blank">列奥纳多的数据集。有了数据和目标(在Spark + Scala上使用MLlib)，让我们创建这个PoC。</a></p><p id="3925" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">快速查看数据后，结论是:大多数列都是数字。所有这些数字栏都可以预测，但是有一个，它的名字使它成为被选中的一个:受欢迎程度。我们可以“执行”那个“机器学习例子”来预测受欢迎程度的值。</p><p id="abb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">流行度是一个结果(目标变量)，它独立于其他结果，但(很可能)依赖于某些特性(变量/特征)。为了预测(未来)受欢迎程度的结果，受欢迎程度是一个数字目标，使用接收到的特征，也是数字的，我们可以使用线性回归。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/74b350dfc63d7139af34c9364175edf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JYbymHifAk7aQ1pHm_IdMQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://creativecommons.org/licenses/by-sa/3.0/" rel="noopener ugc nofollow" target="_blank"> Kenneth Jensens图片</a>描述CRISP-DM的步骤[2]</p></figure><p id="9ae0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来一点理论，这样我们可以用一个潮流来装扮这些断言。我们需要一种简短、实用的方法来从某个事物的示例(PoC)中得出可验证的结果。而且兴趣在需求量很大的TIC领域，大数据(以数据工程师为代表)和数据科学(以数据科学家为代表)。</p><p id="8b4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个框架，并在选定的数据集上采用<a class="ae ky" rel="noopener" target="_blank" href="/crisp-dm-methodology-leader-in-data-mining-and-big-data-467efd3d3781"> CRIPS-DM的前两步</a> [3]，我们构思了一个<em class="lw">假设</em>，即:“一首歌的流行程度在某种程度上是这首歌的其他特征的结果”。当你有指示目标变量的(先前)数据时，从其他特征中预测目标变量，被称为<em class="lw">监督学习。</em></p><p id="1e08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如数据理解步骤向我们展示的，大多数列没有分类值，而是连续数值，包括目标变量。这支持了使用算法(CRIPS-DM的<em class="lw">建模</em>步骤)如线性回归来预测(计算)一首歌的流行度的想法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lx"><img src="../Images/aa60780aa94e0fdca532b035b4c06801.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QchRHkIiau1ULvS7gy616w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">线性回归公式由<a class="ae ky" href="https://medium.com/@lwjirl" rel="noopener">以色列罗德里格斯</a></p></figure><p id="fbeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在线性回归中，我们通过以下方式计算因变量(目标值/结果):将特定(计算)系数乘以与该系数相关的自变量(特征/变量)的结果相加(B1 * X1+B2 * X2+……)，加上截距点，再加上随机误差。所有这些都是数值。</p><p id="4a73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，我们已经以非正式的日常方式和技术性的方式提到了什么是动机、目标以及我们将如何实现这些目标。让我们开始吧。</p><p id="6a61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MLlib中的线性回归算法接收libsvm数据作为参数。所以第一步是将CSV文件转换成libsvm。这一步被称为CRIPS-DM方法论的数据准备。</p><p id="5210" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将删除string(几个字母的数据类型)列和id列，这样做时，我们将面临这样的问题:列名中的点需要在Spark[4]中进行特殊处理。因此，我们首先删除点，然后删除列，最后使用MLlib的<em class="lw">汇编器. transform </em>函数将数据转换为libsvm格式。</p><p id="bb31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是创建模型的时候了，只有很少的几行。但在此之前，我们先把数据随机分为训练和测试，然后，用训练数据来拟合模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">飞度造型由<a class="ae ky" href="https://medium.com/@lwjirl" rel="noopener">伊斯罗德里格</a></p></figure><p id="c4ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将来自<em class="lw"> model_data </em>函数的模型保存在<em class="lw"> val </em>中，并使用它在我们的测试数据上创建一个预测列。我们的第一个模型的RMSD为4(受欢迎程度)，它对测试数据的预测如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ma"><img src="../Images/395503f21131d4321542d243a2d0e816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KJs_rLsROmE0D2hPBpj8Eg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://medium.com/@lwjirl" rel="noopener">以色列罗德里格斯</a>对比预测值与实际值</p></figure><p id="843f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">定义CRISP-DM <em class="lw">评估</em>步骤是为了确保模型的正确性。根据业务情况和误差大小，这些结果可能被视为可接受的结果，也可能不被视为可接受的结果。</p><p id="774c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了改善这一结果，我们可以:标准化(均值为0，标准差为1)我们的数据，我们可以将分类值转换为因子(摇滚= 1，流行= 2，…)，我们应该使用更大的数据集，我们可以丢弃异常值，我们可以对判别变量(例如音乐流派流行度模型)进行特定研究，等等。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按<a class="ae ky" href="https://medium.com/@lwjirl" rel="noopener">以色列罗德里格斯</a>分割数据</p></figure><p id="f2e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，为了评估，有一些重要的事情需要考虑:实验应该是可复制的。</p><p id="7bf4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用于将数据分割成测试和训练数据集的命令不允许我们在每个实验中为每一侧获取完全相同的行。所以每次我们执行实验，我们都会有(稍微)不同的结果。这是不可取的，因为我们将不能正确地度量模型的改进，或者缺少改进。</p><p id="5dee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们能做的是:降低模型的(平均)RMSD。要减少模型的RMSD，最好的办法是移除数据集的异常值(在这种情况下)。</p><p id="1d57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须考虑到:我们可以通过减少RMSD来改善结果，但我们不能将其减少到零，因为这将意味着模型过度拟合。</p><p id="c8cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当模型对于给定的数据集是完美的时，就会发生过度拟合，这通常意味着与没有过度拟合的模型相比，与任何其他数据集的误差水平都会更大。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/4680c07be9977f7c35376f8fe2ae05ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_zNz3OJtnDN6tcjyPjYXKQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://commons.wikimedia.org/wiki/User:Gufosowa" rel="noopener ugc nofollow" target="_blank"> Gufosowa </a>图为k倍交叉验证图[5]</p></figure><p id="a02a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">评估模型是否过度拟合的一个好方法是检查训练和测试数据集之间的误差水平，并通过不同的数据样本交叉验证误差。</p><p id="8e36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，我们会接受一定程度的误差以避免过度拟合，但也不接受欠拟合。很难找到一个好的中间点。我们可以继续寻找完美的中间点，但我们不会在这个故事中这样做，因为目标是“在Spark + Scala上使用MLlib”，并且已经实现了。</p><p id="f1e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读这个故事:)。</p><p id="ccbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在Prezi上找到这个故事的一个(非常)小的演示:【https://prezi.com/tozutehrcojn/?utm_campaign=share】T2&amp;UTM _ medium = copy</p><p id="ce45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参考资料:</p><p id="60f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[1]<a class="ae ky" href="https://unsplash.com/@thisisengineering" rel="noopener ugc nofollow" target="_blank">this is engineering RAEng</a>，女航天工程师写方程(2020)，网址:<a class="ae ky" href="https://unsplash.com/photos/GzDrm7SYQ0g" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/GzDrm7SYQ0g</a></p><p id="132b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2] Kenneth Jensens，显示CRISP-DM (2012)不同阶段之间关系的流程图，URL:<a class="ae ky" href="https://en.wikipedia.org/wiki/Cross-industry_standard_process_for_data_mining#/media/File:CRISP-DM_Process_Diagram.png" rel="noopener ugc nofollow" target="_blank">https://es . Wikipedia . org/wiki/Cross _ Industry _ Standard _ Process _ for _ Data _ Mining #/media/Archivo:CRISP-DM _ Process _ diagram . png</a></p><p id="0bf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3] <a class="ae ky" href="https://towardsdatascience.com/@lwjirl?source=post_page-----467efd3d3781----------------------" rel="noopener" target="_blank"> Israel Rodrigues </a>，CRISP-DM方法论在数据挖掘和大数据领域的领导者(2020)，网址:<a class="ae ky" rel="noopener" target="_blank" href="/crisp-dm-methodology-leader-in-data-mining-and-big-data-467efd3d3781">https://towardsdatascience . com/CRISP-DM-methodology-leader-in-data-mining-and-big-data-467 EFD 3d 3781</a></p><p id="2da7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[4]贾亚德万·issues.apache.org，“当试图从包含列的数据帧中进行选择时。在它里面，是抛出异常”(2016)，网址:【https://issues.apache.org/jira/browse/SPARK-13197<a class="ae ky" href="https://issues.apache.org/jira/browse/SPARK-13197" rel="noopener ugc nofollow" target="_blank"/></p><p id="4bf6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[5] <a class="ae ky" href="https://commons.wikimedia.org/wiki/User:Gufosowa" rel="noopener ugc nofollow" target="_blank"> Gufosowa </a>，k倍交叉验证图。(2019)，网址:<a class="ae ky" href="https://en.wikipedia.org/wiki/Cross-validation_(statistics)#/media/File:K-fold_cross_validation_EN.svg" rel="noopener ugc nofollow" target="_blank">https://es . Wikipedia . org/wiki/Cross _ Industry _ Standard _ Process _ for _ Data _ Mining #/media/Archivo:CRISP-DM _ Process _ diagram . png</a></p></div></div>    
</body>
</html>