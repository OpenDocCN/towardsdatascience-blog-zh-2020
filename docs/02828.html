<html>
<head>
<title>Forecasting Average Daily Rate Trends For Hotels Using LSTM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用LSTM预测酒店的平均每日房价趋势</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/forecasting-average-daily-rate-trends-for-hotels-using-lstm-93a31e01190a?source=collection_archive---------28-----------------------#2020-03-18">https://towardsdatascience.com/forecasting-average-daily-rate-trends-for-hotels-using-lstm-93a31e01190a?source=collection_archive---------28-----------------------#2020-03-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cf1d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以下是如何使用LSTM模型来预测酒店的ADR(平均每日房价),这是业内的一个重要指标。</h2></div><p id="1fae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">平均每日房价(ADR)被认为是酒店最重要的<a class="ae le" href="https://roompricegenie.com/average-rate-adr/" rel="noopener ugc nofollow" target="_blank">指标之一。</a></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/a97bc27eb739b59577d4e685a834ed0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0TjrHBlY2DJF38_8gT-lrg.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">资料来源:pixabay.com</p></figure><p id="8c66" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其计算方法如下:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="b58c" class="ma mb it lw b gy mc md l me mf">ADR = Revenue ÷ sold rooms</span></pre><p id="097f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">实质上，ADR是衡量一个酒店房间在特定时期的平均价格。</p><h1 id="c8fa" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">背景</h1><p id="28df" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">正在研究的<a class="ae le" href="https://www.sciencedirect.com/science/article/pii/S2352340918315191" rel="noopener ugc nofollow" target="_blank">数据集</a>由一家葡萄牙酒店的取消预订组成，其中包括每个单独预订的ADR作为包含变量之一。</p><p id="ab54" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用时间序列分析，我们假设酒店希望1)计算给定一周内所有预订的平均ADR值，2)使用该数据预测未来每周ADR趋势——每周ADR是指任何一周内所有预订的平均ADR——以下称为“每周ADR”。</p><p id="b32f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">人们会注意到，数据集中有许多ADR值为正的取消事件，在这种情况下，假设即使客户取消了预订，他们最终仍会被收取预订费用(例如，在取消截止日期后取消，等等)。</p><p id="0687" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个长短期记忆网络(LSTM)被用来做这件事。LSTMs是顺序神经网络，它假设特定序列中的观察值之间存在相关性。因此，它们越来越多地被用于时间序列预测的目的。</p><p id="609a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为参考，每个客户的ADR也包括在内——考虑到一些客户既是公司也是个人，这导致在许多情况下每次预订不止一个房间。</p><h1 id="bf18" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">数据操作</h1><p id="5407" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">使用pandas，完整的日期(年份和周数)与每个预订的相应ADR值相结合。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/0c1671cac945e0763bcb06ae9d3a6a26.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/0*uTKOBHUodspb1NUE.png"/></div></figure><p id="31cc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后将这些数据点组合在一起，以获得所有预订的每周平均每日房价，如下所示:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="1b4d" class="ma mb it lw b gy mc md l me mf">df4 = df3.groupby('FullDate').agg("mean")<br/>df4<br/>df4.sort_values(['FullDate'], ascending=True)</span></pre><p id="2b40" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是新数据帧的外观:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/6994beac82eacaf83082d3d88d872624.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/0*lWwb-3a5TBiwxnTI.png"/></div></figure><p id="9800" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">顺便提一下，完整的笔记本和数据集可以在下面提供的GitHub资源库的链接中找到，其中更详细地说明了数据操作过程。</p><p id="76cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">生成时间序列图:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="23b3" class="ma mb it lw b gy mc md l me mf">import matplotlib.pyplot as plt<br/>plt.plot(tseries)<br/>plt.tick_params(<br/>    axis='x',          # changes apply to the x-axis<br/>    which='both',      # both major and minor ticks are affected<br/>    bottom=False,      # ticks along the bottom edge are off<br/>    top=False,         # ticks along the top edge are off<br/>    labelbottom=False) # labels along the bottom edge are off<br/>plt.ylabel('ADR')<br/>plt.title("Weekly ADR")<br/>plt.show()</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/db99da681ab05a5c4f1d66aabaf7e99f.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/0*Q8pZ_7SoAifpx8cY.png"/></div></figure><h1 id="404a" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">LSTM模型配置</h1><p id="2936" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">让我们开始分析H1数据集。创建的时间序列的前100个观察值称为。然后，创建数据集矩阵，并对数据进行缩放。</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="3d30" class="ma mb it lw b gy mc md l me mf">df = df[:100]</span><span id="6cdd" class="ma mb it lw b gy ne md l me mf"># Form dataset matrix<br/>def create_dataset(df, previous=1):<br/>    dataX, dataY = [], []<br/>    for i in range(len(df)-previous-1):<br/>        a = df[i:(i+previous), 0]<br/>        dataX.append(a)<br/>        dataY.append(df[i + previous, 0])<br/>    return np.array(dataX), np.array(dataY)</span></pre><p id="84b5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，使用MinMaxScaler对数据进行归一化，以便神经网络正确解释数据:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="aec2" class="ma mb it lw b gy mc md l me mf"># normalize dataset with MinMaxScaler<br/>scaler = MinMaxScaler(feature_range=(0, 1))<br/>df = scaler.fit_transform(df)<br/>df</span></pre><p id="eeb6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是输出示例:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="673b" class="ma mb it lw b gy mc md l me mf">array([[0.35915778],<br/>       [0.42256282],<br/>       [0.53159902],<br/>...<br/>       [0.27125524],<br/>       [0.26293747],<br/>       [0.25547682]])</span></pre><p id="4622" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据被分成训练集和测试集，其中<em class="nf">先前的</em>参数被设置为5:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="ee29" class="ma mb it lw b gy mc md l me mf">import tensorflow as tf<br/>from tensorflow.keras import layers<br/>from tensorflow.keras.layers import Dense<br/>from tensorflow.keras.layers import LSTM</span><span id="b4a3" class="ma mb it lw b gy ne md l me mf"># Training and Validation data partition<br/>train_size = int(len(df) * 0.8)<br/>val_size = len(df) - train_size<br/>train, val = df[0:train_size,:], df[train_size:len(df),:]</span><span id="9719" class="ma mb it lw b gy ne md l me mf"># Number of previous<br/>previous = 5<br/>X_train, Y_train = create_dataset(train, previous)<br/>X_val, Y_val = create_dataset(val, previous)</span></pre><p id="b21a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当<em class="nf">先前</em>参数设置为该值时，这实质上意味着时间<em class="nf"> t </em>(训练数据的Y_train)的值是使用值<em class="nf"> t-1 </em>、<em class="nf"> t-2 </em>、<em class="nf"> t-3 </em>、<em class="nf"> t-4 </em>和<em class="nf"> t-5 </em>(均在X_train下)预测的。</p><p id="51ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里是一个<em class="nf"> Y_train </em>数组的例子:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="4a1e" class="ma mb it lw b gy mc md l me mf">array([0.70858066, 0.75574219, 0.7348692 , 0.63555916, 0.34629856,<br/>       0.32723163, 0.18514608, 0.21056117, 0.13243974, 0.1321469 ,<br/>       0.06636683, 0.09516089, 0.02223529, 0.02497857, 0.06036494,<br/>...<br/>       0.12222412, 0.07324677, 0.05206859, 0.05937164, 0.04205497,<br/>       0.0867528 , 0.10976084, 0.0236608 , 0.11987636])</span></pre><p id="fa1e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里是一个<em class="nf"> X_train </em>数组的例子:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="c67a" class="ma mb it lw b gy mc md l me mf">array([[0.35915778, 0.42256282, 0.53159902, 0.6084246 , 0.63902841],<br/>       [0.42256282, 0.53159902, 0.6084246 , 0.63902841, 0.70858066],<br/>       [0.53159902, 0.6084246 , 0.63902841, 0.70858066, 0.75574219],<br/>...<br/>       [0.07324677, 0.05206859, 0.05937164, 0.04205497, 0.0867528 ],<br/>       [0.05206859, 0.05937164, 0.04205497, 0.0867528 , 0.10976084],<br/>       [0.05937164, 0.04205497, 0.0867528 , 0.10976084, 0.0236608 ]])</span></pre><p id="8f4c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行100个时期:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="a2ea" class="ma mb it lw b gy mc md l me mf"># reshape input to be [samples, time steps, features]<br/>X_train = np.reshape(X_train, (X_train.shape[0], 1, X_train.shape[1]))<br/>X_val = np.reshape(X_val, (X_val.shape[0], 1, X_val.shape[1]))</span><span id="abd8" class="ma mb it lw b gy ne md l me mf"># Generate LSTM network<br/>model = tf.keras.Sequential()<br/>model.add(LSTM(4, input_shape=(1, previous)))<br/>model.add(Dense(1))<br/>model.compile(loss='mean_squared_error', optimizer='adam')<br/>history=model.fit(X_train, Y_train, validation_split=0.2, epochs=100, batch_size=1, verbose=2)</span></pre><p id="1744" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是一些示例结果:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="1750" class="ma mb it lw b gy mc md l me mf">Train on 59 samples, validate on 15 samples<br/>Epoch 1/100<br/>59/59 - 1s - loss: 0.0689 - val_loss: 0.0027<br/>Epoch 2/100<br/>59/59 - 0s - loss: 0.0431 - val_loss: 0.0118<br/>...<br/>Epoch 99/100<br/>59/59 - 0s - loss: 0.0070 - val_loss: 0.0031<br/>Epoch 100/100<br/>59/59 - 0s - loss: 0.0071 - val_loss: 0.0034<br/>dict_keys(['loss', 'val_loss'])</span></pre><p id="8463" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是培训和验证损失的直观表示:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/4d92ad5990a94350f342c74bdf3fc097.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/0*9wEobPY9rhhu5i70.png"/></div></figure><h1 id="c5c5" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">训练和验证预测</h1><p id="80ad" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">现在，让我们进行一些预测。</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="5b1a" class="ma mb it lw b gy mc md l me mf"># Generate predictions<br/>trainpred = model.predict(X_train)<br/>valpred = model.predict(X_val)</span></pre><p id="c308" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是训练和测试预测的示例:</p><p id="0736" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">训练预测</strong></p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="deb7" class="ma mb it lw b gy mc md l me mf">&gt;&gt;&gt; trainpred<br/>array([[0.6923234 ],<br/>       [0.73979336],<br/>       [0.75128263],<br/>...<br/>       [0.09547461],<br/>       [0.11602292],<br/>       [0.050261  ]], dtype=float32)</span></pre><p id="1371" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">测试预测</strong></p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="311d" class="ma mb it lw b gy mc md l me mf">&gt;&gt;&gt; valpred</span><span id="84e1" class="ma mb it lw b gy ne md l me mf">array([[0.06604623],<br/>       [0.0982968 ],<br/>       [0.10709635],<br/>...<br/>       [0.3344252 ],<br/>       [0.2922875 ]], dtype=float32)</span></pre><p id="8d9c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用<code class="fe nh ni nj lw b">scaler.inverse_transform</code>将预测值转换回正常值，并计算训练和验证分数。</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="00f9" class="ma mb it lw b gy mc md l me mf">import math<br/>from sklearn.metrics import mean_squared_error</span><span id="dacb" class="ma mb it lw b gy ne md l me mf"># calculate RMSE<br/>trainScore = math.sqrt(mean_squared_error(Y_train[0], trainpred[:,0]))<br/>print('Train Score: %.2f RMSE' % (trainScore))<br/>valScore = math.sqrt(mean_squared_error(Y_val[0], valpred[:,0]))<br/>print('Validation Score: %.2f RMSE' % (valScore))</span></pre><p id="abb2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">培训和验证分数</strong></p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="92ca" class="ma mb it lw b gy mc md l me mf">Train Score: 12.71 RMSE<br/>Validation Score: 8.83 RMSE</span></pre><p id="f8f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是预测的图表:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/c3239a633b9a16801713ea0819bc25bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/0*TenVxD0OX4ZtNHhv.png"/></div></figure><p id="422c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">测试和预测阵列被相应地重新整形，并且平均方向精度的函数被定义为:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="0381" class="ma mb it lw b gy mc md l me mf">import numpy as np</span><span id="6bb7" class="ma mb it lw b gy ne md l me mf">def mda(actual: np.ndarray, predicted: np.ndarray):<br/>    """ Mean Directional Accuracy """<br/>    return np.mean((np.sign(actual[1:] - actual[:-1]) == np.sign(predicted[1:] - predicted[:-1])).astype(int))</span></pre><h1 id="2dd6" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">模型结果</h1><p id="c751" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">现在计算平均方向精度:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="326f" class="ma mb it lw b gy mc md l me mf">&gt;&gt;&gt; mda(Y_val, predictions)<br/>0.8571428571428571</span></pre><p id="6ea2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">获得了86% 的MDA，这意味着该模型在86%的时间内正确预测了实际每周ADR趋势的方向。</p><p id="f904" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如上所示，还获得了<strong class="kk iu"> 8.83 </strong> RMSE的验证分数。RMSE是衡量每周ADR与实际值之间的偏差，并采用相同的数字格式。验证数据的平均每周ADR为<strong class="kk iu"> 69.99 </strong>。</p><p id="db98" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">验证数据的平均预测误差为<strong class="kk iu"> -1.419 </strong>:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="9cdb" class="ma mb it lw b gy mc md l me mf">&gt;&gt;&gt; forecast_error = (predictions-Y_val)<br/>&gt;&gt;&gt; forecast_error<br/>&gt;&gt;&gt; mean_forecast_error = np.mean(forecast_error)<br/>&gt;&gt;&gt; mean_forecast_error<br/>-1.419167548625413</span></pre><h1 id="bcb1" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">测试看不见的(测试)数据</h1><p id="bd27" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">既然模型已经定型，下一步就是在看不见的(或测试数据)上测试模型的预测。</p><p id="07a3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如前所述，LSTM使用值<em class="nf"> t-1 </em>、<em class="nf"> t-2 </em>、<em class="nf"> t-3 </em>、<em class="nf"> t-4 </em>和<em class="nf"> t-5 </em>预测时间<em class="nf"> t </em>的值。</p><p id="1d53" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，预测系列中最后15周的ADR值。</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="7495" class="ma mb it lw b gy mc md l me mf">actual = tseries.iloc[100:115]<br/>actual = np.array(actual)<br/>actual</span></pre><p id="1c7d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">先前建立的模型现在用于使用时间序列中的前五个值来预测每个值:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="5749" class="ma mb it lw b gy mc md l me mf"># Test (unseen) predictions<br/># (t) and (t-5)<br/>&gt;&gt;&gt; XNew</span><span id="d4ce" class="ma mb it lw b gy ne md l me mf">array([[ 82.1267268 ,  90.48381679,  85.81940503,  84.46819121,<br/>         83.25621451],<br/>       [ 90.48381679,  85.81940503,  84.46819121,  83.25621451,<br/>         84.12304147],<br/>...<br/>       [189.16831978, 198.22268542, 208.71251185, 211.52835052,<br/>        211.16204036],<br/>       [198.22268542, 208.71251185, 211.52835052, 211.16204036,<br/>        210.28488251]])</span></pre><p id="505b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">变量被适当缩放，并调用<code class="fe nh ni nj lw b">model.predict</code>:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="b2f5" class="ma mb it lw b gy mc md l me mf">Xnew = scaler.transform(Xnew)<br/>Xnew<br/>Xnewformat = np.reshape(Xnew, (Xnew.shape[0], 1, Xnew.shape[1]))<br/>ynew=model.predict(Xnewformat)</span></pre><p id="78ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是生成的预测数组:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="9fe4" class="ma mb it lw b gy mc md l me mf">array([0.02153895, 0.0157201 , 0.12966183, 0.22085814, 0.26296526,<br/>       0.33762595, 0.35830092, 0.54184073, 0.73585206, 0.8718423 ,<br/>       0.92918825, 0.9334069 , 0.8861607 , 0.81483454, 0.76510745],<br/>      dtype=float32)</span></pre><p id="e0ef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数组被转换回原始值格式:</p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="6197" class="ma mb it lw b gy mc md l me mf">&gt;&gt;&gt; ynew = ynew * np.abs(maxt-mint) + np.min(tseries)<br/>&gt;&gt;&gt; ynewpd=pd.Series(ynew)<br/>&gt;&gt;&gt; ynewpd</span><span id="0c2d" class="ma mb it lw b gy ne md l me mf">0      45.410988<br/>1      44.423096<br/>2      63.767456<br/>3      79.250229<br/>4      86.398926<br/>5      99.074379<br/>6     102.584457<br/>7     133.744766<br/>8     166.682877<br/>9     189.770493<br/>10    199.506348<br/>11    200.222565<br/>12    192.201385<br/>13    180.092041<br/>14    171.649673<br/>dtype: float32</span></pre><p id="212b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里是计算出的<strong class="kk iu"> MDA </strong>、<strong class="kk iu"> RMSE </strong>、<strong class="kk iu"> MFE(平均预测误差)</strong>。</p><p id="1af8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">丙二醛= 0.86 </strong></p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="d7f9" class="ma mb it lw b gy mc md l me mf">&gt;&gt;&gt; mda(actualpd, ynewpd)</span><span id="06ee" class="ma mb it lw b gy ne md l me mf">0.8666666666666667</span></pre><p id="9bfd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> RMSE = 33.77 </strong></p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="6dd3" class="ma mb it lw b gy mc md l me mf">&gt;&gt;&gt; mse = mean_squared_error(actualpd, ynewpd)<br/>&gt;&gt;&gt; rmse = sqrt(mse)<br/>&gt;&gt;&gt; print('RMSE: %f' % rmse)</span><span id="805f" class="ma mb it lw b gy ne md l me mf">RMSE: 33.775573</span></pre><p id="e894" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> MFE = -30.17 </strong></p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="643b" class="ma mb it lw b gy mc md l me mf">&gt;&gt;&gt; forecast_error = (ynewpd-actualpd)<br/>&gt;&gt;&gt; mean_forecast_error = np.mean(forecast_error)<br/>&gt;&gt;&gt; mean_forecast_error</span><span id="6a95" class="ma mb it lw b gy ne md l me mf">-30.173496939933216</span></pre><p id="ac14" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随着测试集的平均每周ADR达到<strong class="kk iu"> 160.49 </strong>，RMSE和MFE表现看起来相当强劲(误差越低越好)。</p><h1 id="1ce4" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">H2结果</h1><p id="bdf4" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">在H2数据集(葡萄牙一家独立酒店的ADR数据)上执行了相同的过程。以下是将预测与测试集进行比较的结果:</p><p id="4f00" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">丙二醛= 0.86 </strong></p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="0dae" class="ma mb it lw b gy mc md l me mf">&gt;&gt;&gt; mda(actualpd, ynewpd)</span><span id="8327" class="ma mb it lw b gy ne md l me mf">0.8666666666666667</span></pre><p id="d9e8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> RMSE = 38.15 </strong></p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="b0b5" class="ma mb it lw b gy mc md l me mf">&gt;&gt;&gt; mse = mean_squared_error(actualpd, ynewpd)<br/>&gt;&gt;&gt; rmse = sqrt(mse)<br/>&gt;&gt;&gt; print('RMSE: %f' % rmse)</span><span id="17f5" class="ma mb it lw b gy ne md l me mf">RMSE: 38.155347</span></pre><p id="c1d5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> MFE = -34.43 </strong></p><pre class="lg lh li lj gt lv lw lx ly aw lz bi"><span id="354f" class="ma mb it lw b gy mc md l me mf">&gt;&gt;&gt; forecast_error = (ynewpd-actualpd)<br/>&gt;&gt;&gt; mean_forecast_error = np.mean(forecast_error)<br/>&gt;&gt;&gt; mean_forecast_error</span><span id="4f43" class="ma mb it lw b gy ne md l me mf">-34.437111023457376</span></pre><p id="4e8e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于H2数据集，测试集的平均每周ADR为<strong class="kk iu"> 131.42 </strong>，相比之下，RMSE和MFE误差较低。</p><h1 id="efc3" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">结论</h1><p id="48d4" class="pw-post-body-paragraph ki kj it kk b kl mx ju kn ko my jx kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">在本例中，您已经看到了如何使用LSTM模型预测ADR。具体而言，上述示例说明了:</p><ul class=""><li id="271d" class="nk nl it kk b kl km ko kp kr nm kv nn kz no ld np nq nr ns bi translated">如何构建LSTM模型</li><li id="0770" class="nk nl it kk b kl nt ko nu kr nv kv nw kz nx ld np nq nr ns bi translated">测量LSTM模式预测的误差和精确度的方法</li></ul><p id="91c5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本例的数据集和笔记本可从MGCodesandStats GitHub库获得，以及对该主题的进一步研究。</p><p id="e791" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你也可以在michael-grogan.com<a class="ae le" href="https://www.michael-grogan.com/" rel="noopener ugc nofollow" target="_blank">找到更多我的数据科学内容。</a></p><p id="e635" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nf">免责声明:本文是在“原样”的基础上编写的，没有任何担保。本文旨在提供数据科学概念的概述，不应以任何方式解释为专业建议。</em></p></div></div>    
</body>
</html>