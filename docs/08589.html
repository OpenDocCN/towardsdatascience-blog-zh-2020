<html>
<head>
<title>How to transform variables in a pandas DataFrame</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何转换熊猫数据框架中的变量</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transforming-variables-in-a-pandas-dataframe-bce2c6ef91a1?source=collection_archive---------9-----------------------#2020-06-22">https://towardsdatascience.com/transforming-variables-in-a-pandas-dataframe-bce2c6ef91a1?source=collection_archive---------9-----------------------#2020-06-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7b48" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">衍生和修改变量的方法，使其符合目的</h2></div><p id="d4da" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无论是准备数据以提取洞察力，还是为模型设计特征，我认为处理数据的个人的基本技能之一是将数据可靠地转换为所需格式的能力。作为数据清理、数据准备、数据管理、数据操作、数据争论、数据丰富、数据预处理(咻！😅)，经常需要将变量/列/特性转换成更合适的形式。换句话说，原始数据往往需要改头换面✨才能更有用。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/928c68d556107892271a406badcd5d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZZAYEt-akPBtf8Do"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae lu" href="https://unsplash.com/@fempreneurstyledstock?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Leone Venter </a>拍摄的照片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c934" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">0.Python设置🔧</h1><p id="1424" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">我假设读者(👀是的，你！)可以访问并熟悉Python，包括安装包、定义函数和其他基本任务。如果你是Python的新手，<a class="ae lu" href="https://www.python.org/about/gettingstarted/" rel="noopener ugc nofollow" target="_blank">这个</a>是一个入门的好地方。</p><p id="15db" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我已经在Jupyter Notebook中使用并测试了Python 3.7.1中的脚本。在我们开始推导之前，让我们确保你有正确的工具。</p><h2 id="ddb9" class="mz md it bd me na nb dn mi nc nd dp mm kr ne nf mo kv ng nh mq kz ni nj ms nk bi translated">⬜️确保安装了所需的软件包:熊猫和nltk</h2><p id="ebe3" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">我们将使用以下强大的第三方软件包:</p><ul class=""><li id="528a" class="nl nm it kk b kl km ko kp kr nn kv no kz np ld nq nr ns nt bi translated"><em class="nu"> numpy: </em>数值计算库和</li><li id="00a6" class="nl nm it kk b kl nv ko nw kr nx kv ny kz nz ld nq nr ns nt bi translated"><em class="nu">熊猫</em>:数据分析库。</li></ul><h1 id="daca" class="mc md it bd me mf oa mh mi mj ob ml mm jz oc ka mo kc od kd mq kf oe kg ms mt bi translated">1.数据📦</h1><p id="ca3a" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">为了使事情易于管理，我们将创建一个小的数据框架，它将允许我们在下一节中监视每个任务的输入和输出。在一个假设的世界里，我收集了一些弹珠🔮，让我们假设下面的数据框包含我拥有的每种弹珠的详细信息。(嘶！您可能需要将代码复制到Jupyter笔记本或代码编辑器中，以获得更好的格式。)</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="34b7" class="mz md it og b gy ok ol l om on"># Import packages<br/>import numpy as np<br/>import pandas as pd</span><span id="8353" class="mz md it og b gy oo ol l om on"># Update default settings to show 2 decimal place<br/>pd.options.display.float_format = '{:.2f}'.format</span><span id="9af6" class="mz md it og b gy oo ol l om on"># Create a small dataframe<br/>df = pd.DataFrame({'name': ['bob 2012', 'Ava 2013', 'Aby 007', 'XYZ 8', 'GRZ x7', 'Boo VIII', 'Joy 2020'],<br/>                   'p_date': ['2020-02-01', '2020-05-01', '2020-06-30', '2020-04-15', '2020-01-04', '2020-03-21', '2020-07-08'],<br/>                   'count': [80, 30, 10, 60, 40, 20, np.nan],<br/>                   'colour': ['pink', 'teal', 'velvet', 'pink', 'green', 'teal', 'pink'],<br/>                   'radius': [1, 2, 3, 4, 5, 6, 7],<br/>                   'unit': ['cm', 'inch', 'cm', 'cm', 'inch', 'cm', 'cm']})<br/>df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6d8b2a12736d3e5f304a2eaa77a68a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/0*RLTRX5bRBRvEb4iz.png"/></div></figure><h2 id="d508" class="mz md it bd me na nb dn mi nc nd dp mm kr ne nf mo kv ng nh mq kz ni nj ms nk bi translated">1.1.数据字典📘</h2><p id="3501" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">每行代表一种大理石。列定义为:<br/> ◼ <strong class="kk iu">名称:</strong>每颗弹珠的名称(第一部分是型号名称，第二部分是版本)<br/> ◼ <strong class="kk iu">购买日期:</strong>我购买一种弹珠的日期<br/> ◼ <strong class="kk iu">计数:</strong>我拥有多少颗特定种类的弹珠<br/> ◼ <strong class="kk iu">颜色:</strong>该种类的颜色<br/> ◼ <strong class="kk iu">半径:</strong>该种类的半径测量值(对🙊)<br/> ◼ <strong class="kk iu">单位:</strong>单位为<em class="nu">半径</em></p><p id="b605" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果这没有多大意义，不要太担心，因为这只是一个玩具数据。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7d00" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.转换变量🎨</h1><p id="7dcf" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">在这一节中，我们将看一些转换不同数据类型的例子。我们将创建包含转换的新列，以便原始变量不会被覆盖。在可能的情况下，提供了实现相同转换的替代代码以供参考。从这些备选方案列表中，希望您能找到一两个技巧，用于日常数据操作。现在，是时候改头换面了！✨</p><p id="5748" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，所示的一些方法的底层逻辑可以应用于任何数据类型。</p><h2 id="02f7" class="mz md it bd me na nb dn mi nc nd dp mm kr ne nf mo kv ng nh mq kz ni nj ms nk bi translated">2.1.转换数值变量</h2><p id="932e" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">🔦<strong class="kk iu">类型:</strong>基于两个条件创建一个条件变量。</p><p id="ec9d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔒任务:</strong> <em class="nu">半径</em>不能直接跨种类比较，因为它们用不同的单位表示。让我们创建一个变量，以厘米为单位显示半径，以保持一致性。</p><p id="7f41" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔑答:</strong>我们将调用新变量<em class="nu"> radius_cm </em>。假设1英寸等于2.54厘米，我们可以将条件总结如下:<br/> 1)如果单位是“厘米”，则<em class="nu">radius _ cm = radius<br/></em>2)如果单位是“英寸”，则<em class="nu">radius _ cm =</em>2.54<em class="nu">* radius</em></p><p id="577f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用下面的脚本创建<em class="nu">半径_厘米</em>:</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="7803" class="mz md it og b gy ok ol l om on"># Method using np.where<br/>df['radius_cm'] = np.where(df['unit']=='inch', 2.54 * df['radius'], df['radius'])</span><span id="18dc" class="mz md it og b gy oo ol l om on"># ============== ALTERNATIVE METHODS ==============<br/>## Method using np.select<br/># df['radius_cm'] = np.select([df['unit']=='inch'], [2.54 * df['radius']], default=df['radius'])</span><span id="8a85" class="mz md it og b gy oo ol l om on">## Method applying lambda function with if<br/># df['radius_cm'] = df[['radius', 'unit']].apply(lambda x: 2.54 * x[0] if x[1]=='inch' else x[0], axis=1)</span><span id="7c81" class="mz md it og b gy oo ol l om on">## Method A using loc<br/># df.loc[df['unit']!='inch', 'radius_cm'] = df['radius']<br/># df.loc[df['unit']=='inch', 'radius_cm'] = 2.54 * df['radius']</span><span id="d045" class="mz md it og b gy oo ol l om on">## Method B using loc (works as long as df['radius'] has no missing data)<br/># df['radius_cm'] = df['radius']<br/># df.loc[df['unit']=='inch', 'radius_cm'] = 2.54 * df['radius']</span><span id="f01e" class="mz md it og b gy oo ol l om on"># Inspect results<br/>df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/546b540783016d17b2f3ffae6fca985c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/0*cKR5JmKwoewZ1-NT.png"/></div></figure><p id="7c50" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">💡快速提示:</strong>要在Jupyter笔记本中注释或取消注释代码，如果你还不知道的话，选择一段代码并使用[Ctrl/Cmd + /]快捷键。</p><p id="b8a5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">_________________________________________________________________🔦<strong class="kk iu">类型:</strong>根据2个条件创建一个条件变量(分类)。</p><p id="8adc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔒任务:</strong>根据其<em class="nu">半径创建一个描述大理石尺寸的变量，单位为厘米</em>。</p><p id="91bd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔑答:</strong>我们将新变量<em class="nu">的大小叫做</em>。让我们将“大”定义为<em class="nu">半径</em>为5厘米或更高的弹珠，任何低于5厘米的则定义为“小”。所以条件是:<br/> 1)如果<em class="nu"> radius_cm </em> ≥ 5那么<em class="nu"> size </em> = '大'<em class="nu"> <br/> </em> 2)如果<em class="nu"> radius_cm &lt; </em> 5那么<em class="nu"> size = </em>'小'</p><p id="aa54" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用下面的脚本创建<em class="nu">大小</em>:</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="5957" class="mz md it og b gy ok ol l om on"># Method applying lambda function with if<br/>df['size'] = df['radius_cm'].apply(lambda x: 'big' if x&gt;=5 else 'small')</span><span id="34a7" class="mz md it og b gy oo ol l om on"># Inspect results<br/>df.sort_values('radius_cm')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi or"><img src="../Images/46e30e3c701a722a35a46eb61e6f6d18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/0*m_jBRcLD65ouFc-L.png"/></div></figure><p id="d293" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了避免重复，我没有为这个任务提供任何替代方法，因为第一个任务中的任何方法都可以在这里使用。</p><p id="4988" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">📌练习:</strong>通过引用第一个任务中显示的方法，尝试使用不同的方法进行相同的转换。</p><p id="0195" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi">_________________________________________________________________</p><p id="6ae0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔦<strong class="kk iu">类型:</strong>创建一个计算变量。</p><p id="9a15" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔒任务:</strong>为弹珠计算球体体积。</p><p id="80f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> ➗公式:</strong></p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi os"><img src="../Images/9040f88fe2bc7745295b537b87c9aca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/0*CNyCQj5wWj-2Kh3d.png"/></div></figure><p id="1092" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔑答:</strong>我们可以使用下面的脚本创建<em class="nu">卷</em>:</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="a73d" class="mz md it og b gy ok ol l om on"># Method using eval<br/>pi = np.pi<br/>df.eval("volume = 4/3 * @pi * radius**3", inplace=True)</span><span id="47d0" class="mz md it og b gy oo ol l om on"># ============== ALTERNATIVE METHOD ==============<br/>## Method using simple operators<br/># df['volume'] = 4/3 * np.pi * df['radius']**3</span><span id="2139" class="mz md it og b gy oo ol l om on">## Method using pandas wrappers<br/># df['volume2'] = df['radius'].pow(3).mul(4/3*np.pi)</span><span id="911d" class="mz md it og b gy oo ol l om on">## Short description for pow, mul and a few other wrappers:<br/>## add: for addition <br/>## sub: for subtractaction<br/>## mul: for multiplication<br/>## div: for division<br/>## pow: for exponential power (Tip: can use pow(0.5) or pow(1/2) for square root)</span><span id="cf03" class="mz md it og b gy oo ol l om on"># Inspect results<br/>df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/da7a55c058185142550a897e298be471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/0*ysTnltM9iOopTcO1.png"/></div></figure><p id="3d26" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">_________________________________________________________________🔦<strong class="kk iu">类型:</strong>将数值分割成等宽的条块(Discritise)。</p><p id="c9a2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔒任务:</strong>创建一个变量，根据它们的<em class="nu">计数</em>将弹珠分成两个等宽的格子。</p><p id="6a6b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔑答:</strong>我们将新变量<em class="nu">称为cut </em>。<br/> ◼最小<em class="nu">计数</em> = 10 <br/> ◼最大<em class="nu">计数</em> = 80 <br/> ◼范围<em class="nu">计数</em> =最大—最小= 70 <br/> ◼箱宽度=范围/箱数= 70 / 2 = 35 <br/> <em class="nu">由于计数</em>的范围是从10到80个弹珠，具有2个箱将意味着第一个箱是10到45，第二个箱是45到80目前，我们已经用默认设置<code class="fe ou ov ow og b">right=True</code>将面元定义为包含最右边的边。这意味着，如果我们有45个弹珠，它将落入较低的箱子(即10–45)。通过在下面的函数中添加<code class="fe ou ov ow og b">right=False</code>,我们可以很容易地改变这种行为，以排除最右边的边缘。也请参见我在下一个任务中的注释。</p><p id="9cb7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用下面的脚本创建<em class="nu">切割</em>:</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="b59c" class="mz md it og b gy ok ol l om on"># Method using pandas.cut<br/>df['cut'] = pd.cut(df['count'], bins=2, labels=['bin1', 'bin2'])</span><span id="49c0" class="mz md it og b gy oo ol l om on"># Inspect results<br/>df[['count', 'cut']].sort_values('count')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/7d5546252356ac2f920e5857acf3c985.png" data-original-src="https://miro.medium.com/v2/resize:fit:278/format:webp/0*nWwbzgnXRfz9eOzE.png"/></div></figure><p id="ee3a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi">_________________________________________________________________</p><p id="239a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔦<strong class="kk iu">类型:</strong>将数值分割成大小相等的块(Discritise)。</p><p id="636a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔒任务:</strong>创建一个变量，根据弹球的<em class="nu">计数</em>，将弹球分成两个大小相等的桶(即分位数)。</p><p id="d83e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔑答:</strong>我们将调用新变量<em class="nu"> qcut </em>。<br/> ◼排序<em class="nu">计数</em>升序:10、20、30、40、60、80 <br/> ◼ #记录= 6 <br/> ◼ #分位数= 2 <br/> ◼ #每个分位数的记录数= #记录数/ #分位数= 6 / 2 = 3 <br/>因为c <em class="nu">计数</em>中有6个非缺失值，具有相等大小的存储桶意味着第一个分位数将包括:10、20、30和</p><p id="9fc9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">值得注意的是，如果您有兴趣查看等宽或等大小箱子的确切分界点，一种方法是从函数中省去<code class="fe ou ov ow og b">label</code>参数。查看精确的截止点将使离散化时如何处理边缘上的点变得清晰。</p><p id="f546" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以无论如何…回到<em class="nu"> qcut </em>，我们可以使用下面的脚本创建它:</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="e004" class="mz md it og b gy ok ol l om on"># Method using pandas.qcut<br/>df['qcut'] = pd.qcut(df['count'], q=2, labels=['q1', 'q2'])</span><span id="70d2" class="mz md it og b gy oo ol l om on"># Inspect results<br/>df[['count', 'cut', 'qcut']].sort_values('count')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/4990349ce4bcf3a289e8421c5627ced2.png" data-original-src="https://miro.medium.com/v2/resize:fit:372/format:webp/0*L8Ubf_x-eNBeyd8Y.png"/></div></figure><p id="c503" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意到<em class="nu">切割</em>和<em class="nu">q切割</em>的区别了吗？</p><p id="3947" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi">_________________________________________________________________</p><h2 id="cac5" class="mz md it bd me na nb dn mi nc nd dp mm kr ne nf mo kv ng nh mq kz ni nj ms nk bi translated">2.2.转换分类变量或字符串变量</h2><p id="9f51" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">🔦<strong class="kk iu">类型:</strong>基于3+条件(组)创建一个条件变量。</p><p id="ef7e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔒任务:</strong>创建一个变量，将粉色缩写为“PK”，将蓝绿色缩写为“TL”，将所有其他颜色(天鹅绒和绿色)缩写为“OT”。</p><p id="2270" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔑答:</strong>我们将新的变量叫做<em class="nu"> colour_abr </em>。所以条件是:<br/> 1)如果<em class="nu">颜色</em>是‘粉色’那么<em class="nu">颜色_ ABR</em>=‘PK’<em class="nu"><br/></em>2)如果<em class="nu">颜色</em>是‘蓝绿色’那么<em class="nu">颜色_ ABR =</em>‘TL’<br/>3)如果<em class="nu">颜色</em>不是‘天鹅绒’就是‘绿色’那么<em class="nu">颜色_ ABR</em>=‘OT’。</p><p id="f722" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用下面的脚本创建<em class="nu"> colour_abr </em>:</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="0412" class="mz md it og b gy ok ol l om on"># Method using replace<br/>df['colour_abr'] = df['colour'].replace({'pink': 'PK', 'teal': 'TL', 'velvet': 'OT', 'green': 'OT'})</span><span id="0a5c" class="mz md it og b gy oo ol l om on"># ============== ALTERNATIVE METHODS ==============<br/>## Method A using map<br/># mapping = {'pink':'PK', 'teal': 'TL', 'velvet': 'OT', 'green': 'OT'}<br/># df['colour_abr'] = df['colour'].map(mapping)</span><span id="8d43" class="mz md it og b gy oo ol l om on">## Method B using map (works as long as df['colour'] has no missing data)<br/># df['colour_abr'] = df['colour'].map({'pink':'PK', 'teal': 'TL'})<br/># df['colour_abr'].fillna('OT', inplace=True)</span><span id="533e" class="mz md it og b gy oo ol l om on">## Method using nested np.wheres<br/># df['colour_abr'] = np.where(df['colour']=='pink', 'PK', np.where(df['colour']=='teal', 'TL', 'OT'))</span><span id="cf87" class="mz md it og b gy oo ol l om on">## Method using np.select<br/># df['colour_abr'] = np.select([df['colour']=='pink', df['colour']=='teal'], ['PK', 'TL'] , default='OT')</span><span id="afad" class="mz md it og b gy oo ol l om on">## Method applying lambda function with nested ifs<br/># df['colour_abr'] = df['colour'].apply(lambda x: 'PK' if x=='pink' else ('TL' if x=='teal' else 'OT'))</span><span id="4386" class="mz md it og b gy oo ol l om on">## Method using list comprehension<br/># df['colour_abr'] = ['PK' if x=='pink' else ('TL' if x=='teal' else 'OT') for x in df['colour']]</span><span id="db11" class="mz md it og b gy oo ol l om on">## Method A using loc<br/># df.loc[df['colour'] == 'pink', 'colour_abr'] = 'PK'<br/># df.loc[df['colour'] == 'teal', 'colour_abr'] = 'TL'<br/># df.loc[df['colour'].isin(['velvet', 'green']), 'colour_abr'] = 'OT'</span><span id="f6a5" class="mz md it og b gy oo ol l om on">## Method B using loc (works as long as df['colour'] has no missing data)<br/># df['colour_abr'] = 'OT'<br/># df.loc[df['colour'] == 'pink', 'colour_abr'] = 'PK'<br/># df.loc[df['colour'] == 'teal', 'colour_abr'] = 'TL'</span><span id="a216" class="mz md it og b gy oo ol l om on"># Inspect results<br/>df[['colour', 'colour_abr']].sort_values('colour_abr')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/7911f3ba383b17e7d1c838689f143544.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/0*etYXl2FWJMlK3bL_.png"/></div></figure><p id="1036" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们只是重命名类别而不是分组，我们也可以使用下面<em class="nu">中的任何一种方法。cat访问器</em>除了上面显示的方法之外:</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="b699" class="mz md it og b gy ok ol l om on"># Create a copy of colour and convert type to category<br/>df['colour_abr'] = df['colour'].astype('category')</span><span id="a02b" class="mz md it og b gy oo ol l om on"># Method using .cat.rename_categories<br/>df['colour_abr'].cat.rename_categories({'green':'GN', 'pink':'PK', 'teal':'TL', 'velvet': 'VT'}, inplace=True)</span><span id="0e1c" class="mz md it og b gy oo ol l om on"># ============== ALTERNATIVE METHOD ==============<br/>## Method using .cat.categories<br/>## Make sure to get the order of the categories right<br/>## Check the order with by running df['colour_abr'].cat.categories<br/># df['colour_abr'].cat.categories = ['GN', 'PK', 'TL','VT']</span><span id="b3db" class="mz md it og b gy oo ol l om on"># Inspect results<br/>df[['colour', 'colour_abr']].sort_values('colour_abr')</span></pre><p id="c881" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有关<em class="nu">的更多信息，请参见本文档。卡特彼勒存取器</em>。🐱</p><p id="343d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi">_________________________________________________________________</p><p id="9344" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔦<strong class="kk iu">类型:</strong>解析字符串(从字符串中提取一部分)。</p><p id="da52" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔒任务:</strong>解析<em class="nu">名称</em>，这样我们就有了<em class="nu">型号</em>和<em class="nu">版本</em>的新列。</p><p id="21d0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔑答:</strong>我们现在将使用<em class="nu">中的一个方法。str访问器</em>提取部件:</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="9745" class="mz md it og b gy ok ol l om on"># Method using .str.split<br/>df[['model', 'version']] = df['name'].str.split(' ', expand=True)</span><span id="138a" class="mz md it og b gy oo ol l om on"># ============== ALTERNATIVE METHOD ==============<br/>## Method applying lambda function<br/># df['model'] = df['name'].apply(lambda x: x.split(' ')[0])<br/># df['version'] = df['name'].apply(lambda x: x.split(' ')[1])</span><span id="514a" class="mz md it og b gy oo ol l om on"># Inspect results<br/>df[['name', 'model', 'version']]</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/840e04c697afbd7df9892e4db90613bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:506/format:webp/0*_0eM-K0UjQJ6yjzj.png"/></div></figure><p id="39c8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi">_________________________________________________________________</p><p id="9103" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔦<strong class="kk iu">类型:</strong>连接或合并列(与上述任务相反)。</p><p id="87c6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔒任务:</strong>将<em class="nu">模型</em>(大写)和<em class="nu">半径</em>中的值合并到一个新列中。</p><p id="93a5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔑答案:</strong>我们现在将使用下面的脚本来连接:</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="6182" class="mz md it og b gy ok ol l om on"># Method using + operator<br/>df['mod_rad'] = df['model'].str.upper() + '_' + df['radius'].astype(str)</span><span id="c052" class="mz md it og b gy oo ol l om on"># ============== ALTERNATIVE METHOD ==============<br/>## Method using chained .str methods<br/># df['mod_rad'] = df['model'].str.upper().str.cat(df['radius'].astype(str), sep="_")</span><span id="7f81" class="mz md it og b gy oo ol l om on"># Inspect results<br/>df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi pb"><img src="../Images/e1ed60bd37638451d5a86653d543f3f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vuThrZAzCSKEY9Jg.png"/></div></div></figure><p id="4b7a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">关于<em class="nu">的更多信息，参见<a class="ae lu" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/text.html" rel="noopener ugc nofollow" target="_blank">本文档</a>。字符串存取器</em>。🎻</p><p id="14ed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi">_________________________________________________________________</p><h2 id="a8ed" class="mz md it bd me na nb dn mi nc nd dp mm kr ne nf mo kv ng nh mq kz ni nj ms nk bi translated">2.3.转换日期时间变量</h2><p id="ffe4" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">🔦<strong class="kk iu">类型:</strong>解析日期时间(从日期时间中提取一部分)。</p><p id="0314" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔒任务:</strong>提取一周的<em class="nu">天</em>，以及购买的<em class="nu">年</em>。</p><p id="798d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">🔑答:</strong>我们现在将使用<em class="nu">中的方法。dt存取器</em>提取零件:</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="b117" class="mz md it og b gy ok ol l om on"># Convert type to datetime<br/>df['p_date'] = pd.to_datetime(df['p_date'])</span><span id="2095" class="mz md it og b gy oo ol l om on"># Method using .dt.day_name() and dt.year<br/>df['p_dname'] = df['p_date'].dt.day_name()<br/>df['p_year'] = df['p_date'].dt.year</span><span id="3909" class="mz md it og b gy oo ol l om on"># Inspect results<br/>df[['p_date', 'p_dname', 'p_year']]</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/37ac3706de6507aeb4acb945c2edbdeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:596/format:webp/0*bdiJWHVjIehtq3Xd.png"/></div></figure><p id="e821" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _<strong class="kk iu">📌练习:</strong>尝试从<em class="nu"> p_date </em>中提取月和日，并找出如何将<em class="nu"> p_year </em>、<em class="nu"> p_month </em>、<em class="nu"> p_day </em>组合成一个日期。</p><p id="d787" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">关于<em class="nu">的更多信息，参见本文档。dt存取器</em>。🕟</p><p id="49c9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过滚动左边的窗格<a class="ae lu" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.split.html" rel="noopener ugc nofollow" target="_blank">到这里</a>，您可以浏览前面讨论的访问器的可用方法。当心<em class="nu">熊猫。Series.xxx.yyy </em>其中<em class="nu"> xxx </em>可以替换为<em class="nu"> cat </em>、<em class="nu"> str </em>或<em class="nu"> dt，yyy </em>是指方法。</p><h1 id="ccda" class="mc md it bd me mf oa mh mi mj ob ml mm jz oc ka mo kc od kd mq kf oe kg ms mt bi translated">3.把所有东西放在一起📃</h1><p id="b3dc" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">现在我们将熟悉<em class="nu">赋值，</em>它允许我们一次创建多个变量。测试完成后，我们可以结合如下步骤:</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="af07" class="mz md it og b gy ok ol l om on"># Convert type to datetime<br/>df['p_date'] = pd.to_datetime(df['p_date'])</span><span id="bfea" class="mz md it og b gy oo ol l om on"># Derive variables<br/>df = df.assign(radius_cm = np.where(df['unit']=='inch', 2.54 * df['radius'], df['radius']),</span><span id="ea33" class="mz md it og b gy oo ol l om on">               # Referenced radius as radius_cm hasn't been created yet<br/>               size = list(map(lambda r, u: 'big' if ((u=='cm') &amp; (r&gt;=5)) | ((u=='inch') &amp; (2.54*r&gt;=5)) <br/>                               else 'small', df['radius'], df['unit'])),<br/>               volume = 4/3 * np.pi * df['radius']**3,<br/>               cut = pd.cut(df['count'], bins=2, labels=['bin1', 'bin2']),<br/>               qcut = pd.qcut(df['count'], q=2, labels=['q1', 'q2']),<br/>               colour_abr = df['colour'].replace({'pink': 'PK', 'teal': 'TL', 'velvet': 'OT', 'green': 'OT'}),<br/>               # If you find a way to combine the following 2 lines in 1 line inside assign(), feel free to teach me how<br/>               model = df['name'].str.split(' ', expand=True)[0],<br/>               version = df['name'].str.split(' ', expand=True)[1],<br/>               mod_rad = df['name'].str.split(' ', expand=True)[0].str.upper() + '_' + df['radius'].astype(str),<br/>               p_dname = df['p_date'].dt.day_name(),<br/>               p_year = df['p_date'].dt.year)</span><span id="80fc" class="mz md it og b gy oo ol l om on"># Inspect results<br/>df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi pd"><img src="../Images/385f7e34bb349969706760abe873386b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xsjDO-EMpPtTEMPB.png"/></div></div></figure><p id="ba39" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个脚本看起来是不是有点忙乱？如果你一行一行地看，你会发现每一行都是我们从第2节中学到的代码的一个稍微变形的版本。</p><p id="9339" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后一点，在创建变量时，如果你犯了一个错误，你可以用正确的变量覆盖不正确的变量，或者使用⛔️:下面的脚本删除它</p><pre class="lf lg lh li gt of og oh oi aw oj bi"><span id="4f85" class="mz md it og b gy ok ol l om on"># Method A using del<br/>del(df['var_name'])</span><span id="68fa" class="mz md it og b gy oo ol l om on"># ============== ALTERNATIVE METHODS ==============<br/>## Method B using del<br/># del df['var_name']</span><span id="c902" class="mz md it og b gy oo ol l om on">## Method using drop<br/># df.drop(columns='var_name', inplace=True)</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi pe"><img src="../Images/7374584599464e5c7094af76baa09479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tFENbZjeikL12EI7"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@stilclassics?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> STIL </a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="4e59" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您想访问更多这样的内容吗？媒体会员可以无限制地访问媒体上的任何文章。如果您使用 <a class="ae lu" href="https://zluvsand.medium.com/membership" rel="noopener"> <em class="nu">我的推荐链接</em></a><em class="nu">成为会员，您的一部分会费将直接用于支持我。</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="aba0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谢谢你看我的帖子。我希望你已经学到了一些东西，✂️.如果你感兴趣，这里有我其他一些帖子的链接:<br/>◼️️<a class="ae lu" rel="noopener" target="_blank" href="/introduction-to-nlp-part-1-preprocessing-text-in-python-8f007d44ca96">NLP介绍—第1部分:Python中的预处理文本</a><br/>◼️<a class="ae lu" href="https://medium.com/@zluvsand/introduction-to-nlp-part-2-difference-between-lemmatisation-and-stemming-3789be1c55bc" rel="noopener">NLP介绍—第2部分:引理满足和词干化的区别</a><br/>◼️<a class="ae lu" href="https://medium.com/@zluvsand/introduction-to-nlp-part-3-tf-idf-explained-cedb1fc1f7dc" rel="noopener">NLP介绍—第3部分:TF-IDF解释</a><br/>◼️<a class="ae lu" href="https://medium.com/@zluvsand/introduction-to-nlp-part-4-supervised-text-classification-model-in-python-96e9709b4267" rel="noopener">NLP介绍—第4部分:Python中的监督文本分类模型</a></p><p id="2c17" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">继续改造！保持，保持变换变量！🎤(跟着唱！🙋)<br/>你继续改造！你继续，继续变换变量！🎶<br/>继续改造！保持，保持变换变量！🎵<br/>去转换你的数据…🎼</p><p id="0ddc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你猜到我的歌参考了吗？(提示:<a class="ae lu" href="https://cheatography.com/davechild/cheat-sheets/regular-expressions/" rel="noopener ugc nofollow" target="_blank"> L[a-z]{4} </a>)</p><p id="8841" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">再见🏃💨</p></div></div>    
</body>
</html>