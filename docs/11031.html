<html>
<head>
<title>Save Amazon Kinesis Stream Costs using Records Aggregation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用记录聚合节省 Amazon Kinesis 流成本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/save-amazon-kinesis-stream-costs-using-records-aggregation-79c8fd9ea748?source=collection_archive---------42-----------------------#2020-07-31">https://towardsdatascience.com/save-amazon-kinesis-stream-costs-using-records-aggregation-79c8fd9ea748?source=collection_archive---------42-----------------------#2020-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5b87" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 KPL 记录聚合降低 AWS 成本的案例研究</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/4045969b7a6f00b2088f6befd45b10eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*z01yUxHC_fhR8LWT06n1sw.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图片来自<a class="ae ku" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3088958" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ku" href="https://pixabay.com/users/xresch-7410129/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3088958" rel="noopener ugc nofollow" target="_blank"> xresch </a></p></figure><p id="96f7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">几年前，我们为一个客户开发了一个流管道，使用 Kafka 代理在他们自己的数据中心运行。流媒体管道是使用 Kafka Producer API 开发的。由于业务前所未有的增长，他们决定将其基础架构迁移到 AWS 云。作为迁移的一部分，我们决定实现 Kinesis Streams 来替代 Kafka。</p><p id="66aa" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在我们参与之前，客户内部团队已经做了一些调查并得出了一些数字。这是他们想出的办法:</p><p id="32e5" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">平均记录大小:</strong> 77 字节<br/> <strong class="kx iu">记录格式:</strong> JSON</p><p id="b439" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">[centos @ IP-172–31–70–220 ~]$ python 3 single _ record _ producer . py<br/>向 Kinesis 流发送这些数量的记录:1</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lr"><img src="../Images/5b2ad16fe9fe3586f36dbd9fb790b34c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KKelzrAwlcTYf9bYQIojNA.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">(<em class="lw">图片作者</em>)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lx"><img src="../Images/75332e5ea1cc4680c14b96d751a40626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*04vrORlTyfXkmfnY4w6QGg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">(<em class="lw">作者图片</em>)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/d5e8c7ca4412548420867cb38f921eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*nmJpie8KvjAsy3-hILF2Mw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">(<em class="lw">作者图片</em>)</p></figure><p id="fbea" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">假设每秒 25000 条记录，Kinesis 计算器估计的账单为<strong class="kx iu">$ 1196.82/月</strong>——相当高</p><p id="d49d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">由于明显的原因，客户对价格感到担忧，所以他们联系了我们。这篇文章的目的是展示你如何利用运动聚合来获得优势。你可能知道 Kinesis 流的成本是基于 2 个因素:</p><ol class=""><li id="e113" class="lz ma it kx b ky kz lb lc le mb li mc lm md lq me mf mg mh bi translated">碎片成本/小时(固定-根据所需碎片数量计算)</li><li id="f851" class="lz ma it kx b ky mi lb mj le mk li ml lm mm lq me mf mg mh bi translated">PUT 有效负载(根据 PUT 有效负载而变化)—PUT 有效负载单元以 25KB 有效负载区块计算。<strong class="kx iu">这就是使用 Kinesis 记录聚合可以节省成本的地方。</strong></li></ol><h2 id="feed" class="mn mo it bd mp mq mr dn ms mt mu dp mv le mw mx my li mz na nb lm nc nd ne nf bi translated">什么是 Kinesis 记录聚合？</h2><p id="9c9c" class="pw-post-body-paragraph kv kw it kx b ky ng ju la lb nh jx ld le ni lg lh li nj lk ll lm nk lo lp lq im bi translated">在大量情况下，数据工程师使用 Kinesis 生产者库(KPL)将记录写入 Kinesis 流。<a class="ae ku" href="https://docs.aws.amazon.com/streams/latest/dev/kinesis-kpl-concepts.html#kinesis-kpl-concepts-batching" rel="noopener ugc nofollow" target="_blank"> <em class="nl">聚合</em> </a>是 KPL 的一部分，允许客户增加每个 API 调用发送的记录数量。</p><p id="9563" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">数据工程师通常按如下方式构建他们的代码:</p><p id="1658" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><em class="nl">从源<br/>循环中取出数据记录，用于记录:<br/>调用 kinesis_client.put_record 方法发送一条</em> <strong class="kx iu"> <em class="nl"> 78 字节</em> </strong> <em class="nl">记录<br/>结束循环</em></p><p id="3472" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">相反，这是他们<strong class="kx iu">应该</strong>做的事情:</p><p id="e3b0" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><em class="nl">从源<br/>循环中取出数据记录进行记录:<br/> </em> <strong class="kx iu"> <em class="nl">调用 Kinesis 聚合器—一次放入 12 条记录</em> </strong> <em class="nl">请求<br/>调用 kinesis_client.put_record 方法发送 984 </em> <strong class="kx iu"> <em class="nl">字节</em> </strong> <em class="nl">记录<br/>结束循环</em></p><p id="71b2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">[centos @ IP-172–31–70–220 ~]$ python 3 aggregate _ record _ producer . py<br/>向 Kinesis 流发送这些数量的记录:12</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi nm"><img src="../Images/f4042c2a31fd46001efc4b8281392a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M0B9j3rurECB282kkdCHBQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">(<em class="lw">作者图片</em>)</p></figure><p id="763d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在是成本节约…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi nn"><img src="../Images/1d28e289ccf32ec2f595729ff8ffbbbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lF5Ne5PG-KlXc-8mK0o-Ng.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">(<em class="lw">图片作者</em>)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/8e4759b428bb5bb36fca1732de4ad28e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*DWNYomEZqImolmMG2n3Dgg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">(<em class="lw">作者图片</em>)</p></figure><p id="a7b8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu"/>95.75 美元/月，相比之下<strong class="kx iu">1196.82 美元/月— </strong>对于节省来说还不错</p><p id="de97" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我希望您获得了一些关于如何为客户节约成本的宝贵见解。Kinesis 记录聚合当然是一个非常有效的方法，但是我建议你应该从开发周期的一开始就实现它。否则，您将需要重构大量代码来实现它。</p><p id="1112" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我希望这篇文章是有帮助的。<strong class="kx iu">亚马逊 Kinesis </strong>是由<a class="ae ku" href="http://www.datafence.com" rel="noopener ugc nofollow" target="_blank"> Datafence 云学院</a>提供的 AWS 大数据分析课程的一部分。课程是周末自己在网上教的。</p></div></div>    
</body>
</html>