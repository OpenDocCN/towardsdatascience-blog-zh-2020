<html>
<head>
<title>Portfolio Risk Management Using Monte Carlo Simulations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用蒙特卡罗模拟的投资组合风险管理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/var-calculation-using-monte-carlo-simulations-40b2bb417a67?source=collection_archive---------7-----------------------#2020-06-22">https://towardsdatascience.com/var-calculation-using-monte-carlo-simulations-40b2bb417a67?source=collection_archive---------7-----------------------#2020-06-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4dfb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用Python和蒙特卡罗模拟自动计算风险价值(VaR)来管理投资组合或股权和股票的金融风险</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f2befdf9e2c87ba83e1423f3d84e8bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g7j__S-CV4eEq4Jr"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Austin Distel </a>拍摄的照片</p></figure><h2 id="4aa5" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">金融和投资组合风险管理中的VaR？</h2><p id="8482" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">VaR是“风险价值”的首字母缩写，是许多公司和银行用来确定其公司内部金融风险水平的工具。风险值是为一家公司的投资计算的，或者可能是为了检查由银行财富管理部门或精品公司管理的投资组合的风险水平。</p><p id="329c" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">该计算可以被认为是孤立的统计测量。也可以简化为下面的语句示例-</p><blockquote class="mt mu mv"><p id="103a" class="lv lw mw lx b ly mo ju ma mb mp jx md mx mq mf mg my mr mi mj mz ms ml mm mn im bi translated">VaR是在一定概率水平(置信区间)下发生的最小损失或在一定概率水平下实现的最大损失。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/688b49efc48dbaec6bcc6bf9574ff49f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*vX_S15rz5sLHSZhRX9HR6w.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源——SP咨询LLP公司</p></figure><p id="869d" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">上图显示了一家公司在α <strong class="lx iu"> % </strong>信心下可能面临的最大损失。在个人层面上，VaR可以帮助你预测或分析你的投资组合可能面临的最大损失——这是我们将很快分析的内容。</p><h2 id="f750" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">蒙特卡洛模拟</h2><p id="0176" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">蒙特卡洛模型是斯坦尼斯瓦夫·乌拉姆和约翰·诺伊曼的发明，他们在第二次世界大战后开发了这个模型。该模型是以摩纳哥的一个赌博城市命名的，这是因为赌博中面临的机会和随机遭遇。</p><p id="ce0f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">蒙特卡洛模拟是一种概率模型，它生成与经济因素(预期回报、波动性——在基金投资组合的情况下)一起使用的随机变量，以预测大范围内的结果。虽然不是最准确的，但该模型通常用于计算风险和不确定性。</p><p id="3fc8" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们现在将使用蒙特卡洛模拟来为我们的资产组合生成一组预测回报，这将帮助我们找出我们投资的风险值。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="112b" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">用Python计算VaR</strong></h2><p id="12ee" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我们将首先通过导入所需的库和函数来设置笔记本</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="6a8e" class="kz la it nj b gy nn no l np nq">#Importing all required libraries<br/>#Created by Sanket Karve<br/>import matplotlib.pyplot as plt<br/>import numpy as np<br/>import pandas as pd<br/>import pandas_datareader as web<br/>from matplotlib.ticker import FuncFormatter<br/>!pip install PyPortfolioOpt<br/>#Installing the Portfolio Optimzation Library</span><span id="8413" class="kz la it nj b gy nr no l np nq">from pypfopt.efficient_frontier import EfficientFrontier<br/>from pypfopt import risk_models<br/>from pypfopt import expected_returns<br/>from matplotlib.ticker import FuncFormatter</span></pre><p id="59e9" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">为了我们项目的目的，我考虑了过去两年的‘FAANG’股票。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="449e" class="kz la it nj b gy nn no l np nq">tickers = ['GOOGL','FB','AAPL','NFLX','AMZN']<br/>thelen = len(tickers)<br/>price_data = []<br/>for ticker in range(thelen):</span><span id="f163" class="kz la it nj b gy nr no l np nq">   prices = web.DataReader(tickers[ticker], start='2018-06-20', end = '2020-06-20', data_source='yahoo')</span><span id="ffc6" class="kz la it nj b gy nr no l np nq">   price_data.append(prices[['Adj Close']])</span><span id="1e09" class="kz la it nj b gy nr no l np nq">df_stocks = pd.concat(price_data, axis=1)<br/>df_stocks.columns=tickers<br/>df_stocks.tail()</span></pre><p id="8b0e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">下一步，我们将计算每项资产的投资组合权重。我已经通过使用为达到最大夏普比率而计算的资产权重做到了这一点。我已经发布了下面计算的代码片段。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="cb9c" class="kz la it nj b gy nn no l np nq">#Annualized Return<br/>mu = expected_returns.mean_historical_return(df_stocks)<br/>#Sample Variance of Portfolio<br/>Sigma = risk_models.sample_cov(df_stocks)</span><span id="ef2a" class="kz la it nj b gy nr no l np nq">#Max Sharpe Ratio - Tangent to the EF<br/>from pypfopt import objective_functions, base_optimizer<br/>ef = EfficientFrontier(mu, Sigma, weight_bounds=(0,1)) #weight bounds in negative allows shorting of stocks<br/>sharpe_pfolio=ef.max_sharpe() </span><span id="e498" class="kz la it nj b gy nr no l np nq">#May use add objective to ensure minimum zero weighting to individual stocks<br/>sharpe_pwt=ef.clean_weights()<br/>print(sharpe_pwt)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/d5808dbbfa2c71706bf7c8883783f0af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JI_TDIMUcDFMYPkNvFcP0w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">最大夏普比率的资产权重</p></figure><p id="297a" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">资产权重将用于计算预期投资组合回报。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="1c04" class="kz la it nj b gy nn no l np nq">#VaR Calculation<br/>ticker_rx2 = []</span><span id="e0d9" class="kz la it nj b gy nr no l np nq">#Convert Dictionary to list of asset weights from Max Sharpe Ratio Portfolio</span><span id="d7c1" class="kz la it nj b gy nr no l np nq">sh_wt = list(sharpe_pwt.values())<br/>sh_wt=np.array(sh_wt)</span></pre><p id="ea19" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">现在，我们将把投资组合的股票价格转换成累计回报，这也可以被认为是该项目的持有期回报(HPR)。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="82ba" class="kz la it nj b gy nn no l np nq">for a in range(thelen):</span><span id="efe7" class="kz la it nj b gy nr no l np nq">  ticker_rx = df_stocks[[tickers[a]]].pct_change()<br/>  ticker_rx = (ticker_rx+1).cumprod()<br/>  ticker_rx2.append(ticker_rx[[tickers[a]]])</span><span id="fb82" class="kz la it nj b gy nr no l np nq">ticker_final = pd.concat(ticker_rx2,axis=1)<br/>ticker_final</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/c5a1a86ffe55718a42526de94903ea51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*I1WUTkFMRKkv3z6BtMejDw.png"/></div></figure><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="fe3c" class="kz la it nj b gy nn no l np nq">#Plot graph of Cumulative/HPR of all stocks</span><span id="984e" class="kz la it nj b gy nr no l np nq">for i, col in enumerate(ticker_final.columns):<br/>  ticker_final[col].plot()</span><span id="dbaf" class="kz la it nj b gy nr no l np nq">plt.title('Cumulative Returns')<br/>plt.xticks(rotation=80)<br/>plt.legend(ticker_final.columns)</span><span id="2624" class="kz la it nj b gy nr no l np nq">#Saving the graph into a JPG file<br/>plt.savefig('CR.png', bbox_inches='tight')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/1acf45037329dba05836b2812f0be129.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*sktK0W7seX47UYmnSQAyCA.png"/></div></figure><p id="ea06" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">现在，我们将挑选出每项资产的最新HPR，并用<em class="mw">将收益乘以计算出的资产权重。点()</em>功能。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="9868" class="kz la it nj b gy nn no l np nq">#Taking Latest Values of Return</span><span id="a6aa" class="kz la it nj b gy nr no l np nq">pret = []<br/>pre1 = []<br/>price =[]</span><span id="b526" class="kz la it nj b gy nr no l np nq">for x in range(thelen):<br/>  pret.append(ticker_final.iloc[[-1],[x]])<br/>  price.append((df_stocks.iloc[[-1],[x]]))</span><span id="adaa" class="kz la it nj b gy nr no l np nq">pre1 = pd.concat(pret,axis=1)<br/>pre1 = np.array(pre1)<br/>price = pd.concat(price,axis=1)<br/>varsigma = pre1.std()<br/>ex_rtn=pre1.dot(sh_wt)</span><span id="ef18" class="kz la it nj b gy nr no l np nq">print('The weighted expected portfolio return for selected time period is'+ str(ex_rtn))</span><span id="4fe0" class="kz la it nj b gy nr no l np nq">#ex_rtn = (ex_rtn)**0.5-(1) #Annualizing the cumulative return (will not affect outcome)</span><span id="1df6" class="kz la it nj b gy nr no l np nq">price=price.dot(sh_wt) #Calculating weighted value<br/>print(ex_rtn, varsigma,price)</span></pre><p id="240f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">计算出预期投资组合回报和波动性(预期回报的标准差)后，我们将建立并运行蒙特卡洛模拟。我用了1440(一天中的分钟数)的时间进行了10，000次模拟运行。时间步长可以根据要求而改变。我使用了95%的置信区间。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="6582" class="kz la it nj b gy nn no l np nq">from scipy.stats import norm</span><span id="d499" class="kz la it nj b gy nr no l np nq">import math</span><span id="bc09" class="kz la it nj b gy nr no l np nq">Time=1440 #No of days(steps or trading days in this case)</span><span id="590b" class="kz la it nj b gy nr no l np nq">lt_price=[]</span><span id="d612" class="kz la it nj b gy nr no l np nq">final_res=[]</span><span id="3209" class="kz la it nj b gy nr no l np nq">for i in range(10000): #10000 runs of simulation</span><span id="5514" class="kz la it nj b gy nr no l np nq">  daily_return=                     (np.random.normal(ex_rtn/Time,varsigma/math.sqrt(Time),Time))<br/>  plt.plot(daily_returns)</span><span id="b8ba" class="kz la it nj b gy nr no l np nq">plt.axhline(np.percentile(daily_returns,5), color='r', linestyle='dashed', linewidth=1)</span><span id="1ffb" class="kz la it nj b gy nr no l np nq">plt.axhline(np.percentile(daily_returns,95), color='g', linestyle='dashed', linewidth=1)</span><span id="2eaf" class="kz la it nj b gy nr no l np nq">plt.axhline(np.mean(daily_returns), color='b', linestyle='solid', linewidth=1)</span><span id="65b2" class="kz la it nj b gy nr no l np nq">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/18cacbb9bb1ded7fe95acf5ae45c2a68.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*7MZAxRlEK7al92lnvQXg_g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一天1440分钟的回报范围|红色虚线-最小损失|绿色虚线-最小收益</p></figure><p id="1b4b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">可视化回报的分布图为我们呈现了下面的图表</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="dfbd" class="kz la it nj b gy nn no l np nq">plt.hist(daily_returns,bins=15)</span><span id="43dd" class="kz la it nj b gy nr no l np nq">plt.axvline(np.percentile(daily_returns,5), color='r', linestyle='dashed', linewidth=2)</span><span id="fb4b" class="kz la it nj b gy nr no l np nq">plt.axvline(np.percentile(daily_returns,95), color='r', linestyle='dashed', linewidth=2)</span><span id="81b9" class="kz la it nj b gy nr no l np nq">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/c6465a8a835e64172ad36ca6b36b20e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*B6tCbNfezIE9ayJhHnmezw.png"/></div></figure><p id="3608" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">打印上限和下限的精确值，并假设我们的投资组合价值为1000美元，我们将计算出应该保留以弥补最小损失的资金量的估计值。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="c584" class="kz la it nj b gy nn no l np nq">print(np.percentile(daily_returns,5),np.percentile(daily_returns,95)) #VaR - Minimum loss of 5.7% at a 5% probability, also a gain can be higher than 15% with a 5 % probability</span><span id="66b4" class="kz la it nj b gy nr no l np nq">pvalue = 1000 #portfolio value</span><span id="14d9" class="kz la it nj b gy nr no l np nq">print('$Amount required to cover minimum losses for one day is ' + str(pvalue* - np.percentile(daily_returns,5)))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/a69b1c6ab2dd950ca81a07d2e27324e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*FqbuRuoKxVI4cL7CqJ4wQQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每天的最小损失为1.14%，概率为5%</p></figure><p id="1cec" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">得出的金额将意味着弥补你每天损失所需的金额。结果也可以解释为你的投资组合以5%的概率面临的最小损失。</p><h2 id="f2a0" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h2><p id="9396" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">上述方法显示了我们如何计算投资组合的风险价值(VaR)。复习使用现代投资组合理论(MPT) 计算一定投资金额的投资组合<a class="ae ky" rel="noopener" target="_blank" href="/automating-portfolio-optimization-using-python-9f344b9380b9">，将有助于巩固您对投资组合分析和优化的理解。最后，VaR与蒙特卡洛模拟模型相结合，也可用于通过股价预测损益。这可以通过将生成的每日回报值乘以相应股票的最终价格来实现。</a></p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><p id="3d27" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><em class="mw">所有表达的观点都是我自己的。这篇文章不被视为专家投资建议。</em></p><p id="683c" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><em class="mw">随时联系我</em><a class="ae ky" href="https://www.linkedin.com/in/sanketkarve/" rel="noopener ugc nofollow" target="_blank"><em class="mw">LinkedIn</em></a><em class="mw">|</em><a class="ae ky" href="https://twitter.com/Go0n3r" rel="noopener ugc nofollow" target="_blank"><em class="mw">Twitter</em></a><em class="mw">给我留言</em></p></div></div>    
</body>
</html>