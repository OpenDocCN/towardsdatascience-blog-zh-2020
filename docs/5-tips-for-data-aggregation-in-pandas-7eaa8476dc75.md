# ç†ŠçŒ«æ•°æ®æ±‡æ€»çš„ 5 ä¸ªæŠ€å·§

> åŸæ–‡ï¼š<https://towardsdatascience.com/5-tips-for-data-aggregation-in-pandas-7eaa8476dc75?source=collection_archive---------34----------------------->

## æé«˜æ•°æ®å¤„ç†æŠ€èƒ½çš„å®ç”¨æŠ€å·§

åœ¨åšæ•°æ®åˆ†æçš„æ—¶å€™ï¼Œèƒ½å¤Ÿç†Ÿç»ƒçš„èšåˆæ•°æ®èµ·åˆ°äº†å¾ˆé‡è¦çš„ä½œç”¨ã€‚Pandas æä¾›äº†è®¸å¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œå…¶ä¸­ä¸€äº›å¯èƒ½æ²¡æœ‰å…¶ä»–æ–¹æ³•å—æ¬¢è¿ã€‚æ­¤å¤–ï¼Œå³ä½¿å¯¹äºä¼—æ‰€å‘¨çŸ¥çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿›ä¸€æ­¥è°ƒæ•´å®ƒçš„å‚æ•°æˆ–ç”¨å…¶ä»–æ–¹æ³•è¡¥å……å®ƒæ¥å¢åŠ å®ƒçš„æ•ˆç”¨ã€‚è€ƒè™‘åˆ°è¿™äº›å› ç´ ï¼Œå¦‚æœä½ ä»¥å‰æ²¡æœ‰é‡åˆ°è¿‡ï¼Œè¿™é‡Œæœ‰ 5 ä¸ªå…³äºç†ŠçŒ«æ•°æ®èšåˆçš„æŠ€å·§:

![](img/84cc6f917b24be59513478f7010518ee.png)

ä½œè€…å›¾ç‰‡

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†é€šè¿‡ä¾‹å­å±•ç¤ºå®ƒä»¬æ˜¯å¦‚ä½•æœ‰ç”¨çš„ã€‚æˆ‘ä¹Ÿå¸Œæœ›è¿™äº›æŠ€å·§èƒ½å¸®åŠ©ä½ å†™å‡ºæ¸…æ™°ã€ç®€æ´ã€æ˜“è¯»çš„ä»£ç ã€‚

# 0.Python è®¾ç½®ğŸ”§

æˆ‘å‡è®¾è¯»è€…(ğŸ‘€æ˜¯çš„ï¼Œä½ ï¼)æ‹¥æœ‰:
â—¼ï¸è®¿é—®å¹¶ç†Ÿæ‚‰ Pythonï¼ŒåŒ…æ‹¬å®‰è£…åŒ…ã€å®šä¹‰å‡½æ•°å’Œå…¶ä»–åŸºæœ¬ä»»åŠ¡
â—¼ï¸ä½¿ç”¨ pandas çš„å·¥ä½œçŸ¥è¯†ï¼ŒåŒ…æ‹¬åŸºæœ¬çš„æ•°æ®æ“ä½œã€‚

å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…çš„è¯ï¼Œç¡®ä¿ä½ å·²ç»å®‰è£…äº†[ç†ŠçŒ«](https://pandas.pydata.org/pandas-docs/stable/getting_started/install.html)å’Œ[æµ·é¾Ÿ](https://seaborn.pydata.org/installing.html)ã€‚

å¦‚æœä½ æ˜¯ Python æ–°æ‰‹ï¼Œ[è¿™ä¸ª](https://www.python.org/about/gettingstarted/)æ˜¯ä¸€ä¸ªå…¥é—¨çš„å¥½åœ°æ–¹ã€‚å¦‚æœä½ ä»¥å‰æ²¡æœ‰ç”¨è¿‡ç†ŠçŒ«ï¼Œ[è¿™ä¸ª](https://pandas.pydata.org/pandas-docs/stable/user_guide/10min.html)æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒèµ„æ–™ã€‚

*æˆ‘åœ¨ Jupyter Notebook ä¸­ä½¿ç”¨å¹¶æµ‹è¯•äº† Python 3.7.1 ä¸­çš„è„šæœ¬ã€‚*

# 1.æ•°æ®ğŸ“¦

æˆ‘ä»¬å°†ä½¿ç”¨ *seaborn çš„æç¤º*æ•°æ®é›†æ¥è¯´æ˜æˆ‘çš„æç¤ºã€‚

```
# Import packages
import pandas as pd
from seaborn import load_dataset# Import data 
df = load_dataset('tips').rename(columns={'sex': 'gender'})
df
```

![](img/6f1317851dadc77ca0839e3b67db7a2b.png)

å…³äºè¿™ä¸ªæ•°æ®é›†(åŒ…æ‹¬æ•°æ®å­—å…¸)çš„ç»†èŠ‚å¯ä»¥åœ¨è¿™é‡Œ[æ‰¾åˆ°](https://vincentarelbundock.github.io/Rdatasets/doc/reshape2/tips.html)(è¿™ä¸ªæºå®é™…ä¸Šæ˜¯é’ˆå¯¹ R çš„ï¼Œä½†æ˜¯å®ƒçœ‹èµ·æ¥æ˜¯æŒ‡åŒä¸€ä¸ªåº•å±‚æ•°æ®é›†)ã€‚ä¸ºäº†ä¾¿äºå¿«é€ŸæŸ¥é˜…ï¼Œæˆ‘åœ¨ä¸‹é¢å¼•ç”¨äº†ä»–ä»¬çš„æ•°æ®æè¿°:

> [â€œä¸€åæœåŠ¡å‘˜è®°å½•äº†ä»–åœ¨ä¸€å®¶é¤é¦†å·¥ä½œå‡ ä¸ªæœˆæœŸé—´æ”¶åˆ°çš„æ¯ä¸€ç¬”å°è´¹çš„ä¿¡æ¯ã€‚â€](https://vincentarelbundock.github.io/Rdatasets/doc/reshape2/tips.html)

# 2.æŠ€å·§ğŸŒŸ

## ğŸ“æŠ€å·§ 1:å¯¹å¤šå˜é‡è®¡æ•°/ç™¾åˆ†æ¯”ä½¿ç”¨ crosstab()

ä½ å¯èƒ½å·²ç»ç†Ÿæ‚‰è¿™ä¸ªç³»åˆ—å‡½æ•°:`value_counts()`ã€‚è¿è¡Œ`df['day'].value_counts()`å°†ç»™å‡º*æ—¥*å˜é‡ä¸­å”¯ä¸€å€¼çš„è®¡æ•°ã€‚å¦‚æœæˆ‘ä»¬åœ¨æ–¹æ³•ä¸­æŒ‡å®š`normalize=True`ï¼Œå®ƒå°†ç»™å‡ºç™¾åˆ†æ¯”ã€‚è¿™å¯¹äºå•ä¸ªå˜é‡å¾ˆæœ‰ç”¨ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬éœ€è¦æŸ¥çœ‹å¤šä¸ªå˜é‡çš„è®¡æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡*æ—¥*å’Œ*æ—¶é—´*è·å¾—è®¡æ•°ï¼Œä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨`groupby()` + `size()` + `unstack()`:

```
df.groupby(['time', 'day']).size().unstack()
```

![](img/b153b6e1dd826842e1d2705b9409571c.png)

å¦ä¸€ç§æ›´çµæ´»çš„æ–¹å¼æ˜¯ä½¿ç”¨`crosstab()`:

```
pd.crosstab(df['time'], df['day'])
```

![](img/d5329a8629614adf8729fe468f8bfc65.png)

ä½¿ç”¨`crosstab()`æœ‰ä¸€äº›å¥½å¤„ã€‚é¦–å…ˆï¼Œå¾ˆå®¹æ˜“å¾—åˆ°è¡Œå’Œåˆ—çš„å°è®¡â€”â€”æˆ‘ä»¬åªéœ€åŠ ä¸Š`margins=True`:

```
pd.crosstab(df['time'], df['day'], margins=True)
```

![](img/fc79fc7fa1057d3dbb2f7ec1fae4f627.png)

æ˜¯ä¸æ˜¯å¾ˆç‰›é€¼ï¼Ÿå…¶æ¬¡ï¼Œé€šè¿‡è°ƒæ•´`normalize`å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å¾—åˆ°ç™¾åˆ†æ¯”è€Œä¸æ˜¯è®¡æ•°:

```
pd.crosstab(df['time'], df['day'], margins=True, normalize=True)
```

![](img/ae49e03526a707fb4d44c9392cd3a556.png)

åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½®`normalize=True`è·å¾—äº†è¡¨æ ¼ç™¾åˆ†æ¯”ã€‚è¿™ç›¸å½“äºå°†å…¶è®¾ç½®ä¸º`normalize='all'`ã€‚å¯¹äºè¡Œç™¾åˆ†æ¯”ï¼Œæˆ‘ä»¬ä½¿ç”¨`normalize='index'`å’Œ`normalize='columns'`è¡¨ç¤ºåˆ—ç™¾åˆ†æ¯”ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥æ‰©å±•åˆ—å’Œè¡Œçš„å˜é‡é›†:

```
pd.crosstab([df['time'], df['gender']], [df['day'], df['smoker']], 
            margins=True)
```

![](img/78bea4950b1f9390aba07a8530f66b65.png)

å‘ç°`crosstab()`åï¼Œæˆ‘ç°åœ¨ç”¨ç†ŠçŒ«çš„æ—¶å€™ä¹Ÿç»å¸¸ç”¨ã€‚

## ğŸ“æŠ€å·§ 2:ä½¿ç”¨ groupby()å’Œ describe()è¿›è¡Œåˆ†ç»„æ±‡æ€»ç»Ÿè®¡

ä½ å¯èƒ½å·²ç»çŸ¥é“äº†`groupby()`å’Œ`describe()`ã€‚ä½†æ˜¯ä½ ä»¬ä¸€èµ·ç”¨è¿‡å—ï¼Ÿé€šè¿‡ç»“åˆä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†ç±»åˆ—ä¸­çš„å”¯ä¸€å€¼æ¥æ£€æŸ¥æ•°å€¼å˜é‡çš„æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯ï¼Œåªéœ€ä¸€è¡Œä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
df.groupby('day')['tip'].describe()
```

![](img/ed443a85ed1e7a3d1d835cfe92a373ab.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°*æç¤º*çš„æ±‡æ€»ç»Ÿè®¡å¦‚ä½•åœ¨*å¤©*è¿›è¡Œæ¯”è¾ƒã€‚

## ğŸ“æŠ€å·§ 3:ä½¿ç”¨ agg()/aggregate()è¿›è¡Œçµæ´»çš„èšåˆ

*åœ¨æœ¬å¸–ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨* `*agg()*` *ï¼Œ* `*aggregate()*` *çš„åˆ«åã€‚ç„¶è€Œï¼Œä¸¤è€…å¯ä»¥äº’æ¢ä½¿ç”¨ã€‚*

æ‚¨å¯èƒ½çŸ¥é“åŸºæœ¬çš„èšåˆè¯­æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
df.groupby('day')[['tip']].mean()
```

![](img/a397eb519407108186afee6725999b05.png)

ä»¥ä¸‹æ˜¯ç”¨`agg()`è·å¾—ç›¸åŒè¾“å‡ºçš„ä¸€äº›æ›¿ä»£æ–¹æ³•:

```
df.groupby('day')[['tip']].agg('mean')
df.groupby('day').agg({'tip': 'mean'})
```

åœ¨è¿™ä¸ªç®€å•çš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿è¯´æ˜ä¸ºä»€ä¹ˆåº”è¯¥ä½¿ç”¨`agg()`è€Œä¸æ˜¯ç¬¬ä¸€ç§é€‰æ‹©ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬æƒ³è¦æŸ¥çœ‹å¤šä¸ªèšåˆå‡½æ•°çš„è¾“å‡ºæ—¶ï¼Œä½¿ç”¨`agg()`ç»™äº†æˆ‘ä»¬æ›´å¤šçš„çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å‘`agg()`ä¼ é€’ä¸€ä¸ªåˆ—è¡¨æˆ–ä¸€ä¸ªå­—å…¸ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡å¾—åˆ°å‡å€¼å’Œæ ‡å‡†å·®ã€‚

```
df.groupby('day')[['tip']].agg(['mean', 'std']) # list
df.groupby(['day']).agg({'tip': ['mean', 'std']}) # dictionary
```

![](img/61e0af5bdb840d1db2d730f445ad25f0.png)

å¦‚æœæˆ‘ä»¬å¿…é¡»é‡å‘½åè¾“å‡ºåˆ—ï¼Œè€Œä¸æ˜¯è¿™æ ·åš:

```
df.groupby('day')[['tip']].agg(['mean', 'std']).rename(columns={'mean': 'avg', 'std': 'sd'})
```

æˆ‘ä»¬å¯ä»¥æ›´ç®€æ´åœ°åšåˆ°è¿™ä¸¤ç‚¹:

```
df.groupby(['day'])[['tip']].agg([('avg', 'mean'), ('sd', 'std')])
df.groupby(['day']).agg({'tip': [('avg', 'mean'), ('sd', 'std')]})
```

![](img/a8f80150a61ccf9312b4a32f90816168.png)

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½¿ç”¨åˆ—è¡¨æˆ–å­—å…¸éƒ½åŒæ ·æœ‰æ•ˆã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ£€æŸ¥å¤šä¸ªå˜é‡çš„åŒä¸€ç»„æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯ï¼Œä½¿ç”¨ list ä¼šæ›´ç®€æ´ã€‚

```
df.groupby('day')[['tip', 'size']].agg(['mean', 'std'])
```

![](img/9e7399d4e09b07ade5fdb93be0cc5391.png)

å¦ä¸€æ–¹é¢ï¼Œæœ‰æ—¶ä½¿ç”¨å­—å…¸æ˜¯å¯è¡Œçš„æ–¹æ³•ã€‚ä½¿ç”¨ dictionaryï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªå˜é‡æŒ‡å®šä¸åŒçš„é›†åˆå‡½æ•°:

```
df.groupby(['day']).agg({'tip': ['mean', 'std'], 
                         'size': ['median']})
```

![](img/0c30bea33cd8ba2c08c8a3bd0448794a.png)

æœ‰è®¸å¤šèšåˆå‡½æ•°å¯ä¾›ä½¿ç”¨:

â—¼ï¸é¢‘ç‡/è®¡æ•°:`size()`ï¼Œ`count()`
â—¼ï¸ä¸­å¤®å€¾å‘:`mean()`ï¼Œ`median()`
â—¼ï¸æ–¹å·®:`std()`ï¼Œ`var()`
â—¼ï¸å…¶ä»–:`min()`ï¼Œ`max()`ï¼Œï¸ `sum()`ï¼Œ`prod()`ï¼Œ`quantile()`ç­‰ç­‰ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`agg()`ä¸­ä½¿ç”¨ä»»ä½• Series æˆ– DataFrame æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹*æ—¥*å‰æœ€é«˜çš„ä¸¤ä¸ª*æç¤º*ï¼Œæˆ‘ä»¬ä½¿ç”¨:

```
df.groupby('day')['tip'].nlargest(2)
```

![](img/571b1ed50405597e5ae8ee82ec2ac84a.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€äº›æœ€å¤§çš„æç¤ºæ˜¯åœ¨å‘¨å…­ã€‚ğŸ’°

æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ lambda å‡½æ•°:

```
df.groupby(['day']).agg({'tip': [('range', lambda x: x.max() - x.min()), 
                                 ('IQR', lambda x: x.quantile(.75) - x.quantile(.25))]})
```

![](img/43319307632ab29f2b3ce009f6dc64d4.png)

è¿™æ‰©å±•äº†æˆ‘ä»¬å¯ä»¥åšä»€ä¹ˆçš„å¯èƒ½æ€§ï¼ğŸ˜

## ğŸ“æŠ€å·§ 4:åˆ©ç”¨ pivot_table()

å‡è®¾æˆ‘ä»¬éœ€è¦å¾—åˆ°ä¸¤ä¸ªå˜é‡çš„å¹³å‡å€¼*æç¤º*ã€‚ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨`groupby()`:

```
df.groupby(['time', 'day'])['tip'].mean().unstack()
```

![](img/04c36cdaeb2c26ffc11bc52baecd3149.png)

ä½†æ˜¯æ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨`pivot_table()`:

```
df.pivot_table('tip', 'time', 'day')
```

è¿™é‡Œï¼Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šå‚æ•°ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æŒ‰ç…§æ­£ç¡®çš„é¡ºåºä¸ºæ–¹æ³•æä¾›äº†å€¼ã€‚ä¸‹é¢æ˜¯ç›¸åŒä»£ç çš„å¦ä¸€ä¸ªç‰ˆæœ¬ï¼Œå…¶ä¸­æ‰€æœ‰å‚æ•°éƒ½è¢«æ˜¾å¼æŒ‡å®š:

```
df.pivot_table(values='tip', index='time', columns='day')
```

è¿™ä¸ªç‰ˆæœ¬å¯èƒ½å¯è¯»æ€§æ›´å¼ºã€‚æˆ‘è®¤ä¸ºï¼Œå¦‚æœæˆ‘ä»¬çœç•¥ç¬¬ä¸€ä¸ªå‚æ•°åç§°ï¼Œä½¿å…¶ç¨å¾®ç®€æ´ä¸€äº›ï¼Œå¯è¯»æ€§ä¸ä¼šå—åˆ°å½±å“:

```
df.pivot_table('tip', index='time', columns='day')
```

æˆ‘ä»¬å°†ä¿æŒè¿™ç§å½¢å¼å‘å‰å‘å±•ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`pivot_table()`ç»™å‡ºå¹³å‡å€¼ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å®ƒæŒ‡å®šä¸º`aggfunc`å‚æ•°æ¥è½»æ¾åœ°æ›´æ”¹ä¸ºæˆ‘ä»¬å–œæ¬¢çš„å‡½æ•°ï¼Œä¾‹å¦‚`sum()`:

```
df.pivot_table('tip', index='time', columns='day', aggfunc='sum')
```

![](img/91470e4b977c63c824eab707ed4e083e.png)

ç±»ä¼¼äº`crosstab()`ï¼Œç”¨`pivot_table()`ä¹Ÿå¾ˆå®¹æ˜“å¾—åˆ°å°è®¡ã€‚

```
df.pivot_table('tip', index='time', columns='day', aggfunc='sum', 
               margins=True)
```

![](img/150c9ca01a11f075acc4dab407e11415.png)

æˆ‘ä»¬è¿˜å¯ä»¥å°†å­—å…¸ä¼ é€’ç»™`aggfunc`ï¼Œä¸ºä¼ é€’ç»™`values`å‚æ•°çš„æ¯ä¸ªå˜é‡å®šåˆ¶èšåˆå‡½æ•°ã€‚å¦ä¸€ä¸ªæœ‰ç”¨çš„å‚æ•°æ˜¯`fill_value`,åœ¨è¿™é‡Œæˆ‘ä»¬æŒ‡å®šå¦‚æœè¾“å‡ºä¸¢å¤±ï¼Œæˆ‘ä»¬å¸Œæœ›çœ‹åˆ°ä»€ä¹ˆå€¼ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™äº›è§‚ç‚¹:

```
df.pivot_table(['tip', 'size'], index=['time', 'smoker'], 
               columns='day', fill_value=0, margins=True,
               aggfunc={'tip': 'sum', 'size': 'max'})
```

![](img/d02481c5f5d64c8ad75cc72297b85245.png)

ä½¿ç”¨`pivot_table()`ï¼Œæ‚¨å¯ä»¥å‡†ç¡®åœ°çŸ¥é“å“ªäº›å˜é‡å°†å‡ºç°åœ¨è¡Œå’Œåˆ—ä¸­ï¼Œå¹¶ä¸”ä¸éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ•´å½¢ã€‚

## ğŸ“æŠ€å·§ 5:ä½¿ç”¨ transform()å‘æ•°æ®æ·»åŠ èšåˆç»Ÿè®¡ä¿¡æ¯

å½“æˆ‘ä»¬å¸Œæœ›å°†åˆ†ç»„èšåˆåº¦é‡å€¼è¿½åŠ å›æœªåˆ†ç»„çš„æ•°æ®æ—¶ï¼Œè¿™ä¸ªæŠ€å·§å¾ˆæœ‰ç”¨ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹:

```
df['avg_tip_by_gender'] = df.groupby('gender')['tip'].transform('mean')df.head()
```

![](img/dbadbe828cb40a537c2c4ec6327d7df1.png)

åœ¨æœ¬ä¾‹ä¸­ï¼Œæ–°åˆ›å»ºçš„å˜é‡ *avg_tip_by_gender* æ˜¾ç¤ºäº†æŒ‰*æ€§åˆ«*åˆ†ç±»çš„å¹³å‡ *tip* ã€‚æ¢å¥è¯è¯´ï¼Œæ¥è‡ªä¸‹æ–¹çš„å¹³å‡*æç¤º*ç”±*æ€§åˆ«*æ·»åŠ å›æœªåˆ†ç»„æ•°æ®ã€‚

```
df.groupby('gender')['tip'].agg(['mean', 'std'])
```

![](img/67c8411e22ebad79473a44e7ce49a80d.png)

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªç¨å¾®é«˜çº§ä¸€ç‚¹çš„ä¾‹å­:

```
df['n_sd_from_gender_avg_tip'] = df.groupby('gender')['tip'].transform(lambda x: (x-x.mean())/x.std())df.head()
```

![](img/b13f15853903d3f1e096d901e45f2621.png)

è¿™é‡Œï¼Œä½¿ç”¨`lambda`å‡½æ•°ï¼Œæˆ‘ä»¬ä¸ºå˜é‡*æç¤º*åšäº† 3 ä»¶äº‹:

`x.mean():`æŒ‰*æ€§åˆ«*æ‰¾å‡å€¼ã€‚
`x-x.mean():`é€šè¿‡*æ€§åˆ«*æ±‚è·ç¦»å¹³å‡å€¼ã€‚
`(x-x.mean())/x.std():`ä»¥æ ‡å‡†å·®ä¸ºå•ä½æ±‚è·ç¦»ã€‚

è®©æˆ‘ä»¬ä»¥ç¬¬ä¸€æ¡è®°å½•(index=0)ä¸ºä¾‹ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œå°†æ•°å­—å››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½:`x=1.01`ã€`x.mean()=2.83`ã€`x.std()= 1.16`

ç„¶åï¼Œ*n _ SD _ from _ gender _ avg _ tip*=(1.01-2.83)/1.16 =-1.57

è¿™å°±æ˜¯æˆ‘ä»¬åœ¨ *n_sd_from_gender_avg_tip ç¬¬ä¸€è¡Œæ‰¾åˆ°çš„ã€‚*å¯¹äºæ­¤è®°å½•ï¼Œ*å°è´¹*é‡‘é¢æ¯”å¥³æ€§é¡¾å®¢çš„å¹³å‡*å°è´¹*ä½çº¦ 1.57 ä¸ªæ ‡å‡†å·®ã€‚

Voilaâ•:è¿™äº›æ˜¯æˆ‘ç›®å‰å…³äºç†ŠçŒ«çš„é¡¶çº§æ•°æ®æ±‡æ€»æŠ€å·§ï¼

![](img/82beb509b151c6f79587e56ba3e7c950.png)

ç…§ç‰‡ç”±[å®ç³å¨œÂ·å‰ƒåˆ€æ´›å¨ƒ](https://unsplash.com/@bolotohodova?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„

*æ‚¨æƒ³è®¿é—®æ›´å¤šè¿™æ ·çš„å†…å®¹å—ï¼Ÿåª’ä½“ä¼šå‘˜å¯ä»¥æ— é™åˆ¶åœ°è®¿é—®åª’ä½“ä¸Šçš„ä»»ä½•æ–‡ç« ã€‚å¦‚æœæ‚¨ä½¿ç”¨* [*æˆ‘çš„æ¨èé“¾æ¥*](https://zluvsand.medium.com/membership)*æˆä¸ºä¼šå‘˜ï¼Œæ‚¨çš„ä¸€éƒ¨åˆ†ä¼šè´¹å°†ç›´æ¥ç”¨äºæ”¯æŒæˆ‘ã€‚*

è°¢è°¢ä½ çœ‹æˆ‘çš„å¸–å­ã€‚å¸Œæœ›æˆ‘çš„å»ºè®®å¯¹ä½ æœ‰ç”¨ï¼Œâœ‚ï¸.å¦‚æœä½ æœ‰å…´è¶£äº†è§£æ›´å¤šå…³äºç†ŠçŒ«çš„ä¿¡æ¯ï¼Œè¿™é‡Œæœ‰æˆ‘å…¶ä»–å¸–å­çš„é“¾æ¥:
â—¼ï¸ï¸ [åœ¨ç†ŠçŒ«ä¸­ç¼–å†™ 5 ä¸ªå¸¸è§çš„ SQL æŸ¥è¯¢](/writing-5-common-sql-queries-in-pandas-90b52f17ad76)
â—¼ï¸ï¸ [ç»™ç†ŠçŒ«ç”¨æˆ·çš„ 5 ä¸ªæç¤º](/5-tips-for-pandas-users-e73681d16d17)
â—¼ï¸ï¸ [å¦‚ä½•åœ¨ç†ŠçŒ«æ•°æ®æ¡†æ¶ä¸­è½¬æ¢å˜é‡](/transforming-variables-in-a-pandas-dataframe-bce2c6ef91a1)

å†è§ğŸƒğŸ’¨