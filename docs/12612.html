<html>
<head>
<title>How to handle Multiclass Imbalanced Data?- Say No To SMOTE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•å¤„ç†å¤šç±»ä¸å¹³è¡¡æ•°æ®ï¼Ÿ-å¯¹ SMOTE è¯´ä¸</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/how-to-handle-multiclass-imbalanced-data-say-no-to-smote-e9a7f393c310?source=collection_archive---------8-----------------------#2020-08-31">https://towardsdatascience.com/how-to-handle-multiclass-imbalanced-data-say-no-to-smote-e9a7f393c310?source=collection_archive---------8-----------------------#2020-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dd4a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">ä¸éœ€è¦å†æ‰“äº†ã€‚</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/59f938f0417ae46b7aac07816a74c8f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*oDmeGslvHMUtxmVMvdOGCg.png"/></div></figure><p id="043a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">æœºå™¨å­¦ä¹ ä¸­çš„ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯å¤„ç†ä¸å¹³è¡¡æ•°æ®ï¼Œå…¶ä¸­ç›®æ ‡ç±»ä¸­å­˜åœ¨é«˜åº¦ä¸ç›¸ç§°çš„æ•°æ®ã€‚</p><p id="3bef" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">ä½ å¥½ï¼Œä¸–ç•Œï¼Œè¿™æ˜¯æˆ‘ä¸ºæ•°æ®ç§‘å­¦ç¤¾åŒºå†™çš„ç¬¬äºŒç¯‡åšå®¢ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•å¤„ç†å¤šç±»ä¸å¹³è¡¡æ•°æ®é—®é¢˜ã€‚</p><h1 id="5b97" class="lk ll iq bd lm ln lo lp lq lr ls lt lu jw lv jx lw jz lx ka ly kc lz kd ma mb bi translated">ä»€ä¹ˆæ˜¯å¤šç±»ä¸å¹³è¡¡æ•°æ®ï¼Ÿ</h1><p id="f417" class="pw-post-body-paragraph kn ko iq kp b kq mc jr ks kt md ju kv kw me ky kz la mf lc ld le mg lg lh li ij bi translated">å½“åˆ†ç±»é—®é¢˜çš„ç›®æ ‡ç±»(ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Š)ä¸æ˜¯å‡åŒ€åˆ†å¸ƒæ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºä¸å¹³è¡¡æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬ä¸èƒ½å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¨¡å‹å°†ä¼šå˜æˆä¸€åœºç¾éš¾ï¼Œå› ä¸ºä½¿ç”¨é˜¶çº§ä¸å¹³è¡¡æ•°æ®çš„æ¨¡å‹åå‘äºå¤§å¤šæ•°é˜¶çº§ã€‚</p><p id="a4da" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">å¤„ç†ä¸å¹³è¡¡æ•°æ®æœ‰ä¸åŒçš„æ–¹æ³•ï¼Œæœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯è¿‡é‡‡æ ·å’Œåˆ›å»ºåˆæˆæ ·æœ¬ã€‚</p><h1 id="64de" class="lk ll iq bd lm ln lo lp lq lr ls lt lu jw lv jx lw jz lx ka ly kc lz kd ma mb bi translated">ä»€ä¹ˆæ˜¯ SMOTEï¼Ÿ</h1><p id="db87" class="pw-post-body-paragraph kn ko iq kp b kq mc jr ks kt md ju kv kw me ky kz la mf lc ld le mg lg lh li ij bi translated">SMOTE æ˜¯ä¸€ç§è¿‡é‡‡æ ·æŠ€æœ¯ï¼Œå®ƒä»æ•°æ®é›†ç”Ÿæˆåˆæˆæ ·æœ¬ï¼Œä»è€Œæé«˜å°‘æ•°ç±»çš„é¢„æµ‹èƒ½åŠ›ã€‚å°½ç®¡æ²¡æœ‰ä¿¡æ¯ä¸¢å¤±ï¼Œä½†å®ƒæœ‰ä¸€äº›é™åˆ¶ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/51eeca46f25ea31f65f533130b4ee3b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1i7SEN4dg9dkjYoaci6QBg.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">åˆæˆæ ·å“</p></figure><p id="9279" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir"> <em class="mq">å±€é™æ€§:</em> </strong></p><ol class=""><li id="87e3" class="mr ms iq kp b kq kr kt ku kw mt la mu le mv li mw mx my mz bi translated">SMOTE å¯¹äºé«˜ç»´æ•°æ®ä¸æ˜¯å¾ˆå¥½</li><li id="3c63" class="mr ms iq kp b kq na kt nb kw nc la nd le ne li mw mx my mz bi translated">å¯èƒ½ä¼šå‘ç”Ÿç±»çš„é‡å ï¼Œè¿™ä¼šç»™æ•°æ®å¸¦æ¥æ›´å¤šçš„å™ªå£°ã€‚</li></ol><p id="640b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">å› æ­¤ï¼Œä¸ºäº†è·³è¿‡è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨'<strong class="kp ir"> class_weight </strong>'å‚æ•°ä¸ºç±»æ‰‹åŠ¨åˆ†é…æƒé‡ã€‚</p><h1 id="883a" class="lk ll iq bd lm ln lo lp lq lr ls lt lu jw lv jx lw jz lx ka ly kc lz kd ma mb bi translated">ä¸ºä»€ä¹ˆä½¿ç”¨ç±»æƒé‡ï¼Ÿ</h1><p id="9c82" class="pw-post-body-paragraph kn ko iq kp b kq mc jr ks kt md ju kv kw me ky kz la mf lc ld le mg lg lh li ij bi translated">ç±»æƒé‡é€šè¿‡ç»™å…·æœ‰ä¸åŒæƒé‡çš„ç±»ä¸€ä¸ªæƒ©ç½šæ¥ç›´æ¥ä¿®æ”¹æŸå¤±å‡½æ•°ã€‚å®ƒæ„å‘³ç€æœ‰ç›®çš„åœ°å¢åŠ å°‘æ•°é˜¶çº§çš„æƒåŠ›ï¼Œå‡å°‘å¤šæ•°é˜¶çº§çš„æƒåŠ›ã€‚å› æ­¤ï¼Œå®ƒæ¯” SMOTE ç»™å‡ºæ›´å¥½çš„ç»“æœã€‚</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h1 id="8942" class="lk ll iq bd lm ln nm lp lq lr nn lt lu jw no jx lw jz np ka ly kc nq kd ma mb bi translated">æ¦‚è¿°:</h1><p id="2da3" class="pw-post-body-paragraph kn ko iq kp b kq mc jr ks kt md ju kv kw me ky kz la mf lc ld le mg lg lh li ij bi translated">æˆ‘çš„ç›®æ ‡æ˜¯è®©è¿™ä¸ªåšå®¢éå¸¸ç®€å•ã€‚æˆ‘ä»¬æœ‰ä¸€äº›æœ€å¸¸ç”¨çš„æŠ€æœ¯æ¥è·å¾—æ•°æ®çš„æƒé‡ï¼Œè¿™äº›æŠ€æœ¯å¯¹æˆ‘ä¸å¹³è¡¡çš„å­¦ä¹ é—®é¢˜æœ‰æ•ˆã€‚</p><ol class=""><li id="99f6" class="mr ms iq kp b kq kr kt ku kw mt la mu le mv li mw mx my mz bi translated">Sklearn utilsã€‚</li><li id="61a4" class="mr ms iq kp b kq na kt nb kw nc la nd le ne li mw mx my mz bi translated">è®¡æ•°åˆ°é•¿åº¦ã€‚</li><li id="36b7" class="mr ms iq kp b kq na kt nb kw nc la nd le ne li mw mx my mz bi translated">å¹³æ»‘é‡é‡ã€‚</li><li id="11ef" class="mr ms iq kp b kq na kt nb kw nc la nd le ne li mw mx my mz bi translated">æ ·æœ¬æƒé‡ç­–ç•¥ã€‚</li></ol><h1 id="f9a2" class="lk ll iq bd lm ln lo lp lq lr ls lt lu jw lv jx lw jz lx ka ly kc lz kd ma mb bi translated">1.Sklearn å®ç”¨ç¨‹åº:</h1><p id="1a9d" class="pw-post-body-paragraph kn ko iq kp b kq mc jr ks kt md ju kv kw me ky kz la mf lc ld le mg lg lh li ij bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ sklearn è®¡ç®—ç±»æƒé‡æ¥è·å¾—ç±»æƒé‡ã€‚é€šè¿‡åœ¨è®­ç»ƒæ¨¡å‹æ—¶å°†é‚£äº›æƒé‡æ·»åŠ åˆ°å°‘æ•°ç±»ï¼Œå¯ä»¥åœ¨åˆ†ç±»ç±»æ—¶å¸®åŠ©æ€§èƒ½ã€‚</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="d990" class="nw ll iq ns b gy nx ny l nz oa">from sklearn.utils import class_weight</span><span id="f91a" class="nw ll iq ns b gy ob ny l nz oa">class_weight = class_weight.compute_class_weight('balanced,<br/>                                                np.unique(target_Y),<br/>                                                target_Y)</span><span id="6e25" class="nw ll iq ns b gy ob ny l nz oa">model = LogisticRegression(class_weight = class_weight)<br/>model.fit(X,target_Y)</span><span id="cb79" class="nw ll iq ns b gy ob ny l nz oa"># ['balanced', 'calculated balanced', 'normalized'] are hyperpaameters whic we can play with.</span></pre><p id="abd1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">ä»é€»è¾‘å›å½’åˆ° Catboostï¼Œå‡ ä¹æ‰€æœ‰çš„åˆ†ç±»ç®—æ³•éƒ½æœ‰ä¸€ä¸ª class_weight å‚æ•°ã€‚ä½†æ˜¯ XGboost æœ‰é’ˆå¯¹äºŒå…ƒåˆ†ç±»çš„ scale_pos_weight å’Œé’ˆå¯¹äºŒå…ƒå’Œå¤šç±»é—®é¢˜çš„ sample_weights(å‚è€ƒ 4)ã€‚</p><h1 id="e676" class="lk ll iq bd lm ln lo lp lq lr ls lt lu jw lv jx lw jz lx ka ly kc lz kd ma mb bi translated">2.è®¡æ•°ä¸é•¿åº¦ä¹‹æ¯”:</h1><p id="5503" class="pw-post-body-paragraph kn ko iq kp b kq mc jr ks kt md ju kv kw me ky kz la mf lc ld le mg lg lh li ij bi translated">éå¸¸ç®€å•ç›´ç™½ï¼å°†æ¯ç±»çš„è®¡æ•°é™¤ä»¥è¡Œæ•°ã€‚ç„¶å</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="611e" class="nw ll iq ns b gy nx ny l nz oa">weights = df[target_Y].value_counts()/len(df)<br/>model = LGBMClassifier(class_weight = weights)<br/>model.fit(X,target_Y)</span></pre><h1 id="739b" class="lk ll iq bd lm ln lo lp lq lr ls lt lu jw lv jx lw jz lx ka ly kc lz kd ma mb bi translated">3.å¹³æ»‘æƒé‡æŠ€æœ¯:</h1><p id="899f" class="pw-post-body-paragraph kn ko iq kp b kq mc jr ks kt md ju kv kw me ky kz la mf lc ld le mg lg lh li ij bi translated">è¿™æ˜¯é€‰æ‹©æƒé‡çš„ä¼˜é€‰æ–¹æ³•ä¹‹ä¸€ã€‚</p><p id="aaac" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">labels_dict æ˜¯åŒ…å«æ¯ä¸ªç±»çš„è®¡æ•°çš„å­—å…¸å¯¹è±¡ã€‚</p><p id="0d2b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">log å‡½æ•°å¹³æ»‘ä¸å¹³è¡¡ç±»çš„æƒé‡ã€‚</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="943a" class="nw ll iq ns b gy nx ny l nz oa">def class_weight(labels_dict,mu=0.15):<br/>    total = np.sum(labels_dict.values())<br/>    keys = labels_dict.keys()<br/>    weight = dict()</span><span id="fbb2" class="nw ll iq ns b gy ob ny l nz oa">for i in keys:<br/>        score = np.log(mu*total/float(labels_dict[i]))<br/>        weight[i] = score if score &gt; 1 else 1</span><span id="3b3d" class="nw ll iq ns b gy ob ny l nz oa">return weight</span><span id="2712" class="nw ll iq ns b gy ob ny l nz oa"># random labels_dict<br/>labels_dict = <!-- -->df[target_Y].value_counts().to_dict()</span><span id="7473" class="nw ll iq ns b gy ob ny l nz oa">weights = class_weight(labels_dict)</span><span id="7b93" class="nw ll iq ns b gy ob ny l nz oa">model = RandomForestClassifier(class_weight = weights)<br/>model.fit(X,target_Y)</span></pre><h1 id="27fc" class="lk ll iq bd lm ln lo lp lq lr ls lt lu jw lv jx lw jz lx ka ly kc lz kd ma mb bi translated">4.æ ·å“é‡é‡ç­–ç•¥:</h1><p id="aedc" class="pw-post-body-paragraph kn ko iq kp b kq mc jr ks kt md ju kv kw me ky kz la mf lc ld le mg lg lh li ij bi translated">ä»¥ä¸‹å‡½æ•°ä¸åŒäº class_weight å‚æ•°ï¼Œè¯¥å‚æ•°ç”¨äºè·å– XGboost ç®—æ³•çš„æ ·æœ¬æƒé‡ã€‚å®ƒä¸ºæ¯ä¸ªè®­ç»ƒæ ·æœ¬è¿”å›ä¸åŒçš„æƒé‡ã€‚</p><blockquote class="oc od oe"><p id="eadd" class="kn ko mq kp b kq kr jr ks kt ku ju kv of kx ky kz og lb lc ld oh lf lg lh li ij bi translated">Sample_weight æ˜¯ä¸€ä¸ªä¸æ•°æ®é•¿åº¦ç›¸åŒçš„æ•°ç»„ï¼ŒåŒ…å«åº”ç”¨äºæ¯ä¸ªæ ·æœ¬çš„æ¨¡å‹æŸå¤±çš„æƒé‡ã€‚</p></blockquote><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="0ecb" class="nw ll iq ns b gy nx ny l nz oa">def BalancedSampleWeights(y_train,class_weight_coef):<br/>    classes = np.unique(y_train, axis = 0)<br/>    classes.sort()<br/>    class_samples = np.bincount(y_train)<br/>    total_samples = class_samples.sum()<br/>    n_classes = len(class_samples)<br/>    weights = total_samples / (n_classes * class_samples * 1.0)<br/>    class_weight_dict = {key : value for (key, value) in              zip(classes, weights)}<br/>    class_weight_dict[classes[1]] = class_weight_dict[classes[1]] * <br/>    class_weight_coef<br/>    sample_weights = [class_weight_dict[i] for i in y_train]<br/>    return sample_weights</span><span id="5f8f" class="nw ll iq ns b gy ob ny l nz oa">#Usage<br/>weight=BalancedSampleWeights(<!-- -->target_Y<!-- -->,class_weight_coef)<br/>model = XGBClassifier(sample_weight = weight)<br/>model.fit(X, <!-- -->target_Y<!-- -->)</span></pre><p id="487a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir"> <em class="mq">ç±» _ æƒé‡ vs æ ·æœ¬ _ æƒé‡:</em> </strong></p><p id="4901" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe oi oj ok ns b">sample_weights</code>ç”¨äºç»™å‡ºæ¯ä¸ªè®­ç»ƒæ ·æœ¬çš„æƒé‡ã€‚è¿™æ„å‘³ç€æ‚¨åº”è¯¥ä¼ é€’ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ æ•°é‡ä¸æ‚¨çš„è®­ç»ƒæ ·æœ¬å®Œå…¨ç›¸åŒã€‚</p><p id="4746" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe oi oj ok ns b">class_weights</code>ç”¨äºä¸ºæ¯ä¸ªç›®æ ‡ç±»èµ‹äºˆæƒé‡ã€‚è¿™æ„å‘³ç€ä½ åº”è¯¥ä¸ºä½ è¦åˆ†ç±»çš„æ¯ä¸ªç±»ä¼ é€’ä¸€ä¸ªæƒé‡ã€‚</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h1 id="08a0" class="lk ll iq bd lm ln nm lp lq lr nn lt lu jw no jx lw jz np ka ly kc nq kd ma mb bi translated">ç»“è®º:</h1><p id="2ac3" class="pw-post-body-paragraph kn ko iq kp b kq mc jr ks kt md ju kv kw me ky kz la mf lc ld le mg lg lh li ij bi translated">ä»¥ä¸Šæ˜¯ä¸ºä½ çš„åˆ†ç±»å™¨å¯»æ‰¾ç±»æƒé‡å’Œæ ·æœ¬æƒé‡çš„å‡ ç§æ–¹æ³•ã€‚æˆ‘æåˆ°äº†å‡ ä¹æ‰€æœ‰å¯¹æˆ‘çš„é¡¹ç›®æœ‰æ•ˆçš„æŠ€æœ¯ã€‚</p><p id="4ab0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">æˆ‘è¯·æ±‚è¯»è€…å°è¯•ä¸€ä¸‹è¿™äº›å¯ä»¥å¸®åŠ©ä½ çš„æŠ€æœ¯ï¼Œå¦‚æœä¸æ˜¯æŠŠå®ƒå½“ä½œå­¦ä¹ çš„è¯ğŸ˜„ä¸‹æ¬¡å¯èƒ½ä¼šå¯¹ä½ æœ‰å¸®åŠ©ğŸ˜œ</p><p id="4d7b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">é€šè¿‡ LinkedIn è”ç³»æˆ‘ğŸ˜</p></div></div>    
</body>
</html>