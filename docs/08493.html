<html>
<head>
<title>Are you using Pipeline in Scikit-Learn?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你在 Scikit-Learn 中使用 Pipeline 了吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/are-you-using-pipeline-in-scikit-learn-ac4cd85cb27f?source=collection_archive---------24-----------------------#2020-06-20">https://towardsdatascience.com/are-you-using-pipeline-in-scikit-learn-ac4cd85cb27f?source=collection_archive---------24-----------------------#2020-06-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e729" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Pipeline 和 GridSearchCV 找到最佳的定标器、估算器和不同的变压器。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fc7025897311ba806ba7f42504bcfd85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LdwXVtec9-Byt-lOO7Csyg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:作者图片</p></figure><p id="a668" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你在做机器学习，你会遇到管道，因为它们可以帮助你做出更好的机器学习工作流程，易于理解和重现。</p><blockquote class="lu lv lw"><p id="721f" class="ky kz lx la b lb lc ju ld le lf jx lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated">如果你不知道管道，你可以参考 Rebecca Vickery 的博客<a class="mb mc ep" href="https://medium.com/u/8b7aca3e5b1c?source=post_page-----ac4cd85cb27f--------------------------------" rel="noopener" target="_blank"/><a class="ae md" href="https://medium.com/vickdata/a-simple-guide-to-scikit-learn-pipelines-4ac0d974bdcf" rel="noopener">Scikit-learn 管道的简单指南</a>和<a class="mb mc ep" href="https://medium.com/u/9a3c3c477239?source=post_page-----ac4cd85cb27f--------------------------------" rel="noopener" target="_blank">Saptashwa Bhattacharyya</a><a class="ae md" rel="noopener" target="_blank" href="/a-simple-example-of-pipeline-in-machine-learning-with-scikit-learn-e726ffbb6976">Scikit-learn 的机器学习管道的简单例子</a>。</p></blockquote><p id="4462" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我最近发现，你可以将 Pipeline 和 GridSearchCV 结合起来，不仅可以为你的模型找到最好的超参数，还可以为你的机器学习任务找到最好的变压器</p><ol class=""><li id="169d" class="me mf it la b lb lc le lf lh mg ll mh lp mi lt mj mk ml mm bi translated">缩放器缩放您的数据。</li><li id="f657" class="me mf it la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">填补缺失值的估算策略。</li><li id="ff86" class="me mf it la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">您应该使用的 PCA 成分数量。</li></ol><p id="5e15" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">和许多其他人。让我们看看如何能做到这一点。</p><h2 id="1418" class="ms mt it bd mu mv mw dn mx my mz dp na lh nb nc nd ll ne nf ng lp nh ni nj nk bi translated">数据集详细信息</h2><p id="b09d" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">为了更好地演示，我将使用 OpenML 中的<strong class="la iu"> Titanic 数据集</strong>来演示如何创建数据管道。</p><p id="eeb7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以使用以下命令下载数据集-</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="4984" class="ms mt it nr b gy nv nw l nx ny">from sklearn.datasets import fetch_openml</span><span id="7da4" class="ms mt it nr b gy nz nw l nx ny"># Dataset details at- <a class="ae md" href="https://www.openml.org/d/40945" rel="noopener ugc nofollow" target="_blank">https://www.openml.org/d/40945</a><br/>X, y = fetch_openml("titanic", version=1, as_frame=True, return_X_y=True)</span></pre><p id="c7f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，看看我的笔记本，里面有关于每个操作的更多细节，可以随意下载并导入到您的环境中，然后进行试验-</p><div class="oa ob gp gr oc od"><a href="https://github.com/ankitgoel1602/data-science/tree/master/data-pipeline" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">ankitgoel 1602/数据科学</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">该目录详细介绍了如何使用数据管道对数据进行各种操作。还有…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">github.com</p></div></div><div class="om l"><div class="on l oo op oq om or ks od"/></div></div></a></div><h2 id="017e" class="ms mt it bd mu mv mw dn mx my mz dp na lh nb nc nd ll ne nf ng lp nh ni nj nk bi translated">创建数据转换器管道</h2><p id="195a" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">在这里，我将使用一部分特性来进行演示。数据集既有分类特征又有数值特征，我们将对它们应用不同的操作。流程是这样的-</p><p id="a05a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">1.定义数字和分类特征。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="8f52" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.对于数字特征，填充缺失值，然后缩放数据。</p><p id="1f72" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">数据集中的数字特征很少有缺失值，我们在这里使用简单估算器来填充这些值，也可以使用其他估算器。此外，我们应该使用比例来标准化数字特征的范围，因为许多机器学习模型需要遵循相同比例的特征。我还没有定义输入的策略和缩放器需要使用，因为同样可以使用 GridSearchCV 搜索。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="ffce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.对于分类特征，填充缺失值，然后应用一键编码。</p><p id="8fb5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们数据集中的“已装船”要素几乎没有缺失值。因为我们有不同的策略来填充分类特征，所以要为此创建不同的估算器。此外，由于分类特性只有几个值，所以我使用 OneHotEncoder，它通常用于为分类列中的每个值创建不同的特性。使用 GridSearchCV 搜索输入策略。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="3778" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.使用 ColumnTransformer 组合数字和分类转换器。</p><p id="1c30" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">ColumnTransformer 有助于为不同类型的输入定义不同的转换器，并在转换后将它们组合到单个特征空间中。在这里，我们应用上面为我们的数字和分类特征创建的数字转换器和分类转换器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="fc17" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.应用主成分分析降低维数。</p><p id="de7f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">主成分分析(PCA)是一种线性降维算法，用于通过保持最大方差来减少数据集中的特征数量。我们可能不需要在这里应用 PCA，因为它是一个小数据集，但我们的想法是展示如何使用 GridSearchCV 在 PCA 中搜索 number_of _components。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><h2 id="b060" class="ms mt it bd mu mv mw dn mx my mz dp na lh nb nc nd ll ne nf ng lp nh ni nj nk bi translated">将分类器添加到管道中</h2><p id="f346" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">上面，我们创建了一个预处理器管道，其中包含了我们希望应用于数据的所有操作。我将在这里使用逻辑回归作为我们问题的分类器。如果你有兴趣知道如何应用多种模型，丽贝卡·维克里在她的博客中提到了一个很好的方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><h2 id="ee8e" class="ms mt it bd mu mv mw dn mx my mz dp na lh nb nc nd ll ne nf ng lp nh ni nj nk bi translated">应用 GridSearchCV</h2><p id="95c1" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">每个数据科学家都知道 GridSearchCV，它可以帮助我们找到模型的最佳超参数。有一点是<strong class="la iu">错过了</strong>的，那就是你甚至可以借助<strong class="la iu">管道</strong>用它来找出<strong class="la iu">最好的变形金刚</strong>。在我们上面创建的预处理器管道中，你可能已经注意到我们<strong class="la iu">没有定义</strong></p><ol class=""><li id="4d92" class="me mf it la b lb lc le lf lh mg ll mh lp mi lt mj mk ml mm bi translated">定标器，</li><li id="28f1" class="me mf it la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">输入缺失值的策略，</li><li id="cdf3" class="me mf it la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">PCA 中的组件数量</li></ol><p id="b01a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为我们可以使用 GridSearchCV 来找到它们的最佳值。这是如何做到的-</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="64f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以上，我试图从 3 个不同的定标器和估算策略中找出最佳定标器，用于我们的数字和分类列，以及 PCA 的组件和我们模型的超参数。很有帮助，不是吗？</p><h2 id="ba51" class="ms mt it bd mu mv mw dn mx my mz dp na lh nb nc nd ll ne nf ng lp nh ni nj nk bi translated">可视化管道</h2><p id="06c8" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">Scikit-Learn 0.23.1 增加了可视化复合估计量的功能，这对于交叉检查您应用的步骤非常有帮助。下面的代码可以帮助你可视化数据管道。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/7b846952c35bb44b86e6772dde65d332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*yqwjbqRI2tr8jiwMDHP5Pg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:作者 GIF</p></figure><h2 id="dbc2" class="ms mt it bd mu mv mw dn mx my mz dp na lh nb nc nd ll ne nf ng lp nh ni nj nk bi translated">缓存管道中的转换器</h2><p id="71b9" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">在这里，我创建了许多不同的数据可以计算密集型变压器。管道提供了一个参数'<strong class="la iu">存储器</strong>，如果参数和输入数据相同，可以用它来缓存转换器。我们可以将“memory”设置为缓存转换器的目录路径，或者它可以是一个 joblib。内存对象。下面，我使用当前目录作为缓存目录，在这里将创建转换器的所有缓存对象。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="ef70" class="ms mt it nr b gy nv nw l nx ny">cache_dir = "."<br/>cached_pipeline = Pipeline(estimators, memory=cache_dir)</span></pre></div><div class="ab cl ov ow hx ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="im in io ip iq"><p id="d311" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我一直在使用管道，因为它非常容易实现，并且帮助我们解决了许多问题。我希望这也能帮助你们改进机器学习的工作流程。如果你刚刚开始你的数据科学之旅，或者想了解一些用于数据科学的很酷的 python 库，那么看看这个- <a class="ae md" href="/swlh/start-your-data-science-journey-today-37366ee463f" rel="noopener ugc nofollow" target="_blank">今天就开始你的数据科学之旅</a>。</p><p id="0a4e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意安全！！！继续学习！！！</p></div></div>    
</body>
</html>