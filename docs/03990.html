<html>
<head>
<title>Here’s How To Calculate Distance Between 2 Geolocations in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以下是如何用Python计算两个地理位置之间的距离</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/heres-how-to-calculate-distance-between-2-geolocations-in-python-93ecab5bbba4?source=collection_archive---------8-----------------------#2020-04-13">https://towardsdatascience.com/heres-how-to-calculate-distance-between-2-geolocations-in-python-93ecab5bbba4?source=collection_archive---------8-----------------------#2020-04-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0fc0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">想用Python按地理位置过滤？还是找一定半径内的地方？从这里开始。</h2></div><p id="ee3f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">地理位置数据无处不在——许多可下载的数据集都有以某种形式表示的位置数据，最常见的是以普通的纬度和经度对表示。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/73779cd0081656fb37bd422e2b4c4e87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KHFcI-wTUo8-fCKS"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae lu" href="https://unsplash.com/@iambrettzeck?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Brett Zeck </a>拍照</p></figure><p id="7264" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你做过任何机器学习，将原始纬度和经度视为<strong class="kk iu">特征</strong>可能听起来不是一个好主意。想象一下，你的整个数据集位于一个城市，地理位置的差异非常小，因此机器学习算法不太可能很好地挑选差异。</p><p id="244e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要解决这个问题，有一个清晰的解决方案——你可以使用一些(可能)付费或免费的API<strong class="kk iu"/>。如果你对道路距离感兴趣，这可能会派上用场——但在本文中，我们将处理一个<strong class="kk iu">直线距离</strong>。</p><p id="d1a2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们会用一点数学来做所有这些——用<strong class="kk iu">哈弗线距离</strong>公式。如果您从未听说过它，请不要担心，当您第一次看到它时，也不要害怕——因为用Python实现它相当简单。</p><p id="8853" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">事不宜迟，让我们开始吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="39b0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">引入哈弗线距离</h1><p id="3359" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">根据维基百科的官方页面，哈弗辛公式确定了给定经度和纬度的球体上两点之间的大圆距离。[1]</p><p id="ddde" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是我们将在Python中实现的公式，它位于维基百科文章的中间:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/0fda0bd58b5c8e0cca4329a6cb06d2a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*HPzoryv8InMFwWIYTWEkbw.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">资料来源:https://en.wikipedia.org/wiki/Haversine_formula</p></figure><p id="dee9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要的另一件事是地球的半径，这可以通过简单的谷歌搜索找到。谷歌报告说是6471公里。</p><p id="ef8b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">太好了，让我们用Python实现这个公式吧！</p><p id="eb8c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是代码，因为我希望这篇文章尽可能实用:</p><pre class="lf lg lh li gt na nb nc nd aw ne bi"><span id="beb9" class="nf md it nb b gy ng nh l ni nj">def haversine_distance(lat1, lon1, lat2, lon2):<br/>   r = 6371<br/>   phi1 = np.radians(lat1)<br/>   phi2 = np.radians(lat2)<br/>   delta_phi = np.radians(lat2 — lat1)<br/>   delta_lambda = np.radians(lon2 — lon1)<br/>   a = np.sin(delta_phi / 2)**2 + np.cos(phi1) * np.cos(phi2) *   np.sin(delta_lambda / 2)**2<br/>   res = r * (2 * np.arctan2(np.sqrt(a), np.sqrt(1 — a)))<br/>   return np.round(res, 2)</span></pre><p id="c154" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我知道这看起来很糟糕，但是只要把它粘贴到你的代码编辑器中，不要看它(如果你不想看的话)。好了，现在当这个完成后，我们可以进行更实际的部分。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bfb3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">让我们计算一些距离</h1><p id="7035" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">首先，我决定在纽约宣布一个起点，坐标是:</p><ul class=""><li id="2509" class="nk nl it kk b kl km ko kp kr nm kv nn kz no ld np nq nr ns bi translated">纬度:40.6976637</li><li id="1338" class="nk nl it kk b kl nt ko nu kr nv kv nw kz nx ld np nq nr ns bi translated">经度:-74.1197643</li></ul><p id="2749" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者在代码中:</p><pre class="lf lg lh li gt na nb nc nd aw ne bi"><span id="776e" class="nf md it nb b gy ng nh l ni nj">start_lat, start_lon = 40.6976637, -74.1197643</span></pre><p id="9495" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我声明了一个Pandas DataFrame(确保首先导入Numpy和Pandas ),其中包含3个美国城市的名称和地理位置——<em class="ny">丹佛</em>、<em class="ny">迈阿密</em>和<em class="ny">芝加哥</em>。下面是代码，因此您不必手动操作:</p><pre class="lf lg lh li gt na nb nc nd aw ne bi"><span id="38f5" class="nf md it nb b gy ng nh l ni nj">cities = pd.DataFrame(data={<br/>   'City': ['Denver', 'Miami', 'Chicago'],<br/>   'Lat' : [39.7645187, 25.7825453, 41.8339037],<br/>   'Lon' : [-104.9951948, -80.2994985, -87.8720471]<br/>})</span></pre><p id="d85e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">太好了，现在我们有了开始计算距离所需的一切。我们可以通过一个简单的循环来实现，将距离临时存储在一个列表中:</p><pre class="lf lg lh li gt na nb nc nd aw ne bi"><span id="9a43" class="nf md it nb b gy ng nh l ni nj">distances_km = []</span><span id="a5f8" class="nf md it nb b gy nz nh l ni nj">for row in cities.itertuples(index=False):<br/>   distances_km.append(<br/>       haversine_distance(start_lat, start_lon, row.Lat, row.Lon)<br/>   )</span></pre><p id="6300" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完成后，我们可以将这个列表转换成DataFrame中的一个新的<strong class="kk iu">列</strong>:</p><pre class="lf lg lh li gt na nb nc nd aw ne bi"><span id="2763" class="nf md it nb b gy ng nh l ni nj">cities['DistanceFromNY'] = distances_km</span></pre><p id="2c47" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您已经完成了上述所有工作，您应该会得到如下所示的数据框架:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/78c7148dabaab09bc54f5f0c6c04ff1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*UyZ6FbGBAb0bNlerZf9uBg.png"/></div></figure><p id="b912" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着现在你有一个专门的以千米为单位的距离栏。干得好！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="49a6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在你走之前</h1><p id="ee28" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">想象一下这个公式有多有用。例如，您可以使用它来查找位于您当前位置<strong class="kk iu">半径</strong>范围内的感兴趣的物体。您也可以使用它来定位离兴趣点最近的<strong class="kk iu">。有很多可能性，主要取决于你正确构建问题的能力。</strong></p><p id="c641" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你也可以使用像<a class="ae lu" href="https://www.freemaptools.com/how-far-is-it-between.htm" rel="noopener ugc nofollow" target="_blank">这个</a>这样的网站来检查我们计算的距离有多准确。上次我检查(丹佛)时，我们有7或8公里的差异，这对于大多数使用情形来说并不显著。</p><p id="e210" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读，我希望你喜欢它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="65e9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ny">喜欢这篇文章吗？成为</em> <a class="ae lu" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="ny">中等会员</em> </a> <em class="ny">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="ob oc gp gr od oe"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">medium.com</p></div></div><div class="on l"><div class="oo l op oq or on os lo oe"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9a30" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><p id="5235" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">[1]<a class="ae lu" href="https://en.wikipedia.org/wiki/Haversine_formula" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Haversine_formula</a></p></div></div>    
</body>
</html>