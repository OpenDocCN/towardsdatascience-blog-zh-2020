<html>
<head>
<title>Deploying an Image Classifier using JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 JavaScript 部署图像分类器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-an-image-classifier-using-javascript-84da1480b3a4?source=collection_archive---------37-----------------------#2020-05-26">https://towardsdatascience.com/deploying-an-image-classifier-using-javascript-84da1480b3a4?source=collection_archive---------37-----------------------#2020-05-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4ac9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推断图像分类模型的另一种方式是通过直接部署在静态网站或节点 web 应用中来减少推断时间。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/04385af48c4e9363528efaf8ca54f58e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xx7MmtvGOA0R1IygLHVM9Q.jpeg"/></div></div><p class="kx ky gj gh gi kz la bd b be z dk translated">图片来源:<a class="ae lb" href="https://novasush.com/blog/images/cat_vs_dog_in_javascript.jpg" rel="noopener ugc nofollow" target="_blank">novasush.com</a></p></figure><p id="fa2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi lc translated">使用机器学习模型可能会很有趣。你必须确保你已经设置了硬件和软件优化的管道，然后你的模型就可以投入生产了。但是有时用 image 对后端进行 HTTP 调用，然后在前端返回结果可能是一项单调乏味的工作。如果您使用的是重型模型，并且您的服务器配置较低，那么会有很多限制，比如后期推断。<br/>这就是为什么他们说模型部署是数据科学领域 80%的工作。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ll"><img src="../Images/853e6647686f4f33f5f62205109c3542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aIxgxgpZayWoI1sJ4GSodw.jpeg"/></div></div><p class="kx ky gj gh gi kz la bd b be z dk translated"><strong class="bd lm">金钱大劫案教授说</strong> |来源:<a class="ae lb" href="https://imgflip.com/i/42ubrc" rel="noopener ugc nofollow" target="_blank">imgflip.com</a></p></figure><h2 id="42ae" class="ln lo iq bd lp lq lr dn ls lt lu dp lv jy lw lx ly kc lz ma mb kg mc md me mf bi translated">用 JavaScript 进行机器学习</h2><p id="739d" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated"><a class="ae lb" href="https://js.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> TensorFlow.js </a>，这是一个开源库，您可以使用 Javascript 和高级层 API，完全在浏览器中定义、训练和运行机器学习模型。如果您是刚接触 ML 的 Javascript 开发人员，TensorFlow.js 是开始学习的好方法。JavaScript 是一种客户端脚本语言，在浏览器中完全在客户端运行机器学习程序会带来新的机会，如交互式 ML。</p><h1 id="81f6" class="ml lo iq bd lp mm mn mo ls mp mq mr lv ms mt mu ly mv mw mx mb my mz na me nb bi translated">我们开始吧</h1><p id="a91b" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">我已经在 Keras 上训练了一个简单的猫和狗的分类器。想自己培养模特可以参考我的笔记本档案。我们将使用 tensorflowjs_converter 工具将 Keras (.h5)权重转换为 tfjs 格式。<br/> tensorflowjs_converter 附带了 tensorflowjs python 库，我们来安装吧。</p><pre class="km kn ko kp gt nc nd ne nf aw ng bi"><span id="c979" class="ln lo iq nd b gy nh ni l nj nk">pip install tensorflowjs</span></pre><p id="e867" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用 tensorflow.js 转换器将保存的 Keras 模型转换为 JSON 格式。(假设重量模型的名称. h5)</p><p id="276d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个目录来存储转换后的权重并提及其路径(jsweights)</p><pre class="km kn ko kp gt nc nd ne nf aw ng bi"><span id="4012" class="ln lo iq nd b gy nh ni l nj nk">tensorflowjs_converter --input_format=keras ./model.h5 ./jsweights</span></pre><p id="a8f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你做的没错，你现在应该有一个名为<code class="fe nl nm nn nd b">model.json</code>的<strong class="jp ir"> JSON </strong>文件和各种<code class="fe nl nm nn nd b">.bin</code>文件，比如<code class="fe nl nm nn nd b">group1-shard1of10.bin</code>。<code class="fe nl nm nn nd b">.bin</code>文件的数量将取决于您的模型的大小:您的模型越大，<strong class="jp ir">的数量就越大。bin </strong>文件。这个<code class="fe nl nm nn nd b">model.json</code>文件包含了你的模型和<strong class="jp ir">的架构。bin </strong>文件将包含模型的重量。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/fe5dd487b2a5c6ce931992e0cd5793b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MrkRDmr7hXZbj0iQ_w9vUw.jpeg"/></div></div><p class="kx ky gj gh gi kz la bd b be z dk translated">来源:https://novasush.com/blog/images/js_in_action.jpg<a class="ae lb" href="https://novasush.com/blog/images/js_in_action.jpg" rel="noopener ugc nofollow" target="_blank"/></p></figure><h1 id="cc2c" class="ml lo iq bd lp mm mn mo ls mp mq mr lv ms mt mu ly mv mw mx mb my mz na me nb bi translated">让我们开始吧</h1><p id="a64e" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">我们需要创建一个 js 文件，其中包含用于加载模型和从给定图像进行推断的代码。</p><p id="e8a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保您在文件中为加载<code class="fe nl nm nn nd b">model.json</code>设置了正确的位置。此外，预测函数和模型加载函数应该是异步的。</p><pre class="km kn ko kp gt nc nd ne nf aw ng bi"><span id="cb0d" class="ln lo iq nd b gy nh ni l nj nk">//classifier.js<br/>var model;<br/>var predResult = document.getElementById("result");<br/>async function initialize() {<br/>    model = await tf.loadLayersModel('/weights/catsvsdogs/model.json');<br/>}</span><span id="4754" class="ln lo iq nd b gy no ni l nj nk">async function predict() {<br/>  // action for the submit button</span><span id="f0dd" class="ln lo iq nd b gy no ni l nj nk">let image = document.getElementById("img")  <br/>let tensorImg =   tf.browser.fromPixels(image).resizeNearestNeighbor([150, 150]).toFloat().expandDims();<br/>  prediction = await model.predict(tensorImg).data();</span><span id="b282" class="ln lo iq nd b gy no ni l nj nk">if (prediction[0] === 0) {<br/>      predResult.innerHTML = "I think it's a cat";</span><span id="c3c3" class="ln lo iq nd b gy no ni l nj nk">} else if (prediction[0] === 1) {<br/>      predResult.innerHTML = "I think it's a dog";</span><span id="0279" class="ln lo iq nd b gy no ni l nj nk">} else {<br/>      predResult.innerHTML = "This is Something else";<br/>  }<br/>}<br/>initialize();</span></pre><p id="10f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在你的 Html 文件中设置一个图片路径。把路径换成你要预测的图像就行了。你只需要给出一个相对的图像路径。</p><pre class="km kn ko kp gt nc nd ne nf aw ng bi"><span id="0a5f" class="ln lo iq nd b gy nh ni l nj nk">&lt;img src="./images/courage.jpg"&gt;</span></pre><p id="36d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将这个文件和 tensorflowjs CDN 链接添加到您的 HTML 文件中的<code class="fe nl nm nn nd b">&lt;/body&gt;</code>标签之后。</p><pre class="km kn ko kp gt nc nd ne nf aw ng bi"><span id="9eb3" class="ln lo iq nd b gy nh ni l nj nk">&lt;script src="<a class="ae lb" href="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js" rel="noopener ugc nofollow" target="_blank">https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js</a>"&gt; &lt;/script&gt;<br/>&lt;script src="/classifier.js"&gt;&lt;/script&gt;</span></pre><p id="d88f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们的设置完全就绪，我们就可以加载我们的 Html 页面并检查预测。</p><blockquote class="np nq nr"><p id="f669" class="jn jo ns jp b jq jr js jt ju jv jw jx nt jz ka kb nu kd ke kf nv kh ki kj kk ij bi translated"><strong class="jp ir">注意事项</strong></p></blockquote><p id="d9ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即使所有的文件都是静态的，我们的 Html 文件仍然需要一个服务器来加载 model.json 文件。就像托管网页一样。最简单的方法是使用 python HTTP 服务器模块，它可以作为静态网页的托管服务器。最好的部分是，我们不需要安装任何额外的库来加载 HTTP 模块。另外，你也可以使用 apache 或 Nginx 这样的托管服务器。对于 windows 用户来说，WAMP 服务器也很有用。</p><p id="3866" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以使用以下命令在 Html 文件目录中启动 Python HTTP server。</p><pre class="km kn ko kp gt nc nd ne nf aw ng bi"><span id="4a4e" class="ln lo iq nd b gy nh ni l nj nk">python3 -m http.server</span></pre><p id="4b29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行上述命令后，您将获得以下输出:</p><pre class="km kn ko kp gt nc nd ne nf aw ng bi"><span id="7c8b" class="ln lo iq nd b gy nh ni l nj nk">Serving HTTP on 0.0.0.0 port 8000 (<a class="ae lb" href="http://0.0.0.0:8000/" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:8000/</a>) ...</span></pre><p id="30b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在浏览器中打开 URL，查看通过 js 权重预测的图像输出。</p><p id="e250" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里是我的模型的输出</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/2bb183177afee0f034287aa0ccef7548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nrfd5hM3J1n81srnYbgfkA.jpeg"/></div></div><p class="kx ky gj gh gi kz la bd b be z dk translated">来源:<a class="ae lb" href="https://novasush.com/blog/images/courage_garfield.jpg" rel="noopener ugc nofollow" target="_blank">novasush.com</a></p></figure><h1 id="4c33" class="ml lo iq bd lp mm mn mo ls mp mq mr lv ms mt mu ly mv mw mx mb my mz na me nb bi translated">亲自尝试</h1><p id="c390" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">这是我这个项目的 GitHub 回购链接。尝试训练和转换重量，然后自己在网站上部署。</p><div class="nw nx gp gr ny nz"><a href="https://github.com/novasush/image-classifier-in-javascript" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">javascript 中的图像分类器</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">JavaScript 中的猫狗分类器训练一个 Keras 分类器并保存其权重安装 tensorflowjs python 库使用…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">github.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on kv nz"/></div></div></a></div><h1 id="5fa1" class="ml lo iq bd lp mm mn mo ls mp mq mr lv ms mt mu ly mv mw mx mb my mz na me nb bi translated">这是所有的乡亲</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oo"><img src="../Images/e28173375e01473127c1329d7d4d8c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ab_ve5JkcDaF_l5aItETdw.jpeg"/></div></div><p class="kx ky gj gh gi kz la bd b be z dk translated">再见| novasush.com</p></figure><h1 id="f62a" class="ml lo iq bd lp mm mn mo ls mp mq mr lv ms mt mu ly mv mw mx mb my mz na me nb bi translated">参考</h1><p id="89fa" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">[1] <a class="ae lb" href="https://www.tensorflow.org/js" rel="noopener ugc nofollow" target="_blank"> Tensorflow.js </a></p><p id="b18c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[2] <a class="ae lb" href="https://pypi.org/project/tensorflowjs/" rel="noopener ugc nofollow" target="_blank">转换器工具的 Tensorflowjs python 库</a></p><p id="60c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[3] <a class="ae lb" href="https://www.tensorflow.org/tutorials/images/classification" rel="noopener ugc nofollow" target="_blank">猫狗图像分类教程</a>来自 TensorFlow 官方网站</p><p id="766c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【4】<a class="ae lb" href="https://upload.wikimedia.org/wikipedia/en/thumb/b/bc/Garfield_the_Cat.svg/1200px-Garfield_the_Cat.svg.png" rel="noopener ugc nofollow" target="_blank">加菲猫</a>人物参考为猫。</p><p id="9c17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://vignette.wikia.nocookie.net/courage/images/f/f6/Courage3.png/revision/latest?cb=20181025040719" rel="noopener ugc nofollow" target="_blank">勇敢懦弱的狗</a>(我的最爱)</p><p id="e71a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[5] <a class="ae lb" href="https://www.netflix.com/in/title/80192098" rel="noopener ugc nofollow" target="_blank">金钱大劫案</a>人物</p><p id="edd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和几杯咖啡😉</p></div></div>    
</body>
</html>