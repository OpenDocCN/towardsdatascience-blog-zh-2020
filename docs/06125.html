<html>
<head>
<title>How to Model Time Series in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 建模时间序列</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-model-time-series-in-python-9983ebbf82cf?source=collection_archive---------29-----------------------#2020-05-18">https://towardsdatascience.com/how-to-model-time-series-in-python-9983ebbf82cf?source=collection_archive---------29-----------------------#2020-05-18</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="9bd9" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">理解随机游走模型和移动平均过程</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/8dc54138e066783f524fb162e99b0b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uwbNRMo3OPLf1lli"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">在<a class="ae la" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae la" href="https://unsplash.com/@insungyoon?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">尹新荣</a>拍摄的照片</p></figure><p id="5abd" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在本文中，我们引入两个模型来开始建模时间序列:</p><ul class=""><li id="f272" class="lx ly iv ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated">随机游动</li><li id="9ab3" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">移动平均过程</li></ul><p id="9440" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">这篇文章旨在实践。所以，一定要开始你的 Jupyter 笔记本，并遵循！</p><p id="7102" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">完整的笔记本可以在<a class="ae la" href="https://github.com/marcopeix/time-series-analysis/tree/master/2.%20Basic%20Modelling" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="5f40" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我们开始吧！</p><blockquote class="ml"><p id="e5ae" class="mm mn iv bd mo mp mq mr ms mt mu lw dk translated">深入时间序列分析，应用高级模型，如 SARIMAX、VARMAX、CNN、LSTM、ResNet、自回归 LSTM 等，并使用 Python 中的<a class="ae la" href="https://www.datasciencewithmarco.com/offers/tdU2mtVK" rel="noopener ugc nofollow" target="_blank">应用时间序列分析。</a></p></blockquote><h1 id="52c7" class="mv mw iv bd mx my mz na nb nc nd ne nf kb ng kc nh ke ni kf nj kh nk ki nl nm bi translated">随机行走模型</h1><p id="bac1" class="pw-post-body-paragraph lb lc iv ld b le nn jw lg lh no jz lj lk np lm ln lo nq lq lr ls nr lu lv lw io bi translated">随机行走模型由以下公式表示:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/4980d1c7f167a5c50af433826c7f6c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*pFyANnvKCHDGZIM-_h6vAQ.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">随机游动</p></figure><p id="56b3" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">换句话说，这意味着当前时间<em class="nt"> t </em>的位置是先前位置和噪声之和，用<em class="nt"> Z </em>表示。这里，我们假设噪声是正态分布的(均值为 0，方差为 1)。</p><p id="312d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">当然，我们从 0 开始随机行走，我们可以说任何时间点都是到那时为止所有噪声的总和。数学上:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/84f1fec9f7d886e86937df5ed990d473.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*c_-EmF6FgOpsmzV3GV7qMA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">从 0 开始的随机漫步</p></figure><p id="ac19" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">让我们用 Python 模拟一次随机漫步。</p><p id="1037" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">首先，我们将导入本文这一部分和下一部分所需的所有库:</p><pre class="kl km kn ko gt nv nw nx ny aw nz bi"><span id="c131" class="oa mw iv nw b gy ob oc l od oe">from statsmodels.graphics.tsaplots import plot_acf<br/>from statsmodels.tsa.arima_process import ArmaProcess<br/>from statsmodels.tsa.stattools import acf</span><span id="c5d2" class="oa mw iv nw b gy of oc l od oe">import matplotlib.pyplot as plt<br/>import numpy as np</span><span id="7d08" class="oa mw iv nw b gy of oc l od oe">%matplotlib inline</span></pre><p id="1124" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">然后，我们生成一个包含 1000 个数据点的数据集。起点为 0，我们将随机噪声添加到上一个点，以生成下一个点:</p><pre class="kl km kn ko gt nv nw nx ny aw nz bi"><span id="7100" class="oa mw iv nw b gy ob oc l od oe">steps = np.random.standard_normal(1000)<br/>steps[0]=0<br/>random_walk = np.cumsum(steps)</span></pre><p id="040e" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">绘制数据集时，我们看到以下内容:</p><pre class="kl km kn ko gt nv nw nx ny aw nz bi"><span id="bccd" class="oa mw iv nw b gy ob oc l od oe">plt.figure(figsize=[10, 7.5]); # Set dimensions for figure<br/>plt.plot(random_walk)<br/>plt.title("Simulated Random Walk")<br/>plt.show()</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi og"><img src="../Images/ce585610300039d67473d5dd05da9bd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*ZLGmoHIiqWYauWy3F_N-GA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">模拟随机行走</p></figure><p id="9fc4" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">现在，你的随机游走可能与上面的图不同，因为噪声是完全…随机的。因此，也许你的随机漫步实际上是在时间中向上移动。</p><p id="e40c" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">现在，让我们来看看随机游走的自相关图(或相关图):</p><pre class="kl km kn ko gt nv nw nx ny aw nz bi"><span id="9bc7" class="oa mw iv nw b gy ob oc l od oe">random_walk_acf_coef = acf(random_walk)<br/>plot_acf(random_walk, lags=20);</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/df6f10ce3ed76a55cdba3898d05cb2ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*c1yGdjaYysH7VvOQTahdqA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">随机游走的相关图</p></figure><p id="1d2d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">不管你的随机漫步看起来像什么，你应该得到一个非常相似的相关图。如你所见，即使有 20 的滞后，相关性也是非常重要的。因此，该过程不是静止的。</p><p id="7b6e" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">现在，一切都表明我们的数据集中存在一种趋势。有可能消除这种趋势吗？</p><p id="c113" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">是啊！</p><p id="9a60" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">知道一个随机游走给前一个点增加了一个随机噪声，如果我们取每个点和它前一个点的差，就应该得到一个纯随机的随机过程。</p><p id="44b0" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">让我们用 Python 来验证一下。为了区别对待，我们做到了:</p><pre class="kl km kn ko gt nv nw nx ny aw nz bi"><span id="b7c7" class="oa mw iv nw b gy ob oc l od oe">random_walk_diff = np.diff(random_walk, n=1)</span></pre><p id="ec02" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">然后，我们绘制结果，我们应该得到:</p><pre class="kl km kn ko gt nv nw nx ny aw nz bi"><span id="9311" class="oa mw iv nw b gy ob oc l od oe">plt.figure(figsize=[10, 7.5]); # Set dimensions for figure<br/>plt.plot(random_walk_diff)<br/>plt.title('Noise')<br/>plt.show()</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/f7357f9de2d691e8d7c12406926e9630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*LJFh1mv8t1xX2D7FbSTztA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">噪音</p></figure><p id="e2ce" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">如你所见，上面的图在趋势和方差上没有系统的变化，也没有季节性。因此，我们肯定有一个纯粹的随机过程。</p><p id="775f" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">查看差异的相关图:</p><pre class="kl km kn ko gt nv nw nx ny aw nz bi"><span id="6e37" class="oa mw iv nw b gy ob oc l od oe">plot_acf(random_walk_diff, lags=20);</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/e457d9ed91fbb4fa13716eafdd5b33f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*Hg0rwODhrMmzu3EcBRqkOw.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">随机过程的相关图</p></figure><p id="a2b7" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我们看到这是一个纯随机过程的相关图，自相关系数在滞后 1 时下降。</p><h1 id="15cf" class="mv mw iv bd mx my mz na nb nc nd ne nf kb ok kc nh ke ol kf nj kh om ki nl nm bi translated">移动平均过程</h1><p id="a0d9" class="pw-post-body-paragraph lb lc iv ld b le nn jw lg lh no jz lj lk np lm ln lo nq lq lr ls nr lu lv lw io bi translated">让我们从什么是均线过程的直觉开始。</p><p id="4d66" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">假设你将一块石头扔进一池水中，并且随着时间的推移，你正在追踪水面上单个水滴的位置。当然，当岩石撞击表面时，会形成波纹，所以我们的水滴会上下移动。现在，让我们假设表面上的波纹只持续两秒钟，之后表面就完全变平了。</p><p id="bdfe" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">那么，我们可以说，我们的水滴的位置可以表示为:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi on"><img src="../Images/c3757b61ae761b8718affd541d80cead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*asA2Hph7B8ufgjkcXEjKig.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">二阶移动平均过程</p></figure><p id="374c" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">上式表示，时间<em class="nt"> t </em>的位置 X 取决于时间<em class="nt"> t </em>的噪声，加上时间<em class="nt"> t-1 </em>的噪声(具有一定权重<em class="nt">θ</em>)，加上时间<em class="nt"> t-2 </em>的一些噪声(具有一定权重)。</p><p id="2ccc" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">这称为二阶移动平均过程，也可以表示为 MA(2)。</p><p id="84aa" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">广义的符号是 MA(q)。在上面的例子中，q = 2。</p><p id="bd4d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">让我们用 Python 来模拟这个过程。</p><p id="42d2" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">具体来说，我们将模拟以下过程:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/810bce914e468c6cdbab82416c286b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*-SxLNZovlb8ChtXkj2d3_Q.png"/></div></figure><p id="c5b4" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">这又是一个 2 阶移动平均过程，但是我们指定了权重。您可以随意更改它们并试验参数。</p><p id="e12c" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我们从指定滞后开始。这里，我们使用的是滞后 2。</p><pre class="kl km kn ko gt nv nw nx ny aw nz bi"><span id="cbad" class="oa mw iv nw b gy ob oc l od oe">ar2 = np.array([2])</span></pre><p id="8947" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">然后，我们指定权重。在本例中，权重为[1，0.9，0.3]。</p><pre class="kl km kn ko gt nv nw nx ny aw nz bi"><span id="2281" class="oa mw iv nw b gy ob oc l od oe">ma2 = np.array([1, 0.9, 0.3])</span></pre><p id="64cb" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">最后，我们模拟该过程并生成一千个数据点:</p><pre class="kl km kn ko gt nv nw nx ny aw nz bi"><span id="e708" class="oa mw iv nw b gy ob oc l od oe">MA2_process = ArmaProcess(ar2, ma2).generate_sample(nsample=1000)</span></pre><p id="8384" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">现在，让我们想象一下这个过程及其相关图:</p><pre class="kl km kn ko gt nv nw nx ny aw nz bi"><span id="38f5" class="oa mw iv nw b gy ob oc l od oe">plt.figure(figsize=[10, 7.5]); # Set dimensions for figure<br/>plt.plot(MA2_process)<br/>plt.title('Moving Average Process of Order 2')<br/>plt.show()</span><span id="ad90" class="oa mw iv nw b gy of oc l od oe">plot_acf(MA2_process, lags=20);</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi op"><img src="../Images/737ef6c15a21268d5f3be8b91bad1e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*e9PV8yrJ-kYxNWIftrUCrw.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">二阶模拟移动平均过程</p></figure><p id="9b80" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">同样，由于噪声是随机产生的，您的图形可能与我的不同。然而，相关图应该类似于下图:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/cfa1a46af3427ef387dd5087e8b9b193.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*K905NV73WBsMpAeaVp4HlA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">MA 的相关图(2)</p></figure><p id="d41e" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">正如你注意到的，在滞后 2 之前，相关性是显著的。之后，相关性不再显著。这是有意义的，因为我们指定了一个滞后为 2 的公式。</p><p id="08e2" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">这意味着你可以使用相关图来推断时间序列的滞后。如果您发现在特定的滞后<em class="nt"> q </em>之后，相关性不显著，那么您可以将您的时间序列建模为 MA(q)过程。</p></div><div class="ab cl or os hz ot" role="separator"><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow"/></div><div class="io ip iq ir is"><p id="eda9" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">就是这样！你现在了解了什么是随机漫步以及如何模拟它。此外，您还学习了移动平均线过程，如何对它们建模，最重要的是，如何确定移动平均线过程的顺序。</p><p id="24cd" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">通过以下实践课程了解有关时间序列的更多信息:</p><ul class=""><li id="f745" class="lx ly iv ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated"><a class="ae la" href="https://www.datasciencewithmarco.com/offers/tdU2mtVK" rel="noopener ugc nofollow" target="_blank">在 Python 中应用时间序列分析</a></li></ul><p id="6eba" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">干杯！</p></div></div>    
</body>
</html>