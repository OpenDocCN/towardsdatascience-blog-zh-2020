<html>
<head>
<title>Master Pandas Map, Apply, and Applymap in 5 minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫大师在 5 分钟内绘制、应用和应用地图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/master-pandas-map-apply-and-applymap-in-5-minutes-d2bd1bba12a5?source=collection_archive---------35-----------------------#2020-09-07">https://towardsdatascience.com/master-pandas-map-apply-and-applymap-in-5-minutes-d2bd1bba12a5?source=collection_archive---------35-----------------------#2020-09-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ae0e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何以及何时使用这些功能</h2></div><p id="5f5c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">熊猫图书馆有两种主要的数据结构:数据帧和序列。有许多内置函数可以创建、操作和分析这些结构。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/9f6db13ee5df021beb20da86f2e72825.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nalte1CNmPnBWjXUqWC03A.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">由<a class="ae lu" href="https://unsplash.com/@jessbaileydesigns?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">杰斯·贝利</a>在<a class="ae lu" href="https://unsplash.com/s/photos/point?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="4436" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我们将掌握一组用于操作数据帧和序列的 Pandas 函数。这些功能是<strong class="kk iu">映射</strong>、<strong class="kk iu">应用</strong>和<strong class="kk iu">应用映射</strong>。</p><p id="fed3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在某些情况下，熊猫提供了更好的选择来代替地图、应用和应用地图。我们还将尝试涵盖这些选项。</p><p id="a957" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们从定义开始:</p><ul class=""><li id="cde5" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated">映射:映射(即更新、更改、修改)系列的值。</li><li id="5068" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">应用:沿数据帧的轴应用函数。</li><li id="10f4" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">Applymap:对 DataFrame 元素应用函数。</li></ul><p id="7d23" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">需要注意的是，在某些情况下，这些函数会执行相同的操作并返回相同的输出。我们将看到这些案例以及有差异的案例。</p><p id="fd13" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个主要的区别是这些函数作用于不同的对象。Applymap 处理数据帧，而 map 处理序列。两者都适用。</p><p id="b074" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将首先创建一个简单的数据框架来做例子。</p><pre class="lf lg lh li gt mj mk ml mm aw mn bi"><span id="e0b7" class="mo mp it mk b gy mq mr l ms mt">import pandas as pd<br/>import numpy as np</span><span id="8ada" class="mo mp it mk b gy mu mr l ms mt">df = pd.DataFrame(np.random.randint(10, size=(5,5)), columns=list('ABCDE'))</span><span id="3d38" class="mo mp it mk b gy mu mr l ms mt">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/3756affe7c2c3274209d9d390ceef93d.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*005xlhi4Hpno_Q8vZxFWHA.png"/></div></figure><p id="e7e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们有一个计算给定值平均值的函数。如果我们使用“apply”将此函数应用于数据帧，它将返回行或列的平均值。</p><pre class="lf lg lh li gt mj mk ml mm aw mn bi"><span id="efe7" class="mo mp it mk b gy mq mr l ms mt">def calculate_average(row_col):<br/>    return row_col.mean()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/1de2a27b906f7875d107dc87812dd41b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*x273xbNxntSM0fWg9n2New.png"/></div></figure><p id="f275" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该功能沿轴(行或列)应用<strong class="kk iu">。Pandas 提供了在数据帧上执行简单统计操作的功能。在这种情况下，这些功能优先于应用功能。</strong></p><p id="1f36" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以用<code class="fe mx my mz mk b">df.mean(axis=0)</code>计算每一列的平均值，用<code class="fe mx my mz mk b">df.mean(axis=1)</code>计算每一行的平均值。然而，了解一下 apply 函数也无妨。</p><p id="4a90" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Applymap 和 map 处理单个元素，而不是沿着轴。要了解 map 和 applymap 的区别，让我们做一个非常简单的数学运算。</p><p id="291a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Applymap 可应用于整个数据帧:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi na"><img src="../Images/5145e84802898defc8763e95d91681ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*mJoOtUAOHlm4tXao_a_SpQ.png"/></div></figure><p id="e6b0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用 map 函数可以将此函数应用于行或列。因此，映射功能不能应用于整个数据帧。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/f3c1e749fb9bd14e0ca8eeac4bb76495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*nQ_ReAP3h_T2J5glqiN0WQ.png"/></div></figure></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="719b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">简单的数学运算可以作为矢量化运算来完成，它具有单纯形语法，比 map 或 applymap 更快。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/7a60fa275547527e38160d86a1d4bfa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*EptGI77EPptP5LS_2kP0zw.png"/></div></figure><p id="af4b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">地图功能也是如此:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/651cedf785000309bbd93466d3de187d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*CkayDT_F78ZAO66-Fu_yig.png"/></div></figure></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="7d5a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了函数之外，映射还采用字典或序列来映射值。</p><p id="8203" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们向数据框架添加两个新列:</p><pre class="lf lg lh li gt mj mk ml mm aw mn bi"><span id="01fc" class="mo mp it mk b gy mq mr l ms mt">df['F'] = ['Abc','Dbc','Fcd','Afc','Kcd']<br/>df['G'] = ['A',np.nan,'B1','B1','C']</span><span id="71ee" class="mo mp it mk b gy mu mr l ms mt">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/2c5fe0d3ba6ebc1e7f21506f046edd2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*zDvTEV5Im5R47v2PMnZ_Hg.png"/></div></figure><p id="c58f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们希望将 G 列中的值“B1”更改为“B”。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/7a92657fe34d0c84c29d5540f1195f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*BxPBZu9dY4XT4wJuMHTxzw.png"/></div></figure><p id="2b43" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见，其他值被映射为 NaN，这是标准的缺失值表示。我们还需要指定应该映射到哪些其他值。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/c9d8eb528746144e0d1d7b25e40e4e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*vvSf7F3gPiCJlynEerposw.png"/></div></figure><p id="b0e3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，还必须指定其他值使得 map 函数不是最佳选择。熊猫的<strong class="kk iu">替换</strong>功能在这里是比较好的选择。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/e944efcd5faf4fe2d5bae1b2b8601dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*m1UYZIIb4C4Ei-AUhNRwJw.png"/></div></figure></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="436b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以使用 map 和 apply 返回基于现有值的列表:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/da9de039fbc3e6680f315c3c58a8f93c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*8y2YDDqq4G4FJqtQ6kDTNw.png"/></div></figure><p id="165a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个项目都是一个列表，包含转换为小写字母的原始字符串和字符串的长度。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="38cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些函数以迭代的方式工作，这使得它们相对较慢。在许多情况下，矢量化运算或<a class="ae lu" rel="noopener" target="_blank" href="/list-comprehensions-in-python-explained-294a464b5245">列表理解</a>比使用 map 或 applymap 更受欢迎。</p><p id="9eb0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个列表理解、for 循环、map 函数对 50000 个元素求平方的比较。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/cd39725248c5b0062d49168f03fc33fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*5AtJcm0f-dQyk_MS.png"/></div></figure></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="701b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">也有一些情况下，地图功能优于列表理解。列表理解将整个输出列表加载到内存中。这对于小型或中型的列表来说是可以接受的，甚至是可取的，因为它使操作更快。然而，当我们处理大型列表(例如 10 亿个元素)时，应该避免理解列表。这可能会导致您的计算机崩溃，由于内存需求的极端数额。映射功能也不会导致内存问题。</p><p id="733a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">天下没有免费的午餐！map 函数不会导致内存问题，但是它们比 list comprehensions 要慢一些。同样，列表理解的速度来自于内存的过度使用。您可以根据您的应用决定使用哪一种。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="6c68" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>