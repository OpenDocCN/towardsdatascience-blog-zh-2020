<html>
<head>
<title>Visualizing the Stock Market with Python Bokeh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python散景可视化股票市场</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-the-stock-market-with-python-bokeh-d40d9d1f288e?source=collection_archive---------5-----------------------#2020-03-25">https://towardsdatascience.com/visualizing-the-stock-market-with-python-bokeh-d40d9d1f288e?source=collection_archive---------5-----------------------#2020-03-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7364" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建交互式股票价格仪表板的初学者指南。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/95d1fce848ba1317e08101ff9196b6e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*13fHiZVtARpATTx8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@chrisliverani?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯·利维拉尼</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="5228" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">为什么可视化很重要</h1><p id="f422" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要建立你的交易平台，你还需要有一个可视化你的股市数据的方法。最简单的方法之一你可以选择<a class="ae ky" href="http://tradingview.com" rel="noopener ugc nofollow" target="_blank"> TradingView </a>，它有一个极好的分析金融市场数据的想法。</p><p id="76b4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">但是，您可能有特定的需求，比如在某种程度上比较两只股票的价格。大部分网络平台都支持不了这种情况。或者，如果你已经有一些自动化，你需要一个工具来可视化你的交易策略。</p><p id="b727" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这篇文章中，我将向你展示我如何开始在我的每日交易平台中建立我的可视化。在过去的几年里，我尝试了很多可视化框架，并且<a class="ae ky" href="https://docs.bokeh.org/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">散景</a>可以支持我的大多数用例。</p><p id="9d62" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">也许你对Python中绘图的<code class="fe ms mt mu mv b">matplotlib</code>和<code class="fe ms mt mu mv b">seaborn</code>比较熟悉。然而，金融数据，尤其是价格历史可视化在交互时更好。 <a class="ae ky" href="https://docs.bokeh.org/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">散景</a>可以用多个复杂的图表创建丰富的交互式仪表盘。</p><p id="d21e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你对我如何尝试其他框架感兴趣，请查看附录。</p><h1 id="bad7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是散景？</h1><p id="3032" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">散景是一个可视化库，可以很容易地创建功能强大的交互式绘图。</p><p id="4a46" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">散景图可以导出为静态图像，或者嵌入到网页中。该库有一个内置的应用服务器，可以作为交互式仪表板的后端。</p><p id="67a3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">另一方面，散景也是一个低级的库，因为它允许我们控制一个情节的所有方面，包括交互和样式。</p><p id="67aa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">但是，散景也是简单易用和强大的，因为在几行代码中，你可以有多种多样的互动情节。为了对散景图有所了解，让我们来看看MSFT股票的一个简单图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/d818e02f3af98031bd0a0622d6017717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J8630QXbID2T6u8o-703Ew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MSFT每日股票价格烛台</p></figure><h1 id="ff6e" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">开始前，数据</h1><p id="5ef0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">从可视化开始，我们需要先谈谈数据。</p><p id="1c4a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，我们将使用从使用雅虎金融API 的Python的<a class="ae ky" rel="noopener" target="_blank" href="/free-stock-data-for-python-using-yahoo-finance-api-9dafd96cad2e">免费股票数据中提取的OHLCV数据。先看看这个帖子，你应该能得到你想要的数据。或者你已经有了自己的OHLC股票数据。</a></p><p id="9105" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">数据格式如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="0bd8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里我们将使用MSFT日报OHLCV数据作为例子，并建立一个与历史股票价格相关的仪表板。你可以把它应用到任何金融符号上。</p><p id="29f5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你可以在这里下载我的示例数据<a class="ae ky" href="https://gist.github.com/BarneyH19/20f932e8f06e1ede8b52926f3bd1ce89" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="e8a6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">入门指南</h1><p id="9342" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">根据您的设置，使用<code class="fe ms mt mu mv b">conda install bokeh</code>或<code class="fe ms mt mu mv b">pip install bokeh</code>安装散景很简单。</p><p id="85a8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该库不仅提供了Python包，还提供了一个名为<code class="fe ms mt mu mv b">bokeh</code>的CLI，用于运行<code class="fe ms mt mu mv b">bokeh</code> app server。你可以通过命令行<code class="fe ms mt mu mv b">bokeh serve — show xxx.py</code>轻松运行散景。</p><h1 id="cea7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">基本概念</h1><p id="af02" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">编译后，JavaScript客户端库将在浏览器中呈现可视元素并处理散景图的UI交互。不需要控制<strong class="lt iu"> JavaScript </strong>部分。</p><p id="286d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意，使用<code class="fe ms mt mu mv b">bokeh.plotting</code>界面创建的散景图<strong class="lt iu">图</strong>带有一组默认的基本字形。字形有多种形式:<em class="mw">圆</em>字形、<em class="mw">线</em>字形、<em class="mw">文字、</em>和<a class="ae ky" href="https://bokeh.pydata.org/en/latest/docs/reference/plotting.html" rel="noopener ugc nofollow" target="_blank">其他</a>。对于主要用途，散景图就足够了。</p><p id="bfa5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">每个散景图由一组<strong class="lt iu">模型组成。</strong>构成散景“场景图”的最低级别对象。这些都存在于<code class="fe ms mt mu mv b">bokeh.models</code>接口中。最终，所有的散景图都由模型集合组成，这给了你对图的绝对控制，它通常不会被直接使用。</p><p id="685b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">散景<strong class="lt iu">服务器</strong>用于将散景图作为静态页面共享和发布，或者在浏览器中部署应用。</p><p id="b9fa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">基于以上所掌握的知识，我们应该能够用市场数据画出一个图来。</p><h1 id="3411" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">使用股票历史价格数据源绘图</h1><p id="7ade" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了使绘图更加简单和清晰，我们使用了<code class="fe ms mt mu mv b">ColumnDataSource</code>。<code class="fe ms mt mu mv b">ColumnDataSource</code>是散景的基本数据结构。大多数图、数据表等。将由一辆<code class="fe ms mt mu mv b">ColumnDataSource</code>驱动。可以像字典一样定义<code class="fe ms mt mu mv b">ColumnDataSource</code>，然后从<code class="fe ms mt mu mv b">pandas.dataframe</code>导入。</p><p id="26a6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">使用基本的<em class="mw">字形</em>如<code class="fe ms mt mu mv b">vbar</code>来渲染基于<code class="fe ms mt mu mv b">ColumnDataSource</code>的烛台。</p><p id="2fa5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">基本代码如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="3fa3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">运行<code class="fe ms mt mu mv b">bokeh serve — show xxx.py</code>显示图形:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/4d303e2a06b1d1a4e10933cace1c80a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KbzTRqXVMrYBdhemuuIYaA.png"/></div></div></figure><h1 id="8886" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">自定义日期标签</h1><p id="4cff" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">到目前为止，我们只处理了标准数据。这个情节有很多问题。有一点是x轴索引不正确。通常，我们可以显示索引号。然而，股票价格是按日期排序的时间序列数据，我们需要绘制一个时间范围并显示确切的日期。我们需要建立一个从索引到日期字符串的映射。</p><p id="c633" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">默认情况下，一个图中只有五个分笔成交点。为了显示每一天，我们必须设置刻度数。</p><p id="beda" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">更新了代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="79b5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">更改后，现在日期x轴清晰多了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/4568be84c78a7d47ee598f2a8a9e57fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RPysC4pT-orO0i3dL2S64g.png"/></div></div></figure><h1 id="fddc" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">自定义货币</h1><p id="56e4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这里我们再次使用Bokeh的货币格式:<code class="fe ms mt mu mv b">($ 0.00 a)</code>，它将以百万为单位输出数值。对于其他预定义的格式和各种格式化程序，请参见格式化程序<a class="ae ky" href="https://bokeh.pydata.org/en/latest/docs/reference/models/formatters.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><h1 id="fdef" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">自定义绘图工具悬停工具</h1><p id="e6e7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你可能已经注意到，散景为每个图提供了一个工具栏。工具允许<em class="mw">缩放</em>、<em class="mw">平移</em>、<em class="mw">选择</em>数据并执行其他动作。</p><p id="5531" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">悬停工具是一种检查工具。它通常一直处于打开状态，但可以在与默认隐藏的工具栏相关联的检查器菜单中进行配置。默认情况下，悬停工具将生成一个工具提示，其中每行包含一个标签和相关值。</p><p id="a8d3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">通过添加带有标签的工具提示更新了代码:日期时间、打开、关闭、体积。可以根据自己的选择添加更多。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="2d9f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是修改后的工具提示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/bdf85d41d65646b2fb21f375fa310be7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWRqpscX_cYgIF01sYjhcg.png"/></div></div></figure><h1 id="9b18" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">包裹</h1><p id="965d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">到目前为止，您已经学会了如何:</p><ul class=""><li id="69e4" class="nb nc it lt b lu mn lx mo ma nd me ne mi nf mm ng nh ni nj bi translated">基于OHLCV股票数据创建带有<em class="mw">字形</em>的图。</li><li id="dc02" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">用日期时间标签配置图。</li><li id="4de5" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">配置自定义布局和工具提示。</li></ul><p id="8c1b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在你应该可以开始建立你的仪表板，开始你的算法交易分析。如果你想知道更多关于这个话题的信息，请留下你的评论，让我知道。</p><h1 id="e416" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">代码和数据</h1><p id="5493" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">下面附上我的代码，示例数据是<a class="ae ky" href="https://gist.github.com/BarneyH19/20f932e8f06e1ede8b52926f3bd1ce89" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="1630" class="kz la it bd lb lc nw le lf lg nx li lj jz ny ka ll kc nz kd ln kf oa kg lp lq bi translated">附录:其他框架</h1><p id="eb96" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">以下是我对其他框架的评论:</p><ul class=""><li id="49cf" class="nb nc it lt b lu mn lx mo ma nd me ne mi nf mm ng nh ni nj bi translated">Matplotlib财务-&gt; mpl_finance -&gt; mplfinance</li><li id="fcbf" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">Viser</li></ul><p id="1b32" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Matplotlib finance，已被弃用，已被移到一个名为<code class="fe ms mt mu mv b">mpl_finance</code>的模块中。还有，<code class="fe ms mt mu mv b">mpl_finance</code>是贬义，会有新版本<a class="ae ky" href="https://github.com/matplotlib/mplfinance" rel="noopener ugc nofollow" target="_blank"> mplfinance </a>(估计2020年年中替换)。</p><p id="22b9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">与我去年使用的相比，新的打印机相当不错。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/0bc34ad9c4a311b26897ec960e4772c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/0*p6BxIULuS-_-pm-4.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">价格和成交量图</p></figure><p id="c888" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">相比于散景，很难做到交互。如果对于基本用例。这应该是一个快速的解决方案。由于它仍在开发中，我建议在2020年中期使用它。</p><p id="d705" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我尝试过的另一个框架是<a class="ae ky" href="https://viserjs.github.io/" rel="noopener ugc nofollow" target="_blank"> Viser </a>。如果你喜欢JavaScript技术栈。我做了一个Viser的<a class="ae ky" href="http://alwa.info/projects/stock-portfolio/" rel="noopener ugc nofollow" target="_blank">投资组合图</a>。然而，Viser的社区支持非常差。您必须知道许多技巧，才能使它与其他JavaScript库一起工作。</p></div></div>    
</body>
</html>