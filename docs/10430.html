<html>
<head>
<title>How to create and run an EMR cluster using AWS CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 AWS CLI 创建和运行 EMR 集群</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0?source=collection_archive---------7-----------------------#2020-07-22">https://towardsdatascience.com/how-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0?source=collection_archive---------7-----------------------#2020-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="1889" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">技术提示</h2><div class=""/><div class=""><h2 id="8448" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">为初学者编写的清晰易懂的教程</h2></div><h1 id="b598" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated"><strong class="ak">简介</strong></h1><h2 id="2cbd" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated"><strong class="ak">简单介绍一下 Apache Spark 和 AWS EMR 上的 Spark 集群</strong></h2><p id="94a0" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated"><a class="ae mq" href="https://spark.apache.org/docs/latest/" rel="noopener ugc nofollow" target="_blank"> Apache Spark 是用于大规模数据处理的统一分析引擎</a>。Spark 被认为是“<strong class="lz jd"><em class="mr">‘大数据’丛林之王</em> </strong>”，在数据分析、机器学习、流和图形分析等方面有着多种应用。有 4 种不同的 Spark 模式:(1) <strong class="lz jd"> <em class="mr">本地模式</em> </strong>:笔记本电脑等单机上的 Spark，用于学习语法和项目原型化；另外 3 种模式是集群管理器模式:(2) <strong class="lz jd"> <em class="mr">单机模式</em> </strong>用于在私有集群上工作；(3) <strong class="lz jd"> <em class="mr">纱</em> </strong>和(4) <strong class="lz jd"> <em class="mr"> Mesos 模式</em> </strong>在与团队共享集群时使用。在独立模式下，Spark 部署在私有集群上，比如 Amazon Web Service AWS 上的 EC2。一个火花簇包括多个机器。要在每台机器上使用 Spark 代码，Spark 及其依赖项需要手动下载和安装。有了<strong class="lz jd"> <em class="mr">弹性地图还原服务，EMR </em> </strong>，来自 AWS，一切都是现成可用，无需任何手动安装。因此，我们不使用 EC2，而是使用 EMR 服务来建立 Spark 集群。</p><h2 id="e91a" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated">本教程的动机</h2><p id="cc45" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated">我确实花了很多时间使用<strong class="lz jd"> <em class="mr"> AWS 命令行界面、AWS CLI </em> </strong>在 EMR 上创建、设置和运行 Spark 集群。虽然我找到了一些关于这个任务的教程，或者是通过课程提供的，但是大部分都很难理解。有的不够清晰；有些人错过了一些关键步骤；或者假设学习者知道一些关于 AWS、CLI 配置等的先验知识。成功设置并运行集群后，我才知道<strong class="lz jd">这个任务</strong> <strong class="lz jd"> <em class="mr">其实没那么复杂；我们应该轻松地完成它。我不想再看到人们为此而挣扎。</em> </strong>因此，我决定做这个教程。</p><p id="898c" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">本文假设您已经对 Spark、PySpark、命令行环境和 AWS 有了一定的了解。具体来说，<strong class="lz jd"> <em class="mr">这篇文章是写给知道为什么需要创建 Spark 集群的读者的:)。</em> </strong>更多关于 Spark 的内容，请在这里阅读参考文献<a class="ae mq" href="https://spark.apache.org/docs/latest/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="b5b1" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">这是一个很长很详细的教程。简而言之，所有步骤包括:</p><ol class=""><li id="7445" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp nc nd ne nf bi translated"><a class="ae mq" href="#f203" rel="noopener ugc nofollow">创建一个 AWS 账户</a></li><li id="6466" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp nc nd ne nf bi translated"><a class="ae mq" href="#c46c" rel="noopener ugc nofollow">创建一个 IAM 用户</a></li><li id="0fca" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp nc nd ne nf bi translated"><a class="ae mq" href="#9e7d" rel="noopener ugc nofollow">在 EC2 中设置凭证</a></li><li id="3fb0" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp nc nd ne nf bi translated"><a class="ae mq" href="#d889" rel="noopener ugc nofollow">创建一个 S3 存储桶来存储集群产生的日志文件</a></li><li id="7287" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp nc nd ne nf bi translated"><a class="ae mq" href="#6df6" rel="noopener ugc nofollow">安装 AWS CLI 包</a> <code class="fe nl nm nn no b"><a class="ae mq" href="#6df6" rel="noopener ugc nofollow">awscli</a></code></li><li id="4c61" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp nc nd ne nf bi translated"><a class="ae mq" href="#6cd9" rel="noopener ugc nofollow">设置 AWS CLI 环境(创建凭证和配置文件)</a></li><li id="9e0b" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp nc nd ne nf bi translated"><a class="ae mq" href="#5b72" rel="noopener ugc nofollow">创建一个 EMR 集群</a></li><li id="c5b6" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp nc nd ne nf bi translated"><a class="ae mq" href="#2517" rel="noopener ugc nofollow">允许 SSH 访问</a></li><li id="1c48" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp nc nd ne nf bi translated"><a class="ae mq" href="#9d31" rel="noopener ugc nofollow">创建与集群主节点的 SSH 连接</a></li><li id="7bb4" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp nc nd ne nf bi translated"><a class="ae mq" href="#aa90" rel="noopener ugc nofollow">开始使用 EMR 集群</a></li></ol><p id="f488" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">请随意跳过任何你已经知道的步骤。本教程的 Jupyter 笔记本版本，以及关于 Spark 的其他教程和更多数据科学教程可以在<a class="ae mq" href="https://github.com/nhntran/aws_spark_cluster_tutorial" rel="noopener ugc nofollow" target="_blank"> my Github </a>上找到。现在，让我们开始吧！</p><p id="effa" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">我很高兴你们中的许多人发现这个教程很有用。我很荣幸能和大家一起讨论你在电子病历创建过程中遇到的任何问题。基于我们的一些讨论，  <a class="ae mq" href="#4b3f" rel="noopener ugc nofollow"> <strong class="lz jd"> <em class="mr">下面是对本教程</em> </strong> </a> <strong class="lz jd"> <em class="mr">的一些更新。</em> </strong></p><blockquote class="np nq nr"><p id="c881" class="lx ly mr lz b ma ms kd mc md mt kg mf ns mu mh mi nt mv mk ml nu mw mn mo mp im bi translated"><strong class="lz jd">一些注意事项:</strong></p><p id="956b" class="lx ly mr lz b ma ms kd mc md mt kg mf ns mu mh mi nt mv mk ml nu mw mn mo mp im bi translated">1.对于本教程，应该使用<strong class="lz jd"> AWS 常规帐户</strong>而不是 AWS 教育帐户。AWS 常规帐户为用户提供对 AWS 资源和 IAM 角色的完全访问权限；而教育帐户具有一些有限访问权限。</p><p id="dfca" class="lx ly mr lz b ma ms kd mc md mt kg mf ns mu mh mi nt mv mk ml nu mw mn mo mp im bi translated">2.您有责任监控您使用的 AWS 帐户的使用费。每次完成工作时，请记住终止集群和其他相关资源。我已经多次实现了 EMR 集群；本教程在 AWS 上应该没有成本或成本低于 0.5 美元。</p><p id="de84" class="lx ly mr lz b ma ms kd mc md mt kg mf ns mu mh mi nt mv mk ml nu mw mn mo mp im bi translated">3.AWS 控制台和 Udacity 的内容会随着时间的推移而变化/升级，因此我建议您搜索 AWS 网站和 Udacity 的课程，以获取任何更新的教程/指南。本教程根据 2020 年 7 月的 AWS 控制台生成。</p><p id="e46c" class="lx ly mr lz b ma ms kd mc md mt kg mf ns mu mh mi nt mv mk ml nu mw mn mo mp im bi translated">4.本教程是用 Chrome 和 Mac OS X 制作的，在 Windows 平台上应该不会有太大区别。</p></blockquote><h2 id="6524" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated">参考</h2><ul class=""><li id="2283" class="mx my it lz b ma mb md me lo nv lr nw lu nx mp ny nd ne nf bi translated">一些材料来自 Udacity 上的数据工程师纳米学位项目。</li><li id="fcb9" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated">一些想法和问题是从 Knowledge-uda city 问答平台和学生中心-uda city 聊天平台收集的。</li></ul></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><h1 id="6c07" class="kr ks it bd kt ku og kw kx ky oh la lb ki oi kj ld kl oj km lf ko ok kp lh li bi translated">在 AWS CLI 上创建、设置和运行 EMR 集群的具体步骤</h1><h2 id="f203" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated"><strong class="ak">第一步:创建一个 AWS 账户</strong></h2><ul class=""><li id="8d44" class="mx my it lz b ma mb md me lo nv lr nw lu nx mp ny nd ne nf bi translated">如果您还没有 AWS 帐户，请创建一个。该说明在<a class="ae mq" href="https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/" rel="noopener ugc nofollow" target="_blank"> AWS 网站</a>上非常容易理解。</li><li id="e925" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated">登录你的 AWS 账户。</li><li id="c612" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated">(可选)为了提高 AWS 资源的安全性，您可以根据此处的简易<a class="ae mq" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_enable_virtual.html" rel="noopener ugc nofollow" target="_blank"> AWS 指南</a><a class="ae mq" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html" rel="noopener ugc nofollow" target="_blank">配置并启用虚拟多因素身份验证(MFA) </a>设备。</li></ul><h2 id="c46c" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated">步骤 2:创建 IAM 用户</h2><p id="cf4c" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated">从 AWS 控制台，点击<code class="fe nl nm nn no b">Service</code>，输入‘IAM’进入 IAM 控制台:</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi ol"><img src="../Images/ef920a3fcd5de754883d81b042084c0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X_LOSoRLVPAyzidqpm4lkQ.png"/></div></div></figure><p id="878a" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">= &gt;选择<code class="fe nl nm nn no b">User</code>=&gt;=<code class="fe nl nm nn no b">Add user</code>=&gt;输入用户名如‘EMR _ user’，选择<code class="fe nl nm nn no b">Access type</code>为<strong class="lz jd">程序化访问</strong>，然后选择<code class="fe nl nm nn no b">Next: Permissions</code>。</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi ox"><img src="../Images/77f753172bdafb399989db5e9b368d1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pFRN0z7wNgmHSDsjaFjlDg.png"/></div></div></figure><p id="7028" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">点击<code class="fe nl nm nn no b">Attach existence policies directly</code>页面，输入并设置权限为<code class="fe nl nm nn no b">Administrator Access</code>，然后选择<code class="fe nl nm nn no b">Next: Tags</code>。</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi oy"><img src="../Images/2f8a528d8c9db03ce1443e0632ef0f86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fSlWZBokGZ-ZDxgD9uGH3g.png"/></div></div></figure><p id="c655" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">跳过此标签页，选择<code class="fe nl nm nn no b">Next: Review</code> = &gt;选择<code class="fe nl nm nn no b">Create user</code> = &gt;保存用户名、访问密钥和秘密访问密钥。</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi oz"><img src="../Images/36c58be1e5285ab030b971d6caaebbc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTHuUL-zFQm8vn6ogG7QNA.png"/></div></div></figure><p id="282b" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">我们将使用这个 IAM 用户和访问密钥，通过 AWS CLI 设置和访问 AWS。</p><h2 id="9e7d" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated">步骤 3:在 EC2 中设置凭证</h2><p id="748a" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated">在 AWS 控制台中，单击“服务”,键入“EC2”进入 EC2 控制台</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pa"><img src="../Images/ec32ed84fc29c2bcb549db946459cb82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ayHNBO1TNZgRD-_QdHyeA.png"/></div></div></figure><p id="a530" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">在<strong class="lz jd">网络中选择<code class="fe nl nm nn no b">Key Pairs</code>在左侧面板上选择&amp;安全</strong>=&gt;选择<code class="fe nl nm nn no b">Create key pair</code></p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pb"><img src="../Images/5815ef8add679635afddf41020df4d70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e-jgVpL8xzXmvbsj4RydUQ.png"/></div></div></figure><p id="121b" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">键入密钥对的名称，例如“emr-cluster”，文件格式:pem = &gt;选择<code class="fe nl nm nn no b">Create key pair</code>。完成此步骤后，将自动下载一个. pem 文件，在这种情况下，文件名为<code class="fe nl nm nn no b">emr_cluster.pem</code>。我们将在步骤 6 中使用这个文件。</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pc"><img src="../Images/95c7aeb42a56599352ef6ed92635913e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aE0xalZqfgt1Rbf5HlqRXg.png"/></div></div></figure><h2 id="d889" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated">步骤 4(可选):创建一个 S3 存储桶来存储集群生成的日志文件</h2><ul class=""><li id="b219" class="mx my it lz b ma mb md me lo nv lr nw lu nx mp ny nd ne nf bi translated">这将是 AWS 存储桶，用于存储我们将创建和设置的集群所生成的日志文件。如果我们没有指定 S3 存储桶，那么在创建和运行 EMR 集群时，会自动为我们创建一个 S3 存储桶。</li><li id="9048" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated">从 AWS 控制台，点击<code class="fe nl nm nn no b">Service</code>，键入“S3”并转到 S3 控制台= &gt;选择<code class="fe nl nm nn no b">Create bucket</code> = &gt;输入存储桶的名称，如“s3-for-emr-cluster”，选择您的首选地区，如“美国西部(俄勒冈州)”。保持其他选项的默认设置，以创建一个存储桶。</li></ul><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pd"><img src="../Images/187d1777400119df2add0ead95b7444c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELVdf7dHWrkRYiiM95wF-Q.png"/></div></div></figure><ul class=""><li id="bfc8" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">请注意，为了获得最佳性能并避免任何错误，请记住对您的所有工作(S3、EC2、EMR 等)使用相同的 AWS 区域/子区域。)</li></ul><h2 id="6df6" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated"><strong class="ak">第五步:安装 awscli 包</strong></h2><ul class=""><li id="1d49" class="mx my it lz b ma mb md me lo nv lr nw lu nx mp ny nd ne nf bi translated">在终端上，使用命令<code class="fe nl nm nn no b">pip install awscli</code>安装<code class="fe nl nm nn no b">awscli</code></li><li id="9072" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated">键入<code class="fe nl nm nn no b">aws help</code>检查安装是否正确。如果输出如下所示，安装应该会成功:</li></ul><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pe"><img src="../Images/b7c54751c4c6e8a23fccaa0627fa213c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*emURlZyBiYcBaxBXb2RffQ.png"/></div></div></figure><h2 id="6cd9" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated">步骤 6:设置 AWS CLI 环境(创建凭证和配置文件)</h2><p id="d347" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated">这一步将帮助我们使用在上面第 2 步中获得的用户凭证自动访问 awscli 环境中的 AWS。</p><p id="0a75" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">这种设置有两种方法:手动创建凭证和配置文件(方法 1)或使用<code class="fe nl nm nn no b">aws</code>命令创建这些文件(方法 2)。你可以使用任何一个。</p><p id="2be6" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><strong class="lz jd">方法 1: </strong></p><p id="ca19" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><strong class="lz jd"> <em class="mr">在终端上创建</em> </strong> <code class="fe nl nm nn no b"><strong class="lz jd"><em class="mr">credentials</em></strong></code> <strong class="lz jd"> <em class="mr">文件如下(您可以使用</em> </strong> <code class="fe nl nm nn no b"><strong class="lz jd"><em class="mr">nano</em></strong></code> <strong class="lz jd"> <em class="mr">或您选择的任何其他文本编辑器):</em> </strong></p><ul class=""><li id="c669" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">在终端上，导航到所需的文件夹，通常是根目录，并创建一个隐藏目录，如<code class="fe nl nm nn no b">aws</code>:</li></ul><p id="8488" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><code class="fe nl nm nn no b">$mkdir .aws</code>(句点表示隐藏目录)</p><ul class=""><li id="e479" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">转到目录<code class="fe nl nm nn no b">$cd .aws</code></li><li id="1d4f" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated">使用 nano 创建一个<code class="fe nl nm nn no b">credentials</code>文件:<code class="fe nl nm nn no b">$nano credentials</code>按如下方式键入<code class="fe nl nm nn no b">credentials</code>文件的内容(用步骤 2 中为用户‘EMR-user’生成的密钥替换密钥‘EXAMPLE _ ID’和密钥‘EXAMPLE _ Key’):</li></ul><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pf"><img src="../Images/64ebdc53650f7655794b6564f441dd68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ULWJZKwrNSG5pQTFp_CxVg.png"/></div></div></figure><ul class=""><li id="f17e" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">使用<code class="fe nl nm nn no b">Ctrl + X</code>，然后使用<code class="fe nl nm nn no b">Y</code>保存文件并退出 nano。</li></ul><p id="18b7" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><strong class="lz jd">T33】创建配置文件:T35】</strong></p><ul class=""><li id="cb53" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated"><code class="fe nl nm nn no b">$nano config </code>按如下方式键入<code class="fe nl nm nn no b">config</code>文件的内容(我们使用的区域与我们在步骤 4 中创建 S3 存储桶时使用的区域相同):</li></ul><pre class="om on oo op gt pg no ph pi aw pj bi"><span id="d899" class="lj ks it no b gy pk pl l pm pn">[default]<br/>region=us-west-2</span></pre><ul class=""><li id="6b14" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">使用<code class="fe nl nm nn no b">Ctrl + X</code>，然后使用<code class="fe nl nm nn no b">Y</code>保存文件并退出 nano。</li></ul><h2 id="1b9b" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated">方法 2:</h2><p id="1477" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated">在终端上，键入<code class="fe nl nm nn no b">$aws configure</code>，并按如下方式输入所需信息:</p><pre class="om on oo op gt pg no ph pi aw pj bi"><span id="ffa7" class="lj ks it no b gy pk pl l pm pn">AWS Access Key ID [None]: (Enter your access key from the user 'emr-user' created in Step 2)<br/>AWS Secret Access Key [None]: (Enter your secret key from the user 'emr-user' created in Step 2)<br/>Default region name [None]: us-west-2 (The same region used in Step 4)<br/>Default output format [None]:</span></pre><p id="e83e" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">这两个文件将在隐藏文件夹中自动创建。aws 通常位于根目录下，如下所示:</p><ul class=""><li id="e827" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated"><code class="fe nl nm nn no b">$cd ~/.aws</code></li><li id="a73a" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated">键入<code class="fe nl nm nn no b">$ls </code>以验证这两个文件是否存在。信息应该与方法 1 中的相同，我们可以通过键入以下命令来检查内容:</li><li id="fb98" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated"><code class="fe nl nm nn no b">$cat credentials</code></li><li id="eb14" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated"><code class="fe nl nm nn no b">$cat config</code></li></ul><h2 id="8b6d" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated">准备好。步骤 3 中生成的 pem 文件</h2><p id="d197" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated">为了连接到集群，我们需要。在步骤 3 中创建的 pem 文件。移动。我们在步骤 3 中下载的 pem 文件保存到项目所需的位置。对我来说，我把它放在与隐藏文件夹中的凭证和配置文件相同的位置。位于根目录<code class="fe nl nm nn no b">~/.aws/emr-cluster.pem</code>的 aws)</p><pre class="om on oo op gt pg no ph pi aw pj bi"><span id="cb04" class="lj ks it no b gy pk pl l pm pn">$ mv ~/Downloads/emr-cluster.pem .</span></pre><ul class=""><li id="83be" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">用这个的时候。pem 文件来设置 ssh，如果。pem 文件太开放。警告的一个例子是:“<em class="mr">对“~/”的权限 0644。“aws/emr-cluster.pem”太开放。要求您的私钥文件不能被其他人访问。该私钥将被忽略。</em></li><li id="9dab" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated">在这种情况下，我们需要为此更改权限。pem 文件使用命令:<code class="fe nl nm nn no b">sudo chmod 600 ~/.aws/emr-cluster.pem</code></li></ul><h2 id="d6f3" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated">验证我们是否成功安装了 awscli 包并设置了凭据</h2><p id="081e" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated">要验证我们是否成功安装了 awscli 并设置了凭据，请键入一些 aws 命令，如</p><ul class=""><li id="5ee4" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">列出所有 IAM 用户:<code class="fe nl nm nn no b">$aws iam list-users</code></li><li id="bc65" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated">列出 s3 中的所有存储桶:<code class="fe nl nm nn no b">$aws s3 ls</code>该命令将列出 AWS 中的所有 s3 存储桶:</li></ul><figure class="om on oo op gt oq gh gi paragraph-image"><div class="gh gi po"><img src="../Images/b566150c48b0889edb92a603c095f1f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*yTCu2Dtpy83huIShg1CV4w.png"/></div></figure><h2 id="5b72" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated">步骤 7:创建一个 EMR 集群</h2><p id="0097" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated">现在我们准备在终端上创建 EMR 集群。在终端上，键入命令:</p><pre class="om on oo op gt pg no ph pi aw pj bi"><span id="749c" class="lj ks it no b gy pk pl l pm pn">aws emr create-cluster --name test-emr-cluster --use-default-roles --release-label emr-5.28.0 --instance-count 3 --instance-type m5.xlarge --applications Name=JupyterHub Name=Spark Name=Hadoop --ec2-attributes KeyName=emr-cluster  --log-uri s3://s3-for-emr-cluster/</span></pre><p id="544c" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><strong class="lz jd">电子病历脚本组件说明:</strong></p><ul class=""><li id="4910" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated"><code class="fe nl nm nn no b">--name</code>:在这种情况下，集群的名称为‘test-EMR-cluster’</li><li id="ea96" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated"><code class="fe nl nm nn no b">--use-default-roles</code>:使用默认服务角色(EMR_DefaultRole)和实例配置文件(EMR_EC2_DefaultRole)获得访问其他 AWS 服务的权限</li><li id="0bd0" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated"><code class="fe nl nm nn no b">--release-label emr-5.28.0</code>:使用 EMR 版本 5.28.0 构建集群</li><li id="17cf" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated"><code class="fe nl nm nn no b">--instance-count 3</code>和<code class="fe nl nm nn no b">--instance-type m5.xlarge</code>:构建 1 个主节点和 2 个 m5.xlarge 类型的核心节点</li><li id="4f93" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated"><code class="fe nl nm nn no b">--applications Name=JupyterHub Name=Spark Name=Hadoop</code>:在这个集群上安装 JupyterHub、Spark 和 Hadoop</li><li id="6bff" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated"><code class="fe nl nm nn no b">--ec2-attributes KeyName=emr-cluster</code>:配置 Amazon EC2 实例配置，KeyName 是我们在步骤 3 中设置的 EC2 实例名称(<code class="fe nl nm nn no b">Set up credentials in EC2</code>)并获取。pem 文件)。在这种情况下，名称为<code class="fe nl nm nn no b">emr-cluster</code>。</li><li id="2581" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated"><code class="fe nl nm nn no b">--log-uri s3://s3-for-emr-cluster/</code>:指定要存储日志文件的 S3 桶。在这种情况下，S3 存储桶是“s3-for-emr-cluster”。该字段是可选的(如步骤 4 中所述)。</li><li id="c9c2" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated">由于 EMR 集群的成本很高，我们可以设置选项<code class="fe nl nm nn no b">--auto-terminate</code>在集群上的所有操作完成后自动终止集群。为此，我们还需要使用<code class="fe nl nm nn no b">--bootstrap-actions Path="s3://bootstrap.sh"</code>在命令中指定引导动作。当您使用自动终止时，群集将启动，运行您指定的任何引导操作，然后执行通常输入数据、处理数据，然后生成并保存输出的步骤。当这些步骤完成时，Amazon EMR 自动终止集群 Amazon EC2 实例。<strong class="lz jd"> <em class="mr">如果我们不放任何自举动作，我们应该去掉这个字段。</em> </strong>可在<a class="ae mq" href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-plan-bootstrap.html" rel="noopener ugc nofollow" target="_blank"> AWS 网站</a>上找到关于引导的详细参考。</li></ul><p id="3542" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><strong class="lz jd">我们创建 EMR 集群后的期望输出将是:</strong></p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pp"><img src="../Images/7d8f8a3e093578b352a4e97a0efd481c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQK03qk_ZU8HDyo-hIt3BA.png"/></div></div></figure><p id="cd06" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">使用以下命令，使用 ClusterId 检查集群的状态和信息(<code class="fe nl nm nn no b">j- EXAMPLECLUSTERID</code>):</p><pre class="om on oo op gt pg no ph pi aw pj bi"><span id="da97" class="lj ks it no b gy pk pl l pm pn">aws emr describe-cluster --cluster-id j-EXAMPLECLUSTERID</span></pre><p id="0721" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">我们应该等待几分钟，让群集可用(状态变为“可用”)，然后再继续下一步。</p><p id="4b3f" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><strong class="lz jd">* * *更新 1: </strong>如果您在创建 Amazon EMR 集群时遇到了<code class="fe nl nm nn no b">"EMR_DefaultRole is invalid" or "EMR_EC2_DefaultRole is invalid" error</code>的问题，您可能需要删除角色和实例概要文件；然后按照本指令重新创建角色<a class="ae mq" href="https://aws.amazon.com/premiumsupport/knowledge-center/emr-default-role-invalid/" rel="noopener ugc nofollow" target="_blank">。感谢 Trevor S .讨论这个问题。</a></p><p id="e787" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">*** <strong class="lz jd">更新 2: </strong>为了使群集可用于 EMR 上的笔记本，我们可能需要在—ec2—属性中包含子网 id:</p><pre class="om on oo op gt pg no ph pi aw pj bi"><span id="bb00" class="lj ks it no b gy pk pl l pm pn">aws emr create-cluster --name test-emr-cluster --use-default-roles --release-label emr-5.28.0 --instance-count 3 --instance-type m5.xlarge --applications Name=JupyterHub Name=Spark Name=Hadoop --ec2-attributes <strong class="no jd"><em class="mr">SubnetIds=subnet-YOURSUBNET,</em></strong>KeyName=emr-cluster  --log-uri s3://s3-for-emr-cluster/</span></pre><p id="a74d" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">(感谢 Saverio G .和我讨论这个问题。)</p><p id="b22f" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><strong class="lz jd">如何查找子网 id？</strong></p><p id="e874" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">点击 EMR 控制台上的<strong class="lz jd"> VPCSubnets </strong>选项卡，从列表中进行选择。</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pq"><img src="../Images/c3d0d2a942ab42eaf2aee1ccb679ac6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BY6id_4Uri61roz1df2z9w.png"/></div></div></figure><p id="0090" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">对于初学者来说，另一个安全的方法是:使用 AWS 控制台创建一个类似的 EMR 集群。然后查看该群集的<strong class="lz jd">摘要</strong>页面上的“<strong class="lz jd">网络和硬件</strong>”会话，以查看子网 ID:</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pr"><img src="../Images/8bf99aae6196bb991e2ca2cec341623a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vMwTiB7bta2cQXDnl-H89A.png"/></div></div></figure><p id="4760" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">您可以通过 AWS 上的<a class="ae mq" href="https://console.aws.amazon.com/vpc/" rel="noopener ugc nofollow" target="_blank"> VPC 仪表板访问子网。关于子网和 VPC 的更多信息可以在 AWS 网站上找到。</a></p><h2 id="2517" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated">步骤 8:允许 SSH 访问</h2><p id="635e" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated">从 AWS 控制台，点击<code class="fe nl nm nn no b">Service</code>，输入 EMR，并转到 EMR 控制台。</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi ps"><img src="../Images/6580a4bfbf0f258ee8c2d7a529af0709.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xmQVwWAsCUaMadu0E8cEOA.png"/></div></div></figure><p id="3f04" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">= &gt;选择<code class="fe nl nm nn no b">Clusters</code> = &gt;选择列表中集群的名称，在本例中，是<code class="fe nl nm nn no b">test-emr-cluster</code></p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pt"><img src="../Images/043440e2a61a1e2a7b7399fb12d8a0ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yoM4LIQuEZW4DIcbiwMWgA.png"/></div></div></figure><p id="b824" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">在<code class="fe nl nm nn no b">Summary</code>选项卡上，向下滚动查看零件<code class="fe nl nm nn no b">Security and access</code>，选择<code class="fe nl nm nn no b">Security groups for Master</code>链接</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pu"><img src="../Images/c76dbd54157c43e8eb4b913299dbb335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eY-_xEwPXW9dQiQEnkuivA.png"/></div></div></figure><p id="5bc1" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">选择<code class="fe nl nm nn no b">Security group ID</code>为<code class="fe nl nm nn no b">ElasticMapReduce-master</code></p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pv"><img src="../Images/b6d41ff30c0dd1850358fd3341e6b229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*erc38vAxEuLG6lfVEvfRAQ.png"/></div></div></figure><p id="871f" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">向下滚动<code class="fe nl nm nn no b">Inbound rules</code>，<code class="fe nl nm nn no b">Edit inbound rules</code> = &gt;为了安全起见，删除任何 SSH 规则(如果有)，然后选择<code class="fe nl nm nn no b">Add Rule</code> = &gt;选择类型:SSH，TCP 用于协议，22 用于端口范围= &gt;用于源，选择我的 IP = &gt;选择<code class="fe nl nm nn no b">Save</code>。</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pw"><img src="../Images/ebf843b6730ec8ed9e0a9087baeee384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mY58SPoW41tt4ulk7sREbA.png"/></div></div></figure><h2 id="9d31" class="lj ks it bd kt lk ll dn kx lm ln dp lb lo lp lq ld lr ls lt lf lu lv lw lh iz bi translated"><strong class="ak">步骤 9:创建与集群主节点的 SSH 连接</strong></h2><p id="3ed6" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated"><strong class="lz jd">方法 1: </strong></p><ul class=""><li id="a90c" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">在终端上，使用命令检查集群的 id</li></ul><p id="c5f2" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><code class="fe nl nm nn no b">aws emr list-clusters</code></p><ul class=""><li id="cc05" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">使用此命令连接到集群。记住要指定。pem 文件:</li></ul><p id="fca6" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><code class="fe nl nm nn no b">aws emr ssh --cluster-id j-EXAMPLECLUSTERID --key-pair-file ~/.aws/emr-cluster.pem</code></p><p id="fb91" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">如果我们看到如下带有 EMR 字母的屏幕，恭喜您，您使用 AWS CLI 成功创建、设置并连接到 EMR 集群！！！！</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi px"><img src="../Images/610e945cd976567105251f9155f19dc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bGD-PSUaW6DMBeBS8UfPUQ.png"/></div></div></figure><p id="ca49" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">使用命令<code class="fe nl nm nn no b">$logout</code>关闭与集群的连接。</p><p id="9e52" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><strong class="lz jd">方法 2: </strong></p><ul class=""><li id="5ef4" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">从 AWS 控制台，点击<code class="fe nl nm nn no b">Service</code>，输入 EMR，并转到 EMR 控制台。</li><li id="8893" class="mx my it lz b ma ng md nh lo ni lr nj lu nk mp ny nd ne nf bi translated">选择<code class="fe nl nm nn no b">Clusters</code> = &gt;单击列表中的集群名称，在本例中，在 Summary 选项卡上，单击链接<strong class="lz jd">使用 SSH 连接到主节点。</strong></li></ul><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi py"><img src="../Images/2aaecb4d117876c3ddb306a54b7630c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PzabqupZwqyT6W8LrXKnWg.png"/></div></div></figure><ul class=""><li id="7ce3" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">复制弹出窗口中显示的命令，并粘贴到终端上。</li></ul><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pz"><img src="../Images/b4c29e1448fd10c5b7f49b7c6c2a9c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VLl9bFgFDBnk-wg0o9z0MQ.png"/></div></div></figure><ul class=""><li id="f319" class="mx my it lz b ma ms md mt lo mz lr na lu nb mp ny nd ne nf bi translated">记得用私钥文件的位置和文件名替换~/emr-cluster.pem。pem)我们已经建立了。例如</li></ul><p id="609e" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><code class="fe nl nm nn no b">ssh -i ~/.aws/emr-cluster.pem hadoop@ec2-xx-xxx-xx-xx.us-west-2.compute.amazonaws.com</code></p><p id="0460" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">如果我们看到带有 EMR 字母的屏幕，恭喜您，您使用 AWS CLI 成功创建、设置并连接到 EMR 集群！！！！</p><h1 id="6276" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated"><strong class="ak">现在您可以开始使用 EMR 集群了</strong></h1><p id="1a48" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated"><strong class="lz jd"> <em class="mr">创建一个简单的 Spark 任务，例如，创建一个 Spark 数据帧，其中包含字符串类型的时间，然后将该列转换为不同的格式。</em> </strong></p><p id="3348" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">在集群终端上，创建文件<code class="fe nl nm nn no b">test_emr.py</code></p><pre class="om on oo op gt pg no ph pi aw pj bi"><span id="5049" class="lj ks it no b gy pk pl l pm pn">$nano test_emr.py</span></pre><p id="3f6b" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">将该脚本复制并粘贴到 test_emr.py</p><pre class="om on oo op gt pg no ph pi aw pj bi"><span id="48fd" class="lj ks it no b gy pk pl l pm pn">### Content of the file 'test_emr.py'</span><span id="9159" class="lj ks it no b gy qa pl l pm pn">from pyspark.sql import SparkSession, functions as F</span><span id="fd9e" class="lj ks it no b gy qa pl l pm pn">if __name__ == "__main__":<br/>    """<br/>        example of script submited to spark cluster<br/>    """<br/>    spark = SparkSession.builder.getOrCreate()<br/>    <br/>    df = spark.createDataFrame([('01/Jul/1995:00:00:01 -0400', ),('01/Jul/1995:00:00:11 -0400',),('26/Jul/1995:17$<br/>                            ('19/Jul/1995:01:56:43 -0400',), ('11/Jul/1995:12:50:18 -0400',)], ['TIME'])<br/>    df = df.withColumn("date", F.unix_timestamp(F.col('TIME'), 'dd/MMM/yyyy:HH:mm:ss Z').cast('timestamp'))<br/>    # show the dataframe<br/>    df.show()<br/>    <br/>    #### stop the spark, otherwise the program will be hanged <br/>    spark.stop()</span></pre><p id="2801" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">文件的内容如<code class="fe nl nm nn no b">nano</code>文本编辑器所示:</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi qb"><img src="../Images/b86489370d5f3bc980004631b10312f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uwsuOXTccrYimYgISpGQFA.png"/></div></div></figure><p id="29cc" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">使用以下命令在集群终端上提交脚本:</p><pre class="om on oo op gt pg no ph pi aw pj bi"><span id="cacf" class="lj ks it no b gy pk pl l pm pn">$spark-submit --master yarn ./test_emr.py</span></pre><p id="fdf3" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">当任务运行时，它可能会被终端上的任何信息淹没，这在 Spark 中是正常的。可以在信息日志中找到输出:</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi qc"><img src="../Images/686b74406249c4940217e21852dc7786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K1QmnnKVg9D1CIRYYlWQbA.png"/></div></div></figure><h1 id="10f0" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">恭喜你！你做到了！</h1><p id="4b47" class="pw-post-body-paragraph lx ly it lz b ma mb kd mc md me kg mf lo mg mh mi lr mj mk ml lu mm mn mo mp im bi translated"><strong class="lz jd">当不再使用集群时，记得将其终止。</strong></p><p id="be25" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">键入<code class="fe nl nm nn no b">logout</code>退出集群。然后使用以下命令终止集群:</p><pre class="om on oo op gt pg no ph pi aw pj bi"><span id="bcee" class="lj ks it no b gy pk pl l pm pn">$a<!-- -->ws emr terminate-clusters --cluster-id j-EXAMPLECLUSTERID</span></pre><p id="29c6" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">请注意，<strong class="lz jd"> <em class="mr">我们可以使用 AWS CLI 命令轻松地再次创建具有相同配置的集群</em> </strong>，当我们在 emr 控制台上选择终止的集群“test-emr-cluster”时，单击<code class="fe nl nm nn no b">AWS CLI export</code>选项卡可以找到该命令:</p><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi pt"><img src="../Images/52cacbb7822ffbe5bed68ffef338b6ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AxBL_4tcUwS-r2KI8PB_jg.png"/></div></div></figure><figure class="om on oo op gt oq gh gi paragraph-image"><div role="button" tabindex="0" class="or os di ot bf ou"><div class="gh gi qd"><img src="../Images/4fd75538b167a59a03b77abfef824fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mp0vQ5ccCgm8JdoxvCM-cg.png"/></div></div></figure><p id="645d" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated">我希望没有人再需要使用 AWS CLI 在 EMR 上创建、设置和运行 Spark 集群。如果您对本教程有任何问题或发现任何错误，请告诉我。</p><p id="fac4" class="pw-post-body-paragraph lx ly it lz b ma ms kd mc md mt kg mf lo mu mh mi lr mv mk ml lu mw mn mo mp im bi translated"><strong class="lz jd"> <em class="mr">本教程的 Jupyter 笔记本版本，以及 Spark 上的其他教程和更多数据科学教程可以在</em></strong><a class="ae mq" href="https://github.com/nhntran/aws_spark_cluster_tutorial" rel="noopener ugc nofollow" target="_blank"><strong class="lz jd"><em class="mr">my Github</em></strong></a><strong class="lz jd"><em class="mr">上找到。</em> </strong>请欣赏！</p></div></div>    
</body>
</html>