<html>
<head>
<title>Processing and visualizing multiple categorical variables with Python — NBA’s schedule challenges</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python处理和可视化多个分类变量——NBA的赛程挑战</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/processing-and-visualizing-multiple-categorical-variables-with-python-nbas-schedule-challenges-b48453bff813?source=collection_archive---------6-----------------------#2020-02-26">https://towardsdatascience.com/processing-and-visualizing-multiple-categorical-variables-with-python-nbas-schedule-challenges-b48453bff813?source=collection_archive---------6-----------------------#2020-02-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="13e9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用平行分类图和树形图来可视化、识别和比较数据中多个输入变量的影响:NBA中的休息、旅行和主场。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8ed8d87e811341c21fb97c6574cfd3c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZHOVU05yz705IsITXtPCYw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可视化多个分类变量</p></figure><p id="3099" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">今天，我想讨论处理、可视化和回顾分类变量的各种方法。当有多个分类变量时，处理和可视化数据可能会很棘手。</p><p id="5319" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能见过有多种颜色和标记形状的交叉线条图，或者可能是支线剧情的网格。这些解决方案可以工作(并且工作得很好)，但是它们远不是这个特定任务的唯一可用的绘图类型，今天我们将探索一些其他的方法。</p><p id="4593" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">至于数据，我们将使用篮球(NBA)输赢数据。更具体地说，我们将着眼于三个据说影响篮球比赛结果的关键外部因素；主场优势，旅行，休息日。</p><p id="6a9d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一如既往，虽然这篇文章利用了篮球数据，但它首先是一篇数据分析和可视化的文章。因此，专门针对篮球的讨论保持在相对最小的范围内，之前的篮球/NBA知识是不必要的(尽管<em class="lu">欣赏</em>和<em class="lu">鼓励</em>😉).</p><h1 id="f70b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在开始之前</h1><h2 id="b1e8" class="mn lw it bd lx mo mp dn mb mq mr dp mf lh ms mt mh ll mu mv mj lp mw mx ml my bi translated">数据</h2><p id="c9d9" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">我将代码和数据包含在我的<a class="ae ne" href="https://gitlab.com/jphwang/online_articles" rel="noopener ugc nofollow" target="_blank"> GitLab repo here </a>(在<strong class="la iu"> nba_travel_impact </strong>目录中)中，如果您愿意，您应该能够通过下载/克隆repo来轻松跟进。</p><h2 id="7859" class="mn lw it bd lx mo mp dn mb mq mr dp mf lh ms mt mh ll mu mv mj lp mw mx ml my bi translated">包装</h2><p id="8d49" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">我假设您熟悉python。即使你相对来说是新手，这个教程也不应该太难。(请在<a class="ae ne" href="https://twitter.com/_jphwang" rel="noopener ugc nofollow" target="_blank"> twitter </a>上找到我，并告诉我您是否想要更多指导。)</p><p id="caaf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你需要<code class="fe nf ng nh ni b">pandas</code>和<code class="fe nf ng nh ni b">plotly</code>。用一个简单的<code class="fe nf ng nh ni b">pip install [PACKAGE_NAME]</code>安装每一个(在你的虚拟环境中)。</p><p id="5aa2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">显然，你可以使用任何图形包，但我个人更喜欢你用<a class="ae ne" href="https://plot.ly/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>得到的简单和强大。</p><h1 id="991d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">NBA赛程—影响</h1><p id="5ca1" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">每个NBA常规赛在十月和四月之间进行。(例如，2019-20赛季将在10月22日至4月15日之间举行。)在这段时间里，每支球队打82场比赛，平均每场比赛只有2.15天。比赛之间勉强算一天休息。</p><p id="59e5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不仅如此，NBA球场遍布美国和多伦多。为了平衡赛程，他们有一半的比赛要在客场进行，球队必须像乘地铁一样往返于两地之间。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/440d2bf6514efa159e55be6ba00ff2fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bMi6PEiSAVSm51gmOAaRKg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">所有29个NBA球场都在一张地图上</p></figure><p id="bbf6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">事实上，NBA球队每年的行程大约在60，000到85，000公里(37，000-53，000英里/年)之间，他们的飞行总的来说是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/0c9f902e3033da392f0398d02c32e428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oJ4en3nSUaWvr_CAr6Qi2Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">所有30支NBA球队的旅行日程-可视化</p></figure><blockquote class="nl nm nn"><p id="d68e" class="ky kz lu la b lb lc ju ld le lf jx lg no li lj lk np lm ln lo nq lq lr ls lt im bi translated">(<a class="ae ne" href="https://medium.com/swlh/interactive-animated-travel-data-visualizations-mapping-nba-travel-a154a2e7c18d" rel="noopener">我关于可视化旅行数据的文章</a>，以及一个<a class="ae ne" href="https://demo.hindsights.io/202002_nba_travel/nba_travel_map.html" rel="noopener ugc nofollow" target="_blank">交互式的html版本的地图</a>)</p></blockquote><p id="a037" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有这一切的结果是，旅行，比赛和休息的场地是NBA日程的重要组成部分。</p><p id="8bfb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">82场比赛中，每支球队有一半在主场进行，另一半在客场进行。甚至许多主场比赛也不总是需要休息——可能需要旅行一夜才能回来，他们甚至可能为了下一场比赛而马上离开。</p><p id="ad91" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于我们这些不得不乘坐商业航班的凡人来说，这将是一场噩梦。然而，现代NBA球员乘坐私人团队飞机，他们的健康和福祉管理得如此之好，以至于旅行不会对他们产生重大影响。让我们找出答案。</p><h2 id="8107" class="mn lw it bd lx mo mp dn mb mq mr dp mf lh ms mt mh ll mu mv mj lp mw mx ml my bi translated">加载/获取数据</h2><p id="cda7" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">在我们分析休息、比赛和主场优势的影响之前，我们需要收集或加载我们的数据。为了方便起见，我用上一季的，但是(你也可以用这一季的，或者几季的。</p><p id="f539" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然您可以简单地加载我已经预处理过的数据(如果您愿意，可以跳到我加载<code class="fe nf ng nh ni b">box_df</code>的地方)，但是如果您感兴趣的话——我是这样编译数据的:</p><p id="ba39" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我从<a class="ae ne" href="https://www.basketball-reference.com" rel="noopener ugc nofollow" target="_blank">basketball-reference.com</a>获得了时间表数据，你可以简单地从我的回购中加载如下数据:</p><pre class="kj kk kl km gt nr ni ns nt aw nu bi"><span id="ccb8" class="mn lw it ni b gy nv nw l nx ny">schedule_df = pd.read_csv('srcdata/2019_nba_schedule.csv', index_col=0)</span></pre><p id="f54e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该数据包括EST ( <code class="fe nf ng nh ni b">est_time</code>)中的游戏提示时间，因此我创建了一个date列。</p><pre class="kj kk kl km gt nr ni ns nt aw nu bi"><span id="b631" class="mn lw it ni b gy nv nw l nx ny">schedule_df = schedule_df.assign(game_date=schedule_df.est_time.dt.date)</span></pre><p id="e44e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，<code class="fe nf ng nh ni b">game_dates = schedule_df.game_date.unique()</code>获得一个独特的比赛日期列表，之后用<code class="fe nf ng nh ni b">basketball_reference_web_scraper</code>包下载我们每个日期的数据。如果你想尝试这段代码，你需要用<code class="fe nf ng nh ni b">pip</code>来安装它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="0c11" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在这里做的是下载数据，将每场比赛标记为主场比赛或客场比赛，并保存数据帧。</p><p id="f2ea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">无论如何，让我们加载一个我之前为保持一致性而准备的文件:</p><pre class="kj kk kl km gt nr ni ns nt aw nu bi"><span id="a145" class="mn lw it ni b gy nv nw l nx ny">box_df = pd.read_csv('srcdata/2019_nba_team_box_scores.csv', index_col=0)</span></pre><p id="ee66" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看一下<code class="fe nf ng nh ni b">box_df</code>，你会看到它包含2460行，与30支球队的82场比赛相匹配，因为每一行都显示一支球队的盒子分数。</p><h2 id="0f1c" class="mn lw it bd lx mo mp dn mb mq mr dp mf lh ms mt mh ll mu mv mj lp mw mx ml my bi translated">简单的故障</h2><p id="1749" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">我在这里处理了数据，以包括布尔列，表示球队是否在<code class="fe nf ng nh ni b">home</code>比赛，他们是否有<code class="fe nf ng nh ni b">travelled</code>，以及他们是否赢了(<code class="fe nf ng nh ni b">win</code>)。我还为休息日的数量创建了一个分类变量(<code class="fe nf ng nh ni b">rest_cats</code>)，任何超过2天的都被归在一起，包括开幕日。</p><p id="04d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于我们的第一次可视化，让我们看看有多少游戏属于休息日和旅行的每一个类别。我会跳过主客场平分，这是50:50。</p><pre class="kj kk kl km gt nr ni ns nt aw nu bi"><span id="60bc" class="mn lw it ni b gy nv nw l nx ny">import plotly.express as px<br/><br/># How many games in each category?<br/>temp_grp_df = box_df.groupby('rest_cats').count().reset_index(drop=False)<br/><br/>fig = px.bar(temp_grp_df, y='rest_cats', x='outcome', orientation='h')<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/44bbc4f39c94306a98c7df09c789b5ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J9JPkKNwnCzwJpGncZacNA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">2018-19赛季，按休息日</p></figure><pre class="kj kk kl km gt nr ni ns nt aw nu bi"><span id="a887" class="mn lw it ni b gy nv nw l nx ny"># How many games in each category? Rest days &amp; travel.<br/>temp_grp_df = box_df.groupby(['rest_cats', 'travelled']).count().reset_index(drop=False)<br/>temp_grp_df = temp_grp_df.assign(travelled=temp_grp_df.travelled.astype(str))<br/>fig = px.bar(temp_grp_df, y='rest_cats', x='outcome', orientation='h', color='travelled', barmode='group')<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/777702acf81d6582f8d461195ac08e7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-8xkeyEcroH-RDxKh_eisQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">2018-19赛季，按休息日&amp;是否涉及旅行</p></figure><p id="f7ad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这很简单，分类变量在这里可以简洁地表示为成组的条形。</p><p id="cfb3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">至于产出，有几个观察要做NBA的时间表是这样的，大多数比赛有1天的休息，没有多少背靠背(0天休息)的比赛。</p><p id="ca76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">即使有，也似乎主要是主场比赛(因为不涉及旅行)，这对球队来说是好事。</p><h2 id="5646" class="mn lw it bd lx mo mp dn mb mq mr dp mf lh ms mt mh ll mu mv mj lp mw mx ml my bi translated">对成功百分比的总体影响</h2><p id="443d" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">现在，让我们来看看休息和旅行对胜利的影响。这样做的代码与前面的基本相同，除了现在为每个组创建一个<code class="fe nf ng nh ni b">WIN%</code>列，它成为我们的因变量。</p><pre class="kj kk kl km gt nr ni ns nt aw nu bi"><span id="d91d" class="mn lw it ni b gy nv nw l nx ny">travel_cats = ['rest_cats', 'travelled']<br/>travel_grp_df = box_df.groupby(travel_cats).sum()<br/>travel_grp_df = travel_grp_df.assign(games=box_df.groupby(travel_cats)['minutes_played'].count())<br/>travel_grp_df['WIN%'] = travel_grp_df.win/travel_grp_df.games * 100<br/>travel_grp_df.reset_index(drop=False, inplace=True)<br/>travel_grp_df = travel_grp_df.assign(travelled=travel_grp_df.travelled.astype(str))</span><span id="4b36" class="mn lw it ni b gy od nw l nx ny">fig = px.bar(travel_grp_df, y='rest_cats', x='WIN%', orientation='h', color='travelled', barmode='group')<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/8e5359c4bfd2438a419f6c5ae4204d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BzNQxhrmMCfvyD9c4wSxEw.png"/></div></div></figure><p id="f2b1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">趋势正如所料——旅行不利于获胜，多休息更好。但是，有趣的是——旅行过的队伍(红色)在休息2天以上的情况下赢得了几乎一半的比赛！</p><p id="7bb6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，增加这些图表的复杂性是分析开始变得具有挑战性的地方。</p><p id="b8a8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们有三个分类变量，我们试图分析，我们需要选择如何可视化它们，同时也表明因变量(例如，win %)。对于条形图，一种选择是使用上面提到的支线剧情:</p><pre class="kj kk kl km gt nr ni ns nt aw nu bi"><span id="1647" class="mn lw it ni b gy nv nw l nx ny">travel_cats = ['home', 'rest_cats', 'travelled']<br/>...<br/>fig = px.bar(travel_grp_df, y='rest_cats', x='WIN%', facet_col='home', orientation='h', color='travelled', barmode='group')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/8644cbf8dca8c71a4c0b0474c3906af0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yNvkW8wGjyk1o24dQOVAAQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作为支线剧情</p></figure><p id="a5b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这很好，但是它仍然缺少相当多对我们有用的信息。例如，它没有向我们展示这些分类变量是如何重叠或相互作用的。此外，支线剧情并不容易沿着轴线进行比较。</p><p id="cca6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">相反，让我们探索一个平行的类别图表。</p><h1 id="c730" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">平行类别图</h1><h2 id="f3e7" class="mn lw it bd lx mo mp dn mb mq mr dp mf lh ms mt mh ll mu mv mj lp mw mx ml my bi translated">创造</h2><p id="b47b" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">因为它们有些不寻常，所以让我们画一个，然后讨论它们包含的内容。幸运的是，用Plotly绘制平行分类图相对容易。事实上，Plotly Express只是将原始的box score数据帧作为参数，并根据我们传递的类别来编译数据。</p><p id="c829" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看看这个简单的例子，用二进制类别表示<code class="fe nf ng nh ni b">home</code>和<code class="fe nf ng nh ni b">travelled</code>。</p><pre class="kj kk kl km gt nr ni ns nt aw nu bi"><span id="903f" class="mn lw it ni b gy nv nw l nx ny"># PARALLEL CATEGORIES - THREE CATEGORIES AND WIN %<br/>box_df = box_df.assign(win_num=box_df.win.astype(int))<br/>travel_cats = ['home', 'travelled']<br/>fig = px.parallel_categories(box_df, dimensions=travel_cats, color='win_num')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/e33f246d52695f39d5b4d9221354ccc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8p8sFjKNh8LO-Ms-IVnnRQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">平行类别图—显示“家庭”和“旅行”</p></figure><p id="e4bb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能以前没有见过很多平行分类图表。它们看起来很复杂，但是一旦你掌握了窍门，它们就非常简单。</p><p id="0517" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每个垂直柱代表一个类别，每个带显示了沿着每个柱的分类变量的排列。上面的图表代表两个分类变量，我也根据结果(赢或输)将它们分开，代表三个变量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/2eb5c2d0e23556456c15c0a0d4dec8fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YayrZZaNA4MpuNZ1dVvnbw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">平行类别图—显示“家庭”和“旅行”</p></figure><p id="de95" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，它显示有329场比赛(乐队)球队在主场(左栏)，在比赛前旅行(右栏)，并取得胜利(彩色)。</p><p id="95a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">图表的本质是，每增加一个类别都会增加图表的复杂性，潜在地呈指数增长。看看下面的图表，增加了休息日长度的类别。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/a438f08eaadaf8400ad86bb99b658c8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RyaOIHNBiAjhjK70_WV5Ew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">平行类别图—显示“家”、“旅行”和“休息_猫”变量。</p></figure><p id="eb55" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面的示例显示了两条高亮显示的路径。</p><p id="4db7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最上面的深色路径显示了球队在客场(<code class="fe nf ng nh ni b">home==false</code>)、前往比赛(<code class="fe nf ng nh ni b">travel==true</code>)以及休息2天或更长时间(<code class="fe nf ng nh ni b">rest_cats == 2+ Days</code>)的比赛<em class="lu">失败</em>的次数。</p><p id="f386" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下方的黄色路径显示了相同标准的比赛数量，但是球队赢得了比赛。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/68c5d8b405b6d921ce749cf24430d70c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V52xlNsh32QwtXCtlvaa5g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">平行类别图—显示鼠标悬停弹出窗口</p></figure><p id="165b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">(<a class="ae ne" href="https://demo.hindsights.io/202002_nba_travel_impact/parcat.html" rel="noopener ugc nofollow" target="_blank">这里有一个互动版的这个给你试试&amp;玩一玩。</a>)</p><p id="1790" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦我们习惯了这种格式，通过平行类别图表探索多维分类关系会令人耳目一新。在这里，每一个竖线显示了总的胜率，简单地跟随粗线揭示了强共现的位置。</p><p id="52d6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">举例来说，让我们来看看球队没有休息，并且旅行的比赛。这张截图突出显示了在客场比赛的球队的记录。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/3b09dec2e92eea219a7352a5d6048f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5zbKe3i35aoCpogfdQegg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">团队记录—出门在外，没有休息日</p></figure><p id="976d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">已经很清楚的是，损失远远大于收益。客队在这些比赛中只赢了大约32%(总共237场)。</p><p id="443e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一方面，反过来说，一个主场球队在无休日赢得了83场比赛中的69%(我将把它作为一个练习——你自己看看<a class="ae ne" href="https://demo.hindsights.io/202002_nba_travel_impact/parcat.html" rel="noopener ugc nofollow" target="_blank">这里</a>)。</p><p id="6bc4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我发现平行分类图非常有用，尤其是对于数据探索。例如，我发现这张图表非常有用，视觉效果也很突出(<a class="ae ne" rel="noopener" target="_blank" href="/how-to-visualize-hidden-relationships-in-data-with-python-analysing-nba-assists-e480de59db50">我为本文</a>准备了这张图表)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/12d1e5761671c37ac79e6cd7883a259c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ripT3x51ULQfl0SBaRDvzA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我早些时候创建的一个——通过区域和助攻显示克莱的投篮(灰色:无帮助)</p></figure><p id="6502" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这张图表显示了克莱·汤普森的所有射门，按照射门位置，以及助攻来自谁。虽然最初看起来很复杂，但看看找出类别的主要组合是多么容易。如图所示，平行分类图可以很容易地发现趋势和共现。</p><p id="723d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">诚然，虽然平行类别图表在某些情况下很有用，但它也有其局限性。根据我的经验，它可能需要读者做一些工作来理解正在发生的事情，并且对许多人来说，它可能是视觉上的对抗和恐吓。</p><p id="f939" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一个很好的、可能更简单的可视化这类数据的方法是树形图。</p><p id="f885" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">树状图</strong></p><p id="ae30" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">树形图是探索分级、分类数据集的一种奇妙方式。看一看这个例子，就知道它有多容易理解了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/487e226c7633d7ab773b06dbad127d61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QUyjMboxyJfxAxyzBgp3xA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个树形图的例子(<a class="ae ne" href="https://plot.ly/python/treemaps/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>)</p></figure><p id="650d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尽管树形图通常用于评估分层数据结构的影响，但它也是一个很好的工具，适用于像这样的多变量情况。</p><p id="3fb6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以在这里生成树形图，方便地显示每个组的大小，以及随着我们越来越深入地研究每个类别，胜率的变化。</p><p id="652b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为树状图需要层次结构，所以我们在这里通过绘制两种不同的树状图来探索:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="fcac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，层级基于<em class="lu">回家/离开</em>、<em class="lu">旅行/不旅行</em>和<em class="lu">休息日</em>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/4e63510bf4f4599931154a12721fa472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cIYEeVdtLRSRgD9EGGUKZA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">树状图1:回家-&gt;旅行-&gt;休息</p></figure><p id="5efa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第二种情况下，层级被更改为基于<em class="lu">回家/离开</em>、<em class="lu">休息日</em>和<em class="lu">出差/未出差</em>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/316b7e4948fbea896492fecea84bb532.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iRpeJBCLjRdwoJ6tOI3inA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">树状图2:回家-&gt;休息-&gt;旅行</p></figure><p id="5d5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">树形图布局很好地显示了每个子集样本大小的差异，以及颜色百分比的变化。</p><p id="200a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这两个图中，很明显，对胜率的更大影响通常来自于休息的时间，以及仅仅是在家还是在外，而不是来自于他们是否旅行。</p><p id="8e2b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看看上面的图表，在第二层的方框中(标有“旅行/停留”),是主场比赛。主队在比赛前回家(即旅行)的比赛的总赢/输百分比与他们没有旅行的比赛非常相似。</p><p id="4042" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第二张图中，所有盒子在休息日的总体胜率有很大不同，例如休息日为0的客场比赛是最差的(正如我们前面在平行类别图中看到的)。</p><p id="8de3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们再探讨一点，结束今天的分析。到目前为止，我们是从一个球队的角度来看这些数据的(除了主客场数据，这是一个补充)。如果对手的休息数据也是会怎么样？</p><p id="1678" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">出于这个原因，我得到了另一个数据集——对手的休息日被添加到<code class="fe nf ng nh ni b">opp_rest_cats</code>列中。</p><pre class="kj kk kl km gt nr ni ns nt aw nu bi"><span id="785f" class="mn lw it ni b gy nv nw l nx ny">box_df = pd.read_csv('srcdata/2019_nba_team_box_scores_2.csv', index_col=0)</span><span id="a91e" class="mn lw it ni b gy od nw l nx ny">travel_cats = ['home', 'rest_cats', 'opp_rest_cats']<br/>travel_grp_df = box_df.groupby(travel_cats).sum()<br/>travel_grp_df = travel_grp_df.assign(games=box_df.groupby(travel_cats)['minutes_played'].count())<br/>travel_grp_df.reset_index(drop=False, inplace=True)<br/><br/>chart_cats = ['home_str', 'rest_cats', 'opp_rest_cats']<br/>home_away = pd.Series(['Home ' * i for i in travel_grp_df.home.values]) + pd.Series(['Away ' * (1-i) for i in travel_grp_df.home.values])<br/>travel_grp_df['home_str'] = home_away<br/>travel_grp_df['rest_cats'] = travel_grp_df['rest_cats'] + "' Rest"<br/>travel_grp_df['opp_rest_cats'] = 'Opponent: &lt;BR&gt;' + travel_grp_df['opp_rest_cats'] + "'&lt;BR&gt;Rest"<br/>travel_grp_df['WIN%'] = travel_grp_df.win/travel_grp_df.games * 100<br/><br/>fig = px.treemap(<br/>    travel_grp_df, path=['home_str', 'rest_cats', 'opp_rest_cats'], values='games', color='WIN%', color_continuous_midpoint=50, color_continuous_scale=px.colors.diverging.Portland<br/>)<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/ea91addacd9d465d13607c7e944a23cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PTQ9486CHmxxiczTkiHCqg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">树状图3:主场-&gt;休息-&gt;对手休息</p></figure><p id="d4a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看那个！最佳和最差的赢/输百分比发生在其余差异最大的时候。</p><p id="c433" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看看左边的“客场”统计，我们的球队休息0天，对手休息2天以上，相反，我们的球队休息2天以上，对手休息0天。他们代表了极端的对立面。这种模式一直存在，休息的差异是获胜几率的一个重要因素。</p><p id="7b4d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">即使主队背靠背，他们平均也能击败其他背靠背的球队，显示了家常菜的价值。最中立的安排似乎是让主队背靠背，而客队长时间休息。</p><p id="3989" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那不是很有趣吗！？事实证明，旅行是一个相对较小的因素，赢/输百分比的最大因素是休息差和主场/客场。通过这些树形图很容易发现这一点。</p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><p id="6d18" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">总而言之，我希望以上展示了一些有用的例子和技术，用于钻取包含多个分类变量的数据集。</p><p id="f6f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我看来，平行分类图和树形图是这样做的有用工具，也是潜在未被充分利用的工具。</p><p id="1726" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当数据被细分时，树形图在可视化数据方面是有效的，在属性的向下钻取和变化方面，而平行类别图在识别数据点的同现和流动方面是极好的。用你自己的数据集来尝试这些，我很乐意听到更多关于它们的信息。</p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><p id="6110" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢这个，请说👋/关注<a class="ae ne" href="https://twitter.com/_jphwang" rel="noopener ugc nofollow" target="_blank"> twitter </a>，或点击此处获取更新。我还写了这篇关于使用Plotly绘制NBA旅行数据的文章，如果你以前没有读过的话:</p><div class="or os gp gr ot ou"><a href="https://medium.com/swlh/interactive-animated-travel-data-visualizations-mapping-nba-travel-a154a2e7c18d" rel="noopener follow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">交互式和动画旅行数据可视化—绘制NBA旅行地图</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">了解如何使用Python和Plotly创建位置和路径数据的精彩互动和动画可视化。</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">medium.com</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi ks ou"/></div></div></a></div><p id="e8f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还有这篇关于我最喜欢的数据可视化书籍的文章。</p><div class="or os gp gr ot ou"><a rel="noopener follow" target="_blank" href="/create-impactful-data-visualizations-with-these-books-ca9fbfecfde5"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">用这些书创建有影响力的数据可视化</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">如果没有交流，好的分析没有什么意义。数据可视化会有所帮助。以下是我对…的建议</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">towardsdatascience.com</p></div></div><div class="pd l"><div class="pj l pf pg ph pd pi ks ou"/></div></div></a></div><p id="e40d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">谢谢，下次再见！</p></div></div>    
</body>
</html>