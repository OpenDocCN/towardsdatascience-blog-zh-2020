<html>
<head>
<title>NYC Taxi Fare Prediction with Gradient Boosting Algorithm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于梯度推进算法的纽约出租车费用预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/nyc-taxi-fare-prediction-with-gradient-boosting-algorithm-9ff7a1eded1e?source=collection_archive---------66-----------------------#2020-06-01">https://towardsdatascience.com/nyc-taxi-fare-prediction-with-gradient-boosting-algorithm-9ff7a1eded1e?source=collection_archive---------66-----------------------#2020-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c0d2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">基于决策树的预测模型构建方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/839540bea3df84c6bb3dc4abf67ff44b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MEpturVAaHNpeaXw691Y1A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卢克·斯塔克波尔在<a class="ae ky" href="https://unsplash.com/s/photos/taxi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="523b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">纽约市的出租车展示了一幅清晰的城市生活画面。每个月，出租车机构收集的数百万数据使他们能够深入了解需求密度、出行模式和交通拥堵情况。通过利用这些每天积累的数据，出租车公司可以提供更好的定价，旨在为乘客提供具有竞争力的乘车费用。</p><p id="6475" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个实验中，我们将实现一个梯度推进的学习算法来预测出租车费用。</p><blockquote class="lv lw lx"><p id="20a9" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><strong class="lb iu">梯度推进(GBM) </strong>是一种学习技术，它将许多简单预测器的输出结合起来，构建一个强大的预测器，其性能优于基础学习器树。新树是先前树的增强版本，因此这种技术被称为boosting，其中新树提高了原始版本的性能(Biau等人，2019)。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mc"><img src="../Images/9a5c903badde12dbc102084eb9fe2438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PCyCxoO_LOS9WLGIJgD-0w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者插画的大树</p></figure><p id="8c61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GBM算法可以如上图所示。GBM使用由固定规模的多层决策树组成的基本学习器。已经强调了梯度增强具有几个优点。GBM提供了训练模型的易用性，并提高了效率和有效性，如下所示:</p><ul class=""><li id="ef63" class="md me it lb b lc ld lf lg li mf lm mg lq mh lu mi mj mk ml bi translated">与其他模型相比，预测准确性更高</li><li id="e881" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated">提供优化各种损失函数的灵活性，并提供多种超参数调谐选项</li><li id="054d" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated">不需要预处理数据，因为GBM可以很好地处理数字和分类变量</li><li id="afa0" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated">不需要处理丢失的数据</li></ul><h2 id="37f7" class="mr ms it bd mt mu mv dn mw mx my dp mz li na nb nc lm nd ne nf lq ng nh ni nj bi translated"><strong class="ak">数据集</strong></h2><p id="2fec" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">这项实验利用了纽约市出租车和豪华轿车委员会(TLC)的数据，特别是2019年6月的黄色出租车数据。点击查看数据集<a class="ae ky" href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page" rel="noopener ugc nofollow" target="_blank">。数据集由包括上下客区、行程距离、上客时间、乘客数量、拥堵附加费等要素组成。这些变量将被用作独立变量。另一方面，<strong class="lb iu"> fare_amount </strong>变量将被用作目标变量，其定义为出租车费的总额。此外，出于模型开发和评估的目的，大约1000个观察值的随机子集将被分割成8:2的比例。</a></p><p id="acaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，RStudio将用于执行模型开发的所有实验，均方根误差(RMSE)将用作评估指标。</p><h2 id="5be2" class="mr ms it bd mt mu mv dn mw mx my dp mz li na nb nc lm nd ne nf lq ng nh ni nj bi translated"><strong class="ak">梯度增强实现</strong></h2><p id="da49" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">GBM提供各种调谐参数，非常灵活。然而，在寻找超参数的最佳组合时会出现挑战，因为它可能很费时控制。</p><p id="ef94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">毫无疑问，GBM通过消除所有错误，过分强调离群值，并导致它们过度拟合来继续发展。因此，有必要进行交叉验证以推广该模型。第一步，用默认的<strong class="lb iu">【收缩】</strong> <strong class="lb iu">为0.001 </strong>的<strong class="lb iu"> 10重交叉验证</strong>建立GBM模型。此外，GBM使用默认的数量<strong class="lb iu"> interaction.depth </strong> <strong class="lb iu">作为1 </strong>来定义用于学习的树的级别。最后，<strong class="lb iu"> n.trees </strong>将被设置为10000。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="f0ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/cf1ff7a62683d13deb22edec4047e501.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*SGKv-cp3-YkXc4ra7OMAKQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">交叉验证估计</p></figure><p id="7046" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上图可以看出，0.001收缩率是一个非常小的学习率，通常需要大量的树才能达到最小MSE。此外，许多树木也导致一个漫长的训练过程。</p><p id="7da8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个设置似乎不足以进行更好的预测。因此，需要通过网格搜索来调整几个参数。为了在不过度拟合的情况下找到具有较低RMSE速率的参数的正确拟合，执行网格搜索。在此步骤中，调整几个参数，包括:</p><ul class=""><li id="cc15" class="md me it lb b lc ld lf lg li mf lm mg lq mh lu mi mj mk ml bi translated"><strong class="lb iu">缩水:</strong>指GBM学习率</li><li id="a4c2" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated">树的深度(层次)增长</li><li id="aac1" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated"><strong class="lb iu"> n.minobsinnode: </strong>树终止时的观察次数</li><li id="b97a" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated"><strong class="lb iu"> bag.fraction: </strong>随机选择的训练集分数观察值比率，用于提出扩展中的下一棵树</li></ul><p id="ab0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是各参数的网格搜索设置。参数范围设置为适合数据集特征。在这种情况下，给定的数据仅仅是1000个观察值，非常小。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="633a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，网格搜索设置被适配到模型训练循环中，如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="7a62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，以下是输出RMSE的10个最低比率的几个参数集。在这种情况下，第一行设置将用于拟合最终模型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/c69caf85d5670add536e409bc7e6153a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*sxAO8I6cWKuQDhfUqf3GaA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">RMSE税率最低的10个州的产量</p></figure><p id="4c7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是为最终模型设置的参数:</p><ul class=""><li id="0e47" class="md me it lb b lc ld lf lg li mf lm mg lq mh lu mi mj mk ml bi translated"><strong class="lb iu">收缩率:</strong> 0.10</li><li id="e023" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated"><strong class="lb iu">互动深度:</strong> 1</li><li id="9e3c" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated">微小牛肝菌</li><li id="1c2f" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated"><strong class="lb iu">袋.分数:</strong> 0.80</li></ul><p id="4c1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该配置将用于获得最佳模型。然后用<strong class="lb iu"> gbm </strong>()函数将这些参数拟合到最终模型，以训练模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="4bc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终列车RMSE是0.1148923，测试RMSE是0.3030436，这表明它是一个好模型，其中列车RMSE和测试RMSE之间的差距相当小。</p><h2 id="7b61" class="mr ms it bd mt mu mv dn mw mx my dp mz li na nb nc lm nd ne nf lq ng nh ni nj bi translated"><strong class="ak">结论</strong></h2><p id="3e7f" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">在整个模型开发过程中，微调和优化程序在寻找最佳参数以建立更好的模型和降低错误率方面发挥着重要作用。在所有模型被训练之后，执行验证以在测试数据集上评估训练的模型是必要的任务。该验证过程验证模型是否按预期执行。不仅如此，这一过程还有助于已经训练和调整的模型的泛化能力。</p><h2 id="9c84" class="mr ms it bd mt mu mv dn mw mx my dp mz li na nb nc lm nd ne nf lq ng nh ni nj bi translated"><strong class="ak">讨论:随机森林和梯度推进的比较</strong></h2><p id="8b3e" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">在速度性能方面，以前的研究人员揭示了梯度推进学习技术比其他基于树的学习(如随机森林)执行得更快。在随机森林的训练过程中，该模型利用完全生长的树，通过投票的方式将所有的树结合起来进行预测。然而，梯度提升利用弱学习器的组合来做出更好的预测。</p><h2 id="a2f1" class="mr ms it bd mt mu mv dn mw mx my dp mz li na nb nc lm nd ne nf lq ng nh ni nj bi translated"><strong class="ak">参考文献</strong></h2><ol class=""><li id="7111" class="md me it lb b lc nk lf nl li nt lm nu lq nv lu nw mj mk ml bi translated">Biau，g,“干部”, b .和Rouvière，l,“加速梯度推进”。<em class="ly">《机器学习》(2019)，</em>第108卷，第971–992页。</li><li id="8018" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu nw mj mk ml bi translated">纽约市出租车和豪华轿车委员会，<em class="ly"> TLC旅行记录数据(</em> 2020 <em class="ly">)，</em>【在线】<br/>可从以下网址获得:<a class="ae ky" href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page" rel="noopener ugc nofollow" target="_blank">https://www1 . NYC . gov/site/TLC/about/TLC-Trip-Record-Data . page</a></li></ol></div></div>    
</body>
</html>