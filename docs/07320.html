<html>
<head>
<title>How to get the Daily News using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python获取每日新闻</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/get-the-latest-news-using-python-and-performing-analysis-on-it-using-wordclouds-b4541b3b14fd?source=collection_archive---------16-----------------------#2020-06-03">https://towardsdatascience.com/get-the-latest-news-using-python-and-performing-analysis-on-it-using-wordclouds-b4541b3b14fd?source=collection_archive---------16-----------------------#2020-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="98e8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Python中的NewsAPI获取新闻，并生成词云来理解新闻和观点。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/7a1bb062f910ec23171a32bacfa0a0cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*Xfl-noZNSSWpP4gJzRUNZA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">图片来源:作者</p></figure><p id="163c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你有没有想过如何通过编程获得最新的新闻？新闻API就是Python中的一个这样的模块，可以在这方面帮助你。它有大约120个来源的数据，包括路透社、BBC新闻、ABC新闻、ESPN。</p><div class="ln lo gp gr lp lq"><a href="https://newsapi.org/docs/client-libraries/python" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd ir gy z fp lv fr fs lw fu fw ip bi translated">Python客户端库—新闻API</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">使用非官方的Python客户端库将新闻API集成到您的Python应用程序中，而不用担心…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">newsapi.org</p></div></div></div></a></div><p id="61f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，从NewsAPI获取API密钥，开始提取新闻文章。你可以在这里看到更多关于如何得到一个。</p><div class="ln lo gp gr lp lq"><a href="https://newsapi.org/docs/get-started" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd ir gy z fp lv fr fs lw fu fw ip bi translated">开始—文档—新闻API</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">要开始使用，您需要一个API密钥。它们免费用于开发、开源和非商业用途，您可以…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">newsapi.org</p></div></div></div></a></div><p id="3083" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">导入相关的库。</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="41f8" class="me mf iq ma b gy mg mh l mi mj">from newsapi import NewsApiClient</span></pre><p id="7bae" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是用于NewsAPI导入的。现在初始化NewsAPI的变量</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="a678" class="me mf iq ma b gy mg mh l mi mj">newsapi = NewsApiClient(api_key=api_key)</span><span id="7df4" class="me mf iq ma b gy mk mh l mi mj">from pandas.io.json import json_normalize</span><span id="d5a3" class="me mf iq ma b gy mk mh l mi mj">import pandas as pd</span></pre><p id="034e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用Python中漂亮的Soup包来帮助清理数据中的HTML标签。</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="ca5f" class="me mf iq ma b gy mg mh l mi mj">from bs4 import BeautifulSoup</span></pre><p id="a8e1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，让我们看看实际用途。</p><p id="8d46" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi ml translated"><span class="l mm mn mo bm mp mq mr ms mt di">L</span>T2】最新消息</p><p id="da5f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">获取最新消息:</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="5eb9" class="me mf iq ma b gy mg mh l mi mj">def top_headlines():    <br/>   country=input("Which country are you interested in?") <br/>   category=input("""Which category are you interested in? \nHere <br/>   are the categories to choose from:\nbusiness\nentertainment   <br/>   \ngeneral\nhealth\nscience\ntechnology""")        <br/>   top_headlines =newsapi.get_top_headlines(category=category,<br/>   language='en',country=country)     <br/>   top_headlines=json_normalize(top_headlines['articles'])   <br/>   newdf=top_headlines[["title","url"]]    <br/>   dic=newdf.set_index('title')['url'].to_dict()</span></pre><p id="371c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们来谈谈这段代码是做什么的。我写过一个函数叫top_headlines。我接受两个输入，国家和类别。当我向该国提供输入时，你必须以特定的格式书写。新闻API中的国家参数遵循以下代码系统:</p><div class="ln lo gp gr lp lq"><a href="https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd ir gy z fp lv fr fs lw fu fw ip bi translated">ISO 3166国家代码列表</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">下面的可排序表格包含249个国家中每个国家的三组ISO 3166-1国家代码，链接到…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">en.wikipedia.org</p></div></div></div></a></div><p id="9cf1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">USA是“us”，英国是“gb”，印度是“in”。有关其他国家的标志，请参考上面的链接。</p><p id="6742" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在代码本身中，我已经提到了如何向category参数提供输入。“一般”代表一般新闻，“体育”代表体育新闻，以此类推。</p><p id="ca6a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用get_top_headlines，您可以获得最新的新闻。现在，输出是JSON格式的，所以我想把它转换成数据帧。因此，我使用了在本教程前面导入的json_normalize方法。然后，我将它存储到一个新的Dataframe中，该data frame只包含从JSON输出中返回的列列表中选择的几个列。</p><p id="0459" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后我决定，我要搞清楚这个新闻信息。我用了一个案例来看媒体的观点在一个特定的时间段内是如何变化的。新闻API有一个付费版本，提供长达两年的信息。在免费版本中，你可以检索30天的新闻，这也是我选择的时间范围。</p><p id="c32a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi ml translated"><span class="l mm mn mo bm mp mq mr ms mt di">搜索特定的主题</span></p><p id="b310" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了进行这种分析，我们需要使用这种方法:</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="f1bd" class="me mf iq ma b gy mg mh l mi mj">get_everything(query,language,sort_by='relevancy',from_param,to)</span></pre><p id="2ccf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这意味着它可以获得与特定搜索查询相关的所有信息。比方说，您想要获取有关当今世界最热门话题——新冠肺炎病毒或冠状病毒——的所有信息，您可以在上述函数的“query”参数中指定。</p><p id="5bea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上述函数中的“from_param”参数和“to”参数是日期参数。它会要求您指定希望获得搜索查询结果的时间范围。因为我提到过，我想获得30天的所有结果，这是免费版本允许的最大时间范围，我将指定from_param为今天的日期前30天。然而，我需要在一个循环中写这个，这样我可以确保我每天都得到。</p><p id="fbda" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以，我首先构建了一个日期函数来帮助我。</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="f4e1" class="me mf iq ma b gy mg mh l mi mj">import datetime<br/>from datetime import datetime, timedelta<br/>def date(base):    <br/>    date_list=[]    <br/>    yr=datetime.today().year    <br/>    if (yr%400)==0 or ((yr%100!=0) and (yr%4==0)):          <br/>        numdays=366        <br/>        date_list.append([base - timedelta(days=x) for x in    <br/>        range(366)])   <br/>    else:        <br/>        numdays=365        <br/>        date_list.append([base - timedelta(days=x) for x in    <br/>        range(365)])    <br/>        newlist=[]    <br/>        for i in date_list:        <br/>           for j in sorted(i):            <br/>               newlist.append(j)    <br/>        return newlist <br/>def last_30(base):     <br/>    date_list=[base - timedelta(days=x) for x in range(30)]      <br/>    return sorted(date_list)  <br/>def from_dt(x):    <br/>    from_dt=[]    <br/>    for i in range(len(x)):          <br/>        from_dt.append(last_30(datetime.today())[i-1].date())         <br/>    return from_dt        <br/>def to_dt(x):    <br/>    to_dt=[]    <br/>    for i in range(len(x)):        <br/>        to_dt.append(last_30(datetime.today())[i].date())    <br/>    return to_dt<br/>from_list=from_dt(last_30(datetime.today()))<br/>to_list=to_dt(last_30(datetime.today()))</span></pre><p id="6b47" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我构建的第一个日期函数(date)是一个更通用的日期函数，如果需要的话，我想在很长的时间内使用它。我正在使用first date函数获取所有日期的列表。我只需要30天，所以我确保使用last_30来完成。这将给我从当前日期和时间开始的过去30天的列表。继续讨论from_dt函数，它专门用于上面提到的get_everything函数的from_param。这是您需要所有新闻文章的时间范围的开始，to_dt是结束日期。</p><p id="7fec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我现在有两个单独的列表，分别是开始日期和结束日期。</p><p id="20d3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们将处理查询参数，它是get_everything函数的搜索词。</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="af68" class="me mf iq ma b gy mg mh l mi mj">def func(query): <br/>    newd={}    <br/>    newdf=pd.DataFrame()    <br/>    for (from_dt,to_dt) in zip(from_list,to_list):           <br/>        all_articles =   <br/>        newsapi.get_everything(q=query,language='en',<br/>        sort_by='relevancy',from_param=from_dt,to=to_dt)          <br/>        d=json_normalize(all_articles['articles'])         <br/>        newdf=d[["url","publishedAt","source.name","author"]]<br/>        dic=newdf.set_index(["source.name","publishedAt","author"]) <br/>        ["url"].to_dict()        <br/>        for (k,v) in dic.items():            <br/>            page = requests.get(v)            <br/>            html = page.content            <br/>            soup = BeautifulSoup(html, "lxml")            <br/>            text = soup.get_text()            <br/>            d2=soup.find_all("p")            <br/>            newd[k]=re.sub(r'&lt;.+?&gt;',r'',str(d2))     <br/>    return newd</span></pre><p id="64ef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">遍历日期的from和to列表的压缩版本，我们得到了30天时间范围内的所有文章的列表。我选择循环的原因是，这样我就可以对每一天进行分析。然后我将它存储在数据框中。然后，我获取相关的列，并将它们存储回字典中。我想解析新闻URL中的内容，以便只从文章中获取内容。我在这里使用Python中的BeautifulSoup包来解析内容，并获取信息所在的相关<p>标签。因为我们在这里主要关注文本数据，所以我们需要这些段落标签之间的信息。你可以在这里找到更多关于BeautifulSoup的信息:</p></p><div class="ln lo gp gr lp lq"><a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd ir gy z fp lv fr fs lw fu fw ip bi translated">美丽的汤文档—美丽的汤4.9.0文档</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">Beautiful Soup是一个Python库，用于从HTML和XML文件中提取数据。它与您最喜欢的解析器一起工作…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">www.crummy.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz kl lq"/></div></div></a></div><p id="ac64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦我们有了更清晰的数据，我们现在就可以继续使用单词云来分析模式。</p><p id="d321" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi ml translated"><span class="l mm mn mo bm mp mq mr ms mt di">N</span>T3】使用WordCloud进行ews分析</p><p id="ae3c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，我们来看看单词云。我们可以从新闻中理解数据的部分。有哪些常见的模式？</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="c80b" class="me mf iq ma b gy mg mh l mi mj">def wordcld(dictionary):        <br/>    newd={}    <br/>    for (k,v) in dictionary.items():        <br/>    if v!='[]':            <br/>        wordcloud = WordCloud().generate(str(dictionary[k]))                <br/>        fig, axes= plt.subplots(figsize=(20,12),clear=True)                     <br/>        plt.imshow(wordcloud, interpolation='bilinear')            <br/>        plt.show()                 <br/>    else:            <br/>        print(str(k[0])+"_"+str(k[1][5:10])+"_"+str(k[1][11:13])              <br/>        +"_"+str(k[1][14:16]) +"_"+str(k[1][17:19])+"_"+str(k[2]))             <br/>        print("Wordcloud Not applicable")<br/>dic=func("Indian Economy")<br/>wordcld(dic)</span></pre><p id="81e2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我在搜索一些关于印度经济的常用词，得到了下面的图片。我得到的图像是一天。我上面的代码会给你30天的结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/458736958c4d186ec4b832d5ad8f1e80.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*Z4sXkWHd66EQbQbHKNg2XQ.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">图片来源:作者</p></figure><p id="03c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">试试这个，如果你有任何问题，请随时告诉我。</p><p id="d7c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下一步，您可以使用Twilio API/SendGrid电子邮件API将此作为文本消息/电子邮件通知发送给自己，我将在另一个教程中介绍，或者您可以看到一些现有的API，如下所示:</p><div class="ln lo gp gr lp lq"><a href="https://medium.com/@osaimola/creating-a-serverless-sms-twitter-app-with-aws-lambda-twilio-b33f63254cbb" rel="noopener follow" target="_blank"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd ir gy z fp lv fr fs lw fu fw ip bi translated">用AWS Lambda &amp; Twilio创建一个无服务器的SMS-Twitter应用程序</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">我们将使用AWS Lambda函数来创建Tweets，并通过SMS向/从Twilio发送Twitter事件通知…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">medium.com</p></div></div><div class="mu l"><div class="nb l mw mx my mu mz kl lq"/></div></div></a></div><div class="ln lo gp gr lp lq"><a href="https://sendgrid.com/docs/for-developers/sending-email/v3-python-code-example/" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd ir gy z fp lv fr fs lw fu fw ip bi translated">v3 API Python代码示例</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">让我们知道我们做得怎么样！请评价此页面:如果您需要Twilio SendGrid的即时帮助，请…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">sendgrid.com</p></div></div><div class="mu l"><div class="nc l mw mx my mu mz kl lq"/></div></div></a></div><p id="1436" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">总结一下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/7e20015a13e58eb2207d813e7e3752a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*bAGIskyzM000mqn9J7qcAg.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">图片来源:作者</p></figure><p id="060d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你有任何问题，欢迎在这里评论或者给我发邮件。你也可以在GitHub上看到这段代码:<a class="ae ne" href="https://github.com/mukund14/News/tree/news_api_Python" rel="noopener ugc nofollow" target="_blank">https://github.com/mukund14/News/tree/news_api_Python</a></p><p id="14dd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">mukundan.sankar14@gmail.com</p></div></div>    
</body>
</html>