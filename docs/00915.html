<html>
<head>
<title>Automating MXNet build using Bash scripting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Bash 脚本自动构建 MXNet</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automating-mxnet-build-using-bash-scripting-10d822a31637?source=collection_archive---------28-----------------------#2020-01-26">https://towardsdatascience.com/automating-mxnet-build-using-bash-scripting-10d822a31637?source=collection_archive---------28-----------------------#2020-01-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/94fb1eff574473fc555e4c15eefa7a94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_1-wvDS_UqnjJdWt"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae jg" href="https://unsplash.com/@franckinjapan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Franck V. </a>拍摄的照片</p></figure><div class=""/><div class=""><h2 id="97e6" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">为发布软件而构建二进制文件是非常辛苦的。但是使用 Bash 脚本的自动化证明是非常值得的！</h2></div><p id="1a0a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为测试 Apache MXNet 的一部分，我被委托为 Apache MXNet 内部分支构建二进制文件。</p><p id="14f8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在构建和测试 MXNet 二进制文件时，我必须运行无数步骤。此外，该管道必须复制 8 次，以符合 Apache MXNet 支持的各种风格，如 CPU/GPU、+/- MKL 和+/-大张量(2 =8)</p><p id="4309" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这项工作时间紧迫，同时也是重复的。需要按顺序执行某一组步骤。此外，它必须在多台机器上通过微小的调整进行复制。所有这些都需要自动化。</p><blockquote class="lw"><p id="f446" class="lx ly jj bd lz ma mb mc md me mf lt dk translated">任何写了两遍以上的东西都可以而且应该自动化。</p></blockquote><p id="c127" class="pw-post-body-paragraph ky kz jj la b lb mg kk ld le mh kn lg lh mi lj lk ll mj ln lo lp mk lr ls lt im bi translated">Bash (shell 脚本)是完成这项任务的理想选择。由于之前没有什么经验，我热衷于实时应用它。这里尝试捕捉我在这个过程中遇到的与 shell 脚本相关的概念。</p><blockquote class="lw"><p id="ce18" class="lx ly jj bd lz ma mb mc md me mf lt dk translated">#(哈希)+！(砰)= #！(舍邦)</p></blockquote><p id="5ae2" class="pw-post-body-paragraph ky kz jj la b lb mg kk ld le mh kn lg lh mi lj lk ll mj ln lo lp mk lr ls lt im bi translated"><strong class="la jk">从现有 shell 脚本中调用另一个 shell 脚本<br/> </strong>拥有多个 shell 脚本来执行特定任务是一个非常常见的用例(考虑模块化，但在文件级而不是函数级)。由于需要调用另一个脚本，我很快意识到为什么我们需要<code class="fe ml mm mn mo b">shebang</code>。</p><p id="a997" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有了 bash 的许多替代品(zsh，ksh，sh)，在顶部添加一个 shebang 告诉操作系统(是的！OS ftw！)来使用提到的库。程序连同绝对路径(<code class="fe ml mm mn mo b">/usr/bin/env</code>)。如果未指定，操作系统将采用默认设置。</p><p id="270f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">打印/记录</strong></p><p id="5af4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">学习任何语言、测试任何代码、调试任何东西的第一步都是从打印语句开始的:控制台日志记录。打印到标准输出(标准输出)。</p><p id="54aa" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ml mm mn mo b">echo</code></p><p id="89c8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">向 shell 脚本传递参数</strong></p><p id="6997" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ml mm mn mo b">./pip_build_test.sh mkl</code></p><p id="efe6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">给定这个命令，<code class="fe ml mm mn mo b">mkl</code>是我们需要处理的参数。<br/>在 bash 脚本中使用变量$1、$2 等访问参数<br/> $1 是第一个参数(当然是在命令之后):<strong class="la jk"> mkl </strong></p><p id="3178" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一种传递参数的方法叫做<strong class="la jk"> Flags 方法</strong>，在这篇<a class="ae jg" href="https://www.lifewire.com/pass-arguments-to-bash-script-2200571" rel="noopener ugc nofollow" target="_blank"> livewire </a>文章中有很好的解释。</p><p id="6278" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">担心暴露凭据？</strong></p><p id="8fc8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">git 命令之一(针对托管在<a class="ae jg" href="https://aws.amazon.com/codecommit/" rel="noopener ugc nofollow" target="_blank"> AWS 代码提交</a>上的存储库)需要用户名和密码。</p><p id="f1f1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ml mm mn mo b">git clone <a class="ae jg" href="https://username:" rel="noopener ugc nofollow" target="_blank">https://username:password@server</a></code></p><p id="7ffe" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然上面提到的方法在谷歌上的顶级搜索是存在的，但它肯定不是最好的方法。</p><blockquote class="lw"><p id="9bd0" class="lx ly jj bd lz ma mb mc md me mf lt dk translated">公开 git(或任何)凭证从来都不是一个好主意。</p></blockquote><p id="263b" class="pw-post-body-paragraph ky kz jj la b lb mg kk ld le mh kn lg lh mi lj lk ll mj ln lo lp mk lr ls lt im bi translated">又快又脏的变通方法？省略用户名和密码，让用户自己在机器上配置。具有讽刺意味的是，这是自动化过程中唯一的手工操作。</p><p id="fe0e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">更好的解决方案？</p><ol class=""><li id="541d" class="mp mq jj la b lb lc le lf lh mr ll ms lp mt lt mu mv mw mx bi translated"><a class="ae jg" href="https://github.com/awslabs/git-secrets" rel="noopener ugc nofollow" target="_blank"> git-secrets </a></li><li id="279d" class="mp mq jj la b lb my le mz lh na ll nb lp nc lt mu mv mw mx bi translated"><a class="ae jg" href="https://aws.amazon.com/secrets-manager/" rel="noopener ugc nofollow" target="_blank"> AWS 秘密管理器</a> / <a class="ae jg" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_ssh-keys.html" rel="noopener ugc nofollow" target="_blank"> SSH 密钥</a></li><li id="f625" class="mp mq jj la b lb my le mz lh na ll nb lp nc lt mu mv mw mx bi translated">环境变量！</li></ol><p id="6f8e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">将命令输出存储到变量中</strong></p><p id="58a6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有时，我们需要将命令的结果存储在一个变量中以备将来使用。可以使用<code class="fe ml mm mn mo b">var=$(command)</code>来实现</p><p id="1927" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">条件句</strong></p><p id="c601" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这让我们回到了阿尔戈尔！<code class="fe ml mm mn mo b">if</code>、<code class="fe ml mm mn mo b">else</code>得到其次是<code class="fe ml mm mn mo b">fi</code>、<br/>镜像词的使用，得益于<a class="ae jg" href="https://stackoverflow.com/questions/6310008/what-language-uses-fi" rel="noopener ugc nofollow" target="_blank">斯蒂芬伯恩、</a>被从 Algol 移植到 Unix Shell 脚本语言。</p><pre class="nd ne nf ng gt nh mo ni nj aw nk bi"><span id="dddd" class="nl nm jj mo b gy nn no l np nq">if [[ condition ]]<br/>then<br/>    echo "yes"<br/>else<br/>    echo "no"</span></pre><p id="7622" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">条件可以利用各种标志。例如，少数条件表达式- <br/> <code class="fe ml mm mn mo b">-d</code>:搜索目录<br/> <code class="fe ml mm mn mo b">-f</code>:搜索文件<br/> <code class="fe ml mm mn mo b">-z</code>:如果字符串长度为零，则返回 True</p><p id="1b3e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">关于进一步的细节<code class="fe ml mm mn mo b">man bash</code>命令。</p><p id="f5a3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">旁注</strong> : <em class="nr">测试 vs 扩展测试</em>辩论。<br/> <code class="fe ml mm mn mo b">[]</code> vs <code class="fe ml mm mn mo b">[[]]</code>:跟双<code class="fe ml mm mn mo b">[[</code>走。它有增强功能。为什么？<a class="ae jg" href="https://stackoverflow.com/questions/3427872/whats-the-difference-between-and-in-bash" rel="noopener ugc nofollow" target="_blank">改为</a>。</p><p id="c917" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">将用户输入读入变量</strong></p><p id="56e1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，通过允许用户输入一个可以存储在变量中的值(也是为了将来使用)，可以实现灵活性。<br/>T3】</p><p id="6cfa" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将可用性提高一个档次，我们可以允许用户使用<br/> <code class="fe ml mm mn mo b">read -p “Continue? (Y/N): “ confirm &amp;&amp; [[ $confirm == [yY] || $confirm == [yY][eE][sS] ]] || exit 1</code>来确认</p><p id="6648" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">安全第一。终于。</p><p id="dc47" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢<a class="lu lv ep" href="https://medium.com/u/7e46baf4a1e0?source=post_page-----10d822a31637--------------------------------" rel="noopener" target="_blank">佩德罗·拉罗伊</a>指出 2 个方便的细节。<br/>首先要做的事情。为了使 bash 脚本安全，使用<code class="fe ml mm mn mo b">set -euxo pipefail</code>很重要。否则，bash 脚本中的错误将不会被发现，因为脚本将总是返回 true。其次，尽可能使用 Python 而不是 Bash。</p><p id="2072" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为什么你会问？去阅读这篇关于<a class="ae jg" href="https://sipb.mit.edu/doc/safe-shell/" rel="noopener ugc nofollow" target="_blank">编写安全 Shell 脚本</a>的文章。</p><h2 id="b612" class="nl nm jj bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">将脚本转换成可执行文件</h2><p id="c5ac" class="pw-post-body-paragraph ky kz jj la b lb oj kk ld le ok kn lg lh ol lj lk ll om ln lo lp on lr ls lt im bi translated">说了这么多，做了这么多，还有最后一件事:将一个<code class="fe ml mm mn mo b">.sh</code>文件转换成一个可执行的<code class="fe ml mm mn mo b">.sh</code>脚本</p><p id="143b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ml mm mn mo b">chmod u+x &lt;name of the file&gt;.sh</code></p><p id="029f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，你可以选择其他权限来代替<code class="fe ml mm mn mo b">u</code></p><ul class=""><li id="cdbd" class="mp mq jj la b lb lc le lf lh mr ll ms lp mt lt oo mv mw mx bi translated"><em class="nr"> u </em>代表用户。</li><li id="59d1" class="mp mq jj la b lb my le mz lh na ll nb lp nc lt oo mv mw mx bi translated"><em class="nr"> g </em>代表组。</li><li id="ab41" class="mp mq jj la b lb my le mz lh na ll nb lp nc lt oo mv mw mx bi translated"><em class="nr"> o </em>代表别人。</li><li id="4f6e" class="mp mq jj la b lb my le mz lh na ll nb lp nc lt oo mv mw mx bi translated"><em class="nr"> a </em>代表全部。</li></ul><h2 id="1c93" class="nl nm jj bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated"><strong class="ak">最终外壳脚本</strong></h2><figure class="nd ne nf ng gt iv"><div class="bz fp l di"><div class="op oq l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">pip _ build _ 测试. sh</p></figure><p id="b778" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意:aws-cli 一般可以使用<br/> <code class="fe ml mm mn mo b">sudo apt install awscli</code>安装</p><p id="20ec" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上述使用 awscli-bundle 的过程是旧版本 Ubuntu 14.04 所必需的。(你能相信人们还在用 14.04 吗？老是金！)</p></div><div class="ab cl or os hx ot" role="separator"><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow"/></div><div class="im in io ip iq"><p id="8cc3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这只是我典型的一天工作的一个例子。为 Apache MXNet 做贡献教会了我比在学校里学到的更多的东西。我们欢迎更多这样的贡献在我们的 Github 回购上:【https://github.com/apache/incubator-mxnet/<a class="ae jg" href="https://github.com/apache/incubator-mxnet/" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl or os hx ot" role="separator"><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow"/></div><div class="im in io ip iq"><h2 id="b990" class="nl nm jj bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">资源</h2><div class="is it gp gr iu oy"><a href="https://stackoverflow.com/questions/8967902/why-do-you-need-to-put-bin-bash-at-the-beginning-of-a-script-file" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd jk gy z fp pd fr fs pe fu fw ji bi translated">为什么需要放#！脚本文件开头的/bin/bash？</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">感谢贡献一个堆栈溢出的答案！请务必回答问题。提供详细信息并分享…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">stackoverflow.com</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm ja oy"/></div></div></a></div><div class="is it gp gr iu oy"><a href="https://stackoverflow.com/questions/19951369/how-to-store-grep-command-result-in-some-variable-in-shell" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd jk gy z fp pd fr fs pe fu fw ji bi translated">如何将 grep 命令结果存储在 shell 中的某个变量中</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">感谢贡献一个堆栈溢出的答案！请务必回答问题。提供详细信息并分享…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">stackoverflow.com</p></div></div><div class="ph l"><div class="pn l pj pk pl ph pm ja oy"/></div></div></a></div><div class="is it gp gr iu oy"><a href="https://stackoverflow.com/questions/18544359/how-to-read-user-input-into-a-variable-in-bash" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd jk gy z fp pd fr fs pe fu fw ji bi translated">如何在 Bash 中将用户输入读入一个变量？</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">感谢贡献一个堆栈溢出的答案！请务必回答问题。提供详细信息并分享…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">stackoverflow.com</p></div></div><div class="ph l"><div class="po l pj pk pl ph pm ja oy"/></div></div></a></div><div class="is it gp gr iu oy"><a href="https://stackoverflow.com/questions/46823193/git-pull-clone-with-username-and-password-in-aws-code-commit" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd jk gy z fp pd fr fs pe fu fw ji bi translated">在 AWS 代码提交中使用用户名和密码进行 Git 拉/克隆</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">我需要使用 https url 作为一个命令行命令来执行 git pull。我需要将这个命令集成到 bash 脚本中。但是…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">stackoverflow.com</p></div></div><div class="ph l"><div class="pp l pj pk pl ph pm ja oy"/></div></div></a></div><div class="is it gp gr iu oy"><a href="https://www.tutorialspoint.com/execute_bash_online.php" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd jk gy z fp pd fr fs pe fu fw ji bi translated">在线 Bash 编译器-在线 Bash 编辑器-在线 Bash IDE -在线 Bash 编码-练习 Bash…</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">在线 Bash 编译器，在线 Bash 编辑器，在线 Bash IDE，在线 Bash 编码，在线练习 Bash，执行 Bash…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">www.tutorialspoint.com</p></div></div></div></a></div><p id="9dce" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nr">出于隐私和安全的考虑，剧本的内容有所改动。</em></p></div></div>    
</body>
</html>