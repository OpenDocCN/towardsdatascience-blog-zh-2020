<html>
<head>
<title>How to Collect Data From The New York Times Over Any Period of Time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从《纽约时报》收集任何时期的数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/collecting-data-from-the-new-york-times-over-any-period-of-time-3e365504004?source=collection_archive---------21-----------------------#2020-05-02">https://towardsdatascience.com/collecting-data-from-the-new-york-times-over-any-period-of-time-3e365504004?source=collection_archive---------21-----------------------#2020-05-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="199e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python 中的简单指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/911f405b87384c1b52a0569bc1dc252d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0pQEUVRUWVPwRqaXHPBmlw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://stock.adobe.com/contributor/208385959/jj-gouin?load_type=author&amp;prev_url=detail" rel="noopener ugc nofollow" target="_blank">JJ·古恩</a>，via <a class="ae ky" href="https://stock.adobe.com/contributor/208385959/jj-gouin?load_type=author&amp;prev_url=detail&amp;asset_id=328084627" rel="noopener ugc nofollow" target="_blank"> Adobe Stock </a></p></figure><p id="7532" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们想知道在一段时间内,<em class="lv">《纽约时报》</em>中的话语是如何演变的。这些天来，分析这一点会很有趣，因为每当我们访问头版时，都会被关于冠状病毒的新闻淹没。疫情是如何塑造了美国最受欢迎的报纸之一的头条新闻的？</p><p id="cfce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要回答这样的问题，我们需要从纽约时报收集文章元数据。这里我描述了如何用 Python 来做这件事。</p><p id="d724" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">目录:</strong></p><ol class=""><li id="4a1e" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">在哪里可以找到《纽约时报》的文章元数据</li><li id="e606" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">如何从纽约时报<em class="lv">请求文章元数据</em></li></ol><h1 id="cda8" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">在哪里可以找到《纽约时报》的文章元数据</h1><p id="01b8" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated"><em class="lv">纽约时报</em>提供了一个由几个<a class="ae ky" href="https://developer.nytimes.com/apis" rel="noopener ugc nofollow" target="_blank">API</a>组成的开发者网络，让非员工向他们索取文章和元数据，这对于这种分析来说超级方便。</p><p id="27ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，没有多少报纸这么做。维护一个 API 需要做很多工作。对于不提供 API 的报纸，我们需要一种不同的方法来获得它们的标题。还是有可能的，只是没那么容易。</p><p id="14ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">开始使用<em class="lv">纽约时报</em>API:</strong></p><p id="0d6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里创建一个免费的开发者账户<a class="ae ky" href="https://developer.nytimes.com/get-started" rel="noopener ugc nofollow" target="_blank">。打开验证电子邮件中的链接后登录。进入开发者的主页。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/69294eff6ae1706296b4aba42cd63d3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6i5EW5Dw-aon5fTvl7CP7g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">纽约时报开发者网络的主页。</p></figure><p id="59cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的开发者帐户中注册一个新应用。</p><ol class=""><li id="15c5" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">点击右上角的电子邮件地址。</li><li id="f3d9" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">在出现的下拉菜单中选择<strong class="lb iu">应用</strong>。</li><li id="89ce" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">在您的应用程序页面选择<strong class="lb iu">+新应用程序</strong>。</li><li id="f3d5" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">输入任何名称和描述。</li><li id="359e" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">激活存档 API。</li><li id="18ca" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">选择<strong class="lb iu">创建</strong>。</li></ol><p id="5994" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记下您刚刚注册的应用程序的 API 密钥。这是我们需要从《纽约时报》获取数据的唯一信息，我们很快就会需要它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/965e72c9ddf5caeba0184fd36bc1857b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YG3dlMz2lz23iO_QRl1o5A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您的应用的 API 密钥。</p></figure><h1 id="ba6e" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">如何从纽约时报<em class="nc">请求文章元数据</em></h1><p id="f491" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">我们将使用归档 API 来获取去年的所有文章元数据。这段代码可以在 1851 年到今天的任何时间内修改。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/a55d950d8e19da043595fc6c50aba805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2a-f-oGP7RBW1VRON51M_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://developer.nytimes.com/docs/archive-product/1/overview" rel="noopener ugc nofollow" target="_blank">归档 API 概述</a>。</p></figure><p id="03c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">加载依赖项。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="c004" class="nq ml it nm b gy nr ns l nt nu">import os<br/>import json<br/>import time<br/>import requests<br/>import datetime<br/>import dateutil<br/>import pandas as pd<br/>from dateutil.relativedelta import relativedelta</span></pre><p id="d47d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">指定日期范围。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="5867" class="nq ml it nm b gy nr ns l nt nu">end = datetime.date.today()<br/>start = end - relativedelta(years=1)</span></pre><p id="163a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">列出属于这个范围的月份，即使只是一部分。我们需要这些信息来调用归档 API，因为它一次只能运行一个月。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="f94b" class="nq ml it nm b gy nr ns l nt nu">months_in_range = [x.split(' ') for x in pd.date_range(start, end, freq='MS').strftime("%Y %-m").tolist()]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/5d235c19cc30f158f02d13d43653558c.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*mOaQ8IXibpVQjEvdWkhk1A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd nw">范围内的月份</strong></p></figure><p id="55a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我编写了一些代码来请求和处理来自归档 API 的文章元数据。这段代码一次只能运行一个月，以实现最佳的内存管理。我们向 API 发送给定月份的请求，接收并解析响应，然后用每篇文章的一些详细信息填充数据框，包括其出版日期、主要标题、章节、主题关键字、文档类型和材料类型。最后，我们将数据帧保存为 CSV 文件，并继续下一个月，直到到达所需时间范围的末尾。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从纽约时报存档 API 请求和处理任意时间段的文章数据的代码。</p></figure><p id="f200" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，每个 API 有两个<a class="ae ky" href="https://developer.nytimes.com/faq#a11" rel="noopener ugc nofollow" target="_blank">速率限制</a>:每天 4000 个请求和每分钟 10 个请求。为了避免达到每分钟的速率限制，我们在两次通话之间睡眠 6 秒钟。</p><p id="b2fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要忘记用你的 API 键在第 4 行切换出<strong class="lb iu"> YOUR_API_KEY </strong>。</p><p id="a955" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行代码以获取并处理来自<strong class="lb iu"> months_in_range </strong>的文章。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/986a636b0cd389b5b9c6693b253c4e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2F89_VsfLV_gphugh7r69g.png"/></div></div></figure><p id="facd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经收集了去年 80，460 篇文章的元数据！每个月都被保存到<strong class="lb iu"> headlines </strong>目录下的 CSV 文件中。</p><p id="63b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看我们处理的上个月的响应是什么样子的，它仍然在内存中。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="c39f" class="nq ml it nm b gy nr ns l nt nu">response</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/8235ae2ecbd5fd24414b8aa6e90036ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QydypbUzGqDvhitITvWDLA.png"/></div></div></figure><p id="961b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有很多。文档<a class="ae ky" href="https://developer.nytimes.com/docs/archive-product/1/overview" rel="noopener ugc nofollow" target="_blank">告诉我们那里都有什么。</a></p><p id="592c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看这个月的 CSV 文件是什么样子的。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="fe28" class="nq ml it nm b gy nr ns l nt nu">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/6f7452c3368225e5d1f5962a67ca04ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGUmUU8T5mYBIvBJ0rpCIQ.png"/></div></div></figure><p id="7e11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如在数据框中看到的，偶尔会有一致性问题需要注意。有时一个月的第一天被认为是前一个月的一部分。有时数据会缺失，比如 1978 年 9 月和 10 月，原因是多工会罢工。</p><p id="3e61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以利用我们现在的<strong class="lb iu"> headlines </strong>目录中的所有文章元数据做很多事情。我们可以做的事情之一是探索<em class="lv">《纽约时报》在过去一年的报道中是如何演变的，重点是疫情冠状病毒。这将是有趣的，因为我们不仅考虑发生了什么，而且考虑媒体如何讨论它。</em></p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="e04a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的笔记本是<a class="ae ky" href="https://github.com/brienna/coronavirus-news-analysis/blob/master/2020_05_01_get_data_from_NYT.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="3d46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想阅读更多我的文章或探索数百万篇其他文章，你可以注册一个中级会员:</p><div class="oj ok gp gr ol om"><a href="https://brienna.medium.com/membership" rel="noopener follow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">通过我的推荐链接加入 Medium-briena Herold</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">brienna.medium.com</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa ks om"/></div></div></a></div><p id="1cee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">您还可以订阅我的电子邮件列表，以便在我发布新文章时得到通知:</strong></p><div class="oj ok gp gr ol om"><a href="https://brienna.medium.com/subscribe" rel="noopener follow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">每当布蕾娜·赫罗尔德发表。</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">每当布蕾娜·赫罗尔德发表。通过注册，您将创建一个中型帐户，如果您还没有…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">brienna.medium.com</p></div></div><div class="ov l"><div class="pb l ox oy oz ov pa ks om"/></div></div></a></div><p id="b1bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">你可能会对我的其他一些故事感兴趣:</strong></p><div class="oj ok gp gr ol om"><a rel="noopener follow" target="_blank" href="/how-to-download-twitter-friends-or-followers-for-free-b9d5ac23812"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">如何免费下载 Twitter 好友或关注者</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">Python 中的简单指南</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">towardsdatascience.com</p></div></div><div class="ov l"><div class="pc l ox oy oz ov pa ks om"/></div></div></a></div><div class="oj ok gp gr ol om"><a rel="noopener follow" target="_blank" href="/zonked-on-vicodin-in-the-presidential-race-generating-fake-headlines-with-markov-chains-87f06cccd866"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">总统竞选中服用维柯丁:用马尔可夫链制造假头条</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">在讽刺和现实之间游走</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">towardsdatascience.com</p></div></div><div class="ov l"><div class="pd l ox oy oz ov pa ks om"/></div></div></a></div><div class="oj ok gp gr ol om"><a rel="noopener follow" target="_blank" href="/how-to-bulk-access-arxiv-full-text-preprints-58026e19e8ef"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">如何批量获取 arXiv 全文预印本</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">使用 Python3 和 MacOS X 命令行</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">towardsdatascience.com</p></div></div><div class="ov l"><div class="pe l ox oy oz ov pa ks om"/></div></div></a></div></div></div>    
</body>
</html>