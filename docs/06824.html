<html>
<head>
<title>EDA: Visualization in Geopandas, Matplotlib &amp; Bokeh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">EDA:geo pandas、Matplotlib 和 Bokeh 中的可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/eda-visualization-in-geopandas-matplotlib-bokeh-9bf93e6469ec?source=collection_archive---------54-----------------------#2020-05-27">https://towardsdatascience.com/eda-visualization-in-geopandas-matplotlib-bokeh-9bf93e6469ec?source=collection_archive---------54-----------------------#2020-05-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d3445b1da02166f585e1e093435103b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WRSkohctHIScBa9vJ9JyHg.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">来自 tdwi.org<a class="ae kf" href="https://tdwi.org/articles/2019/03/26/adv-all-analytics-at-the-edge.aspx" rel="noopener ugc nofollow" target="_blank">的詹姆斯·鲍威尔</a></p></figure><p id="90e5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如今，每个人都沉浸在来自新闻来源、手机、笔记本电脑、工作场所等等的大量数据中。数据传递来自不同数据变量的大量信息，如日期、字符串、数字和地理格式。如何从庞大的数据集里有效地抓住核心价值，并让用户容易解读？答案是探索性数据分析(EDA)。EDA 是一种可视化和分析数据的工具，可以从数据集中提取洞察力。观众能够从通过 EDA 过程总结的重要特征中更好地理解数据集。</p><p id="5a80" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，您将了解到:</p><p id="5778" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(1)带有 Geopandas 和 Bokeh 的动态地理图</p><p id="91d8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(2)对 2016 年至 2019 年全球数据集的分析</p><p id="0e4c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(Matplotlib 和 Bokeh 中的可视化</p><h1 id="946b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">动态 choropleth 图</h1><p id="d11e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">Choropleth 地图提供了地理区域(即国家)的各种模式和符号，很好地展示了跨区域的测量结果。为了绘制全球幸福地图，我们将关注全球幸福状况调查，该调查根据 155 个国家的幸福水平进行排名，在联合国<strong class="ki iu"> <em class="mh">发布。</em></strong>ka ggle 网站链接:<a class="ae kf" href="https://www.kaggle.com/unsdsn/world-happiness?select=2019.csv" rel="noopener ugc nofollow" target="_blank">世界幸福报告</a>。情节的创建使用了 Python 库和包——Pandas、Geopandas 和 Bokeh。</p><h2 id="2245" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">下载世界地图文件</h2><p id="82a7" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">要渲染世界地图，需要有一个带有世界坐标的 shapefile。<a class="ae kf" href="https://www.naturalearthdata.com/" rel="noopener ugc nofollow" target="_blank"> Natural Earth </a>是下载地理空间数据的绝佳来源，其中充满了各种公共领域地图数据集。对于动态地理图的生成，<a class="ae kf" href="https://www.naturalearthdata.com/downloads/110m-cultural-vectors/" rel="noopener ugc nofollow" target="_blank">1–110m 小比例尺数据</a>是一个很好的地图数据集。</p><h2 id="d130" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">将 shp 文件转换为 Geopandas 数据帧</h2><p id="66a5" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">Geopandas 可以通过<code class="fe mu mv mw mx b">read_file</code>函数将 ESRI shapefile 转换为 GeoDataframe 对象。使用返回地理数据框架对象的<code class="fe mu mv mw mx b">read_file</code>命令，Geopandas 可以读取几乎任何基于矢量的空间数据格式，包括 ESRI shapefile。您可以在使用 geopands 函数读取数据集时指定列。</p><figure class="my mz na nb gt ju"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">地理数据框架的代码片段</p></figure><h2 id="81b3" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">2015 年静态 choropleth 地图</h2><p id="122f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">首先，我们创建一个世界幸福报告的数据框架，并指定 2015 年。然后，可以将生成的数据框 df_2015 合并到地理数据框 gdf 中。为了以后使用散景创建可视化，我们需要 geojson 格式的数据作为绘图源。要素集合包含 GeoJSON 数据中的点、线和面。所以我们把数据帧转换成 JSON，转换成类字符串对象。</p><p id="0610" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">合并后的文件是一个 GeoDataframe 对象，可以使用 geopandas 模块进行渲染。然而，由于我们想加入数据可视化的交互性，我们将使用散景库。散景使用 GeoJSON 格式，用 JSON 表示地理要素。GeoJSON 将点、线和多边形(在散景中称为面片)描述为要素的集合。因此，我们将合并后的文件转换为 GeoJSON 格式。</p><figure class="my mz na nb gt ju"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">Json 数据的代码片段</p></figure><p id="f020" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们准备用散景模块创建一个静态 choropleth 映射。我们首先用<code class="fe mu mv mw mx b">GeoJSONDataSource</code>包读入 geojson 数据。接下来，我们将调色板指定为“YlGnBu ”,并颠倒颜色顺序以匹配最高幸福分数的最暗颜色。然后，我们为颜色条应用自定义刻度标签。对于颜色条，我们将颜色映射器、方向和标记标签映射到颜色条包中。</p><figure class="my mz na nb gt ju"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">choropleth 映射的代码段</p></figure><p id="d71a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们使用指定的地块高度和宽度创建图形对象。然后，我们用 x 和 y 坐标为图形添加补丁，并在 fill_colors 参数中指定字段和转换列。要在 Jupyter 笔记本中显示散景图，我们需要放入 output_notebook()模块，并让图形显示在 show()模块中。</p><figure class="my mz na nb gt ju"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">choropleth 映射的代码段</p></figure><h2 id="9ca8" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">分析:</h2><p id="d7ec" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">从下图中，我们看到加拿大、墨西哥和澳大利亚等国家的幸福指数更高。对于南美和欧洲国家，总得分分布在指数 5 和 6 附近。相比之下，尼日尔、乍得、马里和贝宁等非洲国家的幸福指数要低得多。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/049e701f77228cef15fbec26a70e160e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VdRmfbmwOApeKhHqygMrCg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">图 1:2015 年静态 choropleth 图</p></figure><h2 id="dbc3" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">2015 年至 2019 年交互式 choropleth 地图</h2><p id="7224" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">交互式 choropleth 地图增加了两个部分。一个是悬停工具的创建。我们为图表上显示的信息指定列。另一个是回调函数的创建。对于绘图交互，我们通过滑块指定年份来更新数据。我们将滑块值传递给回调函数，并调整数据。然后，我们将 slider 对象传递给 bokeh 列类中的 widgetbox 参数。最后，我们添加了<code class="fe mu mv mw mx b">curdoc</code>类来创建交互式 web 应用程序，该应用程序可以将前端 UI 事件连接到真实的、正在运行的 Python 代码。</p><figure class="my mz na nb gt ju"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">choropleth 映射的代码段</p></figure><p id="3446" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于那些在 Jupyter 笔记本中运行 choropleth 地图出错的人来说，有一个在终端中运行脚本的替代方法。</p><pre class="my mz na nb gt nf mx ng nh aw ni bi"><span id="6018" class="mi lf it mx b gy nj nk l nl nm">bokeh serve --show EDA_Plot.py</span></pre><figure class="my mz na nb gt ju"><div class="bz fp l di"><div class="nn nd l"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">互动 choropleth 地图视频</p></figure><h1 id="1a24" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">2015 年至 2019 年世界幸福报告的分析图</h1><h2 id="382a" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">2016 年 GDP 与幸福指数散点图</h2><figure class="my mz na nb gt ju"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">散点图的代码片段</p></figure><h2 id="688c" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">分析:</h2><p id="1f4c" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们研究了 2016 年 GDP 增长和幸福水平得分的相关性。由于这些国家按地区进行了颜色编码，我们可以看到东南部国家的 GDP 增长较低，其次是潜在的幸福得分。大多数中欧和东欧国家的 GDP 增长率在 0.8 到 1.4 之间，幸福指数在 5 到 6 之间。对于西欧地区来说，它们往往显示出较高的经济增长幅度和幸福指数。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/e567e31b9f387927273779ae73ed084b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RbABOEHHMXSUbT5WoExiEg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">图 2:2016 年 GDP 与幸福指数散点图</p></figure><h2 id="b067" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">经济指数排名前 10 位和后 10 位的国家(人均 GDP)</h2><figure class="my mz na nb gt ju"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h2 id="e432" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">分析:</h2><p id="414b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">对于前 10 大经济趋势国家，“阿拉伯联合酋长国”显示出增长趋势，2015 年至 2018 年经济增长 0.68%。缅甸是唯一一个人均 GDP 增长率为 0.41 的亚洲国家。令人惊讶的是，像“马拉维”、“几内亚”、“坦桑尼亚”这样的撒哈拉以南非洲国家是经济呈上升趋势的前 5 名国家。</p><p id="220b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到，经济趋势下降的国家大多在非洲。从 2015 年到 2018 年，像'利比亚'，'也门'，'科威特'，'约旦'，'塞拉利昂'这样的倒数 5 个国家的经济指数较低。其中四个国家位于中东和北非。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/4298f85ece6951abf5170c075a4128d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*alI3YOv5GOevJXKpBkhmvw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">图表 3:经济指数最高和最低的 10 个国家</p></figure><h2 id="791f" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">阿联酋年度 GDP 变化</h2><figure class="my mz na nb gt ju"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h2 id="1d85" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">分析:</h2><p id="ee2e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">看到经济指数(人均 GDP 增长)排名前 10 位和后 10 位的国家，我们密切关注阿拉伯联合酋长国的经济趋势。1980 年，阿联酋出现了 40 年来最大的 GDP 增长值。然而，在 1982 年至 1986 年期间，增长率变成了负数。在未来 10 年，阿联酋的国内生产总值表现出相当稳定的增长，约为 0.1-0.2 个百分点。2009 年，受金融危机的影响，国内生产总值大幅下滑。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/72f569dd1eb62d1c55f75ea3fb717339.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h2X0IHA9vlWHkFaS_KV9Xg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">图 4:阿联酋年度 GDP 变化</p></figure><h2 id="6b03" class="mi lf it bd lg mj mk dn lk ml mm dp lo kr mn mo ls kv mp mq lw kz mr ms ma mt bi translated">总之:</h2><ul class=""><li id="326d" class="nr ns it ki b kj mc kn md kr nt kv nu kz nv ld nw nx ny nz bi translated">要创建 choropleth 地图，geopands 可以将 shp 文件转换为数据框对象。对于可视化的创建，散景与 geopandas 包配合得很好。但是，最好记住，在合并两个数据集时，需要将发货文件中的国家/地区与外包数据进行匹配。</li><li id="b5af" class="nr ns it ki b kj oa kn ob kr oc kv od kz oe ld nw nx ny nz bi translated">Matplotlib 和 Bokeh 是 Python 中可视化工具的两个很好的包。散点图更好地显示了两个变量与数值的相关性。就发散图而言，它更好地显示了数据集的下降和上升趋势。对于 DateTime 格式变量，最好在绘图创建时注意缺少值的 date。线形图显示了时间序列数据的明显趋势。</li></ul></div></div>    
</body>
</html>