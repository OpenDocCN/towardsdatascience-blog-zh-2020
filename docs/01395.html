<html>
<head>
<title>Getting started with giotto-time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">giotto-time入门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-started-with-giotto-time-d9b2088d60ca?source=collection_archive---------25-----------------------#2020-02-07">https://towardsdatascience.com/getting-started-with-giotto-time-d9b2088d60ca?source=collection_archive---------25-----------------------#2020-02-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="10d3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">开始使用giotto-time进行预测的教程，Giotto-time是用于时间序列分析中的机器学习建模的Python库</h2></div><blockquote class="ki kj kk"><p id="95f6" class="kl km kn ko b kp kq ju kr ks kt jx ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">由弗朗切斯科·帕尔马、科林·卡林和<a class="ae li" href="https://medium.com/@lewis.c.tunstall" rel="noopener">路易斯·汤斯顿</a>撰写</p></blockquote></div><div class="ab cl lj lk hx ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="im in io ip iq"><p id="7e2c" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">在许多商业和研究领域，生成准确的时间序列预测是必不可少的。在L2F，我们发现用Python和PyData堆栈生成这些预测的工具有限。虽然像<em class="kn"> statsmodels </em>和脸书的<em class="kn"> Prophet </em>这样的流行库对于某些应用程序来说工作得很好，但它需要一个灵活的框架，允许组合数十个，甚至数百个模型并堆叠数千个功能。</p><p id="4047" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">为此，我们用Python库<em class="kn"> giotto-time </em>开源了我们的时间序列工具。该库是为大规模机器学习应用程序设计的，在这些应用程序中，创建自定义模型非常重要。giotto-time还提供了一个简单的API来自动化特性选择、执行因果关系测试和生成新特性。</p><p id="f126" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">在这篇博文中，我们展示了Python时间序列库<a class="ae li" href="https://github.com/giotto-ai/giotto-time" rel="noopener ugc nofollow" target="_blank"> giotto-time </a>的一些功能。随附的笔记本可在<a class="ae li" href="https://github.com/giotto-ai/time_series_energy_demand" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/c3c64df213699dc993cba6347a85fe04.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*CqRigdueGipfVUDI.gif"/></div></figure><h1 id="5d6e" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">数据和问题</h1><p id="f020" class="pw-post-body-paragraph kl km it ko b kp mt ju kr ks mu jx ku lq mv kx ky lr mw lb lc ls mx lf lg lh im bi translated">电在当今社会至关重要。然而，它很难储存，而且价格昂贵。随着可再生能源在能源市场中的重要性日益增加，这一点尤其如此，这使得预测能源需求成为能源供应商的重要任务。</p><p id="f145" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">为了展示giotto-time中可用的功能，我们将重点关注提前21天预测瑞士能源需求的问题。</p><p id="d6a2" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">数据是从瑞士能源传输网运营商Swissgrid下载的，可以在这里找到<a class="ae li" href="https://www.swissgrid.ch/en/home/operation/grid-data/generation.html" rel="noopener ugc nofollow" target="_blank"/>。该图显示了2016年至2019年的日均能源需求。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/0112f16c6c5bd2a3c56177e9ceca0f03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p22MZOrFs4NdesIA3pDjOA.png"/></div></div></figure><h1 id="c83f" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated"><strong class="ak">时间序列库giotto-time </strong></h1><p id="969c" class="pw-post-body-paragraph kl km it ko b kp mt ju kr ks mu jx ku lq mv kx ky lr mw lb lc ls mx lf lg lh im bi translated">giotto-time入门就像跑步一样简单:</p><pre class="lu lv lw lx gt nd ne nf ng aw nh bi"><span id="a37a" class="ni mc it ne b gy nj nk l nl nm">pip install giotto-time</span></pre><p id="f098" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">在以下章节中，我们将介绍giotto-time的四个最重要的特性，这些特性也被用于能源需求建模:</p><ul class=""><li id="6c82" class="nn no it ko b kp kq ks kt lq np lr nq ls nr lh ns nt nu nv bi translated">去趋势和季节性</li><li id="6b3a" class="nn no it ko b kp nw ks nx lq ny lr nz ls oa lh ns nt nu nv bi translated">因果关系测试</li><li id="412f" class="nn no it ko b kp nw ks nx lq ny lr nz ls oa lh ns nt nu nv bi translated">特征创建</li><li id="367d" class="nn no it ko b kp nw ks nx lq ny lr nz ls oa lh ns nt nu nv bi translated">预测</li></ul><p id="8e6e" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">该库旨在充分利用熊猫强大的时间序列和日期功能。特别是，giotto-time中的中心对象是一个pandas数据帧，每个特性的时间戳和列都有一个<code class="fe ob oc od ne b">DateTimeIndex</code>。</p><p id="722b" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">该库的另一个重要方面是与scikit-learn的紧密集成。这使得能够一致地使用流行的机器学习框架的<code class="fe ob oc od ne b">fit</code>、<code class="fe ob oc od ne b">predict</code>和<code class="fe ob oc od ne b">transform</code>范例。</p><h1 id="a342" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated"><strong class="ak"> 1)去趋势化和季节性</strong></h1><p id="b701" class="pw-post-body-paragraph kl km it ko b kp mt ju kr ks mu jx ku lq mv kx ky lr mw lb lc ls mx lf lg lh im bi translated">giotto-time管道的第一步是对时间序列中的潜在趋势和季节性进行建模。giotto-time中的<code class="fe ob oc od ne b">Detrender</code>可以通过选择多项式或指数模型来实现这一点。然后简单地在时间序列上调用<code class="fe ob oc od ne b">fit_transform</code>将会移除趋势，如下面的代码片段所示。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="oe of l"/></div><p class="og oh gj gh gi oi oj bd b be z dk translated">如何用giotto-time去除趋势</p></figure><p id="f099" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">为了对季节性进行编码，例如夏季和冬季或每周的季节性，可以拟合一个具有适当相移的正弦波，如下例所示。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi ok"><img src="../Images/3a96c34aef9adf12687ec50e9eca5e7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gl5_P3WQoze45tHt.png"/></div></div></figure><p id="6cf6" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">这可以通过以下方式完成:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="oe of l"/></div><p class="og oh gj gh gi oi oj bd b be z dk translated">如何添加周期性季节性特征</p></figure><h1 id="6a84" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated"><strong class="ak"> 2)因果关系测试</strong></h1><p id="b940" class="pw-post-body-paragraph kl km it ko b kp mt ju kr ks mu jx ku lq mv kx ky lr mw lb lc ls mx lf lg lh im bi translated">评估因果关系是时间序列分析中最有争议的话题之一，通常需要特别的分析。由于要考虑的数据量和外部因素，这通常是不可能的。在giotto-time中，我们提供了一种方法来自动化这一过程，同时保持特别方法的统计严密性。</p><blockquote class="ol"><p id="26bf" class="om on it bd oo op oq or os ot ou lh dk translated">相关性并不意味着因果关系。但是，如果在统计上有意义，它可能是预测框架中一个有用的特征</p></blockquote><p id="7e3e" class="pw-post-body-paragraph kl km it ko b kp ov ju kr ks ow jx ku lq ox kx ky lr oy lb lc ls oz lf lg lh im bi translated"><code class="fe ob oc od ne b">ShiftedLinearCoefficient</code>类找到目标时间序列与任何特征时间序列最相关的最佳滞后。一旦发现偏移，就进行统计测试以评估相关性的显著性。最后，通过变换方法，所有的特征时间序列自动向前移动，以使它们与目标时间序列在最佳滞后处对齐。这样，输出就可以用于预测了！</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="pa of l"/></div><p class="og oh gj gh gi oi oj bd b be z dk translated">数据科学家首次使用Giotto</p></figure><p id="327b" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">可以使用线性拟合或皮尔逊相关系数。可以进行自举检验或排列检验来评估显著性。在下面的代码示例中，您可以看到这在实践中是如何实现的。最后，我们可以通过简单地使用<code class="fe ob oc od ne b">transform</code>方法来移动数据框中的列。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="oe of l"/></div><p class="og oh gj gh gi oi oj bd b be z dk translated">如何进行因果关系检验并转换时间序列</p></figure><h1 id="144d" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated"><strong class="ak"> 3)特征创建</strong></h1><p id="4967" class="pw-post-body-paragraph kl km it ko b kp mt ju kr ks mu jx ku lq mv kx ky lr mw lb lc ls mx lf lg lh im bi translated">可以说，该库最重要的功能之一是特征创建步骤。</p><p id="04a4" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">以下功能可用:</p><ul class=""><li id="42a6" class="nn no it ko b kp kq ks kt lq np lr nq ls nr lh ns nt nu nv bi translated">移位特征:用于将时间序列移位给定的步数</li><li id="a356" class="nn no it ko b kp nw ks nx lq ny lr nz ls oa lh ns nt nu nv bi translated">移动平均:对于给定的窗口大小</li><li id="3d56" class="nn no it ko b kp nw ks nx lq ny lr nz ls oa lh ns nt nu nv bi translated">常量特征:所有时间步长的常量值</li><li id="63b5" class="nn no it ko b kp nw ks nx lq ny lr nz ls oa lh ns nt nu nv bi translated">多项式特征:对于给定的次数</li><li id="dd11" class="nn no it ko b kp nw ks nx lq ny lr nz ls oa lh ns nt nu nv bi translated">外生特性:可以添加另一个时间序列</li><li id="bf08" class="nn no it ko b kp nw ks nx lq ny lr nz ls oa lh ns nt nu nv bi translated">日历功能:给定国家的公共假日</li><li id="dbb0" class="nn no it ko b kp nw ks nx lq ny lr nz ls oa lh ns nt nu nv bi translated">周期性季节性特征:可用于创建具有给定起始日期和特定周期的正弦波</li><li id="51a1" class="nn no it ko b kp nw ks nx lq ny lr nz ls oa lh ns nt nu nv bi translated">自定义功能:在这里使用您自己的功能</li></ul><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="oe of l"/></div><p class="og oh gj gh gi oi oj bd b be z dk translated">如何创建特征</p></figure><p id="2749" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">一旦创建了特征，我们需要分割<code class="fe ob oc od ne b">X</code>和<code class="fe ob oc od ne b">y</code>数据框。特别是，我们必须定义一个时间范围，该时间范围对应于我们希望预测的时间步数。对于能源需求示例，这是21天，导致数据框有21列，y测试值的右下三角形中有<code class="fe ob oc od ne b">NaN</code>值。这是因为那里没有已知值。标签创建是使用以下转换器完成的:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="oe of l"/></div><p class="og oh gj gh gi oi oj bd b be z dk translated">如何创建标签</p></figure><p id="f0f4" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">下图显示了一个示例。第一列对应于向前看一个时间步，第二列对应于向前看两个时间步，以此类推。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi pb"><img src="../Images/fd3d904f549144d5f2cf2ea5c3305522.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PQPWvSkuHn-u_vJy.png"/></div></div></figure><h1 id="94c7" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated"><strong class="ak"> 4)预测</strong></h1><p id="86c0" class="pw-post-body-paragraph kl km it ko b kp mt ju kr ks mu jx ku lq mv kx ky lr mw lb lc ls mx lf lg lh im bi translated">目前，giotto-time支持两种类型的模型:</p><ul class=""><li id="153a" class="nn no it ko b kp kq ks kt lq np lr nq ls nr lh ns nt nu nv bi translated">带/不带前馈的广义自回归模型(分别简称为<code class="fe ob oc od ne b">GARFF</code> <em class="kn"> </em>或<em class="kn"> </em> <code class="fe ob oc od ne b">GAR</code> <em class="kn"> </em></li><li id="4e62" class="nn no it ko b kp nw ks nx lq ny lr nz ls oa lh ns nt nu nv bi translated">具有自定义损失函数的线性回归模型</li></ul><p id="1848" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated"><code class="fe ob oc od ne b">GARFF</code>模型可以选择任何scikit-learn兼容的回归器或分类器，并使用它对时间序列进行预测。在这种情况下，前馈意味着除了特征之外，模型还会进行一次预测，并将这些预测添加到数据框中，然后使用这个新的数据框进行下一个时间步长的预测，依此类推。</p><p id="ef41" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">下面的代码片段显示了如何使用线性回归器作为基础模型来轻松创建这样的模型。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="oe of l"/></div><p class="og oh gj gh gi oi oj bd b be z dk translated">如何使用GARFF模型</p></figure><p id="961c" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">另一种可能性是使用giotto-time自己的线性回归器，它允许优化自定义损失函数。在下面的例子中，使用了最大误差。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="oe of l"/></div><p class="og oh gj gh gi oi oj bd b be z dk translated">如何使用带有自定义损失函数的线性回归</p></figure><p id="e305" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">它们都使用了scikit-learn中您可能熟悉的<code class="fe ob oc od ne b">fit</code> / <code class="fe ob oc od ne b">predict</code>方法。</p><h1 id="2322" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated"><strong class="ak">结果</strong></h1><p id="a495" class="pw-post-body-paragraph kl km it ko b kp mt ju kr ks mu jx ku lq mv kx ky lr mw lb lc ls mx lf lg lh im bi translated">在这篇博文附带的笔记本<a class="ae li" href="https://github.com/giotto-ai/time_series_energy_demand" rel="noopener ugc nofollow" target="_blank">中，我们使用这些函数来预测瑞士未来21天的日均能源需求。</a></p><p id="b868" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">在下图中，相对于平均绝对误差，最佳模型的结果与参考值一起绘制。我们可以清楚地看到，预测遵循全球趋势以及每周趋势。然而，也有一些异常值。一个例子是8月1日(蓝色曲线的大幅下降)。这是瑞士国庆日，从本文开头的时间序列图中可以看出，2016年至2018年也出现了类似的下降。由于数据中可用的年份很少，我们在模型中包含的日历功能不能完全捕捉到这种影响。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi pc"><img src="../Images/07212b9b760a39153e01d52ed7431044.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zx6Nuq4dzjk7lIdZQxboQQ.png"/></div></div><p class="og oh gj gh gi oi oj bd b be z dk translated">对于1、7、14和21天的时间范围，与最佳模型的相对平均绝对误差分别为4.4%、5.7%、6.7%和6.8%。</p></figure><p id="3429" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">下表概述了经过测试的不同模型以及针对各种指标获得的结果。对于我们在培训中找到的基线模型，设置回顾的理想天数，然后使用这一天的值作为预测。最好的结果用黄色标出。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi pd"><img src="../Images/e813b1b32fa1bb95ac5431d6a94b0434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G3efZQXvGAsO0PRn9S1vyQ.png"/></div></div><p class="og oh gj gh gi oi oj bd b be z dk translated">第1、7、14、21天的结果表(从左到右和从上到下)</p></figure><p id="688c" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">我们观察到，以线性回归作为基础模型的<code class="fe ob oc od ne b">GARFF</code>模型在除最大误差度量之外的所有方面都比其他模型表现得更好。特别是相对平均绝对误差从基线模型中的9.0%提高到线性回归的<code class="fe ob oc od ne b">GARFF</code>模型中的6.8%。对于其他情况，获得了类似的结果。最大误差高度依赖于异常值的存在。如上所述，8月1日是一个例外，因为与其他日子相比，那里的能量需求非常低。</p><h1 id="4940" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated"><strong class="ak">结论</strong></h1><p id="df6c" class="pw-post-body-paragraph kl km it ko b kp mt ju kr ks mu jx ku lq mv kx ky lr mw lb lc ls mx lf lg lh im bi translated">我们介绍了Python时间序列库giotto-time，并用它来预测瑞士的能源需求。介绍了giotto-time的不同功能，如去趋势、因果检验、特征创建，以及不同的模型，如具有前馈的广义自回归模型和具有定制损失函数的线性回归模型。</p><p id="24c4" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku lq kw kx ky lr la lb lc ls le lf lg lh im bi translated">如果你想了解更多关于giotto-time和giotto-tda的信息，你可以在<a class="ae li" href="https://twitter.com/giotto_ai" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae li" href="https://www.linkedin.com/company/l2f-business-topological-modeling/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上关注我们，或者在这里加入我们的Slack频道<a class="ae li" href="https://slack.giotto.ai/" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>