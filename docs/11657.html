<html>
<head>
<title>Python to find Kusto table with data duplication issue</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 找到了带有数据重复问题的 Kusto 表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/use-data-brick-to-verify-azure-explore-kusto-data-duplication-issue-36abd238d582?source=collection_archive---------51-----------------------#2020-08-12">https://towardsdatascience.com/use-data-brick-to-verify-azure-explore-kusto-data-duplication-issue-36abd238d582?source=collection_archive---------51-----------------------#2020-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3636" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Python 与 Kusto 一起寻找重复</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8398cc2267cfd1f374494f4c32641171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wATpVo3eMVFnb2zm"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">约书亚·迈克尔斯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="fb0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Azure Data Explorer ( <strong class="ky ir"> Kusto </strong>)是市场上最专注的关系数据库之一。整个系统运行在固态硬盘和内存中，以提供快速响应的数据分析。作为热路径数据存储，这可能是一个不错的选择。</p><p id="89ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于各种原因，如客户端功能不良、数据管道不完善等。数据可能会多次被输入到 Kusto。这导致了数据重复的问题。如果摄取的数据是<strong class="ky ir">汇总</strong>数据，比如一组商店的总收入等，这个问题可能会更加严重。</p><p id="45a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据重复会搞乱所有后续的数据分析，人们可能会据此做出错误的决定。因此，数据清理/重复数据删除是必要的。在此之前，我们需要首先确认，当前的 Kusto 表是否存在重复问题。</p><p id="c082" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">确认</strong>步骤是本文的重点。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="753a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">主要思想包含以下步骤:</p><ol class=""><li id="893c" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated">连接到 Kusto 集群。</li><li id="5377" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">查询表架构。</li><li id="9527" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">创建每行的唯一标识</li><li id="2bcb" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">对具有相同标识的行进行计数</li><li id="57bb" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">查找任何计数大于 1 的标识值，标记为重复。</li></ol></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="ec1a" class="mn mo iq bd mp mq mr dn ms mt mu dp mv lf mw mx my lj mz na nb ln nc nd ne nf bi translated">连接到 Kusto 集群</h2><p id="ecbe" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">Python 有连接 Kusto 的包:<a class="ae kv" href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/api/python/kusto-python-client-library" rel="noopener ugc nofollow" target="_blank">Azure Data Explorer Python SDK</a>。在这里，我们使用包:azure-kusto-data。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="c4e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的代码片段将允许我们创建 KustoClient。它用于查询 Kusto 集群。在连接到 Kusto 之前，我们需要创建 AppId，并将其注册到 Kusto 集群。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="ca48" class="mn mo iq bd mp mq mr dn ms mt mu dp mv lf mw mx my lj mz na nb ln nc nd ne nf bi translated">查询表模式</h2><p id="bdbf" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated"><strong class="ky ir"> getschema </strong>将返回表模式。KustoClient 将返回表模式作为我们熟悉的 Pandas DataFrame。我们很容易做进一步的加工。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="b9dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">每行的唯一标识</strong></p><p id="ae82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设，该表是一个汇总表。没有可以唯一标识该行的列子集。因此，我们将使用模式中的所有列来创建<strong class="ky ir">标识</strong>。标识将是所有列值的串联。</p><p id="190a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们将使用 tostring()操作符将所有非字符串数据转换为字符串。这就是<strong class="ky ir"> schema.apply( axis = 1) </strong>的目的，其中 axis = 1 将逐行遍历表。</p><p id="6bc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，Kusto 的<strong class="ky ir"> strcat() </strong>将根据 hashOp 定义的操作连接所有的列。</p><p id="f37e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果对于另一个表，我们知道列的子集可以唯一地标识行，例如 user_id 和 order_id 的组合。在这种情况下，我们可以使用第二个 hashKusto 案例。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="b89f" class="mn mo iq bd mp mq mr dn ms mt mu dp mv lf mw mx my lj mz na nb ln nc nd ne nf bi translated">相同标识值计数并查找重复项</h2><p id="4147" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">注意，我们上面创建的 hashKusto 值在 Kusto 查询中用作扩展。这将在 KustoTable 中创建一个额外的列，<strong class="ky ir"> hash </strong>。我们稍后使用 summarize 来获得每个标识散列的计数。</p><p id="fc34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，重复的记录是 recordsCount &gt; 1 的记录。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h1 id="073e" class="nn mo iq bd mp no np nq ms nr ns nt mv jw nu jx my jz nv ka nb kc nw kd ne nx bi translated">带走:</h1><p id="e44f" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">通过使用 Python，我们建立了一种简单直接的方法来验证和识别 Kusto 表中的重复行。这将为后续的数据分析提供坚实的基础。</p></div></div>    
</body>
</html>