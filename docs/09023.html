<html>
<head>
<title>Heatmap Basics with Seaborn</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Seaborn 的热图基础</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/heatmap-basics-with-pythons-seaborn-fb92ea280a6c?source=collection_archive---------0-----------------------#2020-06-29">https://towardsdatascience.com/heatmap-basics-with-pythons-seaborn-fb92ea280a6c?source=collection_archive---------0-----------------------#2020-06-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b2b9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用 Matplotlib 和 Seaborn 创建热图的指南</h2></div><p id="e6e5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个想法很简单，用颜色代替数字。</p><p id="f176" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，这种可视化风格已经从简单的彩色编码表格发展到现在。它被广泛用于地理空间数据。它通常用于描述变量的密度或强度，可视化模式，方差，甚至异常。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/1cd57e1500ca6e492e4545021849e76e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H6kAaFNL1L-r0BzeeZGHTA.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">相关矩阵——谷物样品的成分</p></figure><p id="3f32" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了这么多的应用，这个基本方法值得注意。本文将介绍热图的基础知识，并了解如何使用 Matplotlib 和 Seaborn 创建它们。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cfdd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">亲自动手</h1><p id="c3d5" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">我们将使用熊猫和 Numpy 来帮助我们处理数据争论。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="0137" class="ne md it na b gy nf ng l nh ni">import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import seaborn as sb<br/>import numpy as np</span></pre><p id="f297" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本例中的<a class="ae le" href="https://www.kaggle.com/brunotly/foreign-exchange-rates-per-dollar-20002019" rel="noopener ugc nofollow" target="_blank">数据集</a>是一个对美元汇率的时间序列。</p><p id="e993" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我不想用通常的折线图来表示一段时间内的值，而是想用一个彩色编码的表来显示这些数据，以月份为列，以年份为行。</p><p id="e47d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将尝试绘制折线图和热图，以了解这将是什么样子。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nj"><img src="../Images/2f4deb6d846e7a8131931219aa01b896.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EuGPeHL4OW4-k92HJJEgHw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">用<a class="ae le" href="https://sketchpad.app/" rel="noopener ugc nofollow" target="_blank">画板. app </a>绘制</p></figure><p id="f19a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">折线图在显示数据方面会更有效；比较一个点在直线上的高度比区分颜色更容易。</p><p id="ea6b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">热图将产生更大的影响，因为它们不是显示此类数据的传统方式。它们会失去一些准确性，特别是在这种情况下，因为我们需要在几个月内合计这些值。但总的来说，他们仍然能够显示模式并总结我们数据中的时期。</p><p id="a84b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们<a class="ae le" href="https://medium.com/python-in-plain-english/reading-data-with-pythons-pandas-2715ff925b1d" rel="noopener">读取数据集</a>并根据草图重新排列数据。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="c6c2" class="ne md it na b gy nf ng l nh ni"># read file<br/>df = pd.read_csv('data/Foreign_Exchange_Rates.csv', <br/>                 usecols=[1,7], names=['DATE', 'CAD_USD'], <br/>                 skiprows=1, index_col=0, parse_dates=[0])</span></pre><p id="186b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于这个示例，我们将使用第 1 列和第 7 列，它们是'<em class="nk">时间序列'</em>和'<em class="nk">加拿大—加元/美元'</em>。</p><p id="d8ef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们将这些列重命名为'<em class="nk">DATE '</em>和'<em class="nk">CAD _ USD '，T15，因为我们要传递标题，所以我们也需要跳过第一行。</em></p><p id="95f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还需要解析第一列，所以值是日期时间格式，我们将日期定义为我们的索引。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/114df3dea1361d22fb170c9a3a037b6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:408/format:webp/1*KcmGmFXc8amgmLIee5aasQ.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">数据框。</p></figure><p id="0bc8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们确保所有的值都是数字，并删除空行。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="363d" class="ne md it na b gy nf ng l nh ni">df['CAD_USD'] = pd.to_numeric(df.CAD_USD, errors='coerce')<br/>df.dropna(inplace=True)</span></pre><p id="37db" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要按月汇总这些值。让我们为月和年创建单独的列，然后我们对新列进行分组并获得平均值。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="6e61" class="ne md it na b gy nf ng l nh ni"># create a copy of the dataframe, and add columns for month and year<br/>df_m = df.copy()<br/>df_m['month'] = [i.month for i in df_m.index]<br/>df_m['year'] = [i.year for i in df_m.index]</span><span id="1c50" class="ne md it na b gy nm ng l nh ni"># group by month and year, get the average<br/>df_m = df_m.groupby(['month', 'year']).mean()</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/ceef1d82015302a2a1e007ae8587a7f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*xCSe7Z_3KHy9WJtbzWuNAA.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">前五行分组。</p></figure><p id="7028" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">剩下要做的就是拆分索引，这样我们就有了自己的表。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="fb10" class="ne md it na b gy nf ng l nh ni">df_m = df_m.unstack(level=0)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi no"><img src="../Images/bcb0b9350b1a7b2ea4c46908509d1551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9l8e-nLFo2ov2VaC_0KciA.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">经过整形的数据框。</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="3503" class="ne md it bd me np nq dn mi nr ns dp mm kr nt nu mo kv nv nw mq kz nx ny ms nz bi translated">彩色地图</h2><p id="4a71" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">一切就绪。现在我们可以使用 Seaborn 的<code class="fe oa ob oc na b">.heatmap</code>绘制我们的第一张图表。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="c48a" class="ne md it na b gy nf ng l nh ni">fig, ax = plt.subplots(figsize=(11, 9))</span><span id="e6cb" class="ne md it na b gy nm ng l nh ni">sb.heatmap(df_m)</span><span id="afa8" class="ne md it na b gy nm ng l nh ni">plt.show()</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi od"><img src="../Images/6a88bc757916ba103a4dd10b3e122afb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C7IyB8bwgmnYnwV6dinItQ.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">第一张热图。</p></figure><p id="8dcf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好了，在这个可视化准备好之前，还有很多事情要做。</p><p id="b12b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">颜色是我们图表中最重要的部分，颜色图有点过于复杂。我们不需要这个。相反，我们可以使用只有两种颜色的序列<code class="fe oa ob oc na b">cmap</code>。</p><p id="e608" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以通过定义<code class="fe oa ob oc na b">vmin</code>和<code class="fe oa ob oc na b">vmax</code>来明确色图的界限。熊猫<code class="fe oa ob oc na b">.min</code>和<code class="fe oa ob oc na b">.max</code>可以帮助我们找出它们的最佳价值。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="0f64" class="ne md it na b gy nf ng l nh ni">fig, ax = plt.subplots(figsize=(11, 9))</span><span id="9563" class="ne md it na b gy nm ng l nh ni"># plot heatmap<br/>sb.heatmap(df_m, cmap="Blues", vmin= 0.9, vmax=1.65,<br/>           linewidth=0.3, cbar_kws={"shrink": .8})</span><span id="9659" class="ne md it na b gy nm ng l nh ni">plt.show()</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oe"><img src="../Images/54dd5af1d1ab50d3d164450ecdaba9fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UrNc9z4Ry2eXKGeaojvngQ.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">第二张热图。</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="c352" class="ne md it bd me np nq dn mi nr ns dp mm kr nt nu mo kv nv nw mq kz nx ny ms nz bi translated">定制的</h2><p id="9653" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">使用<code class="fe oa ob oc na b">.heatmap</code>还有很多其他的论点可以探讨。</p><p id="f2bd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如<code class="fe oa ob oc na b">linewidth</code>定义了框之间的线的大小，我们甚至可以用<code class="fe oa ob oc na b">cbar_kws</code>将参数直接传递给颜色栏。</p><p id="3fc3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">颜色看起来不错，现在我们可以把注意力转移到蜱上了。我不认为 CAD_USD-1 是一月的正确名称。让我们用一些更友好的文字来代替它们。</p><p id="eab4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将刻度移动到图表的顶部会提高可视化效果，使它看起来更像一个表。我们也可以去掉 x 和 y 标签，因为我们的轴中的值是不言自明的，标题也会使它们变得多余。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="433e" class="ne md it na b gy nf ng l nh ni"># figure<br/>fig, ax = plt.subplots(figsize=(11, 9))</span><span id="64cc" class="ne md it na b gy nm ng l nh ni"># plot heatmap<br/>sb.heatmap(df_m, cmap="Blues", vmin= 0.9, vmax=1.65, square=True,<br/>           linewidth=0.3, cbar_kws={"shrink": .8})</span><span id="e117" class="ne md it na b gy nm ng l nh ni"># xticks<br/>ax.xaxis.tick_top()<br/>xticks_labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',<br/>                'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']<br/>plt.xticks(np.arange(12) + .5, labels=xticks_labels)</span><span id="eefb" class="ne md it na b gy nm ng l nh ni"># axis labels<br/>plt.xlabel('')<br/>plt.ylabel('')</span><span id="78a3" class="ne md it na b gy nm ng l nh ni"># title<br/>title = 'monthly Average exchange rate\nValue of one USD in CAD\n'.upper()<br/>plt.title(title, loc='left')</span><span id="5544" class="ne md it na b gy nm ng l nh ni">plt.show()</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/243382067f74f5fae3d1a7dee211c7dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*Ma93evjm-hZ815uPh-fRGA.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">最终热图。</p></figure><p id="26bf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我传递给热图的最后一个参数是<code class="fe oa ob oc na b">square</code>。这将使我们的矩阵的细胞呈正方形，而不管图形的大小。</p><p id="111f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">总的来说，看起来不错。我们可以看到，在 21 世纪初，美元比加拿大元高出近 50%，这种情况在 2003 年左右开始改变。这种美元贬值一直持续到 2014 年末，在 2008 年金融危机期间有所变化。</p><p id="5064" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">到 2015 年，它已经稳定在 1.20~1.40 左右，直到 2019 年，即我们的记录结束时，月平均值的变化相对较小。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f9b6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">相关矩阵</h1><p id="e156" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">在下面的例子中，我将通过一个关联矩阵来查看 Seaborn 热图的更多功能。</p><p id="976b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://www.kaggle.com/crawford/80-cereals" rel="noopener ugc nofollow" target="_blank">数据集</a>是 80 种不同谷物的样本，我想看看它们的成分。</p><p id="a781" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了构建相关矩阵，我们可以使用 Pandas <code class="fe oa ob oc na b">.corr()</code>。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="42a4" class="ne md it na b gy nf ng l nh ni"># read dataset<br/>df = pd.read_csv('data/cereal.csv')</span><span id="6efc" class="ne md it na b gy nm ng l nh ni"># get correlations<br/>df_corr = df.corr()</span><span id="1515" class="ne md it na b gy nm ng l nh ni"># irrelevant fields<br/>fields = ['rating', 'shelf', 'cups', 'weight']</span><span id="ef6d" class="ne md it na b gy nm ng l nh ni"># drop rows<br/>df_corr.drop(fields, inplace=True)</span><span id="2c50" class="ne md it na b gy nm ng l nh ni"># drop cols<br/>df_corr.drop(fields, axis=1, inplace=True)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi og"><img src="../Images/4713903a9909606b55b7fce608ff59e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RuFT3bp2kf-QwzMMwUUw-g.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">谷物数据框。</p></figure><p id="9949" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">相关矩阵中有很多冗余。表格上部的三角形与下部的三角形具有相同的信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="60db" class="ne md it bd me np nq dn mi nr ns dp mm kr nt nu mo kv nv nw mq kz nx ny ms nz bi translated">面具</h2><p id="e44d" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">幸运的是，我们可以在 Seaborn 的热图中使用遮罩，Numpy 有建立一个遮罩的功能。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="32fc" class="ne md it na b gy nf ng l nh ni">np.ones_like(df_corr, dtype=np.bool)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oh"><img src="../Images/7dfbdd296fe1ad6a4181a4cb41847fc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*ZE5tY00hcbe2-XqM-7fWWw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">一的矩阵(布尔型)</p></figure><p id="4498" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Numpy <code class="fe oa ob oc na b">.ones_like</code>可以创建一个与我们的数据框形状相同的布尔矩阵，而<code class="fe oa ob oc na b">.triu</code>将只返回该矩阵的上三角。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="2ca6" class="ne md it na b gy nf ng l nh ni">mask = np.triu(np.ones_like(df_corr, dtype=np.bool))</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/0571d0bec3207d6552cda2cbcdc0d5bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*g6PKzbstWt00AFa4OFSIfQ.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">面具</p></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/7afe1fe73324fff3a4d1b5c2111c70d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*9aCyln_nVDqGx9sA68L-Gg.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">第一相关矩阵。</p></figure><p id="5b13" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">面具可以有所帮助，但在我们的矩阵中仍有两个空细胞。</p><p id="5e2b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">没什么不好。这些值可以增加我们绘图的对称性，也就是说，如果两个列表以相同的值开始和结束，就更容易知道它们是相同的。</p><p id="a40d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果像我一样，你对此感到困扰，你可以在绘图时过滤掉它们。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="99a4" class="ne md it na b gy nf ng l nh ni">fig, ax = plt.subplots(figsize=(10, 8))</span><span id="19f6" class="ne md it na b gy nm ng l nh ni"># mask<br/>mask = np.triu(np.ones_like(df_corr, dtype=np.bool))</span><span id="4ecf" class="ne md it na b gy nm ng l nh ni"># adjust mask and df<br/>mask = mask[1:, :-1]<br/>corr = df_corr.iloc[1:,:-1].copy()</span><span id="5024" class="ne md it na b gy nm ng l nh ni"># plot heatmap<br/>sb.heatmap(corr, mask=mask, annot=True, fmt=".2f", cmap='Blues',<br/>           vmin=-1, vmax=1, cbar_kws={"shrink": .8})</span><span id="4ca9" class="ne md it na b gy nm ng l nh ni"># yticks<br/>plt.yticks(rotation=0)</span><span id="f31e" class="ne md it na b gy nm ng l nh ni">plt.show()</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ok"><img src="../Images/6667b33b2f60368992a5c6eaaa32dde9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MsC6ZvLrG7EJBwKs5wK8Mw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">第二相关矩阵。</p></figure><p id="7798" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">酷，唯一没有提到的是注释。我们可以用参数<code class="fe oa ob oc na b">annot</code>来设置它们，并且我们可以用<code class="fe oa ob oc na b">fmt</code>传递一个格式化函数给它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="2728" class="ne md it bd me np nq dn mi nr ns dp mm kr nt nu mo kv nv nw mq kz nx ny ms nz bi translated">发散调色板</h2><p id="1936" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">我们仍然需要一个标题，大写的刻度会更好看，但这还不是最重要的。</p><p id="da0a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">相关性范围从-1 到 1，所以它们有两个方向，在这种情况下，发散调色板比顺序调色板更好。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ol"><img src="../Images/bfcf5af20710e0c8f28671149d3119b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TRpczg5EH519PrWyaKJfPQ.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated"><a class="ae le" href="https://seaborn.pydata.org/generated/seaborn.diverging_palette.html" rel="noopener ugc nofollow" target="_blank"> Seaborn 发散调色板</a>。</p></figure><p id="1328" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Seaborn 有一个有效的方法，叫做<code class="fe oa ob oc na b">.diverging_palette</code>，它用来建立我们需要的彩色地图，每边一种颜色，在中间会聚成另一种颜色。</p><p id="7498" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那种方法使用 HUSL 颜色，所以你需要<em class="nk">色相</em>、<em class="nk">饱和度</em>和<em class="nk">明度。</em>我用<a class="ae le" href="https://www.hsluv.org/" rel="noopener ugc nofollow" target="_blank">hsluv.org</a>来选择这张图表的颜色。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="8758" class="ne md it na b gy nf ng l nh ni">fig, ax = plt.subplots(figsize=(12, 10))</span><span id="0eda" class="ne md it na b gy nm ng l nh ni"># mask<br/>mask = np.triu(np.ones_like(df_corr, dtype=np.bool))</span><span id="3831" class="ne md it na b gy nm ng l nh ni"># adjust mask and df<br/>mask = mask[1:, :-1]<br/>corr = df_corr.iloc[1:,:-1].copy()</span><span id="f15d" class="ne md it na b gy nm ng l nh ni"># color map<br/>cmap = sb.diverging_palette(0, 230, 90, 60, as_cmap=True)</span><span id="5b8b" class="ne md it na b gy nm ng l nh ni"># plot heatmap<br/>sb.heatmap(corr, mask=mask, annot=True, fmt=".2f", <br/>           linewidths=5, cmap=cmap, vmin=-1, vmax=1, <br/>           cbar_kws={"shrink": .8}, square=True)</span><span id="ea8f" class="ne md it na b gy nm ng l nh ni"># ticks<br/>yticks = [i.upper() for i in corr.index]<br/>xticks = [i.upper() for i in corr.columns]</span><span id="6248" class="ne md it na b gy nm ng l nh ni">plt.yticks(plt.yticks()[0], labels=yticks, rotation=0)<br/>plt.xticks(plt.xticks()[0], labels=xticks)</span><span id="f867" class="ne md it na b gy nm ng l nh ni"># title<br/>title = 'CORRELATION MATRIX\nSAMPLED CEREALS COMPOSITION\n'<br/>plt.title(title, loc='left', fontsize=18)</span><span id="a89d" class="ne md it na b gy nm ng l nh ni">plt.show()</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi om"><img src="../Images/68d1e6d6bf35565a89be399d47186e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9oyw9wQ7R6Ai5sAiev-4TQ.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">最终相关矩阵。</p></figure><p id="abbf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">非常酷，我们为相关矩阵建立了一个漂亮的可视化。现在更容易看到最显著的相关系数，比如纤维和钾。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2586" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">密度</h1><p id="831d" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">通常，在一个相关矩阵之后，我们可以更好地了解具有强关系的变量。</p><p id="ed3e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，我们没有太多的数据来研究，所以散点图将足以开始调查这些变量。</p><p id="364d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">散点图的问题是，如果数据太多，它们会变得难以阅读，因为点开始重叠。这时，热图会回到场景中来可视化密度。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="8185" class="ne md it na b gy nf ng l nh ni">fig, ax = plt.subplots(1, figsize=(12,8))</span><span id="9e4f" class="ne md it na b gy nm ng l nh ni">sb.kdeplot(df.potass, df.fiber, cmap='Blues',<br/>           shade=True, shade_lowest=False, clip=(-1,300))</span><span id="6abb" class="ne md it na b gy nm ng l nh ni">plt.scatter(df.potass, df.fiber, color='orangered')</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi on"><img src="../Images/d1c7e8d3e1d7a15e4e52fa8020d52bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EORwIih5pGj7WK9tUn1bhg.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">密度估计</p></figure><p id="b9f9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你有兴趣更多地了解 KDE，我建议你看看马修·康伦关于这个话题的文章。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="f139" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们探索了热图中的大多数基础知识，并研究了它们如何通过彩色地图、条形图、蒙版和密度估计来增加复杂性。</p><p id="5f92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读我的文章。我希望你喜欢它。<br/> <a class="ae le" href="https://linktr.ee/thiagobc23" rel="noopener ugc nofollow" target="_blank">更多教程</a> | <a class="ae le" href="https://twitter.com/thiagobc231" rel="noopener ugc nofollow" target="_blank">推特</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="795a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">资源:</strong> <br/> <a class="ae le" href="https://seaborn.pydata.org/examples/many_pairwise_correlations.html" rel="noopener ugc nofollow" target="_blank"> Seaborn 示例—相关矩阵</a>；<br/> <a class="ae le" href="https://seaborn.pydata.org/tutorial/color_palettes.html" rel="noopener ugc nofollow" target="_blank">海鸟选择颜色托盘</a>；<br/> <a class="ae le" href="https://seaborn.pydata.org/generated/seaborn.diverging_palette.html" rel="noopener ugc nofollow" target="_blank"> Seaborn 发散调色板</a>；<br/> <a class="ae le" href="https://seaborn.pydata.org/generated/seaborn.kdeplot.html" rel="noopener ugc nofollow" target="_blank"> Seaborn 核密度估计图</a>；</p></div></div>    
</body>
</html>