<html>
<head>
<title>Normalized Discounted Cumulative Gain</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">标准化贴现累积收益</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/normalized-discounted-cumulative-gain-37e6f75090e9?source=collection_archive---------2-----------------------#2020-08-08">https://towardsdatascience.com/normalized-discounted-cumulative-gain-37e6f75090e9?source=collection_archive---------2-----------------------#2020-08-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0084" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一种评估推荐引擎的指标</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/757e599363abcf0417e22e2255e3394e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r7WLl-w-r1ewZJ9f"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Graham Ruttan 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="eb0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated">你还记得曾经和你聊得很愉快的人忘记你名字的尴尬时刻吗？在这个时代，我们有了新的标准，新的期望。当期望没有实现时，感觉就在不远处被问到“我在哪里见过你？”上周和你在酒吧呆了一晚上的那个女人/男人，尴尬！—其实我并不去酒吧，但你明白我的意思。我们正处于个性化的时代，个性化的内容正到处涌现——网飞、Youtube、亚马逊等等。用户需要个性化的内容，企业寻求满足用户的需求。</p><p id="c0e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">近年来，许多企业已经采用机器学习来开发有效的推荐系统，以帮助个性化用户体验。就像生活中的所有事情一样，这一壮举伴随着它的挑战。评估推荐引擎的影响是推荐引擎的开发阶段或增强阶段的主要挑战。虽然我们可以肯定推荐系统所带来的积极影响，但为了有效地与利益相关者沟通，或者为了将来我们想增强我们的系统，我们非常需要量化这种影响。</p><p id="773b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">经过一番啰嗦，我在此向大家介绍… <em class="me">归一化贴现累计收益</em> (NDCG)。</p><blockquote class="mf"><p id="566f" class="mg mh it bd mi mj mk ml mm mn mo lu dk translated">衡量排名质量的一种方法，通常用于衡量 web 搜索引擎算法或相关应用程序的有效性。</p></blockquote><p id="042b" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">如果我们要相应地理解 Nd CG 指标，我们必须首先理解 CG(累积收益)和 DCG(贴现累积收益)，以及理解我们在使用 DCG 及其相关指标时所做的两个假设:</p><ol class=""><li id="c24c" class="mu mv it lb b lc ld lf lg li mw lm mx lq my lu mz na nb nc bi translated">高度相关的文档在搜索引擎结果列表中出现得越早越有用。</li><li id="0c78" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">高度相关的文档比不太相关的文档更有用，不太相关的文档比不相关的文档更有用</li></ol><blockquote class="ni nj nk"><p id="2bd9" class="kz la me lb b lc ld ju le lf lg jx lh nl lj lk ll nm ln lo lp nn lr ls lt lu im bi translated">(来源:维基百科)</p></blockquote></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h2 id="819a" class="nv nw it bd nx ny nz dn oa ob oc dp od li oe of og lm oh oi oj lq ok ol om on bi translated">累积增益</h2><p id="5773" class="pw-post-body-paragraph kz la it lb b lc oo ju le lf op jx lh li oq lk ll lm or lo lp lq os ls lt lu im bi translated">如果每个推荐都有一个相关的分级相关性分数，那么 CG 就是搜索结果列表中所有结果的分级相关性值的总和——参见图 1，我们可以用数学方法来表达它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/82d80dd74d8934c8fb663b0ff3e0a168.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*4vJpGCFXu-H95ljQnAFoWA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 1:累积增益数学表达式</p></figure><p id="9553" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">特定排名位置<code class="fe ou ov ow ox b">p</code>的累积增益，其中<code class="fe ou ov ow ox b">rel_i</code>是位置<code class="fe ou ov ow ox b">i</code>的结果的分级相关性。为了用 Python 演示这一点，我们必须首先让变量<code class="fe ou ov ow ox b">setA</code>成为搜索查询响应的分级相关性分数，从而每个分级相关性分数与一个文档相关联。</p><pre class="kj kk kl km gt oy ox oz pa aw pb bi"><span id="cac0" class="nv nw it ox b gy pc pd l pe pf">setA = [3, 1, 2, 3, 2, 0]<br/>print(sum(setA))</span><span id="d3b6" class="nv nw it ox b gy pg pd l pe pf">11</span></pre><p id="9762" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CG 的问题在于，在确定结果集的<strong class="lb iu">有用性</strong>时，它没有考虑结果集的排名。换句话说，如果我们对<code class="fe ou ov ow ox b">setA</code>返回的分级相关性分数进行重新排序，我们将无法更好地了解结果集的有用性，因为 CG 将保持不变。有关示例，请参见下面的代码单元格。</p><pre class="kj kk kl km gt oy ox oz pa aw pb bi"><span id="1d3d" class="nv nw it ox b gy pc pd l pe pf">setB = sorted(setA, reverse=True)<br/>print(f"setA: {setA}\tCG setA: {cg_a}\nsetB: {setB}\tCG setB: {sum(setB)}")</span><span id="bd9c" class="nv nw it ox b gy pg pd l pe pf">setA: [3, 1, 2, 3, 2, 0]	CG setA: 11<br/>setB: [3, 3, 2, 2, 1, 0]	CG setB: 11</span></pre><p id="9b5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ou ov ow ox b">setB</code>显然返回了比<code class="fe ou ov ow ox b">setA</code>更有用的集合，但是 CG 测量表明它们返回的结果一样好。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h2 id="815b" class="nv nw it bd nx ny nz dn oa ob oc dp od li oe of og lm oh oi oj lq ok ol om on bi translated">贴现累积收益</h2><p id="7eac" class="pw-post-body-paragraph kz la it lb b lc oo ju le lf op jx lh li oq lk ll lm or lo lp lq os ls lt lu im bi translated">为了克服这一点，我们引入了 DCG。DCG 通过降低与结果位置成对数比例的分级相关性值来惩罚在搜索中出现较低的高度相关的文档—参见图 2。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/4eb245075d0de1f41c0873fae7c47a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*6zHXVurs9zufQKnhQR8mpA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 2:贴现累积收益数学表达式</p></figure><p id="a0e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面我们创建了一个名为<code class="fe ou ov ow ox b">discountedCumulativeGain</code>的函数来计算<code class="fe ou ov ow ox b">setA</code>和<code class="fe ou ov ow ox b">setB</code>的 DCG。如果这是一个有效的测量，<code class="fe ou ov ow ox b">setB</code>应该比<code class="fe ou ov ow ox b">setA</code>有更高的 DCG，因为它的结果更有用。</p><pre class="kj kk kl km gt oy ox oz pa aw pb bi"><span id="5ee1" class="nv nw it ox b gy pc pd l pe pf">import numpy as np <br/><br/>def discountedCumulativeGain(result):<br/>    dcg = []<br/>    for idx, val in enumerate(result): <br/>        numerator = 2**val - 1<br/>        # add 2 because python 0-index<br/>        denominator =  np.log2(idx + 2) <br/>        score = numerator/denominator<br/>        dcg.append(score)<br/>    return sum(dcg)</span><span id="bc17" class="nv nw it ox b gy pg pd l pe pf">print(f"DCG setA: {discountedCumulativeGain(setA)}\nDCG setB: {discountedCumulativeGain(setB)}")</span><span id="2d21" class="nv nw it ox b gy pg pd l pe pf">DCG setA: 13.306224081788834<br/>DCG setB: 14.595390756454924</span></pre><p id="225a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ou ov ow ox b">setB</code>的 DCG 高于<code class="fe ou ov ow ox b">setA</code>，这符合我们的直觉，即<code class="fe ou ov ow ox b">setB</code>比<code class="fe ou ov ow ox b">setA</code>返回更多有用的结果。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h2 id="4956" class="nv nw it bd nx ny nz dn oa ob oc dp od li oe of og lm oh oi oj lq ok ol om on bi translated">标准化贴现累积收益</h2><p id="72a6" class="pw-post-body-paragraph kz la it lb b lc oo ju le lf op jx lh li oq lk ll lm or lo lp lq os ls lt lu im bi translated">当我们想要比较搜索引擎从一个查询到下一个查询的性能时，DCG 出现了一个问题，因为搜索结果列表的长度会根据所提供的查询而变化。因此，通过对查询中选择的值<code class="fe ou ov ow ox b">p</code>的每个位置的累积增益进行归一化，我们得到 NDCG。我们通过按照相对相关性对语料库中的所有相关文档进行排序来实现这一点，通过位置<code class="fe ou ov ow ox b">p</code>产生最大可能的 DCG(也称为理想的折扣累积收益)——参见图 3。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/d1ea2de894ebb69711bcf7fc18d40e98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*6WupVu-w8trtIgsV0iVWVw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 3:归一化贴现累积收益数学表达式；REL_p 表示语料库中直到位置 p 的相关文档的列表(按照相关性排序)</p></figure><p id="d7dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在 python 中执行这一度量，我们创建了函数<code class="fe ou ov ow ox b">normalizedDiscountedCumulativeGain</code>来帮助实现这一功能。</p><pre class="kj kk kl km gt oy ox oz pa aw pb bi"><span id="041d" class="nv nw it ox b gy pc pd l pe pf">def normalizedDiscountedCumulativeGain(result, sorted_result): <br/>    dcg = discountedCumulativeGain(result)<br/>    idcg = discountedCumulativeGain(sorted_result)<br/>    ndcg = dcg / idcg<br/>    return ndcg</span><span id="2c69" class="nv nw it ox b gy pg pd l pe pf">print(f"DCG setA: {normalizedDiscountedCumulativeGain(setA, setB)}\nDCG setB: {normalizedDiscountedCumulativeGain(setB, setB)}")</span><span id="53b8" class="nv nw it ox b gy pg pd l pe pf">DCG setA: 0.9116730277265138<br/>DCG setB: 1.0</span></pre><p id="fae3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">比率将始终在[0，1]的范围内，1 是满分，这意味着 DCG 与 IDCG 相同。因此，可以对所有查询的 NDCG 值进行平均，以获得推荐系统排序算法的平均性能的度量。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h2 id="8f04" class="nv nw it bd nx ny nz dn oa ob oc dp od li oe of og lm oh oi oj lq ok ol om on bi translated">NDCG 的局限性</h2><blockquote class="ni nj nk"><p id="14e6" class="kz la me lb b lc ld ju le lf lg jx lh nl lj lk ll nm ln lo lp nn lr ls lt lu im bi translated">(来源:维基百科)</p></blockquote><ol class=""><li id="78fe" class="mu mv it lb b lc ld lf lg li mw lm mx lq my lu mz na nb nc bi translated">NDCG 不会对搜索结果中的错误文档进行处罚</li><li id="de8f" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">不惩罚结果中丢失的文档</li><li id="60a9" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">可能不适合衡量可能经常有几个同样好的结果的查询的性能</li></ol></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h2 id="ed10" class="nv nw it bd nx ny nz dn oa ob oc dp od li oe of og lm oh oi oj lq ok ol om on bi translated">包裹</h2><p id="1734" class="pw-post-body-paragraph kz la it lb b lc oo ju le lf op jx lh li oq lk ll lm or lo lp lq os ls lt lu im bi translated">我们在使用 NDCG 时面临的主要困难是，当只有部分相关反馈可用时，我们经常不知道结果的理想排序。然而，NDCG 已被证明是评估各种问题排名质量的有效指标，例如<a class="ae ky" href="https://www.kaggle.com/c/yandex-personalized-web-search-challenge/overview/evaluation" rel="noopener ugc nofollow" target="_blank">个性化网络搜索挑战</a>、<a class="ae ky" href="https://www.kaggle.com/c/airbnb-recruiting-new-user-bookings" rel="noopener ugc nofollow" target="_blank"> AirBnB 新用户预订挑战</a>和<a class="ae ky" href="https://www.kaggle.com/c/expedia-personalized-sort/overview/evaluation" rel="noopener ugc nofollow" target="_blank">个性化 Expedia 酒店搜索——ICDM 2013</a>等等。</p><p id="cb54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢谢你读到这篇文章的结尾。如果你想和我联系，我在 LinkedIn 上很容易找到。</p><div class="pj pk gp gr pl pm"><a href="https://www.linkedin.com/in/kurtispykes/" rel="noopener  ugc nofollow" target="_blank"><div class="pn ab fo"><div class="po ab pp cl cj pq"><h2 class="bd iu gy z fp pr fr fs ps fu fw is bi translated">Kurtis Pykes -人工智能作家-走向数据科学| LinkedIn</h2><div class="pt l"><h3 class="bd b gy z fp pr fr fs ps fu fw dk translated">在世界上最大的职业社区 LinkedIn 上查看 Kurtis Pykes 的个人资料。Kurtis 有一个工作列在他们的…</h3></div><div class="pu l"><p class="bd b dl z fp pr fr fs ps fu fw dk translated">www.linkedin.com</p></div></div><div class="pv l"><div class="pw l px py pz pv qa ks pm"/></div></div></a></div></div></div>    
</body>
</html>