# Python å’Œ OpenCV ä¸­è§†é¢‘ä¼šè®®çš„è™šæ‹ŸèƒŒæ™¯â€”â€”ä¸€ç§æ„šè ¢çš„æ–¹æ³•

> åŸæ–‡ï¼š<https://towardsdatascience.com/virtual-background-for-video-conferencing-in-python-and-opencv-a-silly-approach-5f5ad1a5abef?source=collection_archive---------24----------------------->

ç”¨ Python å’Œ OpenCV åˆ›å»ºè§†é¢‘ä¼šè®®çš„è™šæ‹ŸèƒŒæ™¯ã€‚åŸºæœ¬æ–¹æ³•æ•™ç¨‹å’Œæ€æƒ³ã€‚

![](img/2ef0d03526f3906b51ce9127c34439a9.png)

[timJ](https://unsplash.com/@the_roaming_platypus?utm_source=medium&utm_medium=referral) åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

è™šæ‹ŸèƒŒæ™¯æ˜¯ç›®å‰è¿œç¨‹å·¥ä½œçš„å‘˜å·¥çš„çƒ­é—¨è¯é¢˜ä¹‹ä¸€ã€‚ç”±äºæ–°å† è‚ºç‚ç–«æƒ…ï¼Œæˆ‘ä»¬ä¸­çš„ä¸€äº›äººç›®å‰è¢«éš”ç¦»ï¼Œè®¸å¤šäººä¸å¾—ä¸è¿›è¡Œè§†é¢‘é€šè¯ï¼Œä»¥ä¾¿ç»§ç»­ä»–ä»¬çš„å·¥ä½œã€‚ä¸€äº›ç”¨äºè§†é¢‘ä¼šè®®çš„è½¯ä»¶å·¥å…·å…è®¸è®¾ç½®è™šæ‹ŸèƒŒæ™¯ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥ä¸ºæ¥å¬è¿™äº›ç”µè¯è¥é€ æ›´å‹å¥½çš„æ°›å›´ã€‚

ä½œä¸ºä¸€åç¨‹åºå‘˜ï¼Œæˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨è¿™æ ·çš„è™šæ‹ŸèƒŒæ™¯æ—¶ï¼Œè‡ªç„¶è¢«æ¿€èµ·äº†å…´è¶£ã€‚æˆ‘æƒ³çŸ¥é“å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘èƒ½å»ºç«‹è¿™æ ·çš„è™šæ‹ŸèƒŒæ™¯å—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œæˆ‘è¯¥æ€ä¹ˆåšï¼Ÿ*å‰§é€:è¿›å±•ä¸é¡ºåˆ©ï¼å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ•™è‚²ç»ƒä¹ ï¼Œåœ¨ç ”ç©¶è¿™ä¸ªè¯é¢˜çš„æ—¶å€™ï¼Œæˆ‘æ²¡æœ‰æ‰¾åˆ°å¤ªå¤šçš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œæ­£å¦‚æˆ‘å¯¹æ‰€å­¦çš„ä¸€åˆ‡æ‰€åšçš„é‚£æ ·ï¼Œæˆ‘å†³å®šæŠŠå®ƒè®°å½•åœ¨è¿™é‡Œï¼Œä¹Ÿè®¸å…¶ä»–äººä¼šä»ä¸­å—ç›Šã€‚*

å› æ­¤ï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•ä¸€ç§ç”¨è®¡ç®—æœºè§†è§‰æŠ€æœ¯æ„å»ºè™šæ‹ŸèƒŒæ™¯çš„åŸºæœ¬æ–¹æ³•ï¼Œä½¿ç”¨ Python å’Œ OpenCVã€‚

# ä»‹ç»

è¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯æ‹æ‘„ä¸€æ®µè§†é¢‘ï¼Œè¯•ç€æ‰¾å‡ºè§†é¢‘çš„èƒŒæ™¯å’Œå‰æ™¯ï¼Œå»æ‰èƒŒæ™¯éƒ¨åˆ†ï¼Œç”¨ä¸€å¼ å›¾ç‰‡ä»£æ›¿â€”â€”è™šæ‹ŸèƒŒæ™¯ã€‚å› ä¸ºåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¹³å‡¡çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°†éœ€è¦å‡è®¾ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‰æ™¯å°†æœ‰ä¸åŒäºèƒŒæ™¯çš„é¢œè‰²ã€‚ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„å·¥å…·æ˜¯ä»€ä¹ˆã€‚

## è®¡ç®—æœºè§†è§‰

è®¡ç®—æœºè§†è§‰æ˜¯ä¸€ä¸ªè·¨å­¦ç§‘é¢†åŸŸï¼Œç ”ç©¶è®¡ç®—æœºå¦‚ä½•å¤„ç†å’Œ(ä¹Ÿè®¸)ç†è§£å›¾åƒå’Œè§†é¢‘ã€‚æˆ‘ä»¬è¯´å®ƒæ˜¯ä¸€ä¸ª*è·¨å­¦ç§‘*é¢†åŸŸï¼Œå› ä¸ºå®ƒä»ä¸åŒå­¦ç§‘(è®¡ç®—æœºç§‘å­¦ã€ä»£æ•°ã€å‡ ä½•ç­‰ç­‰)å€Ÿç”¨äº†å¾ˆå¤šæ¦‚å¿µï¼Œå¹¶å°†å®ƒä»¬ç»“åˆèµ·æ¥è§£å†³äº†å¾ˆå¤šä¸åŒçš„å¤æ‚ä»»åŠ¡ï¼Œæ¯”å¦‚å›¾åƒå’Œè§†é¢‘ä¸­çš„**å¯¹è±¡è·Ÿè¸ª**ã€**å¯¹è±¡æ£€æµ‹ã€** **å¯¹è±¡è¯†åˆ«**ã€**å¯¹è±¡åˆ†å‰²**ã€‚

## OpenCV

[**OpenCV**](https://opencv.org/) æ˜¯ä¸ºè§£å†³è®¡ç®—æœºè§†è§‰ä»»åŠ¡è€Œæ„å»ºçš„åº“ã€‚å®ƒæ˜¯å¼€æºçš„ï¼Œå¯ç”¨äºå‡ ç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ Python å’Œ C++ã€‚å®ƒæœ‰å¤§é‡çš„è®¡ç®—æœºè§†è§‰åŠŸèƒ½ï¼Œå…¶ä¸­ä¸€äº›åŸºäºæ•°å­¦å’Œç»Ÿè®¡æ–¹æ³•ï¼Œå¦ä¸€äº›åŸºäºæœºå™¨å­¦ä¹ ã€‚

## è®¡ç®—æœºç¼–ç¨‹è¯­è¨€

å¦‚æœæ‚¨å·²ç»é˜…è¯»äº†æœ¬æ–‡ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½çŸ¥é“ Python æ˜¯ä»€ä¹ˆğŸ˜€

# æ„å»ºè™šæ‹ŸèƒŒæ™¯

æˆ‘å°è¯•çš„æ–¹æ³•å¦‚ä¸‹ã€‚æˆ‘å°†å±•ç¤ºæ¯ä¸€æ­¥çš„ä»£ç ç‰‡æ®µï¼Œåœ¨æ–‡ç« çš„æœ€åï¼Œæ‚¨å°†çœ‹åˆ°å®Œæ•´çš„ä»£ç ã€‚

1.  å¯¼å…¥ä¾èµ–é¡¹

```
import numpy as np
import cv2
```

2.ä»æœ¬åœ°ç¯å¢ƒåŠ è½½è§†é¢‘å¹¶åˆå§‹åŒ–æ•°æ®

```
ap = cv2.VideoCapture('video6.mp4')
ret = True
frameCounter = 0
previousFrame = None
nextFrame = None
iterations = 0
```

3.ä»æœ¬åœ°ç¯å¢ƒåŠ è½½æ›¿æ¢èƒŒæ™¯å›¾åƒ

```
backgroundImage = cv2.imread("image1.jpg")
```

4.é€å¸§åˆ†å‰²è§†é¢‘

```
while (ret):
	ret, frame = cap.read()
```

5.å–æ¯ä¸€å¯¹ä¸¤å¸§

```
if frameCounter % 2 == 1:
            nextFrame = frame if frameCounter % 2 == 0:
            frameCounter = 0
            previousFrame = frame frameCounter = frameCounter + 1
        iterations = iterations + 1
```

6.æ±‚ä¸¤å¸§çš„ç»å¯¹å·®å€¼å¹¶è½¬æ¢æˆç°åº¦->è·å–è’™ç‰ˆã€‚

```
if iterations > 2:
            diff = cv2.absdiff(previousFrame, nextFrame)
            mask = cv2.cvtColor(diff, cv2.COLOR_BGR2GRAY)
```

æ¯å¹…å›¾åƒéƒ½ç”±åƒç´ ç»„æˆâ€”â€”ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªç”±è¡Œå’Œåˆ—ç»„æˆçš„ 2D çŸ©é˜µï¼ŒçŸ©é˜µä¸­çš„æ¯ä¸ªå•å…ƒéƒ½æ˜¯å›¾åƒä¸­çš„ä¸€ä¸ªåƒç´ (å½“ç„¶ï¼Œå¯¹äºå½©è‰²å›¾åƒï¼Œæˆ‘ä»¬æœ‰ä¸æ­¢ 2 ä¸ªç»´åº¦ï¼Œä½†ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥è¿™ä¸€ç‚¹)ã€‚

æˆ‘ä»¬é€šè¿‡åœ¨ç¬¬ä¸€å¹…å›¾åƒä¸­é€ä¸ªåƒç´ åœ°(åœ¨ç¬¬ä¸€çŸ©é˜µä¸­é€ä¸ªå•å…ƒåœ°)æ›¿æ¢å¦ä¸€å¹…å›¾åƒä¸­çš„ç›¸åº”åƒç´ (åœ¨å¦ä¸€çŸ©é˜µä¸­çš„ç›¸åº”å•å…ƒ)æ¥è·å¾—å·®å¼‚ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªçªé—¨:å¦‚æœåœ¨ä¸¤å¸§ä¹‹é—´ï¼Œä¸€ä¸ªåƒç´ æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆç»“æœå½“ç„¶ä¼šæ˜¯ **0** ã€‚*2 å¸§ä¹‹é—´åƒç´ æ€ä¹ˆä¼šä¸ä¸€æ ·ï¼Ÿ*å¦‚æœè§†é¢‘æ˜¯å®Œå…¨é™æ€çš„(å›¾åƒä¸­æ²¡æœ‰ä»»ä½•ä¸œè¥¿ç§»åŠ¨)ï¼Œé‚£ä¹ˆæ‰€æœ‰åƒç´ çš„æ¯ä¸€å¸§ä¹‹é—´çš„å·®å¼‚å°†ä¸º 0ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•ä¸œè¥¿å‘ç”Ÿå˜åŒ–ã€‚**ä½†æ˜¯ï¼Œå¦‚æœå›¾åƒä¸­æœ‰ç‰©ä½“ç§»åŠ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æµ‹åƒç´ å·®å¼‚æ¥è¯†åˆ«ç‰©ä½“åœ¨å›¾åƒä¸­çš„ç§»åŠ¨ä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾ï¼Œåœ¨è§†é¢‘ä¼šè®®ä¸­ï¼Œç§»åŠ¨çš„ä¸œè¥¿åœ¨å‰æ™¯ä¸­â€”â€”ä¹Ÿå°±æ˜¯ä½ â€”â€”è€Œé™æ­¢çš„éƒ¨åˆ†æ˜¯èƒŒæ™¯ã€‚**

è¿˜æœ‰è¿™ä¸ª **0** æœ‰ä»€ä¹ˆé‡è¦çš„ï¼Ÿå›¾åƒä¸­æ¯ä¸ªä¸º 0 çš„åƒç´ å°†æ˜¾ç¤ºé»‘è‰²ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚

7.æ‰¾åˆ°é®ç½©ä¸­è¶…è¿‡é˜ˆå€¼çš„å•å…ƒæ ¼â€”æˆ‘é€‰æ‹©äº† **3** ä½œä¸ºé˜ˆå€¼ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„å€¼ã€‚è¾ƒå¤§çš„å€¼å°†ä»èƒŒæ™¯ä¸­ç§»é™¤æ›´å¤šï¼Œä½†ä¹Ÿå¯èƒ½ä»å‰æ™¯ä¸­ç§»é™¤æ›´å¤šã€‚

```
th = 3
            isMask = mask > th
            nonMask = mask <= th
```

8.åˆ›å»ºä¸€ä¸ªç©ºå›¾åƒ(æ¯ä¸ªå•å…ƒæ ¼ä¸º 0)ï¼Œå¤§å°ä¸ºä¸¤ä¸ªå¸§ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚

```
result = np.zeros_like(nextFrame, np.uint8)
```

9.è°ƒæ•´èƒŒæ™¯å›¾åƒçš„å¤§å°ï¼Œä½¿å…¶ä¸æ¡†æ¶å¤§å°ç›¸åŒã€‚

```
resized = cv2.resize(backgroundImage, (result.shape[1], result.shape[0]), interpolation = cv2.INTER_AREA)
```

10.å¯¹äºé®ç½©ä¸­å¤§äºé˜ˆå€¼çš„æ¯ä¸ªå•å…ƒï¼Œä»åŸå§‹å¸§å¤åˆ¶ã€‚

```
result[isMask] = nextFrame[isMask]
```

11.å¯¹äºä½äºé˜ˆå€¼çš„é®ç½©ä¸­çš„æ¯ä¸ªå•å…ƒæ ¼ï¼Œä»æ›¿æ¢èƒŒæ™¯å›¾åƒä¸­å¤åˆ¶ã€‚

```
result[nonMask] = resized[nonMask]
```

12.å°†ç»“æœå¸§ä¿å­˜åˆ°æœ¬åœ°ç¯å¢ƒã€‚

```
cv2.imwrite("output" + str(iterations) + ".jpg", result)
```

# ç»“æœå’Œç»“è®º

é‚£ä¹ˆç»“æœå¦‚ä½•å‘¢ï¼Ÿè€å®è¯´ï¼Œæˆ‘å¯¹è¿™ä¸ªç»“æœæœ‰ç‚¹å¤±æœ›ã€‚ç„¶åæˆ‘åšäº†æ›´å¤šçš„ç ”ç©¶ï¼ŒåŸå› å˜å¾—æ›´åŠ æ˜æ˜¾ã€‚ä½ éœ€è¦æ›´å…ˆè¿›çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¤§å…¬å¸åœ¨è¿™ç±»é—®é¢˜ä¸ŠæŠ•å…¥å¤§é‡èµ„æºä¹Ÿå°±ä¸è¶³ä¸ºå¥‡äº†ã€‚

ä¸‹é¢æ˜¯æˆ‘è¯•çš„è§†é¢‘æˆªå›¾ã€‚åŸºæœ¬ä¸Šå°±æ˜¯æˆ‘çš„æ‰‹åœ¨å¢™å‰ç§»åŠ¨çš„è§†é¢‘ã€‚

![](img/30828d582921c406fa1d07a98a560bdd.png)

è™šæ‹ŸèƒŒæ™¯ Python å’Œ OpenCV æ•™ç¨‹â€”è¾“å…¥

è¿™æ˜¯è¾“å‡ºå›¾åƒçš„æˆªå›¾ã€‚ä½œä¸ºèƒŒæ™¯ï¼Œæˆ‘ç”¨äº†ä¸€å¼ æˆ‘åœ¨ç½—é©¬å°¼äºšæ‹‰æ–¯è¯ºå¤«çš„ç…§ç‰‡ã€‚

![](img/116ce9309df7cd40ea01724ad52f6102.png)

è™šæ‹ŸèƒŒæ™¯ Python å’Œ OpenCV æ•™ç¨‹â€”è¾“å‡º

æ­£å¦‚æˆ‘æ‰€è¯´çš„ï¼Œæˆ‘å¯¹ç»“æœä¸æ˜¯å¾ˆæ»¡æ„ã€‚ä½†æ˜¯æˆ‘å¯¹ä»è¿™ä¸ªé¡¹ç›®ä¸­å­¦åˆ°çš„ä¸œè¥¿å¾ˆæ»¡æ„ã€‚è¿™æ˜¯ä¸€æ¬¡æœ‰è¶£çš„å­¦ä¹ ç»å†ï¼Œä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼æ¥èŠ±æ—¶é—´å¤„ç†æˆ‘ä¸ä¹ æƒ¯å¤„ç†çš„æ¦‚å¿µã€‚

# åˆ›å»ºè™šæ‹ŸèƒŒæ™¯çš„å…¶ä»–æ–¹æ³•

å¦‚æœä½ è®¤ä¸ºä¸€ä¸ªé—®é¢˜éå¸¸å¤æ‚ï¼Œéœ€è¦ä½ åœ¨è®¡ç®—æœºè½¯ä»¶ä¸­çœ‹åˆ°çš„ä¸å¯»å¸¸çš„æ™ºèƒ½æ°´å¹³ï¼Œé‚£ä¹ˆç­”æ¡ˆå¯èƒ½æ˜¯æœºå™¨å­¦ä¹ ã€‚ğŸ˜€

å·²ç»æœ‰æ·±åº¦å­¦ä¹ æ¨¡å‹å¯ä»¥æ‰§è¡Œè¿™ç§ä»»åŠ¡ã€‚ä½†æ˜¯è¿™æ ·ä¸€ä¸ªæ¨¡å‹éœ€è¦å¤§é‡çš„æ•°æ®é›†æ¥è®­ç»ƒå’Œå¤§é‡çš„å¤„ç†èƒ½åŠ›ï¼Œè€Œåœ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘è¿˜æ²¡æœ‰è¿™æ ·çš„èƒ½åŠ›ã€‚è¿™æ ·çš„æ·±åº¦å­¦ä¹ æ¨¡å‹è¦è§£å†³çš„ä»»åŠ¡å«åšå›¾åƒåˆ†å‰²ã€‚

å¦ä¸€ç§æ–¹æ³•æ˜¯è®¡ç®—æœºè§†è§‰æ–¹æ³•ï¼Œç”¨äºå¯»æ‰¾ç…§ç›¸æœºå’Œå›¾åƒä¸­çš„ç‰©ä½“ä¹‹é—´çš„è·ç¦»ã€‚ç„¶åä½ å¯ä»¥å»ºç«‹ä¸€ä¸ªé˜ˆå€¼æ¥åŒºåˆ†å‰æ™¯å’ŒèƒŒæ™¯ã€‚åœ¨é‚£ä¹‹åï¼Œä½ å¯ä»¥ä½¿ç”¨æˆ‘ç”¨æ¥ç§»é™¤èƒŒæ™¯çš„ç›¸åŒé®ç½©ï¼Œå¹¶å¼•å…¥ä¸€ä¸ªæ–°çš„é®ç½©ã€‚

*æœ¬æ–‡åŸè½½äº* [*ç¨‹åºå‘˜èƒŒåŒ…åšå®¢*](https://programmerbackpack.com/virtual-background-python-opencv/) *ã€‚å¦‚æœä½ æƒ³é˜…è¯»æ›´å¤šè¿™ç±»çš„æ•…äº‹ï¼Œä¸€å®šè¦è®¿é—®è¿™ä¸ªåšå®¢ã€‚*

*éå¸¸æ„Ÿè°¢æ‚¨é˜…è¯»æœ¬æ–‡ï¼å¯¹æ›´å¤šè¿™æ ·çš„æ•…äº‹æ„Ÿå…´è¶£ï¼Ÿåœ¨ Twitter ä¸Šå…³æ³¨æˆ‘ï¼Œåœ°å€æ˜¯*[*@ b _ dmarius*](https://twitter.com/b_dmarius)*ï¼Œæˆ‘ä¼šåœ¨é‚£é‡Œå‘å¸ƒæ¯ä¸€ç¯‡æ–°æ–‡ç« ã€‚*