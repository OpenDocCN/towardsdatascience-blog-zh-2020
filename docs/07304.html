<html>
<head>
<title>How to Scrape Multiple URLs with Python: Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 抓取多个 URL:教程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scraping-multiple-urls-with-python-tutorial-2b74432d085f?source=collection_archive---------0-----------------------#2020-06-03">https://towardsdatascience.com/scraping-multiple-urls-with-python-tutorial-2b74432d085f?source=collection_archive---------0-----------------------#2020-06-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="411b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">因为您想要的数据并不总是您拥有的数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b17cc0ae39a87773fa22a35619a9f7c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I2QjgddWbGV96Exf"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/photos/N6HTCyN50p0" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="4db3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示三种从多个 URL 获取数据的方法。更具体地说，我将展示如何遍历页码，遍历手动创建的 URL 列表，最后遍历一个粗略的 URL 列表。</p><p id="4c33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我假设在本教程中，你有一些网页抓取的超级基础知识。如果你需要快速复习如何检查和抓取一个网站，看看这个。</p><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/a-tutorial-of-what-kaggle-wont-teach-you-web-scraping-data-cleaning-and-more-16d402a206e8"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">一个 Kaggle 不会教你的教程:网页抓取，数据清理等等</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">因为数据科学不仅仅是 EDA 和培训模型</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="885c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将从 Hostelworld 收集旅馆数据，Hostelworld 是世界上寻找旅馆最好的网站。好了，现在我们开始吧！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="94a0" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">在页码上循环</h1><p id="b900" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">这是抓取多个页面的最简单、最直接的方式。让我们先来看看我们收集旅舍的 URL 的末尾(文章末尾有完整的 URL):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/3a1c43d5e8edfee899fb39599c07650b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lzkHveYZZazGiy3cyp7m6Q.png"/></div></div></figure><p id="b05f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到对于第一页，我们有 page=1。对于第二页，我们将有 page=2，依此类推。</p><p id="e020" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们需要做的就是创建一个“for”循环，在这里我们改变最后一个数字。对于每个页面，循环将收集我们指定的信息。</p><p id="2d7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是收集从市中心的距离的代码，宿舍床的价格，一个私人房间的价格，以及以前的客户对网站前 2 页找到的所有旅馆的平均评级。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><ul class=""><li id="e7fd" class="nu nv it lb b lc ld lf lg li nw lm nx lq ny lu nz oa ob oc bi translated">我在这里使用 selenium 是因为 hostelworld 页面是 JavaScript 渲染的，BeautifulSoup 无法处理。</li><li id="18e3" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated">我去掉了"<em class="oi"> price-title 5" </em>元素，因为该元素允许我们知道价格是针对宿舍还是私人房间。</li><li id="7f78" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated">睡眠功能有助于控制我们向网站服务器发出请求的速度(避免降低服务器速度)，但也有助于确保 selenium 在继续运行之前找到我们想要的信息。</li></ul><p id="1c06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，我们会继续清理数据以使其可用，但我将在最后用最后一种方法来做这件事。让我们继续下一个方法。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="9f3f" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">遍历手动创建的 URL 列表</h1><p id="cbad" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">那太好了，但是如果你要抓取的不同网址没有你可以循环通过的页码怎么办？此外，如果我想要的具体信息只在旅舍的实际页面上提供，该怎么办？</p><p id="7dd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一种方法是手动创建一个 URL 列表，并遍历这个列表。下面是为前两个旅馆创建 URL 列表的代码:</p><pre class="kj kk kl km gt oj ok ol om aw on bi"><span id="2b00" class="oo mv it ok b gy op oq l or os">url = ['<a class="ae ky" href="https://www.hostelworld.com/pwa/hosteldetails.php/Casa-Gracia-Barcelona-Hostel/Barcelona/45620?from=2020-07-03&amp;to=2020-07-05&amp;guests=1'" rel="noopener ugc nofollow" target="_blank">https://www.hostelworld.com/pwa/hosteldetails.php/Casa-Gracia-Barcelona-Hostel/Barcelona/45620?from=2020-07-03&amp;to=2020-07-05&amp;guests=1'</a> ,<br/>       '<a class="ae ky" href="https://www.hostelworld.com/pwa/hosteldetails.php/Itaca-Hostel/Barcelona/1279?from=2020-07-03&amp;to=2020-07-05&amp;guests=1',\" rel="noopener ugc nofollow" target="_blank">https://www.hostelworld.com/pwa/hosteldetails.php/Itaca-Hostel/Barcelona/1279?from=2020-07-03&amp;to=2020-07-05&amp;guests=1'</a>]</span></pre><p id="dfc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以创建一个新的“for”循环，遍历列表中的每个元素并收集您想要的信息，其方式与第一种方法完全相同。</p><p id="d96f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你只有几个 URL，那也可以，但是想象一下如果你有 100，1000 甚至 10000 个 URL！当然，手动创建列表不是你想要做的(除非你有大量的空闲时间)！</p><p id="f20a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢天谢地，有更好/更聪明的方法来做事。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="4939" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">循环浏览抓取的 URL 列表</h1><p id="93f7" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">这是本教程的最后一个方法。让我们仔细看看我们正在抓取的 Hostelworld 页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/8392d9cca256752b24e32dec887384ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XunqxHBxOTyhdazm62FQEw.png"/></div></div></figure><p id="17dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到每个旅舍列表都有一个<strong class="lb iu"> href 属性</strong>，它指定了到单个旅舍页面的链接。这就是我们想要的信息。</p><p id="ad20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">方法如下:</strong></p><ol class=""><li id="a60f" class="nu nv it lb b lc ld lf lg li nw lm nx lq ny lu ou oa ob oc bi translated">创建一个“for”循环，抓取我们需要的所有页面的所有 href 属性(以及 URL)。</li><li id="85f1" class="nu nv it lb b lc od lf oe li of lm og lq oh lu ou oa ob oc bi translated">清理数据并创建一个包含所有收集的 URL 的列表。</li><li id="1872" class="nu nv it lb b lc od lf oe li of lm og lq oh lu ou oa ob oc bi translated">创建一个新的循环，遍历 URL 列表，收集所有需要的信息。</li><li id="6d39" class="nu nv it lb b lc od lf oe li of lm og lq oh lu ou oa ob oc bi translated">清理数据并创建最终的数据帧。</li></ol><p id="f591" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要指出的是，如果抓取的每一页都有不同的结构，这种方法将无法正常工作。网址需要来自同一个网站！</p><p id="3553" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于每一个旅舍页面，我都刮掉了旅舍的名称、一张床最便宜的价格、评论数量以及 8 个类别(位置、氛围、安全、清洁度等)的评论分数。).</p><p id="37bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这使得我们看到的第一种方法毫无用处，因为使用这种方法，我们可以获得所有相同的信息，甚至更多！</p><p id="abc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是获得干净的 URL 列表的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><ul class=""><li id="78aa" class="nu nv it lb b lc ld lf lg li nw lm nx lq ny lu nz oa ob oc bi translated">不需要的链接很可能会出现在你的 URL 列表中，就像这里的情况一样。一般来说，几乎总是有一个非常独特的模式来区分你想要的网址和其他网址(宣传等)。).在这种情况下，所有指向旅馆的链接都以/pwa/开头。</li><li id="5ab5" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated">我将字符串<em class="oi">'</em><a class="ae ky" href="https://www.hostelworld.com/" rel="noopener ugc nofollow" target="_blank"><em class="oi">https://www.hostelworld.com</em></a><em class="oi">'</em>添加到列表的每个元素中。在接下来的循环中，URL 需要用到这一部分。</li></ul><p id="dc57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了干净网址的列表，我们可以通过循环列表来抓取我们想要的所有信息。</p><p id="0064" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于每次迭代大约需要 15-20 秒，所以我将只对这里的前 10 个旅舍这样做。你可以很容易地通过改变范围来改变它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><ul class=""><li id="5c93" class="nu nv it lb b lc ld lf lg li nw lm nx lq ny lu nz oa ob oc bi translated">当我收集评论数量时，由于该信息在每页上出现两次，所以我使用[-1]只获得最后一次发现的评论数量。</li><li id="167f" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated">通常有许多价格选择(取决于宿舍的类型)。最后给的价格永远是最便宜的，这也是我想保留的。如果找到多个，try/except 循环基本上保持最后的价格，如果只找到一个，则保持价格不变。</li></ul><p id="b709" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种类型的循环是处理潜在错误的好方法！</p><p id="17f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">收集完所有数据后，下面是清理数据并将其放入 dataframe 的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="dc7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是最终数据帧的头部:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/cfce44a91da49080aa3865573c9e5f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sovVxH1LshUZ714z2sfsiQ.png"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="5469" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你有了，三种不同的抓取多个页面/URL 的方法。我真的希望这有所帮助，不要忘记负责任地刮。</p><p id="f9e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢你的阅读！</p><h2 id="14ac" class="oo mv it bd mw ow ox dn na oy oz dp ne li pa pb ng lm pc pd ni lq pe pf nk pg bi translated">参考</h2><div class="lv lw gp gr lx ly"><a href="https://www.hostelworld.com/s?q=Barcelona,%20Catalonia,%20Spain&amp;country=Spain&amp;city=Barcelona&amp;type=city&amp;id=83&amp;from=2020-07-03&amp;to=2020-07-05&amp;guests=1&amp;page=1" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">便宜的巴塞罗那旅舍“旅舍宿舍和私人房间”旅舍世界</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">巴塞罗那拥有欧洲最好的夜生活，吸引了来自世界各地的背包客和派对爱好者…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">www.hostelworld.com</p></div></div><div class="mh l"><div class="ph l mj mk ml mh mm ks ly"/></div></div></a></div></div></div>    
</body>
</html>