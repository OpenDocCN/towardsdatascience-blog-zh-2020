<html>
<head>
<title>How to Share your Python Objects Across Different Environments in One Line of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在一行代码中跨不同环境共享 Python 对象</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-share-your-python-objects-across-different-environments-in-one-line-of-code-f30a25e5f50e?source=collection_archive---------32-----------------------#2020-07-08">https://towardsdatascience.com/how-to-share-your-python-objects-across-different-environments-in-one-line-of-code-f30a25e5f50e?source=collection_archive---------32-----------------------#2020-07-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8018" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对设置环境与他人分享您的分析感到沮丧？以下是如何让它变得更简单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/97a9028417c37ced74903d45c00f7b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GnnZJjBBjBfT8KRq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@axelahoi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿克塞尔·阿霍伊</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="727c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">动机</h1><p id="389e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你有没有想过在不同的脚本之间共享 Python 对象？或者在你和你的队友之间分享发现，这样每个人都可以工作在最新的结果上？你可能会遇到三个困难:</p><ul class=""><li id="36a3" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">您的队友可能会部署与您的脚本不同的环境</li><li id="e373" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">由你的队友训练的模型<strong class="lt iu">每天都在变化</strong>。所以他们需要每天和你分享模型。</li><li id="50f2" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">文件或模型<strong class="lt iu">很大。每次部署脚本时重新上传它们是很麻烦的。‌</strong></li></ul><p id="c3ff" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">如果你所需要做的就是像这样共享数据帧，不是更容易吗</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="0948" class="nl la it nh b gy nm nn l no np">import datapane as dp</span><span id="547f" class="nl la it nh b gy nq nn l no np">df = dp.Blob.get('profile', owner='khuyentran1401').download_df()</span><span id="fa57" class="nl la it nh b gy nq nn l no np">df</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="aca3" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">或者类似这样的分享你的模型？</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="8135" class="nl la it nh b gy nm nn l no np">import datapane as dp</span><span id="df84" class="nl la it nh b gy nq nn l no np">predictor = dp.Blob.get(<em class="nt">name</em>='predictor',<em class="nt">owner</em>='khuyentran1401').download_obj()</span><span id="106f" class="nl la it nh b gy nq nn l no np">X_TEST = [[10, 20, 30]]</span><span id="e9aa" class="nl la it nh b gy nq nn l no np">outcome = predictor.predict(<em class="nt">X</em>=X_TEST)</span></pre><p id="5052" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">这时我们需要 Datapane 的 Blob API</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="0ae6" class="kz la it bd lb lc ob le lf lg oc li lj jz od ka ll kc oe kd ln kf of kg lp lq bi translated">什么是 Datapane 的 Blob？</h1><p id="1d96" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://datapane.com/" rel="noopener ugc nofollow" target="_blank"> Datapane </a>提供了一个 API 集合，使得与其他人共享 Python 分析变得容易。如果你还不知道 Datapane，我在这里写了一篇关于 Datapane 的文章。</p><div class="og oh gp gr oi oj"><a rel="noopener follow" target="_blank" href="/introduction-to-datapane-a-python-library-to-build-interactive-reports-4593fd3cb9c8"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">Datapane 简介:构建交互式报表的 Python 库</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">创建精美报告并与您的团队分享分析结果的简单框架</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox ks oj"/></div></div></a></div><p id="8f8d" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">除了用于创建报告和部署笔记本的 API(在另一篇博文中显示……等等), Datapane 还提供了用于其他常见用例的 API，例如<strong class="lt iu">共享 blob 和管理秘密</strong>。</p><p id="5446" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">为了说明 Blob 的使用，我使用了来自本文的一个机器学习模型的例子。假设您正在训练一个这样的模型，它在测试集上有很好的性能。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy ns l"/></div></figure><p id="0215" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">您希望将此模型发送给您的团队成员，以便他们可以使用您的模型来预测新的数据集。你怎么能这样做？</p><p id="3ca9" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">你可以建立一个 docker 环境，并把它发送给你的队友。但如果他们只是想快速测试你的模型，而不需要设置环境，<code class="fe oz pa pb nh b">datapane.Blob</code>会是更好的选择。</p><p id="d79b" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">如果您希望其他人访问它，请确保拥有<code class="fe oz pa pb nh b">visibily='PUBLIC'</code>。现在其他人可以用你的 blob 写他们的代码了！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy ns l"/></div></figure><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="d081" class="nl la it nh b gy nm nn l no np">Outcome : [140.]<br/>Coefficients : [1. 2. 3.]`</span></pre><p id="9c25" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">尝试运行相同的代码，看看是否可以访问和使用预测器！在复制和粘贴代码之前，请确保预先在 Datapane 上注册以获得令牌。然后使用您的令牌<br/> <code class="fe oz pa pb nh b">datapane login — server=<a class="ae ky" href="https://datapane.com/" rel="noopener ugc nofollow" target="_blank">https://datapane.com/</a> — token=yourtoken</code>登录终端</p><p id="ecda" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">现在试试</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="51d1" class="nl la it nh b gy nm nn l no np">dp.Blob.get(name='predictor', owner='khuyentran1401').download_obj()</span></pre><p id="3d08" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">看看您是否能够访问和使用预测器并产生与上面相同的结果！</p><p id="1dff" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">如果您想在您的组织中私下共享您的 blob，请遵循相同的过程，但是将 blob 的可见性设置为<code class="fe oz pa pb nh b">ORG</code></p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="8196" class="kz la it bd lb lc ob le lf lg oc li lj jz od ka ll kc oe kd ln kf of kg lp lq bi translated">我还能用 Blob 做什么？</h1><p id="2553" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">除了上传 Python 对象，您还可以使用 blob 来上传 Pandas Dataframe，一个文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy ns l"/></div></figure><p id="958a" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">并从 blob 中获取数据帧、文件或对象</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy ns l"/></div></figure><p id="88ad" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">例如，在文章中，我写了我在搜集了超过 1k 个 Github 概要文件后的发现</p><div class="og oh gp gr oi oj"><a rel="noopener follow" target="_blank" href="/i-scraped-more-than-1k-top-machine-learning-github-profiles-and-this-is-what-i-found-1ab4fb0c0474"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">我收集了超过 1k 的顶级机器学习 Github 配置文件，这就是我的发现</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">从 Github 上的顶级机器学习档案中获得见解</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="os l"><div class="pc l ou ov ow os ox ks oj"/></div></div></a></div><p id="425b" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">为了让你访问我的数据集，我需要做的就是给你数据集的名称和我的数据面板的帐户。现在您已经准备好访问它了！</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="1277" class="nl la it nh b gy nm nn l no np">import datapane as dp</span><span id="e70c" class="nl la it nh b gy nq nn l no np">df = dp.Blob.get('profile', owner='khuyentran1401').download_df()</span><span id="43d9" class="nl la it nh b gy nq nn l no np">df</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="4978" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">当然，为了让您访问我的数据，我需要将 blob 的可见性设置为“PUBLIC”</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="2633" class="kz la it bd lb lc ob le lf lg oc li lj jz od ka ll kc oe kd ln kf of kg lp lq bi translated">可变的</h1><p id="e08b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">像数据库密钥、密码或令牌这样的变量不应该嵌入到我们的代码中，尤其是当你的脚本对外界可见的时候。Datapane 的<code class="fe oz pa pb nh b">Variable</code>对象为<strong class="lt iu">提供了一种安全可靠的方式</strong>来创建、存储和检索脚本所需的值。</p><p id="08cd" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">例如，在这个脚本中，我使用了<code class="fe oz pa pb nh b">dp.Variable</code>来存储我的 Github 令牌和我的用户名，这样当我在 GitHub 上共享我的代码时，我就不需要担心我的令牌被暴露了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy ns l"/></div></figure><p id="3f12" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">这个变量对我来说是完全保密的，除非我用<code class="fe oz pa pb nh b">visibility='PUBLIC'.</code>指定每个人都可以访问它</p><p id="4809" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">如果另一个拥有不同账户的人想要访问我的<code class="fe oz pa pb nh b">github_token</code>变量并指定我为所有者，他们将会得到一个错误</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="827e" class="nl la it nh b gy nm nn l no np">requests.exceptions.HTTPError: 403 Client Error: Forbidden for url</span></pre><p id="dd61" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">因为我在私有模式下使用变量。</p><p id="4a89" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">另一个好处是:如果我碰巧在另一个脚本中重用了这个变量，我可以很容易地再次访问这个令牌，而不需要记住它是什么！</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="2ccc" class="kz la it bd lb lc ob le lf lg oc li lj jz od ka ll kc oe kd ln kf of kg lp lq bi translated">但是这不跟泡菜差不多吗？</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pd ns l"/></div></figure><p id="e563" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">对于那些熟悉 Python pickle 的人来说，您可能会看到 Datapane 的<code class="fe oz pa pb nh b">Blob</code>和<code class="fe oz pa pb nh b">Variable</code>的功能与 Python pickle 相似。是的，它们几乎是相似的，但是<code class="fe oz pa pb nh b">Blob</code>和<code class="fe oz pa pb nh b">Variable</code>与泡菜相比有 3 个主要的优点</p><ul class=""><li id="c516" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">有了<code class="fe oz pa pb nh b">Blob,</code>，其他人不需要为了得到相同的模型而建立与你相似的环境。例如，您可能<a class="ae ky" href="/guides/guide-creating-ml-model-form" rel="noopener ugc nofollow" target="_blank">在 Sagemaker </a>上训练一个模型，并希望在您的脚本中使用它。</li><li id="936a" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">您只需使用<code class="fe oz pa pb nh b">upload</code>上传更改，然后您的队友就可以使用<code class="fe oz pa pb nh b">get</code>查看更改，而无需将 pickle 文件发送给他人。</li><li id="017a" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">您可能会在新版本中意外出错，并希望回到旧版本(即训练错误的数据)。你可以在<code class="fe oz pa pb nh b">get</code>的参数中用<code class="fe oz pa pb nh b">version =</code>回到老版本</li></ul></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="9653" class="kz la it bd lb lc ob le lf lg oc li lj jz od ka ll kc oe kd ln kf of kg lp lq bi translated">结论</h1><p id="c402" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">恭喜你！您刚刚学习了如何使用 Datapane 的<code class="fe oz pa pb nh b">Blob</code>和<code class="fe oz pa pb nh b">Variable</code>来跨不同的脚本或不同的环境共享您的数据帧、文件、Python 对象和变量。</p><p id="e2d2" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">如果你的队友只需要一行代码就能看到你的结果，而不需要设置环境，他们会很高兴的。当你的队友可以像你一样访问相同的数据时，你会很高兴。</p><p id="6897" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">在<a class="ae ky" href="https://github.com/khuyentran1401/Data-science/blob/master/data_science_tools/blob_datapane.ipynb" rel="noopener ugc nofollow" target="_blank">这个 Github repo </a>中，您可以随意派生和使用本文的代码。</p><p id="524c" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">我喜欢写一些基本的数据科学概念，并尝试不同的算法和数据科学工具。你可以在 LinkedIn 和 Twitter 上与我联系。</p><p id="fcaa" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">如果你想查看我写的所有文章的代码，请点击这里。在 Medium 上关注我，了解我的最新数据科学文章，例如:</p><div class="og oh gp gr oi oj"><a rel="noopener follow" target="_blank" href="/how-to-create-fake-data-with-faker-a835e5b7a9d9"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">如何用 Faker 创建假数据</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">您可以收集数据或创建自己的数据</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="os l"><div class="pe l ou ov ow os ox ks oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a rel="noopener follow" target="_blank" href="/dictionary-as-an-alternative-to-if-else-76fe57a1e4af"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">字典作为 If-Else 的替代</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">使用字典创建一个更清晰的 If-Else 函数代码</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="os l"><div class="pf l ou ov ow os ox ks oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a rel="noopener follow" target="_blank" href="/how-to-monitor-and-log-your-machine-learning-experiment-remotely-with-hyperdash-aa7106b15509"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">如何使用 HyperDash 远程监控和记录您的机器学习实验</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">培训需要很长时间才能完成，但你需要去洗手间休息一下…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="os l"><div class="pg l ou ov ow os ox ks oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a rel="noopener follow" target="_blank" href="/how-to-accelerate-your-data-science-career-by-putting-yourself-in-the-right-environment-8316f42a476c"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">如何通过将自己置于合适的环境中来加速您的数据科学职业生涯</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">我感到增长数据科学技能停滞不前，直到我有了一个飞跃</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="os l"><div class="ph l ou ov ow os ox ks oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a rel="noopener follow" target="_blank" href="/how-to-create-reusable-command-line-f9a2bb356bc9"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">如何创建可重用的命令行</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">你能把你的多个有用的命令行打包成一个文件以便快速执行吗？</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="os l"><div class="pi l ou ov ow os ox ks oj"/></div></div></a></div></div></div>    
</body>
</html>