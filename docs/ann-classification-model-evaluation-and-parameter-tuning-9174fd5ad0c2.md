# ç¥ç»ç½‘ç»œä¼˜åŒ–çš„æ¨¡å‹è¯„ä¼°å’Œå‚æ•°è°ƒæ•´

> åŸæ–‡ï¼š<https://towardsdatascience.com/ann-classification-model-evaluation-and-parameter-tuning-9174fd5ad0c2?source=collection_archive---------30----------------------->

## ä½¿ç”¨ Keras çš„äº¤å‰éªŒè¯å’Œç½‘æ ¼æœç´¢çš„åˆ†æ­¥èµ°æŸ¥

![](img/d5de4ff5791827a40eac87e31eabad38.png)

Img æ”¹ç¼–è‡ª pixabay é€šè¿‡[é“¾æ¥](https://pixabay.com/photos/seo-sem-google-marketing-793035/)

åœ¨ä¹‹å‰çš„[æ–‡ç« ](https://medium.com/@vistaxjtu/ann-classification-banking-customer-leave-or-stay-1cba16441185)ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªäººå·¥ç¥ç»ç½‘ç»œæ¥è§£å†³ä¸€ä¸ªäºŒå…ƒåˆ†ç±»é—®é¢˜ã€‚**å¦‚æœä½ è¿˜è®°å¾—çš„è¯ï¼Œç•™åšå®¶åº­ä½œä¸šçš„ä¸€ä¸ªé—®é¢˜æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯¹æ–°å®¢æˆ·æ•°æ®ä½¿ç”¨[[]]ã€‚** *ç­”æ¡ˆæ˜¯æˆ‘ä»¬éœ€è¦å°†å®¢æˆ·æ•°æ®æ”¾å…¥ä¸€ä¸ªæ°´å¹³å‘é‡ä¸­ï¼Œè€Œä¸æ˜¯å‚ç›´å‘é‡ä¸­ï¼Œå› ä¸ºè¾“å…¥æ•°æ®ä¸­çš„æ‰€æœ‰è§‚å¯Ÿå€¼éƒ½æ˜¯è¡Œè€Œä¸æ˜¯åˆ—ã€‚å¸Œæœ›ä½ æ²¡å¼„é”™ğŸ˜*ã€‚**

æœ¬æ–‡ä¸»è¦å…³æ³¨æ¨¡å‹ä¼˜åŒ–çš„äº¤å‰éªŒè¯å’Œç½‘æ ¼æœç´¢ï¼Œåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:

1.  æ¨¡å‹è¯„ä¼°
2.  å‚æ•°è°ƒè°
3.  æ‘˜è¦

ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹æ—…ç¨‹ğŸƒâ€â™€ï¸ğŸƒâ€â™‚ï¸.

1.  **æ¨¡å‹è¯„ä¼°**

*ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦èŠ±ç²¾åŠ›åœ¨æ¨¡å‹è¯„ä¼°ä¸Š*ğŸ¤”*ï¼Ÿ*é—®é¢˜æ˜¯å¦‚æœæˆ‘ä»¬é‡æ–°è¿è¡Œ ANNï¼Œæ¯æ¬¡æ¨¡å‹ä¸ä»…åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šäº§ç”Ÿä¸åŒçš„ç²¾åº¦ã€‚å› æ­¤ï¼Œåœ¨ä¸€æ¬¡æµ‹è¯•ä¸­è¯„ä¼°æ¨¡å‹æ€§èƒ½å¹¶ä¸æ˜¯æœ€æ°å½“çš„æ–¹å¼ã€‚

å…¸å‹çš„æ–¹æ³•æ˜¯ä½¿ç”¨ K-fold äº¤å‰éªŒè¯ã€‚å›¾ 1 å±•ç¤ºäº†å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

![](img/3013659f589f55f69637d439faf15462.png)

å›¾ 1 K å€äº¤å‰éªŒè¯å›¾(ä½œè€…åˆ›å»ºçš„ Img)

æˆ‘ä»¬å°†è®­ç»ƒé›†åˆ†æˆ K ä¸ªæŠ˜å (ä¾‹å¦‚ï¼ŒK=10)ã€‚ç„¶ååœ¨ 9 ä¸ªè¤¶çš±ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œåœ¨æœ€åå‰©ä¸‹çš„è¤¶çš±ä¸Šæµ‹è¯•ã€‚10 æŠ˜ï¼Œæˆ‘ä»¬ç”¨ 9 ä¸ªè®­ç»ƒé›†å’Œ 1 ä¸ªæµ‹è¯•é›†åš 10 ä¸ªä¸åŒçš„ç»„åˆï¼Œè®­ç»ƒ/æµ‹è¯•æ¨¡å‹ 10 æ¬¡ã€‚ä¹‹åï¼Œæˆ‘ä»¬å– 10 æ¬¡è¯„ä¼°çš„å¹³å‡å€¼ï¼Œå¹¶è®¡ç®—æ ‡å‡†åå·®ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šæ¨¡å‹å±äºå“ªä¸ªç±»åˆ«ï¼Œå¦‚å›¾ 2 æ‰€ç¤ºã€‚

![](img/e96f21be360a219594576382696626a5.png)

å›¾ 2 åå·®-æ–¹å·®æƒè¡¡å›¾(Img ç”±ä½œè€…åˆ›å»º)

ä¸ºäº†å®ç° K-fold äº¤å‰éªŒè¯ï¼Œæˆ‘ä»¬åœ¨*Keras*:***Keras classifier***ä¸­ä½¿ç”¨äº†ä¸€ä¸ª ***scikit_learn*** åŒ…è£…å™¨ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨ ***Keras*** æ„å»ºæ¨¡å‹ï¼Œä½¿ç”¨ ***scikit_learn*** è¿›è¡Œäº¤å‰éªŒè¯ã€‚é¦–å…ˆè¦ä¸ºæ¨¡å‹æ¶æ„æ„å»ºä¸€ä¸ªå‡½æ•°ï¼Œå› ä¸ºè¯¥å‡½æ•°æ˜¯ ***Keras*** åŒ…è£…å™¨çš„å¿…éœ€å‚æ•°ã€‚æ­£å¦‚ä½ åœ¨ä¸‹é¢æ³¨æ„åˆ°çš„ï¼Œè¿™å’Œæˆ‘ä»¬ä¹‹å‰å»ºç«‹çš„äººå·¥ç¥ç»ç½‘ç»œç»“æ„æ˜¯ä¸€æ ·çš„ã€‚

```
from keras.wrappers.scikit_learn import KerasClassifier
from sklearn.model_selection import cross_val_score
from keras.models import Sequential
from keras.layers import Densedef build_classifier():
 classifier = Sequential()
 classifier.add(Dense(units = 6, kernel_initializer = â€˜uniformâ€™, activation = â€˜reluâ€™, input_dim = 11))
 classifier.add(Dense(units = 6, kernel_initializer = â€˜uniformâ€™, activation = â€˜reluâ€™))
 classifier.add(Dense(units = 1, kernel_initializer = â€˜uniformâ€™, activation = â€˜sigmoidâ€™))
 classifier.compile(optimizer = â€˜adamâ€™, loss = â€˜binary_crossentropyâ€™, metrics = [â€˜accuracyâ€™])
 return classifier
```

é€šè¿‡ä½¿ç”¨ä¸Šè¿°å‡½æ•°æ„å»ºçš„åˆ†ç±»å™¨ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª *KerasClassifier* å¯¹è±¡ã€‚ä¸‹é¢æˆ‘ä»¬æŒ‡å®šæ‰¹é‡å¤§å°ä¸º 10ï¼Œéœ€è¦è®­ç»ƒçš„æ¨¡å‹çš„æ—¶æœŸæ•°ä¸º 100ã€‚

```
classifier = KerasClassifier(build_fn = build_classifier, batch_size = 10, epochs = 100)
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨***cross _ val _ score()***æ–¹æ³•å¯¹åˆ†ç±»å™¨åº”ç”¨ K-fold äº¤å‰éªŒè¯ã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªè®­ç»ƒç²¾åº¦åˆ—è¡¨ã€‚å‚æ•° ***cv*** æ˜¯æˆ‘ä»¬ç”¨äºäº¤å‰éªŒè¯çš„æŠ˜å æ•°ã€‚è¿™é‡Œï¼Œåˆ†ç±»å™¨å°†åœ¨ 10 ä¸ªä¸åŒçš„è®­ç»ƒé›†ä¸Šè¿›è¡Œè®­ç»ƒï¼Œè¿™äº›è®­ç»ƒé›†æ˜¯ä»åˆå§‹è®­ç»ƒé›†ä¸­åˆ†ç¦»å‡ºæ¥çš„ã€‚

```
accuracies = cross_val_score(estimator = classifier, X = X_train, y = y_train, cv = 10)
mean = accuracies.mean()
std = accuracies.std()
```

åœ¨è¿™é‡Œï¼Œäº¤å‰éªŒè¯å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬å¾—åˆ°äº†å¦‚å›¾ 2 æ‰€ç¤ºçš„å‡†ç¡®åº¦ä¸º 10 çš„è¯„ä¼°ã€‚å¹³å‡å‡†ç¡®åº¦ä¸º 0.843ï¼Œæ ‡å‡†åå·®ä¸º 1.60%ğŸ¤ªã€‚

![](img/ea7e7d3427ef9e375143b5877e6c85a4.png)

å›¾ 2 äº¤å‰éªŒè¯çš„å‡†ç¡®æ€§

2.**å‚æ•°è°ƒè°**

æœ‰äº†å¯é çš„æ¨¡å‹å‡†ç¡®æ€§ï¼Œè®©æˆ‘ä»¬å°è¯•ä½¿ç”¨ä¸¤ç§æŠ€æœ¯æ¥æé«˜å®ƒã€‚

2.1 è¾å­¦æ­£è§„åŒ–

æˆ‘ä»¬æ²¡æœ‰æåˆ°çš„ä¸€ä¸ªæŠ€æœ¯æ˜¯**é€€å‡º**æ­£åˆ™åŒ–ã€‚**è¿™æ˜¯ä¸é«˜æ–¹å·®ç›¸å…³çš„è¿‡æ‹Ÿåˆçš„è§£å†³æ–¹æ¡ˆã€‚**è¾å­¦æ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Ÿåœ¨æ¯æ¬¡è®­ç»ƒè¿­ä»£ä¸­ï¼Œä¸€äº›ç¥ç»å…ƒè¢«éšæœºç¦ç”¨ï¼Œä»¥é˜²æ­¢å®ƒä»¬ç›¸äº’ä¾èµ–ã€‚é€šè¿‡è¦†ç›–è¿™äº›ç¥ç»å…ƒï¼Œç¥ç»ç½‘ç»œæ¯æ¬¡éƒ½ä¼šä¿ç•™ä¸åŒçš„ç¥ç»å…ƒé…ç½®ï¼Œå¸®åŠ©ç¥ç»ç½‘ç»œå­¦ä¹ æ•°æ®çš„ç‹¬ç«‹ç›¸å…³æ€§ã€‚è¿™å¯ä»¥é˜²æ­¢ç¥ç»å…ƒè¿‡åº¦å­¦ä¹ ã€‚

è®©æˆ‘ä»¬ä½¿ç”¨ ***Keras*** æ¥å®ç°å®ƒã€‚åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªéšè—å±‚åæ·»åŠ ä¸€ä¸ªé€€å‡ºå±‚ã€‚æ³¨æ„ *p* =0.1 æ„å‘³ç€æ¯æ¬¡è¿­ä»£å°†ç¦ç”¨ 10%çš„ç¥ç»å…ƒã€‚

```
from keras.layers import Dropout
classifier.add(Dense(output_dim = 6, init = â€˜uniformâ€™, activation = â€˜reluâ€™, input_dim = 11))
#add dropout layer
**classifier.add(Dropout(p =0.1))** classifier.add(Dense(output_dim = 6, init = â€˜uniformâ€™, activation = â€˜reluâ€™))
#add dropout layer
**classifier.add(Dropout(p =0.1))** #add output layer
classifier.add(Dense(output_dim = 1, init = â€˜uniformâ€™, activation = â€˜sigmoidâ€™))
```

2.2 å‚æ•°è°ƒæ•´

> ç¥ç»ç½‘ç»œæœ‰ä¸€äº›è¶…å‚æ•°ï¼Œå¦‚æ—¶æœŸæ•°ã€æ‰¹é‡å¤§å°å’Œå­¦ä¹ é€Ÿç‡ã€‚å‚æ•°è°ƒæ•´å°±æ˜¯æ‰¾åˆ°æ¨¡å‹çš„æœ€ä½³å‚æ•°ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨**ç½‘æ ¼æœç´¢**æ¥æµ‹è¯•å‚æ•°çš„ä¸åŒç»„åˆã€‚

ä¸ºäº†å®ç°å®ƒï¼Œæˆ‘ä»¬åœ¨*Keras*:***Keras classifier***ä¸­ä½¿ç”¨ä¸€ä¸ª ***scikit_learn*** åŒ…è£…å™¨æ¥åŒ…è£…ç¥ç»ç½‘ç»œã€‚ç„¶ååˆ›å»ºä¸€ä¸ªç½‘æ ¼æœç´¢å¯¹è±¡ï¼Œå¹¶åœ¨åŒ…è£…çš„åˆ†ç±»å™¨ä¸Šåº”ç”¨å‚æ•°è°ƒæ•´ã€‚é¦–å…ˆï¼Œå¦‚ä¸‹æ„å»ºåˆ†ç±»å™¨å‡½æ•°ã€‚

```
def build_classifier(optimizer):
 classifier = Sequential()
 classifier.add(Dense(units = 6, kernel_initializer = â€˜uniformâ€™, activation = â€˜reluâ€™, input_dim = 11))
 classifier.add(Dense(units = 6, kernel_initializer = â€˜uniformâ€™, activation = â€˜reluâ€™))
 classifier.add(Dense(units = 1, kernel_initializer = â€˜uniformâ€™, activation = â€˜sigmoidâ€™))
 classifier.compile(optimizer = optimizer, loss = â€˜binary_crossentropyâ€™, metrics = [â€˜accuracyâ€™])
 return classifierclassifier = KerasClassifier(build_fn = build_classifier)
```

**ä¸Šé¢æ³¨æ„ï¼Œæ²¡æœ‰æŒ‡å®šå†å…ƒæ•°å’Œæ‰¹é‡å¤§å°ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æˆ‘ä»¬è®¡åˆ’è°ƒä¼˜çš„å‚æ•°ï¼Œå°†åœ¨**ä¸‹é¢çš„ç½‘æ ¼æœç´¢å¯¹è±¡ä¸­æŒ‡å®šã€‚

è®©æˆ‘ä»¬ä¸ºå‚æ•°åˆ›å»ºä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬å¸Œæœ›æ¨¡å‹å°è¯•çš„å€¼ã€‚

```
parameters = {â€˜batch_sizeâ€™: [25, 32], â€˜nb_epochâ€™: [100, 500], â€˜optimizerâ€™: [â€˜adamâ€™, â€˜rmspropâ€™]}
```

å¦‚æœä½ æ³¨æ„åˆ°ä¸Šé¢ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå‚æ•°**ä¼˜åŒ–å™¨**ç”¨äº *build_classifier()* å‡½æ•°ã€‚è¯¥å‚æ•°æä¾›äº†ä¸€ç§è°ƒä¼˜ä¼˜åŒ–å™¨çš„æ–¹æ³•ã€‚ä¸ºäº†å®ç°ç½‘æ ¼æœç´¢ï¼Œæˆ‘ä»¬é¦–å…ˆç”¨åˆ†ç±»å™¨å’Œå‚æ•°åˆ›å»ºä¸€ä¸ª *GridSearchCV* ç±»çš„å¯¹è±¡ã€‚

```
grid_search = GridSearchCV(estimator=classifier, param_grid =parameters, scoring = â€˜accuracy, cv = 10â€™)
```

æœ€åï¼Œè®©æˆ‘ä»¬åœ¨è¿è¡Œç½‘æ ¼æœç´¢ä»¥æ‰¾åˆ°æœ€ä½³å‚æ•°çš„åŒæ—¶ï¼Œåœ¨è®­ç»ƒé›†ä¸Šæ‹Ÿåˆ ANNã€‚

```
grid_search = grid_search.fit(X_train, y_train)
```

æˆ‘ä»¬æœ€æ„Ÿå…´è¶£çš„æ˜¯äº§ç”Ÿæœ€é«˜ç²¾åº¦çš„æœ€ä½³å‚æ•°ã€‚æ‰€ä»¥æœ‰äº†ä¸‹æ–‡:

```
best_parameters = grid_search.best_params_
best_accuracy = grid_search.best_score_
```

æœ€åï¼Œå‡ ä¸ªå°æ—¶åï¼Œæˆ‘ä»¬çš„ç²¾ç¡®åº¦æé«˜åˆ°äº† 0.849 âœ¨âœ¨.æœ€ä½³å‚æ•°æ˜¯æ‰¹å¤„ç†å¤§å° 25ã€çºªå…ƒç¼–å· 500 å’Œä¼˜åŒ–å™¨ Adamï¼Œå¦‚å›¾ 3 æ‰€ç¤ºã€‚

![](img/58e8e7fa7bf6f6fcdbd52243d0a284f0.png)

å›¾ 3 å‚æ•°è°ƒæ•´çš„ç²¾åº¦

3.**æ€»ç»“**

ç»¼ä¸Šæ‰€è¿°ï¼Œé€šè¿‡äº¤å‰éªŒè¯ï¼Œæˆ‘ä»¬å‘ç°è¯¥æ¨¡å‹çš„ç²¾åº¦çº¦ä¸º 0.843ã€‚é€šè¿‡ä½¿ç”¨éšæœºä¸¢å¼ƒæ­£åˆ™åŒ–å’Œç½‘æ ¼æœç´¢ï¼Œæˆ‘ä»¬å°†æ¨¡å‹ç²¾åº¦æé«˜åˆ° 0.849ã€‚é€šå¸¸ï¼Œç½‘æ ¼æœç´¢å¯ä»¥åˆ†ä¸¤æ­¥è¿›è¡Œï¼Œç¬¬ä¸€æ­¥æ˜¯æ‰¾åˆ°å¤§è‡´èŒƒå›´ï¼Œå¦ä¸€å°æ­¥æ˜¯ç»†åŒ–æœ€ä½³èŒƒå›´ã€‚

**å¤ªå¥½äº†ï¼ä»…æ­¤è€Œå·²ï¼âœ¨âœ¨If ä½ éœ€è¦ä¸€äº›é¢å¤–çš„ï¼Œè®¿é—®æˆ‘çš„** [**Github**](https://github.com/luke4u/Customer_Behaviour_Prediction) **é¡µé¢ã€‚(ä»…ä¾›å‚è€ƒï¼Œå›è´­å¾—åˆ°ç§¯æç»´æŠ¤ğŸ’•ğŸ’•)**