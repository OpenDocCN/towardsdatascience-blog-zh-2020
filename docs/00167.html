<html>
<head>
<title>This Will Change the Way You Look at GANs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这会改变你对甘斯的看法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/this-will-change-the-way-you-look-at-gans-9992af250454?source=collection_archive---------8-----------------------#2020-01-06">https://towardsdatascience.com/this-will-change-the-way-you-look-at-gans-9992af250454?source=collection_archive---------8-----------------------#2020-01-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="01a8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">GAN学习和模式崩溃的实时可视化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e556fc9176e482cdbded2e4b86fd8c09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lmyM45Th9GswSi6pjO5wIg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">西安·莫洛伊插图</p></figure><blockquote class="kz"><p id="9923" class="la lb it bd lc ld le lf lg lh li lj dk translated">给手机用户的一个警告:这篇文章中有一些厚的gif图片。</p></blockquote><h1 id="0c8b" class="lk ll it bd lm ln lo lp lq lr ls lt lu jz lv ka lw kc lx kd ly kf lz kg ma mb bi translated">一个伪造者和一个侦探走进一家酒吧</h1><p id="c9e0" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk ml mm mn mo mp mq mr ms mt mu mv mw lj im bi translated">除非你在过去的几年里一直生活在岩石下，否则你肯定听说过围绕着生成性敌对网络(GANs)的喧嚣。特别是，他们创造新的、照片般逼真的图像的能力令人震惊。考虑以下图像:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/e103adc52ad9aa02fb73e149881e49c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2YuUYfS---5An2reuFK8IA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://github.com/tkarras/progressive_growing_of_gans" rel="noopener ugc nofollow" target="_blank"> pg-GAN </a>的输出(来源:英伟达)</p></figure><p id="d068" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">以上的人都不存在。这些“照片”是由NVIDIA的GANs技术的渐进增长创建的，只是越来越多的GAN开发中的一个例子。</p><p id="49cd" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">GAN技术背后的基本前提很简单:两个网络，一个生成器和一个鉴别器，被串联训练。鉴别器显示来自训练数据的真实样本(例如照片)和由生成器创建的假样本，并且任务是将真品与赝品分开。与此同时，生成器的任务是创建假样本，骗过鉴别器将其归类为真样本。发生器能够产生不同的输出，因为它接受随机噪声作为输入，通常以100个正态分布值的向量形式。在这种情况下，生成器可以被视为从某个潜在空间到样本空间的映射，而鉴别器可以被视为用于测量由生成器描述的样本空间中的分布和真实样本的真实分布之间的散度的工具。</p><p id="0e35" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">众所周知，甘人很难训练。在模式崩溃、无法收敛、循环和许多其他问题之间，GANs有许多失败模式，并以挑剔著称。GAN训练背后的中心思想是生成器创建样本，鉴别器告诉生成器它出错了什么。为了指导生成器，鉴别器必须能够将样本域中的每个点映射到该点是真实样本的概率。这听起来可能很简单，但像深度学习中的大多数事情一样，它在幕后相当复杂。为了帮助演示GAN训练的复杂性，我为一个非常简单的问题的训练过程创建了可视化效果。</p><h1 id="d6c9" class="lk ll it bd lm ln lo lp lq lr ls lt lu jz nd ka lw kc ne kd ly kf nf kg ma mb bi translated">问题是</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/b5a057af0a3353ae39e9ea4cb9255569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sKJzECUy0KFp1Lc015dnvA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:目标函数的输入空间(左)和相应的输出(右)。输入空间通常被称为潜在空间，输出空间被称为样本空间。</p></figure><p id="252d" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">考虑图1所示的映射。2D输入空间([-1，1]，[-1，1])被映射到一个螺旋，其中输入(潜在)空间中的x位置确定该点沿螺旋的距离(在样本空间中)，y位置确定该点在螺旋中的横向位置。下面是目标函数将随机输入转换为螺旋的可视化效果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/d3b489c9c110774b7c82ff660065fc5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*3bi7uLCy6zgJtqSdyK6z-g.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:应用于随机输入的目标函数的动画</p></figure><p id="3a12" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">因此，眼前的任务是训练一个能够从这种螺旋分布中产生点的GAN。由于原始函数具有两个自由度，GAN将被给予2D随机噪声作为输入。</p><h1 id="7caf" class="lk ll it bd lm ln lo lp lq lr ls lt lu jz nd ka lw kc ne kd ly kf nf kg ma mb bi translated">解决办法？</h1><p id="34e7" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk ml mm mn mo mp mq mr ms mt mu mv mw lj im bi translated">我训练了一个GAN 600步的训练步骤，每走一步就观想一遍。发生器和鉴别器都有三个带泄漏ReLU激活的全连接层。使用Adam优化器及其默认参数，生成器和鉴别器的学习率都设置为0.001。训练过程如图3所示；事情很多，所以让我们一个小组一个小组地过一遍。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/812a6c1d78c879b3d0f06354ae0b4002.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*Y54sbtFeMcbzH9rMwzl33A.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:GAN训练过程的动画。左上:发生器和鉴频器的损耗和精度。顶部中心:训练步骤。右上:真实样本和生成样本。左下角:潜在空间的鉴别器输出。右下:样本空间的鉴别器输出。</p></figure><h2 id="9ffe" class="ni ll it bd lm nj nk dn lq nl nm dp lu ml nn no lw mp np nq ly mt nr ns ma nt bi translated">左上角:精确度和损耗</h2><p id="a811" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk ml mm mn mo mp mq mr ms mt mu mv mw lj im bi translated">在左上角的面板中，您可以看到每个训练步骤的生成器和鉴别器的损耗(二进制交叉熵)和精度。两个损失都在<em class="nu"> ln(0.5)=0.69 </em>范围内徘徊，这表明鉴别器对其预测完全没有信心。生成器精度(<em class="nu">即</em>，它如何有效地欺骗鉴别器)通常是100%，偶尔会下降到0%，然后反弹到100%。</p><h2 id="622a" class="ni ll it bd lm nj nk dn lq nl nm dp lu ml nn no lw mp np nq ly mt nr ns ma nt bi translated">右上:真假样品</h2><p id="dc45" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk ml mm mn mo mp mq mr ms mt mu mv mw lj im bi translated">在每个训练步骤之后，绘制真实分布(蓝色)和生成分布(红色)。正如你所看到的，在大多数步骤中，发电机输出已经减少到一个非常小的范围内波动。特别值得注意的是，红色输出斑点在很大程度上保持不变，直到发生器精度降低或损耗增加，此时它会飞到范围的另一部分。</p><h2 id="e54f" class="ni ll it bd lm nj nk dn lq nl nm dp lu ml nn no lw mp np nq ly mt nr ns ma nt bi translated">左下角:潜在空间鉴别器输出</h2><p id="6581" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk ml mm mn mo mp mq mr ms mt mu mv mw lj im bi translated">左下方图解了潜在空间中每个点的鉴别器输出，其中深蓝色表示鉴别器认为“肯定是真的”，深红色表示“肯定是假的”，白色表示鉴别器没有想法。换句话说，该空间中的每个点都由生成器转换，然后由鉴别器分类，因此该面板说明了生成器如何有效地将潜在空间的每个部分映射到现实输出。</p><h2 id="e81d" class="ni ll it bd lm nj nk dn lq nl nm dp lu ml nn no lw mp np nq ly mt nr ns ma nt bi translated">右下角:样本空间鉴别器输出</h2><p id="79fc" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk ml mm mn mo mp mq mr ms mt mu mv mw lj im bi translated">该面板与左下方的面板非常相似，只是它显示的是样本空间而不是潜在空间。该面板中的每个点对应于样本空间中的一个2D点，颜色代表鉴别者对该点真实存在的信心。换句话说，它是由发生器产生的任何给定点相对于目标函数的相对频率的可视化。</p><h1 id="a797" class="lk ll it bd lm ln lo lp lq lr ls lt lu jz nd ka lw kc ne kd ly kf nf kg ma mb bi translated">这是怎么回事？</h1><p id="abaa" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk ml mm mn mo mp mq mr ms mt mu mv mw lj im bi translated"><strong class="me iu">你在上面的gif中看到的简单来说就是模式崩溃</strong>；发生器输出已经崩溃到一个很小的样本区域，鉴别器认为这些样本可能是真实的(图3，右上图)。当鉴别器得知这个区域中的大多数点是假的时，生成器简单地转移到鉴别器认为是真实的另一个区域。这一点从右下面板可以明显看出；蓝色区域是鉴别者认为更可能是真实的区域。因此，驱动发生器在该区域产生样本。尝试移动光标，使其始终位于右下角面板的最蓝区域；您会发现您的光标和右上角面板中的红色斑点沿着相同的轨迹围绕该范围移动。</p><p id="e6b9" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">你可能会认为生成器没有能力学习目标函数。我想可能是这种情况，但是这里有一个生成器通过监督回归学习目标函数的可视化，类似于图3中右上的面板:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/ca3952f3f3f1ce8b3976dc65767703bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*Tt4vuQaXWjuNlktv8iq9WQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:生成器通过监督回归学习目标函数的动画</p></figure><p id="53fb" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">你可能还会说，鉴别器没有学习目标函数的能力。我也认为可能是这种情况，但这里是鉴别器学习目标函数和均匀噪声之间的决策边界的可视化，类似于图3中的右下角面板:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/ef453d1dad186b19ff864db490c6ec6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*KC7k5hSb5d6-al2roHKVKA.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5:鉴别器通过监督分类学习由目标函数(蓝色)或均匀噪声(红色)产生的点的相对概率的动画。</p></figure><p id="c76b" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">最后，你可能会说GAN只是需要更多的时间来达成一个解决方案。不幸的是，即使经过几千步的训练，GAN仍然表现出与前600步完全相同的行为。这个过程看起来非常像下面这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/3cbea661bcb41de3c584b6f3bd500235.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*awWexbMmSB6svkcfEcxluQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6:模式崩溃阵痛中的甘(艺术家印象，来源:<a class="ae ky" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank">吉菲</a>)</p></figure><p id="4e5a" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">这里的主要问题是对鉴别器性质的误解。在讨论GANs时，鉴别器通常被描述为<strong class="me iu">能够预测给定样本是真是假</strong>。事实并非如此。鉴别器实际上做的是<strong class="me iu">分类一个给定的样本是来自真实的数据集还是由生成器创建的。</strong>这种区别很微妙，但请考虑下图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/6f4246bf49ef7bc9456c275d61e761c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Auy48UL9LvVrwNZ4DVAmug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图7:目标分布(蓝色，两者)与均匀噪声(红色，左侧)和发生器输出(红色，右侧)</p></figure><p id="e901" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">在左边，我们看到两类:真实样本(蓝色)和随机噪声(红色)。识别每个点上每个类的相对概率有助于形成一个信息丰富的鉴别器(事实上，这就是图5中的鉴别器是如何被训练的)。在右边，我们还可以看到两个类:真实样本(同样是蓝色)，以及生成器的输出(红色)。基于该数据训练的鉴别器是没有用的；它将得出结论，在那个小的红色区域内的任何样本都可能是由发生器产生的，而该区域之外的任何样本都可能是真实的样本。由此推断，鉴别器决定即使在范围的角上的点也可能是真实的样本，尽管它从未在该区域中见过样本。这鼓励生成器在那些极端区域产生点。最终，鉴别器了解到这个新区域很可能都是伪点<strong class="me iu">，而不知道原来的区域同样大部分是伪点，因为伪点不再在那里产生</strong>。</p><h1 id="3f5e" class="lk ll it bd lm ln lo lp lq lr ls lt lu jz nd ka lw kc ne kd ly kf nf kg ma mb bi translated">更好的解决方案</h1><p id="305f" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk ml mm mn mo mp mq mr ms mt mu mv mw lj im bi translated">关于模式崩溃的问题已经做了大量的研究，但是没有办法把所有的都放在一篇文章里。我们将应用一些常用技巧来改进训练:降低生成器学习率和Adam优化器的β1参数。在最初的训练过程中(图3)，我对生成器使用了0.001的学习率。我使用0.0002的学习率重复了这个过程，并将β1从0.9减少到0.5:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/ca16122ffc9009f4ed76156a76611377.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*tYFFczidK93UW3-9U19bSQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图8:GAN训练过程的动画。如图3所示，但是使用了更好的优化器参数</p></figure><p id="b406" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">在这里，生成器在探索样本空间方面做得更好，这反过来又导致了一个信息更丰富的鉴别器。如果我们允许GAN训练600 <em class="nu">千</em>步而不是600步，我们会看到以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/3afb7c1f5381cab66a69b09d057d2798.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0UttYlwv7EA7-Ikt34EC6g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图9:以降低的学习速率训练GAN 600000步的结果</p></figure><p id="a386" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">正如您所看到的，在这种情况下，鉴别器(右下角面板)比图3中了解到了更有用的相对分布，这导致了更有效的生成器(右上角面板)。在左下角的面板中，我们看到在潜在空间中有两个区域，生成器未能映射到欺骗鉴别器的样本，暗红色的垂直线；生成器将这些区域中的点映射到螺旋的负空间。这些区域的原因如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/6a418dcf28953583b16fa30465bb8c77.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*PTaJE-EEuFTtspa9NEJX7w.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图10:经过训练的生成器将随机输入映射到已学习的螺旋分布的动画</p></figure><p id="4e65" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">动画清楚地显示了平滑的潜在空间在这两个区域被切割，不像图2中所示的平滑函数。在潜在空间中靠近在一起但在线的相对侧的点在样本空间中彼此相距很远；线上的点介于两者之间，大多位于目标分布之外。尽管最简单的解决方案是让一个维度对应于沿着螺旋(长度)的位置<em class="nu">，而另一个维度对应于</em>螺旋(宽度)内的横向位置<em class="nu">，但是GAN反而陷入了一些涉及极端轮廓的局部最小值。这是GANs的一个常见问题，我们认为相似的特征在潜在空间中可能相差甚远，反之亦然。</em></p><h1 id="355d" class="lk ll it bd lm ln lo lp lq lr ls lt lu jz nd ka lw kc ne kd ly kf nf kg ma mb bi translated">结束语</h1><p id="dfc4" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk ml mm mn mo mp mq mr ms mt mu mv mw lj im bi translated">gan通常应用于高维图像数据，因此很容易舍本逐末。即使是生成模型的<code class="fe nx ny nz oa b">hello world</code>MNIST，也存在于784维空间。在一个简单的二维问题上训练一个GAN，并使过程的所有方面可视化，是获得对GAN整体的直观理解的有效方法。和往常一样，如果你花时间去想象一切，你会对你的发现感到惊讶。</p><p id="959b" class="pw-post-body-paragraph mc md it me b mf my ju mh mi mz jx mk ml na mn mo mp nb mr ms mt nc mv mw lj im bi translated">撰写本文时使用的所有代码，包括GAN培训和可视化，都可以从以下github repo获得:</p><div class="ob oc gp gr od oe"><a href="https://github.com/ConorLazarou/medium/tree/master/12019/visualizing_gan_spiral" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">ConorLazarou/培养基</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">GAN学习产生螺旋时的可视化效果</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">github.com</p></div></div><div class="on l"><div class="oo l op oq or on os ks oe"/></div></div></a></div></div></div>    
</body>
</html>