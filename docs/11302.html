<html>
<head>
<title>Analysing Time Series Interventions With causalimpact: Currency Fluctuations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分析具有因果影响的时间序列干预:货币波动</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analysing-time-series-interventions-with-causalimpact-currency-fluctuations-e6ab14a30768?source=collection_archive---------34-----------------------#2020-08-05">https://towardsdatascience.com/analysing-time-series-interventions-with-causalimpact-currency-fluctuations-e6ab14a30768?source=collection_archive---------34-----------------------#2020-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="52b8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们如何解释时间序列中的干预？</h2></div><p id="a198" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">免责声明:本文是在“原样”的基础上编写的，没有任何担保。它旨在提供数据科学概念的概述，不应被解释为投资建议或任何其他类型的专业建议。</em></p><p id="1ef6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当检查一个时间序列时，有一个<strong class="kk iu">干预</strong>在一个特定的点上影响该序列是很常见的。</p><p id="817f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这方面的一些例子可能是:</p><ul class=""><li id="8325" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated">导致销售显著变化的广告活动</li><li id="40b7" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">交通政策的积极变化降低了交通事故的死亡率</li><li id="a3c8" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">影响资产价格的经济政策变化</li></ul><p id="7426" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">分析干预效果的问题是，如果没有干预，人们就无法检查该序列的趋势。</p><p id="508e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，假设一家公司实施了一项广告活动，目的是促进销售。虽然可以在干预后记录销售数据，但如果没有干预，很难说<strong class="kk iu">的销售额</strong>会是多少。</p><h1 id="6baa" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">我们的例子</h1><p id="a57e" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">对于这个例子，让我们考虑一下利率变化对货币波动的影响。</p><p id="4cc8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当中央银行操纵利率时——这被假设为对一种货币有重大影响，因为它影响了该货币相对于市场上其他货币的感知价值。</p><p id="66e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，如果我们希望量化这种影响，该怎么办呢？让我们看看这是如何与<strong class="kk iu">因果影响</strong>包一起工作的。这个包最初是由 Google 为 R 开发的，但是在这个例子中我们将使用 Python 版本(pycasualimpact)。</p><p id="f17c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们考虑 2017 年英镑/美元的波动。</p><p id="d2e7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2017 年 11 月，英国央行决定加息。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mq"><img src="../Images/103c97de1ff6fcea42242ce804800c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XEyWPgl2ACR_e-BqWneWeg.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">资料来源:tradingeconomics.com</p></figure><p id="118a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用因果影响来尝试调查:</p><ol class=""><li id="41f5" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld ng ll lm ln bi translated">如果没有这种干预，英镑对美元的预测汇率会是多少</li><li id="2c37" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld ng ll lm ln bi translated">这种干预是否重要，是否影响了货币水平</li></ol><p id="d945" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了确定这种干预是否对时间序列有显著影响，我们必须使用合适的协变量(X)。这个协变量不能受到干预的影响。</p><p id="8634" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以看到，2017 年，欧洲央行维持利率不变(此后一直如此):</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nh"><img src="../Images/bec9d0fd744654d366d9b936d6bc3308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*br-5-uZIuCmn-IsKiQSfsQ.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">资料来源:tradingeconomics.com</p></figure><p id="cc1e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">考虑到这一点，欧元/美元将被用作本例的协变量。</p><pre class="mr ms mt mu gt ni nj nk nl aw nm bi"><span id="71e0" class="nn lu it nj b gy no np l nq nr">X = eurusd<br/>y = gbpusd</span></pre><p id="0667" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然假设货币会受到美元波动以及许多其他宏观经济条件的影响，但假设英格兰银行的干预不会影响欧元/美元。</p><h1 id="d004" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">分析</h1><p id="1245" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">使用 Quandl 从 FRED 数据库下载相关的货币对:</p><pre class="mr ms mt mu gt ni nj nk nl aw nm bi"><span id="af94" class="nn lu it nj b gy no np l nq nr">&gt;&gt;&gt; eurusd = quandl.get("FRED/DEXUSEU", start_date='2017-01-01', end_date='2018-01-01', api_key='enter_api_key')</span><span id="44b6" class="nn lu it nj b gy ns np l nq nr">&gt;&gt;&gt; gbpusd = quandl.get("FRED/DEXUSUK", start_date='2017-01-01', end_date='2018-01-01', api_key='enter_api_key')<br/>gbpusd</span></pre><p id="62be" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是两种货币对的图表:</p><h2 id="6c85" class="nn lu it bd lv nt nu dn lz nv nw dp md kr nx ny mf kv nz oa mh kz ob oc mj od bi translated">英镑/美元</h2><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/b2ce92f3f1418a345162482607e84b30.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*pSpSgIO4C8ZGKGH7hOY3Aw.png"/></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">资料来源:美联储经济数据</p></figure><h2 id="62f7" class="nn lu it bd lv nt nu dn lz nv nw dp md kr nx ny mf kv nz oa mh kz ob oc mj od bi translated">欧元/美元</h2><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/d3af07a1991de3d3dcc4bef0c5bf6862.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*sCiA0Zv_APCU4qKGFyLv8A.png"/></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">资料来源:美联储经济数据</p></figure><p id="1cb8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随着英国央行在 2017 年 11 月 2 日做出利率决定，<em class="le"> t = 0 至 229 </em>被定义为前期(干预前)，而<em class="le"> t = 230 至 248 </em>被定义为后期(干预后)。</p><pre class="mr ms mt mu gt ni nj nk nl aw nm bi"><span id="053b" class="nn lu it nj b gy no np l nq nr">data = pd.DataFrame({'y': y, 'X': X}, columns=['y', 'X'])<br/>pre_period = [0, 229]<br/>post_period = [230, 248]</span></pre><p id="0bc2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据这个软件包的官方 GitHub，这个模型“使用经典的卡尔曼滤波方法来求解状态空间方程”。</p><p id="df3b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">后验推断可以如下产生:</p><pre class="mr ms mt mu gt ni nj nk nl aw nm bi"><span id="7f14" class="nn lu it nj b gy no np l nq nr">&gt;&gt;&gt; ci = CausalImpact(data, pre_period, post_period)<br/>&gt;&gt;&gt; print(ci.summary())<br/>&gt;&gt;&gt; print(ci.summary(output='report'))<br/>&gt;&gt;&gt; ci.plot()</span></pre><p id="1324" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是生成的输出:</p><pre class="mr ms mt mu gt ni nj nk nl aw nm bi"><span id="2d0a" class="nn lu it nj b gy no np l nq nr">Posterior Inference {Causal Impact}<br/>                          Average            Cumulative<br/>Actual                    1.34               25.46<br/>Prediction (s.d.)         1.32 (0.0)         25.17 (0.08)<br/>95% CI                    [1.32, 1.33]       [25.01, 25.33]<br/><br/>Absolute effect (s.d.)    0.02 (0.0)         0.29 (0.08)<br/>95% CI                    [0.01, 0.02]       [0.13, 0.45]<br/><br/>Relative effect (s.d.)    1.15% (0.32%)      1.15% (0.32%)<br/>95% CI                    [0.52%, 1.77%]     [0.52%, 1.77%]<br/><br/>Posterior tail-area probability p: 0.0<br/>Posterior prob. of a causal effect: 100.0%</span></pre><p id="fdf3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据上述发现，英镑/美元的实际汇率为<strong class="kk iu"> 1.34 </strong>，而在没有干预的情况下，该汇率将为<strong class="kk iu"> 1.32 </strong>。</p><p id="421e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，该模型表明，有一个 100%的因果关系的后验概率。</p><p id="beec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在分析更详细的报告时，输出还指出:</p><blockquote class="of og oh"><p id="1d5c" class="ki kj le kk b kl km ju kn ko kp jx kq oi ks kt ku oj kw kx ky ok la lb lc ld im bi translated">偶然获得这个效果的概率很小<br/>(贝叶斯单侧尾区概率 p = 0.0)。<br/>这意味着因果关系可以被认为是统计上<br/>显著的。</p></blockquote><p id="aa29" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从这个角度来看，有证据表明英镑/美元的走势比没有加息的情况下更高。以下是实际比率与预测比率的概述:</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ol"><img src="../Images/2596aacb3d6ffaab42c24d004ff62726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G99yRjey36D1pIf4-WTglg.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="c7a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如前所述，Python 使用了一种不同于 R 的方法来生成预测，无需干预——后者更依赖于强调用户先验知识的贝叶斯方法。事实上，人们可以尝试这两种方法来验证生成的预测是否一致。</p><h1 id="8843" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">关于对数变换的一个注记</h1><p id="7744" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">在处理资产价格数据时，通常的做法是将数据转换成对数格式。</p><p id="6036" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样做有两个原因:</p><ol class=""><li id="8676" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld ng ll lm ln bi translated">能够比较不同价格范围的资产，例如，比较 200 美元股票和 2000 美元股票的变动</li><li id="d99e" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld ng ll lm ln bi translated">考虑百分比方面的波动</li></ol><p id="ba87" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的例子中，两种货币具有相似的标度，因为它们都以美元为基准。在这方面，没有使用对数变换。</p><p id="b09a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，在我们试图分析的干预背景下，货币价格比股票价格相距更近的事实将使价格变化难以察觉。</p><p id="6842" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，如果将这种转换应用到数据上会怎么样呢？是否仍然观察到统计上显著的因果影响？</p><p id="fd06" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是以对数形式表示的两个时间序列:</p><p id="0f21" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">欧元/美元</strong></p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/1cc3fbbf9d7e3fd2b76d953e9f3fc51d.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*FpBu_dO0pFERyox_f0Ymug.png"/></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="d8f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">英镑/美元</strong></p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/72dcc804e87fa883d503b002adef5996.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*Eu6FC7Oy88_Wceg7X1nc8A.png"/></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="46e5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对经过对数转换的数据运行时，输出结果如下:</p><pre class="mr ms mt mu gt ni nj nk nl aw nm bi"><span id="6e10" class="nn lu it nj b gy no np l nq nr">Posterior Inference {Causal Impact}<br/>                          Average            Cumulative<br/>Actual                    0.29               5.56<br/>Prediction (s.d.)         0.28 (0.0)         5.34 (0.07)<br/>95% CI                    [0.27, 0.29]       [5.21, 5.47]<br/><br/>Absolute effect (s.d.)    0.01 (0.0)         0.22 (0.07)<br/>95% CI                    [0.0, 0.02]        [0.09, 0.35]<br/><br/>Relative effect (s.d.)    4.1% (1.22%)       4.1% (1.22%)<br/>95% CI                    [1.68%, 6.47%]     [1.68%, 6.47%]<br/><br/>Posterior tail-area probability p: 0.0<br/>Posterior prob. of a causal effect: 100.0%</span></pre><p id="d089" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用对数表示，如果没有干预，英镑/美元的自然对数应该是 0.28。然而，实际结果是 0.29。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ol"><img src="../Images/69d76ac89e89be1250b491cc88fdcfa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MNcAJdmi5NdSiAdOBspHQ.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="3d41" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，即使进行了对数变换，干预仍会显示为改变了时间序列的轨迹。这两种货币的比例仍然有很大的不同，在这种情况下是否需要对数变换仍有争议(这种变换通常对比例偏差较大的大值最有效)。</p><p id="0c3d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，证据表明，干预导致了有关时间序列的变化。</p><h1 id="ab5d" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">结论</h1><p id="27a8" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">这是对<strong class="kk iu">因果影响</strong>库的一个介绍性示例，以及如何在一个时间序列中检查干预的效果。</p><p id="c576" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">非常感谢您的时间，任何问题或反馈都非常欢迎。</p><h1 id="d890" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">参考</h1><ul class=""><li id="5f48" class="lf lg it kk b kl ml ko mm kr om kv on kz oo ld lk ll lm ln bi translated"><a class="ae op" href="https://github.com/dafiti/causalimpact" rel="noopener ugc nofollow" target="_blank">GitHub:dafi ti/causal impact</a></li><li id="08da" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><a class="ae op" href="https://www.youtube.com/watch?v=GTgZfCltMm8" rel="noopener ugc nofollow" target="_blank">凯·布罗德森利用因果关系推断事件的影响</a></li><li id="2787" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><a class="ae op" href="https://www.investing.com/economic-calendar/interest-rate-decision-170" rel="noopener ugc nofollow" target="_blank"> investing.com:英国利率决定</a></li></ul></div></div>    
</body>
</html>