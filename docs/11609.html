<html>
<head>
<title>5x Faster Scikit-Learn Parameter Tuning in 5 Lines of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">速度快 5 倍的 sci kit-在 5 行代码中学习参数调整</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5x-faster-scikit-learn-parameter-tuning-in-5-lines-of-code-be6bdd21833c?source=collection_archive---------3-----------------------#2020-08-12">https://towardsdatascience.com/5x-faster-scikit-learn-parameter-tuning-in-5-lines-of-code-be6bdd21833c?source=collection_archive---------3-----------------------#2020-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="20ac" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用<a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> Tune-sklearn </a>来增强和扩展 scikit-learn 的 GridSearchCV。</h2></div><p id="34e0" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><em class="lf">由</em> <a class="ae ki" href="http://mchau.pythonanywhere.com/" rel="noopener ugc nofollow" target="_blank">到<em class="lf">麦洲</em></a><em class="lf"/><a class="ae ki" href="http://anthonyhsyu.com" rel="noopener ugc nofollow" target="_blank"><em class="lf">安东尼于</em></a><em class="lf"/><a class="ae ki" href="http://people.eecs.berkeley.edu/~rliaw/" rel="noopener ugc nofollow" target="_blank"><em class="lf">理查德李奥</em> </a></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/484fabf7d96cca9f5ea9461e234b6b9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9YB2yByydC5lHfdwjm4fdA.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated"><em class="lw">作者图片</em></p></figure><p id="8be3" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">每个人都知道 Scikit-Learn——它是数据科学家的主食，提供了几十种易于使用的机器学习算法。它还提供了两种现成的技术来解决超参数调优:网格搜索(GridSearchCV)和随机搜索(RandomizedSearchCV)。</p><p id="054a" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">这两种技术虽然有效，但都是寻找正确的超参数配置的强力方法，这是一个昂贵且耗时的过程！</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lx"><img src="../Images/381b5044b07d41e4f39490a680689d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5XH-s6fim55yQgAgM5wHQA.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated"><em class="lw">作者图片</em></p></figure><h2 id="b502" class="ly lz it bd ma mb mc dn md me mf dp mg ks mh mi mj kw mk ml mm la mn mo mp mq bi translated">如果你想加快这个过程呢？</h2><p id="3eab" class="pw-post-body-paragraph kj kk it kl b km mr ju ko kp ms jx kr ks mt ku kv kw mu ky kz la mv lc ld le im bi translated">在这篇博文中，我们介绍<a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> tune-sklearn </a>。<a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> Tune-sklearn </a>是 Scikit-Learn 的模型选择模块的<strong class="kl iu">替代产品</strong>，采用尖端的超参数调整技术(贝叶斯优化、提前停止、分布式执行)——这些技术提供了比网格搜索和随机搜索显著的加速！</p><p id="5f70" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">以下是<a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> tune-sklearn </a>提供的内容:</p><ul class=""><li id="17f5" class="mw mx it kl b km kn kp kq ks my kw mz la na le nb nc nd ne bi translated"><strong class="kl iu">与 Scikit-Learn API 的一致性:</strong> <a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> tune-sklearn </a>是 GridSearchCV 和 RandomizedSearchCV 的替代产品，因此您只需在标准 Scikit-Learn 脚本中更改不到 5 行就可以使用该 API。</li><li id="a61b" class="mw mx it kl b km nf kp ng ks nh kw ni la nj le nb nc nd ne bi translated"><strong class="kl iu">现代超参数调优技术:</strong> <a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> tune-sklearn </a>允许您通过简单切换几个参数，轻松利用贝叶斯优化、HyperBand 和其他优化技术。</li><li id="fa1d" class="mw mx it kl b km nf kp ng ks nh kw ni la nj le nb nc nd ne bi translated"><strong class="kl iu">框架支持:</strong> <a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> tune-sklearn </a>主要用于调优 Scikit-Learn 模型，但它也支持许多其他具有 Scikit-Learn 包装器的框架并提供示例，如 Skorch (Pytorch)、KerasClassifiers (Keras)和 XGBoostClassifiers (XGBoost)。</li><li id="2726" class="mw mx it kl b km nf kp ng ks nh kw ni la nj le nb nc nd ne bi translated"><strong class="kl iu">纵向扩展:</strong> <a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> Tune-sklearn </a>利用<a class="ae ki" href="http://tune.io/" rel="noopener ugc nofollow" target="_blank"> Ray Tune </a>，一个用于分布式超参数调整的库，在多个内核甚至多个机器上高效、透明地并行化交叉验证。</li></ul><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nk"><img src="../Images/a7d58e6d02d6be42091faf3c2a9130a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cAz7KsGwkwYiQK2XrfJx0A.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated"><a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> tune-sklearn </a>支持的框架示例。</p></figure><p id="1735" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> Tune-sklearn </a>也是<strong class="kl iu">快</strong>。为了看到这一点，我们在标准超参数扫描上用本机 Scikit-Learn 对<a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> tune-sklearn </a>(启用了早期停止)进行了基准测试。在我们的基准测试中，我们可以看到普通笔记本电脑和 48 个 CPU 内核的大型工作站的显著性能差异。</p><p id="18c8" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">对于更大的基准 48 核计算机，Scikit-Learn 花了 20 分钟来搜索超过 75 个超参数集的 40，000 大小的数据集。Tune-sklearn 只用了 3 分半钟——牺牲了最小的准确性。*</p><div class="lh li lj lk gt ab cb"><figure class="nl ll nm nn no np nq paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><img src="../Images/24f8df37be4caf99e4eb76adcfc3d537.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*7nWc03v4QLEKaF3iHkJPFA.png"/></div></figure><figure class="nl ll nr nn no np nq paragraph-image"><img src="../Images/e1d27d95390c0c4fe3ea71dd3e60b816.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*IbMfcTyKk56C-AkFDKoN1Q.png"/><p class="ls lt gj gh gi lu lv bd b be z dk ns di nt nu translated">左图:在个人双核 i5 8GB RAM 笔记本电脑上，使用 6 种配置的参数网格。右图:在使用 75 种配置的参数网格的大型 48 核 250 GB RAM 计算机上。</p></figure></div><p id="fc69" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><em class="lf"> *注意:对于较小的数据集(10，000 或更少的数据点)，在尝试适应早期停止时可能会牺牲准确性。我们预计这不会对用户产生影响，因为该库旨在加速大型数据集的大型训练任务。</em></p><h1 id="edbf" class="nv lz it bd ma nw nx ny md nz oa ob mg jz oc ka mj kc od kd mm kf oe kg mp of bi translated">简单的 60 秒演练</h1><p id="514d" class="pw-post-body-paragraph kj kk it kl b km mr ju ko kp ms jx kr ks mt ku kv kw mu ky kz la mv lc ld le im bi translated">让我们来看看它是如何工作的。</p><p id="7602" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">运行<code class="fe og oh oi oj b">pip install tune-sklearn ray[tune]</code>或<code class="fe og oh oi oj b">pip install tune-sklearn "ray[tune]"</code>开始使用下面的示例代码。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ok"><img src="../Images/d1ebcd77dd06ad34c5102bd4378da29e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yvXlXlEqR4wQLIwkHwpHFQ.gif"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">超参数集 2 是一组没有希望的超参数，它们将被 tune 的早期停止机制检测到，并被早期停止以避免浪费训练时间和资源。</p></figure><h1 id="ca53" class="nv lz it bd ma nw nx ny md nz oa ob mg jz oc ka mj kc od kd mm kf oe kg mp of bi translated">TuneGridSearchCV 示例</h1><p id="d9d1" class="pw-post-body-paragraph kj kk it kl b km mr ju ko kp ms jx kr ks mt ku kv kw mu ky kz la mv lc ld le im bi translated">首先，只需修改我们的 import 语句，就可以获得 Tune 的网格搜索交叉验证接口:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="21a0" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">从那里，我们将像在 Scikit-Learn 的界面中那样继续进行！让我们使用一个“虚拟”自定义分类数据集和一个<code class="fe og oh oi oj b">SGDClassifier</code>来对数据进行分类。</p><p id="19f8" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们选择<code class="fe og oh oi oj b">SGDClassifier</code>是因为它有一个<code class="fe og oh oi oj b">partial_fit</code> API，这使它能够停止拟合某个超参数配置的数据。如果估计器不支持提前停止，我们将退回到并行网格搜索。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="01d4" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如您所见，这里的设置正是您为 Scikit-Learn 所做的！现在，让我们试着拟合一个模型。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="95e6" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">请注意我们上面介绍的细微差别:</p><ol class=""><li id="2e63" class="mw mx it kl b km kn kp kq ks my kw mz la na le on nc nd ne bi translated">新的<code class="fe og oh oi oj b">early_stopping</code>变量，以及</li><li id="1c07" class="mw mx it kl b km nf kp ng ks nh kw ni la nj le on nc nd ne bi translated"><code class="fe og oh oi oj b">max_iters</code>参数的说明</li></ol><p id="5586" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><code class="fe og oh oi oj b">early_stopping</code>决定何时提前停止——MedianStoppingRule 是一个很好的默认设置，但是请参见 Tune 关于调度器的文档<a class="ae ki" href="https://docs.ray.io/en/master/tune-schedulers.html" rel="noopener ugc nofollow" target="_blank">这里</a>有一个完整的列表可供选择。<code class="fe og oh oi oj b">max_iters</code>是给定超参数集<em class="lf">可以运行</em>的最大迭代次数；如果提前停止，它可能会运行较少的迭代。</p><p id="8c99" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">试着将它与 GridSearchCV 的等价内容进行比较。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ol om l"/></div></figure><h1 id="2b11" class="nv lz it bd ma nw nx ny md nz oa ob mg jz oc ka mj kc od kd mm kf oe kg mp of bi translated">TuneSearchCV 贝叶斯优化示例</h1><p id="6b60" class="pw-post-body-paragraph kj kk it kl b km mr ju ko kp ms jx kr ks mt ku kv kw mu ky kz la mv lc ld le im bi translated">除了网格搜索接口，<a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> tune-sklearn </a>还提供了一个接口 TuneSearchCV，用于从超参数分布中采样。</p><p id="85a6" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">此外，只需修改几行代码，就可以轻松地对 TuneSearchCV 中的分布进行贝叶斯优化。</p><p id="d15a" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">运行<code class="fe og oh oi oj b">pip install scikit-optimize</code>来测试这个例子:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ol om l"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">第 17、18 和 26 行是为了支持贝叶斯优化而修改的唯一几行代码</p></figure><p id="68f9" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如你所见，将<a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> tune-sklearn </a>集成到现有代码中非常简单。查看更多详细示例并开始使用<a class="ae ki" href="https://github.com/ray-project/tune-sklearn" rel="noopener ugc nofollow" target="_blank"> tune-sklearn 点击</a>让我们知道您的想法！还可以看看 Ray 对 joblib 的<a class="ae ki" href="/distributed-computing-with-ray/easy-distributed-scikit-learn-training-with-ray-54ff8b643b33" rel="noopener ugc nofollow" target="_blank">替代</a>，它允许用户在多个节点上并行训练，而不仅仅是一个节点，从而进一步加快训练速度。</p><h1 id="1df4" class="nv lz it bd ma nw nx ny md nz oa ob mg jz oc ka mj kc od kd mm kf oe kg mp of bi translated">文档和示例</h1><ul class=""><li id="e775" class="mw mx it kl b km mr kp ms ks oo kw op la oq le nb nc nd ne bi translated"><a class="ae ki" href="https://docs.ray.io/en/master/tune/api_docs/sklearn.html" rel="noopener ugc nofollow" target="_blank">文献</a> *</li><li id="66f0" class="mw mx it kl b km nf kp ng ks nh kw ni la nj le nb nc nd ne bi translated">示例:<a class="ae ki" href="https://github.com/ray-project/tune-sklearn/blob/master/examples/torch_nn.py" rel="noopener ugc nofollow" target="_blank">带 tune-sklearn 的 sko rch</a></li><li id="0b1a" class="mw mx it kl b km nf kp ng ks nh kw ni la nj le nb nc nd ne bi translated">示例:<a class="ae ki" href="https://github.com/ray-project/tune-sklearn/blob/master/examples/sklearn_pipeline.py" rel="noopener ugc nofollow" target="_blank">sci kit-Learn Pipelines with tune-sk Learn</a></li><li id="0c8c" class="mw mx it kl b km nf kp ng ks nh kw ni la nj le nb nc nd ne bi translated">示例:<a class="ae ki" href="https://github.com/ray-project/tune-sklearn/blob/master/examples/xgbclassifier.py" rel="noopener ugc nofollow" target="_blank"> XGBoost 带 tune-sklearn </a></li><li id="5991" class="mw mx it kl b km nf kp ng ks nh kw ni la nj le nb nc nd ne bi translated">示例:<a class="ae ki" href="https://github.com/ray-project/tune-sklearn/blob/master/examples/keras_example.py" rel="noopener ugc nofollow" target="_blank">带 tune-sklearn 的角膜分类器</a></li><li id="687f" class="mw mx it kl b km nf kp ng ks nh kw ni la nj le nb nc nd ne bi translated">示例:<a class="ae ki" href="https://github.com/ray-project/tune-sklearn/blob/master/examples/lgbm.py" rel="noopener ugc nofollow" target="_blank">带 tune-sklearn 的 LightGBM】</a></li></ul><p id="52f3" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><em class="lf">*注:如链接文档所示，从</em> <code class="fe og oh oi oj b"><em class="lf">ray.tune</em></code> <em class="lf">导入仅适用于夜间光线控制盘，并将很快在 pip 上提供</em></p></div></div>    
</body>
</html>