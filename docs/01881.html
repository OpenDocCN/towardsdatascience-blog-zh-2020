<html>
<head>
<title>Deep Learning using GPU on your MacBook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在MacBook上使用GPU进行深度学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-learning-using-gpu-on-your-macbook-c9becba7c43?source=collection_archive---------2-----------------------#2020-02-22">https://towardsdatascience.com/deep-learning-using-gpu-on-your-macbook-c9becba7c43?source=collection_archive---------2-----------------------#2020-02-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="90a7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用PlaidML并利用AMD/Intel GPU进行深度学习</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fdcc68d5927149cc9febaca959b46964.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E_vlPFo1ME7aUJydI2ZQ4Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我有GPU，我学得很深</p></figure><p id="2bd1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为一名<strong class="la iu"> <em class="lu"> MacBook Pro </em> </strong>的拥有者，我意识到无法利用其GPU进行深度学习的沮丧，考虑到难以置信的质量和纹理，当然还有它的<strong class="la iu">价格</strong>。我还记得当我在MacBook Pro 13 '和15 '之间选择时，当时我对数据科学一点都不熟悉，我选择15 '只是因为它有一个独立的AMD GPU。很快我发现，在机器学习&amp;深度学习方面，额外的一块GPU <strong class="la iu">几乎没有带来任何帮助</strong>。长期以来，大多数现代机器学习模型只能通过通用GPU库<a class="ae lv" href="https://en.wikipedia.org/wiki/CUDA" rel="noopener ugc nofollow" target="_blank"> CUDA </a>来利用Nvidia GPUs。</p><p id="068a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，现在已经是2020年了，今天的事情可能会有点不同:<strong class="la iu"> PlaidML </strong>最初是由<em class="lu"> Vertex在2017年发布的。AI </em>旨在带来<em class="lu">“面向每个平台的深度学习”</em>。自从2018年被<em class="lu">英特尔</em>收购以及之后的0.3.3版本发布以来，你可以利用你的AMD和英特尔GPU用Keras做并行深度学习工作。自今年1月15日发布0.7.0版本以来，<strong class="la iu"> PlaidML </strong>为所有主要目标的GPU &amp; CPU提供了完整的条带后端。但首先，<strong class="la iu">我们为什么需要用GPU做并行计算？</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/84c5fc374f35677e0303121962357c3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lir4TyPU2hlhMQsS4aATcA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">房屋建筑的例子</p></figure><p id="082f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们以建造一所房子为例:如果你独自一人，比方说建造房子可能需要400个小时。然而，如果你雇佣一个额外的建筑工人和你一起建造，只需要200个小时，因为你把工作分成了一半。同样，你雇佣的工人越多，你就能越快地把房子建好。有一个众所周知的<a class="ae lv" href="https://en.wikipedia.org/wiki/Amdahl%27s_law" rel="noopener ugc nofollow" target="_blank">阿姆达尔定律</a>描述了当我们增加更多的处理器(工作者)时，一个程序可以加速到什么程度。</p><p id="0d28" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧，那么<strong class="la iu">为什么要用GPU呢？</strong>GPU，也就是众所周知的图形处理单元，显然一开始就不是为做深度学习而设计的。然而，<strong class="la iu">并行计算的本质似乎与图形处理</strong>类似:GPU的内核虽然较弱，但由于其<strong class="la iu">高度并行的结构和内核数量</strong>，对于处理大数据块的算法来说，GPU的内核比CPU更高效(GPU由数百个计算能力较弱的内核组成，而CPU通常由4到32个更强大的内核组成)。由于图形处理和深度学习的内在本质相似(大多数操作可以同时完成，而不是一个接一个)，GPU成为深度学习和并行计算时自然的首选。</p><p id="b0f6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我最喜欢的一句来自<a class="ae lv" href="https://en.wikipedia.org/wiki/Linus_Torvalds" rel="noopener ugc nofollow" target="_blank"> <em class="lu"> Linus Torvalds </em> </a>的名言所说:</p><blockquote class="lx ly lz"><p id="fc09" class="ky kz lu la b lb lc ju ld le lf jx lg ma li lj lk mb lm ln lo mc lq lr ls lt im bi translated">“空谈是廉价的。给我看看代码。”</p></blockquote><p id="bdfa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们动手，使用您自己的笔记本电脑，使用您的GPU运行一个简单的CNN案例！</p><h1 id="08a0" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">1.安装和设置PlaidML和相关组件</h1><p id="6eeb" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">首先，确保你的笔记本电脑有一个工作的Python3环境。我建议随时在虚拟环境下运行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="dfe9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请记住，TensorFlow下的Keras将无法使用PlaidML。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/489d08e9ae3f25fd13d48c6e32ea8d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uWw8R4jFwQcx_V7647QMjg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置PlaidML第1部分</p></figure><p id="cbe1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先你会看到一个欢迎页面和一个询问你是否使用实验设备支持的问题。正如它所建议的，使用实验设备会导致性能下降、崩溃和其他问题，您可以键入“n”或什么都不输入，然后返回选择使用默认配置设备。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/7e03344b465a8557168f9cb0366b6a8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EslKovXwv4yg4cXrYNB4GQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置PlaidML第2部分</p></figure><p id="9608" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在你得到了一个你可以选择的所有设备的列表。对于我的Macbook Pro 15' 2018，以下选项为:</p><ol class=""><li id="ef89" class="ne nf it la b lb lc le lf lh ng ll nh lp ni lt nj nk nl nm bi translated">我的CPU</li><li id="42b8" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">我的英特尔UHD显卡630 GPU</li><li id="0a83" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">我的AMD镭龙pro 560x GPU</li></ol><p id="362b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我选择3是因为AMD是目前最强大的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/db1750dfcae686201ddd8b320ca06aa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bC3D-WsCoEcjOytJuBI31w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置PlaidML第3部分</p></figure><p id="a50b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，键入“y”或什么都不输入，然后返回保存设置。现在，您已经完全设置好了，并准备好使用您的GPU进行深度学习项目。</p><h1 id="318c" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">2.在时尚mnist数据集上构建简单CNN分类器的教程:</h1><p id="8c95" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">首先，让我们启动一个Jupyter笔记本。(不确定为什么使用Jupyter笔记本或如何使用？查看我的<a class="ae lv" rel="noopener" target="_blank" href="/how-to-start-a-data-science-project-using-google-cloud-platform-6618b7c6edd2">上一篇文章</a>了解更多详情)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e771" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您需要按照正确的顺序运行这几行代码，以利用PlaidML作为Keras后端，否则它将默认使用TensorFlow。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9c52" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们导入包并下载时尚数据集。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="1e09" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将使用Keras序列模型构建一个简单的CNN(卷积神经网络)并编译它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9b7a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们拟合模型并测试准确性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/16b1c1dce095e404108d3d8dcec233cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zkmi4-SGFhRj3m1Z2VvLdQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型结果</p></figure><p id="801d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们训练了一个CNN模型，仅用了大约2分钟就对时尚数据集进行了91%的分类。你可能认为这并不令人印象深刻，但是看看与我的笔记本电脑的CPU的比较:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/f667edf81f803559483de00edab4c3c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vxeW6FVa1n3xM5163aGY7w.png"/></div></div></figure><h1 id="9281" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="479f" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">从上面的比较中我们可以看到，在我的MacBook Pro上使用GPU比使用CPU运行这个简单的CNN代码快大约15倍。在<strong class="la iu"> PlaidML </strong>的帮助下，用自己的笔记本电脑做深度学习不再是无法忍受的事情。这个项目的完整脚本可以在我的<a class="ae lv" href="https://github.com/Frank-Xu-Huaze/Medium/blob/master/PlaidML_CNN/PlaidML_Fashion_mnist.ipynb" rel="noopener ugc nofollow" target="_blank"> github </a>找到。</p><p id="0293" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">截止到今天(2020年2月)，<strong class="la iu"> PlaidML </strong>已经支持<a class="ae lv" href="https://keras.io" rel="noopener ugc nofollow" target="_blank"> Keras </a>、<a class="ae lv" href="https://onnx.ai" rel="noopener ugc nofollow" target="_blank"> ONNX </a>和<a class="ae lv" href="https://pypi.org/project/ngraph-core/" rel="noopener ugc nofollow" target="_blank"> NGraph </a>。它在GPU上运行良好，并且不需要在<em class="lu"> Nvidia </em>硬件上使用CUDA/cuDNN，同时实现可比的性能。在<a class="ae lv" href="https://github.com/plaidml/plaidml" rel="noopener ugc nofollow" target="_blank"> PlaidML github页面</a>上有更多的演示和相关项目。现在你GPU可能还不能得到PlaidML的完全支持，但是我相信很快GPU学习将不再是Nvidia T21的特权。</p></div></div>    
</body>
</html>