<html>
<head>
<title>Docker for Python-Dash &amp; R-Shiny</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python-Dash 和 R-Shiny 的 Docker</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/docker-for-python-dash-r-shiny-6097c8998506?source=collection_archive---------6-----------------------#2020-03-27">https://towardsdatascience.com/docker-for-python-dash-r-shiny-6097c8998506?source=collection_archive---------6-----------------------#2020-03-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9342" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Docker &amp; docker-compose 快速入门。以及显示新冠肺炎案例编号的仪表板示例。</h2></div><p id="45bc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您想使用 Docker &amp; Docker Compose 部署您的数据驱动型应用程序吗？然后继续读下去，因为这篇文章会让你在几分钟内就开始运行。对于最广泛传播的数据科学/分析堆栈:<strong class="kk iu"> Python &amp; R </strong>。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="fae7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我最近的媒体报道中，我解释了如何建立一个数据驱动的 web 应用程序，以显示冠状病毒的病例数。我用下面的<strong class="kk iu">两个栈</strong>创建了<strong class="kk iu">完全相同的 web 应用</strong>:</p><ul class=""><li id="435b" class="ll lm it kk b kl km ko kp kr ln kv lo kz lp ld lq lr ls lt bi translated">Python &amp; Dash ( <a class="ae lu" rel="noopener" target="_blank" href="/visualise-covid-19-case-data-using-python-dash-and-plotly-e58feb34f70f">链接</a>)</li><li id="3edd" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">R &amp;闪亮(<a class="ae lu" rel="noopener" target="_blank" href="/create-a-coronavirus-app-using-r-shiny-and-plotly-6a6abf66091d">链接</a>)</li></ul><p id="8803" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我将向您展示如何使用 Docker &amp; Compose 部署这些应用。我将首先介绍 Docker，包括 Python 和 R，稍后再介绍 docker-compose。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ma"><img src="../Images/39a5b62d6b480679dc1e43e20f21d8eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jodA8-yNulrqDWq-"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">托马斯·詹森在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="873f" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">码头工人</h1><h2 id="2fad" class="ni mr it bd ms nj nk dn mw nl nm dp na kr nn no nc kv np nq ne kz nr ns ng nt bi translated">装置</h2><p id="8f01" class="pw-post-body-paragraph ki kj it kk b kl nu ju kn ko nv jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">在你选择的服务器上安装 Docker 很容易——有大量的说明。例如，如果您有一个运行 Amazon Linux 的<a class="ae lu" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> AWS 实例(EC2) </a>，只需输入:</p><pre class="mb mc md me gt nz oa ob oc aw od bi"><span id="e36a" class="ni mr it oa b gy oe of l og oh">sudo yum install -y docker  # Install Docker.<br/>sudo service docker start   # Start the service.<br/>sudo usermod -a -G docker ec2-user  # Add ec2-user to Docker group.<br/>sudo chkconfig docker on    # Let docker auto-start.</span></pre><p id="215c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完美。码头工人准备好了！</p><h2 id="a99b" class="ni mr it bd ms nj nk dn mw nl nm dp na kr nn no nc kv np nq ne kz nr ns ng nt bi translated">Python-Dash 的 docker 文件</h2><p id="3414" class="pw-post-body-paragraph ki kj it kk b kl nu ju kn ko nv jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">首先，我们要创建<strong class="kk iu"><em class="oi">requirements . txt</em></strong>文件，包括所有必要的库。这可以使用命令来完成</p><pre class="mb mc md me gt nz oa ob oc aw od bi"><span id="8e0f" class="ni mr it oa b gy oe of l og oh">pip freeze &gt; requirements.txt</span></pre><p id="0fe7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者通过手动创建文本文件并输入库的名称。对于<a class="ae lu" rel="noopener" target="_blank" href="/visualise-covid-19-case-data-using-python-dash-and-plotly-e58feb34f70f">提到的 app </a>，我们需要以下库(顺便说一下，<em class="oi"> plotly </em>安装有<em class="oi">破折号</em>):</p><pre class="mb mc md me gt nz oa ob oc aw od bi"><span id="47ba" class="ni mr it oa b gy oe of l og oh">dash<br/>pandas</span></pre><p id="14f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们准备设置<strong class="kk iu"> DOCKERFILE </strong>本身。对于一个简单的 Python-Dash 应用程序，以下代码就足够了:</p><pre class="mb mc md me gt nz oa ob oc aw od bi"><span id="5762" class="ni mr it oa b gy oe of l og oh">FROM python:3.8<br/>LABEL maintainer "Meinhard Ploner &lt;<a class="ae lu" href="mailto:meinhard.ploner@gmail.com" rel="noopener ugc nofollow" target="_blank">dummy@host.com</a>&gt;"</span><span id="6bd3" class="ni mr it oa b gy oj of l og oh">WORKDIR /code</span><span id="a379" class="ni mr it oa b gy oj of l og oh">COPY requirements.txt /<br/>RUN pip install -r /requirements.txt<br/>COPY ./ ./</span><span id="cb42" class="ni mr it oa b gy oj of l og oh">EXPOSE 8050</span><span id="0e69" class="ni mr it oa b gy oj of l og oh">CMD ["python", "./app.py"]</span></pre><p id="43aa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">单个<strong class="kk iu">命令</strong>的描述</strong>:</p><ul class=""><li id="032e" class="ll lm it kk b kl km ko kp kr ln kv lo kz lp ld lq lr ls lt bi translated">FROM …:提取标签为 3.8(=版本)的 Python 图像。</li><li id="eaa4" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">标签…:可选。维护者的姓名和电子邮件。</li><li id="14a5" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">WORKDIR …:设置工作目录。</li><li id="21cc" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">复制需求…:复制<em class="oi">需求. txt </em>文件。</li><li id="5619" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">运行 pip …:安装所有列为需求的库。</li><li id="962f" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">收到。/ …:将所有文件复制到 Docker 映像。</li><li id="719d" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">EXPOSE …:设置监听端口。</li><li id="296c" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">CMD …:设置运行映像时要执行的命令。</li></ul><p id="8b8e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完美。如果我们对 R 解决方案不感兴趣，我们可以<strong class="kk iu">跳到</strong><strong class="kk iu">docker-compose</strong>的定义。否则，请继续…</p><h2 id="42e9" class="ni mr it bd ms nj nk dn mw nl nm dp na kr nn no nc kv np nq ne kz nr ns ng nt bi translated">R-Shiny 的 docker 文件</h2><p id="5c77" class="pw-post-body-paragraph ki kj it kk b kl nu ju kn ko nv jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">在 R 上，<strong class="kk iu">包</strong>通常不在需求文件中列出，而是<strong class="kk iu">直接成为 DOCKERFILE </strong>代码的一部分。与 Python 类似，我提出了一个 DOCKERFILE，它适用于简单的应用程序，就像我在<a class="ae lu" rel="noopener" target="_blank" href="/create-a-coronavirus-app-using-r-shiny-and-plotly-6a6abf66091d">其他帖子</a>中解释的那样。</p><p id="0a85" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该文件比 Python 稍微复杂一些，但仍然很紧凑:</p><pre class="mb mc md me gt nz oa ob oc aw od bi"><span id="7c53" class="ni mr it oa b gy oe of l og oh">FROM rocker/shiny:3.6.1<br/>LABEL maintainer "Meinhard Ploner &lt;<a class="ae lu" href="mailto:meinhard.ploner@gmail.com" rel="noopener ugc nofollow" target="_blank">dummy@host.com</a>&gt;"</span><span id="9384" class="ni mr it oa b gy oj of l og oh">WORKDIR /srv/shiny-server</span><span id="d562" class="ni mr it oa b gy oj of l og oh">RUN apt-get update \<br/>    &amp;&amp; apt-get install -y libsasl2-dev libssl-dev</span><span id="1af7" class="ni mr it oa b gy oj of l og oh">RUN echo \<br/>  'options(repos=list(CRAN="<a class="ae lu" href="https://cloud.r-project.org/" rel="noopener ugc nofollow" target="_blank">https://cloud.r-project.org/</a>"))' &gt; \<br/>  ".Rprofile"<br/>RUN R -e "install.packages(c('dplyr','tidyr', 'plotly'))"</span><span id="d05c" class="ni mr it oa b gy oj of l og oh">ADD https://raw.githubusercontent.com/rocker-org/shiny/master/shiny-server.sh /usr/bin/</span><span id="aaab" class="ni mr it oa b gy oj of l og oh">COPY ./ ./</span><span id="8dd9" class="ni mr it oa b gy oj of l og oh">EXPOSE 3838</span><span id="4eb1" class="ni mr it oa b gy oj of l og oh">RUN chmod a+w .<br/>RUN chmod +x /usr/bin/shiny-server.sh</span><span id="d0cb" class="ni mr it oa b gy oj of l og oh">CMD /usr/bin/shiny-server.sh</span></pre><p id="6031" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">单个<strong class="kk iu">命令</strong>的描述</strong>:</p><ul class=""><li id="ec87" class="ll lm it kk b kl km ko kp kr ln kv lo kz lp ld lq lr ls lt bi translated">来自…:提取标签为 3 . 6 . 1(=版本)的 R-闪亮图像。</li><li id="b078" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">标签…:可选。维护者的姓名和电子邮件。</li><li id="42ba" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">WORKDIR …:设置工作目录。</li><li id="e506" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">运行 apt-get …:安装<em class="oi"> libssl </em>，这是<em class="oi"> plotly </em>所需要的。在其他 Linux 实例或 Windows 上可能有所不同。</li><li id="4f95" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">运行 echo …:将<a class="ae lu" href="https://cran.r-project.org/" rel="noopener ugc nofollow" target="_blank"> CRAN 库 URL </a>写入<em class="oi">。Rprofile </em>，在后续的 R 调用中使用。</li><li id="f4ab" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">运行 R …:调用 R 来安装各种包。</li><li id="4350" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">ADD …:下载<em class="oi"> shiny-server.sh </em>文件并将其添加到映像中。</li><li id="22b4" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">收到。/ …:将所有文件复制到 Docker 映像。</li><li id="620c" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">EXPOSE …:设置监听端口。</li><li id="bb89" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">运行 chmod +w…:使镜像的主目录可写。</li><li id="3257" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">运行 chmod +x…:使<em class="oi"> shiny-server.sh </em>可执行。</li><li id="fde8" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">CMD …:设置运行映像时要执行的命令。</li></ul><p id="58be" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就是这样。让我们继续进行<strong class="kk iu">作曲</strong>部分。</p><h1 id="cd78" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">Docker 撰写</h1><h2 id="a4b3" class="ni mr it bd ms nj nk dn mw nl nm dp na kr nn no nc kv np nq ne kz nr ns ng nt bi translated">装置</h2><p id="05bb" class="pw-post-body-paragraph ki kj it kk b kl nu ju kn ko nv jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">docker-compose 的安装也很简单。从 GitHub 复制适当的二进制文件，并修复权限:</p><pre class="mb mc md me gt nz oa ob oc aw od bi"><span id="5cb9" class="ni mr it oa b gy oe of l og oh">sudo curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose</span></pre><p id="360d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可能想知道<strong class="kk iu"> <em class="oi"> uname </em> </strong>这个命令是干什么用的？<em class="oi"> uname </em>返回操作系统的基本信息。在搭载亚马逊 Linux 的 AWS EC2 上，对于“<em class="oi"> uname -s </em>”给出了“<em class="oi"> Linux </em>”，对于“<em class="oi"> uname -m </em>”给出了“<em class="oi"> x86_64 </em>”。</p><h1 id="01f6" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">docker-为 Python-Dash &amp; R-Shiny 编写文件</h1><p id="6399" class="pw-post-body-paragraph ki kj it kk b kl nu ju kn ko nv jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated"><em class="oi">docker-compose . yml</em>YAML 文件<strong class="kk iu">在两个堆栈</strong>之间没有区别。但是在创建它之前，先设置一个名为“<strong class="kk iu">的环境文件。env </strong>"带基本应用信息:</p><pre class="mb mc md me gt nz oa ob oc aw od bi"><span id="ec54" class="ni mr it oa b gy oe of l og oh">VERSION=1.0.0<br/>TARGET=LIVE</span></pre><p id="704e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在创建合成文件，在我们的例子中，它是极简的:</p><pre class="mb mc md me gt nz oa ob oc aw od bi"><span id="7d86" class="ni mr it oa b gy oe of l og oh">version: "3.7"</span><span id="0a31" class="ni mr it oa b gy oj of l og oh">services:<br/>  app-name:<br/>    build:<br/>      context: .<br/>    image: app-name:$VERSION<br/>    container_name: app-name<br/>    ports:<br/>      - "to:from"<br/>    environment:<br/>      - TARGET=$TARGET<br/>    restart: unless-stopped</span></pre><p id="2d7a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将“<strong class="kk iu"> <em class="oi">应用名称</em> </strong>”替换为您选择的应用名称。映像名称将使用版本号，在我们的例子中是“<em class="oi"> app-name:1.0.0 </em>”。</p><p id="dfae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，Python-Dash 应用程序通常运行在端口 5050 上，而 R-Shiny 应用程序默认使用端口 3838。因此<strong class="kk iu">将端口</strong> ( <em class="oi">“至:”</em>)替换为:</p><ul class=""><li id="2da1" class="ll lm it kk b kl km ko kp kr ln kv lo kz lp ld lq lr ls lt bi translated">Python-Dash 为 80:5050</li><li id="197e" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated">80:3838 代表 R-闪亮</li></ul><p id="5365" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了端口 80，您还可以使用您想要服务的任何其他端口。将文件另存为<em class="oi"> docker-compose.yml，就大功告成了。</em></p><h1 id="1f54" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">构建并运行！</h1><p id="06a7" class="pw-post-body-paragraph ki kj it kk b kl nu ju kn ko nv jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">要构建<strong class="kk iu">图像</strong>,请使用:</p><pre class="mb mc md me gt nz oa ob oc aw od bi"><span id="8cc5" class="ni mr it oa b gy oe of l og oh">docker-compose build</span></pre><p id="54d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">构建完映像后，通过键入以下命令构建并启动<strong class="kk iu">容器</strong>:</p><pre class="mb mc md me gt nz oa ob oc aw od bi"><span id="bfb7" class="ni mr it oa b gy oe of l og oh">docker-compose up -d</span></pre><p id="94cf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">选项<em class="oi">-d "</em>确保应用程序在后台运行。如果没有该选项，您将直接看到日志，这对测试设置的最初几次运行非常有用。</p><p id="496d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您从 GitHub 下载了应用程序代码并按照说明操作，您的应用程序将在服务器上运行。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ok"><img src="../Images/15d80afa60332a3b5712c1ce0c1c82c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m5CsNpl8Kqn1Whxv4XLavA.png"/></div></div></figure><p id="cb5e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">否则，您也可以测试运行在<strong class="kk iu"> my EC2 实例</strong>上的应用程序:</p><ul class=""><li id="aaf0" class="ll lm it kk b kl km ko kp kr ln kv lo kz lp ld lq lr ls lt bi translated"><strong class="kk iu">AWS/EC2 上的 Python-Dash app</strong>:<a class="ae lu" href="https://go.aws/2xsdb7q" rel="noopener ugc nofollow" target="_blank"><em class="oi">https://go.aws/2xsdb7q</em></a></li><li id="4df9" class="ll lm it kk b kl lv ko lw kr lx kv ly kz lz ld lq lr ls lt bi translated"><strong class="kk iu">AWS/EC2 上的 R-Shiny app</strong>:<a class="ae lu" href="https://go.aws/3aoYsIW" rel="noopener ugc nofollow" target="_blank"><em class="oi">https://go.aws/3aoYsIW</em></a></li></ul></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="1238" class="mq mr it bd ms mt ol mv mw mx om mz na jz on ka nc kc oo kd ne kf op kg ng nh bi translated">结论</h1><p id="60b4" class="pw-post-body-paragraph ki kj it kk b kl nu ju kn ko nv jx kq kr nw kt ku kv nx kx ky kz ny lb lc ld im bi translated">如您所见，部署一个简单的 Dash 或闪亮的应用程序没什么大不了的。即使一个应用变得更加复杂，这些例子也可以作为一个蓝图。</p><p id="ea8b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望你喜欢这篇文章，它有助于让你自己的应用程序运行起来！</p></div></div>    
</body>
</html>