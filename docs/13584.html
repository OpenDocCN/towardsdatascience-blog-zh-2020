<html>
<head>
<title>How to Deploy Docker Containers to The Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将 Docker 容器部署到云中</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-deploy-docker-containers-to-the-cloud-b4d89b2c6c31?source=collection_archive---------2-----------------------#2020-09-18">https://towardsdatascience.com/how-to-deploy-docker-containers-to-the-cloud-b4d89b2c6c31?source=collection_archive---------2-----------------------#2020-09-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7e95" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Docker 和 GCP 让与世界分享你的作品变得容易</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cf8fb350a4804134380b5e5c666250be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wlhlxCoEK7TrxDv1"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@zoltantasi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Zoltan·塔斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="a0d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated">ocker 容器是很棒的小东西。它们本质上是独立的应用程序，可以在任何操作系统上运行。</p><p id="624c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您有一个 Python 应用程序，您将它与运行它所需的一切捆绑到 Docker 容器中——该容器现在可以在任何 Windows、Linux 或 macOS 系统上运行，无需安装任何东西！</p><p id="2fb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Docker 的另一个好处是对云平台上的容器的支持，比如我们将在本文中使用的 Google Cloud (GCP)。</p><p id="0a5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以快速构建一个应用程序，使用 Docker 将其打包到一个容器中，然后使用 GCP 在全球范围内部署它。</p><p id="5a7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们在本文中要做的。我们将采用一个简单的 Python API，用 Docker 打包，用 GCP 部署，涵盖:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="33cf" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf iu">&gt; Project Setup</strong></span><span id="da75" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf iu">&gt; Dockerfile</strong><br/>  - FROM<br/>  - WORKDIR and COPY<br/>  - RUN<br/>  - CMD</span><span id="2908" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf iu">&gt; Building the Docker Image</strong></span><span id="e3cc" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf iu">&gt; Deploy with Google Cloud Platform</strong><br/>  - GCloud SDK<br/>  - Cloud Build and Container Registry<br/>  - Cloud Run</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="cbd7" class="mx mk it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">项目设置</h1><p id="8abe" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">我们不会仅仅关注 Python 代码，因为这不是本文的目的。相反，带上你自己的代码——或者，<a class="ae ky" href="https://github.com/jamescalam/gcp-api/blob/master/app.py" rel="noopener ugc nofollow" target="_blank">这是我之前做的一些东西</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/b3010a33ae8ea76eb1b953c76473b463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*bdfBhQCLdSCKzpiyWqrKVQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的<strong class="bd nu"> gcp-api </strong>目录应该是这样的。</p></figure><p id="aed5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将代码存储在一个名为<code class="fe nv nw nx mf b">gcp-api</code>(你可以随便叫它什么)的目录中，命名为<code class="fe nv nw nx mf b">app.py</code>。除了我们的脚本，我们还需要:</p><ul class=""><li id="bc16" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated">a<strong class="lb iu">Docker file</strong>——Docker 的使用说明书</li><li id="404f" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><strong class="lb iu"> requirements.txt </strong> —一组 Python 模块，供我们的 docker 文件安装</li></ul><p id="1c16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，我们用的是 Docker，所以；我们也需要码头工人。可以从<a class="ae ky" href="https://docs.docker.com/docker-for-windows/install/" rel="noopener ugc nofollow" target="_blank">这里</a>安装。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="2796" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您在安装 Docker 时遇到任何特定于操作系统的问题，此视频中的 1:46:21 标记说明了 Windows 安装，随后是 macOS 的 1:53:22 标记。</p><h1 id="d94d" class="mx mk it bd my mz oo nb nc nd op nf ng jz oq ka ni kc or kd nk kf os kg nm nn bi translated">Dockerfile 文件</h1><p id="1d4a" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">docker 文件是我们的容器构建蓝图。它确切地告诉 Docker 如何以一种产生自包含应用程序的方式重新排列我们的脚本和文件。</p><p id="c494" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像盖房子一样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/f96d9671ad057debc8847b9cfdc0e024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nCLTG7Q_KeRxW-JP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">兰迪·法特在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="8662" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的脚本和文件是原材料(木材、砖块等)。).我们创建了一套我们希望我们的房子是什么样子的说明(Dockerfile)，然后我们把它交给我们的建筑师(Docker)，他然后做所有的技术工作来产生一个房子蓝图(图像)。</p><p id="66d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">稍后，我们还将把蓝图交给我们的建造者(Google Build)，他将为我们建造房子(容器)——但现在还不是时候。</p><p id="f66a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的档案。看起来是这样的:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="bd16" class="mj mk it mf b gy ml mm l mn mo">FROM python:3.6-slim-buster</span><span id="af16" class="mj mk it mf b gy mp mm l mn mo">WORKDIR /app<br/>COPY . .</span><span id="98ce" class="mj mk it mf b gy mp mm l mn mo">RUN pip install -r requirements.txt</span><span id="144a" class="mj mk it mf b gy mp mm l mn mo">CMD exec gunicorn --bind :$PORT --workers 1 --threads 8 --timeout 0 app:app</span></pre><p id="3386" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最初，它可能看起来令人困惑，但它非常简单。</p><h2 id="ac43" class="mj mk it bd my ou ov dn nc ow ox dp ng li oy oz ni lm pa pb nk lq pc pd nm pe bi translated">来自 python:3.6-slim-buster</h2><p id="4b73" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">Docker 文件的第一行用另一个预构建的 Docker 映像初始化我们的容器映像。</p><p id="f912" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个预构建的映像本质上就是一个包含 Python 3.6 的轻量级 Linux 操作系统。</p><p id="9dfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但为什么是<em class="pf">【瘦身达人】</em>？嗯，<strong class="lb iu"> buster </strong>是 Debian(一个 Linux 发行版)所有版本 10 变体的代号。</p><p id="db76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至于他们为什么选择“buster”这个词——我想有人打开字典，选择了他们看到的第一个词。</p><p id="1f68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，斯利姆确实有道理。正如你可能已经猜到的，它意味着 Debian 10 . x——但是被削减了，导致一个更小的包大小。</p><p id="f498" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">官方 Python 图片的完整列表<a class="ae ky" href="https://hub.docker.com/_/python" rel="noopener ugc nofollow" target="_blank">可从这里</a>获得。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/98c5d31200e5b2046e870404aae8a55a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*anEtDRLb-QfKZ7Jf.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Firestore (NoSQL 数据库)通过谷歌的 Firebase 平台提供。<a class="ae ky" href="https://firebase.google.com/brand-guidelines" rel="noopener ugc nofollow" target="_blank">图像来源</a>。</p></figure><p id="e92f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="pf">警告:</em> </strong> <em class="pf">另外值得注意的是，我们这里用的是 Python 3.6 你不需要坚持这一点，除非你将使用 Google Firebase(我们不会在这里使用，但意识到这一点是很好的)。</em></p><p id="afc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="pf">如果您碰巧在 Python 中使用 Google Firebase，您可能会使用</em> <code class="fe nv nw nx mf b"><em class="pf">python-firebase</em></code> <em class="pf">模块，其中包含一个名为</em> <code class="fe nv nw nx mf b"><em class="pf">async</em></code> <em class="pf">的导入。</em></p><p id="2845" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，Python 3.7 引入了这个词作为关键字。我们坚持使用 Python 3.6 来避免由此产生的语法错误。</p><h2 id="4dc7" class="mj mk it bd my ou ov dn nc ow ox dp ng li oy oz ni lm pa pb nk lq pc pd nm pe bi translated">工作目录和副本</h2><p id="3f3f" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">接下来是<code class="fe nv nw nx mf b">WORKDIR</code>和<code class="fe nv nw nx mf b">COPY</code>。</p><p id="0a06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用<code class="fe nv nw nx mf b">WORKDIR</code>将我们的映像(我们的容器的构造站点)中的活动目录设置为<code class="fe nv nw nx mf b">/app</code>。从现在开始，我们映像外部的<code class="fe nv nw nx mf b">.</code>是指我们当前的目录(例如<code class="fe nv nw nx mf b">/gcp-api</code>),我们映像内部的<code class="fe nv nw nx mf b">.</code>是指<code class="fe nv nw nx mf b">/app</code>。</p><p id="f800" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nv nw nx mf b">WORKDIR</code>之后，我们<code class="fe nv nw nx mf b">COPY</code>从本地目录<code class="fe nv nw nx mf b">/gcp-api</code>到内部活动目录<code class="fe nv nw nx mf b">/app</code>的所有内容。</p><p id="d714" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在图像中复制<code class="fe nv nw nx mf b">app.py</code>到<code class="fe nv nw nx mf b">/app</code>的原因是因为这是我们的谷歌云实例所期望的结构。我们可以改变这一点，但这是我们将在这里使用的。</p><h2 id="a185" class="mj mk it bd my ou ov dn nc ow ox dp ng li oy oz ni lm pa pb nk lq pc pd nm pe bi translated">奔跑</h2><p id="0690" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">现在，我们有了自己的<code class="fe nv nw nx mf b">pip install</code>指令。我们使用<code class="fe nv nw nx mf b">RUN</code>告诉 Docker 运行下面的命令。下面的命令是<code class="fe nv nw nx mf b">pip install -r requirements.txt</code>。</p><p id="2745" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过编写<code class="fe nv nw nx mf b">pip install -r requirements.txt</code>,我们告诉 Docker 对包含在<code class="fe nv nw nx mf b">requirements.txt</code>中的每一行递归运行<code class="fe nv nw nx mf b">pip install</code>。</p><p id="ed5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么<code class="fe nv nw nx mf b">requirements.txt</code>长什么样？</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="87dc" class="mj mk it mf b gy ml mm l mn mo">pandas==1.1.1<br/>gunicorn==20.0.4<br/>flask==1.1.2<br/>flask-api==2.0</span></pre><p id="274c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当它被输入到我们的递归<code class="fe nv nw nx mf b">pip install</code>指令中时，它被翻译成:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="2dcb" class="mj mk it mf b gy ml mm l mn mo">pip install pandas==1.1.1<br/>pip install gunicorn==20.0.4<br/>pip install flask==1.1.2<br/>pip install flask-api==2.0</span></pre><p id="2c70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我相信每个人都知道这一点。</p><h2 id="e707" class="mj mk it bd my ou ov dn nc ow ox dp ng li oy oz ni lm pa pb nk lq pc pd nm pe bi translated">煤矿管理局</h2><p id="7af1" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">根据我们的应用程序，我们的最终指令不是必需的。在这种情况下，它使用<code class="fe nv nw nx mf b">gunicorn</code> Python 包来托管我们的 API。</p><p id="210b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管如此，<code class="fe nv nw nx mf b">CMD</code>指令相当于打开我们计算机的命令行界面 CLI 并键入我们提供的任何命令，在本例中为<code class="fe nv nw nx mf b">exec gunicorn — bind :$PORT --workers 1 --threads 8 --timeout 0 app:app</code>。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="452d" class="mx mk it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">建立码头工人形象</h1><p id="e71f" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">在本文的前面，我们描述了 Docker 容器的房屋建筑隐喻。到目前为止，我们已经获得了原材料(脚本和文件)，并编写了一套说明，解释我们希望我们的房子是什么样的(Dockerfile)。</p><p id="e9cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，是时候创建我们的蓝图了 Docker 图像。</p><p id="9a84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过执行以下命令来创建它:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="6541" class="mj mk it mf b gy ml mm l mn mo">docker build -t gcp-api .</span></pre><ul class=""><li id="bcaa" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated">这里，Docker 映像构建命令是<code class="fe nv nw nx mf b">docker build</code></li><li id="7172" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">接下来，我们使用<code class="fe nv nw nx mf b">-t</code>标志来指定我们的图像名称— <code class="fe nv nw nx mf b">gcp-api</code></li><li id="ef55" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">最后，我们告诉 Docker 用<code class="fe nv nw nx mf b">.</code>包含当前目录中的所有内容</li></ul><p id="a1c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，我们已经有了蓝图，现在我们需要的是我们的构建者——云——所以让我们开始设置它。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="de38" class="mx mk it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">使用谷歌云平台进行部署</h1><p id="78cd" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">要将容器部署到云中，我们需要采取三个步骤。首先我们:</p><ul class=""><li id="9029" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated">下载 Google Cloud SDK，我们将使用它来—</li><li id="6f79" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">用云构建构建我们的容器。</li><li id="7fc4" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">将集装箱上传到 GCP 的集装箱登记处。</li><li id="65e4" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">使用云运行部署它。</li></ul><h2 id="8dbf" class="mj mk it bd my ou ov dn nc ow ox dp ng li oy oz ni lm pa pb nk lq pc pd nm pe bi translated">GCloud SDK</h2><p id="7a03" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">我们可以在这里找到<a class="ae ky" href="https://cloud.google.com/sdk/docs/downloads-interactive" rel="noopener ugc nofollow" target="_blank"> SDK 安装程序</a>。安装完成后，我们需要通过打开 CMD 提示符(或等效的 CLI)并键入以下命令来验证我们的 GCloud SDK:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="f492" class="mj mk it mf b gy ml mm l mn mo">gcloud auth login</span></pre><p id="860f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个命令打开我们的 web 浏览器，并允许我们像往常一样登录到 Google Cloud。我们将 Docker 配置为将我们的 GCP 凭据用于:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="03a1" class="mj mk it mf b gy ml mm l mn mo">gcloud auth configure-docker</span></pre><p id="7889" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，将活动项目设置为您的项目 ID(我的是<code class="fe nv nw nx mf b">medium-286319</code>),使用:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="112c" class="mj mk it mf b gy ml mm l mn mo">gcloud config set project <em class="pf">medium-286319</em></span></pre><h2 id="a79b" class="mj mk it bd my ou ov dn nc ow ox dp ng li oy oz ni lm pa pb nk lq pc pd nm pe bi translated">云构建和容器注册</h2><p id="4036" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">Google 的容器注册(GCR)服务允许我们存储 Docker 容器，我们可以将其用作部署的发射台。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/20c94cf20fd689402b37615e8a66a0c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Wg3p0vQqLb4Pxqb1.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们需要一个现有的项目来部署我们的容器。图片作者。</p></figure><p id="efac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们可以使用 GCR(或任何其他 GCP 服务)之前，我们需要创建一个项目。我们可以通过在 GCP 控制台中导航到<a class="ae ky" href="https://console.cloud.google.com/projectselector2/home/dashboard" rel="noopener ugc nofollow" target="_blank">项目选择器页面并点击<strong class="lb iu">创建项目</strong>来实现。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/e6bafcad5b620d19c5dfe203f20e73c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ydX1tr3Bkh-KjM9C.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">建立一个新项目非常简单。图片作者。</p></figure><p id="36a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要做的就是给我们的项目起一个名字。我用的是<strong class="lb iu">介质</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/a21a3250508776177c589fe6956a5582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cWbzo9XBSTdss6zFoWjVhg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如果这是我们第一次在项目中使用 GCR，我们将需要启用 GCR API。图片作者。</p></figure><p id="76c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了项目设置；我们应该能够访问<a class="ae ky" href="https://console.cloud.google.com/gcr" rel="noopener ugc nofollow" target="_blank">容器注册表</a>。在这里，我们应该能够在顶栏中看到我们新创建的项目的名称。</p><p id="d646" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用 GCR，我们需要点击控制台窗口中央的<strong class="lb iu">Enable Container Registry API</strong>。</p><p id="e418" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以通过将容器提交到 Cloud Build——构建 Docker 容器的 GCP 服务——来将容器上传到 GCR。</p><p id="45c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们在项目目录(<code class="fe nv nw nx mf b">gcp-api</code>)中打开 CLI，并键入:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="e429" class="mj mk it mf b gy ml mm l mn mo">gcloud builds submit --tag gcr.io/[PROJECT-ID]/gcp-api</span></pre><ul class=""><li id="6a9e" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated"><code class="fe nv nw nx mf b">gcloud builds submit</code>将附加到我们当前目录的 Docker 映像提交到 Cloud Build——它将被打包到一个容器中。</li></ul><p id="8405" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的容器注册位置被提供给<code class="fe nv nw nx mf b">--tag</code>标志，其中:</p><ul class=""><li id="0b53" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated"><code class="fe nv nw nx mf b"><em class="pf">gcr.io</em></code> <em class="pf">就是</em> <a class="ae ky" href="https://cloud.google.com/container-registry/docs/pushing-and-pulling#tag_the_local_image_with_the_registry_name" rel="noopener ugc nofollow" target="_blank"> <em class="pf"> GCR 主机名</em> </a> <em class="pf">。</em></li><li id="a17b" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><code class="fe nv nw nx mf b"><em class="pf">[PROJECT-ID]</em></code> <em class="pf">是我们的项目 ID；我们在创建我们的项目时看到了这一点——对我来说，它是</em> <code class="fe nv nw nx mf b"><em class="pf">medium-286319</em></code> <em class="pf">。</em></li><li id="8271" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><code class="fe nv nw nx mf b"><em class="pf">gcp-api</em></code> <em class="pf">是我们的形象名称。</em></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/1d7463bb3ff13e422284055df208e32c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iLllVEChl5sytGs6rKDt4A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的项目<strong class="bd nu"> gcp-api </strong>在容器注册表中。图片作者。</p></figure><p id="5eb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们回到我们的<a class="ae ky" href="https://console.cloud.google.com/gcr" rel="noopener ugc nofollow" target="_blank"> GCR </a>窗口，我们应该能够看到我们新上传的 Docker 图像。如果它还没有出现，很可能还在构建过程中——这可以在我们的<a class="ae ky" href="https://console.cloud.google.com/cloud-build/dashboard" rel="noopener ugc nofollow" target="_blank">云构建仪表板</a>中找到。</p><h2 id="4446" class="mj mk it bd my ou ov dn nc ow ox dp ng li oy oz ni lm pa pb nk lq pc pd nm pe bi translated">云运行</h2><p id="db63" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">现在我们已经准备好了 Docker 容器；我们可以用<a class="ae ky" href="https://console.cloud.google.com/run" rel="noopener ugc nofollow" target="_blank">云运行</a>来部署它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/1a30e502afef992e577c85966ea72d44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*npMKxh6OpN2Fnyv_t03j5g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用云运行部署容器的分步过程。图片作者。</p></figure><p id="bb78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在云运行界面中，我们通过以下方式进行部署:(1)单击创建服务，(2)配置我们的部署，(3–4)选择容器，以及(5)创建我们的部署！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/03bacf0bbf31b2dc2adce25a3df6094b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VBOimwrCGmr6oHrhCegbnQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">云运行中正在进行的部署。图片作者。</p></figure><p id="b004" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在云运行控制台中看到部署状态，这应该不会超过几分钟。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/a702a35b21866a7788d93d46493e5b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yNUG1GU3oa-tQOJDeKPPrw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">完成后，我们的部署名称和区域旁边会出现一个绿色勾号和 URL。图片作者。</p></figure><p id="4175" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成后，我们会看到部署名称旁边有一个绿色勾号，旁边有我们的部署 URL。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="9cab" class="mx mk it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">完成了的</h1><p id="541a" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">就是这样，我们已经把我们的 Python 应用程序打包到 Docker 容器中，并使用 Google Cloud 将其部署到 web 上！</p><p id="e3f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">多亏了一些出色的工具——即 Docker 和 GCP——这个过程没有痛苦，并且(通常)一次又一次地导致完美的部署。</p><p id="99ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，比人类历史上任何时候都多。我们可以将脑海中的想法和概念在现实世界中有形地呈现出来——这可以产生一些真正令人惊叹的创作。</p><p id="776e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章能帮助你们中的一些人——如果你有任何问题、反馈或想法，请随时通过<a class="ae ky" href="https://twitter.com/jamescalam" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或在下面的评论中联系。感谢阅读！</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><p id="3c09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有兴趣了解云上的 SQL 吗？试试 Google 出色的 MySQL、PostgreSQL 和 SQL Server 数据库服务:</p><div class="po pp gp gr pq pr"><a rel="noopener follow" target="_blank" href="/sql-on-the-cloud-with-python-c08a30807661"><div class="ps ab fo"><div class="pt ab pu cl cj pv"><h2 class="bd iu gy z fp pw fr fs px fu fw is bi translated">使用 Python 在云上运行 SQL</h2><div class="py l"><h3 class="bd b gy z fp pw fr fs px fu fw dk translated">Google 云和 Python 上的 SQL 简明指南</h3></div><div class="pz l"><p class="bd b dl z fp pw fr fs px fu fw dk translated">towardsdatascience.com</p></div></div><div class="qa l"><div class="qb l qc qd qe qa qf ks pr"/></div></div></a></div></div></div>    
</body>
</html>