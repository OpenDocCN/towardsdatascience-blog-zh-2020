<html>
<head>
<title>MTA Turnstile Data: Exploratory Data Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MTA 十字转门数据:探索性数据分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mta-turstile-data-my-first-taste-of-a-data-science-project-493b03f1708a?source=collection_archive---------28-----------------------#2020-04-20">https://towardsdatascience.com/mta-turstile-data-my-first-taste-of-a-data-science-project-493b03f1708a?source=collection_archive---------28-----------------------#2020-04-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/39941011e2870ec0d211dde1a4b1c156.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ssLC7O34awox3iljbsNF5Q.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">埃迪·阿吉雷在<a class="ae kc" href="https://unsplash.com/s/photos/new-york-subway?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="1ebe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Metis 数据科学训练营(新加坡第四批)的第一周刚刚结束，到目前为止，这是一次有趣的经历。下面我将详细介绍我们在那段时间做的第一个项目，这是一个探索性的数据分析，使用 Python 与<em class="lb">熊猫</em>和<em class="lb">海牛</em>配对来分析 MTA 十字转门数据集。</p><h2 id="adec" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">TL；博士:</h2><ul class=""><li id="c380" class="lv lw iq kf b kg lx kk ly ko lz ks ma kw mb la mc md me mf bi translated">准备了 2019 年<strong class="kf ir">2 月和 3 月的 MTA 十字转门数据，用于</strong>一个为夏季晚会报名的活动。</li><li id="861d" class="lv lw iq kf b kg mg kk mh ko mi ks mj kw mk la mc md me mf bi translated">通过<strong class="kf ir">重命名列</strong>、<strong class="kf ir">添加计算字段</strong>、<strong class="kf ir">删除错误数据</strong>和<strong class="kf ir">按站点和日期聚集来清除数据。</strong></li><li id="ea3d" class="lv lw iq kf b kg mg kk mh ko mi ks mj kw mk la mc md me mf bi translated">发现<strong class="kf ir">工作日有最高的流量</strong>，但这是<strong class="kf ir">一些车站</strong>的情况较少；某些日子也有<strong class="kf ir">异常交通流量</strong>。</li><li id="01ee" class="lv lw iq kf b kg mg kk mh ko mi ks mj kw mk la mc md me mf bi translated">建议活动<strong class="kf ir">集中在工作日客流量高而周末客流量低的车站</strong></li><li id="0052" class="lv lw iq kf b kg mg kk mh ko mi ks mj kw mk la mc md me mf bi translated"><strong class="kf ir">异常</strong>、<strong class="kf ir">一天中的时间</strong>和<strong class="kf ir">应考虑人口统计数据</strong>的其他来源，以便进一步分析</li></ul><p id="577a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里是到 GitHub 库的<a class="ae kc" href="https://github.com/KunojiLym/metis_project_1" rel="noopener ugc nofollow" target="_blank">链接</a>。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="fb45" class="ms ld iq bd le mt mu mv lh mw mx my lk mz na nb ln nc nd ne lq nf ng nh lt ni bi translated">一.背景</h1><p id="d7ed" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">女性科技女性是(WTWY)每年初夏都会在纽约市举办一年一度的盛会。他们试图在这个盛会上发挥双重作用，一方面让那些热衷于增加女性在科技领域参与度的人来充实他们的活动空间，另一方面也提高人们的认识和影响力。</p><p id="3938" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，他们在纽约地铁站的入口处安排了街头小组。街头团队收集电子邮件地址，注册的人会收到免费的晚会门票。</p><p id="093f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的任务是使用纽约市大都会运输管理局(MTA)的地铁数据来帮助 WTWY 优化他们街道团队的位置，以便他们可以收集最多的签名，最理想的是从那些将参加晚会并为他们的事业做出贡献的人那里收集签名。</p><h1 id="1756" class="ms ld iq bd le mt nm mv lh mw nn my lk mz no nb ln nc np ne lq nf nq nh lt ni bi translated">二。设置</h1><p id="018b" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">我们使用了来自<a class="ae kc" href="http://web.mta.info/developers/turnstile.html" rel="noopener ugc nofollow" target="_blank"> MTA 十字转门</a>的历史数据，决定专注于 2019 年 2 月和 3 月的数据。</p><ul class=""><li id="3f2e" class="lv lw iq kf b kg kh kk kl ko nr ks ns kw nt la mc md me mf bi translated">二月(T0)、二月(T1)和三月(T2)、三月(T3)这两个月似乎是夏季来临前的充足准备时间，让人们能够将春晚安排到他们的日程表中。</li><li id="bd21" class="lv lw iq kf b kg mg kk mh ko mi ks mj kw mk la mc md me mf bi translated">在 2020 年的这个时候，新冠肺炎疫情正在肆虐，纽约市是世界上最大的热点之一。结果，它被封锁了，这严重扰乱了交通模式，T4 的街道空无一人。这是非常不寻常的情况。如果这是一项真实的研究，我给组织者的建议是完全避免安排街头团队，要么推迟/取消晚会，要么完全转移到网上。出于这个练习的目的，我们假设春晚将发生在 2019 年<strong class="kf ir">的夏天。</strong></li></ul><p id="1381" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">具体来说，我们从 2019 年 2 月 2 日结束的一周<strong class="kf ir">到 2019 年 3 月 5 日结束的一周</strong>的十周时间内获取数据，如以下代码片段所示:</p><figure class="nu nv nw nx gt jr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="da22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还决定专注于收集每个站点每天的总流量，忽略条目的时间。可以想象，在数据分析的后续迭代中会添加时间。</p><h1 id="e847" class="ms ld iq bd le mt nm mv lh mw nn my lk mz no nb ln nc np ne lq nf nq nh lt ni bi translated">三。准备数据</h1><h2 id="04ba" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">a)列重命名</h2><p id="9cf1" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">检查<em class="lb">MTA _ test . columns . values</em>，我们注意到数据集的<em class="lb"> EXITS </em>列有一大堆尾随空格:</p><pre class="nu nv nw nx gt oa ob oc od aw oe bi"><span id="1b27" class="lc ld iq ob b gy of og l oh oi">array(['C/A', 'UNIT', 'SCP', 'STATION', 'LINENAME', 'DIVISION', 'DATE', 'TIME', 'DESC', 'ENTRIES',<br/> 'EXITS                                                               '],<br/>      dtype=object)</span></pre><p id="efe5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以为了让我们的生活更轻松，我们把它重新命名为:</p><pre class="nu nv nw nx gt oa ob oc od aw oe bi"><span id="fcdf" class="lc ld iq ob b gy of og l oh oi">mta_test.rename(columns={'EXITS                                                               ':'EXITS'}, inplace=True)</span></pre><h2 id="1576" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">b)添加计算字段</h2><p id="63ce" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">基于来自 MTA 的<a class="ae kc" href="http://web.mta.info/developers/resources/nyct/turnstile/ts_Field_Description.txt" rel="noopener ugc nofollow" target="_blank">字段描述，我们知道入口和出口分别是给定入口和出口点的累积入口和出口寄存器值。因为我们是按天而不是按时间段聚合，所以我们决定分别减去入口和出口的第一个(也就是最小的)和最后一个(也就是最大的)计数器值。</a></p><p id="de77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还将入口和出口聚合到一个单独的列中，即 TRAFFIC，以及附加的工作日属性，以便于以后按工作日分析数据。我们的结果被放入<em class="lb"> mta_entries_exits </em>中。</p><p id="a775" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这一切的代码片段如下:</p><figure class="nu nv nw nx gt jr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h2 id="6b71" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">c)删除错误数据</h2><p id="2f7e" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">当我们按流量对<em class="lb"> mta_entries_exits </em>排序时，我们发现奇怪的大值似乎会打乱数据集:</p><figure class="nu nv nw nx gt jr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="d77e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对数据的进一步分析显示，在 MTA 数据的某些行中，计数器值以无法解释的数量跳跃(如下例所示):</p><figure class="nu nv nw nx gt jr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="fb32" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看入口和出口的分布可以发现，这些值中的大多数都在 20，000 以下:</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/f4f1b7e74b2298313259d957ba54364b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vjrYhqQVUPk5DPC2Z85KcA.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">条目数量的分布</p></figure><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/73f24d811984aaf7fa81b2c66373f789.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y728nhMvcOL0d_vphzPqCA.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">出口数量分布</p></figure><p id="c2e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们删除了所有大于 20，000 的入口和出口值:</p><pre class="nu nv nw nx gt oa ob oc od aw oe bi"><span id="9179" class="lc ld iq ob b gy of og l oh oi">mta_entries_exits = mta_entries_exits[(mta_entries_exits.ENTRIES &lt; 20000) &amp; (mta_entries_exits.ENTRIES &lt; 20000)]</span></pre><p id="252e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">请注意，这将删除特定十字转门一整天的数据。</strong>出于初步分析的目的，我们认为这是可以接受的，因为车站的每个入口点都有许多十字转门，通常不止一个入口点；然而，进一步的分析需要数据移除更有针对性。</p><h2 id="a67f" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">d)按站点和日期汇总数据</h2><p id="3073" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">最后，我们按车站和日期汇总了数据，因为我们不是在看单个的十字转门。</p><pre class="nu nv nw nx gt oa ob oc od aw oe bi"><span id="b77f" class="lc ld iq ob b gy of og l oh oi">mta_bystation = mta_entries_exits.groupby(['STATION','DATE','WEEKDAY', 'WEEKDAY_INDEX']).sum().reset_index()</span></pre><h1 id="7d1c" class="ms ld iq bd le mt nm mv lh mw nn my lk mz no nb ln nc np ne lq nf nq nh lt ni bi translated">四。来自数据的见解</h1><h2 id="9939" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">a)关注排名前五的电视台</h2><p id="d19a" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">我们发现总流量排名前 5 的站点如下:</p><ol class=""><li id="db97" class="lv lw iq kf b kg kh kk kl ko nr ks ns kw nt la ok md me mf bi translated">宾州车站</li><li id="0223" class="lv lw iq kf b kg mg kk mh ko mi ks mj kw mk la ok md me mf bi translated">大中央车站</li><li id="e62b" class="lv lw iq kf b kg mg kk mh ko mi ks mj kw mk la ok md me mf bi translated">先驱广场</li><li id="6761" class="lv lw iq kf b kg mg kk mh ko mi ks mj kw mk la ok md me mf bi translated">第 23 街</li><li id="538f" class="lv lw iq kf b kg mg kk mh ko mi ks mj kw mk la ok md me mf bi translated">时代广场</li></ol><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/670af5457d8f27e11c726d849b837ec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*jz0eu22cIbku6HkNmOvkPg.png"/></div></figure><p id="7eaa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的建议是<strong class="kf ir">将重点放在这 5 个车站</strong>。</p><h2 id="dbc9" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">b)关注工作日</h2><p id="d2a5" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">我们发现周末的交通流量比平日少(最多是平时的一半)。总的来说是这样的:</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/73fca3d120e1b42153154bc543542466.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*-ryZVVetcosbTaBi6JW00Q.png"/></div></figure><p id="5689" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">排名前五的电视台也是如此:</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/821fd041e298a508131b5a544fae3fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*tW4iYyPHBvwO8He-vPPiIg.png"/></div></figure><p id="42ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的建议是在工作日关注<strong class="kf ir">。</strong></p><h2 id="6c81" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">异常情况</h2><p id="5d02" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">我们注意到并非所有的站点都遵循相同的模式。例如，第 3 至第 5 级车站的工作日交通量更接近周末交通量:</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/52a0842e24f37fc529e5daaaa638e3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*rAaS54vXH6IwddMi6Ulvhg.png"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">顶部 2 站已移除。注意这些车站的工作日和周末交通有多接近。</p></figure><p id="58da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这可能是因为这些车站位于旅游区，时代广场就是一个突出的例子。退一步说，这样的短期游客不太可能参加夏季晚会。我们的建议是<strong class="kf ir">关注工作日客流量高而周末客流量低的车站</strong>。</p><p id="a01c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还发现，在排名前五的站点中，至少有一个站点的流量出现了无法解释的下降:</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/f51fb0f4f7a4ac4944a00793d95a6bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DQL5f4c7T71YFULPwS3jbw.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">请注意 2019 年 2 月 18 日至 25 日这一周中间的流量下降。</p></figure><p id="4c11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种下降(或峰值)需要隔离和调查，因为它们可能是由于特殊情况，如公共假期或紧急情况。这也可能是由于之前的数据清理丢失了数据。</p><h1 id="6eac" class="ms ld iq bd le mt nm mv lh mw nn my lk mz no nb ln nc np ne lq nf nq nh lt ni bi translated">动词 （verb 的缩写）进一步的步骤</h1><p id="fbb6" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">为了获得进一步的见解，我们可以做以下事情:</p><ol class=""><li id="25fd" class="lv lw iq kf b kg kh kk kl ko nr ks ns kw nt la ok md me mf bi translated">包括时间栏，以便:<strong class="kf ir"> a)确定高峰时间</strong>，以便 WTWY 知道何时是安排其团队的最佳时间；和<strong class="kf ir"> b)通过丢弃特定时间的坏数据而不是一整天的坏数据来减少数据丢失</strong>。</li><li id="9f87" class="lv lw iq kf b kg mg kk mh ko mi ks mj kw mk la ok md me mf bi translated">纳入<strong class="kf ir">人口和地理数据</strong>以确定通勤者的构成、任何地理相关性等。</li></ol><h1 id="adb4" class="ms ld iq bd le mt nm mv lh mw nn my lk mz no nb ln nc np ne lq nf nq nh lt ni bi translated">不及物动词外卖食品</h1><p id="2409" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">探索性数据分析的这一练习教会了我们以下内容:</p><ol class=""><li id="5662" class="lv lw iq kf b kg kh kk kl ko nr ks ns kw nt la ok md me mf bi translated">检查列名值的重要性；我们花了一段时间才意识到为什么从数据集中提取出口值有困难。</li><li id="d1f3" class="lv lw iq kf b kg mg kk mh ko mi ks mj kw mk la ok md me mf bi translated">使用分布图和过滤器剔除数据中异常值的重要性。</li></ol></div></div>    
</body>
</html>