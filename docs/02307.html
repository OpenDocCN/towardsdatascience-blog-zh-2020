<html>
<head>
<title>Linear Regression in Python — The Bordeaux Equation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中的线性回归——波尔多方程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/linear-regression-in-python-the-bordeaux-equation-d0e414dc5065?source=collection_archive---------45-----------------------#2020-03-04">https://towardsdatascience.com/linear-regression-in-python-the-bordeaux-equation-d0e414dc5065?source=collection_archive---------45-----------------------#2020-03-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9834" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">预测葡萄酒的价格</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8813353a9af1040dcac31ec2b4ba24e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v79XNpdjZ7pw2EcgDW9kaA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@kymellis?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">金莎·埃利斯</a>在<a class="ae ky" href="https://unsplash.com/s/photos/wine?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d938" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">波尔多红酒在全世界都很受欢迎。Bordeaux 案例研究非常著名地用于使用 r 解释和实现一元和多元线性回归。</p><p id="af20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关案例研究的更多信息，请参见<a class="ae ky" href="https://bookdown.org/egarpor/SSS2-UC3M/multlin-examps.html" rel="noopener ugc nofollow" target="_blank">这里的</a>。数据在<a class="ae ky" href="https://rstudio-pubs-static.s3.amazonaws.com/326428_e7b3416aa30140e79f57b8ed70ca64e4.html" rel="noopener ugc nofollow" target="_blank">这里</a>可用。</p><p id="79e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">线性回归查找数据集可能的最小残差平方和。从<a class="ae ky" rel="noopener" target="_blank" href="/introducing-linear-regression-least-squares-the-easy-way-3a8b38565560">这里</a>开始，让自己快速掌握线性回归基础知识。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="ef35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章讲述了用一个<strong class="lb iu">变量</strong>和多个<strong class="lb iu">变量</strong>创建一个<strong class="lb iu">线性回归</strong>模型的步骤。然后，我们继续根据<strong class="lb iu"> R 平方</strong>对模型进行评分。讨论<strong class="lb iu"> R 平方</strong>的<strong class="lb iu">限制</strong>，我们探索<strong class="lb iu">调整 R 平方</strong>作为评估模型的更好分数。我们会遇到<strong class="lb iu">相关性</strong>和<strong class="lb iu">自变量之间的多重共线性</strong>以及出现这种情况时该怎么办。最后，我们<strong class="lb iu">使用最适合的模型预测</strong>值。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="2d96" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">目标是:</h2><p id="5664" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们希望根据天气状况等特定因素来预测波尔多葡萄酒的价格。价格本质上将量化葡萄酒的质量。</p><h2 id="8d9b" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">进口:</h2><p id="0906" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">下面你将看到使用库组合的 Python 实现:<code class="fe na nb nc nd b">Pandas</code>、<code class="fe na nb nc nd b">Numpy</code>、<code class="fe na nb nc nd b">Scikit-learn</code>、<code class="fe na nb nc nd b">Matplotlib</code>。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="25a0" class="mc md it nd b gy ni nj l nk nl">import pandas as pd <br/>import numpy as np <br/>import matplotlib.pyplot as plt <br/>from sklearn.linear_model import LinearRegression </span><span id="f867" class="mc md it nd b gy nm nj l nk nl">wine = pd.read_csv("wine.csv")</span></pre><h2 id="e67c" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">数据:</h2><p id="6139" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><code class="fe na nb nc nd b">wine.shape</code>告诉我们我们正在处理 25 行 7 列。</p><p id="f359" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">Year</code>:葡萄收获酿酒的年份；<br/> <code class="fe na nb nc nd b">Price</code>:根据 1990-1991 年拍卖的波尔多葡萄酒平均市场价格的对数；<br/> <code class="fe na nb nc nd b">WinterRain</code>:冬季降雨量(毫米)；<br/> <code class="fe na nb nc nd b">AGST</code>:生长季平均温度(摄氏度)；<code class="fe na nb nc nd b">HarvestRain</code>:收获降雨量(毫米)；<br/> <code class="fe na nb nc nd b">Age</code>:葡萄酒的年份，以在木桶中储存的年数来衡量；<code class="fe na nb nc nd b">FrancePop</code>:法国在<code class="fe na nb nc nd b">Year</code>的人口(以千计)。</p><p id="f57e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">wine.info()</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/bd96402530cf5b579b2ccfb1a73477b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yOJtfabPvWuKgXT4_8hiaA.png"/></div></div></figure><p id="44e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">wine.describe(include="all")</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/04030221db24359a5d156553d50e0208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8WgWte5E2_mKNNHl3UUzPw.png"/></div></div></figure><p id="b195" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">wine.head()</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/f1bf3dba1bc3fc46a561f36bcced7e29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NX0-DVVrRPpGDDR8vmtwBw.png"/></div></div></figure><p id="06b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">Price</code>是我们的因变量，其余是我们用来预测<code class="fe na nb nc nd b">Price</code>的自变量。<code class="fe na nb nc nd b">Price</code>量化葡萄酒的品质。</p><p id="a1bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们创建一个一元线性回归模型，根据<code class="fe na nb nc nd b">AGST</code>预测<code class="fe na nb nc nd b">Price</code>。</p><h2 id="9b6c" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">一元线性回归模型:</h2><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="6eb9" class="mc md it nd b gy ni nj l nk nl"><strong class="nd iu"># create an instance of the class LinearRegression</strong><br/>model1 = LinearRegression() </span><span id="f180" class="mc md it nd b gy nm nj l nk nl"><strong class="nd iu"># .values converts the pandas series to a numpy array</strong></span><span id="339a" class="mc md it nd b gy nm nj l nk nl">AGST = wine.AGST.values.reshape((-1, 1)) <strong class="nd iu"># x-value</strong><br/>Price = wine.Price.values<strong class="nd iu"> # y-value</strong></span></pre><p id="c872" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">x 输入数组需要 2D，更准确地说，需要尽可能多的行数和一列数。因此我们必须<code class="fe na nb nc nd b">reshape</code>这个数组。<code class="fe na nb nc nd b">reshape((-1,1))</code>:作为第一个参数的'-1 '让<code class="fe na nb nc nd b">numpy</code>为您确定结果矩阵中未知的行数。“1”指定一列。输出是一维柱状阵列。</p><blockquote class="nq nr ns"><p id="1d37" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">注意:未知数可以是列或行，但不能同时是列和行。</p></blockquote><p id="e484" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们用 x 和 y 值拟合线性回归模型<code class="fe na nb nc nd b">model1</code>。</p><p id="9fdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">model1.fit(AGST, Price)</code></p><p id="c652" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用<code class="fe na nb nc nd b">.fit()</code>计算直线<strong class="lb iu"> y = mx+c </strong>的最优值，用<strong class="lb iu">T33】给定 </strong>输入输出(x 和 y)作为自变量。它返回<code class="fe na nb nc nd b">self</code>，这是变量模型本身。</p><h2 id="f146" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">模型 1 结果:</h2><p id="f3de" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">计算出的回归线的属性，即模型截距和斜率提取如下:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="8a03" class="mc md it nd b gy ni nj l nk nl"><strong class="nd iu"># the model attributes</strong></span><span id="da56" class="mc md it nd b gy nm nj l nk nl">intercept = model1.intercept_</span><span id="d244" class="mc md it nd b gy nm nj l nk nl">slope = model1.coef_</span></pre><blockquote class="nq nr ns"><p id="ccdd" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">y =斜率* x +截距</p></blockquote><p id="aef0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您会注意到<code class="fe na nb nc nd b">intercept</code>是标量，<code class="fe na nb nc nd b">slope</code>是数组。</p><p id="06e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">model1.score(AGST, Price)</code>输出模型的 R 平方值。r 平方是给定数据与计算出的回归线接近程度的度量。</p><blockquote class="nq nr ns"><p id="0369" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">假设我们的模型(回归线)的形式为<strong class="lb iu"> y=mx+c </strong>，R-squared 是平方误差的总和(根据回归线，特定点<strong class="lb iu"> x </strong>的实际数据点<strong class="lb iu"> y </strong>的值与在该值<strong class="lb iu"> x </strong>处的<strong class="lb iu"> y </strong>的计算值之间的差值)。</p></blockquote><p id="a75f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有另一个“值”可以帮助我们预测模型的质量。这是<strong class="lb iu">调整后的 R 平方</strong>。</p><p id="55c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们加入更多的自变量时，r 平方总是会增加。因此，R 平方并不是衡量另一个变量是否应该包含在模型中的理想方法。但是 adjusted-R-squared(根据输入变量的个数修正的 R-squared)如果对模型没有帮助的话会<strong class="lb iu"> <em class="nt">减少</em> </strong>。因此，我们应该为我们创建的每个模型计算调整后的 R 平方，以便进行比较。</p><p id="fd7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">调整后的 R 平方公式:<br/> <code class="fe na nb nc nd b">1 — (1-r_sq)*(len(y)-1)/(len(y)-X.shape[1]-1)</code></p><p id="731d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，我们用<code class="fe na nb nc nd b">Price</code>代替<code class="fe na nb nc nd b">y</code>，用<code class="fe na nb nc nd b">AGST</code>代替<code class="fe na nb nc nd b">X</code>。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="9321" class="mc md it nd b gy ni nj l nk nl">adj_r_sq = 1 — (1-r_sq)*(len(Price)-1)/(len(Price)-AGST.shape[1]-1)</span></pre><p id="695e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">我们的结果:</strong></p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="f354" class="mc md it nd b gy ni nj l nk nl">slope = array([0.63509431])<br/>intercept = -3.4177613134854603</span><span id="020c" class="mc md it nd b gy nm nj l nk nl">r_sq = 0.43502316779991984<br/>adj_r_sq = 0.4104589577042642</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="6f13" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">多元线性回归模型:</h2><p id="f2a4" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们再加一个自变量→ <code class="fe na nb nc nd b">HarvestRain</code>。</p><p id="a01e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的<code class="fe na nb nc nd b">y-value</code>保持原样。同样，我们必须<code class="fe na nb nc nd b">reshape</code>我们的输入变量。一旦整形，我们使用<code class="fe na nb nc nd b">np.concatenate</code>将两个独立变量合并成一个矩阵。<code class="fe na nb nc nd b">axis = 1</code>指定它们沿着列轴连接。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="b7ea" class="mc md it nd b gy ni nj l nk nl">var1 = wine.AGST.values.reshape((-1, 1))<br/>var2 = wine.HarvestRain.values.reshape((-1, 1))</span><span id="2b4a" class="mc md it nd b gy nm nj l nk nl">X = np.concatenate((var1,var2), axis = 1)</span><span id="6487" class="mc md it nd b gy nm nj l nk nl">model2 = LinearRegression()</span><span id="a46f" class="mc md it nd b gy nm nj l nk nl">model2.fit(X, Price)</span></pre><h2 id="8448" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated"><strong class="ak">模型 2 结果:</strong></h2><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="4ef8" class="mc md it nd b gy ni nj l nk nl">r_sq2 = model2.score(X, Price)<br/>adj_r_sq2 = 1 - (1-r_sq2)*(len(Price)-1)/(len(Price)-X.shape[1]-1)</span><span id="6d34" class="mc md it nd b gy nm nj l nk nl">intercept2 = model2.intercept_<br/>slope2 = model2.coef_</span></pre><p id="a98c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">我们的结果:</strong></p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="1a10" class="mc md it nd b gy ni nj l nk nl">slope2 = array([ 0.60261691, -0.00457006])<br/><strong class="nd iu">#array[0] corresponds to the coefficient of AGST<br/>#array[1] corresponds to the coefficient of HarvestRain</strong></span><span id="5fb7" class="mc md it nd b gy nm nj l nk nl">intercept2 = -2.202653600949956</span><span id="7654" class="mc md it nd b gy nm nj l nk nl">r_sq2 = 0.7073707662049418<br/>adj_r_sq2 = 0.6807681085872093</span></pre><p id="a930" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如预期的那样，R 平方值增加了。但是看看调整后的 R 平方值——从之前的 0.41 变成了 0.68。这表明将变量<code class="fe na nb nc nd b">HarvestRain</code>添加到<code class="fe na nb nc nd b">model2</code>中给了我们一个更好的模型来预测<code class="fe na nb nc nd b">Price</code>！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="5681" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以不断添加独立变量，并比较调整后的 R 平方值，以检查模型是变得更好还是更差。但是，在经历每次添加新变量创建新模型的漫长过程之前，我们可以使用<strong class="lb iu"> <em class="nt">相关性</em> </strong>来计算出哪些变量不需要包含在内。</p><h2 id="6648" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">相互关系</h2><p id="6dd4" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">相关性<em class="nt">是指一对变量线性相关的程度</em>。它的范围从-1 到+1。+1 表示完美的正线性关系；相关性为-1 表示完全负线性关系，相关性为 0 表示两个变量之间没有线性关系。</p><p id="ef6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们找出每个变量之间的相互关系。</p><p id="24bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">wine.corr()</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/5f6c19ebd31e167d2947cc28df4361fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wPg4vHdFGrOqqHeskIskeQ.png"/></div></div></figure><p id="5f79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="nt">注意</em> </strong>自变量和因变量(<code class="fe na nb nc nd b">Price</code>)之间有高相关值是好事。当两个独立变量之间高度相关时，问题就出现了。这叫做<strong class="lb iu">多重共线性</strong>。</p><blockquote class="nq nr ns"><p id="d5c1" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">注意:“高相关性”指的是相关性的绝对值，因此包括正相关性和负相关性。</p></blockquote><p id="54b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意<code class="fe na nb nc nd b">Year</code>和<code class="fe na nb nc nd b">Age</code>是绝对负相关的(-1 相关系数)。这是有道理的，因为葡萄收获的年份越老，葡萄酒的年份就越老。</p><p id="777a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">plt.plot(wine.Age.values, wine.Year.values, ‘o’)</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/794a4cb42bb6ed1198fe7ea76c751895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*geVHzOcMNWA8tRLdVXPufw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe na nb nc nd b">Year</code>对<code class="fe na nb nc nd b">Age</code>的曲线图</p></figure><p id="e352" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外两对高度相关的自变量是<code class="fe na nb nc nd b">Year</code> &amp; <code class="fe na nb nc nd b">FrancePop</code> <strong class="lb iu">和</strong> <code class="fe na nb nc nd b">Age</code> &amp; <code class="fe na nb nc nd b">FrancePop</code>。</p><p id="c4f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于上述原因，这些相关性也是有意义的。法国的人口<code class="fe na nb nc nd b">FrancePop</code>，随着每一个<code class="fe na nb nc nd b">Year</code>而增加。同样，葡萄酒的<code class="fe na nb nc nd b">Age</code>随着<code class="fe na nb nc nd b">Year</code>的增加而减少。</p><p id="0c8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于多重共线性，我们必须去除无关紧要的变量。</p><blockquote class="nq nr ns"><p id="799c" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">为什么？</p><p id="e9d8" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">如果 A 与 B 相关，那么我们不能解释 A 和 B 的系数。要知道为什么，想象一下 A=B(完全相关)的极端情况。然后，型号<strong class="lb iu"> y=100 <em class="it"> A+50 </em> B </strong>与型号<strong class="lb iu"> y=5 <em class="it"> A+10 </em> B </strong>或<strong class="lb iu">y =-2000<em class="it">A+4000</em>B</strong>相同。</p><p id="54ee" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">不存在最优解。我们必须不惜一切代价避免这些情况。</p><p id="af5a" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated"><a class="ae ky" href="https://datascience.stackexchange.com/questions/36404/when-to-remove-correlated-variables" rel="noopener ugc nofollow" target="_blank">来源</a></p></blockquote><p id="d44d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须从<code class="fe na nb nc nd b">Year</code>、<code class="fe na nb nc nd b">FrancePop</code>和<code class="fe na nb nc nd b">Age</code>中去掉一些独立变量。<code class="fe na nb nc nd b">Year</code>与<code class="fe na nb nc nd b">FrancePop</code>和<code class="fe na nb nc nd b">Age</code>都相关，并且本质上给出与<code class="fe na nb nc nd b">Age</code>相同的信息。</p><p id="7bc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">移除<code class="fe na nb nc nd b">Year</code>后，我们仍然面临<code class="fe na nb nc nd b">Age</code>和<code class="fe na nb nc nd b">FrancePop</code>之间的多重共线性问题。<code class="fe na nb nc nd b">FrancePop</code>与酒的质量无关。因此，我们保留<code class="fe na nb nc nd b">Age</code>，这对于我们的模型来说直观上是有意义的，因为越老的葡萄酒通常越贵。</p><p id="aece" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，去掉所有三个- <code class="fe na nb nc nd b">Year</code>、<code class="fe na nb nc nd b">Age</code>和<code class="fe na nb nc nd b">FrancePop</code>将导致我们创建一个缺少一个非常重要特性的模型-<code class="fe na nb nc nd b">Age</code>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="5596" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">最终模型:</h2><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="83b0" class="mc md it nd b gy ni nj l nk nl">model3 = LinearRegression()</span><span id="4087" class="mc md it nd b gy nm nj l nk nl">var1 = wine.AGST.values.reshape((-1, 1))<br/>var2 = wine.HarvestRain.values.reshape((-1, 1))<br/>var3 = wine.WinterRain.values.reshape((-1,1))<br/>var4 = wine.Age.values.reshape((-1,1))</span><span id="dda6" class="mc md it nd b gy nm nj l nk nl">X = np.concatenate((var1,var2,var3,var4), axis = 1)</span><span id="33c2" class="mc md it nd b gy nm nj l nk nl">model3.fit(X, Price)</span><span id="8211" class="mc md it nd b gy nm nj l nk nl">r_sq3 = model3.score(X, Price)<br/>adj_r_sq3 = 1 - (1-r_sq3)*(len(Price)-1)/(len(Price)-X.shape[1]-1)<br/>intercept3 = model3.intercept_<br/>slope3 = model3.coef_</span></pre><p id="0ac9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">我们的结果:</strong></p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="4421" class="mc md it nd b gy ni nj l nk nl">slope3 = array([ 0.60720935, -0.00397153,  0.00107551,  0.02393083])<br/>intercept3 = -3.4299801869287148</span><span id="cf7b" class="mc md it nd b gy nm nj l nk nl">r_sq3 = 0.8285662193424285<br/>adj_r_sq3 = 0.7942794632109141</span></pre><p id="f021" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">model3</code>的调整后 R 平方是从<code class="fe na nb nc nd b">model2</code>的 0.68 到 0.79 的跳跃！看起来棒极了！</p><blockquote class="nq nr ns"><p id="3688" class="kz la nt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">你绝对可以尝试创建没有<code class="fe na nb nc nd b">Age</code>和<code class="fe na nb nc nd b">FrancePop</code>的模型，以及没有<code class="fe na nb nc nd b">Age</code>和有<code class="fe na nb nc nd b">FrancePop</code>的模型，看看他们得分的差异。</p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="4a73" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">这些预测:</h2><p id="e6cc" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们期待已久的终于来了。非常感谢您抽出时间来完成这篇文章！</p><p id="0b01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们对<code class="fe na nb nc nd b">model3</code>很满意，现在我们想使用这个模型进行预测。</p><p id="47e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将测试文件读入<code class="fe na nb nc nd b">wine_test</code>。</p><p id="04cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">wine_test = pd.read_csv(“wine_test.csv”)</code></p><p id="0ab7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">wine_test.shape</code> : 2 行 X 7 列</p><p id="a75e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">wine_test.info()</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/7d871f7107bec2dec9bf2890594bfff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9YbX9JpIz97Nji1Gj_hhwA.png"/></div></div></figure><p id="7033" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">先来得到<code class="fe na nb nc nd b">model3</code>的预测回应:</p><p id="0444" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">y_pred = model3.predict(X)</code>。我们得到了一个预测响应的数组。这是使用<code class="fe na nb nc nd b">AGST</code>、<code class="fe na nb nc nd b">HarvestRain</code>、<code class="fe na nb nc nd b">WinterRain</code>和<code class="fe na nb nc nd b">Age</code>的给定值，我们用它们创建了<code class="fe na nb nc nd b">model3</code>。</p><p id="ce4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们使用<code class="fe na nb nc nd b">wine_test</code>中的新数据。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="3ad0" class="mc md it nd b gy ni nj l nk nl">var1 = wine_test.AGST.values.reshape((-1, 1))<br/>var2 = wine_test.HarvestRain.values.reshape((-1, 1))<br/>var3 = wine_test.WinterRain.values.reshape((-1,1))<br/>var4 = wine_test.Age.values.reshape((-1,1))</span><span id="096f" class="mc md it nd b gy nm nj l nk nl">X_test = np.concatenate((var1,var2,var3,var4), axis = 1)</span><span id="b753" class="mc md it nd b gy nm nj l nk nl">y_pred_test = model3.predict(X_test)</span></pre><p id="3f0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">y_pred_test</code>给出一个数组，第一个和第二个测试点的值分别为 6.7689 和 6.6849。</p><p id="3a3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看测试点的给定<code class="fe na nb nc nd b">Price</code>，我们看到两个测试点的实际价格分别为 6.9541 和 6.4979。这说明我们的预测还是蛮不错的！</p><p id="a08e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的测试集非常小，因此我们应该增加测试集的大小，以便对我们的模型更有信心。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="ebf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参考资料:</p><ul class=""><li id="9a38" class="oa ob it lb b lc ld lf lg li oc lm od lq oe lu of og oh oi bi translated"><a class="ae ky" href="https://realpython.com/linear-regression-in-python/" rel="noopener ugc nofollow" target="_blank">Python 中的线性回归</a></li><li id="085a" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated"><a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html" rel="noopener ugc nofollow" target="_blank"> sklearn.linear_model。线性回归</a></li></ul></div></div>    
</body>
</html>