<html>
<head>
<title>Visualizing Traffic Conditions Based on Radio Traffic News</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于广播交通新闻的交通状况可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-traffic-conditions-based-on-radio-traffic-news-67e63eee58b3?source=collection_archive---------30-----------------------#2020-01-18">https://towardsdatascience.com/visualizing-traffic-conditions-based-on-radio-traffic-news-67e63eee58b3?source=collection_archive---------30-----------------------#2020-01-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e3f9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">美声网刮</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7ea124d62a78253c1d79266f430f57f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J_jqQGFDXZNHg4fp"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@jonitboy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Max Titov </a>拍摄的照片</p></figure><h1 id="96a8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">背景</h1><p id="62dd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这个项目发生在 2019 年 10 月，当时我的老板要求我们的团队在网络运营中心(NOC)的大屏幕上可视化我们的网络质量。作为移动运营商，我们经常全天候监控我们的网络质量和状况。开发了许多重要网络 KPI 的仪表板，我的老板希望我们增强所获得的信息，让 NOC 员工“知道/猜测”正在发生的事情。</p><p id="34ad" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们的网络流量可能会受到许多外部因素的影响，我们可以想到的一般信息之一是流量状况，我指的是道路上的实际流量。当出现拥堵、交通堵塞或其他特殊路况时，该特定蜂窝基站的 KPI 可能会爆仓。因此，我们希望在地图上可视化交通状况，让我们的工作人员知道哪个位置有情况。</p><h1 id="bbc0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">使用 BeautifulSoup 进行网页抓取</h1><p id="87bf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi">Radio news provides a very good source of detail traffic conditions as they are very useful for the Taxi drivers to choose their route (especially before the birth of Google Map). Besides the radio broadcast, all this information is online. The one we are choosing is the official radio station of Hong Kong RTHK: <a class="ae ky" href="http://programme.rthk.hk/channel/radio/trafficnews/index.php" rel="noopener ugc nofollow" target="_blank">http://programme.rthk.hk/channel/radio/trafficnews/index.php</a> (Sorry, only Chinese version available). If you know Chinese, you may figure out that the news is well-formatted. If the news is about traffic congestion, the format is the name of the road, the direction, and the queue end position (龍尾：)</p><p id="d71b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">HTML 结构也非常好。我们可以看到所有单独的新闻都有一个无序列表<ul>和一个包含类 inner 的条目<li>。</li></ul></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/c48e8f2ab3733f8820215fe61d33a63d.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/0*UhqThhSye8JFD8qj.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新闻网站的 HTML 结构</p></figure><p id="0311" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有了请求和 BeautifulSoup，我们很容易获得并解析网页。感谢标准格式，我们可以在一秒钟内看到所有的故事。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="693f" class="my la it mu b gy mz na l nb nc">import requestsfrom bs4<br/>import BeautifulSoup<br/>r = requests.get("http://programme.rthk.hk/channel/radio/trafficnews/index.php")<br/>if r.status_code == requests.codes.ok:<br/>    r.encoding='utf-8'<br/>    soup = BeautifulSoup(r.text, 'html.parser')<br/>    stories = soup.find_all('li', class_='inner')</span></pre><p id="b2ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将每条新闻分为标题(新闻内容)和发布时间。我们用“%Y-%m-%d HKT %H:%M”来格式化发布时间。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0aff" class="my la it mu b gy mz na l nb nc">titles = []<br/>times = []<br/>for s in stories:<br/>    title, time = list(filter(None, re.split(r'<strong class="mu iu">\t</strong>|<strong class="mu iu">\n'</strong>, s.text)))<br/>    titles.append(title)<br/>    times.append(time)</span></pre><p id="02ab" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi">The most difficult part is to extract the location. Here we search for the particular phrase (龍尾：), which means the queue end in Chinese. If this phrase does not include in the news, we search for our location database. We will discuss how we obtain this database later. And now we have this DataFrame with title, publish time and location.</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/0bd7a9c5fad4076551f26a54e68b4bfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EPe6hjbN0LmQDTeI.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">交通新闻的数据框架</p></figure><p id="bea9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">接下来，我们需要对新闻进行分类。经过长时间的观察，我们发现新闻的类型属于这几类:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/d7660db851bc0cc20803d21dfd9cd654.png" data-original-src="https://miro.medium.com/v2/resize:fit:362/format:webp/0*jfZQEvRLUyAypoxH.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">交通新闻类别</p></figure><p id="7045" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">服务暂停:</strong>部分公共交通服务停止，<br/> <strong class="lt iu">受阻:</strong>部分道路因各种原因受阻:附近道路维修或特殊事件，<br/> <strong class="lt iu">繁忙:</strong>道路繁忙但仍可行驶；<br/> <strong class="lt iu">拥堵:</strong>道路严重拥堵；<br/> <strong class="lt iu">事故:</strong>那条路上发生了交通事故；<br/> <strong class="lt iu">正常:</strong>被封锁或拥堵的道路恢复通行；<br/> <strong class="lt iu"> Info: </strong>只是一些大概的信息。</p><p id="9cc8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">而且那些措辞曾经重复出现过很多次。因此，我们可以通过识别词语来明确地划分不同的类别。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="fbc0" class="my la it mu b gy mz na l nb nc"># set category<br/>df.loc[df.title.str.contains('關閉'), 'category'] = 'service paused'<br/>df.loc[df.title.str.contains('暫停'), 'category'] = 'service paused'<br/>df.loc[df.title.str.contains('間封'), 'category'] = 'blocked'<br/>df.loc[df.title.str.contains('繁忙'), 'category'] = 'busy'<br/>df.loc[df.title.str.contains('多車'), 'category'] = 'busy'<br/>df.loc[df.title.str.contains('車多'), 'category'] = 'busy'<br/>df.loc[df.title.str.contains('慢車'), 'category'] = 'busy'<br/>df.loc[df.title.str.contains('龍尾'), 'category'] = 'busy'<br/>df.loc[df.title.str.contains('塞車'), 'category'] = 'congestion'<br/>df.loc[df.title.str.contains('擠塞'), 'category'] = 'congestion'<br/>df.loc[df.title.str.contains('意外'), 'category'] = 'accident'<br/>df.loc[df.title.str.contains('回復暢順'), 'category'] = 'normal'<br/>df.loc[df.title.str.contains('回復正常'), 'category'] = 'normal'<br/>df.loc[df.title.str.contains('恢復運作'), 'category'] = 'normal'<br/>df.loc[df.title.str.contains('禁止'), 'category'] = 'blocked'<br/>df.loc[df.title.str.contains('受阻'), 'category'] = 'blocked'<br/>df.loc[df.title.str.contains('不能通車'), 'category'] = 'blocked'<br/>df.loc[df.title.str.contains('封閉'), 'category'] = 'blocked'<br/>df.loc[df.title.str.contains('封路'), 'category'] = 'blocked'<br/>df.loc[df.title.str.contains('恢復'), 'category'] = 'normal'<br/>df.loc[df.title.str.contains('回復'), 'category'] = 'normal'<br/>df.loc[df.title.str.contains('重開'), 'category'] = 'normal'<br/>df.loc[df.title.str.contains('間封措施取消'), 'category'] = 'normal'<br/>df.loc[df.category.isnull(), 'category'] = 'info'</span></pre><p id="3d46" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了定位交通新闻场景，我们需要纬度和经度。幸运的是，我们找到了一个 API GeoPy。你可能会找到一个关于如何使用它的很好的书面教程，从<a class="ae ky" rel="noopener" target="_blank" href="/geocode-with-python-161ec1e62b89"> Geocode with Python，到数据科学</a>。这将物理地址转换为地理位置(即纬度和经度)。乍一看，我们怀疑这个 python 库是否支持中文地址。但事实证明它有着相当不错的性能。我们使用的是基于 OpenStreetMap 数据构建的 nomist 地理编码服务。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="b052" class="my la it mu b gy mz na l nb nc">locator = Nominatim(user_agent=’myGeocoder’, timeout=3)<br/>try:<br/>    location = locator.geocode(record)<br/>except GeocoderTimedOut as e:<br/>    print(“Error: geocode failed on input {} with message {}”.format(record, e))</span></pre><p id="df90" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">过了一段时间，我们收集了一堆新闻，可以选择经常出现的道路手动查询其经纬度(相信我，交通拥堵每天都在同一条道路上重复重复！)</p><p id="b07b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是我们 NOC 中使用的仪表板。也请访问 Tableau 创建的<a class="ae ky" href="https://public.tableau.com/profile/joshua.yeung#!/vizhome/TrafficNewsVisualization/TrafficNews" rel="noopener ugc nofollow" target="_blank">演示站点</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/06e680800fa358185aebe2e76c7da445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x9Qsyhy-JNbMkkiI.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">交通状况仪表板</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/591d24448f1e3cfdab99a17e2e79580f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GEMfVemN6UfmMQBj0AboQw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 Tableau 的可视化</p></figure><h1 id="5d97" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="b349" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">感谢互联网上的丰富资源和那些已经建立了重要有用模块的巨人，我们可以在他们的基础上建立一个交通新闻可视化仪表板。</p><p id="68cd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要了解这个项目的更多信息，请点击这里查看我的 Github 链接<a class="ae ky" href="https://github.com/joshuayeung/Local-Traffic-News-Visualization" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>