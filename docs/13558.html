<html>
<head>
<title>A Guide: Turning OpenStreetMap Location Data into ML Features</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">指南:将 OpenStreetMap 位置数据转化为 ML 要素</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-guide-turning-openstreetmap-location-data-into-ml-features-e687b66db210?source=collection_archive---------25-----------------------#2020-09-17">https://towardsdatascience.com/a-guide-turning-openstreetmap-location-data-into-ml-features-e687b66db210?source=collection_archive---------25-----------------------#2020-09-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9879" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何将商店、餐馆、公共交通方式和其他当地设施融入您的 ML 模型。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/919ff84bfe8a717b9e537d3528acd12e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E5VPlZhk1qsQbG9q9exgmQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">伦敦一系列便利设施的热图。由作者用 Python 制作。</p></figure><p id="3927" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就拿下面这个问题来说。你的任务是预测一个新的 Airbnb 主机可能会在伦敦收取多少费用(推而广之，客人可能会支付多少)。要回答这个问题，你需要收集可能影响该市 Airbnb 房产夜间价格的因素的数据。</p><p id="4e75" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你收集的数据越多，你的 ML 模型就越能接近接近完美预测的最佳点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lr"><img src="../Images/5470ea1e700ab4ed511e299e2bcb6859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EZxahbuYw8lJ9Qr73rhNfQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者制作</p></figure><p id="8aea" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你已经有了关于伦敦 80，000 处 Airbnb 房产和它们的主人的信息。然而，你错过的是关于竞争的关键信息——酒店在哪里，附近有多少商店、酒吧、餐馆、旅游目的地等。毕竟，谁去伦敦旅游是为了呆在一个安静的街区，没有任何活动呢？这就是 OpenStreetMap 可以提供帮助的地方。</p><p id="47f3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们继续之前，如果你更愿意以 Jupyter 笔记本的形式遵循这个指南，在文章的最后提供了一个链接。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="8b40" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">什么是 OpenStreetMap？</h1><p id="7989" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">OpenStreetMap (OSM)将自己描述为“一个创建免费可编辑世界地图的合作项目”。它们是地图的维基百科。它的 500 万贡献者可以做任何事情，从增加新的道路或移除已经关闭的商店。</p><h2 id="14f5" class="mx mb iq bd mc my mz dn mg na nb dp mk le nc nd mm li ne nf mo lm ng nh mq ni bi translated">可靠，准确，免费！</h2><p id="5028" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">如果有人能改变它，它甚至是可靠的吗？是啊！除非你是谷歌的铁杆用户，否则你可能每天都在使用 OSM。苹果、微软、脸书、Mapbox 和 FourSquare 都使用 OSM 作为他们地图工作的基础。<a class="ae ls" href="https://wiki.openstreetmap.org/wiki/Amazon_Logistics" rel="noopener ugc nofollow" target="_blank">亚马逊</a>将其用于他们的物流链。<a class="ae ls" href="https://www.tesmanian.com/blogs/tesmanian-blog/tesla-owners-smart-summon-routes-open-street-maps-full-self-driving" rel="noopener ugc nofollow" target="_blank">特斯拉</a>在他们的自动驾驶汽车上使用。优步在他们的内部寻路平台上使用它。OSM 可能是现存最久经考验的地图平台。</p><p id="2da5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你也可以从这些<em class="nj">企业技术贡献者</em>正在大规模增加平台的事实中得到一些安慰。微软将计算机视觉和卫星图像结合起来，在美国增加了 1 . 24 亿个建筑足迹。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/df40e6ee67ddec6f1ace3a8fd1c7b68d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6XbRJnbey94IirEZ4JrQ8A.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">随着时间的推移，企业对 OpenStreetMap 的贡献。来自<a class="ae ls" href="https://media.ccc.de/v/state-of-the-map-2020-academic-track-4858-curious-cases-of-corporations-in-openstreetmap" rel="noopener ugc nofollow" target="_blank"> SOTM2020 </a>的截屏(在 07:45)。</p></figure><p id="187b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">OSM 最大的优势是<strong class="kx ir">绝对免费</strong>，可以无限制使用。你可以获得大量关于当地的信息——从当地的便利设施到公交车站、自行车道甚至饮水机。<a class="ae ls" href="https://wiki.openstreetmap.org/wiki/Map_Features#Aeroway" rel="noopener ugc nofollow" target="_blank">点击这里</a>查看 OSM 特色的完整列表。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="167a" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">访问 OpenStreetMap 数据</h1><h2 id="c326" class="mx mb iq bd mc my mz dn mg na nb dp mk le nc nd mm li ne nf mo lm ng nh mq ni bi translated">安装和基本查询</h2><p id="58ed" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">我们通过 OSMnx 访问 OSM 数据——这是一个 python 模块，最初由 Geoff Boeing 编写，以支持他的博士论文。</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="15f2" class="mx mb iq nm b gy nq nr l ns nt">pip install osmnx</span></pre><p id="fa9d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">假设我们想找到伦敦所有的餐馆:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/7c348b5f556f2e8421ab27eeb4ee4fb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*boM5p-oWKy7jidL-rj_AaQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Geopandas 是伦敦 OSMnx 搜索的数据框架。图片作者。</p></figure><p id="94aa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以循环这个过程，还可以提取酒吧、餐馆、夜总会和所有其他可能影响房东对 Airbnb 收费的便利设施的所有数据。</p><h2 id="c1dd" class="mx mb iq bd mc my mz dn mg na nb dp mk le nc nd mm li ne nf mo lm ng nh mq ni bi translated">绘图和可视化</h2><p id="f7a6" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">让我们快速检查一下我们得到的数据。我们将使用 OSMnx 绘制伦敦边界的几何图形，并使用 matplotlib 绘制两者。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/cfb01bc691d6504e5ddbd777b7501f7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-Vrv0jyXHwzJBIQ0k8DPQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">伦敦机场地图。由作者使用上述代码制作。</p></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="2894" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">将数据转化为要素</h1><p id="c01b" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">我们目前拥有的是伦敦所有餐馆的数据框架。对于机器学习模型，我们需要的是 Airbnb 每家酒店 10 分钟步行范围内的餐厅数量。要做到这一点需要相当多的操作。</p><h2 id="344b" class="mx mb iq bd mc my mz dn mg na nb dp mk le nc nd mm li ne nf mo lm ng nh mq ni bi translated">步骤 1:将多边形转换为点</h2><p id="da34" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">OSMnx 以单点(经度/纬度)坐标的形式返回大多数属性。但是，有一些会以多边形(一种形状)的形式返回。当属性很大时，通常会发生这种情况。处理多边形比处理点更复杂，所以我们将通过计算它们的中心点把它们都转换成点。我们用 shapely 来做这个。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="2444" class="mx mb iq bd mc my mz dn mg na nb dp mk le nc nd mm li ne nf mo lm ng nh mq ni bi translated">步骤 2:将点坐标转换为局部投影</h2><p id="0648" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">在我们进行任何计算之前，我们需要将我们的点坐标转换成局部投影。正如你所知道的，地球是一个球体。投影是一种展平地球表面的方法，因此我们可以在地图上显示它。然而，问题是，没有办法使球体表面变平，使得所有部分的大小成比例地相等。</p><p id="008b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下面的例子为例。在左边，我们有墨卡托投影——一种流行的地图投影，最初是为了帮助 16 世纪的水手环游世界而设计的。注意，离赤道越远，陆地越大。在右边，我们有一个等矩形投影，它纠正了其中的一些问题。注意两张地图上非洲和格陵兰岛的大小差异。</p><div class="kg kh ki kj gt ab cb"><figure class="ny kk nz oa ob oc od paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/5048a708cedefb0069f083359f9f451e.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*2WlGgyAWHPeqWlsOnL2s4Q.jpeg"/></div></figure><figure class="ny kk oe oa ob oc od paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/3a8a0040c9e462146c9145c38fb119d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*Lfcsn9Mol8v0fYSfvQ4cBA.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk of di og oh translated">左:<a class="ae ls" href="https://simple.wikipedia.org/wiki/Equirectangular_projection#/media/File:Equirectangular-projection.jpg" rel="noopener ugc nofollow" target="_blank">墨卡托</a>投影。右图:<a class="ae ls" href="https://simple.wikipedia.org/wiki/Equirectangular_projection#/media/File:Equirectangular-projection.jpg" rel="noopener ugc nofollow" target="_blank">等角矩形</a>投影。两张图片都来自维基百科。</p></figure></div><p id="1fcb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一些等地球投影确实存在，但它们作为视觉工具毫无用处。取这两个方位等距投影。你应该能认出右边的那个是联合国的标志。</p><div class="kg kh ki kj gt ab cb"><figure class="ny kk oi oa ob oc od paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/da67bf8cccb5ee8d27f34b15a3b75eba.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*Ma5ofgOPSaUHukkI5sNRww.jpeg"/></div></figure><figure class="ny kk oj oa ob oc od paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/f0bbbadb37acc029175196df53e320d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*Ggp5xIS3xk7tYhWGsr3y4Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk ok di ol oh translated">左图:方位角等距投影照片。右联合国标志。均来自<a class="ae ls" href="https://en.wikipedia.org/wiki/Azimuthal_equidistant_projection" rel="noopener ugc nofollow" target="_blank">维基百科</a>。</p></figure></div><p id="38c8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">解决这个问题的唯一方法是找到一个投影，使你感兴趣的世界的特定部分大小相等。这些被称为本地 UTM 坐标参考系统。幸运的是，OSMnx 内置了一个方法，可以帮助我们快速找到正确的本地 UTM。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="99e4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们有了本地 UTM，我们导入 Airbnb 数据并将其转换为本地投影。我们对从 OSMnx 获取的原始餐馆数据进行同样的处理。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="c98f" class="mx mb iq bd mc my mz dn mg na nb dp mk le nc nd mm li ne nf mo lm ng nh mq ni bi translated">步骤 3:创建一个 K-D 树来计算距离</h2><p id="53cf" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">最后，我们需要遍历每个 AirBnb 酒店，并计算出在 10 分钟步行距离内(大约 1 公里)有多少家餐馆。</p><p id="db08" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我用 K-D 树来做这个。解释 K-D 树是如何工作的超出了本文的范围，但简而言之，它们是搜索我们的 80，000 个 AirBnb 房间和 6，000 家餐厅并找出哪些房间靠近哪些餐厅的超级有效的方法。首先，我们建立所有餐馆点的树:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="504b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我们创建一个函数，将在我们的每个 Airbnb 资产上执行该函数。该函数将查询该树，找到最近的 500 家餐馆，并计算它们离 Airbnb 酒店的距离。我们使用 500 这个数字，希望附近没有超过 500 家餐馆。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="58fa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们设置了一个计时器，并将该函数应用于 Airbnb 的每一行:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="dca5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该功能在 80，000 个属性上需要大约 90 秒。让我们来看看结果:<code class="fe om on oo nm b">air_gdf[[‘id’,’restaurants’]].head(5)</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/66e158b8e855afbba8af910a1af433d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:342/format:webp/1*Ua1fgERcWvbvJ0q29G-rxg.png"/></div></figure><h1 id="c9e7" class="ma mb iq bd mc md oq mf mg mh or mj mk jw os jx mm jz ot ka mo kc ou kd mq mr bi translated">结果呢</h1><p id="0280" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">所以你有它。现在你知道有多少家餐馆在每个 AirBnb 房产 10 分钟的步行范围内，有 80，000 个 Airbnb 房产。你可以对酒吧、商店、地铁站、旅游热点、公园以及任何你认为可能影响 Airbnb 房产价格的地方重复这个过程——就像我一样。</p><p id="67c8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我的最终 XGBoost 模型中，正如你在下面看到的，这些 OSM 的特征(用红色突出显示)最终成为伦敦价格的一些最重要的驱动因素。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/47695a263973fd4b62493cfb1e2f29b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wULS5fJ2a_9vqsmGQxLmwQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">功能重要性。由作者用 Python 制作。</p></figure><p id="5826" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">完整的 Jupyter 笔记本<a class="ae ls" href="https://github.com/dljthomas1/Accessing-OpenStreetMap-Data" rel="noopener ugc nofollow" target="_blank">请看这里</a>。</p><p id="fa64" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="nj">喜欢这篇文章吗？在 Instagram 上查看我的数据可视化页面:</em><a class="ae ls" href="https://www.instagram.com/HouseOfData/" rel="noopener ugc nofollow" target="_blank"><em class="nj">HouseOfData</em></a><em class="nj">。</em></p></div></div>    
</body>
</html>