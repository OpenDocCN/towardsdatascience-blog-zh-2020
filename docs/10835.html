<html>
<head>
<title>Syncing Data from Snowflake to DynamoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将数据从雪花同步到 DynamoDB</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/syncing-data-from-snowflake-to-dynamodb-e28363b6432?source=collection_archive---------40-----------------------#2020-07-28">https://towardsdatascience.com/syncing-data-from-snowflake-to-dynamodb-e28363b6432?source=collection_archive---------40-----------------------#2020-07-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2f53" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于如何同步 DynamoDB 并用来自雪花的数据填充 dynamo db 以供实时应用程序使用的指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/05e648b92495c25cf80e12849a5ee095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iUSUpiJp_dCslGvT79r5FQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:<a class="ae ky" href="https://pixabay.com/users/TanteTati-77004/" rel="noopener ugc nofollow" target="_blank"> TanteTati </a>来自 pixabay</p></figure><p id="3b63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在实现移动和 web 应用程序时，使用 NoSQL 服务作为数据存储是显而易见的。这是因为它能够以低延迟处理操作，并且对开发人员来说很直观。在众多 NoSQL 数据库中，完全托管的 AWS DynamoDB(键值)是最常用的高可伸缩性数据库之一。</p><p id="4359" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将带您了解如何将 DynamoDB 与 Snowflake 的性能增强功能相集成，以弥合低延迟数据存储和繁重复杂的数据计算之间的差距。</p><h1 id="d6a7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">为什么要连接 DynamoDB 和雪花</h1><p id="8502" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果您以前使用过 NoSQL 数据存储，您会知道它的主要用途是存储和接收数据，而不是运行分析计算。然而，在数据驱动的应用程序中，总是有分析的元素。</p><p id="213c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">给定一个<em class="ms">“省钱”</em>类型应用程序的典型场景，当客户本月的非公用事业支出比过去 12 个月的平均支出多 20%时，您可能想要提醒客户。要执行此操作，您可能需要:</p><ol class=""><li id="24c1" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">合计本月非公用事业项目的支出</li><li id="75a4" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">计算过去 12 个月的非公用事业支出，并取平均值</li><li id="0346" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">找出这个月的花费和过去 12 个月的平均花费之间的百分比差异</li><li id="868b" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">比较客户本月消费百分比差异是否大于 20%</li></ol><p id="0046" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这里，你将需要客户，他们在过去 12 个月的支出，支出分类器，和一堆计算。这都是 DynamoDB 不擅长的事情，但雪花却非常擅长。</p><h1 id="c730" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">集成雪花和 DynamoDB</h1><p id="59ca" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有一些集成或 EL 工具可以让您将 DynamoDB 加载到 Snowflake，但没有多少其他方法可以让您使用分析来驱动前端应用程序。</p><p id="cf3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想给你看一些我整理的东西，这些东西对我正在做的一个项目非常有用。最棒的是，它是一种无服务器和事件驱动的方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/87531dd1f24f568c3ee3faa1f744e3f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zP4_05_ytyn4PSbKXgm6tA.png"/></div></div></figure><ol class=""><li id="f5ab" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">雪花将数据卸载到 S3，无论是手动卸载、使用编排工具还是创建雪花任务。</li><li id="c9e3" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">一旦数据放到 S3 上，就会触发一个 Lambda 来读取文件并放入 DynamoDB。</li></ol><h2 id="d850" class="ni lw it bd lx nj nk dn mb nl nm dp mf li nn no mh lm np nq mj lq nr ns ml nt bi translated">从雪花到 S3 卸货</h2><p id="8c38" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">出于演示的目的，我已经将 2020 年 5 月的墨尔本停车场传感器数据加载到 Snowflake 上，以显示摄取量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="4074" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将所有停车传感器数据卸载到 snowflake-drop2dynamodb S3 桶中，该桶包含大约 170 万行数据。请注意，我为 DynamoDB 表的“id”字段创建了一个散列，因为我没有惟一的标识符。COPY INTO 语句将创建文件块，最大大小为 10mb。对于每个数据块，Lambda 将被调用以接收到 DynamoDB 中(不保证顺序)。</p><h2 id="627a" class="ni lw it bd lx nj nk dn mb nl nm dp mf li nn no mh lm np nq mj lq nr ns ml nt bi translated">使用 Lambda 将雪花提取物插入 DynamoDB</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/c21e24440db090d0582fbc2dc3bddddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*crWcn0qj2nItNN1Oza3ynA.png"/></div></div></figure><p id="8b83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦 Snowfload 中的 CSV 文件被卸载到 S3 存储桶中，执行超时为 1 分钟的 Lambda 就开始将文件加载到 DynamoDB 表上。它的建立受到了 AWS 演示的启发。python 函数不会将任何数据加载到内存中，到目前为止，这显示了有希望的结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="c571" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="3a8a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">通过使用支持触发器的 S3 和 Lambda，您可以轻松地在 Snowflake 和 DynamoDB 之间构建一个集成管道。这允许您按需或按计划将 DynamoDB 与来自雪花的数据同步。这样，您可以添加或更新属性，同步 DynamoDB 的在线 ML 要素存储和性能批处理计算。</p><p id="b4e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我面临的一些挑战，我想实施一些改进，包括:</p><ol class=""><li id="fe95" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">能够将失败放在一边重新处理，并将完成的文件移动到另一个文件夹/桶。</li><li id="6ac0" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">即使 S3 保证至少一次交付，我还是想在上面建立一个审计表，由雪花函数提供支持。</li><li id="fc68" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">采用事件驱动的编排方法来提高可靠性和持久性。</li></ol><p id="220d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望这篇文章对你有用！</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="5d01" class="lv lw it bd lx ly oe ma mb mc of me mf jz og ka mh kc oh kd mj kf oi kg ml mm bi translated">关于我</h1><blockquote class="oj ok ol"><p id="9382" class="kz la ms lb b lc ld ju le lf lg jx lh om lj lk ll on ln lo lp oo lr ls lt lu im bi translated">我一直在帮助企业在生产 AI/ML、数据工程、无服务器和容器领域构建可扩展的云和数据解决方案，并且对前端开发越来越感兴趣。你可以在<a class="ae ky" href="https://www.linkedin.com/in/cyamma/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上和我联系聊天——只要告诉我你来自 Medium。</p></blockquote></div></div>    
</body>
</html>