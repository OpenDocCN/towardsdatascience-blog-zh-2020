<html>
<head>
<title>3 Libraries You Should Know to Master Apache Kafka in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">掌握 Python 中的 Apache Kafka 应该知道的 3 个库</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-libraries-you-should-know-to-master-apache-kafka-in-python-c95fdf8700f2?source=collection_archive---------4-----------------------#2020-05-26">https://towardsdatascience.com/3-libraries-you-should-know-to-master-apache-kafka-in-python-c95fdf8700f2?source=collection_archive---------4-----------------------#2020-05-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c10f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python 开发者使用 Kafka 的手册</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b8a2d22874794b89342565ef56be3070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W1f3aGDxj6PjKAhE"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杰克·吉文斯在<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3ff3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">数据赋予世界力量。我们每秒钟都会获得大量信息，我们对其进行清理、分析并创造出更有价值的输出，无论是日志文件、用户活动、聊天消息还是其他内容。我们交付得越快，我们给客户带来的价值就越多。我们处在一个快节奏和不断变化的环境中。</span></p><p id="0af4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Apache Kafka 是一个分布式流媒体平台，可以实时发布、订阅、存储和处理消息。其基于拉的架构减轻了负载较重的服务的压力，并使其易于扩展。它以低延迟将大量数据从源移动到目的地。</p><div class="me mf gp gr mg mh"><a href="https://medium.com/@_JeffPoole/thoughts-on-push-vs-pull-architectures-666f1eab20c2" rel="noopener follow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">关于推与拉架构的思考</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">我最近和一些人讨论了不同服务架构的优缺点…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">medium.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv ks mh"/></div></div></a></div><p id="573c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Kafka 是一个基于 JVM 的平台，所以客户端的主流编程语言是 Java。但是随着社区的快速发展，高质量的开源 Python 客户端也可以使用，并被用于生产中。</p><p id="b0f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将涵盖最知名的 Python Kafka 客户端:<em class="mw"> kafka-python </em>、<em class="mw"> pykafka </em>和<em class="mw"> confluent-kafka </em>并对它们进行比较。最后，我会给出我对每个库的利弊的看法。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="729e" class="ne nf it bd ng nh ni dn nj nk nl dp nm li nn no np lm nq nr ns lq nt nu nv nw bi translated">我们为什么要卡夫卡？</h2><p id="e27f" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">首先要做的事。为什么是卡夫卡？Kafka 旨在推动事件驱动的架构。它通过提供高吞吐量、低延迟、高耐用性和高可用性解决方案来增强架构。<em class="mw">(这并不意味着你可以同时拥有它们，总会有所取舍。阅读此白皮书了解更多信息。)</em></p><div class="me mf gp gr mg mh"><a href="https://www.confluent.io/white-paper/optimizing-your-apache-kafka-deployment/" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">如何部署和优化 Kafka 以实现高性能和低延迟</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">Apache Kafka 是一个 power stream 处理平台。本白皮书讨论了如何优化 Kafka 部署，以用于…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">www.confluent.io</p></div></div><div class="mq l"><div class="oc l ms mt mu mq mv ks mh"/></div></div></a></div><p id="61a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了它的高性能，另一个吸引人的特性是<em class="mw">发布/订阅</em>模型，其中发送者不专门向接收者发送消息。取而代之的是，根据<strong class="lb iu"> <em class="mw">主题</em> </strong>，消息被传送到接收者可以订阅的集中地点。</p><p id="ee84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这样做，我们可以轻松地分离应用程序，摆脱单一设计。让我们看一个例子来理解为什么解耦更好。</p><p id="a7e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您创建了一个需要将用户活动发送到某个地方的网站，因此您编写了一个从您的网站到实时监控仪表板的直接连接。这是一个简单的解决方案，效果很好。有一天，您决定将用户活动存储在数据库中以供将来分析。所以，你写另一个直接的数据库连接到你的网站。与此同时，您的网站获得了越来越多的流量，您希望通过添加警报服务、实时分析服务等来增强它的能力。</p><p id="30a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的架构最终会变成这样。诸如大量代码回购、安全问题、可伸缩性问题和可维护性问题等问题会伤害到你。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/de93d41821ff731674122eadc1429375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*4Na1ubon8RzXNKkJ6l0LLA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">无解耦建筑(由高创作)</p></figure><p id="298d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你需要一个<em class="mw">中枢</em>来分离不同角色的应用程序。对于创建事件的应用程序，我们称之为<strong class="lb iu"> <em class="mw">生产者</em> </strong>。他们将事件发布到一个集中的<em class="mw">中心</em>。每个事件(即消息)属于一个<strong class="lb iu"> <em class="mw">主题</em> </strong>。在<em class="mw">枢纽</em>的另一侧坐着<strong class="lb iu"> <em class="mw">消费者</em> </strong> <em class="mw">。他们从<em class="mw">中心</em>订阅他们需要的话题，而不直接与制作人对话。</em></p><p id="4467" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个模型，架构可以很容易地扩展和维护。工程师可以更专注于核心业务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/e57bca24350b27f0c02dcdf6baa1ffec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*P6p0Tge7-zVE6fE618yDGA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">解耦建筑(由高创作)</p></figure><h2 id="621a" class="ne nf it bd ng nh ni dn nj nk nl dp nm li nn no np lm nq nr ns lq nt nu nv nw bi translated">简而言之卡夫卡的设置</h2><p id="884a" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">可以从<a class="ae ky" href="https://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">官网</strong> </a>下载阿帕奇卡夫卡。<a class="ae ky" href="https://kafka.apache.org/quickstart" rel="noopener ugc nofollow" target="_blank">快速启动</a>帮助你在 10 秒内启动服务器。</p><p id="41ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也可以从<a class="ae ky" href="https://www.confluent.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">合流平台</strong> </a>下载阿帕奇卡夫卡。这是迄今为止最大的面向 Kafka 的流媒体数据平台。它为个人和企业提供了一系列围绕 Kafka 的基础设施服务，使数据可以作为实时流使用。<a class="ae ky" href="https://www.confluent.io/about/" rel="noopener ugc nofollow" target="_blank">创始人是最初创建 Apache Kafka 的团队成员。</a></p><p id="1caa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个 Kafka 服务器被称为一个<strong class="lb iu"> <em class="mw">代理</em> </strong>，你可以独立运行它或者组成一个集群。除了卡夫卡，我们还需要<a class="ae ky" href="https://zookeeper.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Zookeeper </strong> </a>来存储关于卡夫卡的元数据。Zookeeper 就像一个指挥者，管理分布式系统中每个代理的状态。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/93232b0a9f147ab15f13ecfe4772cf95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h1IxBKldHTupmQmLKfNUqA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卡夫卡装置(由高创作)</p></figure><p id="85b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们已经用 1 个动物园管理员和 1 个 Kafka 经纪人建立了基础设施。是时候连接它了！原 Java 客户端提供了<a class="ae ky" href="https://kafka.apache.org/documentation/#api" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> 5 个 API</strong></a>:</p><ul class=""><li id="65dd" class="of og it lb b lc ld lf lg li oh lm oi lq oj lu ok ol om on bi translated">生产者 API:向 Kafka 集群中的主题发布消息。</li><li id="cecb" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">消费者 API:消费 Kafka 集群中主题的消息。</li><li id="3fa8" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">Streams API:消费来自主题的消息，并将它们转换成 Kafka 集群中的其他主题。操作可以是过滤、连接、映射、分组等。</li><li id="eeda" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">Connect API:无需编码，直接将 Kafka 集群连接到源系统或接收系统。该系统可以是文件、关系数据库、弹性搜索等。</li><li id="0322" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">Admin API:管理和检查 Kafka 集群中的主题和代理。</li></ul><h2 id="26fa" class="ne nf it bd ng nh ni dn nj nk nl dp nm li nn no np lm nq nr ns lq nt nu nv nw bi translated">卡夫卡的 Python 库</h2><p id="ad40" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">在 Python 世界中，已经实现了 5 个 API 中的 3 个，它们是生产者 API、消费者 API 和管理 API。Python 中还没有这样的 Kafka Stream API，但是一个不错的替代品是<a class="ae ky" href="https://faust.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Faust </strong> </a>。</p><p id="d5e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本节中的测试是基于本地安装的 1 个 Zookeeper 和 1 个 Kafka broker 执行的。这与性能调优无关，所以我主要使用库提供的默认配置。</p><p id="03f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/dpkp/kafka-python" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">卡夫卡-巨蟒</strong> </a></p><blockquote class="ot ou ov"><p id="348d" class="kz la mw lb b lc ld ju le lf lg jx lh ow lj lk ll ox ln lo lp oy lr ls lt lu im bi translated">kafka-python 的设计功能非常类似于官方的 java 客户端，只带有少量 python 接口。最好配合卡夫卡 0.9+版使用。第一次发布是在 2014 年 3 月。它被积极地维护着。</p></blockquote><p id="5234" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">安装</em></p><pre class="kj kk kl km gt oz pa pb pc aw pd bi"><span id="669e" class="ne nf it pa b gy pe pf l pg ph">pip install kafka-python</span></pre><p id="f8a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">制片人</em></p><p id="525c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每条消息通过<code class="fe pi pj pk pa b">send()</code> <strong class="lb iu">异步发送</strong>。当被调用时，它将记录添加到缓冲区并立即返回。这允许制作人以批处理模式向 Kafka 经纪人发送记录以提高效率。异步可以极大地提高速度，但是我们也应该理解一些事情:</p><ol class=""><li id="e5e9" class="of og it lb b lc ld lf lg li oh lm oi lq oj lu pl ol om on bi translated">在异步模式下，不保证排序。你不能控制每个消息何时被 Kafka 代理确认(ack)。</li><li id="95d4" class="of og it lb b lc oo lf op li oq lm or lq os lu pl ol om on bi translated">对于生产者来说，有一个成功的回调和一个失败的回调是一个很好的实践。例如，您可以在成功回调中写入一条信息日志消息，在失败回调中写入一条异常日志消息。</li><li id="08ff" class="of og it lb b lc oo lf op li oq lm or lq os lu pl ol om on bi translated">由于无法保证排序，在您收到回调中的异常之前，可能会发送额外的消息。</li></ol><p id="e7a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果想避免这些问题，可以选择同步发送消息。<code class="fe pi pj pk pa b">send()</code>的返回是一个<code class="fe pi pj pk pa b">FutureRecordMetadata</code>。通过执行<code class="fe pi pj pk pa b">future.get(timeout=60)</code>，生产者将被阻止最多 60 秒，直到消息被代理成功确认。缺点是速度，与异步模式相比相对较慢。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="c041" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">消费者</em></p><p id="4a76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">消费者实例是一个 Python 迭代器。消费类的核心是<code class="fe pi pj pk pa b">poll()</code>方法。它允许消费者不断从主题中提取信息。它的一个输入参数<code class="fe pi pj pk pa b">timeout_ms</code>缺省为 0，这意味着该方法会立即返回任何提取的记录以及缓冲区中的可用记录。您可以增加<code class="fe pi pj pk pa b">timeout_ms</code>返回更大的批次。</p><p id="e439" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，每个消费者都是一个无限的侦听器，所以它不会停止，直到程序中断。但另一方面，你可以根据收到的信息阻止消费者。例如，如果达到某个偏移量，您可以退出循环并关闭使用者。</p><p id="7222" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还可以将消费者分配到多个主题的一个分区或多个分区。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pm pn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/highsmallxu/0f9dc0e3dabfbd6f967a3bf6cf8b6740" rel="noopener ugc nofollow" target="_blank">卡夫卡-python-consumer.py </a></p></figure><p id="d3e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是<em class="mw"> kafka-python </em>库的测试结果。每条消息的大小为 100 字节。生产者的平均吞吐量是 1.4MB/s。消费者的平均吞吐量是 2.8MB/s</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pm pn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/highsmallxu/c58cbdf076dc8a40019e7dd855b17efb" rel="noopener ugc nofollow" target="_blank">Kafka-python-result . CSV</a></p></figure><p id="489f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.confluent.io/current/clients/confluent-kafka-python/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">——卡夫卡</strong> </a></p><blockquote class="ot ou ov"><p id="cb49" class="kz la mw lb b lc ld ju le lf lg jx lh ow lj lk ll ox ln lo lp oy lr ls lt lu im bi translated">Confluent-kafka 是一个用于 Python 的高性能 kafka 客户端，它利用了高性能 C 客户端<a class="ae ky" href="https://github.com/edenhill/librdkafka" rel="noopener ugc nofollow" target="_blank"> librdkafka </a>。从 1.0 版本开始，它们作为独立的二进制轮子在 PyPi 上为 OS X 和 Linux 分发。它支持 Kafka 版本。第一次发布是在 2016 年 5 月。它被积极地维护着。</p></blockquote><p id="daaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">安装</em></p><p id="6554" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于 OS X 和 Linux，librdkafka 包含在软件包中，需要单独安装。</p><pre class="kj kk kl km gt oz pa pb pc aw pd bi"><span id="cb00" class="ne nf it pa b gy pe pf l pg ph">pip install confluent-kafka</span></pre><p id="36d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于 windows 用户，在我写这篇文章的时候，<em class="mw"> confluent-kafka </em>还不支持 Python3.8 二进制轮子。你会碰到 librdkafka 的问题。请检查他们的<a class="ae ky" href="https://github.com/confluentinc/confluent-kafka-python/releases" rel="noopener ugc nofollow" target="_blank">发布说明</a>，它正在积极开发中。另一个解决方案是降级到 Python3.7。</p><p id="68b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">制片人</em></p><p id="a588" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">合流——卡夫卡</em>在速度方面有着不可思议的表现。API 设计有点类似于<em class="mw"> kafka-python </em>。您可以通过将<code class="fe pi pj pk pa b">flush()</code>放入循环中来使其同步。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pm pn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/highsmallxu/f15d7a40cf6c858786fd6c1845d8f3ae" rel="noopener ugc nofollow" target="_blank">合流-卡夫卡-制片人. py </a></p></figure><p id="40a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">消费者</em></p><p id="0e13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw"> confluent-kafka </em>中的消费者 API 需要更多代码。您需要自己处理 while 循环，而不是调用像<code class="fe pi pj pk pa b">consume()</code>这样的高级方法。我建议你创建自己的<code class="fe pi pj pk pa b">consume()</code>，它本质上是一个 Python 生成器。每当有一个消息被拉出来并在缓冲区中可用时，它就产生该消息。</p><p id="ed92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样做，主要功能将是干净的，你可以自由地控制你的消费者的行为。例如，您可以在<code class="fe pi pj pk pa b">consume()</code>中定义一个“会话窗口”。如果在 X 秒钟内没有提取任何消息，那么消费者将停止。或者您可以添加一个标志<em class="mw"> infinite=True </em>作为输入参数来控制消费者是否应该是一个无限的监听器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pm pn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/highsmallxu/cccb9c70389a1160864f53098b34ec66" rel="noopener ugc nofollow" target="_blank">汇合-卡夫卡-消费者. py </a></p></figure><p id="51ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是<em class="mw"> conflunet-kafka </em>库的测试结果。每条消息的大小为 100 字节。生产者的平均吞吐量为 21.97MB/s，消费者的平均吞吐量为 16.8～28.7 MB/s</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pm pn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/highsmallxu/d2ffc55419537514eb82fb93d408cbca" rel="noopener ugc nofollow" target="_blank">汇合-卡夫卡-结果. csv </a></p></figure><p id="6f20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://pykafka.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">卡夫卡</strong> </a></p><blockquote class="ot ou ov"><p id="370f" class="kz la mw lb b lc ld ju le lf lg jx lh ow lj lk ll ox ln lo lp oy lr ls lt lu im bi translated">PyKafka 是一个程序员友好的 Python Kafka 客户端。它包括 Kafka 生产者和消费者的 Python 实现，可选地由构建在<a class="ae ky" href="https://github.com/edenhill/librdkafka" rel="noopener ugc nofollow" target="_blank"> librdkafka </a>上的 C 扩展支持。它支持 Kafka 版本。第一次发布是在 2012 年 8 月，但自 2018 年 11 月以来就没有更新过。</p></blockquote><p id="a1eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">安装</em></p><pre class="kj kk kl km gt oz pa pb pc aw pd bi"><span id="1ac5" class="ne nf it pa b gy pe pf l pg ph">pip install pykafka</span></pre><p id="1c53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/edenhill/librdkafka" rel="noopener ugc nofollow" target="_blank"> librdkafka </a>不附带软件包，你需要在所有操作系统中单独安装。</p><p id="7d3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">制片人</em></p><p id="f105" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">pykafka 有一个 KafkaClient 接口，它覆盖了生产者 API 和消费者 API。</p><p id="28af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">消息可以在异步和同步模式下发送。我发现<em class="mw"> pykafka </em>修改了一些生产者配置的默认值，例如<em class="mw"> linger_ms </em>和<em class="mw"> min_queued_messages，</em>这可能会对发送少量数据产生影响。</p><p id="1770" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以和<a class="ae ky" href="https://kafka.apache.org/documentation/#producerconfigs" rel="noopener ugc nofollow" target="_blank"> Apache Kafka 网站</a>上的默认配置对比一下。</p><p id="bca5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想要获得每个消息的回调，请确保将<em class="mw"> min_queued_messages </em>更改为 1，否则如果您的数据集小于 70000，您将不会获得任何报告。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/3e29f0210eb1e52240ac08b338fa6e70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uBEtwT_64AhXYRRCe1fAfA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://pykafka.readthedocs.io/en/2.0.0/api/producer.html#module-pykafka.producer" rel="noopener ugc nofollow" target="_blank">pykafka-producer-config</a></p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pm pn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">pykafka-producer.py </p></figure><p id="4b61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">消费者</em></p><p id="e5f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以从 KafkaClinet 接口得到一个<code class="fe pi pj pk pa b">SimpleConsumer</code>。这类似于<em class="mw"> kafka-python，</em>poll 被包装在<code class="fe pi pj pk pa b">SimpleConsumer</code>类中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pm pn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/highsmallxu/d99ec0056c3420d9389bce12d9bcd2f8" rel="noopener ugc nofollow" target="_blank"> pykafka-consumer.py </a></p></figure><p id="81ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是<em class="mw"> pykafka </em>库的测试结果。每条消息的大小为 100 字节。生产者的平均吞吐量是 2.1MB/s。消费者的平均吞吐量是 1.57MB/s</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pm pn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/highsmallxu/6ec2c8a303453db0cc241a7b63f9ebe7" rel="noopener ugc nofollow" target="_blank"> pykafka-result.csv </a></p></figure></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="9fae" class="ne nf it bd ng nh ni dn nj nk nl dp nm li nn no np lm nq nr ns lq nt nu nv nw bi translated"><strong class="ak">结论</strong></h2><p id="af64" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">到目前为止，我已经解释了每个库的生产者 API 和消费者 API。在管理 API 方面，<em class="mw"> kafka-python </em>和<em class="mw"> confluent-kafka </em>确实提供了显式的管理 API。您可以在您的单元测试中使用它，您想要创建一个主题，然后在执行下一个测试之前删除它。此外，如果您想用 Python 构建 Kafka 监控仪表板，Admin API 可以帮助您检索集群和主题的元数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pm pn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/highsmallxu/9071651a8bbbb884e3a97714deebc981" rel="noopener ugc nofollow" target="_blank">Kafka-python-result . CSV</a></p></figure><p id="a537" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">汇合——卡夫卡:</em></p><p id="8147" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">毫无疑问，在这三个图书馆中，合流-卡夫卡的表现最好。API 设计得很好，参数与最初的 Apache Kafka 保持相同的名称和默认设置。您可以很容易地将其链接到原始参数。就我个人而言，我喜欢定制消费者行为的灵活性。它也正在积极开发和支持汇合。</p><p id="8766" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个缺点是，Windows 用户可能需要努力一点才能让它工作。由于它的 C 扩展，调试可能会很棘手。</p><p id="ee1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">卡夫卡-巨蟒:</em></p><p id="34bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw"> kafka-python </em>是一个没有 C 扩展的纯 python 库。该 API 设计良好，对于初学者来说简单易用。这也是一个正在积极开发的项目。</p><p id="410e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw"> python-kafka </em>的缺点是速度。如果你真的关心性能，我会推荐你切换到<em class="mw">汇合-卡夫卡</em>。</p><p id="de22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mw">卡夫卡</em>:</p><p id="930c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相对于<em class="mw"> kafka-python </em>和<em class="mw"> conflunet-kafka，</em>py Kafka 的开发不太活跃。<a class="ae ky" href="https://pypi.org/project/pykafka/#history" rel="noopener ugc nofollow" target="_blank">发布历史</a>显示自 2018 年 11 月以来未更新。此外，<em class="mw"> pykafka </em>有不同的 API 设计和使用不同的默认参数，这可能不是第一次直截了当。</p><p id="61f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢这篇文章！如果你有任何想法，请在下面留下你的评论。</p><h2 id="f0df" class="ne nf it bd ng nh ni dn nj nk nl dp nm li nn no np lm nq nr ns lq nt nu nv nw bi translated">资源</h2><div class="me mf gp gr mg mh"><a href="https://pypi.org/project/kafka-python/#history" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">卡夫卡-巨蟒</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">Apache Kafka 分布式流处理系统的 Python 客户端。kafka-python 的设计功能很像…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">pypi.org</p></div></div><div class="mq l"><div class="pp l ms mt mu mq mv ks mh"/></div></div></a></div><div class="me mf gp gr mg mh"><a href="https://pypi.org/project/confluent-kafka/" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">汇流-卡夫卡</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">Confluent 的用于 Apache Kafka 的 Python 客户端</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">pypi.org</p></div></div><div class="mq l"><div class="pq l ms mt mu mq mv ks mh"/></div></div></a></div><div class="me mf gp gr mg mh"><a href="https://pypi.org/project/pykafka/" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">pykafka</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">PyKafka 是一个程序员友好的 Python Kafka 客户端。它包括 Kafka 生产者的 Python 实现和…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">pypi.org</p></div></div><div class="mq l"><div class="pr l ms mt mu mq mv ks mh"/></div></div></a></div><div class="me mf gp gr mg mh"><a href="https://www.confluent.io/resources/kafka-the-definitive-guide/?utm_medium=sem&amp;utm_source=google&amp;utm_campaign=ch.sem_br.nonbrand_tp.prs_tgt.content-search_mt.xct_rgn.emea_lng.eng_dv.all&amp;utm_term=kafka%20the%20definitive%20guide&amp;creative=&amp;device=c&amp;placement=&amp;gclid=CjwKCAjw8J32BRBCEiwApQEKgZ1vBxyFB-DnTvXRClVBHzHX8NERiYyF_2Go5iYHYP6f3aP_l9xNBhoCUi0QAvD_BwE" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">阿帕奇卡夫卡:权威指南</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">什么是卡夫卡，它是如何工作的？在这本全面的电子书中，你会得到阿帕奇卡夫卡的全面介绍…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">www.confluent.io</p></div></div><div class="mq l"><div class="ps l ms mt mu mq mv ks mh"/></div></div></a></div></div></div>    
</body>
</html>