<html>
<head>
<title>Detect and track baseball using Detectron2 object detection and SORT tracking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用检测器 2 对象检测和分类跟踪来检测和跟踪棒球</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/detect-and-track-baseball-using-detectron2-and-sort-6dd92a46e6f2?source=collection_archive---------19-----------------------#2020-07-31">https://towardsdatascience.com/detect-and-track-baseball-using-detectron2-and-sort-6dd92a46e6f2?source=collection_archive---------19-----------------------#2020-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="32f4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">当视频中有多个棒球时，我如何跟踪棒球。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/05efbc25311c990e1178e2864422b6a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vLjUkL3_-6LLa-FnjZe7OQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">棒球检测和跟踪。</p></figure><h1 id="3f87" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">介绍</h1><p id="0cb9" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在我的<a class="ae mm" rel="noopener" target="_blank" href="/how-to-build-a-baseball-detector-using-detectron2-50b44edec6b7">上一篇文章</a>中，我使用 Detectron2 训练并构建了一个模型来检测视频中的棒球。</p><div class="mn mo gp gr mp mq"><a rel="noopener follow" target="_blank" href="/how-to-build-a-baseball-detector-using-detectron2-50b44edec6b7"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">如何使用 Detectron2 构建棒球检测器</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">使用自定义数据集的 Train Detectron2 对象检测。</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">towardsdatascience.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne ks mq"/></div></div></a></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/31d4ce839b75d0618d62b85b48537aea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*igN6BKHioxhNg0tsrRKR0A.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用探测器 2 的棒球探测。(来自<a class="ae mm" rel="noopener" target="_blank" href="/how-to-build-a-baseball-detector-using-detectron2-50b44edec6b7">我之前的帖子</a>)</p></figure><p id="ec42" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">它工作得很好，能够在大多数画面中捕捉到球。然而，将该模型应用于真实棒球练习视频的一个潜在问题是，视频中可能有不止一个棒球，如第一幅图所示。这个问题使得很难提取精确球的信息，例如球的速度和飞行角度。</p><p id="6534" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">解决这个问题的一个可能的方法是跟踪球并给它们分配唯一的 id，然后我可以计算每个球的信息并选择我想要的球。</p><p id="a35f" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">有几种方法来跟踪物体，我决定使用亚历克斯·比雷的<a class="ae mm" href="https://github.com/abewley/sort" rel="noopener ugc nofollow" target="_blank">排序</a>(简单的在线和实时跟踪)。详细介绍和论文可以在作者的报告中找到。我将在这篇文章中重点讨论实现。</p><div class="mn mo gp gr mp mq"><a href="https://github.com/abewley/sort" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">abewley/排序</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">视频序列中 2D 多目标跟踪的简单在线实时跟踪算法。查看示例…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">github.com</p></div></div><div class="mz l"><div class="nl l nb nc nd mz ne ks mq"/></div></div></a></div><h1 id="6796" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">棒球追踪——排序</h1><p id="9b90" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我使用了 Google Colab，所以我首先安装了我的 Google Drive，并将 sort.py 复制到这个文件夹中。然后我安装了排序和导入的需求。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="cbda" class="nr kz it nn b gy ns nt l nu nv">!cp "gdrive/My Drive/Colab Notebooks/object_tracking/sort.py" .<br/>!pip install filterpy</span><span id="0d69" class="nr kz it nn b gy nw nt l nu nv">from sort import *</span></pre><p id="4909" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">然后我调用了排序对象</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="0a13" class="nr kz it nn b gy ns nt l nu nv">mot_tracker1 = Sort(max_age=3, min_hits=1, iou_threshold=0.15)</span></pre><p id="5536" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">max_age、min_hist 和 iou_threshold 是可以根据要求进行调整的参数。</p><p id="2a58" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">然后，我通过每帧更新跟踪器，将分类跟踪器集成到对象检测循环中。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="7bbf" class="nr kz it nn b gy ns nt l nu nv">track_bbs_ids = mot_tracker1.update(dets)</span></pre><p id="5a4e" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">dets 是一个 numpy 检测数组，格式为[[x1，y1，x2，y2，score]，[x1，y1，x2，y2，score]，…]。</p><p id="dbc6" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">它将返回一个数组[[x1，y1，x2，y2，ID]，[x1，y1，x2，y2，ID]，…]。ID 是由 SORT 分配的唯一焊球 ID。</p><p id="5b73" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">必须注意的是，即使在检测到空帧的情况下，也必须对每一帧调用该函数。无检测时使用 np.empty((0，5))。</p><p id="c4c5" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">然后我通过绘制边界框和 id 来可视化它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/21f1d157f600cad0710989945654554e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*jee6fdpcHpF1WUpxAWzLqA.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">球跟踪。</p></figure><p id="8bad" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">结果挺好的。地面上的球被检测到并被分配了 id。然而，快速移动的球并没有通过排序分配给任何 ID。这可能是由于框架之间的球的距离太大，球的尺寸太小。框架之间的边界框没有重叠，因此排序将它们视为不同的球。</p><p id="3653" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">我试验了上面显示的排序参数，并做了一些变通来解决这个问题。</p><p id="6b1a" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">为了进行排序，我手动将边界框变大，因此帧之间的重叠变大。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/4f86e56a27cfe723796f20404d970295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*a_UALbxcWUhz26t_c322Kg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">球跟踪。</p></figure><p id="2511" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">现在飞球可以被捕获并分配到一个唯一的 ID。</p><p id="d38b" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">最后，我可以反转并可视化真实的边界框。我把盒子转换成圆形，这样更适合球形的球。我还为球添加了一个尾巴来显示轨迹。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/f6ae7f20d853cf6e422af5df4b856292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*dX13x-E8F4QvSYCGpDvXgw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">球跟踪</p></figure><p id="e858" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">看起来不错！在这一点上，我有每一帧的球检测 ID。在探测循环期间，我存储在一个列表中，并将其转换为 pandas dataframe 以供进一步分析。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/c8cc75e40b3e6638249375e6fde45d69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bz1J1huPnLUMgok7HMeaFQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫数据框中的球检测细节。</p></figure><h1 id="cab9" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">接下来:</h1><ol class=""><li id="85a9" class="ny nz it ls b lt lu lw lx lz oa md ob mh oc ml od oe of og bi translated">检测效果不是很好，一些球没有被识别出来，还有一些噪音，比如白手套，鞋子等等。被鉴定为鲍尔。我需要扩展训练数据集并改进检测模型。</li><li id="5257" class="ny nz it ls b lt oh lw oi lz oj md ok mh ol ml od oe of og bi translated">检测速度有点慢，也许可以尝试不同的架构。</li><li id="fedd" class="ny nz it ls b lt oh lw oi lz oj md ok mh ol ml od oe of og bi translated">从侧面拍摄视频，这样我就可以在不考虑失真的情况下计算速度和角度。</li></ol><p id="f727" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">感谢阅读，欢迎反馈和建议！</p><p id="55a0" class="pw-post-body-paragraph lq lr it ls b lt ng ju lv lw nh jx ly lz ni mb mc md nj mf mg mh nk mj mk ml im bi translated">在这里支持我:<a class="ae mm" href="https://medium.com/@c.kuan/membership" rel="noopener">https://medium.com/@c.kuan/membership</a></p></div></div>    
</body>
</html>