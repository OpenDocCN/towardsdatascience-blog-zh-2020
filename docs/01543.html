<html>
<head>
<title>Explore and Clean: first steps of any data project.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索和清理:任何数据项目的第一步。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/explore-and-clean-first-steps-of-any-data-project-976a1d80d7aa?source=collection_archive---------24-----------------------#2020-02-11">https://towardsdatascience.com/explore-and-clean-first-steps-of-any-data-project-976a1d80d7aa?source=collection_archive---------24-----------------------#2020-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2f21" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在您开始使用“有趣”和“令人兴奋”的算法和方法之前，这里是在您的数据项目中取得成功的第一步。</h2></div><p id="1e33" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">人们很容易如此热衷于从数据中获得一些东西，以至于直接跳到编写预测算法或其他形式的机器学习/人工智能，以进行尝试。可能和大多数人一样，我也掉进了那个陷阱，对自己发育不良的进步感到失望。</p><p id="7ebd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我想强调在开始“有趣”的东西之前了解您的数据的价值，并用一些具体的例子来说明如何使用一个简单的数据集来做到这一点。我是一个 Python 用户，所以我的代码示例会提到这一点，但是方法的理论将适用于跨语言。</p><h2 id="9794" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">浏览和清理您的数据</h2><p id="4cd6" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">当您考虑您的数据时，在开始清理之前，探索您的数据，找出那里有什么以及哪些部分需要注意似乎是合乎逻辑的。毕竟，如果你不知道乱七八糟的是什么，你怎么能收拾干净呢？我<em class="lz">有点</em>同意这一点，但我认为这是一个迭代过程。对于格式错误的数据，您可能无法探索和找到您需要的信息。所以，我倾向于在探索和清理之间做一些来回。</p><p id="cd0a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我坚信“一张图胜过千言万语”这句话背后的含义，在数据世界中，这意味着将你拥有的数据可视化。在某些情况下，您可能无法可视化数据，因为它可能是错误的格式(您的数字是字符串类型而不是浮点数)，或者您的时间被收集并分布在 4 列(小时、分钟、秒、毫秒)，这对于数字数据尤其重要。</p><p id="b492" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">出于这个原因，我喜欢探索我的数据，然后解决我看到的问题。</strong></p><p id="f4dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这一点上我认为值得考虑的问题是:</p><p id="5d27" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lz">干净的数据意味着什么？我相信什么是干净的数据在很大程度上取决于你手头的任务，包括你的数据项目的应用和你想用这些数据做什么。但是，一般来说，它需要符合逻辑:数字应该是数字，日期应该是日期等等。下面我会详细解释我的意思。</em></p><p id="eb8b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将数据导入数据框后，我建议的第一件事就是检查您拥有的数据是否符合您的预期。为此，我使用<code class="fe ma mb mc md b">df.head</code>检查前五行(其中 df =您的数据帧)。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi me"><img src="../Images/fddf53b8d40c7921e04e88593ebecf11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54CBydZbDoJbAg-25QQVRQ.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">示例数据帧</p></figure><p id="0836" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，您可以看到有 5 列，其中一些是单词或字符串，一个日期字段和一个整数。所有这些看起来和我对列名的期望差不多。</p><p id="16a3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，我们看到的可能不是计算机看到的，所以检查当前的类型很重要:<code class="fe ma mb mc md b">df.dtypes</code>将为您完成这项工作。对于上述数据帧，我们得到以下输出:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/c5e19b55a31aadf67c00ec2971a6d175.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*eDLJ-vp2gt1hTATXJGyk0g.png"/></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">显示数据帧中存在的类型的输出函数</p></figure><p id="5684" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如您在这里看到的，输出告诉我不同的列名，以及其中包含的数据类型。这是单独打印数据帧所不能做到的。从表中，没有办法知道这些值是字符串、浮点数还是其他。这是很重要的信息，甚至对于最初创建简单的图来说也是如此——你不能用字符串创建散点图！—但是当您进一步深入时，您可能会使用需要数字数据而不是字符串的随机森林回归。</p><p id="f3a2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可能想知道为什么所有的列都被分配了“对象”类型。这就是<a class="ae mv" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.dtypes.html" rel="noopener ugc nofollow" target="_blank">文档</a>派上用场的地方。字符串被赋予对象类型，因此 Name 列和 Sex 列都是这样。然而，这不足以解释出生日期或死亡年龄栏。Pandas 还会将对象类型分配给包含混合数据的列，因此对于提到的两列，我们不知道其中的部分或全部数据是字符串还是其他数据。<em class="lz">出生日期列具有字符串或混合数据类型的暗示是日期没有以统一的方式显示。</em></p><p id="811d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一般来说，如果我们在数据帧中看到人类认为是数字或日期的项目，那也是我们希望计算机看到的。在这里，我建议使用以下代码将出生日期列转换为日期，将死亡年龄列转换为整数(其中 pd 是 pandas 库):</p><pre class="mf mg mh mi gt mw md mx my aw mz bi"><span id="3d92" class="lb lc iq md b gy na nb l nc nd">df['Age at Death'] = df['Age at Death'].astype(int)<br/>df['Date of Birth'] = pd.to_datetime(df['Date of Birth'])</span></pre><p id="4140" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我再次展示数据帧时，它看起来像这样:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi ne"><img src="../Images/a2eeadaf661c2102f05fd1ffd1651965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cp70A6gc25YKRQyUma_g6A.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">列重新格式化后的数据帧</p></figure><p id="0782" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有列看起来都一样，除了出生日期列，该列已被重新格式化，因此日期是统一的。这可能不是你想要的格式，所以你可以看看<a class="ae mv" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html" rel="noopener ugc nofollow" target="_blank">文档</a>来了解更多关于改变的细节。</p><p id="aa1c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，当我们查看每列中的数据类型时，您会看到我们转换的两种类型如下所示:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/28ee85b6281472c6c063015ef2c0aed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*c0qpltf-fBOtl3jFzfGxAA.png"/></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">重新格式化后数据帧中存在的类型</p></figure><p id="f73a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你有一个简单的数据集，探索可能看起来有点费力，但我仍然认为这是一个重要的经历；这不仅是因为当你拥有复杂的数据集时，它会帮你做好准备，还因为花时间去探索可以让你看到很多你在原始数据甚至表格中看不到的东西。</p><p id="55d8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们再举一个例子:有时当你获取数据时，你可能会得到一个文件，里面有很多零，表示单元格中没有任何内容。从这个角度来看，只要你的团队有这样的理解，那就很好。然而，你的计算机无法理解:对计算机来说，零是一个数字，因此在单元格中存在某种东西。我们需要告诉计算机这个单元格是空的。让我们向我们一直使用的数据帧添加几行:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi ng"><img src="../Images/7bd9a483914677dd905e56b0102db2eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3sJ-4VasXW5paWaYz0l4hw.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">具有两个附加行的数据帧</p></figure><p id="10a4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的示例中，我们可以看到数据帧中缺少欧内斯特·卢瑟福的出生日期，这一点在 NaT 或 Not a Time(时间的空值示例)中很明显。然而，如果不仔细看死亡年龄一栏，你可能会漏掉玛丽·斯科多瓦斯卡·居里的年龄为零。对于一个大的数据帧，这两个例子都可能会被遗漏，所以简明扼要地获得数据帧的数字方面的信息是很重要的，这样你就能看到，为此我使用了<code class="fe ma mb mc md b">df.describe():</code></p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/ad94f8f019d1e4cfa4c6e985d917e0ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*rMeSxe-pzfjsuAaIQ_W-oQ.png"/></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">描述函数的输出</p></figure><p id="efa4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我们仅有的数字列是“死亡年龄”列，所以我们预计会在输出中看到一列，如果您有一个包含多个数字列的数据帧，每个数字列的显示方式都是相似的。我们可以清楚地看到最小值是零，我们可以用我们人类的智慧意识到这里有问题。在这种情况下，可能会出现这样的情况，无论您的数据来自何处，都用零替换该值，以表明没有我们的数据。然而，在 Python 中，我们需要将它显示为 NaN 或 null，所以单元格中实际上什么也没有。这里您可以使用<code class="fe ma mb mc md b">df.replace(0, np.NaN)</code>(其中 np 是 numpy 库)给出以下内容:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi ni"><img src="../Images/76485db86705f13f3eb422ed292c8d46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sWrQVhkr3Oj7__xTQozLyw.png"/></div></div></figure><p id="b6f1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如您所看到的，当您单独看数据帧时，数据表示的变化似乎很小，但是深入研究类型，您会看到很大的差异。</p><p id="f761" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要检查数据帧中的空值，您也可以使用<code class="fe ma mb mc md b">df.isna().count()</code>，它给出以下输出:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/f0e5e2f155d312fdbe943e5bb2e40802.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*B80Rnp9UeGc2hPPNExjEeQ.png"/></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">每列中出现的 Na 值的数量</p></figure><p id="5112" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上述方法是一种快速而清晰的方法，可以确定数据帧中丢失了多少数据。同样，对于这个例子来说，这似乎有点多余，但是当您开始处理数百列和数千行时，您会喜欢这种方法(甚至可能在这之前！)</p><p id="7ee3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一般来说，当我有数字数据时，我喜欢在完成初始清理后绘制它。我这样做是我探索的一部分:我能看到一个明显的趋势吗？是否有可能扭曲我的数据的明显异常或错误？我发现它帮助我看到实际存在的东西，而不是我在数据帧的片段中看到的东西。</p><p id="97f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我喜欢更清楚地看到我的数据，例如如下所示:</p><pre class="mf mg mh mi gt mw md mx my aw mz bi"><span id="3fd0" class="lb lc iq md b gy na nb l nc nd">fig, ax = plt.subplots()</span><span id="8acf" class="lb lc iq md b gy nk nb l nc nd">x = df['Date of Birth']<br/>y = df['Age at Death']<br/>plt.plot(x, y, 'bo')<br/>fig.suptitle('Year of Birth vs Age at Death', fontsize=20)<br/>xlabel = 'Year of Birth'<br/>ylabel = 'Age at Death'<br/>ax.set_xlabel(xlabel, fontsize=10)<br/>ax.set_ylabel(ylabel, fontsize='medium')</span></pre><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nl"><img src="../Images/2b0b2c4bde2e0a4d75f03d49d7c1ad59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3dti5Io492L6I2FFtvA6Cw.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">图解可能的可视化选项</p></figure><p id="1582" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可能会注意到，虽然数据帧中有七行数据，但图上只有六个数据点。玛丽·斯科多瓦斯卡·居里的数值没有标绘出来，因为她死时的年龄是 15 岁。这是一件好事，如果我们用零值标绘它并继续分析，它可能导致误导的结果。</p><p id="9158" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，Python 有点困惑，因为它显示了大约 1680 年欧内斯特·卢瑟福的数据点。似乎是由于 NaT 的出现而不是他的出生日期，Python 选择了最早的可能日期并绘制了死亡年龄数据点。这是需要注意的事情！通过一点点进一步的操作，您可以确保它也被排除，方法是从数据帧中没有空值的行中选择要绘制的图形的 x 值和 y 值，只需添加少量的<code class="fe ma mb mc md b">df.dropna()</code>:</p><pre class="mf mg mh mi gt mw md mx my aw mz bi"><span id="3bf7" class="lb lc iq md b gy na nb l nc nd">fig, ax = plt.subplots()</span><span id="8e10" class="lb lc iq md b gy nk nb l nc nd">df2 = df.dropna()<br/>x = df2['Date of Birth']<br/>y = df2['Age at Death']<br/>plt.plot(x, y, 'bo')<br/>fig.suptitle('Year of Birth vs Age at Death', fontsize=20)<br/>xlabel = 'Year of Birth'<br/>ylabel = 'Age at Death'<br/>ax.set_xlabel(xlabel, fontsize=10)<br/>ax.set_ylabel(ylabel, fontsize='medium')</span></pre><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nm"><img src="../Images/a88256f8dc6bacb640d7c4c0e5bdc81f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zsfgy_73VyTrTqArC0h7Kw.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">从绘图中移除空值后绘制图表</p></figure><p id="89d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我试图在清理之前绘制数据，Python 会因为不正确的数据类型而抛出一个错误。大多数绘图函数需要整数、浮点数或日期，除非它们是正确的类型，否则看不到我们看到的数字。如果没有人工检查和删除空值行的操作，我们会得到一个误导性的图形，尽管没有抛出任何错误。</p><p id="aef6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">遗言</strong></p><p id="0b7e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我还可以对数字数据做更多的处理，如果我想把它变成整数格式的话，也许我想得到男性和女性的平均死亡年龄，这样我就可以比较了？我可能想将性别列改为二进制类型，因为这可以为分析提供更多的机会。</p><p id="1867" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自然，随着数据集越来越复杂，可能性变得越来越令人兴奋。</p><p id="d082" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我教给任何新程序员的一个过程，作为他们使用数据的第一步。我自己在我的博士学位中使用的每一个新的数据集上使用它，当我只是在新的数据集上玩的时候。当然，这些数据集比我在本文中展示的例子更复杂，但原理是相同的。</p></div></div>    
</body>
</html>