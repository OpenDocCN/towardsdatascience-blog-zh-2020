<html>
<head>
<title>Functions in Power BI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Power BI 中的函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/functions-in-power-bi-56e9e11e4669?source=collection_archive---------32-----------------------#2020-09-15">https://towardsdatascience.com/functions-in-power-bi-56e9e11e4669?source=collection_archive---------32-----------------------#2020-09-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3d32" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这是什么？我们什么时候使用它？我们如何制造一个？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7d48bd144964fe1575ffaa831bc263ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JkapBibEFmrLhLCd"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">埃里克·克鲁尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="ec87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">清洗，扯皮，总结。我不知道你怎么想，但是我喜欢这个数据分析的过程。Power Query 是我在这方面使用的主要工具。以后我会写更多关于权力查询的内容。</p><p id="c95d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我清理是因为数据不干净。我打扫卫生是因为我需要好的数据来分析。我努力为连接找到正确的“形状”。如果您必须手动清理数据，那就太可怕了，而且很容易出现清理错误。想象错误之上的错误？你真正要分析的是什么？</p><p id="3d8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">别担心。功能——就像上面那些可爱的小机器人可以来救援一样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/be7878ee9734f996c3965058c0f08922.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*CcRV1U_vA3Q1syHlCdD3Fg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a89d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">究竟什么是函数？谷歌快速搜索给出了这个定义。</p><blockquote class="lw lx ly"><p id="548b" class="kz la lz lb b lc ld ju le lf lg jx lh ma lj lk ll mb ln lo lp mc lr ls lt lu im bi translated">“功能是一组有组织的、可重复使用的代码，用于执行单个相关的动作。…不同的编程语言对它们的命名不同，例如，函数、方法、子例程、过程等。”</p></blockquote><p id="845a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的关键词是<strong class="lb iu">可重用。</strong>要成为一个功能，它必须是可重用的。这意味着您可以使用这段代码，并将其应用于不止一个文件，还可以应用于其他文件。我认为函数就是<strong class="lb iu">接受输入，执行一组定制的过程，然后给出输出</strong>。</p><p id="9087" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你今天用的很多东西，比如，BI 中的 sum 函数到 joins 都是函数。</p><p id="9248" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，看看 M(超级查询语言)中的这个函数</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi md"><img src="../Images/999d1daaa88dbe8b812f2053dae6497c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQPZANtR84yI7_O9kBkrQQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自作者</p></figure><p id="0513" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题是…有时我们没有可以满足我们需求的功能。我们希望对各种文件应用一组自定义的过程。这就是我们必须使用它的原因和时间。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="1c12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们在 Power Query 中过一遍如何在 Power BI 中创建函数。生活中有那么多清洁和争吵，我相信这对我们会很有用。</p><p id="1f73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如简笔画所提到的，这些年来我们有几个不同的文件。我们需要对所有文件执行相同的操作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/f5fa866fa693d36a5272adaa95876eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kf_0rVKEmGQX8NaSFlA8sA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b9b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们不想对每个文件都执行这个过程，但是我们希望函数为我们执行这个过程。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="a2e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们将所有文件放入一个文件夹中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/6a83c5ab9819336fb5d0e277424be490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEyNR-_-MvZBklv-WYfDsg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9518" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">加载完所有文件后，您应该会看到它们如下所示。</p><p id="dcac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从创建主文件的“副本”开始——我们想从这个副本构建一个函数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/8d223001a6fcf581521771b32d9a70a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*xPfO-TowaaTTvIeQyX8Geg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="dc75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在有了一个副本，我们只保留第一行来构建函数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/4237c294745953ffad4c8d18a72c722a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fb0Pbzgmp3LT_p0Y-o04lA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ebb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Power BI 只保留第一排。很好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/abdc1d122ec711aa1eef342261936277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-pYnmGzquAqDPxm8dZ8XZg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9003" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个巧妙而重要的技巧——您可以键入引用该列的[Content]和引用实际“单元格”本身的{0}。如果你有更多的技术理解，我引用列并返回一个列表，然后引用列表值 0 返回二进制文件。</p><p id="6d6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不喜欢打字，你也可以点击二进制文件本身的“向下钻取”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/7893cd48b8362f31e167ffc74ce20b67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-cVlpEIjqkHQhzRlR8i9A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="82b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Power BI 干净利落地加载文件，不需要那些自动转换。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/f04ea1e4efa3451095239b2a1945b9e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8r12_FE-Ec9Fv1bXiJxzkg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4a32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们使用分组方式进行快速总结。您可以在面板顶部的“变换”功能区下找到“分组依据”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/f15b77bb9c8cbe5cc7c97cdb72b7af39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cgXtUP_tPQVCp844QH2ZHQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="386f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们对其中一个文件的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/c27139accde0ae6c7fd8f8bb80a1fa0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9XKd4dTH0avKsQwjboJU4A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="32ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这正是我们所需要的。</p><p id="53f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯…简笔画。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/85e0995ff10acdb9f3493bbc31c715f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*YfHp1RhBrKLhnQAjby5I6A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="bf36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还没做，让我们把它做成一个实际的函数。</p><p id="e9ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过转换功能区下的高级编辑器选项来实现。</p><p id="4b3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Power BI 把所有的步骤都记录下来，变成 M 脚本给我们看。如果你熟悉 Excel，它就像一个录制的宏。我们只需要更改引用，以便它可以应用于其他文件。</p><p id="f4d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你不需要知道如何把下面的 M 代码全部打出来。Power BI 的妙处在于，它为你记录了所有这些步骤。在不久的将来，我会写更多关于如何阅读 M 脚本的内容。</p><p id="4049" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是当前的脚本。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="462a" class="na nb it mw b gy nc nd l ne nf">let<br/>    Source = Folder.Files("MY_DRIVE"),<br/>    #"Removed Top Rows" = Table.Skip(Source,1),<br/>    #"Removed Other Columns" = Table.SelectColumns(#"Removed Top Rows",{"Name", "Content"}),<br/>    #"Kept First Rows" = Table.FirstN(#"Removed Other Columns",1)[Content]{0},<br/>    #"Imported CSV" = Csv.Document(#"Kept First Rows",[Delimiter=",", Columns=5, Encoding=65001, QuoteStyle=QuoteStyle.None]),<br/>    #"Promoted Headers" = Table.PromoteHeaders(#"Imported CSV", [PromoteAllScalars=true]),<br/>    #"Changed Type" = Table.TransformColumnTypes(#"Promoted Headers",{{"Year", Int64.Type}, {"Sex", type text}, {"Name", type text}, {"Job Title", type text}, {"Salary", Int64.Type}}),<br/>    #"Grouped Rows" = Table.Group(#"Changed Type", {"Year", "Sex"}, {{"Average Salary", each List.Average([Salary]), type nullable number}}),<br/>    #"Rounded Off" = Table.TransformColumns(#"Grouped Rows",{{"Average Salary", each Number.Round(_, 0), type number}})<br/>in<br/>    #"Rounded Off"</span></pre><p id="566e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要让这个压倒你，我们唯一关心的是 Csv。文档部分。</p><p id="26dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们删除 Csv 上面的所有内容。文档部分并声明我们的变量。我选择(X 为二进制)是因为我们希望这个函数有一个二进制输入。</p><p id="aadc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还记得文件夹里的那些 csv 文件吗？它们是二进制文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/ec1e34e857f0c9bf6dd2f93688db9a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KEXi3WbviT2VX4Wk7oAILw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a5d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们的功能！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/72cb81e82ec5f4b303dc7f0e50001e66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SzXdws7OrCYOV9Jx6zcjwg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0ed7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们将它应用到我们的文件中。让我们“调用”我们的自定义函数。您可以在“添加列”功能区下找到“调用”。</p><p id="508a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">听起来像是《哈利·波特》里的情节，对吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/957936ad1e1938575f9d6b05e55929a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XI9juwSIF4Z9bgKbi4cmng.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="1931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/2cb9f3db3510ae044d8efbd37b7e8242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TklYnu9ng47eOLmPTEyn7Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d0c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们点击“扩展”进入决赛桌。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/325c6a120b4bb0c8fb5bbf232280ffdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qjFgu_V25b2Ec0HoFM9eGA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="428b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哒哒！</p><p id="e4e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按年平均工资分列的男性和女性。</p><p id="bc3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，这是一个简单的数据集，但你也可以将连接和其他更复杂的转换构建到一个函数中，并将其应用于所有文件。</p><p id="c9b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> TL:DR </strong>？我为你做了这个。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/986fcba69e5a1df7752999b7beebe945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*Se7lHsdI3JQ-Af7YtkT-9A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="24a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望你喜欢这篇文章。</p><p id="4dee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想看视频——Curbal 是一个真正教会我很多关于<a class="ae ky" href="https://youtu.be/Ar_fV_oXSNs" rel="noopener ugc nofollow" target="_blank">功能</a>的频道，当然还有 Power BI。</p><p id="cf4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意安全，希望这能帮助您的数据之旅！</p></div></div>    
</body>
</html>