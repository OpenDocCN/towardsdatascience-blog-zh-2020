<html>
<head>
<title>How I DIY’d my Budget Using Python for Selenium and Beautiful Soup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何DIY我的预算使用Python制作硒和美丽的汤</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-i-diyd-my-budget-using-python-for-selenium-and-beautiful-soup-4d2edc5c519?source=collection_archive---------5-----------------------#2020-03-14">https://towardsdatascience.com/how-i-diyd-my-budget-using-python-for-selenium-and-beautiful-soup-4d2edc5c519?source=collection_archive---------5-----------------------#2020-03-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e989" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Python提取数据以满足您的个人预算需求</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/266dd9b964f82c47173200d5def5f515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mzKynldcv3tjNWEqhpDaeA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">安妮·斯普拉特在<a class="ae kv" href="https://unsplash.com/s/photos/finance-unicorn?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c336" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我是个性测试的狂热粉丝。我喜欢通读我的预包装类型描述，我发誓这是我独有的，只有我。我喜欢他们给我的感觉，好像两个心理学家用我自己提供的答案偷瞄了一下我的灵魂。但是我知道不是每个人都同意。对于反对者，不管他们是说主流选项太老套，还是因为它在很大程度上是自我报告而对结果打折扣，我提出:预算类型指数。</p><p id="75e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于那些现在希望收到你的个人资料的pdf文件的人，我希望当我告诉你这是你必须自己制作的东西时，你不会太失望。好吧，好吧，这不是传统意义上的性格测试，但我确实认为一份精心制作的预算可以告诉你很多关于你自己的事情，如果不是更多的话，就像那些诱人的在线测验一样。</p><p id="deec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我开始做这个项目时，我想知道我的钱去了哪里，进而了解我优先考虑的是什么。我以前一直手动汇总我的多个银行账户的所有支出，包括非银行但经常使用的服务，如Venmo。我一直在寻找一种服务，这种服务不仅可以自动完成这个过程，向我展示我的历史数据，而且不需要每月付费。没有完全符合所有这些标准的东西，所以我用Python创建了自己的。</p><p id="f949" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于其他想衡量和管理自己支出的人来说，收集数据是第一步，也是最重要的一步。我根据我使用的两个工具分解了本文的其余部分:</p><ol class=""><li id="2268" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">硒</li><li id="889f" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">美味的汤</li></ol><p id="dc2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想建立自己的预算工具，我很乐意帮助你——尽管我们不认识，但请随时联系jenniferrkim7@gmail.com！</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="d666" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">使用Selenium从您的在线银行帐户中删除交易</h1><p id="6bde" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated"><a class="ae kv" href="https://selenium-python.readthedocs.io/index.html" rel="noopener ugc nofollow" target="_blank"> Selenium </a>自动化浏览器。最初创建它是为了测试web应用程序，现在它也广泛用于web抓取。在分解我如何使用这个工具之前，我在下面包含了我的全部代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="e89f" class="nn mp iq bd mq no np dn mu nq nr dp my lf ns nt na lj nu nv nc ln nw nx ne ny bi translated"><strong class="ak">进行设置</strong></h2><p id="f4a8" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">你首先需要安装两个软件包。</p><ul class=""><li id="c863" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated">硒包装</li></ul><p id="2b37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过在命令提示符下键入以下命令进行安装:</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="a36b" class="nn mp iq ob b gy of og l oh oi">pip install selenium</span></pre><ul class=""><li id="2b6b" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated">您正在使用的浏览器的web驱动程序</li></ul><p id="6e98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Chrome驱动程序(这是我正在使用的)可以在<a class="ae kv" href="https://sites.google.com/a/chromium.org/chromedriver/downloads" rel="noopener ugc nofollow" target="_blank">这里</a>找到。不同版本的Chrome有不同的驱动程序。要了解您使用的版本，请点按浏览器右上角的三个垂直点。这将带您到设置。然后，打开菜单，点击“关于Chrome”——这将显示你的Chrome版本。下载适用的驱动程序，并确保它在您的Python路径中。</p><p id="0d69" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更全面的安装说明，包括其他浏览器驱动的链接，可以在<a class="ae kv" href="https://selenium-python.readthedocs.io/installation.html" rel="noopener ugc nofollow" target="_blank">这里</a>的文档中找到。</p><h2 id="f3c6" class="nn mp iq bd mq no np dn mu nq nr dp my lf ns nt na lj nu nv nc ln nw nx ne ny bi translated"><strong class="ak">尺寸很重要</strong></h2><p id="0f22" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">现在您已经有了必要的包，您可以开始指定驱动程序应该选择的web元素。影响这些元素位置的一个因素是窗口的大小。为了获得最大的一致性，我喜欢在启动任何进程之前全屏显示我的窗口。</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="bbff" class="nn mp iq ob b gy of og l oh oi"># from line 8<br/>browser.maximize_window()</span></pre><h2 id="4515" class="nn mp iq bd mq no np dn mu nq nr dp my lf ns nt na lj nu nv nc ln nw nx ne ny bi translated"><strong class="ak">定位元件</strong></h2><p id="fcaa" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">为了检索交易，我们首先希望Selenium登录银行的网站。我们可以通过检查网站的HTML页面来确定需要选择哪些元素。要打开页面，请访问网站，并识别登录框。右键单击在线ID字段。选择“检查”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/ff2041c2dee32a492b3954f0d0eae81c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A_QGA47g7XCSvSCZ1W4cpw.png"/></div></div></figure><p id="ac44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将弹出此元素定位器，并在您选择的字段(在本例中为在线ID)上高亮显示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fe5d6af7aeba3d0a68c46a76e536e4b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwqEidX4PgzSZ4iDo8rwUQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Chrome的HTML元素定位器</p></figure><p id="de04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有八种不同的方法来定位硒元素。这些是由:</p><ul class=""><li id="cdc5" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated">名字</li></ul><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="06b2" class="nn mp iq ob b gy of og l oh oi">elem = driver.find_element_by_name("INSERT-NAME")</span></pre><p id="8101" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我决定使用的一个，正如上面截图中画得不好的红圈所示。</p><ul class=""><li id="3a24" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated">身份证明</li></ul><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="8dfd" class="nn mp iq ob b gy of og l oh oi">elem = driver.find_element_by_id("INSERT-ID")</span></pre><p id="5a82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这被认为是最准确的方法，因为每个元素的ID都是唯一的。</p><ul class=""><li id="b4a3" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated">链接文本</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/1851a581fcd4ed1774aaf08e794d3901.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6X0FpBHT2DvIKtIELmA9ow.png"/></div></div></figure><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="8fdc" class="nn mp iq ob b gy of og l oh oi">elem = driver.find_element_by_link_text("INSERT-NAME-OF-LINK-ON-PAGE")</span><span id="946b" class="nn mp iq ob b gy ol og l oh oi"># example if I wanted to select link circled above<br/>elem = driver.find_element_by_link_text("Vote Is Likely to Fall Largely Along Party Lines")</span></pre><ul class=""><li id="c910" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated">部分链接文本</li></ul><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="fc37" class="nn mp iq ob b gy of og l oh oi">elem = driver.find_element_by_partial_link_text("DONT-NEED-FULL-LINK")</span><span id="1c7b" class="nn mp iq ob b gy ol og l oh oi"># example if I still wanted to select above NYT link<br/>elem = driver.find_element_by_link_text("Vote Is Likely to Fa")</span></pre><ul class=""><li id="afb4" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated">CSS选择器</li></ul><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="3a65" class="nn mp iq ob b gy of og l oh oi">elem = driver.find_element_by_css_selector("INSERT-CSS-SYNTAX")</span></pre><p id="7122" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于CSS选择器的好例子可以在这里找到:<a class="ae kv" href="https://saucelabs.com/resources/articles/selenium-tips-css-selectors" rel="noopener ugc nofollow" target="_blank">https://saucelabs . com/resources/articles/selenium-tips-CSS-selectors</a></p><ul class=""><li id="be18" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated">标签名称</li></ul><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="d804" class="nn mp iq ob b gy of og l oh oi"># referring to an HTML tag. first element with tag is returned.<br/>elem = driver.find_element_by_tag_name("INSERT-TAG-NAME")</span></pre><ul class=""><li id="9fef" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated">类别名</li></ul><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="be33" class="nn mp iq ob b gy of og l oh oi">elem = driver.find_element_by_class_name("INSERT-CLASS-NAME")</span></pre><ul class=""><li id="3a39" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated">XPath</li></ul><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="e095" class="nn mp iq ob b gy of og l oh oi">elem = driver.find_element_by_xpath("INSERT-XPATH")</span></pre><p id="07c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">XPath是一种用于在XML文档中定位节点的语言。当目标元素没有合适的id或name属性时，这很有用。基本格式如下:</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="404e" class="nn mp iq ob b gy of og l oh oi">xpath = //tagname[@attribute = "value"]</span></pre><p id="bbcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里阅读更多关于xpath的内容。</p><p id="9f76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，所有这些方法只会选择它找到的第一个元素。要选择多个元素，请使用相同的方法，但是将单词“元素”替换为“元素”(例如driver . find _<strong class="ky ir">elements</strong>_ by _ NAME(" INSERT-NAME "))</p><h2 id="fa04" class="nn mp iq bd mq no np dn mu nq nr dp my lf ns nt na lj nu nv nc ln nw nx ne ny bi translated">输入键</h2><p id="5f5b" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">找到login元素后，下一步是输入您的凭证。这是通过函数<code class="fe om on oo ob b">send_keys()</code>完成的。</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="7bab" class="nn mp iq ob b gy of og l oh oi">username = browser.find_element_by_name("onlineId1").send_keys("YOUR-USERNAME")</span><span id="2f6c" class="nn mp iq ob b gy ol og l oh oi">time.sleep(2)</span><span id="465d" class="nn mp iq ob b gy ol og l oh oi">password = browser.find_element_by_name("passcode1")<br/>password.send_keys(&lt;YOUR PASSWORD&gt;)</span></pre><p id="2d1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记住不要在任何地方提交密码，以保护自己。</p><p id="569a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我添加了一个等待，告诉Selenium在使用<code class="fe om on oo ob b">time.sleep()</code>输入用户名和密码之间暂停两秒钟。我发现没有它，Selenium移动太快，浏览器很难跟上。</p><p id="ef67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我通常会在输入凭据后按“Enter”按钮，所以我想在Selenium中做同样的事情。幸运的是，Selenium有一个标准键盘键列表<a class="ae kv" href="https://artoftesting.com/press-enter-tab-space-arrow-function-keys-in-selenium-webdriver-with-java" rel="noopener ugc nofollow" target="_blank">和</a>。在这种情况下，我使用了钥匙。返回:</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="cbeb" class="nn mp iq ob b gy of og l oh oi">password.send_keys(Keys.RETURN)</span></pre><p id="a456" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在你进来了！</p><p id="ed13" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要查看是否找到了元素并正确输入了凭据，可以尝试运行代码。一个新的Chrome实例将会弹出，你可以看到浏览器自动运行。此实例与您经常使用的浏览器不同。它不包含任何cookies，并在您完成后消失。因此，如果你确实需要cookies，你可以在<a class="ae kv" href="https://www.guru99.com/handling-cookies-selenium-webdriver.html" rel="noopener ugc nofollow" target="_blank">这个网站</a>上查看如何添加它们。</p><p id="2d79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当这个Chrome实例将我带到我的银行账户主页时，我可以看到我的代码运行正常。我看到两个链接:一个链接到我的支票账户，另一个链接到我的信用卡。要点击这些链接，我使用<code class="fe om on oo ob b">find_element_by_link_text</code>并使用<code class="fe om on oo ob b">click()</code>方法进行选择。</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="49ee" class="nn mp iq ob b gy of og l oh oi">browser.find_element_by_link_text('Bank of America Travel Rewards Visa Platinum Plus - ****').click()</span></pre><p id="654e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您进入包含您想要的交易的页面，从web驱动程序中检索<code class="fe om on oo ob b">page_source</code>并将其存储在一个变量中。这将用于稍后的解析。</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="486c" class="nn mp iq ob b gy of og l oh oi">boa_travel_html = browser.page_source</span></pre><p id="e5ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在剩下唯一要做的就是用你的其他银行账户重复。</p><h2 id="e353" class="nn mp iq bd mq no np dn mu nq nr dp my lf ns nt na lj nu nv nc ln nw nx ne ny bi translated"><strong class="ak"> iFrames </strong></h2><p id="2f8e" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">除了一个讨厌的iFrame之外，我在巴克莱的另一个账户也是如此。内嵌框架是一个HTML文档，嵌入在网站上的另一个HTML文档中。当我收到一个没有找到元素的错误时，我第一次怀疑这可能会妨碍我，尽管我通过它的名字清楚地找到了我想要的元素。幸运的是，Selenium有一种使用<code class="fe om on oo ob b">switch_to</code>方法导航到iFrame的简单方法。</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="28cc" class="nn mp iq ob b gy of og l oh oi">browser.switch_to.frame(browser.find_element_by_tag_name("iframe"))<br/>browser.find_element_by_name("uxLoginForm.username")</span></pre><p id="39ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用与美国银行示例中相同的方法继续检索页面源代码。</p><h2 id="784a" class="nn mp iq bd mq no np dn mu nq nr dp my lf ns nt na lj nu nv nc ln nw nx ne ny bi translated">无头浏览器</h2><p id="d0fd" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">一旦你知道你的代码工作了，你可以通过在下次运行你的程序时去掉弹出的浏览器来加速这个过程。</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="482e" class="nn mp iq ob b gy of og l oh oi">from selenium import webdriver from selenium.webdriver.chrome.options import Options<br/>chrome_options = Options()<br/><br/>chrome_options.add_argument("--headless")</span><span id="5f1c" class="nn mp iq ob b gy ol og l oh oi">driver = webdriver.Chrome(options = chrome_options)</span></pre><p id="b6b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您已经拥有了所有必要的数据。它可能不是一种可读性很强的格式，但是让它变得可用是Beautiful Soup的目的。</p><h1 id="a58b" class="mo mp iq bd mq mr op mt mu mv oq mx my jw or jx na jz os ka nc kc ot kd ne nf bi translated">美味的汤</h1><p id="af72" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated"><a class="ae kv" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank">美汤</a>是一个解析HTML文件的Python包。现在我们已经有了必要的HTML页面，我们可以使用Beautiful Soup来解析它以获得我们需要的信息。同样，在深入下面之前，我已经完整地包含了代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">漂亮的汤函数解析HTML银行交易页面</p></figure><h2 id="a484" class="nn mp iq bd mq no np dn mu nq nr dp my lf ns nt na lj nu nv nc ln nw nx ne ny bi translated">解析交易信息</h2><p id="3b96" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">是时候检查您之前检索的HTML页面了。因为混乱的纯文本页面是如此的…混乱，我选择了通过源本身来导航HTML，通过右击银行网站上的每个交易并选择“Inspect”这突出显示了web页面元素检查器中的事务(之前使用Selenium来标识登录框)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/3219dc88b881ee99f97f4b52ea712947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*m4DOYd8_rxboqTbIoglMog.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Chrome的网页元素检查器</p></figure><p id="0719" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想要收集的数据包括日期、交易描述和金额。如上所述，这些信息被嵌套在父“tr”标签内的多个“td”标签中。我使用了<code class="fe om on oo ob b"><a class="ae kv" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/#find" rel="noopener ugc nofollow" target="_blank">find</a></code>和<code class="fe om on oo ob b"><a class="ae kv" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/#find-all" rel="noopener ugc nofollow" target="_blank">find_all</a></code>函数的组合来沿着树移动，直到到达包含我想要的文本的标签。下面的片段是我如何检索日期的。</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="4b62" class="nn mp iq ob b gy of og l oh oi"># narrowed down to largest parent container <br/>containers = rows.find_all(‘tr’, class_ = [‘trans-first-row odd’, ‘trans-first-row even’, ‘even’, ‘odd’]) </span><span id="b284" class="nn mp iq ob b gy ol og l oh oi">dateli = [] <br/>descli = [] <br/>amtli = [] <br/>pending_counter = 0 </span><span id="ec18" class="nn mp iq ob b gy ol og l oh oi">for container in containers: <br/>    date = container.find(‘td’, headers = ‘transaction-date’)            .          .get_text(strip=True)</span></pre><p id="41be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于如何使用Beautiful Soup是针对您正在查看的网页而言的(正如我为检索到的每个页面创建的独立函数所证明的那样)，因此我不想一行一行地运行我的代码，而是想指出我发现的不规则之处和有趣的花絮，以帮助您尽可能高效地完成整个过程。</p><h2 id="5cc8" class="nn mp iq bd mq no np dn mu nq nr dp my lf ns nt na lj nu nv nc ln nw nx ne ny bi translated">类是类_</h2><p id="3290" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">所有漂亮的汤<code class="fe om on oo ob b">find</code>函数都以HTML属性作为关键字参数。虽然这对于大多数属性来说非常简单，但是在Python中，由于<code class="fe om on oo ob b">class</code>是一个保留关键字，所以您可以使用<code class="fe om on oo ob b">class_</code>来表示它的HTML对应物。</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="0761" class="nn mp iq ob b gy of og l oh oi">containers = rows.find_all(‘tr’, <strong class="ob ir">class_</strong> = [‘trans-first-row odd’,    ‘trans-first-row even’, ‘even’, ‘odd’])</span></pre><h2 id="9dc9" class="nn mp iq bd mq no np dn mu nq nr dp my lf ns nt na lj nu nv nc ln nw nx ne ny bi translated">soup.find()中的Lambda函数</h2><p id="dba4" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated"><code class="fe om on oo ob b">find</code>函数也可以将其他函数作为参数。要快速找到符合多个标准的特定标签，请尝试插入一个lambda函数。</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="6c13" class="nn mp iq ob b gy of og l oh oi"><em class="mg"># Example 1</em><br/>rows = boa_travel_table.find(<strong class="ob ir">lambda</strong> tag: tag.name=='tbody')</span><span id="1a06" class="nn mp iq ob b gy ol og l oh oi"><em class="mg"># Example 2</em><br/>boa_checking_table = boa_checking_soup.find(<strong class="ob ir">lambda</strong> tag: tag.name == 'table' and tag.has_attr('summary') and tag['summary'] == 'Account Activity table, made up of Date, Description, Type, Status, Dollar Amount, and Available balance columns.')</span></pre><p id="fd2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">示例1非常简单。我也可以不用lambda函数来找到相同的元素，使用如下代码:</p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="57e6" class="nn mp iq ob b gy of og l oh oi">rows = boa_travel_table.find('tbody', class_ = 'trans-tbody-wrap')</span></pre><p id="6e7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">示例2是lambda函数真正大放异彩的地方。通过结合多种标准并使用Python的<code class="fe om on oo ob b">has_attr</code> <em class="mg">，</em>我搜索我想要的东西的能力成倍增加。lambda有用性的另一个好例子(以及对lambda的解释！)可以在这里<a class="ae kv" href="https://www.tomordonez.com/python-lambda.html" rel="noopener ugc nofollow" target="_blank">找到</a>，作者在这里取Python <code class="fe om on oo ob b">isinstance</code>函数进行美汤搜索。</p><h2 id="8aa3" class="nn mp iq bd mq no np dn mu nq nr dp my lf ns nt na lj nu nv nc ln nw nx ne ny bi translated">美汤的文字vs .字符串</h2><p id="0069" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">在上面我漂亮的Soup代码的第8-19行中，我将标签(或者我喜欢称之为容器)缩小到最大的一个，它包含了我想要为每笔交易提取的所有三条信息(日期、描述、金额)。为了从这些深入的容器中提取数据，我使用了<code class="fe om on oo ob b">soup.tag.get_text()</code> <em class="mg">。</em></p><pre class="kg kh ki kj gt oa ob oc od aw oe bi"><span id="586d" class="nn mp iq ob b gy of og l oh oi">date = container.find('td', headers = 'transaction-date').<strong class="ob ir">get_text(</strong>strip=True<strong class="ob ir">)</strong></span></pre><p id="a95d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你通读了漂亮的Soup文档，你可能已经看到过用<code class="fe om on oo ob b">soup.tag.string</code>来代替提取文本。这是我第一次使用的功能，但我很快发现它在这种情况下不起作用。<code class="fe om on oo ob b">soup.tag.string</code>只返回一个<code class="fe om on oo ob b">NavigableString</code>类型的对象，该对象必须是标签中的唯一对象。</p><p id="85a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，<code class="fe om on oo ob b">soup.tag.get_text()</code>可以访问它的所有子字符串(即使它不是直接子字符串)并返回一个Unicode对象。因此，如果您想要提取的文本数据存在于一个子标签中(您可以在下面的截图中看到<code class="fe om on oo ob b">td</code>标签中的<code class="fe om on oo ob b">a</code>标签)，您应该使用<code class="fe om on oo ob b">soup.tag.get_text()</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/661cda7fb1b798bf8ce13fb5ffd7386c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*3fV6ItbKgQ4MGSi4yPDRTw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">嵌套标签使得有必要使用<code class="fe om on oo ob b">soup.tag.get_text()</code></p></figure><p id="5d0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢稍微干净的代码，你也可以使用<code class="fe om on oo ob b">soup.tag.text</code> <em class="mg">。</em>它调用<code class="fe om on oo ob b">get_text()</code>，基本上做同样的事情，但是我更喜欢原来的<code class="fe om on oo ob b">get_text()</code>，因为它支持关键字参数，比如分隔符、条带和类型。对于这个项目，我包含了<code class="fe om on oo ob b">strip=True</code>作为关键字参数，从文本中去除任何空白。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="b651" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">结论</h1><p id="a61f" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">现在，您可以通过运行一个程序从数据源中检索所有财务数据。这是你开始创建自己的预算类型指数，并通过你的消费习惯找到更多关于你自己的信息。出发去收集你的数据点，成为你自己最好的金融版本！</p></div></div>    
</body>
</html>