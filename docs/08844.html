<html>
<head>
<title>Classify Dogs and Cats with Google AutoML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用谷歌自动分类狗和猫</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/classify-dogs-and-cats-with-google-automl-2ae6eac64117?source=collection_archive---------31-----------------------#2020-06-25">https://towardsdatascience.com/classify-dogs-and-cats-with-google-automl-2ae6eac64117?source=collection_archive---------31-----------------------#2020-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a201" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们使用狗与猫的 Kaggle 数据集来测试 GCP 汽车</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9b82999155a8fb15a4c3cb75e3d3a564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f5rLhFISiinafRmlGp9j0Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://mc.ai/build-a-machine-learning-model-on-cloud-using-google-automl/" rel="noopener ugc nofollow" target="_blank">https://MC . ai/build-a-machine-learning-model-on-cloud-using-Google-automl/</a></p></figure><p id="450d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我与<a class="ae kv" href="https://cloud.google.com/automl" rel="noopener ugc nofollow" target="_blank">谷歌 Auto ML </a>的第一个项目，我非常好奇想尝试一下，因为我在 Medium 上看到了很多关于它的有趣帖子。例如，我建议你阅读这篇来自 Sriram Gopal 的非常有趣的<a class="ae kv" href="https://medium.com/@sriramgopal10792/image-classification-using-google-automl-tutorial-part-1-dc2beb6908f6" rel="noopener">帖子</a>，他解释了使用 Google AutoML 进行类似项目的所有步骤</p><p id="6eb7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我决定使用来自<a class="ae kv" href="https://www.kaggle.com/" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>的<a class="ae kv" href="https://www.kaggle.com/c/dogs-vs-cats/data" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">狗对猫</strong> </a>数据集。目标是分类图像是否包含狗或猫</p><p id="8a1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从使用<strong class="ky ir"> CRISP-DM 流程</strong>(数据挖掘的跨行业流程)开始:</p><ol class=""><li id="a0b3" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><strong class="ky ir">业务理解</strong></li><li id="d40c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">数据理解</strong></li><li id="54d5" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">准备数据</strong></li><li id="1b0e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">数据建模</strong></li><li id="83e1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">评估结果</strong></li><li id="3a87" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">展开</strong></li></ol><p id="415e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">业务理解</strong></p><p id="645d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图像分类是当今非常常见的任务，它包括将图像和一些类别作为输入，并输出输入图像属于一个或多个给定类别的概率</p><p id="6396" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一部分来自我想尝试的项目的主要目标<a class="ae kv" href="https://cloud.google.com/automl" rel="noopener ugc nofollow" target="_blank"> Google Auto ML </a></p><p id="3829" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">数据理解</strong></p><p id="b2b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kaggle 提供的数据:</p><ul class=""><li id="430b" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated"><strong class="ky ir">测试</strong>:包含 12500 张猫狗图片的文件夹，用作测试数据集</li><li id="4e28" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><strong class="ky ir"> train </strong>:包含 25000 张猫狗图片的文件夹，图片名称中带有标签，即 dog.0.jpg cat.0.jpg</li><li id="a893" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><strong class="ky ir">sample submission . CSV</strong>:CSV 文件，参赛时作为提交参考</li></ul><p id="9909" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些图像是 RGB 的，并且具有不同的尺寸</p><p id="6f59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kaggle 的数据集结构与 Google AutoML 的数据集结构非常不同，Google AutoML 的数据集结构是每个标签一个文件夹，里面有图像</p><p id="05ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">准备数据和数据建模</strong></p><p id="48b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如前所述，Kaggle 已经完成了图像的标记，模型的选择和调整将由 Google AutoML Vision 完成</p><p id="620c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要使用谷歌自动视觉:</p><ol class=""><li id="fed2" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">创建一个谷歌云平台账户</li><li id="a39f" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">创建新项目</li><li id="3be5" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">启用 AutoML API</li><li id="f839" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">创建服务帐户</li><li id="50b9" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">创建一个桶</li><li id="964b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">创建. csv 文件来映射数据集的图像</li><li id="4039" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">将图像上传到桶中</li><li id="a68c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">创建数据集并上传图像</li><li id="dc09" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">训练模型</li><li id="cf2a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">部署模型</li></ol><p id="61f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们只需以预期的格式向 Google AutoML Vision 提供数据。要让 Google AutoML Vision 使用数据:</p><ol class=""><li id="b827" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">将 Kaggle <strong class="ky ir"> train </strong>文件夹中的图像分离到<strong class="ky ir">狗</strong>和<strong class="ky ir">猫</strong>文件夹中</li><li id="e2c5" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">将<strong class="ky ir">狗</strong>和<strong class="ky ir">猫</strong>文件夹上传到谷歌云存储的桶中</li><li id="093a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">创建一个 csv 文件来映射桶中数据集的图像</li></ol><p id="269e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据集已经在训练、验证和测试数据集中被自动拆分。也可以在映射 csv 文件中为每个图像指定训练、验证、测试或未分配，以更改用于训练、验证和测试的图像数量之间的比率</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/c77809d9e8b65790e31bb2bc1399b238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*1TyYp4j2CG8RqqZv3o_Jbw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">标签统计</p></figure><p id="a0c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">模型的训练可能需要几个小时(您可以选择使用多少个节点小时),当它完成时，google 将发送一封电子邮件</p><p id="e2eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">评估结果</strong></p><p id="0b2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<strong class="ky ir">评估</strong>页面中，我们可以看到模型性能</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/c08113738fa2e8cdf38ff6e4cfc6345a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MG81dpiU6Dcy81itpP1ivQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GCP 评估模型</p></figure><p id="df04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以使用滑块改变<strong class="ky ir">置信度阈值</strong></p><p id="0c54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们也可以检查一下<strong class="ky ir">混淆矩阵</strong>(顺便说一句，我建议你读一读这篇来自<a class="ae kv" href="https://blog.exsilio.com/" rel="noopener ugc nofollow" target="_blank">blog.exsilio.com</a>的<a class="ae kv" href="https://blog.exsilio.com/all/accuracy-precision-recall-f1-score-interpretation-of-performance-measures/#:~:text=Precision%20%2D%20Precision%20is%20the%20ratio,the%20total%20predicted%20positive%20observations.&amp;text=F1%20score%20%2D%20F1%20Score%20is,and%20false%20negatives%20into%20account." rel="noopener ugc nofollow" target="_blank">帖子</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/e66f15a051be437866a43328c28b4aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*ID2heSbQOaBri4ra8zC8jw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">https://blog . ex silio . com/all/accuracy-Precision-recall-f1-score-interpretation-of-performance-measures/#:~:text = Precision %20% 2D % 20 Precision % 20 is % 20 比率% 20 总计% 20 预测% 20 正面% 20 观察值。&amp;text = F1 %20 score % 20% 2D % 20 F1 % 20 score % 20 is，以及% 20false % 20negatives %进入% 20 帐户。</p></figure><p id="daaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">真阳性(TP) </strong>:这些是正确预测的阳性<br/> <strong class="ky ir">真阴性(TN) </strong>:这些是正确预测的阴性<br/>假阳性和假阴性，这些值出现在你的实际类与预测类相矛盾的时候。<br/><strong class="ky ir">【FP】</strong>:实际类为负，预测类为正<br/> <strong class="ky ir">假阴性(FN) </strong>:实际类为正，预测类为负</p><p id="8708" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">精度</strong> = (TP + TN) / (TP + FP + FN + TN)</p><p id="64d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">精度</strong> = TP / (TP + FP)</p><p id="ee1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">回忆</strong> = TP / (TP + FN)</p><p id="7f54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> F1 得分</strong> = 2*(召回率*精确度)/(召回率+精确度)</p><p id="42fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的案例中:</p><p id="2533" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">TP = 1240<br/>TN = 1249<br/>FP = 1<br/>FN = 10<br/>精度=(1240+1249)/(1240+1+10+1249)= 0.995<br/>精度= 1240 / (1240 + 1) = 0.999 <br/>召回= 1240 / (1240 + 10) = 0.992 <br/> F1</p><p id="2b4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">展开</strong></p><p id="f71e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">培训结束后，我们可以在 GCP 部署并使用该模型</p><p id="35e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个<a class="ae kv" href="https://dash.plot.ly/introduction" rel="noopener ugc nofollow" target="_blank"> dash </a>应用程序已经被开发为用户界面:可以上传要分类的图像。当没有上传图像时，应用程序显示训练数据集的概览</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/487ef25574b0c89d49974f37325931a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k-ArLB5ZqtMeIrEBlmXRCg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Dash web 应用程序主页</p></figure><p id="7343" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当提供图像并按下<strong class="ky ir">分类</strong>按钮时，应用程序显示分类</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/eda6928e958b6a4943b2aeab85892f42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W02KeVVP5HYFMXMmf-q3Gg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图像分类</p></figure><p id="51e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在所示的例子中，我在谷歌图片上搜索了一只狗，并用它作为输入来检查我的分类器的输出</p><p id="6388" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">有趣的事实</strong></p><p id="6014" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我试图对我的个人资料图片进行分类，显然我是一只得分为 0.89 的狗</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/913d65796e9e89aba4d5f59e1832c80b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*u5l8LgrBQZgTfjd4eXVZBQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我的个人资料图片分类</p></figure><p id="f466" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>代码可以在这个 github <a class="ae kv" href="https://github.com/simonerigoni/dogs_vs_cats" rel="noopener ugc nofollow" target="_blank">仓库</a>中找到</p></div></div>    
</body>
</html>