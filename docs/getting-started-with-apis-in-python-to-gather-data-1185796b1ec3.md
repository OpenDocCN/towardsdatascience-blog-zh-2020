# 开始使用 Python 中的 API 收集数据

> 原文：<https://towardsdatascience.com/getting-started-with-apis-in-python-to-gather-data-1185796b1ec3?source=collection_archive---------4----------------------->

## 使用 API

## Python 中 API 的友好(一点也不可怕)介绍

![](img/057c0b7ccdda00cdaeff93b4bf22c6a7.png)

Python 中的 API 入门不需要吓人！(来源:Nik Piepenbreier)

PIs，或者说应用程序编程接口，提供了简单的方法来检索(和发布)数据。它们是由服务器提供的接口，您可以使用它们通过代码检索和发送数据。本质上，它们简化了复杂的指令来提供来自服务器的请求。他们可以比作餐馆的服务员。作为顾客，你向服务员发出用餐指示，然后服务员将要求反馈给厨房，在那里厨师采取复杂的步骤准备一道菜，而你根本不知道他或她付出了多少努力！然后你就可以拿回你点的餐，而不必计算到达那里的步骤！

与使用静态数据下载(比如 CSV 文件)相比，API 提供了很多效率。这些功能包括处理快速变化的数据或只处理一小部分数据的能力(比如，与下载大量天气数据相比，今天的温度)。

在真实、抽象的世界中，您可能每天都在不知不觉中使用 API。正是这种抽象使得 API 如此有用——网站可能依赖谷歌地图的 API 将你链接到方向，或者你的 Twitter 客户端让你直接将数据发布到你的帐户。

**但是我们如何利用 API 来收集数据呢？**

在本教程中，我们将首先探索在不需要身份验证的情况下收集数据，然后探索另一个需要我们进行身份验证的 API。我们将首先找到国际空间站(ISS)目前在哪里使用 Open Notify API，然后使用对 Dark Sky 的天气 API 的身份验证来收集有趣的天气数据。我们将通过探索如何将法兰克福证券交易所的数据添加到熊猫数据框架中来结束这篇文章！

![](img/f050ed3054604c95192827d6393b3b37.png)

让我们看看这个 API 实际上是如何工作的(来源:Nik Piepenbreier)

# 好的……但是它们是如何工作的呢？

![](img/2945a21ad66fb54cf7869d269eefe68e.png)

(来源:Nik Piepenbreier)

类似于与常规网站的交互，当你想从一个 API 获取数据时，你需要向服务器发出一个**请求**。为了能够使用 Python 从 API 中提取数据，我们需要使用请求库(请看图！).Requests 或多或少是 Python 中进行 HTTP 请求的标准包。由于它的抽象性，使用起来非常简单，尤其是在使用 API 的时候。

首先，您可能需要安装请求库，因为它不是标准 Python 包的一部分。这可以通过 pip 或 conda 实现。

```
pip install requestsconda install requests
```

请求由四部分组成:

1.  一个**端点**——看起来像数据的 URL
2.  一个**方法** —获取、上传、发布或删除。在这篇文章中，我们将只探讨 GET 请求。
3.  **报头**——提供认证密钥等信息。
4.  **数据/主体**——它不是 GET 请求的一部分(所以，现在假装我没有提到它)

当我们使用 requests 库运行一个请求时，它返回一个 request 对象，其中包含我们希望提取的数据，还包含一个 requests *状态代码*。状态代码告诉我们请求发生了什么，它们是我们发出的每个请求的一部分。我们将处理 GET 请求，有许多响应代码与我们的工作相关。根据代码返回的信息，代码被分成数百个不同的值:

*   1xx:提供信息
*   2xx:通常是成功的
*   3xx:提供重定向信息
*   4xx:指客户端错误(我们的错误)
*   5xx:指服务器错误(他们的错误)

当一个页面找不到的时候，你可能很熟悉看到(有时很滑稽)404 页面。这就是状态代码。

同样，状态代码 200 让我们知道一切正常！这就是我们想要的，并且有希望得到的！

# API 101—ISS 当前位置

![](img/6ccb8c5b515b537baa8a4613e994d35d.png)

对双关语爱好者的特别款待(来源:Nik Piepenbreier)

在本教程的第一部分，我们将看看提供国际空间站数据的开放式通知 API。你可以通过[访问他们的文档](http://open-notify.org/Open-Notify-API/)找到更多关于 API 的信息。

这个 API 的一个优点是它不需要认证，这意味着我们可以直接提取一些数据，而不需要额外的设置。

让我们首先用请求库生成一个 URL 请求，并访问它的状态代码属性。

我们可以通过使用下面列出的代码来做到这一点。为简单起见，输出显示在虚线下面。

的。get()函数请求一个请求对象。在这里，我们可以使用。status_code 属性来发现状态代码返回的内容。在本例中，返回的 status_code 是 200，这意味着我们可以继续前进了！

我们得到的数据以 JSON 格式返回。JSON 文件类似于 Python 字典，可以确保数据容易被机器读取。理解 JSON 文件的一个简单方法是将它们想象成用字符串表示的 Python 字典。

要开始处理 JSON 文件，让我们导入 JSON 库，它是标准包的一部分(所以我们不需要安装任何东西)。为了便于阅读，我在虚线下包含了代码的输出。

这个响应返回的字符串很短，很容易阅读。然而，许多 API 响应将会很长，并且可能需要一些解析来确定您想要在哪里查找您的数据(如果您对某个特定部分感兴趣的话)。让我们使用。dumps()函数将 JSON 字符串转换成 Python 对象。为了保持连续性，我们将重复一些代码。

这是一种更容易阅读的格式，使我们能够更容易地解析数据。假设我们只对纬度和经度感兴趣，我们可以像解析 Python 中的字典数据一样解析它。

这里需要注意的一点是，我们在这里调用的是 response.json()对象，而不是我们使用。dumps()函数。

从这里开始，我们现在可以使用这些数据轻松地将数据添加到数据集，使用我们想要的任何方法。

现在让我们把注意力转向黑暗天空 API，在我们开始之前需要做一些设置。

# API 201—黑暗天空 API &添加身份验证

## 让我们给你报名吧！

![](img/d69e7cf9328cdb3edc2069d5702cd357.png)

你来学习，你留下来是为了双关语！(来源:Nik Piepenbreier)

首先，我们需要获得一个所谓的 **API 密匙**。密钥是允许用户在不需要提供用户名和密码的情况下进行身份验证的方法。因此，应该安全地对待它们，而不是共享它们。要获得你自己的黑暗天空密钥，在 https://darksky.net/dev/register 的[注册一个黑暗天空账户。免费层将是很好的实验。](https://darksky.net/dev/register)

注册后，导航到 https://darksky.net/dev/account[的账户页面](https://darksky.net/dev/account)，它会给你 API 密匙。记下这个密钥，并确保它是保密的。

作为免费等级的一部分，您每天最多可以拨打 1，000 次电话。

## 黑暗天空 API 里有什么？

《黑暗天空》提供了关于 API 中包含哪些数据的完整资源，你可以访问:[https://darksky.net/dev/docs](https://darksky.net/dev/docs)

有两种主要的呼叫类型:(1)预测请求，和(2)时间机器请求。前者提供当前天气(直到下周)，后者提供过去和未来的数据。

让我们假设我们想要提取安大略省多伦多市的当前天气状况(概要、温度和风速)。

预测请求采用以下格式:[https://API . dark sky . net/forecast/[**key**]/[**latitude**，[ **经度** ]](https://api.darksky.net/forecast/%5Bkey%5D/%5Blatitude%5D,%5Blongitude%5D)

这意味着我们需要三样东西:

1.  我们的 API 密钥，
2.  我们的纬度，和
3.  我们的经度。

为了轻松找到您的纬度和经度，您可以将您要找的地址输入到[谷歌地图](https://www.google.com/maps)中。比如我搜了多伦多的 CN 塔。返回的 URL 将包含坐标:【https://www.google.com/maps/place/CN+Tower/@】T2**43.6425701**， **-79.3892455** ，17z/

在@符号之后，首先是经度(43.6425701)，然后是纬度(-79.3892455)。

让我们以一种冗长但易于理解的方式写出代码。我们将利用 f 字符串使代码更容易阅读。如果你对 f 弦不熟悉，请查看他们的 [Python 文档](https://www.python.org/dev/peps/pep-0498/)。

根据文档，我们可以看到通用请求提取了比我们需要的更多的数据。虽然不是必需的，但我们可以使用 Dark Sky 的 exclude 块来减少这个问题，这将减少请求的延迟。我们将只使用当前的*块，所以我们将排除所有其他的块。*

前面我们提到我们会对当前的状况感兴趣(特别是概要、温度和风速)。通过查看上面的结构，我们可以看到，通过访问这些项目的键值对，我们可以很容易地提取这些数据。

黑暗天空 API 也允许你设置单位。目前，我们的声明还不清楚我们提取的数据是以什么单位表示的。再明确一点吧。由于我们正在提取加拿大位置的数据，所以让我们指定他们的地区。黑暗天空 API 文档告诉你我们应该设置 units=si。

到目前为止，我们已经学习了如何使用和不使用身份验证进行 API 调用。让我们更进一步，将它添加到熊猫数据框架中。

# 变得非常有趣:将数据添加到熊猫数据框中

假设我们正在进行一个项目，我们需要生成一个包含财务数据的数据框架。我们可以使用熊猫的内置函数轻松做到这一点。

![](img/d99764087aed3fa07a6d534ddf5b7462.png)

这个双关语没那么好。但是，我努力了。(来源:Nik Piepenbreier)

为此，我们将使用 Quandl 的财务 API。特别是，我们将为法兰克福证券交易所使用免费的 API，关于它的[文档可以在这里找到](https://www.quandl.com/data/FSE-Frankfurt-Stock-Exchange/documentation)。

让我们稍微研究一下这些数据。我们将按照在网站上生成 URL 的说明加载数据，并使用上述 json.dumps()函数打印数据。我们需要像以前一样导入相同的库，以及熊猫。

数据实际上会持续很长很长时间，但在这里被截断了。

由此，我们可以看出:

*   列名在['dataset']['column_names']中找到
*   数据在['dataset']['data']中找到

让我们利用这些知识创建一个数据框架:

## 结论:我们学到了什么？

在这篇文章中，我们探讨了什么是 API，如何在 Python 中使用它们，包括认证和不认证，以及如何将 API 中的数据添加到 pandas 数据帧中。对于 API，我们还有很多没有在这里介绍，但是希望这能让您很好地理解从这里学到什么！