<html>
<head>
<title>Access Satellite Imagery with AWS and Google Colab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 AWS 和 Google Colab 访问卫星图像</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/access-satellite-imagery-with-aws-and-google-colab-4660178444f5?source=collection_archive---------12-----------------------#2020-01-12">https://towardsdatascience.com/access-satellite-imagery-with-aws-and-google-colab-4660178444f5?source=collection_archive---------12-----------------------#2020-01-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="72ce" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Python 和 Google Colab 加载、试验和下载云优化地理信息系统(COG)。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8c0faac557a8f79309736ed2cddec22f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VHPZOIbxPu5OKbHK"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@dallasreedy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">达拉斯里德</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="da91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本地下载卫星影像时，访问卫星影像需要大量存储空间。如果您在一段时间内需要多个地块，该过程会占用您的所有存储空间。更糟糕的是，您可能只需要整个图像的一个子集区域。</p><p id="9523" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了解决这样的问题，地理空间数据的最新进展使用了我们云优化的地理信息系统(COG)。</p><blockquote class="lv"><p id="cd73" class="lw lx it bd ly lz ma mb mc md me lu dk translated"><!-- -->云优化 GeoTIFF (COG)是一个常规的 GeoTIFF 文件，旨在托管在一个 HTTP 文件服务器上，其内部组织可以在云上实现更高效的工作流。它通过利用客户端发出的<a class="ae ky" href="https://tools.ietf.org/html/rfc7233" rel="noopener ugc nofollow" target="_blank"> HTTP GET range 请求</a>来请求他们需要的文件部分。——<a class="ae ky" href="https://www.cogeo.org/" rel="noopener ugc nofollow" target="_blank">https://www.cogeo.org/</a></p></blockquote><p id="d6c3" class="pw-post-body-paragraph kz la it lb b lc mf ju le lf mg jx lh li mh lk ll lm mi lo lp lq mj ls lt lu im bi translated">现在想象一下，能够倒带、前进和停止一个大视频来观看你需要的视频部分。COG 精确地允许你用卫星图像做到这一点。你可以得到一个孔瓷砖，可视化低分辨率，子集和掩盖一个地区，甚至进行任何处理，甚至没有下载它。</p><p id="4fee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程将向您展示如何使用 Python 在 Google Colab 中访问存储在 AWS s3 存储中的 Landsat 图像。第一部分讲述了如何找到适合您感兴趣领域的图像，而第二部分向您展示了如何使用 Python 访问、可视化和处理卫星图像。</p><h2 id="ca56" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">查找您感兴趣的区域的卫星图像</h2><p id="a072" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">我收到很多关于如何获得感兴趣区域的正确图像的询问。在这种情况下，我们使用 Landsat 图像，因此我将指导您如何获得卫星图像的路径和行。进入<a class="ae ky" href="https://earthexplorer.usgs.gov/" rel="noopener ugc nofollow" target="_blank"> USGS explorer </a>网站，通过提供地址或地点(下图中以红色突出显示)找到您感兴趣的地方。一旦你得到结果，点击地址。如果你愿意，可以按日期过滤掉。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/b2512cca1a625dfd7e743e2e448f2c0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1OTjeYtM6orER8Dgf5F4nQ.png"/></div></div></figure><p id="a328" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是单击数据集并选择数据集。在本教程中，我们使用的是 Landsat 8，所以我们选择了它(下面突出显示的红色)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/20fe265c5eaff4f5f4071fa77f6307da.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*w_VK-fJze-oYSRHn91lYvw.png"/></div></figure><p id="aa05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击附加标准以过滤云覆盖范围。如下图所示，我们过滤掉小于 10%的云覆盖。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/278b7acb87e49d0d1d2f5dc5bd249d27.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*_ZW4_a4pPeRW66yMXSqV2Q.png"/></div></figure><p id="6550" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，点击结果，找出你所在地区所有可用的图片。一旦您知道您想要用于分析的图像，您就可以复制 ID 或将其记在某处(如下所示)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/e771d132a5a25a55967d0f3ab05026d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*GnkJycJPEhO5CktrhiInPQ.png"/></div></figure><p id="69d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你还需要记下卫星图像的路径和行。你可以点击元数据按钮(红色矩形)或者简单地记下 ID: 0030065 的第三部分。</p><p id="27e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一节中，我们将看到如何使用 Python 在 Google Colab 中直接访问数据。Landsat 同时存储在 AWS 和 Google 云平台中，但在本教程中，我们通过 AWS 获取数据。</p><h1 id="e98d" class="nm ml it bd mm nn no np mp nq nr ns ms jz nt ka mv kc nu kd my kf nv kg nb nw bi translated">用 AWS 和 Google Colab 访问 Landsat</h1><p id="086c" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">让我们首先导入我们将要使用的库。我们的主要工具是 Rasterio，它提供了一个易于使用的 API 来处理卫星图像。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="9acb" class="mk ml it ny b gy oc od l oe of">import numpy as np<br/>import matplotlib.pyplot as plt<br/>import rasterio as rio<br/>from rasterio.plot import show</span></pre><p id="53f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以像这样构造您的 URL 路径。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="48f6" class="mk ml it ny b gy oc od l oe of">fpath = ‘http://landsat-pds.s3.amazonaws.com/c1/L8/003/065/LC08_L1TP_003065_20190925_20191017_01_T1/LC08_L1TP_003065_20190925_20191017_01_T1_B4.TIF'</span></pre><p id="944a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以将上面的 URL 分成不同的部分:</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="87bd" class="mk ml it ny b gy oc od l oe of"><a class="ae ky" href="http://landsat-pds.s3.amazonaws.com/c1/" rel="noopener ugc nofollow" target="_blank">http://landsat-pds.s3.amazonaws.com/c1/</a></span></pre><p id="6dfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">URL 的第一部分总是相同的，并显示 AWS 存储 URL。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="c03f" class="mk ml it ny b gy oc od l oe of">L8/003/065/</span></pre><p id="8af0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">L8 表示陆地卫星 8 号。路径:003。第 065 排。URL 的这一部分将根据您正在访问的数据集和感兴趣的区域而变化。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="728f" class="mk ml it ny b gy oc od l oe of">LC08_L1TP_003065_20190925_20191017_01_T1</span></pre><p id="5ba6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这部分是图片的 ID，你可以从上面的图片中得到。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="b336" class="mk ml it ny b gy oc od l oe of">LC08_L1TP_003065_20190925_20191017_01_T1_B4.TIF</span></pre><p id="cd37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，重复图像的 ID，但这次是您想要访问的波段(这里是 B4)和图像的扩展名。TIFF)</p><p id="12d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们已经设置了访问 URL，我们可以编写一个简单的函数来使用 Rasterio 打开图像。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="b371" class="mk ml it ny b gy oc od l oe of">def rasterio_open(f):</span><span id="d58b" class="mk ml it ny b gy og od l oe of">return rio.open(f)</span><span id="eadd" class="mk ml it ny b gy og od l oe of">src_image = rasterio_open(fpath)</span></pre><p id="8fc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一次，我们打开光栅图像；您可以使用任何可视化库或仅 Rasterio 的数据可视化方法来绘制它。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="2430" class="mk ml it ny b gy oc od l oe of">fig, ax = plt.subplots(1, figsize=(12, 10))</span><span id="42c2" class="mk ml it ny b gy og od l oe of">show(src_image, ax=ax)</span><span id="687f" class="mk ml it ny b gy og od l oe of">plt.show()</span></pre><p id="0e30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们访问显示的整个图像。我们只获得了频带 4。我们稍后会看到如何将不同的波段组合起来构建一幅 RGB 图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/9ad9b6183d642991aa945b519e802bb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*-xLggcuN-IeNMsS79_2xGA.png"/></div></figure><p id="5296" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们有显示为黑色的 NaN 值。我们可以通过使用 Numpy 功能来消除这些问题。我们首先通过用 Rasterio 读取图像，将图像转换为 Numpy 数组</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="3c8c" class="mk ml it ny b gy oc od l oe of">src_image_array = src_image.read(1)</span><span id="25da" class="mk ml it ny b gy og od l oe of">src_image_array = src_image_array.astype(“f4”)</span><span id="eb2a" class="mk ml it ny b gy og od l oe of">src_image_array</span></pre><p id="169b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图像被转换成数组，如下所示。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="c797" class="mk ml it ny b gy oc od l oe of">array([[0., 0., 0., …, 0., 0., 0.], [0., 0., 0., …, 0., 0., 0.], [0., 0., 0., …, 0., 0., 0.], …, [0., 0., 0., …, 0., 0., 0.], [0., 0., 0., …, 0., 0., 0.], [0., 0., 0., …, 0., 0., 0.]], dtype=float32)</span></pre><p id="4ddc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以通过将这些空数组赋值为 np.nan 来轻松删除它们。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="b092" class="mk ml it ny b gy oc od l oe of">src_image_array[src_image_array==0] = np.nan</span><span id="60bb" class="mk ml it ny b gy og od l oe of">fig, ax = plt.subplots(1, figsize=(12, 10))</span><span id="0414" class="mk ml it ny b gy og od l oe of">show(src_image_array, ax=ax)</span><span id="62f6" class="mk ml it ny b gy og od l oe of">plt.show()</span></pre><p id="85de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在在边上没有空值了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/c3f7e5a1b1cda5088e8d37b194c171ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*OpRToWbRbv6KqS6USnUC9w.png"/></div></figure><p id="cb37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，您可能只对图像的一个子集感兴趣。在下一节中，我们将介绍如何使用 Rasterio 的窗口功能对图像进行子集化。</p><h2 id="9cb7" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">子集化图像</h2><p id="e593" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">要只访问图像的特定部分，可以用行、列、宽度和高度过滤掉图片。比方说，我们不想要整个图像，而是要一个 750 X 850(宽和高)的 1200 列和 1200 行的图像。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="401d" class="mk ml it ny b gy oc od l oe of"># Window(col_off, row_off, width, height)<br/>window = rio.windows.Window(1200, 1200, 750, 850)</span><span id="09c1" class="mk ml it ny b gy og od l oe of">subset = src_image.read(1, window=window)</span><span id="8e7a" class="mk ml it ny b gy og od l oe of">fig, ax = plt.subplots(1, figsize=(12, 10))</span><span id="b355" class="mk ml it ny b gy og od l oe of">show(subset, ax=ax)<br/>ax.set_axis_off()</span><span id="0fdc" class="mk ml it ny b gy og od l oe of">plt.show()</span></pre><p id="c1e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在图像缩小到一个子集，在城市 Eirunepe 附近，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/142a9db27375b628ca83800545a20c91.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*HMoPIxoqeGgec_YDweZr7w.png"/></div></figure><p id="708d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，下一节将展示如何创建一个 RGB 图像并将其下载到本地。</p><h2 id="efa7" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">创建 RGB 并下载</h2><p id="0192" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">我们首先通过为每个波段提供一个单独的 URL 来访问每个波段。注意，除了。TIF 分机。这些是波段，在这种情况下，因为我们想要创建一个 RGB 图像，所以我们访问波段 4(红色)、波段 3(绿色)和波段 2(蓝色)。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="f89a" class="mk ml it ny b gy oc od l oe of">rpath = ‘http://landsat-pds.s3.amazonaws.com/c1/L8/003/065/LC08_L1TP_003065_20190925_20191017_01_T1/LC08_L1TP_003065_20190925_20191017_01_T1_B4.TIF'</span><span id="a555" class="mk ml it ny b gy og od l oe of">gpath = ‘http://landsat-pds.s3.amazonaws.com/c1/L8/003/065/LC08_L1TP_003065_20190925_20191017_01_T1/LC08_L1TP_003065_20190925_20191017_01_T1_B3.TIF'</span><span id="2755" class="mk ml it ny b gy og od l oe of">bpath = ‘http://landsat-pds.s3.amazonaws.com/c1/L8/003/065/LC08_L1TP_003065_20190925_20191017_01_T1/LC08_L1TP_003065_20190925_20191017_01_T1_B2.TIF'</span><span id="14f1" class="mk ml it ny b gy og od l oe of">red = rio.open(rpath)</span><span id="81fd" class="mk ml it ny b gy og od l oe of">green = rio.open(gpath)</span><span id="5953" class="mk ml it ny b gy og od l oe of">blue = rio.open(bpath)</span></pre><p id="4d33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们创建一个 RGB 图像，方法是打开一个空图像，并用上面打开的三个波段填充它。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="d796" class="mk ml it ny b gy oc od l oe of"># Create an RGB image</span><span id="93e3" class="mk ml it ny b gy og od l oe of">with rio.open(‘RGB.tiff’,’w’,driver=’Gtiff’, width=red.width, height=red.height,count=3,crs=red.crs,transform=red.transform, dtype=red.dtypes[0]) as rgb:</span><span id="5bbc" class="mk ml it ny b gy og od l oe of">rgb.write(blue.read(1),1)</span><span id="c2ea" class="mk ml it ny b gy og od l oe of">rgb.write(green.read(1),2)</span><span id="1cba" class="mk ml it ny b gy og od l oe of">rgb.write(red.read(1),3)</span><span id="d5c4" class="mk ml it ny b gy og od l oe of">rgb.close()</span></pre><p id="6308" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图像现已存储。你可以用 Rasterio 打开或者下载到本地。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/be915fcc4cb7c4c651c4e9cc89eab6e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p_oB97D64z5QAwmxT3KTAg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 QGIS 可视化的图像子集</p></figure><h2 id="0977" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">结论</h2><p id="1042" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在本教程中，我们介绍了如何查看和找到您感兴趣的领域的正确数据。我们还了解了如何使用 Python 和 AWS 存储来访问 Landsat 图像。</p><p id="2e7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程的代码可以在这个 Colab 笔记本上找到。</p><div class="ol om gp gr on oo"><a href="https://github.com/shakasom/rs-python-tutorials/blob/master/Cloud_Optimized_Geotiffs.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">shaka som/RS-python-教程</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">github.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc ks oo"/></div></div></a></div></div></div>    
</body>
</html>