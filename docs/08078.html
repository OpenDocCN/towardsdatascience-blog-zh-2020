<html>
<head>
<title>Deep dive into ROC-AUC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入研究ROC-AUC</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-dive-into-roc-auc-cfdd78959ac3?source=collection_archive---------43-----------------------#2020-06-14">https://towardsdatascience.com/deep-dive-into-roc-auc-cfdd78959ac3?source=collection_archive---------43-----------------------#2020-06-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8011" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为什么ROC曲线和曲线下面积对分类很重要？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dab26230e9819c5262a329c820b84614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7VpRROTca_NUSO9JIFgQpg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:图片由来自Unsplash的Geran De Klerk提供</p></figure><p id="8c0a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">相信大部分人如果对数据科学感兴趣的话，之前都听过ROC曲线或者曲线下面积。然而，ROC曲线到底是什么，为什么ROC曲线下的面积是评估分类模型的良好度量？我在上一篇文章中简要介绍了分类的顶级指标，但我将在本文中更详细地介绍。</p><h2 id="ab41" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">一些背景信息</h2><p id="35d4" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">ROC的全称是接收机工作特性。它最初是在第二次世界大战期间为雷达信号探测的使用而创建的。美国已经用它来提高雷达探测日本飞机的准确性。这就是为什么它被称为接收机工作特性。</p><p id="9ea6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">AUC或曲线下面积就是ROC曲线下的面积。在我们进入什么是ROC曲线之前，我们需要快速了解混淆矩阵。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/b11a67cca83185b384be4cc17a882157.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0nxsxtwlqLyz5RiFKwLXkg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:作者-困惑矩阵</p></figure><p id="5b2c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从上图可以看出，混淆矩阵是你的预测(1或0) vs实际值(1或0)的组合。根据你的预测值和你是否正确分类，它被分为4个部分。例如，真阳性是您正确地将病例分类为阳性的病例数，而假阳性是指您错误地将病例分类为阳性的病例数。</p><p id="388a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">混淆矩阵只包含绝对数字。然而，基于这些数字，我们可以开发许多新的基于百分比的指标。真阳性率和假阳性率就是其中的两个。</p><ol class=""><li id="0dd6" class="mu mv it la b lb lc le lf lh mw ll mx lp my lt mz na nb nc bi translated">真阳性率(TPR):在真阳性案例中，有多少百分比被正确地捕获到模型中</li></ol><p id="b04f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">TPR=TP/(TP+FN)</p><ol class=""><li id="a7d7" class="mu mv it la b lb lc le lf lh mw ll mx lp my lt mz na nb nc bi translated">假阳性率(NPR):在真正阴性的病例中，有多少百分比实际上是假阳性。</li></ol><p id="2c19" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">NPR=FP/(FP+TN)</p><blockquote class="nd ne nf"><p id="8cf6" class="ky kz ng la b lb lc ju ld le lf jx lg nh li lj lk ni lm ln lo nj lq lr ls lt im bi translated">好了，现在让我们进入ROC曲线！</p></blockquote><h2 id="dc39" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">什么是ROC曲线？</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/21494bc31d4a9ee3c95c7e1e66f367f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*QmriqrBxOTWP34JfDIZfQA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:作者ROC曲线示例</p></figure><p id="a6dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从图中可以看出，ROC曲线只是TPR对NPR的曲线。好了，故事结束了…</p><blockquote class="nd ne nf"><p id="9201" class="ky kz ng la b lb lc ju ld le lf jx lg nh li lj lk ni lm ln lo nj lq lr ls lt im bi translated">开个玩笑！</p><p id="fb05" class="ky kz ng la b lb lc ju ld le lf jx lg nh li lj lk ni lm ln lo nj lq lr ls lt im bi translated">你可以从图表中读到更多的信息。这里我想问的第一件事是:模型结果的TPR、FPR只有一套，你是如何形成这么多的点来绘制图形的？</p></blockquote><p id="0009" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这又回到了分类模型的工作原理。当你建立一个像决策树一样的分类模型，你想根据输入来分类股票明天是上涨还是下跌。分类模型将首先根据您提供的历史值计算增加或减少的概率。之后，基于<strong class="la iu">阈值</strong>，它将决定结果是增加还是减少。</p><p id="6430" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">没错，这里的关键词就是门槛。不同的阈值产生不同的TPR和FPR。它们代表不同的点，形成ROC曲线。根据历史数据，如果增加的可能性超过50%,您可以将输出选择为“增加”,但是您也可以增加阈值，并且只有在超过90%的可能性时才显示“增加”。如果你选择90%的信心，而不是50%，你会更有信心，你选择显示'增加'的股票很可能会增加，但你可能会错过一些潜在的股票。</p><h2 id="bcac" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">为什么我在图上画蓝色虚线？</h2><p id="ad91" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我们知道，曲线下面积(AUC)越大，分类就越好。理想或完美的曲线是一条从(0，0)到(0，1)然后到(1，1)的垂直线，这意味着该模型可以100%区分正面和负面情况。然而，如果你随机选择每种情况，TPR和FPR应该以同样的速度增长。蓝色虚线显示了当您盲目猜测每种情况下的阳性或阴性时的TPR和FPR曲线，对于该对角线，曲线下面积(AUC)为0.5。</p><h2 id="56a6" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">如果我改变门槛，TPR、FPR和ROC曲线会发生什么变化？</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/765fb326bc25cdd263c2f7ffea4cfb0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ol7r2xlTopwL9P-uzuLaHg.png"/></div></div></figure><p id="0ab8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看ROC曲线上的两个点。绿点有一个非常高的阈值，这意味着只有当你有99%的把握时，你才能将这个案例归类为阳性。红点具有相对较低的阈值，这意味着如果你有90%的信心，你可以将该病例归类为阳性。</p><blockquote class="nd ne nf"><p id="480d" class="ky kz ng la b lb lc ju ld le lf jx lg nh li lj lk ni lm ln lo nj lq lr ls lt im bi translated">TPR和FPR从绿点到红点的变化是什么？</p></blockquote><p id="55b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">TPR和FPR都增加了。当您降低阈值时，可以识别更多的阳性病例，因此TP增加，TP/(TP+FN)也增加。另一方面，由于阈值的降低，你不可避免地会错误地将一些负面情况归类为正面情况，因此FP &amp; FP/(FP+TN)也会增加。</p><p id="b0c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">我们可以看到，TPR和FPR是正相关的，你必须在最大限度地捕捉正面案例和最小化负面案例的错误分类之间进行平衡。</strong></p><h2 id="495f" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">如何选择ROC曲线上的最优点？</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/1a1f02663bdb57dd7628a2ad7f5c2815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SkJlG8uLAgCcF8cdPg7J6Q.png"/></div></div></figure><p id="de16" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">很难定义最佳点，因为您应该为业务案例选择最合适的阈值。然而，<strong class="la iu">一般规则是最大化(TPR-FPR)，在图中用橙色和蓝色虚线</strong>之间的垂直距离表示。</p><p id="ec8d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从上面的图表中我们可以看到，在这三个点中，红点的TPR-FPR最大，应该被认为是最优点。从红点移到绿点，门槛变得更加严格。然而，大量的阳性病例没有从模型中捕获，错误分类病例的减少低于比例。从红点移动到蓝点，阈值变得更加宽松，并且增加了比正确识别的正点更多的错误分类的正点。</p><h2 id="a266" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">为什么ROC曲线下的面积是评估分类模型的良好指标？</h2><p id="1879" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">一个好的机器学习模型的度量应该显示模型的真实和一致的预测能力。这意味着如果我改变测试数据集，它不应该有非常不同的分数。</p><p id="f8e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> ROC曲线不仅考虑了分类结果，还考虑了所有类别的预测概率。</strong>例如，如果输出基于51%的概率被正确分类，那么如果使用另一个测试数据集，它很可能被错误分类。此外，ROC曲线还考虑了跨越不同阈值的表现，因此它是评估<strong class="la iu">不同组中的病例</strong>的分离程度的综合指标。</p><h2 id="1c57" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated"><strong class="ak">分类模型的可接受AUC分数是多少？</strong></h2><p id="a20f" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">正如我之前展示的，对于二元分类问题，如果你随机选择，你可以获得0.5 AUC。因此，如果你正在解决一个二元分类问题，<strong class="la iu">一个合理的ROC分数应该是&gt; 0.5 </strong>。一个好的分类模型通常具有AUC分数&gt; 0.9，但是它完全依赖于应用。</p><h2 id="2833" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">如何用Python计算AUC并绘制ROC曲线？</h2><blockquote class="nd ne nf"><p id="225a" class="ky kz ng la b lb lc ju ld le lf jx lg nh li lj lk ni lm ln lo nj lq lr ls lt im bi translated">如果只是想找AUC评分，可以参考sklearn度量包<a class="ae lu" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.roc_auc_score.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="dbe8" class="ky kz ng la b lb lc ju ld le lf jx lg nh li lj lk ni lm ln lo nj lq lr ls lt im bi translated">如果你想为你的模型结果绘制ROC曲线，你可以参考<a class="ae lu" href="https://scikit-learn.org/stable/auto_examples/model_selection/plot_roc.html" rel="noopener ugc nofollow" target="_blank">这里的</a></p></blockquote><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="8afa" class="lv lw it nn b gy nr ns l nt nu"># Calculate FPR, TPR and AUC<br/>from sklearn.metrics import roc_curve, auc<br/>fpr, tpr, treshold = roc_curve(y_test, y_score_new)<br/>roc_auc = auc(fpr, tpr)</span><span id="e00b" class="lv lw it nn b gy nv ns l nt nu">#Plot ROC curve<br/>plt.plot(fpr, tpr, color='darkorange',<br/>         label='ROC curve (area = %0.2f)' % roc_auc)<br/>plt.plot([0, 1], [0, 1], color='navy', linestyle='--')<br/>plt.xlim([0.0, 1.0])<br/>plt.ylim([0.0, 1.05])<br/>plt.xlabel('False Positive Rate')<br/>plt.ylabel('True Positive Rate')<br/>plt.title('Receiver operating characteristic example')<br/>plt.legend(loc="lower right")<br/>plt.show()</span></pre><p id="1f39" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是我在本文中使用的绘制ROC示例图的代码。你需要两个输入，y的真实值和预测概率。注意<strong class="la iu"> roc_curve函数只需要正例的概率，而不需要两类的概率</strong>。如果你有一个多类分类的问题，你也可以使用这个包，在上面的链接中有一个如何绘制的例子。</p><p id="6065" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您有兴趣了解评估分类模型的其他顶级指标，可以参考下面的链接:</p><div class="nw nx gp gr ny nz"><a href="https://medium.com/@songhaowu/top-5-metrics-for-evaluating-classification-model-83ede24c7584" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">评估分类模型的5大指标</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">与回归模型不同的是，当我们评估分类模型的结果时，我们不能只关注预测…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">medium.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on ks nz"/></div></div></a></div></div></div>    
</body>
</html>