<html>
<head>
<title>Classify any Object using pre-trained CNN Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用预先训练的CNN模型对任何对象进行分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/classify-any-object-using-pre-trained-cnn-model-77437d61e05f?source=collection_archive---------27-----------------------#2020-06-07">https://towardsdatascience.com/classify-any-object-using-pre-trained-cnn-model-77437d61e05f?source=collection_archive---------27-----------------------#2020-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="bd91" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">现实世界中的DS</h2><div class=""/><div class=""><h2 id="2343" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用预训练的Inception v3卷积神经网络模型的大规模图像分类</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/95d11068ead2cedb745dbe1545e65981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hPVHCGVgepguJt8I"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">列宁·艾斯特拉达在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f82f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">今天，我们有了超级有效的技术<strong class="lk jd">转移学习</strong>，我们可以使用由<strong class="lk jd">谷歌人工智能</strong>预先训练的模型来对计算机视觉世界中任何已分类视觉对象的图像进行分类。</p><p id="5aa8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">迁移学习是一种利用预训练神经网络的机器学习方法。这里，名为Inception-v3的<em class="me">图像识别</em>模型由两部分组成:</p><ul class=""><li id="83ac" class="mf mg it lk b ll lm lo lp lr mh lv mi lz mj md mk ml mm mn bi translated"><strong class="lk jd">特征提取</strong>部分采用卷积神经网络。</li><li id="d5ea" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md mk ml mm mn bi translated"><strong class="lk jd">分类</strong>具有全连接和softmax层的零件。</li></ul><blockquote class="mt mu mv"><p id="7e08" class="li lj me lk b ll lm kd ln lo lp kg lq mw ls lt lu mx lw lx ly my ma mb mc md im bi translated">Inception-v3是一个预训练的卷积神经网络模型，深度为48层。</p></blockquote><p id="724d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是一个已经在来自<a class="ae lh" href="http://www.image-net.org" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> ImageNet </strong> </a>数据库的100多万张图像上训练过的网络版本。这是谷歌的第三版Inception CNN模型，最初是在<strong class="lk jd"> ImageNet识别挑战</strong>期间发起的。</p><blockquote class="mt mu mv"><p id="7754" class="li lj me lk b ll lm kd ln lo lp kg lq mw ls lt lu mx lw lx ly my ma mb mc md im bi translated">这个预先训练好的网络可以将图像分为1000个对象类别，例如键盘、鼠标、铅笔和许多动物。因此，该网络已经学习了各种图像的丰富特征表示。网络的图像输入大小为299 x 299。该模型在第一部分从输入图像中提取一般特征，并在第二部分基于这些特征对它们进行分类。</p></blockquote><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mz"><img src="../Images/22278d43c9813a996edf3d6e4e99ad98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nJ6IoHRvG_MSVIfxfRy2Ug.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">《盗梦空间3版》示意图——谷歌人工智能</p></figure><p id="b4b4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> <em class="me"> Inception v3 </em> </strong>是一个广泛使用的图像识别模型，已被证明在ImageNet数据集上达到超过78.1%的准确率，在前5名结果中达到大约93.9%的准确率。该模型是过去几年多名研究人员提出的许多想法的结晶。它基于Szegedy等人的原始论文:“<a class="ae lh" href="https://arxiv.org/abs/1512.00567" rel="noopener ugc nofollow" target="_blank">重新思考计算机视觉的初始架构</a>”。艾尔。</p><p id="8791" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">更多关于初始架构的信息可以在这里找到。</p><blockquote class="na"><p id="d319" class="nb nc it bd nd ne nf ng nh ni nj md dk translated">在迁移学习中，当您构建一个新模型来对原始数据集进行分类时，您可以重复使用特征提取部分，并使用数据集重新训练分类部分。由于不需要训练特征提取部分(这是模型中最复杂的部分)，所以可以用更少的计算资源和训练时间来训练模型。</p></blockquote><p id="6ee8" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">在本文中，我们将仅仅使用Inception v3模型来预测一些图像，并获取相同图像的前5个预测类。我们开始吧。</p><p id="c198" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me">我们用的是Tensorflow v2.x </em></p><h1 id="e3b1" class="np nq it bd nr ns nt nu nv nw nx ny nz ki oa kj ob kl oc km od ko oe kp of og bi translated">输入数据</h1><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="f481" class="om nq it oi b gy on oo l op oq">import os<br/>import numpy as np<br/>from PIL import Image<br/>from imageio import imread<br/>import tensorflow.compat.v1 as tf<br/>tf.disable_v2_behavior()<br/>import tf_slim as slim<br/>from tf_slim.nets import inception<br/>import tf_slim as slim<br/>import cv2<br/>import matplotlib.pyplot as plt</span></pre><h1 id="5878" class="np nq it bd nr ns nt nu nv nw nx ny nz ki oa kj ob kl oc km od ko oe kp of og bi translated">数据加载</h1><p id="bd99" class="pw-post-body-paragraph li lj it lk b ll or kd ln lo os kg lq lr ot lt lu lv ou lx ly lz ov mb mc md im bi translated">用默认文件位置和各自的值设置所有初始变量。</p><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="1ac6" class="om nq it oi b gy on oo l op oq">ckpt_path = "/kaggle/input/inception_v3.ckpt"<br/>images_path = "/kaggle/input/animals/*"<br/>img_width = 299<br/>img_height = 299<br/>batch_size = 16<br/>batch_shape = [batch_size, img_height, img_width, 3]<br/>num_classes = 1001<br/>predict_output = []<br/>class_names_path = "/kaggle/input/imagenet_class_names.txt"<br/>with open(class_names_path) as f:<br/>    class_names = f.readlines()</span></pre><h1 id="45ac" class="np nq it bd nr ns nt nu nv nw nx ny nz ki oa kj ob kl oc km od ko oe kp of og bi translated">创建Inception v3模型</h1><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="4662" class="om nq it oi b gy on oo l op oq">X = tf.placeholder(tf.float32, shape=batch_shape)<br/><br/>with slim.arg_scope(inception.inception_v3_arg_scope()):<br/>    logits, end_points = inception.inception_v3(<br/>        X, num_classes=num_classes, is_training=False<br/>    )<br/><br/>predictions = end_points["Predictions"]<br/>saver = tf.train.Saver(slim.get_model_variables())</span></pre><p id="7bdb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">定义用于加载图像和调整大小的函数，以便以RGB模式发送到模型进行评估。</p><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="dc18" class="om nq it oi b gy on oo l op oq">def load_images(input_dir):<br/>    global batch_shape<br/>    images = np.zeros(batch_shape)<br/>    filenames = []<br/>    idx = 0<br/>    batch_size = batch_shape[0]<br/>    files = tf.gfile.Glob(input_dir)[:20]<br/>    files.sort()<br/>    for filepath <strong class="oi jd">in</strong> files:<br/>        with tf.gfile.Open(filepath, "rb") as f:<br/>            imgRaw = np.array(Image.fromarray(imread(f, as_gray=False, pilmode="RGB")).resize((299, 299))).astype(np.float) / 255.0<br/>        images[idx, :, :, :] = imgRaw * 2.0 - 1.0<br/>        filenames.append(os.path.basename(filepath))<br/>        idx += 1<br/>        if idx == batch_size:<br/>            yield filenames, images<br/>            filenames = []<br/>            images = np.zeros(batch_shape)<br/>            idx = 0<br/>    if idx &gt; 0:<br/>        yield filenames, images</span></pre><h1 id="59ea" class="np nq it bd nr ns nt nu nv nw nx ny nz ki oa kj ob kl oc km od ko oe kp of og bi translated">加载预训练模型</h1><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="1eb2" class="om nq it oi b gy on oo l op oq">session_creator = tf.train.ChiefSessionCreator(<br/>        scaffold=tf.train.Scaffold(saver=saver),<br/>        checkpoint_filename_with_path=ckpt_path,<br/>        master='')</span></pre><h1 id="7be2" class="np nq it bd nr ns nt nu nv nw nx ny nz ki oa kj ob kl oc km od ko oe kp of og bi translated">使用模型对图像进行分类</h1><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="f834" class="om nq it oi b gy on oo l op oq">with tf.train.MonitoredSession(session_creator=session_creator) as sess:<br/>    for filenames, images <strong class="oi jd">in</strong> load_images(images_path):<br/>        labels = sess.run(predictions, feed_dict={X: images})<br/>        for filename, label, image <strong class="oi jd">in</strong> zip(filenames, labels, images):<br/>            predict_output.append([filename, label, image])</span></pre><h1 id="388b" class="np nq it bd nr ns nt nu nv nw nx ny nz ki oa kj ob kl oc km od ko oe kp of og bi translated">预言</h1><p id="edcb" class="pw-post-body-paragraph li lj it lk b ll or kd ln lo os kg lq lr ot lt lu lv ou lx ly lz ov mb mc md im bi translated">我们将使用来自kaggle的<a class="ae lh" href="https://www.kaggle.com/alessiocorrado99/animals10" rel="noopener ugc nofollow" target="_blank">动物-10 </a>数据集的一些图像来声明模型预测。</p><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="7d8c" class="om nq it oi b gy on oo l op oq">for x <strong class="oi jd">in</strong> predict_output:<br/>    out_list = list(x[1])<br/>    topPredict = sorted(range(len(out_list)), key=lambda i: out_list[i], reverse=True)[:5]<br/>    plt.imshow((((x[2]+1)/2)*255).astype(int))<br/>    plt.show()<br/>    print("Filename:",x[0])<br/>    print("Displaying the top 5 Predictions for above image:")<br/>    for p <strong class="oi jd">in</strong> topPredict:<br/>        print(class_names[p-1].strip())</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ow"><img src="../Images/0c18a2d7cf3df862ac909657dde3a42c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJG-aEHJo8mfHNngrGASSw.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ox"><img src="../Images/2cd254d164b583b3e461055307ac99cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qdw4-rGAyPbBI3dwQswvvg.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oy"><img src="../Images/7e845d17985ea7c3b195fed5f412c460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_nw0jzhFN7sjB8BbFzpmRg.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oz"><img src="../Images/70978ee23db292d04edcdd7cb0614b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FKO8wrDcUE_H2hlMzq2CPA.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pa"><img src="../Images/8db6411f9d449c46160de6f596ae8e46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fik-gIv8cMwpyCXww3mPhw.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ox"><img src="../Images/cfc5d58fe16dbd6bbe53cc075f8ecbee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jvaX4wEUAQvUE8O5iMzPzQ.png"/></div></div></figure><p id="46dd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，所有的类都被准确地分类了，我们还可以看到模型预测的前5个相似的类都非常好和精确。</p></div><div class="ab cl pb pc hx pd" role="separator"><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt pi"><a rel="noopener follow" target="_blank" href="/insightful-loan-default-analysis-in-lending-credit-risk-model-b16bbfc94a2f"><div class="pj ab fo"><div class="pk ab pl cl cj pm"><h2 class="bd jd gy z fp pn fr fs po fu fw jc bi translated">贷款信用风险模型中的贷款违约分析</h2><div class="pp l"><h3 class="bd b gy z fp pn fr fs po fu fw dk translated">探索和分析贷款违约背后的驱动因素，即，使贷款审批流程风险…</h3></div><div class="pq l"><p class="bd b dl z fp pn fr fs po fu fw dk translated">towardsdatascience.com</p></div></div><div class="pr l"><div class="ps l pt pu pv pr pw lb pi"/></div></div></a></div></div></div>    
</body>
</html>