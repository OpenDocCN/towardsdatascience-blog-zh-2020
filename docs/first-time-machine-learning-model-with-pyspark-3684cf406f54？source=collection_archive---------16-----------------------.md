# ç”¨ PySpark æ„å»ºæœºå™¨å­¦ä¹ æ¨¡å‹

> åŸæ–‡ï¼š<https://towardsdatascience.com/first-time-machine-learning-model-with-pyspark-3684cf406f54?source=collection_archive---------16----------------------->

## åˆå­¦è€…çš„å¾ªåºæ¸è¿›æŒ‡å—

![](img/56a6538452e343b39115cc471deabc9e.png)

è‡ªå·±è®¾è®¡

Spark æ˜¯å®ç°é›†ç¾¤è®¡ç®—çš„å¼•æ“åï¼Œè€Œ PySpark æ˜¯ Python ä½¿ç”¨ Spark çš„åº“ã€‚

PySpark æ˜¯ä¸€ç§å¾ˆå¥½çš„è¯­è¨€ï¼Œå¯ä»¥è¿›è¡Œå¤§è§„æ¨¡çš„æ¢ç´¢æ€§æ•°æ®åˆ†æï¼Œæ„å»ºæœºå™¨å­¦ä¹ ç®¡é“ï¼Œä¸ºæ•°æ®å¹³å°åˆ›å»º ETLã€‚å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰ Python å’Œ Pandas ä¹‹ç±»çš„åº“ï¼Œé‚£ä¹ˆä¸ºäº†åˆ›å»ºæ›´å…·å¯ä¼¸ç¼©æ€§çš„åˆ†æå’Œç®¡é“ï¼ŒPySpark æ˜¯ä¸€ç§å¾ˆå¥½çš„å­¦ä¹ è¯­è¨€ã€‚

è¿™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯å±•ç¤ºå¦‚ä½•ä½¿ç”¨ PySpark æ„å»ºä¸€ä¸ª ml æ¨¡å‹ã€‚

# **å¦‚ä½•å®‰è£… PySpark**

PySpark çš„å®‰è£…è¿‡ç¨‹éå¸¸ç®€å•ï¼Œå°±åƒå…¶ä»– python åŒ…ä¸€æ ·ã€‚(ä¾‹å¦‚ç†ŠçŒ«ã€Numpyã€scikit-learn)ã€‚

![](img/6593572a12b5e0cc80f14128d72ac86e.png)

å›¾ 01

ä¸€ä»¶é‡è¦çš„äº‹æƒ…æ˜¯é¦–å…ˆç¡®ä¿ java å·²ç»å®‰è£…ï¼Œä»¥ç¡®ä¿ java å·²ç»å®‰è£…åœ¨æ‚¨çš„æœºå™¨ä¸Šã€‚ç„¶åä½ å°±å¯ä»¥åœ¨ jupyter ç¬”è®°æœ¬ä¸Šè¿è¡Œ PySpark äº†ã€‚

![](img/d1db8dcc6ff67071af885ac7659eeb3d.png)

Jupyter ç¬”è®°æœ¬ä¸­çš„ PySpark æ£€æŸ¥

# æ¢ç´¢æ•°æ®

å½“æˆ‘ä»¬[åœ¨ Python](https://hackernoon.com/ml-for-diabetes-from-bangladesh-d99d1d058d82) ä¸­å»ºç«‹ ml æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç›¸åŒçš„æ•°æ®é›†ï¼Œå¹¶ä¸”å®ƒä¸ä¸€ä¸ªå›½å®¶ç³–å°¿ç—…å’Œæ¶ˆåŒ–å’Œè‚¾è„ç–¾ç—…ç ”ç©¶æ‰€çš„ç³–å°¿ç—…ç–¾ç—…ç›¸å…³ã€‚åˆ†ç±»ç›®æ ‡æ˜¯é¢„æµ‹æ‚£è€…æ˜¯å¦æ‚£æœ‰ç³–å°¿ç—…(æ˜¯/å¦)ã€‚æ•°æ®é›†å¯ä»¥ä» [Kaggle](https://www.kaggle.com/uciml/pima-indians-diabetes-database) ä¸‹è½½ã€‚

è¯»å– _ æ•°æ®. py

![](img/32f87e889d3f1761dcb6e47a9215a679.png)

å›¾ 02

æ•°æ®é›†åŒ…æ‹¬å‡ ä¸ªåŒ»å­¦é¢„æµ‹å˜é‡å’Œä¸€ä¸ªç›®æ ‡å˜é‡ï¼Œç»“æœã€‚é¢„æµ‹å˜é‡åŒ…æ‹¬æ‚£è€…çš„æ€€å­•æ¬¡æ•°ã€èº«ä½“è´¨é‡æŒ‡æ•°ã€èƒ°å²›ç´ æ°´å¹³ã€å¹´é¾„ç­‰ã€‚

*   è¾“å…¥å˜é‡:è‘¡è„ç³–ï¼Œè¡€å‹ï¼Œèº«ä½“è´¨é‡æŒ‡æ•°ï¼Œå¹´é¾„ï¼Œæ€€å­•ï¼Œèƒ°å²›ç´ ï¼Œçš®è‚¤åšåº¦ï¼Œç³–å°¿ç—…ï¼Œç³–å°¿ç—…åŠŸèƒ½ã€‚
*   äº§å‡ºå˜é‡:ç»“æœã€‚

å…ˆçœ‹ä¸€ä¸‹å‰äº”ä¸ªè§‚å¯Ÿç»“æœã€‚ç†ŠçŒ«æ•°æ®æ¡†æ¯” Spark DataFrame.show()å¥½çœ‹ã€‚

æ˜¾ç¤º _ æ•°æ®. py

![](img/e431c59d2f387d08c120b529680fd812.png)

å›¾ 03

åœ¨ PySpark ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`toPandas()`ç”¨ç†ŠçŒ«çš„æ•°æ®å¸§æ˜¾ç¤ºæ•°æ®

data _ show _ in _ pandas _ data frame . py

![](img/d215df167c6b2693bf7a67b6c10d622b.png)

å›¾ 04

æ£€æŸ¥ç­çº§æ˜¯å¦å®Œå…¨å¹³è¡¡ï¼ï¼

class_balance_check.py

![](img/f1a9f30dce66f7398ed8de9a8e75ded7.png)

å›¾ 05

# ç»Ÿè®¡æ‘˜è¦

ç»Ÿè®¡ _ æ±‡æ€». py

![](img/1a9ad90eae0356637e3186d2a7a8a018.png)

å›¾ 06

**è‡ªå˜é‡ä¹‹é—´çš„ç›¸å…³æ€§**

ç›¸å…³æ€§. py

![](img/401286abb31c7668041a50083c65bad1.png)

å›¾ 07

# **æ•°æ®å‡†å¤‡å’Œç‰¹å¾å·¥ç¨‹**

åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†åˆ é™¤ä¸å¿…è¦çš„åˆ—å¹¶å¡«å……ç¼ºå¤±çš„å€¼ã€‚æœ€åï¼Œæˆ‘ä»¬å°†ä¸º ml æ¨¡å‹é€‰æ‹©ç‰¹æ€§ã€‚è¿™äº›åŠŸèƒ½å°†åˆ†ä¸ºä¸¤éƒ¨åˆ†:è®­ç»ƒå’Œæµ‹è¯•ã€‚

è®©æˆ‘ä»¬å¼€å§‹ä»»åŠ¡å§ğŸ‘¨â€ğŸš€

1.  **ç¼ºå¤±æ•°æ®å¤„ç†:**

missing_data_handling.py

![](img/ebc49aaf80f29e998d3a51e757927de7.png)

å›¾ 08

å“‡ï¼ï¼ğŸ‘Œè¿™å¾ˆå¥½ï¼Œå› ä¸ºæ•°æ®é›†ä¸­æ²¡æœ‰ä»»ä½•ç¼ºå¤±å€¼ã€‚ğŸ˜€

**2ã€‚åˆ é™¤ä¸å¿…è¦çš„åˆ—**

columns_dropping.py

![](img/b5769cd2083038031279d741663a4953.png)

å›¾ 09

**3ã€‚ç‰¹å¾è½¬æ¢æˆçŸ¢é‡**

VectorAssembler å°†å¤šä¸ªåˆ—åˆå¹¶ä¸ºä¸€ä¸ªå‘é‡åˆ—çš„è¦ç´ è½¬æ¢å™¨ã€‚

è½¬æ¢æˆçŸ¢é‡æ ¼å¼

![](img/d734423a48757b4199103a91206967b6.png)

å›¾ 10

æå®šäº†ã€‚ï¼âœŒï¸ç°åœ¨çš„ç‰¹å¾è¢«è½¬æ¢æˆäº†çŸ¢é‡ã€‚ğŸ§®

**4ã€‚è®­ç»ƒå’Œæµ‹è¯•åˆ†å‰²**

å°†æ•°æ®éšæœºåˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå¹¶ä¸ºå¯é‡å¤æ€§è®¾ç½®ç§å­ã€‚

è®­ç»ƒ _ æµ‹è¯• _ æ‹†åˆ†. py

***è®­ç»ƒæ•°æ®é›†è®¡æ•°:620***

***æµ‹è¯•æ•°æ®é›†è®¡æ•°:148***

# **æœºå™¨å­¦ä¹ æ¨¡å‹æ„å»º**

1.  **éšæœºæ£®æ—åˆ†ç±»å™¨**

éšæœºæ£®æ—æ˜¯ä¸€ç§ç›‘ç£å­¦ä¹ ç®—æ³•ï¼Œä¹Ÿç”¨äºåˆ†ç±»å’Œå›å½’æƒ…å†µã€‚ä½†æ˜¯ï¼Œå®ƒä¸»è¦ç”¨äºåˆ†ç±»é—®é¢˜ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œæ£®æ—æ˜¯ç”±æ ‘æœ¨ç»„æˆçš„ï¼Œæ›´å¤šçš„æ ‘æœ¨æ„å‘³ç€æ›´å¥å£®çš„æ£®æ—ï¼Œä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œéšæœºæ£®æ—ç®—æ³•åœ¨æ•°æ®æ ·æœ¬ä¸Šåˆ›å»ºå†³ç­–æ ‘ï¼Œç„¶åä»æ¯ä¸ªæ ·æœ¬ä¸­è·å¾—é¢„æµ‹ï¼Œæœ€åé€šè¿‡æŠ•ç¥¨é€‰æ‹©æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚è¿™æ˜¯ä¸€ç§æ¯”å•ä¸€å†³ç­–æ ‘æ›´å¥½çš„é›†æˆæ–¹æ³•ï¼Œå› ä¸ºå®ƒé€šè¿‡å¹³å‡ç»“æœæ¥å‡å°‘è¿‡æ‹Ÿåˆã€‚

random_forest.py

**è¯„ä¼°æˆ‘ä»¬çš„éšæœºæ£®æ—åˆ†ç±»å™¨æ¨¡å‹ã€‚**

random_forest_evaluate.py

***éšæœºæ£®æ—åˆ†ç±»å™¨å‡†ç¡®ç‡:0.7945205479452054(79.5%)***

2.**å†³ç­–æ ‘åˆ†ç±»å™¨**

å†³ç­–æ ‘è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬æ˜“äºè§£é‡Šã€å¤„ç†åˆ†ç±»ç‰¹å¾ã€æ‰©å±•åˆ°å¤šç±»åˆ†ç±»è®¾ç½®ï¼ŒåŒæ—¶ä¸éœ€è¦ç‰¹å¾ç¼©æ”¾ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ•æ‰éçº¿æ€§å’Œç‰¹å¾äº¤äº’ã€‚

å†³ç­–æ ‘. py

![](img/e42b7a155e64f03de3bb84a1eb0ca1fd.png)

å›¾ 11

è¯„ä¼°æˆ‘ä»¬çš„å†³ç­–æ ‘æ¨¡å‹ã€‚

å†³ç­–æ ‘è¯„ä¼°

***å†³ç­–æ ‘å‡†ç¡®ç‡:0.7876712328767124(78.8%)***

3.**é€»è¾‘å›å½’æ¨¡å‹**

å½“å› å˜é‡ä¸ºäºŒåˆ†å˜é‡(äºŒå…ƒå˜é‡)æ—¶ï¼Œé€»è¾‘å›å½’æ˜¯è¿›è¡Œå›å½’åˆ†æçš„åˆé€‚æ–¹æ³•ã€‚åƒæ‰€æœ‰å›å½’åˆ†æä¸€æ ·ï¼Œé€»è¾‘å›å½’æ˜¯ä¸€ç§é¢„æµ‹åˆ†æã€‚é€»è¾‘å›å½’ç”¨äºæè¿°æ•°æ®ï¼Œå¹¶è§£é‡Šä¸€ä¸ªå› å˜é‡ä¸ä¸€ä¸ªæˆ–å¤šä¸ªåä¹‰å˜é‡ã€åºæ•°å˜é‡ã€åŒºé—´å˜é‡æˆ–æ¯”ç‡æ°´å¹³è‡ªå˜é‡ä¹‹é—´çš„å…³ç³»ã€‚å½“å› å˜é‡(ç›®æ ‡)æ˜¯åˆ†ç±»å˜é‡æ—¶ï¼Œä½¿ç”¨é€»è¾‘å›å½’ã€‚

logistic _ å›å½’. py

è¯„ä¼°æˆ‘ä»¬çš„é€»è¾‘å›å½’æ¨¡å‹ã€‚

logistic _ regression _ evaluator . py

***é€»è¾‘å›å½’å‡†ç¡®ç‡:0.7876712328767124(79.7%)***

4.**æ¢¯åº¦å¢å¼ºæ ‘åˆ†ç±»å™¨æ¨¡å‹**

æ¢¯åº¦æ¨è¿›æ˜¯ä¸€ç§ç”¨äºå›å½’å’Œåˆ†ç±»é—®é¢˜çš„æœºå™¨å­¦ä¹ æŠ€æœ¯ï¼Œå®ƒä»¥å¼±é¢„æµ‹æ¨¡å‹(é€šå¸¸æ˜¯å†³ç­–æ ‘)çš„é›†åˆçš„å½¢å¼äº§ç”Ÿé¢„æµ‹æ¨¡å‹ã€‚

g_boosted_tree.py

è¯„ä¼°æˆ‘ä»¬çš„æ¢¯åº¦å¢å¼ºæ ‘åˆ†ç±»å™¨ã€‚

g _ boosted _ evaluator . py

***æ¸å˜æ ‘å‡†ç¡®ç‡:0.8013698630136986(80.13%)***

# ç»“è®º

PySpark æ˜¯æ•°æ®ç§‘å­¦å®¶å­¦ä¹ çš„ä¸€é—¨å¥½è¯­è¨€ï¼Œå› ä¸ºå®ƒæ”¯æŒå¯æ‰©å±•çš„åˆ†æå’Œ ML ç®¡é“ã€‚å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰ Python å’Œ Pandasï¼Œé‚£ä¹ˆæ‚¨çš„è®¸å¤šçŸ¥è¯†éƒ½å¯ä»¥åº”ç”¨äº Sparkã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨ PySpark æ„å»ºä¸€ä¸ªæœºå™¨å­¦ä¹ åº”ç”¨ã€‚æˆ‘ä»¬å°è¯•äº†ä¸‰ç§ç®—æ³•ï¼Œæ¢¯åº¦æå‡åœ¨æˆ‘ä»¬çš„æ•°æ®é›†ä¸Šè¡¨ç°æœ€å¥½ã€‚

æˆ‘ä» [Favio VÃ¡zquez](https://medium.com/u/e8ec6fa4d7d4?source=post_page-----3684cf406f54--------------------------------) çš„ Github èµ„æºåº“' [first_spark_model](https://github.com/FavioVazquez/first_spark_model) ä¸­è·å¾—äº†çµæ„Ÿã€‚

æºä»£ç å¯ä»¥åœ¨ [Github](https://github.com/harunshimanto/Machine-learning-with-PySpark/tree/master/First%20PySpark%20ml%20model) ä¸Šæ‰¾åˆ°ã€‚æˆ‘æœŸå¾…å¬åˆ°åé¦ˆæˆ–é—®é¢˜ã€‚

> *å½“ PySpark åƒå¯¹é€Ÿåº¦æ¸¸æˆè½¦çš„éœ€æ±‚ä¸€æ ·ç»™å‡ºåŠ é€Ÿå™¨æ¡£ä½æ—¶ï¼Œæœºå™¨å­¦ä¹ æ¨¡å‹é—ªé—ªå‘å…‰ã€‚*

å‚è€ƒèµ„æ–™:

1.  Guru99ï¼Œ [PySpark åˆå­¦è€…æ•™ç¨‹:æœºå™¨å­¦ä¹ ç¤ºä¾‹](https://www.guru99.com/pyspark-tutorial.html#8)

2.[é˜¿å¸•å¥‡ Spark 3.0.0](https://spark.apache.org/docs/latest/ml-classification-regression.html)

3.Susan Liï¼Œ[ä½¿ç”¨ PySpark å’Œ MLlib çš„æœºå™¨å­¦ä¹ â€”è§£å†³ä¸€ä¸ªäºŒå…ƒåˆ†ç±»é—®é¢˜](/machine-learning-with-pyspark-and-mllib-solving-a-binary-classification-problem-96396065d2aa)