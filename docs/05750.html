<html>
<head>
<title>Optimising Javascript Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优化 Javascript 代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/optimising-javascript-code-bb7de4bb14d5?source=collection_archive---------68-----------------------#2020-05-12">https://towardsdatascience.com/optimising-javascript-code-bb7de4bb14d5?source=collection_archive---------68-----------------------#2020-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9223" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有些 web 应用程序需要一段时间才能加载，这种情况并不少见。这可能是因为计算量过大或文件过大。这篇文章着眼于代码优化的两种主要方法，以及如何在谷歌的闭包编译器的帮助下完成这些。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/002177af37ef77aa3888acf32300e59f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gg5xDjVVOLFiLip0"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae ki" href="https://unsplash.com/@tirzavandijk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">蒂尔扎·范·迪克</a>在<a class="ae ki" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="7f61" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">状态</h1><p id="de34" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在 web 应用程序中，javascript 通常有两个可以克服的瓶颈——小型化和代码优化。</p><h2 id="b3e7" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">缩小</h2><p id="e630" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在处理网站时，文件大小对应用程序的性能起着至关重要的作用。这是因为任何代码首先需要下载，然后运行。缩小的行为去除了源代码中任何多余的字符，从而产生一个更紧凑的(尽管可读性通常更差)文件。这方面的一个例子如下:</p><pre class="kk kl km kn gt mz na nb nc aw nd bi"><span id="b08d" class="mn la it na b gy ne nf l ng nh">var array = [];</span><span id="b3eb" class="mn la it na b gy ni nf l ng nh">for (var i = 0; i &lt; 20; i++) {</span><span id="ac69" class="mn la it na b gy ni nf l ng nh">var j = Math.random()*i/100<br/>  array.push(j)</span><span id="6321" class="mn la it na b gy ni nf l ng nh">}</span></pre><p id="4d5c" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">用<a class="ae ki" href="https://jscompress.com" rel="noopener ugc nofollow" target="_blank">https://jscompress.com</a>(它使用<a class="ae ki" href="https://github.com/mishoo/UglifyJS2" rel="noopener ugc nofollow" target="_blank">丑化 JS 3 </a>和<a class="ae ki" href="https://github.com/babel/minify" rel="noopener ugc nofollow" target="_blank">巴别塔缩小</a>)缩小它，我们得到 32%的压缩，节省了 0.03 kb 和以下更紧凑的代码:</p><pre class="kk kl km kn gt mz na nb nc aw nd bi"><span id="0152" class="mn la it na b gy ne nf l ng nh">for(var j,array=[],i=0;20&gt;i;i++)j=Math.random()*i/100,array.push(j);</span></pre><p id="2e26" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">缩小器的工作原理是从代码中删除不必要的字符和空白，但除此之外一般不会改变太多内容。</p><h2 id="e0bb" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">自我语言翻译</h2><p id="c9eb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在编译语言中，优化通常处理复杂循环的展开、缓存阻塞或选择正确的列/行顺序来索引矩阵等过程。然而，这种技术计算方式不一定是 JS 工作流程的一部分。</p><p id="8dd3" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">相反，我们希望简化复杂的方程(例如 python<code class="fe no np nq na b">sympy</code>符号引擎可以帮助将一个方程重写为一个计算强度较低的方程)，或者我们可以将长变量重命名为较短的变量，以帮助简化过程。</p><p id="7ee1" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">这就是 google closure 编译器发挥作用的地方。</p><h1 id="8f7a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Google 闭包编译器</h1><p id="4b4d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是一个 javascript 编译器，它以一种紧凑和更有效的方式重写和精简现有代码。与传统编译不同，闭包编译器不会将 javascript 转换成机器代码，而是转换成更好的版本。</p><h2 id="6262" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">装置</h2><p id="ccea" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">它的安装很简单，可以通过 node.js 完成。</p><pre class="kk kl km kn gt mz na nb nc aw nd bi"><span id="e5c2" class="mn la it na b gy ne nf l ng nh">npm i google-closure-compiler</span></pre><h2 id="caba" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">运转</h2><p id="5b76" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">同样，它的运行也相当直观。Javascript 文件带有<code class="fe no np nq na b">--js</code>标志(在本例中，我使用了<code class="fe no np nq na b">*</code>通配符来选择所有的<code class="fe no np nq na b">.js</code>文件)，这些文件被处理成一个单独的输出文件(<code class="fe no np nq na b">compiled.js)</code>，可以在它们的位置导入。</p><pre class="kk kl km kn gt mz na nb nc aw nd bi"><span id="6042" class="mn la it na b gy ne nf l ng nh">npx google-closure-compiler --js=*.js --js_output_file=compiled.js<!-- --> </span></pre><p id="d235" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated"><em class="nr">注意:如果文件顺序是必需的，那么你可以通过使用多个</em> <code class="fe no np nq na b"><em class="nr">--js=</em></code> <em class="nr">标志顺序加载所有文件来解决这个问题。</em></p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h2 id="8a3a" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">那么闭包编译器做什么呢？</h2><p id="d558" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如你所期待的，谷歌提供了许多工具和技巧来改进代码。最简单的方法是查看长变量名并将其缩短:</p><pre class="kk kl km kn gt mz na nb nc aw nd bi"><span id="1c27" class="mn la it na b gy ne nf l ng nh">function hello(longName) {<br/>  alert('Hello, ' + longName);<br/>}<br/>hello('New User');</span></pre><p id="16f7" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">已更改为:</p><pre class="kk kl km kn gt mz na nb nc aw nd bi"><span id="53f4" class="mn la it na b gy ne nf l ng nh">function hello(a){alert("Hello, "+a)}hello("New User");</span></pre></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="b46f" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated"><strong class="lt iu">更高级的选项</strong>可以进一步简化代码，它解析代码以删除死的(未使用的)函数并检查语法。在<a class="ae ki" href="http://developers.google.com/closure/compiler/docs/" rel="noopener ugc nofollow" target="_blank">文档</a>中给出了一个例子，其中下列功能:</p><pre class="kk kl km kn gt mz na nb nc aw nd bi"><span id="0b63" class="mn la it na b gy ne nf l ng nh">function unusedFunction(note) {<br/>  alert(note['text']);<br/>}<br/><br/>function displayNoteTitle(note) {<br/>  alert(note['title']);<br/>}<br/><br/>var flowerNote = {};<br/>flowerNote['title'] = "Flowers";<br/>displayNoteTitle(flowerNote);</span></pre><p id="3418" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">简化为:</p><pre class="kk kl km kn gt mz na nb nc aw nd bi"><span id="badc" class="mn la it na b gy ne nf l ng nh">function unusedFunction(a){alert(a.text)}function displayNoteTitle(a){alert(a.title)}var flowerNote={};flowerNote.title="Flowers";displayNoteTitle(flowerNote);</span></pre><p id="bc13" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">然后简化为:</p><pre class="kk kl km kn gt mz na nb nc aw nd bi"><span id="1bc3" class="mn la it na b gy ne nf l ng nh">var a={};a.title="Flowers";alert(a.title);</span></pre></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="9f36" class="kz la it bd lb lc nz le lf lg oa li lj jz ob ka ll kc oc kd ln kf od kg lp lq bi translated">结论</h1><p id="fed8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Googles 的 closure compiler 不仅缩减了 javascript 代码，还降低了它的复杂性。静态方程如<code class="fe no np nq na b">var x = 17 + 2 </code>被重写(<code class="fe no np nq na b">var x=42</code>)以避免不必要的运行时计算，ECMAScript 6 代码可以被转换成 ECMAScript 3——这样它就可以在旧的浏览器上运行。“编译器”使用简单，大大减少了浏览器需要做的工作。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h2 id="68df" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">有用的链接</h2><ul class=""><li id="b1b5" class="oe of it lt b lu lv lx ly ma og me oh mi oi mm oj ok ol om bi translated"><a class="ae ki" href="https://github.com/google/closure-compiler" rel="noopener ugc nofollow" target="_blank">https://github.com/google/closure-compiler</a></li><li id="9761" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated"><a class="ae ki" href="https://developers.google.com/closure/compiler/" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/closure/compiler/</a></li><li id="cef9" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated"><a class="ae ki" href="https://www.npmjs.com/package/google-closure-compiler" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/google-closure-compiler</a></li></ul></div></div>    
</body>
</html>