<html>
<head>
<title>Exploring Bayesian A/B Test Measurement as an Alternative to P Values</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索贝叶斯A/B测试测量作为P值的替代</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/embracing-bayesian-a-b-test-measurement-and-ditching-p-values-9e444df379ca?source=collection_archive---------21-----------------------#2020-04-07">https://towardsdatascience.com/embracing-bayesian-a-b-test-measurement-and-ditching-p-values-9e444df379ca?source=collection_archive---------21-----------------------#2020-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8577" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用Rstan将贝叶斯推理应用于A/B测试</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/47b78eb1efd3ddd5a790bcdf27c1df0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cpJsRtB3h8HKj6J_Zd_NdQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">威廉·艾文在<a class="ae kv" href="https://unsplash.com/s/photos/measurement?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="367f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">(这是关于A/B测试的两部分系列的第二部分。第1部分介绍了在设计新测试时权衡所有选项的过程，可以在这里找到</em><a class="ae kv" rel="noopener" target="_blank" href="/streamlining-design-and-maximizing-success-for-agile-test-and-learn-443156d9b2f1"><em class="ls"/></a><em class="ls">。这篇文章选取了测试测量阶段的例子，展示了在R.) </em>中使用贝叶斯分析的方法</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="43d8" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">测量值几百万</h1><p id="a89f" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">如果你像我一样，你的收件箱每天都被电子邮件淹没。许多是与工作有关的，一些是来自朋友和家人的(包括来自奶奶的不健康的转发)，很多(可能太多了)是来自竞争你业务的公司的营销电子邮件。</p><p id="2ac2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它们可能看起来很讨厌，但是说实话，每隔一段时间，我们的兴趣就会被激起，我们就会打开一个。有时我们甚至会去公司的网站买些东西。这个神奇的时刻被公司捕捉到，并算作一次<em class="ls">转化</em>，我们花的钱<em class="ls">归于</em>邮件活动。</p><p id="f06a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转换率因行业和内容类型而异，但通常相当低，不到5%。这可能看起来不多，但是如果你给一个完整的订阅者列表发送一封电子邮件，即使1%的转换率也能产生可观的投资回报。假设你是一家在线零售商，你向去年购买男装的100万名顾客发送了一封电子邮件。如果他们中只有1%的人平均花费50美元进行转化，你就把500，000美元的收入归因于一个电子邮件活动！</p><h1 id="ab51" class="ma mb iq bd mc md mx mf mg mh my mj mk jw mz jx mm jz na ka mo kc nb kd mq mr bi translated">为什么是贝叶斯？</h1><p id="3580" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">作为《走向数据科学》的读者，你可能熟悉贝叶斯分析的概念。贝叶斯定理旨在利用一个事件的信息来理解另一个事件。不严格地说，拥抱贝叶斯就是拥抱概率。应用贝叶斯推理进行A/B测试测量意味着我们将确定A与B不同的<em class="ls">概率</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/ae7d112a8da92baf7c93dbde7fac5bfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MMDR97n09RxKbfXoeWw5Yg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:<a class="ae kv" rel="noopener" target="_blank" href="/intro-to-bayesian-statistics-5056b43d248d"> Pranav Prathvikumar </a></p></figure><p id="f86c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一段时间以来，统计学习的频率主义者和贝叶斯方法之间一直存在争论(有时激烈，通常是务实的)。剧透:在一天结束时，<strong class="ky ir">你的数据有一个故事要告诉</strong>，你可以通过几种不同的方式得出相同的结论。本文关注贝叶斯方法，强调与频率主义方法相比的一些不同之处。最终，我发现贝叶斯推理的某些方面在实践中很有价值。也就是说，贝叶斯推理提供了:</p><ol class=""><li id="cdf4" class="nd ne iq ky b kz la lc ld lf nf lj ng ln nh lr ni nj nk nl bi translated">变异不同的<strong class="ky ir">概率</strong>，使得对结果的解释更容易理解</li><li id="2973" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">量化变量间差异的<strong class="ky ir">大小的便捷方法</strong></li><li id="b3ec" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">一种计算每个变量的<strong class="ky ir">总期望值</strong>并可视化方差的直观方法</li></ol><p id="3b1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将使用传统的频率主义方法和贝叶斯方法来衡量A/B测试结果，并以A对B的预期收入差异结束。<strong class="ky ir"> <em class="ls">我们将展示这两种方法会导致类似的结果，并阐述贝叶斯技术的细微差别以及由此产生的解释</em> </strong>。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="da5b" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">设置</h1><p id="afeb" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">让我们来布置舞台。我们的业务合作伙伴设计并执行了一项新的电子邮件营销活动，测试两种不同类型的电子邮件内容，重点是男士西装。在4000名测试客户中，2000名客户收到了一封电子邮件，宣传一个崭露头角的设计师的新系列礼服衬衫，而另外2000名客户收到了一封电子邮件，宣传一个内部品牌的类似系列礼服衬衫。我们将后起之秀的设计师邮件<strong class="ky ir">称为设计师</strong>，内部邮件<strong class="ky ir">称为内部</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/694d8474b4694c91e1f25c8ecf5f2538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WL3_DBhuC_9b-Xkvj-fxBA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">测试结果:转换和花费汇总</p></figure><p id="9cc5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">邮件发出已经7天了，我们有了结果。88名收到设计师内容的客户进行了购买，平均花费168.34美元，而72名收到内部内容的客户进行了购买，平均花费152.88美元(我们收到了3名客户的回复)。</p><p id="4b4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">设计师看起来是明显的赢家，对吗？也许是这样，但作为优秀的数据科学家，我们必须确保这种差异在统计上是显著的，而不仅仅是我们数据中随机性的结果。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="e509" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">频繁主义方法</h1><p id="7c2f" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">我们将从传统的测量方法开始。这可以通过比较两个样本的均值和方差的t检验来完成，或者通过拟合回归模型和调查独立变量系数来完成。我在这里使用回归方法，因为我喜欢灵活地添加额外的变量来控制(例如，发送电子邮件的日期、客户位置等)，这有助于与贝叶斯方法进行更好的比较，贝叶斯方法也使用回归。</p><p id="b387" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们首先单独研究转换率，将一个逻辑回归模型与我们的数据进行拟合，以观察组(我们的预测值)是否与转换率(我们的结果)有统计学上的显著关系。我们的无效假设是分组和转换之间没有关系，我们将使用0.05的标准P值阈值来确认或拒绝该假设。</p><blockquote class="ns nt nu"><p id="adc6" class="kw kx ls ky b kz la jr lb lc ld ju le nv lg lh li nw lk ll lm nx lo lp lq lr ij bi translated">P &gt;= 0.05 →无法拒绝null(我们无法推断转换和组之间的关系)</p><p id="fb5b" class="kw kx ls ky b kz la jr lb lc ld ju le nv lg lh li nw lk ll lm nx lo lp lq lr ij bi translated">P &lt; 0.05 → Reject the null (we conclude a relationship does exist between Group and Conversion)</p></blockquote><p id="faaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">First, we fit a logistic regression on the data to model conversion rates.</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="1531" class="od mb iq nz b gy oe of l og oh">Call:<br/>glm(formula = conversion ~ group, family = binomial(), data = combined)</span><span id="9f61" class="od mb iq nz b gy oi of l og oh">Deviance Residuals: <br/>    Min       1Q   Median       3Q      Max  <br/>-0.3001  -0.3001  -0.2709  -0.2709   2.5781</span><span id="e603" class="od mb iq nz b gy oi of l og oh">Coefficients:<br/>              Estimate Std. Error z value Pr(&gt;|z|)    <br/>(Intercept)    -3.0780     0.1090 -28.232   &lt;2e-16 ***<br/>groupIn-House  -0.2085     0.1622  -1.286    0.199    <br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><span id="0582" class="od mb iq nz b gy oi of l og oh">(Dispersion parameter for binomial family taken to be 1)</span><span id="4f89" class="od mb iq nz b gy oi of l og oh">Null deviance: 1343.3  on 3996  degrees of freedom<br/>Residual deviance: 1341.6  on 3995  degrees of freedom<br/>AIC: 1345.6</span><span id="bd8b" class="od mb iq nz b gy oi of l og oh">Number of Fisher Scoring iterations: 6</span></pre><p id="2138" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">注意，预测值是“</em> <strong class="ky ir"> <em class="ls">集团内部</em> </strong> <em class="ls">”，这只是意味着回归将我们的二元预测值(集团)变成了虚拟变量，该变量将内部内容的值设为1，将设计师内容的值设为0。</em></p><p id="1b97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的结果总结显示，在两个模型中，我们的预测因子的估计系数都是负的，这表明接收内部内容的客户比接收设计师内容的客户具有更低的转化率。然而，系数的p值为<strong class="ky ir"> 0.199 </strong>高于我们的0.05阈值，这意味着我们未能拒绝我们的零假设，因此无法得出电子邮件内容对转化率有影响的结论。事实上，p值是概率的一种度量。这意味着，在变量之间没有差异的零假设条件下，我们期望在X%的时间里看到我们的数据。在这种情况下，如果真的没有差别，我们的数据在20%的情况下会自然出现。虽然不是绝对的，但它确实表明可能存在一些潜在的差异。</p><p id="ee06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，我们真正想测试的是<strong class="ky ir">对收入的总体影响</strong>，这意味着我们需要比较支出。我们将拟合一个关于花费的线性回归模型。</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="a22b" class="od mb iq nz b gy oe of l og oh">Call:<br/>glm(formula = conv_spend ~ group, data = combined)</span><span id="5b50" class="od mb iq nz b gy oi of l og oh">Deviance Residuals: <br/>    Min       1Q   Median       3Q      Max  <br/> -7.411   -7.411   -5.509   -5.509  310.729</span><span id="7b65" class="od mb iq nz b gy oi of l og oh">Coefficients:<br/>              Estimate Std. Error t value Pr(&gt;|t|)    <br/>(Intercept)     7.4106     0.7669   9.663   &lt;2e-16 ***<br/>groupIn-House  -1.9014     1.0847  -1.753   0.0797 .  <br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><span id="f769" class="od mb iq nz b gy oi of l og oh">(Dispersion parameter for gaussian family taken to be 1175.631)</span><span id="a48b" class="od mb iq nz b gy oi of l og oh">Null deviance: 4700258  on 3996  degrees of freedom<br/>Residual deviance: 4696645  on 3995  degrees of freedom<br/>AIC: 39604</span><span id="eea1" class="od mb iq nz b gy oi of l og oh">Number of Fisher Scoring iterations: 2</span></pre><p id="40bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">p值为0.0797，数据告诉我们，如果没有关系，我们只有8%的机会看到我们的支出数据。我应该注意，我们看到的p值假设我们想要一个双尾检验。由于最初的数据汇总表明设计师将胜过内部人员，我们可以通过将p值除以2来重新解释单尾测试的p值。这将进一步降低8%至4%。一点也不差，显然有些不同。</p><p id="7b18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">查看我们的独立“内部分组”变量的系数，我们看到-1.90，表明平均而言，<strong class="ky ir">内部内容导致<em class="ls">每次发送</em>的收入比设计师</strong>少1.90美元。</p><p id="897b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么我们学到了什么？如果我们的变量没有差异，我们的数据将只出现8%的时间(如果我们使用不太保守的单尾测试，则为4%)，因此，我们非常有信心在我们的两个变量之间存在差异。此外，由于向大约100万客户发送的每封电子邮件收费1.90美元，我们可能会获得190万美元的额外收入！如果没有真正的<strong class="ky ir"><em class="ls"/></strong>分析我们的结果，我们不想错过这样的机会。</p><h1 id="9e01" class="ma mb iq bd mc md mx mf mg mh my mj mk jw mz jx mm jz na ka mo kc nb kd mq mr bi translated">输入贝叶斯</h1><p id="e2be" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">从频率主义者转向贝叶斯方法意味着从概率的角度考虑我们的数据。我们不是对群体和转化之间关系的假设给出“是”或“否”的答案，而是通过生成一个群体的结果始终不同于另一个群体的<strong class="ky ir">概率</strong>来进行测试。</p><p id="543a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简而言之，贝叶斯回归使用传统的基本回归公式，但不是返回输入系数β <em class="ls"> i </em>的点估计，而是<em class="ls">生成截距、输入系数和误差项</em>的分布。</p><p id="0077" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是所谓的<strong class="ky ir">后验分布</strong>，它是利用数据的先验知识(“先验”)结合观测结果生成的。(如果你想更好地理解贝叶斯逻辑回归背后的理论，请查看威尔·库尔特的<a class="ae kv" href="https://www.countbayesie.com/blog/2019/6/12/logistic-regression-from-bayes-theorem" rel="noopener ugc nofollow" target="_blank">这篇精彩概述</a>或这篇<a class="ae kv" href="http://www.tqmp.org/RegularArticles/vol14-2/p099/p099.pdf" rel="noopener ugc nofollow" target="_blank"> rstanarm教程</a>)</p><p id="f2ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用斯坦概述的贝叶斯分析的四个步骤来更好地理解我们的结果:</p><blockquote class="ns nt nu"><p id="65a0" class="kw kx ls ky b kz la jr lb lc ld ju le nv lg lh li nw lk ll lm nx lo lp lq lr ij bi translated"><strong class="ky ir">贝叶斯分析的四个步骤:</strong></p><p id="95c6" class="kw kx ls ky b kz la jr lb lc ld ju le nv lg lh li nw lk ll lm nx lo lp lq lr ij bi translated">1.为结果和所有未知量指定联合分布，通常采用未知量的边际先验分布乘以以未知量为条件的结果的可能性的形式。这种联合分布与以观测数据为条件的未知量的后验分布成比例</p><p id="aa46" class="kw kx ls ky b kz la jr lb lc ld ju le nv lg lh li nw lk ll lm nx lo lp lq lr ij bi translated">2.使用马尔可夫链蒙特卡罗(MCMC)从后验分布中提取。</p><p id="b75b" class="kw kx ls ky b kz la jr lb lc ld ju le nv lg lh li nw lk ll lm nx lo lp lq lr ij bi translated">3.评估模型与数据的吻合程度，并可能修改模型。</p><p id="3d16" class="kw kx ls ky b kz la jr lb lc ld ju le nv lg lh li nw lk ll lm nx lo lp lq lr ij bi translated">4.从给定预测值的结果的后验预测分布中提取，以便可视化预测值的操作如何影响结果(的函数)。</p></blockquote><p id="75ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用<strong class="ky ir"><em class="ls">Rstan</em></strong><em class="ls">—</em>R接口对Stan —指定我们的后验分布，使用MCMC抽取样本，并评估模型拟合度。具体来说，我们使用<strong class="ky ir"> <em class="ls"> rstanarm </em> </strong>包。</p><h2 id="bf96" class="od mb iq bd mc oj ok dn mg ol om dp mk lf on oo mm lj op oq mo ln or os mq ot bi translated">汇率</h2><p id="fdcf" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">首先，我们有什么前科？让我们假设我们在一个新成立的团队中，这个团队之前对测试结果一无所知。这意味着我们事先不知道我们的转换率或花费应该是多少。默认情况下，Rstanarm通过使用弱信息先验很好地处理了这个问题。截距和输入系数的默认先验假设为正态分布，并且<em class="ls"> Rstanarm </em>根据数据调整标度。关于先验及其实现的更多细节可以在<a class="ae kv" href="https://cran.r-project.org/web/packages/rstanarm/vignettes/priors.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> rstanarm简介</strong> </a>中找到。我们稍后将查看<em class="ls"> rstanarm </em>如何调整(或没有调整)默认的优先级。</p><p id="ed2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们需要在建模阶段指定一些关键细节。由于我们的结果是一个转换率(0或1)，我们将使用<em class="ls">二项式分布</em>和<em class="ls"> logit </em>链接函数。我们将设置<em class="ls">链= 4 </em>，这样我们可以运行4个不同的马尔可夫链，并确保得到的样本都收敛于相同的参数估计。然后我们将<em class="ls">迭代的次数</em>设置为4000，预热<em class="ls">为2000。这意味着每个链有2，000次迭代来训练和调整先验(如果需要的话)，对于4个链，我们最终从后验样本中提取了健康的8，000个记录样本。</em></p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="ca15" class="od mb iq nz b gy oe of l og oh">Model Info:<br/> function:     stan_glm<br/> family:       binomial [logit]<br/> formula:      cbind(conversions, customers - conversions) ~ group<br/> algorithm:    sampling<br/> sample:       8000 (posterior sample size)<br/> priors:       see help('prior_summary')<br/> observations: 2<br/> predictors:   2</span><span id="dafd" class="od mb iq nz b gy oi of l og oh">Estimates:<br/>                mean   sd     10%    50%    90% <br/>(Intercept)   -3.083  0.112 -3.227 -3.081 -2.939<br/>groupIn-House -0.212  0.165 -0.425 -0.215  0.004</span><span id="c546" class="od mb iq nz b gy oi of l og oh">Fit Diagnostics:<br/>           mean   sd     10%    50%    90% <br/>mean_PPD 80.078  8.845 69.000 80.000 91.500</span><span id="bc80" class="od mb iq nz b gy oi of l og oh">The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help('summary.stanreg')).</span><span id="f585" class="od mb iq nz b gy oi of l og oh">MCMC diagnostics<br/>              mcse  Rhat  n_eff<br/>(Intercept)   0.002 1.001 5242 <br/>groupIn-House 0.002 1.000 4850 <br/>mean_PPD      0.110 1.001 6448 <br/>log-posterior 0.018 1.001 3174</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/035fe57be1019c5e36285a4de7b83c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J9HZdofHuoSuKNvUDCaj7Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示参数分布收敛的转换轨迹图</p></figure><p id="e14a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">快速检查汇总统计数据看起来不错。<em class="ls"> Rhat </em>对于所有参数都非常接近1，表明模型成功地收敛于每个参数的后验分布。我们还看到每个参数的有效样本量相对较高，远远超过样本量(8000)的10%。此外，查看轨迹图，我们看到4条链中的每一条都收敛于截距和群系数的相同参数估计值附近。请注意，弱信息默认先验没有改变。</p><p id="1b4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">训练我们的模型的输出是从后验分布中采样的一组8，000个值。我们有单个预测组的截距和系数的样本。就像之前一样，模型已经把我们的预测器变成了_House_Flag_conv  中的虚拟变量<strong class="ky ir"> <em class="ls">。</em></strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/0582ca2f17235436538b90fa38242cef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*QkIW8pgX6vxhEW5g_HkdOA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从转换后验中抽取的参数样本</p></figure><p id="319b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我们的预测器是一个虚拟变量，其中内部= 1，设计师= 0，所以我们可以通过查看预测器<strong class="ky ir"><em class="ls">In _ House _ Flag _ conv</em></strong>的采样系数来比较设计师内容和内部内容(上面的右栏)。</p><p id="0737" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该系数的负值表示内部转换率低于设计者，正值表示相反。设计师优于内部设计师的概率就是在<strong class="ky ir"><em class="ls">In _ House _ Flag _ conv&lt;0</em></strong>的抽奖比例。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/2ffe53e3037ddd9aea41ae096fd3e300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5ZWl9V8LM8btxRfaDXECQ.png"/></div></div></figure><p id="fb19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们看到在_House_Flag_conv  中的<strong class="ky ir"> <em class="ls">在90%的时间里是负的，因此设计者内容产生比B更高的转化率的概率是90%。换句话说，如果我们运行这个测试100次，<strong class="ky ir"> <em class="ls">，我们将会期望在100次</em> </strong>中有90次来自设计者内容的更多转换。</em></strong></p><p id="943a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于视觉型学习者来说，画出后验分布图来看看两组之间到底有多大的不同可能会有所帮助。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/c91b98d4d8d4ca2d6fa183f76046b752.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rDZxnS0o9fo2RYEVQnxRpg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">设计师与内部内容的样本分布</p></figure><p id="7ac9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从营销的角度来看，设计师内容是一个非常明显的赢家。制作和发送带有内容的电子邮件在成本上没有本质的区别，所以选择设计师而不是内部设计师的决定似乎是显而易见的。但是转化率只有图片的一半…</p><h2 id="0262" class="od mb iq bd mc oj ok dn mg ol om dp mk lf on oo mm lj op oq mo ln or os mq ot bi translated">支出因素</h2><p id="79a2" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">因为我们做生意是为了赚钱，所以我们也想知道客户在转换时实际花了多少钱。不同的电子邮件内容可能会激发不同的购买行为，当我们向利益相关方展示我们活动的<strong class="ky ir"> <em class="ls">总期望值</em> </strong>时，我们需要将这些因素考虑在内。</p><p id="4ea5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用与上面相同的序列，拟合模型(指定我们的后验分布)，使用MCMC绘制样本，并评估模型拟合。这里唯一真正的调整是将我们的响应变量切换为<em class="ls">花费</em>，将分布族切换为<em class="ls">高斯</em>，以适应我们的连续正态分布响应变量。</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="fab9" class="od mb iq nz b gy oe of l og oh">Model Info:<br/> function:     stan_glm<br/> family:       gaussian [identity]<br/> formula:      spend ~ group<br/> algorithm:    sampling<br/> sample:       8000 (posterior sample size)<br/> priors:       see help('prior_summary')<br/> observations: 160<br/> predictors:   2</span><span id="1ee1" class="od mb iq nz b gy oi of l og oh">Estimates:<br/>                mean    sd      10%     50%     90%  <br/>(Intercept)   168.247   7.164 159.226 168.246 177.389<br/>groupIn-House -15.293  10.803 -28.854 -15.401  -1.619<br/>sigma          66.475   3.703  61.896  66.257  71.329</span><span id="9d35" class="od mb iq nz b gy oi of l og oh">Fit Diagnostics:<br/>           mean    sd      10%     50%     90%  <br/>mean_PPD 161.380   7.369 151.918 161.464 170.604</span><span id="238a" class="od mb iq nz b gy oi of l og oh">The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help('summary.stanreg')).</span><span id="b076" class="od mb iq nz b gy oi of l og oh">MCMC diagnostics<br/>              mcse  Rhat  n_eff<br/>(Intercept)   0.080 1.000 8004 <br/>groupIn-House 0.122 1.000 7843 <br/>sigma         0.042 1.000 7861 <br/>mean_PPD      0.083 1.000 7953 <br/>log-posterior 0.022 1.000 3378</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/fb4ce3855561e6b8dc2546718126f22b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EvvwuEOs6-quIaXPAqJF-g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示参数分布收敛的轨迹图</p></figure><p id="cad9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">汇总数据看起来也不错。<em class="ls"> Rhat = 1 </em>对于所有参数，每个参数的有效样本量都很高，轨迹图显示所有链都收敛于截距、组系数和sigma误差项的相同参数估计值。</p><p id="2326" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用与之前相同的流程，我们将使用我们的虚拟变量比较设计师和内部人员，这次命名为<strong class="ky ir"><em class="ls">In _ House _ Flag _ spend</em></strong>。我们在我们的8000个样本中取<strong class="ky ir"><em class="ls">In _ House _ Flag _ spend&lt;0</em></strong>的比例，得到设计师胜过内部设计师的概率。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/af22a2aadda3436cb655f99fad6958ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7_E1I93jzXRynUGttOHQ_g.png"/></div></div></figure><p id="179d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">果不其然，在92%的情况下，收到设计师作品的顾客比收到内部作品的顾客花费更多。现在让我们看看这转化成了多少美元。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/c857a10e713c99fc6b9906bcf09a87bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*PhyGR-Eb8lrapNBuC2T8eg.png"/></div></figure><p id="1ca0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，当我们的设计师客户通过电子邮件购物时，他们比内部客户平均多花了15.55美元。现在我们有两个强有力的证据表明，设计师内容推动了更高的转化率，并在转化时花费更多。现在让我们将两个信号结合起来，看看两者之间的<strong class="ky ir"><em class="ls"/></strong>总值有何不同。</p><h2 id="123e" class="od mb iq bd mc oj ok dn mg ol om dp mk lf on oo mm lj op oq mo ln or os mq ot bi translated">结合转化和花费</h2><p id="dbd9" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">我们可以通过组合来自我们的转换和支出后验分布的随机样本来计算<em class="ls">总值</em>。一项活动的总价值由转化的顾客百分比乘以他们的消费总额得出。因此，使用我们的后验样本，我们简单地将转换系数乘以每组的花费系数，然后进行比较。</p><p id="b3e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们先来看看设计师客户的总价值大于内部客户的总价值的概率。在R中，它看起来像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pb pc l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/f2a985baa7071d95ecf1f9b4a289d815.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/1*HJj8tdWhu_xYU0c1niSPqA.png"/></div></figure><p id="3cc4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有96%的可能性认为设计师的总价值<em class="ls">高于内部人员的总价值</em>。这是一个非常强烈的迹象，表明设计师的内容对企业来说确实更有价值。</p><p id="a6de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们有一个非常强的概率，问题是收入的预期差异是多少？我们可以合并转换和花费样本，并计算两组之间总价值的平均差异。这将告诉我们<strong class="ky ir"> <em class="ls">我们发送电子邮件给</em> </strong>的每一位客户，我们可以期望获得多少额外收入。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pb pc l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/5ba753dedfb52ff927c988695bdae532.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*m4W9sQIVq5Fnc2kpZvuJPA.png"/></div></figure><p id="bc7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据我们的组合后验分布，我们计算出b组的总价值为1.89美元。这意味着，平均而言，<strong class="ky ir"> <em class="ls">我们预计使用设计师内容与使用内部内容</em> </strong>相比，每次发送的收入将增加1.89美元。考虑到我们可以在一年内将它推广到100万用户，这还不错！</p><p id="8598" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们可以使用<em class="ls"> ggplot </em>可视化这些分布。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/64b51356e39a962c87852fb7d432c479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*88gzt9BL-WJmoVWAOV4gYA.png"/></div></div></figure><p id="96b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，设计师的平均值略低于7.5，内部人员的平均值约为5.5，正好在1.89左右。</p><h1 id="7261" class="ma mb iq bd mc md mx mf mg mh my mj mk jw mz jx mm jz na ka mo kc nb kd mq mr bi translated">结论</h1><p id="f5d8" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">在本文中，我们对A/B测试度量的频率分析和贝叶斯分析进行了比较。总的来说，频率主义者和贝叶斯方法给我们带来了大致相同的结论，只是解释略有不同。</p><ul class=""><li id="7398" class="nd ne iq ky b kz la lc ld lf nf lj ng ln nh lr pg nj nk nl bi translated">Frequentist方法(支出的线性回归)得出的p值为0.0787(或使用单尾检验得出的p值为0.0394)，系数相当于设计师的1.90美元优势。</li><li id="6b5d" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr pg nj nk nl bi translated">贝叶斯方法(结合转换率和支出后验分布)表明，设计师在96%的情况下导致(平均)多1.89美元的收入。</li></ul><p id="1dbf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">分析结果表明，运行设计师的内容比运行内部内容有明显的优势，最终每发送一封电子邮件可带来<em class="ls">1.89美元的额外收入。我们有100万合格的电子邮件订户，通过选择正确的内容，这相当于<strong class="ky ir"><em class="ls"/></strong>189万美元的额外年收入。</em></p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="96f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">注:</em> </strong> <em class="ls">我修改了原来的文章，以反映频率主义者和贝叶斯方法之间的比较。一位读者指出，在许多A/B测试场景中，从均值的单尾t测试中得出的p值相当于贝叶斯推断的A大于B的概率。这一更新版本表明，两种方法得出的数值结果大致相同，并且对这些结果有大致的信心。</em></p><h1 id="ee91" class="ma mb iq bd mc md mx mf mg mh my mj mk jw mz jx mm jz na ka mo kc nb kd mq mr bi translated">密码</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="613c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">你可以从我的</em> <a class="ae kv" href="https://github.com/peifern/bayesian_regression" rel="noopener ugc nofollow" target="_blank"> <em class="ls"> GitHub </em> </a>下载完整代码</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="88bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">感谢</em> <a class="ae kv" href="https://www.linkedin.com/in/curtbergmann/" rel="noopener ugc nofollow" target="_blank"> <em class="ls">柯特·博格曼</em> </a> <em class="ls">向我介绍了这项技术，并在我学习的过程中提供了指导。</em></p></div></div>    
</body>
</html>