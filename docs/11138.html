<html>
<head>
<title>How to identify the right independent variables for Machine Learning Supervised Algorithms?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习监督算法如何识别正确的自变量？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-identify-the-right-independent-variables-for-machine-learning-supervised-algorithms-439986562d32?source=collection_archive---------3-----------------------#2020-08-03">https://towardsdatascience.com/how-to-identify-the-right-independent-variables-for-machine-learning-supervised-algorithms-439986562d32?source=collection_archive---------3-----------------------#2020-08-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d8fc459cf7881385b948e2864c84d757.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*baom9dctOgjheM6z2dGxGg.png"/></div></div></figure><p id="9dc6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在计算机科学领域有一个非常著名的缩写词<em class="kz"> GIGO </em>，这是我在学生时代学过的。<em class="kz"> GIGO </em>代表垃圾进出。本质上，这意味着如果我们向计算机程序和算法提供不适当的垃圾数据，那么它将导致垃圾和不正确的结果。</p><p id="ad8c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">机器学习算法和我们人类是一样的。广义的机器学习算法有两个阶段——学习和预测。<br/>学习环境和参数应与未来要做预测的条件相似。在无偏数据样本上训练的算法和输入变量值的排列真实地反映了全部人口数据集，能够很好地进行准确的预测。</p><p id="aa98" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">监督机器学习算法成功的基石之一是为学习阶段选择正确的独立变量集。在本文中，我将讨论一种结构化的方法来选择正确的独立变量来输入算法。我们不希望过多输入冗余数据点，即高度相关(<strong class="kd iu">多重共线性</strong>)数据，并在不提高预测准确性的情况下使模型复杂化。事实上，有时过多的数据会降低预测的准确性。另一方面，我们需要确保模型不会过于简单，并反映真实的复杂性。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="39a3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">目标</em> </strong></p><p id="7175" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们想建立一个模型来预测 ASML 公司的股票价格。我们已经下载了过去 20 年来 ASML 的一些客户、竞争对手和指数点的股价数据。我们不确定在构建 ASML 股票预测模型时应该包括这些数据点中的哪一个。</p><p id="6671" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">样本数据文件</em> </strong></p><p id="279c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我写了一个小函数，我可以从不同的程序调用它来下载过去 20 年的股票价格。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="36e7" class="lq lr it lm b gy ls lt l lu lv">"""Filename - GetStockData.py is a function to download the stock from 1st Jan 2000 until current date"""</span><span id="cbcb" class="lq lr it lm b gy lw lt l lu lv">import datetime as dt<br/>import pandas as pd<br/>import pandas_datareader.data as web<br/>import numpy as np</span><span id="d0e0" class="lq lr it lm b gy lw lt l lu lv">def stockdata(ticker):</span><span id="bfc5" class="lq lr it lm b gy lw lt l lu lv">    start= dt.datetime(2000,1,1)    ## Start Date Range<br/>    end=dt.datetime.now()    ## Curret date as end date Range<br/>    Stock=web.DataReader(ticker, "yahoo", start, end)<br/>    <br/>    name=str(ticker) + ".xlsx"<br/>    Stock.to_excel(name)<br/>    return ()</span></pre><p id="6ab8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从另一个带有股票代码的程序调用函数 stockdata()来下载数据。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="f084" class="lq lr it lm b gy ls lt l lu lv">""" Filename - stockdownload.py"""<br/>import GetStockData<br/>ticker= ["MU", "ASML","TSM","QCOM", "UMC", "^SOX", "INTC","<strong class="lm iu">^</strong>IXIC"]<br/>for i in ticker:<br/>    GetStockData.stockdata(i)</span></pre><p id="94e7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，GetStockData python 文件和 stockdownload.py 文件放在同一个文件目录中，以便成功导入文件。</p><p id="4989" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第一步- </em> </strong>第一步是想到所有可能影响因变量的变量。到了这一步，我会建议不要约束自己的思维，大脑转储所有的变量。</p><p id="8291" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第二步- </em> </strong>下一步是收集/下载预期自变量数据点进行分析。</p><p id="ac0a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我已经将下载的数据格式化并整理成一个 excel 文件“StockData.xlsx”</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lx"><img src="../Images/e33a05a2080f81ae989ca49346e189c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lwxvC9-jjf76gVq5tiBSeQ.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">过去 20 年的股票价格数据—从 2000 年 1 月到 2020 年 8 月</p></figure></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="1e7f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤 3- </em> </strong>我们将导入包 pandas、matplotlib、seaborn 和 statsmodels 包，我们将使用这些包进行分析。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="fb2e" class="lq lr it lm b gy ls lt l lu lv">import pandas as  pd<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>from statsmodels.stats.outliers_influence import variance_inflation_factor</span></pre><p id="7c06" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤 4- </em> </strong>将完整的数据样本数据 excel 文件读入名为“数据”的 PandasDataframe 中。此外，我们将用日期列替换索引</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="4d3b" class="lq lr it lm b gy ls lt l lu lv">data=pd.read_excel("StockData.xlsx")<br/>data.set_index("Date", inplace= True)</span></pre><p id="6af8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我不会关注初步的数据质量检查，如空白值、异常值等。和各自的修正方法，并假设不存在与差异相关的数据序列。</p><p id="5650" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第 5 步- </em> </strong>开始理解自变量之间关系的最好地方之一就是变量之间的相关性。在以下代码中，使用绘制了关联的热图。熊猫的 corr 方法。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="ed5d" class="lq lr it lm b gy ls lt l lu lv">sns.heatmap(data.corr(), annot=True, cmap="YlGnBu")<br/>plt.show()<br/></span></pre><p id="8aee" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如下所示，相关性热图为我们提供了变量之间关系的可视化描述。现在，我们不想要一组与因变量有或多或少相似关系的自变量。例如，TSM 和纳斯达克指数与 ASML 的相关系数分别为 0.99 和 0.97。包括 TSM 和 NASDAQ 可能不会提高预测的准确性，因为它们与因变量 ASML 股票价格有类似的关系。</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/757379ec9d75946fde41f0cfd110f61f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KMM61jLnhM5kGaP_LBd7HA.png"/></div></div></figure><p id="91ad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第 6 步- </em> </strong>在我们开始舍弃多余的自变量之前，让我们检查一下自变量中的<strong class="kd iu">方差膨胀因子</strong> ( <strong class="kd iu"> VIF </strong>)。VIF 在普通最小二乘回归分析中量化了多重共线性的严重程度。它提供了一个指标来衡量估计回归系数的方差(估计值的标准差的平方)因共线性而增加的程度。我鼓励你们大家阅读维基百科上关于<a class="ae md" href="https://en.wikipedia.org/wiki/Variance_inflation_factor" rel="noopener ugc nofollow" target="_blank">方差膨胀因子</a>的页面，以便更好地理解它。</p><p id="c26e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下面的代码中，我们计算每个独立变量的 VIF 并打印出来。我们将创建一个没有 ASML 历史股票价格的新数据框架，因为我们的目标是确定潜在自变量中的 VIF。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="f16b" class="lq lr it lm b gy ls lt l lu lv">X=data.drop(["ASML"], axis=1)<br/>vif = pd.DataFrame()<br/>vif["features"] = X.columns<br/>vif["vif_Factor"] = [variance_inflation_factor(X.values, i) for i in range(X.shape[1])]<br/>print(vif)</span></pre><figure class="lh li lj lk gt ju gh gi paragraph-image"><div class="gh gi me"><img src="../Images/063970ad845ad9c254185c9a10c707ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*jsq-W1d8lFs8aS-O0-WVmw.png"/></div></figure><p id="4656" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一般来说，我们的目标应该是自变量的 VIF 小于 10。我们已经从之前的热图中看到，TSM 和 NASDAQ 与 ASML 有相似的相关系数，同样也反映了高 VIF 指标。</p><p id="c962" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">基于我们对热图和 VIF 结果的理解，让我们放弃纳斯达克(最高的 VIF)作为我们模型自变量的潜在候选，重新评估 VIF。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="ca59" class="lq lr it lm b gy ls lt l lu lv">X=data.drop(["ASML","NASDAQ"], axis=1)<br/>vif = pd.DataFrame()<br/>vif["features"] = X.columns<br/>vif["vif_Factor"] = [variance_inflation_factor(X.values, i) for i in range(X.shape[1])]<br/>print(vif)</span></pre><figure class="lh li lj lk gt ju gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/a6200b0f9f30fde618f085798aa86836.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*rXQ4yHMxLATHSyuU6AeS7Q.png"/></div></figure><p id="bc86" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以看到，除去纳斯达克，VIF 的其他几个潜在的独立公司也减少了。</p><p id="d4dc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">选择独立变量的正确组合需要一点经验，还要用不同的排列进行试错 VIF 检验。TSMC 是世界领先的半导体代工厂，作为 ASML 的客户，对 ASML 的业务有很大的影响。考虑到这一点，我将放弃“INTC”和“PHLX ”,并重新评估剩余变量的 VIF。</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/1bdc58bac572d79ff3f8afc9fdb87048.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*zmK-xpqaa2UwJMNLcCeX0g.png"/></div></figure><p id="dbc7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">正如我们可以看到的，经过两次迭代后，所有剩余变量的 VIF 都小于 10。我们删除了具有多重共线性的变量，并确定了与预测 ASML 股票价格相关的独立变量列表。</p><p id="465d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望，在为你的机器学习模型选择正确的自变量集合时，你会发现本程序中解释的方法是有帮助的。</p><p id="ccfa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你喜欢这篇文章，那么你可能也会喜欢<a class="ae md" href="https://medium.com/@kaushikthoughts/machine-learning-and-supply-chain-management-hands-on-series-2-d723125f749e" rel="noopener">机器学习和供应链管理:动手系列</a></p><p id="2459" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">免责声明——本文仅为教育目的而写。不要根据本文中确定的独立变量进行任何实际的股票买卖或任何金融交易。</em></p></div></div>    
</body>
</html>