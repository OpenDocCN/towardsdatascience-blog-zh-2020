<html>
<head>
<title>How machine learning can predict the price of the diamond you desire to buy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习如何预测你想要购买的钻石的价格</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-diamond-prices-using-basic-measurement-metrics-bc8ba821c8f6?source=collection_archive---------48-----------------------#2020-05-13">https://towardsdatascience.com/predicting-diamond-prices-using-basic-measurement-metrics-bc8ba821c8f6?source=collection_archive---------48-----------------------#2020-05-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c6cd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用基本测量指标预测钻石价格。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ac7aeee126ec436c9f6beddb7f22745b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VQbogBPJUxpT32a-"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kv" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> chuttersnap </a>拍摄</p></figure><h1 id="1d7a" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="bb70" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我想一有足够的钱就给我妈妈买一枚钻石戒指。前几天，我在谷歌上搜索了它的价格，但我不知道是什么指标推动了这些价格。因此，我决定应用一些机器学习技术来找出是什么推动了一枚完美无瑕的钻石戒指的价格！</p><h1 id="c8ae" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">目标</h1><p id="0b0a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">构建一个web应用程序，用户可以在其中查找他们想要的钻石的预测价格。</p><h1 id="740f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">数据</h1><p id="899b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于这个项目，我使用了GitHub上pycaret的dataset文件夹中的一个<a class="ae kv" href="https://github.com/pycaret/pycaret/blob/master/datasets/diamond.csv" rel="noopener ugc nofollow" target="_blank">数据集</a>，执行了数据预处理转换，并建立了一个回归模型，以使用基本的钻石测量指标来预测钻石的价格(326美元至18，823美元)。数据集中的每颗钻石都有一个价格。钻石的价格由7个输入变量决定:</p><ol class=""><li id="ce3f" class="mk ml iq lq b lr mm lu mn lx mo mb mp mf mq mj mr ms mt mu bi translated"><strong class="lq ir">克拉重量</strong>:0.2千克-5.01千克</li><li id="9217" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">切割:一般、良好、非常好、优质、理想</li><li id="066c" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated"><strong class="lq ir">颜色</strong>:从J(最差)到D(最好)</li><li id="c594" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated"><strong class="lq ir">清晰度</strong> : I1(最差)、SI2、SI1、VS2、VS1、VVS2、VVS1、IF(最好)</li><li id="9641" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated"><strong class="lq ir">波兰</strong> : ID(理想)、EX(优秀)、G(良好)、VG(非常好)</li><li id="3c04" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated"><strong class="lq ir">对称性</strong> : ID(理想)，EX(优秀)，G(良好)，VG(非常好)</li><li id="63e2" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated"><strong class="lq ir">报告</strong> : AGSL(美国宝石协会实验室)、GIA(美国宝石学院)</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/4c8ed82d43f2238530c422b295f2182a.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*R75fqXl3B500vg8nl_xyTA.jpeg"/></div></figure><h1 id="c997" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">👉任务</h1><ol class=""><li id="0967" class="mk ml iq lq b lr ls lu lv lx nb mb nc mf nd mj mr ms mt mu bi translated"><strong class="lq ir">模型训练和验证:</strong>使用Python ( <a class="ae kv" href="https://www.pycaret.org/" rel="noopener ugc nofollow" target="_blank"> PyCaret </a>)训练、验证模型，并开发用于部署的机器学习管道。</li><li id="4d78" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated"><strong class="lq ir">前端Web应用:</strong>构建一个基本的HTML前端，带有自变量(克拉重量、切工、颜色、净度、抛光度、对称性、报告)的输入表单。</li><li id="8415" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated"><strong class="lq ir">后端Web应用:</strong>使用<a class="ae kv" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank">烧瓶</a> <strong class="lq ir"> </strong>框架。</li><li id="eb54" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated"><strong class="lq ir">部署web应用程序:</strong>使用<a class="ae kv" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>，<strong class="lq ir"> </strong>一旦部署，它将公开可用，并且可以通过Web URL访问。</li></ol><h1 id="4616" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">💻项目工作流程</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/0feb05ae62b928fdfa3d9f0bb2e52ef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FjY7vxjIMooJNIomOFbglQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">机器学习工作流程(从培训到PaaS部署)</p></figure><h1 id="7ce6" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">任务1 —模型训练和验证</h1><p id="0d76" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">使用PyCaret在Python (Jupyter笔记本)中进行模型训练和验证，以开发机器学习管道并训练回归模型。我使用PyCaret中的默认预处理设置。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="e269" class="nk kx iq ng b gy nl nm l nn no">from <strong class="ng ir">pycaret.regression import</strong> *</span><span id="b1ec" class="nk kx iq ng b gy np nm l nn no">s2 = setup(data, target = 'Price', session_id = 123,<br/>           normalize = <strong class="ng ir">True</strong>,<br/>           polynomial_features = <strong class="ng ir">True</strong>, trigonometry_features = <strong class="ng ir">True</strong>, feature_interaction=<strong class="ng ir">True</strong>, <br/>           bin_numeric_features= ['Carat Weight']</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/80ffcf161946e07314cfab911c61d8e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*H4tGL_NWnPZFfwouYfFf7w.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据集中转换的比较</p></figure><p id="ce58" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">这改变了数据集，减少到65个用于训练的特征，而原始数据集中只有8个特征。</p><p id="a318" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">PyCaret中的模型训练和验证:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="d426" class="nk kx iq ng b gy nl nm l nn no"># Model Training and Validation <br/>lr = <strong class="ng ir">create_model</strong>('lr')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/f382f0c5589839459ee870d1c3d2e654.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*FwCeBalylPwLsbmVOyV7Ig.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">线性回归模型的10倍交叉验证</p></figure><p id="f932" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">在这里，均方根误差(<strong class="lq ir"> RMSE </strong>)和平均绝对百分比误差(<strong class="lq ir"> MAPE </strong>)受到了显著影响。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="e656" class="nk kx iq ng b gy nl nm l nn no"># plot the trained model<strong class="ng ir"><br/></strong>plot_model(lr)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/3cacdcd26d24583dcec5e0fadbd95283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*DYkg3lccdCl4BLPvHrD3_w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">线性回归模型的残差图</p></figure><p id="77f6" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">构建模型后，我将它保存为一个文件，该文件可以传输到其他应用程序并供其使用:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="f650" class="nk kx iq ng b gy nl nm l nn no"># save transformation pipeline and model <br/>save_model(lr, 'deployment_28042020')</span></pre><p id="7e06" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">保存模型会根据在<strong class="lq ir"> setup() </strong>函数中定义的配置创建整个转换管道，并且会考虑到相互依赖关系。整个机器学习管道和线性回归模型现在保存在<strong class="lq ir"> save_model() </strong>函数中。</p><h1 id="99c0" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">任务2 — <strong class="ak">前端Web应用</strong></h1><p id="9fef" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><strong class="lq ir"> CSS样式表<br/> </strong> CSS(层叠样式表)描述了用HTML编写的文档的呈现方式。它保存诸如颜色、字体大小、边距等信息。它被保存为链接到HTML代码的. css文件。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="b814" class="nk kx iq ng b gy nl nm l nn no">&lt;head&gt;<br/>  &lt;meta charset="UTF-8"&gt;<br/>  &lt;title&gt;Predict Diamond Price&lt;/title&gt;<br/>  &lt;link href='<a class="ae kv" href="https://fonts.googleapis.com/css?family=Pacifico'" rel="noopener ugc nofollow" target="_blank">https://fonts.googleapis.com/css?family=Pacifico'</a> rel='stylesheet' type='text/css'&gt;<br/>&lt;link href='<a class="ae kv" href="https://fonts.googleapis.com/css?family=Arimo'" rel="noopener ugc nofollow" target="_blank">https://fonts.googleapis.com/css?family=Arimo'</a> rel='stylesheet' type='text/css'&gt;<br/>&lt;link href='<a class="ae kv" href="https://fonts.googleapis.com/css?family=Hind:300'" rel="noopener ugc nofollow" target="_blank">https://fonts.googleapis.com/css?family=Hind:300'</a> rel='stylesheet' type='text/css'&gt;<br/>&lt;link href='<a class="ae kv" href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300'" rel="noopener ugc nofollow" target="_blank">https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300'</a> rel='stylesheet' type='text/css'&gt;<br/>&lt;link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='./style.css') }}"&gt;<br/>  <br/>&lt;/head&gt;</span></pre><p id="50a3" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">对于前端web应用程序，我使用了一个简单的HTML模板和一个CSS样式表来设计输入表单。下面是我们的web应用程序前端页面的HTML代码片段。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="fe41" class="nk kx iq ng b gy nl nm l nn no">&lt;body&gt;<br/> &lt;div class="login"&gt;<br/> &lt;h1&gt;Predict Diamond Price&lt;/h1&gt;</span><span id="3846" class="nk kx iq ng b gy np nm l nn no">&lt;!-- Form to enter new data for predictions  --&gt;<br/>    &lt;form action="{{ url_for('predict')}}"method="POST"&gt;<br/>      &lt;input type="text" name="Carat Weight" placeholder="Carat Weight" required="required" /&gt;&lt;br&gt;<br/>     &lt;input type="text" name="Cut" placeholder="Cut" required="required" /&gt;&lt;br&gt;<br/>        &lt;input type="text" name="Color" placeholder="Color" required="required" /&gt;&lt;br&gt;<br/>        &lt;input type="text" name="Clarity" placeholder="Clarity" required="required" /&gt;&lt;br&gt;<br/>        &lt;input type="text" name="Polish" placeholder="Polish" required="required" /&gt;&lt;br&gt;<br/>        &lt;input type="text" name="Symmetry" placeholder="Symmetry" required="required" /&gt;&lt;br&gt;<br/>        &lt;input type="text" name="Report" placeholder="Report" required="required" /&gt;&lt;br&gt;<br/>        &lt;button type="submit" class="btn btn-primary btn-block btn-large"&gt;Predict&lt;/button&gt;<br/>    &lt;/form&gt;</span><span id="012f" class="nk kx iq ng b gy np nm l nn no">&lt;br&gt;<br/>   &lt;br&gt;<br/> &lt;/div&gt;<br/> {{pred}}</span><span id="e7a0" class="nk kx iq ng b gy np nm l nn no">&lt;/body&gt;</span></pre><h1 id="50de" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">任务3—后端Web应用程序</h1><p id="8701" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我使用Flask框架来构建后端web应用程序。下面是后端应用程序的Flask代码片段。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="8c51" class="nk kx iq ng b gy nl nm l nn no">from flask import Flask,request, url_for, redirect, render_template, jsonify<br/>from pycaret.regression import *<br/>import pandas as pd<br/>import pickle<br/>import numpy as np</span><span id="4418" class="nk kx iq ng b gy np nm l nn no">app = Flask(__name__)</span><span id="d3e6" class="nk kx iq ng b gy np nm l nn no">model = load_model('deployment_28042020')<br/>cols = ['Carat Weight', 'Cut', 'Color', 'Clarity', 'Polish', 'Symmetry', 'Report']</span><span id="6fe6" class="nk kx iq ng b gy np nm l nn no"><a class="ae kv" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/')<br/>def home():<br/>    return render_template("home.html")</span><span id="c68b" class="nk kx iq ng b gy np nm l nn no"><a class="ae kv" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/predict',methods=['POST'])<br/>def predict():<br/>    int_features = [x for x in request.form.values()]<br/>    final = np.array(int_features)<br/>    data_unseen = pd.DataFrame([final], columns = cols)<br/>    prediction = predict_model(model, data=data_unseen, round = 0)<br/>    prediction = int(prediction.Label[0])<br/>    return render_template('home.html',pred='Price of the Diamond is ${}'.format(prediction))</span><span id="22d9" class="nk kx iq ng b gy np nm l nn no"><a class="ae kv" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/predict_api',methods=['POST'])<br/>def predict_api():<br/>    data = request.get_json(force=True)<br/>    data_unseen = pd.DataFrame([data])<br/>    prediction = predict_model(model, data=data_unseen)<br/>    output = prediction.Label[0]<br/>    return jsonify(output)</span><span id="1b37" class="nk kx iq ng b gy np nm l nn no">if __name__ == '__main__':<br/>    app.run(debug=True)</span></pre><h1 id="845c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">任务4— <strong class="ak">部署网络应用</strong></h1><p id="8041" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在训练了模型，建立了机器学习管道之后，我在Heroku上部署了web应用程序。我链接了一个GitHub库到Heroku。这个项目的代码可以在我的GitHub库<a class="ae kv" href="http://github.com/dhrumilpatel02/diamond-price-prediction" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/1d325eb5a012b773543e5ff66eb8c9df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*niARTBE1C-YFsEL0_o0GdQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://github.com/dhrumilpatel02/diamond-price-prediction" rel="noopener ugc nofollow" target="_blank">github.com/dhrumilpatel02/diamond-price-prediction</a></p></figure><p id="d1e8" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">接下来，我在Heroku上部署了web应用程序，该应用程序发布在URL:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/0a8f7228b37c88897ee2689ac3afddd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*Iit66VbWpxkDG6V4RBpSTg.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://diamond-price-prediction.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://diamond-price-prediction.herokuapp.com/</a></p></figure></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="b0ee" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">感谢PyCaret的创始人和主要作者，<a class="ae kv" href="https://www.linkedin.com/in/profile-moez/" rel="noopener ugc nofollow" target="_blank"> Moez Ali </a>。这个项目的过程灵感来自于他最近在<a class="ae kv" rel="noopener" target="_blank" href="/build-and-deploy-your-first-machine-learning-web-app-e020db344a99">的帖子</a>。</p><h1 id="81b1" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">感谢阅读！</h1><p id="2ded" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">您可以通过以下方式联系到我:</p><ol class=""><li id="f384" class="mk ml iq lq b lr mm lu mn lx mo mb mp mf mq mj mr ms mt mu bi translated">在<strong class="lq ir"> LinkedIn </strong> <a class="ae kv" href="https://www.linkedin.com/in/dhrumilpatel02/" rel="noopener ugc nofollow" target="_blank">这里</a>关注/联系我。</li><li id="924c" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">在<strong class="lq ir"> GitHub </strong> <a class="ae kv" href="https://github.com/dhrumilpatel02" rel="noopener ugc nofollow" target="_blank">这里</a>关注我。</li><li id="bf38" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">查看我的<strong class="lq ir">网站</strong> <a class="ae kv" href="https://dhrumilpatel02.github.io/portfolio/" rel="noopener ugc nofollow" target="_blank">这里</a>。</li></ol></div></div>    
</body>
</html>