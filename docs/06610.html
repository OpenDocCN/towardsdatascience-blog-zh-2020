<html>
<head>
<title>Build A Motion Detected Alarm System with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 构建运动检测报警系统</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-a-motion-triggered-alarm-in-5-minutes-342fbe3d5396?source=collection_archive---------9-----------------------#2020-05-25">https://towardsdatascience.com/build-a-motion-triggered-alarm-in-5-minutes-342fbe3d5396?source=collection_archive---------9-----------------------#2020-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1876" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 OpenCV 进行运动检测的初学者友好指南</h2></div></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><p id="4c4d" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi ll translated"><span class="l lm ln lo bm lp lq lr ls lt di">在</span>我之前的一篇关于 Open-CV 的文章中，(<a class="ae lu" rel="noopener" target="_blank" href="/face-detection-in-10-lines-for-beginners-1787aa1d9127"><em class="lv">10 行中的人脸检测</em> </a> <em class="lv"> ) </em>，我们探讨了一幅图像或视频中人脸检测的基础知识。在此基础上，我们将看到如何检测帧中的任何移动对象。当你外出度假时，你可以使用这种运动检测逻辑编写一个程序，然后发出警报或向你的手机发送消息。在本文中，我们将重点关注使用<a class="ae lu" href="https://docs.opencv.org/trunk/index.html" rel="noopener ugc nofollow" target="_blank"><strong class="kr iu"><em class="lv">open-cv</em></strong></a>识别和跟踪来自网络摄像头的视频提要中的任何移动对象，并使用离线文本到语音模块<a class="ae lu" href="https://pypi.org/project/pyttsx3/" rel="noopener ugc nofollow" target="_blank"><strong class="kr iu"><em class="lv">pyttsx 3</em></strong></a>库播放音频消息。让我们看看它是否足以吓跑窃贼！</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lw"><img src="../Images/62330368e092974fccb9b665d916cbcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hFxTCQzB8jUqFS456KjPQQ.jpeg"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">照片由<a class="ae lu" href="https://www.pexels.com/@burst?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">突发</a>发自<a class="ae lu" href="https://www.pexels.com/photo/two-person-standing-under-lot-of-bullet-cctv-camera-374103/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">像素</a></p></figure></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="b23a" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">概观</h1><p id="0a26" class="pw-post-body-paragraph kp kq it kr b ks ne ju ku kv nf jx kx ky ng la lb lc nh le lf lg ni li lj lk im bi translated">这个程序中有两个独立的模块，你可以根据你要实现的想法单独使用:</p><blockquote class="nj nk nl"><p id="4c62" class="kp kq lv kr b ks kt ju ku kv kw jx kx nm kz la lb nn ld le lf no lh li lj lk im bi translated">1.检测运动(使用 OpenCV) <br/> 2。播放音频/文本到语音(使用 pyttsx3)</p></blockquote><p id="d25e" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">我们将从使用 pip 安装以下 Python 库开始。</p><pre class="lx ly lz ma gt np nq nr ns aw nt bi"><span id="d29d" class="nu mn it nq b gy nv nw l nx ny">pip install pyttsx3<br/>pip install pywin32<br/>pip install numpy<br/>pip install opencv-python</span></pre></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="dda9" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">方法</h1><p id="db80" class="pw-post-body-paragraph kp kq it kr b ks ne ju ku kv nf jx kx ky ng la lb lc nh le lf lg ni li lj lk im bi translated">方法很简单。当程序启动时，我们将捕获一个名为<em class="lv"> baseline_image 的图片。</em>这是没有任何物体/入侵者的图像。我们的程序将不断比较新的帧和这个基线图像。如果没有人进入或退出框架，将不会有任何区别。然而，当有人进入画面时，图像的内容会有所不同，如果这种差异超过某个阈值，我们的程序会将其视为入侵者并播放音频。</p></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="5f8a" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">1.检测运动</h1><p id="05a7" class="pw-post-body-paragraph kp kq it kr b ks ne ju ku kv nf jx kx ky ng la lb lc nh le lf lg ni li lj lk im bi translated">为了检测运动，我们将使用 Open-CV 模块。我们从 baseline_image 开始，它是在没有任何移动对象的情况下捕获的帧。摄像机一启动，第一张图像就被设置为我们的 baseline_image，这意味着当我们的程序第一次启动时，我们不希望有移动的物体。接下来，当有人进入该帧时，该帧中的某些像素将会不同。我们使用“cv2.absdiff”方法推导出这种差异。</p><p id="0800" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">我们将采取几个步骤来实现这一目标。</p><blockquote class="nj nk nl"><p id="e401" class="kp kq lv kr b ks kt ju ku kv kw jx kx nm kz la lb nn ld le lf no lh li lj lk im bi translated"><strong class="kr iu"> 1 </strong>。捕捉基线 _ 帧(无对象)<br/> 1.1 将帧转换为灰色<br/> 1.2 平滑帧以去除噪声</p><p id="9474" class="kp kq lv kr b ks kt ju ku kv kw jx kx nm kz la lb nn ld le lf no lh li lj lk im bi translated"><strong class="kr iu"> 2 </strong>。捕捉新帧(带对象)<br/> 2.1 将帧转换为灰色<br/> 2.2 平滑帧以去除噪声</p><p id="2906" class="kp kq lv kr b ks kt ju ku kv kw jx kx nm kz la lb nn ld le lf no lh li lj lk im bi translated"><strong class="kr iu"> 3 </strong>。计算两帧之间的差异<br/> 3.1 <strong class="kr iu">如果</strong>差异大于阈值，则假定检测到运动<br/> 3.2 <strong class="kr iu">否则</strong>假定没有检测到运动</p></blockquote><p id="cc27" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">首先，我们将图像转换为灰度，并使用低通滤波器(LPF)柔化(模糊)图像。LPF 通常用于图像处理以平滑图像(例如:-用于皮肤平滑、背景模糊)，而高通滤波器(HPF)用于锐化图像(例如:-锐化眼睛和其他细节)。如果你曾经使用过像 Photoshop/GIMP 等图片编辑工具。，你一定很熟悉这个。这有助于通过消除噪声来提高精度。为此，我们使用了高斯布鲁。GaussianBlur 之前和之后的图像如下所示。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nz"><img src="../Images/d69c1bb13c24a171484d2562223a1dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbB3TxuUwnj1RFzn5Fpu3Q.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">信用:<a class="oa ob ep" href="https://medium.com/u/c5b77fc1811c?source=post_page-----342fbe3d5396--------------------------------" rel="noopener" target="_blank"> Arindom Bhattacharjee </a></p></figure><p id="e8d6" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">如果你仔细观察图像的底部中心，你会注意到在“之前”图像中我手指的较暗一侧，我的手指有不同程度的灰度(一些区域没有其他区域暗)。然而，在“后”图像中，整个较暗的一面几乎是灰色的一种变体。模糊的程度由我们自己决定。这里我有高斯内核大小宽度和高度为(25，25)和一个标准偏差 0。宽度和高度应该是正奇数。可以把它想象成改变图像编辑工具中模糊量的滑块。执行此操作的代码如下所示。</p><pre class="lx ly lz ma gt np nq nr ns aw nt bi"><span id="6640" class="nu mn it nq b gy nv nw l nx ny"><strong class="nq iu">#Gray conversion and noise reduction (smoothening)</strong><br/>gray_frame=cv2.cvtColor(frame,cv2.COLOR_BGR2GRAY)<br/>gray_frame=cv2.GaussianBlur(gray_frame,(25,25),0)</span></pre><p id="db83" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">下一步是推导基线和新帧之间的差异。我们将这两个图像传递给 cv2.absdiff()函数。这是使用一种叫做<a class="ae lu" href="https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_thresholding/py_thresholding.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kr iu"> <em class="lv">图像阈值</em> </strong> </a>的方法转换成的二进制图像，也就是说，如果一个特定的像素值大于某个阈值(我们在这里指定为 35)，它将被赋予白色的值(255)或者黑色的值(0)。现在我们有一个只有两种像素的图像(纯黑或纯白，中间没有)。这样做是为了使我们能够识别检测对象周围的轮廓区域。我们将用它在框架中的对象周围画一个绿色的方框。</p><p id="556f" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">现在我们将在我们的二值图像中找到所有的轮廓。<strong class="kr iu"> <em class="lv">轮廓</em> </strong>简单来说就是沿着具有相同颜色或强度的周界或边界绘制的曲线。本质上，它会在黑色背景上的白色区域周围绘制一条曲线。它期望背景为黑色，前景对象为白色。使用 cv2.findContours()方法，我们将识别图像中的所有轮廓。该方法期望 3 个参数，<strong class="kr iu"> (a) </strong>图像，<strong class="kr iu"> (b) </strong>轮廓检索模式和<strong class="kr iu"> (c) </strong>轮廓逼近方法。</p><p id="3954" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">该方法返回已识别轮廓的列表。我们使用 cv2.contourArea()方法过滤掉我们不感兴趣的小轮廓。cv2.boundingRect()返回左上角的(x，y)坐标以及包含特定轮廓的矩形的宽度和高度。然后我们画一个矩形在屏幕上显示它。</p><pre class="lx ly lz ma gt np nq nr ns aw nt bi"><span id="2dad" class="nu mn it nq b gy nv nw l nx ny"><strong class="nq iu">#Calculating the difference and image thresholding</strong><br/>delta=cv2.absdiff(baseline_image,gray_frame)<br/>threshold=cv2.threshold(delta,35,255, cv2.THRESH_BINARY)[1]</span><span id="ef54" class="nu mn it nq b gy oc nw l nx ny"><strong class="nq iu"># Finding all the contours</strong><br/>(contours,_)=cv2.findContours(threshold,cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)</span><span id="f848" class="nu mn it nq b gy oc nw l nx ny"><strong class="nq iu"># Drawing rectangles bounding the contours (whose area is &gt; 5000)</strong><br/>for contour in contours:<br/>    if cv2.contourArea(contour) &lt; 5000:<br/>        continue<br/>    (x, y, w, h)=cv2.boundingRect(contour)<br/>    cv2.rectangle(frame, (x, y), (x+w, y+h), (0,255,0), 1)</span></pre><h1 id="e986" class="mm mn it bd mo mp od mr ms mt oe mv mw jz of ka my kc og kd na kf oh kg nc nd bi translated">2.播放音频(文本到语音)</h1><p id="69e2" class="pw-post-body-paragraph kp kq it kr b ks ne ju ku kv nf jx kx ky ng la lb lc nh le lf lg ni li lj lk im bi translated">为了播放音频，我们将使用"<a class="ae lu" href="https://pypi.org/project/pyttsx3/" rel="noopener ugc nofollow" target="_blank"><strong class="kr iu"><em class="lv">pyttsx 3</em></strong></a>" python 库来将文本转换为语音。您可以选择自己的声音(男/女)、讲话速度和音量。下面分享了我在这里使用的一段示例代码。</p><pre class="lx ly lz ma gt np nq nr ns aw nt bi"><span id="20ce" class="nu mn it nq b gy nv nw l nx ny">import pyttsx3</span><span id="1cb5" class="nu mn it nq b gy oc nw l nx ny">engine = pyttsx3.init()<br/>voices = engine.getProperty('voices')<br/>engine.setProperty('voice', voices[1].id)<br/>engine.setProperty('rate', 150)<br/>engine.say("Object Detected")<br/>engine.runAndWait()</span></pre></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><p id="de4f" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">最终的输出程序存在于<a class="ae lu" href="https://github.com/arindomjit/Motion_Detected_Alarm" rel="noopener ugc nofollow" target="_blank"> <strong class="kr iu"> Github </strong> </a>库中以供参考。您可能会注意到，播放音频的功能是在一个单独的线程中执行的。这样做是为了在播放音频警报消息时，视频馈送没有延迟。</p><p id="7d79" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">让我们看看我们最终的工作版本是什么样的。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="oi oj l"/></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">阿林多姆·巴塔查尔吉</p></figure></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><p id="63e2" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi ll translated"><span class="l lm ln lo bm lp lq lr ls lt di">在</span>结论中，本文演示了如何使用 Python OpenCV 库来检测帧之间的差异，从而检测视频馈送中的运动对象。我们还探索了另一个 Python 库 pyttsx3，它可以将文本转换为语音，以及如何通过结合这两者来构建一个程序，在新对象进入框架时发送语音警报。我希望您发现本文中的信息很有用，并以自己的方式使用它。<strong class="kr iu">感谢</strong>阅读！</p></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><div class="lx ly lz ma gt ok"><a rel="noopener follow" target="_blank" href="/face-detection-in-10-lines-for-beginners-1787aa1d9127"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">面向初学者的 10 行人脸检测</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">使用 Python OpenCV 在图像和视频中检测人脸的介绍。</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy mg ok"/></div></div></a></div><div class="oz pa gp gr pb ok"><a rel="noopener follow" target="_blank" href="/generate-qrcode-with-python-in-5-lines-42eda283f325"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">用 Python 生成 5 行二维码</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">也许在你的简历中使用它来链接到你的网站或 LinkedIn 个人资料</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="pc l ov ow ox ot oy mg ok"/></div></div></a></div><div class="oz pa gp gr pb ok"><a rel="noopener follow" target="_blank" href="/build-a-voice-controlled-mouse-keyboard-in-5-minutes-952bc8f101fc"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">在 5 分钟内制作一个声控鼠标</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">Python 中语音识别和 GUI 自动化的初学者指南</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="pd l ov ow ox ot oy mg ok"/></div></div></a></div></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="793f" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">参考资料:</h1><p id="0408" class="pw-post-body-paragraph kp kq it kr b ks ne ju ku kv nf jx kx ky ng la lb lc nh le lf lg ni li lj lk im bi translated">[1]图像过滤，<a class="ae lu" href="https://docs.opencv.org/2.4/modules/imgproc/doc/filtering.html" rel="noopener ugc nofollow" target="_blank">https://docs . opencv . org/2.4/modules/imgproc/doc/Filtering . html</a></p><p id="926c" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">[2]图像阈值，<a class="ae lu" href="https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_thresholding/py_thresholding.html" rel="noopener ugc nofollow" target="_blank">https://opencv-python-tutro als . readthedocs . io/en/latest/py _ tutorials/py _ img proc/py _ Thresholding/py _ Thresholding . html</a></p><p id="ac48" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">[3]了解轮廓，<a class="ae lu" href="https://docs.opencv.org/trunk/d4/d73/tutorial_py_contours_begin.html" rel="noopener ugc nofollow" target="_blank">https://docs . opencv . org/trunk/D4/d73/tutorial _ py _ Contours _ begin . html</a></p></div></div>    
</body>
</html>