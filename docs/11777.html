<html>
<head>
<title>How to Install TensorFlow 2 Object Detection API on Windows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Windows 上安装 TensorFlow 2 对象检测 API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-install-tensorflow-2-object-detection-api-on-windows-2eef9b7ae869?source=collection_archive---------10-----------------------#2020-08-15">https://towardsdatascience.com/how-to-install-tensorflow-2-object-detection-api-on-windows-2eef9b7ae869?source=collection_archive---------10-----------------------#2020-08-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e18f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对最初的基于 Docker 的教程进行了一些修正</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8f950f73893036b19309632eefe88c8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K7T7yWGUUBgm0XJbpgr4dw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@youxventures?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> You X Ventures </a>拍摄。使用本教程中提供的代码进行对象检测</p></figure><p id="b377" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> R </span>最近，我需要为正在进行的概念验证运行一个对象检测模型。由于我使用的是 TensorFlow 2，对象检测 API 看起来很合适。然而，不幸的是，安装过程比看起来要麻烦得多，而且官方文档是基于 Docker 的，这对一个普通的 pip 包来说似乎是一个不必要的负担。长话短说，我卷起袖子穿过它，一步一步修复，直到它工作。在这里，我向你介绍如何做。</p><p id="8733" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">免责声明:</strong>我并不是以任何方式反对 Docker。</p><h1 id="bb32" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">摘要</h1><ul class=""><li id="c945" class="mw mx it lb b lc my lf mz li na lm nb lq nc lu nd ne nf ng bi translated">先决条件</li><li id="50ce" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated">在 Windows 上安装<em class="nm"> pycocotools </em></li><li id="a2c6" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated">介绍对象检测 API</li><li id="a6fa" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated">测试您的安装</li><li id="97c2" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated">结束语</li></ul><h2 id="5946" class="nn mf it bd mg no np dn mk nq nr dp mo li ns nt mq lm nu nv ms lq nw nx mu ny bi translated">先决条件</h2><p id="cd6a" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">我假设您熟悉 Python，正在使用某种虚拟环境，并且熟悉 TensorFlow。我使用 TensorFlow 2.3 和 Python 3.7.6 进行了安装过程。前者可能会在此过程中更新，因此如果您需要特定的版本，请记住这一点。</p><p id="fc01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了 Python 环境，您还需要一个文本编辑器和一个 Git 客户机。</p><p id="4774" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不是 TensorFlow 用户或数据科学家，只是想让对象检测算法工作，除了 Python 之外的所有依赖项都会被安装，所以你不需要自己安装 TensorFlow。在本文的最后，我提供了一个代码片段来对一个测试图像运行对象检测，以后您可以根据需要修改它。</p><h2 id="6001" class="nn mf it bd mg no np dn mk nq nr dp mo li ns nt mq lm nu nv ms lq nw nx mu ny bi translated">在 Windows 上安装 pycocotools</h2><p id="e400" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">TF 的许多对象检测 API 模块依赖于<em class="nm"> pycocotools </em>包，该包无法通过 pip 安装在 Windows 上。如果您已经安装了这个包，您可以安全地跳过这一部分。如果没有，请按照下列步骤操作:</p><ol class=""><li id="5b5c" class="mw mx it lb b lc ld lf lg li oc lm od lq oe lu of ne nf ng bi translated"><a class="ae ky" href="https://github.com/cocodataset/cocoapi" rel="noopener ugc nofollow" target="_blank">克隆官方知识库</a></li><li id="3ec5" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu of ne nf ng bi translated">导航到 PythonAPI 文件夹并打开<a class="ae ky" href="https://github.com/cocodataset/cocoapi/blob/master/PythonAPI/setup.py" rel="noopener ugc nofollow" target="_blank"> <em class="nm"> setup.py </em> </a>文件</li><li id="2891" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu of ne nf ng bi translated">将第 12 行编辑为<code class="fe og oh oi oj b">extra_compile_args=[]</code>。这里的基本原理是删除特定的铿锵论点，这在 MVCC 不起作用。</li><li id="dbbd" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu of ne nf ng bi translated">在 CMD 终端的 PythonAPI 文件夹中，运行:<br/> <code class="fe og oh oi oj b">python setup.py build_ext --inplace</code></li></ol><p id="0b2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这最后一个命令将在您当前的环境中构建和安装这个包，准备就绪。为了测试安装是否成功，启动 Python 并将其导入为:<code class="fe og oh oi oj b">import pycocotools</code>。</p><p id="aedb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能会问，我们是否不应该添加 MVCC 特有的旗帜来取代铿锵的旗帜。我也有同样的疑惑，但是它工作得很好，我没有遇到任何错误。据我所知，最初的 Clang 标志是用来禁用某些警告并强制 C99 遵从性的。</p><h2 id="f94b" class="nn mf it bd mg no np dn mk nq nr dp mo li ns nt mq lm nu nv ms lq nw nx mu ny bi translated">安装对象检测 API</h2><p id="fad8" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">准备好 coco 工具后，我们可以转到实际的对象检测 API。遵循这些步骤(注意有些命令以点结束！):</p><ol class=""><li id="08c9" class="mw mx it lb b lc ld lf lg li oc lm od lq oe lu of ne nf ng bi translated">克隆<a class="ae ky" href="https://github.com/tensorflow/models" rel="noopener ugc nofollow" target="_blank"> TensorFlow 模型库</a>。这个 repo 是一组 TF 相关项目的保护伞，Object Detection API 就是其中之一。</li><li id="6c07" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu of ne nf ng bi translated">导航到”。/research/object _ detection/packages/tf2/"并编辑<a class="ae ky" href="https://github.com/tensorflow/models/blob/master/research/object_detection/packages/tf2/setup.py" rel="noopener ugc nofollow" target="_blank"> <em class="nm"> setup.py </em> </a>文件。从<em class="nm">必需 _ 包</em>列表中，删除<em class="nm"> pycocotools </em>引用(第 20 行)。这一改变将防止安装过程试图从 pip 重新安装<em class="nm"> pycocotools </em>，这将失败并中止整个过程。</li><li id="ded6" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu of ne nf ng bi translated">将这个<em class="nm"> setup.py </em>文件复制到。/research”文件夹，替换已经存在的<em class="nm"> setup.py </em>。</li><li id="719d" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu of ne nf ng bi translated">打开<em class="nm">研究</em>文件夹中的 CMD，用<br/> <code class="fe og oh oi oj b">protoc object_detection/protos/*.proto --python_out=.</code>编译协议缓冲区</li><li id="2e2d" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu of ne nf ng bi translated">如果前面的命令有效，应该不会出现任何内容。我知道这不是最直观的东西。之后，运行下面的:<br/> <code class="fe og oh oi oj b">python -m pip install .</code></li></ol><p id="91d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我解释的一切都正确，并且你严格按照字面意思去做，安装过程应该会很顺利，大量的软件包现在已经安装到你的系统中了。</p><p id="6260" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的系统上没有<em class="nm">protocol</em>命令，您需要做的就是下载一个<a class="ae ky" href="https://github.com/protocolbuffers/protobuf/releases/tag/v3.13.0" rel="noopener ugc nofollow" target="_blank">协议缓冲库</a>的预编译版本，并将其添加到您的系统路径(或将其放在 Windows/system32/😈).</p><p id="2fbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">奇怪的是，对我来说，在这一切之后，我的<em class="nm"> OpenCV </em>和<em class="nm"> MatplotLib </em>包不再显示数字(<em class="nm">cv2 . im show</em>/<em class="nm">PLT . show</em>)。我通过使用<code class="fe og oh oi oj b">pip install -U opencv-python opencv-contrib-python matplitlib</code>重新安装两个包修复了这个问题。如果任何其他软件包在安装对象检测 API 后出现故障，尝试像我上面做的那样从 pip 更新它。</p><h2 id="29fb" class="nn mf it bd mg no np dn mk nq nr dp mo li ns nt mq lm nu nv ms lq nw nx mu ny bi translated">测试您的安装</h2><p id="e4ea" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">有两种方法可以确定您当前的安装是否正确。第一个是运行库测试套件。在<em class="nm">研究</em>文件夹下打开 CMD，运行:<br/> <code class="fe og oh oi oj b">python object_detection/builders/model_builder_tf2_test.py</code></p><p id="7074" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它应该打印很多东西，并告诉你所有的测试都成功了。</p><p id="2b5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二种方法是下载一个模型，并尝试用它进行一些推断。这里是用于<a class="ae ky" href="https://github.com/tensorflow/models/blob/master/research/object_detection/colab_tutorials/inference_tf2_colab.ipynb" rel="noopener ugc nofollow" target="_blank">推理</a>和<a class="ae ky" href="https://github.com/tensorflow/models/blob/master/research/object_detection/colab_tutorials/eager_few_shot_od_training_tf2_colab.ipynb" rel="noopener ugc nofollow" target="_blank">训练</a>的官方协作笔记本。我不是笔记本的粉丝，所以<a class="ae ky" href="https://gist.github.com/nuzrub/ee3dc19242915278e95cb75014e29083" rel="noopener ugc nofollow" target="_blank">这里是我的测试脚本</a>，它期望一个<a class="ae ky" href="https://unsplash.com/photos/Oalh2MojUuk" rel="noopener ugc nofollow" target="_blank"><em class="nm">test.png</em></a>文件作为输入，一个<a class="ae ky" href="https://github.com/tensorflow/models/blob/master/research/object_detection/data/mscoco_label_map.pbtxt" rel="noopener ugc nofollow" target="_blank"> <em class="nm"> coco 标签图</em>(你可以在这里找到)</a>，以及<a class="ae ky" href="http://download.tensorflow.org/models/object_detection/tf2/20200711/centernet_resnet50_v1_fpn_512x512_coco17_tpu-8.tar.gz" rel="noopener ugc nofollow" target="_blank"> CenterNet 模型</a>。将所有内容放在一个文件夹中，并将下面的脚本添加到这个文件夹中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="9e50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，应该会弹出一个包含原始图像和检测覆盖图的图像，还应该会创建一个名为<em class="nm">output.png</em>的新文件。</p><p id="915b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章的封面图片是使用上面的脚本和来自 Unsplash 的这张<a class="ae ky" href="https://unsplash.com/photos/Oalh2MojUuk" rel="noopener ugc nofollow" target="_blank">图片生成的。如果一切都设置正确，并且您使用此图像作为输入，您应该得到与我相同的结果。</a></p></div><div class="ab cl om on hx oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="im in io ip iq"><p id="87d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">我</span>希望这有助于您使用 TensorFlow 2 对象检测 API，并使您能够使用开箱即用的模型进行推理和训练。有了上面的脚本，应该不难理解如何在您的管道上应用这个 API，并将其更改为使用其他模型。有关实现及其质量/速度权衡的列表，<a class="ae ky" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md" rel="noopener ugc nofollow" target="_blank">请参考此列表。</a></p><p id="b97b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您对本教程有任何问题，请留下您的评论，我将非常乐意帮助您跟踪问题，并用更新的信息更新本文。</p></div><div class="ab cl om on hx oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="im in io ip iq"><p id="ea61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你刚接触媒体，我强烈推荐<a class="ae ky" href="https://ygorserpa.medium.com/membership" rel="noopener">订阅</a>。对于数据和 IT 专业人员来说，中型文章是 StackOverflow 的完美组合，对于新手来说更是如此。注册时请考虑使用<a class="ae ky" href="https://ygorserpa.medium.com/membership" rel="noopener">我的会员链接。你也可以直接给我买杯咖啡来支持我</a></p><p id="a81a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读:)</p></div></div>    
</body>
</html>