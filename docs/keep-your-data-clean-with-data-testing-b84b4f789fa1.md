# 通过数据测试保持数据整洁

> 原文：<https://towardsdatascience.com/keep-your-data-clean-with-data-testing-b84b4f789fa1?source=collection_archive---------34----------------------->

## 对您的数据进行测试，并满怀期望地提高您的管道质量

![](img/cae87ed94b7e2674a37a5052b6a444ca.png)

在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上[科学高清](https://unsplash.com/@scienceinhd?utm_source=medium&utm_medium=referral)拍摄的照片

在软件工程中，用特定于语言的框架编写测试是减少错误和提高代码质量的最佳实践。然而，在数据科学和数据工程的世界中，您正在构建的管道和模型的质量不仅仅取决于编写的代码，它主要取决于您正在使用的数据。在本文中，我们将看到如何为我们的输入数据编写测试，以避免不愉快的意外。因此，我们可以保证我们的机器学习模型或建立在这些数据上的 ETL 管道的正确行为。

在本文中，我们将关注 Python 代码，并使用 [great-expectations](https://docs.greatexpectations.io/en/v0.4.5/index.html) 包进行测试。我们将专注于 Pandas 数据帧，但是 PySpark 和其他工具的测试也受到了 great-expectations 的支持。

# 测试示例数据集

对于这个例子，我决定使用来自约翰·霍普金斯大学系统科学与工程中心(CSSE)的[新冠肺炎数据](https://github.com/CSSEGISandData/COVID-19)。

**为什么是这个数据集？我使用这个数据集是因为它由几个批次组成。有一个。自 Covid 19 开始以来每天的 csv 文件。数据的质量和信息量随着时间而变化。因此，我们可以在特定日期可用的数据子集上构建我们的测试。随后，我们可以将这些测试应用于新的、看不见的数据，并确保数据内容符合预期。**

首先，让我们创建一个所有文件的列表，这些文件是我们希望稍后在管道中加载和使用的:

我们将首先只检查最旧的文件和最新的文件，而不是立即加载所有文件。因此，我们可以看到列的外观，并评估数据质量。

这个仅仅关于列名的概述已经表明随着时间的推移发生了巨大的变化。添加了几个额外的列，并更改了一些列的命名。这意味着我们不能加载所有。csv 文件并连接它们，无需任何额外的预处理步骤。

基于获得的信息，我们可以编写第一个测试来检查我们以后使用的所有列是否都出现在每个文件中:

这里，我们首先用 great_expectations dataset 对象包装了最新数据文件的 DataFrame 对象。这仍然像一个熊猫数据帧，但带来了一些额外的功能。然后，我们用 *expect_column_to_exist()* 方法创建了第一个测试，称为期望。我们将这种方法应用于 DataFrame 列的定义列表，以确保这些列确实存在。在本例中，我们创建了 5 个期望(5 个不同列的一种期望)。最后，我们创建了一个 expect-config 对象来描述所创建的测试。这个对象可以作为 JSON 文件保存和加载。

到目前为止，我们只创建了这些测试，并将它们保存在一个配置文件中。现在，让我们对我们的两个数据文件应用这些测试，看看它们是否成功:

*ge.read_csv()* 方法是对应的 Pandas 方法的包装器，并提供了定义期望套件的机会，该套件是我们的配置对象，应该用于数据验证。我们可以用 *validate()* 应用已定义的测试，并用 *success()* 检查它们是否成功。结果显示，对最后一个数据文件的测试成功，但对第一个文件的测试失败。这个输出和预期的一样，第一个文件的测试失败了，它有一个不同的列命名。我们可以使用以下命令查看更多详细信息:

在这里，我们迭代每个单独的期望，并检查它是否成功。如果没有，我们将附加信息打印到控制台。输出告诉我们，数据集中没有必要的列“Country_Region”、“Last_Update”和“Active”。我们可以通过简单的列重命名来解决前两个问题。如果缺少“活动”列，则必须进行计算。

必要的数据清理和数据验证可以总结为一个功能:

这个函数做必要的数据准备，如果其中一个定义的测试失败了，就会引发一个错误。否则，它返回有效的 DataFrame 对象。

现在，在成功地检查了基础知识之后，我们可以考虑对各个列进行一些更高级的测试。例如，我们可以检查“确认”、“死亡”和“恢复”列。我们知道这些列都应该是整数类型并且是正数。此外，如果没有有效的“Country_Region”或“Last_Update”条目，则整个数据行将毫无价值。所以我们也应该测试这个。

因为我们已经对最新的数据文件应用了这些测试，所以我们立即发现“Active”列有问题，它包含负值。我们应该在额外的预处理步骤中处理这些情况。

额外的数据清理似乎足以在所有定义的测试中获得成功。现在，我们可以加载所有文件并开始使用它们，而不用担心输入数据中的任何意外行为。

# 最终注释

Great-expectations 是一个强大的工具，可以帮助您检查数据源的一致性并保证数据质量。有许多[预定义的期望](https://docs.greatexpectations.io/en/v0.4.5/dataset_module.html)，您可以轻松定义自己的期望。**本例中显示的内容只是演示基础知识**。Great-expectations 提供了很多更有趣、更强大的特性，比如 Data Docs，它可以为您的验证结果创建漂亮的 HTML 结果。查看教程和文档以了解更多信息:

[](https://github.com/great-expectations/great_expectations) [## 远大的期望

### 永远要知道从你的数据中能得到什么。远大前程通过数据帮助数据团队消除管道债务…

github.com](https://github.com/great-expectations/great_expectations) 

似乎有几种方法可以生成和应用具有很高期望的测试。因为这些技术对我来说也很新，请告诉我，是否有比上面代码中应用的方法更高级的方法。

感谢阅读！