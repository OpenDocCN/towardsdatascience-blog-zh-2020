<html>
<head>
<title>How to Teach Your Panda SQL in 10 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在10分钟内教会你的熊猫SQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-teach-your-panda-sql-in-10-minutes-791ca7877d15?source=collection_archive---------32-----------------------#2020-04-05">https://towardsdatascience.com/how-to-teach-your-panda-sql-in-10-minutes-791ca7877d15?source=collection_archive---------32-----------------------#2020-04-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1465" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将SQL查询集成到Pandas数据框架的快速概述</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4f4575629c596936133dcff125cb3bef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NoHaKxL3pxeNjhzx"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">伊洛娜·弗罗利希在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="7603" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于任何数据科学家或分析师来说，以一种易于理解和有组织的方式管理数据是一项绝对必要的技能。Pandas DataFrames允许对非常大的数据集进行清晰的视图和操作，同时它也可能是使用最广泛的Python包之一。SQL可能是一个更广泛适用的工具，用于数据库管理和直接从数据库模式中的几个数据表中获取数据。</p><p id="f9d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任何时候捕获、组织或操作数据时，通常都有大量的标准需要考虑。Pandas通常需要更多的步骤，在一个多步骤的过程中利用各种打包方法和函数来清理数据。SQL查询需要更多的全局思维，因为构造的查询只需一步就可以获取数据并根据标准进行聚合。</p><p id="0005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个从Python开始然后转向SQL的人，我倾向于在清理数据时使用Pandas，但是将SQL查询集成到我的数据清理过程中有助于减轻我的数据工作工具箱中的一些细微差别。让我们看看如何将查询集成到您的Pandas数据框架中。</p><h1 id="8d55" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">导入库(sqlite3)</h1><p id="25a4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在Jupyter笔记本环境中，我首选的SQL查询包是“sqlite3”。让我们用pandas和SQL导入必要的库进行数据清理:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="6d2f" class="mx lw it mt b gy my mz l na nb">import Pandas as pd<br/>import sqlite3<br/>from pandasql import sqldf</span></pre><p id="1218" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的系统尚未安装pandasql，您必须通过终端安装:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="8cc9" class="mx lw it mt b gy my mz l na nb">pip install pandasql</span></pre><h1 id="2194" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">基本熊猫查询</h1><p id="794c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Pandas已经支持一个非常基本的查询选项。通常我们必须对pandas数据帧进行切片和索引，但是我们可以通过一个简单的查询很容易地得到相同的结果。</p><p id="6006" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从使用传统的切片语法开始:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="e91d" class="mx lw it mt b gy my mz l na nb">df2 = df1[df1[(df1[df1[‘Column1'] != df1['Column2']]) OR (df1['Column1'] == 'X')]]</span></pre><p id="5795" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意这个查询非常复杂，因为它需要多层切片和看似无限多的括号。</p><p id="d361" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可以很容易地用一个。“query()”方法:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="f04c" class="mx lw it mt b gy my mz l na nb">df2 = df.query("Column1 != Column2 | Column1 = 'X'")</span></pre><p id="26ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意我们是如何显著地精简了必要的语法，并且现在可以清楚地理解我们试图查询的是什么标准。另外，请注意“|”的使用。值得注意的是，在编写查询语法时，我们可以用“|”代替“或”，而用“&amp;”代替“和”。句法</p><h1 id="a290" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用pandasql查询</h1><p id="2c81" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">上面的查询非常简单，因为我们只查询了两个条件。在真正的数据库管理中，会有大量的标准，充满了聚合函数、表连接和子查询。如果我们只是使用。query()方法，所以我们将创建一个函数，以更有组织的方式运行我们的查询。</p><p id="0942" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先创建一个lambda函数，它会将全局变量传递给查询对象，这样我们就不必每次运行查询时都这样做。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="62db" class="mx lw it mt b gy my mz l na nb">pysqldf = lambda q: sqldf(q, globals())</span></pre><p id="edb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个函数采用一个查询q(我们将在稍后编写)和一个通用的globals()参数来加快查询过程并节省计算开销。</p><p id="6ff7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们要做的就是编写我们想要使用的实际查询:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="2203" class="mx lw it mt b gy my mz l na nb">q = SELECT c.Name, c.Age, c.Address, o.Income, c.Height<br/>    FROM customers c<br/>    JOIN occupation o<br/>    USING(CustomerId)<br/>    </span></pre></div></div>    
</body>
</html>