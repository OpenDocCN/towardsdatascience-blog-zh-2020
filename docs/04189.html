<html>
<head>
<title>Your live Covid-19 tracker with Airflow and GitHub Pages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您的实时新冠肺炎跟踪与气流和GitHub网页</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/your-live-covid-19-tracker-with-airflow-and-github-pages-658c3e048304?source=collection_archive---------32-----------------------#2020-04-16">https://towardsdatascience.com/your-live-covid-19-tracker-with-airflow-and-github-pages-658c3e048304?source=collection_archive---------32-----------------------#2020-04-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8ed9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">加载数据，使用散景制作出色的可视化效果，将它们托管在GitHub Pages网站上，并随着新数据的到来，让气流自动完成这一过程！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a28501f717c301e2629ed272f47500d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*611IltHXq_117U9X"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@fabrizioverrecchia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Fabrizio Verrecchia </a>拍摄的照片</p></figure><p id="23d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着新冠肺炎病的爆发，我们——数据科学爱好者——可以使用一系列令人惊叹的数据集来制作我们自己的可视化工具，获得有用的见解，并为有用和智能信息的传播做出贡献。</p><p id="4660" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些数据通常每天更新，因为新闻中报道了新的病例。因此，想象一下，您加载数据并花大量时间清理它，进行探索性的数据分析，并创建令人印象深刻的可视化；然后你决定保存你的图表并分享它们。到目前为止还不错，但是第二天呢？数据更新后，您是否每天都手动运行脚本？还有，你的朋友怎么能不用问你就能查看图表呢？</p><p id="3ecd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，有一些工具可以让这项任务变得非常简单。首先，<a class="ae ky" href="https://pages.github.com" rel="noopener ugc nofollow" target="_blank"> GitHub Pages </a>允许你创建自己的网站，在那里你可以托管你令人惊叹的新情节(并与世界分享它们)。)其次，<a class="ae ky" href="https://airflow.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Apache Airflow </a>允许您调度和自动化流程并执行任务。它是基于Python的，但是它处理不同种类的任务(比如运行C++或Bash脚本。)</p><p id="d623" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><h2 id="194f" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">加载、清理和转换数据</h2><p id="e70c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">让我们以约翰·霍普金斯大学系统科学与工程中心提供的广泛使用的<a class="ae ky" href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data" rel="noopener ugc nofollow" target="_blank">CSSE·新冠肺炎数据集</a>为例，来进行我们的可视化。我们旅程的第一步是加载数据集并(像往常一样)对它们进行一些清理:我们只需更改<em class="mt"> State </em>和<em class="mt"> Country </em>列名，按国家对州进行分组并对值求和。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="2743" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很容易，主要归功于组织良好的原始数据集。</p><p id="0d8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们必须选择我们想要显示的内容。为了这篇文章，我决定在<a class="ae ky" href="https://www.ft.com/coronavirus-latest?fbclid=IwAR2Pi_sryd7x2ZvOt_y0J0_00N5mDQeYLvBc4DfMr6bpninqV75dcxRtEsA" rel="noopener ugc nofollow" target="_blank">金融时报</a>上复制这张漂亮的图表。该图根据每个国家首次通过<em class="mt"> x </em>平均死亡人数的天数显示了每个国家的新冠肺炎死亡人数趋势。为此，我们需要计算相关时间序列的<a class="ae ky" href="https://en.wikipedia.org/wiki/Moving_average" rel="noopener ugc nofollow" target="_blank">滚动平均值</a>。下面的代码完成了这个任务:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="44d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原始数据集提供每天的病例总数，因此我们需要首先通过调用<code class="fe mw mx my mz b">.diff()</code>来计算每天的病例数(还要注意，我们将只显示前10个国家；)然后，我们计算每列的滚动平均值。通过重置索引并连接滚动的列，我们能够将索引称为从我们第一次计算<code class="fe mw mx my mz b">n_since</code>值开始的<em class="mt"> x </em>天的数量。当调用<code class="fe mw mx my mz b">rolling(n_since=3)[1].head()</code>(死亡)时，您应该会看到这样的内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h2 id="d2a0" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">散景可视化</h2><p id="01d6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">熊猫<code class="fe mw mx my mz b">.plot()</code>将很快显示图表，但这种类型的情节值得更多的风格。在这些选项中，散景是最简单和最有特色的选择之一。我不打算进一步解释这个库的功能，因为有许多资源，而只是简单地为您提供一个我创建的定制功能(它遵循上面的代码，因此它以滚动数据帧作为输入):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="707c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/7c29432adf3c11d441339c07aedf32f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tfHXCTn3vLPAO9hl5uO1Qg.gif"/></div></div></figure><h1 id="15e9" class="nb lw it bd lx nc nd ne ma nf ng nh md jz ni ka mg kc nj kd mj kf nk kg mm nl bi translated">托管到GitHub</h1><p id="4237" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在是时候让世界看到它了。创建一个Github网站非常简单，按照<a class="ae ky" href="https://pages.github.com" rel="noopener ugc nofollow" target="_blank">这里</a>的说明就可以完成。基本上，您需要创建一个名为structure<em class="mt">username . github . io .</em>的新公共存储库</p><p id="5155" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后你提交新的散景图，命名为<em class="mt">index.html</em>并推它。最后在<a class="ae ky" href="http://username.github.io." rel="noopener ugc nofollow" target="_blank"><em class="mt">http://&lt;username&gt;. github . io</em>就能看到了。</a>你可以在这里找到我的:<a class="ae ky" href="https://hectoramirez.github.io/covid/Daily_deaths_Europe.html" rel="noopener ugc nofollow" target="_blank">https://hectoramirez . github . io/covid/Daily _ deaths _ Europe . html</a>。</p><p id="668a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，明天CSSE数据集更新时会发生什么呢？一种选择是手动运行您的脚本，并将您的情节提交/推送到GitHub。每天。试着在早上早点做——你的朋友可能想在早餐时检查一下。或者…</p><h1 id="f717" class="nb lw it bd lx nc nd ne ma nf ng nh md jz ni ka mg kc nj kd mj kf nk kg mm nl bi translated">借助气流实现it自动化</h1><p id="7e14" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如前所述，Apache Airflow允许您调度和自动化流程——比如在特定时间运行脚本。更准确地说，</p><blockquote class="nm nn no"><p id="6a9e" class="kz la mt lb b lc ld ju le lf lg jx lh np lj lk ll nq ln lo lp nr lr ls lt lu im bi translated">气流用于创建代码管道，我们可以在其中调度和监控我们的工作流。工作流可以是要像流程图一样执行的任务的集合。</p></blockquote><h2 id="23aa" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">设置</h2><p id="1f06" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">有很多学习使用Airflow的资源，包括<a class="ae ky" href="https://airflow.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Airflow自己的文档</a>，所以我会引导你走向我们的具体目标。让我们从安装Airflow开始，这可以通过pip工具轻松完成:</p><pre class="kj kk kl km gt ns mz nt nu aw nv bi"><span id="058c" class="lv lw it mz b gy nw nx l ny nz">$ pip install apache-airflow</span></pre><p id="cd08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一切都是正确的，通过运行<code class="fe mw mx my mz b">$ airflow version</code>,您应该会看到类似这样的内容:</p><pre class="kj kk kl km gt ns mz nt nu aw nv bi"><span id="3b02" class="lv lw it mz b gy nw nx l ny nz">____________       _____________</span><span id="6591" class="lv lw it mz b gy oa nx l ny nz">____    |__( )_________  __/__  /________      __</span><span id="3493" class="lv lw it mz b gy oa nx l ny nz">____  /| |_  /__  ___/_  /_ __  /_  __ \_ | /| / /</span><span id="95d5" class="lv lw it mz b gy oa nx l ny nz">___  ___ |  / _  /   _  __/ _  / / /_/ /_ |/ |/ /</span><span id="bef1" class="lv lw it mz b gy oa nx l ny nz">_/_/  |_/_/  /_/    /_/    /_/  \____/____/|__/  v1.10.9</span></pre><p id="b535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Airflow应该已经创建了一个AIRFLOW_HOME文件夹，并在其中创建了一个<code class="fe mw mx my mz b">dags</code>文件夹(如果没有，自己创建。)在主文件夹中，我们调用</p><pre class="kj kk kl km gt ns mz nt nu aw nv bi"><span id="3c37" class="lv lw it mz b gy nw nx l ny nz">$ airflow initdb</span></pre><p id="fc88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以便初始化与工作流相关的数据库。完成后，你会发现包含初始设置的<code class="fe mw mx my mz b">airflow.db</code>数据库文件和<code class="fe mw mx my mz b">airflow.cfg</code>文件。最后，我们呼吁</p><pre class="kj kk kl km gt ns mz nt nu aw nv bi"><span id="9836" class="lv lw it mz b gy nw nx l ny nz">$ airflow webserver</span></pre><p id="882e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">启动气流图形用户界面。转到<a class="ae ky" href="https://localhost:8080" rel="noopener ugc nofollow" target="_blank"> https://localhost:8080 </a>，您应该会看到类似这样的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/7d4bfdef4c1d737461ce56a662635699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pMRFFx7aY7246r5UoSPxMQ.png"/></div></div></figure><p id="6e7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你现在看到的是一组默认的气流例子(要隐藏它们，去<code class="fe mw mx my mz b">airflow.cfg</code>文件并设置<code class="fe mw mx my mz b">load_examples=False</code>)。)注意这些被称为<em class="mt"> DAG </em> s:</p><blockquote class="nm nn no"><p id="c591" class="kz la mt lb b lc ld ju le lf lg jx lh np lj lk ll nq ln lo lp nr lr ls lt lu im bi translated">在Airflow中，一个<code class="fe mw mx my mz b">DAG</code>——或者一个有向无环图——是你想要运行的所有任务的集合，以一种反映它们的关系和依赖的方式组织。</p><p id="046f" class="kz la mt lb b lc ld ju le lf lg jx lh np lj lk ll nq ln lo lp nr lr ls lt lu im bi translated">DAG是在Python脚本中定义的，它将DAG结构(任务及其依赖项)表示为代码。</p></blockquote><p id="34fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，我们需要编写Python脚本，其中包含一系列按照指定顺序执行的任务。它们按照时间表运行，使用<a class="ae ky" href="https://crontab.guru" rel="noopener ugc nofollow" target="_blank"> Cron </a>的语法。</p><h2 id="6097" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">新冠肺炎的例子</h2><p id="9061" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">回到我们的新冠肺炎追踪器。(这也提供了DAG的简单示例；对于更复杂的任务，请参考文档。)</p><p id="8dd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要创建一个DAG，包含我们想要执行的任务，以保持我们的跟踪器更新:在一个Python文件<code class="fe mw mx my mz b">dags/covid_dag.py</code>中，我们导入基本模块并定义<code class="fe mw mx my mz b">default_args</code>，如下所示:</p><pre class="kj kk kl km gt ns mz nt nu aw nv bi"><span id="4cff" class="lv lw it mz b gy nw nx l ny nz">from airflow import DAG<br/>from airflow.operators.bash_operator import BashOperator<br/>from airflow.operators.python_operator import PythonOperator<br/>import datetime as dt</span><span id="27d2" class="lv lw it mz b gy oa nx l ny nz">default_args = {<br/>    'owner': 'airflow',<br/>    'start_date': dt.datetime(2020, 4, 1, 1, 00, 00),<br/>    'retries': 1<br/>}</span></pre><p id="d972" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">气流操作员允许执行特定类型的任务。例如，我们可以在DAG文件中复制/粘贴<code class="fe mw mx my mz b">bokeh_plot</code>函数，并让<code class="fe mw mx my mz b">PythonOperator</code>调用它。类似地，您可以在外部脚本中拥有该函数，导入它并用相同的操作符调用它。另一个选择是拥有一个包含所有函数的外部python脚本，并让一个<code class="fe mw mx my mz b">BashOperator</code>为您运行它。这就是我们将要做的。</p><p id="b6b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mw mx my mz b">start_date</code>设置工作流程执行的时间。可以是过去的某个日期。<code class="fe mw mx my mz b">retries</code>参数告诉DAG应该运行多少次，以防执行不成功。</p><p id="5d33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们定义DAG参数:</p><pre class="kj kk kl km gt ns mz nt nu aw nv bi"><span id="4983" class="lv lw it mz b gy nw nx l ny nz">dag = DAG('covid',<br/>          default_args=default_args,<br/>          schedule_interval='0 1 * * *',<br/>          catchup=False<br/>          )</span></pre><p id="0fa4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个参数是DAG的名称。<code class="fe mw mx my mz b">schedule_interval</code>告知执行频率—对于我们的案例，每天在<strong class="lb iu">凌晨1点</strong>执行。为了避免常见的陷阱，需要注意以下几点:</p><ul class=""><li id="9f3a" class="oc od it lb b lc ld lf lg li oe lm of lq og lu oh oi oj ok bi translated">正如您在GUI的右上角看到的，Airflow使用UTC时间。</li><li id="e4cd" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated">设置计划时，将开始日期与计划对齐。<em class="mt">如果计划在世界协调时凌晨2点运行，开始日期也应该在世界协调时凌晨2点。</em></li></ul><p id="8122" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请花些时间阅读这些条目，为你未来的努力节省能量:</p><ul class=""><li id="a4aa" class="oc od it lb b lc ld lf lg li oe lm of lq og lu oh oi oj ok bi translated"><a class="ae ky" href="https://cwiki.apache.org/confluence/display/AIRFLOW/Common+Pitfalls" rel="noopener ugc nofollow" target="_blank">https://CWI ki . Apache . org/confluence/display/air flow/Common+陷阱</a></li><li id="069e" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" href="https://airflow.apache.org/docs/stable/scheduler.html" rel="noopener ugc nofollow" target="_blank">https://airflow.apache.org/docs/stable/scheduler.html</a></li></ul><p id="e6cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据<code class="fe mw mx my mz b">schedule_interval</code>，从开始日期到当前日期，可能有多次执行。<code class="fe mw mx my mz b">catchup</code>告知当我们打开DAG时是否应该执行这些执行。</p><p id="3927" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将完整的<em class="mt"> load-clean-bokehplot </em>代码打包到一个<code class="fe mw mx my mz b">covid_func.py</code>脚本中——当运行时，它应该在脚本所在的同一文件夹中输出散景图；但是，由于我们希望将它托管在您的GitHub网站中，您可以通过将输出目录设置为</p><p id="1ffb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mw mx my mz b">save(p, ‘YourGithubPageDirectoryPath/index.html’.format(cat))</code></p><p id="ded9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所述，我们只想运行脚本，所以我们可以调用<code class="fe mw mx my mz b">BashOperator</code>来执行任务。它应该是这样的:</p><pre class="kj kk kl km gt ns mz nt nu aw nv bi"><span id="7669" class="lv lw it mz b gy nw nx l ny nz"># replace PathToYourFile for the directory path</span><span id="9da8" class="lv lw it mz b gy oa nx l ny nz">command_t1 = 'python PathToYourFile/covid_func.py '</span><span id="4389" class="lv lw it mz b gy oa nx l ny nz">t1 = BashOperator(<br/>          task_id = 'covidPlots',<br/>          bash_command = command_t1<br/>          dag = dag<br/>)</span></pre><p id="3cde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要提交和推送文件。从终端提交和推送文件需要几个步骤，实际上，多亏了<code class="fe mw mx my mz b"><a class="ae ky" href="https://gitpython.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">GitPython</a></code>，它们也可以用Python来完成。因此，我决定写一个提交和推送的小脚本，然后用另一个<code class="fe mw mx my mz b">BashOperator</code>调用它:</p><pre class="kj kk kl km gt ns mz nt nu aw nv bi"><span id="5aa5" class="lv lw it mz b gy nw nx l ny nz">from git import Repo<br/>import os<br/><br/>os.chdir(<!-- -->YourGithubPageDirectoryPath<!-- -->)<br/><br/>PATH_OF_GIT_REPO = <!-- -->YourGithubPageDirectoryPath<!-- -->/.git'</span><span id="6d23" class="lv lw it mz b gy oa nx l ny nz">COMMIT_MESSAGE = 'Daily update'<br/><br/>def git_push():<br/><br/>    repo = Repo(PATH_OF_GIT_REPO)<br/>    repo.git.add('--all')<br/>    repo.index.commit(COMMIT_MESSAGE)<br/>    origin = repo.remote(name='origin')<br/>    origin.push()<br/><br/><br/>git_push()</span></pre><p id="5677" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这要求<code class="fe mw mx my mz b">git</code>被正确配置，并且你被允许连接到GitHub而不需要在每次访问时提供你的用户名或密码。这是通过SSH完成的，详情请查看此<a class="ae ky" href="https://help.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="d337" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mt">侧注:气流提供了一堆不同的</em> <a class="ae ky" href="https://airflow.apache.org/docs/stable/_api/airflow/operators/index.html" rel="noopener ugc nofollow" target="_blank"> <em class="mt">运算符</em> </a> <em class="mt">。其中之一就是</em> <code class="fe mw mx my mz b"><a class="ae ky" href="https://airflow-plugins.readthedocs.io/en/latest/plugins/operators/git.html" rel="noopener ugc nofollow" target="_blank"><em class="mt">GitOperator</em></a></code> <em class="mt">。如果你愿意，你可以自己尝试。</em></p><p id="b196" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在准备给你的<code class="fe mw mx my mz b">covid_dag.py</code>添加下一个任务:</p><pre class="kj kk kl km gt ns mz nt nu aw nv bi"><span id="70ed" class="lv lw it mz b gy nw nx l ny nz">command_t2 = 'python PathToYourFile/git_push.py '</span><span id="4959" class="lv lw it mz b gy oa nx l ny nz">t2 = BashOperator(<br/>                  task_id = 'gitPush',<br/>                  bash_command = command_t2,<br/>                  dag = dag<br/>)<br/><br/>t3 = BashOperator(<br/>                 task_id = 'gitPush_repit',<br/>                 bash_command = command_t2,<br/>                 dag = dag)<br/><br/>t1 &gt;&gt; t2 &gt;&gt; t3</span></pre><p id="e8bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，我决定重复这个任务，只是为了确保推的发生——没有危险。</p><p id="70a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们用<code class="fe mw mx my mz b">&gt;&gt;</code>操作符指定任务的顺序。</p><p id="b7b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的狗现在准备好了！让我们再次调用<code class="fe mw mx my mz b">$ airflow initdb</code>来设置它并打开气流GUI——您的新covid DAG应该在那里。如果您单击它并转到树形视图，您应该能够看到工作流程:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/6a9feea5b07ccc7e542bc3eee780aa35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Occm0If9nL9ExxngRDRtUg.jpeg"/></div></div></figure><p id="7ab5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到主页，打开它！</p><p id="b726" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个旅程的最后一步是返回命令行并调用</p><pre class="kj kk kl km gt ns mz nt nu aw nv bi"><span id="7b37" class="lv lw it mz b gy nw nx l ny nz">$ airflow scheduler</span></pre><p id="c7ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的死刑应该在明天凌晨1点执行。</p><p id="a368" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mt">最后一点，您可以随时点击链接栏中的Trigger Dag，手动执行它并检查它是否工作正常。如果出现任何问题，您应该能够在日志中跟踪错误。</em></p><h1 id="561a" class="nb lw it bd lx nc nd ne ma nf ng nh md jz ni ka mg kc nj kd mj kf nk kg mm nl bi translated">摘要</h1><p id="83e5" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在这篇文章中，我们采用了广泛使用的used新冠肺炎数据集，并为前10个国家(死亡人数较多的国家)的每日死亡人数创建了一个高度互动的散景图。然后我们将它提交到GitHub页面。</p><p id="04bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于数据每天都在更新，所以绘图也应该如此。为此，我们设置了Apache Airflow，创建了一个新的DAG，其中包含每天更新数据所需的任务集，并启动了Airflow调度程序。</p><p id="3f3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我又创建了几个图表，都放在我的GitHub网站上。你可以在这里查看:<a class="ae ky" href="https://hectoramirez.github.io/covid/COVID19.html" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"/></a></p><p id="0485" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="mt">欢迎在评论中留下任何想法或问题！</em> </strong></p><p id="83df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">更新(2021): </strong>网页不再维护。完整的代码可以在这个<a class="ae ky" href="https://github.com/hectoramirez/Covid19" rel="noopener ugc nofollow" target="_blank">库</a>中找到。</p><h2 id="8114" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">参考</h2><div class="or os gp gr ot ou"><a rel="noopener follow" target="_blank" href="/6-reasons-i-love-bokeh-for-data-exploration-with-python-a778a2086a95"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">我喜欢用Python进行数据探索的6个理由</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">散景已经存在很多年了，但我只是最近才真正发现它，没多久它就成了我的最爱…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">towardsdatascience.com</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi ks ou"/></div></div></a></div><div class="or os gp gr ot ou"><a rel="noopener follow" target="_blank" href="/getting-started-with-apache-airflow-df1aa77d7b1b"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">Apache Airflow入门</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">在这篇文章中，我将讨论由Airbnb开发的工作流管理系统Apache Airflow。</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">towardsdatascience.com</p></div></div><div class="pd l"><div class="pj l pf pg ph pd pi ks ou"/></div></div></a></div><div class="or os gp gr ot ou"><a href="https://medium.com/zenofai/a-beginners-guide-to-airflow-3572ddd14731" rel="noopener follow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">气流初学者指南</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">Airflow用于创建简单和复杂的代码管道，我们可以在其中调度和监控我们的工作流。一个…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">medium.com</p></div></div><div class="pd l"><div class="pk l pf pg ph pd pi ks ou"/></div></div></a></div><div class="or os gp gr ot ou"><a href="https://www.ft.com/coronavirus-latest?fbclid=IwAR2Pi_sryd7x2ZvOt_y0J0_00N5mDQeYLvBc4DfMr6bpninqV75dcxRtEsA" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">冠状病毒追踪:疫情传播的最新数据|免费阅读</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">冠状病毒爆发的人类成本持续上升，全球确诊病例超过207万例，而…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">www.ft.com</p></div></div><div class="pd l"><div class="pl l pf pg ph pd pi ks ou"/></div></div></a></div></div></div>    
</body>
</html>