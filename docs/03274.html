<html>
<head>
<title>DATE/TIME Functions in SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL 中的日期/时间函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/date-time-functions-in-sql-1885e2cbdc1a?source=collection_archive---------3-----------------------#2020-03-29">https://towardsdatascience.com/date-time-functions-in-sql-1885e2cbdc1a?source=collection_archive---------3-----------------------#2020-03-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fb3d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用 CAST、EXTRACT 和 DATE_TRUNC 的教程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e85c576fd3b686d3ad148d31426da043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xncPjjZkyPpkjdqK"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@goumbik?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卢卡斯·布拉塞克</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="d1ae" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">什么是时序数据？</h1><p id="40e8" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在使用 SQL 时，处理日期和时间是一种常见的做法。使用日期，我们可以计算随时间的变化，数据的趋势，执行区间运算。更好地理解潜在业务问题的影响。</p><blockquote class="mk ml mm"><p id="868c" class="lo lp mn lq b lr mo jr lt lu mp ju lw mq mr lz ma ms mt md me mu mv mh mi mj ij bi translated"><a class="ae kv" href="https://blog.timescale.com/blog/what-the-heck-is-time-series-data-and-why-do-i-need-a-time-series-database-dcf3b1b18563/" rel="noopener ugc nofollow" target="_blank">时序数据</a>作为一系列数据点，随着时间的推移测量同一事物，按时间顺序存储。</p></blockquote><p id="817c" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">时序数据的一些常见用途</p><ul class=""><li id="3ee3" class="mw mx iq lq b lr mo lu mp lx my mb mz mf na mj nb nc nd ne bi translated">股票价格变动</li><li id="5dc5" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nb nc nd ne bi translated">传感器跟踪(例如，天气跟踪)</li><li id="f063" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nb nc nd ne bi translated">租赁服务(如自行车或踏板车租赁)</li></ul></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="6f4f" class="kw kx iq bd ky kz nr lb lc ld ns lf lg jw nt jx li jz nu ka lk kc nv kd lm ln bi translated">我们开始吧</h1><p id="0888" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于本教程，我将假设您具有中级 SQL 技能。我们将讨论三个函数并使用 PostgreSQL 语法。</p><ol class=""><li id="7e24" class="mw mx iq lq b lr mo lu mp lx my mb mz mf na mj nw nc nd ne bi translated">投</li><li id="28a6" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nw nc nd ne bi translated">提取</li><li id="539d" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nw nc nd ne bi translated">日期 _TRUNC</li></ol><p id="7a6e" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">当分解包含大量数据的数据集时，这些函数都很有用。当我们通过一些例子浏览代码时，我们将会看到每种方法的优点。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="797a" class="kw kx iq bd ky kz nr lb lc ld ns lf lg jw nt jx li jz nu ka lk kc nv kd lm ln bi translated">铸造功能</h1><p id="1be7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">一个<code class="fe nx ny nz oa b">CAST</code>函数将选择的数据类型转换成另一种类型。相当直接。它把一种类型变成你喜欢的类型。语法如下。</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="49cb" class="of kx iq oa b gy og oh l oi oj">CAST(expression AS <strong class="oa ir">datatype</strong>)</span></pre><p id="be9a" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">下面是一个如何应用于日期和时间的例子。</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="5279" class="of kx iq oa b gy og oh l oi oj">SELECT<br/>    NOW(),<br/>    CAST(NOW() AS TIMESTAMP),<br/>    CAST(NOW() AS DATE),<br/>    CAST(NOW() AS TIME),<br/>    CURRENT_DATE,<br/>    CURRENT_TIME</span></pre><p id="21ae" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">在这个查询中，我们期望有 6 个输出。如果您不熟悉<code class="fe nx ny nz oa b">NOW()</code>、<code class="fe nx ny nz oa b">CURRENT_DATE</code>、<code class="fe nx ny nz oa b">CURRENT_TIME</code>，它们是检索当前时间或日期的 SQL 函数。以下是按顺序排列的查询的所有输出。(注意—由于这些函数调用的是确切的时间或日期，因此您将获得不同的数字)</p><ul class=""><li id="9123" class="mw mx iq lq b lr mo lu mp lx my mb mz mf na mj nb nc nd ne bi">2020–03–28 23:18:20.261879+00:00</li><li id="f4e8" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nb nc nd ne bi">2020–03–28 23:18:20.261879</li><li id="fc42" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nb nc nd ne bi">2020–03–28</li><li id="c816" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nb nc nd ne bi">23:18:20.261879</li><li id="7409" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nb nc nd ne bi">2020–03–28</li><li id="0f41" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nb nc nd ne bi">23:18:20.261879+00:00</li></ul><p id="756c" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">查看来自单独使用的<code class="fe nx ny nz oa b">NOW()</code>的第一个结果，我们得到一个完整的时间戳值，包括时区。现在我们来看第二个输出，我们使用<code class="fe nx ny nz oa b">CAST</code>只检索时间戳，不包括来自<code class="fe nx ny nz oa b">NOW()</code>的时区。现在我们可以看到 cast 是如何工作的了。我们传入一个我们想要转换的值，然后声明我们想要的类型。</p><p id="739d" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">接下来，我们在<code class="fe nx ny nz oa b">NOW()</code>上使用<code class="fe nx ny nz oa b">CAST()</code>，但是传入<code class="fe nx ny nz oa b">DATE</code>作为我们想要的类型。我们现在得到了一个时间戳，只保留了年/月/日格式。类似地，看看只有<code class="fe nx ny nz oa b">TIME</code>和<code class="fe nx ny nz oa b">NOW()</code>的<code class="fe nx ny nz oa b">CAST()</code>函数，我们得到的只是没有日期的时间值。</p><p id="0864" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">我们可以看到<code class="fe nx ny nz oa b">CAST</code>函数如何与时间一起工作，使用<code class="fe nx ny nz oa b">CURRENT_DATE</code>和<code class="fe nx ny nz oa b">CURRENT_TIME</code>的最后两个输出只是为了让您看到结果的比较。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h2 id="a6f7" class="of kx iq bd ky ok ol dn lc om on dp lg lx oo op li mb oq or lk mf os ot lm ou bi translated">更多示例—不带时间戳</h2><p id="2562" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">SQL 还允许<code class="fe nx ny nz oa b">CAST()</code>函数用于没有时间戳的类型。</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="6359" class="of kx iq oa b gy og oh l oi oj">SELECT <br/>    CAST(1.34 AS INT),<br/>    CAST(1 AS BOOLEAN),<br/>    CAST(2.65 AS DEC(3,0))</span></pre><p id="f5fb" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">该查询的结果是，</p><ul class=""><li id="5820" class="mw mx iq lq b lr mo lu mp lx my mb mz mf na mj nb nc nd ne bi translated">1 →因为整数不能有小数，所以会四舍五入到最接近的整数值</li><li id="aef5" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nb nc nd ne bi translated">true → 1 作为布尔值为真，0 为假</li><li id="073b" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nb nc nd ne bi translated">3 →使用<code class="fe nx ny nz oa b">DEC()</code>我们也可以做第一次整数转换的反向操作。</li></ul></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h2 id="1ba6" class="of kx iq bd ky ok ol dn lc om on dp lg lx oo op li mb oq or lk mf os ot lm ou bi translated">间隔</h2><p id="9fb4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在 SQL 中，您还可以使用<code class="fe nx ny nz oa b">INTERVAL</code>为您拥有的任何时间戳添加更多时间。对于下面的例子，您不需要使用<code class="fe nx ny nz oa b">CAST()</code>函数，但是我选择这样做只是为了得到日期。</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="3c60" class="of kx iq oa b gy og oh l oi oj">SELECT<br/>    CAST(NOW() AS DATE) AS TODAY_DATE,<br/>    CAST((<strong class="oa ir">INTERVAL </strong>'3 DAYS' + NOW()) AS DATE) AS three_days,<br/>    CAST((<strong class="oa ir">INTERVAL </strong>'3 WEEKS' + NOW()) AS DATE) AS three_weeks,<br/>    CAST((<strong class="oa ir">INTERVAL </strong>'3 MONTHS' + NOW()) AS DATE) AS three_months,<br/>    CAST((<strong class="oa ir">INTERVAL </strong>'3 YEARS' + NOW()) AS DATE) AS three_years</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/17fdec9ad5763d1bd7e67858fda35f5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*my__677XldKvkIdZk7031g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd ow">输出</strong></p></figure><p id="3be4" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">我们可以看到，除了以天、周、月或年为单位的时间间隔长度之外，使用<code class="fe nx ny nz oa b">INTERVAL</code>会为您拥有的任何日期增加更多时间——在本例中，当前日期是从<code class="fe nx ny nz oa b">NOW()</code>获得的。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="6e91" class="kw kx iq bd ky kz nr lb lc ld ns lf lg jw nt jx li jz nu ka lk kc nv kd lm ln bi translated">提取()</h1><p id="5a3a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">接下来，我们可以看看从时间戳中提取特定的格式。目标是从时间戳中提取一部分。例如，如果我们只需要 2018 年 12 月 10 日的月份，我们将得到 12 月(12)。</p><p id="e11e" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">让我们来看看<code class="fe nx ny nz oa b">EXTRACT</code>的语法</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="6bfc" class="of kx iq oa b gy og oh l oi oj">EXTRACT(part FROM date)</span></pre><p id="ec21" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">我们声明我们想要的提取类型为<em class="mn">部分</em>，然后是要提取的源<em class="mn">日期</em>。<code class="fe nx ny nz oa b">EXTRACT</code>是时间序列数据分析的重要工具。它可以帮助您隔离时间戳中的组，以便基于精确的计时来聚合数据。例如，如果一家汽车租赁店想在每个<code class="fe nx ny nz oa b">MAY</code>找到<code class="fe nx ny nz oa b">MONDAYS</code>最繁忙的租赁<code class="fe nx ny nz oa b">HOUR</code>，您可以使用<code class="fe nx ny nz oa b">EXTRACT</code>来完成。你可以深入细节，看到更多有价值的见解。</p><p id="2c82" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">假设我们运行<code class="fe nx ny nz oa b">NOW()</code>，我们的时间戳是<strong class="lq ir">2020–03–29 00:27:51.677318+00:00</strong>，我们可以使用<code class="fe nx ny nz oa b">EXTRACT</code>得到以下内容。</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="9ca4" class="of kx iq oa b gy og oh l oi oj">SELECT<br/>    EXTRACT(MINUTE      FROM NOW()) AS MINUTE,<br/>    EXTRACT(HOUR        FROM NOW()) AS HOUR,<br/>    EXTRACT(DAY         FROM NOW()) AS DAY,<br/>    EXTRACT(WEEK        FROM NOW()) AS WEEK,<br/>    EXTRACT(MONTH       FROM NOW()) AS MONTH,<br/>    EXTRACT(YEAR        FROM NOW()) AS YEAR,<br/>    EXTRACT(DOW         FROM NOW()) AS DAY_OF_WEEK,<br/>    EXTRACT(DOY         FROM NOW()) AS DAY_OF_YEAR,<br/>    EXTRACT(QUARTER     FROM NOW()) AS QUARTER,<br/>    EXTRACT(TIMEZONE    FROM NOW()) AS TIMEZONE</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/8945e299e82a0a2047c15d9941213f23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXEpTk-8LCLfRASIhBOu1A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd ow">输出</strong></p></figure><p id="d8c2" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">我们看到，我们可以深入了解如何从时间戳中提取信息。注意— DOW —一周中的某一天是星期日(0)到星期六(6)。</p><p id="a1b3" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">我们可以在前面的租车例子的基础上，看看它是如何工作的。</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="cda5" class="of kx iq oa b gy og oh l oi oj">SELECT <br/>  EXTRACT(HOUR FROM RENTAL_DATE) AS HOUR, <br/>  COUNT(*) as RENTALS <br/>FROM RENTAL <br/>WHERE<br/>    EXTRACT(DOW   FROM RENTAL_DATE) = 1 AND<br/>    EXTRACT(MONTH FROM RENTAL_DATE) = 5<br/>GROUP BY 1<br/>ORDER BY RENTALS DESC</span></pre><p id="02ed" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">请记住，我们希望每个<code class="fe nx ny nz oa b">MAY</code>的<code class="fe nx ny nz oa b">MONDAYS</code>有最繁忙的出租<code class="fe nx ny nz oa b">HOUR</code>。首先，我们在<code class="fe nx ny nz oa b">SELECT</code>中使用<code class="fe nx ny nz oa b">EXTRCT</code>来声明，我们只需要<code class="fe nx ny nz oa b">HOUR</code>和总计<code class="fe nx ny nz oa b">COUNT</code>。然后我们在<code class="fe nx ny nz oa b">WHERE</code>子句中为传递两个<code class="fe nx ny nz oa b">EXTRACT</code>函数，以便只过滤<code class="fe nx ny nz oa b">MONDAYS</code>和<code class="fe nx ny nz oa b">MAY</code>。看下面的表格，上午 11 点是 5 月份每周一最受欢迎的出租时间，共有 11 次出租。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/ecc5faad73408d83246b8a828744d4a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*duHwWUSIqFXhJN_XE7AXZw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd ow">输出</strong></p></figure></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="bfb2" class="kw kx iq bd ky kz nr lb lc ld ns lf lg jw nt jx li jz nu ka lk kc nv kd lm ln bi translated">日期 _TRUNC</h1><blockquote class="oz"><p id="74ed" class="pa pb iq bd pc pd pe pf pg ph pi mj dk translated">截断——通过或仿佛通过切断来缩短</p></blockquote><p id="0365" class="pw-post-body-paragraph lo lp iq lq b lr pj jr lt lu pk ju lw lx pl lz ma mb pm md me mf pn mh mi mj ij bi translated">在 SQL 中截断日期的目的是以绝对精度返回一个间隔。精度值是可用于<code class="fe nx ny nz oa b">EXTRACT</code>的字段标识符的子集。<code class="fe nx ny nz oa b">DATE_TRUNC</code>将返回一个时间间隔或时间戳而不是一个数字。</p><p id="2176" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated"><code class="fe nx ny nz oa b">DATE_TRUNC</code>、<code class="fe nx ny nz oa b">time_column</code>的<a class="ae kv" href="https://mode.com/blog/date-trunc-sql-timestamp-function-count-on" rel="noopener ugc nofollow" target="_blank">语法</a>是包含您想要舍入的时间戳的数据库列，而<code class="fe nx ny nz oa b">‘[interval]’</code>表示您想要的精度级别。</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="edf0" class="of kx iq oa b gy og oh l oi oj">DATE_TRUNC(‘[interval]’, time_column)</span></pre><p id="49dd" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">让我们假设我们的<code class="fe nx ny nz oa b">NOW()</code>返回相同的<strong class="lq ir">2020–03–29 00:27:51.677318+00:00</strong>，我们可以使用<code class="fe nx ny nz oa b">date_part</code>得到如下。</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="9c81" class="of kx iq oa b gy og oh l oi oj">SELECT<br/>    CAST(DATE_TRUNC('DAY', NOW()) AS DATE) AS DAY,<br/>    CAST(DATE_TRUNC('WEEK', NOW()) AS DATE) AS WEEK,<br/>    CAST(DATE_TRUNC('MONTH', NOW()) AS DATE) AS MONTH,<br/>    CAST(DATE_TRUNC('YEAR', NOW()) AS DATE) AS YEAR</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi po"><img src="../Images/a572ae818db92b53d6f337c2bb0f2071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*7vzBw-PBjiHX9XkqnS0D6A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd ow">输出</strong></p></figure><p id="6c8b" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">可以把使用<code class="fe nx ny nz oa b">DATE_TRUNC</code>看作是获取当前位置的间隔，间隔的每一层都是日期被修整的方式。注意——在这个例子中，我们不需要使用<code class="fe nx ny nz oa b">CAST</code>。我用它来确保格式干净，便于分析。</p><p id="46d4" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">我们可以在前面的租车场景中使用<code class="fe nx ny nz oa b">DATE_TRUNC</code>,并尝试找出一年中的哪一天(不考虑时间)更受欢迎。</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="2ae8" class="of kx iq oa b gy og oh l oi oj">SELECT<br/>    CAST(DATE_TRUNC('DAY', RENTAL_DATE) AS DATE) AS RENTAL_DAY,<br/>    COUNT(*) AS RENTALS<br/>FROM RENTAL<br/>GROUP BY<br/>    RENTAL_DAY<br/>ORDER BY RENTALS DESC</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/2fe0ea87358df476961be4f73fcde3ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*xFG3eh1XEFtc2Cxr2kLKmQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd ow">输出</strong></p></figure></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="3f3a" class="kw kx iq bd ky kz nr lb lc ld ns lf lg jw nt jx li jz nu ka lk kc nv kd lm ln bi translated">把所有的放在一起</h1><p id="29fc" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">既然我们已经看到了如何使用<code class="fe nx ny nz oa b">CAST</code>、<code class="fe nx ny nz oa b">EXTRACT</code>和<code class="fe nx ny nz oa b">DATE_TRUNC</code>，我们可以将我们学到的一些技术整合到一个实际的例子中。</p><p id="4881" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">对于本例，我们将添加一个名为<code class="fe nx ny nz oa b">AGE</code>的新时间函数，它接受 2 个日期作为参数，并输出“<a class="ae kv" href="https://w3resource.com/PostgreSQL/age-function.php" rel="noopener ugc nofollow" target="_blank">年龄</a>”或日期之间的年和月时间。</p><p id="8067" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">让我们通过从<code class="fe nx ny nz oa b">2019–05–01</code> + <code class="fe nx ny nz oa b">30 days</code>中提取租赁持续时间最长(<code class="fe nx ny nz oa b">AGE</code>)的客户列表来结束本教程。</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="8264" class="of kx iq oa b gy og oh l oi oj">SELECT<br/>    CUSTOMER_ID,<br/>    <strong class="oa ir">EXTRACT</strong>(DOW FROM RENTAL_DATE) AS DAY_OF_WEEK,<br/>    <strong class="oa ir">AGE</strong>(RETURN_DATE, RENTAL_DATE) AS RENTAL_DAYS<br/>FROM<br/>    RENTAL<br/>WHERE <br/>    RENTAL_DATE <br/>        BETWEEN <strong class="oa ir">CAST</strong>('2019-05-01' AS TIMESTAMP) AND<br/>                <strong class="oa ir">CAST</strong>('2019-05-01' AS TIMESTAMP) + <strong class="oa ir">INTERVAL </strong>'30 DAY'<br/>ORDER BY 3 DESC</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/66f6c973c9eca0c2c7a5c1666627ed2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*3H9IKIigIG8ewwHi5lPaaA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd ow">输出</strong></p></figure></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="fea3" class="kw kx iq bd ky kz nr lb lc ld ns lf lg jw nt jx li jz nu ka lk kc nv kd lm ln bi translated">最终结果</h1><p id="4b33" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我希望您对在 SQL 中使用时间戳感到舒适。你已经学会使用<code class="fe nx ny nz oa b">CAST</code>、<code class="fe nx ny nz oa b">EXTRACT</code>、<code class="fe nx ny nz oa b">INTERVAL</code>、<code class="fe nx ny nz oa b">DATE_TRUNC</code>、<code class="fe nx ny nz oa b">AGE</code>。您应该做好充分准备来处理与趋势相关的分析，并更深入地挖掘数据，以找到您以前可能无法找到的见解！</p><p id="d898" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">如果你对更多的 SQL 教程感兴趣，可以看看我的其他帖子。</p><ul class=""><li id="69c6" class="mw mx iq lq b lr mo lu mp lx my mb mz mf na mj nb nc nd ne bi translated"><a class="ae kv" rel="noopener" target="_blank" href="/using-ctes-to-improve-sql-queries-dfcb04b7edf0">如何在 SQL 中使用 cte</a></li><li id="4d59" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nb nc nd ne bi translated"><a class="ae kv" rel="noopener" target="_blank" href="/intro-to-window-functions-in-sql-23ecdc7c1ceb">窗口功能介绍</a></li><li id="c72c" class="mw mx iq lq b lr nf lu ng lx nh mb ni mf nj mj nb nc nd ne bi translated"><a class="ae kv" rel="noopener" target="_blank" href="/creating-tables-in-sql-96cfb8223827">在 SQL 中创建表格</a></li></ul><p id="65a7" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mr lz ma mb mt md me mf mv mh mi mj ij bi translated">在<a class="ae kv" href="https://www.linkedin.com/in/jasonmchlee/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> Linkedin </strong> </a>或<a class="ae kv" href="https://github.com/jasonmchlee" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> Github </strong> </a>上与我联系</p></div></div>    
</body>
</html>