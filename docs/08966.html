<html>
<head>
<title>Reshape R dataframes wide-to-long with melt — tutorial and visualization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用熔体重塑宽到长的 R 数据帧——教程和可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/reshape-r-dataframes-wide-to-long-with-melt-tutorial-and-visualization-ddf130cd9299?source=collection_archive---------10-----------------------#2020-06-28">https://towardsdatascience.com/reshape-r-dataframes-wide-to-long-with-melt-tutorial-and-visualization-ddf130cd9299?source=collection_archive---------10-----------------------#2020-06-28</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="e4d8" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">你唯一需要的函数和教程</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/68a79a7a08d2f4c6640246c2d3630d3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LO40fnD-KI_kmGhEvY-9rg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">R 中的 melt()如何工作的总结</p></figure><p id="f627" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在 R 语言中，如何将一个数据帧从宽格式变成长格式？<code class="fe lv lw lx ly b">melt()</code>函数如何重塑 R 中的数据帧？本教程将引导您使用 r 中的<code class="fe lv lw lx ly b">melt</code>函数重塑数据帧。</p><p id="51b1" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果你正在用 Python 重塑数据帧或数组，看看我下面的教程。</p><div class="lz ma gq gs mb mc"><a rel="noopener follow" target="_blank" href="/reshape-pandas-dataframe-with-melt-in-python-tutorial-and-visualization-29ec1450bb02"><div class="md ab fp"><div class="me ab mf cl cj mg"><h2 class="bd iv gz z fq mh fs ft mi fv fx it bi translated">使用 Python 中的 melt 重塑熊猫数据框—教程和可视化</h2><div class="mj l"><h3 class="bd b gz z fq mh fs ft mi fv fx dk translated">想象一下 pd.melt 是如何将熊猫数据帧从宽到长进行整形的</h3></div><div class="mk l"><p class="bd b dl z fq mh fs ft mi fv fx dk translated">towardsdatascience.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq kt mc"/></div></div></a></div><div class="lz ma gq gs mb mc"><a rel="noopener follow" target="_blank" href="/reshape-pandas-dataframe-with-pivot-table-in-python-tutorial-and-visualization-2248c2012a31"><div class="md ab fp"><div class="me ab mf cl cj mg"><h2 class="bd iv gz z fq mh fs ft mi fv fx it bi translated">用 Python 中的 pivot_table 重塑熊猫数据框—教程和可视化</h2><div class="mj l"><h3 class="bd b gz z fq mh fs ft mi fv fx dk translated">使用 pd.pivot_table 将 long 转换为 wide</h3></div><div class="mk l"><p class="bd b dl z fq mh fs ft mi fv fx dk translated">towardsdatascience.com</p></div></div><div class="ml l"><div class="mr l mn mo mp ml mq kt mc"/></div></div></a></div><div class="lz ma gq gs mb mc"><a rel="noopener follow" target="_blank" href="/reshaping-numpy-arrays-in-python-a-step-by-step-pictorial-tutorial-aed5f471cf0b"><div class="md ab fp"><div class="me ab mf cl cj mg"><h2 class="bd iv gz z fq mh fs ft mi fv fx it bi translated">在 Python 中重塑 numpy 数组—一步一步的图形教程</h2><div class="mj l"><h3 class="bd b gz z fq mh fs ft mi fv fx dk translated">本教程和备忘单提供了可视化效果，帮助您理解 numpy 如何重塑数组。</h3></div><div class="mk l"><p class="bd b dl z fq mh fs ft mi fv fx dk translated">towardsdatascience.com</p></div></div><div class="ml l"><div class="ms l mn mo mp ml mq kt mc"/></div></div></a></div><h1 id="49e8" class="mt mu iu bd mv mw mx my mz na nb nc nd ka ne kb nf kd ng ke nh kg ni kh nj nk bi translated">为什么融而不融其他功能？</h1><p id="e93b" class="pw-post-body-paragraph kz la iu lb b lc nl jv le lf nm jy lh li nn lk ll lm no lo lp lq np ls lt lu in bi translated">这种从宽到长的转换的常用术语是熔化、旋转、逆旋转、聚集、堆叠和整形。已经编写了许多函数来将数据从宽格式转换为长格式，来自<code class="fe lv lw lx ly b">data.table</code>库的<code class="fe lv lw lx ly b">melt()</code>是最好的。参见<code class="fe lv lw lx ly b">melt()</code>文档<a class="ae nq" href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-reshape.html" rel="noopener ugc nofollow" target="_blank">此处</a>。为什么？</p><ul class=""><li id="f693" class="nr ns iu lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">Python 的<a class="ae nq" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html" rel="noopener ugc nofollow" target="_blank"> pandas </a>库也有类似的<code class="fe lv lw lx ly b">melt</code>函数/方法，以同样的方式工作(参见我的 pandas melt 教程<a class="ae nq" rel="noopener" target="_blank" href="/reshape-pandas-dataframe-with-melt-in-python-tutorial-and-visualization-29ec1450bb02">这里</a>)</li><li id="8872" class="nr ns iu lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">独自一人通常足以完成你所有的从宽到长的转换；你不必学习<code class="fe lv lw lx ly b">pivot_longer</code>或<code class="fe lv lw lx ly b">gather</code></li><li id="3396" class="nr ns iu lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">像<code class="fe lv lw lx ly b">gather</code>和<code class="fe lv lw lx ly b">pivot_longer</code>这样的其他函数通常只是<code class="fe lv lw lx ly b">melt()</code>或<code class="fe lv lw lx ly b">reshape()</code>的包装函数——这些其他函数简化了<code class="fe lv lw lx ly b">melt</code>，通常不能处理更复杂的转换。</li><li id="5faa" class="nr ns iu lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe lv lw lx ly b">melt</code>比其他函数更强大，但并不复杂。</li><li id="38a1" class="nr ns iu lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe lv lw lx ly b">data.table</code>包对<code class="fe lv lw lx ly b">melt</code>的实现，非常强大——比重塑库的<code class="fe lv lw lx ly b">melt</code>功能高效强大得多。来自<a class="ae nq" href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-reshape.html" rel="noopener ugc nofollow" target="_blank">文档</a>:</li></ul><blockquote class="of"><p id="7625" class="og oh iu bd oi oj ok ol om on oo lu dk translated"><em class="op">数据表的 melt 和 dcast 函数分别用于宽到长和长到宽的整形；这些实施是专门针对大内存数据(例如 10Gb)而设计的。</em></p></blockquote><p id="8594" class="pw-post-body-paragraph kz la iu lb b lc oq jv le lf or jy lh li os lk ll lm ot lo lp lq ou ls lt lu in bi translated"><strong class="lb iv">提醒:</strong>我们使用的是来自<code class="fe lv lw lx ly b">data.table</code>库的<code class="fe lv lw lx ly b">melt</code>，而不是<code class="fe lv lw lx ly b">reshape</code>库！将两个库中的<code class="fe lv lw lx ly b">melt</code>函数文档进行比较，找出差异:<code class="fe lv lw lx ly b">?data.table::melt</code>和<code class="fe lv lw lx ly b">?reshape::melt</code></p></div><div class="ab cl ov ow hy ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="in io ip iq ir"><h1 id="69fa" class="mt mu iu bd mv mw pc my mz na pd nc nd ka pe kb nf kd pf ke nh kg pg kh nj nk bi translated">宽与长数据帧</h1><p id="e0dd" class="pw-post-body-paragraph kz la iu lb b lc nl jv le lf nm jy lh li nn lk ll lm no lo lp lq np ls lt lu in bi translated">如果我们观察一个<strong class="lb iv">宽的</strong>数据帧并将其与一个长的<strong class="lb iv"> </strong>数据帧进行比较，就很容易理解它是什么或看起来像什么。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ph"><img src="../Images/8c4272d3e396460fd7129a76dedbaf6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_i1R5IHwswYdL78V1z_cLw.png"/></div></div></figure><p id="9f93" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">下面是相应的数据帧(具有相同的信息),但是是以<strong class="lb iv">长</strong>的形式:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pi"><img src="../Images/3f6b781602b01433865145318b3e106f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*viB43bRI8m02gy5oF0r-jg.png"/></div></div></figure></div><div class="ab cl ov ow hy ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="in io ip iq ir"><p id="33e2" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在我们开始我们的<code class="fe lv lw lx ly b">melt</code>教程之前，让我们重新创建上面的宽数据框架。</p><pre class="kk kl km kn gu pj ly pk pl aw pm bi"><span id="2217" class="pn mu iu ly b gz po pp l pq pr">df_wide &lt;- data.table(<br/>  student = c("Andy", "Bernie", "Cindey", "Deb"),<br/>  school = c("Z", "Y", "Z", "Y"),<br/>  english = c(10, 100, 1000, 10000),  # eng grades<br/>  math = c(20, 200, 2000, 20000),  # math grades<br/>  physics = c(30, 300, 3000, 30000)   # physics grades<br/>)</span><span id="f432" class="pn mu iu ly b gz ps pp l pq pr">df_wide<!-- -->  <br/>   student school english  math physics<br/>1:    Andy      Z      10    20      30<br/>2:  Bernie      Y     100   200     300<br/>3:  Cindey      Z    1000  2000    3000<br/>4:     Deb      Y   10000 20000   30000</span></pre><p id="666e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">注意，我喜欢用<code class="fe lv lw lx ly b">data.table</code>而不是<code class="fe lv lw lx ly b">data.frame</code>，因为<code class="fe lv lw lx ly b">data.table</code>对象更强大。如果您的数据不是 data.table(通过在您的控制台中运行<code class="fe lv lw lx ly b">class(your_dataframe)</code>来检查)，我强烈建议您将其转换为<code class="fe lv lw lx ly b">data.table</code>。</p><pre class="kk kl km kn gu pj ly pk pl aw pm bi"><span id="e5fc" class="pn mu iu ly b gz po pp l pq pr">class(df_wide) # data.table and data.frame<br/>[1] "data.table" "data.frame"</span></pre><p id="a099" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">只需加载<code class="fe lv lw lx ly b">data.table</code>库，并使用<code class="fe lv lw lx ly b">data.table</code>库中的<code class="fe lv lw lx ly b">setDT</code>函数将任何<code class="fe lv lw lx ly b">data.frame</code>转换为<code class="fe lv lw lx ly b">data.table</code>。</p><pre class="kk kl km kn gu pj ly pk pl aw pm bi"><span id="1a5a" class="pn mu iu ly b gz po pp l pq pr">setDT(df_wide) # no reassignment required! </span></pre></div><div class="ab cl ov ow hy ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="in io ip iq ir"><h1 id="e5e2" class="mt mu iu bd mv mw pc my mz na pd nc nd ka pe kb nf kd pf ke nh kg pg kh nj nk bi translated">熔体实施例 1</h1><p id="15e8" class="pw-post-body-paragraph kz la iu lb b lc nl jv le lf nm jy lh li nn lk ll lm no lo lp lq np ls lt lu in bi translated">我们通过<code class="fe lv lw lx ly b">id.vars</code>来指定标识符列。“剩余的”非标识符列(英语、数学、物理)将被融合或堆叠成一列。</p><p id="735e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">将创建一个新的指示器列(包含英语、数学、物理值)，我们可以通过<code class="fe lv lw lx ly b">variable.name</code>重命名这个新列(类)。我们也可以通过<code class="fe lv lw lx ly b">value.name</code>重命名包含所有实际成绩的列(gRaDe)。</p><pre class="kk kl km kn gu pj ly pk pl aw pm bi"><span id="23be" class="pn mu iu ly b gz po pp l pq pr">df_long &lt;- melt(data = df_wide, <br/>                id.vars = c("student", "school"),<br/>                variable.name = "cLaSs",<br/>                value.name = "gRaDe")<br/>df_long<br/>    student school   cLaSs gRaDe<br/> 1:    Andy      Z english    10<br/> 2:  Bernie      Y english   100<br/> 3:  Cindey      Z english  1000<br/> 4:     Deb      Y english 10000<br/> 5:    Andy      Z    math    20<br/> 6:  Bernie      Y    math   200<br/> 7:  Cindey      Z    math  2000<br/> 8:     Deb      Y    math 20000<br/> 9:    Andy      Z physics    30<br/>10:  Bernie      Y physics   300<br/>11:  Cindey      Z physics  3000<br/>12:     Deb      Y physics 30000</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pt"><img src="../Images/d3dcb84d597b467836db135e25fb104f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zsr4-wSuCr90iwts9L2CpQ.png"/></div></div></figure></div><div class="ab cl ov ow hy ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="in io ip iq ir"><h1 id="c796" class="mt mu iu bd mv mw pc my mz na pd nc nd ka pe kb nf kd pf ke nh kg pg kh nj nk bi translated">熔体实施例 2</h1><p id="fca4" class="pw-post-body-paragraph kz la iu lb b lc nl jv le lf nm jy lh li nn lk ll lm no lo lp lq np ls lt lu in bi translated">你可以用<code class="fe lv lw lx ly b">measure.vars</code>来指定你想把哪些列融掉或者堆到 column 里(这里我们排除了 physics 列，所以<code class="fe lv lw lx ly b">measure.vars = c("english", "math")</code>)。我们也放弃了<code class="fe lv lw lx ly b">id.vars</code>的学校专栏。</p><pre class="kk kl km kn gu pj ly pk pl aw pm bi"><span id="e995" class="pn mu iu ly b gz po pp l pq pr">df_long &lt;- melt(data = df_wide, <br/>                id.vars = "student",<br/>                measure.vars = c("english", "math"),<br/>                variable.name = "cLaSs",<br/>                value.name = "gRaDe")<br/>df_long<br/>   student   cLaSs gRaDe<br/>1:    Andy english    10<br/>2:  Bernie english   100<br/>3:  Cindey english  1000<br/>4:     Deb english 10000<br/>5:    Andy    math    20<br/>6:  Bernie    math   200<br/>7:  Cindey    math  2000<br/>8:     Deb    math 20000</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pu"><img src="../Images/36567a971681620762923638e6f82bba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TEjlvYQaIG6WaydET6dciw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">从宽到长:原来的学校和物理专栏被删除</p></figure></div><div class="ab cl ov ow hy ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="in io ip iq ir"><h1 id="7588" class="mt mu iu bd mv mw pc my mz na pd nc nd ka pe kb nf kd pf ke nh kg pg kh nj nk bi translated">熔体实施例 3</h1><p id="1965" class="pw-post-body-paragraph kz la iu lb b lc nl jv le lf nm jy lh li nn lk ll lm no lo lp lq np ls lt lu in bi translated">最后，让我们看看如果我们只指定 student 列作为标识符列(<code class="fe lv lw lx ly b">id.vars = "student"</code>)而不指定要通过<code class="fe lv lw lx ly b">measure.vars</code>堆叠哪些列会发生什么。因此，所有非标识符列(学校、英语、数学、物理)将被堆叠到一列中。</p><p id="d8d7" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">产生的长数据帧看起来是错误的，因为现在 cLaSs 和 gRaDe 列包含了不应该在那里的值。这里的重点是向你展示<code class="fe lv lw lx ly b">melt</code>是如何工作的。</p><pre class="kk kl km kn gu pj ly pk pl aw pm bi"><span id="de7a" class="pn mu iu ly b gz po pp l pq pr">df_long &lt;- melt(data = df_wide,<br/>                id.vars = "student",<br/>                variable.name = "cLaSs",<br/>                value.name = "gRaDe")<br/>df_long<br/>    student   cLaSs gRaDe<br/> 1:    Andy  school     Z<br/> 2:  Bernie  school     Y<br/> 3:  Cindey  school     Z<br/> 4:     Deb  school     Y<br/> 5:    Andy english    10<br/> 6:  Bernie english   100<br/> 7:  Cindey english  1000<br/> 8:     Deb english 10000<br/> 9:    Andy    math    20<br/>10:  Bernie    math   200<br/>11:  Cindey    math  2000<br/>12:     Deb    math 20000<br/>13:    Andy physics    30<br/>14:  Bernie physics   300<br/>15:  Cindey physics  3000<br/>16:     Deb physics 30000</span></pre><p id="f14a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这个表看起来是错误的，因为<code class="fe lv lw lx ly b">df_wide</code>中的<code class="fe lv lw lx ly b">school</code>列不属于— <code class="fe lv lw lx ly b">school</code>应该是另一个标识符列(参见上面的 Melt 1)。melt 函数还返回了一条警告消息，告诉您您的列(<code class="fe lv lw lx ly b">gRaDe</code>)有不同类型的值(即字符型和数值型)。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pv"><img src="../Images/b6c3313b327e5bc6d92f0281786e46e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uk7hTXvbCqpIWk_O0a7rzw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">宽到长:学校列不是标识符列</p></figure><h1 id="3a78" class="mt mu iu bd mv mw mx my mz na nb nc nd ka ne kb nf kd ng ke nh kg ni kh nj nk bi translated">结束语</h1><p id="6644" class="pw-post-body-paragraph kz la iu lb b lc nl jv le lf nm jy lh li nn lk ll lm no lo lp lq np ls lt lu in bi translated">我希望现在您对<code class="fe lv lw lx ly b">melt</code>如何执行宽到长转换有了更好的理解。期待大家的想法和评论。</p><p id="3a9b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果你觉得这篇文章有用，请关注我并访问<a class="ae nq" href="http://hausetutorials.netlify.com/" rel="noopener ugc nofollow" target="_blank">我的网站</a>获取更多数据科学教程和我的其他文章:</p><div class="lz ma gq gs mb mc"><a rel="noopener follow" target="_blank" href="/new-python-library-for-statistical-tests-simpler-than-statsmodels-richer-than-scipy-stats-ff380d4673c0"><div class="md ab fp"><div class="me ab mf cl cj mg"><h2 class="bd iv gz z fq mh fs ft mi fv fx it bi translated">用于统计测试的新 Python 库—比 statsmodels 更简单，比 scipy.stats 更丰富</h2><div class="mj l"><h3 class="bd b gz z fq mh fs ft mi fv fx dk translated">统计建模变得更简单</h3></div><div class="mk l"><p class="bd b dl z fq mh fs ft mi fv fx dk translated">towardsdatascience.com</p></div></div><div class="ml l"><div class="pw l mn mo mp ml mq kt mc"/></div></div></a></div><div class="lz ma gq gs mb mc"><a rel="noopener follow" target="_blank" href="/what-ive-learned-after-using-vim-15-days-straight-ceda7e773a6d"><div class="md ab fp"><div class="me ab mf cl cj mg"><h2 class="bd iv gz z fq mh fs ft mi fv fx it bi translated">连续 15 天使用 Vim 后，我学到了什么</h2><div class="mj l"><h3 class="bd b gz z fq mh fs ft mi fv fx dk translated">从 Vim noob 到业余爱好者的旅程</h3></div><div class="mk l"><p class="bd b dl z fq mh fs ft mi fv fx dk translated">towardsdatascience.com</p></div></div><div class="ml l"><div class="px l mn mo mp ml mq kt mc"/></div></div></a></div><p id="0c93" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><em class="py">更多帖子，</em> <a class="ae nq" href="https://hauselin.ck.page/587b46fb05" rel="noopener ugc nofollow" target="_blank"> <em class="py">订阅我的邮件列表</em> </a> <em class="py">。</em></p></div></div>    
</body>
</html>