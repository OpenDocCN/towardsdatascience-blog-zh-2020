<html>
<head>
<title>How to Find Cheap Flights in 80 Lines of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 80 行代码找到便宜的航班</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-find-cheap-flights-in-80-lines-of-code-ba4f492587db?source=collection_archive---------26-----------------------#2020-08-12">https://towardsdatascience.com/how-to-find-cheap-flights-in-80-lines-of-code-ba4f492587db?source=collection_archive---------26-----------------------#2020-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c2ea" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Python 毫不费力地找到划算的交易</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/07f1403affbb2c1d2ffb1cbce7a69b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*79LoJvqYZNBBGawm"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://unsplash.com/photos/Nukqi6L_5DU" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/Nukqi6L_5DU</a></p></figure><p id="7412" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于旅行已经变得几乎不可能，我决定考虑如何开始为我的下一次旅行做准备。是的，我想到了旅行。</p><p id="389e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如大多数人所知，飞机票价格相差很大。这是因为航空公司使用收益管理，这是一种旨在预测消费者行为以实现利润最大化的定价策略。</p><p id="3a40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，用下面的代码，我连续两天每天 48 次查看一张从蒙特利尔到奥斯陆的机票。<strong class="lb iu">价格在 891 美元到 1298 美元之间</strong>(所有数据都是从 Kayak 报废的，右边<a class="ae ky" href="https://www.ca.kayak.com/flights" rel="noopener ugc nofollow" target="_blank">这里</a>)。同样的日期，同样的目的地，价格却相差很大。</p><blockquote class="lv lw lx"><p id="53d9" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">考虑到这一点，我编写了一个代码，可以搜索便宜的机票，如果找到了，就通过电子邮件通知我。</p></blockquote><p id="eca6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是代码。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h2 id="5a46" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">包和参数</h2><p id="acb5" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">让我们从导入必要的包开始:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="0236" class="mj mk it ni b gy nm nn l no np"><strong class="ni iu"># import libraries<br/></strong>from bs4 import BeautifulSoup<br/>from selenium import webdriver<br/>import pandas as pd<br/>import datetime, re, time, itertools, smtplib, ssl<br/>from email.mime.text import MIMEText<br/>from email.mime.multipart import MIMEMultipart</span></pre><p id="87b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们定义代码工作所需的参数:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="2c4e" class="mj mk it ni b gy nm nn l no np"><strong class="ni iu">#Define parameters<br/></strong>start_date = datetime.datetime(2020,9,13)<br/>days_range = 2<br/>trip_length, min_length, max_length = 7, 6, 12<br/>price_goal = 900<br/>cities = 'YMQ-OSL'</span></pre><ul class=""><li id="46bb" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">航班起飞的最早日期。</li><li id="eb66" class="nq nr it lb b lc oc lf od li oe lm of lq og lu nv nw nx ny bi translated"><code class="fe nz oa ob ni b">days_range</code>:离开<code class="fe nz oa ob ni b">start_date</code>的最大天数。基本上，旅行最晚什么时候开始(这里是 9 月 15 日)。</li><li id="5349" class="nq nr it lb b lc oc lf od li oe lm of lq og lu nv nw nx ny bi translated"><code class="fe nz oa ob ni b">trip_length, min_length, max_length</code>:期望的行程长度，以及可接受的最小和最大长度。可以等同于<code class="fe nz oa ob ni b">trip_length</code>。</li><li id="0374" class="nq nr it lb b lc oc lf od li oe lm of lq og lu nv nw nx ny bi translated"><code class="fe nz oa ob ni b">price_goal</code>:您希望收到电子邮件提醒的价格。</li><li id="47a5" class="nq nr it lb b lc oc lf od li oe lm of lq og lu nv nw nx ny bi translated"><code class="fe nz oa ob ni b">cities</code>:出发和到达的城市。为了找到正确的缩写，请在网站上搜索航班时查看网址。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/7c84aac26890ace8e115325be955d969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*8vOtDv-n868LEzBCmpPggA.png"/></div></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h2 id="2391" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">创建日期组合</h2><p id="592e" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">既然已经定义了所有参数，下面是如何为旅行创建所有可能的出发/返回日期组合。</p><p id="9fab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，你可能有灵活的日期，无论是出发/返回还是旅行的长度。下面的代码将根据前面定义的参数生成所有可能的旅行日期。</p><p id="f24d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我使用<code class="fe nz oa ob ni b">itertools</code>库生成所有可能的日期组合。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="a451" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，下面的循环允许我们去掉所有不尊重条件的日期(旅行的最小/最大长度)或不连贯的日期(出发日期之前返回)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="d1be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，下面几行代码清除了日期，使它们可用于后面的循环。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="4cca" class="mj mk it ni b gy nm nn l no np"><strong class="ni iu">#Cleaning dates to make them usable in loop<br/></strong>for i in range(len(departing)):<br/>    departing[i]=re.sub(' 00:00:00', '', departing[i])<br/>    returning[i]=re.sub(' 00:00:00', '', returning[i])</span></pre></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h2 id="3929" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">抓取数据并接收警报</h2><p id="a694" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">现在，说点实际的。这是用来找到最佳航班的算法，并确保当价格足够低时，您会收到提醒。</p><ol class=""><li id="cf74" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu ok nw nx ny bi translated">在 URL 中插入城市和日期</li><li id="2ba5" class="nq nr it lb b lc oc lf od li oe lm of lq og lu ok nw nx ny bi translated">获得 Kayak 使用硒和美丽的汤提议的最佳飞行的价格</li><li id="20ad" class="nq nr it lb b lc oc lf od li oe lm of lq og lu ok nw nx ny bi translated">如果找到一个价格，保存它，如果没有，返回“没有找到航班”(try-expect 循环)</li><li id="6490" class="nq nr it lb b lc oc lf od li oe lm of lq og lu ok nw nx ny bi translated">如果找到的价格低于<code class="fe nz oa ob ni b">price_goal</code>参数，发送一封电子邮件提醒，其中包含找到价格的 URL。</li></ol><p id="cb2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是完整的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="8ccb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我想提三件事。首先，不要忘记下载一个 chrome 驱动程序(并在第 6 行调整可执行路径)来使用 Selenium。</p><p id="b55f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二，不要忘记更新发送者、密码和接收者参数。这些指定了发送电子邮件的地址和接收电子邮件的地址。如果你愿意，你也可以改变邮件内容(主题或正文)。</p><p id="2ba8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三，代码当前是为 Gmail 地址发送者设置的。对于任何其他类型的地址，应该更改端口(第 22 行)和<code class="fe nz oa ob ni b">stmp.gmail.com</code>(第 37 行)。</p><p id="29cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">收到的电子邮件警报应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/96b777deebeb08a04019dc16a1ff3949.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ch4y3yQmxg0q5zir-dmDXQ.png"/></div></div></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h2 id="6f2e" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">使用任务计划程序</h2><p id="3ef9" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">所有这些都是一个好的开始，但是不断地手工运行代码是浪费时间，直到找到一个好的交易。还不如像任何人一样，手动在 Kayak 上寻找交易。</p><p id="9aab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，任务调度程序是存在的。这个想法很简单。您可以安排您的代码每天运行 N 次，时间长短由您决定。你甚至可以在电脑睡眠时让它工作(但不要关机)。</p><p id="ff9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于如何用 python 脚本设置 Windows 任务调度器的教程，请点击<a class="ae ky" rel="noopener" target="_blank" href="/automate-your-python-scripts-with-task-scheduler-661d0a40b279">这里</a>。使用这个工具在很多情况下都非常有用，我强烈建议你学会使用它！</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><p id="a6b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当你坐下来喝杯啤酒时，你可以让你的电脑搜索廉价航班。你不仅节省了时间和金钱，而且是免费的。</p><p id="fe41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢你的阅读！</p><p id="e186" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的代码可在<a class="ae ky" href="https://github.com/francoisstamant/cheap_flights_finder" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div></div>    
</body>
</html>