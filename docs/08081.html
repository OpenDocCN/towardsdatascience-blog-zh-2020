<html>
<head>
<title>COVID-19: Risk of Geographical Areas being infected</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新冠肺炎:地理区域被感染的风险</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/covid-19-risk-of-geographical-areas-being-infected-a81938a5e286?source=collection_archive---------46-----------------------#2020-06-14">https://towardsdatascience.com/covid-19-risk-of-geographical-areas-being-infected-a81938a5e286?source=collection_archive---------46-----------------------#2020-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bec0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">PostgreSQL-PostGIS方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d5efc9a1591c6162e5038bf7042e8709.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3LTRWuHdiJI8I26pLbQ1Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图1:曼哈顿出租车的轨迹</p></figure><p id="7595" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="http://towardsdatascience.com/" rel="noopener" target="_blank"> <em class="ls">迈向数据科学</em> </a> <em class="ls">是一份以研究数据科学和机器学习为主的媒体刊物。我们不是健康专家或流行病学家，本文的观点不应被解释为专业建议。想了解更多关于疫情冠状病毒的信息，可以点击</em> <a class="ae lr" href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports" rel="noopener ugc nofollow" target="_blank"> <em class="ls">这里</em> </a> <em class="ls">。</em></p><p id="09e4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">自从电晕疫情爆发以来，我一直看到多伦多技术社区的人们提出了令人敬畏的分析，如Russell Pollari为了人民的利益贡献他们的理解和知识。这一直是激励我尝试为我的硕士论文和研究工作寻找一些用例的因素。</p><p id="71b9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我将解释我是如何想出利用地理区域内的轨迹来了解哪些地区受新冠肺炎影响的风险更高的想法的，例如，多伦多或纽约。在我深入实际框架本身的细节之前，让我们先了解一些基础知识。</p><h2 id="8469" class="lt lu iq bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">PostgreSQL和PostGIS</h2><p id="5a4a" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">PostgreSQL (又名Postgres)是一个开源的对象关系数据库管理系统(ORDBMS)，强调可扩展性和标准遵从性。它扩展了SQL语言，并结合了许多安全存储和扩展最复杂的数据工作负载的功能。<br/> <a class="ae lr" href="https://postgis.net/" rel="noopener ugc nofollow" target="_blank"> PostGIS </a>是Postgres的空间数据库扩展器。它向Postgres添加了空间函数，如距离、面积、并集、交集和几何数据类型(这也是我在当前分析中使用它的原因)。</p><h2 id="5347" class="lt lu iq bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">数据</h2><p id="03b9" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">我使用的数据集由纽约市出租车和豪华轿车委员会(TLC)发布，其中包括接送时间、地理坐标、乘客数量和其他几个特征。数据集<a class="ae lr" href="https://www.kaggle.com/c/nyc-taxi-trip-duration/data?select=train.zip" rel="noopener ugc nofollow" target="_blank"> <em class="ls">文件</em> </a>包含1，048，576个旅行记录，这些记录包含作为(经度，纬度)坐标对的上下车点。为了这个实验的需要，我依靠随机样本<em class="ls"> S </em>包括10，000双。对于每一对接送坐标，我利用Google Directions API(<a class="ae lr" href="https://github.com/saimmehmood/covid_19_risk/blob/master/new_york_taxi.py" rel="noopener ugc nofollow" target="_blank"><em class="ls">python代码</em> </a>)在NYC创建轨迹(如图1所示)。</p><h2 id="ee6b" class="lt lu iq bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">将地理区域划分成统一的网格</h2><p id="1633" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">设轨迹<em class="ls"> t = {(x_0，y_0)，(x_1，y_1)，…，(x_n，y_n)} </em>等于从起点到终点的路线，其中序列对<em class="ls"> (x_i，y_i) </em>表示2D笛卡尔坐标系中的经纬度坐标。虽然移动物体的单个轨迹被定义在较低的粒度级别(例如，经度和纬度坐标对的序列)，但是地理区域的分析通常需要在较高的粒度级别完成，例如在城市的街区或邮政编码级别。不失一般性，我采用了一个<em class="ls">均匀网格</em>的抽象，它将观察空间<em class="ls"> A </em>分成一组均匀间隔的<em class="ls"> r </em>行和<em class="ls"> c </em>列，形成<em class="ls">网格单元</em>；行数不需要等于列数。我正式定义<em class="ls"> grid_rc </em>如下:</p><blockquote class="mr ms mt"><p id="ded3" class="kv kw ls kx b ky kz jr la lb lc ju ld mu lf lg lh mv lj lk ll mw ln lo lp lq ij bi translated">grid_rc = {c_00，c_01，c_10，…，c_r-1c-1}</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/74c59feba8a67df27973026fd1430f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*llU4df0Tz1cJXwkTgfovNg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图2:样本网格和网格单元上的样本轨迹</p></figure><p id="2b02" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ls"> grid_rc </em>由<em class="ls"> r x c </em>网格单元组成，而<em class="ls"> c_ij </em>代表第<em class="ls"> i </em>行和第<em class="ls">j</em>列的网格单元。通过将<em class="ls"> A </em>划分为网格单元，我能够将轨迹<em class="ls"> t ϵ T </em>从地理位置序列转换为grid_rc上的网格单元序列。例如，图2显示了一个7x10 <em class="ls"> </em>网格和一个穿过13个网格单元的样本轨迹，从c_02开始移动到c_03、c_04、c_14、…，一直到c_67。</p><p id="a11c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在你应该想到一个有趣的问题。<strong class="kx ir">为什么我需要将地理区域划分成网格单元？</strong>这可以从以下可视化中理解:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/03b57d674bcd7875dcf71d73d93d98f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FNe875t00RidGIPLfW5A2A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图3:从作为地理位置的轨迹到作为网格单元的轨迹</p></figure><p id="f68b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，我们看到的是一个单一的(a)轨迹表示为地理位置(b)遍历网格单元和(c)最终转换为一组网格单元表示的运动路径的轨迹。对成千上万条轨迹进行的这种抽象使我们能够发现移动物体(即人、公共汽车和汽车)与分割的地理空间的相互作用。</p><p id="8d74" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请注意，网格的大小在更精确的分析和更快速的分析之间提供了一个有趣的平衡。这是因为网格的行数和列数越多，每个网格单元所代表的地理区域就越小，但代价是必须将每个轨迹关联到更大数量的网格单元，这在计算上是昂贵的(如图4所示)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/8ba90f0eb1dcc653a213c9ea2d6746bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LQytYDnK8vVE06jxK66Efw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图4 :( a)更少和(b)更精细分析之间的权衡</p></figure><h2 id="2db4" class="lt lu iq bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">数据库中数据集的建模</h2><p id="167e" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">为了将数据存储在postgres数据库中，需要将其转换为<a class="ae lr" href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry" rel="noopener ugc nofollow" target="_blank">众所周知的文本</a> (WKT)格式，这是一种用于在地图上表示矢量几何对象的文本标记语言。WKT可以表示许多不同的几何对象，如点、线串&amp;多边形等(如图5所示)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/8cf23ff9ece8c49aaf6b519554929d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cDsanSIg-9sJC4BkICrkXQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图5:几何图元(2D)[参考:<a class="ae lr" href="https://tinyurl.com/nz8ybfu4" rel="noopener ugc nofollow" target="_blank">https://tinyurl.com/nz8ybfu4</a></p></figure><p id="a54a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我使用<em class="ls"> Linestring </em>存储轨迹数据集，类似地使用<em class="ls"> Polygon </em>存储网格单元坐标。使用这个<a class="ae lr" href="https://github.com/saimmehmood/covid_19_risk/blob/master/uniform_grid.py" rel="noopener ugc nofollow" target="_blank">代码</a>我将地理空间划分成35×35的网格(如图6所示)并以WKT格式存储网格单元坐标。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/dddf7de4e955f5c7b66e463833a9405b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4xYTjJfbiIc8EdSYY1TPYA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图6:划分为35x35网格的地理区域</p></figure><h2 id="7231" class="lt lu iq bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">识别高感染区域</h2><p id="e43a" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">宣布地理区域(即网格单元)为高度感染的想法是基于这样的假设，即通过特定网格单元(划分的地理区域)的轨迹数量越多，该区域被感染的机会就越大。我通过绘制轨迹与网格单元的相互作用以及使用基于PostGIS的空间查询来识别这些区域。</p><p id="bb18" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">查询</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Q#1:存储网格单元坐标和轨迹数据集的查询</p></figure><p id="247f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我使用<a class="ae lr" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank"> pgAdmin </a>中可用的导入/导出命令将数据存储在traj、网格和单元格表中。现在是进行神奇查询的时候了，该查询可以找到感染风险高的区域。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">问题2:神奇的查询</p></figure><p id="ac7a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">神奇的部分是我们得到的表格(traj_as_cells)。它类似于图7所示，但是针对数千条轨迹。<br/>完成上述分析后，我们的工作是找到通过其的轨迹数量最多的细胞id，即，具有被新冠肺炎感染的高风险的(划分的地理区域)。</p><p id="c077" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了帮助更好地理解它，我们可以编写一个简单的查询来查找有多少轨迹通过单个网格单元(在下面的查询中<em class="ls"> 646 </em>)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">问题3:发现具有高感染风险的热点(网格细胞)</p></figure><p id="43fe" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的网格细胞有111个轨迹穿过它(可能是感染的热点)。<br/>(图7)显示了从postgres数据库获取的快照。此外，我们可以通过将它的id与“单元格”表进行比较来定位这个网格单元格坐标(如Q#4所示)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/a4400120122c180a225415d2946d5234.png" data-original-src="https://miro.medium.com/v2/resize:fit:292/format:webp/1*bBBlK-OEkYbCy16Qk1vhpQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图7</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">问题4:定位网格单元坐标</p></figure><p id="0c52" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们可以聚集轨迹穿过的所有网格单元，并基于穿过它们的轨迹的数量对它们进行排序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">寻找穿过每个网格单元的轨迹</p></figure><p id="7b66" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的代码聚集了通过每个网格单元的所有轨迹，并将它们存储在<code class="fe nf ng nh ni b">traj_ids.txt</code>文件中。最后，我们使用一个bash命令对网格单元进行排序。</p><pre class="kg kh ki kj gt nj ni nk nl aw nm bi"><span id="756a" class="lt lu iq ni b gy nn no l np nq">perl -ne 'push <a class="ae lr" href="http://twitter.com/a" rel="noopener ugc nofollow" target="_blank">@a</a>, $_; END{ print sort { length $a &lt;=&gt; length $b } <a class="ae lr" href="http://twitter.com/a" rel="noopener ugc nofollow" target="_blank">@a</a> }' traj_ids.txt</span></pre><h2 id="2326" class="lt lu iq bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">概述</h2><ul class=""><li id="0999" class="nr ns iq kx b ky mm lb mn le nt li nu lm nv lq nw nx ny nz bi translated">我们开始探索一个地理空间，并着眼于人的运动路径，即轨迹。</li><li id="765c" class="nr ns iq kx b ky oa lb ob le oc li od lm oe lq nw nx ny nz bi translated">我们将地理空间划分为统一的网格单元，并讨论了较小或较大网格大小之间的权衡。</li><li id="a6e6" class="nr ns iq kx b ky oa lb ob le oc li od lm oe lq nw nx ny nz bi translated">此外，我们详细阐述了划分地理空间如何使我们能够将轨迹从一组地理位置坐标转换到一组网格单元中。</li><li id="2f77" class="nr ns iq kx b ky oa lb ob le oc li od lm oe lq nw nx ny nz bi translated">最后，我们执行了各种Postgres/PostGIS查询来查找轨迹穿过的格网单元。</li><li id="68ee" class="nr ns iq kx b ky oa lb ob le oc li od lm oe lq nw nx ny nz bi translated">最后，python (numpy <em class="ls">，pandas </em>)使我们能够将属于每个单元的轨迹放在一起，并通过bash命令对它们进行排序。</li></ul><h2 id="b1af" class="lt lu iq bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">结论</h2><p id="bc26" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">从本质上说，这项工作提供了一个简单、易于遵循的概念验证方法，用于发现受新冠肺炎影响的高风险地区。</p></div></div>    
</body>
</html>