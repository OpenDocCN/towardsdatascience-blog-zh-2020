<html>
<head>
<title>Using Python to Scrape NFL Stats and Compare Quarterback Efficiencies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python收集NFL数据并比较四分卫效率</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scraping-nfl-stats-to-compare-quarterback-efficiencies-4989642e02fe?source=collection_archive---------20-----------------------#2020-05-17">https://towardsdatascience.com/scraping-nfl-stats-to-compare-quarterback-efficiencies-4989642e02fe?source=collection_archive---------20-----------------------#2020-05-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="945d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用BeautifulSoup收集NFL数据并绘制四分卫的雷达图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f84f9a4ae6816203a8686c9168a61ff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*87qvjGMYcYSkShI1uZnRiA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Riley McCullough 在<a class="ae ky" href="https://unsplash.com/s/photos/american-football?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="0f69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我总是担心试图收集自己的数据，事实上，像Kaggle这样的网站聚集了如此高质量的数据集，使得学习这种技能变得不那么必要。然而，这个平台上大量关于数据科学的教育文章帮助我在收集自己的数据集方面取得了进展。很多搜集数据的灵感和方法都来自这里的<a class="ae ky" rel="noopener" target="_blank" href="/web-scraping-nba-stats-4b4f8c525994"/>。</p><p id="8e35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将从<a class="ae ky" href="https://www.pro-football-reference.com/" rel="noopener ugc nofollow" target="_blank"> Pro Football Reference </a>中提取2019–20 NFL赛季的四分卫统计数据，并使用它们创建雷达图来评估QB效率。</p><h1 id="0321" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">加载包</strong></h1><p id="8749" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了打开网页并抓取数据，我们将使用两个模块，<code class="fe ms mt mu mv b">urllib.request</code>打开URL，<code class="fe ms mt mu mv b">BeautifulSoup</code>解析HTML。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="4c07" class="na lw it mv b gy nb nc l nd ne"># Import scraping modules<br/>from urllib.request import urlopen<br/>from bs4 import BeautifulSoup</span></pre><p id="9541" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了这些包，我们还需要一些包来操作数据，<code class="fe ms mt mu mv b">numpy</code>和<code class="fe ms mt mu mv b">pandas</code>，并绘制我们的数据，<code class="fe ms mt mu mv b">matplotlib</code>。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="8db5" class="na lw it mv b gy nb nc l nd ne"># Import data manipulation modules<br/>import pandas as pd<br/>import numpy as np</span><span id="0be1" class="na lw it mv b gy nf nc l nd ne"># Import data visualization modules<br/>import matplotlib as mpl<br/>import matplotlib.pyplot as plt</span></pre><h1 id="bb4e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">刮数据</strong></h1><p id="09bd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们要导入的数据是2019赛季的NFL传球数据，可以在这里<a class="ae ky" href="https://www.pro-football-reference.com/years/2019/passing.htm" rel="noopener ugc nofollow" target="_blank">找到</a>。我们打开站点，并通过以下内容将其传递给<code class="fe ms mt mu mv b">BeautifulSoup</code>:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="d6d1" class="na lw it mv b gy nb nc l nd ne"># URL of page<br/>url = 'https://www.pro-football-reference.com/years/2019/passing.htm'</span><span id="f982" class="na lw it mv b gy nf nc l nd ne"># Open URL and pass to BeautifulSoup<br/>html = urlopen(url)<br/>stats_page = BeautifulSoup(html)</span></pre><p id="c007" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，通过将URL中的<code class="fe ms mt mu mv b">2019</code>更改为您选择的年份，我们可以很容易地将所有这些分析调整到以前的年份。</p><p id="007a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将用来抓取页面的两个<code class="fe ms mt mu mv b">BeautifulSoup</code>函数是<code class="fe ms mt mu mv b">findAll()</code>和<code class="fe ms mt mu mv b">getText()</code>，它们基于我们正在抓取的页面的HTML返回值。我在下面给出了简化的用例——对于所有的可能性，你应该参考<a class="ae ky" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="e530" class="na lw it mv b gy nb nc l nd ne">findAll(name)</span><span id="4e14" class="na lw it mv b gy nf nc l nd ne">Parameters<br/>name -- HTML tags to use to parse webpage</span><span id="c268" class="na lw it mv b gy nf nc l nd ne">Returns array of all matches to name tag</span><span id="0ddc" class="na lw it mv b gy nf nc l nd ne"><br/>getText()</span><span id="162c" class="na lw it mv b gy nf nc l nd ne">Returns text from HTML</span></pre><p id="32ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使这些有效，我们必须确定页面源中的模式。在我们的例子中，数据在表格中被很好地格式化，所以我们可以找到所有的表格行(<code class="fe ms mt mu mv b">tr</code>)和列(<code class="fe ms mt mu mv b">td</code>)，并直接从单元格中提取文本。</p><p id="1a2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要收集列标题，以便稍后在数据框架中使用它们。为此，我们找到页面中的第一个<code class="fe ms mt mu mv b">tr</code>元素，并从所有表格标题中收集文本(<code class="fe ms mt mu mv b">th</code>):</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="a8f2" class="na lw it mv b gy nb nc l nd ne"># Collect table headers</span><span id="9661" class="na lw it mv b gy nf nc l nd ne">column_headers = stats_page.findAll('tr')[0]<br/>column_headers = [i.getText() for i in column_headers.findAll('th')]</span></pre><p id="117e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们索引第一个元素，因为这是包含列标题的行。我们可以查看我们的结果:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="f5d5" class="na lw it mv b gy nb nc l nd ne">print(column_headers)</span><span id="e3e8" class="na lw it mv b gy nf nc l nd ne">&gt;&gt;&gt; ['Rk', 'Player', 'Tm', 'Age', 'Pos', 'G', 'GS', 'QBrec', 'Cmp', 'Att', 'Cmp%', 'Yds', 'TD', 'TD%', 'Int', 'Int%', '1D', 'Lng', 'Y/A', 'AY/A', 'Y/C', 'Y/G', 'Rate', 'QBR', 'Sk', 'Yds', 'NY/A', 'ANY/A', 'Sk%', '4QC', 'GWD']</span></pre><p id="3b92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了收集实际的数据，我们将首先收集所有的表行(<code class="fe ms mt mu mv b">tr</code>)并将它们存储在一个数组中。然后，我们遍历每一行，用<code class="fe ms mt mu mv b">getText()</code>收集每一列中的文本(<code class="fe ms mt mu mv b">td</code>):</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="3dcd" class="na lw it mv b gy nb nc l nd ne"># Collect table rows<br/>rows = stats_page.findAll('tr')[1:]</span><span id="3915" class="na lw it mv b gy nf nc l nd ne"># Get stats from each row<br/>qb_stats = []<br/>for i in range(len(rows)):<br/>  qb_stats.append([col.getText() for col in rows[i].findAll('td')])</span></pre><p id="aa86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们跳过第一行，因为这些是我们之前刚刚收集的列标题。当我们检查<code class="fe ms mt mu mv b">qb_stats</code>列表的第一行时:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="0b1e" class="na lw it mv b gy nb nc l nd ne">print(qb_stats[0])</span><span id="fc80" class="na lw it mv b gy nf nc l nd ne">&gt;&gt;&gt; ['Jared Goff', 'LAR', '25', 'QB', '16', '16', '9-7-0', '394', '626', '62.9', '4638', '22', '3.5', '16', '2.6', '220', '66', '7.4', '7.0', '11.8', '289.9', '86.5', '', '22', '170', '6.90', '6.46', '3.4', '1', '2']</span></pre><p id="656c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以将标题和统计数据合并到一个<code class="fe ms mt mu mv b">pandas</code>数据帧中。如果您以前没有使用过<code class="fe ms mt mu mv b">pandas</code>，它本质上是一个Excel电子表格，您可以通过编程来操作，因此它非常适合处理大型数据集。我们注意到上面的<code class="fe ms mt mu mv b">Rk</code>列在我们的<code class="fe ms mt mu mv b">qb_stats</code>列表中没有相应的数据——这是因为那些值都是表头，所以我们的<code class="fe ms mt mu mv b">findAll()</code>函数没有提取它们的数据。无论如何，这些数据对于我们的分析来说都是无关紧要的，因此我们在创建数据帧时会将其忽略。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="f2cf" class="na lw it mv b gy nb nc l nd ne"># Create DataFrame from our scraped data<br/>data = pd.DataFrame(qb_stats, columns=column_headers[1:])</span></pre><p id="d7dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ms mt mu mv b">columns</code> —数据框架的列标题(我们省略了<code class="fe ms mt mu mv b">Rk</code>)</p><p id="b149" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们看看数据帧的前五行:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="0a6a" class="na lw it mv b gy nb nc l nd ne"># Examine first five rows of data<br/>data.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/1c1452a72ac82f8a8908c81780171b1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FnIERmbjACoEucfhXOC30Q.png"/></div></div></figure><p id="9d94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功！</p><h1 id="a720" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">操作和清理数据</strong></h1><p id="16a7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在，我们可以处理这个数据框中的数据，得到我们需要的东西来制作我们的雷达图。首先，让我们看看集合中的所有列:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="59da" class="na lw it mv b gy nb nc l nd ne"># View columns in data<br/>data.columns</span><span id="126c" class="na lw it mv b gy nf nc l nd ne">&gt;&gt;&gt; Index(['Player', 'Tm', 'Age', 'Pos', 'G', 'GS', 'QBrec', 'Cmp', 'Att', 'Cmp%', 'Yds', 'TD', 'TD%', 'Int', 'Int%', '1D', 'Lng', 'Y/A', 'AY/A', 'Y/C', 'Y/G', 'Rate', 'QBR', 'Sk', 'Yds', 'NY/A', 'ANY/A', 'Sk%', '4QC', 'GWD'], dtype='object')</span></pre><p id="27ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们立即看到一个问题—有两个标题为<code class="fe ms mt mu mv b">Yds</code>的列；一个是传球码，另一个是因为被抢而失去的码。我们可以通过重命名后者来轻松解决这个问题:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="c364" class="na lw it mv b gy nb nc l nd ne"># Rename sack yards column to `Yds_Sack`<br/>new_columns = data.columns.values<br/>new_columns[-6] = 'Yds_Sack'<br/>data.columns = new_columns</span></pre><p id="acce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们再次查看我们的专栏:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="8965" class="na lw it mv b gy nb nc l nd ne"># View columns in data<br/>data.columns</span><span id="9018" class="na lw it mv b gy nf nc l nd ne">&gt;&gt;&gt; Index(['Player', 'Tm', 'Age', 'Pos', 'G', 'GS', 'QBrec', 'Cmp', 'Att', 'Cmp%', 'Yds', 'TD', 'TD%', 'Int', 'Int%', '1D', 'Lng', 'Y/A', 'AY/A', 'Y/C', 'Y/G', 'Rate', 'QBR', 'Sk', 'Yds_Sack', 'NY/A', 'ANY/A', 'Sk%', '4QC', 'GWD'], dtype='object')</span></pre><p id="60ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经成功地将该列重命名为<code class="fe ms mt mu mv b">Yds_Sack</code>，并且不再有列名冲突！接下来，让我们确定我们对可视化感兴趣的统计类别。我们将选择:</p><p id="b71d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(1)完成百分比— <code class="fe ms mt mu mv b">Cmp%</code></p><p id="872e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(2)传球码— <code class="fe ms mt mu mv b">Yds</code></p><p id="1b2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(3)传球达阵— <code class="fe ms mt mu mv b">TD</code></p><p id="663c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(4)拦截— <code class="fe ms mt mu mv b">Int</code></p><p id="4f54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每次试跳5码— <code class="fe ms mt mu mv b">Y/A</code></p><p id="89b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(6)及格分数— <code class="fe ms mt mu mv b">Rate</code></p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="ea1f" class="na lw it mv b gy nb nc l nd ne"># Select stat categories<br/>categories = ['Cmp%', 'Yds', 'TD', 'Int', 'Y/A', 'Rate']</span></pre><p id="d122" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们创建一个新的数据框架，作为原始数据的子集，只使用我们选择的类别中的数据。此外，我们将添加球员的名字和球队。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="cb55" class="na lw it mv b gy nb nc l nd ne"># Create data subset for radar chart<br/>data_radar = data[['Player', 'Tm'] + categories]<br/>data_radar.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/448e4b42cae53b329793d450a5ed883b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBk9Z9ZaUsWs_-tWx-ozkQ.png"/></div></div></figure><p id="cc60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了数据子集，让我们检查数据类型，因为我们从URL中提取了文本形式的值:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="32ae" class="na lw it mv b gy nb nc l nd ne"># Check data types<br/>data_radar.dtypes</span><span id="106a" class="na lw it mv b gy nf nc l nd ne">&gt;&gt;&gt; Player    object<br/>    Tm        object<br/>    Cmp%      object<br/>    Yds       object<br/>    TD        object<br/>    Int       object<br/>    Y/A       object<br/>    Rate      object<br/>    dtype: object</span></pre><p id="8008" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们所有的数字数据都被存储为对象，所以我们不能操作它们。因此，在我们继续之前，我们必须将所有这些数据转换成数值。为此，我们使用了一个名为<code class="fe ms mt mu mv b">pandas.to_numeric</code>的函数。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="833a" class="na lw it mv b gy nb nc l nd ne"># Convert data to numerical values<br/>for i in categories:<br/>  data_radar[i] = pd.to_numeric(data[i])</span></pre><p id="96b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们再次检查我们的数据类型:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="9b4c" class="na lw it mv b gy nb nc l nd ne"># Check data types<br/>data_radar.dtypes</span><span id="2eaa" class="na lw it mv b gy nf nc l nd ne">&gt;&gt;&gt; Player     object<br/>    Tm         object<br/>    Cmp%      float64<br/>    Yds       float64<br/>    TD        float64<br/>    Int       float64<br/>    Y/A       float64<br/>    Rate      float64<br/>    dtype: object</span></pre><p id="719a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还有最后一项数据清理工作要做。在最初的网站上，他们把装饰性的人物放在有季末成就的球员旁边，比如职业碗(*)或全职业(+)选择。我们将使用<code class="fe ms mt mu mv b">str.replace()</code>移除这些:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="0808" class="na lw it mv b gy nb nc l nd ne"># Remove ornamental characters for achievements<br/>data_radar['Player'] = data_radar['Player'].str.replace('*', '')<br/>data_radar['Player'] = data_radar['Player'].str.replace('+', '')</span></pre><p id="2d0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们把数据过滤到投球距离超过1500码的四分卫:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="92a4" class="na lw it mv b gy nb nc l nd ne"># Filter by passing yards<br/>data_radar_filtered = data_radar[data_radar['Yds'] &gt; 1500]</span></pre><p id="4832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，对于我们的雷达图，我们想通过百分位数计算每个四分卫的统计排名，这在<code class="fe ms mt mu mv b">pandas</code>中用<code class="fe ms mt mu mv b">DataFrame.rank(pct=True)</code>很容易完成。<code class="fe ms mt mu mv b">rank()</code>函数可以采用其他参数来根据其他参数进行排序，您可以查阅<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rank.html" rel="noopener ugc nofollow" target="_blank">在线文档</a>。</p><p id="7a00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们想翻转我们的拦截排名，因为我们不希望有最多拦截的QB有最高的百分位数！</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="69cf" class="na lw it mv b gy nb nc l nd ne"># Create columns with percentile rank<br/>for i in categories:<br/>  data_radar_filtered[i + '_Rank'] = <br/>  data_radar_filtered[i].rank(pct=True)</span><span id="a75a" class="na lw it mv b gy nf nc l nd ne"># We need to flip the rank for interceptions<br/>data_radar_filtered['Int_Rank'] = <br/>1 - data_radar_filtered['Int_Rank']</span></pre><p id="5d83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们检查我们的新数据:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="4907" class="na lw it mv b gy nb nc l nd ne"># Examine data<br/>data_radar_filtered.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/10180432b01a275f21b060b1c682831f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1wTcz2rC2ySA0I4yQOxfMQ.png"/></div></div></figure><p id="6eed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了！我们现在可以进行可视化了！</p><h1 id="e7a4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">生成雷达图</strong></h1><p id="ae93" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将从编辑一些通用的绘图参数开始。我们将生成一个极坐标图，因此x刻度对应于围绕圆的角度，我们将增加轴和刻度标签之间的填充:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="3bd7" class="na lw it mv b gy nb nc l nd ne"># General plot parameters<br/>mpl.rcParams['font.family'] = 'Avenir'<br/>mpl.rcParams['font.size'] = 16<br/>mpl.rcParams['axes.linewidth'] = 0<br/>mpl.rcParams['xtick.major.pad'] = 15</span></pre><p id="4632" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于图表中的颜色，我们将使用NFL球队颜色的十六进制代码，这些代码是从<a class="ae ky" href="https://teamcolorcodes.com/nfl-team-color-codes/" rel="noopener ugc nofollow" target="_blank">链接</a>中收集的。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="47cd" class="na lw it mv b gy nb nc l nd ne">team_colors = {'ARI':'#97233f', 'ATL':'#a71930', 'BAL':'#241773', 'BUF':'#00338d', 'CAR':'#0085ca', 'CHI':'#0b162a', 'CIN':'#fb4f14', 'CLE':'#311d00', 'DAL':'#041e42', 'DEN':'#002244', 'DET':'#0076b6', 'GNB':'#203731', 'HOU':'#03202f', 'IND':'#002c5f', 'JAX':'#006778', 'KAN':'#e31837', 'LAC':'#002a5e', 'LAR':'#003594', 'MIA':'#008e97', 'MIN':'#4f2683', 'NWE':'#002244', 'NOR':'#d3bc8d', 'NYG':'#0b2265', 'NYJ':'#125740', 'OAK':'#000000', 'PHI':'#004c54', 'PIT':'#ffb612', 'SFO':'#aa0000', 'SEA':'#002244', 'TAM':'#d50a0a', 'TEN':'#0c2340', 'WAS':'#773141'}</span></pre><p id="bb87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们绘制所有观点的角度将取决于我们所拥有的统计类别的数量。在我们的例子中，我们有6个类别，所以我们将每隔2π/6弧度或60度绘制我们的点。我们可以使用<code class="fe ms mt mu mv b">numpy.linspace()</code>计算如下:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="948d" class="na lw it mv b gy nb nc l nd ne"># Calculate angles for radar chart<br/>offset = np.pi/6<br/>angles = np.linspace(0, 2*np.pi, len(categories) + 1) + offset</span></pre><p id="330d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们添加了<code class="fe ms mt mu mv b">offset</code>项来调整标签出现在圆上的位置(第一个标签不是0弧度，而是出现在π/6)。</p><p id="439e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们绘制数据时，我们需要实际复制第一个类别，这样形状就会自动闭合。如果你注意到当我们计算角度时，我们有7个数据点，第一个和最后一个角度对应于圆上的同一点。因此，当我们绘制数据时，我们使用以下内容(我们将把它变成一个函数，所以<code class="fe ms mt mu mv b">player_data</code>表示我们将传递的一行特定于玩家的数据):</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="4eec" class="na lw it mv b gy nb nc l nd ne"># Plot data and fill with team color<br/>ax.plot(angles, np.append(player_data[-(len(angles)-1):], player_data[-(len(angles)-1)]), color=color, linewidth=2)</span><span id="92d1" class="na lw it mv b gy nf nc l nd ne">ax.fill(angles, np.append(player_data[-(len(angles)-1):], player_data[-(len(angles)-1)]), color=color, alpha=0.2)</span></pre><p id="5a14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码是有效的，因为我们的类别是数据帧的最后6列，所以<code class="fe ms mt mu mv b">len(angles) — 1</code>对应于这些类别中的第一列(因为angles有一个额外的元素)。然后，我们将第一个类别的值附加到该数组的末尾，这样我们就可以关闭该形状。</p><p id="bc0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以设置类别名称的标签(因为我们的类别比角度少一个，所以我们省略了最后一个元素):</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="e4cd" class="na lw it mv b gy nb nc l nd ne"># Set category labels<br/>ax.set_xticks(angles[:-1])<br/>ax.set_xticklabels(categories)</span></pre><p id="fa03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们将在雷达图的顶部添加玩家的名字——我们将文本对象放置在绝对绘图坐标中的(π/2，1.7)处，以便它出现在轴的上方:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="23b5" class="na lw it mv b gy nb nc l nd ne"># Add player name<br/>ax.text(np.pi/2, 1.7, player_data[0], ha='center', va='center', size=18, color=color)</span></pre><p id="a943" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以将所有这些放在一起，创建一个辅助函数来生成我们的雷达图，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="94f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建另一个助手函数，当给定一个团队输入时，返回QB数据的<code class="fe ms mt mu mv b">numpy</code>数组:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="f565" class="na lw it mv b gy nb nc l nd ne"># Function to get QB data<br/>def get_qb_data(data, team):<br/>  return np.asarray(data[data['Tm'] == team])[0]</span></pre><h1 id="994e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">可视化数据</strong></h1><p id="04f9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu"> NFC西</strong></p><p id="c685" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我是49人队的超级粉丝，所以我们先来看看NFC西区QBs的雷达图:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="d0a9" class="na lw it mv b gy nb nc l nd ne"># Create figure<br/>fig = plt.figure(figsize=(8, 8), facecolor='white')</span><span id="e34e" class="na lw it mv b gy nf nc l nd ne"># Add subplots<br/>ax1 = fig.add_subplot(221, projection='polar', facecolor='#ededed')<br/>ax2 = fig.add_subplot(222, projection='polar', facecolor='#ededed')<br/>ax3 = fig.add_subplot(223, projection='polar', facecolor='#ededed')<br/>ax4 = fig.add_subplot(224, projection='polar', facecolor='#ededed')</span><span id="c140" class="na lw it mv b gy nf nc l nd ne"># Adjust space between subplots<br/>plt.subplots_adjust(hspace=0.8, wspace=0.5)</span><span id="fce7" class="na lw it mv b gy nf nc l nd ne"># Get QB data<br/>sf_data = get_qb_data(data_radar_filtered, 'SFO')<br/>sea_data = get_qb_data(data_radar_filtered, 'SEA')<br/>ari_data = get_qb_data(data_radar_filtered, 'ARI')<br/>lar_data = get_qb_data(data_radar_filtered, 'LAR')</span><span id="feb2" class="na lw it mv b gy nf nc l nd ne"># Plot QB data<br/>ax1 = create_radar_chart(ax1, angles, lar_data, team_colors['LAR'])<br/>ax2 = create_radar_chart(ax2, angles, ari_data, team_colors['ARI'])<br/>ax3 = create_radar_chart(ax3, angles, sea_data, team_colors['SEA'])<br/>ax4 = create_radar_chart(ax4, angles, sf_data, team_colors['SFO'])</span><span id="399b" class="na lw it mv b gy nf nc l nd ne">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/1d27f6bef53ab5eebecda710017be6f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*qYaAN8n21VviuULMFwvGCA.png"/></div></figure><p id="abff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据似乎支持我们从视力测试中看到的:</p><ol class=""><li id="62a5" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">Russell Wilson处于精英水平，在所有统计类别中至少达到75个百分点。这个分析也没有考虑到他的扰流能力带来了什么。</li><li id="8ec9" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">吉米·加罗波洛通常是一个可靠的四分卫，但不时会投出一些愚蠢的拦截。</li><li id="19e4" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">贾里德·戈夫(Jared Goff)获得了很多码，但这似乎并没有转化为大量生产(<em class="oa">即</em>“空码”)。</li><li id="b649" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">凯勒穆雷很难判断，因为他是一个新秀，但他的效率看起来是四个人中最低的。像威尔逊一样，他的机动性在这个情节中没有被考虑。</li></ol><p id="0109" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> MVP赛</strong></p><p id="86e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最有价值球员的争夺(在QB)在拉塞尔·威尔逊和拉马尔·杰克逊(谁最终获胜)之间展开:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="ef58" class="na lw it mv b gy nb nc l nd ne"># MVP Race<br/># Create figure<br/>fig = plt.figure(figsize=(8, 4), facecolor='white')</span><span id="1b12" class="na lw it mv b gy nf nc l nd ne"># Add subplots<br/>ax1 = fig.add_subplot(121, projection='polar', facecolor='#ededed')<br/>ax2 = fig.add_subplot(122, projection='polar', facecolor='#ededed')</span><span id="e260" class="na lw it mv b gy nf nc l nd ne"># Adjust space between subplots<br/>plt.subplots_adjust(hspace=0.8, wspace=0.5)</span><span id="7d38" class="na lw it mv b gy nf nc l nd ne"># Get QB data<br/>bal_data = get_qb_data(data_radar_filtered, 'BAL')<br/>sea_data = get_qb_data(data_radar_filtered, 'SEA')</span><span id="1f57" class="na lw it mv b gy nf nc l nd ne"># Plot QB data<br/>ax1 = create_radar_chart(ax1, angles, sea_data, team_colors['SEA'])<br/>ax2 = create_radar_chart(ax2, angles, bal_data, team_colors['BAL'])</span><span id="23b7" class="na lw it mv b gy nf nc l nd ne">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/91f34c96941e3d346a13ff4c6d339e1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*-oZAT9rQnLhEGHhMHzvViw.png"/></div></figure><p id="74ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从一个纯粹的传球者的角度来看，拉塞尔·威尔逊有更平衡的数据，但拉马尔·杰克逊显然有更“划算”的传球码数，正如他的传球得分和四分卫得分所显示的那样。此外，拉马尔·杰克逊创造了一个赛季的QB冲刺记录，这在这张图表中没有体现出来。</p><p id="a220" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">起草第一轮QBs的团队</strong></p><p id="15e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">四名四分卫在2020年NFL第一轮选秀中被选中:乔·伯罗(CIN)，图阿·塔戈瓦洛(米娅)，贾斯汀·赫伯特(拉加)，以及(令人惊讶的)乔丹·洛夫(英国)。让我们想象一下这些选秀会取代的四分卫的数据。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="1bb6" class="na lw it mv b gy nb nc l nd ne"># 1st Round Draft Picks<br/># Create figure<br/>fig = plt.figure(figsize=(8, 8), facecolor='white')</span><span id="91d2" class="na lw it mv b gy nf nc l nd ne"># Add subplots<br/>ax1 = fig.add_subplot(221, projection='polar', facecolor='#ededed')<br/>ax2 = fig.add_subplot(222, projection='polar', facecolor='#ededed')<br/>ax3 = fig.add_subplot(223, projection='polar', facecolor='#ededed')<br/>ax4 = fig.add_subplot(224, projection='polar', facecolor='#ededed')</span><span id="aee4" class="na lw it mv b gy nf nc l nd ne"># Adjust space between subplots<br/>plt.subplots_adjust(hspace=0.8, wspace=0.5)</span><span id="5ae6" class="na lw it mv b gy nf nc l nd ne"># Get QB data<br/>cin_data = get_qb_data(data_radar_filtered, 'CIN')<br/>mia_data = get_qb_data(data_radar_filtered, 'MIA')<br/>lac_data = get_qb_data(data_radar_filtered, 'LAC')<br/>gnb_data = get_qb_data(data_radar_filtered, 'GNB')</span><span id="5bb5" class="na lw it mv b gy nf nc l nd ne"># Plot QB data<br/>ax1 = create_radar_chart(ax1, angles, cin_data, team_colors['CIN'])<br/>ax2 = create_radar_chart(ax2, angles, mia_data, team_colors['MIA'])<br/>ax3 = create_radar_chart(ax3, angles, lac_data, team_colors['LAC'])<br/>ax4 = create_radar_chart(ax4, angles, gnb_data, team_colors['GNB'])</span><span id="bccc" class="na lw it mv b gy nf nc l nd ne">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/bf134601bd6cd165474bd77ae8dc686e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*OJF877wAOpnIFkFCqIqRqA.png"/></div></figure><ol class=""><li id="98fc" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">无论从哪方面来看，安迪·道尔顿都经历了一个糟糕的赛季——显然是时候继续前进了</li><li id="ce0e" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">Ryan Fitzpatrick在所有六个统计指标上都低于平均水平，这个赛季表现平平。考虑到乔什-罗森在菲茨派翠克的比赛中坐冷板凳，热火需要为图阿的未来投资。</li><li id="0d64" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">菲利普·里弗斯实际上在大多数类别中表现平平，但显然有一些糟糕的决策，从他拦截的次数来看。</li><li id="852e" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">Aaron Rodgers经历了一个似乎高于平均水平的赛季，但从我们对他的高度期望来看，仍然低于平均水平。乔丹的爱情选择对每个人来说都是一个震惊。</li></ol><h1 id="bd85" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">其他分部</strong></h1><h2 id="24a9" class="na lw it bd lx oc od dn mb oe of dp mf li og oh mh lm oi oj mj lq ok ol ml om bi translated"><strong class="ak"> NFC北方</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/8ff74d7bd68715e6a5bca378c3cf60d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*CSrSGpWBenHD8vX-8GLq2Q.png"/></div></figure><h2 id="ab1f" class="na lw it bd lx oc od dn mb oe of dp mf li og oh mh lm oi oj mj lq ok ol ml om bi translated"><strong class="ak"> NFC东</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/55af94843fa8ced7c53774b2b8664f16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*e4rvsGunore6NpHOFHYV8w.png"/></div></figure><h2 id="7d87" class="na lw it bd lx oc od dn mb oe of dp mf li og oh mh lm oi oj mj lq ok ol ml om bi translated"><strong class="ak"> NFC South </strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/1398e57948a9ba1d7b73e62aff667d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*V59doztwFQikj5vl2F2XnQ.png"/></div></figure><h2 id="2509" class="na lw it bd lx oc od dn mb oe of dp mf li og oh mh lm oi oj mj lq ok ol ml om bi translated"><strong class="ak">亚足联西区</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/ae829c400e90d23ad3ddd900f7c59bef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*AOaM2lgfnnQ8Nwv05_O69A.png"/></div></figure><h2 id="002f" class="na lw it bd lx oc od dn mb oe of dp mf li og oh mh lm oi oj mj lq ok ol ml om bi translated"><strong class="ak"> AFC北部</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/846170d1fd9965d454248cc97a962ed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*VDyjmQGgsKhTRV3CvHg40g.png"/></div></figure><h2 id="c265" class="na lw it bd lx oc od dn mb oe of dp mf li og oh mh lm oi oj mj lq ok ol ml om bi translated"><strong class="ak">亚足联东区</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/993aa2d23db3f202403d52548e39f214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*f7LxxvrJfL-QdplllzhL-g.png"/></div></figure><h2 id="a3d8" class="na lw it bd lx oc od dn mb oe of dp mf li og oh mh lm oi oj mj lq ok ol ml om bi translated"><strong class="ak">亚足联南区</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/dbd9d38c61af4896c945213a95a0a7aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*1-kmFkpavTTRzZTufNLppg.png"/></div></figure><h1 id="1101" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">结束语</strong></h1><p id="bbbe" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">正如您所看到的，可能性是无限的——这个框架可以很容易地适用于其他统计数据，如抢断和接收指标。本文使用的Jupyter笔记本可以在这个<a class="ae ky" href="https://github.com/venkatesannaveen/medium-articles" rel="noopener ugc nofollow" target="_blank"> Github资源库</a>中找到。</p><p id="ae25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读！我感谢任何反馈，你可以在<a class="ae ky" href="https://twitter.com/naveenv_92" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上找到我，并在<a class="ae ky" href="https://www.linkedin.com/in/naveenvenkatesan/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上与我联系以获得更多更新和文章。</p></div></div>    
</body>
</html>