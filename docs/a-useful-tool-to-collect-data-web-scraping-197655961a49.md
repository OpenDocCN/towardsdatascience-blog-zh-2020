# 收集数据的有用工具:网络搜集

> 原文：<https://towardsdatascience.com/a-useful-tool-to-collect-data-web-scraping-197655961a49?source=collection_archive---------15----------------------->

![](img/af6e3e284387b1bfab9018b2c06bd421.png)

安德烈·季霍诺夫斯基在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

## 使用这一工具的好处和道德

**第一节:简介**

计算机的发展产生了许多有用的技术，可以创建大规模的数据库。一种技术是 web 抓取，这是统计学家、数据科学家、计算机科学家和 web 开发人员最常用的一种技术，用于积累大量数据，这些数据用统计方法进行处理，以便进行分析。顾名思义，web scraping 是一种从万维网中提取特定数字、文本和表格等信息的方法，使用的软件可以方便地存储和管理已下载的所有信息。

不管我们使用什么样的浏览器，每个网页都使用计算机语言，比如 XML/HTML、AJAX 和 JSON 来呈现网页中的信息。当一个人在互联网上进入一个网页时，无论是社交媒体、维基百科还是像谷歌或必应这样的搜索引擎，使用浏览器都意味着使用 HTML (Munzert et al .，2014)。网页在任何浏览器上呈现的信息与 HTML 中呈现的信息不同；换句话说，HTML 是网页的代码，浏览器能够确保用户友好的体验。特别是，本文将尝试解释 HTML 成功实现 web 抓取工具所具有的一些特性，以及它们与 Python 的关系。

本文的主要目的是展示 web 抓取背后的有用性，以及统计学家如何利用这种方法。在第 4 节的结尾，Python 代码提供了一个解释，以深入了解这种技术的范围。

这篇文章将由以下不同部分组成。首先，第 2 部分将解释为什么网络搜集对统计人员有用。第 3 节将解释为什么在某些情况下，网络抓取很难使用，以及进行网络抓取的法律后果。在第 4 节中，将提供 Python 代码来解释使用金融 web 页面的 web 报废的简单实现。最后，在最后一节给出了结论。

**第二节:网页抓取的重要性**

统计学家经常发现获取数据很困难。收集数据的方式通常是通过观察、抽样调查、访谈或焦点小组。在许多情况下，从上述方法中收集信息需要时间和金钱。如今，互联网已经成为许多专业人士和科学家的重要信息来源。从这个意义上说，要解决很多学术角度或者行业内的问题，从互联网上提取信息是容易、快捷、廉价的。例如，政府通过各自的统计局免费提供公共商业周期数据；世界各地的中央银行提供经济和金融数据；国际能源署(IEA)提供石油和天然气等信息。

作为从网络浏览器复制和粘贴信息到电子表格的替代方法，计算机程序可以比人类更快更精确地完成这项工作(Broucke 和 Baesens，2018 年)。此外，如果一个人需要从许多网页下载数据，该算法会自动将收集到的所有信息整理到一个数据库中，以便随时进行分析。

或者，API 是由网页的创建者提供的一组功能，以便程序员能够使用这些功能从特定网页中提取信息。此外，API 允许运行它的程序正确地与网页通信。正如 Broucke 和 Baesens (2018 年)所建议的，“例如，Twitter、脸书、LinkedIn 和谷歌都提供这样的 API，以便搜索和发布推文，获得你的朋友和他们喜欢的人的列表，查看你与谁联系，等等”。

不幸的是，该网站可能会提供一个昂贵或用途有限的 API，等等；因此，使用网页抓取可能是实用的。事实是，只要数据在 web 浏览器中是可见的，scraper 就可以使用程序来访问和提取一些信息。如果是这样，这些信息可以以任何方式被清理、存储和使用(Broucke 和 Baesens，2018)。

正如前面提到的，HTML 有一些特性可以用来用 Python 实现 web 抓取机器人。此外，程序员可以在 Python 中安装 web 抓取工具，比如 Selenium。这个抓取工具的主要功能是使浏览器自动化，以便可以加载网站，恢复其内容，并像用户一样使用浏览器执行操作。Selenium 可以通过使用不同的编程语言来操作，包括 Python、PHP、C #和 Java (Broucke 和 Baesens，2018)。出于本文的目的，将使用 Python。

假设一名统计学家已经成功地下载并安装了 Python 中的 Selenium，并创建了一个简单的代码来从 web 中提取一些信息。那个人运行代码，发现它不起作用；没有 web 浏览器，Selenium 本身无法工作。特别是，它将需要使用一个网络驱动程序。该工具适用于大多数浏览器，如 Chrome、Firefox、Safari 和 Explorer (Broucke 和 Baesens，2018)。web 驱动程序可以从互联网上下载，并且必须与将要用于执行抓取的浏览器具有相同的版本。通过下载正确的 WebDriver，然后运行前面介绍的代码，Python 通过 Selenium，它会“说”和浏览器一样的语言。这将使得能够从网页中正确地提取信息。

迄今为止，我们知道我们需要一个特定的程序来做网络搜集，Python 我们还需要在 Python 中安装 Selenium，以及一个能够与 Python 成功通信的 WebDriver。

有很多方法可以从网页上抓取信息。Selenium 可以在 HTML 代码中通过 ID、名称、XPath、链接文本、部分链接文本、标记名、类名和 CSS 选择器从特定网页中提取特定信息(Broucke 和 Baesens，2018)。上面提到的一个有用的框架是 XML Path 或 XPath。XPath 是一种分层寻址机制，类似于计算机用来在许多文件夹中定位文件的机制(Munzert 等人，2014 年)。换句话说，XPath 是指向信息在网页的 HTML 代码上的确切位置的路径。值得一提的是，Munzert 等人(2014)指出，XPath“只是从 HTML、XML 等标记文档中选择信息的一个非常有用的工具”。

**第三节:使用网页抓取时的常见问题**

本节将展示在进行网络抓取时可能出现的真实例子和复杂情况；刮网时问题是不可避免的，也是常见的。对于网络抓取来说，能够检测、抛出和管理这些错误是至关重要的(Mitchell，2013)。正如 Mitchell(同上)所言，“网络是杂乱的，你永远无法确定是否有某个元素，或者某个页面是否返回了你想要的数据，或者某个网站的服务器是否已经启动并在运行”。许多数据分析师在进行网络搜集时会遇到意想不到的问题。有趣的是，我曾经在一家投资银行工作，其中许多分析数据来自互联网，我们通过对金融网页进行网络抓取来提取这些数据。我们开发了这些工具来提取股票、债券和指数的金融时间序列，而不是将彭博或路透社作为主要的信息来源。

团队遇到的最常见的问题是网页模板的突然更新。换句话说，为提取特定网页的信息而开发的网络抓取工具将不能与网页的新结构一起工作。一个需要花费大量时间开发的代码可能在几秒钟内就变得无关紧要了。解决这个问题的一个方法是确保代码的结构足够灵活，以便能够更快地适应新的网页。

当试图下载信息时，一些网站可能不同意网页抓取器。例如，如果在同一个网站发送数百个 HTTP 请求，尽管许多网页相对健壮，但一些网页可能会停止工作，无法参加常规的用户流(Broucke 和 Baesens，2018)。网页之所以有效，是因为公司拥有可以处理大量用户的服务器。如果许多用户同时进入一个网页，这个网页很可能会崩溃。

同样的问题也发生在 Bidder's Edge 上，这是一家致力于从拍卖网站收集数据并提供给网站的公司。用户可以在他们的网站上搜索列表，而不是在每个拍卖地点张贴许多申请。该公司被易贝起诉，并针对其网站上使用的机器人进行了有效辩护(H. Liu and Davis，2015)。

此外，一个新的问题出现了:网络抓取的合法性。在分析了一些涉及网络抓取的真实案例后，Munzert 等人(2014)确认“从这些令人不安的故事中吸取的教训是，不清楚哪些行为可以归入‘网络抓取’标签下，哪些行为实际上是非法的”。H. Liu 和 Davis (2015)指出“法律是模糊的。在很大程度上，公司已经成功地阻止了不必要的刮削——至少是部分地。但称这是一个既定法律领域还为时过早”。此外，Mitchell，R. (2013)也持类似观点，认为“网络抓取的法律先例很少”。

为了避免法律上的问题，遵循网站上的使用条款和版权文件(同上)是被普遍接受的。Broucke 和 Baesens (2018 年)还讨论了网络抓取的合法性，写道“显而易见的是，围绕网络抓取的法律格局仍在演变，许多被引用为违反的法律在我们的数字时代尚未成熟”。最后 13 洗。J.L .技术公司。& Arts 275 (2018)指出“技术往往领先于法律和政策。网络爬虫目前几乎完全受社会规范和礼貌的支配，国会、行政部门和法院都没有颁布法律”。很明显，使用网页抓取工具时存在灰色地带；大公司并没有打赢所有的官司。

为了避免网页出现问题，最近提出了一个想法，那就是 robots.txt 文件。这一概念是为了表明机器人可以或不可以访问存储在网站根目录中的文本文件中的数据(Munzert 等人，2014 年)。换句话说，这个文本文件“告诉”网页抓取工具哪些信息可以从网页下载，哪些不可以。然而，并没有表明 robots.txt 文件本身具有法律约束力，尽管服务条款通常具有法律约束力(Mitchell，r .，2013)。

最后，美国列出的最常见的法律问题有:违反条款；版权或商标侵权；《计算机欺诈和滥用法》(Fraud 侵犯动产；机器人排除协议；以及《数字千年版权法案》(DMCA)、《CAN-SPAM 法案》(Broucke and Baesens，2018)。

**第四部分:网页抓取的示例**

本节将帮助理解如何从金融网页实现 Python web 抓取代码。这个想法是给出一个概要，指定代码中最重要的部分；完整的代码可以在我的 [GitHub 库](https://github.com/juanvarl/A-Useful-Tool-to-Collect-Data-Web-Scraping)中找到。如果你愿意，请随时检查和使用它。该机器人从不同的交易所交易基金(etf)中提取特定特征，并将其排列到数据库中(etf.com，2020)。ETF 是一组证券，如股票、商品、债券或投资类型的混合，其目的是复制或跟踪基础指数。每只 ETF 都有一个价格，投资者可以轻松地买卖它们(Investopedia，2020)。

首先，我们需要导入将在整个代码中使用的库。如前所述，我们将使用 Selenium、Chrome 作为浏览器，以及 Chrome WebDriver(因为 WebDriver 版本需要与浏览器版本相同)。从代码行 1 到 5，显示了将要使用什么库以及使用了特定库的什么功能。

为了更好地理解，库 openpyxl 帮助读写 Excel 文档，numpy 提供有用的数学函数，pandas 是一个帮助操作数据结构的包(PyPI，2020)。从这个意义上说，第 7 行将创建一个工作簿，存储从 web 下载的所有数据。

第 16、20、21 和 105 行是需要修改的特定目录，以便代码可以在另一台计算机上运行。具体来说，第 21 行包含工作簿，其中包含将要被剔除的 ETF 的输入。此外，第 20 行显示了 WebDriver 的位置，它将用于进行 web 抓取。

第 29 行显示了包含路径和如何显示浏览器的首选项的变量。第 34 行描述了将要从网页中提取的特性。因此，第 43 行显示了如何使用第 29 行创建的变量打开浏览器的命令。

XPath 语法出现在第 45、50、52、58、72、77、82 和 95 行。通过观察代码，在 XPath 代码之间，我们可以找到 try:和 except:参数。当代码在 HTML 代码中找不到 XPath 时，这很有帮助。否则，我们会在执行代码时看到一个错误。

一方面，第 38 行中的 for 循环将迭代从第 21 行的工作簿中提取的每个 ETF。另一方面，第 67 行和第 92 行将有助于迭代一些特定 ETF 的一些特征。最后，第 103 行累积了下载的所有信息；第 104 行将该信息保存在特定目录下的. csv 文件中，第 107 行关闭 WebDriver。下面的视频展示了这段代码的作用。

**第五部分:结论**

网络抓取是从网页中提取数据的强大工具。根据研究人员试图进行的分析类型，网络搜集可能会取代既费钱又难以实施的调查。如果对代码进行适当的编程，与人类相比，计算机可以提取和排列更多的信息。

尽管 web 抓取有许多方式，但本文解释了如何使用 Python 实现 web 抓取工具。此外，还展示了如何在 Python 代码上使用 Selenium，以及它与 HTML 的关系。最后，展示了使用 XPath 从 HTML 代码中提取特定信息的方法。

做网页抓取时出现困难；问题是不可避免的，但通常是可以解决的。这篇文章通过许多不同作者的研究证明，围绕这种技术工具的合法性并没有一条清晰的道路。关于这个问题的不确定性，建议先查看条款，建议有网站官方授权做网页抓取。如果没有正确的使用，网页抓取工具可能会被起诉。免费获取并不意味着必要的免费数据。

**参考文献:**

马蒂·阿尔钦。以及 j·伯顿·勃朗宁(2019)。 *Pro Python 3:专业开发的特性和工具。*压力。

Seppe vanden B .和 Bart B. (2018)。*面向数据科学的实用 Web 抓取:Python 的最佳实践和示例。*一种压力。

Munzert，s .，Rubba，c .，Meissner，p .和 Nyhuis (2014 年)。使用 R 的自动数据收集:Web 抓取和 Tex 实用指南。约翰·威利的儿子们。

米歇尔河(2013 年)。*用 Java 进行即时网页抓取*。打包。出版有限公司。

Gold，z .和 Latonero，M. (2018 年)。机器人受欢迎吗？网络爬行和抓取的道德和法律考量。华盛顿法律、技术杂志& Arts，13(3)，第 277-281 页。

H.刘教授和戴维斯博士(2015 年)。*网页抓取-免费样品的限制*。滑坡，8(2(2015 年 11 月/12 月)，第 1–5 页。

etf.com(2020 年)。 *ETF.com:找到合适的 ETF——工具、评级、新闻*。【在线】可在:[http://www.etf.com](http://www.etf.com)获得。(etf.com，2020)

Investopedia。(2020). *Investopedia* 。【在线】可在:[https://www.investopedia.com](https://www.investopedia.com)获得。(Investopedia，2020 年)

皮皮。(2020). *PyPI* 。【在线】可在:[https://pypi.org](https://pypi.org)找到。(PyPI，2020 年)