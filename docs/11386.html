<html>
<head>
<title>How to track football players using Yolo, SORT and Opencv.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Yolo，SORT 和 Opencv 追踪足球运动员？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-track-football-players-using-yolo-sort-and-opencv-6c58f71120b8?source=collection_archive---------9-----------------------#2020-08-07">https://towardsdatascience.com/how-to-track-football-players-using-yolo-sort-and-opencv-6c58f71120b8?source=collection_archive---------9-----------------------#2020-08-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9b29" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Yolov3、Opencv 和 SORT 检测和跟踪足球运动员，并将球员的运动转换为鸟瞰图。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/16d3e2fa653aeb81fef1b4f9b78c4634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*PET5MB76d59EtAomBIMksw.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">鸟瞰视图中的玩家跟踪。(背景图片来自<a class="ae ku" href="https://commons.wikimedia.org/wiki/File:Soccer_field_-_empty.svg" rel="noopener ugc nofollow" target="_blank">https://commons . wikimedia . org/wiki/File:Soccer _ field _-_ empty . SVG</a>)</p></figure><h1 id="873f" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated">介绍</h1><p id="148f" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">在这篇文章中，我将展示我如何使用 Yolov3，Opencv 和 SORT from video clip 检测和跟踪球员，并将检测结果转换为如上所示的鸟瞰图。</p><p id="69e0" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">受<a class="ae ku" href="https://medium.com/@samuelfblake?source=post_page-----a64d9564ccb1----------------------" rel="noopener"> Sam Blake </a>的伟大作品(<a class="ae ku" href="https://medium.com/hal24k-techblog/how-to-track-objects-in-the-real-world-with-tensorflow-sort-and-opencv-a64d9564ccb1" rel="noopener">https://medium . com/Hal 24k-tech blog/how-to-track-objects-in-the-real-world with-tensor flow-sort-and-opencv-a64d 9564 CCB 1</a>)的启发，我将为这个项目做以下步骤:</p><ol class=""><li id="1015" class="mo mp it lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">对象检测(Yolo 和 Opencv)</li><li id="da14" class="mo mp it lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">对象跟踪(排序)</li><li id="07ab" class="mo mp it lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">透视变换(Opencv)</li></ol><h1 id="73a9" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated"><strong class="ak">足球视频数据集</strong></h1><p id="48cf" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">为了有一个稳定的跟踪和透视变换，我需要一个没有摄像机移动的视频剪辑。我从<a class="ae ku" href="http://ipl.ce.sharif.edu/ball_datasets.html" rel="noopener ugc nofollow" target="_blank"> IPL 球检测数据集下载了视频。</a>请注意，球在这个项目中没有被跟踪，它已经从源被跟踪(绿色边界框)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/aabfbea6d8642efeeedd73b88db04ccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*awaNxSIH0b_jEc1KWL8SzQ.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">该项目的视频输入(从<a class="ae ku" href="http://ipl.ce.sharif.edu/ball_datasets.html" rel="noopener ugc nofollow" target="_blank">这里</a>下载)</p></figure><h1 id="590a" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated"><strong class="ak">物体检测</strong></h1><p id="b3b4" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">第一步是加载视频并检测玩家。</p><p id="71b4" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">我使用了预先训练的 Yolov3 权重，并使用了 Opencv 的 dnn 模块，只选择了分类为“人”的检测。</p><p id="d378" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">我为检测到的玩家画了边界框，并在前十帧画了他们的尾巴。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/696daf8899b9e2ef0a7c75b5b0288422.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*Zpea6ZSapSOSPNqXHwVRQg.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">使用 Yolov3 和 Opencv 进行玩家跟踪</p></figure><p id="b6a7" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">看起来预训练的模型做得很好。</p><h1 id="9eb2" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated">目标跟踪</h1><p id="0685" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">接下来，我想跟踪玩家，并为他们分配唯一的 id。我使用了 Alex Bewley 的排序算法(简单的在线和实时跟踪)，我把它应用到了我之前的工作中。</p><div class="nd ne gp gr nf ng"><a rel="noopener follow" target="_blank" href="/detect-and-track-baseball-using-detectron2-and-sort-6dd92a46e6f2"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">检测和跟踪棒球使用探测器 2 和排序</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">当视频中有多个棒球时，我如何跟踪棒球。</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">towardsdatascience.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu ko ng"/></div></div></a></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/fa2efc9a14212cacce6eca6806d3a6b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*chmIVsr8D0GhL_ZMxdAYEw.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">使用排序的玩家跟踪。</p></figure><p id="a57e" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">现在，每个玩家都有一个唯一的 ID，并显示在视频中。</p><h1 id="592e" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated">透视变换</h1><p id="7cf8" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">视频现在看起来不错，但我仍然希望在鸟瞰图中有球员的动作。做透视变换就可以了。这涉及到一点数学问题，幸运的是 Opencv 的<a class="ae ku" href="https://docs.opencv.org/2.4/modules/imgproc/doc/geometric_transformations.html#getperspectivetransform" rel="noopener ugc nofollow" target="_blank"> getPerspectiveTransform </a>函数使它变得简单多了。</p><p id="efe8" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">我需要找到 4 个固定点作为参考，并从视频和鸟瞰图像中识别坐标。</p><p id="7d6f" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">首先，我从视频中找出 4 个参考点，如红色斑点所示，并获得像素坐标。</p><pre class="kj kk kl km gt nv nw nx ny aw nz bi"><span id="8f67" class="oa kw it nw b gy ob oc l od oe">np.array([<br/>        [1, 47], # Upper left<br/>        [878, 54], # Upper right<br/>        [1019, 544], # Lower right<br/>        [1, 546] # Lower left<br/>                                   ])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi of"><img src="../Images/84ab13a7c5e03a06dd4bba3d9c389abc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ITXaTVQvggtvaIDgX-sZoQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">视频上标记的 4 个参考点(红点)</p></figure><p id="9d18" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">我没有从视频中看到非常坚实的参考点，所以我粗略地确定了 4 个点，并在鸟瞰图上标记了这些位置，并获得了相应的像素坐标。如果参考点更健壮，它将更精确。</p><pre class="kj kk kl km gt nv nw nx ny aw nz bi"><span id="2b2e" class="oa kw it nw b gy ob oc l od oe">np.array([<br/>        [871, 37], # Upper left<br/>        [1490, 39], # Upper right<br/>        [1458, 959], # Lower right<br/>        [1061, 955] # Lower left<br/>                                   ])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi ok"><img src="../Images/e02a1ca1c8988a9b27a4dd2332bdc3cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LENQwYuHl1NXHUB3h3dl2Q.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">4 个参考点标记在鸟瞰图上(红点)</p></figure><p id="61f5" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">然后通过使用这些参考点应用 Opencv 的<a class="ae ku" href="https://docs.opencv.org/2.4/modules/imgproc/doc/geometric_transformations.html#getperspectivetransform" rel="noopener ugc nofollow" target="_blank"> getPerspectiveTransform </a>，我们可以将检测从视频转换为鸟瞰图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/2dd2d0cbaf7d22ce25b6cbbf0ba16ea8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*ys9vXbsYte4hhFhxqse9Fw.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">视频和鸟瞰图上的玩家跟踪。</p></figure><p id="d8f7" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">有了球员的运动信息，就有可能做进一步的分析，比如球员的跑动距离和速度。</p><p id="9003" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">在我的 2016 Macbook Pro Intel i5 CPU 上，运行这种玩家跟踪的速度约为每帧 0.3 秒。如果有必要，可以通过对某些应用程序使用 GPU 来实时实现这一点。</p><p id="5240" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">感谢阅读，欢迎评论和建议！</p><p id="0a81" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">在这里支持我:【https://medium.com/@c.kuan/membership】T4</p></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><p id="698a" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">在我的下一篇文章中，我使用 OpenCV 根据球员球衣的颜色来识别他们的球队。随便看看吧！</p><div class="nd ne gp gr nf ng"><a rel="noopener follow" target="_blank" href="/football-players-tracking-identifying-players-team-based-on-their-jersey-colors-using-opencv-7eed1b8a1095"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">足球运动员跟踪——使用 OpenCV 根据运动员球衣的颜色识别他们的球队</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">使用 Yolov3、SORT 和 OpenCV 检测、跟踪、确定球员的球队并将其转换为鸟瞰图。</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">towardsdatascience.com</p></div></div><div class="np l"><div class="os l nr ns nt np nu ko ng"/></div></div></a></div></div></div>    
</body>
</html>