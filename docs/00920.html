<html>
<head>
<title>Using Python and Selenium to get coordinates from street addresses</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 和 Selenium 从街道地址获取坐标</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-python-and-selenium-to-get-coordinates-from-street-addresses-62706b6ac250?source=collection_archive---------4-----------------------#2020-01-27">https://towardsdatascience.com/using-python-and-selenium-to-get-coordinates-from-street-addresses-62706b6ac250?source=collection_archive---------4-----------------------#2020-01-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/fd6c72e4ce647f8d9f487ab56308a41c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oNUuJJUC_J7hCzbZ0zds2Q.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">澳洲墨尔本市(www.pxhere.com)</p></figure><p id="6de5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这是一篇分步介绍如何使用<strong class="kh iu"> Python </strong>和<strong class="kh iu"> Selenium </strong>从基于街道地址的谷歌地图<strong class="kh iu">中抓取<strong class="kh iu">坐标数据</strong>(纬度和经度值)的文章。</strong></p><p id="d157" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在这个例子中，我将使用一个包含所有澳大利亚慈善机构和非营利组织街道地址的官方数据集。最后，我将继续使用<strong class="kh iu">lyum，</strong>绘制<strong class="kh iu">墨尔本</strong>市的所有慈善机构和非营利机构的地图，以展示如何使用新获得的坐标数据。</p><p id="eae1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">要继续学习，您可以从我的 GitHub 库下载<a class="ae ld" href="https://github.com/kelmouloudi/MediumArticle-Selenium" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本。</a></p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="b9d7" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">软件包和设置:</h1><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/f1e693479b2897b961d36721ba63ec33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDcTpidlPaFBD473jux6tg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">Selenium 主要用于自动化 web 应用程序测试，但也可以用于从网站上抓取数据或在浏览器上执行重复性任务(www.rawpixel.com)</p></figure><p id="5ae5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将需要<a class="ae ld" href="https://pypi.org/project/selenium/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh iu">硒</strong> </a> <strong class="kh iu"> </strong> python 包来执行数据抓取<strong class="kh iu">。</strong>如果还没有，可以使用<strong class="kh iu"/>pip:<strong class="kh iu"/><code class="fe mo mp mq mr b"><strong class="kh iu">pip install selenium</strong></code><strong class="kh iu"/>安装<a class="ae ld" href="https://www.youtube.com/watch?v=FKwicZF7xNE" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="ee60" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们还需要一个<strong class="kh iu">网络驱动</strong>来与浏览器互动，所以你必须<a class="ae ld" href="https://chromedriver.chromium.org/downloads" rel="noopener ugc nofollow" target="_blank">到这里下载</a>到你的机器上(确保它与你当前的 Chrome 版本兼容)。</p><p id="2118" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在让我们开始导入:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="8905" class="mw lm it mr b gy mx my l mz na">from selenium import webdriver</span></pre><p id="ed63" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们也得到<a class="ae ld" href="https://github.com/tqdm/tqdm" rel="noopener ugc nofollow" target="_blank"> <strong class="kh iu"> tqdm </strong> </a>，一个必不可少的 progressbar python 包。估计你的代码的 web 抓取部分将花费多少时间是非常有用的(我使用 tqdm_notebook 是因为我在 Jupyter 笔记本上工作) :</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="3b0c" class="mw lm it mr b gy mx my l mz na">from tqdm import tqdm_notebook as tqdmn</span></pre><p id="8404" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">除此之外，我们还需要<a class="ae ld" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh iu">熊猫</strong> </a> <strong class="kh iu"> </strong>来读取和操作数据集:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="c9c6" class="mw lm it mr b gy mx my l mz na">import pandas as pd</span></pre><p id="7ff1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最后，我们将得到<a class="ae ld" href="https://pypi.org/project/folium/" rel="noopener ugc nofollow" target="_blank"><strong class="kh iu"/></a><strong class="kh iu"/>来绘制地图上的坐标数据(可以使用<code class="fe mo mp mq mr b">pip install folium</code>来安装):</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="1b03" class="mw lm it mr b gy mx my l mz na">import folium</span></pre><p id="15c3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我将在一个 Jupyter 笔记本上工作(<a class="ae ld" href="https://github.com/kelmouloudi/MediumArticle-Selenium" rel="noopener ugc nofollow" target="_blank">你可以在这里下载</a>)。如果您在 python IDE 中工作，所有这些步骤仍然适用。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="a686" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">数据集:ACNC 慈善和非营利注册</h1><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nb"><img src="../Images/c3dc1e97017dd366185033771d7807dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8b70fHIS09h-b_KJ0CV_UA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">澳大利亚慈善和非营利委员会(ACNC)是澳大利亚慈善机构的国家监管机构</p></figure><p id="c552" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在涵盖过去 10 年的第 10 版 CAF 世界捐赠指数中，澳大利亚在全球排名第四。通过访问<a class="ae ld" href="https://www.acnc.gov.au/" rel="noopener ugc nofollow" target="_blank"> ACNC 的网站</a>，你会很快注意到他们让研究人员可以很容易地获取所有关于澳大利亚慈善机构和非营利组织的数据。</p><p id="6774" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将使用的数据集可以在这里下载(以及一个解释变量的有用的用户注释文档):</p><ul class=""><li id="692c" class="nc nd it kh b ki kj km kn kq ne ku nf ky ng lc nh ni nj nk bi translated"><a class="ae ld" href="http://data.gov.au/dataset/acnc-register" rel="noopener ugc nofollow" target="_blank"> ACNC 慈善登记数据集</a><em class="nl">【Excel 文件 XLSX</em><strong class="kh iu"><em class="nl">|</em></strong><em class="nl">7.7 Mb</em><strong class="kh iu"><em class="nl">|</em></strong><em class="nl">截至 2020 年 1 月 23 日 74155 行 60 列</em></li></ul><p id="57b1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">该数据集展示了澳大利亚慈善机构和非营利机构的许多有趣方面:唯一标识符、法定名称、地址(用于通信)、注册日期、规模、目的、受益人等(阅读用户注释了解更多信息)。</p><p id="6489" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这里我们主要感兴趣的是<strong class="kh iu">街道地址特征</strong>，它跨越了几列:<em class="nl">地址 _ 行 _1 </em>，<em class="nl">地址 _ 行 _2 </em>，<em class="nl">地址 _ 行 _3 </em>，<em class="nl">城镇 _ 城市</em>，<em class="nl">州</em>，<em class="nl">邮政编码</em>和<em class="nl">国家</em>。此外，为了简单起见，我们将只调查墨尔本市的慈善机构和非营利组织。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="50dc" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">数据清理和准备:</h1><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/77fd72e938fb3f1da20855fa17801769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1dSdBkGK0pXu58n2dLKYJQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">自由峰的 rawpixel.com/宏矢量</p></figure><p id="9b81" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">首先，让我们来看看之前从 ACNC 网站下载的关于熊猫的数据集:</p><figure class="mk ml mm mn gt ju"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="eb47" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">请确保提供 Excel 文件在您的计算机上的路径。参数<code class="fe mo mp mq mr b">keep_default_na</code>被设置为<code class="fe mo mp mq mr b">False</code>，所以当某些值丢失时，我们将得到空值而不是<code class="fe mo mp mq mr b">NaN</code>。稍后当我们将所有街道地址变量合并成一个变量时，这将非常有用。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/2bb9343a0bf8f2b0b125a366415ca0cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V-ZnQnITEHddAXu6fcVQLQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">acnc.shape 给出了<strong class="bd np"> 74155 </strong>行和<strong class="bd np"> 60 </strong>列</p></figure><p id="576a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，让我们创建一个新的数据框架<code class="fe mo mp mq mr b">mel</code>，在通过变量<code class="fe mo mp mq mr b">Town_City</code>过滤后作为<code class="fe mo mp mq mr b">acnc</code>的副本，以便只选择墨尔本市的慈善机构和非营利组织:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="d949" class="mw lm it mr b gy mx my l mz na">mel = acnc[acnc.Town_City.str.contains('melbourne', case=False)][['ABN', 'Charity_Legal_Name', 'Address_Line_1', 'Address_Line_2', 'Address_Line_3', 'Town_City', 'State', 'Postcode', 'Country', 'Date_Organisation_Established', 'Charity_Size']].copy()</span></pre><p id="ca30" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我在这里做了两件事:我通过<code class="fe mo mp mq mr b">Town_City</code>变量过滤了<code class="fe mo mp mq mr b">acnc</code>数据帧，然后我从最初的 60 列中只选择了 11 列有用的列。<code class="fe mo mp mq mr b">copy()</code>确保我们制作了经过过滤的<code class="fe mo mp mq mr b">acnc</code>数据帧的正确副本。</p><p id="c35a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我在这里没有使用<code class="fe mo mp mq mr b">acnc[acnc.Town_City == 'Melbourne']</code>，因为我怀疑它可能以不同的方式编写。为了确保这是必要的:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="11a2" class="mw lm it mr b gy mx my l mz na">mel.Town_City.value_counts()</span></pre><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/c8ca2718b9722c5baafc9651004dd695.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*Imomhbh8NGz5dynFKOj5fg.png"/></div></figure><p id="4b06" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">正如我们在上面看到的，这个专栏包含了不同的方式来表明一个慈善机构确实位于墨尔本，其中一些使用了郊区，甚至是城市中非常特殊的地方，比如墨尔本大学。通过使用<code class="fe mo mp mq mr b">acnc.Town_City.str.contains('melbourne', case=False)</code>，我们确保了上述所有慈善机构都被计算在内(否则我们只能得到 1779 个正确标记的慈善机构)。</p><p id="98d8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们看看新的<code class="fe mo mp mq mr b">mel</code>数据框架是什么样的:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="93ae" class="mw lm it mr b gy mx my l mz na">mel.head()</span></pre><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/502e076352e6bfbfc18f02aa8475a530.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2nEY89kbEpf-f1OOJV8oQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">mel.shape 赋予<strong class="bd np"> 2722 </strong>行和<strong class="bd np"> 11 </strong>列</p></figure><p id="3801" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，让我们添加一个包含完整地址的新列<code class="fe mo mp mq mr b">Full_Address</code>:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="eab0" class="mw lm it mr b gy mx my l mz na">mel['Full_Address'] = mel['Address_Line_1'].str.cat( mel[['Address_Line_2', 'Address_Line_3', 'Town_City']], sep=' ')</span></pre><p id="921a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><code class="fe mo mp mq mr b">str.cat()</code>在这里有效，因为所有这些列都是 object 或 string 类型的。</p><p id="fbea" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下面是<code class="fe mo mp mq mr b">mel</code>中第一个完整地址的例子:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="04be" class="mw lm it mr b gy mx my l mz na">mel.Full_Address.iloc[0]</span><span id="59e2" class="mw lm it mr b gy ns my l mz na">Output:</span><span id="9841" class="mw lm it mr b gy ns my l mz na">'G Se 11 431 St Kilda Rd   Melbourne'</span></pre><p id="a1ea" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">还有一点:这些完整的地址中，有些只包含邮政信箱号码(称为邮政信箱或邮政信箱)。这些地址对我们来说完全没有用，因为它们不涉及一个已存在的地方。这里有一个例子:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="8752" class="mw lm it mr b gy mx my l mz na">mel[mel.Full_Address.str.contains('po box', case=False)].Full_Address.iloc[0]</span><span id="1804" class="mw lm it mr b gy ns my l mz na">Output:</span><span id="2dd2" class="mw lm it mr b gy ns my l mz na">'GPO Box 2307   Melbourne VIC 3001 AUSTRALIA'</span></pre><p id="5b25" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在继续之前，我们需要删除这些记录(或行):</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="3eb6" class="mw lm it mr b gy mx my l mz na">mel = mel[~mel.Full_Address.str.contains('po box', case=False)].copy()</span></pre><p id="a81f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最后一件事:一些地址包含字符<code class="fe mo mp mq mr b">/</code>，它可以破坏任何 URL。我们需要用空格替换任何斜杠:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="0526" class="mw lm it mr b gy mx my l mz na">mel.Full_Address = mel.Full_Address.str.replace('/', ' ')</span></pre></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="96fb" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">探索谷歌地图:</h1><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/c511f79ec88e3c4b9994febe8926fb28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0UuyvrW5gVVUIzW93VzxZQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">rawpixel.com</p></figure><p id="2667" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在任何网络抓取工作之前，探索你想要从中提取数据的网站是很重要的。在我们的例子中，它是<a class="ae ld" href="https://www.google.com/maps" rel="noopener ugc nofollow" target="_blank">谷歌地图</a>。</p><p id="6974" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">首先，让我们研究一下使用 Google Maps 内部的搜索栏搜索完整地址是如何影响结果页面的 URL 的。为此，我将使用虚构的地址<code class="fe mo mp mq mr b">Grinch house mount crumpit whoville </code>,因为我希望谷歌地图不返回任何结果:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nt"><img src="../Images/aad03a59e4883fe493cc1bffa888f729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*CMzGOjASfF8x_DJAF1qBuQ.png"/></div></div></figure><p id="7dad" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">正如你在上面看到的，我们得到了<code class="fe mo mp mq mr b">www.google.com/maps/search/</code>,后面是我们搜索的地址。换句话说，如果我们想在谷歌地图中搜索一个地址 XYZ，我们所要做的就是使用网址<code class="fe mo mp mq mr b">www.google.com/maps/search/XYZ</code>，而不必与搜索栏本身进行交互。</p><p id="7dd8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这里的想法是在<code class="fe mo mp mq mr b">mel</code>中生成一个新列，我们将<code class="fe mo mp mq mr b">www.google.com/maps/search/</code>与数据帧<code class="fe mo mp mq mr b">mel,</code>中的每一个<code class="fe mo mp mq mr b">Full_Address</code>组合在一起，然后让 Selenium 遍历它们，一个接一个地访问 URL。</p><p id="e7f4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们创建新的<code class="fe mo mp mq mr b">Url</code>列:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="02b8" class="mw lm it mr b gy mx my l mz na">mel['Url'] = ['https://www.google.com/maps/search/' + i for i in mel['Full_Address'] ]</span></pre><p id="bd3b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在我们有了一个包含所有要抓取的 URL 的列，让我们看看地址<code class="fe mo mp mq mr b">G Se 11 431 St Kilda Rd Melbourne</code>例如:</p><p id="d091" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae ld" href="http://www.google.com/maps/search/G Se 11 431 St Kilda Rd Melbourne" rel="noopener ugc nofollow" target="_blank">www.google.com/maps/search/G 东南 11 区，墨尔本第一基尔达路 431 号</a></p><p id="cec2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">上面的链接给了我们:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/4c63ad1d85d6497ea221a648e440f5da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bS5q2yPhnzbqpN9nR3odYQ.png"/></div></div></figure><p id="308e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">以上地址对应的是慈善机构<strong class="kh iu">澳大利亚护士纪念中心</strong>。让我们在谷歌地图上按名字搜索一下:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/803155e921a705d2970d372e3fb5a169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lImFiCK4_KuMJ8huPm_EPw.png"/></div></div></figure><p id="e046" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们得到完全相同的点，但在 URL 中没有相同的坐标。这是因为 URL 中的坐标与地图的居中方式相关联，而不是与标记相关联(如果放大或缩小，坐标会发生变化)。这就是为什么我们要直接从页面本身的源代码中提取坐标。</p><p id="45fc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">要查看源代码，请右键单击页面内的空白区域(地图外部),然后选择“查看页面源代码”(在 Mac 中为 CTRL+U 或 Command+U)。现在在源页面中搜索<strong class="kh iu"> -37.8 </strong>或<strong class="kh iu"> 144.9 </strong>:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/8058e3c4d774d0bbcd88d771fb789404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*17IjuHiRMK4vVhgwmKy5MA.png"/></div></div></figure><p id="9af4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你会在源代码中的很多地方找到我们正在寻找的坐标。但是如果它们包含在一个我们可以瞄准的 HTML 标签中，那么它们对我们来说是最有用的。幸运的是，这里有一个元标记我们可以利用:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/6fe1b7c4e9792ed231f4b8ebc44b5de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*7UsaC4LjuxdXl41TQHtc_Q.png"/></div></div></figure><p id="c206" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，让我们注意它是一个带有属性<code class="fe mo mp mq mr b">content</code>的<code class="fe mo mp mq mr b">meta</code>标签，属性<code class="fe mo mp mq mr b">content</code>包含我们想要提取的 URL，属性<code class="fe mo mp mq mr b">itemprop</code>的值<code class="fe mo mp mq mr b">image</code>可以用来识别和定位这个特定的<code class="fe mo mp mq mr b">meta</code>标签。</p><p id="82e0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在我们所要做的就是使用 Selenium 访问<code class="fe mo mp mq mr b">mel.Url</code>中的每个 URL，并定位这个<code class="fe mo mp mq mr b">meta</code>标签，以提取其属性<code class="fe mo mp mq mr b">content</code>的值。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="eaf7" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">使用硒:</h1><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/78683a756ecdec0bc11cde6548458f99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cEswDkWqVj3Bpo3Zw9uBRA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">rawpixel.com—<a class="ae ld" href="https://www.flickr.com/photos/webhamster/" rel="noopener ugc nofollow" target="_blank">网络仓鼠</a></p></figure><p id="86f2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下面是我们将用来从 Google Maps 中提取包含坐标的 URL 的代码:</p><figure class="mk ml mm mn gt ju"><div class="bz fp l di"><div class="nm nn l"/></div></figure><ul class=""><li id="ff20" class="nc nd it kh b ki kj km kn kq ne ku nf ky ng lc nh ni nj nk bi translated"><strong class="kh iu">第 1 行</strong>:我们创建了一个名为<code class="fe mo mp mq mr b">Url_With_Coordinates</code>的空列表，稍后我们将用(你猜对了)我们想要提取的 URL 填充它；</li><li id="5103" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated"><strong class="kh iu">第 3 行到第 5 行</strong> : prefs 在没有 javascript 和图片的情况下运行 Webdriver。这样，代码加载网页的时间会少得多。显然，如果您想要提取的内容依赖于 javascript，这不是一个好的选择。移除<code class="fe mo mp mq mr b">'images':2, 'javascript':2</code>，网页将正常加载图片和 javascript</li><li id="7401" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated">确保指定你把 chromedriver.exe 文件放在你机器的什么地方。在我的例子中，为了简单起见，我把它放在 c 盘中。注意，路径中的反斜杠<code class="fe mo mp mq mr b">\</code>需要加倍<code class="fe mo mp mq mr b">\\</code>才能识别路径；</li><li id="900d" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated"><strong class="kh iu">第 9 行</strong>:这个 for 循环在<code class="fe mo mp mq mr b">mel.Url</code>系列上迭代。包装我们的 iterable 的<code class="fe mo mp mq mr b">tqdmn()</code>在执行完单元后添加了一个进度条。其参数<code class="fe mo mp mq mr b">leave=False</code>确保操作完成后，杆消失；</li><li id="369d" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated"><strong class="kh iu">第 10 行</strong>:对于<code class="fe mo mp mq mr b">mel.Url</code>中的每个 URL，网络驱动打开那个 URL(对于第一个 URL，你会看到一个 chrome 窗口打开，然后你会注意到它从一个 URL 到另一个 URL，直到<code class="fe mo mp mq mr b">mel.Url</code>结束)；</li><li id="048c" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated"><strong class="kh iu">第 11 行</strong>:首先，我们使用<code class="fe mo mp mq mr b">driver.find_element_by_css_selector</code>搜索我们的<code class="fe mo mp mq mr b">meta</code>标签，并且我们通过<code class="fe mo mp mq mr b">meta[itemprop=image]</code>识别标签。之后，我们使用<code class="fe mo mp mq mr b">.get_attribute('content')</code>提取属性<code class="fe mo mp mq mr b">content</code>的值。然后使用<code class="fe mo mp mq mr b">append()</code>将该操作的结果(包含坐标的 URL)添加到<code class="fe mo mp mq mr b">Url_With_Coordinates</code>列表中。</li><li id="1a37" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated"><strong class="kh iu">第 13 行</strong>:我们在脚本完成后关闭 webdriver (chrome 窗口)(这是一个很好的做法)。</li></ul><p id="39f2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下面是运行中的脚本和 tqdm 进度条(或 tqdmn，因为我使用的是 tqdm_notebook 子模块) :</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oc"><img src="../Images/a264cf38739cc4d56d7d38cbea40b178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4f05tFnsoSMs01R4PQfR4Q.gif"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">tqdm 估计整个操作大约需要 32 分钟(大约每秒 1 次迭代或 URL)</p></figure><p id="b102" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> NB 1: </strong> <strong class="kh iu">下次运行笔记本的时候，你就不用再重新运行一遍网页抓取代码</strong>了，因为我们已经把结果保存在一个名为<code class="fe mo mp mq mr b">Url_With_Coordinates.csv</code>的 CSV 文件里了。让我们改为读取该文件:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="6c5c" class="mw lm it mr b gy mx my l mz na">import csv</span><span id="5770" class="mw lm it mr b gy ns my l mz na">with open('Url_With_Coordinates.csv', 'r') as f:<br/>    reader = csv.reader(f, delimiter=',')<br/>    for i in reader:<br/>        Url_With_Coordinates = i<br/>        break</span></pre><p id="ae19" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在你的测试中，你不会想让 for 循环遍历数千个地址，到头来却抛出一个错误。在正确执行脚本之前，您需要先测试几个值。在我们的例子中，测试代码将是这样的，只检查<code class="fe mo mp mq mr b">mel.Url</code>的前 10 个值:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="4602" class="mw lm it mr b gy mx my l mz na">for url in tqdmn(mel.Url[:10], leave=False):<br/>    driver.get(url)<br/>    ......</span></pre><p id="fe3d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在让我们看看<code class="fe mo mp mq mr b">Url_With_Coordinates</code>列表是什么样子的:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/2d3ba1a8e6cdc91ff46666e197d8a3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jctw5sCqClI_Sw6Upp1Qwg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">2009 年前 5 个网址</p></figure><p id="b1bd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们将这个列表作为一列添加到我们的<code class="fe mo mp mq mr b">mel</code>数据框架中:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="17f4" class="mw lm it mr b gy mx my l mz na">mel['Url_With_Coordinates'] = Url_With_Coordinates</span></pre><p id="a051" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">但是我们如何从这些 URL 中提取坐标呢？下面是如何使用 Python 的<code class="fe mo mp mq mr b">split()</code>方法实现这一目的的直观解释:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/13e61039254092ef78df3a68aec6afb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e0mPQ0M3FGf6dhxBSvILXQ.png"/></div></div></figure><p id="a62c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">该代码翻译成如下代码(该代码不会运行，因为没有定义<code class="fe mo mp mq mr b">url</code>，它只是为了展示上面的解决方案是如何工作的):</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="6409" class="mw lm it mr b gy mx my l mz na">url.split('?center=')[1].split('&amp;zoom=')[0].split('%2C')</span><span id="3860" class="mw lm it mr b gy ns my l mz na">Output:</span><span id="b2ca" class="mw lm it mr b gy ns my l mz na">[-37.8386737, 144.97706]</span></pre><p id="faac" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在使用上面的代码，我们将向我们的<code class="fe mo mp mq mr b">mel</code>数据框架添加两个新列:<code class="fe mo mp mq mr b">lat</code>表示纬度，<code class="fe mo mp mq mr b">long</code>表示经度:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="5aa8" class="mw lm it mr b gy mx my l mz na">mel['lat'] = [ url.split('?center=')[1].split('&amp;zoom=')[0].split('%2C')[<strong class="mr iu">0</strong>] for url in mel['Url_With_Coordinates'] ]</span><span id="ae74" class="mw lm it mr b gy ns my l mz na">mel['long'] = [url.split('?center=')[1].split('&amp;zoom=')[0].split('%2C')[<strong class="mr iu">1</strong>] for url in mel['Url_With_Coordinates'] ]</span></pre><p id="7b70" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最有可能的是，上面的代码给出了一个错误<code class="fe mo mp mq mr b">list index out of range</code>:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/c65e621c01b0a7e02a8faf56db8ef41e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pba2Nz0ufVbUjblyiOm89g.png"/></div></figure><p id="c0f5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这个错误意味着对于列<code class="fe mo mp mq mr b">Url_With_Coordinates</code>中的一些 URL，<code class="fe mo mp mq mr b">split()</code>方法没有按预期工作。也许一些 URL 没有我们用于<code class="fe mo mp mq mr b">split()</code>方法的关键字。让我们寻找缺少<code class="fe mo mp mq mr b">&amp;zoom=</code>的 URL，例如:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="e666" class="mw lm it mr b gy mx my l mz na">mel[~mel.Url_With_Coordinates.str.contains('&amp;zoom=')]</span></pre><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi og"><img src="../Images/2a0a3c2525d499f0db78e676197059b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mvA82yYsraetbvZd9KpCSw.png"/></div></div></figure><p id="f2c3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">正如我们在这里看到的，我们有 5 个提取的 URL 以<code class="fe mo mp mq mr b">//www.gstatic.com/images ...</code>开头的实例(因此我们得到了错误) :</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="c359" class="mw lm it mr b gy mx my l mz na">list(mel[~mel.Url_With_Coordinates.str.contains('&amp;zoom=')].Url_With_Coordinates)</span><span id="a921" class="mw lm it mr b gy ns my l mz na">Output:</span><span id="8f01" class="mw lm it mr b gy ns my l mz na">['//www.gstatic.com/images/branding/product/1x/maps_round_512dp.png',<br/> '//www.gstatic.com/images/branding/product/1x/maps_round_512dp.png',<br/> '//www.gstatic.com/images/branding/product/1x/maps_round_512dp.png',<br/> '//www.gstatic.com/images/branding/product/1x/maps_round_512dp.png',<br/> '//www.gstatic.com/images/branding/product/1x/maps_round_512dp.png']</span></pre><p id="6554" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了简单起见，因为 5 不是一个大数字，我们将从<code class="fe mo mp mq mr b">mel</code>中删除这些实例:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="b515" class="mw lm it mr b gy mx my l mz na">mel = mel[mel.Url_With_Coordinates.str.contains('&amp;zoom=')].copy()</span></pre><p id="5988" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，让我们重新运行将两列<code class="fe mo mp mq mr b">lat</code>和<code class="fe mo mp mq mr b">long</code>添加到我们的<code class="fe mo mp mq mr b">mel</code>数据帧的代码:</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="7d0e" class="mw lm it mr b gy mx my l mz na">mel['lat'] = [ url.split('?center=')[1].split('&amp;zoom=')[0].split('%2C')[0] for url in mel['Url_With_Coordinates'] ]</span><span id="4f89" class="mw lm it mr b gy ns my l mz na">mel['long'] = [url.split('?center=')[1].split('&amp;zoom=')[0].split('%2C')[1] for url in mel['Url_With_Coordinates'] ]</span></pre><p id="9919" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">成功了！下面是我们的<code class="fe mo mp mq mr b">mel</code>数据框架的样子，其中每个慈善机构或非营利组织都获得纬度和经度值(这里的一些列被屏蔽了) :</p><pre class="mk ml mm mn gt ms mr mt mu aw mv bi"><span id="5892" class="mw lm it mr b gy mx my l mz na">mel.head()</span></pre><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/a01a452bb8b8d617eb2ca65157bf2525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1jdsCFtKJDfp9afXRtB4hg.png"/></div></div></figure><p id="b12c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们来绘制这些坐标，看看它们能有多精确。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="1694" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">使用叶子进行坐标映射:</h1><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/08c4152478615ccb24e208d9dc2bff9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*qTBGchl7ZA7-EQEcT4JEyg.gif"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">在此下载该地图的 HTML 文件<a class="ae ld" href="https://github.com/kelmouloudi/MediumArticle-Selenium" rel="noopener ugc nofollow" target="_blank"/></p></figure><p id="7e72" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">颜色编码(慈善规模取决于年收入) :</p><ul class=""><li id="d24b" class="nc nd it kh b ki kj km kn kq ne ku nf ky ng lc nh ni nj nk bi translated"><strong class="kh iu">红色</strong>:大型慈善机构(100 万澳元以上)；</li><li id="b131" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated"><strong class="kh iu">紫色</strong>:中等慈善机构(25 万澳元至 100 万澳元之间)；</li><li id="b48c" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated"><strong class="kh iu">橙色</strong>:小型慈善机构(25 万澳元以下)；</li><li id="b273" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated"><strong class="kh iu">灰色</strong>:无数据。</li></ul><p id="cfcf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下面是我们将用来映射这些坐标的代码:</p><figure class="mk ml mm mn gt ju"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4436" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我不会详细介绍如何使用 Folium，但我会在这里澄清一些要点:</p><ul class=""><li id="f90a" class="nc nd it kh b ki kj km kn kq ne ku nf ky ng lc nh ni nj nk bi translated">我在这张地图上使用了<code class="fe mo mp mq mr b">CartoDB positron</code>,因为它对彩色标记提供了非常低的对比度(这使得它们更加明显)。使用默认图块<code class="fe mo mp mq mr b">OpenStreetMap</code>很难看到标记；</li><li id="2e48" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated">我使用<code class="fe mo mp mq mr b">folium.CustomIcon</code>的参数<code class="fe mo mp mq mr b">icon_size=(..,..)</code>根据慈善机构的规模改变了标记的大小。这背后的原因是为了防止居住在同一栋楼里的慈善机构互相掩盖。因为先画大的标记，然后在上面画小的标记，这样即使重叠的慈善机构也能被区分出来；</li><li id="8862" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated">我使用自定义标记(托管在 imgur 上),因为默认标记会大大降低导航速度，因为我们在地图上有大约 2000 个标记。对于自定义标记，您可以提供要使用的图像的 URL，或者您计算机上图像文件的路径。</li><li id="6ba1" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated">如果你点击一个标记，它会给你慈善机构的名称和地址，所以你可以验证定位是否正确；</li><li id="a89f" class="nc nd it kh b ki nx km ny kq nz ku oa ky ob lc nh ni nj nk bi translated">在上面的代码中，我可以只使用<code class="fe mo mp mq mr b">mel_map</code>而不是<code class="fe mo mp mq mr b">mel_map.save('mel_map.html')</code>后跟<code class="fe mo mp mq mr b">IFrame(src='mel_map.html', width='100%', height=500)</code>，但是当标记的数量很大时，最好将地图保存为 HTML 文件，然后使用<code class="fe mo mp mq mr b">IFrame()</code>打开它(否则您将得到一个空白地图)。</li></ul></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="ae0b" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">这种方法有多准确可靠？</h1><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/15c2cff7c3e95400d5c6c52c555067f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*26vmDnfp60vQ49GUXgslfg.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">我们将使用已经有街道地址和坐标的华盛顿州 DC 的企业数据集来测试我们的方法——图片(CC0)pxhere.com</p></figure><p id="11b1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这是一个非常合理的问题。显然，从街道地址中获取坐标的最佳方式是从一个像 Google Maps 或 Bing 这样的知名 API 中获取，但是这些选项可能要花钱。</p><p id="bc60" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这种方法的准确性很大程度上受所提供的街道地址的精确度和正确性的影响。例如，在我们上面的例子中，你会注意到一个标记被扔在了印度洋的中央。经审查，地址<code class="fe mo mp mq mr b">65 Macarae Road Melbourne</code>实际上应该是<code class="fe mo mp mq mr b">65 Mcrae Road Melbourne</code>，因此出错。</p><p id="830c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了从经验上测试我们的方法，我们将使用一个数据集，该数据集包含华盛顿州 DC 数千家企业的街道地址和坐标。我们将随机抽取 500 个商业地址，然后使用我们的方法从中生成坐标。之后，我们会将它们与数据集中列出的实际坐标进行比较。我们将在测试中使用的数据集可以从这里下载:</p><ul class=""><li id="ed91" class="nc nd it kh b ki kj km kn kq ne ku nf ky ng lc nh ni nj nk bi translated"><a class="ae ld" href="https://opendata.dc.gov/datasets/a9ac9f8d9d1546e8bd6610b48cb29810/data" rel="noopener ugc nofollow" target="_blank">最近 30 天的基本营业执照</a>:opendata.dc.gov 数据集，<strong class="kh iu"> 6418 </strong>记录(截至 26/01/2020)，2.64 Mb</li></ul><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/41f42592d78ff76b6b5bf2cea4b12c3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yM60i6mfxVk8GlUiiMPTWg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">我们将用来测试我们方法的数据集</p></figure><p id="699e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">结果如下(测试详情可在<a class="ae ld" href="https://github.com/kelmouloudi/MediumArticle-Selenium" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>中获得) :</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/8631676acdc8e058f48928745dce74b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ri1lJL-PTdrahE17D29A8g.gif"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">红色:数据集中的实际坐标—橙色:使用 Selenium 和 Google Maps 生成的坐标(此处下载 HTML 文件形式的地图)</p></figure><p id="0267" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">正如我们在上面看到的，在华盛顿州 DC 随机抽样的 500 家企业中，生成的坐标非常接近实际坐标。我将橙色标记做得比红色标记小，这样当它们完全重叠时就都可见了(这就是为什么缩小时橙色标记看起来有红色边框)。</p></div></div>    
</body>
</html>