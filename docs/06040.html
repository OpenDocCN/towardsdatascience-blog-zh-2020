<html>
<head>
<title>Rainfall Time Series Analysis and Forecasting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">降雨时间序列分析和预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/rainfall-time-series-analysis-and-forecasting-87a29316494e?source=collection_archive---------10-----------------------#2020-05-17">https://towardsdatascience.com/rainfall-time-series-analysis-and-forecasting-87a29316494e?source=collection_archive---------10-----------------------#2020-05-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/3b03a0a0ded897608c83a2cf7aa5cd67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-3owW2Ev_DtnLFb9v4DgRg.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">SHAH Shah在Unsplash上拍摄的照片</p></figure><div class=""/><div class=""><h2 id="912c" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">印度尼西亚万丹省2019-2020年使用“R”语言的降雨量预测</h2></div><p id="d567" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">预测是对未来事件的计算或估计，尤其是对金融趋势或未来天气的预测。直到今年，在面对任何事件之前，预测作为制定任何行动或政策的基础非常有帮助。例如，在一些国家一年只有两个季节(旱季和雨季)的热带地区，许多国家，尤其是非常依赖农业商品的国家，需要预测降雨，以决定开始种植产品和最大化收获的最佳时间。另一个例子是，预测可以被公司用来预测原材料价格的变动，并安排最佳策略以从中获取最大利润。</p><p id="2ed3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在本文中，我们将尝试对印度尼西亚万丹省(依赖农业商品的热带国家之一)的降雨量进行预测，我们有2006-2018年的历史降雨量数据，并将尝试使用“R”语言进行预测。</p><p id="30f6" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在此过程中将使用一个简单的工作流程:</p><figure class="lr ls lt lu gt is gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/2e5cc5ea6ed77f24b4402ddd40f50594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*SUmV8YmybekPDX1U74grNw.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图一。流程工作流</p></figure><h1 id="a3cc" class="lv lw jf bd lx ly lz ma mb mc md me mf kl mg km mh ko mi kp mj kr mk ks ml mm bi translated">导入和选择数据</h1><p id="279d" class="pw-post-body-paragraph ku kv jf kw b kx mn kg kz la mo kj lc ld mp lf lg lh mq lj lk ll mr ln lo lp ij bi translated">该数据集包含印度尼西亚万丹省从2005年1月到2018年12月的降雨历史数据。对于这一预测，我将放弃2005年，从2006-2018年开始，作为我们预测的基础。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="e0aa" class="mx lw jf mt b gy my mz l na nb">#Import Necessary Library<br/>library(lubridate)<br/>library(ggplot2)<br/>library(tidyverse)<br/>library(dplyr)<br/>library(astsa)<br/>library(forecast)<br/>library(readxl)<br/>library(urca)<br/>library(ggfortify)<br/>library(tsutils)<br/><br/>#Import Data<br/>hujan &lt;- read_excel("../input/hujan-update/Hujan_Update.xlsx", <br/> sheet = 'Sheet1')<br/>hujan &lt;- hujan %&gt;% gather(key = "Tahun", value = "Curah_Hujan", <br/> -Bulan)</span><span id="f6f8" class="mx lw jf mt b gy nc mz l na nb"><em class="nd">#Converting To Time Series<br/></em>hujan_ts &lt;- ts(data = hujan[,3], frequency = 12, start = c(2005,1))<br/><em class="nd">#Selecting Data</em> <br/>hujan_ts &lt;- window(hujan_ts, start=c(2006,1))</span><span id="8884" class="mx lw jf mt b gy nc mz l na nb">hujan_ts</span></pre><p id="ce9a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">运行完这些代码后，我们将获得以下时间序列数据:</p><figure class="lr ls lt lu gt is gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/b1e973f4d86caeaed27e9da8cc7bbc93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*cAC8USUYKdwP4muvhDSh7A.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图二。时间序列降雨数据</p></figure><h1 id="6193" class="lv lw jf bd lx ly lz ma mb mc md me mf kl mg km mh ko mi kp mj kr mk ks ml mm bi translated">探索性时间序列数据分析</h1><p id="f9ed" class="pw-post-body-paragraph ku kv jf kw b kx mn kg kz la mo kj lc ld mp lf lg lh mq lj lk ll mr ln lo lp ij bi translated">对任何时间序列数据进行探索性数据分析的第一步是可视化相对于时间的值。我们将使用以下代码将我们的降雨量数据可视化为时间序列图(折线图、值与时间的关系):</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="2411" class="mx lw jf mt b gy my mz l na nb">#Plot Time Series Data</span><span id="ce92" class="mx lw jf mt b gy nc mz l na nb">autoplot(hujan_ts) + ylab("Rainfall (mm2)") + xlab("Datetime") + <br/>  scale_x_date(date_labels = '%b - %Y', breaks = '1 year', minor_breaks = '2 month') +<br/>  theme_bw() + ggtitle("Banten Rainfall 2006 - 2018")</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/5c231e9a671c33b1a9f4e62d0d931f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MmctduYday63Alebk452UA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图三。万丹降雨时间序列图</p></figure><p id="2112" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">时间序列图显示降雨具有季节性模式，但没有出现任何趋势；降雨量将在年末达到最高值，直到1月<strong class="kw jg">(雨季)</strong>，从3月到8月<strong class="kw jg">(旱季)</strong>开始减少。在2006年至2018年期间，这种模式每年都会重复。</p><p id="fe61" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们将根据趋势、季节性和剩余部分将时间序列数据分解成更详细的内容。利用这一分解结果，我们希望更精确地了解2006-2018年期间的降雨行为。</p><p id="4c51" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">将使用<strong class="kw jg"> stl() </strong>函数进行分解，并将时间序列自动分成三个部分(趋势、季节性、余数)。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="ace9" class="mx lw jf mt b gy my mz l na nb">#Decomposition using stl()<br/>decomp &lt;- stl(hujan_ts[,1], s.window = 'periodic')</span><span id="0725" class="mx lw jf mt b gy nc mz l na nb">#Plot decomposition<br/>autoplot(decomp) + theme_bw() + scale_x_date(date_labels = '%b - %Y', breaks = '1 year', minor_breaks = '2 month') +<br/>    ggtitle("Remainder")</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/97a18b597d8b9ea018d6af330433ac99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HM_aM-Hohd5hf7LcjGgvfA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图4。时间序列分解</p></figure><p id="2993" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">趋势周期和季节图显示出现了季节波动，没有特定的趋势和相当随机的剩余/残差。</p><p id="79a1" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">有一种计算方法可以衡量趋势和季节性强度:</p><p id="2fad" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> Ft </strong>:趋势强度</p><figure class="lr ls lt lu gt is gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/04eb7f881ab6ea76bc112de8ac291349.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*QbFk5AUfkI5nLCvzQufQBw.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图五。趋势强度公式</p></figure><p id="ff45" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> Fs </strong>:季节性强度</p><figure class="lr ls lt lu gt is gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/8a04f9d5855baa18f157becd18d9b688.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*kEgMxMv_Vax4FGcilmLx4w.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图六。季节性强度公式</p></figure><p id="5330" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">趋势和季节性的强度在0和1之间，而<strong class="kw jg"> "1" </strong>意味着有很强的趋势和季节性发生。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="377a" class="mx lw jf mt b gy my mz l na nb">Tt &lt;- trendcycle(decomp)<br/>St &lt;- seasonal(decomp)<br/>Rt &lt;- remainder(decomp)</span><span id="2691" class="mx lw jf mt b gy nc mz l na nb">#Trend Strength Calculation<br/>Ft &lt;- round(max(0,1 - (var(Rt)/var(Tt + Rt))),1)</span><span id="028f" class="mx lw jf mt b gy nc mz l na nb">#Seasonal Strength Calculation<br/>Fs &lt;- round(max(0,1 - (var(Rt)/var(St + Rt))),1)<br/><br/>data.frame('Trend Strength' = Ft , 'Seasonal Strength' = Fs)</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/61acf6b715066e2465e0792f938c4319.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*j3qo0YvSxGqAvbvmtFpTQg.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图七。趋势/季节强度计算结果</p></figure><p id="da83" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">通过使用测量趋势和季节强度的公式，我们证明了我们的数据具有季节性模式(季节强度:0.6)，而没有出现趋势(趋势强度:0.2)。</p><p id="88e6" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">季节性分析</strong></p><p id="cb1a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们知道我们的数据有季节性模式。因此，探索更多关于我们的降雨数据的季节性；季节图、季节-子系列图和季节箱线图将对我们的数据提供更深刻的解释。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="ce7b" class="mx lw jf mt b gy my mz l na nb">#Seasonal Plot<br/>seasonplot(hujan_ts, year.labels = TRUE, col = 1:13, <br/>   main =  "Seasonal Plot", ylab= "Rainfall (mm2)")</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/259934b96c78fb7fc9a7ed7d44d9bc29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2udefa1HjjSm9p3SRx7a6A.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图八。降雨时间序列季节图</p></figure><p id="0d39" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">季节图确实显示了每年发生的季节模式。尽管如此，由于在此期间几年的差异，我们无法仅使用此图来查看模式。进一步的探索将使用季节性箱线图和子系列图，从我们的数据中获得更深入的分析和见解。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="84d5" class="mx lw jf mt b gy my mz l na nb">#Seasonal Sub-Series Plot<br/>seasplot(hujan_ts, outplot = 3, trend = FALSE, <br/>      main = "Seasonal Subseries Plot", ylab= "Rainfall (mm2)")</span><span id="8114" class="mx lw jf mt b gy nc mz l na nb">#Seasonal Boxplot<br/>seasplot(hujan_ts, outplot = 2, trend = FALSE, <br/>     main = "Seasonal Box Plot", ylab= "Rainfall (mm2)")</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/7e160e95991b683bf8d731a405c4eb24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0zkVOzKJ4Qeq1BXw1nPOA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图九。季节性子系列图</p></figure><figure class="lr ls lt lu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/608cd669f7e637366714df9336412648.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_jgt--968mSXtdSZl0BKXw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图10。季节性箱线图</p></figure><p id="1310" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">使用季节性箱线图和子系列图，我们可以更清楚地看到数据模式。水平线表示按月分组的降雨量平均值，通过使用此信息，我们了解到降雨量将从4月开始减少，并在8月和9月达到最低点。降雨量将在9月后再次开始攀升，并在1月达到顶峰。</p><p id="0627" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">据此，我们可以将旱季安排在4月至9月，雨季安排在10月至3月。这对像印度尼西亚这样依赖农产品的国家来说是一个有益的启示。旱季和雨季预测可用于确定开始种植农业商品并使其产量最大化的正确时间。</p><p id="18c6" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">此外，这些信息可以帮助政府制定任何政策，作为预防雨季暴雨引发洪水或旱季干旱的方法。</p><h1 id="95ac" class="lv lw jf bd lx ly lz ma mb mc md me mf kl mg km mh ko mi kp mj kr mk ks ml mm bi translated">2019-2020年降雨量预测</h1><p id="2d1d" class="pw-post-body-paragraph ku kv jf kw b kx mn kg kz la mo kj lc ld mp lf lg lh mq lj lk ll mr ln lo lp ij bi translated">预测的第一步是选择正确的模型。为此，我们需要将时间序列数据集分为训练集和测试集。训练集将用于训练几个模型，而且，这个模型应该在测试集上进行测试。</p><p id="3896" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">分体列车/测试装置</strong></p><p id="fc65" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">训练集:</strong>我们将使用截至2017年12月的所有数据作为我们的训练集</p><p id="07b5" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">测试集:</strong> 2018年期间(1月-12月)将作为我们的测试集</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="dcec" class="mx lw jf mt b gy my mz l na nb"><em class="nd">#Create Train Set</em><br/>hujan_train &lt;- window(hujan_ts, end = c(2017,12))</span><span id="ebae" class="mx lw jf mt b gy nc mz l na nb"><em class="nd">#Create Test Set</em> <br/>hujan_test &lt;- window(hujan_ts, start = c(2018,1))</span></pre><p id="b93c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">静止测试</strong></p><p id="c221" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在开始建立ARIMA模型之前，应检查列车组数据的平稳性。可以使用URCA包装的<strong class="kw jg"> <em class="nd">科维亚特科夫斯基-菲利普-施密特-申恩试验(KPSS) </em> </strong>和<strong class="kw jg"> <em class="nd">迪基-富勒试验(D-F试验)</em> </strong>进行静态试验。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="b5f6" class="mx lw jf mt b gy my mz l na nb"><em class="nd">#Kwiatkowski–Phillips–Schmidt–Shin Test</em><br/>summary(ur.kpss(hujan_train)) </span><span id="dee8" class="mx lw jf mt b gy nc mz l na nb"><em class="nd">#Dickey-Fuller Test<br/></em>summary(ur.df(hujan_train)) </span><span id="6f01" class="mx lw jf mt b gy nc mz l na nb">####################### <br/># KPSS Unit Root Test # <br/>####################### <br/><br/>Test is of type: mu with 4 lags. <br/><br/>Value of test-statistic is: 0.0531 <br/><br/>Critical value for a significance level of: <br/>                10pct  5pct 2.5pct  1pct<br/>critical values 0.347 0.463  0.574 0.739</span><span id="68fc" class="mx lw jf mt b gy nc mz l na nb">############################################### <br/># Augmented Dickey-Fuller Test Unit Root Test # <br/>############################################### <br/><br/>Test regression none <br/><br/><br/>Call:<br/>lm(formula = z.diff ~ z.lag.1 - 1 + z.diff.lag)<br/><br/>Residuals:<br/>    Min      1Q  Median      3Q     Max <br/>-176.15  -43.66    3.80   68.21  355.75 <br/><br/>Coefficients:<br/>           Estimate Std. Error t value Pr(&gt;|t|)    <br/>z.lag.1    -0.15081    0.05230  -2.883 0.004555 ** <br/>z.diff.lag -0.28241    0.08111  -3.482 0.000664 ***<br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1<br/><br/>Residual standard error: 96.77 on 140 degrees of freedom<br/>Multiple R-squared:  0.1755,	Adjusted R-squared:  0.1637 <br/>F-statistic:  14.9 on 2 and 140 DF,  p-value: 1.36e-06<br/><br/><br/>Value of test-statistic is: -2.8835 <br/><br/>Critical values for test statistics: <br/>      1pct  5pct 10pct<br/>tau1 -2.58 -1.95 -1.62</span></pre><p id="9973" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">使用95%作为置信水平，两个测试的零假设(ho)定义为:</p><ul class=""><li id="5df5" class="nj nk jf kw b kx ky la lb ld nl lh nm ll nn lp no np nq nr bi translated"><strong class="kw jg"> KPSS检验:</strong>数据是平稳的</li><li id="636c" class="nj nk jf kw b kx ns la nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="kw jg"> D-F检验:</strong>数据是非平稳的</li></ul><p id="1ccc" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">因此，对于KPSS测试，我们希望p值&gt; 0.5，我们可以接受零假设，对于D-F测试，我们希望p值&lt; 0.05 to reject its null hypothesis. Based on the test which been done before, <strong class="kw jg">我们可以很舒服地说，我们的训练数据是平稳的</strong>。</p><p id="24d1" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">型号分配</strong></p><p id="d8c1" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">将使用ARIMA和ETS模型进行预测，这些模型之间的比较也将使用测试集的一些参数进行评估。</p><p id="c396" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> ARIMA模式</strong></p><p id="f2ee" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">建立ARIMA模型的第一步是创建平稳时间序列数据的自相关图。有时为了得到稳定的数据，我们需要做差分；对于我们的例子，我们已经有了一个固定的集合。因此，我们模型上的差异数(D，D)可以设置为零。</p><p id="712b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们的数据集具有季节性，因此我们需要构建<strong class="kw jg"> ARIMA (p，D，q)(P，D，Q)m </strong>，以获得(P，P，Q，Q)我们将看到自相关图(ACF/PACF)并从图中导出这些参数。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="1d55" class="mx lw jf mt b gy my mz l na nb">acf2(hujan_train)</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/6bf580d057690afc4b656d4958262951.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UNIlmFKX9bLMLx0G4kJslQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图11。ACF/PACF绘图训练装置</p></figure><p id="304d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">ACF图用于获得MA参数(Q，Q)，在滞后2处有显著的尖峰，正弦曲线指示年度季节性(m = 12)。PACF图用于获得AR参数(P，P)，AR参数在滞后1时有显著的尖峰。</p><p id="dd65" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这个ACF/PACF图表明，合适的模型可能是<strong class="kw jg"> ARIMA(1，0，2)(1，0，2) </strong>。为了确定这个模型，我们将根据我们的建议设置其他模型，用<strong class="kw jg"> 1 </strong>修改<strong class="kw jg"> (AR) </strong>和<strong class="kw jg"> (MA) </strong>组件。</p><ol class=""><li id="5732" class="nj nk jf kw b kx ky la lb ld nl lh nm ll nn lp nx np nq nr bi translated">模型-1 : <strong class="kw jg"> ARIMA(1，0，2)(1，0，2) </strong></li><li id="465b" class="nj nk jf kw b kx ns la nt ld nu lh nv ll nw lp nx np nq nr bi translated">模型二:<strong class="kw jg"> ARIMA(2，0，2)(2，0，2) </strong></li><li id="17b1" class="nj nk jf kw b kx ns la nt ld nu lh nv ll nw lp nx np nq nr bi translated">模型3 : <strong class="kw jg"> ARIMA(1，0，1)(1，0，1) </strong></li><li id="09dc" class="nj nk jf kw b kx ns la nt ld nu lh nv ll nw lp nx np nq nr bi translated">模型4 : <strong class="kw jg"> ARIMA(2，0，1)(2，0，1) </strong></li><li id="95c1" class="nj nk jf kw b kx ns la nt ld nu lh nv ll nw lp nx np nq nr bi translated">模型-5 : <strong class="kw jg"> ARIMA(0，0，2)(0，0，2) </strong></li><li id="40b2" class="nj nk jf kw b kx ns la nt ld nu lh nv ll nw lp nx np nq nr bi translated">模型6 : auto.arima()</li></ol><p id="0928" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们还将设置<strong class="kw jg"> auto.arima() </strong>作为我们的模型的另一个比较，并期望找到更适合我们的时间序列。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="721e" class="mx lw jf mt b gy my mz l na nb">fit1 &lt;- Arima(hujan_train, order = c(1,0,2), seasonal = c(1,0,2))<br/>fit2 &lt;- Arima(hujan_train, order = c(2,0,2), seasonal = c(2,0,2))<br/>fit3 &lt;- Arima(hujan_train, order = c(1,0,1), seasonal = c(1,0,1))<br/>fit4 &lt;- Arima(hujan_train, order = c(2,0,1), seasonal = c(2,0,1))<br/>fit5 &lt;- Arima(hujan_train, order = c(0,0,2), seasonal = c(0,0,2))<br/>fit6 &lt;- auto.arima(hujan_train, stepwise = FALSE, <br/>        approximation = FALSE)</span></pre><p id="b35f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">为了在所有ARIMA模型中选择最适合我们数据的模型，我们将比较这些模型的AICc值。具有最小AICc的模型通常是预测的最佳模型。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="ad39" class="mx lw jf mt b gy my mz l na nb">data.frame('Model-1' = fit1$aicc, 'Model-2' = fit2$aicc, <br/>     'Model-3' = fit3$aicc,<br/>     'Model-4' = fit4$aicc, <br/>     'Model-5' =  fit5$aicc,'Auto.Arima'= fit6$aicc,<br/>      row.names =   "AICc Value")</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/77a0c71b16af901414e80fecdb725030.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*lQHd6DquDD2ULq1OzurF6Q.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图12。ARIMA模型的AICc值</p></figure><p id="3cea" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">模型1的AICc值在其他模型中是最低的，这就是为什么我们选择这个模型作为我们预测的ARIMA模型。但是，我们还需要对该模型进行残差检查，以确保该模型适用于我们的时间序列预测。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="795f" class="mx lw jf mt b gy my mz l na nb">checkresiduals(fit1)</span><span id="27e0" class="mx lw jf mt b gy nc mz l na nb">	Ljung-Box test<br/><br/>data:  Residuals from ARIMA(1,0,2)(1,0,2)[12] with non-zero mean<br/>Q* = 10.187, df = 17, p-value = 0.8956<br/><br/>Model df: 7.   Total lags used: 24</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/6c5d8f0abc31c0b00f82de75babc4211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wKuOP-h5l6cQRLRKqRqx7A.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图13。ARIMA模型的残差检验</p></figure><p id="4320" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">基于模型残差的Ljung-Box检验和ACF图，我们可以得出结论，该模型适用于预测，因为其残差表现出白噪声行为，并且彼此不相关。</p><p id="bce4" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> ETS模型</strong></p><p id="e6a2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们将构建ETS模型，并将其与我们选择的ARIMA模型进行比较，以查看哪个模型更适合我们的测试集。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="880a" class="mx lw jf mt b gy my mz l na nb"><em class="nd">#ETS Model</em><br/>fit_ets &lt;- ets(hujan_train, damped =TRUE)</span></pre><p id="7e0c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">与ARIMA模型相似，我们也需要检查其残差行为，以确保该模型能够很好地进行预测。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="5223" class="mx lw jf mt b gy my mz l na nb">checkresiduals(fit_ets)</span><span id="7276" class="mx lw jf mt b gy nc mz l na nb">Ljung-Box test<br/><br/>data:  Residuals from ETS(A,Ad,A)<br/>Q* = 40.433, df = 7, p-value = 1.04e-06<br/><br/>Model df: 17.   Total lags used: 24</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/bd231b3e823b5faf87b8f27bfaca6d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*__n9DkjiejSGImXLaHLArA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图14。ETS模型的残差检验</p></figure><p id="8591" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在残差检查之后，ACF图显示ETS模型残差在几个滞后上相互之间的相关性很小，但是大多数残差仍然在限制范围内，我们将继续使用该模型作为与我们选择的ARIMA模型的比较。</p><p id="f5b9" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">测试集上的ARIMA vs ETS模型</strong></p><p id="dbc1" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">可以使用测试集来检查我们的时间序列数据的更好模型。我们将使用ARIMA和ETS模型进行预测，并根据测试集(2018年1月至12月)查看它们的准确性。</p><p id="5efb" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">第一步，我们需要在ARIMA模型、ETS模型和我们2018年的实际数据之间绘制可视化。但是由于ggfortify包不能很好地与其他包相适应，我们应该稍微修改一下代码来显示漂亮的可视化效果。</p><p id="efe3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">注意:如果没有加载ggfortify包，可以直接使用:autoplot(实际数据)+ autolayer(forecast_data)，来做可视化。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="a973" class="mx lw jf mt b gy my mz l na nb">#Modifying Data For ggplot</span><span id="a64a" class="mx lw jf mt b gy nc mz l na nb">model_1 &lt;- forecast(fit1, h=12) <br/>model_ets &lt;- forecast(fit_ets, h=12)<br/><br/>model_1 &lt;- as.data.frame(model_1$mean)<br/>model_ets &lt;- as.data.frame(model_ets$mean)<br/><br/>colnames(model_1) &lt;- "Curah_Hujan"<br/>colnames(model_ets) &lt;- "Curah_Hujan"<br/><br/>hujan_train_df &lt;- as.data.frame(hujan_train)<br/><br/>model_1_plot &lt;- rbind(hujan_train_df,model_1)<br/>model_ets_plot &lt;- rbind(hujan_train_df, model_ets)<br/><br/>model_1_plot &lt;- model_1_plot %&gt;% <br/>  mutate('Date' = seq(from = as.Date("2006-01-01", '%Y-%m-%d'), to = as.Date("2018-12-31",'%Y-%m-%d'),by = 'month'))<br/><br/>model_ets_plot &lt;- model_ets_plot %&gt;% <br/>  mutate('Date' = seq(from = as.Date("2006-01-01", '%Y-%m-%d'), to = as.Date("2018-12-31",'%Y-%m-%d'),by = 'month'))<br/><br/>hujan_ts_df &lt;- as.data.frame(hujan_ts)<br/><br/>hujan_ts_df &lt;- hujan_ts_df %&gt;% <br/>  mutate('Date' = seq(from = as.Date("2006-01-01", '%Y-%m-%d'), to = as.Date("2018-12-31",'%Y-%m-%d'),by = 'month'))<br/><br/>hujan_train_df &lt;- hujan_train_df %&gt;% <br/>  mutate('Date' = seq(from = as.Date("2006-01-01", '%Y-%m-%d'), to = as.Date("2017-12-31",'%Y-%m-%d'),by = 'month'))<br/><br/>colors &lt;- c("ARIMA Model Forecast 2018" = "blue", "ETS Model Forecast 2018" = "red", "Actual Data" = "black")<br/><br/><br/>#Creating Plot</span><span id="f9cd" class="mx lw jf mt b gy nc mz l na nb">ggplot() + geom_line(model_1_plot,<br/>   mapping = aes(x=Date, y=Curah_Hujan, <br/>   color= "ARIMA Model Forecast 2018"),lty = 2) +<br/>  geom_line(model_ets_plot,<br/>  mapping = aes(x=Date, y=Curah_Hujan, <br/>  color= "ETS Model Forecast 2018"),lty= 2) +<br/>  geom_line(hujan_ts_df,mapping = aes(x=Date, y=Curah_Hujan, <br/>  color= "Actual Data"), lty = 1, show.legend = TRUE) +<br/>  ylab("Rainfall (mm2)") + xlab("Datetime") + <br/>  scale_x_date(date_labels = '%b - %Y', breaks = '1 year', <br/>  minor_breaks = '2 month') +<br/>  theme_bw() + ggtitle("Banten Rainfall 2006 - 2018") + <br/>  scale_color_manual(values=colors)</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/6c3664d91a70c86ab19d4f7f32b25d3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bc39_MwebTBeDBk7KWD7yg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图15。实际数据与ARIMA和ETS预测</p></figure><p id="c948" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">尽管ARIMA和ETS的模型并不完全符合实际数据的相同值，但可以肯定的是，他们都策划了一个非常相似的运动来反对它。</p><p id="cd07" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在numbers中，我们可以用实际数据计算这些模型之间的准确性，并决定哪一个模型最符合我们的数据:</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="8c97" class="mx lw jf mt b gy my mz l na nb">#ARIMA Model Accuracy<br/>accuracy(forecast(fit1, h=12), hujan_test)</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/4b951380960ae10e2881a75d992f3218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*1j2f3l8oF25yyEJeNKKlzQ.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图16。ARIMA模型精度</p></figure><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="1218" class="mx lw jf mt b gy my mz l na nb">#ETS Model Accuracy<br/>accuracy(forecast(fit_ets, h=12), hujan_test)</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/b87f061bbfd2ccfc1c1614de9f8963fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*5TnUfES_8e58N3UqPKgaqA.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图17。ETS模型准确性</p></figure><p id="b7ea" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">从准确性来看，ETS模型在训练集和测试集上都优于ARIMA模型。</p><p id="b7e5" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">2019-2020年降雨量预测</strong></p><p id="1a21" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">使用与使用我们的训练集创建的模型相同的参数，我们将预测2019-2020年的降雨量预测(h=24)。</p><p id="2545" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">预测和绘图:</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="866d" class="mx lw jf mt b gy my mz l na nb"><em class="nd">#Create Model</em><br/>ARIMA_Model &lt;- Arima(hujan_ts, order = c(1,0,2), <br/>   seasonal = c(1,0,2))<br/>ETS_Model &lt;- ets(hujan_ts, damped = TRUE, model = "AAA")<br/><br/><em class="nd">#ARIMA Model Forecast</em><br/>autoplot(forecast(ARIMA_Model, h=24)) + theme_bw() + <br/>  ylab("Rainfall (mm2)") + xlab("Datetime") + <br/>  scale_x_date(date_labels = '%b - %Y', <br/>  breaks = '1 year', minor_breaks = '2 month') +<br/>  theme_bw() + ggtitle("Banten Rainfall Forecast 2019-2020 <br/>  ARIMA Model")<br/><em class="nd">#ETS Model Forecast</em><br/>autoplot(forecast(ETS_Model, h=24)) + theme_bw() + <br/>  ylab("Rainfall (mm2)") + xlab("Datetime") + <br/>  scale_x_date(date_labels = '%b - %Y', breaks = '1 year', <br/>  minor_breaks = '2 month') +<br/>  theme_bw() + ggtitle("Banten Rainfall Forecast 2019-2020 <br/>  ETS Model")</span></pre><figure class="lr ls lt lu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/93dcf68becee7a1e6cb430876af3f08b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r8JuONeEs-aMoD1nqD_3SQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图18。ARIMA模型预测2019–2020</p></figure><figure class="lr ls lt lu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/7e44461b84b5c92c979857081dff4eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xg5VM8jdwS9o7zT2mkO5-w.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图19。ETS模型预测2019–2020年</p></figure><p id="0847" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">使用这两个模型进行了预测，基于2019年和2020年8月降雨量最低值的绘图，它们共享相似的运动。</p><p id="af70" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们的预测对于想知道哪个月开始种植最好的农民是有用的，对于需要制定雨季防洪和旱季抗旱政策的政府也是有用的。最重要的是，这种预测仅基于历史趋势，更准确的预测必须结合使用气象数据和气候专家的一些专业知识。</p></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><p id="d20e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">[1] <a class="ae oi" href="https://banten.bps.go.id/" rel="noopener ugc nofollow" target="_blank"> banten.bps.go.id </a>。于<code class="fe oj ok ol mt b">May,17th 2020</code>访问</p><p id="a84e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">[2]Hyndman，R.J .，&amp; Athanasopoulos，G. (2018) <em class="nd">预测:原理与实践</em>，第二版，OTexts:澳洲墨尔本。OTexts.com/fpp2.Accessed在<code class="fe oj ok ol mt b">May,17th 2020</code>上。</p></div></div>    
</body>
</html>