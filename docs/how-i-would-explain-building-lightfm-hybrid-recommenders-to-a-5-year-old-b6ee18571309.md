# æˆ‘å°†å¦‚ä½•å‘ä¸€ä¸ª 5 å²çš„å­©å­è§£é‡Šæ„å»ºâ€œLightFM æ··åˆæ¨èå™¨â€!

> åŸæ–‡ï¼š<https://towardsdatascience.com/how-i-would-explain-building-lightfm-hybrid-recommenders-to-a-5-year-old-b6ee18571309?source=collection_archive---------4----------------------->

## æ„å»ºç”¨æˆ·/é¡¹ç›®åŠŸèƒ½ä»¥è§£å†³å†·å¯åŠ¨é—®é¢˜å¹¶é¢„æµ‹æ–°ç”¨æˆ·è¯„çº§çš„ç¤ºä¾‹ã€‚

*æ³¨æ„:5 å²çš„å­©å­å¿…é¡»æŒæ¡ Python çš„å·¥ä½œçŸ¥è¯†ï¼*

![](img/880d0b221c1017f31cb27a7be0e009fe.png)

æ¥æº:ä½œè€…åœ¨ [imgflip](https://imgflip.com/i/47bj0b) ä¸Šåˆ›å»º

# ä¸ºä»€ä¹ˆå¯¹å†·å¯åŠ¨é—®é¢˜å¤§æƒŠå°æ€ªï¼Ÿ

åœ¨æ¨èç³»ç»Ÿä¸­ï¼Œ**å†·å¯åŠ¨é—®é¢˜**æŒ‡çš„æ˜¯å°†é¡¹ç›®æ¨èç»™ä¸€ä¸ªå®Œå…¨**æ–°* *ç”¨æˆ·*çš„é—®é¢˜ï¼Œå³ä¸€ä¸ªæ²¡æœ‰ä¸ä½ çš„æ•°æ®åº“ä¸­çš„ä»»ä½•ç°æœ‰é¡¹ç›®è¿›è¡Œè¿‡äº¤äº’çš„ç”¨æˆ·ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæ‚¨ä»åˆå§‹è®­ç»ƒæ•°æ®åˆ›å»ºç”¨æˆ·-é¡¹ç›®çŸ©é˜µï¼Œæ‚¨å°†æ‰¾ä¸åˆ°è¿™ä¸ªæ–°ç”¨æˆ·çš„è¡Œã€‚ç±»ä¼¼çš„ç±»æ¯”å¯ç”¨äºè§£é‡Šåœ¨*å…¨æ–°é¡¹ç›®*çš„æƒ…å†µä¸‹çš„å†·å¯åŠ¨é—®é¢˜ã€‚*

*ä½œä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ï¼Œè¿™å¯èƒ½ä¼šç»™ä½ å¸¦æ¥å¾ˆå¤§çš„ä¸ä¾¿ï¼Œä¾‹å¦‚ï¼Œå½“å¬ä¼—è¯•å›¾å¯»æ‰¾æ–°çš„æ’­å®¢å»ºè®®æ¥å¬æ—¶ï¼Œä½ å¾—åˆ°çš„æ˜¯â€”â€”zipï¼Œzilchï¼Œnadaï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬æ’­å®¢åº”ç”¨ç¨‹åº [Podurama](https://podurama.com/) æœ€åˆå¼€å‘é˜¶æ®µçš„é—®é¢˜ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ LightFM æ˜¯å¦‚ä½•å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜çš„â€¦*

# *LightFM å¦‚ä½•å¸®åŠ©è§£å†³å†·å¯åŠ¨é—®é¢˜ï¼Ÿ*

*LightFM çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œè¯¥æ¨¡å‹ä¸ä¼šé­å—å†·å¯åŠ¨é—®é¢˜ï¼Œæ— è®ºæ˜¯ç”¨æˆ·è¿˜æ˜¯é¡¹ç›®å†·å¯åŠ¨ã€‚åŸå› æ˜¯ LightFM å…è®¸æ„å»ºä¸€ä¸ª**æ··åˆæ¨èç³»ç»Ÿ**ã€‚*

> *æ··åˆæ¨èå™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¨èå™¨ï¼Œå®ƒä½¿ç”¨ååŒè¿‡æ»¤å’ŒåŸºäºå†…å®¹çš„è¿‡æ»¤æ¥è¿›è¡Œæ¨èã€‚*

*ç®€è€Œè¨€ä¹‹ï¼ŒLightFM å¯ä»¥ä½¿ç”¨æ™®é€šçš„ç”¨æˆ·-é¡¹ç›®äº¤äº’æ¥ä¸ºå·²çŸ¥çš„**ç”¨æˆ·åšå‡ºé¢„æµ‹ã€‚*åœ¨ n ä¸ª*ç”µå­æˆ˜ç”¨æˆ·çš„æƒ…å†µä¸‹ï¼Œ*å¦‚æœå®ƒçŸ¥é“å…³äºè¿™äº›æ–°ç”¨æˆ·çš„ä¸€äº›*é™„åŠ ä¿¡æ¯*ï¼Œå®ƒå¯ä»¥åšå‡ºé¢„æµ‹ã€‚è¿™äº›é™„åŠ ä¿¡æ¯å¯ä»¥æ˜¯æ€§åˆ«ã€å¹´é¾„ã€ç§æ—ç­‰ç‰¹å¾ï¼Œå¹¶ä¸”åœ¨è®­ç»ƒæœŸé—´å¿…é¡»å°†**è¾“å…¥åˆ°ç®—æ³•ä¸­ã€‚****

# **è®©æˆ‘ä»¬ç›´æ¥è¿›å…¥ç¼–ç **

**æˆ‘å°†ä½¿ç”¨(éå¸¸)å°çš„è™šæ‹Ÿè¯„çº§æ•°æ®å’Œç‰¹å¾æ•°æ®ï¼Œå› ä¸ºæˆ‘å¸Œæœ›èƒ½å¤Ÿæ˜¾ç¤ºæ¯ä¸ªé˜¶æ®µçš„ä¸­é—´è¾“å‡ºã€‚å¦‚æœä½ æƒ³è·Ÿç€å»ï¼Œè¿™é‡Œæœ‰ä¸€æœ¬ [Jupyter ç¬”è®°æœ¬](https://github.com/V-Sher/LightFm_HybridRecommenderSystem/blob/master/LightFM%20Worked%20Example.ipynb)ã€‚**

## **è¯„çº§æ•°æ®æ¡†æ¶**

**å®ƒåŒ…å«æ¥è‡ªä¸‰ä¸ªç”¨æˆ·(u1ã€u2ã€u3)å’Œå››ä¸ªé¡¹ç›®(i1ã€i2ã€i3ã€i4)çš„æ•°æ®ã€‚**

```
**# create dummy dataset
data = {'user': ['u1','u1','u2','u2', 'u3', 'u3', 'u3'], 
        'item': ['i1', 'i3', 'i2', 'i3', 'i1', 'i4', 'i2'], 
        'r': [1,2,1,3,4,5,2]
       }
df = pd.DataFrame(data,  columns = ['user', 'item', 'r'])**
```

**![](img/84044f0ec57bdffc9a49f89498f3bcb8.png)**

## **ç”¨æˆ·ç‰¹å¾æ•°æ®æ¡†æ¶**

**æˆ‘ä»¬æœ‰å…³äºæ¯ä¸ªç”¨æˆ·çš„å››æ¡é™„åŠ ä¿¡æ¯â€”â€”ä¸‰ä¸ªå¸ƒå°”ç‰¹å¾â€”â€”f1ã€f2ã€f3ï¼Œä»¥åŠä¸€ä¸ªä½ç½®ç‰¹å¾â€”â€”locï¼Œç°åœ¨å¯ä»¥å–ä¸¤ä¸ªå€¼â€”â€”å¾·é‡Œæˆ–å­Ÿä¹°ã€‚**

```
***#dummy user features*
data = {'user': ['u1','u2','u3', 'loc'], 
        'f1': [1, 0, 1, 'del'], 
        'f2': [1, 1, 1, 'mum'],
        'f3': [0, 0, 1, 'del']
       }
features = pd.DataFrame(data,  columns = ['user', 'f1', 'f2', 'f3', 'loc'])**
```

**![](img/535424303100c91183147fb0c33483d9.png)**

## **åˆ›å»ºç¬¦åˆ LightFM çš„æ•°æ®é›†**

**å¦‚æœæ‚¨æµè§ˆè¿‡ LightFM æ–‡æ¡£ï¼Œå°±ä¼šçŸ¥é“å®ƒå–œæ¬¢ç‰¹å®šæ ¼å¼çš„è¾“å…¥æ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»æœä»ã€‚**

```
**from lightfm.data import Dataset
dataset1 = Dataset()**
```

## **è°ƒç”¨ fit æ–¹æ³•**

**æˆ‘ä»¬éœ€è¦è°ƒç”¨ fit æ–¹æ³•æ¥å‘Šè¯‰ LightFM ç”¨æˆ·æ˜¯è°ï¼Œæˆ‘ä»¬æ­£åœ¨å¤„ç†ä»€ä¹ˆé¡¹ç›®ï¼Œä»¥åŠä»»ä½•ç”¨æˆ·/é¡¹ç›®ç‰¹æ€§ã€‚**

**æˆ‘ä»¬å°†å‘ fit æ–¹æ³•ä¼ é€’ä¸‰ä¸ªè¾“å…¥:**

*   **`users`:æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨**
*   **`items`:åˆ—å‡ºæ‰€æœ‰é¡¹ç›®**
*   **`user_features`:é™„åŠ ç”¨æˆ·åŠŸèƒ½åˆ—è¡¨**

**ä¼ é€’ç”¨æˆ·å’Œé¡¹ç›®åˆ—è¡¨éå¸¸ç®€å•â€”â€”åªéœ€ä½¿ç”¨`df`ä¸­çš„â€œç”¨æˆ·â€å’Œâ€œé¡¹ç›®â€åˆ—ã€‚**

**å½“è°ˆåˆ°ä¼ é€’`user_features`æ—¶ï¼Œæˆ‘ä¼š**å¼ºçƒˆ**æ¨èä¼ é€’ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ç±»ä¼¼äº`'feature_name:feature_value'`çš„æ ¼å¼(æˆ‘ä¿è¯æˆ‘ä¼šè§£é‡Šä¸ºä»€ä¹ˆæˆ‘æ›´å–œæ¬¢è¿™æ ·åšï¼Œä»¥åŠæ˜¯å¦æœ‰å…¶ä»–é€‰æ‹©ï¼Œä½†æ˜¯ç°åœ¨ï¼Œè¯·è€å¿ƒç­‰å¾…)ã€‚**

**è¿™æ„å‘³ç€æˆ‘ä»¬çš„`user_features`åº”è¯¥æ˜¯è¿™æ ·çš„:
`['f1:1', 'f1:0', 'f2:1', 'f3:0', 'f3:1', 'loc:mum', 'loc:del']`ã€‚**

**æ­£å¦‚ä½ æ‰€çŒœæµ‹çš„ï¼Œè¿™ä¸ªåˆ—è¡¨æ˜¯é€šè¿‡è€ƒè™‘åœ¨è®­ç»ƒé›†ä¸­å¯èƒ½é‡åˆ°çš„æ‰€æœ‰å¯èƒ½çš„å¯¹æ¥ç”Ÿæˆçš„ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç­‰äº`loc`çš„`feature_name`ï¼Œå¯ä»¥æœ‰ä¸¤ä¸ª`feature_values`ï¼Œå³`mum`å’Œ`del`ã€‚**

**æˆ‘å†™äº†ä¸€å°æ®µä»£ç ï¼Œè®©æˆ‘ç”Ÿæˆè¿™æ ·ä¸€ä¸ªåˆ—è¡¨(æˆ‘ç§°ä¹‹ä¸º`uf`):**

```
**uf = []
col = ['f1']*len(features.f1.unique()) + ['f2']*len(features.f2.unique()) + ['f3']*len(features.f3.unique()) + ['loc']*len(features['loc'].unique())
unique_f1 = list(features.f1.unique()) + list(features.f2.unique()) + list(features.f3.unique()) + list(features['loc'].unique())
#print('f1:', unique_f1)
for x,y in zip(col, unique_f1):
    res = str(x)+ ":" +str(y)
    uf.append(res)
    print(res)**
```

**![](img/5400df92e1c5fbff365a287e8004624d.png)**

**æœ€åï¼Œæœ‰äº†æ‰€æœ‰å¯ç”¨çš„éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬å¯¹æ•°æ®é›†è°ƒç”¨ fit æ–¹æ³•:**

```
***# we call fit to supply userid, item id and user/item features*
dataset1.fit(
        df['user'].unique(), *# all the users*
        df['item'].unique(), *# all the items*
        user_features = uf *# additional user features*
)**
```

**æ—¢ç„¶æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†æ¡†æ¶æ•°æ®é›†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å®é™…çš„äº¤äº’å’Œè¯„çº§æ’å…¥å…¶ä¸­äº†ã€‚**

## **å»ºç«‹äº’åŠ¨**

**`build_interactions`æ–¹æ³•çš„è¾“å…¥æ˜¯äº¤äº’çš„ iterableï¼Œå…¶ä¸­æ¯ä¸ªäº¤äº’æ˜¯ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªå…ƒç´ çš„å…ƒç»„:**

*   **ç”¨æˆ·**
*   **é¡¹ç›®**
*   **äº¤äº’æƒé‡(å¯é€‰)**

**äº¤äº’æƒé‡ä»…ä»…æ„å‘³ç€å¦‚æœç”¨æˆ·â€˜uâ€™ä¸é¡¹ç›®â€˜Iâ€™äº¤äº’ï¼Œé‚£ä¹ˆè¿™ä¸ªäº¤äº’*æœ‰å¤šé‡è¦ã€‚ä»æˆ‘ä»¬ç¤ºä¾‹çš„è§’åº¦æ¥çœ‹ï¼Œæƒé‡æ˜¯æˆ‘ä»¬å¯¹æ¯ä¸ª(ç”¨æˆ·ã€å•†å“)å¯¹çš„è¯„çº§ã€‚***

**æ’å…¥æƒé‡å¯èƒ½æœ‰ç”¨çš„å¦ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ­£åœ¨å¤„ç†(ç”¨æˆ·ã€æ­Œæ›²)äº¤äº’æ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å¯ä»¥ç»™é‚£äº›ç”¨æˆ·å¬äº†è¶…è¿‡ 3/4 æ­Œæ›²çš„äº¤äº’åˆ†é…ä¸€ä¸ªè¾ƒé«˜çš„æƒé‡ã€‚**

```
***# plugging in the interactions and their weights*
(interactions, weights) = dataset1.build_interactions([(x[0], x[1], x[2]) for x in df.values ])**
```

> **æ€»ä¹‹ï¼Œ`interactions`çŸ©é˜µå‘Šè¯‰æˆ‘ä»¬ç”¨æˆ·æ˜¯å¦ä¸æŸä¸ªé¡¹ç›®è¿›è¡Œäº†äº¤äº’ï¼Œè€Œ`weights`çŸ©é˜µé‡åŒ–äº†ç‰¹å®šçš„äº¤äº’ã€‚**

**æˆ‘ä»¬å¯ä»¥çœ‹çœ‹è¿™ä¸¤ä¸ªè¾“å‡ºçŸ©é˜µæ˜¯ä»€ä¹ˆæ ·çš„ã€‚ç”±äºè¿™äº›æ˜¯ç¨€ç–çŸ©é˜µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`.todense()`æ–¹æ³•ã€‚åœ¨è¿™ä¸¤ä¸ªçŸ©é˜µä¸­ï¼Œè¡Œæ˜¯ç”¨æˆ·ï¼Œåˆ—æ˜¯é¡¹ç›®ã€‚**

**![](img/caab53877f6f1b28e8c21c9acba29d75.png)**

**å¦‚æœä½ ç°åœ¨è¿˜å’Œæˆ‘åœ¨ä¸€èµ·ï¼Œæˆ‘å‘ä½ è‡´æ•¬ã€‚ç†è§£ä¸‹ä¸€éƒ¨åˆ†éå¸¸é‡è¦ï¼Œè¿™æ ·ä½ ä¹Ÿå¯ä»¥ä¸ºä½ è‡ªå·±çš„æ¨èç³»ç»Ÿå®ç°å®ƒã€‚(æœ‰è¶£çš„äº‹å®:LightFM Github é¡µé¢ä¸Šçš„è®¸å¤šå…¬å¼€é—®é¢˜éƒ½ä¸æ„å»ºç”¨æˆ·/ç‰©å“ç‰¹æ€§ä¸»é¢˜æœ‰å…³)ã€‚**

## **æ„å»ºç”¨æˆ·ç‰¹å¾**

**`build_user_features`æ–¹æ³•éœ€è¦ä»¥ä¸‹æ ¼å¼çš„è¾“å…¥:
[
(ç”¨æˆ· 1ï¼Œ[ç‰¹å¾ 1ï¼Œç‰¹å¾ 2ï¼Œç‰¹å¾ 3ï¼Œâ€¦ã€‚])ï¼Œ
(ç”¨æˆ· 2ï¼Œ[åŠŸèƒ½ 1ï¼ŒåŠŸèƒ½ 2ï¼ŒåŠŸèƒ½ 3ï¼Œâ€¦ã€‚])ï¼Œ
(ç”¨æˆ· 3ï¼Œ[åŠŸèƒ½ 1ï¼ŒåŠŸèƒ½ 2ï¼ŒåŠŸèƒ½ 3ï¼Œâ€¦ã€‚])ï¼Œ
ã€‚
ã€‚** 

> **è¿™é‡Œéœ€è¦è®°ä½çš„ä¸€ä»¶è¶…çº§é‡è¦çš„äº‹æƒ…æ˜¯ï¼Œ`feature1`ã€`feature2`ã€`feature3`ç­‰åº”è¯¥æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹ä¼ é€’ç»™`fit`æ–¹æ³•çš„`user_features`åˆ—è¡¨ä¸­çš„é¡¹ç›®ä¹‹ä¸€ã€‚**

**åªæ˜¯é‡ç”³ä¸€ä¸‹ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„`user_features`åˆ—è¡¨ç›®å‰çš„æ ·å­:
`['f1:1', 'f1:0', 'f2:1', 'f3:0', 'f3:1', 'loc:mum', 'loc:del']`ã€‚**

**å› æ­¤ï¼Œå¯¹äºæˆ‘ä»¬ç‰¹å®šçš„è™šæ‹Ÿæ•°æ®ï¼Œ`build_user_features`çš„è¾“å…¥åº”è¯¥æ˜¯è¿™æ ·çš„:**

```
**[
     ('u1', ['f1:1', 'f2:1', 'f3:0', 'loc:del']),
     ('u2', ['f1:0', 'f2:1', 'f3:0', 'loc:mum']),
     ('u3', ['f1:1', 'f2:1', 'f3:1', 'loc:del'])
 ]**
```

**åŒæ ·ï¼Œæˆ‘å·²ç»ç¼–å†™äº†ä¸€ä¸ª(ä¸é‚£ä¹ˆå°çš„)ä»£ç ç‰‡æ®µï¼Œè®©æˆ‘ç”Ÿæˆè¿™æ ·ä¸€ä¸ªåˆ—è¡¨:**

```
*****# Helper function that takes the user features and converts them into the proper "feature:value" format***
def feature_colon_value(my_list):
    """
    Takes as input a list and prepends the columns names to respective values in the list.
    For example: if my_list = [1,1,0,'del'],
    resultant output = ['f1:1', 'f2:1', 'f3:0', 'loc:del']

    """
    result = []
    ll = ['f1:','f2:', 'f3:', 'loc:']
    aa = my_list
    for x,y in zip(ll,aa):
        res = str(x) +""+ str(y)
        result.append(res)
    return result***# Using the helper function to generate user features in proper format for ALL users*** ad_subset = features[["f1", 'f2','f3', 'loc']] 
ad_list = [list(x) for x in ad_subset.values]
feature_list = []
for item in ad_list:
    feature_list.append(feature_colon_value(item))
print(f'Final output: {feature_list}')**
```

**![](img/061b596abfd79496c4286e8d79a147a9.png)**

**æœ€åï¼Œæˆ‘ä»¬å¿…é¡»å°†`feature_list`çš„æ¯ä¸ªå…ƒç´ ä¸ç›¸åº”çš„ç”¨æˆ· id ç›¸å…³è”ã€‚**

```
**user_tuple = list(zip(features.user, feature_list))**
```

**![](img/bbbd0686060ae14419df08d13d1f6143.png)**

**ç§ï¼Œæˆ‘ä»¬æœ‰äº†`build_user_features`æ–¹æ³•æ‰€éœ€çš„è¾“å…¥ã€‚è®©æˆ‘ä»¬ç»§ç»­ç§°ä¹‹ä¸º:**

```
**user_features = dataset1.build_user_features(user_tuple, normalize= False)**
```

**![](img/d318671062ae8147067ccf161389ca48.png)**

**å›¾ 1**

**åœ¨ä¸Šé¢çš„`user_features`çŸ©é˜µä¸­ï¼Œè¡Œæ˜¯ç”¨æˆ·ï¼Œåˆ—æ˜¯ç”¨æˆ·ç‰¹å¾ã€‚æ¯å½“ç”¨æˆ·åœ¨è®­ç»ƒæ•°æ®ä¸­å…·æœ‰è¯¥ç‰¹å®šç”¨æˆ·ç‰¹å¾æ—¶ï¼Œå°±å­˜åœ¨ 1ã€‚**

**æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ€»å…±æœ‰ 10 åˆ—ï¼Œè¿™æ„å‘³ç€å­˜åœ¨ 10 ä¸ªç”¨æˆ·ç‰¹æ€§ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆä½ é—®ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ï¼**

```
**user_id_map, user_feature_map, item_id_map, item_feature_map = dataset1.mapping()
user_feature_map**
```

**![](img/32338379062f3227399d23350d35666f.png)**

**å¦‚æœä½ çœ‹çœ‹ä¸Šé¢çš„è¾“å‡ºï¼Œå°±ä¼šæ˜ç™½ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰ 10 ä¸ªç”¨æˆ·ç‰¹æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ· id æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ä¸‰ä¸ªã€‚å‰©ä¸‹çš„ä¸ƒä¸ªä¸€å®šå¾ˆç†Ÿæ‚‰ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ä¸€å¼€å§‹å°±åˆ›å»ºäº†å®ƒä»¬ã€‚**

## **æ˜¯æ—¶å€™å»ºç«‹æ¨¡å‹äº†**

**è¿™ä¸€æ­¥éå¸¸ç®€å•ï¼Œä¹Ÿéå¸¸é€šç”¨ã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥éµå¾ª[æ–‡æ¡£](https://making.lyst.com/lightfm/docs/index.html)å¹¶å°è¯•ä¸åŒçš„`loss`å€¼æˆ–`learning_schedule`é€‰é¡¹ã€‚**

```
**model = LightFM(loss='warp')
model.fit(interactions,
      user_features= user_features,
      sample_weight= weights,
      epochs=10)**
```

## **æ‰“å° AUC åˆ†æ•°**

```
**from lightfm.evaluation import auc_score
train_auc = auc_score(model,
                      interactions,
                      user_features=user_features
                     ).mean()
print('Hybrid training set AUC: %s' % train_auc)**Output: Hybrid training set AUC: 0.9166667****
```

**æˆ‘å†è¯´ä¸€éï¼Œä¸è¦å¯¹é«˜ AUC è¿‡äºå…´å¥‹ã€‚è®°ä½è¿™åªæ˜¯è™šæ‹Ÿæ•°æ®ã€‚**

## **ä¸ºå·²çŸ¥ç”¨æˆ·åšé¢„æµ‹**

**`predict`æ–¹æ³•æœ‰ä¸¤ä¸ªè¾“å…¥:**

*   **ç”¨æˆ· id æ˜ å°„(ä¾‹å¦‚:è¦è·å¾—å¯¹â€œu1â€çš„é¢„æµ‹ï¼Œå¿…é¡»ä¼ é€’ 0ï¼›å¯¹äºâ€˜U2â€™ï¼Œä¼ é€’ 1ï¼Œä»¥æ­¤ç±»æ¨ã€‚).è¿™äº›æ˜ å°„å¯ä»`user_id_map` å­—å…¸ä¸­è®¿é—®ã€‚**
*   **æ¡ç›® id çš„åˆ—è¡¨(åŒæ ·ä¸æ˜¯ i1ã€i2ï¼Œè€Œæ˜¯æ˜ å°„ï¼›å¯ä»`item_id_map`è·å¾—æ‚¨æƒ³è¦çš„æ¨èã€‚**

```
***# predict for existing user*
user_x = user_id_map['u3']
n_users, n_items = interactions.shape *# no of users * no of items*
model.predict(user_x, np.arange(n_items)) *# means predict for all* **Output: array([-0.18600112, -0.91691172, -0.295421  , -0.06632421])****
```

## **ä¸ºæœªçŸ¥ç”¨æˆ·åšé¢„æµ‹**

**è¿™å°±æ˜¯æˆ‘ä»¬æœ€åˆæ„å»ºæ··åˆæ¨èå™¨çš„åŸå› ã€‚**

**å¯¹äºä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œè¿™æ˜¯æˆ‘ä»¬æ‰€çŸ¥é“çš„- (s)ä»–æœ‰ f1ï¼Œf2ï¼Œf3 çš„å€¼ï¼Œåˆ†åˆ«ä¸º 1ï¼Œ1 å’Œ 0ã€‚æ­¤å¤–ï¼Œä»–ä»¬çš„ä½ç½®æ˜¯å¾·é‡Œã€‚**

```
**user_feature_list = ['f1:1', 'f2:1', 'f3:0', 'loc:del']**
```

**ç°åœ¨ï¼Œæˆ‘ä»¬ä¸èƒ½å°†å®ƒç›´æ¥æä¾›ç»™`predict`æ–¹æ³•ã€‚æˆ‘ä»¬å¿…é¡»å°†è¿™ç§è¾“å…¥è½¬æ¢æˆ lightFM æ¨¡å‹å¯ä»¥ç†è§£çš„å½¢å¼ã€‚**

**ç†æƒ³æƒ…å†µä¸‹ï¼Œè¾“å…¥åº”è¯¥ç±»ä¼¼äº`user_features`çŸ©é˜µä¸­çš„ä¸€è¡Œ(è§ä¸Šé¢çš„å›¾ 1)ã€‚**

**æˆ‘åœ¨ [Stackoverflow](https://stackoverflow.com/questions/46924119/lightfm-handling-user-and-item-cold-start) ä¸Šæ‰¾åˆ°äº†ä¸€æ®µä»£ç ï¼Œå®ƒå°±æ˜¯è¿™æ ·åšçš„â€”â€”å°†`user_feature_list`è½¬æ¢æˆæ‰€éœ€çš„æ ¼å¼(åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ä¸€ä¸ªæœ‰ 10 åˆ—çš„ç¨€ç–çŸ©é˜µ)ã€‚æˆ‘åªæ˜¯ç¨å¾®ä¿®æ”¹äº†åŸå§‹ä»£ç ï¼Œå¹¶å°†å…¶å°è£…åœ¨ä¸€ä¸ªå¯é‡ç”¨çš„å‡½æ•°`format_newuser_input`ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:**

```
**from scipy import sparsedef format_newuser_input(user_feature_map, user_feature_list):
  num_features = len(user_feature_list)
  normalised_val = 1.0 
  target_indices = []
  for feature in user_feature_list:
    try:
        target_indices.append(user_feature_map[feature])
    except KeyError:
        print("new user feature encountered '{}'".format(feature))
        pass

  new_user_features = np.zeros(len(user_feature_map.keys()))
  for i in target_indices:
    new_user_features[i] = normalised_val
  new_user_features = sparse.csr_matrix(new_user_features)
  return(new_user_features)**
```

**æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹é¢„æµ‹æ–°ç”¨æˆ·:**

```
**new_user_features = format_newuser_input(user_feature_map, user_feature_list)
model.predict(0, np.arange(n_items), user_features=new_user_features)**
```

**è¿™é‡Œï¼Œç¬¬ä¸€ä¸ªå‚æ•°(å³ 0)ä¸å†æŒ‡ç”¨æˆ· u1 çš„æ˜ å°„ idã€‚ç›¸åï¼Œå®ƒçš„æ„æ€æ˜¯â€”â€”é€‰æ‹©`new_user_features`ç¨€ç–çŸ©é˜µçš„ç¬¬ä¸€è¡Œã€‚ä¼ é€’é™¤ 0 ä»¥å¤–çš„ä»»ä½•å€¼éƒ½ä¼šå¼•å‘ä¸€ä¸ªé”™è¯¯ï¼Œè¿™æ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œå› ä¸ºåœ¨`new_user_features`ä¸­æ²¡æœ‰è¶…è¿‡ row0 çš„è¡Œã€‚**

## **ä¸‡å²ï¼ï¼æˆ‘ä»¬åšåˆ°äº†ã€‚æˆ‘ä»¬çš„è™šæ‹Ÿæ··åˆæ¨èç³»ç»Ÿå·²ç»å‡†å¤‡å¥½äº†ã€‚**

## **åˆ›å»ºç”¨æˆ·/é¡¹ç›®ç‰¹å¾çš„å…¶å®ƒæ–¹å¼**

**å›åˆ°æˆ‘åœ¨å¼€å§‹æ—¶æ‰€åšçš„æ‰¿è¯ºï¼Œé™¤äº†æ„å»º`user_features`çŸ©é˜µï¼Œè¿˜æœ‰å…¶ä»–é€‰æ‹©ï¼Œ**å‡è®¾** **ä½ çš„æ•°æ®æ˜¯ä¸€ç§ç‰¹å®šçš„æ ¼å¼**ã€‚**

**ä¾‹å¦‚ï¼Œè€ƒè™‘å¦‚ä¸‹æ‰€ç¤ºçš„ç”¨æˆ·ç‰¹å¾æ•°æ®å¸§:**

**![](img/e1b52b0b3f9f9798bdba8ce93cee8a09.png)**

**æ¥æº:[https://github.com/lyst/lightfm/issues/372](https://github.com/lyst/lightfm/issues/372)**

**å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œè¿™ä¸‰ä¸ªç‰¹å¾â€”â€”ç§æ—ã€æ€§åˆ«ã€30 å²ä»¥ä¸‹ï¼Œæ¯ä¸€ä¸ªéƒ½æœ‰ä¸é‡å çš„å€¼ã€‚æ¢å¥è¯è¯´ï¼Œ*ç§æ—åˆ—ä¸­çš„å¯èƒ½å€¼ä¸åŒäºæ€§åˆ«åˆ—ä¸­çš„å¯èƒ½å€¼ï¼Œæ€§åˆ«åˆ—ä¸­çš„å¯èƒ½å€¼åˆä¸åŒäº under_30yo åˆ—ä¸­çš„å¯èƒ½å€¼*ã€‚**

**å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†è¡¨å•`[Asian, Hispanic, Female, Male, no, yes]`çš„`user_features`åˆ—è¡¨ä¼ é€’ç»™`fit`ã€‚éšåï¼Œæˆ‘ä»¬**å¿…é¡»**ä¹Ÿæ›´æ–°æˆ‘ä»¬æ„å»ºç”¨æˆ·ç‰¹æ€§çš„æ–¹å¼ï¼Œå› æ­¤`.build_user_features()`çš„è¾“å…¥åº”è¯¥æ˜¯è¿™æ ·çš„:**

```
**[
     ('u1', ['Asian', 'Female', 'No']),
     ('u2', ['Hispanic', 'Male', 'Yes']),
     ('u3', ['Hispanic', 'Male', 'No'])
 ]**
```

**è¿™çœ‹èµ·æ¥å¾ˆæ£’ã€‚ä½†æ˜¯ç°åœ¨å›ç­”è¿™ä¸ªï¼Ÿ**

**å½“æˆ‘æœ‰ä¸€ä¸ªå…³äºæ¯ä¸ªç”¨æˆ·çš„é¢å¤–ä¿¡æ¯æ—¶ï¼Œæ¯”å¦‚ä¸€ä¸ªæ–°åˆ—â€œheight_under_5ftâ€å¯ä»¥å–å€¼ yes æˆ– noï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ**

**åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½å¾ˆéš¾ä»å¹´é¾„å’Œèº«é«˜æ¥åŒºåˆ†æ˜¯/å¦ã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…æ­§ä¹‰ï¼Œæœ€å¥½ä½¿ç”¨æˆ‘ä»¬åœ¨å¼€å§‹æ—¶è°ˆåˆ°çš„`feature:value`æ ¼å¼ï¼Œå¹¶å°†`user_features = ['eth:Asian', 'eth:Hispanic', 'gender:Male', 'gender:Female', 'age:yes', 'age:no', 'height:yes', 'height:no]`ä¼ é€’ç»™`fit`ï¼Œå¹¶å°†ä»¥ä¸‹è¾“å…¥ä¼ é€’ç»™`.build_usear_features()`**

```
**[
     ('u1', ['eth:Asian', 'gender:Female', 'age:No', 'height:yes']),
     ('u2', ['eth:Hispanic', 'gender:Male', 'age:No', 'height:no'])
     ('u3', ['eth:Asian', 'gender:Female', 'age:No', 'height:yes'])
 ]**
```

# **ç»“å°¾æ³¨é‡Š**

**æœ‰å¾ˆå¤šä¸åŒçš„æ–¹æ³•å¯ä»¥æ¨è¿›è¿™ä¸ªæ•™ç¨‹ã€‚é¦–å…ˆï¼Œå°è¯•æ’å…¥çœŸå®æ•°æ®é›†è€Œä¸æ˜¯è™šæ‹Ÿæ•°æ®ï¼Œçœ‹çœ‹ä½ çš„æ¨èç³»ç»Ÿè¡¨ç°å¦‚ä½•ã€‚æ‚¨ç”šè‡³å¯ä»¥å°è¯•ä½¿ç”¨æˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­è®¨è®ºçš„ç±»ä¼¼æ–¹æ³•æ¥åˆ›å»º`item_features`ã€‚**

**æˆ‘æ²¡æœ‰è¿‡å¤šåœ°è®¨è®ºè¿‡æ¨¡å‹è°ƒä¼˜ã€æ¨¡å‹è¯„ä¼°ã€äº¤å‰éªŒè¯ç­‰ç­‰ï¼Œä½†é‚£æ˜¯ä»¥åçš„äº‹äº†ã€‚æˆ‘å¸Œæœ›ä½ å–œæ¬¢é˜…è¯»ï¼Œå¹¶éšæ—¶åœ¨ Github ä¸Šåˆ†äº«æˆ‘çš„ä»£ç ï¼Œä»¥æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚ä¸€å¦‚æ—¢å¾€ï¼Œæˆ‘å¾ˆæƒ³çŸ¥é“æ˜¯å¦æœ‰æ›´å¥½çš„æ–¹æ³•æ¥åšæˆ‘æåˆ°çš„ä¸€äº›äº‹æƒ…ã€‚**

**ç›´åˆ°ä¸‹æ¬¡:)**

**å“¦ï¼Œæˆ‘å·®ç‚¹å¿˜äº†ï¼Œâ€œ*å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯èƒ½ä¹Ÿä¼šå–œæ¬¢*â€ğŸ˜œ)**

**æˆ‘å–œæ¬¢å†™å¾ªåºæ¸è¿›çš„åˆå­¦è€…æŒ‡å—ã€æ“ä½œæŒ‡å—ã€é¢è¯•é—®é¢˜ã€ML/AI ä¸­ä½¿ç”¨çš„è§£ç æœ¯è¯­ç­‰ã€‚å¦‚æœä½ æƒ³å®Œå…¨è®¿é—®æˆ‘çš„æ‰€æœ‰æ–‡ç« (ä»¥åŠå…¶ä»–æ–‡ç« )ï¼Œé‚£ä¹ˆä½ å¯ä»¥æ³¨å†Œä½¿ç”¨ [***æˆ‘çš„é“¾æ¥***](https://varshitasher.medium.com/membership)**è¿™é‡Œ* ***ã€‚******

**[](/how-to-make-most-of-your-python-debugger-in-vscode-9e05dfce533f) [## å¦‚ä½•åœ¨ VSCode ä¸­å……åˆ†åˆ©ç”¨ä½ çš„ python è°ƒè¯•å™¨ï¼Ÿ

### è§‚å¯Ÿå˜é‡ï¼Œä½¿ç”¨æ¡ä»¶æ–­ç‚¹ï¼Œè°ƒç”¨å †æ ˆï¼Œå¼‚å¸¸æ–­ç‚¹ç­‰â€”â€”å½“åœ¨å¤§å‹é¡¹ç›®ä¸­å·¥ä½œæ—¶

towardsdatascience.com](/how-to-make-most-of-your-python-debugger-in-vscode-9e05dfce533f) [](/understanding-python-imports-init-py-and-pythonpath-once-and-for-all-4c5249ab6355) [## äº†è§£ Python å¯¼å…¥ï¼Œ__init__ã€‚py å’Œ pythonpath â€”ä¸€åŠ³æ°¸é€¸

### äº†è§£å¦‚ä½•å¯¼å…¥åŒ…å’Œæ¨¡å—(ä»¥åŠä¸¤è€…ä¹‹é—´çš„åŒºåˆ«)

towardsdatascience.com](/understanding-python-imports-init-py-and-pythonpath-once-and-for-all-4c5249ab6355) [](/time-series-analysis-using-pandas-in-python-f726d87a97d8) [## ä½¿ç”¨ Python ä¸­çš„ Pandas è¿›è¡Œæ—¶é—´åºåˆ—åˆ†æ

### å¯¹å­£èŠ‚æ€§ã€è¶‹åŠ¿ã€è‡ªç›¸å…³ç­‰å…³é”®è¯çš„é¢å¤–ä»‹ç»ã€‚

towardsdatascience.com](/time-series-analysis-using-pandas-in-python-f726d87a97d8) [](/deploying-h2o-models-as-apis-using-flask-42065a4fa567) [## ä½¿ç”¨ FLASK å°† H2o æ¨¡å‹éƒ¨ç½²ä¸º API

### æ¨¡å‹è®­ç»ƒã€è°ƒä¼˜å’Œåˆ›å»ºç®€å• API çš„ç«¯åˆ°ç«¯ç¤ºä¾‹(æ²¡æœ‰æŠ€æœ¯æœ¯è¯­)ã€‚

towardsdatascience.com](/deploying-h2o-models-as-apis-using-flask-42065a4fa567)**