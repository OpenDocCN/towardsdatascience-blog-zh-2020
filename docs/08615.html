<html>
<head>
<title>Using B-Splines and K-means to Cluster Time Series</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 B 样条和 K 均值聚类时间序列</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-b-splines-and-k-means-to-cluster-time-series-16468f588ea6?source=collection_archive---------35-----------------------#2020-06-22">https://towardsdatascience.com/using-b-splines-and-k-means-to-cluster-time-series-16468f588ea6?source=collection_archive---------35-----------------------#2020-06-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f533" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在时间序列数据中寻找趋势变得更加容易</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0068975bc31befda7af369ee7614b5fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xkZVAenDq4SI94oA"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">斯蒂芬·道森在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="7d08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">电子商务中的数据科学家不断发现自己在查看时间序列数据。在某些情况下，我们分析单个时间序列并开发预测模型。但是在<em class="ls">的其他案例中</em>我们正在回顾成千上万的时间序列，并试图找出有趣的模式。</p><p id="2f52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">处理一组时间序列可能会很尴尬。它们很难以有意义的方式聚集在一起。然而，使用 B 样条，我们可以简化我们的时间序列，更容易地进行探索性数据分析。</p><h2 id="9944" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">现实生活中的例子</h2><p id="bc05" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">假设您是一家大型在线零售商的数据科学家，您的任务是识别产品销售趋势。你可能会得到一个类似于<a class="ae kv" href="https://archive.ics.uci.edu/ml/datasets/Sales_Transactions_Dataset_Weekly" rel="noopener ugc nofollow" target="_blank">的数据集，这个数据集在 UCI 知识库</a>中。它包含 811 种不同产品的 52 周销量。让我们来看看随机抽样的产品及其标准化销售量:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/ef1922307140a2e676cb5e9ac62e9ecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VOflYagQMQ5IqntznCJIEQ.png"/></div></figure><p id="15f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个趋势很明显。大多数产品经历了相对稳定的销售，而 3 个产品经历了零星的高峰。在这些时间序列中可能隐藏着其他趋势，但试图通过人工检查来发现它们将是非常耗时和无聊的。</p><p id="4b22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以通过 k-means 等无监督的机器学习算法来运行这些数据，但我们的结果可能会过度拟合。此外，<strong class="ky ir">重要的不仅仅是每周时间序列的值，还有相对的上下移动</strong>，这不会被这个表示所捕获。</p><p id="12d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们需要一种方法来以简洁的方式表示我们的时间序列，这种方法不仅可以捕获每周序列的绝对值，还可以捕获形状。这就是 B 样条的用武之地。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="b768" class="mz lu iq bd lv na nb nc ly nd ne nf mb jw ng jx me jz nh ka mh kc ni kd mk nj bi translated">什么是 B 样条？</h1><p id="1373" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">b 样条是一种通过使用多项式的分段组合来近似非线性函数的方法<strong class="ky ir">。在深入研究 b 样条之前，让我们先来看看数据集中的单个时间序列，并尝试用线性回归模型对其进行拟合:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/0f7c2c9ca11998e860426bbe764bcd4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W7YMc5NxH167QtX0yMpBww.png"/></div></figure><p id="503b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然<strong class="ky ir">线性回归捕捉到了总体下降趋势，但它过度简化了系列</strong>中的模式。想象一下，如果不是一个线性回归，我们拟合两个回归模型，一个用于系列的前半部分，另一个用于后半部分。这可能会有所帮助。现在想象一下，如果我们拟合 52 个不同的回归模型，每个模型都适用于系列中特定的一周。虽然这个模型肯定会过度拟合，但它在描述原始系列方面做得很好。</p><p id="a53c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在适合一个模型和适合 52 个模型之间可能有一个中间地带。<strong class="ky ir">这是 b 样条背后的思想——拟合一系列局部模型。</strong></p><h2 id="9330" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">创建 B 样条逼近</h2><p id="afe4" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">b 样条有两个组成部分，一个基和系数。基础决定了超参数:使用多少个局部模型(称为结)以及在每个模型中使用什么次数的多项式。然后将系数乘以这个基数，以逼近原始数据。</p><p id="d2c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">b 样条基是一个对角矩阵，有 52 行——系列中的每个时间段一行，每个局部模型一列。我们可以创建一个 b 样条基，它使用 6 个局部模型或节点，并使用三次多项式，代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="faee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们使用热图绘制该矩阵的值，我们会得到如下结果:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/9f75a61bb918b26c11100577e5c19f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H8kyfxvgA15g7Dc2FKzfgA.png"/></div></figure><p id="347f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">矩阵中的每一列都有唯一的非零值区间</strong>，这些区间共同覆盖了整个矩阵<strong class="ky ir">。因此，通过将矩阵中的每一列乘以不同的系数，我们将能够控制局部区间上近似的形状。下面是我们的 B 样条基的另一种表示。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/9e9a04a343ed57d84b2845ab038f0ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VP5tbchoOGizXJ8vuvlmCg.png"/></div></figure><p id="619c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过使用不同的权重或系数组合这六个多项式，我们可以得到原始时间序列的非线性估计。我们可以使用最小二乘估计来获得最佳拟合系数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/c8b991ec7b0b260c42af34084f7d6ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2fJMGSiPihfCZkG_jAYRzA.png"/></div></figure><p id="e7f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个比我们最初的线性回归好得多的近似值。接下来，让我们看看如何使用 b 样条来执行无监督学习。</p><h1 id="02f5" class="mz lu iq bd lv na nm nc ly nd nn nf mb jw no jx me jz np ka mh kc nq kd mk nj bi translated">B 样条聚类</h1><p id="2303" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">上述 b 样条可以用 6 个系数来表示。想象一下，如果我们为原始数据集中的所有 811 个时间序列创建一个 b 样条近似。我们将有一个 811x6 的矩阵，比我们原来的 811x52 数据集维数低得多。</p><p id="e088" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过用不同的 K 值运行 K-means，我们看到对于 K 有几个好的选择，但是为了简单起见，让我们坚持 K=2</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/99a8264d193f7cf2b291aefae6cc7014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AntBEbxLTXp8mxlb62Q9FA.png"/></div></figure><p id="214d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们从原始时间序列中随机抽取一个样本，看看它们是如何用 K=2 进行聚类的</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/66c4f98e9219e3ab26b42e04d91d2de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kBQpfWsp4qvzBWEz9S3Rlw.png"/></div></figure><p id="d32f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们最初通过眼睛发现的，<strong class="ky ir">K-意味着区分具有持续销售的产品和具有大量零星峰值的产品</strong>。通过选择不同的 K 值，我们还可以识别时间序列中的不同趋势。我们来看看 K=5</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/ba0c9d3216f4e886aa85002069a7d9ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*akU3GAZFjiMVUKu2bE71Aw.png"/></div></figure><p id="a53a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，我们可以将我们的聚类的质心乘以基数，以查看每个聚类的平均时间序列。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/8407c9265f4445121682de5392fcf61e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mkw7MnyKcP8jnK5qIQ1uyA.png"/></div></figure><h1 id="5bbf" class="mz lu iq bd lv na nm nc ly nd nn nf mb jw no jx me jz np ka mh kc nq kd mk nj bi translated">摘要</h1><p id="ada6" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">B 样条提供了一种仅用少量数据点来表示时间序列的有效方法。当我们试图聚集数百、数千或数百万个时间序列时，这就很方便了。</p><p id="9616" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个例子中，我们使用 b 样条来执行分割。我们发现了有趣的相似点和时间序列片段，可以用来为产品决策提供信息。但是相同的 b 样条近似也可以用于分类或回归。</p><h1 id="67d2" class="mz lu iq bd lv na nm nc ly nd nn nf mb jw no jx me jz np ka mh kc nq kd mk nj bi translated">参考和链接</h1><p id="d503" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">[1] Github 完整代码在 R<a class="ae kv" href="https://github.com/RoryMichelen/Medium-Articles/blob/master/Clustering_w_B_Splines.rmd#L42-L56" rel="noopener ugc nofollow" target="_blank">https://Github . com/RoryMichelen/Medium-Articles/blob/master/Clustering _ w _ B _ splines . rmd # L42-L56</a></p><p id="1401" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[2]数据集:<a class="ae kv" href="https://archive.ics.uci.edu/ml/datasets/Sales_Transactions_Dataset_Weekly" rel="noopener ugc nofollow" target="_blank">https://archive . ics . UCI . edu/ml/datasets/Sales _ Transactions _ Dataset _ Weekly</a></p></div></div>    
</body>
</html>