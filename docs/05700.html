<html>
<head>
<title>7 Handy Use Cases Of Dictionary Comprehensions In Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中字典理解的7个便利用例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/7-handy-use-cases-of-dictionary-comprehensions-in-python-f7c37e462d92?source=collection_archive---------18-----------------------#2020-05-12">https://towardsdatascience.com/7-handy-use-cases-of-dictionary-comprehensions-in-python-f7c37e462d92?source=collection_archive---------18-----------------------#2020-05-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="b9b1" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">PYTHONIC式的编码方法</h2><div class=""/><div class=""><h2 id="4e9f" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">展平、反转、合并、过滤等等</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/fed89a26afec80c0b1c1ec6a0ec13548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oLz1jKpwSQTRlR5D"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae le" href="https://unsplash.com/@larm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Larm Rmah </a>拍摄</p></figure><p id="0f2f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Python中的理解是用于从其他序列构建序列的语法结构。本质上，理解是一种更简洁、更易读的编写循环的奇特形式。</p><p id="0f8a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">所有的理解都可以使用<code class="fe mb mc md me b">for</code>循环重写，但反之则不成立。总的来说，Python中有四种理解技术。</p><ul class=""><li id="3feb" class="mf mg iq lh b li lj ll lm lo mh ls mi lw mj ma mk ml mm mn bi translated">列出理解</li><li id="df4c" class="mf mg iq lh b li mo ll mp lo mq ls mr lw ms ma mk ml mm mn bi translated">词典释义</li><li id="46c0" class="mf mg iq lh b li mo ll mp lo mq ls mr lw ms ma mk ml mm mn bi translated">集合理解</li><li id="5a11" class="mf mg iq lh b li mo ll mp lo mq ls mr lw ms ma mk ml mm mn bi translated">生成器理解</li></ul><p id="60c7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这篇文章的目的是向你展示字典理解的力量，以及如何以不同的方式利用它。在我们探索一些有趣的案例之前，让我们先了解一下语法，因为它可能会让许多开发人员在开始时感到困惑。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="c6a8" class="na nb iq bd nc nd ne nf ng nh ni nj nk kf nl kg nm ki nn kj no kl np km nq nr bi translated">词典理解的句法</h1><p id="c4ff" class="pw-post-body-paragraph lf lg iq lh b li ns ka lk ll nt kd ln lo nu lq lr ls nv lu lv lw nw ly lz ma ij bi translated">考虑下面的代码，该代码从一系列数字中创建一个字典，其值是键的平方:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="9f80" class="ob nb iq me b gy oc od l oe of">square_dict = {num: num*num for num in range(1, 6)}<br/>print(square_dict)<br/>#Output<br/>{1: 1, 2: 4, 3: 9, 4: 16, 5: 25}</span></pre><p id="44cb" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在让我们使用上面的代码作为参考来分析字典表达式的语法:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi og"><img src="../Images/3f5c44d548ed77340701f1fd5418d18b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*80WUEWFPNo8ZEfvcRPD8-Q.png"/></div></div></figure><p id="f644" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">上面的语法代表了编写字典理解的最小形式。词典理解的输出以绿色突出显示。所有的键值对都被分配给构造的字典。</p><p id="e717" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">iterable不一定是字典。它可以是任何可以循环的python对象——列表、元组、字符串等。</p><p id="26e9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">与列表理解不同，字典理解也可以同时迭代一组键和值。通过调用字典上的<code class="fe mb mc md me b">items()</code>方法，您可以将它转换成一个键值元组列表进行循环。</p><p id="c986" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">还可以在字典理解中的<code class="fe mb mc md me b">for</code>循环后设置一个条件语句，如下所示:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="9f4d" class="ob nb iq me b gy oc od l oe of">fruits = ['Apple', 'Orange', 'Papaya', 'Banana', '']</span><span id="6b68" class="ob nb iq me b gy oh od l oe of">fruits_dict = {f:len(f) for f in fruits if len(f) &gt; 0}</span><span id="72b7" class="ob nb iq me b gy oh od l oe of">print(fruits_dict)<br/>#Output<br/>{'Apple': 5, 'Orange': 6, 'Papaya': 6, 'Banana': 6}</span></pre><p id="1e1c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">既然我们已经很好地了解了字典理解的语法，让我们来看看它的应用。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="fc02" class="na nb iq bd nc nd ne nf ng nh ni nj nk kf nl kg nm ki nn kj no kl np km nq nr bi translated">1.字频率</h1><p id="85d8" class="pw-post-body-paragraph lf lg iq lh b li ns ka lk ll nt kd ln lo nu lq lr ls nv lu lv lw nw ly lz ma ij bi translated">通常情况下，您需要构建一个字典来保存字符串中每个单词的计数。使用for循环实现这一点的经典方法是:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="345f" class="ob nb iq me b gy oc od l oe of">s = 'I felt happy because I saw the others were happy and because I knew I should feel happy'</span><span id="19a4" class="ob nb iq me b gy oh od l oe of">dict = {}<br/>for token in s.split(" "):<br/>    dict[token] = dict.get(token, 0) + 1</span></pre><p id="929c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">但是我们可以使用字典理解使它明显更短，如下所示:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="f275" class="ob nb iq me b gy oc od l oe of">frequency_dict = {token: s.split().count(token) for token in set(s.split())}</span><span id="6601" class="ob nb iq me b gy oh od l oe of">#Output<br/>{'felt': 1, 'and': 1, 'should': 1, 'others': 1, 'saw': 1, 'were': 1, 'knew': 1, 'happy': 3, 'feel': 1, 'the': 1, 'because': 2, 'I': 4}</span></pre></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="8104" class="na nb iq bd nc nd ne nf ng nh ni nj nk kf nl kg nm ki nn kj no kl np km nq nr bi translated">2.修改字典的键和值</h1><p id="79db" class="pw-post-body-paragraph lf lg iq lh b li ns ka lk ll nt kd ln lo nu lq lr ls nv lu lv lw nw ly lz ma ij bi translated">对于大型字典，可能会出现这样的情况，您需要在所有的字典后面追加一个字符。例如，它可以是一个简单的<code class="fe mb mc md me b">$</code>符号。</p><p id="3f46" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在另一种情况下，您可能需要从键或值字符串中删除一个字符。以下是如何使用字典理解功能通过修改键和值来创建新字典的示例:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="745c" class="ob nb iq me b gy oc od l oe of">d = {'My_Article1': '1', 'My_Article2' : '2'}</span><span id="e1f0" class="ob nb iq me b gy oh od l oe of">my_dict = { k[3:] : '$' + v for k, v in d.items()}</span><span id="7f8f" class="ob nb iq me b gy oh od l oe of">#Output<br/>{'Article1': '$1', 'Article2': '$2'}</span></pre></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="bcf9" class="na nb iq bd nc nd ne nf ng nh ni nj nk kf nl kg nm ki nn kj no kl np km nq nr bi translated">3.按一组关键字过滤词典</h1><p id="b34d" class="pw-post-body-paragraph lf lg iq lh b li ns ka lk ll nt kd ln lo nu lq lr ls nv lu lv lw nw ly lz ma ij bi translated">您可能只对字典中具有特定键集的部分感兴趣。下面是一个基于键列表过滤和创建新字典的示例:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="92b5" class="ob nb iq me b gy oc od l oe of">d = {1: 'a', 2: 'b', 3: 'c', 4: 'd'}<br/>keys = [1, 2]</span><span id="8aed" class="ob nb iq me b gy oh od l oe of">my_dict = {key: d[key] for key in keys}<br/>#Output<br/>{1: 'a', 2: 'b'}</span></pre><p id="1348" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">但是当列表<code class="fe mb mc md me b">keys</code>包含一个字典中没有的无关值时，上面的代码会抛出一个错误。因此，我们不迭代<code class="fe mb mc md me b">keys</code>，而是使用<code class="fe mb mc md me b">sets</code>来寻找<code class="fe mb mc md me b">d</code>和<code class="fe mb mc md me b">keys</code>中的公共键，如下所示:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="dcd1" class="ob nb iq me b gy oc od l oe of">my_dict = {key: d[key] for key in set(keys).intersection(d.keys())}</span></pre><p id="22be" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下面是第三种情况，我们通过包含指定字符串的关键字来过滤字典:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="2a8a" class="ob nb iq me b gy oc od l oe of">d = {'num_1': 'a', '2': 'b', 'num_3': 'c', '4': 'd'}</span><span id="8b30" class="ob nb iq me b gy oh od l oe of">filter_string = 'num'<br/>filtered_dict = {k:v for (k,v) in d.items() if filter_string in k}<br/>#Output<br/>{'num_1': 'a', 'num_3': 'c'}</span></pre></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="e774" class="na nb iq bd nc nd ne nf ng nh ni nj nk kf nl kg nm ki nn kj no kl np km nq nr bi translated">4.反转字典的映射</h1><p id="a220" class="pw-post-body-paragraph lf lg iq lh b li ns ka lk ll nt kd ln lo nu lq lr ls nv lu lv lw nw ly lz ma ij bi translated">如果您的字典有唯一的键和值，并且想要反转从<code class="fe mb mc md me b">k:v</code>到<code class="fe mb mc md me b">v:k</code>的映射，您可以通过以下方式使用<code class="fe mb mc md me b">for</code>循环来实现:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="02e4" class="ob nb iq me b gy oc od l oe of">d = {'1': 'a', '2': 'b', '3': 'c', '4': 'd'}</span><span id="15ca" class="ob nb iq me b gy oh od l oe of">my_dict = {}<br/>for k,v in d.items():<br/>    my_dict[v] = k</span></pre><p id="b882" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过使用字典理解，我们可以在一行中做同样的事情:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="1a94" class="ob nb iq me b gy oc od l oe of">my_dict = {v: k for k, v in d.items()}<br/>#Output<br/>{'a': '1', 'b': '2', 'c': '3', 'd': '4'}</span></pre></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="e6ce" class="na nb iq bd nc nd ne nf ng nh ni nj nk kf nl kg nm ki nn kj no kl np km nq nr bi translated">5.元组和稀疏向量到字典</h1><p id="cd4c" class="pw-post-body-paragraph lf lg iq lh b li ns ka lk ll nt kd ln lo nu lq lr ls nv lu lv lw nw ly lz ma ij bi translated">接下来，我们有一个元组列表，其中每个元素包含国家代码和名称。我们将使用理解技术创建一个字典，以国家名称作为关键字，以国家代码作为值:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="9716" class="ob nb iq me b gy oc od l oe of">tuples = [("US", '+1'), ("Australia", '+61'), ("India", '+91')]<br/>my_dict = {k[0]: k[1] for k in tuples}</span></pre><p id="4cd1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">稀疏向量一般包含很多零值。我们可以考虑在字典中只保存非零值，这样可以节省一些空间。通过使用下面的字典理解技术，我们可以将稀疏向量转换成键值对，其中<code class="fe mb mc md me b">key</code>是稀疏向量的索引:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="5a8d" class="ob nb iq me b gy oc od l oe of">values = [0,0,21,0,0,0,100]<br/>my_dict = { values.index(v) : v for v in values if v}<br/>#Output<br/>{2: 21, 6: 100}</span></pre><p id="5ee7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">还有另一种方式来编写上面的字典理解，可读性稍微好一点:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="0038" class="ob nb iq me b gy oc od l oe of">my_dict = {n: v for n,v in enumerate(values) if v}</span></pre><p id="e035" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><code class="fe mb mc md me b">if v</code>表示仅当稀疏向量的元素不是False、0、None等时，才将键和值添加到字典中。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="962f" class="na nb iq bd nc nd ne nf ng nh ni nj nk kf nl kg nm ki nn kj no kl np km nq nr bi translated">6.整理字典</h1><p id="066d" class="pw-post-body-paragraph lf lg iq lh b li ns ka lk ll nt kd ln lo nu lq lr ls nv lu lv lw nw ly lz ma ij bi translated">对字典进行分类有不同的方法。我们可以用键或值，按升序或降序来做。让我们来看看。</p><p id="8766" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下面是一个按关键字升序和降序排序的示例:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="5698" class="ob nb iq me b gy oc od l oe of">d = {"a": 3, "b": 4, "d": 1, "c": 2}<br/>dk_ascending = {k: d[k] for k in sorted(d)}<br/>#Output<br/>{'a': 3, 'b': 4, 'c': 2, 'd': 1}</span><span id="b943" class="ob nb iq me b gy oh od l oe of">dk_descending = {k: d[k] for k in sorted(d, reverse=True)}<br/>#Output<br/>{'d': 1, 'c': 2, 'b': 4, 'a': 3}</span></pre><p id="8079" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">以下示例显示了如何按升序和降序对值进行排序:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="191d" class="ob nb iq me b gy oc od l oe of">d = {"a": 3, "b": 4, "d": 1, "c": 2}<br/>dv_ascending = {k: d[k] for k in sorted(d, key=d.get)}<br/>#Output<br/>{'d': 1, 'c': 2, 'a': 3, 'b': 4}</span><span id="1eb5" class="ob nb iq me b gy oh od l oe of">dv_descending = <!-- -->{k: d[k] for k in sorted(d, key=d.get, reverse=True)}<br/>#Output<br/>{'b': 4, 'a': 3, 'c': 2, 'd': 1}</span></pre></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="38ef" class="na nb iq bd nc nd ne nf ng nh ni nj nk kf nl kg nm ki nn kj no kl np km nq nr bi translated">7.将字典列表展平为单个字典</h1><p id="5c27" class="pw-post-body-paragraph lf lg iq lh b li ns ka lk ll nt kd ln lo nu lq lr ls nv lu lv lw nw ly lz ma ij bi translated">假设Python列表中有未知数量的字典，如下所示:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="cb72" class="ob nb iq me b gy oc od l oe of">l = [{'a':1}, {'b':2}, {'c':3, 'd' : 4}]</span></pre><p id="440d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，我们想把这个列表展平成一个字典，这样所有的子字典合并成一个字典。我们可以使用下面的双重嵌套字典理解技术:</p><pre class="kp kq kr ks gt nx me ny nz aw oa bi"><span id="c796" class="ob nb iq me b gy oc od l oe of">my_dict = {k: v <br/>for d in l <br/>for k, v in d.items()<br/>}</span><span id="f8bd" class="ob nb iq me b gy oh od l oe of">#Output<br/>{'a': 1, 'b': 2, 'c': 3, 'd': 4}</span></pre></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="9afb" class="na nb iq bd nc nd ne nf ng nh ni nj nk kf nl kg nm ki nn kj no kl np km nq nr bi translated">结论</h1><p id="82f2" class="pw-post-body-paragraph lf lg iq lh b li ns ka lk ll nt kd ln lo nu lq lr ls nv lu lv lw nw ly lz ma ij bi translated">我们看到了在Python中应用字典理解的许多不同的用例。这个想法是有效地使用它，不要过度使用。很容易误用它来进行相当简单的操作。</p><p id="2f69" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这一篇就到此为止——感谢阅读。</p></div></div>    
</body>
</html>