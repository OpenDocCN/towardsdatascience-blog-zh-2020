<html>
<head>
<title>Serve a TensorFlow 2 Deep Learning Classifier as a REST API (with GPU support), Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 TensorFlow 2 深度学习分类器用作 REST API(有 GPU 支持)，第一部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-serve-a-tensorflow-2-2-deep-learning-classifier-as-a-rest-api-with-gpu-support-part-i-4767a8a22608?source=collection_archive---------67-----------------------#2020-05-18">https://towardsdatascience.com/create-serve-a-tensorflow-2-2-deep-learning-classifier-as-a-rest-api-with-gpu-support-part-i-4767a8a22608?source=collection_archive---------67-----------------------#2020-05-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="2b54" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/TensorFlow-REST-API" rel="noopener" target="_blank">端到端 TensorFlow REST API </a></h2><div class=""/><div class=""><h2 id="29f5" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">在这一系列文章中，我将一步一步地解释如何使用<a class="ae kr" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>创建和服务一个图像分类器作为 REST API！🚀稍后我们将<a class="ae kr" href="https://www.docker.com/why-docker" rel="noopener ugc nofollow" target="_blank">把它归档🐳！</a></h2></div><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/21a1fd69ebb108f7226692a0f13fc6db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WaH7lUMgrfwXR-mj"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated"><a class="ae kr" href="https://unsplash.com/@billjelen?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">比尔·杰伦</a>在<a class="ae kr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h2 id="c758" class="lp lq it bd lr ls lt dn lu lv lw dp lx ly lz ma mb mc md me mf mg mh mi mj iz bi translated">在<a class="ae kr" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>上编写深度学习图像分类器很棒，如果你部署你的模型，让你的客户有可能使用它，那就更棒了！</h2><p id="97b1" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">这一系列文章将帮助您从笔记本转向数据科学技术的真实使用案例！我们将深度学习分类器从零到生产🚀！</p><p id="1cd9" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated"><em class="ni">免责声明:你应该有</em><a class="ae kr" href="https://cs231n.github.io/convolutional-networks/" rel="noopener ugc nofollow" target="_blank"><em class="ni">CNN-卷积神经网络</em> </a> <em class="ni">的先验知识和经验。</em></p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="eb42" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">我们将用来训练我们的卷积神经网络分类器的数据集是<a class="ae kr" href="https://www.cs.toronto.edu/~kriz/cifar.html" rel="noopener ugc nofollow" target="_blank"> CIFAR-10 </a> ( <strong class="mm jd">暂时不要下载</strong>)。CIFAR-10 数据集包括 10 类 60000 幅 32×32 彩色图像，每类 6000 幅图像。有 50000 个训练图像和 10000 个测试图像。</p><p id="0aca" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">以下是数据集中的类，以及每个类中的 10 幅随机图像:</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/f81d65480a9da8df0a8f9e01dff4ca5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*I2dBe5VZBUz119uCsX1M5g.png"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated"><a class="ae kr" href="https://www.cs.toronto.edu/~kriz/cifar.html" rel="noopener ugc nofollow" target="_blank"> CIFAR-10 </a></p></figure><p id="24ad" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">准备好了吗？我们走吧！</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="5b2a" class="nk lq it bd lr nl nm nn lu no np nq lx ki nr kj mb kl ns km mf ko nt kp mj nu bi translated">1 —创建我们的项目结构</h1><p id="ac66" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">受 cookiecutter-data-science 开源模板的启发太多，下面是我最喜欢的数据科学项目结构:</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/87b6e014a8c513a10775f35f8342a6e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/0*gh10fP80JrloWkSu"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated">我最喜欢的数据科学项目结构</p></figure><ul class=""><li id="ebbf" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">在<em class="ni">数据/raw </em>中，我复制我的原始数据并在<em class="ni">数据/中处理；</em>我保留预处理过的数据。</li><li id="0542" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">在<em class="ni"> deploy </em>文件夹中，您可以找到 Dockerfile 和<em class="ni"> requirements.txt </em>或<em class="ni"> environment.yml </em>(仅保存生产库)</li><li id="8b37" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">在 models 的<em class="ni"> </em>文件夹中，我存储了保存的模型。</li><li id="da82" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">在<em class="ni">笔记本</em>文件夹中，我有我的笔记本(。ipynb 文件)</li><li id="585f" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">在<em class="ni">参考</em>文件夹中，我放入了元数据和我在项目中使用的资源的所有参考(pdf，笔记…等等)</li><li id="b8e5" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">在<em class="ni">报告</em>文件夹中，我放了所有的图表和报告(png、pdf、幻灯片),其中包含与我的团队分享的见解</li><li id="608f" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">在<em class="ni"> src </em>文件夹中，我的 Python 脚本按以下方式分组:src/<strong class="mm jd"><em class="ni">API</em></strong><em class="ni"/>文件夹用于创建 REST API 的脚本，src/ <strong class="mm jd"> <em class="ni"> data </em> </strong>文件夹包含用于处理数据的脚本，src/ <strong class="mm jd"> <em class="ni"> dags </em> </strong>文件夹包含我的<a class="ae kr" href="https://airflow.apache.org/docs/stable/concepts.html" rel="noopener ugc nofollow" target="_blank"> Airflow DAG </a> s，src/ <strong class="mm jd"> 【T25</strong></li><li id="87f5" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><em class="ni">测试</em>文件夹包含用于测试我的应用程序的 python 脚本</li><li id="ec91" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">我在那里配置我的 Python 日志记录器</li><li id="77ca" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">db_config.json 只是一个 json 文件，包含一些数据库访问配置</li></ul><p id="9bfd" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated"><strong class="mm jd">为了简化起见</strong>，让我们稍微简化一下我们的项目结构，只创建(暂时保留所有内容为空):</p><ul class=""><li id="1b06" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated"><strong class="mm jd"> <em class="ni">数据</em> </strong>文件夹</li><li id="fc98" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><strong class="mm jd"> <em class="ni">部署</em> </strong>文件夹</li><li id="f009" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><strong class="mm jd"> <em class="ni">型号</em> </strong>文件夹</li><li id="006e" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><strong class="mm jd"> <em class="ni">笔记本</em> </strong>文件夹</li><li id="9074" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><strong class="mm jd"> <em class="ni"> src </em> </strong>文件夹内的<strong class="mm jd"> <em class="ni"> src/model </em> </strong>和<strong class="mm jd"> <em class="ni"> src/api </em> </strong>子文件夹</li><li id="c97e" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><strong class="mm jd"><em class="ni">environment . yml</em></strong>文件</li><li id="53d7" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><strong class="mm jd"> <em class="ni"> logging.yml </em> </strong>文件</li></ul><p id="2aa1" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">就像我一样，你最终会得到这些文件夹</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/d35fe18b020cd717cfe9f39928b73ef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*fSboyxonmK8kWCC4r_VLvg.png"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated">项目结构</p></figure><p id="0c55" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">太好了！您已经准备好了一个清晰的项目结构！让我们建立我们的工作环境！</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="2ba2" class="nk lq it bd lr nl nm nn lu no np nq lx ki nr kj mb kl ns km mf ko nt kp mj nu bi translated">2 —开发设置</h1><p id="8ad2" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">按照以下步骤创建一个在<em class="ni"> environment.yml </em>文件中定义的虚拟 Python 3 工作环境，并配置您的 GPU:</p><ul class=""><li id="0b40" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated"><strong class="mm jd"> 2.1 — </strong>安装<a class="ae kr" href="http://conda.pydata.org/miniconda.html" rel="noopener ugc nofollow" target="_blank"> Miniconda 3 </a>(或<a class="ae kr" href="https://www.anaconda.com/products/individual" rel="noopener ugc nofollow" target="_blank"> <em class="ni"> Anaconda 3 </em> </a>)</li><li id="6f95" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><strong class="mm jd"> 2.2 — </strong>确保<em class="ni"> conda </em>在您的路径上(否则将 bin 文件添加到您的<strong class="mm jd"> $PATH </strong>):</li></ul><pre class="kt ku kv kw gt ol om on oo aw op bi"><span id="6278" class="lp lq it om b gy oq or l os ot">$ which conda</span><span id="1498" class="lp lq it om b gy ou or l os ot">~/anaconda3/bin/conda</span></pre><ul class=""><li id="d8ea" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated"><strong class="mm jd"> 2.3 — </strong>如果你有 CUDA 计算能力 3.5 或更高的 NVIDIA GPU 卡，请按照以下步骤启用 TensorFlow GPU 支持<a class="ae kr" href="https://www.tensorflow.org/install/gpu#software_requirements" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/install/GPU # software _ requirements</a>(暂时不要<em class="ni"> pip 安装 tensorflow </em>！首先配置 CUDA，我们将在下一步安装 tf2(2.4)</li><li id="1e43" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><strong class="mm jd"> 2.4 — </strong>我们现在调用我们的虚拟环境<strong class="mm jd"><em class="ni">tf2-image-classifier-API</em></strong>，然后在<strong class="mm jd"><em class="ni">environment . yml</em></strong>文件中指定所需的包(复制粘贴以下代码):<em class="ni"> tensorflow-gpu </em>、<em class="ni"> numpy </em>、<em class="ni"> seaborn </em>、<em class="ni"> jupyter </em>用于创建图像分类器<em class="ni">烧瓶</em>和<em class="ni">女侍</em>用于休息 API 创建。tqdm 用于获得令人愉快的进度条，最后，opencv-python 用于图像预处理！</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated"><strong class="ak"> environment.yml </strong>文件</p></figure><ul class=""><li id="1f07" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated"><strong class="mm jd"> 2.5 — </strong>现在转到项目根目录，创建一个虚拟环境:</li></ul><pre class="kt ku kv kw gt ol om on oo aw op bi"><span id="2f09" class="lp lq it om b gy oq or l os ot">$ conda env create -f environment.yml</span></pre><ul class=""><li id="101a" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated"><strong class="mm jd"> 2.6 — </strong>激活虚拟环境</li></ul><pre class="kt ku kv kw gt ol om on oo aw op bi"><span id="2024" class="lp lq it om b gy oq or l os ot">conda activate tf2-image-classifier-api</span></pre><p id="6b50" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">您现在应该已经激活了您的虚拟环境！</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ox"><img src="../Images/fb9590ef7d0f37b8e615c07dc0deb7d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACERUeAwrFAucZOoMOkMAQ.png"/></div></div></figure><p id="b0d9" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated"><strong class="mm jd">奖金(仅供参考，现在不需要)</strong>:</p><p id="f4e6" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">彻底清除环境</p><pre class="kt ku kv kw gt ol om on oo aw op bi"><span id="fb31" class="lp lq it om b gy oq or l os ot">conda env remove — name tf2-image-classifier-api</span></pre><p id="40da" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">将环境包更新到最新的兼容版本</p><pre class="kt ku kv kw gt ol om on oo aw op bi"><span id="06f6" class="lp lq it om b gy oq or l os ot">conda env update -f environment.yml</span></pre><ul class=""><li id="bdaa" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated"><strong class="mm jd"> 2.7 — </strong>从此处 下载 CIFAR-10 数据集，但为 png 格式<a class="ae kr" href="https://pjreddie.com/projects/cifar-10-dataset-mirror/" rel="noopener ugc nofollow" target="_blank"> <em class="ni"/></a></li><li id="0e46" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><strong class="mm jd"> 2.8 — </strong>将下载的<em class="ni"> cifar.tgz </em>文件复制到<strong class="mm jd"><em class="ni">data/raw</em></strong><em class="ni"/>文件夹中并解压到那里(你应该会得到<em class="ni"> train </em>文件夹、<em class="ni"> test </em>文件夹和 labels.txt 文件)</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/96d307cd9b03907a4dbe6ffa5b24bdd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*ZnCG7BnR0xJSajmaqrurGg.png"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated">解压<em class="oz"> cifar.tgz 文件并将其移动到</em><strong class="bd pa"><em class="oz">data/raw</em></strong>后</p></figure><p id="aace" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">太好了！现在，您的环境和数据集已经为我们的图像分类器训练和预测做好了准备！</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="eade" class="nk lq it bd lr nl nm nn lu no np nq lx ki nr kj mb kl ns km mf ko nt kp mj nu bi translated">3-加载库和数据集</h1><p id="8ef0" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">首先在<strong class="mm jd">项目的根</strong>中运行 jupyter notebook 命令:</p><pre class="kt ku kv kw gt ol om on oo aw op bi"><span id="c485" class="lp lq it om b gy oq or l os ot">$ jupyter notebook</span></pre><p id="ab6f" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">现在导航到<a class="ae kr" href="http://localhost:8888/tree/notebooks" rel="noopener ugc nofollow" target="_blank">http://localhost:8888/tree/notebooks</a></p><p id="e543" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">创建新笔记本</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pb"><img src="../Images/96ee3399517c14f412dff0ccb51d5974.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UuBWAjMtcdXazbiSyJ3VCg.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">创建新的 Jupyter 笔记本</p></figure><p id="37eb" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">并遵循以下步骤:</p><h2 id="a5da" class="lp lq it bd lr ls lt dn lu lv lw dp lx ly lz ma mb mc md me mf mg mh mi mj iz bi translated">3.1 —导入 tensorflow 并检查 GPU 支持</h2><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="9a6c" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">第一次，加载所需的<a class="ae kr" href="https://developer.nvidia.com/cudnn" rel="noopener ugc nofollow" target="_blank"> cuDNN </a> libs(帮助 TensorFlow 发现您的 GPU 设备)需要几分钟时间。如果一切正常，你会得到与我相似的结果(除了我有一个 GTX 960M/CUDA v10.2)。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pc"><img src="../Images/c0636110f82a7fa5e22430ae9a5d906d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C9Yd6DM7ApJ8D_m8NNOv9Q.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">导入 tf2 并检查 GPU 支持</p></figure><h2 id="40ca" class="lp lq it bd lr ls lt dn lu lv lw dp lx ly lz ma mb mc md me mf mg mh mi mj iz bi translated">3.2-导入其他必需的库</h2><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div></figure><h2 id="45d3" class="lp lq it bd lr ls lt dn lu lv lw dp lx ly lz ma mb mc md me mf mg mh mi mj iz bi translated">3.3-加载数据集</h2><p id="2da2" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">但是之前我们需要定义两个方法；<em class="ni">read _ image</em>&amp;<em class="ni">load _ dataset</em></p><ul class=""><li id="8704" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">使用 OpenCV 读取图像</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div></figure><ul class=""><li id="8df1" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">通过可视化一些图像来测试该方法</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="6408" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">结果</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/e8806012a2c4040b2fe1f28a8242a8c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*QczFQmDAnnecjh3FRmMrcg.png"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated">从训练集中可视化的随机图像</p></figure><ul class=""><li id="7439" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">加载数据集并以 numpy 数组的形式返回<em class="ni">图像</em>和<em class="ni">目标</em></li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div></figure><ul class=""><li id="4f87" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">现在我们已经准备好加载我们的<strong class="mm jd">训练&amp;测试数据集</strong>！</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div></figure><ul class=""><li id="e4ae" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">检查您的训练数据和测试数据形状</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="7f07" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">如果一切正常，你会得到和我相似的结果。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pe"><img src="../Images/4539249fb3a57dc892d6334122957031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xtgwf8Na5pIIfEZ8Y3zjOw.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">验证数据集形状</p></figure><p id="51be" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">太好了！现在我们已经加载了库，数据集也准备好了！让我们创建我们的 CNN 架构！</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="438a" class="nk lq it bd lr nl nm nn lu no np nq lx ki nr kj mb kl ns km mf ko nt kp mj nu bi translated">4 —创建图像分类深度学习模型</h1><p id="2031" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">我们不需要重新发明轮子，我们将使用这个<a class="ae kr" href="https://github.com/deep-diver/CIFAR10-img-classification-tensorflow" rel="noopener ugc nofollow" target="_blank"> CNN 架构</a>但是在 TensorFlow 2.2 中！</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pf"><img src="../Images/027c5ae276f04c614641425490408278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9VeN96YmMAUBJOix.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">我们的 CNN 模型架构— <a class="ae kr" href="https://github.com/deep-diver/CIFAR10-img-classification-tensorflow" rel="noopener ugc nofollow" target="_blank">图片来源</a></p></figure><p id="98a9" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">整个模型总共包括 16 层:</p><ol class=""><li id="6a49" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc pg oc od oe bi translated">批量标准化</li><li id="942a" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc pg oc od oe bi translated">与 64 个大小为(3×3)的不同滤波器进行卷积</li><li id="9359" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc pg oc od oe bi translated">最大池容量为 2</li></ol><ul class=""><li id="488d" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">ReLU 激活功能</li><li id="2ae7" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">批量标准化</li></ul><p id="5dc6" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">4.与 128 个大小为(3×3)的不同滤波器进行卷积</p><p id="7955" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">5.最大池容量为 2</p><ul class=""><li id="96a4" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">ReLU 激活功能</li><li id="939d" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">批量标准化</li></ul><p id="b072" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">6.与 256 个大小为(3×3)的不同滤波器进行卷积</p><p id="46f1" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">7.最大池容量为 2</p><ul class=""><li id="0121" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">ReLU 激活功能</li><li id="47a6" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">批量标准化</li></ul><p id="f178" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">8.与 512 个大小为(3×3)的不同滤波器进行卷积</p><p id="709c" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">9.最大池容量为 2</p><ul class=""><li id="fb08" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">ReLU 激活功能</li><li id="5762" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">批量标准化</li></ul><p id="fa40" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">10.展平最后卷积运算的三维输出。</p><p id="2827" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">11.具有 128 个单元的全连接层</p><ul class=""><li id="a671" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">拒绝传统社会的人</li><li id="2fd7" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">批量标准化</li></ul><p id="5320" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">12.具有 256 个单元的全连接层</p><ul class=""><li id="5391" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">拒绝传统社会的人</li><li id="6e11" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">批量标准化</li></ul><p id="0b8c" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">13.具有 512 个单元的全连接层</p><ul class=""><li id="6b4b" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">拒绝传统社会的人</li><li id="0c9c" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">批量标准化</li></ul><p id="2e22" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">14.具有 1024 个单元的全连接层</p><ul class=""><li id="b68e" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated">拒绝传统社会的人</li><li id="41f6" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated">批量标准化</li></ul><p id="3075" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">15.具有 10 个单元的全连接层(图像类的数量)</p><p id="59c9" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">16.Softmax</p><h2 id="7e5b" class="lp lq it bd lr ls lt dn lu lv lw dp lx ly lz ma mb mc md me mf mg mh mi mj iz bi translated">4.1 —创建卷积块</h2><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated">定义一种创建卷积块的方法(使用最大池和批量标准化)</p></figure><h2 id="62c8" class="lp lq it bd lr ls lt dn lu lv lw dp lx ly lz ma mb mc md me mf mg mh mi mj iz bi translated">4.2 —创建密集块</h2><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated">定义一种创建密集块的方法(带丢弃和批量标准化)</p></figure><h2 id="4a9b" class="lp lq it bd lr ls lt dn lu lv lw dp lx ly lz ma mb mc md me mf mg mh mi mj iz bi translated">4.3 —使用 TF 2 Keras 创建 CNN 模型</h2><p id="ba68" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">酷！现在我们已经准备好创建 CNN 的助手函数了！</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated">这个函数帮助我们创建一个 CNN Keras 模型准备编译！</p></figure><p id="6c0f" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">现在我们可以定义我们的训练<strong class="mm jd">超参数</strong>:</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated">训练超参数，你应该调整以获得更好的结果！</p></figure><p id="65d6" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">现在可以实例化我们的模型了。还有，我们来看看它的总结。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="0995" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">应该能打印出来</p><pre class="kt ku kv kw gt ol om on oo aw op bi"><span id="f1e9" class="lp lq it om b gy oq or l os ot">Model: "keras_image_classification_model"<br/>_________________________________________________________________<br/>Layer (type)                 Output Shape              Param #   <br/>=================================================================<br/>inputs (InputLayer)          [(None, 32, 32, 3)]       0         <br/>_________________________________________________________________<br/>batch_normalization_15 (Batc (None, 32, 32, 3)         12        <br/>_________________________________________________________________<br/>conv_1_features (Conv2D)     (None, 32, 32, 64)        1792      <br/>_________________________________________________________________<br/>max_pooling2d_8 (MaxPooling2 (None, 16, 16, 64)        0         <br/>_________________________________________________________________<br/>batch_normalization_16 (Batc (None, 16, 16, 64)        256       <br/>_________________________________________________________________<br/>conv_2_features (Conv2D)     (None, 16, 16, 128)       73856     <br/>_________________________________________________________________<br/>max_pooling2d_9 (MaxPooling2 (None, 8, 8, 128)         0         <br/>_________________________________________________________________<br/>batch_normalization_17 (Batc (None, 8, 8, 128)         512       <br/>_________________________________________________________________<br/>conv_3_features (Conv2D)     (None, 8, 8, 256)         819456    <br/>_________________________________________________________________<br/>max_pooling2d_10 (MaxPooling (None, 4, 4, 256)         0         <br/>_________________________________________________________________<br/>batch_normalization_18 (Batc (None, 4, 4, 256)         1024      <br/>_________________________________________________________________<br/>conv_4_features (Conv2D)     (None, 4, 4, 512)         3277312   <br/>_________________________________________________________________<br/>max_pooling2d_11 (MaxPooling (None, 2, 2, 512)         0         <br/>_________________________________________________________________<br/>batch_normalization_19 (Batc (None, 2, 2, 512)         2048      <br/>_________________________________________________________________<br/>flatten_2 (Flatten)          (None, 2048)              0         <br/>_________________________________________________________________<br/>dense_1_features (Dense)     (None, 128)               262272    <br/>_________________________________________________________________<br/>dropout_4 (Dropout)          (None, 128)               0         <br/>_________________________________________________________________<br/>batch_normalization_20 (Batc (None, 128)               512       <br/>_________________________________________________________________<br/>dense_2_features (Dense)     (None, 256)               33024     <br/>_________________________________________________________________<br/>dropout_5 (Dropout)          (None, 256)               0         <br/>_________________________________________________________________<br/>batch_normalization_21 (Batc (None, 256)               1024      <br/>_________________________________________________________________<br/>dense_3_features (Dense)     (None, 512)               131584    <br/>_________________________________________________________________<br/>dropout_6 (Dropout)          (None, 512)               0         <br/>_________________________________________________________________<br/>batch_normalization_22 (Batc (None, 512)               2048      <br/>_________________________________________________________________<br/>dense_4_features (Dense)     (None, 1024)              525312    <br/>_________________________________________________________________<br/>dropout_7 (Dropout)          (None, 1024)              0         <br/>_________________________________________________________________<br/>batch_normalization_23 (Batc (None, 1024)              4096      <br/>_________________________________________________________________<br/>dense_1 (Dense)              (None, 10)                10250     <br/>_________________________________________________________________<br/>softmax (Softmax)            (None, 10)                0         <br/>=================================================================<br/>Total params: 5,146,390<br/>Trainable params: 5,140,624<br/>Non-trainable params: 5,766</span></pre><p id="2054" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">精彩！<strong class="mm jd">5140624 个参数</strong>来训练！</p><h2 id="3049" class="lp lq it bd lr ls lt dn lu lv lw dp lx ly lz ma mb mc md me mf mg mh mi mj iz bi translated">4.4 —编译我们的 CNN Keras 模型</h2><p id="15e0" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">为了训练我们的模型，我们将使用<a class="ae kr" href="https://keras.io/api/optimizers/rmsprop/" rel="noopener ugc nofollow" target="_blank"> RMSprop </a>作为优化器&amp; <a class="ae kr" href="https://www.tensorflow.org/api_docs/python/tf/keras/losses/SparseCategoricalCrossentropy" rel="noopener ugc nofollow" target="_blank"> <em class="ni">作为损失函数。为什么<em class="ni">稀疏分类交叉熵</em>而不仅仅是<em class="ni">分类交叉熵？</em>好问题！下面是<a class="ae kr" href="https://stackoverflow.com/questions/59787897/how-does-tensorflow-sparsecategoricalcrossentropy-work/59788222#59788222" rel="noopener ugc nofollow" target="_blank">为什么是</a>！</em></a></p><p id="2315" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">现在我们可以编译我们的模型了！</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated">使用 RMSProp 作为优化器和 CategoricalCrossentropy 作为损失函数来编译 CNN 模型</p></figure><h2 id="a095" class="lp lq it bd lr ls lt dn lu lv lw dp lx ly lz ma mb mc md me mf mg mh mi mj iz bi translated">4.5 —训练我们的 CNN Keras 模型</h2><p id="3c23" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">一切都准备好训练我们的模型了。然而，让我们定义三个回调:</p><ul class=""><li id="dbd9" class="nw nx it mm b mn nd mq ne ly ny mc nz mg oa nc ob oc od oe bi translated"><a class="ae kr" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/EarlyStopping" rel="noopener ugc nofollow" target="_blank"> <strong class="mm jd">提前停止</strong> </a> <strong class="mm jd"> </strong>当我们的指标停止改善时，停止训练</li><li id="6878" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><a class="ae kr" href="https://www.tensorflow.org/tensorboard/tensorboard_in_notebooks" rel="noopener ugc nofollow" target="_blank"> <strong class="mm jd">张量板回调</strong> </a> <strong class="mm jd"> </strong>查看我们模型的训练历史</li><li id="9ee7" class="nw nx it mm b mn of mq og ly oh mc oi mg oj nc ob oc od oe bi translated"><a class="ae kr" href="https://tqdm.github.io/docs/keras/" rel="noopener ugc nofollow" target="_blank"><strong class="mm jd">tqdm 回调</strong> </a> <strong class="mm jd"> </strong> tqdm <code class="fe ph pi pj om b">keras</code>回调为历元和批次进度</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated">CNN 培训！</p></figure><p id="a40d" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">如果一切正常，你的模特应该开始训练了！你应该得到和我相似的结果。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pk"><img src="../Images/ec1845ad068ced95c9b16bfd2af67bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LOnxhvZJBbzxCiuwRUba9g.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">我的 CNN 培训！</p></figure><p id="c0ed" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">太好了！你的 GPU 现在正在燃烧🔥！让它训练你的模型，我们将在训练结束后回来！(这里是我的 GPU 努力工作的截图)</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pl"><img src="../Images/26c3e6afb09155c3cbe7ea68056433de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_zOU4_9GEY9K_YbSzwZVrg.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">我训练 Keras CNN 时的 GPU</p></figure><p id="3319" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">如果你想像汤姆那样，就拍快照吧！</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/f0d16ec19717cce8ef05bae4afb9bb33.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*qA1GGS6z0vTags4Y.png"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated"><a class="ae kr" href="https://pics.me.me/thumb_data-scientists-while-their-model-is-training-still-waiting-60708854.png" rel="noopener ugc nofollow" target="_blank">图像信用</a></p></figure><h2 id="3735" class="lp lq it bd lr ls lt dn lu lv lw dp lx ly lz ma mb mc md me mf mg mh mi mj iz bi translated">4.5 —测试我们的模型</h2><p id="267d" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">酷！我们的分类器已经完成训练！是时候评估一下了，对吧？它是如何处理测试图像的？我们可以通过使用下面的命令启动笔记本中的<strong class="mm jd"> tensorboard </strong>界面来检查这一点。</p><pre class="kt ku kv kw gt ol om on oo aw op bi"><span id="3dbd" class="lp lq it om b gy oq or l os ot">%tensorboard --logdir logs</span></pre><p id="3b49" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">此命令应启动 tensorboard，并显示精度和损耗图，用于训练和验证:</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pn"><img src="../Images/d99394a93a44281a97bfb7c7a02eb55e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MmPSsK8TKTmq3_Bq5wIP7g.png"/></div></div><p class="le lf gj gh gi lg lh bd b be z dk translated">张量板</p></figure><p id="fada" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">但是等等，对于一个分类器来说，准确度不是一个好的评估指标！让我们检查每一个类的精确度、召回率和 f1 分数！我们能做到这一点要感谢 scikit-learn 的<a class="ae kr" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.classification_report.html" rel="noopener ugc nofollow" target="_blank"> <em class="ni">分类 _ 报告</em> </a> <em class="ni"> </em>方法:</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div><p class="le lf gj gh gi lg lh bd b be z dk translated">分类报告</p></figure><p id="36ae" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">这些是我的结果:</p><pre class="kt ku kv kw gt ol om on oo aw op bi"><span id="c521" class="lp lq it om b gy oq or l os ot">precision    recall  f1-score   support</span><span id="3f83" class="lp lq it om b gy ou or l os ot">    airplane       0.84      0.86      0.85      1000<br/>  automobile       0.92      0.92      0.92      1000<br/>        bird       0.76      0.72      0.74      1000<br/>         cat       0.63      0.67      0.65      1000<br/>        deer       0.80      0.81      0.80      1000<br/>         dog       0.74      0.72      0.73      1000<br/>        frog       0.86      0.86      0.86      1000<br/>       horse       0.87      0.86      0.86      1000<br/>        ship       0.91      0.90      0.91      1000<br/>       truck       0.88      0.89      0.88      1000</span><span id="72f4" class="lp lq it om b gy ou or l os ot">    accuracy                           0.82     10000<br/>   macro avg       0.82      0.82      0.82     10000<br/>weighted avg       0.82      0.82      0.82     10000</span></pre><p id="bb49" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">第一次尝试不错，对吧？<strong class="mm jd"> 0.82 精度&amp; 0.82 召回</strong>！我们可以调整超参数并重新训练模型以获得更好的结果！</p><p id="4d2c" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">用你的结果来回应这个故事！我很乐意检查它们！😊</p><p id="c18a" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">让我们做一个推理测试。给出测试集中的图像，让我们发现我们的模型看到了什么！</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="dd86" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">结果</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi po"><img src="../Images/e882d1aedbbca2355c13793eb35ef286.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*9MLylfC9xN_PiJbQncsRkQ.png"/></div></figure><h1 id="d866" class="nk lq it bd lr nl pp nn lu no pq nq lx ki pr kj mb kl ps km mf ko pt kp mj nu bi translated">5-导出模型</h1><p id="41c6" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">不错！我们的模型在测试数据上表现很好，现在我们可以将它导出到磁盘。我们保存的模型用于进行推理，并将作为 REST API 公开！</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="1e14" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">最后，让我们通过加载来检查保存的模型是否工作正常！</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="70d9" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">精彩！精彩！精彩！您已经成功创建、训练(在 GPU 上)、测试并保存了一个 TensorFlow 2 深度学习图像分类器！</p><p id="59cf" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">现在我们准备将它公开为一个带有 Flask 和 waste 的 REST API，稍后将所有东西 Dockerize！</p><p id="8235" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">准备好了吗？走吧。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="3ff1" class="nk lq it bd lr nl nm nn lu no np nq lx ki nr kj mb kl ns km mf ko nt kp mj nu bi translated">6 —开发一个 REST API</h1><p id="ef53" class="pw-post-body-paragraph mk ml it mm b mn mo kd mp mq mr kg ms ly mt mu mv mc mw mx my mg mz na nb nc im bi translated">但是等等，这对于一个中等的故事来说已经太多了😔！敬请关注第二部分！🚀</p><p id="e511" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">所有的源代码都在我的 GitHub 上👇我会继续推动一切！</p><div class="pu pv gp gr pw px"><a href="https://github.com/hzitoun/tensorFlow-2-Deep-Learning-Image-Classifier-REST-API-Docker-GPU" rel="noopener  ugc nofollow" target="_blank"><div class="py ab fo"><div class="pz ab qa cl cj qb"><h2 class="bd jd gy z fp qc fr fs qd fu fw jc bi translated">Hz iton/tensor flow-2-深度学习-图像-分类器-REST-API-Docker-GPU</h2><div class="qe l"><h3 class="bd b gy z fp qc fr fs qd fu fw dk translated">媒体故事的源代码🚀创建和服务 TensorFlow 2 深度学习图像分类器作为 REST API 和…</h3></div><div class="qf l"><p class="bd b dl z fp qc fr fs qd fu fw dk translated">github.com</p></div></div><div class="qg l"><div class="qh l qi qj qk qg ql lc px"/></div></div></a></div></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="9bd3" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">太好了！感谢您的阅读！我渴望在第二部里见到你(即将上映)！</p><p id="069c" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">我希望我已经帮助你使用 TensorFlow 2.2 创建了一个深度学习图像分类器。在第二部分中，我们将把保存的模型公开为 REST API，稍后我们将对所有内容进行 dockerize！</p><p id="a174" class="pw-post-body-paragraph mk ml it mm b mn nd kd mp mq ne kg ms ly nf mu mv mc ng mx my mg nh na nb nc im bi translated">如果你喜欢这个故事，请考虑分享。那会有很大帮助。</p><h2 id="3f10" class="lp lq it bd lr ls lt dn lu lv lw dp lx ly lz ma mb mc md me mf mg mh mi mj iz bi translated">最后，我每天在 LinkedIn 上分享机器学习👉https://www.linkedin.com/in/hamed-zitoun/与我联系😊</h2></div></div>    
</body>
</html>