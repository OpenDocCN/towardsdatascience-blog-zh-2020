<html>
<head>
<title>Deploy Custom Object Detection using Flask &amp; Python, Step by Step</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">逐步使用 Flask &amp; Python 部署自定义对象检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/step-by-step-yolo-model-deployment-in-localhost-using-python-8537e93a1784?source=collection_archive---------2-----------------------#2020-09-03">https://towardsdatascience.com/step-by-step-yolo-model-deployment-in-localhost-using-python-8537e93a1784?source=collection_archive---------2-----------------------#2020-09-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9548" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">自定义对象检测本地主机部署</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/f0200f9ed0df4a6ee0e4d65b59d71d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5ESOLmxZT2sYvH24"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@emilep?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">埃米尔·佩龙</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ac7e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">你只看一次(YOLO)是一个最先进的，实时对象检测系统。最新版本是 YOLOV5。这些 YOLO 型号以速度著称。他们可以在几秒钟内检测到视频帧中的多个对象。与 EfficientDet 和 RetinaNet 等模型相比，YOLO 模型的推理时间更短。YOLO 以其检测图像/视频中物体的速度而闻名。如果您的使用案例更关注多个对象的实时检测，那么 YOLO 是最合适的。现在，我们有 YOLO V5，它的小型版本大约有<strong class="lc iu"> 476 FPS </strong>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="3f74" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在本文中，我将带您完成在 localhost 中部署您自己的定制 YOLO 模型的步骤。</p><blockquote class="md me mf"><p id="9d68" class="la lb mg lc b ld le ju lf lg lh jx li mh lk ll lm mi lo lp lq mj ls lt lu lv im bi translated">那我们开始吧</p></blockquote><p id="803b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这里，我将简要介绍所有其他步骤，因为我们的议程是部署模型并在我们的网站上使用它。</p><ol class=""><li id="22f1" class="mk ml it lc b ld le lg lh lj mm ln mn lr mo lv mp mq mr ms bi translated"><strong class="lc iu">抓取图像进行标注:</strong>这是第一步。在这里，你可以去谷歌搜索你想要定制的图片。或者，您可以四处查看并单击对象的照片，然后为模型收集这些照片。这是你的选择，你希望你的模型有多好。</li><li id="73ce" class="mk ml it lc b ld mt lg mu lj mv ln mw lr mx lv mp mq mr ms bi translated"><strong class="lc iu">给你的图片贴标签。</strong>为这一步提供大量数据，因为这对您的准确性至关重要。您可以使用任何工具来标注数据。没有自动标记自定义数据的方法。你必须手动操作。这是客体滞留中最令人沮丧也是最费时的部分，但是如果你把你的奉献给这一部分，你肯定会得到一个丰硕的成果。我使用了“LabelImg”工具进行标注。要了解更多关于“LabelImg”工具如何工作的信息，请阅读本文<a class="ae kz" href="https://medium.com/@pranjalAI/how-to-label-images-for-object-detection-step-by-step-7ee317f98583" rel="noopener">如何为对象检测标记图像</a>。</li><li id="3a10" class="mk ml it lc b ld mt lg mu lj mv ln mw lr mx lv mp mq mr ms bi translated"><strong class="lc iu">选择物体检测算法</strong>这里，我们将使用 YOLO-泰尼。并且，您可以在此处参考自定义对象检测代码。<a class="ae kz" href="https://github.com/pranjalAI/Yolo-tiny-insurance" rel="noopener ugc nofollow" target="_blank">https://github.com/pranjalAI/Yolo-tiny-insurance</a>还有许多其他方法用于对象检测，如 SSD、Yolo 等。</li><li id="49a3" class="mk ml it lc b ld mt lg mu lj mv ln mw lr mx lv mp mq mr ms bi translated">从第 3 步获得 Yolo 权重文件后，您需要转换 Yolo 生成的暗网模型。权重文件到 TensorFlow 服务，以便我们可以使用 TensorFlow 服务到我们的网页。</li></ol><p id="e890" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你已经到达这里。干杯！！你做得很好。您已经准备好将您的模型投入生产。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi my"><img src="../Images/905a681a551eea9ae75f1c1937f36add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oLzES3mTwu2shfpE"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">威尔·斯图尔特在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="c2cb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">皈依。重量文件是暗网格式到 TensorFlow 格式，你需要按照以下步骤。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><blockquote class="md me mf"><p id="9ce7" class="la lb mg lc b ld le ju lf lg lh jx li mh lk ll lm mi lo lp lq mj ls lt lu lv im bi translated"><strong class="lc iu">暗网转张量流</strong></p></blockquote><p id="b7a9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">克隆这个目录<a class="ae kz" href="https://github.com/pranjalAI/tensorflow-yolov4-tflite" rel="noopener ugc nofollow" target="_blank">https://github.com/pranjalAI/tensorflow-yolov4-tflite</a></p><p id="fc57" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">使用命令提示符进入目录。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mz"><img src="../Images/9a96fa18a797f4fa75973c7c8893f09c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p3nBbE2MfG_qHOWa"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@hishahadat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">沙哈达特·拉赫曼</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ed36" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，您需要安装一些依赖项/库。</p><blockquote class="md me mf"><p id="c6cf" class="la lb mg lc b ld le ju lf lg lh jx li mh lk ll lm mi lo lp lq mj ls lt lu lv im bi translated"><strong class="lc iu">安装库</strong></p></blockquote><p id="7aeb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您安装了 anaconda，那么您需要按照这个步骤在一个环境中安装所有需要的库。这将创造一个新的环境。环境名可以在。yml 文件。</p><pre class="kk kl km kn gt na nb nc nd aw ne bi"><span id="d1ed" class="nf ng it nb b gy nh ni l nj nk"># Tensorflow CPU<br/>conda env create -f conda-cpu.yml<br/>conda activate yolov4-cpu</span><span id="a36b" class="nf ng it nb b gy nl ni l nj nk"># Tensorflow GPU<br/>conda env create -f conda-gpu.yml<br/>conda activate yolov4-gpu</span></pre><p id="3164" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您没有安装 conda，那么请使用 pip 命令。我建议使用康达。</p><pre class="kk kl km kn gt na nb nc nd aw ne bi"><span id="2bc0" class="nf ng it nb b gy nh ni l nj nk"># TensorFlow CPU<br/>pip install -r requirements.txt</span><span id="b531" class="nf ng it nb b gy nl ni l nj nk"># TensorFlow GPU<br/>pip install -r requirements-gpu.txt</span></pre><p id="407a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">因此，创建了具有各自依赖性的新环境。现在，要使用新创建的环境，您需要激活它。(这一步是为那些正在使用康达创造环境的人准备的。)</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nm"><img src="../Images/74be70434368ef9c6f699940baf061d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DjSWjT75_sEeC_v_"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@claybanks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">粘土堤</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><blockquote class="md me mf"><p id="b697" class="la lb mg lc b ld le ju lf lg lh jx li mh lk ll lm mi lo lp lq mj ls lt lu lv im bi translated">激活环境</p></blockquote><blockquote class="nn"><p id="361e" class="no np it bd nq nr ns nt nu nv nw lv dk translated"><strong class="ak">康达激活 yolov4-gpu </strong></p></blockquote><p id="79d8" class="pw-post-body-paragraph la lb it lc b ld nx ju lf lg ny jx li lj nz ll lm ln oa lp lq lr ob lt lu lv im bi translated">这里“yolov4-gpu”是环境名。您可以在中更改它。yml 文件。(这一步是为那些正在使用康达创造环境的人准备的。)如果您正在使用 pip，则直接进行下一步。</p><p id="e346" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，如果您进入了刚刚克隆的文件夹，并且已经激活了环境，最后，您需要在克隆的文件夹中进行两项更改。</p><p id="e07f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">首先，复制并粘贴您的自定义。重量文件，你用你的 Yolo 模型训练，到'数据'文件夹，并复制和粘贴您的自定义。“数据/类/”文件夹中。</p><p id="9a19" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">其次，您需要对代码进行的唯一更改是在“core/config.py”文件的第 14 行。更新代码以指向您的自定义。名称文件如下所示。(我的习俗。names 文件称为 custom.names，但您的名称可能不同)</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oc"><img src="../Images/01e2c6674fd2ed826ed203b359ea0e01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2iQtbVu5nUbij-eAVJDGow.png"/></div></div></figure><p id="e99f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">注意:</strong>如果你使用的是预先训练好的 yolov4，那么确保第 14 行仍然是<strong class="lc iu"> coco.names </strong>。</p><p id="b3c7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">开始了。！现在，我们需要一个命令行来使代码 TensorFlow 兼容</p><div class="od oe gp gr of og"><a href="https://medium.com/better-programming/9-handy-python-functions-for-programmers-cc391a59acc7" rel="noopener follow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">程序员的 9 个方便的 Python 函数</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">根据我个人的脚本编写经验</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">medium.com</p></div></div><div class="op l"><div class="oq l or os ot op ou kt og"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="33db" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">python save_model.py - weights。/data/your _ weight _ file . weights-output。/check points/yolo-tiny-416-input _ size 416-型号 yolov4</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="ec8c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这里，416 是您在训练 yolo-tiny 时在配置文件中定义的图像大小。运行上述命令后，您将获得一个. pb 文件</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ov"><img src="../Images/dc52d10526fd28726a229a9ac9a4509c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i_R8o7ReO0drtVtE.png"/></div></div></figure><p id="ef3f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，您需要在检测对象时给出这个文件夹的位置。现在，喝杯茶。搜索您可以使用的任何 HTML 模板。我们可以在这里讨论一些 HTML 的东西，但是，我们将在下次做。这里，我假设您已经准备好了一个演示网页。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ow"><img src="../Images/2b86f2486a37410d2f9289a713b58a82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sxfz6KYHtdMp0DVk"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@kimdonkey?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">曼基·金</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><blockquote class="md me mf"><p id="798e" class="la lb mg lc b ld le ju lf lg lh jx li mh lk ll lm mi lo lp lq mj ls lt lu lv im bi translated"><strong class="lc iu">使用 flask 服务 TensorFlow 模型</strong></p></blockquote><p id="9dcf" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们有了 TensorFlow 服务模型。现在，我们需要使用 flask 将它提供给我们的网页。</p><p id="9b42" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，将这个最终的对象检测和裁剪代码粘贴到您获得 TensorFlow 服务模型的同一个根文件夹中(检查上面的步骤)。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="1d62" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，您的 flask 应用程序将调用它来检测图像。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ox oy l"/></div></figure><blockquote class="md me mf"><p id="4d6d" class="la lb mg lc b ld le ju lf lg lh jx li mh lk ll lm mi lo lp lq mj ls lt lu lv im bi translated"><strong class="lc iu">最终演示</strong></p></blockquote><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oz oy l"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">工作演示</p></figure><p id="c4de" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">所以，恭喜你！您刚刚使用 Flask 在本地主机上部署了第一个自定义对象检测模型。尝试使用您的自定义对象，并对您部署的自定义对象检测模型进行注释。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><blockquote class="md me mf"><p id="fd68" class="la lb mg lc b ld le ju lf lg lh jx li mh lk ll lm mi lo lp lq mj ls lt lu lv im bi translated"><em class="it">在你走之前……</em></p></blockquote><p id="8394" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你喜欢这篇文章，并且想继续关注更多关于<strong class="lc iu"> Python &amp;数据科学</strong>的<strong class="lc iu">精彩文章</strong>——请点击这里<a class="ae kz" href="https://pranjalai.medium.com/membership" rel="noopener">https://pranjalai.medium.com/membership</a>考虑成为一名中级会员。</p><p id="3d59" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">请考虑使用<a class="ae kz" href="https://pranjalai.medium.com/membership" rel="noopener">我的推荐链接</a>注册。通过这种方式，会员费的一部分归我，这激励我写更多关于 Python 和数据科学的令人兴奋的东西。</p><p id="9cdc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">还有，可以随时订阅我的免费简讯:<a class="ae kz" href="https://pranjalai.medium.com/subscribe" rel="noopener"> <strong class="lc iu"> Pranjal 的简讯</strong> </a>。</p></div></div>    
</body>
</html>