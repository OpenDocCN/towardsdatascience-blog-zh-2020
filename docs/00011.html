<html>
<head>
<title>Visualizing marginal effects using ggeffects in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在R中使用ggeffects可视化边缘效果</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-marginal-effects-using-ggeffects-in-r-4e7fb0569040?source=collection_archive---------10-----------------------#2020-01-01">https://towardsdatascience.com/visualizing-marginal-effects-using-ggeffects-in-r-4e7fb0569040?source=collection_archive---------10-----------------------#2020-01-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e303" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据集中关键变量边际效应的图解指南。</h2></div><p id="32f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个众所周知的困境:你知道你的变量X1影响你的变量Y，你可以在回归分析中显示出来，但很难用图形显示出来。原因是还有一个变量影响着Y，即X2，只有在考虑了X2的影响后，X1对Y的影响才显现出来。因此，你需要一种方法来显示X1如何影响Y，同时考虑X2的影响。</p><p id="2b90" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是边际效应派上用场的地方。它们使您能够显示感兴趣的自变量的变化如何影响因变量，同时将所有其他自变量考虑在内。更具体地说，您可以使用ggeffects包来可视化关键变量的边际效应。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="fc0d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的教程将使用base R中可用的sales数据集。它包含教授的薪水数据和其他几个会直观地影响他们薪水的变量。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/e812496796e9d41ee282997fe88fa9a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_l4C6JD1r3_JDBofZhH-pQ.jpeg"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">也许有人拿着他或她的薪水？亚历山大·密尔斯在<a class="ae mb" href="https://unsplash.com/s/photos/salary?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3233" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您只需输入以下命令就可以加载它。</p><pre class="lm ln lo lp gt mc md me mf aw mg bi"><span id="07b2" class="mh mi it md b gy mj mk l ml mm">df=Salaries</span></pre><p id="3b39" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们想回答这个数据集中的关键问题:教授的性别会影响他们的薪水吗？</p><p id="ed7c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">天真地，人们可以通过简单地运行下面的回归模型来尝试回答这个问题:</p><pre class="lm ln lo lp gt mc md me mf aw mg bi"><span id="dabe" class="mh mi it md b gy mj mk l ml mm">fit1=lm(salary~sex,df)<br/>summary(fit1)</span></pre><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi mn"><img src="../Images/8e8a783d892ff7cd79a818a2c60b5931.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bcP-311KppGZnf-o9EJHxw.png"/></div></div></figure><p id="0965" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">单看产量，似乎性别影响一个教授的工资。此外，当绘制性别对工资的影响时，这种影响似乎是显著的。</p><pre class="lm ln lo lp gt mc md me mf aw mg bi"><span id="9374" class="mh mi it md b gy mj mk l ml mm">#install and load ggplot<br/>install.packages("ggplot2")<br/>library(ggplot2)</span><span id="0164" class="mh mi it md b gy mo mk l ml mm">#plot the relationship<br/>ggplot(df,aes(y=salary, x=sex))+<br/>  stat_summary(fun.y="mean", geom="bar",position="dodge")+<br/>  stat_summary(fun.data = mean_se, geom = "errorbar", position="dodge",width=.8)+<br/>  labs(<br/>    x="Sex",<br/>    y="Salary",<br/>    title="The Effect of Sex on Salary"<br/>  )</span></pre><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/ef6deff19dba68579c9e0232aef04c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*5CxdlzihN1l8gUhEO6J3sQ.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">性别对工资的影响</p></figure><p id="184e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，问题是:是性别导致了这种差异，还是性别与更直接的薪水预测因素相关？这个问题在回归中很容易回答。一种方法是增加更多的协变量来检验是性别还是其他原因导致了这种差异。</p><pre class="lm ln lo lp gt mc md me mf aw mg bi"><span id="2eb1" class="mh mi it md b gy mj mk l ml mm">fit2=lm(salary~sex+yrs.since.phd+yrs.service+rank+discipline,df)<br/>summary(fit2)</span></pre><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi mq"><img src="../Images/b633e5ddc52869dace2116ace984df4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QIabY6xbDgst_K0x2yPqRQ.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">第二次回归的输出</p></figure><p id="be24" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如你所看到的，性别的边际效应现在是微不足道的，这意味着在这个数据集中，性别不是工资的实际预测因素，而是与数据集中的其他变量之一相关，这些变量可以概括为资历和学术学科的指标。</p><p id="bdc0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们知道性别不是工资的重要预测因素。但是如果我们要绘制性别和薪水之间的关系——如上图所示——看起来好像性别是一个实际的薪水预测因素。如果我们想在考虑所有其他协变量后，绘制性别对工资的实际影响——即绘制边际影响——会怎么样？这就是ggeffects发挥作用的地方。</p><p id="874b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们安装并加载ggeffects，如果我们还没有这样做的话。</p><pre class="lm ln lo lp gt mc md me mf aw mg bi"><span id="f05d" class="mh mi it md b gy mj mk l ml mm">install.packages("ggeffects")<br/>library(ggeffects)</span></pre><p id="aab8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们使用ggeffects包中的ggpredict函数，预测数据集中每个性别的边际效应。我们将输出保存为一个整洁的数据帧，命名为dummy。</p><pre class="lm ln lo lp gt mc md me mf aw mg bi"><span id="da8f" class="mh mi it md b gy mj mk l ml mm">dummy=ggpredict(fit2, terms = "sex")</span></pre><p id="e76a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们使用ggplot来绘制这些边际效应。</p><pre class="lm ln lo lp gt mc md me mf aw mg bi"><span id="407f" class="mh mi it md b gy mj mk l ml mm">ggplot(dummy, aes(x=x, y=predicted)) +<br/>  geom_bar(stat = "identity", position = position_dodge()) +<br/>  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), alpha = .9,position = position_dodge())+<br/>  labs(<br/>    x="Sex",<br/>    y="Salary",<br/>    title="The Marginal Effect of Sex on Salary"<br/>  )+scale_x_continuous(breaks=c(1,2) ,labels = c("Female", "Male"))</span></pre><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/9403ab53b7644def56825912b5ecb94a.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*aG3DQ6ul13vTM8oR3aYRbw.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">性别对工资的边际影响</p></figure><p id="a0d7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在控制了所有其他预测因素后，我们现在可以绘制出性别对工资的实际边际影响。</p><p id="64a3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">觉得这个故事有趣？<a class="ae mb" href="https://medium.com/@mattifuchs" rel="noopener">在Medium上关注我</a>看我的其他故事！</p></div></div>    
</body>
</html>