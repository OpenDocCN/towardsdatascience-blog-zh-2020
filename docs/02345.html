<html>
<head>
<title>Time Series Analysis — Handling Time Zones</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列分析-处理时区</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-analysis-handling-time-zones-b6fcb324c7b?source=collection_archive---------26-----------------------#2020-03-05">https://towardsdatascience.com/time-series-analysis-handling-time-zones-b6fcb324c7b?source=collection_archive---------26-----------------------#2020-03-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1de2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何处理熊猫的时区问题</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/78665d62d9d83bca011fae07831274ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3y1SZKM4CZotnwXD_C7Gog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.timeanddate.com/time/map/" rel="noopener ugc nofollow" target="_blank">图源</a></p></figure><p id="1922" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你坐过从东到西的长途飞机吗？如果你有，你知道那是什么感觉。假设飞机下午 1 点起飞，10 个小时到达目的地。飞机一着陆你就往外看。天还亮着，好像你只飞了一个小时。你查一下当地时间。现在才下午 3 点。这感觉像是你生命中最漫长的一天。</p><p id="c630" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于地球的形状和运动，地球上不同的部分同时从不同的角度接收阳光。当你在德国喝咖啡的时候，你在美国的朋友可能正准备睡觉。根据阳光调整时间是不可避免的，因为如果可能的话，我们希望白天有阳光，晚上睡觉。因此，出现了一个叫做“本地时间”的概念。也就是根据太阳光束的角度计算的时间。为了使用方便，地球被划分为不同的地区，这些地区被称为“时区”。有些国家的领土上只有一个时区，而有些国家却有多个时区。在这个时区的小介绍之后，让我们开始真正的话题。</p><p id="c404" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">在时间序列分析中我们如何处理时区？</strong></p><p id="c96c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列数据包括附加到连续时间戳的数据点。时间序列数据的来源是周期性的测量或观察。时间序列数据的分析对于许多行业中的关键任务是必不可少的。在这篇文章中，我将重点介绍时区，但是如果你想学习时间序列分析的基础知识，你可以从以下几点开始:</p><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/time-series-analysis-with-pandas-e6281a5fcda0"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">熊猫的时间序列分析</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">如何处理和操作时间序列数据</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="6a5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们生活在一个全球化的世界里。大公司通常希望在位于不同时区的许多不同国家开展业务。数据是公司的宝贵资产，需要正确分析。对于时间序列分析，忽略时区将是一个严重的错误。在这篇文章中，我将讲述时区的关键概念，以及如何在熊猫身上处理它们。</p><p id="2276" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从导入相关库开始:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="f6ff" class="ms mt it mo b gy mu mv l mw mx">import numpy as np<br/>import pandas as pd</span><span id="22de" class="ms mt it mo b gy my mv l mw mx">import datetime<br/>import dateutil<br/>import pytz</span></pre><p id="db2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们创建一个简单的时间序列数据:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="aff3" class="ms mt it mo b gy mu mv l mw mx">dates = pd.date_range('2019-01-01','2019-01-10')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/6f2cd5bb35f297399a17655862b605e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*Qy5KlYfqAbMgVvJ7SyLrhA.png"/></div></figure><p id="5c9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，熊猫的时间序列对象没有指定的时区:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="e038" class="ms mt it mo b gy mu mv l mw mx">#date_range object<br/>dates.tz is None<br/>True</span><span id="d034" class="ms mt it mo b gy my mv l mw mx">#Timestamp object<br/>date = pd.Timestamp('2019-01-01')<br/>date.tz is None<br/>True</span></pre><p id="917f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<strong class="lb iu"> tz_localize </strong>方法给这些对象分配一个时区:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="1d86" class="ms mt it mo b gy mu mv l mw mx">dates_lcz = dates.tz_localize('Europe/Berlin')</span><span id="d9cb" class="ms mt it mo b gy my mv l mw mx">dates_lcz.tz<br/>  &lt;DstTzInfo 'Europe/Berlin' LMT+0:53:00 STD&gt;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/1dec0959e687cc80facf16d949a2a5ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*k6fs89MClVKbLlwilbxKaA.png"/></div></figure><p id="b1d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> Pytz vs dateutil </strong></p><blockquote class="nb nc nd"><p id="4fe5" class="kz la ne lb b lc ld ju le lf lg jx lh nf lj lk ll ng ln lo lp nh lr ls lt lu im bi translated">注意:Pandas 通过标准库的<strong class="lb iu"> pytz </strong>和<strong class="lb iu"> dateutil </strong>库或<strong class="lb iu"> datetime.timezone </strong>对象支持时区。</p></blockquote><p id="300c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要分配时区，请执行以下操作:</p><ul class=""><li id="730c" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">传递 pytz 或 dateutil 时区对象，或者</li><li id="4ea5" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">传递奥尔森时区字符串</li></ul><p id="acb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">pytz 时区字符串的一个示例是“美国/太平洋”。dateutil 的相同时区字符串是“dateutil/US/Pasific”。您可以使用以下命令检查整个时区字符串列表:</p><ul class=""><li id="ec42" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">从 pytz 导入公共时区</li><li id="d626" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">从 pytz 导入所有时区</li></ul></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><p id="ddcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用关键字参数<strong class="lb iu"> tz </strong>创建一个带有时区的时间序列对象:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="f528" class="ms mt it mo b gy mu mv l mw mx">#using pytz<br/>date_pytz = pd.Timestamp('2019-01-01', tz = 'Europe/Berlin')<br/>date_pytz.tz<br/>    &lt;DstTzInfo 'Europe/Berlin' CET+1:00:00 STD&gt;</span><span id="b2bc" class="ms mt it mo b gy my mv l mw mx">#using dateutil<br/>date_util = pd.Timestamp('2019-01-01', tz = 'dateutil/Europe/Berlin')<br/>date_util.tz<br/>  tzfile('/usr/share/zoneinfo/Europe/Berlin')</span></pre><p id="23b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有时区的时间序列的数据类型是 datetime64[ns]。如果指定了时区，则数据类型变为 datetime64[ns，tz]:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="b822" class="ms mt it mo b gy mu mv l mw mx">dates = pd.date_range('2020-01-01', periods = 5, freq = 'D')</span><span id="d715" class="ms mt it mo b gy my mv l mw mx">dates_tz = pd.date_range('2020-01-01', periods = 5, freq = 'D', tz='US/Eastern')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/0d66343240ec9996098798f5bf2871a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*0EJ1OfTYOLW3vZBdAwjBcg.png"/></div></figure><p id="0f89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可能还需要将时间序列数据转换到不同的时区:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="ba9f" class="ms mt it mo b gy mu mv l mw mx">date_berlin = pd.Timestamp('2019-01-01', tz = 'Europe/Berlin')</span><span id="6762" class="ms mt it mo b gy my mv l mw mx">date_converted = date_berlin.tz_convert('US/Central')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/18c2f56f669dfb63c13de8c02d48531c.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*SwOy4nqTEqv6ZOaeb3M91A.png"/></div></figure></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><blockquote class="nb nc nd"><p id="6172" class="kz la ne lb b lc ld ju le lf lg jx lh nf lj lk ll ng ln lo lp nh lr ls lt lu im bi translated"><strong class="lb iu">注:世界协调时</strong></p><p id="c62a" class="kz la ne lb b lc ld ju le lf lg jx lh nf lj lk ll ng ln lo lp nh lr ls lt lu im bi translated">协调世界时(UTC)是一种时间标准，不同国家的当地时间根据 UTC 来描述。例如，马来西亚的当地时间是 UTC + 8。关于 Pandas 的时间序列分析，所有时间戳都存储在 UTC 下。当您转换时间戳对象的时区时，新对象有自己的日期和时间，但它被认为与原始对象相同。</p></blockquote><p id="4674" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过检查前面示例中的 date_berlin 和 date_converted 进行确认:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="c598" class="ms mt it mo b gy mu mv l mw mx">date_berlin == date_converted<br/>True</span></pre></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><p id="7aee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">删除时区信息</strong></p><p id="cd0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用<strong class="lb iu"> tz_localize(None) </strong>或<strong class="lb iu"> tz_convert(None) </strong>删除时区信息:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="1ff9" class="ms mt it mo b gy mu mv l mw mx">date = pd.Timestamp('2020-02-01', tz='US/Eastern')</span><span id="8ec3" class="ms mt it mo b gy my mv l mw mx">date<br/>  Timestamp('2020-02-01 00:00:00-0500', tz='US/Eastern')</span><span id="0821" class="ms mt it mo b gy my mv l mw mx">date.tz_localize(None)<br/>  Timestamp('2020-02-01 00:00:00')</span></pre><p id="15a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要减去时间戳，它们必须在同一个时区或不在同一个时区:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="9615" class="ms mt it mo b gy mu mv l mw mx">date1 = pd.Timestamp('2020-02-01 15:00', tz='US/Eastern')</span><span id="d663" class="ms mt it mo b gy my mv l mw mx">date2 = pd.Timestamp('2020-02-01 09:00', tz='US/Pacific')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/ad91e7685b83a92ef4d7513259b7ee46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8EIlmemgy7W7DPLE80L4ew.png"/></div></div></figure><p id="fbf4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以去掉时区，做减法:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="e3a8" class="ms mt it mo b gy mu mv l mw mx">date1.tz_localize(None) - date2.tz_localize(None)</span><span id="eb08" class="ms mt it mo b gy my mv l mw mx">Timedelta('0 days 06:00:00')</span></pre></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><p id="3922" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><p id="3f56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想了解更多关于熊猫的时间序列，你可以随时在熊猫官方网站上查看<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html" rel="noopener ugc nofollow" target="_blank">用户指南</a>。</p></div></div>    
</body>
</html>