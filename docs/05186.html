<html>
<head>
<title>Designing an energy arbitrage strategy with linear programming</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用线性规划设计能源套利策略</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/designing-an-energy-arbitrage-strategy-with-linear-programming-f60734fe9888?source=collection_archive---------43-----------------------#2020-05-03">https://towardsdatascience.com/designing-an-energy-arbitrage-strategy-with-linear-programming-f60734fe9888?source=collection_archive---------43-----------------------#2020-05-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b2aa" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何利用 Python 中的真实数据和开源工具(包括 PuLP 和 pandas ),使用经典的数学优化技术来指导并网电池的运行并实现利润最大化。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9e1fbd83ca9849acb8d2d3d2502ffee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NBLemnrKe2PB6inG.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">电力线，照片由 Pexels 的 Pok Rie 拍摄</p></figure><p id="bc34" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">能源的价格每小时都在变化，这为时间套利提供了可能性:低价购买能源，储存起来，然后以更高的价格出售。要成功执行任何时间套利策略，需要对未来价格有一定的信心，才能期望获利。在能量套利的情况下，还必须考虑能量存储系统的约束。例如，电池具有有限的容量、有限的充电速率，并且不是 100%有效的，因为不是所有用于对电池充电的能量都可以在以后用于放电。</p><p id="ab25" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文的目的是说明在已知未来价格的假设下，如何使用线性规划的数学优化技术，在给定一组操作约束的情况下，为并网电池设计操作策略。所有这些都将使用真实世界的能源价格数据和 Python 中的开源工具来完成。Jupyter 笔记本可在此处获得<a class="ae lr" href="https://github.com/klostest/energy_arbitrage_work_sample/blob/master/Energy%20arbitrage.ipynb" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="d599" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">问题和方法</h1><p id="4c4d" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">任务是为并网电池系统制定运营策略，在纽约独立系统运营商(NYISO)日前市场进行能源套利。什么是尼索？根据他们的<a class="ae lr" href="https://www.nyiso.com/what-we-do" rel="noopener ugc nofollow" target="_blank">网站</a>，</p><blockquote class="mp mq mr"><p id="3b4d" class="kv kw ms kx b ky kz jr la lb lc ju ld mt lf lg lh mu lj lk ll mv ln lo lp lq ij bi translated"><em class="iq">ny iso 是纽约独立系统运营商，负责管理纽约电网及其竞争激烈的电力批发市场。</em></p></blockquote><p id="aafe" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">纽约国际标准化组织每天上午 11 点公布第二天的每小时能源价格(纽约 ISO 2019，参考资料见下页)。我们在这里设计的电池系统将利用这些信息安排接下来 24 小时的电池工作(当天中午到第二天上午 11 点)。我们将假设在 NYISO 发布每日价格公告后，接下来 36 小时的价格信息是可用的:当天剩余 12 小时的价格，以及第二天 24 小时的价格。因此，优化时间范围将是 36 小时，以利用所有可用的未来价格信息。</p><p id="91e7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于每天都会重复运行时间表，因此 36 小时策略的最后 12 小时将始终被忽略。这是因为新的价格信息将在第二天上午 11 点提供，我们可以利用这一点。然而，这些“额外的 12 小时”的数据并没有被浪费；我在最初的实验中确定，36 小时的时间范围比更短的时间范围更有利可图。这具有直观的意义，因为我们能够纳入套利策略的未来信息越多，就应该越有利可图。您可以使用下面的代码尝试不同的时间范围，尽管这里假设时间范围至少为 24 小时。该计划可以想象如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/bac6d99c38c974af9e247296d435aaa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/0*2PbLrlCNuCQIjziP.png"/></div></figure><p id="6d59" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">电池被称为价格接受者，这意味着它的活动不会影响能源的价格。为电池充电而支付的电力价格和放电收入是基于位置的边际价格(LBMP)，它考虑了系统边际价格、阻塞部分和边际损耗部分(PJM 互联有限责任公司)。目标是在给定日前价格和电池系统参数的情况下，实现利润最大化。</p><p id="52e1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这种情况下，未来价格已知，电池系统是价格接受者，设计运营策略的问题可以通过线性规划来解决(Salles et al. 2017，Sioshansi et al. 2009，Wang and Zhang 2018)。简而言之，<a class="ae lr" href="https://en.wikipedia.org/wiki/Linear_programming" rel="noopener ugc nofollow" target="_blank">线性规划</a>是一种众所周知的技术，用于最大化或最小化某些目标。在这种情况下，我们希望利润最大化。只要描述目标的数学函数，即所谓的<strong class="kx ir">目标函数</strong>，以及系统的<strong class="kx ir">约束</strong>，都可以描述为定义操作策略的<strong class="kx ir">决策变量</strong>的线性组合，就可以使用线性规划来优化系统。</p><h1 id="e480" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">纸浆中线性规划问题的建立</h1><p id="ce72" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">大致遵循 Sioshansi 等人(2009 年)的符号，这里我们将列出决策变量，并将约束添加到 PuLP 中的线性规划模型。从下一个单元格中的类定义开始，本节中的 markdown 代码片段应该放在一起定义一个类，该类描述了我们的电池系统(请参见<a class="ae lr" href="https://github.com/klostest/energy_arbitrage_work_sample/blob/master/Energy%20arbitrage.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>进行确认)。这种系统模型将有助于模拟电池的运行，以每天一次的增量逐步通过时间。</p><p id="934b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在继续之前，让我们导入本练习所需的包。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="401d" class="nc lt iq my b gy nd ne l nf ng"><em class="ms">#Load packages<br/></em>import pulp<br/>import os<br/>import numpy <strong class="my ir">as</strong> np<br/>import pandas <strong class="my ir">as</strong> pd<br/>import matplotlib <strong class="my ir">as</strong> mpl<br/>import matplotlib.pyplot <strong class="my ir">as</strong> plt<br/>import time<br/><strong class="my ir">%</strong>matplotlib inline</span></pre><p id="cc20" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">每天，在上午 11 点到下午 12 点之间需要解决一个优化问题，这将提供足够的信息来指导电池在接下来的 36 个小时内的运行。为了指导电池的运行，我们需要确定时间范围内每个离散时间步长的能量流。能量流，也称为电能，可以流入或流出电池。因此，我们将在时间<em class="ms"> t </em>创建两个决策变量，<em class="ms"> c_t </em>和<em class="ms"> d_t，</em>分别作为充电和放电功率流(kW)，这将是一个小时的时间步长。对于所有时间步长，充电或放电速率是连续变量，并且被限制在电池的工作极限内:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/c262a0b2e67414accbeb355408d21832.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*OZJ3YX6MUxdnlpkf4PYPHQ.png"/></div></div></figure><p id="0e4f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">其中<em class="ms"> κ </em> (kW)是最大充电和放电功率容量，这里我们假设它们相等。</p><p id="a562" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要在优化的时间范围内为每个时间步长指定流量变量。PuLP 提供了一个<code class="fe ni nj nk my b">LpVariable</code>类的便捷方法<code class="fe ni nj nk my b">dicts</code>，我们可以用它来一次为所有时间步骤创建充电和放电流。我们将开始定义一个类来保存管理电池运行的所有信息。输入<code class="fe ni nj nk my b">time_horizon</code>是一个整数，指定优化范围内的小时数，这里假设至少为 24，其他输入如上所述:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="36a6" class="nc lt iq my b gy nd ne l nf ng"><strong class="my ir">class</strong> <strong class="my ir">Battery</strong>():<br/>    <br/>    <strong class="my ir">def</strong> <strong class="my ir">__init__</strong>(self,<br/>                 time_horizon,<br/>                 max_discharge_power_capacity,<br/>                 max_charge_power_capacity):<br/>        <em class="ms">#Set up decision variables for optimization.<br/></em>        <em class="ms">#These are the hourly charge and discharge flows for<br/></em>        <em class="ms">#the optimization horizon, with their limitations.<br/></em>        self<strong class="my ir">.</strong>time_horizon <strong class="my ir">=</strong> time_horizon<br/>    <br/>        self<strong class="my ir">.</strong>charge <strong class="my ir">=</strong> \<br/>        pulp<strong class="my ir">.</strong>LpVariable<strong class="my ir">.</strong>dicts(<br/>            "charging_power",<br/>            ('c_t_' <strong class="my ir">+</strong> str(i) <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(0,time_horizon)),<br/>            lowBound<strong class="my ir">=</strong>0, upBound<strong class="my ir">=</strong>max_charge_power_capacity,<br/>            cat<strong class="my ir">=</strong>'Continuous')<br/><br/>        self<strong class="my ir">.</strong>discharge <strong class="my ir">=</strong> \<br/>        pulp<strong class="my ir">.</strong>LpVariable<strong class="my ir">.</strong>dicts(<br/>            "discharging_power",<br/>            ('d_t_' <strong class="my ir">+</strong> str(i) <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(0,time_horizon)),<br/>            lowBound<strong class="my ir">=</strong>0, upBound<strong class="my ir">=</strong>max_discharge_power_capacity,<br/>            cat<strong class="my ir">=</strong>'Continuous')</span></pre><p id="9bcf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">设置好所有的决策变量后，就该定义纸浆将为我们解决的优化问题了。我们的目标是在优化时间范围内最大化利润<em class="ms"> P </em>,可使用电荷流和能源价格定义如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/e1d762e48c019c9b065b1ace310f9102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IHAR31VgL7yCDkoMmHg6Gw.png"/></div></div></figure><p id="379a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">其中<em class="ms"> p_t </em>是时间<em class="ms"> t </em>时的 LBMP ($/MWh)。就单位而言，因为<em class="ms"> t </em>是一个小时时间步长，它有效地取消了 LBMP 单位的每小时部分。目标函数除以 1000 以说明单位(MW/kW)的差异，因此最终利润的目标将以美元为单位。我们将在运行模拟后进行这个单元修正，所以它不会反映在这里的代码中。</p><p id="ec15" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">目标函数是通过将决策变量添加到纸浆中的模型对象来指定的，将每个决策变量乘以适当的成本或收入，该成本或收入将来自充入或释放该量的能量。决策变量与价格的相乘是使用<code class="fe ni nj nk my b">LpAffineExpression</code>完成的。<code class="fe ni nj nk my b">prices</code>由 LBMP 决定，我们将在运行模拟时选择相关的时间段。例如，对于 36 小时的时间范围，这将是当天中午到第二天晚上 11 点。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="6634" class="nc lt iq my b gy nd ne l nf ng"><strong class="my ir">    def</strong> <strong class="my ir">set_objective</strong>(self, prices):<br/>        <em class="ms">#Create a model and objective function.<br/></em>        <em class="ms">#This uses price data, which must have one price<br/></em>        <em class="ms">#for each point in the time horizon.<br/></em>        <strong class="my ir">try</strong>:<br/>            <strong class="my ir">assert</strong> len(prices) <strong class="my ir">==</strong> self<strong class="my ir">.</strong>time_horizon<br/>        <strong class="my ir">except</strong>:<br/>            <strong class="my ir">print</strong>('Error: need one price for each hour in time horizon')<br/>        <br/>        <em class="ms">#Instantiate linear programming model to maximize the objective<br/></em>        self<strong class="my ir">.</strong>model <strong class="my ir">=</strong> pulp<strong class="my ir">.</strong>LpProblem("Energy arbitrage", pulp<strong class="my ir">.</strong>LpMaximize)<br/>    <br/>        <em class="ms">#Objective is profit<br/></em>        <em class="ms">#This formula gives the daily profit from charging/discharging<br/></em>        <em class="ms">#activities. Charging is a cost, discharging is a revenue<br/></em>        self<strong class="my ir">.</strong>model <strong class="my ir">+=</strong> \<br/>        pulp<strong class="my ir">.</strong>LpAffineExpression(<br/>            [(self<strong class="my ir">.</strong>charge['c_t_' <strong class="my ir">+</strong> str(i)],<br/>              <strong class="my ir">-</strong>1<strong class="my ir">*</strong>prices[i]) <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(0,self<strong class="my ir">.</strong>time_horizon)]) <strong class="my ir">+</strong>\<br/>        pulp<strong class="my ir">.</strong>LpAffineExpression(<br/>            [(self<strong class="my ir">.</strong>discharge['d_t_' <strong class="my ir">+</strong> str(i)],<br/>              prices[i]) <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(0,self<strong class="my ir">.</strong>time_horizon)])</span></pre><p id="998a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">已经定义了模型和目标，现在我们需要添加电池的操作约束。电池容量有限，因此优化受电池存储限制:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/55145792ac5959e95ffcc8e3add44866.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*fBUpx2nCoXn3R9FptHkYgw.png"/></div></div></figure><p id="024a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">其中<em class="ms"> t_f </em> =从当天下午 1 点到第二天晚上 11 点的每个小时，<em class="ms"> s_i </em>是 36 小时优化期开始时电池的能量状态(kWh)<em class="ms">η</em>是电池的往返效率。该约束要求电池的能量状态(初始状态和每小时功率流的总和)在零(假设电池具有完全深度的放电能力)和电池在优化范围内每小时的放电能量容量之间。在此约束条件下，功率流(kW)被理解为通过乘以一小时时间步长转换为能量单位(kWh)。</p><p id="55d4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在 PuLP 中，约束可以像目标函数一样添加到模型中:使用加法语法。我们可以通过使用<code class="fe ni nj nk my b">lpSum</code>将放电流量相加来表达这些约束，如果充电流量需要乘以效率，则再次使用<code class="fe ni nj nk my b">LpAffineExpression</code>。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="9224" class="nc lt iq my b gy nd ne l nf ng"><strong class="my ir">    def</strong> <strong class="my ir">add_storage_constraints</strong>(self,<br/>                                efficiency,<br/>                                min_capacity,<br/>                                discharge_energy_capacity,<br/>                                initial_level):<br/>        <em class="ms">#Storage level constraint 1<br/></em>        <em class="ms">#This says the battery cannot have less than zero energy, at<br/></em>        <em class="ms">#any hour in the horizon<br/></em>        <em class="ms">#Note this is a place where round-trip efficiency is factored in.<br/></em>        <em class="ms">#The energy available for discharge is the round-trip efficiency<br/></em>        <em class="ms">#times the energy that was charged.       <br/></em>        <strong class="my ir">for</strong> hour_of_sim <strong class="my ir">in</strong> range(1,self<strong class="my ir">.</strong>time_horizon<strong class="my ir">+</strong>1):     <br/>            self<strong class="my ir">.</strong>model <strong class="my ir">+=</strong> \<br/>            initial_level \<br/>            <strong class="my ir">+</strong> pulp<strong class="my ir">.</strong>LpAffineExpression(<br/>                [(self<strong class="my ir">.</strong>charge['c_t_' <strong class="my ir">+</strong> str(i)], efficiency)<br/>                 <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(0,hour_of_sim)]) \<br/>            <strong class="my ir">-</strong> pulp<strong class="my ir">.</strong>lpSum(<br/>                self<strong class="my ir">.</strong>discharge[index]<br/>                <strong class="my ir">for</strong> index <strong class="my ir">in</strong>('d_t_' <strong class="my ir">+</strong> str(i)<br/>                             <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(0,hour_of_sim)))\<br/>            <strong class="my ir">&gt;=</strong> min_capacity<br/>            <br/>        <em class="ms">#Storage level constraint 2<br/></em>        <em class="ms">#Similar to 1<br/></em>        <em class="ms">#This says the battery cannot have more than the<br/></em>        <em class="ms">#discharge energy capacity<br/></em>        <strong class="my ir">for</strong> hour_of_sim <strong class="my ir">in</strong> range(1,self<strong class="my ir">.</strong>time_horizon<strong class="my ir">+</strong>1):<br/>            self<strong class="my ir">.</strong>model <strong class="my ir">+=</strong> \<br/>            initial_level \<br/>            <strong class="my ir">+</strong> pulp<strong class="my ir">.</strong>LpAffineExpression(<br/>                [(self<strong class="my ir">.</strong>charge['c_t_' <strong class="my ir">+</strong> str(i)], efficiency)<br/>                 <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(0,hour_of_sim)]) \<br/>            <strong class="my ir">-</strong> pulp<strong class="my ir">.</strong>lpSum(<br/>                self<strong class="my ir">.</strong>discharge[index]<br/>                <strong class="my ir">for</strong> index <strong class="my ir">in</strong> ('d_t_' <strong class="my ir">+</strong> str(i)<br/>                              <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(0,hour_of_sim)))\<br/>            <strong class="my ir">&lt;=</strong> discharge_energy_capacity</span></pre><p id="56ea" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最大日放电吞吐量<em class="ms"> τ </em> (kWh)也受到限制，这限制了在给定的一天内可以流过电池的能量。我们对此进行了设置，以便时间范围的第一天受 24 小时约束，而超出该时间范围的任何部分都受部分约束。例如，在我们的 36 小时范围内，约束条件是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/0d81fecee0bc82b592fea66671aa5eae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*n8PO_bpQUCZJlUIij9sG7w.png"/></div></figure><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="37db" class="nc lt iq my b gy nd ne l nf ng"><strong class="my ir">    def</strong> <strong class="my ir">add_throughput_constraints</strong>(self,<br/>                                   max_daily_discharged_throughput):<br/>        <em class="ms">#Maximum discharge throughput constraint<br/></em>        <em class="ms">#The sum of all discharge flow within a day cannot exceed this<br/></em>        <em class="ms">#Include portion of the next day according to time horizon<br/></em>        <em class="ms">#Assumes the time horizon is at least 24 hours<br/></em>        <br/>        self<strong class="my ir">.</strong>model <strong class="my ir">+=</strong> \<br/>        pulp<strong class="my ir">.</strong>lpSum(<br/>            self<strong class="my ir">.</strong>discharge[index] <strong class="my ir">for</strong> index <strong class="my ir">in</strong> (<br/>                'd_t_' <strong class="my ir">+</strong> str(i) <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(0,24))) \<br/>        <strong class="my ir">&lt;=</strong> max_daily_discharged_throughput<br/>        <br/>        self<strong class="my ir">.</strong>model <strong class="my ir">+=</strong> \<br/>        pulp<strong class="my ir">.</strong>lpSum(<br/>            self<strong class="my ir">.</strong>discharge[index] <strong class="my ir">for</strong> index <strong class="my ir">in</strong> (<br/>                'd_t_' <strong class="my ir">+</strong> str(i) <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(25,self<strong class="my ir">.</strong>time_horizon))) \<br/>        <strong class="my ir">&lt;=</strong> max_daily_discharged_throughput \<br/>        <strong class="my ir">*</strong>float(self<strong class="my ir">.</strong>time_horizon<strong class="my ir">-</strong>24)<strong class="my ir">/</strong>24</span></pre><p id="da3d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">既然我们已经建立了具有目标函数和所有约束的模型，我们包括解决问题的方法，并报告结果，即在时间范围内每小时的最佳充电和放电流量。只要我们提出的问题在我们指出的约束条件下是可行的，线性规划就应该工作，因为它会找到一个最优解，使利润最大化。然而，如果没有，我们将返回一条消息指出这一点。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="f847" class="nc lt iq my b gy nd ne l nf ng"><strong class="my ir">    def</strong> <strong class="my ir">solve_model</strong>(self):<br/>        <em class="ms">#Solve the optimization problem<br/></em>        self<strong class="my ir">.</strong>model<strong class="my ir">.</strong>solve()<br/>        <br/>        <em class="ms">#Show a warning if an optimal solution was not found<br/></em>        <strong class="my ir">if</strong> pulp<strong class="my ir">.</strong>LpStatus[self<strong class="my ir">.</strong>model<strong class="my ir">.</strong>status] <strong class="my ir">!=</strong> 'Optimal':<br/>            <strong class="my ir">print</strong>('Warning: ' <strong class="my ir">+</strong> pulp<strong class="my ir">.</strong>LpStatus[self<strong class="my ir">.</strong>model<strong class="my ir">.</strong>status])<br/>            <br/>    <strong class="my ir">def</strong> <strong class="my ir">collect_output</strong>(self):  <br/>        <em class="ms">#Collect hourly charging and discharging rates within the<br/></em>        <em class="ms">#time horizon<br/></em>        hourly_charges <strong class="my ir">=</strong>\<br/>            np<strong class="my ir">.</strong>array(<br/>                [self<strong class="my ir">.</strong>charge[index]<strong class="my ir">.</strong>varValue <strong class="my ir">for</strong><br/>                 index <strong class="my ir">in</strong> ('c_t_' <strong class="my ir">+</strong> str(i) <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(0,24))])<br/>        hourly_discharges <strong class="my ir">=</strong>\<br/>            np<strong class="my ir">.</strong>array(<br/>                [self<strong class="my ir">.</strong>discharge[index]<strong class="my ir">.</strong>varValue <strong class="my ir">for</strong><br/>                 index <strong class="my ir">in</strong> ('d_t_' <strong class="my ir">+</strong> str(i) <strong class="my ir">for</strong> i <strong class="my ir">in</strong> range(0,24))])<br/><br/>        <strong class="my ir">return</strong> hourly_charges, hourly_discharges</span></pre><p id="0c88" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就完成了<code class="fe ni nj nk my b">Battery</code>课。我们现在准备接收数据，并继续模拟电池工作。</p><h1 id="26bc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">导入价格数据</h1><p id="6185" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">我们获得了一年的 LBMPs 值，因此我们可以模拟电池在这段时间内的运行情况。这些数据可作为几个区域的 LBMPs，以每小时为时间步长。这里我们加载 CSV 文件(每天一个)并将它们连接到一个<code class="fe ni nj nk my b">DataFrame</code>。您可以从这篇博文附带的<a class="ae lr" href="https://github.com/klostest/energy_arbitrage_work_sample" rel="noopener ugc nofollow" target="_blank"> git repo </a>中获得这些数据。数据于 2020 年 5 月 2 日从<a class="ae lr" href="http://mis.nyiso.com/public/" rel="noopener ugc nofollow" target="_blank">这里</a>下载，作为 CSV 文件的压缩目录(定价数据、LBMP 日前市场(DAM)、区域 P-2A)。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="2717" class="nc lt iq my b gy nd ne l nf ng"><em class="ms">#Directory of data<br/></em>data_dir <strong class="my ir">=</strong> './data_2019_2020_from_web/'</span><span id="764d" class="nc lt iq my b gy no ne l nf ng">dir_list <strong class="my ir">=</strong> os<strong class="my ir">.</strong>listdir(data_dir)<br/>dir_list<strong class="my ir">.</strong>sort()<br/>dir_list</span><span id="d27f" class="nc lt iq my b gy no ne l nf ng">['.DS_Store',<br/> '20190501damlbmp_zone_csv',<br/> '20190601damlbmp_zone_csv',<br/> '20190701damlbmp_zone_csv',<br/> '20190801damlbmp_zone_csv',<br/> '20190901damlbmp_zone_csv',<br/> '20191001damlbmp_zone_csv',<br/> '20191101damlbmp_zone_csv',<br/> '20191201damlbmp_zone_csv',<br/> '20200101damlbmp_zone_csv',<br/> '20200201damlbmp_zone_csv',<br/> '20200301damlbmp_zone_csv',<br/> '20200401damlbmp_zone_csv']</span><span id="60b2" class="nc lt iq my b gy no ne l nf ng"><em class="ms">#Remove invisible files (i.e. .DS_Store used by Mac OS)<br/></em><strong class="my ir">for</strong> this_item <strong class="my ir">in</strong> dir_list:<br/>    <strong class="my ir">if</strong> this_item[0] <strong class="my ir">==</strong> '.':<br/>        dir_list<strong class="my ir">.</strong>remove(this_item)</span></pre><p id="5aa8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">遍历所有子目录，加载所有 CSV 文件。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="d45c" class="nc lt iq my b gy nd ne l nf ng">tic <strong class="my ir">=</strong> time<strong class="my ir">.</strong>time()<br/><em class="ms">#count loaded files<br/></em>file_counter <strong class="my ir">=</strong> 0<br/><br/><em class="ms">#For each subdirectory in the parent directory<br/></em><strong class="my ir">for</strong> this_sub_dir <strong class="my ir">in</strong> dir_list:<br/>    <em class="ms">#List the files<br/></em>    this_sub_dir_list <strong class="my ir">=</strong> os<strong class="my ir">.</strong>listdir(data_dir <strong class="my ir">+</strong> '/' <strong class="my ir">+</strong> this_sub_dir)<br/>    <em class="ms">#Sort the list<br/></em>    this_sub_dir_list<strong class="my ir">.</strong>sort()<br/>    <em class="ms">#Delete invisible files (that start with '.')<br/></em>    <strong class="my ir">for</strong> this_item <strong class="my ir">in</strong> this_sub_dir_list:<br/>        <strong class="my ir">if</strong> this_item[0] <strong class="my ir">==</strong> '.':<br/>            this_sub_dir_list<strong class="my ir">.</strong>remove(this_item)<br/>    <em class="ms">#For each file in the subdirectory<br/></em>    <strong class="my ir">for</strong> this_file <strong class="my ir">in</strong> this_sub_dir_list:<br/>        <em class="ms">#Load the contents into a DataFrame<br/></em>        this_df <strong class="my ir">=</strong> pd<strong class="my ir">.</strong>read_csv(data_dir <strong class="my ir">+</strong> '/' <strong class="my ir">+</strong> this_sub_dir <strong class="my ir">+</strong> '/' <strong class="my ir">+</strong> this_file)<br/>        <em class="ms">#Concatenate with existing data if past first file<br/></em>        <strong class="my ir">if</strong> file_counter <strong class="my ir">==</strong> 0:<br/>            all_data <strong class="my ir">=</strong> this_df<strong class="my ir">.</strong>copy()<br/>        <strong class="my ir">else</strong>:<br/>            all_data <strong class="my ir">=</strong> pd<strong class="my ir">.</strong>concat([all_data, this_df])<br/>        <br/>        file_counter <strong class="my ir">+=</strong> 1<br/>toc <strong class="my ir">=</strong> time<strong class="my ir">.</strong>time()<br/><strong class="my ir">print</strong>(str(toc<strong class="my ir">-</strong>tic) <strong class="my ir">+</strong> ' seconds run time')</span><span id="ec40" class="nc lt iq my b gy no ne l nf ng">2.1731250286102295 seconds run time</span></pre><p id="9537" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">检查数据</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="3ede" class="nc lt iq my b gy nd ne l nf ng">all_data<strong class="my ir">.</strong>info()</span><span id="f963" class="nc lt iq my b gy no ne l nf ng">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>Int64Index: 131760 entries, 0 to 359<br/>Data columns (total 6 columns):<br/> #   Column                             Non-Null Count   Dtype  <br/>---  ------                             --------------   -----  <br/> 0   Time Stamp                         131760 non-null  object <br/> 1   Name                               131760 non-null  object <br/> 2   PTID                               131760 non-null  int64  <br/> 3   LBMP ($/MWHr)                      131760 non-null  float64<br/> 4   Marginal Cost Losses ($/MWHr)      131760 non-null  float64<br/> 5   Marginal Cost Congestion ($/MWHr)  131760 non-null  float64<br/>dtypes: float64(3), int64(1), object(2)<br/>memory usage: 7.0+ MB</span><span id="3cb4" class="nc lt iq my b gy no ne l nf ng">all_data<strong class="my ir">.</strong>head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/40775f3cae165931d79f8752288e46ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U38tQiYf5hsAU0p0icRnWg.png"/></div></div></figure><p id="a3ed" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对数据进行健全性检查。考虑到我们有 12 个月的数据，包括闰年的 2 月 29 日，是否加载了 366 天的数据？</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="df18" class="nc lt iq my b gy nd ne l nf ng"><strong class="my ir">assert</strong> file_counter <strong class="my ir">==</strong> 366</span></pre><p id="686a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有多少个区域，它们是什么？</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="05db" class="nc lt iq my b gy nd ne l nf ng">unique_names <strong class="my ir">=</strong> all_data['Name']<strong class="my ir">.</strong>unique()<br/><strong class="my ir">print</strong>(len(unique_names))<br/>unique_names</span><span id="aa64" class="nc lt iq my b gy no ne l nf ng">15<br/><br/>array(['CAPITL', 'CENTRL', 'DUNWOD', 'GENESE', 'H Q', 'HUD VL', 'LONGIL',<br/>       'MHK VL', 'MILLWD', 'N.Y.C.', 'NORTH', 'NPX', 'O H', 'PJM', 'WEST'],<br/>      dtype=object)</span></pre><p id="5d47" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有多少排？</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="bdd5" class="nc lt iq my b gy nd ne l nf ng">all_data<strong class="my ir">.</strong>shape</span><span id="609e" class="nc lt iq my b gy no ne l nf ng">(131760, 6)</span></pre><p id="a885" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">检查行数=区域数乘以一天 24 小时乘以一年 366 天:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="ffff" class="nc lt iq my b gy nd ne l nf ng"><strong class="my ir">assert</strong> 15<strong class="my ir">*</strong>24<strong class="my ir">*</strong>366 <strong class="my ir">==</strong> all_data<strong class="my ir">.</strong>shape[0]</span></pre><p id="d90d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于这个例子，我们只关心纽约市。选择感兴趣的数据(特定区域):</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="bb87" class="nc lt iq my b gy nd ne l nf ng">zone_of_interest <strong class="my ir">=</strong> 'N.Y.C.'<br/>all_data <strong class="my ir">=</strong> all_data<strong class="my ir">.</strong>loc[all_data['Name']<strong class="my ir">.</strong>isin([zone_of_interest]),:]</span><span id="3d10" class="nc lt iq my b gy no ne l nf ng">all_data<strong class="my ir">.</strong>shape</span><span id="4f09" class="nc lt iq my b gy no ne l nf ng">(8784, 6)</span></pre><p id="2137" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有了<code class="fe ni nj nk my b">DatetimeIndex</code>，<code class="fe ni nj nk my b">DataFrame</code>会更容易使用。将索引重置为时间戳:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="fe38" class="nc lt iq my b gy nd ne l nf ng">all_data <strong class="my ir">=</strong> all_data<strong class="my ir">.</strong>set_index(['Time Stamp'])</span></pre><p id="3e60" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">扮成<code class="fe ni nj nk my b">datetime</code>:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="e3f9" class="nc lt iq my b gy nd ne l nf ng">all_data<strong class="my ir">.</strong>index <strong class="my ir">=</strong> pd<strong class="my ir">.</strong>to_datetime(all_data<strong class="my ir">.</strong>index, format<strong class="my ir">=</strong>'%m/%d/%Y %H:%M')</span></pre><p id="4f69" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们看看夏令时前后的数据:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="2c63" class="nc lt iq my b gy nd ne l nf ng">start_time <strong class="my ir">=</strong> pd<strong class="my ir">.</strong>Timestamp(year<strong class="my ir">=</strong>2019, month<strong class="my ir">=</strong>11, day<strong class="my ir">=</strong>2, hour<strong class="my ir">=</strong>23)<br/>end_time <strong class="my ir">=</strong> pd<strong class="my ir">.</strong>Timestamp(year<strong class="my ir">=</strong>2019, month<strong class="my ir">=</strong>11, day<strong class="my ir">=</strong>3, hour<strong class="my ir">=</strong>3)</span><span id="301b" class="nc lt iq my b gy no ne l nf ng">time_test_1 <strong class="my ir">=</strong> all_data[start_time:end_time]<br/>time_test_1</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/88a934a1fff35e39a471ccc1950e4b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7f1Ygsy5qQeeZ3dn_Nk_SA.png"/></div></div></figure><p id="d3ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以看到凌晨 1 点有两个条目，其中第二个条目是时钟“倒转”的结果。为了用这个<code class="fe ni nj nk my b">DatetimeIndex</code>做算术，我们需要让它知道时区。Pandas 简化了这一过程，并适当地处理了重复的 1am 行:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="eae8" class="nc lt iq my b gy nd ne l nf ng">all_data<strong class="my ir">.</strong>index <strong class="my ir">=</strong> \<br/>all_data<strong class="my ir">.</strong>index<strong class="my ir">.</strong>tz_localize('America/New_York', ambiguous<strong class="my ir">=</strong>'infer')</span><span id="9491" class="nc lt iq my b gy no ne l nf ng">time_test_2 <strong class="my ir">=</strong> all_data[start_time:end_time]<br/>time_test_2</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/03b0f29b52c7f76f6debfd230c6213d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hopZtzZnAiK1b1qv2xN-JQ.png"/></div></div></figure><p id="aeec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们可以看到，相对于 UTC 的偏移量已显示出来。在继续之前，让我们仔细检查一下数据的开头和结尾。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="3bd3" class="nc lt iq my b gy nd ne l nf ng">all_data<strong class="my ir">.</strong>head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/806159b6306a60f7188ac46732375546.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EsUctR6RgLlaZLe1w0WzUA.png"/></div></div></figure><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="9d9a" class="nc lt iq my b gy nd ne l nf ng">all_data<strong class="my ir">.</strong>tail()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/bcaa46da26a5e54ddc00ccc04b39bbcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iP6q-dAAHi22BOlkUeioXQ.png"/></div></div></figure><p id="bf37" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">看起来数据像预期的那样，从 2019 年 5 月 1 日到 2020 年 4 月底跨越了一年。</p><h1 id="972e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">运行模拟</h1><p id="e9b2" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">在本节中，我们将定义一个函数<code class="fe ni nj nk my b">simulate_battery</code>，它模拟电池在一年中的能量套利操作。以下是该函数的输入:</p><ul class=""><li id="aa07" class="nu nv iq kx b ky kz lb lc le nw li nx lm ny lq nz oa ob oc bi translated"><code class="fe ni nj nk my b">initial_level</code>，模拟开始时电池充电的初始水平(kWh)</li><li id="d8f8" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated"><code class="fe ni nj nk my b">price_data</code>、每小时 LBMP 的<code class="fe ni nj nk my b">DataFrame</code>($/MWh)</li><li id="a5f1" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated"><code class="fe ni nj nk my b">max_discharge_power_capacity</code>、<em class="ms"> κ </em>(千瓦)</li><li id="860f" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated"><code class="fe ni nj nk my b">max_charge_power_capacity</code>，亦作<em class="ms"> κ </em> (kW)</li><li id="9a71" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated"><code class="fe ni nj nk my b">discharge_energy_capacity</code>(千瓦小时)</li><li id="c794" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated"><code class="fe ni nj nk my b">efficiency</code>、交-交往返效率、<em class="ms">、η </em>(无单位)</li><li id="d628" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated"><code class="fe ni nj nk my b">max_daily_discharged_throughput</code>、<em class="ms"> τ </em>(千瓦时)</li><li id="5c1f" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated"><code class="fe ni nj nk my b">time_horizon</code>，优化时间范围(h)，这里假设大于等于 24。</li><li id="7f95" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated"><code class="fe ni nj nk my b">start_day</code>，一只熊猫<code class="fe ni nj nk my b">Timestamp</code>在第一个模拟日的中午</li></ul><p id="07c2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该函数返回几个可用于检查系统操作的输出:</p><ul class=""><li id="411c" class="nu nv iq kx b ky kz lb lc le nw li nx lm ny lq nz oa ob oc bi translated"><code class="fe ni nj nk my b">all_hourly_charges</code>、<code class="fe ni nj nk my b">all_hourly_discharges</code>、<code class="fe ni nj nk my b">all_hourly_state_of_energy</code>、充电和放电活动以及能量状态，以每小时为时间步长(kWh)</li><li id="6a4c" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated"><code class="fe ni nj nk my b">all_daily_discharge_throughput</code>、每日时间步长的排放吞吐量(kWh)</li></ul><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="cd3b" class="nc lt iq my b gy nd ne l nf ng"><strong class="my ir">def</strong> <strong class="my ir">simulate_battery</strong>(initial_level,<br/>                     price_data,<br/>                     max_discharge_power_capacity,<br/>                     max_charge_power_capacity,<br/>                     discharge_energy_capacity,<br/>                     efficiency,<br/>                     max_daily_discharged_throughput,<br/>                     time_horizon,<br/>                     start_day):<br/>    <em class="ms">#Track simulation time<br/></em>    tic <strong class="my ir">=</strong> time<strong class="my ir">.</strong>time()<br/>    <br/>    <em class="ms">#Initialize output variables<br/></em>    all_hourly_charges <strong class="my ir">=</strong> np<strong class="my ir">.</strong>empty(0)<br/>    all_hourly_discharges <strong class="my ir">=</strong> np<strong class="my ir">.</strong>empty(0)<br/>    all_hourly_state_of_energy <strong class="my ir">=</strong> np<strong class="my ir">.</strong>empty(0)<br/>    all_daily_discharge_throughput <strong class="my ir">=</strong> np<strong class="my ir">.</strong>empty(0)<br/>    <br/>    <em class="ms">#Set up decision variables for optimization by<br/></em>    <em class="ms">#instantiating the Battery class<br/></em>    battery <strong class="my ir">=</strong> Battery(<br/>        time_horizon<strong class="my ir">=</strong>time_horizon,<br/>        max_discharge_power_capacity<strong class="my ir">=</strong>max_discharge_power_capacity,<br/>        max_charge_power_capacity<strong class="my ir">=</strong>max_charge_power_capacity)<br/>    <br/>    <em class="ms">#############################################<br/></em>    <em class="ms">#Run the optimization for each day of the year.<br/></em>    <em class="ms">#############################################<br/></em>    <br/>    <em class="ms">#There are 365 24-hour periods (noon to noon) in the simulation,<br/></em>    <em class="ms">#contained within 366 days<br/></em>    <strong class="my ir">for</strong> day_count <strong class="my ir">in</strong> range(365):<br/>        <em class="ms">#print('Trying day {}'.format(day_count))<br/></em>        <br/>        <em class="ms">#############################################<br/></em>        <em class="ms">### Select data and simulate daily operation<br/></em>        <em class="ms">#############################################<br/></em>        <br/>        <em class="ms">#Set up the 36 hour optimization horizon for this day by<br/></em>        <em class="ms">#adding to the first day/time of the simulation<br/></em>        start_time <strong class="my ir">=</strong> start_day \<br/>        <strong class="my ir">+</strong> pd<strong class="my ir">.</strong>Timedelta(day_count, unit<strong class="my ir">=</strong>'days')<br/>        end_time <strong class="my ir">=</strong> start_time <strong class="my ir">+</strong> pd<strong class="my ir">.</strong>Timedelta(time_horizon<strong class="my ir">-</strong>1, unit<strong class="my ir">=</strong>'hours')<br/>        <em class="ms">#print(start_time, end_time)<br/></em>    <br/>        <em class="ms">#Retrieve the price data that will be used to calculate the<br/></em>        <em class="ms">#objective<br/></em>        prices <strong class="my ir">=</strong> \<br/>        price_data[start_time:end_time]['LBMP ($/MWHr)']<strong class="my ir">.</strong>values<br/>                      <br/>        <em class="ms">#Create model and objective<br/></em>        battery<strong class="my ir">.</strong>set_objective(prices)<br/><br/>        <em class="ms">#Set storage constraints<br/></em>        battery<strong class="my ir">.</strong>add_storage_constraints(<br/>            efficiency<strong class="my ir">=</strong>efficiency,<br/>            min_capacity<strong class="my ir">=</strong>0,<br/>            discharge_energy_capacity<strong class="my ir">=</strong>discharge_energy_capacity,<br/>            initial_level<strong class="my ir">=</strong>initial_level)<br/>            <br/>        <em class="ms">#Set maximum discharge throughput constraint<br/></em>        battery<strong class="my ir">.</strong>add_throughput_constraints(<br/>            max_daily_discharged_throughput<strong class="my ir">=</strong><br/>            max_daily_discharged_throughput)<br/><br/>        <em class="ms">#Solve the optimization problem and collect output<br/></em>        battery<strong class="my ir">.</strong>solve_model()<br/>        hourly_charges, hourly_discharges <strong class="my ir">=</strong> battery<strong class="my ir">.</strong>collect_output()<br/>        <br/>        <em class="ms">#############################################<br/></em>        <em class="ms">### Manipulate daily output for data analysis<br/></em>        <em class="ms">#############################################<br/></em>        <br/>        <em class="ms">#Collect daily discharge throughput<br/></em>        daily_discharge_throughput <strong class="my ir">=</strong> sum(hourly_discharges)<br/>        <em class="ms">#Calculate net hourly power flow (kW), needed for state of energy.<br/></em>        <em class="ms">#Charging needs to factor in efficiency, as not all charged power<br/></em>        <em class="ms">#is available for discharge.<br/></em>        net_hourly_activity <strong class="my ir">=</strong> (hourly_charges<strong class="my ir">*</strong>efficiency) \<br/>        <strong class="my ir">-</strong> hourly_discharges<br/>        <em class="ms">#Cumulative changes in energy over time (kWh) from some baseline<br/></em>        cumulative_hourly_activity <strong class="my ir">=</strong> np<strong class="my ir">.</strong>cumsum(net_hourly_activity)<br/>        <em class="ms">#Add the baseline for hourly state of energy during the next<br/></em>        <em class="ms">#time step (t2)<br/></em>        state_of_energy_from_t2 <strong class="my ir">=</strong> initial_level \<br/>        <strong class="my ir">+</strong> cumulative_hourly_activity<br/>        <br/>        <em class="ms">#Append output<br/></em>        all_hourly_charges <strong class="my ir">=</strong> np<strong class="my ir">.</strong>append(all_hourly_charges, hourly_charges)<br/>        all_hourly_discharges <strong class="my ir">=</strong> np<strong class="my ir">.</strong>append(<br/>            all_hourly_discharges, hourly_discharges)<br/>        all_hourly_state_of_energy <strong class="my ir">=</strong> \<br/>        np<strong class="my ir">.</strong>append(all_hourly_state_of_energy, state_of_energy_from_t2)<br/>        all_daily_discharge_throughput <strong class="my ir">=</strong> \<br/>        np<strong class="my ir">.</strong>append(<br/>            all_daily_discharge_throughput, daily_discharge_throughput)<br/>        <br/>        <em class="ms">#############################################<br/></em>        <em class="ms">### Set up the next day<br/></em>        <em class="ms">#############################################<br/></em>        <br/>        <em class="ms">#Initial level for next period is the end point of current period<br/></em>        initial_level <strong class="my ir">=</strong> state_of_energy_from_t2[<strong class="my ir">-</strong>1]<br/>        <br/>        <br/><br/>    toc <strong class="my ir">=</strong> time<strong class="my ir">.</strong>time()<br/>        <br/>    <strong class="my ir">print</strong>('Total simulation time: ' <strong class="my ir">+</strong> str(toc<strong class="my ir">-</strong>tic) <strong class="my ir">+</strong> ' seconds')<br/><br/>    <strong class="my ir">return</strong> all_hourly_charges, all_hourly_discharges, \<br/>        all_hourly_state_of_energy,\<br/>        all_daily_discharge_throughput</span></pre><p id="1986" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们将全年运行我们的模拟，使用以下电池参数的说明性值。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="e181" class="nc lt iq my b gy nd ne l nf ng">max_discharge_power_capacity <strong class="my ir">=</strong> 100 <em class="ms">#(kW)<br/></em>max_charge_power_capacity <strong class="my ir">=</strong> 100 <em class="ms">#(kW)<br/></em>discharge_energy_capacity <strong class="my ir">=</strong> 200 <em class="ms">#(kWh)<br/></em>efficiency <strong class="my ir">=</strong> 0.85 <em class="ms">#unitless<br/></em>max_daily_discharged_throughput <strong class="my ir">=</strong> 200  <em class="ms">#(kWh)</em></span></pre><p id="3630" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们假设电池充电到一半就可以启动。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="06d7" class="nc lt iq my b gy nd ne l nf ng">initial_level <strong class="my ir">=</strong> discharge_energy_capacity<strong class="my ir">/</strong>2<br/>initial_level</span><span id="466d" class="nc lt iq my b gy no ne l nf ng">100.0</span><span id="b242" class="nc lt iq my b gy no ne l nf ng">all_hourly_charges, all_hourly_discharges, all_hourly_state_of_energy,\<br/>all_daily_discharge_throughput <strong class="my ir">=</strong> \<br/>simulate_battery(initial_level<strong class="my ir">=</strong>initial_level,<br/>                 price_data<strong class="my ir">=</strong>all_data,<br/>                 max_discharge_power_capacity<br/>                     <strong class="my ir">=</strong>max_discharge_power_capacity,<br/>                 max_charge_power_capacity<br/>                     <strong class="my ir">=</strong>max_charge_power_capacity,<br/>                 discharge_energy_capacity<strong class="my ir">=</strong>discharge_energy_capacity,<br/>                 efficiency<strong class="my ir">=</strong>efficiency,<br/>                 max_daily_discharged_throughput<br/>                     <strong class="my ir">=</strong>max_daily_discharged_throughput,<br/>                 time_horizon<strong class="my ir">=</strong>36,<br/>                 start_day<strong class="my ir">=</strong>pd<strong class="my ir">.</strong>Timestamp(<br/>                     year<strong class="my ir">=</strong>2019, month<strong class="my ir">=</strong>5, day<strong class="my ir">=</strong>1, hour<strong class="my ir">=</strong>12,<br/>                     tz<strong class="my ir">=</strong>'America/New_York'))</span><span id="c35e" class="nc lt iq my b gy no ne l nf ng">Total simulation time: 20.976715087890625 seconds</span></pre><p id="323d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">健全性检查:模拟小时数应为:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="0613" class="nc lt iq my b gy nd ne l nf ng"><strong class="my ir">assert</strong> 24<strong class="my ir">*</strong>365 <strong class="my ir">==</strong> len(all_hourly_discharges)</span></pre><h1 id="8eb1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">分析电池运行</h1><p id="c984" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">现在我们来看一组电池如何工作的指标。我们可以检查是否满足了所有的约束，并分析我们系统的财务影响。</p><h1 id="c13a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">功率输出</h1><p id="57c3" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">定义放电为正，充电为负的功率输出。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="c425" class="nc lt iq my b gy nd ne l nf ng">mpl<strong class="my ir">.</strong>rcParams["figure.figsize"] <strong class="my ir">=</strong> [5,3]<br/>mpl<strong class="my ir">.</strong>rcParams["figure.dpi"] <strong class="my ir">=</strong> 100<br/>mpl<strong class="my ir">.</strong>rcParams<strong class="my ir">.</strong>update({"font.size":12})</span><span id="372a" class="nc lt iq my b gy no ne l nf ng">plt<strong class="my ir">.</strong>hist(all_hourly_discharges <strong class="my ir">-</strong> all_hourly_charges)<br/>plt<strong class="my ir">.</strong>xlabel('kW')<br/>plt<strong class="my ir">.</strong>title('Hourly power output')</span><span id="3e89" class="nc lt iq my b gy no ne l nf ng">Text(0.5, 1.0, 'Hourly power output')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/8161c590ba49ef3b8da906ebd6d2b334.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/0*KOSDgSoBYB0D-dxf.png"/></div></figure><p id="7ac6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这表明在一年中的大部分时间里，电力接近于零。换句话说，电池既不充电也不放电。然而，电池在其范围[-100，100] kW 的极限下运行也是常见的。</p><h1 id="e0ab" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">能量状态</h1><p id="9c1c" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">在任何时候，电池的能量状态应不小于零，且不大于放电能量容量:[0，200] kWh。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="8df5" class="nc lt iq my b gy nd ne l nf ng">plt<strong class="my ir">.</strong>hist(all_hourly_state_of_energy)<br/>plt<strong class="my ir">.</strong>xlabel('kWh')<br/>plt<strong class="my ir">.</strong>title('Hourly state of energy')</span><span id="31a7" class="nc lt iq my b gy no ne l nf ng">Text(0.5, 1.0, 'Hourly state of energy')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/f89bbbeada3558ef7ba8d89310f7dd1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/0*SFPwLsXWgQY-wYRV.png"/></div></figure><p id="5cb3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">结果表明电池在规定的能量状态范围内工作。</p><h1 id="21ed" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">收入、成本和利润</h1><p id="44db" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">我们将分析以下财务指标:</p><ul class=""><li id="466a" class="nu nv iq kx b ky kz lb lc le nw li nx lm ny lq nz oa ob oc bi translated">年收入总额(美元)</li><li id="670b" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated">年度总收费成本(美元)</li></ul><p id="62ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">稍后，我们还将了解总的年排放吞吐量(kWh)。为了检查所有这些，将数据放在一个<code class="fe ni nj nk my b">DataFrame</code>中是很方便的。</p><p id="4df2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据模拟的时间范围选择一个新的<code class="fe ni nj nk my b">DataFrame</code>，以报告进一步的结果:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="c112" class="nc lt iq my b gy nd ne l nf ng">all_data_sim_time <strong class="my ir">=</strong> all_data[<br/>    pd<strong class="my ir">.</strong>Timestamp(year<strong class="my ir">=</strong>2019, month<strong class="my ir">=</strong>5, day<strong class="my ir">=</strong>1, hour<strong class="my ir">=</strong>12, tz<strong class="my ir">=</strong>'America/New_York'):<br/>    pd<strong class="my ir">.</strong>Timestamp(year<strong class="my ir">=</strong>2020, month<strong class="my ir">=</strong>4, day<strong class="my ir">=</strong>30, hour<strong class="my ir">=</strong>11, tz<strong class="my ir">=</strong>'America/New_York')]<strong class="my ir">.</strong>copy()</span></pre><p id="513a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">检查行数是否正确:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="d167" class="nc lt iq my b gy nd ne l nf ng">all_data_sim_time<strong class="my ir">.</strong>shape</span><span id="dab3" class="nc lt iq my b gy no ne l nf ng">(8760, 5)</span><span id="d9f1" class="nc lt iq my b gy no ne l nf ng"><strong class="my ir">assert</strong> all_data_sim_time<strong class="my ir">.</strong>shape[0] <strong class="my ir">==</strong> len(all_hourly_discharges)</span></pre><p id="07d6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">附加模拟结果</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="74e3" class="nc lt iq my b gy nd ne l nf ng"><em class="ms">#These indicate flows during the hour of the datetime index<br/></em>all_data_sim_time['Charging power (kW)'] <strong class="my ir">=</strong> all_hourly_charges<br/>all_data_sim_time['Discharging power (kW)'] <strong class="my ir">=</strong> all_hourly_discharges<br/>all_data_sim_time['Power output (kW)'] <strong class="my ir">=</strong> \<br/>    all_hourly_discharges <strong class="my ir">-</strong> all_hourly_charges<br/><em class="ms">#This is the state of power at the beginning of the hour of the datetime index <br/></em>all_data_sim_time['State of Energy (kWh)'] <strong class="my ir">=</strong> \<br/>    np<strong class="my ir">.</strong>append(initial_level, all_hourly_state_of_energy[0:<strong class="my ir">-</strong>1])</span></pre><p id="6d9a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">收入和成本的单位是</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/601d65dcb0a908a4fe0c90a0ce924954.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*ONo2rdnrdBt34bYZesPXCg.png"/></div></figure><p id="6b57" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所以除以 1000 调整为美元:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="9a60" class="nc lt iq my b gy nd ne l nf ng">all_data_sim_time['Revenue generation ($)'] <strong class="my ir">=</strong> \<br/>all_data_sim_time['Discharging power (kW)'] \<br/><strong class="my ir">*</strong> all_data_sim_time['LBMP ($/MWHr)'] <strong class="my ir">/</strong> 1000</span><span id="a6b0" class="nc lt iq my b gy no ne l nf ng">all_data_sim_time['Charging cost ($)'] <strong class="my ir">=</strong> \<br/>all_data_sim_time['Charging power (kW)'] \<br/><strong class="my ir">*</strong> all_data_sim_time['LBMP ($/MWHr)'] <strong class="my ir">/</strong> 1000</span><span id="398b" class="nc lt iq my b gy no ne l nf ng">all_data_sim_time['Profit ($)'] <strong class="my ir">=</strong> all_data_sim_time['Revenue generation ($)'] \<br/><strong class="my ir">-</strong> all_data_sim_time['Charging cost ($)']</span></pre><p id="298c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">年总收入是多少？</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="d8b0" class="nc lt iq my b gy nd ne l nf ng">all_data_sim_time['Revenue generation ($)']<strong class="my ir">.</strong>sum()</span><span id="1816" class="nc lt iq my b gy no ne l nf ng">2354.6574498602467</span></pre><p id="02a5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">每年总充电成本？</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="0695" class="nc lt iq my b gy nd ne l nf ng">all_data_sim_time['Charging cost ($)']<strong class="my ir">.</strong>sum()</span><span id="349b" class="nc lt iq my b gy no ne l nf ng">1391.6754123382877</span></pre><p id="420f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">计算利润</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="cae7" class="nc lt iq my b gy nd ne l nf ng">all_data_sim_time['Profit ($)']<strong class="my ir">.</strong>sum()</span><span id="c72e" class="nc lt iq my b gy no ne l nf ng">962.9820375219592</span></pre><p id="ba99" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，我们可以通过执行能源套利获得近 963 美元的利润。</p><h1 id="6255" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">总年排放吞吐量</h1><p id="bae8" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">一年中有多少能量流过这个电池？在某些情况下，每天的排放总量限制在 200 千瓦时/天。如果电池在 365 天的模拟过程中每天都释放其最大可能能量，则总放电量为:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="882f" class="nc lt iq my b gy nd ne l nf ng">365<strong class="my ir">*</strong>200<br/><em class="ms">#kWh</em></span><span id="1d64" class="nc lt iq my b gy no ne l nf ng">73000</span></pre><p id="693d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">事实上它是:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="5c1a" class="nc lt iq my b gy nd ne l nf ng">sum(all_daily_discharge_throughput)</span><span id="1d69" class="nc lt iq my b gy no ne l nf ng">72955.00000394997</span></pre><p id="28ff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这意味着系统在大多数日子里达到了最大排出吞吐量限制。我们可以通过对日吞吐量的<code class="fe ni nj nk my b">Series</code>进行<code class="fe ni nj nk my b">value_counts()</code>来检查这一点。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="4a7d" class="nc lt iq my b gy nd ne l nf ng">pd<strong class="my ir">.</strong>Series(all_daily_discharge_throughput<strong class="my ir">.</strong>round(0))<strong class="my ir">.</strong>value_counts()</span><span id="3a36" class="nc lt iq my b gy no ne l nf ng">200.0    364<br/>155.0      1<br/>dtype: int64</span></pre><p id="ae6f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">除了一天之外，电池一直以最大生产能力运行。</p><h1 id="f865" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">找到最赚钱的一周</h1><p id="f37f" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">按周对利润列进行分组，并找到最大值:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="cb23" class="nc lt iq my b gy nd ne l nf ng">max_profit_week <strong class="my ir">=</strong> (all_data_sim_time['Profit ($)']<strong class="my ir">.</strong>resample('W')<strong class="my ir">.</strong>sum() <strong class="my ir">==</strong> \<br/>all_data_sim_time['Profit ($)']<strong class="my ir">.</strong>resample('W')<strong class="my ir">.</strong>sum()<strong class="my ir">.</strong>max())<strong class="my ir">.</strong>values</span><span id="24a1" class="nc lt iq my b gy no ne l nf ng">all_data_sim_time['Profit ($)']<strong class="my ir">.</strong>resample('W')<strong class="my ir">.</strong>sum()[max_profit_week]</span><span id="ce98" class="nc lt iq my b gy no ne l nf ng">Time Stamp<br/>2019-07-21 00:00:00-04:00    51.015471<br/>Freq: W-SUN, Name: Profit ($), dtype: float64</span></pre><p id="3e63" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">7 月的一周是能源套利最有利可图的一周。本周，让我们制作一个每小时电池能量状态和每小时 LBMP 的图表。</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="56b3" class="nc lt iq my b gy nd ne l nf ng">mpl<strong class="my ir">.</strong>rcParams["figure.figsize"] <strong class="my ir">=</strong> [8,6]<br/>mpl<strong class="my ir">.</strong>rcParams["figure.dpi"] <strong class="my ir">=</strong> 150<br/>mpl<strong class="my ir">.</strong>rcParams<strong class="my ir">.</strong>update({"font.size":14})</span><span id="5ccd" class="nc lt iq my b gy no ne l nf ng">most_profit_week_start <strong class="my ir">=</strong> pd<strong class="my ir">.</strong>Timestamp(<br/>    year<strong class="my ir">=</strong>2019, month<strong class="my ir">=</strong>7, day<strong class="my ir">=</strong>21, tz<strong class="my ir">=</strong>'America/New_York')<br/>ax <strong class="my ir">=</strong> all_data_sim_time[<br/>    most_profit_week_start:most_profit_week_start<strong class="my ir">+</strong>pd<strong class="my ir">.</strong>Timedelta(weeks<strong class="my ir">=</strong>1)]\<br/>[['State of Energy (kWh)', 'LBMP ($/MWHr)']]\<br/><strong class="my ir">.</strong>plot(secondary_y<strong class="my ir">=</strong>'LBMP ($/MWHr)', mark_right<strong class="my ir">=</strong>False)<br/><br/>ax<strong class="my ir">.</strong>set_ylabel('State of energy (kWh)')<br/>ax<strong class="my ir">.</strong>right_ax<strong class="my ir">.</strong>set_ylabel('LBMP ($/MWh)')<br/>ax<strong class="my ir">.</strong>get_legend()<strong class="my ir">.</strong>set_bbox_to_anchor((0.3, 1))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/36189cdfe72bfb65b0b1b56188f9a3e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2jXJSHye9iv7Q1w9.png"/></div></div></figure><p id="67f6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">电池似乎遵循“低买高卖”的一般套利策略，或者在这种情况下，“便宜充电，谨慎放电”，以利用未来的价格变化。可能是在这一周，纽约市相当温暖，导致空调电力需求高，昼夜价格波动大，也是我们的电池系统赚钱的好机会。</p><h1 id="a4fc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">月收入</h1><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="bad5" class="nc lt iq my b gy nd ne l nf ng">mpl<strong class="my ir">.</strong>rcParams["figure.figsize"] <strong class="my ir">=</strong> [6,4]<br/>mpl<strong class="my ir">.</strong>rcParams["figure.dpi"] <strong class="my ir">=</strong> 100<br/>mpl<strong class="my ir">.</strong>rcParams<strong class="my ir">.</strong>update({"font.size":12})</span><span id="d4c0" class="nc lt iq my b gy no ne l nf ng">all_data_sim_time['Profit ($)']<strong class="my ir">.</strong>resample('M')<strong class="my ir">.</strong>sum()<strong class="my ir">.</strong>plot()<br/>plt<strong class="my ir">.</strong>ylabel('Total monthly profit ($)')</span><span id="f046" class="nc lt iq my b gy no ne l nf ng">Text(0, 0.5, 'Total monthly profit ($)')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/b1ac1825db98ffcf6585443e0081c5d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/0*KwMBEynBh0Hs98jP.png"/></div></figure><p id="ba20" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">夏季的利润通常高于冬季，但 1 月和 12 月的利润也很高。LBMP 全年的一幅图对此有所启发:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="4592" class="nc lt iq my b gy nd ne l nf ng">all_data_sim_time['LBMP ($/MWHr)']<strong class="my ir">.</strong>plot()<br/>plt<strong class="my ir">.</strong>ylabel('LBMP ($/MWHr)')</span><span id="da8a" class="nc lt iq my b gy no ne l nf ng">Text(0, 0.5, 'LBMP ($/MWHr)')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/bb872dff7126af30f4f34fd4e0ce3dea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/0*z8xA_DCkKGWKl22H.png"/></div></figure><p id="6abf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">价格的变化使得套利策略能够获利。一般来说，大多数较大的价格波动发生在夏季，这可能反映了炎热夏季空调使用量的增加。但是 11 月、12 月和 1 月的价格变化很大。这可能是由于纽约市在假日期间的旅游业或寒冷的天气增加了对取暖用电的需求。</p><h1 id="9c3d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="19dd" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">我们发现，一个并网电池的能源套利策略可以使用线性规划来制定，假设未来价格在一定时间范围内是已知的。我们表明，当在一组说明性的系统参数下运行并使用真实世界的能源价格数据时，这样一个系统每年可以产生 963 美元的利润。</p><p id="5911" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果价格能够在这里使用的 36 小时优化范围之外准确预测，则可能会进一步优化以增加利润。NYISO 价格的确定涉及一个负荷预测模型，该模型取决于经济和天气因素。有可能在价格预测模型中包括这些因素，以估计尚未公开的未来一天的市场价格。在另一个有趣的方向上，王和张(2018)表明，使用历史价格数据的强化学习可以比最大化瞬时利润带来更高的利润，这表明了从能源套利中最大化利润的其他可能方法。</p><p id="900d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我希望这篇文章有助于你理解在未来价格已知的情况下，如何使用线性规划来制定最优套利策略。</p><h1 id="ee37" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">参考</h1><p id="e132" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">所有引用都是在 2020 年 5 月 2 日访问的。</p><p id="a3a0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">尼索。<a class="ae lr" href="https://www.nyiso.com/documents/20142/2923301/dayahd_schd_mnl.pdf/0024bc71-4dd9-fa80-a816-f9f3e26ea53a" rel="noopener ugc nofollow" target="_blank">日前调度手册</a>。</p><p id="7455" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">PJM 互联有限责任公司。<a class="ae lr" href="https://www.pjm.com/-/media/training/nerc-certifications/markets-exam-materials/mkt-optimization-wkshp/locational-marginal-pricing-components.ashx?la=en" rel="noopener ugc nofollow" target="_blank">区位边际定价成分</a>。</p><p id="33a9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Salles，Mauricio B. C .等人，2017 年。<a class="ae lr" href="https://www.mdpi.com/1996-1073/10/8/1100/htm" rel="noopener ugc nofollow" target="_blank">PJM 储能系统潜在套利收益</a>。能量 10:8。</p><p id="75e6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Sioshansi，Ramteen 等人，2009 年。<a class="ae lr" href="https://www.sciencedirect.com/science/article/pii/S0140988308001631" rel="noopener ugc nofollow" target="_blank">估算 PJM 电力储存的价值:套利和一些福利效应</a>。能源经济学 31:2，269–277。</p><p id="602c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">王，郝，张，2018。<a class="ae lr" href="https://arxiv.org/abs/1711.03127" rel="noopener ugc nofollow" target="_blank">通过强化学习在实时市场中进行储能套利</a>。IEEE PES 大会。</p><p id="1b5d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我发现这本由 Ben Alex Keen 撰写的<a class="ae lr" href="https://benalexkeen.com/linear-programming-with-python-and-pulp/" rel="noopener ugc nofollow" target="_blank">指南非常有帮助。</a></p></div><div class="ab cl on oo hu op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="ij ik il im in"><p id="4a1e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ms">原载于 2020 年 5 月 3 日 https://www.steveklosterman.com</em><a class="ae lr" href="https://www.steveklosterman.com/energy-arbitrage/" rel="noopener ugc nofollow" target="_blank"><em class="ms"/></a><em class="ms">。</em></p></div></div>    
</body>
</html>