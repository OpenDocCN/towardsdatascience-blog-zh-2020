<html>
<head>
<title>Simulating Web Events</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模拟 Web 事件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/simulating-web-events-7199bf8afcfd?source=collection_archive---------36-----------------------#2020-07-17">https://towardsdatascience.com/simulating-web-events-7199bf8afcfd?source=collection_archive---------36-----------------------#2020-07-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b3b8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有时我们想要生成假事件来测试我们的管道和仪表板。随机事件做不了这个工作。这就是我构建这个 Python 包的原因。</h2></div><p id="5e7d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您希望在工作场所实施新的流式管道，并需要向您的经理展示概念证明。此 POC 应允许您演示一些功能，在这种情况下，生成实时指标。但是，有一个限制:您不能在 POC 上使用生产数据。你如何解决这个问题？</p><p id="74ee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你的答案是制造假事件，那么你是对的。这可能是最好的解决方案。然后，您创建一些随机事件，并将其推送到管道。你很快就会意识到随机和假不一样。你肯定不想给你的经理看这样的图表:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/8f3bb292a59a020dd958d5bc2fc00ffb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ladLeOa2VJwifZC_rS8L3Q.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">随着时间的推移产生的随机事件的网页浏览量。它们只是随机的。作者图表。</p></figure><p id="348a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随机事件没有意义；他们不卖任何东西。让我们来了解一下在随机事件基础上创建的另一个指标:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lu"><img src="../Images/fdb324dd24092a1c22197ca1697d5178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a50zwCRXL8TMqR6muY1cFA.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">随机浏览量没有任何意义。没有人指望一个网站在付费页面的访问量会超过首页。作者图表。</p></figure><p id="b2d0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，让我们说，你想建立一个分析工程师职位的投资组合。你可能需要表明，你有能力创建网络会话，衡量转化率和分裂活动或来源的指标。如果没有数据，你怎么建立你那该死的投资组合？同样，生成随机数据不会让你测量任何东西。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="28b3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建半随机事件</h1><p id="39bf" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">考虑到这些问题，我决定创建一个 python 包来生成不完全随机的假事件。它们遵循一套约束，允许你用看起来像真的假数据创造美丽的东西。再次查看一段时间内的页面浏览量图表:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mz"><img src="../Images/e88daa4a4063fa3312dac1925507a681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*IXGMCQYjFReQDVvMQU-pMA.gif"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">虚假网络事件。现在，随着时间的推移，我们有了更真实的页面浏览量。作者图表。</p></figure><p id="064e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们看看页面浏览量漏斗，我们会看到更多的主页访问，而付费和确认的访问要少得多，对吗？让我们看看这是不是真的。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi na"><img src="../Images/1bc37e4f156c8183b46707db7fd058e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dfYGQjFazt76Va78"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">虚假网络事件。有道理的漏斗！作者图表。</p></figure><h1 id="3be6" class="mc md it bd me mf nb mh mi mj nc ml mm jz nd ka mo kc ne kd mq kf nf kg ms mt bi translated">如何自己创建假的 web 事件？</h1><p id="c368" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">很简单！PyPI 上有<a class="ae ng" href="https://pypi.org/project/fake-web-events/" rel="noopener ugc nofollow" target="_blank">包，GitHub </a>上有<a class="ae ng" href="https://github.com/andresionek91/fake-web-events" rel="noopener ugc nofollow" target="_blank">源代码。要安装你做<strong class="kk iu"> pip 安装</strong>，就像你对任何其他软件包做的那样:</a></p><pre class="lf lg lh li gt nh ni nj nk aw nl bi"><span id="0014" class="nm md it ni b gy nn no l np nq">pip install fake_web_events</span></pre><p id="9be6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用起来也很简单。请参见下面将事件打印到 stdout 的示例。</p><pre class="lf lg lh li gt nh ni nj nk aw nl bi"><span id="16d8" class="nm md it ni b gy nn no l np nq">from fake_web_events import Simulation</span><span id="0482" class="nm md it ni b gy nr no l np nq">simulation = Simulation(user_pool_size=100, sessions_per_day=10000)<br/>events = simulation.run(duration_seconds=10)</span><span id="e68b" class="nm md it ni b gy nr no l np nq">for event in events:<br/>    print(event)</span></pre><p id="63ba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在循环里做任何你想做的事情。发给卡夫卡或者 Kinesis。用 Spark 流处理它，并创建一些指标。保存到 Postgres 并使用元数据库构建一些仪表板。炫耀你的投资组合的 SQL 技能。或者让 POC 获得批准。</p><p id="bcdd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由此包创建的事件将如下所示:</p><pre class="lf lg lh li gt nh ni nj nk aw nl bi"><span id="2eba" class="nm md it ni b gy nn no l np nq">{<br/>  "event_timestamp": "2020-07-05 14:32:45.407110",<br/>  "event_type": "pageview",<br/>  "page_url": "http://www.dummywebsite.com/home",<br/>  "page_url_path": "/home",<br/>  "referer_url": "www.instagram.com",<br/>  "referer_url_scheme": "http",<br/>  "referer_url_port": "80",<br/>  "referer_medium": "internal",<br/>  "utm_medium": "organic",<br/>  "utm_source": "instagram",<br/>  "utm_content": "ad_2",<br/>  "utm_campaign": "campaign_2",<br/>  "click_id": "b6b1a8ad-88ca-4fc7-b269-6c9efbbdad55",<br/>  "geo_latitude": "41.75338",<br/>  "geo_longitude": "-86.11084",<br/>  "geo_country": "US",<br/>  "geo_timezone": "America/Indiana/Indianapolis",<br/>  "geo_region_name": "Granger",<br/>  "ip_address": "209.139.207.244",<br/>  "browser_name": "Firefox",<br/>  "browser_user_agent": "Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_5_5; rv:1.9.6.20) Gecko/2012-06-06 09:24:19 Firefox/3.6.20",<br/>  "browser_language": "tn_ZA",<br/>  "os": "Android 2.0.1",<br/>  "os_name": "Android",<br/>  "os_timezone": "America/Indiana/Indianapolis",<br/>  "device_type": "Mobile",<br/>  "device_is_mobile": true,<br/>  "user_custom_id": "vsnyder@hotmail.com",<br/>  "user_domain_id": "3d648067-9088-4d7e-ad32-45d009e8246a"<br/>}</span></pre><p id="574c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假的网络事件正在使用<a class="ae ng" href="https://faker.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"> Faker </a>来创建一些数据；其他字段是根据预定义的权重(可以在 YAML 文件中自定义)随机生成的。</p><h1 id="7c15" class="mc md it bd me mf nb mh mi mj nc ml mm jz nd ka mo kc ne kd mq kf nf kg ms mt bi translated">幕后的虚假网络事件</h1><p id="5bfa" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">我假设您可能有兴趣了解这些事件是如何创建的，以及其背后的逻辑是什么。我可以直截了当的告诉你，不是外星科技:)。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="ns nt l"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">虚假网络事件不是外星技术。Gif 信用<a class="ae ng" href="https://www.reddit.com/user/Huesh/" rel="noopener ugc nofollow" target="_blank"> u/Huesh </a>在<a class="ae ng" href="https://www.reddit.com/r/HighQualityGifs/comments/5kqyvo/when_you_come_to_hqg_and_see_the_aliens/" rel="noopener ugc nofollow" target="_blank"> Reddit </a>上。</p></figure><h2 id="7387" class="nm md it bd me nu nv dn mi nw nx dp mm kr ny nz mo kv oa ob mq kz oc od ms oe bi translated">用户</h2><p id="e019" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">我们首先创建一个用户池。一些字段完全是随机的(来自 Faker)，其他字段遵循一组预定义的权重。例如，用户将获得使用以下权重分配的浏览器:</p><pre class="lf lg lh li gt nh ni nj nk aw nl bi"><span id="e09a" class="nm md it ni b gy nn no l np nq">browsers:<br/>  Chrome: 0.5<br/>  Firefox: 0.25<br/>  InternetExplorer: 0.05<br/>  Safari: 0.1<br/>  Opera: 0.1</span></pre><p id="d314" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着大约 50%的用户将使用 Chrome，25%的用户将使用 Firefox。</p><p id="885d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用户与事件具有本质上相同的 JSON 结构，除了它不包含时间戳或页面信息。当我们运行模拟时，将从池中随机挑选用户开始“浏览网站”。用户以后可能会回到这个网站，这就是为什么他们选择了重新定位。</p><h2 id="ed00" class="nm md it bd me nu nv dn mi nw nx dp mm kr ny nz mo kv oa ob mq kz oc od ms oe bi translated">事件</h2><p id="d047" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">为了创建事件，我们模拟会话。在模拟中创建了一些“页面”。用户将从主页、产品 A 或产品 B 页面开始。在每次迭代中，用户可以停留在同一个页面，移动到另一个页面，或者结束会话。以下是当前在家的用户的概率:</p><pre class="lf lg lh li gt nh ni nj nk aw nl bi"><span id="b779" class="nm md it ni b gy nn no l np nq">home:<br/>  home: 0.45<br/>  product_a: 0.17<br/>  product_b: 0.12<br/>  session_end: 0.26</span></pre><p id="6599" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该模拟跟踪所有用户，并在每次到达新页面时生成一个事件。一旦用户到达会话末尾，他的会话就会被丢弃。遵循模拟过程中可能的用户事件图表:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi of"><img src="../Images/4e28f9b30ddb6bdb7082ad0c1e45f868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x5D1XHU1TrrJgn2HC16iaQ.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">虚假 web 事件模拟的站点地图。绿页是用户在会话开始时可以进入的页面。黄页只对已经在浏览的用户开放。作者配图。</p></figure><h2 id="53a1" class="nm md it bd me nu nv dn mi nw nx dp mm kr ny nz mo kv oa ob mq kz oc od ms oe bi translated">模拟</h2><p id="d6a0" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">模拟将分批运行，其内部时钟通常会比标准时间快得多。例外情况是，如果您正在使用<strong class="kk iu">非常大的</strong>user _ pool _ size 和<em class="og"> sessions_per_day 运行它。</em></p><p id="7680" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">模拟将创建一个发电机对象。它不会运行或使用资源，直到你开始迭代它。</p><h1 id="90a0" class="mc md it bd me mf nb mh mi mj nc ml mm jz nd ka mo kc ne kd mq kf nf kg ms mt bi translated">接下来是什么？</h1><p id="7b15" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">我确实对这个项目下一步做什么有一些想法。有些是简单的错误修复，或者是对如何生成和跟踪事件的改进实现。但是有一个广泛的想法我想深入探讨:</p><p id="ccd4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">在 web 事件之上产生微服务事件。</strong></p><p id="e5b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的想法是向模拟中添加另一个模块，该模块将基于微服务架构创建不同的事件。我能想到这样的事件:</p><ul class=""><li id="c423" class="oh oi it kk b kl km ko kp kr oj kv ok kz ol ld om on oo op bi translated">用户 _ 创建的</li><li id="fca6" class="oh oi it kk b kl oq ko or kr os kv ot kz ou ld om on oo op bi translated">订单 _ 已创建</li><li id="81e1" class="oh oi it kk b kl oq ko or kr os kv ot kz ou ld om on oo op bi translated">付款 _ 已完成</li><li id="dd10" class="oh oi it kk b kl oq ko or kr os kv ot kz ou ld om on oo op bi translated">支付 _ 失败</li><li id="a026" class="oh oi it kk b kl oq ko or kr os kv ot kz ou ld om on oo op bi translated">订单 _ 已发送</li><li id="8da4" class="oh oi it kk b kl oq ko or kr os kv ot kz ou ld om on oo op bi translated">订单 _ 完成</li></ul><p id="d61a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">微服务事件将有助于创建绑定到 web 事件的假事务数据库。我认为这对很多人来说是有用的，因为它允许更多的用例。</p><p id="637c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你喜欢这个项目，请在 GitHub 上主演来表达你的爱<a class="ae ng" href="https://github.com/andresionek91/fake-web-events" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="146a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">每个人也可以贡献</strong>:创建一些问题、特性请求，甚至是拉式请求，如果你对接触代码感到舒服的话！</p></div></div>    
</body>
</html>