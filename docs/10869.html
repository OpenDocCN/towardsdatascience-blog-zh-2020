<html>
<head>
<title>Time Series Forecasting with SARIMA in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 中的 SARIMA 进行时间序列预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-forecasting-with-sarima-in-python-cda5b793977b?source=collection_archive---------2-----------------------#2020-07-29">https://towardsdatascience.com/time-series-forecasting-with-sarima-in-python-cda5b793977b?source=collection_archive---------2-----------------------#2020-07-29</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="3aca" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">关于使用 Python 使用 SARIMA 进行时间序列建模的实践教程</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/de7403e4110ac6dd439d798a95c94680.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9sAh7U-BnKdb1sB6"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">摩根·豪斯尔在<a class="ae la" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="dd24" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在之前的文章中，我们介绍了<a class="ae la" rel="noopener" target="_blank" href="/how-to-model-time-series-in-python-9983ebbf82cf">移动平均过程 MA(q) </a>，和<a class="ae la" rel="noopener" target="_blank" href="/time-series-forecasting-with-autoregressive-processes-ba629717401">自回归过程 AR(p) </a>。我们将它们结合起来，形成了 ARMA(p，q)和 ARIMA(p，d，q)模型来模拟更复杂的时间序列。</p><p id="a1ea" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">现在，给模型添加最后一个组件:季节性。</p><p id="c664" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">本文将涵盖:</p><ul class=""><li id="5f66" class="lx ly iv ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated">季节性 ARIMA 模型</li><li id="a182" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">使用真实数据的完整建模和预测项目</li></ul><p id="020c" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">Github 上有<a class="ae la" href="https://github.com/marcopeix/time-series-analysis/tree/master/Advanced%20modelling" rel="noopener ugc nofollow" target="_blank">笔记本</a>和<a class="ae la" href="https://github.com/marcopeix/time-series-analysis/tree/master/data" rel="noopener ugc nofollow" target="_blank">数据集</a>。</p><p id="dc06" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我们开始吧！</p><blockquote class="ml"><p id="7036" class="mm mn iv bd mo mp mq mr ms mt mu lw dk translated"><em class="mv">关于 Python 中时间序列分析的完整课程，涵盖统计和深度学习模型，请查看我新发布的</em> <a class="ae la" href="https://www.datasciencewithmarco.com/offers/tdU2mtVK" rel="noopener ugc nofollow" target="_blank"> <em class="mv">课程</em> </a> <em class="mv">！</em></p></blockquote><h1 id="c65e" class="mw mx iv bd my mz na nb nc nd ne nf ng kb nh kc ni ke nj kf nk kh nl ki nm nn bi translated">萨里玛模型</h1><p id="fddb" class="pw-post-body-paragraph lb lc iv ld b le no jw lg lh np jz lj lk nq lm ln lo nr lq lr ls ns lu lv lw io bi translated">到目前为止，我们还没有考虑时间序列中季节性的影响。然而，这种行为肯定存在于许多情况下，如礼品店销售或飞机乘客总数。</p><p id="da5c" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">季节性 ARIMA 模型或萨里玛的写法如下:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi nt"><img src="../Images/325c889d30d23024fcf31b95580d52fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yxe5Sf5JSAROq-UVgMLtmA.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">萨里玛符号</p></figure><p id="7b3d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">你可以看到我们为时间序列的季节性部分添加了 P、D 和 Q。它们与非季节性成分的术语相同，因为它们涉及季节性周期的后移。</p><p id="8769" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在上面的公式中，<em class="nu"> m </em>是每年或一段时间内的观察次数。如果我们分析季度数据，<em class="nu"> m </em>等于 4。</p><h2 id="f142" class="nv mx iv bd my nw nx dn nc ny nz dp ng lk oa ob ni lo oc od nk ls oe of nm og bi translated">ACF 和 PACF 图</h2><p id="b5ba" class="pw-post-body-paragraph lb lc iv ld b le no jw lg lh np jz lj lk nq lm ln lo nr lq lr ls ns lu lv lw io bi translated">AR 和 MA 模型的季节性部分可以从 PACF 和 ACF 图中推断出来。</p><p id="9002" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在 SARIMA 模型中，只有一个阶为 1、周期为 12 的季节性移动平均过程，表示为:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/215fda5c908799add726f484c0215396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*nnZS0-GhBBxuWNPYDa4SuQ.png"/></div></figure><ul class=""><li id="e758" class="lx ly iv ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated">在滞后 12 时观察到峰值</li><li id="bc58" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">PACF 季节滞后的指数衰减(滞后 12，24，36，…)</li></ul><p id="f101" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">类似地，对于仅具有阶为 1、周期为 12 的季节性自回归过程的模型:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/65b1972b7dca01e131e1b1c5fc343698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*gE4up-SWOKh0jE3KblnNXw.png"/></div></figure><ul class=""><li id="0c9a" class="lx ly iv ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated">ACF 季节性滞后的指数衰减(滞后 12，24，36，…)</li><li id="5d7b" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">在 PACF 中，在滞后 12 时观察到峰值</li></ul><h2 id="9df9" class="nv mx iv bd my nw nx dn nc ny nz dp ng lk oa ob ni lo oc od nk ls oe of nm og bi translated">系统模型化</h2><p id="4d16" class="pw-post-body-paragraph lb lc iv ld b le no jw lg lh np jz lj lk nq lm ln lo nr lq lr ls ns lu lv lw io bi translated">建模过程与非季节性 ARIMA 模型相同。在这种情况下，我们只需要考虑额外的参数。</p><p id="86b9" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">使时间序列平稳和根据最低 AIC 选择模型所需的步骤仍留在建模过程中。</p><p id="96fd" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">让我们用真实世界的数据集来涵盖一个完整的示例。</p><h1 id="04c7" class="mw mx iv bd my mz na nb nc nd ne nf ng kb oj kc ni ke ok kf nk kh ol ki nm nn bi translated">项目—为强生公司的季度每股收益建模</h1><p id="dd12" class="pw-post-body-paragraph lb lc iv ld b le no jw lg lh np jz lj lk nq lm ln lo nr lq lr ls ns lu lv lw io bi translated">我们将重温强生公司的季度每股收益(EPS)数据集。这是一个非常有趣的数据集，因为有一个移动平均过程在起作用，而且我们有季节性，这是用 SARIMA 进行一些练习的完美时机。</p><p id="acc9" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">和往常一样，我们首先导入所有必要的库来进行分析</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="466e" class="nv mx iv on b gy or os l ot ou">from statsmodels.graphics.tsaplots import plot_pacf<br/>from statsmodels.graphics.tsaplots import plot_acf<br/>from statsmodels.tsa.statespace.sarimax import SARIMAX<br/>from statsmodels.tsa.holtwinters import ExponentialSmoothing<br/>from statsmodels.tsa.stattools import adfuller<br/>import matplotlib.pyplot as plt<br/>from tqdm import tqdm_notebook<br/>import numpy as np<br/>import pandas as pd</span><span id="38a1" class="nv mx iv on b gy ov os l ot ou">from itertools import product</span><span id="41b6" class="nv mx iv on b gy ov os l ot ou">import warnings<br/>warnings.filterwarnings('ignore')</span><span id="2226" class="nv mx iv on b gy ov os l ot ou">%matplotlib inline</span></pre><p id="8cdd" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">现在，让我们读入数据帧中的数据:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="8f29" class="nv mx iv on b gy or os l ot ou">data = pd.read_csv('jj.csv')</span></pre><p id="fabb" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">然后，我们可以显示一个时间序列图:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="d703" class="nv mx iv on b gy or os l ot ou">plt.figure(figsize=[15, 7.5]); # Set dimensions for figure<br/>plt.plot(data['date'], data['data'])<br/>plt.title('Quarterly EPS for Johnson &amp; Johnson')<br/>plt.ylabel('EPS per share ($)')<br/>plt.xlabel('Date')<br/>plt.xticks(rotation=90)<br/>plt.grid(True)<br/>plt.show()</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi ow"><img src="../Images/2b27eea10e8957d429fc014f50bcd6df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_rSv_YS-yCZJJPGlDUVgw.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">强生公司季度每股收益</p></figure><p id="90c5" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">很明显，时间序列不是静态的，因为它的平均值在整个时间内不是恒定的，我们看到数据中的方差在增加，这是<strong class="ld iw">异方差</strong>的标志。</p><p id="8cbf" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">为了确保这一点，让我们绘制 PACF 和 ACF:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="321c" class="nv mx iv on b gy or os l ot ou">plot_pacf(data['data']);<br/>plot_acf(data['data']);</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/fa346f2cdb66192ad2f1db8c7c6ca20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*tDM1ADDqa5kA09RY3DQjXA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">PACF 和 ACF</p></figure><p id="fe85" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">同样，不能从这些图中推断出任何信息。您可以使用扩展的 Dickey-Fuller 测试进一步测试平稳性:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="6801" class="nv mx iv on b gy or os l ot ou">ad_fuller_result = adfuller(data['data'])<br/>print(f'ADF Statistic: {ad_fuller_result[0]}')<br/>print(f'p-value: {ad_fuller_result[1]}')</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/c84a2ecaf991d7a5c3578dfda5e10502.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*sMrifHyFDjHnoJXik9clDw.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">ADF 测试结果</p></figure><p id="bcec" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">由于 p 值很大，我们不能拒绝零假设，必须假设时间序列是非平稳的。</p><p id="14c9" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">现在，让我们取对数差，努力使它保持稳定:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="0ea7" class="nv mx iv on b gy or os l ot ou">data['data'] = np.log(data['data'])<br/>data['data'] = data['data'].diff()<br/>data = data.drop(data.index[0])</span></pre><p id="3b2f" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">绘制新数据应给出:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="0c21" class="nv mx iv on b gy or os l ot ou">plt.figure(figsize=[15, 7.5]); # Set dimensions for figure<br/>plt.plot(data['data'])<br/>plt.title("Log Difference of Quarterly EPS for Johnson &amp; Johnson")<br/>plt.show()</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi oz"><img src="../Images/1dd916277a8c73ea8a47f4b68ad91821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iNbAIE7iHqlkmXEi5sv0Zw.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">强生公司季度每股收益记录表</p></figure><p id="2d78" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">厉害！现在，我们仍然在上面的图中看到季节性。因为我们处理的是季度数据，所以我们的周期是 4。因此，我们将在 4:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="3530" class="nv mx iv on b gy or os l ot ou"># Seasonal differencing</span><span id="04fe" class="nv mx iv on b gy ov os l ot ou">data['data'] = data['data'].diff(4)<br/>data = data.drop([1, 2, 3, 4], axis=0).reset_index(drop=True)</span></pre><p id="b538" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">绘制新数据:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="d881" class="nv mx iv on b gy or os l ot ou">plt.figure(figsize=[15, 7.5]); # Set dimensions for figure<br/>plt.plot(data['data'])<br/>plt.title("Log Difference of Quarterly EPS for Johnson &amp; Johnson")<br/>plt.show()</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pa"><img src="../Images/fa1f7ecbe1250ef4e67b7bf1dbc8f4a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uje-MWCpzCUXskrBtlJpgQ.png"/></div></div></figure><p id="d074" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">完美！请记住，虽然我们在 4 个月的时间内取了差值，但季节差值(D)的顺序是 1，因为我们只取了一次差值。</p><p id="46dc" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">现在，让我们再次运行扩展的 Dickey-Fuller 测试，看看我们是否有一个平稳的时间序列:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="1bd7" class="nv mx iv on b gy or os l ot ou">ad_fuller_result = adfuller(data['data'])<br/>print(f'ADF Statistic: {ad_fuller_result[0]}')<br/>print(f'p-value: {ad_fuller_result[1]}')</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/f54664ceec843903a39701b68da5d4c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*TC6Z46Se-CN5NtKU0aj0-g.png"/></div></figure><p id="ed0d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">事实上，p 值足够小，我们可以拒绝零假设，我们可以认为时间序列是平稳的。</p><p id="74af" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">看看 ACF 和 PACF:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="43a3" class="nv mx iv on b gy or os l ot ou">plot_pacf(data['data']);<br/>plot_acf(data['data']);</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/1ba7b8a50ce5771b6c1d60dd572cb481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*h2kTtXNHn-EkQqkoekL4FA.png"/></div></figure><p id="c7a3" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我们可以从 PACF 中看到，我们在滞后 1 处有一个显著的峰值，这表明 AR(1)过程。此外，我们在滞后 4 处有另一个峰值，表明 1 阶的季节性自回归过程(P = 1)。</p><p id="a67b" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">查看 ACF 图，我们仅在滞后 1 处看到一个显著的峰值，表明存在非季节性 MA(1)过程。</p><p id="37f9" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">尽管这些图可以让我们大致了解正在进行的过程，但最好测试多个场景，并选择产生最低 AIC 的模型。</p><p id="2b8c" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">因此，让我们编写一个函数来测试 SARIMA 模型的一系列参数，并输出一个性能最佳的模型位于顶部的表:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="bd9e" class="nv mx iv on b gy or os l ot ou">def optimize_SARIMA(parameters_list, d, D, s, exog):<br/>    """<br/>        Return dataframe with parameters, corresponding AIC and SSE<br/>        <br/>        parameters_list - list with (p, q, P, Q) tuples<br/>        d - integration order<br/>        D - seasonal integration order<br/>        s - length of season<br/>        exog - the exogenous variable<br/>    """<br/>    <br/>    results = []<br/>    <br/>    for param in tqdm_notebook(parameters_list):<br/>        try: <br/>            model = SARIMAX(exog, order=(param[0], d, param[1]), seasonal_order=(param[2], D, param[3], s)).fit(disp=-1)<br/>        except:<br/>            continue<br/>            <br/>        aic = model.aic<br/>        results.append([param, aic])<br/>        <br/>    result_df = pd.DataFrame(results)<br/>    result_df.columns = ['(p,q)x(P,Q)', 'AIC']<br/>    #Sort in ascending order, lower AIC is better<br/>    result_df = result_df.sort_values(by='AIC', ascending=True).reset_index(drop=True)<br/>    <br/>    return result_df</span></pre><p id="dade" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">请注意，我们将只测试参数 P、P、q 和 q 的不同值。我们知道季节和非季节积分参数都应该是 1，季节长度是 4。</p><p id="6b45" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">因此，我们生成所有可能的参数组合:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="c370" class="nv mx iv on b gy or os l ot ou">p = range(0, 4, 1)<br/>d = 1<br/>q = range(0, 4, 1)<br/>P = range(0, 4, 1)<br/>D = 1<br/>Q = range(0, 4, 1)<br/>s = 4</span><span id="0f0c" class="nv mx iv on b gy ov os l ot ou">parameters = product(p, q, P, Q)<br/>parameters_list = list(parameters)<br/>print(len(parameters_list))</span></pre><p id="e624" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">你应该看到我们有 256 种不同的组合！现在，我们的函数将根据我们的数据拟合 256 种不同的 SARIMA 模型，以找到 AIC 最低的模型:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="f9a9" class="nv mx iv on b gy or os l ot ou">result_df = optimize_SARIMA(parameters_list, 1, 1, 4, data['data'])<br/>result_df</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/d93c23ecbc56bf577641cf7a50b06e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*Vcoj8r0-fnM-AoOLIEvU6g.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">结果表</p></figure><p id="ccd1" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">从表中可以看出，最佳模型是:SARIMA(0，1，2)(0，1，2，4)。</p><p id="fb3b" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我们现在可以拟合模型并输出其摘要:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="f35c" class="nv mx iv on b gy or os l ot ou">best_model = SARIMAX(data['data'], order=(0, 1, 2), seasonal_order=(0, 1, 2, 4)).fit(dis=-1)<br/>print(best_model.summary())</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pe"><img src="../Images/876379f45d77b0d8f4f4804cadc6358f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KwCtO3_mwtO2l6Tgvwln0Q.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">最佳模式总结</p></figure><p id="cff0" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在这里，你可以看到表现最好的模型同时具有季节性和非季节性移动平均过程。</p><p id="3a70" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">根据上面的总结，您可以找到系数的值及其 p 值。请注意，从 p 值来看，所有系数都是显著的。</p><p id="0ce8" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">现在，我们可以研究残差:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="5a98" class="nv mx iv on b gy or os l ot ou">best_model.plot_diagnostics(figsize=(15,12));</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pf"><img src="../Images/b90e6da1025b98c276f0c7744d5f1ad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r4OqfGPim7nKl6V1_qY54g.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">模型诊断</p></figure><p id="a87f" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">从正常的 Q-Q 图，我们可以看到，我们几乎有一条直线，这表明没有系统偏离正常。此外，右下角的相关图表明残差中没有自相关，因此它们实际上是白噪声。</p><p id="3d33" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我们已经准备好绘制模型的预测图，并预测未来:</p><pre class="kl km kn ko gt om on oo op aw oq bi"><span id="8666" class="nv mx iv on b gy or os l ot ou">data['arima_model'] = best_model.fittedvalues<br/>data['arima_model'][:4+1] = np.NaN</span><span id="686c" class="nv mx iv on b gy ov os l ot ou">forecast = best_model.predict(start=data.shape[0], end=data.shape[0] + 8)<br/>forecast = data['arima_model'].append(forecast)</span><span id="2290" class="nv mx iv on b gy ov os l ot ou">plt.figure(figsize=(15, 7.5))<br/>plt.plot(forecast, color='r', label='model')<br/>plt.axvspan(data.index[-1], forecast.index[-1], alpha=0.5, color='lightgrey')<br/>plt.plot(data['data'], label='actual')<br/>plt.legend()</span><span id="ff3a" class="nv mx iv on b gy ov os l ot ou">plt.show()</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pg"><img src="../Images/9ddfe13d1c6869e9fc61c9aeecb9bde5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQwLa1yvmuf0ALadM0HUiA.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">模型预测</p></figure><p id="4cd3" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">瞧啊。</p><h1 id="1fc7" class="mw mx iv bd my mz na nb nc nd ne nf ng kb oj kc ni ke ok kf nk kh ol ki nm nn bi translated">结论</h1><p id="f012" class="pw-post-body-paragraph lb lc iv ld b le no jw lg lh np jz lj lk nq lm ln lo nr lq lr ls ns lu lv lw io bi translated">恭喜你！您现在了解了什么是季节性 ARIMA(或 SARIMA)模型，以及如何使用它进行建模和预测。</p><p id="a340" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">通过以下课程了解有关时间序列的更多信息:</p><ul class=""><li id="c836" class="lx ly iv ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated"><a class="ae la" href="https://www.datasciencewithmarco.com/offers/tdU2mtVK" rel="noopener ugc nofollow" target="_blank">在 Python 中应用时间序列分析</a></li></ul><p id="c624" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">干杯🍺</p></div></div>    
</body>
</html>