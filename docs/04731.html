<html>
<head>
<title>Mapping US Census Data with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 绘制美国人口普查数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mapping-us-census-data-with-python-607df3de4b9c?source=collection_archive---------24-----------------------#2020-04-26">https://towardsdatascience.com/mapping-us-census-data-with-python-607df3de4b9c?source=collection_archive---------24-----------------------#2020-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="2f49" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">公共数据</h2><div class=""/><div class=""><h2 id="f4c7" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">制作纽约州公共交通使用的地图</h2></div><p id="93e7" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如果你曾经想要创建你最喜欢的人口普查统计数据的快速地理可视化，那么你来对地方了！首先，你需要得到你感兴趣的人口普查数据。对于这个例子，我们将使用纽约州的交通数据。</p><h2 id="e3c6" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kx lt lu lv lb lw lx ly lf lz ma mb iw bi translated">数据下载</h2><p id="dbd9" class="pw-post-body-paragraph ko kp iq kq b kr mc ka kt ku md kd kw kx me kz la lb mf ld le lf mg lh li lj ij bi translated">现在您需要导入所需的包。如果你是第一次接触<em class="mh"> censusdata </em>软件包，请花点时间熟悉一下使用<a class="ae mi" href="https://jtleider.github.io/censusdata/" rel="noopener ugc nofollow" target="_blank">优秀文档</a>或这个<a class="ae mi" rel="noopener" target="_blank" href="/accessing-census-data-with-python-3e2f2b56e20d">关于这个主题的介绍性博客</a></p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="3f26" class="lk ll iq mo b gy ms mt l mu mv">import pandas as pd<br/>import censusdata<br/>from tabulate import tabulate</span></pre><p id="8195" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在我们需要下载我们感兴趣的数据。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="4475" class="lk ll iq mo b gy ms mt l mu mv">df = censusdata.download('acs5', <br/>           2015,<br/>           censusdata.censusgeo([('state', '36'), ('county', '*')]),<br/>           ['B08301_001E', 'B08301_010E'])</span></pre><p id="ba29" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">该方法参数的快速分解:</p><ul class=""><li id="cb07" class="mw mx iq kq b kr ks ku kv kx my lb mz lf na lj nb nc nd ne bi translated"><strong class="kq ja">‘ACS 5’</strong>指的是 5 年美国社区调查，并指定我们下载的数据库。</li><li id="1836" class="mw mx iq kq b kr nf ku ng kx nh lb ni lf nj lj nb nc nd ne bi translated"><strong class="kq ja"> 2015 年</strong>是我们获取数据的年份</li><li id="9e44" class="mw mx iq kq b kr nf ku ng kx nh lb ni lf nj lj nb nc nd ne bi translated"><strong class="kq ja">census data . census geo([(' state '，' 36 ')，(' county '，' * '))</strong>定义我们感兴趣的地理位置。“36”值是纽约州的 FIPS(联邦信息处理标准)代码，而“*”表示我们需要每个县。要查找您所在州或县的 FIPS 代码，请参考维基百科页面<a class="ae mi" href="https://en.wikipedia.org/wiki/Federal_Information_Processing_Standard_state_code" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="6921" class="mw mx iq kq b kr nf ku ng kx nh lb ni lf nj lj nb nc nd ne bi translated"><strong class="kq ja"> ['B08301_001E '，' B08301_010E'] </strong>这是我们感兴趣的具体两个表的列表。注意，这些是预先使用<em class="mh"> censusdata 的搜索功能定位的。</em></li></ul><h2 id="b6b9" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kx lt lu lv lb lw lx ly lf lz ma mb iw bi translated">数据帧准备</h2><p id="a2ce" class="pw-post-body-paragraph ko kp iq kq b kr mc ka kt ku md kd kw kx me kz la lb mf ld le lf mg lh li lj ij bi translated">现在，让我们看看数据框中有什么。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="b721" class="lk ll iq mo b gy ms mt l mu mv">print(tabulate(df, headers='keys', tablefmt='psql'))</span></pre><figure class="mj mk ml mm gt nl gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nk"><img src="../Images/791eca45ad75cbddc9855d5adf0cf466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sSjHYqqWHashYzsTtwBXLQ.png"/></div></div></figure><p id="8fe6" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">好的，我们确实在这个表中得到了我们想要的原始信息，但是现在解释起来有点麻烦。例如，这里的 Id 值是<em class="mh"> censusgeo 对象。Y </em> ikes！</p><p id="cc2e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">首先，我们将更改那些表 id 的现有列名，以反映它们的内容。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="0c52" class="lk ll iq mo b gy ms mt l mu mv">column_names = ['total_transpo', 'total_public_transpo']<br/>df.columns = column_names</span></pre><p id="6572" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">接下来，我们将设计一个新列，它只是公共交通的比率。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="4617" class="lk ll iq mo b gy ms mt l mu mv">df['percent_public_transpo'] = df.apply(<br/>   lambda row: row['total_public_transpo']/row['total_transpo'], <br/>   axis = 1)</span></pre><p id="0064" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在我们将在提取县名时重新定义索引。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="9a91" class="lk ll iq mo b gy ms mt l mu mv">new_indices = []<br/>county_names = []</span><span id="b3c2" class="lk ll iq mo b gy ns mt l mu mv">for index in df.index.tolist():<br/>        new_index = index.geo[0][1] + index.geo[1][1]<br/>        new_indices.append(new_index)<br/>        county_name = index.name.split(',')[0]<br/>        county_names.append(county_name)</span><span id="85c1" class="lk ll iq mo b gy ns mt l mu mv">df.index = new_indices<br/>df['county_name'] = county_names</span></pre><p id="ca81" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">好吧，让我们再看看。</p><figure class="mj mk ml mm gt nl gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/a15c4b94eb2263a6381386b645e095cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*wk6kvxPKc_2XHGlvshOueg.png"/></div></figure><p id="e436" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">好多了！现在在地图上</p><h2 id="0a52" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kx lt lu lv lb lw lx ly lf lz ma mb iw bi translated">绘图</h2><p id="f34b" class="pw-post-body-paragraph ko kp iq kq b kr mc ka kt ku md kd kw kx me kz la lb mf ld le lf mg lh li lj ij bi translated">为了进行映射，我们将使用一个名为<a class="ae mi" href="https://plotly.com/python/county-choropleth/" rel="noopener ugc nofollow" target="_blank"><em class="mh">figure _ factory</em></a><em class="mh"/>的特性，它将为我们做很多工作<em class="mh">。</em>所以第一件事就是导入包。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="a65c" class="lk ll iq mo b gy ms mt l mu mv">import plotly.figure_factory as ff</span></pre><p id="bda7" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在创建地图只需要几行代码。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d656" class="lk ll iq mo b gy ms mt l mu mv">fig = ff.create_choropleth(fips=df.index, <br/>                           scope=['New York'],<br/>                           values=df.percent_public_transpo, <br/>                           title='NY Public Transit Use by County', <br/>                           legend_title='% Public Transit')<br/>fig.layout.template = None<br/>fig.show()</span></pre><figure class="mj mk ml mm gt nl gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nu"><img src="../Images/d63f071211339c6cb43fa4cac969000e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DTq-FekbqJgDFhN2nfdDMQ.png"/></div></div></figure><p id="bfdd" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">对于几行代码来说看起来相当不错！但是不要被愚弄了，我们通过以一种与<em class="mh"> figure_factory </em>兼容的方式构建我们的数据框架，努力为我们的成功做好准备。例如，它以<em class="mh">州代码</em> + <em class="mh">县代码的形式接收 FIPS 数据。</em>因此，通过重命名我们的索引来遵循这种形式，我们可以简单地将直接的索引值传递到方法中</p><p id="3e04" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">最后，这张地图中的数据以我们预期的方式分布，一个巨大的热点以纽约市为中心，越往外越淡。</p><p id="e4a2" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这就是它的全部，现在获取映射！</p></div></div>    
</body>
</html>