<html>
<head>
<title>Tidy Data with R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 R 整理数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tidy-data-with-r-f3d078853fc6?source=collection_archive---------43-----------------------#2020-05-10">https://towardsdatascience.com/tidy-data-with-r-f3d078853fc6?source=collection_archive---------43-----------------------#2020-05-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/16dfcc38855adfab3fcdb76d5441dac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4umfu6rCAwm_-fGFQks5JA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来自<a class="ae jg" href="https://stocksnap.io" rel="noopener ugc nofollow" target="_blank"> StockSnap </a>的<a class="ae jg" href="https://stocksnap.io/author/28055" rel="noopener ugc nofollow" target="_blank">山姆·沃克</a>的照片</p></figure><div class=""/><div class=""><h2 id="6682" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">为什么你应该在它上面投资更多，为什么这使你的分析变得容易得多</h2></div><h2 id="8ab7" class="ky kz jj bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">介绍</h2><p id="54e0" class="pw-post-body-paragraph lu lv jj lw b lx ly kk lz ma mb kn mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">在现实世界中，数据并不干净。清理数据是分析前的一个重要步骤，因为我们用于分析的程序不能使用任何不干净的数据，因此我们必须首先清理它。就清理而言，我指的是诸如缺失值、非正态分布、离群值、离散化等。</p><p id="9da4" class="pw-post-body-paragraph lu lv jj lw b lx mn kk lz ma mo kn mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">在我们清理完这些数据后，我们可以用它来进行分析。尽管它已经很干净了，但这并不意味着数据本身已经很整洁了。在本文中，我将向您展示一些不整齐的数据，以及为什么我们应该在进行分析或建模之前先整理数据的原因。</p><h2 id="fa3b" class="ky kz jj bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">为什么？</h2><p id="352d" class="pw-post-body-paragraph lu lv jj lw b lx ly kk lz ma mb kn mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">让我们谈谈为什么。给定这些数据，这是来自约翰·霍普斯金大学的新冠肺炎数据，包括来自世界各国和地区的确诊、死亡和康复病例数。我给你看确认的数据，</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="3617" class="ky kz jj mx b gy nb nc l nd ne">library(readr)<br/>confirmed &lt;- read_csv("<a class="ae jg" href="https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv</a>")<br/>head(confirmed)</span></pre><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nf"><img src="../Images/3ed70457e38dfd5ec8cfb6ca725f1458.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Hi7KHGHKYWKaTfdwjhd7g.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">数据</p></figure><p id="0612" class="pw-post-body-paragraph lu lv jj lw b lx mn kk lz ma mo kn mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">在每一行中，数据都包含从 2020 年 1 月 22 日到最近日期的位置和日期等信息。假设我们有兴趣可视化一个国家的线图，例如印度尼西亚。我们该怎么做？首先，我们确定 x 轴和 y 轴，然后我们可以制作情节，但可笑的是，它并不那么容易，为什么？我们想要的 x 轴，在这个例子中是日期，是数据集的列名。然后，要获取 y 轴，我们必须通过过滤指定数据的位置，然后获取数据上的值，最后绘制一个图。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="d9c2" class="ky kz jj mx b gy nb nc l nd ne">x &lt;- as.Date(colnames(confirmed)[5:length(colnames(confirmed))], format="%m/%d/%y")<br/>y &lt;- confirmed[confirmed$`Country/Region` == "Indonesia", 5:length(colnames(confirmed))]<br/>plot(x, y)</span></pre><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/7c4290a72d2e3c5cf3ec94256b389d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*yX9Z8vMflnoxbzHASup4eg.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">基于代码的情节</p></figure><p id="06d0" class="pw-post-body-paragraph lu lv jj lw b lx mn kk lz ma mo kn mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">这不容易也不吸引人，对吧？这不是一种整洁的分析方式。tidyverse 库，如 ggplot2、tidyr、dplyr 等。支持使用整齐的数据。这就是为什么我们必须先整理数据的原因。因此，我将向您介绍使用 tidyr 整理数据的概念。但是等等，什么是整齐的数据？</p><h2 id="361f" class="ky kz jj bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">什么？</h2><p id="00e5" class="pw-post-body-paragraph lu lv jj lw b lx ly kk lz ma mb kn mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">整齐的数据是一组规则，用于格式化数据集，以便更好地进行分析。规则是:<br/> 1。每个变量都放在它们的列上，<br/> 2。每个观察值被放置在它们的行上，<br/> 3。每个值都放在它们的单元格中</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nh"><img src="../Images/b74f44925511af60b1ccaeb5d9d06035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xrhQm6fw3zcXtMHFxFZTjg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图来自数据科学的<a class="ae jg" href="https://r4ds.had.co.nz/tidy-data.html" rel="noopener ugc nofollow" target="_blank"> R，作者<em class="ni">加勒特·格罗勒蒙德和哈德利·威克姆</em></a></p></figure><h2 id="5665" class="ky kz jj bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">怎么会？</h2><p id="e788" class="pw-post-body-paragraph lu lv jj lw b lx ly kk lz ma mb kn mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">回到我们的数据，数据本身不符合上面的要求。在该示例中，日期变量作为一行放置。然后，每一列由该日期每个国家的值组成。这样，我们必须将日期作为列，然后与之对应的值也成为列。这被称为旋转，我们将数据集从长变高。为此，我们将使用 tidyr 包中的 R 函数 pivot_longer。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="f557" class="ky kz jj mx b gy nb nc l nd ne">library(tidyr)</span><span id="a598" class="ky kz jj mx b gy nj nc l nd ne"><strong class="mx jk"># Pivot the data set</strong><br/>confirmed_tidy &lt;- confirmed %&gt;%<br/>  pivot_longer(5:(length(colnames(confirmed))), names_to = "date", values_to = "total")</span><span id="1aed" class="ky kz jj mx b gy nj nc l nd ne"><strong class="mx jk"># Specify the names of the column</strong><br/>colnames(confirmed_tidy) &lt;- c("province", "country", "lat", "long", "date", "total")</span><span id="915d" class="ky kz jj mx b gy nj nc l nd ne"><strong class="mx jk"># Convert to date format</strong><br/>confirmed_tidy$date &lt;- as.Date(confirmed_tidy$date, format="%m/%d/%y")</span><span id="8b23" class="ky kz jj mx b gy nj nc l nd ne">confirmed_tidy</span></pre><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/0dcd9a3b68ff94e443965e27f243504a.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*-U-BdRxf82ZrH_zUaUpslQ.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">整洁的数据</p></figure><p id="785d" class="pw-post-body-paragraph lu lv jj lw b lx mn kk lz ma mo kn mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">Pivot_longer 函数通过指定列的索引返回一个更高的数据集。整理完数据集后，现在我们可以更容易地进行分析了。我给你举个例子，我想画出这些国家的线图，印度尼西亚，马来西亚，泰国，新加坡和越南。有了这个整洁的数据集，我们可以轻松做到这一点。首先，我们使用 dplyr 库根据东盟国家对其进行过滤，然后我们根据它绘制一个线图，并使用 ggplot2 库根据变量指定每个轴和颜色。代码本身看起来像这样，</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="51fb" class="ky kz jj mx b gy nb nc l nd ne">library(dplyr)<br/>library(ggplot2)</span><span id="1bd1" class="ky kz jj mx b gy nj nc l nd ne">asean &lt;- c("Indonesia", "Singapore", "Vietnam", "Malaysia", "Thailand")</span><span id="01d7" class="ky kz jj mx b gy nj nc l nd ne"><strong class="mx jk"># Filter the data based on the list</strong><br/>confirmed_tidy %&gt;%<br/>  filter(country %in% asean) %&gt;%<br/>  <strong class="mx jk"># Create the plot</strong><br/>  ggplot(aes(x=date, y=total, color=country)) +<br/>  geom_line(size=1.5) +<br/>  ggtitle("COVID-19 Cases", subtitle = "Indonesia, Malaysia, Singapore, Thailand, Vietnam")</span></pre><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/77ec5b2825eb2c7eaf3eb767f66115a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*ECOZ1K_6AlO3MLbfcbN9gQ.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">这个图是根据整理好的数据绘制的</p></figure><p id="fac7" class="pw-post-body-paragraph lu lv jj lw b lx mn kk lz ma mo kn mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">简单明了，不是吗？有了这个例子，我们就没有理由不投入一点时间来使我们的数据更加整洁。有了更整齐的数据，我们就可以很容易地进行分析和建模。</p><h2 id="7633" class="ky kz jj bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">参考资料:</h2><p id="b523" class="pw-post-body-paragraph lu lv jj lw b lx ly kk lz ma mb kn mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">[1] Hadley Wickham 和 Garrett Grolemund，<a class="ae jg" href="https://r4ds.had.co.nz/" rel="noopener ugc nofollow" target="_blank"> R for Data Science: Import，Tidy，Transform，Visualize，and Model Data (2017) </a>，O'Reilly Media，Inc .</p></div></div>    
</body>
</html>