<html>
<head>
<title>Moving averages with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中的移动平均线</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/moving-averages-in-python-16170e20f6c?source=collection_archive---------0-----------------------#2020-07-08">https://towardsdatascience.com/moving-averages-in-python-16170e20f6c?source=collection_archive---------0-----------------------#2020-07-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7565" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">熊猫的简单、累积和指数移动平均线</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e785f96db3a2d9fef7e9fd973dd1fd77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U-cNTr-xZ-goL4FQ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@austindistel" rel="noopener ugc nofollow" target="_blank"> Austin Distel </a>拍摄的照片</p></figure><p id="d69a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">移动平均线</strong>通常与<strong class="lb iu">时间序列</strong>一起使用，以平滑随机的短期变化，并突出显示数据中的其他成分(趋势、季节或周期)。移动平均值也称为<strong class="lb iu">滚动平均值</strong>，通过对 k 个时间段内的时间序列数据进行平均计算得出。<strong class="lb iu">移动平均线</strong>在<strong class="lb iu">金融</strong>中广泛用于确定市场趋势，在<strong class="lb iu">环境工程</strong>中广泛用于评估污染物浓度等环境质量标准。</p><p id="b6eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们简单解释一下最常见的均线类型:(1)<strong class="lb iu">简单均线</strong> (SMA)，(2)<strong class="lb iu">累积均线</strong> (CMA)，(3)<strong class="lb iu">指数均线</strong> (EMA)。此外，我们展示了如何用<strong class="lb iu"> Python </strong>来实现它们。为此，我们使用了来自<strong class="lb iu">公开数据巴塞罗那</strong>的两个数据集，包含巴塞罗那从<strong class="lb iu"> 1786 </strong>到<strong class="lb iu"> 2019 </strong>的<strong class="lb iu">降雨量</strong>和<strong class="lb iu">气温</strong>。</p><p id="0ae7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！💪</p><h1 id="cb77" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据预处理</h1><p id="8247" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在本文中，我们将使用开放数据巴塞罗那中的两个数据集:(1) <strong class="lb iu">巴塞罗那市自 1780 年以来的月平均气温</strong>；以及(2) <strong class="lb iu">巴塞罗那市自 1786 年以来的月累计降雨量。你可以通过以下链接轻松下载。</strong></p><div class="ms mt gp gr mu mv"><a href="https://opendata-ajuntament.barcelona.cat/data/en/dataset/temperatures-hist-bcn" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">巴塞罗那市自 1780 年以来的月平均气温-巴塞罗那公开数据</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">巴塞罗那市自 1780 年以来的月平均气温。温度以摄氏度(°C)为单位。</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">open data-a jument . Barcelona . cat</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj ks mv"/></div></div></a></div><div class="ms mt gp gr mu mv"><a href="https://opendata-ajuntament.barcelona.cat/data/en/dataset/precipitacio-hist-bcn" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">巴塞罗那市自 1786 年以来的月累积降雨量-巴塞罗那公开数据</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">巴塞罗那市自 1786 年以来的月累积降雨量。降水量以毫米为单位。</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">open data-a jument . Barcelona . cat</p></div></div><div class="ne l"><div class="nk l ng nh ni ne nj ks mv"/></div></div></a></div><p id="2c97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从<strong class="lb iu"> Open Data Barcelona </strong>下载两个 CSV 文件后，我们可以使用<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> pandas.read_csv </strong> </a>函数将它们加载到 Pandas 数据框中，并使用<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.head.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> pandas 可视化前 5 行。data frame . head</strong></a><strong class="lb iu"/>方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/3a15f68dd505680308a795526226605d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zai5PfTIpojEsXqJhZaVMw.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/c568b9cebf484441b2c752c97684b97e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WpP-I23MuL650LgNKv8d1w.png"/></div></div></figure><p id="9fc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所示，两个数据集都包含月度数据。</p><p id="37e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集最常见的问题是错误的数据类型和缺失值。我们可以使用<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.info.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">熊猫轻松分析这两者。DataFrame.info </strong> </a>方法。此方法打印数据框的简明摘要，包括列名及其数据类型、非空值的数量、数据框使用的内存量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/212f30024b896f79d74f65465dca3ef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*ljPVe0ZtzcI14EaJsM-pXA.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/057cee794a789e3e2da19cc52b2d0de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*VkbQn6L_ngwvFJw1oTfpOw.png"/></div></figure><p id="f1af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所示，数据集不包含空值，数据类型是预期的类型，因此不需要重要的清理任务；但是，它们包含月度数据，而不是年度值。我们计算年平均气温和年累积降雨量如下。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/a9da70872f992de33a32b2253280e74b.png" data-original-src="https://miro.medium.com/v2/resize:fit:378/format:webp/1*VeZj9Z372Ejba4XrGIP3IA.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/1d05ce3d6e7e4b6a972d4ce870246a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/1*mTVOPmUkudPkjhFxAeVxGg.png"/></div></figure><p id="fb75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们将 year 列设置为数据框的索引。此外，我们已经删除了月度数据，因为我们将在可视化中仅使用年度值。因此，我们有两个数据框，包含(1)巴塞罗那的年平均气温和(2)年累积降雨量。</p><p id="48cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们用线图来显示这两个时间序列。</p><ul class=""><li id="6cb4" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated"><strong class="lb iu">巴塞罗那的年平均气温</strong></li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/665760955a587f0d20e716eff1bdf6fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELOD8nDDmpvc4ZrZr66sDA.png"/></div></div></figure><ul class=""><li id="e2b0" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated"><strong class="lb iu">巴塞罗那的年累积降雨量</strong></li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/356b14be903111ad82cc8cda8f6cd2ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2VHoYjxpvAf8os92PppAg.png"/></div></div></figure><p id="0a52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所观察到的，可视化中有许多波动和噪声，但是我们有一个解决方案来平滑这两个时间序列:移动平均线👐</p><p id="5941" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们深入了解💜</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="594e" class="lv lw it bd lx ly ol ma mb mc om me mf jz on ka mh kc oo kd mj kf op kg ml mm bi translated"><strong class="ak">简单移动平均线</strong></h1><p id="4de3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu">简单移动平均</strong>是前 M 个数据点的<strong class="lb iu">未加权平均值</strong>。M(滑动窗口)的选择取决于所需的平滑量，因为增加 M 的值以精度为代价改善了平滑。</p><p id="fd08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于一系列值，我们计算时间段 t 的<strong class="lb iu">简单移动平均值</strong>如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/79d1493864f5355c0c674c8a30e4befd.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*0LhEYMGJkjH7tO5RKd3iRQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">时间段 t 的简单移动平均线</p></figure><p id="ebec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">计算<strong class="lb iu">简单移动平均线</strong>最简单的方法是使用<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.rolling.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">熊猫。</strong> </a> <strong class="lb iu"> </strong>法连载。该方法提供了数据上的滚动窗口。在生成的窗口中，我们可以使用统计函数(在这种情况下是平均值)进行计算。窗口的大小(周期数)在参数<strong class="lb iu">窗口</strong>中指定。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/4ed38787239b57b0cc28a9ba53434cd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*lQzDibyWCHS1E9VEJfHFcQ.png"/></div></figure><p id="e4cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">返回序列的第一行包含空值，因为滚动至少需要 n 个值(在 window 参数中指定的值)才能返回平均值。我们可以通过修改参数<strong class="lb iu"> min_periods </strong>来改变这种行为，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/68b4f6f0615af7c712ab734725e2a261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*FLCKsDufQ-hLkwGcJrBX6g.png"/></div></figure><p id="b474" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们计算在<strong class="lb iu"> 10 年和 20 年</strong>期间的<strong class="lb iu">简单移动平均值</strong>(窗口大小)，在所有情况下选择最小周期数 1。如下图所示，我们将移动平均值添加到现有数据帧中(<strong class="lb iu"> df_temperature </strong>和<strong class="lb iu">df _ rain</strong>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="ab57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将移动平均值添加到数据帧后，我们使用线图绘制结果。以下图表显示了平均气温和累积降雨量以及<strong class="lb iu"> 10 年和</strong>20 年<strong class="lb iu">移动平均值</strong>。请注意移动平均线是如何平滑数据的，让我们可以正确地看到趋势方向。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/23b94f58844ff2759fe73acfbfbaca64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5R9L5Azv73L1gat3Lznerg.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/aad8981a2b99458bb93f6a9582f32df9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jDMQT5lOVKrb5d_c8yw9uQ.png"/></div></div></figure><p id="fd13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所观察到的，气温呈现上升趋势，自 1975 年以来尤其高。相反，自 1850 年以来，累积降雨量一直保持不变。</p><p id="f5c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我想指出的是，您可以将<strong class="lb iu">滚动方法</strong>与其他<strong class="lb iu">统计功能</strong>一起使用。下表显示了您可以使用<strong class="lb iu">滚动方法</strong>来计算<strong class="lb iu">滚动窗口计算</strong>的一些函数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/5820774bfac1c5171361a497a297c0b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*NKnYagw01lgFGObd8VPakg.png"/></div></figure></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="b745" class="lv lw it bd lx ly ol ma mb mc om me mf jz on ka mh kc oo kd mj kf op kg ml mm bi translated">累积移动平均线</h1><p id="5055" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">累积移动平均值是到当前时间 t 之前的值的未加权平均值<strong class="lb iu"/></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/c48bd8117710942793f8a5cdb37b9f32.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*1Dfj9H32mZb3hxe038QZOQ.png"/></div></figure><p id="49d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">简单移动平均线</strong>有一个恒定尺寸<strong class="lb iu"> M </strong>的<strong class="lb iu">滑动窗口</strong>。相反，当计算<strong class="lb iu">累积移动平均值</strong>时，窗口大小随着时间的推移而变大。</p><p id="150a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.expanding.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">熊猫来计算<strong class="lb iu"> Python </strong>中的累积移动平均值。</strong>编</a>法。这个方法给出了聚合函数的累积值(在这个例子中是平均值)。和以前一样，我们可以用参数<strong class="lb iu"> min_periods </strong>指定返回值所需的最小观察次数(默认值为 1)。</p><p id="4885" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了扩展方法的工作原理。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/1bcf13b753602dcc226e8c2f7371ed57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*2lHKrmuxKfc-9w-LnQPWQQ.png"/></div></figure><p id="167b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所观察到的，扩展方法包括计算中当前行之前的所有行。</p><p id="aafc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们用<strong class="lb iu">熊猫</strong>计算<strong class="lb iu">累积移动平均值</strong>，将结果添加到现有数据帧中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0a08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的图显示了气温和累积降雨量的累积移动平均值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/a2cb6ac6e58d2f2e4f6f73a5202b1633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJwJGf3IY16rqJAxEM0cNg.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/5e10a019193b75271caef49016d80681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*va1Y-kA49lvYHCuHDcmnAA.png"/></div></div></figure><p id="18cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">累积移动平均值</strong>在计算平均值时会考虑所有之前的值。因此，它们不是分析趋势的好选择，尤其是对于长时间序列。<strong class="lb iu">简单移动平均线</strong>更适合此目的。但是，所有数据点的权重相等。为了突出显示最近的观察结果，我们可以使用<strong class="lb iu">指数移动平均线</strong>，它将更多权重应用于最近的数据点，对变化做出更快的反应。</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="144e" class="lv lw it bd lx ly ol ma mb mc om me mf jz on ka mh kc oo kd mj kf op kg ml mm bi translated">指数移动平均线</h1><p id="8a80" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">指数移动平均线是一种广泛使用的过滤噪音和识别趋势的方法。每个元素的权重随着时间的推移而逐渐降低，这意味着指数移动平均给予最近的数据点更大的权重。这是在最近的数据比旧数据更相关的想法下完成的。与<strong class="lb iu">简单移动平均线</strong>相比，<strong class="lb iu">指数移动平均线</strong>对变化反应更快，因为对最近的变动更敏感。</p><p id="f373" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">计算时间段 t 的<strong class="lb iu">指数移动平均线</strong>的代数公式为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/439b5db7273086fde01329d942e463e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*gzC8tdlwaLM3Y1tiaM3xzw.png"/></div></figure><p id="ecee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中:</p><ul class=""><li id="7ed0" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated"><strong class="lb iu"> xₜ </strong>是在时间段<strong class="lb iu"> t. </strong>的观测值</li><li id="1520" class="nt nu it lb b lc ox lf oy li oz lm pa lq pb lu ny nz oa ob bi translated"><strong class="lb iu"> EMAₜ </strong>是时间段<strong class="lb iu"> t. </strong>的<strong class="lb iu">指数移动平均线</strong></li><li id="3061" class="nt nu it lb b lc ox lf oy li oz lm pa lq pb lu ny nz oa ob bi translated"><strong class="lb iu"> α </strong>是<strong class="lb iu">平滑因子。</strong>平滑因子的值介于 0 和 1 之间，表示应用于最近时段的权重。</li></ul><p id="1f12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于指数平滑，Pandas 提供了<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.ewm.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> pandas。</strong>series . ewm</a>方法。我们可以在<strong class="lb iu"> alpha </strong>参数中直接指定平滑因子。或者，我们可以用<strong class="lb iu">质心</strong>、<strong class="lb iu">跨度</strong>或<strong class="lb iu">半衰期</strong>来表示。</p><p id="5a97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了<strong class="lb iu"> ewm 方法</strong>如何计算<strong class="lb iu">指数移动平均</strong>。在这种情况下，我们设置参数<strong class="lb iu"> alpha </strong>等于<strong class="lb iu"> 0.1 </strong>，参数<strong class="lb iu"> adjust </strong>等于<strong class="lb iu"> False </strong>。如您所见，计算中使用了时间段 t-1 的<strong class="lb iu">均线</strong>，这意味着在计算时间段 t 的<strong class="lb iu">均线</strong>时，包括了截至当前时间的所有数据点。但是，最早的数据点对计算的影响最小。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/72f080f66b59f7dd000c700ebd6c69f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*TJ8D3Ur4G6g3xZ0PaA1gaw.png"/></div></figure><p id="e1cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们用平滑因子<strong class="lb iu"> 0.1 和 0.3 </strong>计算<strong class="lb iu">指数移动平均线</strong>。如前所述，我们将移动平均值添加到现有数据帧中(<strong class="lb iu"> df_temperature 和 df _ rain</strong>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="3e81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了平均气温和累积降雨量以及<strong class="lb iu">指数移动平均值</strong>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/95ae7fccddf2343ac85cbce005c74612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tEv7qZFQ-qJfccvdj34yig.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/b066dd9a6dd5738230c351c6313bc2fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pwU2VD4kB1JujLjydozArw.png"/></div></div></figure><p id="a48b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所示，小的加权因子<strong class="lb iu"> α </strong>导致高度平滑，而较大的值提供对最近变化的更快响应。</p><p id="08df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了 15 个数据点的简单移动平均值和指数移动平均值的权重(alpha=0.3，adjust=False)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/d53349fdaa7dae6cc31ae9753d346ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*n2U3idPWgQsZBALWOZGPFw.png"/></div></figure><p id="37a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所观察到的，简单移动平均线对所有数据点的权重相等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/157fab6f8274b85361540ac40e5dc17e.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*Ue_2K0bWY2YrvCJ3NTGgsQ.png"/></div></figure><p id="448d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，指数移动平均线给予最近的数据点更大的权重。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/2cccfe5e6c318ba54238dd7559099b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*ztkNyl-e9ZlLhqOXhDl2wA.png"/></div></figure><p id="d867" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，最后一个重量<strong class="lb iu"> w₁₄ </strong>比<strong class="lb iu"> w₁₃ </strong>高。原因是用于计算最后重量的公式不同，如下所述。</p><p id="0b82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.ewm.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">熊猫。Series.ewm </strong> </a>方法提供了指数权重的两种变体。如果我们设置参数<strong class="lb iu"> adjust=False </strong>，我们将使用代数公式计算指数移动平均线。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/439b5db7273086fde01329d942e463e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*gzC8tdlwaLM3Y1tiaM3xzw.png"/></div></figure><p id="3de0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于时间步长 0、1、2 和 3，我们得到以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/5f1b66d92c9925250aebcff467c0f1db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yo2tjKhSAxRvk4zWUPsJKQ.png"/></div></div></figure><p id="6ac0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所示，这相当于使用权重:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/80dc0998071b6f4f0d37a83548044b2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*N78PquwXJnSmGFu5sDvC4A.png"/></div></figure><p id="7c93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，最后的权重<strong class="lb iu"> i=t </strong>是使用不同的公式计算的，其中<strong class="lb iu"> (1-α)^i </strong>没有乘以<strong class="lb iu"> α。</strong></p><p id="3a11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，如果我们设置<strong class="lb iu"> adjust=True </strong>(默认值)，我们使用权重<strong class="lb iu"> wᵢ=(1-α)^i </strong>来计算指数移动平均，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/e3b47fc472d17af68d165994b7d42d6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*BXodXxGotw61LX-78C6dgA.png"/></div></figure><p id="93cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，使用相同的公式计算所有权重。</p><p id="788d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我想指出的是，指数移动平均线不仅用于过滤噪音和识别趋势，也是处理时间序列时的一种预测方法。用于预测的最佳平滑因子<strong class="lb iu"> α </strong>是最小化<strong class="lb iu"> MSE </strong>(均方误差)的因子。</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="0f28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，<strong class="lb iu"> Pandas </strong>提供了多个内置方法来计算<strong class="lb iu">移动平均值</strong>🙌。<strong class="lb iu">滚动法</strong>提供了数据的滚动窗口，让我们很容易获得<strong class="lb iu">简单移动平均线</strong>。我们可以使用<strong class="lb iu">展开法计算<strong class="lb iu">累积移动平均值</strong>。</strong>扩展窗口将包括计算中当前行之前的所有行。最后，我们可以用<strong class="lb iu"> ewm 方法</strong>计算<strong class="lb iu">指数移动平均线</strong>。要计算其他类型的移动平均线，我们可以只使用 Python 编程，或者使用第三方库，如<strong class="lb iu"> Alpha Vantage。</strong></p><p id="83ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢这篇文章✋</p><p id="aaba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阿曼达💜</p></div></div>    
</body>
</html>