<html>
<head>
<title>Conda + Google Colab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Conda + Google Colab</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/conda-google-colab-75f7c867a522?source=collection_archive---------1-----------------------#2020-06-12">https://towardsdatascience.com/conda-google-colab-75f7c867a522?source=collection_archive---------1-----------------------#2020-06-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5764" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Google Colab时安装Conda的指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b9a38ae25d73cb1f6bf1c74138c614a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7FNl6aNMHOPusRLxE6hdlw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">让Conda在Google Colab上工作有点乏味，但如果你不能与pip相处，这是必要的。<a class="ae ky" href="https://pixabay.com/users/geralt-9301/" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="7c5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.conda.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Conda </a>是许多流行的数据科学工具的推荐环境和包管理解决方案，包括<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/install.html" rel="noopener ugc nofollow" target="_blank"> Pandas </a>、<a class="ae ky" href="https://scikit-learn.org/stable/install.html" rel="noopener ugc nofollow" target="_blank"> Scikit-Learn </a>、<a class="ae ky" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>、<a class="ae ky" href="https://rapids.ai/" rel="noopener ugc nofollow" target="_blank"> NVIDIA Rapids </a>和许多其他工具。Conda还大大简化了安装流行的深度学习工具的过程，如<a class="ae ky" rel="noopener" target="_blank" href="/installing-tensorflow-bcbe6ef21213"> TensorFlow </a>。</p><p id="7d99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank"> Google Colab </a>是一项免费服务，通过与Jupyter笔记本<em class="lv">非常</em>相似的用户界面提供交互式计算资源，运行在谷歌云平台(GCP)上，并提供对GPU和TPU的免费访问。Google Colab是一个很棒的教学平台，也可能是唯一一个与你的同行共享GPU或TPU加速代码的免费解决方案。不幸的是，Conda在Google Colab上默认是不可用的，在Google Colab的默认Python环境中安装并正常工作Conda有点麻烦。</p><p id="a3cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将向您介绍我在Google Colab中工作时需要使用Conda安装包时所经历的过程。</p><h1 id="8355" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">预赛</h1><p id="94e6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">首先，您需要确认Google Colab中默认使用的是哪种Python。运行以下命令将返回默认Python可执行文件的绝对路径。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d2aa" class="my lx it mu b gy mz na l nb nc">!which python # should return /usr/local/bin/python</span></pre><p id="de24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在检查这个默认Python的版本号。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="6346" class="my lx it mu b gy mz na l nb nc">!python --version</span></pre><p id="4c9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在编写时，上述命令返回<code class="fe nd ne nf mu b">Python 3.6.9</code>。这意味着，为了使用所有预装的Google Colab包，您需要安装一个默认情况下与Python 3.6兼容的Miniconda版本。默认情况下，Miniconda的最新版本(即4.5.12+)面向Python 3.7或Python 3.8。针对Python 3.6的Miniconda的最新版本是Miniconda 4.5.4，因此这是您应该安装的版本。</p><p id="d092" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，检查是否已经设置了<code class="fe nd ne nf mu b">PYTHONPATH</code>变量。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="267a" class="my lx it mu b gy mz na l nb nc">!echo $PYTHONPATH</span></pre><p id="8cb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在编写这个命令时，它只返回<code class="fe nd ne nf mu b">/env/python</code>(奇怪的是，这个目录似乎并不存在于Google Colab文件系统中)。</p><p id="1fe8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常情况下，在安装Miniconda之前取消设置<code class="fe nd ne nf mu b">PYTHONPATH</code>变量是一个好主意，因为如果通过<code class="fe nd ne nf mu b">PYTHONPATH</code>中包含的目录安装和访问的软件包与Miniconda中包含的Python版本不兼容，这可能会导致问题。</p><p id="fdd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用以下命令取消设置<code class="fe nd ne nf mu b">PYTHONPATH</code>变量。这一步是可选的，但是如果你不取消设置这个变量，那么你会在安装Miniconda后看到一个警告消息。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="55ac" class="my lx it mu b gy mz na l nb nc">%env PYTHONPATH=</span></pre><h1 id="fbdf" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">安装Miniconda</h1><p id="f2f4" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">当在Google Colab单元中执行时，下面的代码将下载Miniconda适当版本的安装程序脚本，并将其安装到<code class="fe nd ne nf mu b">/usr/local</code>中。直接安装到<code class="fe nd ne nf mu b">/usr/local</code>，而不是默认位置<code class="fe nd ne nf mu b">~/miniconda3</code>，确保Conda及其所有必需的依赖项在Google Colab中自动可用。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="1ea3" class="my lx it mu b gy mz na l nb nc">%%bash</span><span id="d3df" class="my lx it mu b gy ng na l nb nc">MINICONDA_INSTALLER_SCRIPT=<a class="ae ky" href="https://repo.continuum.io/miniconda/Miniconda3-$MINICONDA_VERSION-Linux-x86_64.sh" rel="noopener ugc nofollow" target="_blank">Miniconda3-4.5.4-Linux-x86_64.sh</a><br/>MINICONDA_PREFIX=/usr/local<br/>wget <a class="ae ky" href="https://repo.continuum.io/miniconda/Miniconda3-$MINICONDA_VERSION-Linux-x86_64.sh" rel="noopener ugc nofollow" target="_blank">https://repo.continuum.io/miniconda/</a>$MINICONDA_INSTALLER_SCRIPT<br/>chmod +x $MINICONDA_INSTALLER_SCRIPT<br/>./$MINICONDA_INSTALLER_SCRIPT -b -f -p $MINICONDA_PREFIX</span></pre><p id="aea5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你安装了Miniconda，你应该能够看到conda可执行文件是可用的…</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="9382" class="my lx it mu b gy mz na l nb nc">!which conda # should return /usr/local/bin/conda</span></pre><p id="abf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">…并且版本号是正确的。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="cca5" class="my lx it mu b gy mz na l nb nc">!conda --version # should return 4.5.4</span></pre><p id="d691" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，虽然安装Miniconda似乎不会影响Python可执行文件…</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="b890" class="my lx it mu b gy mz na l nb nc">!which python # still returns /usr/local/bin/python</span></pre><p id="e726" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">…然而，Miniconda实际上安装了一个略有不同的Python版本。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="df6f" class="my lx it mu b gy mz na l nb nc">!python --version # now returns Python 3.6.5 :: Anaconda, Inc.</span></pre><h1 id="936f" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">更新Conda</h1><p id="eccd" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">既然您已经安装了Conda，那么您需要将Conda及其所有依赖项更新到最新版本<em class="lv">，而不需要</em>将Python更新到3.7(或3.8)。下面的<code class="fe nd ne nf mu b">conda install</code>命令实际上是<em class="lv">将</em> Conda更新到最新版本，同时保持Python版本固定在3.6。然后,<code class="fe nd ne nf mu b">conda update</code>命令将Conda的所有依赖项更新到最新版本。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="7afd" class="my lx it mu b gy mz na l nb nc">%%bash</span><span id="bd7a" class="my lx it mu b gy ng na l nb nc">conda install --channel defaults conda python=3.6 --yes<br/>conda update --channel defaults --all --yes</span></pre><p id="88b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以通过检查Conda的版本号来确认更新。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="505e" class="my lx it mu b gy mz na l nb nc">!conda --version # now returns 4.8.3</span></pre><p id="6e09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，请注意Python版本再次发生了变化。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0fcf" class="my lx it mu b gy mz na l nb nc">!python --version # now returns Python 3.6.10 :: Anaconda, Inc.</span></pre><h1 id="84c2" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">追加到<code class="fe nd ne nf mu b">sys.path</code></h1><p id="8e4c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在您已经安装了Miniconda，您需要将conda将安装包的目录添加到Python在查找要导入的模块时将搜索的目录列表中。通过检查<code class="fe nd ne nf mu b"><a class="ae ky" href="https://docs.python.org/3/library/sys.html" rel="noopener ugc nofollow" target="_blank">sys.path</a></code>，您可以看到Python在查找要导入的模块时将搜索的当前目录列表。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="224e" class="my lx it mu b gy mz na l nb nc">import sys</span><span id="2487" class="my lx it mu b gy ng na l nb nc">sys.path</span></pre><p id="7104" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在撰写本文时，Google Colab上的<code class="fe nd ne nf mu b">sys.path</code>如下所示。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="7c22" class="my lx it mu b gy mz na l nb nc">['',  <br/> '/env/python',<br/> '/usr/lib/python36.zip',<br/> '/usr/lib/python3.6',<br/> '/usr/lib/python3.6/lib-dynload',<br/> '/usr/local/lib/python3.6/dist-packages', # pre-installed packages<br/> '/usr/lib/python3/dist-packages',<br/> '/usr/local/lib/python3.6/dist-packages/IPython/extensions',<br/> '/root/.ipython']</span></pre><p id="0439" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，Google Colab附带的预安装软件包安装在<code class="fe nd ne nf mu b">/usr/local/lib/python3.6/dist-packages</code>目录中。您可以通过简单地列出这个目录的内容来了解哪些包是可用的。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="04d2" class="my lx it mu b gy mz na l nb nc">!ls /usr/local/lib/python3.6/dist-packages</span></pre><p id="b98e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你用Conda安装的任何包都将被安装到目录<code class="fe nd ne nf mu b">/usr/local/lib/python3.6/site-packages</code>中，所以你需要把这个目录添加到<code class="fe nd ne nf mu b">sys.path</code>中，以便这些包可以被导入。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f76b" class="my lx it mu b gy mz na l nb nc">import sys</span><span id="45f3" class="my lx it mu b gy ng na l nb nc">_ = (sys.path<br/>        .append("<!-- -->/usr/local/lib/python3.6/site-packages"))</span></pre><p id="4ed1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，因为包含预装Google Colab软件包的<code class="fe nd ne nf mu b">/usr/local/lib/python3.6/dist-packages</code>目录出现在Conda安装包的<code class="fe nd ne nf mu b">/usr/local/lib/python3.6/site-packages</code>目录之前，所以通过Google Colab获得的软件包版本将优先于通过Conda安装的同一软件包的任何版本。</p><h1 id="7562" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">安装软件包</h1><p id="8f64" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在你需要做的就是安装你喜欢的软件包。只要记住在安装软件包时包含<code class="fe nd ne nf mu b">--yes</code>标志，以避免提示确认软件包计划。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="6010" class="my lx it mu b gy mz na l nb nc">!conda install --channel conda-forge featuretools --yes</span></pre><h1 id="50d0" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">摘要</h1><p id="cb5b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在本文中，当我需要使用conda来管理Google Colab上的包时，我介绍了安装和配置Miniconda的过程。希望这能在你下次需要在Google Colab上分享Conda管理的数据科学项目时有所帮助。</p></div></div>    
</body>
</html>