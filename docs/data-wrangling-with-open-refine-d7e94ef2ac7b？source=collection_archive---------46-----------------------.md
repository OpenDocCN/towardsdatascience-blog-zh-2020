# 与 Open Refine 的数据争论

> 原文：<https://towardsdatascience.com/data-wrangling-with-open-refine-d7e94ef2ac7b?source=collection_archive---------46----------------------->

![](img/605ee8586fff3d8bb80a16f9d25f1353.png)

马库斯·斯皮斯克拍摄的照片

大多数时候，当我们听到数据争论时，我们会想到使用 Python 或其他语言进行数据清理和操作。在大多数现实生活中，数据是如此的杂乱或庞大，以至于用一种语言来清理会感觉非常手工和痛苦。

Open Refine 是 Google 的一个免费开源工具，它可以清理杂乱的数据，将数据从一种格式转换为另一种格式，并使用其他 web 服务扩展数据。Open Refine 也可以在本地使用，所以你不用担心你的数据会泄露给公众。

在本文中，我们将介绍一个虚构的阳光药店的数据争论过程，该药店陈述了不同药物的销售情况。我们希望使用 Open Refine 来清理当前数据，使其具有标题:产品 ID、产品名称、包装类型、数量。转让和价格。

[](https://drive.google.com/file/d/1wtdsf4R-2V1Gc2Jca4vm9Ln3Puvk720y/view?usp=sharing) [## 阳光药房销售数据. xlsx

drive.google.com](https://drive.google.com/file/d/1wtdsf4R-2V1Gc2Jca4vm9Ln3Puvk720y/view?usp=sharing) 

从上面的表格中，我们看到数据相当混乱。数据面临的一些挑战包括:

1.  不正确的标题名称
2.  不规则数据— (1，200)在假定的`Tranf. Quantity`列中。
3.  表中嵌入了不需要的数据，例如，表中有我们不感兴趣的药店分支和每个分支的总销售额。

# 开放式精炼装置

Open Refine 可以在 Windows、Linux 和 Mac 上运行。要获得安装说明，请查看[安装页面](https://github.com/OpenRefine/OpenRefine/wiki/Installation-Instructions)了解所有细节。

一旦安装并运行了它，您应该会在浏览器上看到这样一个页面:

![](img/81599bb89b15f09ecfcd7c16a8878705.png)

打开优化起始页(图片由作者提供)

从这个起始页，您可以通过导入杂乱的数据来创建一个项目。请注意，数据可以是我们已经熟悉的形式— `csv`、`json`、`xls`、`xlsx`等。此外，您可以从多个来源获取数据，如您的计算机、URL、数据库等。让我们从计算机上的文件浏览器导入阳光药房数据，然后单击“下一步”。

![](img/80a892e921f5042be6331e97e318ee19.png)

项目创建前的格式设置(图片由作者提供)

在创建项目之前，Open Refine 向我们展示了项目的预览，以便我们在开始项目之前进行一些更改。如果我们注意，我们会注意到列标题是不正确的。我们将从这里开始清理我们的数据。当前的标题似乎没有用，所以如果我们删除它们，我们不会丢失任何重要的数据。同样，在第 2 行，我们可以得到更好的列标题，所以我们让 Open Refine 使用第 2 行的数据作为我们的列标题。我们可以通过以下方式做到这一点:

![](img/68062280275c09308deae25c01e5dcaa.png)

忽略项目中的前两行(图片由作者提供)

通过将`ignore first`选项更新为 2，忽略前 2 行，并且`Parse next`选项框使用第 2 行的数据作为新的列标题。

![](img/cb01bb9e5d6d0bd9937d1292213c44e1.png)

更新的列标题(作者图片)

这些列被更新了，尽管不正确，但它已经大大改善了我们数据的外观。我们将在进行过程中修改列标题。另外，请注意，数字周围的括号已被自动删除，数字已被转换为数字(绿色)。现在，我们可以通过单击 Create Project 按钮来创建项目。

![](img/638b7ea24f9009f8bf3c24b56906e1de.png)

新项目表(图片由作者提供)

我们现在有一个新项目。请注意，它在顶部显示了总行数。此外，每页最多只能显示 50 行，最少只能显示 5 行。这是所有奇迹发生的地方。让我们跳进来吧！

# 将日期提取到它自己的列中

我们首先将第一列中的日期提取到它自己的一列中——`dates`列。在 Open Refine 中，我们可以通过在第一列的基础上创建一个新列来实现这一点。

![](img/95880536ca1926ad8ad94e618e3759e3.png)

基于另一列添加列(按作者排序的图像)

通过点击列标题上的插入符号，我们得到选项`Edit column`，然后选择`Add column based on this column`。这就是 Open Refine 变得非常有趣的地方，您可以编写代码来过滤这个非常混乱的列，以获得日期并将它们放在另一列中。

![](img/235c726ced13876570addd95995423db.png)

使用 GREL 过滤日期列(作者图片)

从上图中，我们给新列命名为`Date`，然后继续使用通用精炼表达式语言来过滤该列。如你所见，它非常简单和干净。由于我们正在处理的工作表是针对三月份的，我们要求如果第一列中的任何一行包含单词“Mar ”,那么该列中的数据应该被复制到新的`Date`列中。点击 OK，看看我们做了什么。

![](img/85feb9bdeb4e6fff77103ecf0a59bb42.png)

符合要求的行将被复制到新列中(图片由作者提供)

我们的过滤器工作了，带有日期的行被移动到`Date`列。我们仍然需要对`Date`列进行一些清理，因为我们仍然有许多空白和不需要的行。另外，请注意，我必须移动 4 页才能看到第 190 行上的第一个日期。

# 在日期栏中填写

接下来，我们要做的是对新的`Date`列进行填充。向下填充用任何正好在它上面的数据填充空白行。此举将有助于填补我们的空白行。

![](img/490417545a3d41c7aa72fcb48f0e122a.png)

在日期栏中向下填充(作者图片)

单击`Date`列标题上的插入符号，选择编辑单元格选项，然后单击向下填充选项。最初，如果您在表单的第一页上，您可能看不到任何更改。这是因为在第 190 行之前,`Date`列中没有数据，所以让我们在接下来的几页中检查一下。

![](img/fd6ef26883eeb77d33126646397b3b93.png)

填写日期栏(图片由作者提供)

我们可以有把握地假设第一列中的标题将用于`Date`列中的第一个日期。此外，由于我们之前已经填充了该列，该列中剩余的空白单元格将用于第一个日期。因此，让我们用 2020 年 3 月 2 日星期一**来填充空白处。**我们将通过使用**文本刻面**来做到这一点。文本方面获取列中的每个唯一值，并显示它们的频率。点击日期标题上的插入符号，并选择 **Facet - > Text Facet。**

![](img/10ca72904e41920f00197e94f83f5a12.png)

在日期列上做文本方面(图片由作者提供)

![](img/bf54a4781cfd5fde01bb4e491c520081.png)

日期列上的文本方面(作者图片)

您可以在`Date`列中看到各种不同的条目及其频率。但是，我们对空白单元格感兴趣，因此我们可以填写第一个日期。让我们向下滚动文本方面以查看空白单元格。

![](img/220b922e9789aa8f57b7445d207ed24a.png)

频率为 188 的空白单元格(图片由作者提供)

单击(空白)链接，只过滤那些在`Date`列中有空白单元格的记录。您会看到所有记录都是在 2020 年 3 月 3 日星期二之前的。现在，让我们编辑空白并填入正确的日期。将鼠标悬停在(空白)链接上以查看并单击编辑链接。

![](img/badcd77e82f0d8e0345e97d5b4dce764.png)

编辑空白单元格的编辑链接(作者图片)

这将弹出一个提示，让您填写想要的值。我们将输入`Monday, 02 Mar 2020`并点击**应用**。您可以看到，更新后我们有 0 个匹配行，因为在该列中不再有任何空白单元格。关闭日期方面以再次查看整个数据表。

![](img/60942b7e3b1a3110e63a80b463e5eaee.png)

编辑空白单元格(作者图片)

# 清理列和列标题

让我们重新命名我们的标题，让我们对我们的数据有一个更清晰的概念。在开始，我提到我们希望这个数据有列:发布日期、产品 ID、产品名称、包装类型、数量。Transf。和价格。我们将从重命名第一列开始。让我们从第一列开始。点击第一个标题上的插入符号，并选择**编辑列- >重命名该列**。这将显示重命名列的提示。

![](img/9a72de787376d2c879411e8e667fdb27.png)

重命名第一列(作者图片)

我们也将对日期列进行同样的操作。我们将把该列的名称改为`Post Date`。产品代码看起来像是保存了药品名称的数据，所以我们称之为`Product Name`。列 Product/Name 包含药物的价格，因此我们将其重命名为`Price`。Curr。成本价列保存售出的数量，因此我们将其重命名为`Qty Transf.`。我们不需要运输。数量，转移。价值和剩余数量。我们将删除 Transf。数量和转移。首先通过点击标题上的插入符号并选择**编辑列- >移除此列**来获取值。我们可以将最后一列“剩余数量”重命名为`Packing Type`。

![](img/4e607801ad53e1a419e9341f5287cb78.png)

重命名的列(作者图片)

我们已经重命名了列，但是它仍然不在需求的排列中。我们将从`Product ID`开始。点击插入符号并选择**编辑列- >右移列。**这会将列移动到发布日期之后。

![](img/d7ff3f2cb0f65723fb022e54f85c5189.png)

向右移动产品 ID(作者图片)

我们将通过单击标题上的插入符号将`Price`列移动到工作表的末尾，选择**编辑列- >将列移动到末尾**。最后，我们将`Qty Transf.`向右移动，就像我们之前对`Product ID`所做的那样。

![](img/6103f1268a0411b4d1ec8ae795c14ec0.png)

清理和重新排列后的标题(图片由作者提供)

# 删除不需要的数据

我们已经清理了标题，现在，我们清理数据。从第一行中，我们可以看到该行不合适，因为该行中没有产品名称、数量或价格数据。在我们的 6360 记录中有许多这样的行，我们必须清理它们。我们可以通过找到列中的空白单元格来做到这一点。我们将从产品名称开始。我们使用文本方面来获取空白单元格，就像我们对`Post Date`列所做的那样。然后，我们单击(空白)值，只过滤列中的空白单元格。

![](img/3ad1f16f1d1eee1a865618bf25a45fdd.png)

产品名称的空白单元格(作者图片)

如果我们仔细观察过滤后的数据，我们会发现这些行是阳光药房不同分支机构的标题。我们不需要这些数据，因此我们将删除匹配的行。我们通过点击 **All** 列上的插入符号并选择**Edit rows->Remove All matching rows**来实现这一点。

![](img/e5f56a0a53d47a5d16d7a8be84dcc562.png)

删除与空白产品 id 匹配的行(按作者排序的图片)

这删除了 103 个不需要的记录，这是我们的方式负载污垢。让我们检查其他列，看看我们是否可以看到更多的空白。我们对`Qty Transfer.`和`Price`做同样的事情。对于`Qty Transf.`，我们做了文本方面，我们注意到我们也有空白和一些应该有数字的列中的文本。检查后，我们看到文本也是数据中的标题，我们不需要，空白代表的行是为了显示每日总销售额，我们也不希望在这里。我们将删除它们，就像我们删除`Product Name`列一样。

![](img/3c064f32bf61db211aedb17746d72dac.png)

28 行匹配空白数量转换。单元格(作者图片)

![](img/670c60090909faae34023b4c33485eb0.png)

26 行匹配数量转换中不需要的数据。专栏(作者图片)

对于`Price`列，除了一个有趣的大数字之外，一切看起来都很好，这个数字代表了这个月的总销售额。我们不需要它，所以我们会像以前一样删除它。

![](img/db90a70ef47517ce27fb83c7f015bc2f.png)

删除代表总计的行(作者图片)

现在我们已经删除了所有不需要的行和列，一切看起来都很整洁。

![](img/889743c788d6045f0bd7851a983f3720.png)

清理数据集(图片由作者提供)

我们完了。这看起来真棒，你已经走了很长的路。您可能需要做一些调整，比如将负数改为正数，使用 GREL 将日期改为典型的`mm/dd/yyyy`格式。我把它留给你去玩。

Open Refine 非常容易用来清理非常大的数据集，特别是如果你不是程序员或者不想经历用编程语言清理的恐惧。

我希望这有所帮助。感谢阅读。