<html>
<head>
<title>Visualise COVID-19 case data using Python, Dash, and Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python、Dash和Plotly可视化新冠肺炎案例数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualise-covid-19-case-data-using-python-dash-and-plotly-e58feb34f70f?source=collection_archive---------8-----------------------#2020-03-18">https://towardsdatascience.com/visualise-covid-19-case-data-using-python-dash-and-plotly-e58feb34f70f?source=collection_archive---------8-----------------------#2020-03-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5af0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">立即创建您自己的仪表板Web应用程序！</h2></div><p id="05ff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章不是关于新冠肺炎，而是关于如何使用<strong class="kk iu"> Python &amp; Dash </strong>创建一个<strong class="kk iu">有用的</strong> web应用程序。它旨在作为一个简单的指南，帮助&amp;掌握这项技术，并让<strong class="kk iu">自己动手</strong>！</p><p id="f73a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">我写了很多关于如何使用R &amp; Shiny </em>  <em class="le">执行这个任务的</em> <a class="ae lf" rel="noopener" target="_blank" href="/create-a-coronavirus-app-using-r-shiny-and-plotly-6a6abf66091d"> <em class="le">相同的文章，并有意想要比较这两个软件栈。在这里我用Python-Dash的方式解释一下，不过我计划在</em> <strong class="kk iu"> <em class="le">的另一篇</em> </strong> <em class="le">中做一个</em> <strong class="kk iu"> <em class="le">的专用比较</em> </strong> <em class="le">的解决方案。</em></a></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/3366fdd8cdd9188420ba3464340b6e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a93eF5dmjXVCeWq9PuljKg.jpeg"/></div></div></figure><p id="69c7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要了解最终的应用程序是什么样子，请测试该应用程序:</p><blockquote class="ls lt lu"><p id="84a9" class="ki kj le kk b kl km ju kn ko kp jx kq lv ks kt ku lw kw kx ky lx la lb lc ld im bi translated"><a class="ae lf" href="https://go.aws/2xsdb7q" rel="noopener ugc nofollow" target="_blank">https://go.aws/2xsdb7q</a></p></blockquote><p id="97c5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的<strong class="kk iu">分步指南</strong>解释了如何创建这个web应用程序，包括交互情节。软件栈基于<strong class="kk iu"> Python &amp; Dash </strong>，并且是开源的。总共只有大约130行代码。</p><p id="2e17" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">顺便说一句，本文底部提供了一个链接，链接到<strong class="kk iu"> GitHub </strong> <strong class="kk iu">代码</strong>库供下载。</p><h1 id="c42f" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">目标</h1><p id="d4cc" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">目标是创建一个<strong class="kk iu"> web应用程序</strong>，它在应用程序启动时更新新冠肺炎案例数据，并在仪表板上显示数据。特点:</p><ul class=""><li id="2129" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated">冠状病毒官方可用数据的下载和解析。</li><li id="d37d" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">下拉菜单选择国家和州。</li><li id="0da5" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">显示所选国家新的和累积的病例统计数据的两个图。可以选择确诊病例、痊愈病例、死亡病例。</li></ul><h1 id="c1ae" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">任务</h1><ol class=""><li id="5fcc" class="mv mw it kk b kl mq ko mr kr nj kv nk kz nl ld nm nb nc nd bi translated">设置Python和Visual Studio代码。</li><li id="a553" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld nm nb nc nd bi translated">设置Python项目及其文件夹结构。</li><li id="1137" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld nm nb nc nd bi translated">实现加载和预处理数据的逻辑。</li><li id="e5ec" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld nm nb nc nd bi translated">使用Dash &amp; Plotly创建用户界面。</li><li id="4690" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld nm nb nc nd bi translated">添加服务器逻辑。</li><li id="108e" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld nm nb nc nd bi translated">[可选]将应用程序上传到云。</li></ol></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="11af" class="ly lz it bd ma mb nu md me mf nv mh mi jz nw ka mk kc nx kd mm kf ny kg mo mp bi translated">设置Python和Visual Studio代码</h1><p id="9b97" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">首先，从<a class="ae lf" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank">https://www.python.org/downloads/</a>下载<strong class="kk iu"> Python </strong>的最新稳定版，启动安装程序并通过。</p><p id="443b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于代码编辑器的选择，有很多可能性。<strong class="kk iu"> Visual Studio代码</strong>是一个有效选项。要安装它，从<a class="ae lf" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank">https://code.visualstudio.com/download</a>下载安装程序，运行它，完成安装。</p><h1 id="d692" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">设置Python项目及其文件夹结构</h1><p id="c976" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">Python中的包管理有多种解决方案:<em class="le"> pip </em>、<em class="le"> pipenv </em>、<em class="le"> (ana)conda </em>和<em class="le">虚拟环境</em>。如需快速解释，请参见本文<a class="ae lf" rel="noopener" target="_blank" href="/guide-of-choosing-package-management-tool-for-data-science-project-809a093efd46">中的帖子</a>。我们在这里使用<a class="ae lf" href="https://docs.python.org/3/tutorial/venv.html" rel="noopener ugc nofollow" target="_blank"> <em class="le">虚拟环境</em> </a>。</p><p id="3889" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">仍然在命令行上，移动到应用程序应该位于的目录。然后创建一个新的app目录和一个<strong class="kk iu">虚拟环境</strong>:</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="1bfa" class="oe lz it oa b gy of og l oh oi">cd &lt;folder-with-my-apps&gt;   # Put here the folder of your choice.<br/>mkdir corona-app           # Create a dedicated app directory.<br/>cd corona-app              <br/>virtualenv venv            # Create the virtual environment 'venv'.</span></pre><p id="aa54" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，激活虚拟环境。在<strong class="kk iu"> <em class="le"> macOS </em> </strong>和<strong class="kk iu"> <em class="le"> Linux </em> </strong>上，做:</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="c6f9" class="oe lz it oa b gy of og l oh oi">source venv/bin/activate</span></pre><p id="bf41" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<strong class="kk iu"> <em class="le">窗口的</em> </strong>上，输入:</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="0034" class="oe lz it oa b gy of og l oh oi">venv\Scripts\activate</span></pre><p id="1a58" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要将软件包安装到新环境中，请键入:</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="ef33" class="oe lz it oa b gy of og l oh oi">pip install dash      # Installs &lt;plotly&gt;, too.<br/>pip install pandas</span></pre><p id="5ac8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在打开Visual Studio代码。在欢迎屏幕的右上角(自定义-&gt;工具和语言)，您可以选择Python来安装对Python 的<strong class="kk iu">语言支持:</strong></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi oj"><img src="../Images/3491951409231cba830e2090e814b4b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lDdrot6f4CaOmrjLMKS-NQ.png"/></div></div></figure><p id="5449" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">仍在欢迎屏幕上，点击左侧的“<em class="le">打开文件夹……”</em>，并选择您之前创建的文件夹(<em class="le"> corona-app </em>):</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/cb303e7d0c2db5a7e735aa954d26993b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*Z_6yhGqZpxeU3-_m-FEBWA.png"/></div></figure><p id="6bdf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">关于设置和定制VS代码的更多细节，请看这个专门的<a class="ae lf" href="https://code.visualstudio.com/docs/python/python-tutorial" rel="noopener ugc nofollow" target="_blank">教程</a>。下一步是创建文件<em class="le"> app.py </em>，其中将包含我们需要的所有app代码。点击文件浏览器上的加号按钮，输入文件名。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ol"><img src="../Images/f51bb1c045b4510d22a9cca096582876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ejWqlCJ7sP5qGWJIrFw55g.png"/></div></div></figure><p id="0a36" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以开始编码了！</p><h1 id="0300" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">实现加载和预处理数据的逻辑</h1><p id="93f9" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">在Visual Studio代码中，如果文件尚未打开，请单击文件名“app.py”。键入下面几行来加载我们需要的库:</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="647c" class="oe lz it oa b gy of og l oh oi">import dash<br/>import dash_core_components as dcc<br/>import dash_html_components as html<br/>import plotly.graph_objects as go<br/>from dash.dependencies import Input, Output<br/>import pandas as pd</span></pre><p id="f95f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，定义一个<em class="le"> baseURL </em>，我们从其中下载国家和地区的冠状病毒病例数据。<strong class="kk iu">数据</strong>位于<strong class="kk iu">约翰霍普金斯系统科学与工程中心(JHU/CSSE) </strong>的服务器上。函数<em class="le"> loadData </em>处理下载和一些基本的转换，如下所述。</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="1554" class="oe lz it oa b gy of og l oh oi">baseURL = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/"</span><span id="b278" class="oe lz it oa b gy om og l oh oi">def loadData(fileName, columnName):<br/>    data = pd.read_csv(baseURL + fileName) \<br/>             .drop(['Lat', 'Long'], axis=1) \<br/>             .melt(id_vars=['Province/State', 'Country/Region'], <br/>                 var_name='date', value_name=columnName) \<br/>             .astype({'date':'datetime64[ns]', columnName:'Int64'}, <br/>                 errors='ignore')<br/>    data['Province/State'].fillna('&lt;all&gt;', inplace=True)<br/>    data[columnName].fillna(0, inplace=True)<br/>    return data</span></pre><p id="8e87" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le"> read_csv </em>从网上下载文件，转换成<a class="ae lf" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> <em class="le">熊猫</em> </a> <em class="le">数据帧</em>。地理坐标被<em class="le">删除；</em> <em class="le">熔化</em>将<em class="le">数据帧</em>从<em class="le">宽</em>转换为<em class="le">长</em>格式。然后，<em class="le"> astype </em>确保类型正确。最后，如果没有区域可用，方法<em class="le"> fillna </em>插入文本<em class="le"> &lt; all &gt; </em>或者为包含累积案例号的列插入0。</p><p id="7e4c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后一个转换是将相应的列转换成<em class="le">日期</em>类型。</p><p id="5630" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过多次调用函数<em class="le"> loadData </em>，我们<strong class="kk iu">加载一个清理过的数据帧</strong><strong class="kk iu">【确诊病例】</strong><strong class="kk iu">【痊愈病例】</strong> <strong class="kk iu">和死亡病例</strong>。函数<em class="le"> merge </em>连接这3个数据集，得到一个包含所有数据的数据集:</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="be02" class="oe lz it oa b gy of og l oh oi">allData = <br/>  loadData(<br/>    "time_series_covid19_confirmed_global.csv", "CumConfirmed") \<br/>  .merge(loadData(<br/>    "time_series_covid19_deaths_global.csv", "CumDeaths")) \<br/>  .merge(loadData(<br/>    "time_series_covid19_recovered_global.csv", "CumRecovered"))</span></pre><p id="26be" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于用户界面的初始化，我们需要国家名称。我们从大的<em class="le">数据帧</em>中提取它们，使用:</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="6e64" class="oe lz it oa b gy of og l oh oi">countries = allData['Country/Region'].unique()<br/>countries.sort()</span></pre><p id="ff35" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们已经完成了数据加载。让我们转到UI部分！</p><blockquote class="ls lt lu"><p id="8951" class="ki kj le kk b kl km ju kn ko kp jx kq lv ks kt ku lw kw kx ky lx la lb lc ld im bi translated">[更新2020-3-27]:服务器上的文件名在3月23日更改了，所以我必须在这里也更新它们。</p></blockquote><h1 id="06de" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">使用Dash &amp; Plotly创建用户界面</h1><p id="52f9" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">首先，我们初始化一个外部样式表的路径和一个自定义字体(匹配这个应用程序的<a class="ae lf" rel="noopener" target="_blank" href="/create-a-coronavirus-app-using-r-shiny-and-plotly-6a6abf66091d"> R-Shiny版本):</a></p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="df1f" class="oe lz it oa b gy of og l oh oi">external_stylesheets=['https://codepen.io/chriddyp/pen/bWLwgP.css']</span><span id="8ebf" class="oe lz it oa b gy om og l oh oi">tickFont = {'size':12, 'color':"rgb(30,30,30)", \<br/>            'family':"Courier New, monospace"}</span></pre><p id="0054" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用上面定义的样式表初始化<em class="le"> Dash </em>应用程序:</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="f630" class="oe lz it oa b gy of og l oh oi">app = dash.Dash(__name__, external_stylesheets=external_stylesheets)</span><span id="251b" class="oe lz it oa b gy om og l oh oi">app.layout = html.Div(<br/>    style={ 'font-family':"Courier New, monospace" }, children=[<br/>        ## ...<br/>    ]<br/>])</span></pre><p id="f054" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然标题和两个情节遍布整个屏幕宽度，但三个控件仅占三分之一。根据<strong class="kk iu">引导网格系统，</strong>这转化为三个<em class="le">列</em>，每个列的宽度为4，总计为12。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi on"><img src="../Images/a891561adcab6a39ba137ff024c5eaf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3SYwIkY81QSKp-UXvOLzjw.jpeg"/></div></div></figure><p id="853c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在输入以下代码块来定义包含控件的列，而不是三个点(见最后一个代码块):</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="2d92" class="oe lz it oa b gy of og l oh oi">        html.H1('Case History of the Coronavirus (COVID-19)'),<br/>        html.Div(className="row", children=[<br/>            html.Div(className="four columns", children=<br/>                html.H5('Country'),<br/>                dcc.Dropdown( <br/>                    id='country',<br/>                    options=[{'label':c, 'value':c} \<br/>                        for c in countries],<br/>                    value='Italy'<br/>                )<br/>            ]),<br/>            html.Div(className="four columns", children=[<br/>                html.H5('State / Province'),<br/>                dcc.Dropdown(<br/>                    id='state'<br/>                )<br/>            ]),<br/>            html.Div(className="four columns", children=[<br/>                html.H5('Selected Metrics'),<br/>                dcc.Checklist(<br/>                    id='metrics',<br/>                    options=[{'label':m, 'value':m} for m in \<br/>                        ['Confirmed', 'Deaths', 'Recovered']],<br/>                    value=['Confirmed', 'Deaths']<br/>                )<br/>            ])<br/>        ]),</span></pre><p id="d9f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们定义的<strong class="kk iu">控件</strong>是:</p><ul class=""><li id="b174" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated">国家<em class="le">下拉列表</em>，其中填充了唯一的国家。</li><li id="9681" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">州/省<em class="le">下拉菜单</em>。至今未初始化。</li><li id="b4b0" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">指标<em class="le">清单</em>，填有3个指标名称。</li></ul><p id="f4f9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于两个条形图，我们使用交互式版本的<em class="le"> Plotly </em> ( <a class="ae lf" href="https://plot.ly/python/" rel="noopener ugc nofollow" target="_blank">文档</a>)，并更改配置以隐藏大量控件。代码也是<em class="le">子数组</em>的一部分:</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="ae6c" class="oe lz it oa b gy of og l oh oi">    dcc.Graph(<br/>        id="plot_new_metrics",<br/>        config={ 'displayModeBar': False }<br/>    ),<br/>    dcc.Graph(<br/>        id="plot_cum_metrics", <br/>        config={ 'displayModeBar': False }<br/>    )</span></pre><h1 id="fcb9" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">添加服务器逻辑</h1><p id="0788" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">与<a class="ae lf" href="https://medium.com/@meinhard.ploner/create-a-coronavirus-app-using-r-shiny-and-plotly-6a6abf66091d" rel="noopener"> R-Shiny软件栈</a>相比，Python-Dash没有简单的解决方案来生成表达式(=数据！)无功。下一个函数返回指定国家和州的所有数据。该函数将在我们的代码中使用两次(每个图一次)，因此如果计算不会发生两次，这将是一个优势:</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="a6ba" class="oe lz it oa b gy of og l oh oi">def nonreactive_data(country, state):<br/>    data = allData.loc[allData['Country/Region'] == country] \<br/>                  .drop('Country/Region', axis=1)<br/>    if state == '&lt;all&gt;':<br/>        data = data.drop('Province/State', axis=1) \<br/>                   .groupby("date") \<br/>                   .sum() \<br/>                   .reset_index()<br/>    else:<br/>       data = data.loc[data['Province/State'] == state]<br/>    newCases = data.select_dtypes(include='Int64').diff().fillna(0)<br/>    newCases.columns = [column.replace('Cum', 'New') <br/>                        for column in newCases.columns]<br/>    data = data.join(newCases)<br/>    data['dateStr'] = data['date'].dt.strftime('%b %d, %Y')<br/>    return data</span></pre><p id="f49e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了过滤国家和州的总体<em class="le">数据帧</em>之外，如果用户为有州的国家(如美国)选择<em class="le"> &lt;【全部】&gt; </em>，该函数还会聚合数据(使用<em class="le"> groupby </em>和<em class="le"> sum </em>)。进一步的<strong class="kk iu">差异从累积的统计数据中计算</strong>并保存到新列中，前缀为“<em class="le">New”</em>而不是<em class="le">“Cum”。</em></p><p id="1bff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一个块定义了一个<strong class="kk iu">函数来创建条形图</strong>，它将用于两个图。</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="61d9" class="oe lz it oa b gy of og l oh oi">colors = { 'Deaths':'rgb(200,30,30)', \<br/>           'Recovered':'rgb(30,200,30)', \ <br/>           'Confirmed':'rgb(100,140,240)' }</span><span id="09fb" class="oe lz it oa b gy om og l oh oi">def barchart(data, metrics, prefix="", yaxisTitle=""):<br/>    figure = go.Figure(data=[<br/>        go.Bar(<br/>            name=metric, x=data.date, y=data[prefix + metric],<br/>            marker_line_color='rgb(0,0,0)', marker_line_width=1,<br/>            marker_color=colors[metric]<br/>        ) for metric in metrics<br/>    ])<br/>    figure.update_layout( <br/>              barmode='group', legend=dict(x=.05, y=0.95), <br/>              plot_bgcolor='#FFFFFF', font=tickFont) \<br/>          .update_xaxes( <br/>              title="", tickangle=-90, type='category',  <br/>              showgrid=True, gridcolor='#DDDDDD', <br/>              tickfont=tickFont, ticktext=data.dateStr,                     <br/>              tickvals=data.date) \<br/>          .update_yaxes(<br/>              title=yaxisTitle, showgrid=True, gridcolor='#DDDDDD')<br/>    return figure</span></pre><p id="5ddb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该函数的顶部循环遍历指标以添加条形。底部设置条形图模式(“组”)，并对图例、轴和标签进行一些调整和样式设置。最重要的是，我们想在x轴的每个刻度上显示日期。</p><h2 id="f2db" class="oe lz it bd ma oo op dn me oq or dp mi kr os ot mk kv ou ov mm kz ow ox mo oy bi translated">反应图</h2><p id="6add" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">虽然到目前为止Dash还不支持反应式表达式，但是反应式UI元素是支持的。如果<em class="le">输入</em>值之一改变 ( <em class="le">国家</em>、<em class="le">状态、</em>或<em class="le">指标</em>)，则以下<strong class="kk iu">回调</strong>被触发。在这种情况下，后续函数被调用并更新<em class="le">输出</em> ( <em class="le">图</em>)中定义的变量。</p><p id="d969" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了完成该任务，该函数通过调用适当的函数“<em class="le">条形图</em>”来加载清理后的数据并呈现图表。</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="275b" class="oe lz it oa b gy of og l oh oi"><a class="ae lf" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback(<br/>    Output('plot_new_metrics', 'figure'), <br/>    [Input('country', 'value'), Input('state', 'value'), <br/>     Input('metrics', 'value')]<br/>)<br/>def update_plot_new_metrics(country, state, metrics):<br/>    data = nonreactive_data(country, state)<br/>    return barchart(data, metrics, prefix="New", <br/>        yaxisTitle="New Cases per Day")</span><span id="4e9d" class="oe lz it oa b gy om og l oh oi"><a class="ae lf" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback(<br/>    Output('plot_cum_metrics', 'figure'), <br/>    [Input('country', 'value'), Input('state', 'value'), <br/>     Input('metrics', 'value')]<br/>)<br/>def update_plot_cum_metrics(country, state, metrics):<br/>    data = nonreactive_data(country, state)<br/>    return barchart(data, metrics, prefix="Cum", <br/>        yaxisTitle="Cumulated Cases")</span></pre><h2 id="c3c3" class="oe lz it bd ma oo op dn me oq or dp mi kr os ot mk kv ou ov mm kz ow ox mo oy bi translated">反应式下拉菜单</h2><p id="5d12" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">最后但同样重要的是，当用户改变选择的国家时，下拉菜单<strong class="kk iu">中显示的<strong class="kk iu">州/省</strong>必须适应</strong>。<em class="le"> update_states </em>提取唯一状态列表，添加<em class="le"> &lt; all &gt; </em>，返回整个列表并更新所选值。</p><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="e94f" class="oe lz it oa b gy of og l oh oi"><a class="ae lf" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback(<br/>    [Output('state', 'options'), Output('state', 'value')],<br/>    [Input('country', 'value')]<br/>)<br/>def update_states(country):<br/>    states = list(allData.loc[allData['Country/Region'] == country]<br/>        ['Province/State'].unique()<br/>    )<br/>    states.insert(0, '&lt;all&gt;')<br/>    states.sort()<br/>    state_options = [{'label':s, 'value':s} for s in states]<br/>    state_value = state_options[0]['value']<br/>    return state_options, state_value</span></pre><p id="716e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">搞定了。</p><p id="1435" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您只需按下VS代码右上角的绿色“运行”按钮，就可以运行该应用程序。玩得开心:)</p><h1 id="8353" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">GitHub代码</h1><p id="8610" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">以上所有代码都可以在<em class="le">GitHub:</em><a class="ae lf" href="https://github.com/ploner/coronavirus-py" rel="noopener ugc nofollow" target="_blank">https://github.com/ploner/coronavirus-py</a>上找到</p><h1 id="5e2a" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">[可选]将应用程序上传到云</h1><p id="6588" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">在网络服务器上发布应用程序非常容易，尤其是像<a class="ae lf" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> Heroku </strong> </a>这样的免费服务。</p><p id="88c1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">步骤</strong>是:</p><ul class=""><li id="1e37" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated">在<em class="le"> app.py </em>文件中添加下面一行:</li></ul><pre class="lh li lj lk gt nz oa ob oc aw od bi"><span id="15cc" class="oe lz it oa b gy of og l oh oi">server = app.server</span></pre><ul class=""><li id="b116" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated">在Heroku上创建一个帐户。</li><li id="b540" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">安装Heroku CLI(命令行界面)。</li><li id="632f" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">遵循https://dash.plot.ly/deployment—<a class="ae lf" href="https://dash.plot.ly/deployment" rel="noopener ugc nofollow" target="_blank">—“Heroku示例”部分的说明。基本上，你通过<em class="le"> pip </em>安装<em class="le"> gunicorn </em>，创建<em class="le">。git忽略</em>、<em class="le"> ProcFile </em>和<em class="le"> requirements.txt </em>，使用<em class="le"> git </em>一起提交给<em class="le"> Heroku </em>。</a></li></ul></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="22f4" class="oe lz it bd ma oo op dn me oq or dp mi kr os ot mk kv ou ov mm kz ow ox mo oy bi translated">最后的想法</h2><p id="daa8" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">这是我在Medium上的第二篇文章，与我的第一篇高度相关:</p><blockquote class="ls lt lu"><p id="a828" class="ki kj le kk b kl km ju kn ko kp jx kq lv ks kt ku lw kw kx ky lx la lb lc ld im bi translated">用R，闪亮的&amp; Plotly 在一眨眼的时间内可视化新冠肺炎案例数据</p></blockquote><p id="6c40" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你领导着一个<strong class="kk iu">数据科学团队</strong>，并且你的成员也<strong class="kk iu">精通R和Python </strong>，那么<strong class="kk iu">比较Shiny和Dash </strong>可能就在你的任务清单上。让我知道你是如何做决定的。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="9a7c" class="oe lz it bd ma oo op dn me oq or dp mi kr os ot mk kv ou ov mm kz ow ox mo oy bi translated">如果你喜欢这个故事，你可能也会喜欢我在《走向数据科学》上发表的关于新冠肺炎、分析和机器学习的两个中型故事之一:</h2><div class="oz pa gp gr pb pc"><a rel="noopener follow" target="_blank" href="/forget-daily-statistics-of-the-coronavirus-7e9bbb7349bd"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd iu gy z fp ph fr fs pi fu fw is bi translated">厌倦了被告知新冠肺炎方向每两天改变？</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">忘记每日统计，遵循正确的KPI！</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">towardsdatascience.com</p></div></div><div class="pl l"><div class="pm l pn po pp pl pq lq pc"/></div></div></a></div><div class="oz pa gp gr pb pc"><a rel="noopener follow" target="_blank" href="/which-countries-react-similar-to-covid-19-machine-learning-provides-the-answer-5971ec2f6f31"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd iu gy z fp ph fr fs pi fu fw is bi translated">哪些国家的反应与新冠肺炎相似？机器学习提供了答案</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">看看你的国家(或美国的州)和它的同行相比表现如何。了解聚类分析的实际应用——使用UMAP…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">towardsdatascience.com</p></div></div><div class="pl l"><div class="pr l pn po pp pl pq lq pc"/></div></div></a></div></div></div>    
</body>
</html>