<html>
<head>
<title>Getting Started with SNAP Toolbox in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中的捕捉工具箱入门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-started-with-snap-toolbox-in-python-89e33594fa04?source=collection_archive---------11-----------------------#2020-06-19">https://towardsdatascience.com/getting-started-with-snap-toolbox-in-python-89e33594fa04?source=collection_archive---------11-----------------------#2020-06-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8a59" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">SentiNel 应用程序，通常称为 SNAP，是一个适应性很强的开源软件，用于对地球观测卫星数据进行科学探索。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8494739544f8fd913210de6eb353209e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MiSwYPDSG4aF_n2s0D2StQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">美国地质勘探局在<a class="ae kv" href="https://unsplash.com/photos/35Z2ylLRCO8" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b4cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SNAP 由欧洲航天局(ESA)开发，是一个支持哨兵任务的通用软件平台。它由几个模块组成，可以修改并重新用于地球观测卫星数据的图像处理、建模和可视化。SNAP 不仅可用作哨兵任务(哨兵 1、哨兵 2 和哨兵 3)的研究支持工具，还可用作有效处理大量卫星数据的功能出口，包括来自 Landsat、MODIS 和 RapidEye 等其他任务的各种不同格式的数据。SNAP 的项目页面和各个工具箱可以在 http://step.esa.int<a class="ae kv" href="http://step.esa.int/" rel="noopener ugc nofollow" target="_blank">找到。</a></p><p id="593d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我想一步一步地介绍配置 python 安装以使用<strong class="ky ir"> SNAP-Python </strong>或“<em class="ls"> snappy </em>”接口的过程。这样做将允许您通过使用 python 脚本自动执行图像处理任务来高效地分析大量卫星数据。</p><p id="2ece" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文将涵盖以下主题:</p><ol class=""><li id="b552" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">在 Windows 上下载并安装最新的 SNAP 版本(7.0 版)，</li><li id="0863" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">在快照安装过程期间和之后配置 snappy，</li><li id="00a4" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">建立一个虚拟环境，</li><li id="8c89" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">为 snappy 和配置最佳设置</li><li id="bb28" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">使用 snappy 可视化卫星数据</li></ol></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="281b" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated"><strong class="ak">下载快照工具箱</strong></h2><p id="82b5" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">捕捉由几个工具箱组成。您可以单独安装每个工具箱，也可以安装一体化版本。在本教程中，我们将安装后者。</p><p id="a65d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">快照工具箱可以从下面的链接下载:<a class="ae kv" href="https://step.esa.int/main/download/snap-download/" rel="noopener ugc nofollow" target="_blank">https://step.esa.int/main/download/snap-download/</a></p><h2 id="836c" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated"><strong class="ak">创建虚拟环境</strong></h2><p id="ef93" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">在你应该在你的系统上安装 SNAP 软件之前，我建议你使用<strong class="ky ir"> <em class="ls"> pip </em> </strong>或者<strong class="ky ir"> <em class="ls"> conda </em> </strong>创建一个虚拟环境。对于本教程，我们将使用 conda。要运行这个命令，您需要在系统上安装 Anaconda 或 Miniconda。</p><p id="a3e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过在系统的 python 配置命令行工具上执行以下命令，使用 python 2.7 版创建一个名为“snap”的新虚拟环境。</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="20ad" class="mo mp iq nn b gy nr ns l nt nu">conda create -n snap python=2.7</span></pre><p id="09b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用 python 2.7 版本的原因是因为 SNAP 软件仅支持 python 2.7、3.3 和 3.4 版本。</p><p id="7565" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:如果你使用 pip 来创建一个新的环境，你必须安装 venv 包。点击了解更多关于如何使用 venv <a class="ae kv" href="https://docs.python.org/3/library/venv.html" rel="noopener ugc nofollow" target="_blank">创建虚拟环境的信息。</a></p><h2 id="d89d" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated"><strong class="ak">卡扣安装</strong></h2><p id="d39d" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">接下来，我们可以使用下载的可执行文件开始安装快照软件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/a0e24a4aed84f6e3c710222bc88a21a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*1eX03jCMce4geCdSSXTyDQ.png"/></div></figure><p id="faf3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以将 python 安装配置为在快照安装期间使用 snappy，方法是选中复选框并提供 python 目录的路径(如下所示)。然而，在本教程中，我们将<strong class="ky ir">而不是</strong>检查复选框并在 SNAP 安装完成后配置 snappy。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/a2ea63464ef46783ea7c32333d9644c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*Uwm3P_96y7TjF3QW4qohWw.png"/></div></figure><p id="c829" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装过程的其余部分非常简单。第一次启动 SNAP 时，它会进行一些更新。完成后，您就可以开始使用快照软件了。</p><h2 id="39db" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated"><strong class="ak">配置爽快的</strong></h2><p id="ea35" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">snap 安装完成后，我们希望获得虚拟环境“SNAP”所在的目录位置。从这里开始，我们需要以下两条路径:</p><ol class=""><li id="9a1e" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">虚拟环境的 Python 可执行路径</li><li id="e4f0" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">虚拟环境目录中名为“Lib”的文件夹</li></ol><p id="5778" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开作为 SNAP 软件一部分安装的 SNAP 命令行工具，并运行以下命令:</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="fa91" class="mo mp iq nn b gy nr ns l nt nu">snappy-conf {path_to_snap_env}\python.exe {path_to_snap_env}\Lib\</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/c473a92726299b6e6c3376a3e8972594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u1BKZiCTlp5801rXdE8wNw.png"/></div></div></figure><p id="83a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">更改可用 RAM 的数量</strong></p><p id="5396" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们开始使用 snappy 创建 python 脚本之前，我们需要做一些改变，以确保 snappy 操作符以最高的最优性运行。如果您计划进行一些图像渲染和批处理操作，默认设置会非常慢。如果您想使用 snappy 来自动化繁重的处理任务并处理多个文件，这一点很重要。</p><p id="e9ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转到{ virtual _ env " snap " directory } &gt; Lib &gt; snappy。</p><p id="a9e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开名为“<em class="ls"> snappy.ini”的 snappy 配置文件。</em></p><p id="9c5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编辑名为" j <em class="ls"> ava_max_mem" </em>的参数值，并将其设置为相当于系统 RAM 70–80%的值。</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="46c1" class="mo mp iq nn b gy nr ns l nt nu">java_max_mem: 26G</span></pre><p id="e06e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在同一个目录中，有一个名为“<em class="ls"> jpyconfig.py”的文件。C </em>更改参数"<em class="ls"> jvm_maxmem" </em>如下<em class="ls"> : </em></p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="039e" class="mo mp iq nn b gy nr ns l nt nu">jvm_maxmem = '26G'</span></pre><p id="e366" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">改变磁贴缓存内存</strong></p><p id="adcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，导航到安装快照软件的位置。默认情况下，它设置为 C:\Program Files\snap。在其中，您会找到名为<em class="ls"> etc </em>的文件夹，其中包含名为<em class="ls">“SNAP . properties”</em>的快照属性文件。编辑文件并更改名为<em class="ls">snap . jai . tile cachesize .</em>的参数，将其设置为等于<em class="ls"> java_max_mem </em>值的 70–80%的值。您输入的数字应该以兆字节为单位。您可能需要启用管理员权限来保存对此文件的更改。</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="ce0e" class="mo mp iq nn b gy nr ns l nt nu">snap.jai.tileCacheSize = 21504</span></pre><p id="ac0d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注:此处显示的值适用于 32GB 内存的系统。更改时必须考虑到系统的 RAM。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="d503" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated"><strong class="ak">开始使用 Snappy </strong></h2><p id="eed4" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">因此，对于最后一部分，我们想探索 snappy 是如何工作的，并可视化一些样本数据。在我们开始使用 snappy 之前，我们需要一些数据，在本教程中，我们将使用 snappy 安装预加载的测试数据。</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="90b4" class="mo mp iq nn b gy nr ns l nt nu"># Import Libraries</span><span id="bdfb" class="mo mp iq nn b gy ny ns l nt nu">import os<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import snappy<br/>from snappy import ProductIO</span><span id="d065" class="mo mp iq nn b gy ny ns l nt nu"># Set Path to Input Satellite Data</span><span id="1e17" class="mo mp iq nn b gy ny ns l nt nu"># miniconda users<br/>path = r'C:\Users\{User}\miniconda3\envs\snap\Lib\snappy\testdata'</span><span id="7cfe" class="mo mp iq nn b gy ny ns l nt nu"># anaconda users<br/>path = r'C:\Users\{User}\anaconda3\envs\snap\Lib\snappy\testdata'</span><span id="5ed3" class="mo mp iq nn b gy ny ns l nt nu">filename = 'MER_FRS_L1B_SUBSET.dim'</span><span id="b56e" class="mo mp iq nn b gy ny ns l nt nu"># Read File<br/>df = ProductIO.readProduct(os.path.join(path, filename))</span><span id="730d" class="mo mp iq nn b gy ny ns l nt nu"># Get the list of Band Names<br/>list(df.getBandNames())</span><span id="07ca" class="mo mp iq nn b gy ny ns l nt nu"># Using "radiance_3" band as an example<br/>band = df.getBand('radiance_3') # Assign Band to a variable<br/>w = df.getSceneRasterWidth() # Get Band Width<br/>h = df.getSceneRasterHeight() # Get Band Height</span><span id="c4c2" class="mo mp iq nn b gy ny ns l nt nu"># Create an empty array<br/>band_data = np.zeros(w * h, np.float32)</span><span id="3ebd" class="mo mp iq nn b gy ny ns l nt nu"># Populate array with pixel value<br/>band.readPixels(0, 0, w, h, band_data) </span><span id="381d" class="mo mp iq nn b gy ny ns l nt nu"># Reshape<br/>band_data.shape = h, w</span><span id="8039" class="mo mp iq nn b gy ny ns l nt nu"># Plot the band  <br/>plt.figure(figsize=(18,10))<br/>plt.imshow(band_data, cmap = plt.cm.binary)<br/>plt.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/e34cdd24cc5487dc116cd75b9b308ecf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*07d5CeI5AdqD-ofG2lOd6A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">“radiance_3”波段图</p></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><p id="a8be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我还制作了一个视频，展示了我在这篇文章中列出的所有内容。因此，如果对如何在 Python 中安装和配置 SNAP Toolbox 有任何困惑，请务必查看。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="0b33" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated"><strong class="ak">附加资源</strong></h2><ol class=""><li id="e126" class="lt lu iq ky b kz nh lc ni lf oc lj od ln oe lr ly lz ma mb bi translated">Github 页面:【https://github.com/senbox-org T4】</li><li id="4e43" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">为 Python 配置 SNAP:<a class="ae kv" href="https://senbox.atlassian.net/wiki/spaces/SNAP/pages/50855941/Configure+Python+to+use+the+SNAP-Python+snappy+interface" rel="noopener ugc nofollow" target="_blank">https://senbox . atlassian . net/wiki/spaces/SNAP/pages/50855941/Configure+Python+to+use+the+SNAP-Python+snappy+interface</a></li><li id="0a6c" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">写这篇文章时有用的论坛讨论</li></ol><div class="of og gp gr oh oi"><a href="https://forum.step.esa.int/t/snappy-where-to-start/1463/7" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">爽快:从哪里开始？</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">下午好，我是一名新的欧空局学员，我想实施 S2-tbx/sen2cor 的一些过程到一个…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">forum.step.esa.int</p></div></div><div class="or l"><div class="os l ot ou ov or ow kp oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://forum.step.esa.int/t/run-processes-of-snap-toolbox-using-python-script/3021/3" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">使用 python 脚本运行捕捉工具箱的进程</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">你好，我是 SNAP 工具箱的新用户。我已经在我的 windows 机器上安装了 SNAP 4.0。我目前正在使用快照桌面…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">forum.step.esa.int</p></div></div><div class="or l"><div class="ox l ot ou ov or ow kp oi"/></div></div></a></div></div></div>    
</body>
</html>