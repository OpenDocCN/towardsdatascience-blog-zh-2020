<html>
<head>
<title>Speech Recognition with TensorFlow.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 TensorFlow.js 进行语音识别</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/speech-recognition-with-tensorflow-js-66608355376e?source=collection_archive---------48-----------------------#2020-06-23">https://towardsdatascience.com/speech-recognition-with-tensorflow-js-66608355376e?source=collection_archive---------48-----------------------#2020-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="e23b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">语音识别</h2><div class=""/><div class=""><h2 id="399b" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用 TensorFlow.js 构建一个小型语音识别示例</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/2df121adaee5840b98568229bb65e54c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iNIQhKTXK6sZbxu7vS9kCQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">马特·博茨福德在<a class="ae lh" href="/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="ef7d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们通常谈论 AI、深度学习、机器学习时，我们会自动想到 Python、R 或 C++，但 JavaScript 呢？嗯……事实证明，Python 中最受欢迎的机器学习库之一也可用于 JavaScript，我们正在谈论<a class="ae lh" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> Tensorflow </a>，今天我们将对该库做一个简短的介绍，我们将一起构建一个有趣的项目。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="cad8" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">Tensorflow.js 是什么，可以用来做什么？</h1><p id="c9a9" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated"><a class="ae lh" href="https://www.tensorflow.org/js" rel="noopener ugc nofollow" target="_blank"> TensorFlow.js </a>是一个由 Google 开发的 JavaScript 库，用于在浏览器和 Node.js 中训练和部署机器学习模型。它是 Python 的流行 ML 库<a class="ae lh" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a>的姊妹库。</p><p id="f1e0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">TensorFlow.js 不仅仅是一个玩具库，它是严肃的商业，性能令人惊讶，尤其是在通过 WebGL 使用硬件加速时，但我们应该用它来训练模型吗？也许不是，即使你可以获得很好的性能，它的 Python 版本甚至更快，当使用 Python 时，你会发现更多的库来支持你的代码，如 Numpy 和 Pandas。除了学习资料，TensorFlow.js 的内容没有 TensorFlow 多。</p><p id="e239" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，这并不意味着您不应该使用 TensorFlow.js，相反，我认为它是一个用于部署和运行 ML 模型的很好的库，这也是我们将在本文的剩余部分重点关注的内容。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="87e9" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">使用 TensorFlow.js 部署示例模型</h1><p id="a17c" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">正如我们所说，TensorFlow.js 是一个强大的库，我们可以处理许多不同的事情，如图像分类、视频处理和语音识别等。今天，我决定研究一个基本的语音识别示例。</p><p id="8b91" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们的代码将能够通过麦克风监听并识别用户在说什么，至少几个词，因为我们对我使用的示例模型有一些限制。但与其解释，我认为如果我们先看到它的实际应用会很酷:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ni"><img src="../Images/eef79f156a512433f797433cd636487a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oyC3zMjVdfoLVqiUkxnjMA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">不幸的是，我不能在介质上运行代码，但你可以在这里访问现场演示<a class="ae lh" href="https://livecodestream.dev/post/2020-06-23-speech-recognition-with-tensorflowjs/" rel="noopener ugc nofollow" target="_blank"/></p></figure><p id="e0a5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">很酷吗？我知道这可能有点不稳定，而且仅限于几个词，但如果您使用正确的模型，可能性是无穷的。说够了，让我们开始编码吧。</p><p id="53a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们需要做的第一件事是安装库并获得我们的模型。为了安装 TensorFlow.js，有几个选项可以查看<a class="ae lh" href="https://www.tensorflow.org/js/tutorials/setup" rel="noopener ugc nofollow" target="_blank">这里是</a>，为了简单起见，我们将从 CDN 导入。</p><pre class="ks kt ku kv gt nj nk nl nm aw nn bi"><span id="4914" class="no mm it nk b gy np nq l nr ns">&lt;script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"&gt;&lt;/script&gt;<br/>&lt;script src="https://unpkg.com/@tensorflow-models/speech-commands"&gt;&lt;/script&gt;</span></pre><p id="854a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后我们将使用一些 HTML 来显示单词列表:</p><pre class="ks kt ku kv gt nj nk nl nm aw nn bi"><span id="41d8" class="no mm it nk b gy np nq l nr ns">&lt;div class="demo"&gt;<br/>    &lt;div&gt;<br/>        &lt;label class="form-switch"&gt;<br/>            &lt;input type="checkbox" id="audio-switch"&gt;<br/>            Microphone<br/>        &lt;/label&gt;<br/>        &lt;div id="demo-loading" class="hidden"&gt;Loading...&lt;/div&gt;<br/>    &lt;/div&gt;<br/>    &lt;div id="sp-cmd-wrapper" class="grid"&gt;&lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="519c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">到目前为止，没有什么奇怪的，我们有我们的复选框，一个加载元素和一个包装元素，我们将使用它们来呈现单词列表，所以让我们接下来这样做:</p><pre class="ks kt ku kv gt nj nk nl nm aw nn bi"><span id="d4e3" class="no mm it nk b gy np nq l nr ns">const wrapperElement = document.getElementById('sp-cmd-wrapper');<br/>for (let word of wordList) {<br/>    wrapperElement.innerHTML += `&lt;div id='word-${word}'&gt;${word}&lt;/div&gt;`;<br/>}</span></pre><p id="6c75" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了让演示开始工作，我们需要单击麦克风复选框，让我们在那里设置一个事件监听器来触发加载和监听过程。</p><pre class="ks kt ku kv gt nj nk nl nm aw nn bi"><span id="bb7d" class="no mm it nk b gy np nq l nr ns">document.getElementById("audio-switch").addEventListener('change', (event) =&gt; {<br/>    if(event.target.checked) {<br/>        if(modelLoaded) {<br/>            startListening();<br/>        }else{<br/>            loadModel();<br/>        }<br/>    } else {<br/>        stopListening();<br/>    }   <br/>});</span></pre><p id="1fa3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当复选框改变其值时，我们有 3 种不同的可能性，用户启用了复选框而模型未被加载，在这种情况下，我们使用<code class="fe nt nu nv nk b">loadModel()</code>函数，但是如果模型已经被加载，我们触发监听过程。如果用户禁用了复选框，我们将停止访问麦克风。</p><p id="d3af" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们回顾一下每个函数的实现:</p><h2 id="1fc3" class="no mm it bd mn nw nx dn mr ny nz dp mv lr oa ob mx lv oc od mz lz oe of nb iz bi translated">负载模型()</h2><p id="95c9" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated"><code class="fe nt nu nv nk b">loadModel()</code>负责创建识别器实例和加载模型。当模型被加载时，我们将能够通过<code class="fe nt nu nv nk b">recognizer.wordLabels()</code>得到模型被训练的标签列表。这将有助于以后评估模型。</p><pre class="ks kt ku kv gt nj nk nl nm aw nn bi"><span id="1e22" class="no mm it nk b gy np nq l nr ns">async function loadModel() { <br/>    // Show the loading element<br/>    const loadingElement = document.getElementById('demo-loading');<br/>    loadingElement.classList.remove('hidden');<br/>    <br/>    // When calling `create()`, you must provide the type of the audio input.<br/>    // - BROWSER_FFT uses the browser's native Fourier transform.<br/>    recognizer = speechCommands.create("BROWSER_FFT");  <br/>    await recognizer.ensureModelLoaded()<br/>    <br/>    words = recognizer.wordLabels();<br/>    modelLoaded = true;<br/>    <br/>    // Hide the loading element<br/>    loadingElement.classList.add('hidden');<br/>    startListening();<br/>}</span></pre><h2 id="033c" class="no mm it bd mn nw nx dn mr ny nz dp mv lr oa ob mx lv oc od mz lz oe of nb iz bi translated">开始监听()</h2><p id="6cb1" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated"><code class="fe nt nu nv nk b">startListening()</code>将在模型加载或用户启用麦克风后被调用，将负责访问麦克风 API 并评估模型以查看我们能够识别哪个单词。这听起来很复杂，但由于 TensorFlow 只有几行代码。</p><pre class="ks kt ku kv gt nj nk nl nm aw nn bi"><span id="f148" class="no mm it nk b gy np nq l nr ns">function startListening() {<br/>    recognizer.listen(({scores}) =&gt; {<br/>    <br/>        // Everytime the model evaluates a result it will return the scores array<br/>        // Based on this data we will build a new array with each word and it's corresponding score<br/>        scores = Array.from(scores).map((s, i) =&gt; ({score: s, word: words[i]}));<br/>        <br/>        // After that we sort the array by scode descending<br/>        scores.sort((s1, s2) =&gt; s2.score - s1.score);<br/>        <br/>        // And we highlight the word with the highest score<br/>        const elementId = `word-${scores[0].word}`;<br/>        document.getElementById(elementId).classList.add('active');<br/>        <br/>        // This is just for removing the highlight after 2.5 seconds<br/>        setTimeout(() =&gt; {<br/>            document.getElementById(elementId).classList.remove('active');<br/>        }, 2500);<br/>    }, <br/>    {<br/>        probabilityThreshold: 0.70<br/>    });<br/>}</span></pre><p id="bf35" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">超级容易！现在是最后一个函数。</p><h2 id="0f3d" class="no mm it bd mn nw nx dn mr ny nz dp mv lr oa ob mx lv oc od mz lz oe of nb iz bi translated">停止列表()</h2><p id="a9d9" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated"><code class="fe nt nu nv nk b">stopListening()</code>将停止访问麦克风并停止评估。</p><pre class="ks kt ku kv gt nj nk nl nm aw nn bi"><span id="ccb9" class="no mm it nk b gy np nq l nr ns">function stopListening(){<br/>    recognizer.stopListening();<br/>}</span></pre><p id="fb5e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就这样，这就是在 web 上构建第一个语音识别示例所需的全部内容。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="16e3" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">把所有的放在一起</h1><pre class="ks kt ku kv gt nj nk nl nm aw nn bi"><span id="6f4d" class="no mm it nk b gy np nq l nr ns">&lt;script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"&gt;&lt;/script&gt;<br/>&lt;script src="https://unpkg.com/@tensorflow-models/speech-commands"&gt;&lt;/script&gt;</span><span id="466e" class="no mm it nk b gy og nq l nr ns">&lt;script type="text/javascript"&gt;<br/>    let recognizer;<br/>    let words;<br/>    const wordList = ["zero","one","two","three","four","five","six","seven","eight","nine", "yes", "no", "up", "down", "left", "right", "stop", "go"];<br/>    let modelLoaded = false;<br/>    <br/>    document.addEventListener('DOMContentLoaded', () =&gt; {<br/>        const wrapperElement = document.getElementById('sp-cmd-wrapper');<br/>        for (let word of wordList) {<br/>            wrapperElement.innerHTML += `&lt;div class='col-3 col-md-6'&gt;&lt;div id='word-${word}' class='badge'&gt;${word}&lt;/div&gt;&lt;/div&gt;`;<br/>        };<br/>        <br/>        document.getElementById("audio-switch").addEventListener('change', (event) =&gt; {<br/>            if(event.target.checked) {<br/>                if(modelLoaded) {<br/>                    startListening();<br/>                }else{<br/>                    loadModel();<br/>                }<br/>            } else {<br/>                stopListening();<br/>            }   <br/>        });<br/>    });<br/>    <br/>    async function loadModel() { <br/>        // Show the loading element<br/>        const loadingElement = document.getElementById('demo-loading');<br/>        loadingElement.classList.remove('hidden');<br/>        <br/>        // When calling `create()`, you must provide the type of the audio input.<br/>        // - BROWSER_FFT uses the browser's native Fourier transform.<br/>        recognizer = speechCommands.create("BROWSER_FFT");  <br/>        await recognizer.ensureModelLoaded()<br/>        <br/>        words = recognizer.wordLabels();<br/>        modelLoaded = true;<br/>        <br/>        // Hide the loading element<br/>        loadingElement.classList.add('hidden');<br/>        startListening();<br/>    }<br/>    <br/>    function startListening() {<br/>        recognizer.listen(({scores}) =&gt; {<br/>        <br/>            # Everytime the model evaluates a result it will return the scores array<br/>            # Based on this data we will build a new array with each word and it's corresponding score<br/>            scores = Array.from(scores).map((s, i) =&gt; ({score: s, word: words[i]}));<br/>            <br/>            # After that we sort the array by scode descending<br/>            scores.sort((s1, s2) =&gt; s2.score - s1.score);<br/>            <br/>            # And we highlight the word with the highest score<br/>            const elementId = `word-${scores[0].word}`;<br/>            document.getElementById(elementId).classList.add('active');<br/>            <br/>            # This is just for removing the highlight after 2.5 seconds<br/>            setTimeout(() =&gt; {<br/>                document.getElementById(elementId).classList.remove('active');<br/>            }, 2500);<br/>        }, <br/>        {<br/>            probabilityThreshold: 0.70<br/>        });<br/>    }<br/>    <br/>    function stopListening(){<br/>        recognizer.stopListening();<br/>    }<br/>&lt;/script&gt;</span><span id="b3a7" class="no mm it nk b gy og nq l nr ns">&lt;div class="demo"&gt;<br/>    Please enable the microphone checkbox and authorize this site to access the microphone.<br/>    &lt;br /&gt;<br/>    Once the process finished loading speak one of the word bellow and see the magic happen.<br/>    &lt;br /&gt;&lt;br /&gt;<br/>    &lt;div&gt;<br/>        &lt;label class="form-switch"&gt;<br/>            &lt;input type="checkbox" id="audio-switch"&gt;<br/>            Microphone<br/>        &lt;/label&gt;<br/>        &lt;div id="demo-loading" class="hidden"&gt;Loading...&lt;/div&gt;<br/>    &lt;/div&gt;<br/>    &lt;div id="sp-cmd-wrapper" class="grid"&gt;&lt;/div&gt;<br/>&lt;/div&gt;</span></pre></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="3385" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">结论</h1><p id="eccd" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">TensorFlow.js 是一个强大的库，非常适合部署 ML 学习模型。今天我们了解到，只需几行代码，我们就能够加载一个模型并开始生成结果。与大多数 ML 解决方案一样，它与模型和数据一样好。</p><p id="1227" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你有可以使用 TensorFlow.js 的好想法，或者如果你知道任何我可以用来构建下一个项目并在博客上展示的好模型，请在评论中告诉我。</p><p id="2fcc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一如既往的感谢阅读！</p></div></div>    
</body>
</html>