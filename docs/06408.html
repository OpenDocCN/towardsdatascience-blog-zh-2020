<html>
<head>
<title>Creating an interactive map in Python using Bokeh and pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用散景和熊猫在 Python 中创建交互式地图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-an-interactive-map-in-python-using-bokeh-and-pandas-f84414536a06?source=collection_archive---------17-----------------------#2020-05-22">https://towardsdatascience.com/creating-an-interactive-map-in-python-using-bokeh-and-pandas-f84414536a06?source=collection_archive---------17-----------------------#2020-05-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="00bd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 Python 来(相对)容易地创建一个交互式热图，按位置显示鳄梨价格。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a5a654c4227cd5d4e90341d19995d072.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WOYrwHRGj4X1GWkEFQtddA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片——跟随这篇博文，自己制作。互动版<a class="ae kv" href="https://www.craigdoesdata.de/blog/avocadobokeh.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="684c" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated"><em class="lz">这篇文章可以看作是我之前处理鳄梨价格数据的文章的延伸(我能说什么呢，我爱鳄梨！)你可以在这里找到</em><a class="ae kv" rel="noopener" target="_blank" href="/mapping-avocado-prices-in-python-with-geopandas-geopy-and-matplotlib-c7e0ef08bc26"><em class="lz"/></a><em class="lz">。推荐去看看！</em></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="ce94" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">作为数据分析师/数据科学家/其他数据操纵者，我们经常发现自己使用可视化来有效地向他人传达我们的发现(并让自己更好地理解它们)。如果使用得当，可视化有很多优势——它们可以总结数据、显示时间趋势、显示地理数据等等。</p><p id="2107" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">有时静态的可视化是完美的，但在其他情况下，创建一些交互的东西会更清晰，对最终用户更有用，或者更酷更有趣！</p><p id="0e4a" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在本文中，我们将介绍创建显示美国鳄梨价格的交互式热图的过程，该热图可以在任何现代 web 浏览器中轻松查看和操作。我们将使用 Python 来完成，主要使用<a class="ae kv" href="https://docs.bokeh.org/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">散景</a>和<a class="ae kv" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫</a> <a class="ae kv" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank">数据帧</a>。</p><p id="9f0e" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在看到<a class="ae kv" href="https://github.com/nadinezab" rel="noopener ugc nofollow" target="_blank">纳丁·阿梅西-博尔顿</a>的优秀项目<a class="ae kv" href="https://github.com/nadinezab/kc-house-prices-prediction" rel="noopener ugc nofollow" target="_blank">“预测国王郡的房价”</a>后，我受到启发开始使用散景，该项目非常有效地使用了散景。我建议把整本笔记本都看看——里面有一些非常有趣的东西。</p><h1 id="a645" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">入门指南</h1><p id="0349" class="pw-post-body-paragraph ld le iq lf b lg ms jr li lj mt ju ll lm mu lo lp lq mv ls lt lu mw lw lx ly ij bi translated">首先，我们需要一些 Python <a class="ae kv" href="https://www.w3schools.com/python/python_dictionaries.asp" rel="noopener ugc nofollow" target="_blank"> dict </a>形式的地理数据、熊猫数据帧或熊猫<a class="ae kv" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html" rel="noopener ugc nofollow" target="_blank"> GroupBy </a>对象。方便的是，我碰巧有一个旧的数据框架，我将在这篇文章中使用它。我在我的<a class="ae kv" rel="noopener" target="_blank" href="/mapping-avocado-prices-in-python-with-geopandas-geopy-and-matplotlib-c7e0ef08bc26">上一篇文章</a>中生成了这个文件，并使用<a class="ae kv" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_csv.html" rel="noopener ugc nofollow" target="_blank"> pd.to_csv() </a>将其导出。如果您对我为达到这一点所做的数据争论感兴趣，请查看一下。</p><p id="a458" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这篇文章的所有代码都可以在<a class="ae kv" href="https://github.com/thecraigd/BokehAvocado" rel="noopener ugc nofollow" target="_blank">这个 GitHub repo </a>中找到，如果你想在不安装任何东西的情况下进行编码，那么使用<a class="ae kv" href="https://mybinder.org/" rel="noopener ugc nofollow" target="_blank">活页夹</a> <a class="ae kv" href="https://mybinder.org/v2/gh/thecraigd/BokehAvocado/master" rel="noopener ugc nofollow" target="_blank">查看这里</a>。如果你只是想边看边读，我推荐你使用<a class="ae kv" href="https://nbviewer.jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本浏览器</a>。</p><h1 id="8755" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">为什么要用散景？</h1><p id="af76" class="pw-post-body-paragraph ld le iq lf b lg ms jr li lj mt ju ll lm mu lo lp lq mv ls lt lu mw lw lx ly ij bi translated">Bokeh 可以帮助你简单方便地制作好看且有用的交互式可视化效果，然后可以在所有现代浏览器中显示。这意味着你可以在一篇博客文章、一个内部仪表板或者任何你可以查看 HTML 的地方嵌入一些好的有用的东西。几乎每个人都有使用浏览器的经验，这对于让你的视觉呈现在观众面前非常有用。</p><p id="a45e" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我的目的的主要卖点是交互性。在我们的<a class="ae kv" href="http://www.craigdoesdata.de/blog/avocadobokeh.html" rel="noopener ugc nofollow" target="_blank">示例</a>中，我们今天使用的是地理地图，因此允许用户随意放大和缩小以查看我们的数据点的物理分布，以及当用户悬停在某个点上时选择突出显示哪些数据的能力，让我们创建了一个直观的可视化，我们的观众可以按照自己的节奏进行交互和操作。这反过来会让他们更容易将我们的发现<a class="ae kv" rel="noopener" target="_blank" href="/how-to-work-with-stakeholders-as-a-data-scientist-13a1769c8152">应用到</a>身上，这对任何数据专业人士来说都是一个优势！</p><p id="8d23" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">如果您有一个工作的 Python 设置，在您的系统上安装散景相对简单。我自己正在使用 Anaconda 生态系统，所以只需要一个简单的<code class="fe mx my mz na b">conda install bokeh</code>就可以了。如果你喜欢 pip，那么<code class="fe mx my mz na b">pip install bokeh</code>也可以。更多信息可以在他们的<a class="ae kv" href="https://docs.bokeh.org/en/latest/docs/user_guide/quickstart.html#userguide-quickstart" rel="noopener ugc nofollow" target="_blank">快速入门指南</a>中找到。</p><h1 id="cfd5" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">它是如何工作的？</h1><p id="5bef" class="pw-post-body-paragraph ld le iq lf b lg ms jr li lj mt ju ll lm mu lo lp lq mv ls lt lu mw lw lx ly ij bi translated">散景是建立在四个主要概念上的:地块、字形、引导线和注释以及范围。为了获得完整的信息，我强烈推荐阅读<a class="ae kv" href="https://docs.bokeh.org/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">文档</a>(总是<a class="ae kv" href="https://danieldonbavand.com/documentationisimportant/" rel="noopener ugc nofollow" target="_blank">阅读文档</a>！)，但是我会在这里提供一个非常简短的说明。</p><ul class=""><li id="6581" class="nb nc iq lf b lg lh lj lk lm nd lq ne lu nf ly ng nh ni nj bi translated">剧情。这是您将在输出中看到的所有内容的容器。您将创建一个呈现给用户的图形。任何使用过<a class="ae kv" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> Matplotlib </a>或<a class="ae kv" href="https://seaborn.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Seaborn </a>或 Python 中其他可视化库的人都会熟悉这个想法。</li><li id="64fd" class="nb nc iq lf b lg nk lj nl lm nm lq nn lu no ly ng nh ni nj bi translated">象形文字。这就是散景如何显示你的观想。这些可以简单到一条线或一个圆，也可以复杂到像一个多边形，图像 url(很适合在 viz 上使用你的 logo！)或者文字。</li><li id="c47e" class="nb nc iq lf b lg nk lj nl lm nm lq nn lu no ly ng nh ni nj bi translated">参考线和注释。引导线是像轴、网格线等帮助用户理解比例和进行比较的东西。注释是像标题、图例等东西，它们提供额外的信息来帮助用户理解可视化。</li><li id="f781" class="nb nc iq lf b lg nk lj nl lm nm lq nn lu no ly ng nh ni nj bi translated">范围。这是数据的范围。你会注意到，如果你点击我的可视化，默认情况下，它会打开所有可见的数据点，以美国为中心(我所有的数据都来自那里)。如果你愿意，这可以在创建可视化时修改。</li></ul><h1 id="1b15" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">事实真相</h1><p id="8b99" class="pw-post-body-paragraph ld le iq lf b lg ms jr li lj mt ju ll lm mu lo lp lq mv ls lt lu mw lw lx ly ij bi translated">好了，言归正传。</p><p id="7d29" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">首先，我们想要导入我们的库。Bokeh 与您可能熟悉的其他 Python 可视化库(如<a class="ae kv" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> Matplotlib </a>或<a class="ae kv" href="https://seaborn.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Seaborn </a>)略有不同，因为它被排列为许多不同的子模块，您可以从中导入您需要的函数。它没有一个可以导入来访问所有功能的包罗万象的包。</p><p id="af3d" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这确实使了解它变得有点困难，但是您可以遵循下面的代码。习惯了就不太恐怖了！</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="c349" class="nt mb iq na b gy nu nv l nw nx">from bokeh.io import output_notebook, show, output_file<br/>from bokeh.plotting import figure, ColumnDataSource<br/>from bokeh.tile_providers import get_provider, Vendors<br/>from bokeh.palettes import PRGn, RdYlGn<br/>from bokeh.transform import linear_cmap,factor_cmap<br/>from bokeh.layouts import row, column<br/>from bokeh.models import GeoJSONDataSource, LinearColorMapper, ColorBar, NumeralTickFormatter</span><span id="bda2" class="nt mb iq na b gy ny nv l nw nx">import numpy as np<br/>import pandas as pd</span></pre><p id="663c" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">好了，现在我们准备开始了。首先，我们需要一些数据。我们将使用我们的 CSV 文件，我们可以使用<a class="ae kv" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html" rel="noopener ugc nofollow" target="_blank"> pd.read_csv() </a>将它作为数据帧读入 pandas:</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="dca8" class="nt mb iq na b gy nu nv l nw nx">import pandas as pd</span><span id="0b93" class="nt mb iq na b gy ny nv l nw nx">df = pd.read_csv('avocado_df.csv', index_col=0)</span><span id="456b" class="nt mb iq na b gy ny nv l nw nx">display(df.head())</span></pre><p id="ea15" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这为我们提供了以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/0193f29e0328610a99da5d200e6af328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wTGFbDTc0C2q7ZnQoFcQIw.jpeg"/></div></div></figure><p id="f97c" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">出于他们自己最了解的原因<a class="ae kv" href="https://docs.bokeh.org/en/latest/docs/user_guide/geo.html" rel="noopener ugc nofollow" target="_blank"/>，散景图使用<a class="ae kv" href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system" rel="noopener ugc nofollow" target="_blank">墨卡托坐标</a>。我们的位置以经度和纬度列出。这意味着我们需要将纬度和经度转换成墨卡托坐标。</p><p id="4ad6" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">参与编程和数据分析这样一项有趣而富有挑战性的活动的一大好处是，对于你遇到的大多数困难问题，其他一些聪明人可能以前也遇到过。为了取得进步和提高你的技能，你还需要发展<a class="ae kv" href="https://knightlab.northwestern.edu/2014/03/13/googling-for-code-solutions-can-be-tricky-heres-how-to-get-started/" rel="noopener ugc nofollow" target="_blank">有效谷歌</a>的技能，找到那些聪明人在你之前找到的答案！</p><p id="8ce3" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在我们的例子中，我们的开拓者<a class="ae kv" href="https://github.com/nadinezab" rel="noopener ugc nofollow" target="_blank"> Nadine Amersi-Bolton </a>已经解决了这个问题，并为我们创建了一个函数来完成这个转换。这非常好，所以我们将<a class="ae kv" href="https://www.lifehack.org/articles/work/dont-work-harder-work-smarter-with-these-12-tips.html" rel="noopener ugc nofollow" target="_blank">更聪明地</a>工作，而不是更努力地使用这个现有的解决方案。谢谢纳丁。</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="f499" class="nt mb iq na b gy nu nv l nw nx"># Define function to switch from lat/long to mercator coordinates<br/>def x_coord(x, y):<br/>    <br/>    lat = x<br/>    lon = y<br/>    <br/>    r_major = 6378137.000<br/>    x = r_major * np.radians(lon)<br/>    scale = x/lon<br/>    y = 180.0/np.pi * np.log(np.tan(np.pi/4.0 + <br/>        lat * (np.pi/180.0)/2.0)) * scale<br/>    return (x, y)</span><span id="ff94" class="nt mb iq na b gy ny nv l nw nx"># Define coord as tuple (lat,long)<br/>df['coordinates'] = list(zip(df['latitude'], df['longitude']))</span><span id="fbf5" class="nt mb iq na b gy ny nv l nw nx"># Obtain list of mercator coordinates<br/>mercators = [x_coord(x, y) for x, y in df['coordinates'] ]</span></pre><p id="ee37" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">现在我们只需要将这一列添加到我们的数据帧中，并将其分成两个单独的列(一个用于 x 坐标，一个用于 y 坐标)。我们可以用熊猫通过两个简单的步骤做到这一点。</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="bad5" class="nt mb iq na b gy nu nv l nw nx"># Create mercator column in our df<br/>df['mercator'] = mercators</span><span id="ee93" class="nt mb iq na b gy ny nv l nw nx"># Split that column out into two separate columns - mercator_x and mercator_y<br/>df[['mercator_x', 'mercator_y']] = df['mercator'].apply(pd.Series)</span></pre><p id="e4ea" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">当我运行这个程序时，我发现散景非常不想与数据帧中的<code class="fe mx my mz na b">geometry</code>列合作。这来自我们在之前的<a class="ae kv" rel="noopener" target="_blank" href="/mapping-avocado-prices-in-python-with-geopandas-geopy-and-matplotlib-c7e0ef08bc26">可视化</a>中使用的<a class="ae kv" href="https://pypi.org/project/Shapely/" rel="noopener ugc nofollow" target="_blank">匀称的</a>文件，这里不需要。我们可以用<a class="ae kv" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html" rel="noopener ugc nofollow" target="_blank"> df.drop() </a>来摆脱它。</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="15eb" class="nt mb iq na b gy nu nv l nw nx">df = df.drop(columns=['geometry']</span><span id="4219" class="nt mb iq na b gy ny nv l nw nx"><br/># Examine our modified DataFrame<br/>df.head()</span></pre><p id="51cf" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这给了我们:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/ab304a5924cecec3047bf962ec022c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NEBf7D7VQNIKaVeF0vpYEQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">看那些墨卡托 x 和墨卡托 y 柱！太棒了。</p></figure><h1 id="fdf1" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">准备我们的阴谋</h1><p id="be4e" class="pw-post-body-paragraph ld le iq lf b lg ms jr li lj mt ju ll lm mu lo lp lq mv ls lt lu mw lw lx ly ij bi translated">现在我们有了开始策划的一切。在创建我们的数字之前，我们需要先做一些准备工作。这些包括:选择用于地图的图块；选择我们的调色板；指示散景使用哪个数据帧作为信息源；创建颜色映射器；并设置我们的工具提示。</p><p id="2a83" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">别担心，我们会边走边检查的！</p><p id="7991" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">首先—选择我们的瓷砖提供商。有各种组织提供可以在散景中使用的地图拼图。这些可能是<a class="ae kv" href="https://developers.google.com/android/reference/com/google/android/gms/maps/model/TileProvider" rel="noopener ugc nofollow" target="_blank">谷歌地图</a>(很棒，但需要一个 API，所以我们不会在这里使用它)或<a class="ae kv" href="https://carto.com/" rel="noopener ugc nofollow" target="_blank"> CartoDB </a>(也很棒)或<a class="ae kv" href="http://maps.stamen.com/#toner/12/37.7706/-122.3782" rel="noopener ugc nofollow" target="_blank"> Stamen </a>。这些大多使用<a class="ae kv" href="https://wiki.openstreetmap.org/wiki/Tile_servers" rel="noopener ugc nofollow" target="_blank"> OpenStreetMap </a>数据，一般可靠性很高。我们将使用雄蕊碳粉，因为它看起来很棒，单色造型将允许我们的彩色数据点很好地显示出来。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/38b70afbf7d9892b1cffae97c7c96dbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YuFqEr02SDUM8GN_8zl_YQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用<a class="ae kv" href="http://maps.stamen.com/m2i/#toner/" rel="noopener ugc nofollow" target="_blank">雄蕊调色剂</a>制作的西欧地图|由<a class="ae kv" href="http://stamen.com" rel="noopener ugc nofollow" target="_blank">雄蕊设计</a>制作的地图拼贴，在<a class="ae kv" href="http://creativecommons.org/licenses/by/3.0" rel="noopener ugc nofollow" target="_blank"> CC 下由 3.0 </a>制作。数据由<a class="ae kv" href="https://www.openstreetmap.org/" rel="noopener ugc nofollow" target="_blank"> OpenStreetMap </a>提供，在<a class="ae kv" href="http://www.openstreetmap.org/copyright" rel="noopener ugc nofollow" target="_blank"> ODbL </a>下。</p></figure><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="b40e" class="nt mb iq na b gy nu nv l nw nx"># Select tile set to use<br/>chosentile = get_provider(Vendors.STAMEN_TONER)</span></pre><p id="9c8a" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">接下来，我们需要选择一个<a class="ae kv" href="https://docs.bokeh.org/en/latest/docs/reference/palettes.html" rel="noopener ugc nofollow" target="_blank">调色板。</a>当我们在处理鳄梨时，我选择了紫绿色的 PRGn。我们可以使用<code class="fe mx my mz na b">PRGn[3]</code>到<code class="fe mx my mz na b">PRGn[11]</code>选择 3 到 11 种色调。我们将使用最大化来获得我们视觉化的最大变化。</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="e715" class="nt mb iq na b gy nu nv l nw nx"># Choose palette<br/>palette = PRGn[11]</span></pre><p id="3db3" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">现在我们想通过使用<a class="ae kv" href="https://docs.bokeh.org/en/latest/docs/reference/models/sources.html?highlight=columndatasource#bokeh.models.sources.ColumnDataSource" rel="noopener ugc nofollow" target="_blank"> ColumnDataSource </a>将散景指向我们的数据帧。</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="cb72" class="nt mb iq na b gy nu nv l nw nx"># Tell Bokeh to use df as the source of the data<br/>source = ColumnDataSource(data=df)</span></pre><p id="bd3d" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">接下来我们需要定义颜色映射器。在这种情况下，我们想让散景知道是我们的<code class="fe mx my mz na b">'AveragePrice'</code>字段决定了数据点的颜色。</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="9c72" class="nt mb iq na b gy nu nv l nw nx"># Define color mapper - which column will define the colour of the data points<br/>color_mapper = linear_cmap(field_name = 'AveragePrice', palette = palette, low = df['AveragePrice'].min(), high = df['AveragePrice'].max())</span></pre><p id="4191" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在我们构建图形之前，要做的最后一件准备工作是选择哪些字段应该用作<a class="ae kv" href="https://docs.bokeh.org/en/latest/docs/reference/models/tools.html?highlight=tooltips#bokeh.models.tools.HoverTool.tooltips" rel="noopener ugc nofollow" target="_blank">工具提示</a>——也就是说，当用户将鼠标悬停在地图上的数据点上时，应该显示哪些字段。在这种情况下，我们将选择<code class="fe mx my mz na b">'AveragePrice'</code>字段和<code class="fe mx my mz na b">'Region'</code>，因为它们可能是我们的观众最感兴趣的。</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="11b0" class="nt mb iq na b gy nu nv l nw nx"># Set tooltips - these appear when we hover over a data point in our map, very nifty and very useful<br/>tooltips = [("Price","<a class="ae kv" href="http://twitter.com/AveragePrice" rel="noopener ugc nofollow" target="_blank">@AveragePrice</a>"), ("Region","<a class="ae kv" href="http://twitter.com/region" rel="noopener ugc nofollow" target="_blank">@region</a>")]</span></pre><h1 id="14f4" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">创建图形</h1><p id="06ab" class="pw-post-body-paragraph ld le iq lf b lg ms jr li lj mt ju ll lm mu lo lp lq mv ls lt lu mw lw lx ly ij bi translated">我们快到了！坚持住。</p><p id="20dd" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">下一步是定义我们的数字。这个图形是我们所有元素的持有者。我们这样设置它:</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="556b" class="nt mb iq na b gy nu nv l nw nx"># Create figure<br/>p = figure(title = 'Avocado Prices by region in the United States', x_axis_type="mercator", y_axis_type="mercator", x_axis_label = 'Longitude', y_axis_label = 'Latitude', tooltips = tooltips)</span></pre><p id="c27b" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">您可以看到，我们已经为图形指定了标题，将轴类型设置为墨卡托，为两个轴都指定了标签，并告诉 Bokeh 在哪里可以找到关于 tootltips 的信息。所有这些都在一行代码中——不错！</p><p id="5c56" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">现在我们需要添加图块，否则我们的数据点会漂浮在空白背景上。不是如此引人注目的观想！</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="cc35" class="nt mb iq na b gy nu nv l nw nx"># Add map tile<br/>p.add_tile(chosentile)</span></pre><p id="2494" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">下一步是创建数据点本身:</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="47b6" class="nt mb iq na b gy nu nv l nw nx"># Add points using mercator coordinates<br/>p.circle(x = 'mercator_x', y = 'mercator_y', color = color_mapper, source=source, size=30, fill_alpha = 0.7)</span></pre><p id="11ad" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在这种情况下，我们调整了<code class="fe mx my mz na b">fill_alpha</code>，这减少了圆圈的不透明度，并允许用户在缩小时更容易理解重叠的数据点。我们还将圆的大小设置为 30。大小在每一级缩放中都保持不变，所以尝试一下，看看什么适合您的数据。</p><p id="642c" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我们的下一步是创建一个颜色条——这将作为我们可视化旁边的一个图例，提供关于我们的数据点上使用的颜色的含义的重要信息。绿色是贵还是便宜？(贵！)通过给我们的用户这些信息，他们一眼就能明白观想在向他们展示什么。</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="c004" class="nt mb iq na b gy nu nv l nw nx">#Defines color bar<br/>color_bar = ColorBar(color_mapper=color_mapper['transform'], <br/>                     formatter = NumeralTickFormatter(format='0.0[0000]'), <br/>                     label_standoff = 13, width=8, location=(0,0))</span><span id="8843" class="nt mb iq na b gy ny nv l nw nx"># Set color_bar location<br/>p.add_layout(color_bar, 'right')</span></pre><p id="3271" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">现在只需几个步骤来确保我们可以在 Jupyter 笔记本中看到可视化，并将文件保存为 HTML 文件，然后我们可以<a class="ae kv" href="http://www.craigdoesdata.de/blog/avocadobokeh.html" rel="noopener ugc nofollow" target="_blank">将它嵌入到我们想要的任何地方</a>。</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="c304" class="nt mb iq na b gy nu nv l nw nx"># Display in notebook<br/>output_notebook()</span><span id="7cab" class="nt mb iq na b gy ny nv l nw nx"># Save as HTML<br/>output_file('avocado.html', title='Avocado Prices by region in the United States')</span></pre><p id="2901" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我们到了。我们准备赞美我们的劳动成果！只差一步了:</p><pre class="kg kh ki kj gt np na nq nr aw ns bi"><span id="94da" class="nt mb iq na b gy nu nv l nw nx"># Show map<br/>show(p)</span></pre><p id="d804" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">瞧啊。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a5a654c4227cd5d4e90341d19995d072.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WOYrwHRGj4X1GWkEFQtddA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">辉煌的漫威！<a class="ae kv" href="http://www.craigdoesdata.de/blog/avocadobokeh.html" rel="noopener ugc nofollow" target="_blank">放大，摆弄一下</a>！</p></figure><p id="5f47" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">哒哒！现在，我们已经从一个包含一些位置数据的 CSV 文件变成了一个完全成熟的交互式地图，我们可以将它嵌入到我们的仪表盘、博客帖子或任何我们想嵌入的地方。</p><p id="9f50" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我希望这篇文章能给你灵感，让你自己用散景做出一些伟大的东西。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="0b46" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">非常感谢您抽出时间和我一起探讨这个话题。一如既往，我非常欢迎您的反馈——您可以在 Twitter 上通过@<a class="ae kv" href="https://twitter.com/craigdoesdata" rel="noopener ugc nofollow" target="_blank">craigdoedata</a>联系我，让我知道我如何才能更有效地完成这项分析。</p><p id="2b73" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">你可以在我的网站<a class="ae kv" href="http://www.craigdoesdata.de" rel="noopener ugc nofollow" target="_blank">www . craigdoedata . de</a>上看到我还在做什么。</p><p id="360d" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">再说一遍，整个 Jupyter 笔记本和相关文件都可以在我的<a class="ae kv" href="https://github.com/thecraigd/BokehAvocado" rel="noopener ugc nofollow" target="_blank"> Github 页面</a>和<a class="ae kv" href="https://mybinder.org/v2/gh/thecraigd/BokehAvocado/master" rel="noopener ugc nofollow" target="_blank">活页夹</a>上找到，我鼓励你使用它们。</p><p id="53cb" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">下次见！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/324a05c7bd405dbd438a0d3fd4d52366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jTJOsuU4DWXzQVeC.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">更像这样？访问<a class="ae kv" href="https://www.craigdoesdata.de/" rel="noopener ugc nofollow" target="_blank">craigdoedata . de</a></p></figure></div></div>    
</body>
</html>