<html>
<head>
<title>Automating Data Science Projects With Jenkins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与 Jenkins 一起自动化数据科学项目</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automating-data-science-projects-with-jenkins-8e843771aa02?source=collection_archive---------28-----------------------#2020-08-03">https://towardsdatascience.com/automating-data-science-projects-with-jenkins-8e843771aa02?source=collection_archive---------28-----------------------#2020-08-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5825" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用 Jenkins 自动化数据科学代码</h2></div><p id="da00" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们描绘一个场景，您正在进行一个数据科学项目，起初，您有一个 80%的模型准确性，您使用 Flask 将该应用程序作为 API 部署到生产中。然后几天后，你决定继续这个项目，在调整了一些参数并增加了一些数据后，你有了比之前建立的模型更好的精确度。现在，您计划部署该模型，您必须经历构建、测试和再次将该模型部署到生产环境的麻烦，这是一项繁重的工作。在本文中，我将向您展示我们如何使用一个名为<strong class="kk iu"> Jenkins </strong>的强大工具来自动化这个过程。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/49d893da95780238e4baa6a06fdd5178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3VTmxylb6rmtdkXp"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated"><a class="ae lu" href="https://unsplash.com/@yancymin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">扬西·敏</a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="9949" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">詹金斯是什么？</h1><p id="fe23" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">Jenkins 是一个免费的开源自动化服务器。它帮助自动化与<a class="ae lu" href="https://en.wikipedia.org/wiki/Software_build" rel="noopener ugc nofollow" target="_blank">构建</a>、<a class="ae lu" href="https://en.wikipedia.org/wiki/Test_automation" rel="noopener ugc nofollow" target="_blank">测试</a>和<a class="ae lu" href="https://en.wikipedia.org/wiki/Software_deployment" rel="noopener ugc nofollow" target="_blank">部署</a>相关的<a class="ae lu" href="https://en.wikipedia.org/wiki/Software_development" rel="noopener ugc nofollow" target="_blank">软件开发</a>部分，促进<a class="ae lu" href="https://en.wikipedia.org/wiki/Continuous_integration" rel="noopener ugc nofollow" target="_blank">持续集成</a>和<a class="ae lu" href="https://en.wikipedia.org/wiki/Continuous_delivery" rel="noopener ugc nofollow" target="_blank">持续交付</a>——维基百科</p><p id="f84c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">借助 Jenkins，您可以使用大量插件，在整个生命周期中自动化并加速软件交付过程。例如，您可以设置 Jenkins 自动检测存储库中的代码提交，并自动触发命令，从 Docker 文件构建 Docker 映像、运行单元测试、将映像推送到容器注册表或将其部署到生产服务器，而无需手动执行任何操作。我将解释一些我们需要知道的基本概念，以便在我们的数据科学项目中执行一些自动化。</p><h1 id="ce24" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">詹金斯的优势</h1><ol class=""><li id="df8c" class="ms mt it kk b kl mn ko mo kr mu kv mv kz mw ld mx my mz na bi translated">它是开源的</li><li id="8814" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated">易于使用和安装</li><li id="073e" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated">大量适合 DevOps 环境的插件</li><li id="266e" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated">在代码上花更多时间，在部署上花更少时间</li><li id="319d" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated">大型社区</li></ol><h1 id="8682" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">詹金斯装置</h1><p id="b4a9" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">Jenkins 支持跨平台安装，无论您是 Windows、Linux 还是 Mac 用户。您甚至可以将它安装在支持 PowerShell 或 Linux 实例的云服务器上。要安装 Jenkins，可以参考文档<a class="ae lu" href="https://www.jenkins.io/doc/book/installing/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="da5d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Jenkins 有很多惊人的特性，有些超出了本文的范围，要掌握 Jenkins 的窍门，你可以查看<a class="ae lu" href="https://www.jenkins.io/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="c220" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们开始实际操作之前，我想解释一些非常重要的术语，其中包括:</p><h2 id="a71d" class="ng lw it bd lx nh ni dn mb nj nk dp mf kr nl nm mh kv nn no mj kz np nq ml nr bi translated">詹金斯工作</h2><p id="b76c" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">Jenkins 作业只是指由 Jenkins 控制的可运行任务。例如，你可以分配一个任务给 Jenkins 来执行一些特定的操作，比如运行“Hello World”，执行单元和集成测试等等。在 Jenkins 中创建工作非常容易，但是在软件环境中，你可能不会创建一个单独的工作，相反，你会做被称为<strong class="kk iu">管道</strong>的事情。</p><h2 id="dde4" class="ng lw it bd lx nh ni dn mb nj nk dp mf kr nl nm mh kv nn no mj kz np nq ml nr bi translated"><strong class="ak">詹金斯管道</strong></h2><p id="7778" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">管道按照特定的顺序运行一组作业，让我用一个例子来解释。假设我正在 Jenkins 上开发一个应用程序，我想从代码库中提取代码，构建应用程序，测试并将其部署到服务器上。为此，我将创建四个作业来执行每个进程。因此，第一个作业(作业 1)将从存储库中提取代码，第二个作业(作业 2)将构建应用程序，第三个作业(作业 3)将执行单元和集成测试，第四个作业(作业 4)将代码部署到生产环境中。我可以使用 Jenkins 构建管道插件来执行这项任务。在创建作业并将它们按顺序链接起来之后，构建插件会将这些作业作为一个管道来运行。</p><p id="9173" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">詹金斯管道的类型:</p><ol class=""><li id="9d11" class="ms mt it kk b kl km ko kp kr ns kv nt kz nu ld mx my mz na bi translated">声明性管道:这是一个支持管道作为代码概念的特性。它使管道代码更容易阅读和编写。这段代码写在一个<strong class="kk iu"> Jenkinsfile </strong>中，它可以被签入一个源代码控制管理系统，比如 Git。</li><li id="3861" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated">脚本管道:这是编写代码的老方法之一。使用这种方法，管道代码被<strong class="kk iu">写在 Jenkins 用户界面实例</strong>上，而不是写在文件中。尽管这两个管道执行相同的功能，并且使用相同的脚本语言(Groovy)。</li></ol><p id="dd89" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在讨论了主要概念之后，让我们构建一个简单的迷你项目，并使用 Jenkins 实现自动化。</p><p id="2ad4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个项目包含一个经过训练的机器学习模型，它可以检测来自 twitter 的与自杀相关的情绪，我使用 flask 将它部署为一个 API。我构建了我的 Jenkins 管道:</p><p id="1ecf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">提交时从存储库中提取更改&gt;&gt;&gt;构建 Docker 映像&gt;&gt;&gt;将构建的映像推送到 DockerHub &gt; &gt; &gt;删除未使用的 Docker 映像。</p><h1 id="8767" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">步伐</h1><p id="b6a7" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">启动一个 Jenkins 服务器，安装 Git、Docker、Pipeline 和 build 插件，并在实例中安装 Git 和 Docker。对于本文，我在 AWS EC2 实例上使用了 Jenkins。</p><p id="ae08" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将代码推送到存储库，在本文中我使用了 Github。你可以在这里找到这篇文章的代码。</p><p id="7cfc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的工作目录:</p><pre class="lf lg lh li gt nv nw nx ny aw nz bi"><span id="d4bb" class="ng lw it nw b gy oa ob l oc od">.<br/>├── app.py<br/>├── CustomCode<br/>│   └── data_preprocessing.py<br/>├── Dockerfile<br/>├── Jenkinsfile<br/>├── ML_model<br/>│   └── model.pkl<br/>└── requirements.txt</span></pre><p id="c888" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们需要告诉 Jenkins，每当代码库中发生更改时，就开始构建管道。为此，您需要将 Jenkins webhook 添加到 Github 存储库中，以便 GitHub 在代码发生变化时与 Jenkins 进行通信。为此:</p><p id="f7f9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">点击代码库中的<strong class="kk iu">设置</strong></p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/485c1b280b4aa2858fec9dc9518ede26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C_9332WjaotRcGdYofKcqg.jpeg"/></div></div></figure><p id="e47b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后导航到 webhooks，点击<strong class="kk iu">添加 Webhook </strong></p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/2f374a8c3af2e5456c8414566afc73b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nkYkbQr3-izXmw2wJhOnJA.jpeg"/></div></div></figure><p id="5b7d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后使用你的 Jenkins 服务器的公共 DNS 或公共 IP 并在末尾添加“<strong class="kk iu">/github-web hook/”</strong>，然后选择 application/json 作为内容类型。在“您希望哪个事件触发此网页挂钩？”，选择单个事件并选择<strong class="kk iu">仅推</strong>并点击添加 webhook。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi of"><img src="../Images/92458d337a1b39835f330184f6e3a943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGb4sA_tkHLTBfPxMVQIUQ.png"/></div></div></figure><p id="daee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，前往 Jenkins 并点击<strong class="kk iu">新项目</strong></p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/4947b6d409086911dbef55f201e848dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v9wwq--F6n93TD7Ia44LgA.jpeg"/></div></div></figure><p id="7fad" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输入项目名称，选择管道，点击<strong class="kk iu">确定</strong></p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/f7ce8cd3ebfb57911708e438adf6430d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bd5zvTj8tlN3GuqXPZDkFg.jpeg"/></div></div></figure><p id="4116" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从 General 向下滚动到 Build Triggers 并选择<strong class="kk iu">Github hook trigger for git SCM polling</strong>。它的简单作用是，每当代码中有提交时，帮助我们构建管道</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/e51fe31898faacf567c70f7a26aa3423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CIxkHFmBA0HXBQVZtBqFHA.jpeg"/></div></div></figure><p id="ad65" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后滚动到管道，并在定义中从下拉列表中选择来自 SCM 的管道脚本。在 SCM(源代码管理)中，选择 Git 并输入存储库 URL，如果您的存储库是私有的，您需要使用您的用户名和密码创建一个凭证。在分支说明符中，您可以选择 master 或者您的代码存储库所在的任何分支，脚本路径选择<strong class="kk iu"> Jenkinsfile，</strong>Jenkins file 是我为项目编写管道的地方。然后选择<strong class="kk iu">保存</strong>。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/068b1087340db9ac0063ff2177c6669e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N6iSn2_I2lVnc8OmzeJ-Rg.jpeg"/></div></div></figure><p id="e82f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们建立管道…</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/6a1cfae23717d94269a14d6c74307993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FnEpFPMgR7rVZwNxph1Phw.jpeg"/></div></div></figure><p id="8a64" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它贯穿了所有的阶段，构建是成功的</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/677c675e22ee28ec0f32ab1b7d53f592.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K9wrpZ0zK30botoQegKnUg.png"/></div></div></figure><p id="a4ce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你查看你的 Docker Hub 库，你会在那里找到 Docker 图片。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/07cacd873f4be5f57e16c968ef905bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*anE8yQjXqMzZtKlWVOipxg.jpeg"/></div></div></figure><p id="2b2b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们在代码库中做一点小小的改变</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/3db2e73c16e694aa5984790abab3a409.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0-3ie5bvAL2ig9RRgQQQsg.png"/></div></div></figure><p id="3a9a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，如果你回到 Jenkins，你会看到它已经检测到已经做出的更改，并自动触发另一个构建。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/bb0d60844ac78c6c900b26064e0b0fe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hfUdg6WQ1kqzxUFpxX6G4w.png"/></div></div></figure><p id="8d51" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是如何使用 Jenkins 来自动化这三个过程。</p><p id="610b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读😃</p></div></div>    
</body>
</html>