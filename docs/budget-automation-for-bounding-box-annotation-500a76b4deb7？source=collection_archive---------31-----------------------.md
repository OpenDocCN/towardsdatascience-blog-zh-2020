# ç”¨äºè¾¹ç•Œæ¡†æ³¨é‡Šçš„é¢„ç®—è‡ªåŠ¨åŒ–

> åŸæ–‡ï¼š<https://towardsdatascience.com/budget-automation-for-bounding-box-annotation-500a76b4deb7?source=collection_archive---------31----------------------->

## [å®è·µæ•™ç¨‹](https://towardsdatascience.com/tagged/hands-on-tutorials)

## äº†è§£å¦‚ä½•ä½¿ç”¨ TensorFlow.js åŠ é€Ÿæ•°æ®æ³¨è®°

# ä»‹ç»ğŸ‘‹

[æœ€åˆå‘å¸ƒäº bitsy.ai](https://www.bitsy.ai/automate-bounding-box-annotation-with-tensorflow-and-automl/)

æ•°æ®æ”¶é›†å’Œå‡†å¤‡æ˜¯æ¯ä¸ªæœºå™¨å­¦ä¹ åº”ç”¨çš„åŸºç¡€ã€‚ä½ ä»¥å‰å¬è¯´è¿‡:â€œåƒåœ¾è¾“å…¥ï¼Œåƒåœ¾è¾“å‡ºâ€ï¼ŒæŒ‡çš„æ˜¯ç®—æ³•çº æ­£ä¸å‡†ç¡®ã€è´¨é‡å·®æˆ–æœ‰åè§çš„è¾“å…¥æ•°æ®çš„èƒ½åŠ›æœ‰é™ã€‚

é«˜è´¨é‡æ ‡æ³¨æ•°æ®çš„æˆæœ¬ä¿ƒä½¿å·¥å…·/å¹³å°çš„å®¶åº­å·¥ä¸šåŠ é€Ÿæ•°æ®æ ‡æ³¨è¿‡ç¨‹ã€‚é™¤äº† SaaS/æœ¬åœ°åˆ›ä¸šç”Ÿæ€ç³»ç»Ÿï¼Œæ¯ä¸ªä¸»è¦çš„äº‘æä¾›å•†(AWSã€å¾®è½¯ã€è°·æ­Œ)åœ¨è¿‡å»ä¸¤å¹´éƒ½æ¨å‡ºäº†è‡ªåŠ¨åŒ–æ•°æ®æ ‡ç­¾äº§å“ã€‚å¯ä»¥ç†è§£çš„æ˜¯ï¼Œå¼€å‘è¿™äº›æœåŠ¡æ—¶é€šå¸¸ä¼šè€ƒè™‘åˆ°é«˜çº§/ä¼ä¸šç”¨æˆ·ã€åŠŸèƒ½å’Œä»·ä½ã€‚

## åœ¨æœ‰é™çš„é¢„ç®—ä¸‹ï¼Œæˆ‘æ˜¯ä¸æ˜¯åªèƒ½æ‰‹å·¥ç»™*çš„æ‰€æœ‰ä¸œè¥¿*è´´æ ‡ç­¾ï¼Ÿ

å¥½æ¶ˆæ¯ã€‚ç¨åŠ åŠªåŠ›ï¼Œä½ å°±å¯ä»¥ä¸ºä½ è‡ªå·±æˆ–ä¸€ä¸ªå°å›¢é˜Ÿè‡ªåŠ¨åŒ–è¾¹ç•Œæ¡†æ³¨é‡Šã€‚åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºæˆ‘ç”¨æ¥å¿«é€ŸåŸå‹åŒ– 3D æ‰“å°æ•…éšœæ£€æµ‹æ¨¡å‹çš„è‡ªåŠ¨åŒ–æŠ€æœ¯ã€‚

æ‚¨å°†å­¦ä¹ å¦‚ä½•:

1.  ä¸ºäººç±»è´´æ ‡æœºåˆ›å»ºè¯¦ç»†çš„è¯´æ˜
2.  è®­ç»ƒåˆ¶å¯¼æ¨¡å‹
3.  ä½¿ç”¨ [Microsoft VoTT](https://github.com/microsoft/VoTT) (å¯è§†å¯¹è±¡æ ‡è®°å·¥å…·)å’Œ TensorFlow.js è‡ªåŠ¨æ ‡æ³¨è¾¹ç•Œæ¡†

å›¾ä¸º:è‡ªå®šä¹‰ TensorFlow æ¨¡å‹åœ¨å¾®è½¯ VoTT(å¯è§†å¯¹è±¡æ ‡è®°å·¥å…·)ä¸­è‡ªåŠ¨æ ‡æ³¨ä¸€ä¸ªè§†é¢‘å¸§ã€‚

![](img/99488a3abb64135a6c833013a7074fd4.png)

è‡ªå®šä¹‰å¼ é‡æµæ¨¡å‹åœ¨ Microsoft VoTT(å¯è§†å¯¹è±¡æ ‡è®°å·¥å…·)ä¸­è‡ªåŠ¨æ³¨é‡Šè§†é¢‘å¸§ã€‚å›¾ç‰‡ä½œè€…ã€‚

# ç¬¬ä¸€éæ³¨é‡ŠğŸ·

å¦‚æœæ‚¨æ˜¯ä»æ²¡æœ‰æ ‡ç­¾çš„åœ°æ–¹å¼€å§‹ï¼Œæ‚¨ç¡®å®éœ€è¦ç¡¬ç€å¤´çš®æ‰‹å·¥æ³¨é‡Šä¸€äº›æ•°æ®ã€‚ä¸ºæ³¨é‡Šå†³ç­–åˆ›å»ºä¹¦é¢æŒ‡å—å’Œè¯„ä¼°æ ‡å‡†ï¼Œéœ€è¦æ‰‹åŠ¨æ ‡è®°è‡³å°‘å‡ ç™¾ä¸ªç¤ºä¾‹ã€‚

## ä»æºä»£ç å®‰è£… VoTT(è§†è§‰å¯¹è±¡è·Ÿè¸ªå·¥å…·)

Microsoft VoTT æ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œç”¨äºç”¨è¾¹ç•Œæ¡†(å¯¹è±¡æ£€æµ‹)å’Œå¤šè¾¹å½¢(åˆ†å‰²)æ¥æ³¨é‡Šå›¾åƒå’Œè§†é¢‘ã€‚æˆ‘ä½¿ç”¨ VoTT æ˜¯å› ä¸ºå®ƒ:

*   æ”¯æŒå¤šç§å¯¼å‡ºæ ¼å¼
*   å¯ä»¥ä½œä¸º web åº”ç”¨ç¨‹åºæ‰˜ç®¡
*   è®©æˆ‘ä» TensorFlow.js æ¨¡å‹é¢„å¡«å……è¾¹ç•Œæ¡†å»ºè®®

å®‰è£…å…ˆå†³æ¡ä»¶:

*   NodeJS (>= 10.x)å’Œ NPMã€‚æˆ‘æ¨è [NVM](https://github.com/nvm-sh/nvm) (èŠ‚ç‚¹ç‰ˆæœ¬ç®¡ç†å™¨)æ¥ç®¡ç† NodeJS å®‰è£…å’Œç¯å¢ƒã€‚

å…‹éš† VoTT repo å¹¶ä»æºå®‰è£…:

```
$ git clone https://github.com/microsoft/VoTT 
$ cd VoTT 
$ npm ci 
$ npm i @tensorflow/tfjs@2.7.0 
$ npm start
```

è¦ä½¿ç”¨è¾ƒæ–°çš„ opsï¼Œå¿…é¡»å‡çº§ TensorFlow.js åŒ…ã€‚

å‚è€ƒ[ä½¿ç”¨ VoTT](https://github.com/microsoft/VoTT#using-vott) åˆ›å»ºæ–°é¡¹ç›®å¹¶è®¾ç½®æ•°æ®è¿æ¥ã€‚

å¯»æ‰¾æ•°æ®é›†ï¼Ÿ[è¯•è¯•è°·æ­Œçš„æ•°æ®é›†æœç´¢](https://datasetsearch.research.google.com)ã€‚

## æ‰‹åŠ¨æ ‡è®°ä¸€äº›ç¤ºä¾‹

æ‚¨éœ€è¦æ‰‹åŠ¨æ ‡è®°çš„å›¾åƒæ•°é‡å–å†³äºé—®é¢˜é¢†åŸŸï¼Œä»å‡ åä¸ªå›¾åƒåˆ°å‡ åƒä¸ªå›¾åƒã€‚æˆ‘é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸ºæˆ‘çš„é—®é¢˜(æ£€æµ‹ 3D æ‰“å°ç¼ºé™·)è·å¾—äº†åˆç†çš„ç»“æœ:

*   5 ä¸ªæ ‡ç­¾(åˆ†å¸ƒå¦‚ä¸‹)
*   67 ä¸ªæ‰“å°å»¶æ—¶è§†é¢‘ï¼Œæ¯ç§’é‡‡æ · 3 å¸§
*   æµè§ˆäº† 6 248 å¼ å›¾ç‰‡
*   åœ¨ 3ï¼Œ215 å¹…å›¾åƒä¸Šç»˜åˆ¶äº† 9ï¼Œ004 ä¸ªè¾¹ç•Œæ¡†ï¼Œå¹³å‡æ¯å¹…å›¾åƒ 3 ä¸ªè¾¹ç•Œæ¡†ã€‚
*   å…«å°æ—¶ï¼Œåˆ†å‡ å¤©å®Œæˆã€‚æˆ‘åœ¨æ²¡æœ‰æ—©æ™¨é€šå‹¤çš„æƒ…å†µä¸‹èµ¶ä¸Šäº†æˆ‘ä¸€ç›´å¿½ç•¥çš„æ’­å®¢ã€‚

![](img/af1bb1d72e62a67e8cc3bf515ffcf0d3.png)

VoTT(è§†è§‰å¯¹è±¡è·Ÿè¸ªå·¥å…·)æä¾›çš„æ•°æ®é›†ç»Ÿè®¡ã€‚å›¾ç‰‡ä½œè€…ã€‚

## ç¼–å†™æ³¨é‡ŠæŒ‡å—

å½“è¿™ä¸ªä»»åŠ¡è¿˜å†å†åœ¨ç›®æ—¶ï¼ŒèŠ±ç‚¹æ—¶é—´å†™ä¸‹æ¸…æ™°çš„æŒ‡å—(å¦‚ä¸‹ä¾‹),ä»¥ä¿æŒæ ‡ç­¾çš„ä¸€è‡´æ€§ï¼Œå¹¶æ¶µç›–å¸¸è§çš„è¾¹ç¼˜æƒ…å†µã€‚è¯·éšæ„ä½¿ç”¨æˆ‘çš„æŒ‡ç¤ºä½œä¸ºä½ è‡ªå·±çš„æ¨¡æ¿ã€‚

# è¾¹ç•Œæ¡†æ³¨é‡ŠæŒ‡å—

## æ¦‚å¿µ

2-3 å¥è¯ä»‹ç»ä»»åŠ¡/æ¦‚å¿µ

*è¯¥æ•°æ®é›†åŒ…å«å¤±è´¥çš„ 3D æ‰“å°ä½œä¸šçš„å»¶æ—¶è§†é¢‘ã€‚å›¾åƒæ˜¯æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯åœ¨æ‰€æœ‰å¯è¯†åˆ«çš„åƒç´ å‘¨å›´ç”»å‡ºç´§å¯†çš„æ–¹æ¡†ï¼Œä»¥åŒ¹é…æ‰“å°ç¼ºé™·æˆ–å¯¹è±¡ã€‚*

## æ ‡ç­¾

idã€æ–‡æœ¬åç§°ã€æ ‡ç­¾å’Œè¾¹ç¼˜æ¡ˆä¾‹çš„ä¹¦é¢æè¿°ã€æ­£é¢å’Œè´Ÿé¢ç¤ºä¾‹

*   æ ‡ç­¾åº”è¯¥ä» 0 è¿˜æ˜¯ 1 å¼€å§‹ï¼Ÿ
*   0 æ˜¯å¦ä¸ºèƒŒæ™¯/æœªçŸ¥ç±»ä¿ç•™ï¼Ÿ

## 0 èƒŒæ™¯

## 1 ä¸ªå–·å˜´

æ‰“å°å–·å˜´æ˜¯ä¸€ä¸ªé‡‘å±ç‰©ä½“ï¼Œå®ƒæŒ¤å‡ºçƒ­ä¸ã€‚

å¦‚æœå–·å˜´è¢«éƒ¨åˆ†é®æŒ¡ï¼Œå›´ç»•æ•´ä¸ªå¯¹è±¡(åŒ…æ‹¬é®æŒ¡çš„åƒç´ )ç»˜åˆ¶ä¸€ä¸ªè¾¹ç•Œæ¡†ã€‚

å¦‚æœå–·å˜´å®Œå…¨å µå¡ï¼Œä¸è¦è´´æ ‡ç­¾ã€‚

## 2 ä¸ªæœ¨ç­

â€œç­â€æ˜¯å›´ç»•å°åˆ·å“å‰å‡ å±‚çš„è–„è½®å»“ã€‚

å¦‚æœç­å­è¢«éƒ¨åˆ†é®æŒ¡(é€šå¸¸è¢«å°è¿¹é®æŒ¡)ï¼Œåœ¨æ•´ä¸ªç­å­å‘¨å›´ç”»ä¸€ä¸ªè¾¹ç•Œæ¡†ã€‚

## 3 æ‰“å°

æ­£åœ¨æ‰“å°çš„å¯¹è±¡ã€‚å¦‚æœè¦æ‰“å°å¤šä¸ªå¯¹è±¡æˆ–å¤šä¸ªéƒ¨åˆ†ï¼Œè¯·åœ¨æ¯ä¸ªä¸åŒçš„å¯¹è±¡å‘¨å›´ç”»ä¸€ä¸ªè¾¹æ¡†ã€‚

## 4 é™„ç€åŠ›

â€¦

## 5 æ ¹æ„å¤§åˆ©é¢æ¡

â€¦

## æŒ‡å¯¼æ–¹é’ˆ

*   è¾“å…¥æ ¼å¼
*   æ ‡ç­¾æ ¼å¼
*   æ¯å¸§ 1 ä¸ªè¿˜æ˜¯å¤šä¸ªå¯¹è±¡ï¼Ÿ
*   æ¯ä¸ªå¯¹è±¡â€œå®ä¾‹â€æœ‰ 1 ä¸ªè¿˜æ˜¯å¤šä¸ªç›’å­ï¼Ÿ
*   ç›’å­æ˜¯ç´§çš„è¿˜æ˜¯æ¾çš„ï¼Ÿ
*   æ ‡ç­¾åå°„(é•œå­ï¼Œæ°´)ï¼Ÿ

## ç”¨ AutoML è®­ç»ƒåˆ¶å¯¼æ¨¡å‹ğŸ¤–

AutoML(è‡ªåŠ¨æœºå™¨å­¦ä¹ )æ˜¯ä¸€ç§å±äºâ€œå¼ºåŠ›â€ç®—æ³•ç±»åˆ«çš„æŠ€æœ¯ã€‚åŸºäºäº‘çš„ AutoML å¹³å°æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œç”¨æ¥éªŒè¯ä½ çš„é—®é¢˜*å¯ä»¥*å’Œ*åº”è¯¥*ç”¨æœºå™¨å­¦ä¹ æ¥è§£å†³ã€‚

å³ä½¿ä½ è®¡åˆ’è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œä¹Ÿè¦è€ƒè™‘å…ˆæŠŠ AutoML æ¨¡å‹æ”¾åœ¨å®¢æˆ·é¢å‰ã€‚å°½æ—©æ”¶é›†å®¢æˆ·åé¦ˆï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯æ•´åˆåˆ°å®šåˆ¶æ¨¡å‹çš„å¼€å‘ä¸­ã€‚ä¸€äº›è§è§£çš„ä¾‹å­â€¦

*   å®¢æˆ·å¯¹è¯¯æŠ¥ä¸æ•æ„Ÿ(é€šè¿‡çŸ­ä¿¡æŠ¥å‘Šç¼ºé™·ï¼Œä½†æ‰“å°æ²¡é—®é¢˜)ã€‚
*   å¤§å¤šæ•°å®¢æˆ·å–œæ¬¢å°åˆ·è¿›åº¦çš„å¯è§†åŒ–æ›´æ–°ï¼Œå³ä½¿æ£€æµ‹æœºä¸æ­£ç¡®ã€‚
*   ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œä¸€äº›å®¢æˆ·æŠ¥å‘Šçš„å‡é˜³æ€§å¼•èµ·äº†å®‰å…¨æ„Ÿã€‚

æˆ‘ä½¿ç”¨äº†[è°·æ­Œäº‘è‡ªåŠ¨è§†è§‰](https://cloud.google.com/vision/automl/object-detection/docs) Edge(ç‰©ä½“æ£€æµ‹)ï¼Œæˆ‘é€‰æ‹©å®ƒæ˜¯å› ä¸º:

*   [S](https://cloud.google.com/vision/automl/object-detection/docs/edge-quickstart) æ”¯æŒæ¨¡å‹å¯¼å‡ºåˆ° TensorFlow Liteã€TensorFlow.js å’Œ opsï¼Œå…¼å®¹ Edge TPUã€ARM å’Œ NVIDIA ç¡¬ä»¶åŠ é€Ÿã€‚
*   æŠ«éœ²:æˆ‘æ˜¯ä¸€å[è°·æ­Œå¼€å‘ä¸“å®¶](https://developers.google.com/community/experts)ğŸ¤“

## ä» VoTT å¯¼å‡ºæ•°æ®é›†

åœ¨é¡¹ç›®çš„å¯¼å‡ºè®¾ç½®ä¸­ï¼Œé€‰æ‹© CSV æä¾›ç¨‹åºã€‚é€‰ä¸­â€œåŒ…æ‹¬å›¾åƒâ€ï¼Œä¿å­˜é…ç½®ï¼Œç„¶åå¯¼å‡ºæ•°æ®ã€‚å¦‚æœæ‚¨è¦å¯¼å‡ºæ•°åƒå¹…å›¾åƒï¼Œè¿™å°†éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ã€‚ä¼‘æ¯ä¸€ä¸‹ï¼

![](img/98998977b1f5a3ca080ad13665e61973.png)

VoTT å¯¼å‡ºè®¾ç½®ã€‚å›¾ç‰‡ä½œè€…ã€‚

![](img/c0991b35f9f905edff76577f890c58e6.png)

ä» VoTT å¯¼å‡ºçš„æ–‡ä»¶ã€‚å›¾ç‰‡ä½œè€…ã€‚

## æ£€æŸ¥å’Œé¢„å¤„ç†æ•°æ®

å¦‚æœæä¾›äº†ä¸¤ä¸ªé¡¶ç‚¹ï¼ŒAutoML Vision éœ€è¦ä»¥ä¸‹æ ¼å¼çš„ CSV æ•°æ®:

`SET,gs://path/to/img,label,x_min,y_min,,,x_max,y_max`

åæ ‡å¿…é¡»æ˜¯ç›¸å¯¹äºå›¾åƒå°ºå¯¸çš„**ï¼Œè½åœ¨èŒƒå›´ã€0ï¼Œ1ã€‘å†…ã€‚**

[Github Gist](https://gist.github.com/leigh-johnson/293f3380f15c496934e2846ec7f9ad16) ä¸­æä¾›çš„ä»£ç 

```
import pandas as pd

# load VoTT CSV export
# notice: coordinates are absolute
df = pd.read_csv('/path/to/vott-csv-export/{project name}-export.csv')
df.head()
```

![](img/72758c90940138abf4ea43cb4783d44c.png)

å›¾ç‰‡ä½œè€…ã€‚

```
import cv2

base_path = '/path/to/vott-csv-export/'

LOG_INTERVAL=2000

# convert absolute coordinates to relative coordinates in [0, 1] range
for index, row in df.iterrows():
    if index % LOG_INTERVAL == 0:
        print(f'finished {index} / {len(df)}')
    filename = row['image_path'].split('/')[-1]
    img = cv2.imread(f'{base_path}{filename}')
    height, width, channels = img.shape
    df.at[index, 'x1_n'] = row['x1'] / width
    df.at[index, 'x2_n']= row['x2'] / width  
    df.at[index, 'y1_n'] = row['y1'] / height
    df.at[index, 'y2_n'] = row['y2'] / height

# replace relative image paths with a Google Storage bucket path
df['set'] = 'UNASSIGNED'
df['gs_path'] = df['image'] + 'gs://bucket-name/path/to/upload'

# write CSV with columns expected by AutoML Vision
# the "none" columns are required for boxes defined by 2 vertices
df['none'] = ''
df.to_csv('/home/leigh/datasets/spaghetti/labeled/vott-csv-export/spaghetti_v1-normalized-export.csv', 
    columns=['set', 'image_path', 'label', 'x1_n', 'y1_n', 'none', 'none', 'x2_n', 'y2_n', 'none', 'none'],
    index=False
    )
```

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ[å‡†å¤‡æ‚¨çš„åŸ¹è®­æ•°æ®](https://cloud.google.com/vision/automl/object-detection/docs/prepare)ã€‚

## ä¸Šä¼ æ•°æ®

å°†æ•°æ®ä¸Šä¼ åˆ°è°·æ­Œäº‘å­˜å‚¨æ¡¶ã€‚**æ³¨æ„:**å¦‚æœæ‚¨æ­£åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¶æ®µï¼ŒAutoML Vision exports åœ¨åé¢çš„æ­¥éª¤ä¸­è¦æ±‚ç›®æ ‡æ—¶æ®µåœ¨ us-central-1 åœ°åŒºã€‚

*   æ–°æ¥ GCP å—ï¼Ÿåœ¨å¼€å§‹è®¾ç½®é¡¹ç›®å’Œè®¤è¯ä¹‹å‰ï¼Œéµå¾ª[ä¸­çš„æ­¥éª¤ã€‚](https://cloud.google.com/vision/automl/docs/edge-quickstart#before_you_begin)
*   [å®‰è£… gsutil](https://cloud.google.com/storage/docs/gsutil)
*   `gsutil rsync -r /path/to/vott-csv-export gs://your-bucket-name/vott-csv-export/`

## å°†æ•°æ®å¯¼å…¥ AutoML Vision

*   åœ¨ GCP çš„æ§åˆ¶å°ä¸­æ‰“å¼€ [AutoML è§†è§‰æ•°æ®é›†æµè§ˆå™¨](https://console.cloud.google.com/vision/datasets)ã€‚
*   åˆ›å»ºæ–°çš„æ•°æ®é›†ã€‚åœ¨å¯¼å…¥é€‰é¡¹å¡ä¸­ï¼Œä»å­˜å‚¨æ¡¶ä¸­é€‰æ‹©æ‚¨çš„ CSV æ–‡ä»¶ã€‚

![](img/a8efede629de67d0b66aa36ac800994e.png)

å›¾ç‰‡ä½œè€…ã€‚

æ•°æ®å¯¼å…¥æ—¶ä¼‘æ¯ä¸€ä¸‹ï¼ğŸ‘

åœ¨è®­ç»ƒä¹‹å‰ï¼Œå¯¹å¯¼å…¥çš„æ•°æ®è¿›è¡Œå…¨é¢æ£€æŸ¥ï¼Œå¹¶éªŒè¯æ ‡ç­¾æ˜¯å¦æ­£ç¡®ã€‚

![](img/16cbf8d73cc454e500385447b6cccb1c.png)

3D æ‰“å°çš„â€œç­â€æ˜¯ä¸€æ¬¡æ€§çš„æ”¯æ’‘ç»“æ„ã€‚å›¾ç‰‡ä½œè€…ã€‚

## ç«è½¦æ¨¡å‹

AutoML çš„ä»·æ ¼ä½“ç³»æ˜¯åŸºäº**èŠ‚ç‚¹å°æ—¶ï¼Œ**ä¸â€œæŒ‚é’Ÿâ€æˆ–è¿è¡Œæ—¶é—´ä¸åŒã€‚æˆ‘çš„ä¸€ä¸ªæ‰¹è¯„æ˜¯ï¼Œæå‰ä¸ºåŸ¹è®­å·¥ä½œå®šä»·éœ€è¦ä¸€äº›é¢å¤–çš„åŠªåŠ›ã€‚

[AutoML Vision å®šä»·](https://cloud.google.com/vision/automl/pricing?_ga=2.231171871.-1460275601.1603318024#free-trial)(ç¾å…ƒä»·æ ¼å¦‚ä¸‹æ‰€ç¤º)å› åŠŸèƒ½è€Œå¼‚ï¼Œä¸åŒçš„å®šä»·è¡¨é€‚ç”¨äº:

*   äº‘æ‰˜ç®¡åˆ†ç±»å’Œå¯¹è±¡æ£€æµ‹â€”3.15 ç¾å…ƒ/èŠ‚ç‚¹å°æ—¶ï¼Œ75.6 ç¾å…ƒ/ 24 å°æ—¶
*   è¾¹ç¼˜(åˆ†ç±»)-4.95 ç¾å…ƒ/èŠ‚ç‚¹å°æ—¶ï¼Œ118.80 ç¾å…ƒ/ 24 å°æ—¶
*   è¾¹ç¼˜(ç‰©ä½“æ£€æµ‹)â€”â€”18.00 ç¾å…ƒ/èŠ‚ç‚¹å°æ—¶ï¼Œ432 ç¾å…ƒ/ 24 å°æ—¶

å¦‚æœè¿™äº›ä»·æ ¼è¶…å‡ºäº†æ‚¨é¡¹ç›®çš„é¢„ç®—ï¼Œæˆ‘å°†åœ¨æœªæ¥çš„å¸–å­ä¸­ä»‹ç»æˆ‘å¦‚ä½•ä½¿ç”¨ [TensorFlow çš„å¯¹è±¡æ£€æµ‹ API](https://github.com/tensorflow/models/tree/master/research/object_detection) è®­ç»ƒæ¨¡å‹ã€‚å…³æ³¨æˆ–[è®¢é˜…æˆ‘çš„ç®€è®¯](https://www.bitsy.ai/)ä»¥è·å¾—å‡ºç‰ˆé€šçŸ¥ã€‚

å¯¹äºè¿™ä¸ªç‰¹æ®Šçš„é—®é¢˜(æ£€æµ‹ 3D æ‰“å°ç¼ºé™·)ï¼Œæˆ‘çœ‹åˆ°äº†ä½¿ç”¨æˆ‘çš„æ•°æ®é›†å¤§å°çš„æ¨èè®­ç»ƒæ—¶é—´(24 èŠ‚ç‚¹å°æ—¶)çš„åˆç†ç»“æœã€‚æ·±å…¥åˆ°å•ä¸ªæ ‡ç­¾ï¼Œâ€œå–·å˜´â€æ£€æµ‹çš„è¡¨ç°æ˜æ˜¾æ¯”å…¶ä»–æ ‡ç­¾å·®ã€‚

![](img/4c611aa99dcef05858468439d13a0fe1.png)

æ‰€æœ‰æ ‡ç­¾çš„æŒ‡æ ‡ã€‚å›¾ç‰‡ä½œè€…ã€‚

![](img/9dd074f5f4b140db6481fe12b3afdc0a.png)

â€œå–·å˜´â€æ ‡ç­¾çš„æŒ‡æ ‡ã€‚å›¾ç‰‡ä½œè€…ã€‚

å·¦:æ‰€æœ‰æ ‡ç­¾çš„ç²¾åº¦/å¬å›æ›²çº¿ã€‚å³å›¾:â€œå–·å˜´â€çš„ç²¾åº¦/å¬å›æ›²çº¿

ç»è¿‡æ›´ä»”ç»†çš„æ£€æŸ¥ï¼Œæˆ‘å‘ç°é«˜çš„å‡é˜³æ€§ç‡æ˜¾è‘—å½±å“äº†æ¨¡å‹çš„ç²¾åº¦åˆ†æ•°ã€‚ç²¾åº¦æ˜¯*çœŸé˜³æ€§/(çœŸé˜³æ€§+å‡é˜³æ€§)ä¹‹å’Œã€‚æˆ‘å¾ˆå…´å¥‹åœ°å‘ç°äº†ä¸€äº›ä¾‹å­ï¼Œåœ¨è¿™äº›ä¾‹å­ä¸­ï¼Œæˆ‘æ²¡æœ‰åœ¨åœ°é¢çœŸå®æ•°æ®ä¸­æ ‡æ³¨å–·å˜´ã€‚*

ğŸ¤¯å³ä½¿æˆ‘åœ¨ç¬¬ä¸€æ¬¡è´´æ ‡ç­¾çš„è¿‡ç¨‹ä¸­å˜å¾—è‰ç‡ï¼ŒæŒ‡å¯¼æ¨¡å‹å·²ç»è¶³å¤Ÿå¥½æ¥æ•æ‰è¿™äº›é”™è¯¯ã€‚å“‡ï¼å¦‚æœæˆ‘ä¸å¾—ä¸æ‰‹åŠ¨æ ‡è®°è¿™äº›æ•°æ®çš„æ•´ä½“ï¼Œå®ƒå°†å……æ»¡é”™è¯¯ã€‚

![](img/f22c7440f7230d2fcf4adbb433615bb8.png)

æˆ‘çš„æ¨¡å‹è‡ªä¿¡åœ°åœ¨è¿™äº›å›¾åƒä¸­æ£€æµ‹åˆ°â€œå–·å˜´â€ç‰©ä½“ï¼Œç”±äºäººä¸ºé”™è¯¯æ ‡è®°åœ°é¢çœŸå®æ•°æ®ï¼Œè¿™äº›ç‰©ä½“è¢«è¯„ä¸ºâ€œå‡é˜³æ€§â€ã€‚å›¾ç‰‡ä½œè€…ã€‚

## ä½¿ç”¨ TensorFlow.js è‡ªåŠ¨æ ‡æ³¨ VoTTğŸ¤–

ä¸‹ä¸€èŠ‚å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰ TensorFlow.js æ¨¡å‹æ¥å»ºè®®å…·æœ‰ VoTTâ€œä¸»åŠ¨å­¦ä¹ â€åŠŸèƒ½çš„è¾¹ç•Œæ¡†ã€‚

â€œä¸»åŠ¨å­¦ä¹ â€ä½¿ç”¨ TensorFlow.js æ¨¡å‹åœ¨å¸§ä¸Šæ‰§è¡Œæ¨ç†ï¼Œåº”ç”¨éæœ€å¤§æŠ‘åˆ¶ï¼Œå¹¶ä¸ºæ¯ä¸ªæ£€æµ‹åˆ°çš„å¯¹è±¡ç»˜åˆ¶æœ€ä½³æ¡†å»ºè®®ã€‚

## å¯¼å‡º TensorFlow.js æ¨¡å‹

æ¨¡å‹è®­ç»ƒå®Œæˆåï¼Œæ‚¨å¯ä»¥åœ¨â€œæµ‹è¯•å’Œä½¿ç”¨â€é€‰é¡¹å¡ä¸­å¯¼å‡º TensorFlow.js åŒ…ã€‚è¯¥æ¨¡å‹å°†å¯¼å‡ºåˆ°ä¸€ä¸ªå­˜å‚¨æ¡¶ä¸­(ç›®æ ‡æ¡¶å¿…é¡»åœ¨ç¾å›½ä¸­éƒ¨-1 åœ°åŒº)ã€‚

![](img/15ca1f3015840d822d843eba86fb86c7.png)

è°·æ­Œäº‘è‡ªåŠ¨è§†è§‰è¾¹ç¼˜å¯¼å‡ºã€‚å›¾ç‰‡ä½œè€…ã€‚

![](img/6915a9c81ebb1ce3889a65cb7bd82a27.png)

è°·æ­Œäº‘è‡ªåŠ¨è§†è§‰è¾¹ç¼˜å¯¼å‡ºã€‚å›¾ç‰‡ä½œè€…ã€‚

## åˆ›å»º classes.json æ–‡ä»¶

æˆ‘æ‰‹åŠ¨ä¿®å¤äº†è¿™ä¸ªã€‚AutoML Vision Edge å¯¼å‡ºæ–°è¡Œåˆ†éš”çš„æ ‡ç­¾æ–‡ä»¶ã€‚VoTT è¦æ±‚çš„æ ¼å¼å¦‚ä¸‹ã€‚æ ‡ç­¾ç´¢å¼•å¿…é¡»ä» 1ï¼

```
[{"id":1,"displayName":"nozzle"}, ... ]
```

## ä¿®è¡¥ VoTT ä»¥ä¿®å¤ TensorFlow 1.x -> 2.x é”™è¯¯

VoTT è‡ªå¸¦@tensorflow/tfjs çš„ v1ã€‚AutoML Vision Edge æ¨¡å‹ä½¿ç”¨éœ€è¦æ›´æ–°ç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿ(å¦‚ AddV2)ã€‚æˆ‘ç”¨ä»¥ä¸‹è¡¥ä¸ä¿®å¤äº†å‡ ä¸ªå°é—®é¢˜:

*   æ¨¡å‹éœ€è¦ float32 è¾“å…¥
*   ä½¿ç”¨è¾ƒæ–°çš„ TF . image . nonmaxsupressionasync()fn

```
diff --git a/src/providers/activeLearning/objectDetection.ts b/src/providers/activeLearning/objectDetection.ts
index 196db45..a8dff06 100755
--- a/src/providers/activeLearning/objectDetection.ts
+++ b/src/providers/activeLearning/objectDetection.ts
@@ -151,6 +151,8 @@ export class ObjectDetection {
         const batched = tf.tidy(() => {
             if (!(img instanceof tf.Tensor)) {
                 img = tf.browser.fromPixels(img);
+                // model requires float32 input
+                img = tf.cast(img, 'float32');
             }
             // Reshape to a single-element batch so we can pass it to executeAsync.
             return img.expandDims(0);
@@ -166,7 +168,8 @@ export class ObjectDetection {
         const result = await this.model.executeAsync(batched) as tf.Tensor[];

         const scores = result[0].dataSync() as Float32Array;
-        const boxes = result[1].dataSync() as Float32Array;
+        // tf.image.nonMaxSepressionAsync() expects tf.Tensor as input
+        const boxes = result[1].dataSync()

         // clean the webgl tensors
         batched.dispose();
@@ -177,10 +180,8 @@ export class ObjectDetection {
         const prevBackend = tf.getBackend();
         // run post process in cpu
         tf.setBackend("cpu");
-        const indexTensor = tf.tidy(() => {
-            const boxes2 = tf.tensor2d(boxes, [result[1].shape[1], result[1].shape[3]]);
-            return tf.image.nonMaxSuppression(boxes2, maxScores, maxNumBoxes, 0.5, 0.5);
-        });
+        const boxes2d = tf.tensor2d(boxes, [result[1].shape[0], result[1].shape[1]]);
+        const indexTensor = await tf.image.nonMaxSuppressionAsync(boxes2d, maxScores, maxNumBoxes, 0.5, 0.5);

         const indexes = indexTensor.dataSync() as Float32Array;
         indexTensor.dispose();
@@ -188,7 +189,9 @@ export class ObjectDetection {
         // restore previous backend
         tf.setBackend(prevBackend);

-        return this.buildDetectedObjects(width, height, boxes, maxScores, indexes, classes);
+        // _.buildDetectedObjects expects Float32Array input
+        const fboxes = boxes as Float32Array
+        return this.buildDetectedObjects(width, height, fboxes, maxScores, indexes, classes);
     }
```

## è‡ªåŠ¨åŒ…å›´ç›’å»ºè®®âœ¨

*   ä¿®è¡¥ VoTT åè¿è¡Œ`npm start`
*   åœ¨â€œä¸»åŠ¨å­¦ä¹ â€é€‰é¡¹å¡ä¸­ï¼Œé…ç½®â€œæ¨¡å‹è·¯å¾„â€ä»¥æŒ‡å‘æ‚¨çš„ TensorFlow.js å¯¼å‡ºã€‚æˆ‘å»ºè®®å¯ç”¨â€œè‡ªåŠ¨æ£€æµ‹â€åŠŸèƒ½ï¼Œå¦åˆ™ä½ å¿…é¡»æ‰‹åŠ¨æŒ‰ ctrl/cmd+d æ¥å¯¹æ¯ä¸€å¸§æ‰§è¡Œæ£€æµ‹ã€‚

![](img/4e97eeafca17342d4120b68d06e46ddd.png)

å¾®è½¯ VoTT ä¸»åŠ¨å­¦ä¹ é…ç½®ã€‚å›¾ç‰‡ä½œè€…ã€‚

## åŒ…æ‰

æ‚¨åˆšåˆšå­¦ä¹ äº†å¦‚ä½•å°†å‡ ä¸ªå°æ—¶å’Œå‡ ç™¾ç¾å…ƒç”¨äºè‡ªåŠ¨è¾¹ç•Œæ¡†æ³¨é‡Šå·¥ä½œæµã€‚ä½œä¸ºä¸€ä¸ªé¢å¤–çš„å¥–åŠ±ï¼ŒæŒ‡å¯¼æ¨¡å‹å¯ä»¥é€‚ç”¨äºåŸå‹ç”šè‡³æ˜¯åˆå§‹ç”Ÿäº§è¿è¡Œã€‚æˆ‘å¸Œæœ›è¿™èƒ½ä¸ºä½ çš„ä¸‹ä¸€ä¸ªç‰©ä½“æ¢æµ‹é¡¹ç›®èŠ‚çœä¸€ç‚¹æ—¶é—´/ç²¾åŠ›ï¼

ä¸å…¶ä»–äº‘äº§å“ç›¸æ¯”ï¼ŒAutoML äº§å“ä»·æ ¼æ˜‚è´µâ€”â€”ä½†å®ƒä»¬è¿œä¸å¦‚ä»é›¶å¼€å§‹å¼€å‘ä¸€ä¸ªå¯æ¯”è¾ƒçš„æ¨¡å‹æˆ–ç”šè‡³ä½¿ç”¨é‡é‡è½¬ç§»å­¦ä¹ è¿™æ ·çš„èµ„æºå¯†é›†å‹äº§å“*æˆ–*ã€‚

ä½ ç›®å‰æ­£åœ¨ä½¿ç”¨ç‰©ä½“æ¢æµ‹å™¨è§£å†³é—®é¢˜å—ï¼Ÿè¯·åœ¨ä¸‹é¢çš„è¯„è®ºä¸­å‘Šè¯‰æˆ‘æ›´å¤šå…³äºä½ çš„ç†å¿µå’Œæ–¹æ³•ã€‚

è®¢é˜…æˆ‘çš„æ—¶äº‹é€šè®¯@ [bitsy.ai](https://www.bitsy.ai/) è·å–æ›´å¤šå…³äº Raspberry Piã€Arduino å’Œå…¶ä»–å°å‹è®¾å¤‡çš„ ML åº”ç”¨çš„æŠ€å·§ã€æ•™ç¨‹å’Œè¯¦ç»†æ–‡ç« ã€‚æˆ‘ç›®å‰æ­£åœ¨ä¸º [Octoprint](https://octoprint.org/) æ‰“é€ ä¸€ä¸ªéšç§ä¼˜å…ˆçš„ 3D æ‰“å°ç›‘æ§æ’ä»¶ã€‚