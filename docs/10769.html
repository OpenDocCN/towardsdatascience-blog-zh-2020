<html>
<head>
<title>Creating a Racing Bar Chart using the Covid-19 Dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用新冠肺炎数据集创建赛车条形图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-a-racing-bar-chart-using-the-covid-19-dataset-c7595d0b51ee?source=collection_archive---------59-----------------------#2020-07-27">https://towardsdatascience.com/creating-a-racing-bar-chart-using-the-covid-19-dataset-c7595d0b51ee?source=collection_archive---------59-----------------------#2020-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2262" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的条形图栩栩如生</h2></div><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="kn ko l"/></div></figure><p id="1393" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">在我之前的两篇关于使用新冠肺炎数据集进行数据分析的文章中，我首先</p><ul class=""><li id="2b66" class="ll lm it kr b ks kt kv kw ky ln lc lo lg lp lk lq lr ls lt bi translated">讨论了如何使用 NumPy 和 Pandas 进行数据分析(<a class="ae lu" href="https://levelup.gitconnected.com/performing-data-analytics-on-the-covid-19-dataset-using-python-numpy-and-pandas-bdfc352c61e9" rel="noopener ugc nofollow" target="_blank">https://level up . git connected . com/performing-data-analytics-on-the-新冠肺炎-dataset-using-python-NumPy-and-Pandas-bdfc 352 c61e 9</a>)，随后，</li><li id="4644" class="ll lm it kr b ks lv kv lw ky lx lc ly lg lz lk lq lr ls lt bi translated">如何使用 matplotlib 进行数据可视化(<a class="ae lu" href="https://levelup.gitconnected.com/performing-data-visualization-using-the-covid-19-dataset-47c441747c43" rel="noopener ugc nofollow" target="_blank">https://level up . git connected . com/performing-data-visualization-using-the-新冠肺炎-dataset-47c441747c43 </a>)。</li></ul><p id="a942" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">新冠肺炎数据集是探索和理解数据分析和可视化的一个很好的候选。在本文中，我将向您展示如何在 matplotlib 中创建一个<em class="ma">动态</em>图表。特别是我会创建一个<em class="ma">赛车条形图</em>来动态显示每一天每个国家的确诊病例数。在这篇文章的结尾，你将会看到这样一个图表:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/9992f1419a5ca96f5f18b40cf4ef53e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*981F45oiKhB4TZP2cEiRFg.png"/></div></div></figure><h1 id="b656" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">争论数据</h1><p id="7961" class="pw-post-body-paragraph kp kq it kr b ks na ju ku kv nb jx kx ky nc la lb lc nd le lf lg ne li lj lk im bi translated">首先，让我们使用 Jupyter Notebook 来清理和过滤所有数据，这样您就有了一个干净的数据集。准备好数据后，您就可以专注于创建条形图了。</p><h2 id="b01a" class="nf mj it bd mk ng nh dn mo ni nj dp ms ky nk nl mu lc nm nn mw lg no np my nq bi translated">导入包</h2><p id="5e04" class="pw-post-body-paragraph kp kq it kr b ks na ju ku kv nb jx kx ky nc la lb lc nd le lf lg ne li lj lk im bi translated">第一步是导入您将用于此项目的所有包:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="c50d" class="nf mj it ns b gy nw nx l ny nz">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import datetime</span></pre><h2 id="6e18" class="nf mj it bd mk ng nh dn mo ni nj dp ms ky nk nl mu lc nm nn mw lg no np my nq bi translated">加载数据集</h2><p id="0482" class="pw-post-body-paragraph kp kq it kr b ks na ju ku kv nb jx kx ky nc la lb lc nd le lf lg ne li lj lk im bi translated">对于本文，我将使用来自<a class="ae lu" href="https://www.kaggle.com/sudalairajkumar/novel-corona-virus-2019-dataset" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/sudalairajkumar/novel-corona-virus-2019-dataset</a>的最新数据集。所以一定要下载并保存在你的本地机器上。对于我的情况，我将它保存在名为“<strong class="kr iu">Dataset—2020 年 7 月 20 日</strong>”的文件夹中，该文件夹与我的 Jupyter 笔记本的位置相对应:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="641c" class="nf mj it ns b gy nw nx l ny nz"># load the dataset<br/>dataset_path = "./Dataset - 20 July 2020/"<br/>df_conf = pd.read_csv(dataset_path + \<br/>              "time_series_covid_19_confirmed.csv")<br/>df_conf</span></pre><p id="0073" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">数据帧看起来像这样:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi od"><img src="../Images/67e8d0f7b556bc3e638b1afc17aeca57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ElrgGLOwA4GlGxnZ04k5QA.png"/></div></div></figure><h2 id="22f8" class="nf mj it bd mk ng nh dn mo ni nj dp ms ky nk nl mu lc nm nn mw lg no np my nq bi translated">对数据帧排序</h2><p id="2a57" class="pw-post-body-paragraph kp kq it kr b ks na ju ku kv nb jx kx ky nc la lb lc nd le lf lg ne li lj lk im bi translated">加载数据框架后，让我们按'<strong class="kr iu">省/州</strong>和'<strong class="kr iu">国家/地区</strong>列对值进行排序:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="a546" class="nf mj it ns b gy nw nx l ny nz"># sort the df<br/>df_conf = df_conf.sort_values(by='Province/State','Country/Region'])<br/>df_conf = df_conf.reset_index(drop=True)<br/>df_conf</span></pre><p id="11e7" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">排序后，<code class="fe oa ob oc ns b"><strong class="kr iu">df_conf</strong></code>将如下所示:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oe"><img src="../Images/cbb41a6519e12996964ddbfb4d82ef34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NK09uNBQa1y8eKXoq7aY-Q.png"/></div></div></figure><h2 id="40eb" class="nf mj it bd mk ng nh dn mo ni nj dp ms ky nk nl mu lc nm nn mw lg no np my nq bi translated"><strong class="ak">取消数据帧的透视</strong></h2><p id="2936" class="pw-post-body-paragraph kp kq it kr b ks na ju ku kv nb jx kx ky nc la lb lc nd le lf lg ne li lj lk im bi translated">下一步是取消数据框的透视，这样现在就有了两个新列<code class="fe oa ob oc ns b"><strong class="kr iu">Date</strong></code>和<code class="fe oa ob oc ns b"><strong class="kr iu">Confirmed</strong></code>:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="cb67" class="nf mj it ns b gy nw nx l ny nz"># extract the dates columns<br/>dates_conf = df_conf.columns[4:]</span><span id="d60e" class="nf mj it ns b gy of nx l ny nz"># perform unpivoting<br/>df_conf_melted = \<br/>    df_conf.melt(<br/>        id_vars=['Province/State', 'Country/Region', 'Lat', 'Long'], <br/>        value_vars=dates_conf, <br/>        var_name='Date',<br/>        value_name='Confirmed')</span><span id="fc60" class="nf mj it ns b gy of nx l ny nz">df_conf_melted</span></pre><p id="a3e7" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">取消透视的数据帧(<code class="fe oa ob oc ns b"><strong class="kr iu">df_conf_melted</strong></code>)现在应该如下所示:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="gh gi og"><img src="../Images/bd7fabe0810db628efcc9d0e4aefba45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*LdEtwUa5uc3k6KE7jTIL5Q.png"/></div></figure><h2 id="682b" class="nf mj it bd mk ng nh dn mo ni nj dp ms ky nk nl mu lc nm nn mw lg no np my nq bi translated">将日期列转换为日期格式</h2><p id="16d5" class="pw-post-body-paragraph kp kq it kr b ks na ju ku kv nb jx kx ky nc la lb lc nd le lf lg ne li lj lk im bi translated">下一步是将存储在<strong class="kr iu">日期</strong>列中的日期格式化为<strong class="kr iu">日期</strong>对象:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="06dd" class="nf mj it ns b gy nw nx l ny nz"># convert the date column to date format<br/>df_conf_melted[“Date”] = df_conf_melted[“Date”].apply(<br/>    lambda x: datetime.datetime.strptime(x, ‘%m/%d/%y’).date())</span><span id="260f" class="nf mj it ns b gy of nx l ny nz">df_conf_melted</span></pre><p id="bb2e" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">更新后的<code class="fe oa ob oc ns b"><strong class="kr iu">df_conf_melted</strong></code>数据帧现在看起来像这样:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/ac67cde794762f7f4611db0b74b46a54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*WaNQ8YmbR3RTkEdkGvFg7Q.png"/></div></figure><h2 id="49ce" class="nf mj it bd mk ng nh dn mo ni nj dp ms ky nk nl mu lc nm nn mw lg no np my nq bi translated">按日期和国家/地区分组，并总结每个国家的确诊病例</h2><p id="0a09" class="pw-post-body-paragraph kp kq it kr b ks na ju ku kv nb jx kx ky nc la lb lc nd le lf lg ne li lj lk im bi translated">现在是总结每个国家(不分省/州)所有确诊病例的时候了。您可以使用以下语句来实现:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="f7d2" class="nf mj it ns b gy nw nx l ny nz"># group by date and country and then sum up based on country<br/>df_daily = df_conf_melted.groupby(["Date", "Country/Region"]).sum()<br/>df_daily</span></pre><p id="641f" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><code class="fe oa ob oc ns b"><strong class="kr iu">df_daily</strong></code>数据框现在显示了每个国家的每日确诊病例:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/07c58b698bea07064d30c3edfb83a68b.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*wSZTjIwj_41MnJAO1_EuFA.png"/></div></figure><h2 id="7128" class="nf mj it bd mk ng nh dn mo ni nj dp ms ky nk nl mu lc nm nn mw lg no np my nq bi translated">按日期排序数据帧并确认</h2><p id="041a" class="pw-post-body-paragraph kp kq it kr b ks na ju ku kv nb jx kx ky nc la lb lc nd le lf lg ne li lj lk im bi translated">我们希望根据两个关键字对<code class="fe oa ob oc ns b"><strong class="kr iu">df_daily</strong></code>数据帧进行排序:</p><ul class=""><li id="5766" class="ll lm it kr b ks kt kv kw ky ln lc lo lg lp lk lq lr ls lt bi translated"><code class="fe oa ob oc ns b"><strong class="kr iu">Date</strong></code>(升序)</li><li id="a619" class="ll lm it kr b ks lv kv lw ky lx lc ly lg lz lk lq lr ls lt bi translated"><code class="fe oa ob oc ns b"><strong class="kr iu">Confirmed</strong></code>(降序)</li></ul><p id="68f3" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">因此，以下语句实现了这一点:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="0557" class="nf mj it ns b gy nw nx l ny nz">df_daily_sorted = df_daily.sort_values(['Date','Confirmed'], <br/>                      ascending=[True, False])<br/>df_daily_sorted</span></pre><p id="f3ee" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><code class="fe oa ob oc ns b"><strong class="kr iu">df_daily_sorted</strong></code>数据帧现在看起来像这样:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/219065285a83bf38d182f1098b9edb4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*0JdR2tuXQTUfLy0Mkk8dhQ.png"/></div></figure><p id="6779" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">最后要做的一件事是，让我们将国家列表提取为一个列表:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="9085" class="nf mj it ns b gy nw nx l ny nz"># get the list of all countries<br/>all_countries = list(df_conf['Country/Region'])</span></pre><p id="6b5d" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">这将在下一节中使用。</p><h2 id="a504" class="nf mj it bd mk ng nh dn mo ni nj dp ms ky nk nl mu lc nm nn mw lg no np my nq bi translated">每天都在重复</h2><p id="4f99" class="pw-post-body-paragraph kp kq it kr b ks na ju ku kv nb jx kx ky nc la lb lc nd le lf lg ne li lj lk im bi translated">既然我们的<code class="fe oa ob oc ns b"><strong class="kr iu">df_daily_sorted</strong></code>数据框架已经按照我们想要的方式进行了排序和格式化，我们现在可以开始深入研究它了。</p><p id="242a" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">首先，定义我们想要查看的前<em class="ma"> n </em>个国家:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="732a" class="nf mj it ns b gy nw nx l ny nz">top_n = 20    # view the top 20 countries</span></pre><p id="3f5b" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">让我们按照第一级索引(<strong class="kr iu">级 0 </strong>，即<code class="fe oa ob oc ns b"><strong class="kr iu">Date</strong></code>)对<code class="fe oa ob oc ns b"><strong class="kr iu">df_daily_sorted</strong></code>数据帧进行分组，然后遍历它:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="71f4" class="nf mj it ns b gy nw nx l ny nz">for date, daily_df in df_daily_sorted.groupby(level=0):<br/>    print(date)<br/>    print(daily_df)    # a dataframe</span></pre><p id="a5cd" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">您应该会看到以下输出:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="a894" class="nf mj it ns b gy nw nx l ny nz">2020-01-22<br/>                                       Lat         Long  Confirmed<br/>Date       Country/Region                                         <br/>2020-01-22 China               1085.292300  3688.937700        548<br/>           Japan                 36.204824   138.252924          2<br/>           Thailand              15.870032   100.992541          2<br/>           Korea, South          35.907757   127.766922          1<br/>           Taiwan*               23.700000   121.000000          1<br/>...                                    ...          ...        ...<br/>           West Bank and Gaza    31.952200    35.233200          0<br/>           Western Sahara        24.215500   -12.885800          0<br/>           Yemen                 15.552727    48.516388          0<br/>           Zambia               -13.133897    27.849332          0<br/>           Zimbabwe             -19.015438    29.154857          0<br/><br/>[188 rows x 3 columns]<br/>2020-01-23<br/>                                       Lat         Long  Confirmed<br/>Date       Country/Region                                         <br/>2020-01-23 China               1085.292300  3688.937700        643<br/>           Thailand              15.870032   100.992541          3<br/>           Japan                 36.204824   138.252924          2<br/>           Vietnam               14.058324   108.277199          2<br/>           Korea, South          35.907757   127.766922          1<br/>...                                    ...          ...        ...</span></pre><p id="36b6" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">以上数据框显示了每个国家的确诊病例总数(按降序排列)，按<code class="fe oa ob oc ns b"><strong class="kr iu">Date</strong></code>排序。</p><p id="ce91" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">对于每一天，提取排名前<em class="ma"> n </em>的国家及其确诊病例数:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="fce0" class="nf mj it ns b gy nw nx l ny nz">for date, daily_df in df_daily_sorted.groupby(level=0):       <br/>    print(date)<br/>    <strong class="ns iu"># </strong>print(daily_df)    # a dataframe<br/>    <strong class="ns iu">topn_df = daily_df.head(top_n)</strong></span><span id="966a" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu">    </strong># get all the countries from the multi-index of the dataframe<strong class="ns iu"><br/>    countries = list(map(lambda x:(x[1]),topn_df.index))[::-1]    <br/>    confirmed = list(topn_df.Confirmed)[::-1]    </strong></span><span id="ce47" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu">    print(countries)<br/>    print(confirmed)</strong></span></pre><blockquote class="ok ol om"><p id="bdf4" class="kp kq ma kr b ks kt ju ku kv kw jx kx on kz la lb oo ld le lf op lh li lj lk im bi translated">注意，我用<code class="fe oa ob oc ns b"><strong class="kr iu">[::1]</strong></code>颠倒了<code class="fe oa ob oc ns b"><strong class="kr iu">countries</strong></code>和<code class="fe oa ob oc ns b"><strong class="kr iu">confirmed</strong></code>列表的顺序。这是为了确保病例最多的国家列在最后。这样做将确保稍后当您使用<code class="fe oa ob oc ns b"><strong class="kr iu">plt.barh()</strong></code>方法绘制水平条形图时，案例最多的国家将被列在顶部。这是因为<code class="fe oa ob oc ns b"><strong class="kr iu"><em class="it">plt.barh()</em></strong></code>方法在向上的方向绘制水平条。</p></blockquote><p id="89d5" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">您将看到类似这样的内容:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="d329" class="nf mj it ns b gy nw nx l ny nz">2020-01-22<br/>['Bangladesh', 'Bahrain', 'Bahamas', 'Azerbaijan', 'Austria', 'Australia', 'Armenia', 'Argentina', 'Antigua and Barbuda', 'Angola', 'Andorra', 'Algeria', 'Albania', 'Afghanistan', 'US', 'Taiwan*', 'Korea, South', 'Thailand', 'Japan', 'China']<br/>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 2, 2, 548]<br/>2020-01-23<br/>['Bahamas', 'Azerbaijan', 'Austria', 'Australia', 'Armenia', 'Argentina', 'Antigua and Barbuda', 'Angola', 'Andorra', 'Algeria', 'Albania', 'Afghanistan', 'US', 'Taiwan*', 'Singapore', 'Korea, South', 'Vietnam', 'Japan', 'Thailand', 'China']<br/>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 3, 643]<br/>2020-01-24<br/>['Azerbaijan', 'Austria', 'Australia', 'Armenia', 'Argentina', 'Antigua and Barbuda', 'Angola', 'Andorra', 'Algeria', 'Albania', 'Afghanistan', 'Vietnam', 'US', 'Korea, South', 'Japan', 'France', 'Taiwan*', 'Singapore', 'Thailand', 'China']<br/>...</span></pre><p id="ed46" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">此时，您基本上已经获得了绘制条形图所需的所有数据，该条形图显示了每个国家每天的确诊病例数。</p><h1 id="bb20" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">绘制条形图</h1><p id="e8bf" class="pw-post-body-paragraph kp kq it kr b ks na ju ku kv nb jx kx ky nc la lb lc nd le lf lg ne li lj lk im bi translated">您现在可以显示一个竞赛条形图，显示每个国家的确诊病例数。您不能在 Jupyter Notebook 中显示动态图表，因此让我们编写以下代码，并将其保存为名为<strong class="kr iu"> RacingBarChart.py </strong>的文件(保存在您启动 Jupyter Notebook 的同一目录中)。下面以粗体显示的代码是绘制赛车条形图的代码:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="986f" class="nf mj it ns b gy nw nx l ny nz">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import datetime</span><span id="2589" class="nf mj it ns b gy of nx l ny nz"># load the dataset<br/>dataset_path = "./Dataset - 20 July 2020/"<br/>df_conf = pd.read_csv(dataset_path + <br/>              "time_series_covid_19_confirmed.csv")</span><span id="44cf" class="nf mj it ns b gy of nx l ny nz"># sort the dfs<br/>df_conf = df_conf.sort_values(by=<br/>    ['Province/State','Country/Region'])</span><span id="c744" class="nf mj it ns b gy of nx l ny nz">df_conf = df_conf.reset_index(drop=True)</span><span id="3c4e" class="nf mj it ns b gy of nx l ny nz"># extract the dates columns<br/>dates_conf = df_conf.columns[4:]</span><span id="5852" class="nf mj it ns b gy of nx l ny nz"># perform unpivoting<br/>df_conf_melted = \<br/>    df_conf.melt(<br/>        id_vars=['Province/State', 'Country/Region', 'Lat', 'Long'],<br/>        value_vars=dates_conf,<br/>        var_name='Date',<br/>        value_name='Confirmed')</span><span id="9ead" class="nf mj it ns b gy of nx l ny nz"># convert the date column to date format<br/>df_conf_melted["Date"] = df_conf_melted["Date"].apply(<br/>    lambda x: datetime.datetime.strptime(x, '%m/%d/%y').date())</span><span id="d2aa" class="nf mj it ns b gy of nx l ny nz"># group by date and country and then sum up based on country<br/>df_daily = df_conf_melted.groupby(["Date", "Country/Region"]).sum()</span><span id="ac56" class="nf mj it ns b gy of nx l ny nz">df_daily_sorted = df_daily.sort_values(['Date','Confirmed'],<br/>                      ascending=[True, False])</span><span id="a31e" class="nf mj it ns b gy of nx l ny nz"># get the list of all countries<br/>all_countries = list(df_conf['Country/Region'])</span><span id="4cac" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu"># plotting using the seaborn-darkgrid style<br/>plt.style.use('seaborn-darkgrid')</strong></span><span id="1e42" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu"># set the size of the chart<br/>fig, ax = plt.subplots(1, 1, figsize=(14,10))</strong></span><span id="8742" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu"># hide the y-axis labels<br/>ax.yaxis.set_visible(False)</strong></span><span id="6034" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu"># assign a color to each country<br/>NUM_COLORS = len(all_countries)<br/>cm = plt.get_cmap('Set3')<br/>colors = np.array([cm(1.*i/NUM_COLORS) for i in range(NUM_COLORS)])</strong></span><span id="9d39" class="nf mj it ns b gy of nx l ny nz">top_n = 20</span><span id="73d2" class="nf mj it ns b gy of nx l ny nz">for date, daily_df in df_daily_sorted.groupby(level=0):<br/>    <strong class="ns iu"># </strong>print(date)<br/>    <strong class="ns iu"># </strong>print(daily_df)    # a dataframe<br/>    topn_df = daily_df.head(top_n)<br/>    <br/>    # get all the countries from the multi-index of the dataframe<br/>    countries = list(map (lambda x:(x[1]),topn_df.index))[::-1]<br/>    confirmed = list(topn_df.Confirmed)[::-1]</span><span id="0203" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu">    # clear the axes so that countries no longer in top 10 will not <br/>    # be displayed<br/>    ax.clear()</strong></span><span id="62d5" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu">    # plot the horizontal bars<br/>    plt.barh(<br/>        countries,<br/>        confirmed,<br/>        color = colors[[all_countries.index(n) for n in countries]],<br/>        edgecolor = "black",<br/>        label = "Total Number of Confirmed Cases")</strong></span><span id="7d3c" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu">    # display the labels on the bars<br/>    for index, rect in enumerate(ax.patches):<br/>        x_value = rect.get_width()<br/>        y_value = rect.get_y() + rect.get_height() / 2</strong></span><span id="f393" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu">        # display the country<br/>        ax.text(x_value, y_value, f'{countries[index]} ',<br/>            ha="right", va="bottom",<br/>            color="black", fontweight='bold')</strong></span><span id="0310" class="nf mj it ns b gy of nx l ny nz">        <strong class="ns iu"># display the number<br/>        ax.text(x_value, y_value, f'{confirmed[index]:,} ',<br/>            ha="right", va="top",<br/>            color="black")</strong></span><span id="360c" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu">    # display the title<br/>    plt.title(f"Top {top_n} Countries with Covid-19 ({date})",<br/>        fontweight="bold",<br/>        fontname="Impact",<br/>        fontsize=25)</strong></span><span id="c6fa" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu">    # display the x-axis and y-axis labels</strong><br/>    <strong class="ns iu">plt.xlabel("Number of people")</strong></span><span id="8269" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu">    # draw the data and runs the GUI event loop<br/>    plt.pause(0.5)</strong></span><span id="af90" class="nf mj it ns b gy of nx l ny nz"><strong class="ns iu"># keep the matplotlib window<br/>plt.show(block=True)</strong></span></pre><p id="cec8" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">要运行该应用程序，请在您的<strong class="kr iu">终端/Anaconda </strong>提示符中键入以下内容:</p><p id="d498" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><code class="fe oa ob oc ns b"><strong class="kr iu">$ python RacingBarChart.py</strong></code></p><p id="6c48" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">您现在应该会看到赛车条形图:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oq"><img src="../Images/cacd08a270e94a001f8ea2375cdb2840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h2WX6OFOayCAZ2k0gu-9SQ.png"/></div></div></figure><p id="a6cd" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">如果不想显示这么多国家，调整<code class="fe oa ob oc ns b"><strong class="kr iu">top_n</strong></code>变量的值:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="5649" class="nf mj it ns b gy nw nx l ny nz">top_n = <strong class="ns iu">10</strong></span></pre><p id="952b" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">并更改图形的大小:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="2df6" class="nf mj it ns b gy nw nx l ny nz">fig, ax = plt.subplots(1, 1, figsize=(<strong class="ns iu">10,6</strong>))</span></pre><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/cb7c59e6f8da5f03758d5e8adb04a5cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dygp_auPHIDQtTRSSCMEbQ.png"/></div></div></figure><p id="8cb2" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">如果你想加速比赛，改变<code class="fe oa ob oc ns b"><strong class="kr iu">pause()</strong></code>功能的持续时间:</p><pre class="ki kj kk kl gt nr ns nt nu aw nv bi"><span id="4582" class="nf mj it ns b gy nw nx l ny nz"># draw the data and runs the GUI event loop</span><span id="f681" class="nf mj it ns b gy of nx l ny nz">plt.pause(<strong class="ns iu">0.2</strong>)</span></pre><h1 id="b11c" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">摘要</h1><p id="5f30" class="pw-post-body-paragraph kp kq it kr b ks na ju ku kv nb jx kx ky nc la lb lc nd le lf lg ne li lj lk im bi translated">我希望你有机会尝试一下赛车条形图。赛车条形图允许信息动态呈现，是一个非常强大的媒介来推动你的观点。如果您有任何改进，请告诉我，我很乐意收到您的来信！下次见！</p></div></div>    
</body>
</html>