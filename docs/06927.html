<html>
<head>
<title>3 Highly Practical Operations of Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">3熊猫高度实用的操作</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-highly-practical-operations-of-pandas-61d86ca09979?source=collection_archive---------78-----------------------#2020-05-28">https://towardsdatascience.com/3-highly-practical-operations-of-pandas-61d86ca09979?source=collection_archive---------78-----------------------#2020-05-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ce20" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Sample，其中，isin用例子详细解释。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eb015a0ec14a48bb7730a5af7159a23b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OTGT-Si8SJVs_IL-.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@danielkcheung?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">张家瑜</a>在<a class="ae ky" href="https://unsplash.com/s/photos/small?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="0d5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是一个非常强大和通用的Python数据分析库，它加速了数据科学项目的预处理步骤。它提供了许多在数据分析中非常有用的函数和方法。</p><p id="ec68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我的目标是涵盖一些我经常使用的非常方便的操作。本帖将涉及的主题有:</p><ul class=""><li id="9f8b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">样品</strong></li><li id="b1fd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">其中</strong></li><li id="689c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> Isin </strong></li></ul><h1 id="5c13" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"><strong class="ak">样品</strong></h1><p id="d936" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">样本方法允许您从<strong class="lb iu">系列</strong>或<strong class="lb iu">数据帧</strong>中随机选择数值。当我们想从分布中选择一个随机样本时，这是很有用的。假设我们有一个随机变量，它的值存储在数据帧的序列或列中。我们可以使用loc或iloc方法选择它的一部分，但我们需要指定索引或选择范围。但是，使用样本方法，我们可以随机选择值。在开始举例之前，我们先导入numpy和pandas:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="2bcb" class="nl mk it nh b gy nm nn l no np">import numpy as np<br/>import pandas as pd</span></pre><p id="c469" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个具有3列和10000行的数据帧:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="7eb6" class="nl mk it nh b gy nm nn l no np">col_a = np.random.random(10000)<br/>col_b = np.random.randint(50, size=10000)<br/>col_c = np.random.randn(10000)</span><span id="747a" class="nl mk it nh b gy nq nn l no np">df = pd.DataFrame({<br/>    'col_a':col_a,<br/>    'col_b':col_b,<br/>    'col_c':col_c<br/>})</span><span id="3444" class="nl mk it nh b gy nq nn l no np">print(df.shape)<br/>(10000, 3)</span><span id="71ca" class="nl mk it nh b gy nq nn l no np">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/2331cafd8a7ffab49df9401c97c1a5fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*raJEbCYMZCTcR7mrYYnvAQ.png"/></div></figure><p id="0e1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以从任何列中选择n个值:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="e956" class="nl mk it nh b gy nm nn l no np">sample1 = df.col_a.sample(n=5)</span><span id="99c5" class="nl mk it nh b gy nq nn l no np">sample1<br/>3309    0.049868<br/>7856    0.121563<br/>3012    0.073021<br/>9660    0.436145<br/>8782    0.343959<br/>Name: col_a, dtype: float64</span></pre><p id="1a7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> sample() </strong>返回值和索引。我们用n参数指定值的数量，但是我们也可以将一个比率传递给<strong class="lb iu"> frac </strong>参数。例如，0.0005将返回一行中10000个值中的5个:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="5bb6" class="nl mk it nh b gy nm nn l no np">sample2 = df.col_c.sample(frac=0.0005)</span><span id="03cf" class="nl mk it nh b gy nq nn l no np">sample2<br/>8955    1.774066<br/>8619   -0.218752<br/>8612    0.170621<br/>9523   -1.518800<br/>597     1.151987<br/>Name: col_c, dtype: float64</span></pre><p id="9849" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，采样在<em class="ns">完成，无需更换</em>。因此，每个值只能选择一次。我们可以通过将替换<strong class="lb iu">参数</strong>设置为真来改变这种选择方式。则可以多次选择这些值。请注意，这并不意味着样本一定会多次包含一个值。它可能选择相同的值，也可能不选择相同的值。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="e82b" class="nl mk it nh b gy nm nn l no np">sample3 = df.col_c.sample(n=5, replace=True)</span><span id="bfba" class="nl mk it nh b gy nq nn l no np">sample3<br/>3775    0.898356<br/>761    -0.758081<br/>522    -0.221239<br/>6586   -1.404669<br/>5940    0.053480<br/>Name: col_c, dtype: float64</span></pre><p id="fd40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，每个值被选中的概率相同。在某些情况下，我们可能希望从一个系列或数据帧的特定部分中随机选择。例如，我们可能希望跳过前9000行，并希望从剩余的1000行中随机选择。为此，我们可以使用<strong class="lb iu">权重</strong>参数。</p><p id="2153" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们给每个数据点分配权重，表示被选中的概率。权重之和必须为1。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="25bb" class="nl mk it nh b gy nm nn l no np">weights = np.zeros(10000)<br/>weights[9000:] = 0.0001</span><span id="7c3e" class="nl mk it nh b gy nq nn l no np">sample4 = df.col_c.sample(n=5, weights=weights)</span><span id="bd47" class="nl mk it nh b gy nq nn l no np">sample4<br/>9232   -0.429183<br/>9556   -1.282052<br/>9388   -1.041973<br/>9868   -1.809887<br/>9032   -0.330297<br/>Name: col_c, dtype: float64</span></pre><p id="e2d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将第一个9000的权重设置为零，因此结果样本只包括索引9000之后的值。</p><p id="7dd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了获得可再现的样本，我们可以使用<strong class="lb iu"> random_state </strong>参数。如果将整数值传递给random_state，则每次运行代码时都会产生相同的样本。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="691d" class="nl mk it nh b gy nm nn l no np">sample6 = df.col_b.sample(n=5, random_state=1)</span><span id="eda1" class="nl mk it nh b gy nq nn l no np">sample6<br/>9953    31<br/>3850    47<br/>4962    35<br/>3886    16<br/>5437    23<br/>Name: col_b, dtype: int32</span></pre><p id="92a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以通过将轴参数设置为1来随机选择一列。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="90ab" class="nl mk it nh b gy nm nn l no np">sample5 = df.sample(n=1, axis=1)</span><span id="8e4e" class="nl mk it nh b gy nq nn l no np">sample5[:5]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/648fa0435d50b0b06b870eb8fbb059c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*uAn1XgvHGJEpP95hdaxPhw.png"/></div></figure></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="3c9d" class="mj mk it bd ml mm ob mo mp mq oc ms mt jz od ka mv kc oe kd mx kf of kg mz na bi translated"><strong class="ak">哪里</strong></h1><p id="3729" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">“Where”用于根据条件替换行或列中的值。默认的替换值是NaN，但是我们也可以指定替换值。让我们复习一个例子，这样就清楚了。</p><p id="2903" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先创建一个示例数据帧:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="9144" class="nl mk it nh b gy nm nn l no np">df2 = pd.DataFrame({<br/>    'A':[0,0,1,2,4,3,5,8],<br/>    'B':[-1,3,4,-2,2,-4,6,5],<br/>    'C':[9,11,13,5,8,9,11,19]<br/>})</span><span id="365d" class="nl mk it nh b gy nq nn l no np">df2</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/b2fffba0edcba152e88c022bb3738e3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*I8LrdDEhYXlG44UIOWZ00g.png"/></div></figure><p id="a9f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑这样一种情况，我们需要用0替换负值。我们不用遍历if语句和for循环，而是使用<strong class="lb iu"> where </strong>轻松实现这一点:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="3143" class="nl mk it nh b gy nm nn l no np">df2.where(df2 &gt; 0, 0)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/d22e9927641f5fe0164679f23ff7569a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*ipiAEdtt92XPSi5SEeYTkQ.png"/></div></figure><p id="56ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“where”的工作方式是选择符合条件的值，并用指定的值替换剩余的值。<strong class="lb iu">其中(df2 &gt; 0，0) </strong>选择所有大于0的值，其余值替换为0。因此，where也可以被认为是一个掩码操作。</p><p id="472e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们再看一个例子。我们希望保持负值不变，但将正值转换为负值(即2替换为-2):</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="46ca" class="nl mk it nh b gy nm nn l no np">df2.where(df2 &lt; 0, -df2)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/27e87d8d04813b5ff23bb0222087c1fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*5ClSa6TNuAoBZLLOmORnUw.png"/></div></figure><p id="92bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了保存原始数据帧中的更改，我们需要将<strong class="lb iu"> inplace </strong>参数设置为True。</p><p id="9c79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的一点是，熊猫和熊猫的“T10”和“T11”并不完全相同。我们可以获得相同的结果，但语法略有不同。使用<strong class="lb iu"> DataFrame.where </strong>，选择符合条件的值<strong class="lb iu">作为</strong>，其他值替换为指定值。<strong class="lb iu"> Np.where </strong>还要求指定符合条件的值。以下两行返回相同的结果:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="72a5" class="nl mk it nh b gy nm nn l no np">df2['B'].where(df2['B'] &lt; 0, 0)</span><span id="06cc" class="nl mk it nh b gy nq nn l no np">np.where(df2['B'] &lt; 0, df2['B'], 0)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/b82592a88cf298b11df6bdf22f71d3a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YfyLxrCDym8wydK0RMmB6w.png"/></div></div></figure><p id="1a46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，numpy版本更加灵活。我们也可以改变符合条件的值。例如，我们可能希望将负值乘以2:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="0536" class="nl mk it nh b gy nm nn l no np">np.where(df2['B'] &lt; 0, df2['B']*2 , 0)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/c2999f941f174aeb2bfcc9fa3236c9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m-xglo1QfmNWUP0CcnT1Qw.png"/></div></div></figure></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="34ba" class="mj mk it bd ml mm ob mo mp mq oc ms mt jz od ka mv kc oe kd mx kf of kg mz na bi translated"><strong class="ak"> isin </strong></h1><p id="db7e" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在处理数据帧时，我们经常使用过滤或选择方法。我们可以像使用where那样基于条件进行过滤，或者使用行或列索引选择数据帧的一部分。Isin 方法是一种先进的滤波方法。例如，我们可以选择符合一系列条件的值。</p><p id="afe1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们为“isin”示例创建一个不同的数据帧:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="03ff" class="nl mk it nh b gy nm nn l no np">df3 = pd.DataFrame({<br/>    'A':[7,4,1,2,4,3,5,8],<br/>    'B':['cat','cat','dog','bird','bird','cat','dog','chicken'],<br/>    'C':['brown','black','black','yellow','green','brown','white','brown']<br/>})</span><span id="94b3" class="nl mk it nh b gy nq nn l no np">df3</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/6aa4f66cadb5095c9f297b9c3039bdec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAkRXcSBQ4iTgzRayF9cOA.png"/></div></div></figure><p id="be54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用简单的掩码操作设置一个条件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/ae190d7daaff4eef93e5e001eae0a3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*gRVDc_GNhf-UrNncrKIYMw.png"/></div></figure><p id="d1bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> isin </strong>允许在一个列表中设置多个条件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/a5806aead062ebb19a9d47dab3d8bf66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*TWk76b_37OLCYgpEvHNuag.png"/></div></figure><p id="6f10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以在isin中使用波浪号(~)运算符。然后返回<em class="ns">不符合条件的值:</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/fcdf8ec1878c7f9f4099c89ecf9aebae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*nEe3KMwQkoJ7gZZ1WnnPuA.png"/></div></figure><p id="7950" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以将一个过滤器以字典的形式传递给isin。将基于以下条件返回布尔值:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="fcc7" class="nl mk it nh b gy nm nn l no np">values = {'B':['cat','dog'], 'C':['brown','black']}</span><span id="b003" class="nl mk it nh b gy nq nn l no np">df3.isin(values)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6f0e3cc65c7e2f5c18711bd9ce3f2ff6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*GdBdv4t1m8-Bs1PzouQgRw.png"/></div></figure></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><p id="3249" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我认为熊猫的成功和流行来自于其多功能、强大且易于使用的操作和分析数据的功能。和熊猫一起完成一项任务几乎总是有多种方式。由于花在数据科学项目上的大部分时间都花在了数据清理和预处理步骤上，Pandas是您武库中的宝贵资产。</p><p id="6108" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>