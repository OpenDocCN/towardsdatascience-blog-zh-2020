<html>
<head>
<title>Beware of implementing machine learning algorithms as black box tools</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当心将机器学习算法实现为黑盒工具</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/beware-of-implementing-machine-learning-models-as-black-box-tools-d08947db7536?source=collection_archive---------21-----------------------#2020-01-01">https://towardsdatascience.com/beware-of-implementing-machine-learning-models-as-black-box-tools-d08947db7536?source=collection_archive---------21-----------------------#2020-01-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ab64" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在没有完全理解模型的复杂性的情况下，使用任何机器学习模型作为黑箱，都会导致模型被证伪</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8ec7c2472c889f314350575c5fae9495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WeM1_1WWp3OsXoxD5exCEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">Benjamin o . Tayo 创作的照片</strong></p></figure><p id="2212" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">在</span>数据科学和机器学习中，数学技能和编程技能一样重要。有很多好的软件包可以用来构建预测模型。一些最常见的描述性和预测性分析包包括</p><ul class=""><li id="9d38" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated">Ggplot2</li><li id="013e" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">Matplotlib</li><li id="1253" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">海生的</li><li id="9167" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">Sci-kit 学习包</li><li id="af47" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">插入符号包</li><li id="b57b" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">张量流</li><li id="f347" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">PyTouch 包</li><li id="1d48" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">Keras 包</li></ul><p id="cd61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢上面提到的软件包，几乎每个对数据科学有一些基本了解的人都可以建立一个机器学习模型。</p><p id="62ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在使用这些包之前，您必须掌握数据科学的基础知识，这样您就不会将这些包简单地用作黑盒工具。</p><p id="3f01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们说明了深入了解机器学习算法的后端对于构建高效可靠的模型是多么重要和关键。我们将考虑使用游轮数据集<a class="ae ms" href="https://github.com/bot13956/ML_Model_for_Predicting_Ships_Crew_Size" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">cruise _ ship _ info . CSV</strong></a><strong class="lb iu"/>建立推荐船员人数的模型的案例研究。</p><h1 id="26e4" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">机器学习算法的后端</h1><p id="117c" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">现在，假设我们想要在给定的特征空间上建立一个模型，用于预测目标变量<strong class="lb iu"> y </strong>。我们的模型可以用以下形式表示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/75dbbf15a22cdb779215a72bb53acb01.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*Uu6GTG5NBUQgegUFxnUZIg.png"/></div></figure><p id="d068" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<strong class="lb iu"> X </strong>是 M×N 特征矩阵，并且<strong class="lb iu"> w </strong>是要从算法中学习的权重。我们将使用游轮数据集来说明我们的示例。</p><p id="bd1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上一篇文章中(<a class="ae ms" href="https://medium.com/towards-artificial-intelligence/feature-selection-and-dimensionality-reduction-using-covariance-matrix-plot-b4c7498abd07" rel="noopener"> <strong class="lb iu">使用协方差矩阵图进行特征选择和降维</strong> </a>)，我们已经展示了协方差矩阵图可以用于特征选择和降维。</p><p id="ba1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用游轮数据集<a class="ae ms" href="https://github.com/bot13956/ML_Model_for_Predicting_Ships_Crew_Size" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">cruise _ ship _ info . CSV</strong></a><strong class="lb iu">，</strong>我们发现，在 6 个预测特征[' <strong class="lb iu">年龄</strong>'、<strong class="lb iu">吨位</strong>'、<strong class="lb iu">乘客</strong>'、<strong class="lb iu">长度</strong>'、<strong class="lb iu">舱室</strong>、<strong class="lb iu">乘客密度</strong> ]中，如果我们假设重要特征的相关系数为 0.6 或 那么目标变量“<strong class="lb iu">乘员</strong>”与 4 个预测变量:“<strong class="lb iu">吨位</strong>”、“<strong class="lb iu">乘客</strong>”、“<strong class="lb iu">长度</strong>、“<strong class="lb iu">舱位</strong>”强相关。 因此，我们能够将特征空间的维数从 6 降低到 4。</p><p id="5939" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设现在我们想要建立一个线性回归模型，使用 4 个预测变量来预测<strong class="lb iu">“船员”</strong>:“<strong class="lb iu">吨位</strong>”、“<strong class="lb iu">乘客</strong>”、“<strong class="lb iu">长度</strong>和“<strong class="lb iu">舱室</strong>”。</p><p id="a059" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们希望我们的模型对输入数据集执行 3 项重要任务:</p><p id="7cc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(1)使用<strong class="lb iu">标准缩放器()</strong>转换器进行特征缩放；</p><p id="a976" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(2)使用<strong class="lb iu"> PCA() </strong>变换器的特征工程和维数减少；和</p><p id="7043" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(3)使用<strong class="lb iu">线性回归()</strong>估计量建模。</p><p id="ea40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到 Python 的 sklearn 包很好地为我们执行了大部分任务。例如，我们可以将上述 3 个过程合并成一个管道，如下所示:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="0993" class="nw mu it ns b gy nx ny l nz oa">import numpy as np</span><span id="1eef" class="nw mu it ns b gy ob ny l nz oa">import pandas as pd</span><span id="44a9" class="nw mu it ns b gy ob ny l nz oa">from sklearn.preprocessing import StandardScaler</span><span id="8b4a" class="nw mu it ns b gy ob ny l nz oa">from sklearn.decomposition import PCA</span><span id="bc39" class="nw mu it ns b gy ob ny l nz oa">from sklearn.linear_model import LinearRegression</span><span id="5861" class="nw mu it ns b gy ob ny l nz oa">from sklearn.pipeline import Pipeline</span><span id="c4f1" class="nw mu it ns b gy ob ny l nz oa">pipe_lr = Pipeline([('scl', StandardScaler()),('pca', <br/>                  PCA(n_components=4)),('slr', LinearRegression())])</span></pre><p id="177f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在实现模型之前，用户必须确保他们理解算法后端如何工作的所有细节。例如，你需要问自己以下问题:</p><ol class=""><li id="679f" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu oc mk ml mm bi translated"><strong class="lb iu"> StandardScaler() </strong>估算器对我的特性有什么影响？</li><li id="aa30" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu oc mk ml mm bi translated">什么是<strong class="lb iu"> PCA() </strong>变压器，它的一些超参数是什么？在最终的模型中，我应该使用多少个主成分？</li><li id="1ad8" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu oc mk ml mm bi translated">什么是<strong class="lb iu"> LinearRegression() </strong>估计量？我完全理解它是如何工作的吗？</li></ol><h1 id="27a2" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">机器学习模型的前端:用户输入</h1><p id="b911" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">为了建立一个机器学习模型，用户必须通过向模型中输入数据来与机器学习模型的后端进行交互。因此，作为用户，您需要导入数据集，准备数据集，然后将其划分为训练集和测试集。。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="5222" class="nw mu it ns b gy nx ny l nz oa">df = pd.read_csv("cruise_ship_info.csv")</span><span id="ae7f" class="nw mu it ns b gy ob ny l nz oa">cols_selected = ['Tonnage', 'passengers', 'length', 'cabins','crew']</span><span id="896c" class="nw mu it ns b gy ob ny l nz oa">X = df[cols_selected].iloc[:,0:4].values <br/>    <br/>y = df[cols_selected]['crew']</span></pre><h1 id="cce0" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">模型实现</h1><p id="e2f0" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">既然您已经了解了机器学习模型后端如何工作的细节，并且您已经准备好了数据集，那么是时候将数据输入到机器学习模型中了。我们希望使用 k-fold 交叉验证来训练、测试和评估我们的模型。在 k-fold 交叉验证中，数据集被随机划分为训练集和测试集。该模型在训练集上被训练，并在测试集上被评估。该过程重复 k 次。然后，通过对 k 倍进行平均来计算平均训练和测试分数。</p><p id="ed4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是 k 倍交叉验证伪代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/24e378a6c19278313352dab488208281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*phBn3s9GF-h3pd8O.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky"> k 倍交叉验证伪代码。Benjamin O. Tayo 的照片</strong></p></figure><p id="c1f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后可以使用下面的代码实现我们的模型:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="2a0f" class="nw mu it ns b gy nx ny l nz oa">from sklearn.metrics import r2_score</span><span id="9ddb" class="nw mu it ns b gy ob ny l nz oa">from sklearn.model_selection import train_test_split</span><span id="8594" class="nw mu it ns b gy ob ny l nz oa">sc_y = StandardScaler()</span><span id="55e2" class="nw mu it ns b gy ob ny l nz oa">train_score = []</span><span id="63e2" class="nw mu it ns b gy ob ny l nz oa">test_score =  []</span><span id="5817" class="nw mu it ns b gy ob ny l nz oa">for i in range(10):   </span><span id="3376" class="nw mu it ns b gy ob ny l nz oa">    X_train, X_test, y_train, y_test = train_test_split( X, y, <br/>                                  test_size=0.4, random_state=i) </span><span id="9208" class="nw mu it ns b gy ob ny l nz oa">    y_train_std = sc_y.fit_transform(y_train[:, <br/>                                     np.newaxis]).flatten()    </span><span id="8ed4" class="nw mu it ns b gy ob ny l nz oa">    pipe_lr.fit(X_train, y_train_std)    </span><span id="940f" class="nw mu it ns b gy ob ny l nz oa">    y_train_pred = sc_y.inverse_transform(pipe_lr.predict(X_train))</span><span id="829f" class="nw mu it ns b gy ob ny l nz oa">    y_test_pred = sc_y.inverse_transform(pipe_lr.predict(X_test)) </span><span id="3f1f" class="nw mu it ns b gy ob ny l nz oa">    train_score = np.append(train_score, r2_score(y_train, <br/>                            y_train_pred))   </span><span id="f4e1" class="nw mu it ns b gy ob ny l nz oa">    test_score = np.append(test_score, r2_score(y_test, <br/>                            y_test_pred))</span></pre><h1 id="d23b" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">模型输出</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/7305e762ab7a61578f100173c7ea9566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*seJdhtumrWZDwUzN.png"/></div></div></figure><p id="47c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总之，我们已经讨论了机器学习算法的后端，以及为什么用户理解后端如何工作的所有细节是重要的。感谢 sci-kit learn、TensorFlow、PyTouch、Keras 和 Caret 等机器学习包，每个对数据科学和机器学习有一些基本了解的人都可以建立预测模型。然而，在没有充分理解模型的错综复杂的情况下，将任何机器学习模型作为黑箱，都会导致模型被证伪。</p><h1 id="ef4c" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">参考</h1><ol class=""><li id="0025" class="me mf it lb b lc nl lf nm li of lm og lq oh lu oc mk ml mm bi translated"><a class="ae ms" href="https://medium.com/towards-artificial-intelligence/training-a-machine-learning-model-on-a-dataset-with-highly-correlated-features-debddf5b2e34" rel="noopener">在特征高度相关的数据集上训练机器学习模型</a>。</li><li id="1ef9" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu oc mk ml mm bi translated"><a class="ae ms" href="https://medium.com/towards-artificial-intelligence/feature-selection-and-dimensionality-reduction-using-covariance-matrix-plot-b4c7498abd07" rel="noopener">使用协方差矩阵图进行特征选择和降维</a>。</li><li id="956d" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu oc mk ml mm bi translated">拉什卡、塞巴斯蒂安和瓦希德·米尔贾利利<strong class="lb iu">。</strong> <em class="oi"> Python 机器学习，第二版</em>。Packt 出版公司，2017 年。</li><li id="5ad3" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu oc mk ml mm bi translated">Benjamin O. Tayo，<em class="oi">预测船只船员规模的机器学习模型</em>，<a class="ae ms" href="https://github.com/bot13956/ML_Model_for_Predicting_Ships_Crew_Size" rel="noopener ugc nofollow" target="_blank">https://github . com/bot 13956/ML _ Model _ for _ Predicting _ Ships _ Crew _ Size</a>。</li></ol></div></div>    
</body>
</html>