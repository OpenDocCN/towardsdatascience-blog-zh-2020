<html>
<head>
<title>Create A Machine Learning Model With Google Cloud BigQuery ML Using SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 SQL 通过 Google Cloud BigQuery ML 创建机器学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-a-machine-learning-model-with-google-cloud-bigquery-ml-using-sql-9e2c0ce7fd2d?source=collection_archive---------48-----------------------#2020-06-01">https://towardsdatascience.com/create-a-machine-learning-model-with-google-cloud-bigquery-ml-using-sql-9e2c0ce7fd2d?source=collection_archive---------48-----------------------#2020-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/53082807f39cae4d42ed2d6cfc725e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mrm3IaHeXoLiyyYFVDpi5w.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">我的简单白板</p></figure><p id="6405" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">随着机器学习模型在不同领域的应用，以及技术的进步(更好的硬件和高级编程语言)，建立一个适合您需求的工作机器学习模型变得越来越容易。制作机器学习模型的过程越来越简单，代码行数越来越少。</p><p id="535e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在本文中，我将向您展示如何使用 Google BigQuery ML 构建一个只包含 SQL 的定制 ML 模型。</p><blockquote class="ld le lf"><p id="2d3c" class="kf kg lg kh b ki kj kk kl km kn ko kp lh kr ks kt li kv kw kx lj kz la lb lc im bi translated"><strong class="kh iu"> <em class="it">但是首先，Google BigQuery 是什么？</em>T3】</strong></p></blockquote><p id="e760" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Google BigQuery 是一个无服务器、低成本、高可伸缩的数据仓库系统，由 Google Cloud Platform 提供，具有许多业务敏捷性特性。BigQuery ML 就是这样一个特性，它帮助数据科学家、数据分析师和数据工程师(比如我)构建可操作的生产级 ML 模型。我们可以在结构化和非结构化数据上创建模型。最重要的是，只需在短时间内使用 SQL 环境进行查询。</p><p id="8fed" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在本文中，我们将完成以下任务:</p><ol class=""><li id="74e3" class="lk ll it kh b ki kj km kn kq lm ku ln ky lo lc lp lq lr ls bi translated">使用“德国信用数据”作为样本数据集来预测贷款申请的好坏。</li><li id="23e8" class="lk ll it kh b ki lt km lu kq lv ku lw ky lx lc lp lq lr ls bi translated">将样本数据分为训练集和测试集。</li><li id="5688" class="lk ll it kh b ki lt km lu kq lv ku lw ky lx lc lp lq lr ls bi translated">创建并加载 Google BigQuery 表中的数据。</li><li id="a1d6" class="lk ll it kh b ki lt km lu kq lv ku lw ky lx lc lp lq lr ls bi translated">只需使用 SQL 创建一个“逻辑回归”模型。</li><li id="3751" class="lk ll it kh b ki lt km lu kq lv ku lw ky lx lc lp lq lr ls bi translated">最后，我们将评估和预测贷款类型的好坏。</li></ol><blockquote class="ld le lf"><p id="4c0e" class="kf kg lg kh b ki kj kk kl km kn ko kp lh kr ks kt li kv kw kx lj kz la lb lc im bi translated"><strong class="kh iu"> <em class="it">我们将使用的样本数据:</em> </strong></p></blockquote><p id="e8a5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将使用一个样本结构化数据集“德国信贷数据”。您也可以从下面的 git 资源库下载这些文件:</p><p id="a864" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae ly" href="https://github.com/aakash-rathore/BigQueryML/tree/master/data" rel="noopener ugc nofollow" target="_blank">https://github . com/aa kash-ra thore/BigQueryML/tree/master/data</a></p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="171f" class="mi mj it me b gy mk ml l mm mn">├── data<br/>│   ├── germanCredit.csv<br/>│   ├── GermanCredit.xls<br/>│   ├── testData.csv<br/>│   └── trainData.csv<br/>├── README.md<br/>└── test_train.py</span></pre><p id="15aa" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在存储库“GermanCredit.xls”的原始数据文件中，该文件提供了所有列数据的详细信息。我已经对所有分类数据进行了编码，并创建了一个文件“german credit . CSV”,“test _ train . py”是一个 python 脚本，用于将数据划分到测试和训练数据集中(testData.csv 和 trainData.csv)</p><blockquote class="ld le lf"><p id="0a6e" class="kf kg lg kh b ki kj kk kl km kn ko kp lh kr ks kt li kv kw kx lj kz la lb lc im bi translated"><strong class="kh iu"> <em class="it">在 BigQuery 中加载数据:</em> </strong></p></blockquote><p id="1a0c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">登录到 Google 云平台控制台，使用左侧选项面板导航到 BigQuery 选项卡。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mo"><img src="../Images/a86f3c6284b9c2d7d222da85d96b9c71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n_x2Dr_oYGHqbTXX5B38XQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">在 GCP 控制台中选择 Bigquery 工具</p></figure><p id="6637" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用 BigQuery 控制台中的选项创建数据集。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/57456a55ee06f34d1fe922736d5853f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oCa3yjgyyS2F8GtHh7zslQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">创建数据集</p></figure><p id="fc36" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">从先前创建的数据集中的 trainData.csv 和 testData.csv 创建表格。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/48d4e7a347ab82a593ab3517ee3d98cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v26Es1ETxdgUxQbJ7UAIow.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">创建包含列车数据的表创建包含测试数据的表</p></figure><p id="7d4a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在选择相应的表后，我们可以使用“预览”选项预览创建的表中的样本数据。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/9521581b7fdafce453e1870919f73c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Szs87BWO7T1ZmmJ8TTjXw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">预览表格数据</p></figure><p id="9c15" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，我们可以开始创建一个 ML 模型，在我们的样本数据中,“响应”列是结果标签(1 =好，0 =坏),其他列是输入特征。令人惊奇的是，我们将只使用 SQL 查询来创建和评估我们的 ML 模型。</p><blockquote class="ld le lf"><p id="d288" class="kf kg lg kh b ki kj kk kl km kn ko kp lh kr ks kt li kv kw kx lj kz la lb lc im bi translated"><strong class="kh iu"> <em class="it">创建 ML 模型:</em> </strong></p></blockquote><p id="5ecb" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将创建一个逻辑回归模型，这是一个分类模型，在我们的案例中，我们将使用它来根据以前的信用报告数据对贷款申请进行分类。</p><p id="2121" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> SQL 查询创建一个 ML 模型</strong>:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="6d1f" class="mi mj it me b gy mk ml l mm mn"># Creating logistic regression model using data from trainData table</span><span id="2b20" class="mi mj it me b gy ms ml l mm mn">CREATE OR REPLACE MODEL<br/>  `mltestDataset.credit_classification_model` OPTIONS ( model_type='logistic_reg' labels=['response'] ) AS<br/>SELECT<br/>  * EXCEPT(obs)<br/>FROM<br/>  `mltestDataset.trainData`</span></pre><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/9c50915c53188e516b06c9f44df98d9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DWZjT5G9qndvWjrSnTfjRQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">从包含训练数据的表中创建模式</p></figure><blockquote class="ld le lf"><p id="bc2b" class="kf kg lg kh b ki kj kk kl km kn ko kp lh kr ks kt li kv kw kx lj kz la lb lc im bi translated"><strong class="kh iu"> <em class="it">评估创建的 ML 模型:</em> </strong></p></blockquote><p id="a672" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">评估 ML 模型有不同性能参数，在我们创建的 ML 模型中，当评估我们训练的 ML 模型时，roc_auc 是这样一个简单的可查询字段。</p><p id="8d67" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">评估 ML 模型的 SQL 查询:</strong></p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="2289" class="mi mj it me b gy mk ml l mm mn"># Evaluating logistic regression model using data from testData table</span><span id="5911" class="mi mj it me b gy ms ml l mm mn">SELECT<br/>  roc_auc,<br/>  CASE<br/>    WHEN roc_auc &gt; .8 THEN 'good'<br/>    WHEN roc_auc &gt; .7 THEN 'fair'<br/>    WHEN roc_auc &gt; .6 THEN 'not great'<br/>  ELSE<br/>  'poor'<br/>END<br/>  AS model_quality<br/>FROM<br/>  ML.EVALUATE(MODEL mltestDataset.credit_classification_model,<br/>    (<br/>    SELECT<br/>      * EXCEPT(obs)<br/>    FROM<br/>      `mltestDataset.testData` ) )</span></pre><p id="8a34" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">输出</strong>:</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/276f8b69c3203f87577d1cf436bfe259.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rPLwX-WcVyFPWu3ZrOEN5Q.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">使用曲线下的 ROC 面积评估模型性能</p></figure><p id="e5b0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">正如您可以看到的性能相当不错，我们可以通过使用特征工程调整模型来提高性能。但是为了简单起见，我们将使用这个模型来分析预测。</p><blockquote class="ld le lf"><p id="96c4" class="kf kg lg kh b ki kj kk kl km kn ko kp lh kr ks kt li kv kw kx lj kz la lb lc im bi translated"><strong class="kh iu"> <em class="it">预测使用创建的 ML 模型:</em> </strong></p></blockquote><p id="baa0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在我们将使用这个模型来预测贷款类型(1 =好，0 =坏)。下面给出了从模型中获取预测的查询:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="b927" class="mi mj it me b gy mk ml l mm mn"># Getting prediction for our ML model using data from testData table</span><span id="c7d7" class="mi mj it me b gy ms ml l mm mn">SELECT<br/>  *<br/>FROM<br/>  ml.PREDICT(MODEL `mltestDataset.credit_classification_model`,<br/>    (<br/>    SELECT<br/>      * EXCEPT(obs)<br/>    FROM<br/>      `mltestDataset.testData` ) );</span></pre><p id="fa9c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">输出:</strong></p><p id="1b65" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将检查前 5 个预测:</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/50ad4191b554bd10b642d90135050460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iGc6cD_rKfoxwCKfZlWM4g.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">检查预测</p></figure><p id="9c36" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们可以看到前 5 个预测的结果:<br/> 1。对于第一条记录，我们的模型以 84%的置信度预测贷款是好的(响应=1)，实际上，它是好的(响应=1)。<br/> 2。对于第二条记录，模型以 93%的置信度预测贷款是好的(响应=1)，实际上，它是好的(响应=1)。<br/> 3。对于第三条记录，模型以 63%的置信度预测贷款是好的(响应=1)，实际上，它是好的(响应=1)。<br/> 4。对于第 4 条记录，模型以 74%的置信度预测贷款是好的(响应=1)，实际上，它是好的(响应=1)。<br/> 5。对于第 5 条记录，模型以 66%的置信度预测贷款为不良贷款(响应=0)，实际上，它是不良贷款(响应=0)。</p><blockquote class="ld le lf"><p id="e8e3" class="kf kg lg kh b ki kj kk kl km kn ko kp lh kr ks kt li kv kw kx lj kz la lb lc im bi translated"><strong class="kh iu">T26】结论:T28】</strong></p></blockquote><p id="aba4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在本文中，我解释了如何使用 SQL 在 Google BigQuery 中创建和评估 ML 模型。后来我们分析了这个模型的预测。</p><p id="1b12" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">请在下面留下您对本文的评论，如果您在上面指定的任何步骤中遇到问题，您可以通过<a class="ae ly" href="https://www.instagram.com/_aakash.rathore/" rel="noopener ugc nofollow" target="_blank"><strong class="kh iu">insta gram</strong></a><strong class="kh iu"/>和<a class="ae ly" href="https://www.linkedin.com/in/aakash-data-engineer" rel="noopener ugc nofollow" target="_blank"> <strong class="kh iu"> LinkedIn </strong> </a> <strong class="kh iu">联系我。</strong></p></div></div>    
</body>
</html>