<html>
<head>
<title>Python Interactive Data Visualization with Altair</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Altair 实现 Python 交互式数据可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-interactive-data-visualization-with-altair-b4c4664308f8?source=collection_archive---------4-----------------------#2020-03-13">https://towardsdatascience.com/python-interactive-data-visualization-with-altair-b4c4664308f8?source=collection_archive---------4-----------------------#2020-03-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="605e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用不到 20 行代码创建交互式图表。</h2></div><h1 id="ced8" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">一个简单的例子</h1><p id="74d6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在我们进入细节之前，我想向您展示一个不到 20 行代码的交互式图表。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/31cf60a58392dff3b8659e3388c961d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/1*UL8ZWQvfhI6rvGhadaSuZw.gif"/></div></figure><p id="a403" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">这个图表是用 Python 数据可视化库 Altair 创建的。Altair 是 Python 的一个声明性统计可视化库，基于<a class="ae mj" href="http://vega.github.io/vega" rel="noopener ugc nofollow" target="_blank"> Vega </a>和<a class="ae mj" href="http://vega.github.io/vega-lite" rel="noopener ugc nofollow" target="_blank"> Vega-Lite </a>。Altair 提供了强大而简洁的可视化语法，使您能够快速构建各种各样的统计可视化。</p><p id="3520" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">这个库的关键思想是你在<em class="mk">数据列</em>和<em class="mk">可视编码通道</em>之间声明链接，比如 x 轴、y 轴、颜色等。其余的情节细节是自动处理的。基于这种声明性的绘图思想，可以使用相对简洁的语法创建一系列从简单到复杂的绘图和可视化。</p><p id="5de9" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">下面是来自<a class="ae mj" href="https://altair-viz.github.io/gallery/index.html" rel="noopener ugc nofollow" target="_blank">官方示例图库</a>的部分示例截图。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ml"><img src="../Images/0c43380d870af10a81b9925563cfb413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbyyXADh9ZkyTz4Fo8HCxw.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">来自<a class="ae mj" href="https://altair-viz.github.io/gallery/index.html" rel="noopener ugc nofollow" target="_blank">官方示例图库</a>的一些牛郎星示例</p></figure><h1 id="ac47" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">装置</h1><p id="906c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这个库有很多依赖项，我强烈建议创建一个新的虚拟环境。此外，避免使用<strong class="lc iu"> <em class="mk"> base(root) </em> </strong>也是一个最佳实践，因为这可能会破坏您的系统。</p><p id="882e" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">关于创建 Python 虚拟环境的教程，你可以看看:</p><div class="mu mv gp gr mw mx"><a rel="noopener follow" target="_blank" href="/create-virtual-environment-using-virtualenv-and-add-it-to-jupyter-notebook-6e1bf4e03415"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">使用“virtualenv”创建虚拟环境，并将其添加到 Jupyter 笔记本中</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">你是机器学习工程师，正在使用 Python 和 Jupyter Notebook 吗？在这篇文章中，你会看到为什么…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">towardsdatascience.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl mc mx"/></div></div></a></div><div class="mu mv gp gr mw mx"><a href="https://medium.com/analytics-vidhya/create-virtual-environment-using-conda-and-add-it-to-jupyter-notebook-d319a81dfd1" rel="noopener follow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">使用“conda”创建虚拟环境，并将其添加到 Jupyter 笔记本中</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">你正在使用 anaconda 和使用 Jupyter Notebook 和 Python 吗？在这篇文章中，你将看到如何创建虚拟的…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">medium.com</p></div></div><div class="ng l"><div class="nm l ni nj nk ng nl mc mx"/></div></div></a></div><p id="ca2b" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">以下是安装 Altair 的两个选项:</p><ul class=""><li id="9a0e" class="nn no it lc b ld me lg mf lj np ln nq lr nr lv ns nt nu nv bi translated">终端— pip/conda</li><li id="a0e8" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated">阿南康达-领航员</li></ul><h2 id="6154" class="ob kj it bd kk oc od dn ko oe of dp ks lj og oh ku ln oi oj kw lr ok ol ky om bi translated">通过 pip/conda 的终端</h2><p id="82fd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">假设您已经处于想要安装 Altair 的环境中。</p><p id="c3df" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">Altair 可以与示例数据集一起安装在<a class="ae mj" href="https://github.com/altair-viz/vega_datasets" rel="noopener ugc nofollow" target="_blank"> vega_datasets </a>中，</p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="ee09" class="ob kj it oo b gy os ot l ou ov">pip install altair vega_datasets</span></pre><p id="fb64" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">如果您使用的是 conda 软件包管理器，则等同于:</p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="9657" class="ob kj it oo b gy os ot l ou ov">conda install -c conda-forge altair vega_datasets</span></pre><p id="ac5f" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">成功安装后，您应该能够打开 Jupyter Notebook 或 JupyterLab，并执行来自<a class="ae mj" href="https://altair-viz.github.io/gallery/index.html#example-gallery" rel="noopener ugc nofollow" target="_blank">示例库</a>的任何代码。</p><h2 id="3e8c" class="ob kj it bd kk oc od dn ko oe of dp ks lj og oh ku ln oi oj kw lr ok ol ky om bi translated">巨蟒领航员</h2><p id="8753" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">启动<strong class="lc iu"><em class="mk">anaconda-Navigator</em></strong>，导航到<strong class="lc iu"> <em class="mk">环境</em> </strong>，选择您喜欢安装 Altair 的环境，例如“<em class="mk">数据可视化</em>”。然后从下拉菜单中选择<em class="mk">未安装</em>。</p><p id="2479" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">重要提示:您应该始终避免使用<strong class="lc iu"> <em class="mk"> base(root) </em> </strong>，因为库及其依赖项的更新可能会破坏您的系统。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ow"><img src="../Images/93dd6a38d0d39391a02c122cabc8bece.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CtCQCXlXB6tvpmO3HZCw1A.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">使用 Anaconda-Navigator 安装 Altair</p></figure><p id="b8a4" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">从<strong class="lc iu">搜索</strong>字段中搜索<em class="mk">牛郎星</em>，并选择库。之后点击<em class="mk">应用</em>应该可以安装 Altair 及其依赖项。可以按照同样的方法安装示例数据集<a class="ae mj" href="https://github.com/altair-viz/vega_datasets" rel="noopener ugc nofollow" target="_blank"> vega_datasets </a>。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ox"><img src="../Images/2472cf3702827be38b3573491c59f3f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3LR8vu5zcCfxigNh32oXeQ.png"/></div></div></figure><p id="1245" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">一旦成功安装，返回<strong class="lc iu">主页</strong>并确保您处于正确的<strong class="lc iu">环境<em class="mk">。</em> </strong>你应该能够启动 Jupyter Notebook 或 JupyterLab，并执行<a class="ae mj" href="https://altair-viz.github.io/gallery/index.html#example-gallery" rel="noopener ugc nofollow" target="_blank">示例库</a>中的任何代码。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi oy"><img src="../Images/cd9700759569c240afa4d5f238c9737b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OFFV7xG4VYgMHcKJW_KsUg.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">从 Anaconda Navigator 启动 JupyterLab 或 Jupyter Notebook</p></figure><h1 id="fdd3" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">牛郎星图表基础指南</h1><p id="91f7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">牛郎星官方用户指南里有很多概念，<em class="mk"> </em>但是<em class="mk"> </em> <strong class="lc iu"> <em class="mk">数据</em> </strong>，<strong class="lc iu"> <em class="mk">标志</em> </strong>，<strong class="lc iu"> <em class="mk">编码</em> </strong>是基本的。理解以下概念应该足以让您创建基本的交互式图表。</p><h2 id="1d32" class="ob kj it bd kk oc od dn ko oe of dp ks lj og oh ku ln oi oj kw lr ok ol ky om bi translated">数据</h2><p id="bbcd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Altair 内部使用的数据以 Pandas DataFrame 格式存储，但有四种方式可以传入:</p><ul class=""><li id="d6a3" class="nn no it lc b ld me lg mf lj np ln nq lr nr lv ns nt nu nv bi translated">作为熊猫的数据框架</li><li id="33c5" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated">作为数据或相关对象</li><li id="1718" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated">作为指向 json 或 csv 格式文件的 url 字符串</li><li id="981e" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated">作为支持 __geo_interface__(例如<a class="ae mj" href="http://geopandas.org/data_structures.html#geodataframe" rel="noopener ugc nofollow" target="_blank"> Geopandas 地理数据框架</a>、<a class="ae mj" href="https://shapely.readthedocs.io/en/latest/manual.html#geometric-objects" rel="noopener ugc nofollow" target="_blank"> Shapely Geometries </a>、<a class="ae mj" href="https://github.com/jazzband/geojson#geojson-objects" rel="noopener ugc nofollow" target="_blank"> GeoJSON 对象</a>)的对象</li></ul><p id="2e03" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">下面是一个导入 Pandas 和 Altair 的示例，并创建一个简单的数据帧来可视化，在列<strong class="lc iu"> col-1 </strong>中有一个分类变量，在列<strong class="lc iu"> col-2 </strong>中有一个数字变量:</p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="4f6f" class="ob kj it oo b gy os ot l ou ov"><strong class="oo iu">import altair as alt<br/>import</strong> <strong class="oo iu">pandas</strong> <strong class="oo iu">as</strong> <strong class="oo iu">pd</strong></span><span id="7328" class="ob kj it oo b gy oz ot l ou ov">data = pd.DataFrame({'col-1': list('CCCDDDEEE'),<br/>                     'col-2': [2, 7, 4, 1, 2, 6, 8, 4, 7]})<br/>chart = alt.Chart(data)</span></pre><h2 id="1f0e" class="ob kj it bd kk oc od dn ko oe of dp ks lj og oh ku ln oi oj kw lr ok ol ky om bi translated">马克斯（英格兰人姓氏）</h2><p id="98b1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">选择数据后，您需要选择各种图表，如条形图、折线图、面积图、散点图、直方图和地图。<code class="fe pa pb pc oo b">mark</code>属性指定了这些属性应该如何在图上精确地表示。Altair 提供了许多基本标记属性:</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi pd"><img src="../Images/33557b60e7e7f01c9af06b11ef8f799f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QRDSkZXspfnPJtBiq5uLxA.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">牛郎星基本标志</p></figure><p id="8c16" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">除基本标记外，它还提供以下复合标记:</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi pe"><img src="../Images/84be0a885d6160fe865b550ae8cf870c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9GeD748Ao8hBwc4LJtRcfA.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">牛郎星复合标志</p></figure><p id="c387" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">有了上面的图表对象，我们现在可以指定我们希望数据如何可视化。这是通过<code class="fe pa pb pc oo b">Chart.mark_*</code>完成的。例如，我们可以使用<code class="fe pa pb pc oo b">mark_point()</code>将数据显示为一个点。</p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="3c21" class="ob kj it oo b gy os ot l ou ov">import altair as alt<br/>import pandas as pd</span><span id="9a10" class="ob kj it oo b gy oz ot l ou ov">data = pd.DataFrame({'a': list('CCCDDDEEE'),<br/>                     'b': [2, 7, 4, 1, 2, 6, 8, 4, 7]})<br/>chart = alt.Chart(data)<br/><strong class="oo iu">alt.Chart(data).mark_point()</strong></span></pre><p id="ec69" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">通过执行上面的代码，它应该给你一个图表:</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/945a199bf2d3f018ada2c5965d8efb28.png" data-original-src="https://miro.medium.com/v2/resize:fit:172/format:webp/1*Z3mwHU3WwZpeBpsqugaquA.png"/></div></figure><p id="a786" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">我们获得单点显示的原因是渲染由数据集中每行一个点组成，所有点都绘制在彼此之上，因为我们还没有指定这些点的位置。这将通过<strong class="lc iu">编码</strong>解决。</p><h2 id="3e50" class="ob kj it bd kk oc od dn ko oe of dp ks lj og oh ku ln oi oj kw lr ok ol ky om bi translated">编码</h2><p id="255b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在 Altair 中，编码是数据到视觉属性的映射，比如轴、标记的颜色、标记的形状等等。编码方法<code class="fe pa pb pc oo b">Chart.encode()</code>定义了图表显示的各种属性，它是创建有意义的可视化的最重要的功能。<a class="ae mj" href="https://altair-viz.github.io/user_guide/encoding.html" rel="noopener ugc nofollow" target="_blank">官方用户指南</a>提供了一长串受支持的属性。以下是最基本的编码属性，了解它们应该足以让您创建基本的图表。</p><p id="ab92" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated"><strong class="lc iu">位置通道</strong></p><ul class=""><li id="5622" class="nn no it lc b ld me lg mf lj np ln nq lr nr lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">x</code>:x 轴数值</li><li id="0e0a" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">y</code>:y 轴数值</li><li id="ac25" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">row</code>:分面绘图的行</li><li id="d0c5" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">column</code>:分面绘图的列</li></ul><p id="16a1" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated"><strong class="lc iu">标记属性通道</strong></p><ul class=""><li id="8407" class="nn no it lc b ld me lg mf lj np ln nq lr nr lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">color</code>:标记的颜色</li><li id="3328" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">opacity</code>:标记的不透明度</li><li id="d7f1" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">shape</code>:标记的形状</li><li id="e4e1" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">size</code>:标记的大小</li></ul><p id="02c8" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated"><strong class="lc iu">文字频道</strong></p><ul class=""><li id="9f0b" class="nn no it lc b ld me lg mf lj np ln nq lr nr lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">text</code>:用于标记的文本</li></ul><p id="c27b" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated"><strong class="lc iu">数据类型</strong></p><ul class=""><li id="d62a" class="nn no it lc b ld me lg mf lj np ln nq lr nr lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">quantitative</code>:速记码<strong class="lc iu"> Q </strong>，连续实数值</li><li id="e1f3" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">ordinal</code>:简写代码<strong class="lc iu"> O </strong>，离散订购数量</li><li id="dc19" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">nominal</code>:简写代码<strong class="lc iu"> N </strong>，离散订购数量</li><li id="d2e3" class="nn no it lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe pa pb pc oo b">temporal</code>:速记代码<strong class="lc iu"> T </strong>，时间或日期值</li></ul><p id="938f" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">为了直观地将这些点从代码中分离出来，我们可以将各种<em class="mk">编码通道</em>，或者简称为<em class="mk">通道</em>映射到数据集中的列。例如，我们可以用<code class="fe pa pb pc oo b">x</code>通道对数据的变量<code class="fe pa pb pc oo b">col-1</code>进行<em class="mk">编码，该通道代表点的 x 轴位置。这可以通过<code class="fe pa pb pc oo b"><a class="ae mj" href="https://altair-viz.github.io/user_guide/generated/toplevel/altair.Chart.html#altair.Chart.encode" rel="noopener ugc nofollow" target="_blank"><strong class="lc iu">Chart.encode()</strong></a></code>方法直接完成:</em></p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="a2f7" class="ob kj it oo b gy os ot l ou ov">import altair as alt<br/>import pandas as pd</span><span id="6ba1" class="ob kj it oo b gy oz ot l ou ov">data = pd.DataFrame({'<strong class="oo iu">col-1</strong>': list('CCCDDDEEE'),<br/>                     '<strong class="oo iu">col-2</strong>': [2, 7, 4, 1, 2, 6, 8, 4, 7]})<br/>chart = alt.Chart(data)<br/>alt.Chart(data).mark_point()<strong class="oo iu">.encode(<br/>    x='col-1',<br/>    y='col-2'<br/>)</strong></span></pre><p id="5be6" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">这是输出</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/6813d10d139e350bdb8898c5b997c2e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*2os7mqBNck4-0bhgSrv33Q.png"/></div></figure><h1 id="7e77" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">让图表互动</h1><p id="e2c6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">除了基本的图表，Altair 的一个独特功能是用户可以与图表进行交互，包括平移、缩放和选择一系列数据等控件。</p><p id="411f" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">在主题后面，只需调用<code class="fe pa pb pc oo b">interactive()</code>模块就可以实现平移和缩放。例如:</p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="bd92" class="ob kj it oo b gy os ot l ou ov">import altair as alt<br/>import pandas as pd</span><span id="fd6c" class="ob kj it oo b gy oz ot l ou ov">data = pd.DataFrame({'col-1': list('CCCDDDEEE'),<br/>                     'col-2': [2, 7, 4, 1, 2, 6, 8, 4, 7]})<br/>chart = alt.Chart(data)<br/>alt.Chart(data).mark_point().encode(<br/>    x='col-1',<br/>    y='col-2'<br/>)<strong class="oo iu">.interactive()</strong></span></pre><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/3d6190720ab2063c674abc4f809b42ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/1*yagonOszJIYh2hZ5vHyzkA.gif"/></div></figure><p id="328c" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">Altair 还提供了用于创建交互式图像的选择 API。在<code class="fe pa pb pc oo b">selection()</code>功能中，我们可以制作一些更酷的高级功能，比如本文开头所示的 GIF 允许对选定的数据点进行分析并生成实时直方图。</p><h1 id="3368" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">逐步构建交互式图表</h1><p id="6ced" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">有了牛郎星的基础知识，我们来做一个互动图。</p><p id="5556" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">对于本教程，我们将使用来自<a class="ae mj" href="https://github.com/altair-viz/vega_datasets" rel="noopener ugc nofollow" target="_blank"> vega_datasets </a>中示例数据集中的汽车数据，</p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="9a6c" class="ob kj it oo b gy os ot l ou ov">from vega_datasets import data</span><span id="f4aa" class="ob kj it oo b gy oz ot l ou ov">cars = data.cars()</span></pre><p id="267c" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">首先，我们将使用<code class="fe pa pb pc oo b"><a class="ae mj" href="https://altair-viz.github.io/user_guide/generated/api/altair.selection_interval.html#altair.selection_interval" rel="noopener ugc nofollow" target="_blank"><strong class="lc iu">selection_interval()</strong></a></code>功能创建一个区间选择:</p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="66cf" class="ob kj it oo b gy os ot l ou ov">brush = alt.selection_interval()</span></pre><p id="e2ca" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">我们现在可以通过设置<code class="fe pa pb pc oo b">selection</code>属性将这个画笔绑定到我们的图表:</p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="1e29" class="ob kj it oo b gy os ot l ou ov">alt.Chart(cars).mark_point().encode(<br/>    x='Miles_per_Gallon:Q',<br/>    y='Horsepower:Q',<br/>    color='Origin:N'<br/>)<strong class="oo iu">.add_selection(<br/>    brush<br/>)</strong></span></pre><p id="58ff" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">上面的结果是一个图表，它允许您单击并拖动来创建一个选择区域，并在创建区域后移动该区域。这很简洁，但是这个选择实际上并没有做任何事情。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi pi"><img src="../Images/f4a42bcaebcac43ba768ac126985201d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*duIruzyu1vSsuT-Tj7GK9w.gif"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">添加选择的结果()</p></figure><p id="fcb6" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">要使用这个选项，我们需要在图表中以某种方式引用它。这里，我们将使用<code class="fe pa pb pc oo b"><a class="ae mj" href="https://altair-viz.github.io/user_guide/generated/api/altair.condition.html#altair.condition" rel="noopener ugc nofollow" target="_blank"><strong class="lc iu">condition()</strong></a></code>函数来创建一个条件颜色编码:我们将把选择中的点的颜色绑定到<code class="fe pa pb pc oo b">"Origin"</code>列，并将选择之外的点的颜色设置为<code class="fe pa pb pc oo b">"lightgray"</code>:</p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="f6e8" class="ob kj it oo b gy os ot l ou ov">alt.Chart(cars).mark_point().encode(<br/>    x='Miles_per_Gallon:Q',<br/>    y='Horsepower:Q',<br/>    <strong class="oo iu">color=alt.condition(brush, 'Origin:N', alt.value('lightgray'))</strong><br/>).add_selection(<br/>    brush<br/>)</span></pre><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi pj"><img src="../Images/996d7af6aef88dc192e5887f99d2d593.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HPVs7mcV6PVAzdywstFkmw.gif"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">条件()的结果</p></figure><p id="195c" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">接下来，我们创建一个<code class="fe pa pb pc oo b">mark_bar()</code>图表</p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="4963" class="ob kj it oo b gy os ot l ou ov">alt.Chart(cars).mark_bar().encode(<br/>    y='Origin:N',<br/>    color='Origin:N',<br/>    x='count(Origin):Q'<br/>)</span></pre><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi pk"><img src="../Images/80706398ca9adce431a0c00197760359.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pzNyieid5PgNeTRMNz-UIA.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">牛郎星条形图</p></figure><p id="994b" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">为了将条形图与之前的散点图关联起来，我们需要使用<code class="fe pa pb pc oo b">transform_filter()</code>并传递同一个<code class="fe pa pb pc oo b">brush</code>。此外，对于组合多选图表，我们还需要为它们分别创建变量，并使用组合多选<code class="fe pa pb pc oo b">&amp;</code>。</p><pre class="lx ly lz ma gt on oo op oq aw or bi"><span id="80a8" class="ob kj it oo b gy os ot l ou ov"><strong class="oo iu">points = </strong>alt.Chart(cars).mark_point().encode(<br/>    x='Horsepower:Q',<br/>    y='Miles_per_Gallon:Q',<br/>    color=alt.condition(brush, 'Origin:N', alt.value('lightgray'))<br/>).add_selection(<br/>    brush<br/>)</span><span id="9376" class="ob kj it oo b gy oz ot l ou ov"><strong class="oo iu">bars = </strong>alt.Chart(cars).mark_bar().encode(<br/>    y='Origin:N',<br/>    color='Origin:N',<br/>    x='count(Origin):Q'<br/>).<strong class="oo iu">transform_filter(<br/>    brush<br/>)</strong></span><span id="48c0" class="ob kj it oo b gy oz ot l ou ov"><strong class="oo iu">points &amp; bars</strong></span></pre><p id="7e85" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">而且，就是这样。这是输出</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/31cf60a58392dff3b8659e3388c961d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/1*UL8ZWQvfhI6rvGhadaSuZw.gif"/></div></figure><p id="215d" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">这是完整的代码:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="pl pm l"/></div></figure><h1 id="fff3" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">学习建议</h1><p id="9633" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">本文是一个快速教程，主要是给大家展示这个优秀的数据可视化库。学习没有捷径。你必须看文档，源代码，研究相关的例子，并在实践中应用它们。</p><h1 id="e617" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">尽情享受吧！</h1><p id="8b01" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">仅此而已。感谢阅读。</p><p id="d4f2" class="pw-post-body-paragraph la lb it lc b ld me ju lf lg mf jx li lj mg ll lm ln mh lp lq lr mi lt lu lv im bi translated">关于 Altair 交互式数据可视化的更多内容，您可以看看</p><div class="mu mv gp gr mw mx"><a rel="noopener follow" target="_blank" href="/interactive-data-visualization-for-exploring-coronavirus-spreads-f33cabc64043"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">探索冠状病毒传播的交互式数据可视化</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">使用 Altair 创建不到 30 行代码的交互式复合图表</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">towardsdatascience.com</p></div></div><div class="ng l"><div class="pn l ni nj nk ng nl mc mx"/></div></div></a></div></div></div>    
</body>
</html>