<html>
<head>
<title>Creating a Web Application to Analyse Dengue Cases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个分析登革热病例的网络应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-a-web-application-to-analyse-dengue-cases-1be4a708a533?source=collection_archive---------33-----------------------#2020-08-14">https://towardsdatascience.com/creating-a-web-application-to-analyse-dengue-cases-1be4a708a533?source=collection_archive---------33-----------------------#2020-08-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c782" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 Tweepy、TextBlob、NewsAPI 和 Geopandas 分析登革热</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/99c79b45c7971b4fbab9eb86c2b57ecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gmyKrbmuak71h4ZY"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">卢克·切瑟在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="2247" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="d631" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><em class="mk">信息就是力量。指尖上的信息是超能力。</em></p><p id="4620" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">在此期间，我偶然在 Reddit、Twitter 和脸书上看到了许多关于新冠肺炎的图像。它们中的许多都非常鼓舞人心，能够在如此短的时间内吸收大量信息是如此令人愉快。</p><p id="b642" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">我也想在新冠肺炎上建一个仪表板，但我觉得已经够多了。因此，我决定研究另一个问题，登革热，这也是一个紧迫的问题。data.gov.sg 的数据很容易获得，但是有三个主要问题:</p><ol class=""><li id="9484" class="mq mr iq lq b lr ml lu mm lx ms mb mt mf mu mj mv mw mx my bi translated">一些数据没有任何可视化</li><li id="4f9e" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">数据到处都是，需要额外的工作来过滤结果</li><li id="063c" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">没有足够的数据来讲述一个故事</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/5d293b1e2a6d4735deaa2adaf8e9dcb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/0*7H3AfvBJ6KBuBvQV.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">学分:<a class="ae kv" href="https://ggscore.com/en/dota-2/team/hmmm" rel="noopener ugc nofollow" target="_blank"> ggscore </a></p></figure><p id="e257" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这促使我自己制作了一个仪表板。这个项目有 3 个主要部分:</p><ol class=""><li id="0a4f" class="mq mr iq lq b lr ml lu mm lx ms mb mt mf mu mj mv mw mx my bi translated"><strong class="lq ir">分析:</strong>我可视化了登革热病例的数量，并创建了一个登革热热区和繁殖点的叠加地图。</li><li id="caaa" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated"><strong class="lq ir">新闻检索:</strong>该选项卡能够从多个来源检索主题为“登革热”的新闻。</li><li id="b2fd" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated"><strong class="lq ir"> Twitter 分析:</strong>该功能构成了该项目的主体。简而言之，我实时检索 twitter 数据，分析他们的情绪，并以图表形式呈现出来。</li></ol><p id="6614" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这个项目的目的是展示构建这样一个强大的应用程序是多么简单。不一定是登革热。可以是任何话题。对于这个项目来说，重要的不是内容，而是<strong class="lq ir">技能</strong>。这更多的是概念验证，而不是最终产品。我将带你走过项目的所有 3 个不同部分，同时提供代码片段。希望您能够在自己有意义的项目中复制它。请务必滚动到本文的底部，找到完整代码的链接。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h1 id="6332" class="kw kx iq bd ky kz nm lb lc ld nn lf lg jw no jx li jz np ka lk kc nq kd lm ln bi translated">概念</h1><p id="4c59" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在我开始之前，我想谈谈这个项目是如何建立的。</p><p id="3dd2" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这个项目是用<a class="ae kv" href="https://plotly.com/dash/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> Dash </strong> </a>构建的，这是一个构建数据科学/ML 项目的 Python 框架。随着<a class="ae kv" href="https://dash-bootstrap-components.opensource.faculty.ai/docs/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> dash 引导组件</strong></a><strong class="lq ir">【DBC】</strong><a class="ae kv" href="https://dash.plotly.com/dash-core-components" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir">dash 核心组件</strong></a><strong class="lq ir">【DCC】</strong>，你将需要<strong class="lq ir">最少的</strong> HTML/CSS 技能来构建你的 web 应用。</p><p id="9e78" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这三个特性中的每一个都采用了不同的技术(将进一步解释)。然后使用<a class="ae kv" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> Heroku </strong> </a>部署所有这些功能，这是一个云平台即服务(PaaS)，允许您轻松地将应用程序部署到云。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h1 id="5f04" class="kw kx iq bd ky kz nm lb lc ld nn lf lg jw no jx li jz np ka lk kc nq kd lm ln bi translated">第 0 部分:仪表板</h1><p id="aa2e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Dash 应用程序主要由两部分组成。</p><h2 id="5fdf" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">第 1 部分:应用程序布局</h2><p id="1a38" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">应用程序布局是应用程序的<strong class="lq ir">前端</strong>部分。然而，多亏了 DBC 和 DCC，你不需要复杂的 HTML 代码来创建你的应用程序。例如，我的整个应用程序是用以下代码创建的:</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="c7d6" class="nr kx iq oe b gy oi oj l ok ol"># Code partially hidden for readability<br/># Layout of entire app<br/>app.layout = html.Div(<br/>    [<br/>        navbar,<br/>        dbc.Tabs(<br/>            [<br/>                dbc.Tab(analysisTab, id="label_tab1", label="Visuals"),<br/>                dbc.Tab(newsTab, ...),<br/>                dbc.Tab(socialMediaTab, ...),<br/>                dbc.Tab(infoTab, ...),<br/>            ],<br/>            style={"font-size": 20, "background-color": "#b9d9eb"},<br/>        ),<br/>    ]<br/>)</span></pre><p id="8dbc" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">当然，你必须指定什么是 analysisTab，newsTab 等。你可以看到<strong class="lq ir">如何用 DBC 和 DCC 抽象</strong>你的应用程序。DBC 和 DCC 都提供了按钮、选项卡、表单、导航栏以及许多其他基本组件。</p><h2 id="024a" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">第 2 部分:应用程序回调(可选)</h2><p id="e4be" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">应用程序回调可以被认为是应用程序的后端部分。如果你观察上面的代码，你会注意到我给我的<code class="fe om on oo oe b">analysisTab</code>分配了一个<code class="fe om on oo oe b">id="label_tab1"</code>，这有助于我们识别哪个回调用于那个特定的组件。</p><p id="18dd" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">回调的示例如下所示:</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="25d6" class="nr kx iq oe b gy oi oj l ok ol"><a class="ae kv" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback(<br/>    Output("sa-graph", "children"), [Input("interval-component-slow", "n_intervals")]<br/>)<br/>def sa_line(n):<br/>    children = [...]<br/>    return children</span></pre><p id="0c83" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这样做的是，它将接受一个带有指定参数<code class="fe om on oo oe b">n_intervals</code>的输入组件<code class="fe om on oo oe b">interval-component-slow</code>，并将由方法<code class="fe om on oo oe b">sa_line()</code>创建的结果<code class="fe om on oo oe b">children</code>输出到输出组件<code class="fe om on oo oe b">sa-graph</code>。如果您想让您的应用程序具有交互性，这一点尤其有用。例如，你可以允许你的可视化根据用户点击的单选按钮而改变。</p><p id="e8b7" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">但是，如果您希望应用程序是静态的，并不总是需要回调。你会意识到我的前两个标签页没有使用回调，因为我不需要用户的任何输入。我只需要向他们发送信息。第三个标签(twitter 分析)是一个特例。我不得不使用回调，因为我希望我的分析每 30 秒刷新一次。稍后详细介绍！</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/2f25a5a3da50ed0652317ae0930b8310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5kInjn1DutANsGIyk_jkYA.png"/></div></div></figure><h1 id="4407" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">第一部分:视觉化</h1><p id="ced4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://github.com/bensjx/Dengue-dashboard/blob/master/analysis.py" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir">完整代码在此。</strong>T3】</a></p><p id="78c8" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">本节的主要学习点是<a class="ae kv" href="https://geopandas.org/" rel="noopener ugc nofollow" target="_blank">地垫</a>和<a class="ae kv" href="https://python-visualization.github.io/folium/" rel="noopener ugc nofollow" target="_blank">叶子</a>的用法。</p><h2 id="8a94" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">地质公园</h2><p id="4309" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">从<a class="ae kv" href="https://data.gov.sg/dataset/dengue-clusters" rel="noopener ugc nofollow" target="_blank">data.gov.sg</a>下载的数据以<a class="ae kv" href="https://geojson.org/" rel="noopener ugc nofollow" target="_blank"> GeoJSON </a>格式出现。GeoJSON 文件允许您将地理数据编码到对象中。它具有非常结构化的格式，包括位置的类型、几何图形和属性。由于登革热集群涉及一块土地，我们的位置被编码在一个多边形对象中，这是一个经度和纬度的数组。</p><p id="8af7" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">读取 GeoJSON 文件很容易。我们简单地使用 Geopandas:</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="0e05" class="nr kx iq oe b gy oi oj l ok ol">central_data = gpd.read_file("data/dengue-cases-central-geojson.geojson")</span></pre><p id="c2a8" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">一旦数据被加载，操作应该很容易，前提是你精通数据框架。</p><h2 id="035d" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">薄层</h2><p id="0950" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">follow 允许我们将 GeoJSON 数据可视化在一个活页地图(一个用于交互式地图的 JavaScript 库)中。</p><p id="620e" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">首先，我们创建一张地图并放大到我们想要的地点(在我的例子中，我选择了新加坡的经度和纬度):</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="a66e" class="nr kx iq oe b gy oi oj l ok ol">kw = {"location": [1.3521, 103.8198], "zoom_start": 12}<br/>m = folium.Map(**kw)</span></pre><p id="c756" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">接下来，我在地图上添加两个图层(一个用于集群，另一个用于繁殖区):</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="cd9c" class="nr kx iq oe b gy oi oj l ok ol">folium.GeoJson(&lt;FIRST LAYER DATA&gt;, ...).add_to(m)<br/>folium.GeoJson(&lt;SECOND LAYER DATA&gt;, ...).add_to(m)</span></pre><p id="5033" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">最后，由于 Dash 不允许我直接显示叶子对象，所以我将生成的地图导出到一个<strong class="lq ir"> HTML 文件</strong>中，并使用一个<strong class="lq ir"> IFrame </strong>来显示它:</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="241c" class="nr kx iq oe b gy oi oj l ok ol">m.save("dengue-cluster.html")</span><span id="ec91" class="nr kx iq oe b gy oq oj l ok ol">html.Iframe(id="dengue-map", srcDoc=open("dengue-cluster.html", "r").read(), ...)</span></pre></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/42221f9d36db476ce937ee8bb18c37c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lyEaGLaBAzvvXCpvJiZ8mQ.png"/></div></div></figure><h1 id="acbf" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">第二部分:新闻剪报</h1><p id="eb0a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://github.com/bensjx/Dengue-dashboard/blob/master/news.py" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir">完整代码在此。</strong> </a></p><p id="e159" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">本节的主要学习点是<a class="ae kv" href="https://newsapi.org/" rel="noopener ugc nofollow" target="_blank"> NewsAPI </a>的用法。NewsAPI 允许我们使用他们的 API 从多个来源搜索新闻文章。在您可以开始使用它之前，您需要注册一个帐户，以便获得您自己唯一的 API 密钥。</p><p id="b7f6" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">请注意，作为一个免费会员，你将受到每天新闻检索数量的限制。</p><h2 id="a85b" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">存储密钥(本地系统)</h2><p id="79f0" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">钥匙很重要！就像你不会和你的朋友分享你的房子钥匙一样，<strong class="lq ir">你也不会想要分享你的 API 钥匙</strong>。当您在本地系统上开发时，我强烈建议您将所有的键保存在一个<code class="fe om on oo oe b">keys.py</code>文件中，并将该文件添加到<code class="fe om on oo oe b">.gitignore</code>中，这样它就不会被在线推送。</p><h2 id="4567" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">存储密钥(Heroku)</h2><p id="d80e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">由于你没有将<code class="fe om on oo oe b">keys.py</code>推送到 GitHub，Heroku 无法访问它。相反，Heroku 有自己的<strong class="lq ir">配置变量</strong>。您可以通过 CLI 或它们的 GUI 将您的密钥添加到 Heroku。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/fe63fdb64f4dd3feb327dbcfb97e525a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bpkwk8n6jz8p2ZMNBsuLsg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Heroku 配置变量</p></figure><h2 id="872e" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">代码！</h2><p id="a8d3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">出于部署的目的，我们让代码根据我们是在本地系统上还是在 Heroku 上来检索密钥:</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="d4df" class="nr kx iq oe b gy oi oj l ok ol">try:<br/>    from keys import newsapikey  # retrieve from local system<br/>    newsapi = NewsApiClient(api_key=newsapikey)<br/>except:<br/>    newsapikey = os.environ["newapi_key"]  # retrieve from Heroku<br/>    newsapi = NewsApiClient(api_key=newsapikey)</span></pre><p id="6c06" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">接下来，我们终于可以检索我们的新闻文章了:</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="5c60" class="nr kx iq oe b gy oi oj l ok ol">all_articles = newsapi.get_everything(<br/>        q="dengue singapore",<br/>        from_param=date_n_days_ago,<br/>        to=date_now,<br/>        language="en",<br/>        sort_by="publishedAt",<br/>        page_size=100,<br/>    )</span></pre><p id="8478" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">有三个主要功能<code class="fe om on oo oe b">newsapi.get_everything()</code>、<code class="fe om on oo oe b">newsapi.get_top_headlines()</code>和<code class="fe om on oo oe b">newsapi.get_sources()</code>。使用任何你认为合适的！然后我们可以检索我们的内容。检索所有文章标题的示例如下所示:</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="f9b1" class="nr kx iq oe b gy oi oj l ok ol">all_articles_title = [<br/>        str(all_articles["articles"][i]["title"])<br/>        for i in range(len(all_articles["articles"]))<br/>    ]</span></pre><p id="aae1" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">现在您已经有了数据，您可以使用 DBC 添加它们。在这个项目中，我使用了<a class="ae kv" href="https://dash-bootstrap-components.opensource.faculty.ai/docs/components/card/" rel="noopener ugc nofollow" target="_blank">卡片</a>、<a class="ae kv" href="https://dash-bootstrap-components.opensource.faculty.ai/docs/components/card/" rel="noopener ugc nofollow" target="_blank">卡片主体</a>和<a class="ae kv" href="https://dash-bootstrap-components.opensource.faculty.ai/docs/components/card/" rel="noopener ugc nofollow" target="_blank">卡片页脚</a>。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/a9f31d88064b63357ef81b81e0d414c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KgxBH_ZZpoGEzZmCSEge5A.png"/></div></div></figure><h1 id="fb90" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">第 3 部分:实时 Twitter 情感分析</h1><p id="852b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这构成了项目的主体。我使用了<a class="ae kv" href="https://www.tweepy.org/" rel="noopener ugc nofollow" target="_blank"> Tweepy </a>，这是一个 Python 库，允许我们访问 Twitter API 来传输推文。我的目标是检索所有与“登革热”相关的推文，预处理文本，分析情感，并可视化结果。从 Twitter 上不断挖掘推文，我的应用程序将每 30 秒刷新一次以显示新数据。</p><h2 id="00b3" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">工作流程</h2><p id="4831" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这个阶段，我可能应该向您介绍一下工作流程。</p><ol class=""><li id="afb3" class="mq mr iq lq b lr ml lu mm lx ms mb mt mf mu mj mv mw mx my bi translated">推文被从推特中抽出<strong class="lq ir"/></li><li id="e44e" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">推文正在被<strong class="lq ir">清理</strong>(翻译成英文，表情符号被移除，链接被移除)，推文的情感被<a class="ae kv" href="https://textblob.readthedocs.io/en/dev/" rel="noopener ugc nofollow" target="_blank"> TextBlob </a>分析</li><li id="a3f1" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">建立了与数据库的连接，每次<strong class="lq ir">有新的推文进入</strong>时，处理过的推文和情感就会被推送到数据库。对于本地系统，我使用 MySQL，对于 Heroku，我使用他们的 PostgreSQL 数据库。<strong class="lq ir">该脚本保持运行</strong>。</li><li id="94d0" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">同时，我检索超过一天的推文，并从数据库中删除它们。这将确保我们的数据库不会耗尽空间。</li><li id="d9b0" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">随着我的应用程序在<strong class="lq ir">并行</strong>中运行，它将每隔<strong class="lq ir"> 30 秒</strong>从数据库中检索<strong class="lq ir">一小时的数据</strong>并显示它们。</li></ol><h2 id="e1aa" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">钥匙钥匙钥匙</h2><p id="bfc9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">就像 NewsAPI 一样，Tweepy 也要求我们生成 API 密钥。前往<a class="ae kv" href="https://developer.twitter.com/" rel="noopener ugc nofollow" target="_blank"> Twitter 开发者</a>获取您的！</p><h2 id="d08d" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">Twitter 抓取</h2><p id="146d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://github.com/bensjx/twitter-scrap-dengue/blob/master/mylistener.py" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir">完整代码在此。</strong> </a>注意注释代码是针对 MySQL 的，未注释代码是针对 PostgreSQL 的。</p><p id="de14" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">步骤 1:如果数据库和表不存在，通过为我们创建一个数据库来初始化数据库。</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="152f" class="nr kx iq oe b gy oi oj l ok ol">DATABASE_URL = os.environ["DATABASE_URL"]<br/>conn = psycopg2.connect(DATABASE_URL, sslmode="require")<br/>cur = conn.cursor()</span><span id="2daa" class="nr kx iq oe b gy oq oj l ok ol">cur.execute(<br/>    """<br/>        SELECT COUNT(*)<br/>        FROM information_schema.tables<br/>        WHERE table_name = '{0}'<br/>        """.format(<br/>        parameters.TABLE_NAME<br/>    )<br/>)<br/>if cur.fetchone()[0] == 0:<br/>    cur.execute(<br/>        "CREATE TABLE {} ({});".format(<br/>            parameters.TABLE_NAME, parameters.TABLE_ATTRIBUTES<br/>        )<br/>    )<br/>    conn.commit()<br/>cur.close()</span></pre><p id="fc0b" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">步骤 2:初始化 Twitter API 并开始流媒体播放</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="82aa" class="nr kx iq oe b gy oi oj l ok ol">myStreamListener = MyStreamListener()<br/>myStream = tweepy.Stream(auth=api.auth, listener=myStreamListener)<br/>myStream.filter(track=parameters.TRACK_WORDS)</span></pre><p id="d441" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">第三步:处理收到的每条推文。为了实现这一点，你必须<strong class="lq ir">超越</strong> tweepy。StreamListener，它是负责从 Twitter 向您推送新推文的类。</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="5bad" class="nr kx iq oe b gy oi oj l ok ol"># Override tweepy.StreamListener to add logic to on_status<br/>class MyStreamListener(tweepy.StreamListener):<br/>    def on_status(self, status):<br/>        # Start modifying<br/>        id_str = status.id_str<br/>        created_at = status.created_at<br/>        clean_text, text = preprocess(status.text)<br/>        sentiment = TextBlob(text).sentiment<br/>        polarity = sentiment.polarity<br/>        ...<br/>        # SQL statement for pushing tweets to DB<br/>        ...<br/>        # SQL statement for deleting and cleaning DB<br/>        ...</span></pre><h2 id="fe65" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">让它活起来</h2><p id="eda6" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让你的应用程序每 x 秒刷新一次的诀窍是使用<code class="fe om on oo oe b">dcc.Interval</code>。通过在应用程序中添加一个时间间隔作为回调的输入，可以告诉应用程序每隔 x 秒重新生成一次组件。</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="ae25" class="nr kx iq oe b gy oi oj l ok ol">dcc.Interval(<br/>            id="interval-component-slow",<br/>            interval=30000,  # in milliseconds<br/>            n_intervals=0,<br/>        ),</span></pre><h2 id="64fe" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">情绪的折线图+饼图</h2><p id="6a65" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://github.com/bensjx/Dengue-dashboard/blob/master/app.py" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir">此处为观想完整代码。</strong> </a></p><p id="4dfa" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">首先，我们必须检索刮出的数据:</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="3193" class="nr kx iq oe b gy oi oj l ok ol"># Loading data from Heroku PostgreSQL<br/>    DATABASE_URL = os.environ["DATABASE_URL"]<br/>    db_connection = psycopg2.connect(DATABASE_URL, sslmode="require")</span><span id="f603" class="nr kx iq oe b gy oq oj l ok ol"># Load last 1 hour data from MySQL<br/>    ...</span><span id="13a6" class="nr kx iq oe b gy oq oj l ok ol">query = "SELECT ... FROM {} WHERE created_at &gt;= '{}' ".format(<br/>        "dengue", timenow<br/>    )</span><span id="af91" class="nr kx iq oe b gy oq oj l ok ol">df = pd.read_sql(query, con=db_connection)</span><span id="a398" class="nr kx iq oe b gy oq oj l ok ol"># Convert UTC into SGT<br/>    ...</span></pre><p id="8e48" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">接下来，对数据进行清理和转换，以绘制时间序列:</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="fca1" class="nr kx iq oe b gy oi oj l ok ol"># Clean and transform data to enable time series<br/>    # Bin into 5 minutes<br/>    result = (<br/>        df.groupby([pd.Grouper(key="created_at", freq="5min"), "polarity"])<br/>        .count()<br/>        .reset_index()<br/>    )<br/>    ...</span></pre><p id="514f" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">最后，我们使用<a class="ae kv" href="https://plotly.com/python/graph-objects/" rel="noopener ugc nofollow" target="_blank"> Plotly Graph 对象</a>将结果可视化。左上角的折线图是用<code class="fe om on oo oe b">go.Scatter</code>创建的，而右上角的饼图是用<code class="fe om on oo oe b">go.Pie</code>创建的。这就是创建视觉效果的简单之处！</p><h2 id="7f96" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">检索实际的推文</h2><p id="af71" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">推文用<a class="ae kv" href="https://dash.plotly.com/datatable" rel="noopener ugc nofollow" target="_blank">仪表板数据表</a>显示。</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="09c0" class="nr kx iq oe b gy oi oj l ok ol">dash_table.DataTable(id='table', columns=[{"name": i, "id": i} for i in df.columns], data=df.to_dict('records'))</span></pre><h2 id="7cab" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">真实推文的文字云</h2><p id="3131" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">目前还不太支持单词云。传统的方法是创建一个图像，并把它附加到我们的可视化中。我使用的非常规方法是在 X 和 Y 轴上绘制单词，而不是显示坐标，而是显示文本。因此，这个词云是使用<code class="fe om on oo oe b">go.Scatter</code>创建的。</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="2d73" class="nr kx iq oe b gy oi oj l ok ol">go.Scatter(x=wc_data.x,<br/>           y=wc_data.y,<br/>           mode="text",<br/>           text=wc_data.words,<br/>           ...)</span></pre></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/16d113ef2c4d1ae16cadfd7e8c18704b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uIbbxNLJ95nPVT932lNHBQ.png"/></div></div></figure><h1 id="1131" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">第 4 部分:部署到 Heroku</h1><p id="2318" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">既然您的应用程序在本地系统中运行良好，那么是时候将它部署到 Heroku 了。我<strong class="lq ir">强烈推荐</strong>你看看这个<a class="ae kv" href="https://www.youtube.com/watch?reload=9&amp;v=j3VvVaNnDH4" rel="noopener ugc nofollow" target="_blank"> 15 分钟教程</a>如何做到这一点。否则，请参考下面的摘要:</p><ol class=""><li id="5d49" class="mq mr iq lq b lr ml lu mm lx ms mb mt mf mu mj mv mw mx my bi translated">创建一个 Heroku 帐户并下载 Heroku CLI</li><li id="7ffd" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">确保项目的所有依赖项都已下载。此外，运行<code class="fe om on oo oe b">pip install gunicorn</code></li><li id="67d8" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">创建一个<a class="ae kv" href="https://github.com/bensjx/Dengue-dashboard/blob/master/Procfile" rel="noopener ugc nofollow" target="_blank"> Procfile </a>，它将告诉 Heroku 运行什么</li><li id="c898" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">用<code class="fe om on oo oe b">pip freeze &gt; requirements.txt</code>创建 requirements.txt。这对于 Heroku 了解你正在使用的包是很重要的，这样他们也可以下载它。</li><li id="ac22" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">使用部署您的应用程序</li></ol><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="d8e3" class="nr kx iq oe b gy oi oj l ok ol">heroku login<br/>heroku create "&lt;YOUR APP NAME&gt;"<br/>git add .<br/>git commit -m "&lt;ANY MESSAGE&gt;"<br/>git push heroku master<br/>heroku ps:scale web=1</span></pre><p id="ca46" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">注意:为了让你的 tweet scrapper 和应用程序同时运行，你需要<strong class="lq ir"> 2 个不同的应用程序</strong>。否则，您可以支付额外的 dynos，这是 Heroku 容器。您的 Procfile 将会不同。要使用<strong class="lq ir">相同的数据库</strong>，将您的 scrapper 的 DATABASE_URL(配置变量)设置为与您的应用程序的 DATABASE_URL 相同。</p><p id="9a0d" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">此外，请注意，加载应用程序需要相当长的时间。这是因为我正在使用免费的 dynos。如果应用程序在设定的时间内没有被访问，免费的 dynos 将被置于睡眠状态。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h1 id="d763" class="kw kx iq bd ky kz nm lb lc ld nn lf lg jw no jx li jz np ka lk kc nq kd lm ln bi translated">结论</h1><p id="a7ab" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这个应用程序简单、轻量、功能强大。由于有限的预算、时间和网页设计技巧，这绝不是一个完美的应用程序。我还需要花时间优化算法，这将大大提高应用程序的加载速度。</p><p id="9cb9" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">通过这篇文章，希望你对 Dash，Tweepy，NewsAPI，Geopandas，和 leav 有了更深入的了解。我强烈要求你为不同的上下文创建类似的应用程序。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h2 id="7246" class="nr kx iq bd ky ns nt dn lc nu nv dp lg lx nw nx li mb ny nz lk mf oa ob lm oc bi translated">链接:</h2><ol class=""><li id="c8e6" class="mq mr iq lq b lr ls lu lv lx ov mb ow mf ox mj mv mw mx my bi translated"><a class="ae kv" href="https://dengue-db.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://dengue-db.herokuapp.com/</a></li><li id="310a" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated"><a class="ae kv" href="https://github.com/bensjx/Dengue-dashboard" rel="noopener ugc nofollow" target="_blank">https://github.com/bensjx/Dengue-dashboard</a></li><li id="c6fd" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated"><a class="ae kv" href="https://github.com/bensjx/twitter-scrap-dengue" rel="noopener ugc nofollow" target="_blank">https://github.com/bensjx/twitter-scrap-dengue</a></li></ol></div></div>    
</body>
</html>