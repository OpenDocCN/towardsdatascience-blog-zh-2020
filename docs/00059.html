<html>
<head>
<title>Create a model with Azure Custom Vision and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure自定义视觉和Python创建模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-a-model-with-azure-custom-vision-and-python-7bc5caed82c4?source=collection_archive---------30-----------------------#2020-01-02">https://towardsdatascience.com/create-a-model-with-azure-custom-vision-and-python-7bc5caed82c4?source=collection_archive---------30-----------------------#2020-01-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2ae8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在这篇文章中，我想和你分享如何使用<a class="ae ki" href="https://docs.microsoft.com/en-us/azure/cognitive-services/custom-vision-service/?WT.mc_id=AI4DEV01-blog-heboelma" rel="noopener ugc nofollow" target="_blank"> Azure Custom Vision </a>和<a class="ae ki" href="https://docs.microsoft.com/en-us/python/api/overview/azure/cognitiveservices/customvision?view=azure-python&amp;WT.mc_id=AI4DEV01-blog-heboelma" rel="noopener ugc nofollow" target="_blank"> Python SDK </a>创建一个分类模型。</h2></div><h1 id="b484" class="kj kk it bd kl km kn ko kp kq kr ks kt jz ku ka kv kc kw kd kx kf ky kg kz la bi translated">为什么是Python而不是可视化界面？</h1><p id="886a" class="pw-post-body-paragraph lb lc it ld b le lf ju lg lh li jx lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">答案很简单，如果你用代码构建训练过程，你可以在Github上对它进行版本化。让你的代码版本化意味着你可以回读你所做的，在一个团队中工作，如果你需要的话再运行一次。</p><p id="422f" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">让我们深入研究代码！在我们开始之前，我假设你已经安装了<a class="ae ki" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python 3.6 </a>。</p><h1 id="cd5a" class="kj kk it bd kl km kn ko kp kq kr ks kt jz ku ka kv kc kw kd kx kf ky kg kz la bi translated">在Azure中创建资源</h1><p id="2f8c" class="pw-post-body-paragraph lb lc it ld b le lf ju lg lh li jx lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">您需要做的第一件事是创建一个Azure自定义视觉服务。如果你没有Azure套餐，你可以在第一个月获得200美元的点数。</p><p id="7e60" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">您可以通过门户轻松创建Azure自定义Vision端点，但您也可以为此使用<a class="ae ki" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?WT.mc_id=AI4DEV01-blog-heboelma" rel="noopener ugc nofollow" target="_blank"> Azure CLI </a>。如果你没有安装Azure cli，你可以使用pip来安装。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="d2e5" class="ml kk it mh b gy mm mn l mo mp">pip install azure-cli</span></pre><p id="9788" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">第一步是登录到您的Azure订阅，选择正确的订阅并为自定义Vision端点创建资源组。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="1066" class="ml kk it mh b gy mm mn l mo mp">az login az account set -s &lt;SUBSCRIPTION_ID&gt; az group create --name CustomVision_Demo-RG --location westeurope</span></pre><p id="867e" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">自定义视觉服务有两种类型的端点。一个用于训练模型，另一个用于针对模型运行预测。</p><p id="ca9f" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">让我们创建两个端点。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="8141" class="ml kk it mh b gy mm mn l mo mp">az cognitiveservices account create --name CustomVisionDemo-Prediction --resource-group CustomVision_Demo-RG --kind CustomVision.Prediction --sku S0 --location westeurope –yes </span><span id="4ec5" class="ml kk it mh b gy mq mn l mo mp">az cognitiveservices account create --name CustomVisionDemo-Training --resource-group CustomVision_Demo-RG --kind CustomVision.Training --sku S0 --location westeurope –yes</span></pre><p id="478c" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">现在我们已经创建了端点，我们可以开始训练模型了。</p><h1 id="bfab" class="kj kk it bd kl km kn ko kp kq kr ks kt jz ku ka kv kc kw kd kx kf ky kg kz la bi translated">一切都从一个问题开始</h1><figure class="mc md me mf gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mr"><img src="../Images/e45dca9ee63f0dfa7d91b6be6965f735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kDUfaYmp3EqbyoR1yRyCVg.jpeg"/></div></div></figure><blockquote class="mz"><p id="4763" class="na nb it bd nc nd ne nf ng nh ni lw dk translated">每一次机器学习之旅都是从一个你希望得到答案的问题开始的。在这个例子中，你要回答这个问题:它是一个荷马还是一个玛吉·乐高玩具？</p></blockquote><p id="4bf9" class="pw-post-body-paragraph lb lc it ld b le nj ju lg lh nk jx lj lk nl lm ln lo nm lq lr ls nn lu lv lw im bi translated">既然我们知道了要问模型什么，我们可以继续下一个需求；那就是数据。我们的模型将是一个分类模型，这意味着模型将查看图片，并根据不同的类别对图片进行评分。因此，输出将是我70%确信这是荷马，1%确信这是玛吉。通过选择得分最高的班级，并为置信度设置一个最低阈值，我们就知道图片上是什么了。</p><p id="27ca" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">我已经为你创建了一个数据集，其中有50张荷马·辛普森乐高玩具的图片和50张玛吉·辛普森乐高玩具的图片。我拍摄这些照片时考虑了一些事情，使用了很多不同的背景，从不同的角度拍摄了这些照片。我确保照片中唯一的物体是荷马或玛吉，并且照片的质量在某种程度上是一致的。</p><p id="c332" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><a class="ae ki" href="https://www.henkboelman.com/media/45lkxosc/ai4dev01-dataset.zip" rel="noopener ugc nofollow" target="_blank"> <strong class="ld iu">在这里下载数据集</strong> </a></p><h1 id="e58f" class="kj kk it bd kl km kn ko kp kq kr ks kt jz ku ka kv kc kw kd kx kf ky kg kz la bi translated">训练模型</h1><p id="3974" class="pw-post-body-paragraph lb lc it ld b le lf ju lg lh li jx lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">对于培训，我们将使用<a class="ae ki" href="https://docs.microsoft.com/en-us/python/api/overview/azure/cognitiveservices/customvision?view=azure-python&amp;WT.mc_id=AI4DEV01-blog-heboelma" rel="noopener ugc nofollow" target="_blank">定制视觉服务Python SDK </a>，您可以使用pip安装这个包。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="e49e" class="ml kk it mh b gy mm mn l mo mp">pip install azure-cognitiveservices-vision-customvision</span></pre><p id="5399" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">创建一个名为“train.py”的新Python文件，并开始添加代码。</p><p id="38f6" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">从导入所需的包开始。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="8f9a" class="ml kk it mh b gy mm mn l mo mp">from azure.cognitiveservices.vision.customvision.training import CustomVisionTrainingClient <br/>from azure.cognitiveservices.vision.customvision.training.models import ImageFileCreateEntry</span></pre><p id="3c75" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">接下来，为自定义视觉端点、自定义视觉训练密钥和存储训练图像的位置创建变量。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="4f7e" class="ml kk it mh b gy mm mn l mo mp">cv_endpoint = "https://westeurope.api.cognitive.microsoft.com" training_key = "&lt;INSERT TRAINING KEY&gt;" <br/>training_images = "LegoSimpsons/TrainingImages"</span></pre><p id="2f40" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">从培训开始，我们需要创建一个培训客户端。该方法将端点和训练密钥作为输入。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="7d7b" class="ml kk it mh b gy mm mn l mo mp">trainer = CustomVisionTrainingClient(training_key, endpoint= cv_endpoint)</span></pre><p id="2e21" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">现在您已经准备好创建您的第一个项目了。该项目以名称和域作为输入，名称可以是任何东西。领域是一个不同的故事。你可以要求列出所有可能的领域，并选择最接近你要完成的领域。例如，如果你试图对食物进行分类，你可以选择“食物”或“地标”作为地标。使用下面的代码显示所有域。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="2c95" class="ml kk it mh b gy mm mn l mo mp">for domain in trainer.get_domains():   <br/>   print(domain.id, "\t", domain.name)</span></pre><p id="9467" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">您可能会注意到，一些域旁边有单词“Compact”。如果是这种情况，这意味着Azure Custom Vision服务将创建一个较小的模型，您可以导出该模型并在您的手机或桌面上本地运行。</p><p id="a62f" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">让我们创建一个域设置为“General Compact”的新项目。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="8ace" class="ml kk it mh b gy mm mn l mo mp">project = trainer.create_project("Lego - Simpsons - v1","0732100f-1a38-4e49-a514-c9b44c697ab5")</span></pre><p id="2d9b" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">接下来你需要创建标签，这些标签和上面提到的类是一样的。当您创建了一些标签后，我们可以用它们来标记图像，并将图像上传到Azure Custom Vision服务。</p><p id="06d2" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">我们的图像在文件夹中按标签/类别分类。玛吉的所有照片都在名为“玛吉”的文件夹中，荷马的所有照片都在名为“荷马”的文件夹中。</p><p id="800c" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">在下面的代码中，我们执行以下步骤:</p><ul class=""><li id="0546" class="no np it ld b le lx lh ly lk nq lo nr ls ns lw nt nu nv nw bi translated">我们打开包含训练图像文件夹的目录。</li><li id="7141" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">遍历在该文件夹中找到的所有目录</li><li id="ae95" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">用文件夹名称创建一个新标签</li><li id="8dfe" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">打开包含图像的文件夹</li><li id="7698" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">为该文件夹中的每个图像创建一个包含文件名、文件内容和标签的ImageFileEntry。</li><li id="6f80" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">将此ImageFileEntry添加到列表中。</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="0d2e" class="ml kk it mh b gy mm mn l mo mp">image_list = []<br/>directories = os.listdir(training_images)</span><span id="5c4e" class="ml kk it mh b gy mq mn l mo mp">for tagName in directories:<br/>  tag = trainer.create_tag(project.id, tagName)<br/>  images = os.listdir(os.path.join(training_images,tagName))<br/>  for img in images:<br/>   with open(os.path.join(training_images,tagName,img), "rb") as image_contents:<br/>    image_list.append(ImageFileCreateEntry(name=img, contents=image_contents.read(), tag_ids=[tag.id]))</span></pre><p id="598a" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">现在您有了一个包含所有标记图像的列表。到目前为止，Azure Custom Vision服务中还没有添加任何图像，只创建了标签。</p><p id="c2d9" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">上传图片分批进行，每批最多64张图片。我们的数据集有100张图片，所以首先我们需要将列表分成64张图片。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="4df1" class="ml kk it mh b gy mm mn l mo mp">def chunks(l, n):<br/>  for i in range(0, len(l), n):<br/>   yield l[i:i + n]<br/>batchedImages = chunks(image_list, 64)</span></pre><p id="ba2d" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">现在，我们已经将图像分成64个一批，我们可以将它们一批一批地上传到Azure Custom Vision服务。<em class="oc">注意:这可能需要一段时间！</em></p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="e83a" class="ml kk it mh b gy mm mn l mo mp">for batchOfImages in batchedImages:<br/>  upload_result = trainer.create_images_from_files(project.id, images=batchOfImages)</span></pre><p id="1906" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">现在您已经到达了最后一步，我们可以发布模型了。然后，它在预测API中可用，并准备好供应用程序使用。</p><p id="314f" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">每次训练你的模型都被称为一次迭代。当你有了新的数据，或者当你发现在现实世界中你的模型与预期的有所不同时，你通常需要重新训练你的模型。</p><p id="c506" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">Custom Vision服务的概念是，您可以在特定的名称下发布模型的迭代。这意味着您可以有多个版本的模型供您的应用程序使用，例如，您可以用它非常快速地对您的模型进行a-b测试。</p><p id="16a1" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">要发布模型的迭代，您需要调用publish_iteration方法，该方法需要几个参数。</p><p id="3b58" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">项目ID和迭代ID，这些是来自前面步骤的值。您可以为模型的发布选择一个名称，例如“最新”或“版本1”。您需要的最后一个参数是您要将它发布到的资源的“资源标识符”。这是我们在开始时用AZ命令创建的Azure自定义视觉预测资源的资源标识符。</p><p id="216a" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">您可以使用此命令检索您创建的预测资源的所有详细信息:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="1683" class="ml kk it mh b gy mm mn l mo mp">az cognitiveservices account show --name CustomVisionDemo-Prediction --resource-group CustomVision_Demo-RG</span></pre><p id="a48d" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">您可以复制字段ID后面的值，如下所示:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="2b80" class="ml kk it mh b gy mm mn l mo mp">/subscriptions/&lt;SUBSCRIPTION-ID&gt;/resourceGroups/&lt;RESOURCE_GROUP_NAME&gt;/providers/Microsoft.CognitiveServices/accounts/&lt;RESOURCE_NAME&gt;")</span></pre><p id="749e" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">获得资源ID后，将其粘贴到下面的变量中，并调用“publish_iteration”方法。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="c64e" class="ml kk it mh b gy mm mn l mo mp">publish_iteration_name = '' resource_identifier = '' trainer.publish_iteration(project.id, iteration.id, publish_iteration_name, resource_identifier)</span></pre><p id="cdb2" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">现在您已经成功地训练并发布了您的模型！</p><p id="c3f8" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">简单回顾一下我们所做的工作:</p><ul class=""><li id="a081" class="no np it ld b le lx lh ly lk nq lo nr ls ns lw nt nu nv nw bi translated">您创建了一个包含Azure自定义视觉服务培训和预测端点的Azure资源组</li><li id="a52c" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">您已经创建了一个新项目</li><li id="4b4c" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">在该项目中，您已经创建了标记</li><li id="3347" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">您分批上传了64张图片，并对其进行了标记</li><li id="3b33" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">您已经训练了模型的迭代</li><li id="b0ac" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">您已经将迭代发布到预测端点</li></ul><p id="88cb" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><a class="ae ki" href="https://github.com/hnky/AI4DEV01-CustomVision/blob/master/train.py" rel="noopener ugc nofollow" target="_blank"> <strong class="ld iu">查看完整代码这里</strong> </a></p><h1 id="a37a" class="kj kk it bd kl km kn ko kp kq kr ks kt jz ku ka kv kc kw kd kx kf ky kg kz la bi translated">我们来测试一下模型！</h1><p id="61b0" class="pw-post-body-paragraph lb lc it ld b le lf ju lg lh li jx lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在应用程序中使用模型就像调用API一样简单。您可以只对端点进行json post，但也可以使用自定义Vision Python SDK中的方法，这将使事情变得容易得多。</p><p id="d594" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">创建一个名为“predict.py”的新文件</p><p id="c6cf" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">从导入预测所需的依赖项开始。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="43fb" class="ml kk it mh b gy mm mn l mo mp">from azure.cognitiveservices.vision.customvision.prediction import CustomVisionPredictionClient</span></pre><p id="9ed5" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">接下来你需要的是预测键。这是您将模型发布到的资源的键。您可以使用这个az命令来列出这些键。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="2b78" class="ml kk it mh b gy mm mn l mo mp">az cognitiveservices account keys list --name CustomVisionDemo-Prediction --resource-group CustomVision_Demo-RG</span></pre><p id="8c97" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">当您拥有预测键时，您可以创建一个预测客户端。对于这个客户端，您还需要端点。您可以运行下面的az命令并复制字段“endpoint”后面的url。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f953" class="ml kk it mh b gy mm mn l mo mp">az cognitiveservices account show --name CustomVisionDemo-Prediction --resource-group CustomVision_Demo-RG</span></pre><p id="6e24" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">现在您有了预测键和端点，可以创建PredictionClient了。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="fb81" class="ml kk it mh b gy mm mn l mo mp">predictor = CustomVisionPredictionClient(prediction_key, endpoint=ENDPOINT)</span></pre><p id="1159" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">您有多种选择来对图像进行分类。您可以发送URL，也可以将二进制图像发送到端点。默认情况下，Azure Custom Vision服务会保存发布到端点的所有图像的历史记录。可以在门户中查看图像及其预测，并用于重新训练您的模型。但是，有时你不希望图像保留在历史中，因此可以禁用此功能。</p><p id="ba8f" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">我已经上传了两张图片，你可以用来测试，但是你也可以使用搜索引擎找到其他的图片，比如玛吉的图片和T2的图片。</p><p id="7501" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">要使用URL对图像进行分类并保留历史记录，您需要调用“classify_image_url”方法。您可以根据上面的几个步骤为它提供项目id和迭代名称，并提供图像的URL。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="863c" class="ml kk it mh b gy mm mn l mo mp">results = predictor.classify_image_url(project.id,publish_iteration_name,url="https://missedprints.com/wp-content/uploads/2014/03/marge-simpson-lego-minifig.jpg")</span></pre><p id="022a" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">要在屏幕上显示不同类别的分数，您可以使用下面的代码循环显示结果，并显示图像的标签名称和置信度分数。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="3bc8" class="ml kk it mh b gy mm mn l mo mp">for prediction in results.predictions:<br/>  print("\t" + prediction.tag_name + ": {0:.2f}%".format(prediction.probability * 100))</span></pre><p id="e6d2" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">现在，您已经完成了所有工作，并且拥有了自己的运行在云中的分类模型！以下是您所取得成就的回顾:</p><ul class=""><li id="2b52" class="no np it ld b le lx lh ly lk nq lo nr ls ns lw nt nu nv nw bi translated">我们问了一个问题</li><li id="c086" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">收集的数据</li><li id="cca3" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">创建了Azure自定义视觉服务端点</li><li id="8524" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">创建了新项目</li><li id="275c" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">标记和上传的内容</li><li id="560a" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">训练模型</li><li id="469a" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">发布迭代，以便它可以在API中使用</li><li id="95cc" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated">使用API对模型运行预测</li></ul><p id="89b0" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">在这一系列文章的其余部分，我们将把这个模型用于不同的解决方案！敬请期待！</p><p id="616e" class="pw-post-body-paragraph lb lc it ld b le lx ju lg lh ly jx lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><a class="ae ki" href="https://github.com/hnky/AI4DEV01-CustomVision/blob/master/predict.py" rel="noopener ugc nofollow" target="_blank"> <strong class="ld iu">查看完整代码这里</strong> </a></p><h1 id="211c" class="kj kk it bd kl km kn ko kp kq kr ks kt jz ku ka kv kc kw kd kx kf ky kg kz la bi translated">资源:</h1><ul class=""><li id="2f7a" class="no np it ld b le lf lh li lk od lo oe ls of lw nt nu nv nw bi translated"><a class="ae ki" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?WT.mc_id=AI4DEV01-blog-heboelma" rel="noopener ugc nofollow" target="_blank">如何安装Azure CLI </a></li><li id="6788" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated"><a class="ae ki" href="https://docs.microsoft.com/en-us/azure/cognitive-services/cognitive-services-apis-create-account-cli?WT.mc_id=AI4DEV01-blog-heboelma" rel="noopener ugc nofollow" target="_blank">通过CLI创建认知服务</a></li><li id="1025" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated"><a class="ae ki" href="https://docs.microsoft.com/en-us/python/api/overview/azure/cognitiveservices/customvision?view=azure-python&amp;WT.mc_id=AI4DEV01-blog-heboelma" rel="noopener ugc nofollow" target="_blank"> Python SDK </a></li><li id="a75b" class="no np it ld b le nx lh ny lk nz lo oa ls ob lw nt nu nv nw bi translated"><a class="ae ki" href="https://docs.microsoft.com/en-us/azure/cognitive-services/custom-vision-service?WT.mc_id=AI4DEV01-blog-heboelma" rel="noopener ugc nofollow" target="_blank">定制视觉文档</a></li></ul></div></div>    
</body>
</html>