<html>
<head>
<title>Send your new year greetings by email and text message using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 通过电子邮件和短信发送新年祝福</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/send-your-new-year-greetings-by-email-and-text-message-using-python-6222a2836538?source=collection_archive---------14-----------------------#2020-01-03">https://towardsdatascience.com/send-your-new-year-greetings-by-email-and-text-message-using-python-6222a2836538?source=collection_archive---------14-----------------------#2020-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/56fe5cde394f0962e8abaa335dbcd218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l96oZ9HoQ8d9VC82ffCzaQ.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">安妮·斯普拉特在<a class="ae jg" href="https://unsplash.com/s/photos/greeting?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="dc9e" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">有时，开发人员喜欢通过编程解决常规任务来使事情复杂化。我选择使用 Python 编写一些代码来发送我的新年祝福。不是因为容易；这是因为它很难——在某种程度上。不管怎样，编码很有趣！</h2></div><p id="5e40" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">新年到了。虽然我们开发者一般不会费心维护友情(到底是不是开玩笑？)，我们不介意把我们的问候发给我们的朋友，只要有一个程序化的方法来完成这件事！</p><p id="7e20" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，我将分两部分向您展示如何使用 Python 通过电子邮件和文本消息发送问候。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="0309" class="mb mc jj bd md me mf mg mh mi mj mk ml kp mm kq mn ks mo kt mp kv mq kw mr ms bi translated">第一部分:发送电子邮件问候</h1><p id="16d1" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">Python 有一个名为<code class="fe my mz na nb b"><a class="ae jg" href="https://docs.python.org/3/library/smtplib.html" rel="noopener ugc nofollow" target="_blank">smtplib</a></code>的内置库——一个可以用来创建 SMTP 客户端会话对象的模块，允许我们向任何实施 SMTP 或 ESMTP 的电子邮件服务提供商发送电子邮件。发送电子邮件的另一个有用的模块是<code class="fe my mz na nb b">email</code>包，它提供了与电子邮件相关的功能，比如读和写。</p><h2 id="c3f2" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated"><strong class="ak">首先导入相关模块:</strong> <code class="fe my mz na nb b"><strong class="ak">smtplib</strong></code> <strong class="ak">和</strong> <code class="fe my mz na nb b"><strong class="ak">email</strong></code> <strong class="ak">。</strong></h2><p id="9837" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">为了当前教程的简单性，我们将只发送一封纯文本电子邮件。为此，我们只需要 MIMEText 来创建电子邮件正文。在后面的教程中，我可以向您展示如何发送更复杂的电子邮件(例如，图像附件)。</p><pre class="no np nq nr gt ns nb nt nu aw nv bi"><span id="b9a9" class="nc mc jj nb b gy nw nx l ny nz">import smtplib<br/>import email<br/>from email.mime.text import MIMEText</span></pre><h2 id="44e7" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated"><strong class="ak">其次，创建发送邮件所需的变量。</strong></h2><p id="42cf" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">在本教程中，我将使用 gmail 帐户发送电子邮件。请注意，您需要更新您的 gmail 安全设置(<a class="ae jg" href="https://myaccount.google.com/lesssecureapps" rel="noopener ugc nofollow" target="_blank">https://myaccount.google.com/lesssecureapps</a>)，以允许您的电子邮件使用 Python 以编程方式发送。</p><pre class="no np nq nr gt ns nb nt nu aw nv bi"><span id="baef" class="nc mc jj nb b gy nw nx l ny nz">email_host = "smtp.gmail.com"<br/>email_port = 587<br/>email_sender = "" # change it to your own gmail account<br/>email_password = "" # change it to your gmail password<br/>email_receivers = ["xxx@gmail.com", "yyy@gmail.com", "zzz@gmail.com"] # the list of recipient email addresses</span></pre><h2 id="380c" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">第三，起草信息。</h2><p id="e4ba" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">接下来，您可以撰写您的邮件。您可以将发件人指定为您自己的电子邮件帐户。对于打算发送的邮件列表，可以使用以下格式:首先，最后<xxxx>，这是邮件收件人的标准格式。</xxxx></p><pre class="no np nq nr gt ns nb nt nu aw nv bi"><span id="27c9" class="nc mc jj nb b gy nw nx l ny nz">message = MIMEText("I wish you a great 2020.")<br/>message["From"] = ""  # your email account<br/>message["To"] = "John Smith&lt;xxxx@gmail.com&gt;, Mike Dickson&lt;yyyyy@hotmail.com&gt;" # the list of email addresses<br/>message["Subject"] = "Happy New Year"</span></pre><h2 id="1fac" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">第四，发送消息。</h2><p id="1574" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">您使用主机和端口来创建所需的 SMTP 会话。在初始化期间，Python 将通过调用 connect 方法自动建立 SMTP 连接。然后，出于安全原因，我们启动 TLS。</p><p id="a47d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您只需要使用电子邮件帐户和密码来验证您的身份。如前所述，对于 gmail，您必须先放松安全设置，然后才能使用此方法登录。</p><p id="1be8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以简单地调用<code class="fe my mz na nb b">sendmail</code>方法来发送消息并退出会话。</p><pre class="no np nq nr gt ns nb nt nu aw nv bi"><span id="5ea7" class="nc mc jj nb b gy nw nx l ny nz">email_server = smtplib.SMTP(email_host, email_port)<br/>email_server.starttls()<br/>email_server.login(email_sender, email_password)<br/>email_server.sendmail(email_sender, email_receivers, message.as_string())<br/>email_server.quit()</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="60c1" class="mb mc jj bd md me mf mg mh mi mj mk ml kp mm kq mn ks mo kt mp kv mq kw mr ms bi translated">第二部分。发送短信问候</h1><p id="c04b" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">实际上，有多种方法可以使用 Python 通过短信发送新年祝福。</p><h2 id="12a5" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">方法一。电子邮件发送选项的调整。</h2><p id="f245" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">你们很多人可能都知道，许多手机运营商允许你用电子邮件发送短信。以下是美国主要航空公司的简短列表。</p><ul class=""><li id="3b6c" class="oa ob jj la b lb lc le lf lh oc ll od lp oe lt of og oh oi bi translated">cell-phone-number@txt.att.net 美国电话电报公司</li><li id="54e1" class="oa ob jj la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated">冲刺:cell-phone-number@messaging.sprintpcs.com</li><li id="34ca" class="oa ob jj la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated">t-Mobile:cell-phone-number@tmomail.net</li><li id="d835" class="oa ob jj la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated">cell-phone-number@vtext.com 威瑞森</li></ul><p id="b19a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，您可以简单地使用 1234567890@txt.att.net 作为电子邮件收件人之一，而不是使用电子邮件地址作为<code class="fe my mz na nb b">email_receivers</code>变量。</p><p id="0483" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，有一个问题，你可能必须知道与该号码相关的运营商。如果你不知道，你可以写一些代码来创造所有可能的变化(如 1234567890@messaging.springtpcs.com，1234567890@tmomail.net)，以涵盖所有的可能性。我还听说有付费的第三方服务可以让你查找某个电话号码的运营商。但是我想这对于我们想要完成的目标来说有点过头了。</p><h2 id="9747" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">方法二。通过 AWS 发送</h2><p id="0b3f" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">您也可以使用 AWS SNS 发送短信。显然，您需要注册一个 AWS 帐户，这超出了当前教程的范围。可以参考官网(<a class="ae jg" href="https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/premium support/knowledge-center/create-and-activate-AWS-account/</a>)。</p><h2 id="f40d" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">首先，安装 AWS boto3 模块。</h2><p id="71b0" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">在终端或命令行工具中运行代码(<code class="fe my mz na nb b">pip install boto3</code>)。boto3 库是为 AWS 相关管理开发的 Python 模块。</p><h2 id="6216" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">其次，用 Python 创建一个 SNS 客户端。</h2><p id="533e" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">SNS 是一款<a class="ae jg" href="https://aws.amazon.com/sns" rel="noopener ugc nofollow" target="_blank"> AWS 产品</a>，允许开发者向最终用户发送文本消息和其他通信(例如，电子邮件)。</p><pre class="no np nq nr gt ns nb nt nu aw nv bi"><span id="3c38" class="nc mc jj nb b gy nw nx l ny nz">import boto3<br/>client = boto3.client(<br/>    "sns",<br/>    aws_access_key_id="", # your aws access key<br/>    aws_secret_access_key="", # your aws secrete access key<br/>    region_name="us-east-1"<br/>)</span></pre><h2 id="69db" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">第三，创建话题，添加订阅者。</h2><p id="7063" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">要向多个电话号码发送问候语，您需要创建一个主题，该主题允许您向该主题添加订阅者。每个用户由一个电话号码指定，电话号码还应该包括国家代码(例如，美国为+1)，即 E.164 格式。因为我们正在发送消息(即短消息服务或 sms)，所以我们将协议指定为<code class="fe my mz na nb b">sms</code>。</p><pre class="no np nq nr gt ns nb nt nu aw nv bi"><span id="9392" class="nc mc jj nb b gy nw nx l ny nz">topic = client.create_topic(Name="new_year") # create a topic<br/>topic_arn = topic['TopicArn']  # get its Amazon Resource Name</span><span id="300d" class="nc mc jj nb b gy oo nx l ny nz"># Add SMS Subscribers to this topic<br/>phone_numbers = ["+1234567890"] </span><span id="900c" class="nc mc jj nb b gy oo nx l ny nz">for phone_number in phone_numbers:<br/>    client.subscribe(<br/>        TopicArn=topic_arn,<br/>        Protocol='sms',<br/>        Endpoint=phone_number<br/>    )</span></pre><h2 id="aba0" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">第四，发布消息给题目。</h2><p id="6f84" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">将订阅者添加到主题后，就可以向主题发布消息了。您只需要提供消息，并指定要发布该消息的主题。通过这样做，所有的用户都将收到文本消息。</p><pre class="no np nq nr gt ns nb nt nu aw nv bi"><span id="14c8" class="nc mc jj nb b gy nw nx l ny nz">client.publish(Message="Happy New Year!", TopicArn=topic_arn)</span></pre><h2 id="e6e3" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">方法三。通过 Twilio 发送</h2><p id="2fe1" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">您也可以选择使用 Twilio 发送短信。当然，它需要一个 Twilio 帐户，可以免费注册，类似于 AWS 帐户。一旦您创建了 Twilio 帐户，我们就可以开始玩游戏了！</p><h2 id="2520" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">首先，安装 Twilio 模块。</h2><p id="7eed" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">运行命令<code class="fe my mz na nb b">pip install twilio</code>安装 Twilio 模块，这将使您能够访问 Twilio 提供的各种功能。短信只是其中之一。</p><h2 id="1638" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">其次，用 Python 创建一个 Twilio 客户机</h2><p id="49a9" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated"><code class="fe my mz na nb b">Cilent</code>方法将用于通过获取您的 Twilio 帐户 SID 和 AUTH Token 来创建 Twilio 客户端，这两者都可以在您的 Twilio 帐户的仪表板上找到。</p><pre class="no np nq nr gt ns nb nt nu aw nv bi"><span id="745c" class="nc mc jj nb b gy nw nx l ny nz">from twilio.rest import Client</span><span id="1fdb" class="nc mc jj nb b gy oo nx l ny nz">client = Client(<br/>    "", # your Twilio Account SID<br/>    "", # your Twilio AUTH token<br/>)</span></pre><h2 id="0af5" class="nc mc jj bd md nd ne dn mh nf ng dp ml lh nh ni mn ll nj nk mp lp nl nm mr nn bi translated">第三，创建和发送消息。</h2><p id="cdec" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">您创建了一个列表，列出了您要发送新年祝福的所有电话号码。请再次注意，电话号码使用 E.164 格式，类似于 AWS SNS 的使用。</p><p id="5a6e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一个问题是，使用免费的 Twilio 帐户，你只能向你验证过的电话号码发送短信，与 AWS SNS 相比，你的灵活性较低。但是，您可以升级您的 Twilio 帐户，这样您就可以选择以非常低的成本(每条消息不到 1 美分)向您选择的多个电话号码发送消息。</p><pre class="no np nq nr gt ns nb nt nu aw nv bi"><span id="c359" class="nc mc jj nb b gy nw nx l ny nz">phone_numbers = ["+1234567890", "+1234567891"] # the list of phone numbers to receive the messages</span><span id="f8b0" class="nc mc jj nb b gy oo nx l ny nz">for phone_number in phone_numbers:<br/>    client.messages.create(<br/>        to=phone_number,<br/>        from_="", # your Twilio phone number<br/>        body="Happy New Year!"<br/>    )</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="292e" class="mb mc jj bd md me mf mg mh mi mj mk ml kp mm kq mn ks mo kt mp kv mq kw mr ms bi translated">结论</h1><p id="2149" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">通过学习本教程，您应该已经为每个作业创建了多个 python 脚本。以后，你可以使用这些脚本非常方便地发送电子邮件和短信。</p><p id="6071" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以实际上，编程确实使某些事情变得更容易，不是吗？</p></div></div>    
</body>
</html>