<html>
<head>
<title>How I Created A Lyrics Generator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何创建一个歌词生成器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-i-created-a-lyrics-generator-b62bde13badb?source=collection_archive---------13-----------------------#2020-03-11">https://towardsdatascience.com/how-i-created-a-lyrics-generator-b62bde13badb?source=collection_archive---------13-----------------------#2020-03-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bd17" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用人工智能创作热门歌曲</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/2897798e9b9f94d5878431c7baf4fdab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*VpzI0YEGPAv7TCPo_nVmCQ.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图片:<a class="ae ku" href="https://pixabay.com/users/ib306660-546673/" rel="noopener ugc nofollow" target="_blank"> IB306660 </a>，经由<a class="ae ku" href="https://pixabay.com/photos/lyrics-art-sculpture-thinking-1099741/" rel="noopener ugc nofollow" target="_blank">pixabay.com</a>(CC0)</p></figure><p id="1a56" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">网上有很多歌词生成器，虽然玩起来很有趣，但他们创作的歌曲没有多大意义。作为一个真正的人类歌曲作者(我已经写了100多首歌)，我想一定有更好的方法来做到这一点，所以我决定利用机器学习的最新进展来建立自己的方法。没有好的方法来教人工智能“歌曲”的概念，但是可以使用NLP来训练它模仿你给它看的任何文本。我给它大量的歌曲来学习，最终，它能够输出听起来连贯的歌词。总的来说，该项目涉及了大约50个小时的编程，但最终结果是值得的:【https://boredhumans.com/lyrics_generator.php.<a class="ae ku" href="https://boredhumans.com/lyrics_generator.php" rel="noopener ugc nofollow" target="_blank"/></p><p id="687b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">以下是我做这件事的细节:</p><p id="a548" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我从微调GPT-2开始，这是一个开源语言模型，在超过800万个网页上训练，预测文本中的下一个单词。为此，我使用了<a class="ae ku" href="https://github.com/minimaxir/gpt-2-simple" rel="noopener ugc nofollow" target="_blank"> GPT-2 Simple </a>(它有一个链接，任何人都可以通过谷歌Colab在免费的GPU上运行它)和一个包含<a class="ae ku" href="https://www.kaggle.com/tgdivy/poetry-foundation-poems" rel="noopener ugc nofollow" target="_blank"> 13，000首诗歌的数据库</a>。我原本打算在我下载的400，000首歌词的数据库上训练它，但其中许多都有脏话，性内容，毒品参考和其他不适合孩子的东西，我不想让我的模型学习所有这些。另外，我希望我的版本听起来比其他网站更“聪明”，所以使用诗歌似乎是一个更好的计划。</p><p id="fc69" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">一旦我让它很好地用于创作诗歌，我就对我认为有诗意的艺术家(如鲍勃·迪伦、U2、泰勒·斯威夫特和几十个其他艺术家)的7000首歌词进行了更多的微调。但结果仍然是诗歌，所以我添加了一堆非ML的后期处理步骤，使它看起来更像宋立科的歌词。在GPT-2产生原始内容后，我使用前6行，称之为“第1节”，然后接下来的4行是“合唱”，然后接下来的6行是“第2节”，然后为了让合唱听起来像合唱，我再次重复第一个合唱。我还做了其他各种各样的小调整，比如过滤掉r级内容，删除原始歌词的最后一行，因为大部分时间它都没有完成(被剪掉)，如果歌曲在所有删除后变得太短，则获得一套全新的歌词。有时它有像[重复合唱]或(乐器间歇)这样的短语，这是不好的，所以我也自动删除了这些台词。所有这些任务都是通过简单的PHP编程完成的，比如使用str_replace去掉我不想显示的各种字符:</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="26a4" class="lw lx it ls b gy ly lz l ma mb">$title = str_replace("/", "", $title);</span></pre><p id="a8a1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这是为了删除重复太多的行:</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="9bcc" class="lw lx it ls b gy ly lz l ma mb">// find repeated lines<br/>  for ($i = 0; $i &lt; count($words); $i++) {<br/>    if (str_word_count($words[$i])) {<br/>      if ($counts[$words[$i]] &gt; 5) array_push($repeated_lines, $i);<br/>    }<br/>  }<br/>  // remove repeated lines<br/>  for ($i = 0; $i &lt; count($repeated_lines); $i++) {<br/>    if ($i &gt; 3) {<br/>      unset($words[$repeated_lines[$i]]);<br/>    }</span></pre><p id="0a78" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">找出给每首歌起一个标题的最佳方式比我预想的要困难得多。有时人类词曲作者很难做到这一点，我不确定ML模型可以训练得很好，所以相反，我选择创建一些硬编码的规则来选择标题。我主要使用重复最多的行，但有限制，不能太短或太长。</p><p id="fe5b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这一切变得复杂的一个原因是，它是一个网站，而不仅仅是一个普通的Python程序。简单地找出将Python ML模型部署到web的最佳方式是一场磨难，因为它对于Google Cloud Run或AWS Lambda来说有点太大了，而在常规AWS服务器上运行它又太昂贵了。我最终使用了AWS LightSail，它就像一个普通的web主机(如DigitalOcean)，但仍然具有普通AWS的许多优点。</p><p id="b464" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">此外，一旦部署了模型，还需要做更多的工作，使用PHP和JavaScript/Ajax使它真正发挥网站的功能。让我的PHP页面与ML模型(使用Starlette/uvicon[类似于Flask])的REST API feed一起工作时，我遇到了无尽的CORS跨域问题。它涉及到一些修复，比如向Python API部分添加如下代码行:</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="3a7a" class="lw lx it ls b gy ly lz l ma mb">middleware = [Middleware(CORSMiddleware, allow_origins=['*'])]</span><span id="dcab" class="lw lx it ls b gy mc lz l ma mb"># Needed to avoid cross-domain issues<br/>response_header = {'Access-Control-Allow-Origin': '*'}</span></pre><p id="c2b7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">并引用我的服务器的SSL证书，如:</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="5754" class="lw lx it ls b gy ly lz l ma mb">if __name__ == '__main__':<br/>    uvicorn.run(<br/>        app,<br/>        host='0.0.0.0',<br/>        port=int(os.environ.get('PORT', 6006)),<br/>        ssl_version=ssl.PROTOCOL_SSLv23,<br/>        ssl_cert_reqs=ssl.CERT_OPTIONAL,<br/>        ssl_keyfile="./ssl/server.key",<br/>        ssl_certfile="./ssl/server.crt"<br/>    )</span></pre><p id="0b09" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我的计划是最终将人工智能生成的音乐和人工智能生成的人声添加到歌词中。我已经试验过最先进的音频程序，比如谷歌的<a class="ae ku" href="https://magenta.tensorflow.org" rel="noopener ugc nofollow" target="_blank"> Magenta </a>，虽然它确实输出好听的音乐，但远远达不到创作一首真正的歌曲所需的水平。加入人声更是难上加难，因为除了努力让它听起来像歌手而不仅仅是普通的电脑声音，歌词还必须与旋律/音乐同步。理想情况下，所有这些都可以自动生成，以配合人工智能歌词，然后我将有一首完整的歌曲从开始到结束，所以这是我接下来要做的。</p></div></div>    
</body>
</html>