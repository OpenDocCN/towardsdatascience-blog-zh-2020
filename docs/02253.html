<html>
<head>
<title>Using GeoPandas and Folium to Over-Engineer a Question in Jewish Law</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GeoPandas和Folium过度设计犹太法律中的一个问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-geopandas-and-folium-to-over-engineer-a-question-in-jewish-law-b9b33c4909d2?source=collection_archive---------19-----------------------#2020-03-03">https://towardsdatascience.com/using-geopandas-and-folium-to-over-engineer-a-question-in-jewish-law-b9b33c4909d2?source=collection_archive---------19-----------------------#2020-03-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="174e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">借助计算地理学解决一个古老问题的尝试</h2></div><p id="bf86" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">今年是犹太人的普林节，庆祝挫败了古波斯针对犹太人的种族灭绝阴谋。根据你所在的地方，普林节是在3月10日，或者“蜀山节”是在3月11日。</p><p id="53e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着这个古老的节日增加了时间和空间的维度。正是在这样的时候，我喜欢我的职业，数据科学，像过去的拉比和圣贤一样质疑一切。</p><p id="90a9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">哈尔布拉查高等犹太法学院的拉比埃利泽·梅拉梅德解释说，某些地方之所以会在一天后庆祝这个节日，是因为一些城市有城墙，而另一些没有。如果一座城市在约书亚·本·嫩时期建有城墙，那么这座城市会庆祝书珊节(后来的日子),否则这座城市会庆祝常规的普林节。</p><p id="2a52" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从表面上看，这似乎是一个相对容易的城市之间的划分，但仔细观察，许多问题出现了。</p><ol class=""><li id="ee2d" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated">我们怎么知道约书亚·本·嫩时期存在的有城墙的城市就是今天以同样的名字命名的城市呢？Lod就是这种情况。</li><li id="f904" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">这座在约书亚·本·嫩时代被城墙包围的城市已经失去了它的犹太社区和历史记录。</li><li id="0561" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">一个历史上存在于约书亚本嫩时期的城市，历史上有城墙，但不知道它是否在奇迹发生时有城墙。希伯伦就属于这一类</li></ol><p id="823b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">唯一一个仍然只庆祝舒山节的城市实际上是耶路撒冷。然而，我们的问题仍然没有完全回答，因为城市的边界在过去的2000年里呈指数增长。还有其他城市被认为可能是庆祝蜀山普林节的地方，所以在我们的实验中，我们也将解决它们。</p><p id="8f35" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">今天的耶路撒冷被认为是约书亚本嫩时代的同一实体吗？</p><p id="ce3d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要回答这个问题，我们可以从《塔木德经》中找到一些具体的城市划分规范。<a class="ae le" href="https://www.sefaria.org.il/Megillah.3b.10?lang=bi&amp;with=all&amp;lang2=en" rel="noopener ugc nofollow" target="_blank">“拉比耶霍舒亚·本·利瓦伊说:一座城市，和所有毗邻它的定居点，以及所有能与它一起被看见的定居点，即，能从有城墙的城市被看见的，都被认为是像这座城市一样的”(Megila 3，2)。</a></p><p id="68b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是什么是相邻的呢？仅仅是密集的连片建筑吗？拉比·梅拉梅德<a class="ae le" href="https://ph.yhb.org.il/category/%d7%96%d7%9e%d7%a0%d7%99%d7%9d/17-%d7%93%d7%99%d7%a0%d7%99-%d7%a4%d7%a8%d7%96%d7%99%d7%9d-%d7%95%d7%9e%d7%95%d7%a7%d7%a4%d7%99%d7%9d/" rel="noopener ugc nofollow" target="_blank">澄清道</a>邻里之间少于141肘(67.8米)的差距足以将他们视为一个邻里。</p><p id="6c32" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以现在我们有了一个关键变量，来过度设计犹太律法的问题。</p><p id="951b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有许多方法可以用数据来解决这个问题，但我认为最简单的方法是使用OpenStreetMap下载以色列的所有空间建筑数据，并将建筑的边界扩展67.8米，统一重叠部分，并找到包含耶路撒冷古代部分的多边形。</p><p id="a9f3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们开始吧:</p><p id="0bf5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">导入必要的包后，我创建了一个可能的蜀山普林节城市(以及耶路撒冷)的字典，然后将它转换成笛卡尔参考系中的地理数据框架。我通过简单地使用谷歌地图来找到疑似城墙城市的可能历史中心地理坐标。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="5cea" class="mc md it ly b gy me mf l mg mh"><strong class="ly iu">import</strong> <strong class="ly iu">geopandas</strong> <strong class="ly iu">as</strong> <strong class="ly iu">gpd</strong><br/><strong class="ly iu">import</strong> <strong class="ly iu">folium</strong><br/><strong class="ly iu">import</strong> <strong class="ly iu">pandas</strong> <strong class="ly iu">as</strong> <strong class="ly iu">pd</strong><br/><strong class="ly iu">from</strong> <strong class="ly iu">folium.plugins</strong> <strong class="ly iu">import</strong> LocateControl<br/><strong class="ly iu">from</strong> <strong class="ly iu">shapely.geometry</strong> <strong class="ly iu">import</strong> Point<br/><strong class="ly iu">from</strong> <strong class="ly iu">shapely.ops</strong> <strong class="ly iu">import</strong> cascaded_union<br/>walled_cities_dict = {"Tiberias":[32.775011, 35.545584],"Hebron":[31.524723, 35.110460],"Nablus":[32.213117, 35.284881],<br/>                      "Jaffa":[32.053705, 34.750625],"Lod":[31.955268, 34.896203],"Gaza":[31.504135, 34.464426],<br/>                      "Zefat":[32.966292, 35.494927],"Acre":[32.920831, 35.069042],"Haifa":[32.800833, 35.019167],<br/>                      "Beit Shean":[32.499474, 35.498450],"Jericho":[31.870487, 35.440522],<br/>                      "Beer Sheva":[31.237182, 34.793101],"Ramla":[31.924759, 34.872939],"Tyre":[33.274876, 35.193785],<br/>                      "Sidon":[33.562539, 35.369619],"Damascus":[33.511125, 36.301019],"Izmir":[38.418095, 27.139753],<br/>                      "Baghdad":[33.350506, 44.401307],"Jerusalem":[31.777055, 35.234268]}<br/>walled_cities_gdf = gpd.GeoDataFrame()<br/>walled_cities_gdf['City'] = list(walled_cities_dict.keys())<br/>walled_cities_gdf['geometry'] = list(walled_cities_dict.values())<br/>walled_cities_gdf['geometry'] = walled_cities_gdf['geometry'].apply(<strong class="ly iu">lambda</strong> x: Point(x[1],x[0]))<br/>walled_cities_gdf.crs = {'init':'epsg:4326'}<br/>walled_cities_gdf = walled_cities_gdf.to_crs(epsg=3857)</span></pre><p id="7117" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在以色列<a class="ae le" href="https://download.geofabrik.de/asia/israel-and-palestine.html" rel="noopener ugc nofollow" target="_blank">这里</a>下载了建筑足迹的shapefile:</p><p id="b7ce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在质心中旋转多边形(以使其更容易计算)并将多边形缓冲67.8米。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="38cd" class="mc md it ly b gy me mf l mg mh">buildings = gpd.read_file('/home/arieh/Downloads/israel-and-palestine-latest-free.shp/gis_osm_buildings_a_free_1.shp')<br/>buildings = buildings.to_crs(epsg=3857)<br/>buildings_cent = buildings.copy()<br/>buildings_cent['geometry'] = buildings_cent['geometry'].centroid<br/>buildings_cent['geometry'] = buildings_cent['geometry'].buffer(67.8)</span></pre><p id="98b2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们将其全部转换为一个多面，删除重叠面之间的边界，然后将该多面转换回地理数据框。这样做是为了方便我们在它和城墙城市地理数据框架之间执行空间连接。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="1cc7" class="mc md it ly b gy me mf l mg mh">all_union = cascaded_union(buildings_cent['geometry'])<br/>all_union_polys = []<br/><strong class="ly iu">for</strong> poly <strong class="ly iu">in</strong> all_union:<br/>    all_union_polys.append(poly)<br/>max_buffers_gdf = gpd.GeoDataFrame()<br/>max_buffers_gdf['geometry'] = all_union_polys<br/>max_buffers_gdf['id'] = range(len(all_union_polys))<br/>max_buffers_gdf.crs = buildings_cent.crs<br/>shushan_extents = gpd.sjoin(walled_cities_gdf,max_buffers_gdf)<br/>max_buffers_gdf_subset = max_buffers_gdf[max_buffers_gdf['id'].isin(shushan_extents['index_right'])]<br/>max_buffers_gdf_subset = max_buffers_gdf_subset.to_crs({'init':'epsg:4326'})<br/>Shushan_Zones = pd.merge(max_buffers_gdf_subset,shushan_extents[['id','City']],on = 'id')</span></pre><p id="4dbc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们只剩下可能庆祝蜀山普林节的最大范围。</p><p id="dc60" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们可以使用leav将我们计算的蜀山普林节区域转换成交互式网络地图。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="5f3d" class="mc md it ly b gy me mf l mg mh">x1,y1,x2,y2 = Shushan_Zones['geometry'].total_bounds<br/>m = folium.Map(tiles='openstreetmap')<br/>LocateControl().add_to(m)<br/>m.fit_bounds([[y1, x1], [y2, x2]])<br/>folium.GeoJson(Shushan_Zones,name='Shushan Zones').add_to(m)<br/>folium.LayerControl().add_to(m)<br/>m.save('local_files/Shushan_Zone_Tool.html')</span></pre><p id="354e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">互动网络应用位于<a class="ae le" href="https://acopelan.github.io/index.html" rel="noopener ugc nofollow" target="_blank">这里</a></p><p id="1abb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">来自网络应用的一些截图显示了蜀山区的高级地图:</p><figure class="lt lu lv lw gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mi"><img src="../Images/4053d45427062ac0b2985226e67881f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bekt0xCFM_kUUkmdFIfaIQ.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">蜀山区高级地图</p></figure><p id="a95f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一张放大的照片显示了耶路撒冷的细节:</p><figure class="lt lu lv lw gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mu"><img src="../Images/bc958eee5cc8ceb1f66fdc256f235138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSWXgr_3EiLeZjAly8Le9Q.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">放大到耶路撒冷</p></figure><p id="02cc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">嗯，那还行…但是杰里科和希伯伦呢？</p><figure class="lt lu lv lw gt mj gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/f8cedf2e5b9abc16f3f561e29a7dc178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*eWhWWd5-om3yV5ToydZZEg.png"/></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">希布伦</p></figure><figure class="lt lu lv lw gt mj gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/f9d790b0df4e20eb199aa74252e8b7df.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*saiJqeZnCuEr7w0IDro7FA.png"/></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">杰里科</p></figure><p id="d6ff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里没有太多的成功，因为有几个建筑足迹的工作。</p><p id="ce92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们有了它，就像物理<a class="ae le" href="https://en.wikipedia.org/wiki/Cubit" rel="noopener ugc nofollow" target="_blank">肘杆</a>如何帮助过去的圣人提出犹太律法的解决方案，所以我们也可以利用今天技术时代的工具和逻辑，并以可扩展和计算的方式应用它们！</p><p id="8f3f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个项目的一个更好的版本将使用对象检测来描绘建筑物，并以光栅聚焦的方式创建区域。我想我们会把改造工作留到明年在耶路撒冷(zone)进行！</p><p id="de77" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里找到<a class="ae le" href="https://github.com/acopelan/ShushanPurim/blob/master/shushan_zones.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>，在这里找到<a class="ae le" href="https://acopelan.github.io/index.html" rel="noopener ugc nofollow" target="_blank"> HTML网页应用</a>。</p></div></div>    
</body>
</html>