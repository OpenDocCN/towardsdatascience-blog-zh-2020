<html>
<head>
<title>1 | Basics of Self-Attention</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">1 |自我关注的基础</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/self-attention-5b95ea164f61?source=collection_archive---------23-----------------------#2020-07-01">https://towardsdatascience.com/self-attention-5b95ea164f61?source=collection_archive---------23-----------------------#2020-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="4aca" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="http://towardsdatascience.com/tagged/TOCAAT" rel="noopener" target="_blank">变形金刚，一次一个概念</a></h2><div class=""/><p id="b4d4" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">TL；DR-Transformers 是机器学习(ML)中令人兴奋的(<strong class="kb jd">相对而言</strong>)新的部分，但是在你能够理解它们之前，有很多<strong class="kb jd">概念需要被分解。这是我写的关于他们的专栏的第一篇文章。在这里，我们重点关注基本的自我关注机制是如何工作的，这是 Transformer 模型的第一层。本质上，对于每个输入向量，自我关注产生一个向量，该向量是其邻域中向量的加权和。权重由单词之间的关系或<em class="kx">连通性</em>决定。这个专栏是针对那些对变形金刚下发生的事情感到好奇的 ML 新手和爱好者的。</strong></p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="5076" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">内容:</h1><ol class=""><li id="3ef7" class="md me it kb b kc mf kg mg kk mh ko mi ks mj kw mk ml mm mn bi translated"><a class="ae mo" href="#cce2" rel="noopener ugc nofollow">简介</a></li><li id="5017" class="md me it kb b kc mp kg mq kk mr ko ms ks mt kw mk ml mm mn bi translated"><a class="ae mo" href="#2beb" rel="noopener ugc nofollow">自我关注——数学</a></li><li id="5295" class="md me it kb b kc mp kg mq kk mr ko ms ks mt kw mk ml mm mn bi translated"><a class="ae mo" href="#c2e8" rel="noopener ugc nofollow">参考文献</a></li></ol><h1 id="cce2" class="lf lg it bd lh li mu lk ll lm mv lo lp lq mw ls lt lu mx lw lx ly my ma mb mc bi translated">1.介绍</h1><p id="9828" class="pw-post-body-paragraph jz ka it kb b kc mf ke kf kg mg ki kj kk mz km kn ko na kq kr ks nb ku kv kw im bi translated">变压器是一种 ML 架构，已经成功地用于各种 NLP 任务，尤其是序列到序列(seq2seq)任务，如机器翻译和文本生成。在 seq2seq 任务中，目标是获取一组输入(例如英语单词)并产生一组期望的输出(德语中的相同单词)。自 2017 年成立以来，他们已经为 seq2seq 篡夺了当时的主导架构(<a class="ae mo" href="https://en.wikipedia.org/wiki/Long_short-term_memory" rel="noopener ugc nofollow" target="_blank"> LSTMs </a>)，并且几乎无处不在地出现在任何关于 NLP 突破的新闻中(例如 OpenAI 的<a class="ae mo" href="https://www.vox.com/2019/5/15/18623134/openai-language-ai-gpt2-poetry-try-it" rel="noopener ugc nofollow" target="_blank"> GPT-2 甚至出现在主流</a>媒体上！).</p><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/fc6f49528999434b2dfe4a3e40fd5364.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*pblofc3psQrBkvXI4Jfxog.png"/></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图 1.1 —机器翻译(欧洲→ DE)⁴</p></figure><p id="98c5" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">本专栏旨在非常温和、渐进地介绍 Transformer 架构背后的数学、代码和概念。没有比注意力机制更好的起点了，因为:</p><blockquote class="no"><p id="c595" class="np nq it bd nr ns nt nu nv nw nx kw dk translated">最基本的变形金刚完全依靠注意力<strong class="ak">机制。</strong></p></blockquote><h1 id="2beb" class="lf lg it bd lh li mu lk ll lm mv lo lp lq ny ls lt lu nz lw lx ly oa ma mb mc bi translated">2.自我关注——数学</h1><p id="8ec4" class="pw-post-body-paragraph jz ka it kb b kc mf ke kf kg mg ki kj kk mz km kn ko na kq kr ks nb ku kv kw im bi translated">我们希望 ML 系统能够学习单词之间的重要关系，就像人类理解句子中单词的方式一样。在图 2.1 中，你和我都知道“The”指的是“animal ”,因此应该和那个词有很强的联系。正如图表的颜色编码所示，这个系统知道“动物”、“十字路口”、“街道”和“the”之间有某种联系，因为它们都与句子的主题“动物”的相关。这是通过<em class="kx">自我关注实现的。⁴ </em></p><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi ob"><img src="../Images/aeceb2d8557bafee16ea796e9cd05328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9XxSNAGInd3rbwTE_AwrQA.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图 2.1—“The”关注<strong class="bd og"><em class="oh"/></strong>哪些词？⁴</p></figure><p id="127d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">在最基本的层面上，自我关注是一个过程，其中一个向量序列<em class="kx"> x </em>被<strong class="kb jd">编码</strong>成另一个向量序列<em class="kx"> z </em>(图 2.2)。每一个原始向量都只是一个数字块<strong class="kb jd"/>，其中<strong class="kb jd">代表一个单词。</strong>其对应的<em class="kx"> z </em>向量既表示原始单词<em class="kx">又表示其<strong class="kb jd">与其周围其他单词的关系</strong>。</em></p><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi oi"><img src="../Images/9af65097ff95acaec4053d641e754a73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qeY6mWlzwkCIl2LhPN0zZQ.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图 2.2:输入向量序列<em class="oh"> x </em>变成另一个同样长的向量序列<em class="oh"> z </em></p></figure><p id="f8a8" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">向量代表了空间中的某种东西，比如海洋中的水粒子流或者地球周围任何一点的重力效应。你<em class="kx">能不能</em>把词想成词的总空间里的向量。每个词向量<em class="kx">的方向意味着</em>某事。向量之间的异同对应于单词本身之间的异同(我在<a class="ae mo" href="https://medium.com/analytics-vidhya/ideas-for-using-word2vec-in-human-learning-tasks-1c5dabbeb72e" rel="noopener">这里</a>之前已经写过这个主题)。</p><p id="6fc2" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">让我们先来看看前三个向量，特别是向量<em class="kx"> x2 </em>，我们的“猫”向量，是如何变成<em class="kx"> z2 </em>的。所有这些步骤将对输入向量的每个重复<em class="kx">。</em></p><p id="0968" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">首先，我们将聚光灯下的向量<em class="kx"> x2 </em>与一个序列中的所有向量<em class="kx">相乘，包括其自身</em>。我们将做每个向量和<em class="kx">转置</em>(对角翻转版本)x2 的乘积(图 2.3)。这与做点积是一样的，你可以把两个向量的点积看作是对它们相似程度的度量。</p><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi oj"><img src="../Images/efe26781c4be6dadded81898bb467692.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dVJGPnBgZAFy8MorveslUQ.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图 2.3:转置乘法(上标“T”=“转置”)</p></figure><p id="aba1" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">两个向量的点积与它们之间角度的余弦成正比(图 2.4)，因此它们的方向排列越紧密，点积就越大。如果它们指向完全相同的方向，那么角度 a 就是 0⁰，0⁰的余弦等于 1。如果它们指向相反的方向(因此 A = 180⁰),那么余弦就是-1。</p><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi ok"><img src="../Images/e4ceeddebfd55aef241e904d33d114b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2c4vsG2yNRBQL8xsIYKuew.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图 2.4-两个向量的点积</p></figure><p id="8b4e" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">作为题外话，注意我们用来得到向量间乘积的<em class="kx">运算</em>是一个我们可以选择的超参数。点积只是我们拥有的最简单的选项，在<a class="ae mo" href="https://arxiv.org/pdf/1706.03762.pdf" rel="noopener ugc nofollow" target="_blank"> <em class="kx">中使用的那个选项就是你所需要的全部注意力</em></a><em class="kx"/>【AIAYN】<em class="kx">。</em></p><p id="8b91" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">如果你想在这个问题上有一个额外的直观视角，<a class="ae mo" href="http://www.peterbloem.nl/blog/transformers" rel="noopener ugc nofollow" target="_blank"> Bloem 的</a>帖子讨论了自我关注如何类似于推荐系统确定电影或用户相似性的方式。</p><p id="0bf1" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">因此，我们一次将一个单词放在聚光灯下，并从其邻近单词中确定其输出。这里我们只看单词之前和之后，但我们可以选择在未来扩大窗口。</p><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/9fd6e11cd617211a278e8beb4768b8aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*RN9sHNRPhQu2atGXzTW5zg.png"/></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图 2.5-每个第 j 个向量的原始权重</p></figure><p id="5520" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">如果聚光灯下的单词是“猫”，我们要复习的单词顺序是“the”，“cat”，“sat”。我们在问<strong class="kb jd">单词“<em class="kx">cat”</em>应该分别对“<em class="kx"> the”、“cat”</em>和“<em class="kx">sat”</em></strong>给予多大的关注(类似于我们在图 2.1 中看到的)。</p><p id="b8c1" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">将我们的聚光灯单词向量的转置和它周围的单词序列相乘，将得到一组 3 个<em class="kx">原始权重</em>(图 2.5) <em class="kx">。每个权重与这两个词在意思上的联系程度成正比。然后，我们需要将它们规范化，以便它们更容易使用。我们将使用<a class="ae mo" href="https://en.wikipedia.org/wiki/Softmax_function" rel="noopener ugc nofollow" target="_blank"> softmax 公式来完成这项工作(图 2.6)。</a>这将数字序列转换到 0，1 范围内，其中每个输出与输入数字</em>的<em class="kx">指数成比例。这使得我们的权重更容易使用和解释。</em></p><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div class="gh gi om"><img src="../Images/b3b55341a6750bb733a8a50a505c62ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*FM5PaDrHI31yoE8AwvMAWw.jpeg"/></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图 2.6:通过 softmax 函数归一化原始重量</p></figure><p id="b5fd" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">现在我们取归一化的权重(每个向量一个，在<em class="kx"> j </em>序列中)，将它们分别与<em class="kx"> x </em>输入向量相乘，对乘积求和，然后就成功了！我们有一个输出<em class="kx"> z </em>向量，(图 2.5)！当然，这只是 x2 ("cat ")的输出向量<strong class="kb jd">——这一操作将对<em class="kx"> x </em>中的每个输入向量重复，直到我们得到如图 2.2 所示的输出序列。</strong></p><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi on"><img src="../Images/328b7c46aea9e8cebe0e1f6fa173ef16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q1d4gzdBleLgcMUrI58D8g.jpeg"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图 2.7:得到新的向量序列的最后操作，<em class="oh"> z </em></p></figure><p id="d3ac" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">到目前为止，这种解释可能引发了一些问题:</p><ul class=""><li id="6c73" class="md me it kb b kc kd kg kh kk oo ko op ks oq kw or ml mm mn bi translated">我们计算的权重不是高度依赖于我们如何确定原始输入向量吗？</li><li id="d3f6" class="md me it kb b kc mp kg mq kk mr ko ms ks mt kw or ml mm mn bi translated">为什么我们要依赖向量的相似度？如果我们想在两个‘相异’的单词之间找到联系，比如“猫坐在马特上”的宾语和主语，该怎么办？</li></ul><p id="fadb" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">在下一篇文章中，我们将回答这些问题。我们将为每个不同的用途转换每个向量，从而更精确地定义单词<em class="kx">和</em>之间的关系，这样我们可以得到更像图 2.8 的输出。</p><figure class="nd ne nf ng gt nh gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi os"><img src="../Images/bb4b286e2573a151d6f01c0256d1fc69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*al_9j5AzCoqPaTUMjFRkjQ.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图 2.8—<strong class="bd og">橙色栏</strong>与<strong class="bd og">粉色栏</strong>中的“cross”关注的是哪个词？</p></figure></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><p id="a50d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">我希望你喜欢这篇文章，我感谢任何数量的掌声。欢迎在评论中留下任何反馈(积极的或建设性的),我会尽可能快地把它写下来。</p><p id="b1a9" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">对我的理解帮助最大，我非常感谢的人是 Peter Bloem(如果你像我一样喜欢数学优先的机器学习方法，他的<a class="ae mo" href="http://www.peterbloem.nl/blog/transformers" rel="noopener ugc nofollow" target="_blank">帖子</a>是一个很好的开始)和 Jay Alammar(如果你想从自上而下的角度开始，我推荐<a class="ae mo" href="https://jalammar.github.io/illustrated-transformer/" rel="noopener ugc nofollow" target="_blank">他的文章</a>)。</p><h1 id="c2e8" class="lf lg it bd lh li mu lk ll lm mv lo lp lq mw ls lt lu mx lw lx ly my ma mb mc bi translated">3.参考</h1><ol class=""><li id="8837" class="md me it kb b kc mf kg mg kk mh ko mi ks mj kw mk ml mm mn bi translated">插图变压器。(2018)<em class="kx"/><a class="ae mo" href="https://jalammar.github.io/illustrated-transformer/" rel="noopener ugc nofollow" target="_blank">https://jalammar.github.io/illustrated-transformer/</a>【2020 年 6 月 27 日访问】</li><li id="3ded" class="md me it kb b kc mp kg mq kk mr ko ms ks mt kw mk ml mm mn bi translated">从无到有的变形金刚。(2019)<a class="ae mo" href="http://www.peterbloem.nl/blog/transformers" rel="noopener ugc nofollow" target="_blank">http://www.peterbloem.nl/blog/transformers</a>。[2020 年 6 月 27 日获取]</li><li id="b4ec" class="md me it kb b kc mp kg mq kk mr ko ms ks mt kw mk ml mm mn bi translated">Vaswani A .等人，2017 年 12 月。你所需要的只是关注。第 31 届神经信息处理系统会议(NIPS 2017)，美国加州长滩。<a class="ae mo" href="https://papers.nips.cc/paper/7181-attention-is-all-you-need.pdf" rel="noopener ugc nofollow" target="_blank">https://papers . nips . cc/paper/7181-attention-is-all-you-need . pdf</a>【2020 年 6 月 27 日访问】。<a class="ae mo" href="https://arxiv.org/abs/1706.03762" rel="noopener ugc nofollow" target="_blank"> arXiv:1706.03762 </a></li><li id="eaee" class="md me it kb b kc mp kg mq kk mr ko ms ks mt kw mk ml mm mn bi translated">瓦斯瓦尼 a .等人 2018 年 3 月<a class="ae mo" href="https://arxiv.org/abs/1803.07416" rel="noopener ugc nofollow" target="_blank"> arXiv:1803.07416 </a>。<a class="ae mo" href="https://colab.research.google.com/github/tensorflow/tensor2tensor/blob/master/tensor2tensor/notebooks/hello_t2t.ipynb?authuser=2#scrollTo=OJKU36QAfqOC" rel="noopener ugc nofollow" target="_blank">互动笔记本</a>:【2020 年 6 月 29 日访问】</li></ol></div></div>    
</body>
</html>