<html>
<head>
<title>Interactive Geospatial Data Visualization with Geoviews in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python中的Geoviews进行交互式地理空间数据可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-geospatial-data-visualization-with-geoviews-in-python-7d5335c8efd1?source=collection_archive---------5-----------------------#2020-03-02">https://towardsdatascience.com/interactive-geospatial-data-visualization-with-geoviews-in-python-7d5335c8efd1?source=collection_archive---------5-----------------------#2020-03-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e4aa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何开始使用Geoviews的初学者指南。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e6eb6ff41b3b58c11c2f564ac1fe523f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2-ZZ03mXlc49J9W2UeJ_kA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="http://maps.tnc.org/migrations-in-motion/#4/19.00/-78.00" rel="noopener ugc nofollow" target="_blank">互动地图</a></p></figure><p id="b9be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">交互式数据可视化已经成为数据科学过程中不可或缺的一部分，以便试验和执行数据科学中的第一个探索过程。在Python生态系统中，很少有交互可视化地理数据的选项，但是，我认为Geoviews提供了易于使用的高级API和广泛的灵活性。</p><blockquote class="lv"><p id="c16d" class="lw lx it bd ly lz ma mb mc md me lu dk translated">G <a class="ae ky" href="https://geoviews.org/#" rel="noopener ugc nofollow" target="_blank"> eoViews </a>是一个<a class="ae ky" href="http://python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>库，它使得探索和可视化地理、气象和海洋数据集变得容易，例如那些用于天气、气候和遥感研究的数据集。</p></blockquote><p id="0667" class="pw-post-body-paragraph kz la it lb b lc mf ju le lf mg jx lh li mh lk ll lm mi lo lp lq mj ls lt lu im bi translated">在本教程中，我们将介绍使用Geoviews进行交互式地理数据可视化的基本组件。</p><p id="4a55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们导入本教程使用的库。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="f701" class="mp mq it ml b gy mr ms l mt mu">import pandas as pd<br/>import geopandas as gpd</span><span id="c969" class="mp mq it ml b gy mv ms l mt mu">import geoviews as gv<br/>import geoviews.feature as gf</span><span id="3db2" class="mp mq it ml b gy mv ms l mt mu">from geoviews import opts<br/>from cartopy import crs <br/>import geoviews.tile_sources as gts</span><span id="da54" class="mp mq it ml b gy mv ms l mt mu">gv.extension(‘bokeh’, ‘matplotlib’)</span></pre><p id="296a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们从一个简单的示例开始，展示如何使用Geoviews库绘制坐标。</p><h2 id="9059" class="mp mq it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">点地图</h2><p id="d420" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">让我们为这四个城市创建一个元组，保存城市的坐标和名称。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="fa0d" class="mp mq it ml b gy mr ms l mt mu">stockholm = ( 18.070625,59.320462, “Stockholm”)<br/>london = ( -0.135593, 51.507020, “London”)<br/>istanbul = ( 28.981856, 41.008327, “Istanbul”)<br/>mogadishu = ( 45.299626, 2.042388, “Mogadishu”)</span></pre><p id="c1c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用Geoviews功能创建简单的点。我们也可以用熊猫，但也没必要那样。一旦你创建了一个Geoviews特征，你可以通过<code class="fe ns nt nu ml b">dframe()</code>来创建一个数据框，如下所示。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="81f6" class="mp mq it ml b gy mr ms l mt mu">cities = gv.Points([stockholm, london, istanbul, mogadishu], vdims=”City”)<br/>cities.dframe()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/333e75272803b540f9a691a71f6958f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/1*6InEms7yBVkfvQe14nlXww.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">城市积分</p></figure><p id="4d49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们准备好了我们的第一张地图。你可以简单地调用这些特性，它会绘制点。然而，在这种情况下，我们使用<code class="fe ns nt nu ml b">opts </code>选项设置一些属性，如颜色和大小。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="2b46" class="mp mq it ml b gy mr ms l mt mu">cities.opts(opts.Points(global_extent=True, width=500, height=475, size=12, color=’black’))</span></pre><p id="58fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面显示的是点的地图。这是一个简单的情节，以后会修改。然而，我们的点是用它们的纬度和经度绘制的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/018f325d99b41119308733f2b69ea747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*KGVHJX2Ip3NN9wVy_68BXQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带地理视图的简单地图</p></figure><p id="90dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，这些点缺乏背景，而这正是我们需要底图的地方。在下一节中，我们将看到如何在绘图中包含底图。</p><h2 id="0df8" class="mp mq it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">底图</h2><p id="1c69" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">Geoviews提供了一些简洁的底图。让我们看看有什么可用的。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="2d13" class="mp mq it ml b gy mr ms l mt mu">gv.Layout([ts.relabel(name) for name, ts in gts.tile_sources.items()]).opts(<br/> ‘WMTS’, xaxis=None, yaxis=None, width=225, height=225).cols(6)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/ac4a6db1940f9c461dac0261c2600e95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iVfZV1LMNubFmSBfhvW4Lw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Geoviews中可用的底图</p></figure><p id="9773" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，有19种不同的底图可以在Geoviews中使用，所以让我们尝试其中的一些。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="8b1c" class="mp mq it ml b gy mr ms l mt mu">gv.tile_sources.OSM.opts( width=800, height=600)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/670e2845a8d31250e1b2bef3a31b893e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TwPg9oH8nC3PSNF1hjSrHw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">OpenStreetMap底图</p></figure><p id="c4d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图显示了全世界的OpenStreetMap(OSM)底图。虽然它现在是空的，但它是一个交互式地图。</p><p id="2df4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们叠加基础地图和我们上面创建的城市点。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="caf2" class="mp mq it ml b gy mr ms l mt mu">(gv.tile_sources.CartoDark * cities).opts(opts.Points(global_extent=True, width=800, height=600, size=8, color=’red’))</span></pre><p id="e32a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Geoviews中，这与使用*叠加任意两个(或更多)要素一样简单。在我们的例子中，我们覆盖了底图和城市点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/36f1cd54e1b18bb7b6f4be563647b538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*31lBSfcfkv-UeJqkZ2kMzQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Geoviews中带有底图的城市点</p></figure><p id="da60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上图所示，我们可以看到城市点在底图的帮助下处于正确的位置。在下一节中，我们将介绍地理数据科学中一个非常重要的组成部分——投影。</p><h2 id="b290" class="mp mq it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">预测</h2><p id="d815" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">当我们在地图制作中将地球变平时，我们会引入一些扭曲。有不同的预测，有些熟悉，有些不熟悉。让我们看看投影是如何扭曲地图的。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="329f" class="mp mq it ml b gy mr ms l mt mu">projections = [crs.RotatedPole, crs.LambertCylindrical, crs.Geostationary, <br/> crs.AzimuthalEquidistant, crs.OSGB, crs.EuroPP, crs.Gnomonic,<br/> crs.Mollweide, crs.OSNI, crs.Miller, crs.InterruptedGoodeHomolosine,<br/> crs.SouthPolarStereo, crs.Orthographic, crs.NorthPolarStereo, crs.Robinson,<br/> crs.LambertConformal, crs.AlbersEqualArea]</span><span id="3056" class="mp mq it ml b gy mv ms l mt mu">proj_layout = gv.Layout([gf.coastline.relabel(group=p.__name__).opts(projection=p(), backend=’matplotlib’)<br/> for p in projections])</span><span id="0e71" class="mp mq it ml b gy mv ms l mt mu">gv.output(proj_layout, backend=’matplotlib’)</span></pre><p id="2eaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了一些可用的不同投影。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/c1bfcadc0c8e9d4e60cfb1cd85ba0259.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*db-Ge-iWEx86fY7qXNboYA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">地理预测</p></figure><p id="7e5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们选择正交(M)投影来可视化失真。但是首先，我们用Geopandas读取世界各国的数据。Reviews与Geopandas库很好地集成在一起，可以随时使用。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="e5b4" class="mp mq it ml b gy mr ms l mt mu">world = gpd.read_file(gpd.datasets.get_path(‘naturalearth_lowres’))<br/>world.head()</span></pre><p id="c37e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">世界数据包含国家的多边形和一些其他特征，如pop_estimate、洲等..</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/f6a95b4dd714ab917035a98d43a5ca5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tznPMkFWTeCinJJVknUdHA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">世界人口地理数据框架</p></figure><p id="f2f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要绘制多边形数据，我们只需调用<code class="fe ns nt nu ml b">gv.Polygon()</code>并传递Geopandas GeodataFrame。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="ab85" class="mp mq it ml b gy mr ms l mt mu">world_poly = gv.Polygons(world).opts(color=”gray”, line_color=”white” )<br/></span></pre><p id="9a42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也创建城市点，但是这次做了一些调整。我们将点的大小减少到8，并给它一个红色。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="656f" class="mp mq it ml b gy mr ms l mt mu">cities_points = gv.Points(cities).opts(opts.Points(global_extent=True, width=800, height=600, size=8, color=’red’, tools=[‘hover’]))</span></pre><p id="00d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以叠加点和多边形。此外，我们提供了我们希望在<code class="fe ns nt nu ml b">opts</code>参数中使用的投影。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="7887" class="mp mq it ml b gy mr ms l mt mu">(world_poly * gf.ocean * cities_points).opts(projection=crs.Orthographic(central_longitude=0.1, central_latitude=22), global_extent=True, width=600, tools=[‘hover’])</span></pre><p id="efc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图描绘了以非洲为中心的正投影。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/0b88712d725d6da674399d979f16a1d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*hxgnt4VEaUkXw3fZZ_6llw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有城市点的正投影</p></figure><p id="9eca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们学习如何用Geoivews绘制Choropoleth地图</p><h2 id="ba9c" class="mp mq it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">等值区域图</h2><p id="00c8" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">您已经看到了如何绘制多边形，我们只添加一个组件来绘制choropleth地图。我们只提供希望用于choropleth的列的名称。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="74ac" class="mp mq it ml b gy mr ms l mt mu">gv.Polygons(world, vdims=[‘name’, ‘pop_est’, ‘gdp_md_est’], label=”World Population”).opts(color=’pop_est’,cmap=’blues’, colorbar=True, xaxis=None, yaxis=None,toolbar=’above’, width=1000, height=700, tools=[‘hover’])</span></pre><p id="16b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面显示的choropleth地图使用蓝色对每个国家的世界人口进行分类。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/790ddf822515bd5b6235d54b9d992756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lUjbw5mFyIqPw4kbO5qToA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等值区域图</p></figure><p id="80cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们将介绍Geoviews的一些简洁功能，即交互式小部件。</p><h2 id="1041" class="mp mq it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">交互式小工具</h2><p id="dd60" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">交互式小部件提供了一些灵活的方法来可视化数据。多亏了Geoviews，你现在可以用大量复杂的代码创建微件。在本例中，我们学习了如何对数据进行分组并只显示一个组。让我们说，我们想要显示我们想要可视化的大陆。</p><p id="7b4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们按大陆分组，与<code class="fe ns nt nu ml b">gv.Polygon()</code>一起策划。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="f853" class="mp mq it ml b gy mr ms l mt mu">coountries_grouped = gv.Polygons(world, vdims=[‘name’, ‘continent’],label=”Continent”).groupby(“continent”)<br/><br/></span></pre><p id="4a83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们绘图并提供绘图的宽度和高度选项。</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="8a53" class="mp mq it ml b gy mr ms l mt mu">continents = coountries_grouped.opts(width=600, height=400, tools=[‘hover’], infer_projection=True)<br/>continents</span></pre><p id="b4d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的GIF展示了只用上面两行代码创建的小部件。图中只显示选定的洲。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/8bdea57e1c4336933dd0fe9808cf2b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yrCk2wJfNQ3SWnFognSzwg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有地理视图的GIF下拉微件</p></figure><h2 id="98f5" class="mp mq it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">结论</h2><p id="6402" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">在本教程中，我们已经了解了如何使用Geoviews交互式打印地理空间数据。本教程涵盖了一些展示Geoviews基础知识的示例。你可能会从<a class="ae ky" href="https://geoviews.org/gallery/index.html" rel="noopener ugc nofollow" target="_blank">官方地理视图图库</a>中找到一些有趣的教程，所以试试吧。</p><p id="98d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要安装Geoviews，只需使用Conda:</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="d798" class="mp mq it ml b gy mr ms l mt mu">conda install -c pyviz geoviews</span></pre></div></div>    
</body>
</html>