<html>
<head>
<title>Recreating Netflixâ€™s quantile bootstrapping in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨ R ä¸­é‡å»ºç½‘é£çš„åˆ†ä½æ•°è‡ªä¸¾</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/recreating-netflixs-quantile-bootstrapping-in-r-a4739a69adb6?source=collection_archive---------44-----------------------#2020-05-26">https://towardsdatascience.com/recreating-netflixs-quantile-bootstrapping-in-r-a4739a69adb6?source=collection_archive---------44-----------------------#2020-05-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="8882" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘åœ¨åšä¸€äº›éšæ„çš„æ•°æ®ç§‘å­¦é˜…è¯»ï¼Œç„¶åå˜£ï¼æˆ‘åœ¨ç½‘é£çš„æŠ€æœ¯åšå®¢ä¸Šé‡æ–°å‘ç°äº†ä¸€ç¯‡å¾ˆæ£’çš„æ–‡ç« :<a class="ae ko" href="https://www.linkedin.com/in/martintingley/" rel="noopener ugc nofollow" target="_blank">é©¬ä¸Â·å»·åˆ©</a>çš„ã€Š<a class="ae ko" href="https://netflixtechblog.com/streaming-video-experimentation-at-netflix-visualizing-practical-and-statistical-significance-7117420f4e9a" rel="noopener ugc nofollow" target="_blank">ç½‘é£æµå¼è§†é¢‘å®éªŒ:å¯è§†åŒ–å®è·µå’Œç»Ÿè®¡æ„ä¹‰</a>ã€‹ã€‚</p><p id="dffb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å®ƒæœ‰ä»€ä¹ˆé…·çš„ï¼Ÿå®ƒæä¾›äº†ä¸€ç§å¯æ‰©å±•çš„æ–¹æ³•æ¥æ¢ç´¢å¤§è§„æ¨¡åœ¨çº¿å®éªŒä¸­çš„å¼‚æ„å¤„ç†æ•ˆæœã€‚å¿ƒæ™ºèåŒ–ï¼Ÿå¥½çš„ï¼Œæˆ‘å†è¯•ä¸€æ¬¡ã€‚å®ƒæè¿°äº†ä¸€ç§æ–¹å¼ï¼Œå®éªŒè€…å¯ä»¥å­¦åˆ°æ›´å¤šçš„ä¸œè¥¿ï¼Œè€Œä¸ä»…ä»…æ˜¯ä»–ä»¬æ˜¯å¦æœ‰æ•´ä½“å½±å“ã€‚ç›¸åï¼Œå®ƒè®©å®éªŒè€…çœ‹åˆ°ä»–ä»¬å¦‚ä½•å½±å“ä¸åŒçš„ç¾¤ä½“ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å¯ä»¥æ‰©å±•åˆ°å¤„ç†æµ·é‡æ•°æ®ï¼</p><p id="6731" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://netflixtechblog.com/data-compression-for-large-scale-streaming-experimentation-c20bfab8b9ce" rel="noopener ugc nofollow" target="_blank">é©¬ä¸å’Œæ–°åˆè‘—è€…æœ€è¿‘çš„æ–‡ç« </a>ï¼Œåˆ†äº«äº†ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ¥è¯´æ˜è¿™ç§æ–¹æ³•æ˜¯å¦‚ä½•å¸®åŠ©çš„ã€‚ä¸‹é¢æ‚¨å¯ä»¥çœ‹åˆ°ç”¨æˆ·çš„è§†é¢‘è´¨é‡å¦‚ä½•åœ¨ç°æœ‰çš„æµé…ç½®(ç”Ÿäº§ï¼Œé»‘è‰²è®¾ç½®ä¸ºé›¶)å’Œæ–°çš„(æ²»ç–—ï¼Œç´«è‰²)ä¹‹é—´è¿›è¡Œæ¯”è¾ƒã€‚</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/0ed03faaef57424dcc0624f97fd6096e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4cU5cbOKkX9pIdYR.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">å›¾æ¥è‡ªâ€œ<a class="ae ko" href="https://netflixtechblog.com/data-compression-for-large-scale-streaming-experimentation-c20bfab8b9ce" rel="noopener ugc nofollow" target="_blank">å¤§è§„æ¨¡æµå®éªŒçš„æ•°æ®å‹ç¼©</a>â€ã€‚è¯¦ç»†ä¿¡æ¯:â€œå¸¦é˜´å½±ç½®ä¿¡åŒºé—´çš„å·®å¼‚å›¾è¡¨æ˜ï¼Œåœ¨åˆ†å¸ƒçš„æœ€ä½ç™¾åˆ†ä½æ•°å¤„ï¼Œè§†é¢‘è´¨é‡æœ‰å®é™…å’Œç»Ÿè®¡ä¸Šçš„æ˜¾è‘—æé«˜â€</p></figure><p id="8008" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¯·è®°ä½ï¼Œç‰¹åˆ«ä¹‹å¤„åœ¨äºçœ‹åˆ°ä¸åŒç”¨æˆ·çš„å½±å“å¦‚ä½•ä¸åŒã€‚å¯¹è´¨é‡å·®çš„ç”¨æˆ·æœ‰ç§¯æçš„å½±å“(è§å·¦è¾¹)ï¼Œå¯¹å…¶ä»–äººæ²¡æœ‰æ˜¾è‘—å½±å“ã€‚è¿™æ„å‘³ç€äº§å“å›¢é˜Ÿå¯ä»¥ä»è¯´â€œè´¨é‡æé«˜äº†â€å˜æˆæ›´æœ‰ç”¨çš„è¯ï¼Œæ¯”å¦‚â€œæˆ‘ä»¬ä¸ºä½“éªŒæœ€å·®çš„ç”¨æˆ·æé«˜äº†è´¨é‡ï¼Œè€Œä¸å½±å“å·²ç»æœ‰é«˜è´¨é‡ä½“éªŒçš„ç”¨æˆ·ã€‚â€</p><p id="0202" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™å¯¹æˆ‘æ¥è¯´å¤ªæ£’äº†ï¼Œæˆ‘å†³å®šå‰”é™¤ç»†èŠ‚ï¼Œè¾¹èµ°è¾¹ç¼–ç å­¦ä¹ ã€‚æ›´å¥½çš„æ˜¯ï¼Œæˆ‘æ­£åœ¨åˆ†äº«æˆ‘æ‰€åšçš„æ¥èŠ‚çœä½ çš„æ—¶é—´ï¼</p><p id="bdf3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lf">æ³¨æ„:æˆ‘åœ¨æœ¬æ–‡ä¸­ç²˜è´´äº†ä¸€äº›æœ‰ç”¨çš„ä»£ç ç‰‡æ®µã€‚å¯ä»¥ä»æˆ‘çš„ GitHub repo </em>  <em class="lf">ä¸­</em> <a class="ae ko" href="https://github.com/drsimonj/RecreatingNetflixQuantileBootstrap" rel="noopener ugc nofollow" target="_blank"> <em class="lf">è®¿é—®å®Œæ•´çš„ä»£ç æ¼”ç»ƒã€‚</em></a></p><h1 id="7075" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">å…¥é—¨æŒ‡å—</h1><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="1a9e" class="mj lh it mf b gy mk ml l mm mn">library(tidyverse)</span></pre><h2 id="ea59" class="mj lh it bd li mo mp dn lm mq mr dp lq kb ms mt lu kf mu mv ly kj mw mx mc my bi translated">æ¨¡æ‹Ÿæ•°æ®</h2><p id="8b04" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated">æ²¡æœ‰æ•°æ®æˆ‘ä»¬åšä¸äº†ä»€ä¹ˆã€‚æˆ‘å°†ä¸ºä¸€ç»„å®éªŒå¯¹è±¡æ¨¡æ‹Ÿä¸€ä¸ªè¿ç»­çš„åº¦é‡æ ‡å‡†<code class="fe ne nf ng mf b">x</code>ã€‚æƒ³è±¡ä¸€ä¸‹<code class="fe ne nf ng mf b">x</code>å¯¹äºç½‘é£çš„æ¯ä¸€ä¸ªç”¨æˆ·æ¥è¯´ä»£è¡¨ç€ç±»ä¼¼â€œç§’å»¶è¿Ÿâ€çš„ä¸œè¥¿ã€‚ä¸ºäº†çœ‹èµ·æ¥æ›´åˆç†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¡æ–¹åˆ†å¸ƒæ•°æ®:</p><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="9f4a" class="mj lh it mf b gy mk ml l mm mn">x &lt;- rchisq(n = 200, df = 8)</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nh"><img src="../Images/f7b8b47b62d91c0046abdf6554b4d77e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZ0ubsx18WF-BWUYfUmW9A.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">æ¨¡æ‹ŸæŒ‡æ ‡çš„åˆ†å¸ƒï¼Œâ€œxâ€</p></figure><h2 id="164b" class="mj lh it bd li mo mp dn lm mq mr dp lq kb ms mt lu kf mu mv ly kj mw mx mc my bi translated">è·å–åˆ†ä½æ•°</h2><p id="736d" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated"><em class="lf">æé†’:</em> <a class="ae ko" href="https://en.wikipedia.org/wiki/Quantile" rel="noopener ugc nofollow" target="_blank"> <em class="lf">åˆ†ä½æ•°</em> </a> <em class="lf">æ˜¯å°†æ•°æ®åˆ†å‰²æˆä¸åŒå¤§å°/ç™¾åˆ†ä½æ•°çš„æ•°å€¼ã€‚ä¾‹å¦‚ï¼Œ0.5 åˆ†ä½æ•°å°†æ˜¯å°†æ•°æ®åˆ†æˆä¸¤åŠçš„å€¼(å› æ­¤ 50%çš„å€¼ä½äºè¯¥å€¼)ã€‚è¿™ä¹Ÿæ˜¯ä¸€ç§å«åšä¸­ä½æ•°çš„ç‰¹ä¾‹ã€‚. 25 åˆ†ä½æ•°å°†æ˜¯å¤§äºæ•°æ®çš„ 25%çš„å€¼ã€‚è¦æ‰¾åˆ°ç‰¹å®šçš„åˆ†ä½æ•°ï¼Œæ‚¨éœ€è¦æ’åˆ—æ•°æ®(ä»æœ€å°åˆ°æœ€å¤§)å¹¶åœ¨ x%ä½ç½®æ‰¾åˆ°æ•°æ®ç‚¹ã€‚</em></p><p id="1c3c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">r æœ‰ä¸€ä¸ªä¿çš®çš„åŠŸèƒ½ï¼Œ<code class="fe ne nf ng mf b">quantile()</code>ã€‚è®©æˆ‘ä»¬ç”¨å®ƒæ¥å¾—åˆ°ä¸€ä¸ªæ•°å€¼èŒƒå›´(ç”¨<code class="fe ne nf ng mf b">seq()</code>è®¾ç½®)ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="5422" class="mj lh it mf b gy mk ml l mm mn">quantile_df &lt;- tibble(percentile = seq(0, 1, by = .2)) %&gt;% <br/>  mutate(value = quantile(x, percentile))<br/>quantile_df</span><span id="b95b" class="mj lh it mf b gy ni ml l mm mn">#&gt; # A tibble: 6 x 2<br/>#&gt;   percentile value<br/>#&gt;        &lt;dbl&gt; &lt;dbl&gt;<br/>#&gt; 1        0    1.02<br/>#&gt; 2        0.2  4.08<br/>#&gt; 3        0.4  6.31<br/>#&gt; 4        0.6  8.58<br/>#&gt; 5        0.8 11.0 <br/>#&gt; 6        1   20.0</span></pre><p id="ce05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è½»æ¾ç‚¹ã€‚</p><h1 id="d61a" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">ç­¾åˆ°:æˆ‘ä»¬å·²ç»å¯ä»¥åšä¸€ç‚¹äº†</h1><p id="cfca" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated">è¿™å·²ç»è¶³ä»¥äº§ç”Ÿç±»ä¼¼ç½‘é£çš„æƒ…èŠ‚ã€‚æˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸¤ç§æƒ…å†µ(ç”Ÿäº§å’Œå¤„ç†)çš„æ•°æ®ï¼Œå¹¶è®¡ç®—æ¯ç§æƒ…å†µçš„åˆ†ä½æ•°ã€‚</p><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="a14d" class="mj lh it mf b gy mk ml l mm mn"><em class="lf"># Simulate data sets. For treatment, we'll bind two distributions<br/># skewed either side of production</em><br/>x_production &lt;- rchisq(200, 8)<br/>x_treatment  &lt;- c(rchisq(100, 12), rchisq(100, 4))</span><span id="8f71" class="mj lh it mf b gy ni ml l mm mn">group_quantiles_df &lt;- tibble(percentile = seq(0, 1, by = .2)) %&gt;% <br/>  mutate(production = quantile(x_production, percentile),<br/>         treatment  = quantile(x_treatment, percentile))<br/>group_quantiles_df</span><span id="c2de" class="mj lh it mf b gy ni ml l mm mn">#&gt; # A tibble: 6 x 3<br/>#&gt;   percentile production treatment<br/>#&gt;        &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;<br/>#&gt; 1        0         1.80     0.180<br/>#&gt; 2        0.2       4.76     2.83 <br/>#&gt; 3        0.4       6.44     5.22 <br/>#&gt; 4        0.6       7.96     8.04 <br/>#&gt; 5        0.8      10.3     13.2  <br/>#&gt; 6        1        27.9     36.2</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/f88a481725f46dc04d409811899fe287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ruroQWRzOUmqcIJFUFXQZw.png"/></div></div></figure><p id="3c11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç½‘é£å›¾æ˜¾ç¤ºäº†ä¸äº§é‡(äº§é‡= 0)ç›¸æ¯”çš„â€œå·®å¼‚â€ï¼Œå¯¹æˆ‘ä»¬æ¥è¯´æ˜¯è¿™æ ·çš„:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/4ca5177279956426353a931a91de0531.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DzZbovzL7DilvZyV0zsA4A.png"/></div></div></figure><p id="a025" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¯¹äºå‡ è¡Œä»£ç æ¥è¯´ç›¸å½“ä¸é”™ï¼å¥½å§ï¼Œæˆ‘ä»¬çš„æ•°æ®å’Œä»–ä»¬çš„ä¸åŒï¼Œä½†æ˜¯æ¦‚å¿µéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><h1 id="4e03" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">è‡ªä¸¾å·®å¼‚</h1><p id="74a6" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated">æˆ‘ä»¬å·²ç»èµ°äº†å¾ˆè¿œï¼Œä½†æ˜¯ç¼ºå°‘äº†ä¸€äº›é‡è¦çš„ä¸œè¥¿:ç½®ä¿¡åŒºé—´(åŸå§‹å›¾ä¸­çš„é€æ˜å¸¦)ã€‚è¿™äº›å‘Šè¯‰æˆ‘ä»¬ä¸¤ç»„ä¹‹é—´æ˜¯å¦æœ‰æ˜¾è‘—å·®å¼‚ã€‚è®©æˆ‘ä»¬è¿æ¥æŒ‘æˆ˜ï¼Œå¼€å§‹è¡ŒåŠ¨å§ã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„ç¬¬ä¸€ä»¶äº‹æ˜¯å¼•å¯¼ã€‚</p><p id="c721" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lf">æé†’:</em><a class="ae ko" href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)" rel="noopener ugc nofollow" target="_blank"><em class="lf">Bootstrapping</em></a><em class="lf">æ˜¯ä¸€ä¸ªéšæœºæŠ½å–ä¸€å †æ•°æ®è¿›è¡Œæ›¿æ¢çš„è¿‡ç¨‹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–°æ ·æœ¬è®¡ç®—æ‰€æœ‰æ„Ÿå…´è¶£çš„ç»Ÿè®¡æ•°æ®(ä¾‹å¦‚ï¼Œåˆ†ä½æ•°)ã€‚ç„¶åé‡å¤å¤šæ¬¡ï¼Œæ¯æ¬¡å¾—åˆ°çš„ç»“æœéƒ½ç•¥æœ‰ä¸åŒï¼Œå¹¶å»ºç«‹èµ·ä¸€ç§ä¸ç¡®å®šæ„Ÿã€‚</em></p><p id="d8f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨ R çš„<code class="fe ne nf ng mf b">sample()</code>å’Œ<code class="fe ne nf ng mf b">replace = TRUE</code>åˆ›å»ºä¸€ä¸ªè‡ªä¸¾ã€‚ç»“æœå°†æ˜¯ä¸€ä¸ªå‘é‡ï¼Œå…¶é•¿åº¦ä¸åŸå§‹æ•°æ®ç›¸åŒï¼Œä½†ä½¿ç”¨æ›¿æ¢å¯¹å…¶è¿›è¡Œé‡‡æ ·ã€‚</p><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="24bf" class="mj lh it mf b gy mk ml l mm mn">x_bootstrap &lt;- sample(x, replace = TRUE)</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/bce211d24b14b9ab57383f4be78519f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7XDqGOZNo2nPbfLZICkQ9g.png"/></div></div></figure><p id="3ea0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¯¹äºæ¯ä¸ªæ•°æ®é›†(ç”Ÿäº§å’Œå¤„ç†),æˆ‘ä»¬å¤šæ¬¡è¿™æ ·åšï¼Œæ¯æ¬¡éƒ½ä¿å­˜è‡ªä¸¾æ ·æœ¬çš„åˆ†ä½æ•°ã€‚</p><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="f1f5" class="mj lh it mf b gy mk ml l mm mn">n_bootstraps &lt;- 100<br/>quantile_df_template &lt;- tibble(percentile = seq(0, 1, by = .2))</span><span id="1515" class="mj lh it mf b gy ni ml l mm mn">bootstrapped_quantiles &lt;- map_df(seq_len(n_bootstraps),function(i) {<br/>  bootstrapped_production &lt;- sample(x_production, replace = TRUE)<br/>  bootstrapped_treatment  &lt;- sample(x_treatment, replace = TRUE)<br/>  <br/>  quantile_df_template %&gt;%<br/>    mutate(bootstrap = i,<br/>           production = quantile(bootstrapped_production,<br/>                                 percentile),<br/>           treatment  = quantile(bootstrapped_treatment, <br/>                                 percentile))<br/>})</span><span id="4c8a" class="mj lh it mf b gy ni ml l mm mn">bootstrapped_quantiles</span><span id="7547" class="mj lh it mf b gy ni ml l mm mn">#&gt; # A tibble: 600 x 4<br/>#&gt;    percentile bootstrap production treatment<br/>#&gt;         &lt;dbl&gt;     &lt;int&gt;      &lt;dbl&gt;     &lt;dbl&gt;<br/>#&gt;  1        0           1       1.80     0.180<br/>#&gt;  2        0.2         1       4.84     3.16 <br/>#&gt;  3        0.4         1       6.41     5.58 <br/>#&gt;  4        0.6         1       8.24     7.48 <br/>#&gt;  5        0.8         1      11.0     14.9  <br/>#&gt;  6        1           1      27.9     36.2  <br/>#&gt;  7        0           2       1.80     0.180<br/>#&gt;  8        0.2         2       4.80     2.93 <br/>#&gt;  9        0.4         2       7.14     5.07 <br/>#&gt; 10        0.6         2       8.78     7.79 <br/>#&gt; # â€¦ with 590 more rows</span></pre><p id="982f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™ç»™äº†æˆ‘ä»¬æ¯ä¸ªç™¾åˆ†ç‚¹çš„å¾ˆå¤šç‚¹(æ¯ä¸ªå¼•å¯¼ä¸€ä¸ªç‚¹)ã€‚ä¸‹å›¾ä»¥çº¢è‰²æ˜¾ç¤ºäº†åŸå§‹<code class="fe ne nf ng mf b">production</code>æ•°æ®çš„èŒƒå›´å’Œå¹³å‡å€¼ã€‚</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/cf37bd11b2dfcbbe33897554f5861de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iFnv1xkTnRh3Ws2gaUxleA.png"/></div></div></figure><p id="c9ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬çœŸæ­£æ„Ÿå…´è¶£çš„æ˜¯ä¸¤ç»„ä¹‹é—´çš„å·®å¼‚ã€‚è®©æˆ‘ä»¬ä¸ºç”Ÿäº§å’Œå¤„ç†è‡ªä¸¾åˆ†ä½æ•°ä¹‹é—´çš„â€œå·®å¼‚â€é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚ç„¶åä½¿ç”¨è¿™äº›æ•°æ®è®¡ç®—ä¸ç”Ÿäº§æ•°æ®ç›¸æ¯”ï¼Œå›´ç»•å¤„ç†æ¡ä»¶ç»˜åˆ¶çš„â€œèŒƒå›´â€ã€‚</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/9effd06ebe586f9a47ad20c0b70f2a91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QIPeE1HVv1uVXN78gUkfKw.png"/></div></div></figure><h1 id="c06c" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">ç½®ä¿¡åŒºé—´</h1><p id="f990" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated"><em class="lf">æé†’:</em> <a class="ae ko" href="https://en.wikipedia.org/wiki/Confidence_interval" rel="noopener ugc nofollow" target="_blank"> <em class="lf">ç½®ä¿¡åŒºé—´</em> </a> <em class="lf">ä¸ºå¯ä»¥è¢«è®¤ä¸ºä¸æˆ‘ä»¬è§‚å¯Ÿåˆ°çš„æ•°æ®æ˜¾è‘—ä¸åŒçš„ä¸œè¥¿è®¾å®šç•Œé™ã€‚æ˜¾è‘—æ€§ç”±ä¸€ä¸ªç§°ä¸ºæ˜¾è‘—æ€§æ ‡å‡†çš„æ¦‚ç‡é˜ˆå€¼å†³å®šã€‚</em></p><p id="e241" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸Šé¢æˆ‘ä»¬ç»˜åˆ¶äº†è‡ªä¸¾åˆ†ä½æ•°å·®å¼‚çš„å®Œæ•´èŒƒå›´ï¼Œä½†è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚æˆ‘ä»¬å®é™…ä¸Šæƒ³è¦ç½®ä¿¡åŒºé—´ã€‚ä¸ºäº†å¾—åˆ°è¿™äº›ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œä¸€å®šæ•°é‡çš„è‡ªä¸¾ï¼Œç„¶åè®¡ç®—å‡ºæˆªæ–­æœ€é«˜å’Œæœ€ä½è‡ªä¸¾å€¼çš„ç‚¹ï¼Œä»¥ç»™æˆ‘ä»¬è‡ªå·±ç•™ä¸‹ç‰¹å®šç™¾åˆ†æ¯”çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„æ˜¾è‘—æ€§æ ‡å‡†æ˜¯ 5%ï¼Œè¿™æ˜¯éå¸¸å…¸å‹çš„ï¼Œæˆ‘ä»¬å¸Œæœ›å¾—åˆ°ç æ‰æœ€ä½å’Œæœ€é«˜ 2.5%æ•°æ®çš„ç‚¹ã€‚é¢å¤–æ”¶è·:è¿™äº›å¯¹åº”äºè‡ªä¸¾å·®å¼‚çš„ 0.025 å’Œ 0.975 åˆ†ä½æ•°ï¼</p><p id="47d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™æ®µä»£ç å¯ä»¥è®©æˆ‘ä»¬å¿«é€Ÿåˆ°è¾¾ç›®çš„åœ°:</p><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="4e6d" class="mj lh it mf b gy mk ml l mm mn">bootstrapped_cis &lt;- <!-- -->bootstrapped_quantiles %&gt;% <br/>  mutate(q_dif = treatment - production) %&gt;% <br/>  group_by(percentile) %&gt;% <br/>  summarise(lower_bound = quantile(q_dif, .025),<br/>            upper_bound = quantile(q_dif, .975))</span><span id="9dd2" class="mj lh it mf b gy ni ml l mm mn">bootstrapped_cis</span><span id="ab11" class="mj lh it mf b gy ni ml l mm mn">#&gt; # A tibble: 6 x 3<br/>#&gt;   percentile lower_bound upper_bound<br/>#&gt;        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;<br/>#&gt; 1        0        -2.28       -1.00 <br/>#&gt; 2        0.2      -2.53       -0.984<br/>#&gt; 3        0.4      -2.09       -0.351<br/>#&gt; 4        0.6      -1.19        2.03 <br/>#&gt; 5        0.8       0.825       4.75 <br/>#&gt; 6        1        -4.72       16.3</span></pre><p id="b403" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬ç°åœ¨å¯ä»¥å°†è¿™äº›æ•°æ®ç»˜åˆ¶æˆé€æ˜å¸¦ï¼</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/780c6c75a42a4f4997d9bf234b305099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uBzOql3mNshJA7jHZuvTog.png"/></div></div></figure><p id="454e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">çœ‹èµ·æ¥ä¸é”™ï¼ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œæˆ‘ä»¬çš„æ²»ç–—ç»„æ˜æ˜¾ä½äºè¾ƒä½ç™¾åˆ†ä½æ•°çš„äº§é‡ï¼Œå¯èƒ½é«˜äº 80%å·¦å³ï¼Œåœ¨å…¶ä»–åœ°æ–¹æ²¡æœ‰ä¸åŒã€‚</p><h1 id="da47" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">æé«˜æ•°å­—</h1><p id="7af3" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated">ä½ å·²ç»å¾—åˆ°äº†æé«˜æ•°å­—æ‰€éœ€çš„ä¸€åˆ‡ã€‚æ›´å¤§çš„æ•°æ®é›†ï¼Œæ›´å¤šçš„æ•°é‡ï¼Œæ›´å¤šçš„å¼•å¯¼ã€‚æ‚¨å¯èƒ½ä¼šå¾—åˆ°è¿™æ ·çš„ç»“æœ:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/129c1dfe87ba4e2c334b2dd081984fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iK95F8_ZA83rCM1BOLRfBg.png"/></div></div></figure><p id="3c6e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°åœ¨æˆ‘ä»¬æ­£åœ¨è°ˆè¯ï¼</p><h1 id="1fd1" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">æ˜¯æ—¶å€™è·å¾—(æ›´å¤š)æŠ€æœ¯äº†</h1><p id="0dfa" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated">å¥½äº†ï¼Œè¯¥è®¤çœŸäº†ã€‚Martin ç»§ç»­åˆ†äº«å¦‚ä½•å¤„ç†(1)å¤šé‡æ¯”è¾ƒå’Œ(2)å¤§é‡æ•°æ®çš„â€œä¸€äº›æŠ€æœ¯ç»†èŠ‚â€ã€‚è®©æˆ‘ä»¬æŒ‰é¡ºåºè§£å†³å®ƒä»¬ã€‚</p><h2 id="bf06" class="mj lh it bd li mo mp dn lm mq mr dp lq kb ms mt lu kf mu mv ly kj mw mx mc my bi translated">å¤šé‡æ¯”è¾ƒ</h2><p id="d59b" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated">å½“ä½ è¿è¡Œä¸€ä¸ªå®éªŒå¹¶æ¯”è¾ƒç»„å¹³å‡å€¼æ—¶ï¼Œä½ åšäº†ä¸€ä¸ªç»Ÿè®¡æµ‹è¯•ã€‚ä½ å¯ä»¥ä½¿ç”¨ 95%çš„ç½®ä¿¡åŒºé—´ï¼Œæœ‰ 5%çš„æœºä¼šé”™è¯¯åœ°è¯´æœ‰å·®å¼‚ï¼Œè€Œå®é™…ä¸Šæ²¡æœ‰å·®å¼‚(ç»Ÿè®¡å­¦å®¶è¯´æœ‰ 5%çš„å‡é˜³æ€§ç‡)ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å®é™…ä¸Šè¿è¡Œäº†è®¸å¤šæµ‹è¯•:æ¯ä¸ªåˆ†ä½æ•°ä¸€ä¸ªã€‚Lots =å€æ•°ï¼›æµ‹è¯•=æ¯”è¾ƒã€‚<a class="ae ko" href="https://en.wikipedia.org/wiki/Multiple_comparisons_problem" rel="noopener ugc nofollow" target="_blank">å¤šé‡æ¯”è¾ƒ</a>ï¼è¿™å¯èƒ½ä¸å¤ªç›´è§‚ï¼Œä½†è¯·ç›¸ä¿¡æˆ‘ï¼Œå¯¹æ‰€æœ‰è¿™äº›æµ‹è¯•ä½¿ç”¨ 95%çš„ç½®ä¿¡åŒºé—´ä¼šä½¿ä½ å‡ºé”™çš„å‡ ç‡å¤§å¤§é«˜äº 5%ã€‚ä¸é…·ğŸ˜¬</p><p id="38f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å¯ä»¥è°ƒæ•´æ˜¾è‘—æ€§é˜ˆå€¼ï¼Œä½¿å‡ºé”™çš„æ€»ä½“å‡ ç‡è¾¾åˆ°æœŸæœ›çš„æ°´å¹³ã€‚è¿™å¯ä»¥é€šè¿‡<a class="ae ko" href="https://en.wikipedia.org/wiki/Bonferroni_correction" rel="noopener ugc nofollow" target="_blank"> Bonferroni ä¿®æ­£</a>æ¥å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥ä¼°è®¡ç‹¬ç«‹æµ‹è¯•çš„æ•°é‡(è€Œä¸æ˜¯å› ä¸ºä½¿ç”¨äº†æ›´å¤šçš„åˆ†ä½æ•°è€Œå—åˆ°æƒ©ç½š)ã€‚æˆ‘å…ˆä¸ä¸ºæ–°æ‰‹è¯»è€…è§£é‡Šè¿™ä¸ªï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä»£ç ã€‚</p><p id="a9d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">PSA:æˆ‘å·²ç»æ ¹æ®æˆ‘æ‰€èƒ½è¯»åˆ°çš„æ‹¼å‡‘äº†è¿™äº›ï¼Œä½†æˆ‘æ„¿æ„æ¥å—ä¿®æ”¹ã€‚</p><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="1db6" class="mj lh it mf b gy mk ml l mm mn"><em class="lf"># Sum of the correlations between bootstrapped<br/># differences at each quantile</em><br/>cor_sum &lt;- bootstrapped_quantiles %&gt;%<br/>  transmute(bootstrap, percentile, <br/>            q_dif = treatment - production) %&gt;% <br/>  pivot_wider(names_from = percentile, values_from = q_dif) %&gt;% <br/>  select(-bootstrap) %&gt;% <br/>  cor() %&gt;% <br/>  .[-upper.tri(.)] %&gt;% <br/>  sum()</span><span id="226c" class="mj lh it mf b gy ni ml l mm mn"><em class="lf"># Estimated number of independent tests</em><br/>n_tests_estimate &lt;- length(quantile_seq) ^ 2 / cor_sum<br/>n_tests_estimate</span><span id="7a4e" class="mj lh it mf b gy ni ml l mm mn">#&gt; [1] 2.289841</span><span id="1ec1" class="mj lh it mf b gy ni ml l mm mn"># Bonferroni adjusted confidence interval<br/>desired_error_rate  &lt;- 0.05<br/>adjusted_error_rate &lt;- desired_error_rate / n_tests_estimate<br/>adjusted_error_rate</span><span id="9b31" class="mj lh it mf b gy ni ml l mm mn">#&gt; [1] <!-- -->0.022</span></pre><p id="7f14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸ºäº†å¤„ç†æˆ‘ä»¬çš„å¤šé‡æ¯”è¾ƒå¹¶ä¿è¯åªæœ‰ 5%çš„é”™è¯¯ç‡ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ 97.8%çš„ç½®ä¿¡åŒºé—´(ä»<code class="fe ne nf ng mf b">1 â€” 0.022</code>)è€Œä¸æ˜¯ 95% ( <code class="fe ne nf ng mf b">1 â€” 0.05</code>)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸æ˜¯åœ¨ 0.025 å’Œ 0.975 åˆ†ä½æ•°å¤„æˆªæ–­è‡ªä¸¾æ•°æ®ï¼Œè€Œæ˜¯åœ¨ 0.011 å’Œ 0.989 å¤„æˆªæ–­ã€‚</p><p id="ab4e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™æ˜¾ç¤ºäº†ä¸åŒä¹‹å¤„:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/001555c35392a121940746a83bb57bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E6lm-rzJfWYtzpp17137WQ.png"/></div></div></figure><p id="471f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¯·æ³¨æ„ï¼Œç»è¿‡é€‚å½“è°ƒæ•´çš„ç»¿è‰²ç½®ä¿¡åŒºé—´æ¯”åŸå§‹åŒºé—´æ›´å®½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯¹ç»Ÿè®¡æ˜¾è‘—æ€§çš„è¯„ä¼°æ›´ä¸ºä¿å®ˆï¼Œå°†æˆ‘ä»¬çš„æ€»ä½“è¯¯å·®ç‡ä¿æŒåœ¨ 5%ã€‚</p><p id="370c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸é”™ï¼</p><h2 id="0c9d" class="mj lh it bd li mo mp dn lm mq mr dp lq kb ms mt lu kf mu mv ly kj mw mx mc my bi translated">åŸºäºå¤§æ•°æ®çš„å¿«é€Ÿå¼•å¯¼</h2><p id="753d" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡éƒ½å¾ˆé…·ï¼Œä½†å¦‚æœä½ æœ‰ä»æ•°åƒæ¬¡å®éªŒä¸­äº§ç”Ÿçš„å¤§é‡æ•°æ®ï¼Œå°±ä¼šå´©æºƒã€‚èªæ˜çš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡å°†æ•°æ®å‹ç¼©åˆ°å‡åŒ€å¤§å°çš„æ¡¶ä¸­æ¥è¿‘ä¼¼è®¡ç®—ç»“æœï¼Œå¹¶å¼•å¯¼è¿™äº›æ¡¶è€Œä¸æ˜¯åŸå§‹æ•°æ®ã€‚è¿™æ„å‘³ç€æ— è®ºåŸå§‹å¤§å°å¦‚ä½•ï¼Œæ•°æ®éƒ½å¯ä»¥å‹ç¼©åˆ°è®¾å®šæ•°é‡çš„å­˜å‚¨æ¡¶ã€‚</p><p id="2041" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lf">æç¤º:æˆ‘å‘ç°è·Ÿéšæœ€è¿‘çš„æ–‡ç« </em>  <em class="lf">ä¼šæ›´å®¹æ˜“ç†è§£è¿™ä¸ªè¯é¢˜ã€‚å¦‚æœä½ æƒ³çœ‹ä¸€ä¸ªä¸åŒçš„åº”ç”¨ç¨‹åºï¼Œè¯·é˜…è¯»æˆ‘ä¹‹å‰å…³äºå›å½’çš„æ–‡ç« ã€‚</em></p><p id="34df" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç¬¬ä¸€æ­¥ï¼Œè·å–æœ‰åºå­˜å‚¨æ¡¶ä¸­çš„æ•°æ®ï¼Œè·Ÿè¸ªæ¯ä¸ªå­˜å‚¨æ¡¶çš„è®¡æ•°å’Œæ±‡æ€»ç»Ÿè®¡æ•°æ®(æˆ‘å°†ä½¿ç”¨ä¸­é—´å€¼)ã€‚æˆ‘ä»¬å¯ä»¥åœ¨<code class="fe ne nf ng mf b">cut_number()</code>(æ¥è‡ª tidyverse è‡ªå¸¦çš„ ggplot2)çš„å¸®åŠ©ä¸‹åšå¦‚ä¸‹æ“ä½œã€‚</p><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="5e02" class="mj lh it mf b gy mk ml l mm mn"># Define number of buckets per group<br/>n_buckets &lt;- 100</span><span id="5c17" class="mj lh it mf b gy ni ml l mm mn"># Compress data into buckets of even counts<br/>compressed_data &lt;- tibble(production = x_production, <br/>                          treatment = x_treatment) %&gt;% <br/>  pivot_longer(c(production, treatment),<br/>               names_to = "group", values_to = "x") %&gt;% <br/>  group_by(group) %&gt;% <br/>  mutate(x_bucket = cut_number(x, n_buckets)) %&gt;% <br/>  group_by(group, x_bucket) %&gt;% <br/>  summarise(count = n(),<br/>            x = median(x)) %&gt;%<br/>  ungroup()</span><span id="0362" class="mj lh it mf b gy ni ml l mm mn">compressed_data</span><span id="a637" class="mj lh it mf b gy ni ml l mm mn">#&gt; # A tibble: 200 x 4<br/>#&gt;    group      x_bucket    count     x<br/>#&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt;<br/>#&gt;  1 production (1.53,1.94]    10  1.69<br/>#&gt;  2 production (1.94,2.15]    10  2.06<br/>#&gt;  3 production (10.1,10.3]    10 10.2 <br/>#&gt;  4 production (10.3,10.4]    10 10.4 <br/>#&gt;  5 production (10.4,10.6]    10 10.5 <br/>#&gt;  6 production (10.6,10.8]    10 10.7 <br/>#&gt;  7 production (10.8,10.9]    10 10.8 <br/>#&gt;  8 production (10.9,11]      10 11.0 <br/>#&gt;  9 production (11,11.2]      10 11.1 <br/>#&gt; 10 production (11.2,11.3]    10 11.2 <br/>#&gt; # â€¦ with 190 more rows</span></pre><p id="5424" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸‹ä¸€ä¸ªæŒ‘æˆ˜æ˜¯è·å¾—åˆ†ä½æ•°ï¼Œå› ä¸º<code class="fe ne nf ng mf b">quantile()</code>ä¸å†å·¥ä½œäº†ã€‚æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ã€‚è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç´¯ç§¯ç™¾åˆ†æ¯”åˆ—ï¼Œå¹¶ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æ ¹æ®éœ€è¦æœç´¢æ•°æ®æ¡†ã€‚</p><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="cfe4" class="mj lh it mf b gy mk ml l mm mn"># Add cumulative percentile to compressed data for easy search<br/>compressed_data &lt;- compressed_data %&gt;% <br/>  group_by(group) %&gt;% <br/>  arrange(x) %&gt;% <br/>  mutate(cum_percentile = cumsum(count) / sum(count)) %&gt;% <br/>  ungroup()<br/><br/>compressed_data</span><span id="35d3" class="mj lh it mf b gy ni ml l mm mn">#&gt; # A tibble: 200 x 5<br/>#&gt;    group      x_bucket       count     x cum_percentile<br/>#&gt;    &lt;chr&gt;      &lt;chr&gt;          &lt;int&gt; &lt;dbl&gt;          &lt;dbl&gt;<br/>#&gt;  1 treatment  [0.0539,0.412]    10 0.223           0.01<br/>#&gt;  2 treatment  (0.412,0.547]     10 0.447           0.02<br/>#&gt;  3 treatment  (0.547,0.769]     10 0.675           0.03<br/>#&gt;  4 treatment  (0.769,0.881]     10 0.812           0.04<br/>#&gt;  5 treatment  (0.881,0.986]     10 0.926           0.05<br/>#&gt;  6 treatment  (0.986,1.08]      10 1.01            0.06<br/>#&gt;  7 production [0.493,1.53]      10 1.08            0.01<br/>#&gt;  8 treatment  (1.08,1.21]       10 1.11            0.07<br/>#&gt;  9 treatment  (1.21,1.33]       10 1.23            0.08<br/>#&gt; 10 treatment  (1.33,1.43]       10 1.38            0.09<br/>#&gt; # â€¦ with 190 more rows</span><span id="971f" class="mj lh it mf b gy ni ml l mm mn"><em class="lf"># Function we can reuse to get `x` quantile from the compressed data</em><br/>x_at_percentile &lt;- <strong class="mf iu">function</strong>(percentile, compressed_df) {<br/>  i &lt;- 1<br/>  <strong class="mf iu">while</strong> (compressed_df$cum_percentile[i] &lt; percentile) {<br/>    i &lt;- i + 1<br/>  }<br/>  <strong class="mf iu">return</strong> (compressed_df$x[i])<br/>}</span><span id="65d7" class="mj lh it mf b gy ni ml l mm mn"># Test<br/>compressed_data %&gt;% <br/>  filter(group == "production") %&gt;% <br/>  x_at_percentile(.5, .)</span><span id="3194" class="mj lh it mf b gy ni ml l mm mn">#&gt; [1] 7.361729</span></pre><p id="0b82" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æœ€å¥½ç¡®ä¿å®ƒèƒ½å·¥ä½œï¼ä¸‹é¢æˆ‘ç”¨è¿™ä¸¤ç§æ–¹æ³•ä»åŸå§‹æ•°æ®å’Œå‹ç¼©æ•°æ®ä¸­å¾—åˆ°ç”Ÿäº§æ•°æ®çš„åˆ†ä½æ•°ã€‚</p><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="b9dc" class="mj lh it mf b gy mk ml l mm mn">quantile_df &lt;- tibble(percentile = seq(0, 1, by = .1)) %&gt;%<br/>  mutate(original = quantile(x_production, percentile)) %&gt;%<br/>  mutate(compressed = map_dbl(<br/>    percentile,<br/>    x_at_percentile,<br/>    filter(compressed_data, group == "production")<br/>  ))</span></pre><p id="6470" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å½“æˆ‘ä»¬ç»˜åˆ¶åŸå§‹å’Œå‹ç¼©çš„ç»“æœæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/673761386680d64bb5e671a1ab1710b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I1Oioa1r2JroRplXa4iYEg.png"/></div></div></figure><p id="348f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¿‘ä¼¼å€¼ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨å¤ªå¤šçš„æ•°æ®æˆ–æ¡¶ã€‚è¿™åªä¼šéšç€æ›´å¤šçš„åŸå§‹æ•°æ®å’Œæ›´å¤šçš„æ¡¶è€Œå˜å¾—æ›´å‡†ç¡®(æ˜¾ç„¶â€œå‡ åƒâ€åº”è¯¥å¯ä»¥åšåˆ°)ã€‚</p><p id="1ae9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬ç°åœ¨å¯ä»¥å‹ç¼©æˆ‘ä»¬çš„æ•°æ®ï¼Œæ— è®ºæ•°æ®æœ‰å¤šå¤§ï¼Œéƒ½å¯ä»¥å¤§è§„æ¨¡ç®¡ç†ï¼</p><p id="8e27" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬éœ€è¦çŸ¥é“çš„æœ€åä¸€ä»¶äº‹æ˜¯å¦‚ä½•å¼•å¯¼å‹ç¼©æ•°æ®é›†ã€‚æˆ‘ä»¬ç°åœ¨å¯¹å‹ç¼©æ•°æ®å¸§çš„è¡Œè¿›è¡Œé‡‡æ ·(åŒ…å«è®¡æ•°å’Œæ±‡æ€»å€¼)ã€‚è¿™å¯ä»¥é€šè¿‡<code class="fe ne nf ng mf b">sample_n()</code>(æ¥è‡ª tidyverse é™„å¸¦çš„ dplyr)æ¥å®Œæˆã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®ƒå¯¹å‹ç¼©çš„ç”Ÿäº§æ•°æ®è¿›è¡Œé‡‡æ ·ï¼Œå¹¶é‡æ–°è®¡ç®—ç´¯ç§¯çš„ç™¾åˆ†ä½æ•°:</p><pre class="kq kr ks kt gt me mf mg mh aw mi bi"><span id="40ca" class="mj lh it mf b gy mk ml l mm mn"># A bootstrap of the compressed data<br/>compressed_data %&gt;% <br/>  filter(group == "production") %&gt;% <br/>  sample_n(n(), replace = TRUE) %&gt;% <br/>  arrange(x) %&gt;% <br/>  mutate(cum_percentile = cumsum(count) / sum(count))</span><span id="9c71" class="mj lh it mf b gy ni ml l mm mn">#&gt; # A tibble: 100 x 5<br/>#&gt;    group      x_bucket    count     x cum_percentile<br/>#&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt;          &lt;dbl&gt;<br/>#&gt;  1 production (1.53,1.94]    10  1.69           0.01<br/>#&gt;  2 production (2.15,2.39]    10  2.19           0.02<br/>#&gt;  3 production (2.39,2.65]    10  2.48           0.03<br/>#&gt;  4 production (2.39,2.65]    10  2.48           0.04<br/>#&gt;  5 production (3.29,3.38]    10  3.31           0.05<br/>#&gt;  6 production (3.38,3.51]    10  3.43           0.06<br/>#&gt;  7 production (3.69,3.82]    10  3.75           0.07<br/>#&gt;  8 production (3.69,3.82]    10  3.75           0.08<br/>#&gt;  9 production (3.92,4.05]    10  4.02           0.09<br/>#&gt; 10 production (3.92,4.05]    10  4.02           0.1 <br/>#&gt; # â€¦ with 90 more rows</span></pre><p id="0eca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¯·æ³¨æ„ï¼Œæ­£å¦‚åŸå§‹æ•°æ®ä¸€æ ·ï¼Œå¼•å¯¼ä¼šå¯¼è‡´è¡Œè¢«å¤šæ¬¡é‡‡æ ·(ä¾‹å¦‚ï¼Œè¡Œ 3 å’Œ 4ã€è¡Œ 7 å’Œ 8 æˆ–è¡Œ 9 å’Œ 10)ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬é‡æ–°è®¡ç®—ç™¾åˆ†ç‚¹ï¼Œä¸€åˆ‡éƒ½åº”è¯¥å·¥ä½œã€‚</p><p id="4fce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lf">æ³¨æ„:å¦‚æœæ¯è¡Œçš„è®¡æ•°ä¸ç›¸ç­‰ï¼Œæ‚¨éœ€è¦åšä¸€äº›åŠ æƒï¼Œä»¥ç¡®ä¿å…·æœ‰è¾ƒé«˜è®¡æ•°çš„è¡Œä»¥è¾ƒé«˜çš„é€Ÿç‡è¢«é‡‡æ ·ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†æ•°æ®åˆ†æˆå¤§å°ç›¸ç­‰çš„ç»„ï¼Œå› æ­¤å¯ä»¥å¿½ç•¥è¿™ä¸€ç‚¹ï¼Œå¹¶ä»¥ç›¸ç­‰çš„æ¦‚ç‡å¯¹è¡Œè¿›è¡Œé‡‡æ ·ã€‚</em></p><h1 id="1d85" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">é‚£éƒ½æ˜¯ä¹¡äº²ä»¬ï¼</h1><p id="b8a6" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated">å—¯ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ã€‚è¿™äº›éƒ½æ˜¯ä½ å¼€å§‹å¤§è§„æ¨¡å®æ–½ç½‘é£åˆ†ä½æ•°è‡ªä¸¾æŠ€æœ¯éœ€è¦è§£å†³çš„é—®é¢˜ã€‚</p><p id="947c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘è¿˜æ˜¯è¦ç»™ä½ ä¸€ä¸ªé‡è¦çš„è­¦å‘Šã€‚æ’°å†™æœ¬æ–‡å’Œä»£ç æ˜¯ä¸ºäº†å¸®åŠ©ç†è§£æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚è¿™ç»å¯¹ä¸æ˜¯ä¸ºäº†è¡¨ç°ã€‚æ‰€ä»¥ä¸è¦æŠŠå®ƒæ‰”è¿›ä»»ä½•å®éªŒç®¡é“ï¼Œå› ä¸º s*ï¼%ä¼šå‡ºé—®é¢˜ã€‚æƒ³è¦å¯åŠ¨å¹¶è¿è¡Œè¿™é¡¹æŠ€æœ¯å—ï¼Ÿä½¿ç”¨ä¸€ä¸ªå°æ•°æ®é›†æ¥è¯•éªŒè¿™äº›ä»£ç ï¼Œç›´åˆ°æ‚¨ç†è§£å‘ç”Ÿäº†ä»€ä¹ˆã€‚ç„¶åæ…¢æ…¢åœ°æ”¹è¿›æ€§èƒ½ï¼Œåå¤æµ‹è¯•å‡†ç¡®æ€§å’Œå¤„ç†æ›´å¤§æ•°æ®çš„èƒ½åŠ›ã€‚å®Œæˆåï¼Œè¯·å›åˆ°è¿™é‡Œåˆ†äº«æ‚¨çš„ä½œå“:)</p></div></div>    
</body>
</html>