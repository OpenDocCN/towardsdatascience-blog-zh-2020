<html>
<head>
<title>Six essential plots in time series data analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列数据分析中的六个关键点</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/six-essential-plots-for-time-series-data-analysis-477bd7e778ac?source=collection_archive---------18-----------------------#2020-04-29">https://towardsdatascience.com/six-essential-plots-for-time-series-data-analysis-477bd7e778ac?source=collection_archive---------18-----------------------#2020-04-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7dbe" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">季节性图、滚动窗口、时间序列分解等</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/201065fa7c3f298e03ac6f8ed96f3e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fFYejcRTG5LYAGM6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@campaign_creators?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">活动创作者</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><blockquote class="kz"><p id="4ee2" class="la lb it bd lc ld le lf lg lh li lj dk translated">一幅画胜过千言万语</p></blockquote><p id="e220" class="pw-post-body-paragraph lk ll it lm b ln lo ju lp lq lr jx ls lt lu lv lw lx ly lz ma mb mc md me lj im bi translated">对，没错，一图胜千言；在数据科学中，一张图片可能胜过千言万语！</p><p id="1406" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">数据可视化是数据科学的基础，无论是用于探索性数据分析、构建更好的模型，还是用于可视化<a class="ae ky" rel="noopener" target="_blank" href="/storytelling-with-data-a-data-visualization-guide-for-business-professionals-97d50512b407">讲故事</a>。仅仅通过目测箱线图或散点图，一双有经验的眼睛可以瞬间获得比阅读表格中的描述性统计数据更多的信息。</p><p id="3921" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">时间序列数据更是如此。很难想象没有时间序列图的时间序列分析。</p><p id="228a" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">下面我将展示六个这样的基本情节，并介绍如何创建每一个情节，解释并从中提取信息。我将在这个练习中使用R，因为它是一个特别为时间序列分析设计的超级有用的库<code class="fe mk ml mm mn b">fpp2</code>,你只需要几行代码就可以完成大多数绘图。</p><p id="e17b" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">这是我们将要探索的情节:</p><ol class=""><li id="215a" class="mo mp it lm b ln mf lq mg lt mq lx mr mb ms lj mt mu mv mw bi translated">一个简单的时间序列图</li><li id="6fe4" class="mo mp it lm b ln mx lq my lt mz lx na mb nb lj mt mu mv mw bi translated">滚动窗</li><li id="38a4" class="mo mp it lm b ln mx lq my lt mz lx na mb nb lj mt mu mv mw bi translated">季节性绘图</li><li id="d9d3" class="mo mp it lm b ln mx lq my lt mz lx na mb nb lj mt mu mv mw bi translated">亚季节图</li><li id="1238" class="mo mp it lm b ln mx lq my lt mz lx na mb nb lj mt mu mv mw bi translated">时间序列分解</li><li id="8ece" class="mo mp it lm b ln mx lq my lt mz lx na mb nb lj mt mu mv mw bi translated">自相关(ACF)图</li></ol><p id="b10b" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">让我们卷起袖子吧。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h2 id="7edd" class="nj nk it bd nl nm nn dn no np nq dp nr lt ns nt nu lx nv nw nx mb ny nz oa ob bi translated">图书馆和数据</h2><p id="e158" class="pw-post-body-paragraph lk ll it lm b ln oc ju lp lq od jx ls lt oe lv lw lx of lz ma mb og md me lj im bi translated">做下面的视觉效果你所需要的就是<code class="fe mk ml mm mn b">fpp2</code>库。它附带了必要的依赖项，所以一开始只使用一个库应该没问题。</p><p id="2eb2" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">要了解这个库的更多信息，这里有Rob J Hyndman和George Athanasopoulos的<a class="ae ky" href="https://cran.r-project.org/web/packages/fpp2/fpp2.pdf" rel="noopener ugc nofollow" target="_blank">包文档</a>和一本开放访问的书<a class="ae ky" href="https://otexts.com/fpp2/" rel="noopener ugc nofollow" target="_blank">预测:原则和实践</a>。</p><pre class="kj kk kl km gt oh mn oi oj aw ok bi"><span id="9fdc" class="nj nk it mn b gy ol om l on oo">library("fpp2")</span></pre><p id="31da" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">本练习的数据来自<a class="ae ky" href="https://www.census.gov/econ/currentdata/dbsearch?program=RESSALES&amp;startYear=1963&amp;endYear=2018&amp;categories=SOLD&amp;dataType=TOTAL&amp;geoLevel=US&amp;notAdjusted=1&amp;submit=GET+DATA&amp;releaseScheduleId=" rel="noopener ugc nofollow" target="_blank">人口普查局存储库</a>。该数据集包含从1963年1月到2018年12月每月售出的新独栋房屋数量。这些数据是以千套住房为单位报告的，没有经过季节调整。</p><p id="f049" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">读入后，需要进行一些格式化，以便<code class="fe mk ml mm mn b">fpp2</code>包将它识别为一个时间序列对象。</p><pre class="kj kk kl km gt oh mn oi oj aw ok bi"><span id="ff76" class="nj nk it mn b gy ol om l on oo"># read in data <br/>data = read.csv("../NewSingleFamilyHousesSold.csv", skip = 6)</span><span id="cebc" class="nj nk it mn b gy op om l on oo"># drop "Period" column<br/>data$Period &lt;- NULL</span><span id="47b6" class="nj nk it mn b gy op om l on oo"># rename column<br/>names(data) &lt;- c("value")</span><span id="3aa6" class="nj nk it mn b gy op om l on oo"># convert dataframe to a ts object<br/>df = ts(data, start = 1963, frequency = 12)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/f08f5213a0bf4f7273e88c49d2266606.png" data-original-src="https://miro.medium.com/v2/resize:fit:306/format:webp/1*St1MEQRK4T4UBwqOEKBQFA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从人口普查局检索的原始数据</p></figure><h2 id="460d" class="nj nk it bd nl nm nn dn no np nq dp nr lt ns nt nu lx nv nw nx mb ny nz oa ob bi translated"><strong class="ak">情节#1:简单时间序列情节</strong></h2><p id="8c02" class="pw-post-body-paragraph lk ll it lm b ln oc ju lp lq od jx ls lt oe lv lw lx of lz ma mb og md me lj im bi translated">一旦读入数据并将其转换成一个<code class="fe mk ml mm mn b">ts</code>对象，第一个图通常是一个简单的可视化图，以获得数据的“感觉”。</p><pre class="kj kk kl km gt oh mn oi oj aw ok bi"><span id="182f" class="nj nk it mn b gy ol om l on oo">autoplot(df[, "value"])+<br/>  ggtitle("Number of new single-family houses sold") +<br/>  xlab("Year") + ylab("Thousand units")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/d310ef2959d942330e4c79f49e5e71d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*d1u-21Anq-TuioioutLjUA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">时间序列图的简单可视化</p></figure><p id="67da" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">仅仅通过目测这幅图，你就可以得到很多提示——比如售出的房屋数量、季节性、趋势、周期、市场崩溃等等。我们将放大每一个以进一步了解。</p><h2 id="b7db" class="nj nk it bd nl nm nn dn no np nq dp nr lt ns nt nu lx nv nw nx mb ny nz oa ob bi translated"><strong class="ak">剧情#2:卷窗</strong></h2><p id="95cf" class="pw-post-body-paragraph lk ll it lm b ln oc ju lp lq od jx ls lt oe lv lw lx of lz ma mb og md me lj im bi translated">图1信息太多，有点嘈杂，所以我们需要简化它。只要用12个月移动平均线去除季节性因素，我们就能看到数据中的关键信号。</p><pre class="kj kk kl km gt oh mn oi oj aw ok bi"><span id="a369" class="nj nk it mn b gy ol om l on oo">autoplot(ma(df, 12), series = "Moving avg.") +<br/>    xlab("Year") + ylab(" Thousand house units")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/39e7a147e8e44357533c0ee7b2e2d538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*0CeRJ5ZfakxIjMeT2PdxcA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">具有12个滞后滚动窗口的移动平均线</p></figure><p id="730a" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">因此，通过牺牲季节性，我们可以更好地看到趋势和其他特征。</p><p id="1f40" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">例如，在整个70年代和80年代，年销售量徘徊在每年4-5万台左右，大约有5-6年的商业周期。但是没有发现明显的趋势。</p><p id="fed9" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">自20世纪90年代以来，市场呈上升趋势。这种情况一直持续到2005年，年销量超过10万台。</p><p id="40a1" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">然后就发生了车祸。</p><p id="64eb" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">自2011年以来，市场正在复苏。但截至2018年，仍处于70年代水平左右。</p><h2 id="a84e" class="nj nk it bd nl nm nn dn no np nq dp nr lt ns nt nu lx nv nw nx mb ny nz oa ob bi translated"><strong class="ak">曲线#3:季节性曲线</strong></h2><p id="c4c8" class="pw-post-body-paragraph lk ll it lm b ln oc ju lp lq od jx ls lt oe lv lw lx of lz ma mb og md me lj im bi translated">在前面的图中，我们去除了季节性来检测关键信号。现在，让我们通过对全年每个月的销售额进行平均来专门放大季节性。</p><pre class="kj kk kl km gt oh mn oi oj aw ok bi"><span id="3776" class="nj nk it mn b gy ol om l on oo">ggseasonplot(df, year.labels = TRUE) +<br/>  ggtitle("Seasonal plot")+ xlab(" ")+ ylab("Thousand house units")</span></pre><p id="b402" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">我知道这看起来真的很丑，当然有办法用更多的代码来美化这个情节，但这不是我们所追求的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/b1ee46ef51e441e31030402601d078c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*Unnmzb2V60iawI-jT8C5MQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示每年月度趋势的季节性曲线图</p></figure><p id="6e87" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">再一次，通过目测，你可以看到三月是独户住宅市场的最佳月份。夏季市场还不错，但从秋季开始就开始下滑。</p><h2 id="5ee6" class="nj nk it bd nl nm nn dn no np nq dp nr lt ns nt nu lx nv nw nx mb ny nz oa ob bi translated"><strong class="ak">地块#4:亚季节地块</strong></h2><p id="633c" class="pw-post-body-paragraph lk ll it lm b ln oc ju lp lq od jx ls lt oe lv lw lx of lz ma mb og md me lj im bi translated">现在让我们做与图3相反的事情，将所有年份的平均值挤进每个月。</p><pre class="kj kk kl km gt oh mn oi oj aw ok bi"><span id="3464" class="nj nk it mn b gy ol om l on oo">ggsubseriesplot(df) +<br/>  ggtitle(" Seasonal subseries plot") + ylab("Thousand house units")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/187b373fba06b3c7f29bb43f8009acbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*r_g8CayX-xuz0CvxIh6r6Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示全年每月销售额变化的分季节曲线图</p></figure><p id="a992" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">它显示的是——在连续几年的平均值之后，新房销售每月是如何变化的。横条代表一年中每个月的平均值。</p><p id="d77c" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">例如，3月份的平均销量约为6万台，峰值为12.5万台。</p><h2 id="1c4f" class="nj nk it bd nl nm nn dn no np nq dp nr lt ns nt nu lx nv nw nx mb ny nz oa ob bi translated"><strong class="ak">地块#5:时间序列分解</strong></h2><p id="ab44" class="pw-post-body-paragraph lk ll it lm b ln oc ju lp lq od jx ls lt oe lv lw lx of lz ma mb og md me lj im bi translated">正如我们已经看到的，时间序列数据有很多属性——趋势、季节性和随机(噪声)成分。</p><p id="1aaf" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">如果我们想看到所有的组件呢？我们可以通过所谓的“<a class="ae ky" href="https://online.stat.psu.edu/stat510/lesson/5/5.1" rel="noopener ugc nofollow" target="_blank">时间序列分解</a>”来做到这一点。</p><pre class="kj kk kl km gt oh mn oi oj aw ok bi"><span id="0ea2" class="nj nk it mn b gy ol om l on oo">df %&gt;% decompose(type="multiplicative") %&gt;%<br/>  autoplot() + xlab("Year") + ylab("Thousand house units")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/8a4e719b27881e341c5417afdc784e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*tn1lWqyGXZK8PjBf9vyB_w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">时间序列分解有四个组成部分:数据、季节性、趋势和噪声</p></figure><p id="a48c" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">因此分解的输出有4层:顶层——原始数据；第二——季节性；第三——趋势；第四，余数/噪声。</p><p id="d651" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">时间序列分解通常有助于在一个地方一览无余。</p><h2 id="ce1f" class="nj nk it bd nl nm nn dn no np nq dp nr lt ns nt nu lx nv nw nx mb ny nz oa ob bi translated"><strong class="ak">曲线#6:自相关曲线</strong></h2><p id="fa90" class="pw-post-body-paragraph lk ll it lm b ln oc ju lp lq od jx ls lt oe lv lw lx of lz ma mb og md me lj im bi translated">“Auto”表示自身——因此自相关是一个序列与其自身的相关性。在时间序列分析中，自相关意味着数据点对其过去值的依赖性。</p><p id="e6bd" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">例如，12月份的房屋销售量并不是随机的，而是与11月、10月及以后的销售量相关。</p><pre class="kj kk kl km gt oh mn oi oj aw ok bi"><span id="6cdc" class="nj nk it mn b gy ol om l on oo"># auto-correlation plot<br/>ggAcf(df, lag = 72)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/e4fde33ce20f997f56f756a338c4aa48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*KTIp_88JRY8QWKldeAn49g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示不同滞后中自相关的ACF图</p></figure><p id="f145" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">所以自相关图的目的是确定“自相关”可以追溯到多远。例如，在该图中，自相关直到任何数据点的前51个值都是显著的。</p><p id="188b" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">自相关图在高级时间序列分析和预测中是一种有用的技术——尤其是确定在<a class="ae ky" rel="noopener" target="_blank" href="/time-series-forecasting-from-naive-to-arima-and-beyond-ef133c485f94"> ARIMA家族</a>中用作参数的滞后数。</p><h2 id="d7fb" class="nj nk it bd nl nm nn dn no np nq dp nr lt ns nt nu lx nv nw nx mb ny nz oa ob bi translated"><strong class="ak">期末笔记</strong></h2><p id="882a" class="pw-post-body-paragraph lk ll it lm b ln oc ju lp lq od jx ls lt oe lv lw lx of lz ma mb og md me lj im bi translated">我们探索了六种不同的情节，每一种都表达了不同的信息。数据可视化是数据科学工具箱中必不可少的工具。不仅仅是为了讲故事，而是为了理解数据，理解关键组件，甚至调整模型参数。</p><p id="ecb2" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">希望这对R用户是一个有用的练习。Python用户需要心灰意冷，盯紧了，来了。</p></div></div>    
</body>
</html>