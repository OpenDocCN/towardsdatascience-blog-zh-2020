<html>
<head>
<title>Step-by-Step Tutorial: Web Scraping Wikipedia with BeautifulSoup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分步教程:用BeautifulSoup抓取维基百科</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/step-by-step-tutorial-web-scraping-wikipedia-with-beautifulsoup-48d7f2dfa52d?source=collection_archive---------1-----------------------#2020-01-05">https://towardsdatascience.com/step-by-step-tutorial-web-scraping-wikipedia-with-beautifulsoup-48d7f2dfa52d?source=collection_archive---------1-----------------------#2020-01-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/5fad62d8512c48f15515b89287c1c439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N4ZNL18TtZ1ogq5-zDIDWA.jpeg"/></div></div></figure><p id="37ac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我的室友和我讨论了她对瑞典高抑郁率的观察。我们得出了抑郁率和缺少阳光之间的联系。我决定通过收集自己的数据并进行分析来支持我的假设。</p><p id="13c4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我使用Beautiful Soup，这是一个易于使用的Python web抓取工具。我喜欢这个工具的原因是它易于使用和理解。库的文档可以在<a class="ae kz" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="b0fd" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">准备</h1><p id="aae4" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">假设:一个国家的日照时间越少，这个国家的抑郁率就越高。</p><p id="aad1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要收集的数据:</p><ul class=""><li id="59ad" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated">国家名称</li><li id="4ca6" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">他们的抑郁率</li><li id="617a" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">他们的日照时间</li></ul><p id="c0f1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要使用的资源:</p><ul class=""><li id="c9c3" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated"><a class="ae kz" href="https://en.wikipedia.org/wiki/Epidemiology_of_depression" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Epidemiology_of_depression</a></li><li id="780a" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><a class="ae kz" href="https://en.wikipedia.org/wiki/List_of_cities_by_sunshine_duration" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/List _ of _ cities _ by _ sunshine _ duration</a></li></ul><h1 id="df22" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">开始</h1><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="32bf" class="na lb it mw b gy nb nc l nd ne">import requests<br/>import urllib.request<br/>import time<br/>from bs4 import BeautifulSoup<br/>import numpy as np<br/>import pandas as pd<br/>from urllib.request import urlopen</span><span id="84c3" class="na lb it mw b gy nf nc l nd ne">url = 'https://en.wikipedia.org/wiki/Epidemiology_of_depression'</span><span id="639c" class="na lb it mw b gy nf nc l nd ne">html = urlopen(url) </span><span id="db6b" class="na lb it mw b gy nf nc l nd ne">soup = BeautifulSoup(html, 'html.parser')</span></pre><figure class="mr ms mt mu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/e687b60c37246b1f97ca276fbb38bc60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j5w3pGzpmSNUsKSL_hRGDQ.png"/></div></div></figure><p id="25b5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">右键单击页面，然后转到检查。单击上面显示的图标，选择网站中要检查的元素。</p><p id="45ce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们对从表格中提取信息感兴趣。这可以用一行代码轻松完成。通过检查，我们发现这张桌子被贴上了<code class="fe nh ni nj mw b">&lt;table&gt;</code>标签。</p><figure class="mr ms mt mu gt ju gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/726ad7c77a67f524100bcde5a8a4de62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*rCLVdZxs_IpVEYsFrU60Ww.png"/></div></figure><p id="df42" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe nh ni nj mw b">find_all('table')</code>扫描整个文档寻找标签<code class="fe nh ni nj mw b">&lt;table&gt;</code></p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="eb74" class="na lb it mw b gy nb nc l nd ne">tables = soup.find_all('table')</span></pre><p id="7218" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">find_all()是一个简单有效的方法，在本教程中会经常用到。</p><h1 id="1f2b" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">收集数据</h1><p id="9214" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">因为“，”，看起来<code class="fe nh ni nj mw b">DALY rate</code>列中的数据在收集时将是一个字符串。创建一个函数，通过使用re.sub()将字符串处理成整数，这是一个返回与正则表达式匹配的子字符串的方法。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="bf72" class="na lb it mw b gy nb nc l nd ne">import re<br/>def process_num(num):<br/>    return float(re.sub(r'[^\w\s.]','',num))</span></pre><p id="f0ed" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">测试功能</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="3795" class="na lb it mw b gy nb nc l nd ne">num1 = float(re.sub(r'[^\w\s.]','','1,156.30'))<br/>num1</span></pre><p id="6c5c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">产量:1156.30</p><figure class="mr ms mt mu gt ju"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0944" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们来分析一下。</p><p id="ae74" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第6–7行:我们注意每一行都在<code class="fe nh ni nj mw b">&lt;tr&gt;</code>标签下。这给了我们一个想法，我们将通过找到所有的标签<code class="fe nh ni nj mw b">&lt;tr&gt;</code>来得到这些行</p><figure class="mr ms mt mu gt ju gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/6c12d50c5cde241886f5875f05d09a63.png" data-original-src="https://miro.medium.com/v2/resize:fit:452/format:webp/1*AuyK1DR9NieQAbECNmAjEQ.png"/></div></figure><p id="cb2d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第9–10行:通过查找所有<code class="fe nh ni nj mw b">&lt;td&gt; tags</code>来提取行</p><figure class="mr ms mt mu gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/846078f68afda3ad736e2cadbdebc457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*Pb6kP_en8rhwyGWNeJEsuw.png"/></div></figure><p id="1418" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第14行:由于第一行的<code class="fe nh ni nj mw b">len(cells)</code>是1，我们设置条件跳过第一行，从其他行提取。</p><p id="7ce2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第15行:因为<code class="fe nh ni nj mw b">cells</code>是3个单元格的列表，我们使用第一个单元格提取排名，使用第二个单元格提取国家名称，使用第三个单元格提取DALY比率。</p><p id="b881" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">把数据放入<code class="fe nh ni nj mw b">pandas.DataFrame</code></p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="6a53" class="na lb it mw b gy nb nc l nd ne">df1 = pd.DataFrame(ranks, index= countries</span><span id="ca34" class="na lb it mw b gy nf nc l nd ne">columns = ['Rank'])df1['DALY rate'] = rates</span><span id="deab" class="na lb it mw b gy nf nc l nd ne">df1.head(10)</span></pre><figure class="mr ms mt mu gt ju gh gi paragraph-image"><div class="gh gi np"><img src="../Images/d3f9f78a6ea3befbf73d30c92673336d.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*i_x8EPAka3Tx8E-13bVFFQ.png"/></div></figure><p id="a443" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用与上述相同的方法从第二个网站收集日照时数。请记住，这两个网站的数据有两个不同之处:</p><ul class=""><li id="c283" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated">同一个国家的日照时数有多种数据。因此，我们可能希望取这些数据的平均值，以获得每个国家的小时数。为了取平均值，我们简单地使用两个字典，<code class="fe nh ni nj mw b">country_suns </code>和<code class="fe nh ni nj mw b">count</code>，它们具有相同的关键字但不同的值。</li><li id="dc67" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">第二次数据中的一些国家在第一次数据中没有。因此，我们只想从第一个数据中的国家收集数据，这些数据存储在上面创建的变量<code class="fe nh ni nj mw b">countries</code>中。</li></ul><figure class="mr ms mt mu gt ju"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="65d2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">结果:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="f8ba" class="na lb it mw b gy nb nc l nd ne">789.14 3<br/>Country: Benin, Sunshine Hours: 263.05<br/>515.99 2<br/>Country: Togo, Sunshine Hours: 258.0<br/>710.25 3<br/>Country: Ghana, Sunshine Hours: 236.75<br/>866.0500000000001 4<br/>Country: Cameroon, Sunshine Hours: 216.51<br/>344.03999999999996 2<br/>Country: Gabon, Sunshine Hours: 172.02<br/>1334.54 5<br/>Country: Nigeria, Sunshine Hours: 266.91<br/>711.91 2<br/>Country: Sudan, Sunshine Hours: 355.95<br/>336.1 1<br/>...</span></pre><h1 id="a200" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">清理数据</h1><p id="d575" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">使用join方法连接我们之前收集的两个数据。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="d29f" class="na lb it mw b gy nb nc l nd ne">df2 = pd.DataFrame.from_dict(country_suns,orient='index', columns = ['Sunshine Hours/Year'])</span><span id="4617" class="na lb it mw b gy nf nc l nd ne">df = df1.join(df2)</span><span id="0734" class="na lb it mw b gy nf nc l nd ne">df.info()</span></pre><p id="eb91" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">结果:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="1847" class="na lb it mw b gy nb nc l nd ne">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>Index: 192 entries, United States to Japan<br/>Data columns (total 3 columns):<br/>Rank                   192 non-null int64<br/>DALY rate              192 non-null float64<br/>Sunshine Hours/Year    122 non-null float64<br/>dtypes: float64(2), int64(1)<br/>memory usage: 11.0+ KB</span></pre><p id="4365" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们意识到最后一列中有空值，因为第一个来源中的一些国家不在第二个来源中。有许多方法可以处理缺失值。但是现在，只需删除缺少值的行，就可以直观地看到我们得到了什么。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="a9c6" class="na lb it mw b gy nb nc l nd ne">df.dropna(inplace=True)</span></pre><h1 id="3807" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">将数据可视化</h1><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="169d" class="na lb it mw b gy nb nc l nd ne">import matplotlib.pyplot as plt<br/>import seaborn as sns</span><span id="bf6c" class="na lb it mw b gy nf nc l nd ne">sns.scatterplot('Rank', 'Sunshine Hours/Year', data=df)</span></pre><figure class="mr ms mt mu gt ju gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/f5fa944fc97a122e1f8d7b2b29e4cde8.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*l53TSknzzoCMbonGXwfZXg.png"/></div></figure><p id="bd29" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里似乎没有很强的相关性。看一下相关系数。</p><figure class="mr ms mt mu gt ju gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/44cc28cea5e2752cfb0f259aae84ebff.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*TzmBhNv58yl6ApNFvrxzvg.png"/></div></figure><p id="65ee" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果要使用不同的工具处理数据，请保存数据。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="57c2" class="na lb it mw b gy nb nc l nd ne">df.to_csv('wiki-2.csv')</span></pre><h1 id="24b5" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">结论</h1><p id="e5ce" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">相关性没有我想象的那么强。但是我们没有考虑到不同的因素，如确定抑郁率的指标的准确性，国家的大小(国家越大，日照时数/年的变化越大)，GDP，人口等。应该收集更多的数据以获得更准确的结果。但在此之前，要为自己感到骄傲，因为你刚刚学会了网络搜集，这是数据科学中最重要的过程之一。</p><p id="0269" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本教程的Github库可以在这里找到:<a class="ae kz" href="https://github.com/khuyentran1401/Web-Scrapping-Wikipedia" rel="noopener ugc nofollow" target="_blank">https://github.com/khuyentran1401/Web-Scrapping-Wikipedia</a>。</p><p id="df39" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我喜欢写一些基本的数据科学概念，并尝试不同的算法和数据科学工具。你可以在<a class="ae kz" href="https://www.linkedin.com/in/khuyen-tran-1401/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae kz" href="https://twitter.com/KhuyenTran16" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系我。</p><p id="be83" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你想查看我写的所有文章的代码，请点击这里。在Medium上关注我，了解我的最新数据科学文章，例如:</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h2 id="ed8a" class="na lb it bd lc nz oa dn lg ob oc dp lk km od oe lo kq of og ls ku oh oi lw oj bi translated">参考</h2><p id="b2d1" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">[1]抑郁症流行病学，维基百科</p><p id="98f6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[2]根据日照时间列出的城市列表，维基百科</p><p id="4b24" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[3]Varun Choudhary，如何抓取网站而不被列入黑名单(2019)，Hackernoon</p></div></div>    
</body>
</html>