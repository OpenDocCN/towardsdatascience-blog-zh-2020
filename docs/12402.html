<html>
<head>
<title>A Sweet Python hack to Cut Work in Half: Automate Your Execution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将工作减半的 Python 妙招:自动化执行</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/from-outlook-to-python-results-a-sweet-hack-to-cut-your-work-in-half-c2741a403f40?source=collection_archive---------22-----------------------#2020-08-26">https://towardsdatascience.com/from-outlook-to-python-results-a-sweet-hack-to-cut-your-work-in-half-c2741a403f40?source=collection_archive---------22-----------------------#2020-08-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="246d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 VBA、Powershell 和任务调度程序自动执行脚本并通过电子邮件发送结果</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c87f6fca95e7b14895803c7e24015975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0pjN_GOYq5DNKHXCgjE15A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片，来自维基共享和 Flickr 的徽标</p></figure><p id="7d5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="lu">摘要:</em> </strong> <em class="lu">这篇文章讲述了如何调度你的常规 python 脚本。假设你</em></p><ol class=""><li id="0f74" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><em class="lu">将每天/每周/每月更新的 excel 报告放入共享网络或电子邮件</em></li><li id="994d" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><em class="lu">启动并运行 python 脚本来处理您的报告，并以图像、工作表或其他数据形式提供见解。</em></li><li id="8d56" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><em class="lu">希望以固定的时间间隔长时间运行流程，但又非常担心必须手动运行。</em></li></ol><p id="6e50" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">数据工程也有有趣的部分——比如编程和分析数据。然后是无聊的部分，比如定期使用已经写好的程序来获得最新的结果。显然，没有人想做后者。这里有一个快速解决方法，我用它来避免运行那些需要每天/每周/每月执行的脚本，以便更好地利用这些时间。</p><p id="4bac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">三个词—宏、批处理和调度。</p><ol class=""><li id="17a1" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">我使用一个<strong class="la iu">宏将</strong>我收到的 excel 报告保存到一个位置。(我从一个执行分析并手动向我发送报告的地方获得它。不，这个没办法)。</li><li id="0a3a" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">我设置了一个<strong class="la iu"> outlook 规则</strong>,只在想要的文件夹上运行宏，并附带一些其他条件(发件人、主题等)。</li><li id="2f47" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">我<strong class="la iu">写一个批处理文件</strong>(。bat)，单击它将在命令提示符下执行脚本。</li><li id="8bdd" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">我使用<strong class="la iu"> Windows 任务调度器</strong>调度 bat 文件，以与新 excel 报告到达的频率相同的频率执行脚本</li><li id="0da0" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">我写了一个<strong class="la iu"> PowerShell 脚本</strong>,将最新的结果通过电子邮件发送给所有必要的接收者，然后我安排它在 bat 文件执行后马上运行。</li></ol><h2 id="ab72" class="mj mk it bd ml mm mn dn mo mp mq dp mr lh ms mt mu ll mv mw mx lp my mz na nb bi translated">步骤 1: Outlook 宏</h2><ol class=""><li id="842f" class="lv lw it la b lb nc le nd lh ne ll nf lp ng lt ma mb mc md bi translated">通过在 outlook 的选项窗格中激活 VBA 脚本，可以在 Outlook 中激活它。</li><li id="af91" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">然后，您会看到一个开发人员工具按钮出现在 outlook 主页窗口的顶部。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/3fa1052e1ec14cf5a2a351a90caab4e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*Cg7Gb7kOdEj71KU48BhFSg.png"/></div></figure><p id="fee7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.转到“开发工具”选项卡，启动 Visual Basic 脚本。</p><p id="d7ad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.在这里创建一个新模块，并编写代码脚本来保存传入的附件。</p><p id="b3f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">很简单。</p><p id="edb5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在下面的示例中，报告名称始终是我收到的自动电子邮件的主题。所以我用这个标准来决定我的文件的文件名，并把它保存到一个文件夹中。</p><p id="20a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">(我还确保保存它的日期，这样我就知道在执行我的脚本之前，目标文件夹总是有最新的文件。)</p><p id="4294" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在收到的电子邮件中保存附件的 VBA 脚本:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="5fab" class="mj mk it nj b gy nn no l np nq">Public Sub SaveRegularReports(MItem As Outlook.MailItem)<br/>Dim oAttachment As Outlook.Attachment<br/>Dim sSaveFolder As String<br/>sSaveFolder = "/You/want/to/save/here/"<br/>If MItem.Subject = "Quarterly_rep" Then<br/> savename = "QRep"<br/>ElseIf MItem.Subject = "JustSomeRegRep" Then<br/> savename = "RegRep"<br/>ElseIf MItem.Subject = "WeeklyReport" Then<br/> savename = "WeeklyUpdate"<br/>End If<br/>For Each oAttachment In MItem.Attachments<br/>oAttachment.SaveAsFile sSaveFolder &amp; savename &amp; Format(MItem.ReceivedTime, "mmddyyyy") &amp; ".xlsx"<br/>Next<br/>End Sub</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/f42200902a67da5fc3e88497a2edad61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yOsUCTmcYV767_1qB4fWBA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原谅我的德语，但我相信你也能认出这些英语设置！</p></figure><p id="d251" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我要做的就是决定这些规则适用于谁。因此，我转到规则，并设置我想要应用脚本的条件。</p><p id="13d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的例子中，我的条件是电子邮件总是来自一个特定的地址，其主题包含报告的名称。(为了安全起见，我将所有此类常规报告都移到了收件箱中的一个单独文件夹中)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/776b21121f8a302b5e41e3fb6b775aed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2vMv_XEq0nCNvTzzai-Jmg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/329fc87e4c672d338084faa11978ed37.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*6m4PiOmBz_O31axvqBsKaw.png"/></div></figure><p id="8a7a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在下一步中，作为一个动作，每当这个文件夹得到一个新手时，我就执行上面的脚本 SaveRegularReports。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/510cf511e8e93d8f7b0d50f20e67887c.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*V2c53I9oEQsTCNO8rznTmw.png"/></div></figure><blockquote class="nv"><p id="7036" class="nw nx it bd ny nz oa ob oc od oe lt dk translated">瞧吧！不费吹灰之力就自动保存了我需要的一切！！</p></blockquote><h2 id="bf8a" class="mj mk it bd ml mm og dn mo mp oh dp mr lh oi mt mu ll oj mw mx lp ok mz na nb bi translated">第二步。编写 bat 文件以在保存的 excel 表上执行 python 脚本</h2><p id="81eb" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ol lj lk ll om ln lo lp on lr ls lt im bi translated">这也是小菜一碟。bat(或批处理)文件是一组命令，当您单击它时，命令提示符会执行这些命令。如果您曾经编写过 bash 命令或者使用过 windows 命令提示符 shell 脚本来“pip install”之类的，那么您应该知道我在说什么。</p><ol class=""><li id="7594" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">打开一个文本文件，编写与下面类似的命令来执行 python 脚本，就像在命令提示符下一样。(我使用的是 anaconda，所以在执行 python 脚本之前，我首先激活了 Anaconda 提示符)。</li><li id="1442" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">将该文件另存为 filename.bat</li></ol><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="20dd" class="mj mk it nj b gy nn no l np nq"><a class="ae oo" href="http://twitter.com/echo" rel="noopener ugc nofollow" target="_blank">@echo</a> off</span><span id="1156" class="mj mk it nj b gy op no l np nq">call C:\Users\myUSer\AppData\Local\anaconda\Scripts\activate.bat</span><span id="b39f" class="mj mk it nj b gy op no l np nq">C:\This\is\Where\Your\Script\Lives\Scriptchen.py</span><span id="9f64" class="mj mk it nj b gy op no l np nq">pause</span></pre><p id="809b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我点击上面的 bat 文件(scriptchens_bat.bat)时，我的 python 脚本被执行。它使用步骤 1 中保存的 excel 报告。</p><h2 id="6426" class="mj mk it bd ml mm mn dn mo mp mq dp mr lh ms mt mu ll mv mw mx lp my mz na nb bi translated">第三步。任务-计划您的脚本执行</h2><p id="af3f" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ol lj lk ll om ln lo lp on lr ls lt im bi translated">注意:我知道我每周都会收到报告，比如说周五上午 10 点。我将这个脚本设置为每周五 10:30 运行。</p><ol class=""><li id="8cbb" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">从 Windows 中的搜索栏打开任务计划程序。转到创建基本任务。</li><li id="f1bc" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">在出现的窗口中命名和描述后，转到触发器窗格并设置您的时间表。在这个例子中是星期五的 10:30。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/f504b4923eb4c049e901746c70109ebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9D4oQiMLOTkEYXsAs6UNEg.png"/></div></div></figure><p id="1fed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在是肉的部分。转到操作窗格。这里是您设置 bat 文件以便执行的地方。从“操作”中选择“启动程序”，在程序窗格中，给出您的。您在步骤 2 中编写的 bat 文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/847be1454113b3fa94c616c34d65b1c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*DvrJUknqkTe3CZjaX_m-qQ.png"/></div></figure><p id="2efe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">单击确定并确认。</p><blockquote class="nv"><p id="1a27" class="nw nx it bd ny nz os ot ou ov ow lt dk translated">瞧啊。现在，您每周都可以轻松地输出 Python 脚本了！</p></blockquote><h2 id="78ae" class="mj mk it bd ml mm og dn mo mp oh dp mr lh oi mt mu ll oj mw mx lp ok mz na nb bi translated">第四步。通过电子邮件发送结果</h2><p id="43f2" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ol lj lk ll om ln lo lp on lr ls lt im bi translated">如果你对最新的结果感到满意，你可以就此打住。但是，如果您想更进一步，也想自动分发您的处理结果，请喝杯咖啡，通读最后一步。</p><p id="c72f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我决定使用 powershell 将我的 outlook 结果通过电子邮件发送给其他同事。以下是方法:</p><ol class=""><li id="a144" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">从 windows 搜索打开 PowerShell ISE。</li><li id="c62b" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">下面的脚本是我的案例的一个例子，它将结果分别用正文和主题行发送给所有收件人。你可以修改你的脚本来满足你的需要。</li></ol><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="815c" class="mj mk it nj b gy nn no l np nq">$OL = New-Object -ComObject outlook.application</span><span id="23cb" class="mj mk it nj b gy op no l np nq">Start-Sleep 5</span><span id="1be7" class="mj mk it nj b gy op no l np nq">$recipients = @(“recipient_one@company.de”,”recipient_two@company.de”,”recipient_three@company.de”)</span><span id="aa5c" class="mj mk it nj b gy op no l np nq">foreach ($recipient in $recipients){</span><span id="80ff" class="mj mk it nj b gy op no l np nq">$mItem = $OL.CreateItem(“olMailItem”)</span><span id="e27c" class="mj mk it nj b gy op no l np nq">$mItem.To = $recipient</span><span id="ba05" class="mj mk it nj b gy op no l np nq">$mItem.Subject = “Automatic Email: Weekly Report”</span><span id="c64b" class="mj mk it nj b gy op no l np nq">$mItem.Body = “This is an automated email sent using powershell. In case of any questions please contact Me. Dieses Dokument enthält… “</span><span id="b1b1" class="mj mk it nj b gy op no l np nq">$mItem.Attachments.Add(“\This\is\where\my\python\output\lives\file_to_email.xlsx”)</span><span id="06e3" class="mj mk it nj b gy op no l np nq">$mItem.Send()</span><span id="c3e7" class="mj mk it nj b gy op no l np nq">}</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/9154000784e11cd15b2b2308ae8c48c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9UT1tA9-9F-JUy13us1xvg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">自动发送电子邮件的 Powershell 脚本</p></figure><h2 id="2a9f" class="mj mk it bd ml mm mn dn mo mp mq dp mr lh ms mt mu ll mv mw mx lp my mz na nb bi translated">第五步。设置任务计划程序，将您的结果通过电子邮件发送给收件人</h2><p id="2005" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ol lj lk ll om ln lo lp on lr ls lt im bi translated">与步骤 3 类似，现在您将安排 powershell 脚本在 python 脚本执行后每周执行一次。</p><ol class=""><li id="7442" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">转到任务计划程序中的新任务</li><li id="0855" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">命名并描述您的任务</li><li id="7776" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">转到 trigger 并设置您的计划</li><li id="dacf" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">开始行动。在程序/脚本栏中，输入 PowerShell 应用程序的地址。它通常在这里:</li></ol><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="54dd" class="mj mk it nj b gy nn no l np nq">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</span></pre><p id="8b49" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在参数栏中，输入之前编写的. ps1 脚本的路径。</p><blockquote class="nv"><p id="063d" class="nw nx it bd ny nz os ot ou ov ow lt dk translated">瞧啊。你不费吹灰之力就发了邮件！</p></blockquote><p id="d869" class="pw-post-body-paragraph ky kz it la b lb oy ju ld le oz jx lg lh pa lj lk ll pb ln lo lp pc lr ls lt im bi translated">总而言之，您自动化了整个事件链，从接收 excel 文件开始，将其保存到某个位置，用 python 处理它，然后用电子邮件发送结果。这是一个非常巧妙的方法，节省了我大量的工作时间。希望它也能帮助你！</p></div></div>    
</body>
</html>