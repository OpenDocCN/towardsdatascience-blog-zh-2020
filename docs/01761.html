<html>
<head>
<title>“My data scientist doesn’t know how to properly start an EC2 instance”.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">“我的数据科学家不知道如何正确启动EC2实例”。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/my-data-scientist-doesnt-know-how-to-properly-start-an-ec2-instance-b1b9f4920359?source=collection_archive---------7-----------------------#2020-02-18">https://towardsdatascience.com/my-data-scientist-doesnt-know-how-to-properly-start-an-ec2-instance-b1b9f4920359?source=collection_archive---------7-----------------------#2020-02-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3663" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">VPC、子网或互联网网关是指任何AWS设置的核心组件。然而，数据科学家通常认为它是为他们配置的。让我们介绍一下最重要的概念，并清楚地了解它们的作用。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/50584f8517b117d0241b283111605504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*azvue-vaBYDDjBDVe2-w0Q.jpeg"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">新加坡的CBD采用神经式传送，用的是这种<a class="ae kw" href="https://github.com/ProGamerGov/neural-style-pt" rel="noopener ugc nofollow" target="_blank">码</a>和<a class="ae kw" href="https://arxiv.org/abs/1508.06576" rel="noopener ugc nofollow" target="_blank">纸</a>。</p></figure><p id="ca85" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae kw" href="https://medium.com/@louisdge/catching-up-with-the-cloud-trend-and-the-aws-ecosystem-dd512e8e2456" rel="noopener">在我之前的文章</a>中，我们为弹性和数据密集型应用建立了一个云基础设施，如下图所示。如果您对AWS区域、AZs或高可用性区域没有很好的了解，我推荐您阅读这篇文章。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi lt"><img src="../Images/a61cb149d335811696087bd676bd2014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F-KO2_NhVED2glCslRfjCw.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">我们上一篇文章中的云架构示例</p></figure><p id="c2e0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们用这个例子来解释底层的网络和安全概念。请随意访问AWS控制台，启动我们提供的资源(大多数都是免费的)。阅读完本文后，您将能够理解在设置EC2实例时您实际上在做什么。不仅如此，它还将使您能够配置其他AWS服务并将它们链接在一起。此外，各部分都是相当独立的，因此在需要时可以直接跳到概念。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="bdfd" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> I .隔离您的基础设施</strong></p><ol class=""><li id="5da1" class="mb mc iq kz b la lb ld le lg md lk me lo mf ls mg mh mi mj bi translated"><em class="mk"> VPC </em></li><li id="8189" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls mg mh mi mj bi translated"><em class="mk">子网</em></li></ol><p id="80b3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">二。实例和网络之间的通信</strong></p><ol class=""><li id="5d76" class="mb mc iq kz b la lb ld le lg md lk me lo mf ls mg mh mi mj bi translated"><em class="mk">弹性网络接口</em></li><li id="4123" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls mg mh mi mj bi translated"><em class="mk">互联网网关</em></li><li id="698f" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls mg mh mi mj bi translated"><em class="mk">路由表</em></li></ol><p id="d0b7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">三。安全事项</strong></p><ol class=""><li id="0682" class="mb mc iq kz b la lb ld le lg md lk me lo mf ls mg mh mi mj bi translated"><em class="mk">安全组</em></li><li id="740a" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls mg mh mi mj bi translated"><em class="mk">氯化钠</em></li></ol></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="5e50" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们开始吧！</p><h1 id="2a56" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">隔离您的基础设施</h1><p id="948b" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">首先，请记住，互联网从根本上说是一个巨大的网络，其中的节点由像您这样的服务器或计算机组成，由公共的<a class="ae kw" href="https://en.wikipedia.org/wiki/IP_address" rel="noopener ugc nofollow" target="_blank">互联网协议地址</a>或<em class="mk"> IP </em>(如104.16.122.127)标识。这些节点使用<a class="ae kw" href="https://en.wikipedia.org/wiki/Internet_protocol_suite" rel="noopener ugc nofollow" target="_blank">互联网协议套件</a> ( <em class="mk"> TCP/IP </em>)相互通信。</p><p id="cbeb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在继续之前，请务必熟悉这些概念。</p><p id="d3ad" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当在云中创建一个应用程序时，比如上面提到的，我们可以独占访问由云提供商创建的位于更大的公共网络中的网络。这被称为<em class="mk">虚拟私有云</em> (VPC)，是首先要设置的。这是我们所有的AWS资源将在其中运行的网络。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nn"><img src="../Images/ff00edccfdc7de0e498cfd053fa53b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H-I9YeopmIiPi4_1KiO9EQ.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">在互联网这个庞大的网络中，你可以通过云提供商获得自己的私有网络。</p></figure><h2 id="df2d" class="no mr iq bd ms np nq dn mw nr ns dp na lg nt nu nc lk nv nw ne lo nx ny ng nz bi translated">VPC</h2><p id="1b99" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">默认情况下，VPC最初会与任何其它网络隔离。它必须位于一个AWS区域中。然后，您需要选择一些IP地址，这些地址将用于标识在VPC中运行的实例。这必须在您开始构建基础设施时完成。例如，使用<a class="ae kw" href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" rel="noopener ugc nofollow" target="_blank">无类域间路由</a> ( <em class="mk"> CIDR </em>)符号，您可以留出这些IP地址(或CIDR <em class="mk">块</em>)供将来使用:176.13.0.0/16。此语法指定了从176.13.0.0到176.13.255.255的所有IP地址。</p><p id="1bce" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了确保这些地址不会与互联网上当前使用的公共IP地址重叠(例如像<em class="mk">medium.com</em>的地址)，你应该从<a class="ae kw" href="https://en.wikipedia.org/wiki/Private_network" rel="noopener ugc nofollow" target="_blank"> RFC1918范围</a>中选择它们。如果你想连接两者，也不应该与现有的VPC重叠！选择您的IP地址范围非常重要，因为一旦创建了VPC，您将无法修改它。所以仔细想想吧！</p><p id="3e08" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">请注意，我们在示例中使用了IPv4地址，类似的概念也适用于较新的(1998…) IPv6地址。</p><h2 id="17ff" class="no mr iq bd ms np nq dn mw nr ns dp na lg nt nu nc lk nv nw ne lo nx ny ng nz bi translated">子网络</h2><p id="aabe" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">现在还不是在我们刚刚创建的VPC中开始EC2实例的时候:我们需要另一个层。每个实例必须与一个<em class="mk">子网</em>相关联，这个子网只是VPC内部的一个逻辑子网。它是用CIDR块定义的，它必须是VPC CIDR块的子集。例如，我们可以使用CIDR地址块176.13.0.0/24在之前创建的VPC中定义一个子网。它确实是176.13.0.0/16的子集。</p><p id="c424" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为什么我们需要这样的子网？云架构师在构建应用程序时要牢记三个主要原因:</p><ul class=""><li id="f5fd" class="mb mc iq kz b la lb ld le lg md lk me lo mf ls oa mh mi mj bi translated"><strong class="kz ir">将实例彼此隔离</strong>:一个<em class="mk">公共</em>子网可用于直接与互联网通信的web服务器，而一个<em class="mk">私有</em>子网可用于仅与web服务器通信。</li><li id="796d" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated"><strong class="kz ir">控制实例间的流量:</strong>当你有一个分段的架构时，监控你的网络和防止攻击就变得更容易了。它还可以通过允许流量只到达某些子网来提高性能。</li><li id="3a84" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated"><strong class="kz ir">保持井然有序</strong>通过为每个子网分配特定的功能:一个子网可以专用于存储，例如RDS之类的服务。</li></ul><p id="18d6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后但同样重要的是，您应该记住每个子网只能跨越一个<em class="mk">可用区域</em> (AZ)。正如我们在上一篇文章中看到的，这意味着单个子网内的资源容易受到本地故障的影响(因为AZ对应于一个物理数据中心)。为了使您的应用程序<em class="mk">具有高可用性(HA) </em>，您需要跨可用性区域复制子网，但仍然在同一个VPC内。</p><p id="8686" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">因此，让我们看看它在我们之前设计的应用程序中会是什么样子。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ob"><img src="../Images/dbc2eda3e571e461e6bdbd233a45961f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_YS4h8LXhe6Y7aB-H7YvXw.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">基本设置，单个VPC覆盖一个IPv4数据块和一个IPv6数据块，两个子网跨越两个az。</p></figure><p id="e711" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们现在有了一个合适的网络设置。现在，我们如何让我们的实例相互通信呢？</p><h1 id="9e97" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">实例和网络之间的通信</h1><h2 id="8785" class="no mr iq bd ms np nq dn mw nr ns dp na lg nt nu nc lk nv nw ne lo nx ny ng nz bi translated">弹性网络接口</h2><p id="5eda" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">弹性网络接口(ENI)使网络实例之间能够进行通信。因此，任何实例都必须至少有一个:它是您的实例和一个子网之间的链接。IP地址实际上绑定到ENI，而不是实例！</p><p id="527e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">大多数时候，我们忽略这些ENI，因为它们将单个实例链接到单个子网。因此，我们之前的架构实际上应该是这样的(为简单起见，仅查看一个AZ):</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oc"><img src="../Images/fc703b6da27d7114935f4c092789e8f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OnT-soP5RSTr0VLqZqWjpQ.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">IP绑定到ENIs，ENIs反过来支持与实例的通信。</p></figure><p id="1286" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">尽管如此，当一个实例出现故障时，Eni对于重定向流量还是很有用的。考虑下面有两个实例的情况:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi od"><img src="../Images/ea07df96dbdcd6e80ee5a34d6bad4c94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cylBDF09tIQYWhe5VxA5kg.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">在实例失败的情况下，可以使用相同的IP地址，而使用不同的实例来完成处理工作。</p></figure><p id="24d4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果实例1出现故障，其ENI可以作为<em class="mk">辅助</em> ENI连接到实例2。从外部看，流量仍然到达同一个IP地址，但实际上是由幕后的另一个实例处理的。</p><p id="3e52" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在我们可以在子网内进行通信，那么与互联网通信呢？</p><h2 id="f517" class="no mr iq bd ms np nq dn mw nr ns dp na lg nt nu nc lk nv nw ne lo nx ny ng nz bi translated">互联网网关</h2><p id="2658" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">为此，我们使用互联网网关(IG)作为中间人，连接到子网。它将给出一个实例:</p><ul class=""><li id="f19f" class="mb mc iq kz b la lb ld le lg md lk me lo mf ls oa mh mi mj bi translated">一个<strong class="kz ir">公共IP地址，</strong>不同于标识子网内实例的私有IP地址(因此实例可以有两个IP——公共和私有！),</li><li id="2c6e" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated">到互联网的<strong class="kz ir">连接</strong>以查询网络客户端，例如，</li><li id="14df" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated">从互联网接收请求的能力</li></ul><p id="adcd" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">IG与单个VPC相关联。你认出它是因为它在AWS上的ID以<code class="fe oe of og oh b">igw-xxx</code>开头。</p><p id="3e04" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在，请注意，我们从未提及实例之间、子网之间、实例和互联网之间的流量应该如何流动，等等。那就是<em class="mk">路由表</em>介入的地方。它将指定从您的实例到其他实例和外部世界的路线。</p><h2 id="51e0" class="no mr iq bd ms np nq dn mw nr ns dp na lg nt nu nc lk nv nw ne lo nx ny ng nz bi translated">路由表</h2><p id="d251" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">关于路由表，您应该记住的第一件事是它们链接到一个或多个子网。路由表描述了应该如何重定向来自子网实例的流量。就路线而言，我们指以下两件事:</p><ul class=""><li id="5b2d" class="mb mc iq kz b la lb ld le lg md lk me lo mf ls oa mh mi mj bi translated">以CIDR记法表示为IP地址的<strong class="kz ir">目的地</strong></li><li id="a936" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated">一个<strong class="kz ir">目标</strong>，这是一个AWS网络资源，如IG、ENI、本地或NAT设备(继续阅读了解这是什么；)</li></ul><p id="d4b4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">起初，让我感到困惑的是，一条路线只有一个目的地。实际上是因为原点是与路由表相关联的整个子网。</p><p id="06db" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">同样令人困惑的是:目的地和目标有什么区别？目的地是您希望数据包(数据)最终到达的最终IP地址，而目标是数据包下一步应该到达的地方，以便更接近这个最终目的地。</p><p id="f136" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">有两条特别重要的路线，您几乎会一直看到:</p><ul class=""><li id="a47f" class="mb mc iq kz b la lb ld le lg md lk me lo mf ls oa mh mi mj bi translated"><em class="mk">本地路由</em>允许来自一个子网的实例与VPC内不同子网的其他实例通信。</li><li id="3984" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated"><em class="mk">默认路由</em>指向互联网网关，允许互联网访问与路由表相关联的子网。</li></ul><p id="f935" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在我们的应用中，我们通常可以为第一个子网配置下表:</p><pre class="kh ki kj kk gt oi oh oj ok aw ol bi"><span id="070d" class="no mr iq oh b gy om on l oo op">----- Example of a Route table for a webserver ----<br/>+-------------------------+------------------------+<br/>|     Destination         |         Target         |<br/>+-------------------------+------------------------+<br/>| 2001:db8:1234:1a00::/56 |  local                 |<br/>| 0.0.0.0/0               |  igw-0e533011g0frrd318 |<br/>| ::/0                    |  igw-0e533011g0frrd318 |<br/>+-------------------------+------------------------+</span></pre><p id="5f9b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您可以看到，第一条路由将流量从我们创建的第一个子网重定向到第二个子网，第二个子网由2001:db8:1234:1a00::/56定义。最后两行简单地创建了与我们的第一个子网的互联网连接，允许所有地址("<strong class="kz ir"><em class="mk">0 . 0 . 0 . 0/0</em></strong><em class="mk">"</em>IP v4和"<strong class="kz ir"><em class="mk">::/0</em></strong><em class="mk">"</em>IPv6中的【】指的是所有地址—公共地址和您的VPC内的地址)通过IG到达。由于这两条线，子网变成了<em class="mk">公共子网</em>。如果没有这些到互联网网关的连接，它将是一个<em class="mk">私有子网</em>。</p><p id="466d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们用这些新元素更新我们应用的云架构:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oq"><img src="../Images/d5c379117d2d9aaddf1728179b047b3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pSbgz33J2fkLqN6z1wqbhg.png"/></div></div></figure><p id="a9ec" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您可以看到上面的子网是公共的，而包含数据库的子网是私有的。请注意，私有子网仍然可以通过公共子网间接访问互联网。</p><p id="6a5b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果现在您想以一种详细的方式控制流向您的实例的流量，该怎么办呢？比如哪个协议被允许到达你的实例，在哪个端口，等等。？</p><h1 id="b1ed" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">安全事项</h1><p id="c7c7" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">主要通过在实例级使用<em class="mk">安全组</em>和在子网级使用<em class="mk">网络访问控制列表</em> (NACL)来实现对到达基础设施的内容的细粒度控制。</p><h2 id="eebc" class="no mr iq bd ms np nq dn mw nr ns dp na lg nt nu nc lk nv nw ne lo nx ny ng nz bi translated">安全组</h2><p id="5fe1" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">安全组基本上是一个防火墙，它控制着与该安全组链接的实例之间的流量。这是通过指定<em class="mk">入站</em>和<em class="mk">出站</em>规则来实现的，由以下内容组成:</p><ul class=""><li id="ba20" class="mb mc iq kz b la lb ld le lg md lk me lo mf ls oa mh mi mj bi translated">数据包的入站规则的<strong class="kz ir">源</strong>(分别为出站规则的<strong class="kz ir">目的地</strong>)表示为CIDR块或另一个安全组的ID</li><li id="bee6" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated"><strong class="kz ir"> </strong> <a class="ae kw" href="https://en.wikipedia.org/wiki/Internet_protocol_suite" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir">协议</strong> </a> <strong class="kz ir"> </strong>用于与实例之间传输数据包(如TCP)</li><li id="cbcd" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated"><a class="ae kw" href="https://en.wikipedia.org/wiki/Port_(computer_networking)" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir">端口</strong> </a> <strong class="kz ir">范围</strong>，指定数据包通过哪些端口中转</li></ul><p id="2418" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们以您想用作web服务器的EC2实例为例。在这种情况下，你会允许每个IP地址作为一个来源，因为你希望你的用户访问你的应用程序，对不对？在这种情况下，用于在互联网用户和实例之间建立连接的协议将是TCP，而端口范围是443，通常用于<a class="ae kw" href="https://en.wikipedia.org/wiki/HTTPS" rel="noopener ugc nofollow" target="_blank"> HTTPS </a>数据传输。现在，您可能还想从远程终端控制您的实例来做一些维护工作。您将通过SSH从一个特定的源(例如在197.52.101.10)完成这项工作。考虑到这一点，安全组的入站规则如下所示:</p><pre class="kh ki kj kk gt oi oh oj ok aw ol bi"><span id="b5cc" class="no mr iq oh b gy om on l oo op">- Example of Security group Inbound rules -<br/>+------------------+----------+------------+<br/>|      Source      | Protocol | Port range |<br/>+------------------+----------+------------+<br/>| 0.0.0.0/0        |    TCP   |        443 |<br/>| ::/0             |    TCP   |        443 |<br/>| 197.52.101.10/32 |    TCP   |        443 |<br/>+------------------+----------+------------+</span></pre><p id="a5e7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">请注意，默认情况下，所有外部通信都被拒绝。您需要明确地将将要与您的实例通信的<em class="mk">源列入白名单</em>。</p><p id="15f7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">另一方面，对于出站通信，默认情况下允许所有地址。这意味着您的默认出站规则如下所示:</p><pre class="kh ki kj kk gt oi oh oj ok aw ol bi"><span id="f32f" class="no mr iq oh b gy om on l oo op">Default Security Group's Outbound rules <br/>+-------------+----------+------------+<br/>| Destination | Protocol | Port range |<br/>+-------------+----------+------------+<br/>| 0.0.0.0/0   |    TCP   |        443 |<br/>| ::/0        |    TCP   |        443 |<br/>+-------------+----------+------------+</span></pre><p id="84ba" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后，关于安全组有一个重要的概念需要记住:据说它是<em class="mk">有状态的</em>。这意味着，如果在一个方向上允许一些流量，那么在相反的方向上也允许一些回复流量。这在与互联网客户端通信时很重要:我们的实例可能试图向web服务器发送一个包(像GET请求)并期待一个应答。我们的安全小组将允许答案通过。</p><p id="09de" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当安全组在实例级控制流量时，另一个服务用于更方便地控制子网间的流量:<em class="mk"> NACL </em>。</p><h2 id="9baf" class="no mr iq bd ms np nq dn mw nr ns dp na lg nt nu nc lk nv nw ne lo nx ny ng nz bi translated">氯化钠</h2><p id="f33b" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated"><em class="mk">网络访问控制列表</em>在使用规则控制入站和出站流量的意义上类似于安全组。但是，一个NACL连接到一个子网，控制进出整个子网的流量。对于子网实例之间的流量，安全组是首选。</p><p id="0c0e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">与担保集团类似，NACL实施以下列要素为特征的规则:</p><ul class=""><li id="a1d7" class="mb mc iq kz b la lb ld le lg md lk me lo mf ls oa mh mi mj bi translated"><strong class="kz ir">规则号</strong>:一个整数，用于确定规则应用的顺序。首先应用较低的规则编号。</li><li id="fb71" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated"><strong class="kz ir">协议</strong>:与安全组相同的字段</li><li id="22c5" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated"><strong class="kz ir">端口范围</strong>:与安全组相同的字段</li><li id="9373" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated"><strong class="kz ir">入站规则的源</strong>(或出站规则的<strong class="kz ir">目的地</strong>):与安全组的字段相同</li><li id="4ad8" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated"><strong class="kz ir">动作</strong>:要么<em class="mk">允许</em>要么<em class="mk">拒绝</em>与<em class="mk"> </em>的通信源或目的地</li></ul><p id="c1af" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">创建子网时，会附加一个默认NACL，并且可以进一步修改。它的默认入站规则如下所示:</p><pre class="kh ki kj kk gt oi oh oj ok aw ol bi"><span id="292f" class="no mr iq oh b gy om on l oo op">--------------- Default NACL Outbound rules -----------------<br/>+-------------+-----------+------------+-----------+---------+<br/>| Rule Number |  Protocol | Port Range |  Source   |  Action |<br/>+-------------+-----------+------------+-----------+---------+<br/>| 100         | All       | All        | 0.0.0.0/0 | Allow   |<br/>| *           | All       | All        | 0.0.0.0/0 | Deny    |<br/>+-------------+-----------+------------+-----------+---------+</span></pre><p id="8b1a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">请注意，默认情况下允许所有入站流量，这与安全组不同！另请注意，最后一行带有星号作为规则编号:这是一个默认规则，不能修改或删除。它会拒绝先前规则未明确允许的任何流量。</p><p id="4f31" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">NaCl有一个特性会导致一些错误，因此值得记住:NaCl是无状态的。这意味着它不会自动返回流量:您需要指定与允许通信发生的入站规则相对应的出站规则。或者你可以使用短暂的港口，但那是另外一个故事了！</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi or"><img src="../Images/28c59ba7663f81920ac5ffba180e8137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yxf_gig7a4Lj98M-bSE2_g.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">NACLs覆盖整个子网，而安全组在实例级运行(注意，DynamoDB没有安全组，而是使用IAM角色……)</p></figure><h2 id="8fdb" class="no mr iq bd ms np nq dn mw nr ns dp na lg nt nu nc lk nv nw ne lo nx ny ng nz bi translated">结论</h2><p id="b463" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">我们讨论了正确启动AWS服务所需的基本概念。我们看到了如何根据实例的利用率将实例安排到子网中。我们还支持实例之间的通信以及与互联网的通信(IG，路由表)。最后，我们通过指定应该允许哪些流量到达我们的实例(安全组，NACL)来保护我们的基础设施。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h2 id="131f" class="no mr iq bd ms np nq dn mw nr ns dp na lg nt nu nc lk nv nw ne lo nx ny ng nz bi translated"><em class="kf">接下来的步骤</em></h2><p id="4669" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">请记住，这篇文章仅仅触及了理解云架构的皮毛。下一步，您可能会对AWS UI感兴趣，创建自己的免费资源(使用免费层服务)。然后，通过阅读文档或关注AWS定期推出的新服务，您可以了解许多微妙之处:</p><ul class=""><li id="5f04" class="mb mc iq kz b la lb ld le lg md lk me lo mf ls oa mh mi mj bi translated">例如，在创建VPC之后，您仍然可以使用<em class="mk">辅助CIDR块</em>为VPC分配IP地址(正如这里<a class="ae kw" href="https://aws.amazon.com/about-aws/whats-new/2017/08/amazon-virtual-private-cloud-vpc-now-allows-customers-to-expand-their-existing-vpcs/" rel="noopener ugc nofollow" target="_blank">所宣布的</a>)。这是为了在您需要更多资源时随时进行扩展。</li><li id="13a7" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated">最好使用安全组来限制出站流量，因为随着更新，端口可能会改变，并且NACLs不允许对其进行动态改变。</li><li id="9c49" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated">您可以使用<a class="ae kw" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html" rel="noopener ugc nofollow" target="_blank">弹性IP地址</a>独占访问和使用一系列公共IP地址。</li><li id="34d5" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated">只需将流量从私有子网重新路由到<a class="ae kw" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_NAT_Instance.html\" rel="noopener ugc nofollow" target="_blank"> NAT设备</a>，以进一步保护您的敏感实例(数据库等)。)</li><li id="2027" class="mb mc iq kz b la ml ld mm lg mn lk mo lo mp ls oa mh mi mj bi translated">还有更多…</li></ul><p id="7573" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">一如既往地感谢您的阅读，请不要犹豫给我提供反馈或意见，以提高我对这个主题的理解。</p></div></div>    
</body>
</html>