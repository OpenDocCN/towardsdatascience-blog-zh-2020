<html>
<head>
<title>Tracking Raspberry Pi Internal Temperatures in Computer Vision Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在计算机视觉应用中跟踪Raspberry Pi内部温度</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tracking-raspberry-pi-internal-temperatures-in-computer-vision-applications-3c039fe6ec14?source=collection_archive---------44-----------------------#2020-03-20">https://towardsdatascience.com/tracking-raspberry-pi-internal-temperatures-in-computer-vision-applications-3c039fe6ec14?source=collection_archive---------44-----------------------#2020-03-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2225d13d6a64c7e2b30045d98e6720fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MdkyYgd-ZBQZlP6cM9H4Bg.png"/></div></div></figure><p id="9781" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行计算机视觉应用程序(或一般的人工智能应用程序)会给边缘设备带来压力，尤其是在组合模型时。使用<a class="ae kz" href="https://medium.com/hacksters-blog/carefully-researched-raspberry-pi-3-active-cooling-10109a045235" rel="noopener">散热器和风扇</a>可能足以防止设备节流，但在您的设备变得这么热之前得到通知会很有帮助。收到潜在不安全温度的警报后，您可以在设备烧毁之前停止应用程序，并继续监控温度——当设备充分冷却后，您可以选择重新启动程序。</p><p id="f208" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">为此，我们创建了一个实用程序类，使您能够跟踪和记录温度读数，并提供所收集数据的摘要。</strong></p><p id="c301" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本教程使用一个Raspberry Pi 4和包“gpiozero”，它默认安装在Raspbian操作系统映像上。欲了解更多关于此包的信息，请参见以下<a class="ae kz" href="https://gpiozero.readthedocs.io/en/stable/installing.html" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="04ce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">要完成本教程，您必须具备:</strong></p><ol class=""><li id="2d54" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">一个<a class="ae kz" href="https://alwaysai.co/auth?register=true&amp;utm_campaign=Open%20Beta&amp;utm_source=medium&amp;utm_content=temperature-tracking" rel="noopener ugc nofollow" target="_blank"> alwaysAI账号</a>(免费！)</li><li id="3cb2" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">在你的机器上设置alwaysAI<a class="ae kz" href="https://alwaysai.co/docs/getting_started/development_computer_setup.html" rel="noopener ugc nofollow" target="_blank"/>(也是免费的)</li><li id="1fb9" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">诸如<a class="ae kz" href="https://www.sublimetext.com/" rel="noopener ugc nofollow" target="_blank"> sublime </a>之类的文本编辑器或者诸如<a class="ae kz" href="https://www.jetbrains.com/pycharm/" rel="noopener ugc nofollow" target="_blank"> PyCharm </a>之类的IDE，或者任何你喜欢用来编码的东西</li></ol><p id="4790" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请参见alwaysAI <a class="ae kz" href="https://learn.alwaysai.co/?&amp;utm_campaign=Open%20Beta&amp;utm_source=medium&amp;utm_content=temperature-tracking" rel="noopener ugc nofollow" target="_blank">博客</a>了解更多关于<a class="ae kz" href="https://learn.alwaysai.co/computer-vision-101?&amp;utm_campaign=Open%20Beta&amp;utm_source=medium&amp;utm_content=temperature-tracking" rel="noopener ugc nofollow" target="_blank">计算机视觉</a>、<a class="ae kz" href="https://learn.alwaysai.co/blog/computer-vision-application-lifecycles-explained-0?&amp;utm_campaign=Open%20Beta&amp;utm_source=medium&amp;utm_content=temperature-tracking" rel="noopener ugc nofollow" target="_blank">开发模型</a>、如何<a class="ae kz" href="https://learn.alwaysai.co/blog/change-computer-vision-models-alwaysai-platform-0?&amp;utm_campaign=Open%20Beta&amp;utm_source=medium&amp;utm_content=temperature-tracking" rel="noopener ugc nofollow" target="_blank">改变模型</a>等等。</p><p id="7467" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本教程的所有代码都可以在<a class="ae kz" href="https://github.com/alwaysai/temperature-tracker" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><p id="2b59" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本教程有两个主要部分:</p><ol class=""><li id="47fd" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">添加GPIO零要求</li><li id="171d" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">初始化app.py文件中的温度跟踪器</li></ol><p id="a9ed" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">我们开始吧！</strong></p><p id="4cbf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当你有了你的免费账户并建立了你的开发者环境后，你需要下载所有的入门应用；在继续本教程的其余部分之前，使用此链接完成<a class="ae kz" href="https://www.alwaysai.co/docs/reference/starter_applications.html?&amp;utm_campaign=Open%20Beta&amp;utm_source=medium&amp;utm_content=temperature-tracking" rel="noopener ugc nofollow" target="_blank">操作。</a></p><p id="cd7e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为本教程修改的应用程序是“对象检测器”应用程序，因此cd进入starter apps文件夹，然后进入“realtime_object_detector”文件夹。</p><ol class=""><li id="d4e0" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">添加GPIO零要求:</li></ol><ul class=""><li id="b469" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lo lg lh li bi translated">首先，将requirements.txt文件添加到您的文件夹中。</li><li id="c6f3" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lo lg lh li bi translated">将内容“gpiozero”添加到requirements.txt。这将在您部署应用程序时安装。有关<a class="ae kz" href="https://alwaysai.co/docs/application_development/handling_app_dependencies.html?&amp;utm_campaign=Open%20Beta&amp;utm_source=medium&amp;utm_content=temperature-tracking" rel="noopener ugc nofollow" target="_blank">依赖关系</a>的更多信息，请参见alwaysAI文档。</li></ul><p id="abce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意:<em class="lp">如果您的Pi没有连接wifi，将无法下载requirements.txt中的需求</em></p><p id="b479" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.更新app.py文件以使用温度跟踪器:</p><ul class=""><li id="cce1" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lo lg lh li bi translated">通过在“app.py”的顶部添加以下行来导入温度跟踪器代码:</li></ul><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="0ea5" class="lz ma it lv b gy mb mc l md me">from temperature_tracker import TemperatureTracker</span></pre><ul class=""><li id="622f" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lo lg lh li bi translated">在打印描述模型、引擎、加速器和标签的语句后，我们将创建TemperatureTracker实例。添加以下代码行:</li></ul><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="e680" class="lz ma it lv b gy mb mc l md me">temperature_tracker = TemperatureTracker()</span></pre><ul class=""><li id="b829" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lo lg lh li bi translated">现在，我们需要标记开始记录温度数据的时间。在try/with块内，但在“while”循环之前，在启动FPS实例后立即添加以下代码:</li></ul><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="8d27" class="lz ma it lv b gy mb mc l md me">temperature_tracker.start()</span></pre><ul class=""><li id="131e" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lo lg lh li bi translated">要实际捕获温度数据，请调用“update”方法。将以下代码放入while循环中:</li></ul><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="3fa0" class="lz ma it lv b gy mb mc l md me">temperature_tracker.update()</span></pre><p id="391f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意:<em class="lp">为了可读性，我在“预测中的预测”循环之后和温度语句之前添加了一个空行。这可以在任何时候使用' text.append(" ")在流文本输出中获得更好的可读性。</em></p><ul class=""><li id="8c4b" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lo lg lh li bi translated">要仅获取当前读数，而不修改存储的数据，可以使用“now”方法。这将返回温度和相应的时间戳。为此，请在上一步中添加的update调用之后添加以下代码行:</li></ul><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="cd80" class="lz ma it lv b gy mb mc l md me">now = temperature_tracker.now()</span></pre><ul class=""><li id="9b3d" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lo lg lh li bi translated">我们可以将当前温度附加到发送给streamer的文本中，并检查返回的温度是否安全(至少对于Raspberry Pi 4是如此)。在前面两步中所做的更改下添加以下代码:</li></ul><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="354c" class="lz ma it lv b gy mb mc l md me"># log block showing current temperature<br/>text.append(“{:1.2f}C/{:1.2f}F at time {}\n”.format(now[0], ((now[0]*(9 / 5)) + 32),time.strftime(‘%Y-%m-%d %H:%M:%S’, now[1])))</span><span id="266f" class="lz ma it lv b gy mf mc l md me"># details whether the temperature is safe for a Raspberry Pi 4<br/>if now[0] &lt; temperature_tracker.MAX_TEMP_RASP4:<br/>    text.append(“Temperature is safe”)<br/>else:<br/>    text.append(“TEMPERATURE IS NO LONGER SAFE”)</span></pre><p id="add1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意:<em class="lp">如果您在应用程序停止之前没有在流媒体工具上看到警告消息，这意味着在应用程序停止之前浏览器提要没有刷新。一旦程序停止，您仍会在控制台上看到此警告消息。</em></p><ul class=""><li id="7873" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lo lg lh li bi translated">在调用fps.update()后，添加以下检查:</li></ul><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="34c0" class="lz ma it lv b gy mb mc l md me">if now[0] &gt;= temperature_tracker.MAX_TEMP_RASP4:<br/>    print(<strong class="lv iu">“Maximum safe temperature reached, stopping program”</strong>)<br/>    break</span></pre><ul class=""><li id="0a08" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lo lg lh li bi translated">最后，在最后一个块中，在停止FPS实例后，通过添加以下内容来标记停止跟踪器的时间:</li></ul><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="de08" class="lz ma it lv b gy mb mc l md me">temperature_tracker.stop()</span></pre><ul class=""><li id="5c1f" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lo lg lh li bi translated">通过在“程序结束”打印语句前添加以下几行，捕获并打印温度汇总数据:</li></ul><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="d40e" class="lz ma it lv b gy mb mc l md me">summary = temperature_tracker.summary()<br/>print(summary)</span></pre><p id="ee76" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样！现在，您可以构建并启动您的应用程序来查看它的运行情况。您可能需要先配置应用程序，尤其是在您更改了边缘设备或从头开始创建新文件夹的情况下。您可以使用以下命令完成此操作，并在出现提示时输入所需的配置输入:</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="8794" class="lz ma it lv b gy mb mc l md me">aai app configure</span></pre><p id="cd7c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，要查看您的应用程序的运行情况，首先通过在命令行中键入以下内容来构建应用程序:</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="b7d4" class="lz ma it lv b gy mb mc l md me">aai app deploy</span></pre><p id="101c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">构建完成后，使用以下命令启动应用程序:</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="7a74" class="lz ma it lv b gy mb mc l md me">aai app start</span></pre><p id="a11d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">打开浏览器localhost:5000，查看应用程序的运行情况，并在终止程序后观察控制台，查看您的温度数据摘要，如下所示。</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mg"><img src="../Images/e57940562595e9ce339dcb96684bf325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nQDK7cNBQMdvm7l7AmaFlg.png"/></div></div></figure></div></div>    
</body>
</html>