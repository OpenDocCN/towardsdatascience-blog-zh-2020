<html>
<head>
<title>How to Extract Web Data Efficiently: 4 Ways</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何有效提取 Web 数据:4 种方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-extract-web-data-efficiently-4-ways-926434ac6c46?source=collection_archive---------7-----------------------#2020-05-13">https://towardsdatascience.com/how-to-extract-web-data-efficiently-4-ways-926434ac6c46?source=collection_archive---------7-----------------------#2020-05-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="93d4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这些被忽视的方法将为你节省时间和金钱</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d9341030e9996d59049f1031e8830c79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hdgQsOsKL4h1_AWD"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卢卡斯·布拉塞克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="cd4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名程序员和经常使用数据的人，我经常很难找到好的完整数据集来使用。开源数据库是有限的，API 使用起来可能很昂贵——更不用说每分钟、每天、每月调用次数的限制了。</p><p id="8685" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在几个项目的过程中，我总结了一些为 Python(和 Excel)用户提取和导入 web 数据的基本方法。我非常依赖这些方法来完成任何需要自己获取数据并将其导入工作空间的项目。</p><p id="c83e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，对于非编码项目，我将演示一个有价值的 Excel 工具，它允许您从网页中抓取格式化数据，自动将值填充到电子表格中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="cf8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是四种方法。我将用同样的目标数据集来说明它们:截至 2020 年 3 月的 ATP 网球运动员排名。</p><h1 id="b87d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.使用熊猫:read_html</h1><p id="a560" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">网球数据的一个奇妙来源是 tennisabstract.com 的 T4。这是 ATP 官方排名的网页。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/4ecd72e6c9f0bf235a78a4ca3ec59be0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XTZ2yo7JUl3VaBa8yXSwGw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ATP 排名更新 2020 年 3 月 9 日，<a class="ae ky" href="http://tennisabstract.com/reports/atpRankings.html" rel="noopener ugc nofollow" target="_blank">tennisabstract.com</a></p></figure><p id="74ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查 HTML 后，结构看起来很简单——有四个 table 标记，最后一个包含逐行列出的玩家排名。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/2fe61ee1cc66333af83824aebedacf26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NcAbjy9-4OMEbHiWUMfbbg.png"/></div></div></figure><p id="a3c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当数据已经被很好地格式化成 HTML 表时，检索它的最快方法是使用 Pandas 的<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/version/0.23.4/generated/pandas.read_html.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> read_html </strong> </a>。这个方法只是将一组 HTML 表读入一个 DataFrame 对象列表。</p><p id="1efe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:有一个字符串参数，<strong class="lb iu"> match </strong>，它确保只返回包含与给定字符串匹配的文本的表。这对于包含大量 HTML 表格的页面非常有用。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="275f" class="ng md it nc b gy nh ni l nj nk">import pandas as pd</span><span id="632a" class="ng md it nc b gy nl ni l nj nk">tables = pd.read_html("<a class="ae ky" href="http://tennisabstract.com/reports/atpRankings.html" rel="noopener ugc nofollow" target="_blank">http://tennisabstract.com/reports/atpRankings.html</a>")</span><span id="0e29" class="ng md it nc b gy nl ni l nj nk">rankings = tables[-1]<br/>rankings.iloc[:200]</span></pre><p id="eb58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是前 200 名选手。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/be9d3c50ec15a4f3b2f401938b12916b.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*lL1iLGweJUblzJ1gIdRbMQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Top 200 强选手排名，<a class="ae ky" href="http://tennisabstract.com/reports/atpRankings.html" rel="noopener ugc nofollow" target="_blank">http://tennisabstract.com</a></p></figure><h1 id="7f26" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.使用 HTML 解析器:美丽的汤</h1><p id="30be" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">然而，事情并不总是那么简单。根据配置的不同，一些网站禁止使用<strong class="lb iu"> read_html </strong>函数直接访问，导致 HTTP 错误 403。无论如何，如果您想抓取表中没有格式化的数据，该怎么办呢？</p><p id="79bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是像 Beautiful Soup 这样的 HTML 解析器派上用场的地方。</p><p id="8937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们试试用美汤从 ATP 官方<a class="ae ky" href="https://www.atptour.com/en/rankings/singles" rel="noopener ugc nofollow" target="_blank">网站</a>提取排名。安装说明可以在<a class="ae ky" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="690e" class="ng md it nc b gy nh ni l nj nk">import requests<br/>from bs4 import BeautifulSoup</span><span id="fcd6" class="ng md it nc b gy nl ni l nj nk">url = "<a class="ae ky" href="https://www.atptour.com/en/rankings/singles" rel="noopener ugc nofollow" target="_blank">https://www.atptour.com/en/rankings/singles"</a><br/>response = requests.get(url)<br/>page = response.text<br/>soup = BeautifulSoup(page, 'lxml')</span></pre><p id="3476" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这段简短的代码，我们现在有了网页的 HTML。我们可以使用<strong class="lb iu"> soup.find_all("table") </strong>获得所有表的列表。可以通过传入 id 来定位一个特定的表——就此而言，页面上的任何对象都可以通过它的 HTML 标签和传入唯一的属性来访问(参见<a class="ae ky" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank"> docs </a>)。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="d8ff" class="ng md it nc b gy nh ni l nj nk">table = soup.find(class_="mega-table")<br/>[row.text.split() for row in table.find_all("tr")]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/d1078c385804eb93699eaf10c67b057a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*rangz28cE8qrJP7CldUudQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">嵌套列表，包含(1)标题列和(2)播放器行</p></figure><p id="3a83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">经过一点清理后，我们可以将数据组织成一个标题列表和另一个播放器行列表。剩下的工作就是将信息存储在数据帧中。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="5652" class="ng md it nc b gy nh ni l nj nk">header = [j for j in [i.strip("  ") for i in table.find_all("tr")[0].text.splitlines()] if j != ""]<br/>header.remove("Country")<br/>header.remove("Move")</span><span id="228e" class="ng md it nc b gy nl ni l nj nk">data = []<br/>for row in table.find_all("tr")[1:]:<br/>    x = row.text.split()<br/>    name = " ".join(i for i in x if i.isalpha() or "-" in i)<br/>    res = [i for i in x if not (i.isalpha() or "-" in i)]<br/>    res.insert(1, name)<br/>    if len(res) == 8:<br/>        res.pop(2)<br/>    data.append(res)</span><span id="c46b" class="ng md it nc b gy nl ni l nj nk">rankings2 = pd.DataFrame(data, columns=header)<br/>rankings2</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/3630a3886dc6e308fcf6bc6a83a44a1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*IzaQZ7INhPYe-vlI1bA7wA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ATP 排名前 100，<a class="ae ky" href="https://www.atptour.com/en/rankings/singles" rel="noopener ugc nofollow" target="_blank">https://www.atptour.com</a></p></figure><h1 id="10ce" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.使用 JSON 请求</h1><p id="1295" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">第三种方法是提取 JSON 格式的数据。作为一个例子，我们将从<a class="ae ky" href="https://www.ultimatetennisstatistics.com/rankingsTable" rel="noopener ugc nofollow" target="_blank">ultimatetennisstatistics.com</a>检索排名。</p><p id="b267" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您愿意右键单击并检查页面，您会在“Network”选项卡下看到一个 GET 请求是由 JSON 类型构成的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/4b2fc4cad2b5b813a2639bdfa620b07e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZzVd2ONSilUVH412RQqefg.png"/></div></div></figure><p id="62cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需点击相关的链接，就会产生下面的 JSON 输出页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/f56b8c72497e4b1aa4b59b59eeaef592.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fu9nfkMIkvMDmFLQ-JkjwA.png"/></div></div></figure><p id="104b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<strong class="lb iu">请求</strong>和<strong class="lb iu"> json </strong>库可以很容易地将 JSON 数据读入 Python，然后导入到 Pandas 数据帧中。这个简单的函数完成了这个任务。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="98ca" class="ng md it nc b gy nh ni l nj nk">import requests<br/>import json</span><span id="d7be" class="ng md it nc b gy nl ni l nj nk">def get_json(url):<br/>    response = requests.get(url)<br/>    rows = json.loads(response.text)['rows']<br/>    data = pd.DataFrame.from_dict(rows)<br/>    return data</span><span id="b3d2" class="ng md it nc b gy nl ni l nj nk">rankings3 = get_json(<a class="ae ky" href="https://www.ultimatetennisstatistics.com/rankingsTableTable?current=1&amp;rowCount=-1&amp;sort%5Brank%5D=asc&amp;searchPhrase=&amp;rankType=RANK&amp;season=&amp;date=&amp;_=1589249780003" rel="noopener ugc nofollow" target="_blank">"https://www.ultimatetennisstatistics.com/rankingsTableTable?current=1&amp;rowCount=-1&amp;sort%5Brank%5D=asc&amp;searchPhrase=&amp;rankType=RANK&amp;season=&amp;date=&amp;_=1589249780003</a>")</span><span id="3b98" class="ng md it nc b gy nl ni l nj nk">rankings3</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/fabc6c1250fd74511055126cdcd5c3ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hve1PFCwbJhPOJKKTSLORg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ATP 排名前 500，<a class="ae ky" href="https://www.ultimatetennisstatistics.com/rankingsTable" rel="noopener ugc nofollow" target="_blank">ultimatetennisstatistics.com</a></p></figure><h1 id="d0c1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.额外收获:使用 Excel 下载 HTML 数据</h1><p id="0f27" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">无需一行代码，您就可以将任何 HTML 文件下载到 Excel 电子表格中。我将使用来自<a class="ae ky" href="http://tennisabstract.com/reports/atpRankings.html" rel="noopener ugc nofollow" target="_blank">tennisabstract.com</a>的相同排名数据集来演示这一点。</p><h2 id="f064" class="ng md it bd me ns nt dn mi nu nv dp mm li nw nx mo lm ny nz mq lq oa ob ms oc bi translated">Excel for Windows</h2><ol class=""><li id="4942" class="od oe it lb b lc mu lf mv li of lm og lq oh lu oi oj ok ol bi translated">找到包含所需数据的网页。复制网址。</li><li id="8461" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated">打开 Excel，导航到“数据”选项卡，然后单击“从 Web”。</li><li id="5851" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated">将网站的 URL 粘贴到弹出框中，并按照提示匿名连接到该页面。</li><li id="01ac" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated">打开“导航”菜单，在“显示选项”下找到所需数据。检查数据是否正确显示，并将其“加载”到电子表格中。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/1b6e9e7eca3f366b5356623796e05622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tvaEjp-QVsMttCNWuo-zkQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/5b61b27652a388509d1dee1b60d44126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6NxivgOdgkuDII1lVYVueQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/2b10ae5abfa593a1249a85e7c4cc2ca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*5CKPd5nxgCnP1JwNAQz6gg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ATP 排名<a class="ae ky" href="http://tennisabstract.com/reports/atpRankings.html" rel="noopener ugc nofollow" target="_blank">(tennisabstract.com</a>)，导入 Windows Excel</p></figure><h2 id="b35e" class="ng md it bd me ns nt dn mi nu nv dp mm li nw nx mo lm ny nz mq lq oa ob ms oc bi translated"><strong class="ak">苹果电脑版 Excel】</strong></h2><ol class=""><li id="5f7c" class="od oe it lb b lc mu lf mv li of lm og lq oh lu oi oj ok ol bi translated">当在网页上时，右键单击，您应该会看到一个类似于“另存为…”或“将页面另存为…”的选项，这取决于您的浏览器。继续将文件以 HTML 格式保存在本地。</li><li id="58dc" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated">打开 Excel，导航到“数据”选项卡，然后单击“来自 HTML”。注意，该选项可能位于子菜单“获取外部数据”中。</li><li id="a622" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated">从弹出菜单中找到并打开保存的 HTML 文件。按照提示将数据加载到电子表格中。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/f4514408ca4b7111639e21368b86c08d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D_P6HHfRvCNzc_6AHWBwhg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ATP 排名【tennisabstract.com<a class="ae ky" href="http://tennisabstract.com/reports/atpRankings.html" rel="noopener ugc nofollow" target="_blank">，导入 Excel for Mac</a></p></figure><p id="3312" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！现在，数据已经被导入并格式化，每个值都在单独的单元格中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7aa1" class="mc md it bd me mf ov mh mi mj ow ml mm jz ox ka mo kc oy kd mq kf oz kg ms mt bi translated">事后思考</h1><p id="aee8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这些方法对于抓取网络数据并将其导入到一种更易处理的格式中是必不可少的——从这种格式中，你可以根据需要对数据进行清理、过滤、建模和可视化。</p><p id="161d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果您的第一反应是使用 API，您可能需要再考虑一下。尽管在某些情况下这可能是不可避免的，但是许多在线数据可以在不使用 API 的情况下被访问，这样就省去了您获取 API 密钥和浏览文档的精力和费用。</p><p id="fa34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这些工具对你的下一个数据分析项目有用。</p><p id="208b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>