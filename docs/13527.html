<html>
<head>
<title>The PyTorch DataLoader needed a facelift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyTorch 数据加载器需要翻新</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/fixing-the-pytorch-dataloader-990b336b8e5a?source=collection_archive---------49-----------------------#2020-09-16">https://towardsdatascience.com/fixing-the-pytorch-dataloader-990b336b8e5a?source=collection_archive---------49-----------------------#2020-09-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="587f" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">入侵数据科学工作流程</h2><div class=""/><div class=""><h2 id="136d" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">向 PyTorch 数据加载器类添加高度可定制性</h2></div><p id="64c2" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我最近遇到了一个有趣的问题。我和一个队友正在进行一系列深度学习实验，这些实验涉及一个跨越数百千兆字节的图像数据集。作为一个优柔寡断的傻瓜，我想知道这些数据是否适合过多的分类任务，所有这些任务都跨越数据集的不同配置。</p><p id="c118" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这让我们在一个<a class="ae ln" href="https://pytorch.org/docs/1.1.0/_modules/torch/utils/data/dataloader.html" rel="noopener ugc nofollow" target="_blank"> PyTorch DataLoader </a>形状的兔子洞里走了几个小时，之后我们几乎因为沮丧而放弃。谢天谢地，唯一比编写脚手架代码更令人沮丧的事情是等待虚拟机完成跨任意目录复制大量文件。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/1f10df184de3abefe5d6e89a6e8341e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GuOXRSEWOxxVDPMDT8Qf7A.jpeg"/></div></div><p class="ma mb gj gh gi mc md bd b be z dk translated">您是否曾经为了在不同的标签集上训练 PyTorch 模型而不得不复制/symlink 文件？(图片由<a class="ae ln" href="https://unsplash.com/photos/-2vD8lIhdnw" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ln" href="https://unsplash.com/@jeshoots" rel="noopener ugc nofollow" target="_blank">jeshouts</a>拍摄)</p></figure><p id="d3e6" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">幸运的是，我们很快发现了一个解决方案，并决定是时候对 DataLoader 类进行一次翻新了。我们将杂乱的脚手架代码清理干净，不仅添加了动态标记训练数据的功能，还添加了指定子集、执行自定义预处理操作以输入数据加载器等功能。几个小时的咖啡因诱导代码后，<a class="ae ln" href="https://binitai.github.io/BetterLoader/" rel="noopener ugc nofollow" target="_blank"> BetterLoader </a>诞生了。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi me"><img src="../Images/f44f1736bccba312ac64fa94ad5c6570.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/1*5rnaz1ee_sMteSLBdKa9MA.png"/></div><p class="ma mb gj gh gi mc md bd b be z dk translated">如果我说我对自己设计的商标一点都不自豪，那我是在撒谎</p></figure><p id="c027" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><a class="ae ln" href="https://binitai.github.io/BetterLoader/" rel="noopener ugc nofollow" target="_blank"> BetterLoader </a>完全去掉了默认的 PyTorch DataLoader 结构。现在，您可以将文件存储在一个单一的平面目录中，并使用<a class="ae ln" href="https://www.json.org/json-en.html" rel="noopener ugc nofollow" target="_blank"> JSON </a>配置文件的强大功能以不同的方式加载数据。例如，下面几行代码允许您加载带有动态标签的数据集子集:</p><pre class="lp lq lr ls gt mf mg mh mi aw mj bi"><span id="4889" class="mk ml it mg b gy mm mn l mo mp">from betterloader import BetterLoader</span><span id="97e0" class="mk ml it mg b gy mq mn l mo mp">index_json = './examples/index.json'<br/>basepath = "./examples/sample_dataset/"</span><span id="ed90" class="mk ml it mg b gy mq mn l mo mp">loader = BetterLoader(basepath=basepath, index_json_path=index_json)<br/>loaders, sizes = loader.fetch_segmented_dataloaders(<br/>batch_size=2, transform=None)</span></pre><p id="3140" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">酷的部分？我们的<code class="fe mr ms mt mg b">index.json</code>只包含一个键-值对的列表，其中键是类标签，值是相关文件名的列表。然而，读取索引文件的<a class="ae ln" href="https://binitai.github.io/BetterLoader/" rel="noopener ugc nofollow" target="_blank"> BetterLoader </a>函数可以被<a class="ae ln" href="https://binitai.github.io/BetterLoader/docs/#dataset-metadata" rel="noopener ugc nofollow" target="_blank">定制</a>，我已经能够通过正则表达式、布尔条件甚至 MongoDB 调用来使用这个库。</p><p id="45a1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我最新的<a class="ae ln" href="https://binitai.github.io/BetterLoader/" rel="noopener ugc nofollow" target="_blank"> BetterLoader </a>工作流包括检查是否需要加载图像，从 MongoDB 实例获取裁剪中心，创建一堆裁剪，然后将这些<strong class="kt jd">裁剪馈送给加载器。我只是使用了<a class="ae ln" href="https://binitai.github.io/BetterLoader/" rel="noopener ugc nofollow" target="_blank"> BetterLoader </a>，而不是每次都创建不同的搭建代码。</strong></p><p id="477a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">所以，是的。那是<a class="ae ln" href="https://binitai.github.io/BetterLoader/" rel="noopener ugc nofollow" target="_blank">更好的加载器</a> — <strong class="kt jd">类固醇 PyTorch 数据加载器</strong>。现在还为时尚早，但我们对让我们的生活，希望也是其他数据科学家的生活变得更容易的前景感到非常兴奋。如果你认为<a class="ae ln" href="https://binitai.github.io/BetterLoader/" rel="noopener ugc nofollow" target="_blank"> BetterLoader </a>听起来有用，并且你已经避开了我在本文中散布的所有文档的链接，你可以在 Github <a class="ae ln" href="https://github.com/binitai/betterloader" rel="noopener ugc nofollow" target="_blank">这里</a>找到源代码，在 PyPi 页面<a class="ae ln" href="https://pypi.org/project/BetterLoader/" rel="noopener ugc nofollow" target="_blank">这里</a>找到源代码。</p><p id="2622" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我们还将开放大量票证，以增加对无监督深度学习方法的支持，并修复最终会出现的过多问题，因为咖啡因引发的狂欢很少会产生完美稳定的库。我们希望<a class="ae ln" href="https://github.com/binitai/betterloader" rel="noopener ugc nofollow" target="_blank">能为我们带来一位明星</a>、<a class="ae ln" href="https://github.com/binitai/betterloader/issues" rel="noopener ugc nofollow" target="_blank">参与其中</a>，或者敬请关注！</p></div></div>    
</body>
</html>