<html>
<head>
<title>How to Split Shapefiles</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何拆分 Shapefiles</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-split-shapefiles-e8a8ac494189?source=collection_archive---------20-----------------------#2020-02-07">https://towardsdatascience.com/how-to-split-shapefiles-e8a8ac494189?source=collection_archive---------20-----------------------#2020-02-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7f08" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">切割阿拉斯加附近的西阿留申群岛(它们大多无人居住)</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/42e8c3481071456bbbd8339e225b544b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nWY7EsTuAZ0WH3LH"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿拉斯加。<a class="ae ky" href="https://unsplash.com/@rodlong?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杆长</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">上拍照</a></p></figure><p id="8843" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时您只需要 shapefile 的一部分。根据哪一部分和 shapefile 源，这可能非常简单，也可能不那么简单。例如，前几周，我在绘制美国各州向联邦消费者金融保护局投诉的相对比率(更多<a class="ae ky" rel="noopener" target="_blank" href="/data-prep-with-spark-dataframes-3629478a1041?source=friends_link&amp;sk=1393493838aa8a9f7d4438b1af778c9f">此处</a>)，我的 choropleth 是这样绘制的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/3a9063860308ae2aa846a5bf949ff86b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4mJFEQ47kwTnE89x5PhoIQ.png"/></div></div></figure><p id="5edb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然在这个比例下很难看到，但是西阿留申群岛穿过了 180 度经线<a class="ae ky" href="https://en.wikipedia.org/wiki/180th_meridian" rel="noopener ugc nofollow" target="_blank">,形成了这幅试图将球体展平为矩形的不连贯地图。</a></p><p id="c6b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决这个问题有几种选择:</p><ol class=""><li id="047a" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">将不需要的(同样是无人居住的)面从其多面簇中分离出来</li><li id="fdbb" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">对整个地理数据框使用 shapely 函数<code class="fe mk ml mm mn b">.intersects()</code></li><li id="24f8" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">在 matplotlib 中设置绘图的 x 极限</li><li id="a383" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">将正/东经多边形转换为负/西经多边形</li><li id="4e03" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">使用 Cartopy 进行不同的地图投影，而不是拆分形状</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/c18d42f7aef89a1fda6ca22e3e2b79d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QGkncfEHUxrhCB5k"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更多的阿拉斯加，而不是西阿留申群岛。<a class="ae ky" href="https://unsplash.com/@paxsonwoelber?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">帕克森·沃尔伯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="4662" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧:</p><h1 id="3ab2" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">将不需要的(同样是无人居住的)面从其多面簇中分离出来</h1><p id="edcb" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">我想从这个选项开始，因为它解决了一个我一次又一次碰到的更普遍的问题。如何在<code class="fe mk ml mm mn b">shapely</code>和/或<code class="fe mk ml mm mn b">geopandas</code>中拆分多个多边形，然后将它们放回一起用于 choropleths。</p><p id="cf57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我加载 shapefiles 并选择我想要处理的记录，在本例中是阿拉斯加。(谢谢<a class="ae ky" href="https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html" rel="noopener ugc nofollow" target="_blank">美国人口普查</a>提供的 shapefiles！#opendata)</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="0aa0" class="nq mq it mn b gy nr ns l nt nu"># import necessary packages<br/>import geopandas as gpd<br/>from matplotlib import pyplot as plt</span><span id="6f27" class="nq mq it mn b gy nv ns l nt nu"># load shapefile<br/>states_gdf = gpd.read_file('./data/cb_2018_us_state_5m.shp')</span><span id="25e9" class="nq mq it mn b gy nv ns l nt nu"># select Alaska<br/>alaska_gdf = states_gdf.loc[states_gdf['STUSPS'] == "AK"]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/32a3bb159611f4762a5c614422084372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E3jWhJSd0LYqAhZuCSEbpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">修改前的阿拉斯加地块。</p></figure><p id="50cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“geometry”列返回一个单项数据帧。您可以通过<code class="fe mk ml mm mn b">.values</code>访问形状良好的几何图形列表。在这种情况下，我们的单记录数据框架有一个项目列表。通过访问第一个值，我们得到了阿拉斯加形状优美的多多边形。</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="d3c7" class="nq mq it mn b gy nr ns l nt nu">alaska_mp = alaska_gdf['geometry'].values[0]</span></pre><p id="4cb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以使用原始状态地理数据框架，但我总是忘记到底有多少层，并且发现使用我的单记录数据框架进行猜测和检查更容易。</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="0b42" class="nq mq it mn b gy nr ns l nt nu">alaska_mp_alt = states_gdf.loc[states_gdf['STUSPS'] == "AK", <br/>                               'geometry'].values[0]</span></pre><p id="2a7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用多重多边形，您可以像访问列表或数组一样访问每个多边形。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/4ccb9e352a0a6bcb6a927447f2c9f43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*V_aHn3jp9sFIX3puwJJ4Pg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿拉斯加多重多边形中的第一个多边形。</p></figure><p id="9796" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在其当前形式下，当使用 Shapely 函数(如)时，整个多边形集合(多多边形)被视为一个整体。相交())。为了分别考虑每个面，我将多重面转换为其自己的地理数据框架:</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="3e72" class="nq mq it mn b gy nr ns l nt nu"># create the GeoDataFrame<br/>ak_exp_gdf = gpd.GeoDataFrame(alaska_mp)</span><span id="a09b" class="nq mq it mn b gy nv ns l nt nu"># set the geometry column<br/>ak_exp_gdf.columns = ['geometry']</span></pre><p id="be3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了一个地理数据框，其中每一行都是一个多边形，它们共同构成了阿拉斯加，我们可以根据我们想要或不想要的位置来过滤这些地理数据框了。我们需要制作一个形状优美的多边形，用来判断和过滤阿拉斯加的每一片土地。我们需要一个多边形来覆盖你想要(或不想要)的所有区域，我们将使用<code class="fe mk ml mm mn b">.intersects()</code>或你选择的另一个 shapely 函数来分类你的形状。</p><p id="606e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">多边形是用一列点/顶点创建的。最后一个点会自动连接到第一个点，因此您不需要自己闭合回路。</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="66b6" class="nq mq it mn b gy nr ns l nt nu">from shapely.geometry import Polygon</span><span id="54df" class="nq mq it mn b gy nv ns l nt nu"># create polygon that covers Alaska up to the 180th Meridian<br/>target_poly = Polygon([(-180, 50), (-180, 75), <br/>                       (-100, 75), (-100, 50)])</span></pre><p id="b03e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以使用这个多边形和 shapely/geopandas 的<code class="fe mk ml mm mn b">.intersects()</code>进行过滤。</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="b97a" class="nq mq it mn b gy nr ns l nt nu">western_isles = ak_exp_gdf[al_exp_gdf.intersects(target_poly) == <br/>                           False].copy()<br/>eastern_ak = ak_exp_gdf[al_exp_gdf.intersects(target_poly)].copy()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/fa6997f8f7b5bfc457d2abfb23306796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TanLrsKichAxxR_QkHRBIg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿拉斯加东部的地块</p></figure><p id="3fdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">厉害！！！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/5d3b353af413eaf0a760c33889bed34f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rhp46BswSohhiklM"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@funkmastacrump?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> McKayla Crump </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h2 id="bb18" class="nq mq it bd mr oa ob dn mv oc od dp mz li oe of nb lm og oh nd lq oi oj nf ok bi translated">将面的地理数据框架合并为多面</h2><p id="ebc9" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">现在我们有了感兴趣的阿拉斯加多边形，我们准备将此几何图形放入我们的州地理数据框架中。我们使用“by”参数，用<code class="fe mk ml mm mn b">.dissolve()</code>将一个多边形的数据帧组合成一个或多个多多边形。(我仍然不明白让“溶解”感觉像是“粘合”或“结合”的同义词的框架——也许我们正在溶解边界？)</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="ec44" class="nq mq it mn b gy nr ns l nt nu"># add a column to groupby<br/>eastern_ak['STUSPS'] = 'AK'</span><span id="0ecb" class="nq mq it mn b gy nv ns l nt nu"># combine polygons/records into a single multipolygon/record<br/>alaska_trimmed = eastern_ak.dissolve(by='STUSPS')</span><span id="eae8" class="nq mq it mn b gy nv ns l nt nu"># add this new multipolygon in place of the old alaska multipolygon<br/>states_trimmed = states_gdf.copy()<br/>states_trimmed.loc[states_trimmed['STUSPS'] == 'AK', 'geometry']<br/>  = alaska_trimmed['geometry'].values</span></pre><p id="d9f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们准备好了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/c48e1d5f73d07d64d2b3f2626a9e2dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*faPmvBA0WmllcwfX-6Vteg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">修剪过的美国地图。充分披露:我还修剪关岛，北马里亚纳群岛联邦，美属萨摩亚出这个阴谋。</p></figure><p id="8211" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个包含阿拉斯加的 choropleth 示例——水域面积与陆地面积的比率。阿拉斯加的巨大面积确实让我们很难看到东部的一些州，但控制局面很好，可以自由决定是否(以及如何)通过修剪来包含不同的形状。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/66d6af8c6764d76ceb0a51a01909447a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8XuW7TQGzDEFa4xssTuHDQ.png"/></div></div></figure><h1 id="a4cd" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">在整个地理数据框上使用匀称的<code class="fe mk ml mm mn b">.intersects()</code></h1><p id="08c2" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">您也可以修改几何图形，而无需将多重多边形分解为单独的多边形。这种方法确实有其特殊性，但是代码行要少得多。请注意，使用<code class="fe mk ml mm mn b">GeoDataFrame.intersection(<em class="on">shape</em>)</code>会返回一系列几何图形，而不是添加了新信息的原始地理数据框。您需要添加或替换一个列来将此信息存储在现有的地理数据框中。</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="ef1b" class="nq mq it mn b gy nr ns l nt nu">from shapely.geometry import Polygon</span><span id="c9d5" class="nq mq it mn b gy nv ns l nt nu"># create a polygon with the desired dimensions of the map<br/>desired_map = Polygon([(-180, 80), (-60, 80), (-60, 15), <br/>                       (-180, 15)])</span><span id="d131" class="nq mq it mn b gy nv ns l nt nu"># create a new copy of the states GeoDataFrame for this example<br/>states_trimmed_v3 = states_gdf.copy()</span><span id="8e06" class="nq mq it mn b gy nv ns l nt nu"># get the intersection of the states geometries with the desired map states_trimmed_v3['geometry'] = states_gdf.intersection(desired_map)</span></pre><p id="4524" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你试图直接<code class="fe mk ml mm mn b">.plot()</code>这个几何集合，你可能会得到一个<code class="fe mk ml mm mn b">TypeError: ‘Polygon’ object is not subscriptable</code>。当您有一些记录与您的相交几何不重叠时，就会发生这种情况，在我们的示例中，就是太平洋地区。在这种情况下<code class="fe mk ml mm mn b">.intersection()</code>返回一个空多边形。我的解决方案是在绘图前过滤这种情况。</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="4ff6" class="nq mq it mn b gy nr ns l nt nu">states_trimmed_v3[states_trimmed_v3['geometry'] != Polygon()].plot()</span></pre><p id="0e93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们得到了与上面相同的结果，不需要找到令人讨厌的形状，分割多重多边形，然后将多边形融合成一个单一的多重多边形。根据您的用例，这绝对是一个好的选择。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/ac8319212fbab3cbdd116c8cf83be180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DZWHyedde4BuQPw6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美丽的阿拉斯加天空。照片由<a class="ae ky" href="https://unsplash.com/@funkmastacrump?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">麦克凯拉·克伦普</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="ab20" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">在 matplotlib 中设置绘图的 x 极限</h1><p id="c5e3" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">另一个简单的选择是使用<code class="fe mk ml mm mn b">matplotlib</code>的图形界面来删除任何不想要的区域。</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="e039" class="nq mq it mn b gy nr ns l nt nu">fig, ax = plt.subplots(figsize=(15,10))<br/>alaska_gdf.plot(ax=ax)<br/>ax.set_xlim(-180, -128)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/fdbaa7f89db5fc66c6ab4a7b82e565d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nb2GFUKo84EfvKEdtLF6sg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 matplotlib 的绘图选项 ax.set_xlim()修剪阿拉斯加</p></figure><h1 id="bf74" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">将正/东经多边形转换为负/西经多边形</h1><p id="cd07" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">如果你想保留投影和阿留申群岛西部，你可以使用<code class="fe mk ml mm mn b">.translate()</code>将这些多边形的 x 值移动-360°。该选项使用上文描述的<a class="ae ky" href="#3ab2" rel="noopener ugc nofollow">分割多多边形的技术</a></p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="a36e" class="nq mq it mn b gy nr ns l nt nu"># shift the western isles by 360 degrees<br/>western_isles_shifted = western_isles.translate(xoff=-360)</span><span id="1dc1" class="nq mq it mn b gy nv ns l nt nu"># convert to GeoDataFrame<br/>west_ak_shift_gdf = gpd.GeoDataFrame(western_isles_shifted)<br/>west_ak_shift_gdf.columns = ['geometry']</span><span id="3794" class="nq mq it mn b gy nv ns l nt nu"># add 'STUSPS' column<br/>west_ak_shift_gdf['STUSPS'] = 'AK'</span><span id="2132" class="nq mq it mn b gy nv ns l nt nu"># combine the western and eastern parts into the same dataframe<br/>ak_shifted_actual_gdf = west_ak_shift_gdf.append(eastern_ak, <br/>                                                 ignore_index=True)</span><span id="10ad" class="nq mq it mn b gy nv ns l nt nu"># combine/dissolve into a single MultiPolygon<br/>ak_shifted_actual_dissolved = <br/>                         ak_shifted_actual_gdf.dissolve(by='STUSPS')</span></pre><p id="ecfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这会生成 x 值为-190 到-125 的阿拉斯加。在绘图时，您可能需要调整 x 刻度标签，以符合传统的-180°到+180°约定。</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="b486" class="nq mq it mn b gy nr ns l nt nu">fig, ax = plt.subplots(figsize=(15, 12))<br/>ak_shifted_actual_dissolved.plot(ax=ax)</span><span id="29b5" class="nq mq it mn b gy nv ns l nt nu"># get the locations and labels of the x-ticks<br/>locs, labels = plt.xticks()</span><span id="849b" class="nq mq it mn b gy nv ns l nt nu"># set the first label in labels to 170 instead of -190<br/>labels[1] = '170'</span><span id="14bb" class="nq mq it mn b gy nv ns l nt nu"># set the x-ticks with new labels (keeping the locs)<br/>plt.xticks(locs, labels)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/f26bc7cf4ff06013360dc38c7a35da47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pKIgNPXwoElrFwAPHhNM2w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿拉斯加和所有的阿留申群岛。</p></figure><p id="d623" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:我试图将整个美国移动+30 °,但这只改变了 x 轴上的 x 刻度值，而没有将地图最右边的部分移到左边。</p><h1 id="1430" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">对 Cartopy 使用不同的地图投影</h1><p id="13f1" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">或者，您可以使用<code class="fe mk ml mm mn b">Cartopy</code>根据自己的喜好改变地图投影。我喜欢这个选项！它允许您将地理空间数据调整到对项目最有意义的视图。</p><p id="33b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，用<code class="fe mk ml mm mn b">conda install -c conda-forge cartopy</code>安装或查看<a class="ae ky" href="https://scitools.org.uk/cartopy/docs/latest/installing.html#installing" rel="noopener ugc nofollow" target="_blank">完整安装指南</a>。请注意，我在 conda-forge 通道上也安装了 geopandas 将所有这些包及其依赖项安装在同一个通道上可能很好。</p><p id="a0d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那你准备好了！基本使用与上述相同的投影(平板托架):</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="88e4" class="nq mq it mn b gy nr ns l nt nu"># set figure size<br/>fig = plt.figure(figsize=(15, 12)</span><span id="9067" class="nq mq it mn b gy nv ns l nt nu"># set axis with desired projection<br/>ax = plt.axes(projection=ccrs.PlateCarree())</span><span id="5897" class="nq mq it mn b gy nv ns l nt nu"># add shapes, indicating their original projection<br/>ax.add_geometries(states_gdf['geometry'], <br/>                  crs=ccrs.PlateCarree())</span><span id="0e89" class="nq mq it mn b gy nv ns l nt nu"># add gridlines<br/>gl = ax.gridlines(crs=ccrs.PlateCarree(), draw_labels=True,<br/>                  linewidth=.5, color='gray', alpha=0.5)</span><span id="39f5" class="nq mq it mn b gy nv ns l nt nu"># display map<br/>plt.show();</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/420b2d51960ad7815edfbd209e36864d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_c7D1EYa78Dp0B-VYJUXWg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美国地图与卡雷板投影。</p></figure><p id="25dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里查看所有的预测<a class="ae ky" href="https://scitools.org.uk/cartopy/docs/latest/crs/projections.html#cartopy-projections" rel="noopener ugc nofollow" target="_blank"/>。在我的例子中，允许你设置视图中心的投影正是我所寻找的。</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="cbbd" class="nq mq it mn b gy nr ns l nt nu"># set desired projection/view<br/>ax = plt.axes(projection = ccrs.Orthographic(central_longitude=-100, <br/>                                             central_latitude=40))</span><span id="50a5" class="nq mq it mn b gy nv ns l nt nu"># add your shapes (indicating their existing projection)<br/>ax.add_geometries(states_gdf.geometry, crs=ccrs.PlateCarree())</span><span id="ab89" class="nq mq it mn b gy nv ns l nt nu"># add coastlines and gridlines for context<br/>ax.coastlines(linewidth=.5)<br/>ax.gridlines()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/e9002fa87cdee81a63f461261760d35e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*DVp4q2vL3XBKP9B6ic_MOw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">未用正交投影修剪的美国</p></figure><p id="3a3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以使用<code class="fe mk ml mm mn b">ax.set_extent(<em class="on">xmin, ymin, xmax, ymax</em>)</code>聚焦于特定区域。</p><p id="6854" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">若要调整几何图形的颜色，请使用各种面颜色分别添加它们。例如与上述相同的 choropleth:</p><pre class="kj kk kl km gt nm mn nn no aw np bi"><span id="ea0d" class="nq mq it mn b gy nr ns l nt nu">from matplotlib.colors import Normalize</span><span id="1af6" class="nq mq it mn b gy nv ns l nt nu"># value normalization for the color map<br/>values = list(states_trimmed_v2['water:land'])<br/>norm = Normalize(vmin=min(values), vmax=max(values))</span><span id="a9e6" class="nq mq it mn b gy nv ns l nt nu"># select color map<br/>cmap = plt.cm.get_cmap('viridis')</span><span id="4304" class="nq mq it mn b gy nv ns l nt nu">#create chorpleth: set fig and ax projection<br/>fig = plt.figure(figsize=(15,15))<br/>ax = plt.axes(projection = ccrs.Orthographic(central_longitude=-100, central_latitude=40))</span><span id="1a58" class="nq mq it mn b gy nv ns l nt nu"># add each state to the ax with its appropriate facecolor<br/>for state_i in states_trimmed_v2.index:<br/>    geom = []<br/>    geom.append(states_trimmed_v2.loc[state_i, 'geometry'])<br/>    facecolor = cmap(norm(states_trimmed_v2.loc[state_i, 'water:land']))<br/>    ax.add_geometries(geom, <br/>                      ccrs.PlateCarree(), <br/>                      facecolor=facecolor, <br/>                      edgecolor='grey', <br/>                      linewidth=.2)<br/>    <br/>ax.set_title('States By Water Area to Land Area Ratio', fontsize=20)<br/>ax.coastlines(linewidth=.2)<br/>ax.gridlines()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/d9b4d771aa4fb1a720fd4ce9306cae00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vu0OYHGLV7GFavK3692czg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有卡通图案的 Choropleth</p></figure></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><p id="12b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关更多信息，请查看以下资源:</p><ul class=""><li id="d5ac" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu oz mc md me bi translated">使用地理空间数据:<a class="ae ky" rel="noopener" target="_blank" href="/puppies-python-analyzing-geospatial-data-93dd9dc3137?source=friends_link&amp;sk=6486448b7c31de38bc6fc15a3e62f617">这篇博文</a>(由你的真实作者撰写)</li><li id="0a95" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oz mc md me bi translated">Cartopy 简介:<a class="ae ky" href="https://geohackweek.github.io/visualization/04-geopandas-and-cartopy/" rel="noopener ugc nofollow" target="_blank">由 geohackweek 发布</a></li></ul><p id="8384" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里找到 GitHub <a class="ae ky" href="https://github.com/allisonhonold/splitting_shapes" rel="noopener ugc nofollow" target="_blank">回购</a>。编码快乐！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/e65399c77f6026e70bba817d00b0d4e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QPlzXYjvcJHHP9TC"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@ronaldwong57?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">黄斌</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div></div>    
</body>
</html>