<html>
<head>
<title>Image Recommendations with PyTorch + Flask + PostgreSQL + Heroku deployment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">py torch+Flask+PostgreSQL+Heroku 部署的映像建议</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/image-recommendations-with-pytorch-flask-postgresql-heroku-deployment-206682d06c6b?source=collection_archive---------20-----------------------#2020-08-29">https://towardsdatascience.com/image-recommendations-with-pytorch-flask-postgresql-heroku-deployment-206682d06c6b?source=collection_archive---------20-----------------------#2020-08-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0774" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">用 Flask 封装一个基于 PostgreSQL/ PyTorch 的图像推荐系统，导入数据并在 Heroku 云应用平台上运行。</strong></h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7414f52bb2dfb210f321670cfb79a498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*riylSbFZVUMftHsjhMRZuA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">标识的选定图像和用于图像推荐应用的其他技术的自动检测的标识(来源:M. D. Korzec<a class="ae kv" href="https://flask.palletsprojects.com/en/1.1.x/license/#artwork-license" rel="noopener ugc nofollow" target="_blank">烧瓶标志许可证</a>；Python 标志<a class="ae kv" href="https://www.python.org/psf/trademarks/" rel="noopener ugc nofollow" target="_blank"> PSF 商标使用政策</a>；<a class="ae kv" href="https://www.w3.org/html/logo/" rel="noopener ugc nofollow" target="_blank"> html logo cc by 3.0 </a></p></figure><p id="21ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在过去的几周里，我实现了一个项目到项目的图像推荐系统，该系统使用 PyTorch 预先训练的 Resnet18 卷积神经网络，通过特征向量、管理图像和 top-k 列表的数据库以及用户界面来生成可比性。</p><p id="77bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文介绍了开发的解决方案和在 Heroku 上部署的步骤，代码可从 GitHub 获得。</p><p id="eb04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我已经<strong class="ky ir"> <em class="ls">为该项目设定并满足</em> </strong>以下<strong class="ky ir"> <em class="ls">要求</em> </strong></p><p id="85fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 1。该网络应用程序可在互联网上访问。</strong></p><p id="fccb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2。该应用程序有一个带有分页的图库，只加载页面的相关数据。</strong></p><p id="70dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 3。图库和推荐的数据是从数据库中提取的。</strong></p><p id="d923" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 4。这些推荐是来自可能很大的图像集中的最相似的图像。他们必须立即出现；这意味着相似性计算离线进行。</strong></p><p id="038d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 5。画廊有回应。</strong></p><p id="fe6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">6。Flask 应用程序被适当地打包，以便将来扩展/重用。</p><p id="cafb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的上一篇文章中，部分需求已经实现为原型，尤其是第 2 和第 4 部分。<a class="ae kv" href="https://github.com/MathMagicx/JupyterNotebooks/tree/master/ImageRecommenderResnet18" rel="noopener ugc nofollow" target="_blank">GitHub</a>为 Resnet18 PyTorch 推荐器提供了一个 Jupyter 笔记本，它将图像作为输入，并从同一图像集中给出最相似的图像。要使用 Flask 应用程序，该笔记本应该用于生成存储为 pickle 文件的 Pandas 数据帧。这些在应用程序中用作静态内容。</p><p id="c70e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我们将展示如何实现所有其他需求，如何在本地使用 SQLite 数据库，如何在 Heroku 上使用 PostgreSQL，如何使用它进行分页，如何清理工作并将其部署到 Heroku，以便通过 PC 或智能手机上的浏览器在互联网上使用。</p><p id="e25c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过以下链接在 Heroku 上使用一些图片访问和测试演示应用程序:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://image-recommender-demo.herokuapp.com/"><div class="gh gi lt"><img src="../Images/d0fc5d09df7ad58dda03fe06816b8ded.png" data-original-src="https://miro.medium.com/v2/resize:fit:226/format:webp/1*nCn31U3ol6VP8mwcpz9FYA.png"/></div></a></figure><p id="343b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章由以下几个部分组成:</p><p id="b755" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 1。应用程序的功能描述</strong></p><p id="7938" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2。重新讨论图像间相似性的计算</strong></p><p id="fa2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 3。描述了应用程序的封装结构</strong></p><p id="43a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 4。SQL 模型呈现</strong></p><p id="0173" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 5。后台应用逻辑介绍</strong></p><p id="fbb0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 6。模板介绍</strong></p><p id="2c00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 7。解释 Heroku 部署的所有步骤</strong></p><p id="66d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 8。得出结论</strong></p><p id="4947" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">注意，对于这篇文章，我使用的是 Windows 10 机器和 Python 3.5.4。我没有提到任何异常处理。</em></p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="c255" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak"> 1。应用程序的特性</strong></h1><p id="40e7" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">为了更好地理解实现的目的，让我简单解释一下应用程序的特性。</p><p id="ecfc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">图片集:</strong></p><p id="1ac4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用户可以在自己编写的图库中浏览一组图像，显示来自初始输入集(从我的私有图像存储库中生成的一个小型测试集)的所有图像，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/a784f1dc94bb61660ba332bdebde914c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xCiFl5-hNnh0hf3WTCyWKA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">分页图片库(来源:M. D. Korzec)</p></figure><p id="78b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图库有一个用样式表创建的自定义设计。它定义了标题、鼠标反应、图像、文本覆盖和页码外观的大小。</p><p id="5d8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">分页</strong>:</p><p id="222a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在图库中的图片下方看到数字。这些允许选择带有图像的页面。为了不一次加载所有数据，我放弃了基于 JavaScript 的方法，这种方法会导致隐藏更多信息，但它仍然会加载所有图像。对于给出的实现，只加载相关的数据。</p><p id="8a29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">图片推荐:</strong></p><p id="9243" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于可能较大的图像集中的每个图像，具有相似性值的相似图像被取出并以第二路线呈现。为此，使用一对多关系来显示与所选输入最相似的图像。该方法允许改变所寻求的推荐的数量。我们使用四个，由于小，人工图像集。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/1e2569a7dc44f51ac44a2be3fe1cd4c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P7YL8bGtIQ3EImDOYcjuHg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">里约热内卢，来自《阿德邮报》,应用程序找到的类似图片(来源:M. D. Korzec)</p></figure><p id="41fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于图像被截断，您可以在一个模式中进一步单击并放大它们，以查看完整的图像，该模式使用一些基本的 JavaScript。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/937e8822ffb5c11a8e7c98e331df9852.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HTZuXz4dF3PBlWyjy4nKCA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">放大图像(来源:M. D. Korzec)</p></figure><p id="db8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">响应度</strong>:</p><p id="9c82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">画廊和建议是有反应的，这意味着你可以在智能手机上使用它，图像选择和建议在这样的设备上是用户友好的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/06c92b41daa6458c0f81b95280e044f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*etJawmGB2Yyb02SDnwmaZg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">智能手机上的画廊(来源:M. D. Korzec)</p></figure><p id="62d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">数据库命令:</strong></p><p id="f9c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我准备了一些测试数据，并使用字典在一个<a class="ae kv" rel="noopener" target="_blank" href="/a-flask-app-for-image-recommendations-a865e1496a0d?source=your_stories_page---------------------------">早期原型</a>中使用。这将在导入命令中重复使用。用户可以使用控制台创建或清除数据库，并导入这种字典中描述的数据。这不仅适用于 SQLite，也适用于 Heroku 的 PostgreSQL 数据库。这些命令包含在蓝图模块中。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="6dbc" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak"> 2。离线计算建议</strong></h1><p id="ca3c" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在之前的一篇文章中，我详细解释了如何容易地生成相似性矩阵和前 k 个列表(对于每张图片，k 个最相似的其他图片)。在另一篇文章中<a class="ae kv" rel="noopener" target="_blank" href="/recommending-similar-images-using-pytorch-da019282770c?source=post_stats_page---------------------------">介绍了一个实现。因此，检查这些职位的细节。</a></p><p id="a227" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简而言之，我们要做的是:</p><ul class=""><li id="c268" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">预处理图像输入文件夹中的图像</li><li id="24d6" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">用 PyTorch 的 Resnet18 为每个图像创建特征向量</li><li id="22d2" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">比较特征向量并存储 top-k 列表</li></ul><p id="34ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是在一个<a class="ae kv" href="https://github.com/MathMagicx/JupyterNotebooks/blob/master/ImageRecommenderResnet18/Recommending%20Similar%20Images.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>中完成的，我现在在其中添加了两行来存储与 pickle 文件具有相似图像名称和相似值的数据帧。这些被用作推荐应用程序的静态内容。您可以使用测试图像来检查存储库，它应该可以轻松运行。</p><p id="87e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要添加的是将这些结果——实际的建议——导入到 SQL 数据库中。</p><p id="f321" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于在线处理，后端进程只查询最相似的图像来呈现正确的 html。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="fe08" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak"> 3。打包应用程序</strong></h1><p id="841f" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">使用了以下应用程序结构:</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="028c" class="nv mc iq nr b gy nw nx l ny nz">~/imageRecommender             <br/>     |-- requirements.txt         # All packages to run the app<br/>     |-- Procfile                 # file needed to use gunicorn<br/>     |-- run.py                   # starts the application   <br/>     |-- .flaskenv                # sets environment variables   <br/>     |__ env                      # virtual environment – not in vc<br/>     |__ /imageRecommender        # The application package<br/>          |-- __init__.py         # Application factory method<br/>          |-- config.py           # Configuration file for dev/prod     <br/>          |-- models.py           # Database models <br/>          |__ /commands           # For import to database<br/>              |-- __init__.py     # Application factory<br/>              |-- commands.py     # Commands for DB creation/import<br/>          |__ /main               # For routes<br/>              |-- __init__.py     # Application factory<br/>              |-- routes.py       # Business logic, fctns for routes   <br/>          |__ /static             # All static data<br/>              |__ /css            # Stlyesheets<br/>              |__ /javascript     # Java Script code for modal<br/>              |__ /pickles        # The top-k lists in pickle format<br/>              |__ /site_imgs      # The images for the app<br/>              |-- favicon.ico     # The favicon<br/>          |__ /templates          # All templates<br/>              |-- home.html       # Home route<br/>              |-- layout.html     # General layout<br/>              |-- recommend.html  # Recommend route</span></pre><p id="3fbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> __init__。py </strong>文件使它们包含在模块中的文件夹。这些模块可以注册为蓝图。只有<strong class="ky ir"> __init__。在此应用程序中，imageRecommender 级别上的 py </strong>文件为非空。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="24ce" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak"> 4。数据模型</strong></h1><p id="69cb" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">我们将图像信息存储在 SQL 数据库中。因此，我们使用<em class="ls"> Flask-SQLAlchemy </em>，这是一个帮助使用 Flask 和 SQLAlchemy 的库——它也是一个 Flask SQL 工具包，让您可以使用 SQL 和 Flask。</p><p id="bbbf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 3.1。开始使用 SQL for Flask </strong></p><p id="c9c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">支持 SQL 数据库的包是<strong class="ky ir"> flask-sqlalchemy </strong>，版本 2.4.4 在<strong class="ky ir"> requiremets.txt </strong>文件中。这样，我们可以将它导入到 imageRecommender 应用程序工厂<strong class="ky ir"> __init__ 的工厂应用程序中。py </strong>。</p><p id="720a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在本地为 Flask 应用程序配置 SQLite 数据库，并在<strong class="ky ir"> config.py </strong>文件中为 Heroku 配置 Postgres 数据库(所有内容都存储在一个文件中)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="91a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据用例(在 Heroku 上开发或生产)选择正确的配置。为了安全起见，生产中的密钥需要是唯一的，并且需要设置数据库的 URL。</p><p id="7c29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 3.2。数据模型</strong></p><p id="d2d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们为图库的图像创建一个类，并为要推荐的图像创建一个相关的类。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="0d6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对该模型的一些说明:</p><ul class=""><li id="efd1" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">两个表的<em class="ls"> id </em>标识符被自动且唯一地设置为默认值</li><li id="cac5" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated"><em class="ls"> imageName </em>和<em class="ls"> imageDescription </em>是图像元数据的字符串</li><li id="7f7a" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated"><em class="ls"> imageRecs </em>是与推荐的关系，这些是推荐路线所需要的</li><li id="569c" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated"><em class="ls"> Imagerecommendations </em>类包含来自查询图像的相关 ID、推荐图像的名称及其相似性值。它将图像名称的范式反规范化</li></ul><p id="dd2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以创建数据库并导入数据。</p><p id="53c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 3.3 数据库命令</strong></p><p id="7788" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有三个简单的命令:</p><ol class=""><li id="3030" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr oc ni nj nk bi translated">删除数据库</li><li id="aaf2" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr oc ni nj nk bi translated">来创造它</li><li id="3eb7" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr oc ni nj nk bi translated">要导入数据</li></ol><p id="505a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该应用程序如上所述进行了打包，以便<strong class="ky ir"> commands.py </strong>脚本可以访问该应用程序——我们将在稍后讨论蓝图时看到这一点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="7bd7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在运行导入之后，用户已经有了可以测试的数据库，例如通过创建查询。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="d927" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak"> 5。后端应用逻辑</strong></h1><p id="c9ac" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在我的上一篇文章中已经描述了什么是烧瓶以及如何设置它。</p><p id="7aca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该解决方案被打包到 imageRecommender 包中，我们用<strong class="ky ir"> run.py </strong>脚本调用它</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="201d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls"> createApp </em>方法在<strong class="ky ir"> __init__ 中。py </strong>应用程序工厂，在扩展应用程序时使用它变得很有用，例如，通过需要应用程序的几个实例的测试。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><ul class=""><li id="5cea" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">对于加载配置的导入，这些在前面已经描述过了。需要在此<strong class="ky ir"> __init__ 中创建应用程序。py </strong>文件 via app = Flask(__name__)。</li><li id="1652" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">创建对象后，将验证环境变量是否适用于正确的用例，并加载合适的配置。</li><li id="6c4d" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">创建了数据库对象，并为主应用程序和数据库命令注册了两个蓝图。cli_group=None 将命令合并到应用程序级别，这样它们就可以在 Heroku 控制台中被 flask <command name="">调用。</command></li></ul><p id="3e49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">主</em>蓝图在<strong class="ky ir"> routes.py </strong>文件中包含主要的后端应用程序逻辑。让我们一步一步地浏览这个文件:</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="afb1" class="nv mc iq nr b gy nw nx l ny nz">from flask import render_template, request, Blueprint<br/>from imageRecommender.models import Galleryimages</span></pre><ul class=""><li id="4be3" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">我们通过<em class="ls"> render_template </em>包使用用于 html 页面生成的模板。</li><li id="16ed" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">通过请求，我们得到所选图像的名称和我们在图库中的页面。</li><li id="9075" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">当我们使用蓝图来模块化应用程序时，蓝图是导入的。</li><li id="086b" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">对于查询的图像，我们通过 Imagerecommendations 相关类获得相似的图像，因此我们使用我们的<em class="ls"> Galleryimages </em>类。</li></ul><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="cff8" class="nv mc iq nr b gy nw nx l ny nz">main = Blueprint('Fmain', __name__)</span></pre><ul class=""><li id="ce44" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">蓝图<em class="ls">主</em>已注册。</li></ul><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="6ac4" class="nv mc iq nr b gy nw nx l ny nz">@main.route("/")<br/>@main.route("/home")<br/>def home():<br/>    page = request.args.get('page', 1, type=int)<br/>    gImages = Galleryimages.query.paginate(page=page, per_page=8)<br/>    return render_template('home.html', images = gImages)</span></pre><ul class=""><li id="d5c1" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">主路和回家的路通向画廊。</li><li id="c91d" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">通过<em class="ls">home.html</em>模板，我们渲染<em class="ls"> render_template </em>调用中给出的图像。</li><li id="2326" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">它将来自<em class="ls"> gImages </em>的图像作为输入。这里使用了分页特性。使用<em class="ls"> per_page </em>可以设置图库的一页上显示多少幅图像，page 是打开的默认页面，在这种情况下是图库的第一页，包含前八幅图像。</li></ul><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="c60d" class="nv mc iq nr b gy nw nx l ny nz">@main.route("/recommend")<br/>def recommend():<br/>    selectedImage = request.args.get('selectedImage')<br/>    imageEntry = Galleryimages.query.filter_by(imageName=selectedImage)<br/>    images = []<br/>    values = []<br/>    for image in imageEntry:<br/>         for recommendation in image.imageRecs:<br/>             images.append(recommendation.recommendedName)<br/>             values.append(recommendation.similarityValue)</span><span id="7a6c" class="nv mc iq nr b gy od nx l ny nz">    return render_template('recommend.html', title='Recommendations', customstyle='recommend.css', inputImage=selectedImage, similarImages=images, similarityValues = values)</span><span id="96b4" class="nv mc iq nr b gy od nx l ny nz">if __name__ == '__main__':<br/>    app.run(debug=True)</span></pre><ul class=""><li id="1908" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">使用请求用户所选图像的相应推荐函数来调用推荐路线。</li><li id="cae5" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">它是从我们的数据库中查询的，我们迭代相关类中的所有推荐。</li><li id="b8f2" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">图像和值数组填充有相应的信息。</li><li id="8141" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">传递所有必需的信息来呈现 recommend.html 页面。</li></ul></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="b256" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak"> 6。模板</strong></h1><p id="2534" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">我们看到了两个从模板呈现 html 页面的调用:</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="abe4" class="nv mc iq nr b gy nw nx l ny nz">render_template('home.html', images = gImages)</span><span id="4918" class="nv mc iq nr b gy od nx l ny nz">render_template('recommend.html', title='Recommendations', customstyle='recommend.css', inputImage=selectedImage, similarImages=images, similarityValues = values)</span></pre><p id="d197" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看 home.html 文件<strong class="ky ir">和 recommend.html 文件</strong>的相关部分</p><p id="b553" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应用程序使用布局模板<strong class="ky ir">layout.html</strong>来最大化 html 代码的重用。重要的部分是模板的主体有一个在另外两个 html 文件中指定的块内容。</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="c022" class="nv mc iq nr b gy nw nx l ny nz">&lt;body&gt;<br/>…<br/>{% block content %} {% endblock %}<br/>&lt;/body&gt;</span></pre><p id="cea6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">home.html</strong>文件用于图库</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="395f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它主要由两部分组成:</p><p id="4848" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.通过<em class="ls">{ % for images . items % }</em>迭代的图库中的图像以及</p><p id="c761" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.分页 div 部分中的分页元素。这里最有趣的部分是<em class="ls"> iter_pages </em>方法，它允许设置在数字块的左右边缘和中间显示多少数字</p><p id="844a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">{ % for page _ num in images . ITER _ pages(left _ edge = 2，right_edge=2，left_current=1，right_current=2) %} </em></p><p id="e0d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">recommend.html 模板用于显示查询和最相似的图像:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="e98a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结尾的模态和这个应用程序中唯一的 JavaScript 代码是为弹出窗口准备的，如果需要，可以放大类似的图像。</p><p id="8441" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">响应度:</strong></p><p id="6546" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了在智能手机上正确显示图库，一些设计元素需要不同的大小，图库应该只有一列。这都可以通过样式表添加相应的部分来实现</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="69fd" class="nv mc iq nr b gy nw nx l ny nz"><em class="ls">@media only screen and (max-device-width : 640px) {</em></span></pre><p id="e9f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，对于图库内容，我们在此部分将列计数设置为 1</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="f3be" class="nv mc iq nr b gy nw nx l ny nz">.gallery .galleryContent .item{<br/>    float: left;<br/>    width: 100%;<br/>    height: 100%;<br/>    position: relative;<br/>    cursor: pointer;<br/>    column-count: 1;<br/>}</span></pre></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="200a" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak"> 7。Heroku 部署</strong></h1><p id="e76e" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated"><strong class="ky ir">。flaskenv </strong>文件包含两个条目，它在安装了<em class="ls"> python-dotenv </em>时工作</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="08c7" class="nv mc iq nr b gy nw nx l ny nz">FLASK_APP=run.py<br/>FLASK_ENV=development</span></pre><p id="fc7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，flask run 允许您在本地测试应用程序(在 http://localhost:5000/ 上)</p><p id="495d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在是时候部署这个包并使它可以通过互联网访问了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="http://heroku.com"><div class="gh gi oe"><img src="../Images/5f1d5e6c138de9b31c6f2c97c47deeb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C514ItaHTpeHtD_15tMD8Q.png"/></div></a></figure><p id="0590" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Heroku 是一个允许轻松部署和托管应用程序的平台。它不遗余力，没有通常的系统管理，网络服务器，防火墙设置任务等。都是需要的。免费层允许简单的测试，所展示的演示在这样一个免费的主机上运行。我们希望将该应用程序部署到 Heroku，因为它提供免费的云虚拟主机服务，非常适合像这样的演示。</p><p id="618b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下步骤于 2020 年 8 月在 Heroku.com 进行了测试和工作。</p><p id="98fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于 Heroku 的简单部署，将您的代码推送到 GitHub。创建存储库。使用您收到的 URL 将存储库推送到 GitHub。</p><p id="b666" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，你需要访问<a class="ae kv" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank">https://www.heroku.com/</a>并用主要开发语言 Python 创建一个账户。</p><p id="b2c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">按照 https://devcenter.heroku.com/articles/heroku-cli 上的说明安装 Heroku CLI。</p><p id="2028" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以使用 Heroku CLI 执行以下许多步骤，但是，如果可能的话，我将介绍基于 UI 的配置步骤。</p><p id="7d03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在 Heroku 点击“创建一个新的应用程序”。它要求你给它一个名字，让我们在这里设置<em class="ls">图像推荐演示</em>和欧洲地区。</p><p id="1e19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确认后，您将进入下一个屏幕，在这里您可以选择您的部署方法</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/737795bd3cf7b9d5ef6f3036381851ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bV34CKzVD5OM7Blgx2-sIQ.png"/></div></div></figure><p id="f389" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们将代码推送到 GitHub 时，我们选择 GitHub 选项，之后我们需要“连接到 GitHub”并授权 Heroku 访问您的 GitHub 存储库。</p><p id="656d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们输入相应存储库的名称<em class="ls"> image-recommender-demo </em>，搜索它并连接到它。</p><p id="7818" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以选择自动部署每个变更，例如，到您的主分支，这对于这样的演示用例来说非常方便，</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/3c285ea8ae81ea771ff5ed9e8d1a93e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:458/format:webp/1*_HYNsfTVa1dVafLnZwEjpA.png"/></div></figure><p id="4538" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始时，我们手动部署一次(为此需要按另一个按钮)。现在，您可以看到您的解决方案正在构建中，并且处于成功状态</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/476024e57954aa1190159113574fc8ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L8tVpJZyYd19Yw78rKjdUg.png"/></div></div></figure><p id="4f64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在网站的顶部，你可以找到一个按钮</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/247d69ec6c3a4f09c4044ef3ec34ecf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:208/format:webp/1*8a-eRNKpqIkhEvILGepuYA.png"/></div></figure><p id="6f28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这使我们在这种情况下，我们的推荐系统</p><p id="5af4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">https://image-recommender-demo.herokuapp.com/<a class="ae kv" href="https://image-recommender-demo.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"/></p><p id="29e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，日志将显示没有 web 进程正在运行，因此需要创建一个<strong class="ky ir"> Procfile </strong>，Heroku 使用它来了解如何运行应用程序。它只包含一行</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="7fa3" class="nv mc iq nr b gy nw nx l ny nz">web: gunicorn run:app</span></pre><p id="83c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls"> web </em>指定使用 web worker。需要一个应用服务器，因此使用 gunicorn 并需要安装它——版本 20.0.4 在<strong class="ky ir"> requirements.txt </strong>文件中引用。<em class="ls"> gunicorn </em>是运行 web 进程所需的命令，以便 python 代码可以与 web 服务器通信。<em class="ls"> run </em>是指包含应用对象的<strong class="ky ir"> run.py </strong>文件，<em class="ls"> app </em>是指应用对象的名称。</p><p id="20d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">提交之后，需要设置 FLASK_ENV。如上所述，我使用了<strong class="ky ir">。本地保存文件。在生产中，通过 Heroku CLI 手动设置配置</strong></p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="33e4" class="nv mc iq nr b gy nw nx l ny nz">heroku config:set FLASK_ENV=production --app image-recommender-demo</span></pre><p id="1863" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您尚未登录，Heroku 将首先请求登录。</p><p id="fc1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在运行应用程序仍然会给你留下一个内部服务器错误，因为数据库还没有设置好。</p><p id="f92c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们希望使用 PostgreSQL。在 Heroku UI 中点击“概览”，选择“配置附加组件”，搜索“Postgres”；选择“Heroku Postgres”。这个演示我用的是免费版。</p><p id="fd02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在这个数据库已经连接到应用程序<em class="ls">图像推荐演示</em>！你现在可以在“设置”、“配置变量”下看到它的网址。</p><p id="737d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果<em class="ls"> psycopg2 </em>尚未安装，Heroku 将再次告诉我们一个错误，日志显示“psycopg2”模块未找到。因此，<strong class="ky ir"> requirements.txt </strong>文件中的 psycopg2==2.8.5 得到正确的包。</p><p id="cfb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些表仍然不存在，所以在 Heroku 上进行调整后，我们仍然会看到一个错误。</p><p id="965c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了创建缺失的表格并导入一些数据，我们使用前面解释过的<strong class="ky ir"> command.py </strong>文件中的命令。</p><p id="caa1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将设置<em class="ls"> FLASK_APP </em>变量，以便在 Heroku con 中识别命令</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="8222" class="nv mc iq nr b gy nw nx l ny nz">heroku config:set FLASK_APP=run.py --app image-recommender-demo</span></pre><p id="0965" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以在 Heroku 中调用控制台，并使用前面给出的命令</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="6ba4" class="nv mc iq nr b gy nw nx l ny nz">flask createDB<br/>flask importDB</span></pre><p id="2497" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就这样，应用程序部署完毕，上线，数据库包含相关数据！</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="e5c9" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak"> 8。结论</strong></h1><p id="7b00" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">有了这个和<a class="ae kv" rel="noopener" target="_blank" href="/recommending-similar-images-using-pytorch-da019282770c?source=post_stats_page---------------------------"> PyTorch 推荐人的帖子</a>，你手头就有了一切</p><ul class=""><li id="87a8" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">离线运行机器学习代码并存储结果</li><li id="c062" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">创建一个基于 Flask 的 web 应用程序</li><li id="7fa9" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">在 web 应用程序中使用机器学习结果</li><li id="08e9" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">使用带有 Flask 的 PostgreSQL 数据库</li><li id="6ca2" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">将您的应用程序部署到 Heroku</li></ul><p id="7729" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你不一定要在这个特定的演示应用程序中使用这些编程见解，一旦你理解了所有的步骤，你可以用其他的想法变得有创造性。</p><p id="f94b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我在<a class="ae kv" rel="noopener" target="_blank" href="/a-flask-app-for-image-recommendations-a865e1496a0d">的上一篇文章</a>中所描述的，还有更多方面需要考虑，以实现生产目标。</p><p id="6bc1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以投入更多的工作，使推荐本身成为一个 API 服务，具有合适的端点来添加、删除和更新条目。</p><p id="0405" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种服务可以是生产系统的一部分，比如大型的网上商店。注意，在这种情况下，图像应该从静态文件夹移动到例如某个对象存储器。</p><h1 id="373a" class="mb mc iq bd md me oj mg mh mi ok mk ml jw ol jx mn jz om ka mp kc on kd mr ms bi translated">感谢阅读！喜欢这个话题吗？</h1><p id="8aff" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">如果你觉得这本书很有趣，你可能想补上我以前的文章，这篇文章的主题是:</p><div class="oo op gp gr oq or"><a rel="noopener follow" target="_blank" href="/effortlessly-recommending-similar-images-b65aff6aabfb"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">轻松推荐相似图片</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">使用来自训练的卷积神经网络的特征来产生可比性</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">towardsdatascience.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf kp or"/></div></div></a></div><div class="oo op gp gr oq or"><a rel="noopener follow" target="_blank" href="/recommending-similar-images-using-pytorch-da019282770c"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">使用 PyTorch 推荐相似图片</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">使用 Resnet18 实现完全迁移学习</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">towardsdatascience.com</p></div></div><div class="pa l"><div class="pg l pc pd pe pa pf kp or"/></div></div></a></div><div class="oo op gp gr oq or"><a rel="noopener follow" target="_blank" href="/a-flask-app-for-image-recommendations-a865e1496a0d"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">一个推荐图片的 Flask 应用程序</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">PyTorch 中基于卷积神经网络的相似图像推荐网站原型</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">towardsdatascience.com</p></div></div><div class="pa l"><div class="ph l pc pd pe pa pf kp or"/></div></div></a></div></div></div>    
</body>
</html>