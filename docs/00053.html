<html>
<head>
<title>What exactly is Metaflow?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">元流到底是什么？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-exactly-is-metaflow-c007e5b75b5?source=collection_archive---------24-----------------------#2020-01-02">https://towardsdatascience.com/what-exactly-is-metaflow-c007e5b75b5?source=collection_archive---------24-----------------------#2020-01-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="378d" class="pw-subtitle-paragraph jr is it bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">网飞用于数据科学的Python框架的高级视图</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/ad19d4057b6dac3dab06e41fa56c822f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ntfhE_jcmmkOWjndNuYGw.png"/></div></div></figure><h2 id="211a" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="ak"><em class="jq">TL；</em> 【T4博士】</strong></h2><p id="00fe" class="pw-post-body-paragraph lr ls it lt b lu lv jv lw lx ly jy lz le ma mb mc li md me mf lm mg mh mi mj im bi translated"><em class="mk"> Metaflow </em>是网飞开发的用于数据科学的Python框架；于2019年12月作为开源项目发布<a class="ae ml" href="https://medium.com/netflix-techblog/open-sourcing-metaflow-a-human-centric-framework-for-data-science-fa72e04a5d9?" rel="noopener">。它解决了数据科学家在可伸缩性和版本控制方面面临的一些挑战。处理流水线被构建为图中的一系列步骤。Metaflow使得从在本地机器上运行管道转移到在云资源上运行(目前仅AWS)变得容易。每一步都可以在一个单独的节点上运行，具有唯一的依赖关系，元流将处理相互通信。下面，我将我认为的关键特征进行了分解。</a></p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="5b60" class="pw-post-body-paragraph lr ls it lt b lu mt jv lw lx mu jy lz le mv mb mc li mw me mf lm mx mh mi mj im bi translated">我总是在寻找让生活变得更简单的方法，尤其是在从事数据驱动的项目时。<em class="mk"> Metaflow </em>声称“它可以快速、轻松地构建和管理现实生活中的数据科学项目”，所以我洗耳恭听。我的第一个问题是:“<em class="mk">它实际上是做什么的？我不得不做一些调查来找出答案。在阅读了文档和教程之后，我在这里总结了我的发现。</em></p><blockquote class="my mz na"><p id="46cf" class="lr ls mk lt b lu mt jv lw lx mu jy lz nb mv mb mc nc mw me mf nd mx mh mi mj im bi translated">Metaflow使得从运行在本地机器上转移到运行在云资源上变得很容易。</p></blockquote><p id="795f" class="pw-post-body-paragraph lr ls it lt b lu mt jv lw lx mu jy lz le mv mb mc li mw me mf lm mx mh mi mj im bi translated">主要的好处(在我看来)是<em class="mk">元流</em>在计算资源之上提供了一个抽象层。这意味着您可以专注于代码，而<em class="mk"> Metaflow </em>将负责如何在一台或多台机器上运行它。用文档的话来说，它提供了“基础设施栈的统一API”。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="8e96" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">有向无环图</h2><p id="de5c" class="pw-post-body-paragraph lr ls it lt b lu lv jv lw lx ly jy lz le ma mb mc li md me mf lm mg mh mi mj im bi translated"><em class="mk">元流</em>使用一个<a class="ae ml" href="https://en.wikipedia.org/wiki/Directed_acyclic_graph" rel="noopener ugc nofollow" target="_blank">有向无环图</a>(DAG)——包含要运行的操作的流——来提供这种抽象。管道中的每一个操作都是一个<code class="fe ne nf ng nh b">step</code>，并且被定义为一个Python类中的一个方法，带有一个装饰器:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ni"><img src="../Images/a8f4a0bf65eaf96ae0e0413b7751b92b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eyzGyanqAWnGsEQvR9fAhg.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">元流图是使用一个子类化FlowSpec(网飞技术博客)的类定义的</p></figure><p id="0cfa" class="pw-post-body-paragraph lr ls it lt b lu mt jv lw lx mu jy lz le mv mb mc li mw me mf lm mx mh mi mj im bi translated">在并行定义步骤的情况下(例如上图中的两个模型拟合步骤)，如果资源可用，<em class="mk"> Metaflow </em>可以并行运行它们。当在单个机器上运行时，这是并行处理的一个途径，类似于Python中的<code class="fe ne nf ng nh b">multiprocessing</code>包。然而，当您想要在云资源上运行时，主要优势就来了。一旦<a class="ae ml" href="https://docs.metaflow.org/metaflow-on-aws/deploy-to-aws" rel="noopener ugc nofollow" target="_blank">配置了集群</a>，一个附加的命令行参数将告诉<em class="mk">Metaflow</em>在云中运行代码:<code class="fe ne nf ng nh b">--with batch</code>。虽然目前只支持Amazon Web Services，但我想这在将来会有所改变。</p><p id="3a79" class="pw-post-body-paragraph lr ls it lt b lu mt jv lw lx mu jy lz le mv mb mc li mw me mf lm mx mh mi mj im bi translated">在每一步的末尾都有一个检查点，并且可以在稍后的阶段恢复每一步的执行，以帮助<a class="ae ml" href="https://docs.metaflow.org/metaflow/debugging" rel="noopener ugc nofollow" target="_blank">调试</a>。但是你不能一行一行的检查你的代码。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="b4af" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">版本控制</h2><p id="fe5e" class="pw-post-body-paragraph lr ls it lt b lu lv jv lw lx ly jy lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">机器学习模型的版本控制有点挑战，所以<em class="mk"> Metaflow </em>也解决了这个问题。代码和数据都被散列。图形的每次执行都会被记录下来，结果会与关键超参数一起存储:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="5152" class="pw-post-body-paragraph lr ls it lt b lu mt jv lw lx mu jy lz le mv mb mc li mw me mf lm mx mh mi mj im bi translated">这些可以作为命令行参数轻松操作:</p><pre class="kk kl km kn gt np nh nq nr aw ns bi"><span id="7002" class="kv kw it nh b gy nt nu l nv nw">python metaflow_parameter.py run --alpha 0.001</span></pre><p id="d8a1" class="pw-post-body-paragraph lr ls it lt b lu mt jv lw lx mu jy lz le mv mb mc li mw me mf lm mx mh mi mj im bi translated">元数据以JSON格式存储在文件系统中，您可以访问每个步骤中存储的变量数据。回读上一次运行也很容易:</p><pre class="kk kl km kn gt np nh nq nr aw ns bi"><span id="91e4" class="kv kw it nh b gy nt nu l nv nw">run = Flow(flow_name).latest_successful_run</span></pre></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="f0d6" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">依赖性管理</h2><p id="b2cf" class="pw-post-body-paragraph lr ls it lt b lu lv jv lw lx ly jy lz le ma mb mc li md me mf lm mg mh mi mj im bi translated"><em class="mk">元流</em>也提供了一种管理依赖关系的机制，可以使用装饰器在<code class="fe ne nf ng nh b">flow</code>级别或<code class="fe ne nf ng nh b">step</code>级别<a class="ae ml" href="https://docs.metaflow.org/metaflow/dependencies#managing-dependencies-with-conda-decorator" rel="noopener ugc nofollow" target="_blank">指定它们。这些可以指定特定的Python版本或特定的包:</a></p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="d7b1" class="pw-post-body-paragraph lr ls it lt b lu mt jv lw lx mu jy lz le mv mb mc li mw me mf lm mx mh mi mj im bi translated">从命令行运行时指定了<code class="fe ne nf ng nh b">conda</code>环境标志:</p><pre class="kk kl km kn gt np nh nq nr aw ns bi"><span id="46f3" class="kv kw it nh b gy nt nu l nv nw">python metaflow_conda.py --environment=conda run</span></pre></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="426a" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">后续步骤</h2><p id="901f" class="pw-post-body-paragraph lr ls it lt b lu lv jv lw lx ly jy lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">如果您想试用<code class="fe ne nf ng nh b">metaflow</code>，从命令行安装很简单，文档中有一组很好的教程:</p><pre class="kk kl km kn gt np nh nq nr aw ns bi"><span id="f32e" class="kv kw it nh b gy nt nu l nv nw">pip install metaflow</span></pre><div class="nx ny gp gr nz oa"><a href="https://docs.metaflow.org/getting-started/tutorials" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">教程</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">元流—入门:docs.metaflow.org</h3></div></div><div class="oi l"><div class="oj l ok ol om oi on kt oa"/></div></div></a></div></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="e967" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结论</h2><p id="e75a" class="pw-post-body-paragraph lr ls it lt b lu lv jv lw lx ly jy lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">Metaflow的目标是“无缝的可伸缩性”，看起来它做得很好。有一点手动设置让它与AWS一起工作，但它的<a class="ae ml" href="https://docs.metaflow.org/metaflow-on-aws/deploy-to-aws" rel="noopener ugc nofollow" target="_blank">相当好地记录了</a>。如果你可能需要将你的分析项目扩展到云，并且关心部署，你可能应该看看<em class="mk"> Metaflow </em>。我还没有想出如何从版本控制和细粒度依赖管理中获得最大价值，但它们看起来像是强大的功能。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="309d" class="pw-post-body-paragraph lr ls it lt b lu mt jv lw lx mu jy lz le mv mb mc li mw me mf lm mx mh mi mj im bi translated">你试过Metaflow吗？欢迎在下面的评论区留下任何体验和反馈。</p><blockquote class="my mz na"><p id="2d50" class="lr ls mk lt b lu mt jv lw lx mu jy lz nb mv mb mc nc mw me mf nd mx mh mi mj im bi translated"><a class="ae ml" href="https://twitter.com/rupertthomas" rel="noopener ugc nofollow" target="_blank"><em class="it">Rupert Thomas</em></a><em class="it">是一名技术顾问，专门研究机器学习、机器视觉和数据驱动产品。</em> <a class="ae ml" href="https://medium.com/u/6ea46cd46fb3?source=post_page-----a530eb55ced9----------------------" rel="noopener"> <em class="it">鲁伯特·托马斯</em> </a></p></blockquote></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="d1a6" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">参考</h2><p id="712c" class="pw-post-body-paragraph lr ls it lt b lu lv jv lw lx ly jy lz le ma mb mc li md me mf lm mg mh mi mj im bi translated"><a class="ae ml" href="https://docs.metaflow.org/getting-started/tutorials" rel="noopener ugc nofollow" target="_blank">https://docs.metaflow.org/getting-started/tutorials</a></p><p id="b0e6" class="pw-post-body-paragraph lr ls it lt b lu mt jv lw lx mu jy lz le mv mb mc li mw me mf lm mx mh mi mj im bi translated"><a class="ae ml" href="https://medium.com/netflix-techblog/open-sourcing-metaflow-a-human-centric-framework-for-data-science-fa72e04a5d9" rel="noopener">开源元流，一个以人为中心的数据科学框架</a></p><p id="4b60" class="pw-post-body-paragraph lr ls it lt b lu mt jv lw lx mu jy lz le mv mb mc li mw me mf lm mx mh mi mj im bi translated"><a class="ae ml" rel="noopener" target="_blank" href="/learn-metaflow-in-10-mins-netflixs-python-r-framework-for-data-scientists-2ef124c716e4">10分钟学会元流</a></p></div></div>    
</body>
</html>