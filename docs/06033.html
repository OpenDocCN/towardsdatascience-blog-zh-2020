<html>
<head>
<title>What is Gumbel-Softmax?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是 Gumbel-Softmax？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-is-gumbel-softmax-7f6d9cdcb90e?source=collection_archive---------3-----------------------#2020-05-17">https://towardsdatascience.com/what-is-gumbel-softmax-7f6d9cdcb90e?source=collection_archive---------3-----------------------#2020-05-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4abd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">离散数据采样的可微近似法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1aa4d0ea4c820592753de4933ef7b4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WbtNaE8_y5tqiMY1"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">paweczerwi ski 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b178" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在深度学习中，我们经常想要对离散数据进行采样。举个例子，</p><ul class=""><li id="62e7" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">基于生成对抗网络的文本生成</li><li id="828e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">离散隐变量变分自动编码器</li><li id="b885" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">具有离散动作空间的深度强化学习</li></ul><p id="1df0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，来自分类分布的离散数据的采样过程是不可微的，这意味着反向传播将不起作用。Gumbel-Softmax 分布是一种连续分布，它近似于分类分布中的样本，也适用于反向传播。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="aeb6" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">Gumbel-Softmax 分布</h2><p id="0403" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">设<em class="no"> Z </em>是分类分布<em class="no">分类</em> (𝜋₁，…，𝜋ₓ)的分类变量，其中𝜋ᵢ是我们的神经网络要学习的分类概率。假设我们的离散数据被编码为一个热点向量。最常见的采样方式 Z<em class="no">由下式给出</em></p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="0a4c" class="mq mr it nq b gy nu nv l nw nx"><em class="no">Z</em> = onehot(max{<em class="no">i</em> | 𝜋₁ + ... + 𝜋ᵢ₋₁ ≤ <em class="no">U</em>})</span></pre><p id="60c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<em class="no"> i </em> = 1，…，<em class="no"> x </em>为类索引，<em class="no"> U </em> ~ <em class="no"> Uniform </em> (0，1)。由于 max 函数的存在，这个采样公式是不可微的。为了获得可微分的近似值，我们应用以下公式:</p><ol class=""><li id="730b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ny mb mc md bi translated"><strong class="lb iu">甘贝尔-马克斯诡计</strong></li></ol><p id="4458" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Gumbel-Max 技巧提供了一个不同的采样公式<em class="no"> Z </em></p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="235c" class="mq mr it nq b gy nu nv l nw nx"><em class="no">Z</em> = onehot(argmaxᵢ{<em class="no">G</em>ᵢ + log(𝜋ᵢ)})</span></pre><p id="0dd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<em class="no"> G </em> ᵢ ~ <em class="no">冈贝尔</em> (0，1)是从标准冈贝尔分布中抽取的同分布样本。这是一个“重新参数化的把戏”，将<em class="no"> Z </em>的采样重构为参数的确定性函数和一些固定分布的独立噪声。</p><p id="0940" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">采样过程的重构并没有使它变得可区分。在我们的例子中，不可微性来自 argmax 函数。然而，一旦我们有了 argmax 的可微近似值，我们就可以很容易地进行反向传播，因为它只是关于计算确定性函数的梯度 w.r.t .参数。另一方面，如果没有重新参数化的技巧，我们将不得不计算分布的梯度 w.r.t .参数，这是一个更困难的问题。</p><p id="0fbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.<strong class="lb iu">使用 softmax 作为可微分近似值</strong></p><p id="bd7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用 softmax 作为 argmax 的可微分近似值。样本向量<em class="no"> y </em>现在由下式给出</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="14a8" class="mq mr it nq b gy nu nv l nw nx"><em class="no">y</em>ᵢ = exp((<em class="no">G</em>ᵢ + log(𝜋ᵢ)) / 𝜏) / 𝚺ⱼ exp((<em class="no">G</em>ⱼ + log(𝜋ⱼ)) / 𝜏)</span></pre><p id="395f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于每一个<em class="no"> i </em> = 1，…，<em class="no"> x </em>。<em class="no">当𝜏 → 0 时，softmax 计算平滑地接近 argmax，并且样本向量接近 one-hot；随着𝜏 → ∞，样本向量变得一致。</em></p><p id="77aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">具有上述抽样公式的分布称为 Gumbel-Softmax 分布。注意，在训练期间使用连续向量，但是在评估期间样本向量被离散化为单热点向量。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="fc3a" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">使用</h2><p id="4009" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">每当我们有一个离散变量的随机神经网络，我们可以使用 Gumbel-Softmax 分布来近似离散数据的采样过程。然后可以使用反向传播来训练网络，其中网络的性能将取决于温度参数𝜏.的选择</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="bbe9" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">直通 Gumbel-Softmax</h2><p id="2856" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">有些情况下，我们会希望在训练期间对离散数据进行采样:</p><ul class=""><li id="4cf8" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">我们受限于离散值，因为实值连续逼近是不允许的。比如在动作空间离散的深度强化学习中。</li><li id="692b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在训练期间使用连续近似和在评估期间使用一次性向量具有非常不同的动态。这导致评估期间模型性能的大幅下降。</li></ul><p id="c979" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在正向传递中使用 argmax 将 Gumbel-Softmax 样本离散化，使其与原始分类分布中的样本相同。这确保了培训和评估动态是相同的。然而，我们仍然在反向传递中使用 Gumbel-Softmax 样本来近似梯度，因此反向传播仍然有效。这种技术在文献中被称为直通 Gumbel-Softmax。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="0c1b" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">履行</h2><ul class=""><li id="3329" class="lv lw it lb b lc nj lf nk li nz lm oa lq ob lu ma mb mc md bi translated">tensor flow:<a class="ae ky" href="https://www.tensorflow.org/probability/api_docs/python/tfp/distributions/RelaxedOneHotCategorical" rel="noopener ugc nofollow" target="_blank">TFP . distributions . relaxedonehotcategorial</a></li><li id="ac56" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">py torch:<a class="ae ky" href="https://pytorch.org/docs/stable/nn.functional.html#gumbel-softmax" rel="noopener ugc nofollow" target="_blank">torch . nn . functional . gum bel _ soft max</a></li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="734b" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">常见问题</h2><p id="4372" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">问:我们如何选择温度参数𝜏？</p><p id="529c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答:我们可以给𝜏.一个固定的值最佳值是通过反复试验确定的，通常小于等于 1。我们也可以使用退火时间表，或者让它成为一个学习参数。</p><p id="a747" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问:为什么我们不需要使用 Gumbel-Softmax 进行分类任务，这涉及到离散的类别标签？</p><p id="1458" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答:这是因为在解决分类问题时通常不涉及抽样过程。相反，我们只需要我们的模型输出属于不同类别的特征向量的概率。简单地应用 softmax 函数就足够了。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="29ef" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">进一步阅读</h2><ol class=""><li id="a37e" class="lv lw it lb b lc nj lf nk li nz lm oa lq ob lu ny mb mc md bi translated">Gumbel-Softmax 分布是由[2]和[3]独立发现的，在[3]中称为具体分布。两篇论文都是很好的参考，特别是关于分布的理论方面，以及关于重新参数化的技巧。</li><li id="2a9c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ny mb mc md bi translated">[5]是[2]第一作者写的博文。这是一个很好的教程，有一个关于 Gumbel-Softmax 发行版采样的交互式小部件。</li><li id="ac79" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ny mb mc md bi translated">对于 Gumbel-Softmax 分布在 GAN 中的应用，我们参考[4],其中给出了 Gumbel-Softmax 如何解决用离散数据训练 GAN 的问题的大图。</li><li id="9216" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ny mb mc md bi translated">[1]提供了一个需要直通 Gumbel-Softmax 而不是普通 Gumbel-Softmax 的用例。</li></ol></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="2a65" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">参考</h2><ol class=""><li id="06e1" class="lv lw it lb b lc nj lf nk li nz lm oa lq ob lu ny mb mc md bi translated">南哈夫里洛夫和我蒂托夫。<a class="ae ky" href="https://papers.nips.cc/paper/6810-emergence-of-language-with-multi-agent-games-learning-to-communicate-with-sequences-of-symbols.pdf" rel="noopener ugc nofollow" target="_blank">用多智能体游戏出现语言:学习用符号序列交流</a> (2017)，NIPS 2017。</li><li id="7d25" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ny mb mc md bi translated">E.张，s .顾和 b .普尔。<a class="ae ky" href="https://openreview.net/pdf?id=rkE3y85ee" rel="noopener ugc nofollow" target="_blank">使用 Gumbel-Softmax </a> (2017)，ICLR 2017 进行分类重新参数化。</li><li id="1279" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ny mb mc md bi translated">C.马迪森，Mnih 和叶维庆。<a class="ae ky" href="http://www.stats.ox.ac.uk/~cmaddis/pubs/concrete.pdf" rel="noopener ugc nofollow" target="_blank">《具体分布:离散随机变量的一个连续松弛》</a> (2017)，ICLR 2017。</li><li id="0e6c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ny mb mc md bi translated">W.聂、纳洛德茨卡和帕特尔。<a class="ae ky" href="https://openreview.net/pdf?id=rJedV3R5tm" rel="noopener ugc nofollow" target="_blank"> RelGAN:用于文本生成的关系生成对抗网络</a> (2019)。ICLR 2019。</li><li id="7315" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ny mb mc md bi translated">教程:使用 Gumbel-Softmax 的分类变分自动编码器，<a class="ae ky" href="https://blog.evjang.com/2016/11/tutorial-categorical-variational.html" rel="noopener ugc nofollow" target="_blank">https://blog . ev jang . com/2016/11/tutorial-categorial-variable . html</a></li></ol></div></div>    
</body>
</html>