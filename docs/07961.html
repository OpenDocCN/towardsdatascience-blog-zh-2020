<html>
<head>
<title>Making open data more accessible with datasette</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用datasette使开放数据更易访问</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/making-open-data-more-accessible-with-datasette-480a1de5e919?source=collection_archive---------55-----------------------#2020-06-12">https://towardsdatascience.com/making-open-data-more-accessible-with-datasette-480a1de5e919?source=collection_archive---------55-----------------------#2020-06-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/6b6688be3b02dbb5e4ddbda5f66fbb7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H5ZPXSx3r0bTQzsB"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@nasa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NASA </a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><div class=""/><p id="e1c7" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">加利福尼亚州最近发布了与该州八大机构官员在2018年7月至12月期间进行的拦截有关的数据。这是将在未来几年生效的第一波数据发布。数据覆盖了全州180多万个站点。虽然这是朝着正确方向迈出的一步，但一个大约640兆字节、180多万行和140多列的文件可能会让一些从探索这些数据中受益的人感到害怕:地方领导人、记者、活动家和组织者，等等。</p><p id="307b" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae jg" href="https://opendatacharter.net/principles/" rel="noopener ugc nofollow" target="_blank">开放数据宪章</a>的第三个原则是数据应该<em class="li">可访问和可用。</em>提供数据是第一步，但为了让大多数人能够使用和访问数据，我们不能简单地发布数据；我们必须考虑到用户体验，并开发出便于探索和使用这些数据的方法。</p><p id="7ee3" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本教程中，我分享一种方法:使用<strong class="ki jk">dataset</strong>，一种用于探索和发布数据的python <em class="li">工具。它帮助人们获取任何形状或大小的数据，并将其发布为一个交互式、可探索的网站和附带的API。”</em></p><p id="ebfb" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们采用加州最近发布的警察停车数据，清理和转换数据，并向Heroku部署一个datasette实例。</p><h2 id="3a2d" class="lj lk jj bd ll lm ln dn lo lp lq dp lr kr ls lt lu kv lv lw lx kz ly lz ma mb bi translated"><strong class="ak">目录</strong></h2><p id="dc31" class="pw-post-body-paragraph kg kh jj ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">— <a class="ae jg" href="#fe64" rel="noopener ugc nofollow">序幕</a> <br/> — <a class="ae jg" href="#6e08" rel="noopener ugc nofollow">关于数据</a> <br/> — <a class="ae jg" href="#44d1" rel="noopener ugc nofollow">关于数据集</a> <br/> — <a class="ae jg" href="#f6a2" rel="noopener ugc nofollow">分步</a><br/>—<a class="ae jg" href="#0e36" rel="noopener ugc nofollow">获取数据</a><br/>—<a class="ae jg" href="#ba93" rel="noopener ugc nofollow">准备数据</a><br/>—<a class="ae jg" href="#594a" rel="noopener ugc nofollow">服务数据</a> <br/> — <a class="ae jg" href="#aa2a" rel="noopener ugc nofollow">部署到heroku </a> <br/> — <a class="ae jg" href="#6dd2" rel="noopener ugc nofollow">自动化一切</a></p><h1 id="fe64" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">序言</h1><p id="60bb" class="pw-post-body-paragraph kg kh jj ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">探索这个数据集的想法来自于听2020年3月3日的一集<strong class="ki jk"> Pod拯救人类</strong></p><div class="is it gp gr iu my"><a href="https://overcast.fm/+I9KRmEwJc/04:12" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd jk gy z fp nd fr fs ne fu fw ji bi translated">即使是最好的球员也有教练(乔治·加斯东)</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">本周，DeRay、Clint和Sam讨论了旧金山的量刑加重、弗吉尼亚州的儿童假释和选民…</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">阴. fm</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm ja my"/></div></div></a></div><p id="591e" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">他们在上诉中提到了这篇文章:</p><blockquote class="nn no np"><p id="ecee" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated">布丹今天将宣布第二项指令，也由上诉机构审查，关于所谓的文本前拦截，其中一名官员因轻微违法或违规(如交通违规)而拦截某人，以进行无关的搜查，如枪支或毒品。根据新政策，当违禁品是由于与违规相关的停车而被收集时，“在没有其他明显的犯罪活动嫌疑的情况下”，地方检察官办公室将不会起诉持有违禁品的案件。任何与政策的背离都应以书面形式做出，并需要DA或刑事部门负责人的批准。此外，根据该指令，该禁令包括个人同意搜查的情况，“因为执法部门要求同意搜查的长期和有记录的种族和民族差异”。<br/>--<a class="ae jg" href="https://theappeal.org/san-francisco-da-to-announce-sweeping-changes-on-sentencing-policy-and-police-stops/" rel="noopener ugc nofollow" target="_blank">https://the appeal . org/San-Francisco-da-to-announce-sweeping-changes-on-pending-policy-and-police-stops/</a></p></blockquote><p id="736e" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这一集里，萨姆提到黑人和棕色人种被拦截和搜查的比例更高<em class="li">，而且很多这样的搜查是他们所谓的“同意搜查”，这意味着警察实际上根本没有理由搜查这个人，除了问那个人他们是否可以搜查他们和那个据称同意的人。</em></p><p id="e1bd" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这种严重的种族差异令人心碎，但并不令人惊讶。</p><p id="9594" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我第一次开始探索数据集时，我发现使用它<em class="li">很麻烦</em>。数据集的大小使得那些没有使用付费资源(如stata和sas)或开源资源(如python和r)以编程方式分析数据的人很难做到这一点。这些信息不是为了方便研究而设计的，但有一些工具可以帮助他们。</p><blockquote class="nn no np"><p id="80ef" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated"><em class="jj">💡</em>该法案要求收集数据并向司法部长报告。这个数据集就是为这个目的服务的。</p></blockquote><h1 id="6e08" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">关于数据</h1><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nt"><img src="../Images/486f0d2c8cf40cbc1bcf7bc1ee3cdeaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tDeVEZl_Dbe0DdwkCMPAKQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><strong class="bd ny">来源:</strong><a class="ae jg" href="https://openjustice.doj.ca.gov/data" rel="noopener ugc nofollow" target="_blank">https://openjustice.doj.ca.gov/data</a></p></figure><p id="d0a0" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据集由一个641.4 MB的<code class="fe le lf lg lh b">.csv</code>文件组成，该文件包含180万行和143列。每个停止实例都有一个惟一的<code class="fe le lf lg lh b">DOJ_RECORD_ID</code>，每个被停止的人都有一个<code class="fe le lf lg lh b">PERSON_NUMBER</code>。该数据集中总共有1，708，377个停靠点，涉及1，800，054人。</p><p id="25a6" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该数据集包括关于每个停留的基本信息(如持续时间、一天中的时间、最近的城市、机构名称)、<strong class="ki jk">感知的</strong>人口统计信息(种族/民族、性别、年龄、残疾)，以及关于停留原因、搜查、扣押、停留期间采取的行动、发现的违禁品或证据等的信息。有关数据集的更多详细信息，您可以阅读司法部整理的自述文件和2020年年度报告。</p><p id="f18a" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是未来几年将发布的一系列RIPA数据中的第一波。这一波发布的数据与加州8个最大的执法机构(执法机构)有关(这些执法机构雇佣了1000多名官员)。这些lea(及其在总观测值中所占的份额)是:</p><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="0d26" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae jg" href="https://data-openjustice.doj.ca.gov/sites/default/files/dataset/2020-01/RIPA%20Dataset%20Read%20Me%2020200106.pdf" rel="noopener ugc nofollow" target="_blank">自述</a> | <a class="ae jg" href="https://oag.ca.gov/sites/all/files/agweb/pdfs/ripa/ripa-board-report-2020.pdf" rel="noopener ugc nofollow" target="_blank"> 2020年年报</a></p><h1 id="44d1" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">关于datasette</h1><blockquote class="nn no np"><p id="3b78" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated"><strong class="ki jk">dataset</strong>是一个探索和发布数据的工具。它帮助人们获取任何形状或大小的数据，并将其发布为一个交互式的、可探索的网站和附带的API。<strong class="ki jk">dataset</strong>面向数据记者、博物馆馆长、档案管理员、地方政府和其他任何希望与世界分享数据的人。它是一个更大的工具和插件生态系统的一部分，致力于尽可能提高结构化数据的工作效率。<em class="jj"><br/>-</em><a class="ae jg" href="https://datasette.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"><em class="jj">datasette . readthedocs . io</em></a></p></blockquote><p id="d0c3" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki jk">数据集</strong>是这个项目的引擎。简而言之，它抓取一个sqlite数据库，并创建一个<em class="li">交互式的、可探索的网站和附带的API </em>。为了准备数据，我们使用了<code class="fe le lf lg lh b">csvs-to-sqlite</code>，这是来自<strong class="ki jk">dataset</strong>生态系统的另一个工具，它抓取CSV文件并从它们创建sqlite数据库。</p><p id="456b" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在<a class="ae jg" href="https://github.com/simonw/datasette/wiki/Datasettes" rel="noopener ugc nofollow" target="_blank"> GitHub repo的维基</a>上找到一些公开<strong class="ki jk">数据集</strong>的例子。这里有一个服务于FiveThirtyEight发布的数据集(在他们的<a class="ae jg" href="https://github.com/fivethirtyeight/data" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中找到):<a class="ae jg" href="https://fivethirtyeight.datasettes.com/" rel="noopener ugc nofollow" target="_blank">https://fivethirtyeight.datasettes.com/</a></p><p id="a971" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">主页显示了数据的许可、来源，并提供了对一些表格的快速访问。</p><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/f4bf97b1c8800f129c21146bcd23fdca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y1-FwGc2JhX_1ocHz7TXBA.png"/></div></div></figure><p id="961d" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你点击你的数据库名称，它会提供一个所有表的视图，并为你提供一个文本框来运行定制的SQL查询。这是使<strong class="ki jk">数据集</strong>成为如此强大的工具的特性之一。</p><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/3b9386eb84a7e8fabc05f2d3bd755416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7QZ3wF9k2TbMd79dauftng.png"/></div></div></figure><p id="8efd" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您深入研究其中一个表，您会看到建议的方面、一个易于使用的过滤器按钮、一个JSON和CSV链接，它将提供这些格式中的一种格式的表(这意味着您可以将它用作API)，以及对表的描述。在这种情况下，描述包含一个带有标题和定义的HTML表。</p><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/d6c62c3f10c8553b791652def82ae8e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QWaKpYg7mgvGcbeI0Kcwmw.png"/></div></div></figure><p id="f685" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您单击“查看和编辑SQL”按钮，您将再次访问一个文本框，以便在上面编写您自己的查询。</p><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/e6c532c92680b6b5fa3e7856d9287b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e_nW20lBbSPRAgXLYkgYng.png"/></div></div></figure><p id="abf0" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">datasette是丰富的工具和插件生态系统的一部分。您可以添加<strong class="ki jk"> datasette-vega </strong>插件(<a class="ae jg" href="https://github.com/simonw/datasette-vega" rel="noopener ugc nofollow" target="_blank"> repo </a>)来添加当前表格的交互式可视化(使用<a class="ae jg" href="https://altair-viz.github.io/" rel="noopener ugc nofollow" target="_blank"> altair </a>制作)</p><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/85d177946245bc1c171551cb92f86b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zZ7i8wiP7yBc-cKx7tPW8w.png"/></div></div></figure><p id="2b00" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是一个基本的数据集网站的样子，但是T2的数据集是高度可定制的。以《巴尔的摩太阳报》的<strong class="ki jk">数据集</strong>为例，人们可以探索每年更新的公共工资记录。</p><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/70a320f6f42279b9e475d12e3d4a4851.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z4OxKW3TwU4l3AsN2Xm0lQ.png"/></div></div></figure><p id="daff" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是在后台运行的数据集，但是他们添加了自己的模板/布局，css和javascript文件。关于如何定制<strong class="ki jk">dataset</strong>的更多信息，请点击这里:<a class="ae jg" href="https://datasette.readthedocs.io/en/stable/custom_templates.html" rel="noopener ugc nofollow" target="_blank">https://dataset . readthe docs . io/en/stable/custom _ templates . html</a></p><h1 id="f6a2" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">按部就班的</h1><p id="9e9e" class="pw-post-body-paragraph kg kh jj ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这一部分是对该项目的技术性更强的描述。<strong class="ki jk">数据集</strong>的数据准备和部署非常简单，可以分为三个阶段:</p><p id="f87e" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">—获取数据<br/> —准备数据<br/> —服务数据</p><h1 id="0e36" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">获取数据</h1><p id="faab" class="pw-post-body-paragraph kg kh jj ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这些数据是从加州司法部的公开司法网站上获得的:<a class="ae jg" href="https://openjustice.doj.ca.gov/data" rel="noopener ugc nofollow" target="_blank">https://openjustice.doj.ca.gov/data</a>。网站提供了下载数据的链接(截止到2020年5月5日，我为这个项目下载的)。要了解更多关于数据本身的信息，你可以阅读项目GitHub repo上关于数据 的<a class="ae jg" href="https://github.com/chekos/RIPA-2018-datasette#about-the-data" rel="noopener ugc nofollow" target="_blank"> <em class="li">部分。</em></a></p><h1 id="ba93" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">准备数据</h1><p id="9550" class="pw-post-body-paragraph kg kh jj ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">原始CSV文件的大小超过650 MB，所以第一步是将<em class="li">分割成15个CSV文件，这样每个文件都可以上传到这个存储库中的GitHub。</em></p><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="nz oa l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://github.com/chekos/RIPA-2018-datasette/blob/fea53ce60ae43f0d7b0dd130109a01496f08e20a/src/data/split_data.py#L1-L16" rel="noopener ugc nofollow" target="_blank">https://github . com/chekos/RIPA-2018-dataset/blob/FEA 53 ce 60 AE 43 f 0d 7 b 0dd 130109 a 01496 f 08 e20 a/src/data/split _ data . py # L1-L16</a></p></figure><blockquote class="nn no np"><p id="7598" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated"><em class="jj">💡</em> <strong class="ki jk">为什么是</strong>？以防它神秘地从原始数据源中消失…</p></blockquote><p id="7327" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，因为数据集太大而不能作为一个单独的表(180万行乘143列)，所以它也被<em class="li">分解为</em>更小的表。这意味着我们将相关变量(基于它们的后缀)提取到它们自己的表中。例如，从“主”表中提取与性别相关的变量，如<code class="fe le lf lg lh b">G_FULL</code>、<code class="fe le lf lg lh b">G_MALE</code>、<code class="fe le lf lg lh b">G_FEMALE</code>、<code class="fe le lf lg lh b">G_TRANSGENDER_MAN</code>、<code class="fe le lf lg lh b">G_TRANSGENDER_WOMAN</code>、<code class="fe le lf lg lh b">G_GENDER_NONCOMFORMING</code>和<code class="fe le lf lg lh b">G_MULTIGENDER</code>，并添加到数据库中的<strong class="ki jk">性别</strong>表中。可以使用分配给它们的<strong class="ki jk"> UNIQUE_ID </strong>将它们连接回主表。</p><div class="is it gp gr iu my"><a href="https://github.com/chekos/RIPA-2018-datasette/blob/master/src/data/break_down_database.py" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd jk gy z fp nd fr fs ne fu fw ji bi translated">chekos/RIPA-2018-数据集</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">CA RIPA 2018数据发布数据集。通过创建一个……为chekos/RIPA 2018-dataset的发展做出贡献</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">github.com</p></div></div><div class="nh l"><div class="oc l nj nk nl nh nm ja my"/></div></div></a></div><p id="4aca" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该数据集的每个观察或行被分配一个<code class="fe le lf lg lh b">DOJ_RECORD_ID</code>和一个<code class="fe le lf lg lh b">PERSON_NUMBER</code>。这些分别是停靠点和被停靠的人员所特有的。这意味着我们可以将它们组合起来，为每一行创建一个<code class="fe le lf lg lh b">UNIQUE_ID</code>，我们可以用它将表连接在一起。然而，这最终是一个22个字符的字符串，这是不必要的大。为了方便起见，每一行都分配了一个从1，000，000开始的数字id。从一百万开始是完全随意的，我们可以从零开始，但是因为有180万行，我们决定让每个数字id都是七位数。这个数字<code class="fe le lf lg lh b">UNIQUE_ID</code>让我们将表连接在一起<strong class="ki jk">和</strong>在内存方面对数据库来说并不是一个很大的增加。</p><p id="69f3" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦创建了这个<code class="fe le lf lg lh b">UNIQUE_ID</code>,我们就可以从“主”表中提取列到它们自己的表中，并将它们保存为单独的CSV文件，确保每个观察都可以在这些新表中匹配。</p><p id="ee08" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们使用<code class="fe le lf lg lh b">csvs-to-sqlite</code>创建一个sqlite数据库，其中每个CSV都是一个表。在这一步中，我们还包括从DOJ网站获得的<strong class="ki jk">附录B表3.csv </strong>文件，以及我们可能已经创建的伴随数据集的任何其他补充表。</p><pre class="nu nv nw nx gt od lh oe of aw og bi"><span id="0728" class="lj lk jj lh b gy oh oi l oj ok">csvs-to-sqlite data/processed/*.csv "data/external/Appendix B Table 3.csv" datasette/ripa-2018-db.db</span></pre><h1 id="594a" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">提供数据</h1><p id="6fde" class="pw-post-body-paragraph kg kh jj ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在准备数据和创建sqlite数据库之后，我们使用<strong class="ki jk">dataset</strong>作为一个交互式网站和API。这和跑步一样简单</p><pre class="nu nv nw nx gt od lh oe of aw og bi"><span id="5fba" class="lj lk jj lh b gy oh oi l oj ok">datasette ripa-2018.db</span></pre><p id="1556" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，对于这个项目，我们稍微定制了一下我们的<strong class="ki jk">dataset</strong>实例。</p><p id="57cb" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们包括标题、描述、数据源URL和一些额外的CSS和JS资产。你可以探索<a class="ae jg" href="https://github.com/chekos/RIPA-2018-datasette/blob/master/datasette/metadata.json" rel="noopener ugc nofollow" target="_blank">dataset/metadata . JSON</a>来找到细节。</p><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="nz oa l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://github.com/chekos/RIPA-2018-datasette/blob/fea53ce60ae43f0d7b0dd130109a01496f08e20a/datasette/metadata.json" rel="noopener ugc nofollow" target="_blank">https://github . com/chekos/RIPA-2018-dataset/blob/FEA 53 ce 60 AE 43 f 0d 7 b 0dd 130109 a 01496 f 08 e20 a/dataset/metadata . JSON</a></p></figure><p id="4e07" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还包括<em class="li">预设查询；</em>查询默认包含在我们的实例中，显示在主页中，并带有自己的URL以方便访问。包含这些查询是因为它们是在数据中发现的有用和/或有趣的事实。其中一些是计算2020年年度报告中发布的特定事实的查询。</p><p id="ec30" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还从<strong class="ki jk">数据集</strong>中修改了一些模板，具体是<code class="fe le lf lg lh b">base.html</code>和<code class="fe le lf lg lh b">query.html</code>。第一个被修改为在<code class="fe le lf lg lh b">&lt;head&gt;</code>(网站预览描述等)中包含一些元数据。第二个进行了修改，在SQL文本框下面添加了一个按钮，用于提交用户刚刚在GitHub上作为建议运行的查询，以便于共享。</p><p id="6a98" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还更改了<strong class="ki jk">数据集</strong>的一些默认选项:</p><ol class=""><li id="7137" class="ol om jj ki b kj kk kn ko kr on kv oo kz op ld oq or os ot bi translated"><code class="fe le lf lg lh b">default_page_size:50</code> -每页仅显示50个结果</li><li id="4a5f" class="ol om jj ki b kj ou kn ov kr ow kv ox kz oy ld oq or os ot bi translated"><code class="fe le lf lg lh b">sql_time_limit_ms:30000</code> - 30秒限时计算查询(限时在Heroku上)</li><li id="d76e" class="ol om jj ki b kj ou kn ov kr ow kv ox kz oy ld oq or os ot bi translated"><code class="fe le lf lg lh b">facet_time_limit_ms:10000</code>-dataset应该花费在计算表的一个方面的时间限制(默认为200毫秒，但是因为我们的数据集非常大，所以我们将其扩展到10秒)</li></ol><p id="eb9d" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行的结果代码是:</p><pre class="nu nv nw nx gt od lh oe of aw og bi"><span id="e418" class="lj lk jj lh b gy oh oi l oj ok">datasette ripa-2018-db.db \\<br/>  -m metadata.json \\<br/>  --extra-options="--config default_page_size:50 --config sql_time_limit_ms:30000 --config facet_time_limit_ms:10000"</span></pre><h1 id="aa2a" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">部署到heroku</h1><p id="a24f" class="pw-post-body-paragraph kg kh jj ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">以下是该流程的高级概述</p><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oz"><img src="../Images/a3cbc1c52f8ad51c0527b39252dccfdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DGg6BYW2iexf2SsFrQnpig.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://github.com/chekos/RIPA-2018-datasette" rel="noopener ugc nofollow" target="_blank">https://github.com/chekos/RIPA-2018-datasette</a></p></figure><p id="0a1b" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">到目前为止，我们使用了一些python代码来处理我们的数据(创建一个<code class="fe le lf lg lh b">UNIQUE_ID</code>并将包含143列的原始数据集分解成各种更小的<code class="fe le lf lg lh b">.csv</code>文件)，我们还使用<code class="fe le lf lg lh b">csvs-to-sqlite</code>从这些<code class="fe le lf lg lh b">.csv</code>文件中构建了我们的<code class="fe le lf lg lh b">ripa-2018-db.db</code>数据库。到目前为止，我们一直通过运行运行本地服务器的命令<code class="fe le lf lg lh b">datasette ripa-2018-db.db</code>与我们的<strong class="ki jk">数据集</strong>进行交互。为了让我们的<strong class="ki jk">数据集</strong>对全世界可用，我们必须在线部署它，幸运的是这非常非常容易做到，因为<strong class="ki jk">数据集</strong>已经包含了一个<code class="fe le lf lg lh b">publish</code>命令。</p><p id="a192" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用<strong class="ki jk">dataset，</strong>可以直接发布到<a class="ae jg" href="https://datasette.readthedocs.io/en/stable/publish.html#publishing-to-heroku" rel="noopener ugc nofollow" target="_blank"> Heroku </a>、<a class="ae jg" href="https://datasette.readthedocs.io/en/stable/publish.html#publishing-to-google-cloud-run" rel="noopener ugc nofollow" target="_blank"> Google Cloud Run </a>或<a class="ae jg" href="https://datasette.readthedocs.io/en/stable/publish.html#publishing-to-fly" rel="noopener ugc nofollow" target="_blank"> Fly </a>(从0.42版本开始)。因为我以前有部署heroku的经验，我发现这是三个中最简单的，但是它们都是很好的选择，文档也很容易理解。</p><p id="9bfe" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">部署到Heroku就像运行几乎相同的命令一样简单，该命令用于本地服务我们的数据集。</p><pre class="nu nv nw nx gt od lh oe of aw og bi"><span id="d150" class="lj lk jj lh b gy oh oi l oj ok">datasette publish heroku ripa-2018-db.db \\<br/>  --name ripa-2018-db \\<br/>  -m metadata.json \\<br/>  --extra-options="--config default_page_size:50 --config sql_time_limit_ms:30000 --config facet_time_limit_ms:10000"</span></pre><blockquote class="nn no np"><p id="1b11" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated"><em class="jj">💡</em> <strong class="ki jk">注意</strong><code class="fe le lf lg lh b">--name</code>标志，它指定了我们heroku应用程序的名称。这意味着它会发布到<a class="ae jg" href="http://ripa-2018-db.herokuapp.com" rel="noopener ugc nofollow" target="_blank">ripa-2018-db.herokuapp.com</a>并且会覆盖之前的应用(如果有的话)。</p></blockquote><p id="06ac" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要运行这个，你需要一个<a class="ae jg" href="https://signup.heroku.com/" rel="noopener ugc nofollow" target="_blank"> heroku账号</a>并安装<a class="ae jg" href="https://devcenter.heroku.com/articles/heroku-cli" rel="noopener ugc nofollow" target="_blank"> heroku cli工具</a>。<strong class="ki jk">dataset</strong>(使用heroku cli)将要求您登录并打开一个浏览器窗口。你登录后，它会处理剩下的事情。</p><p id="8651" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">利斯托。至此，我们已经成功地将我们的<strong class="ki jk">数据集</strong>发布到heroku，我们可以访问<a class="ae jg" href="http://ripa-2018-db.herokuapp.com" rel="noopener ugc nofollow" target="_blank">ripa-2018-db.herokuapp.com</a>或<a class="ae jg" href="http://ripa-2018.datasettes.cimarron.io/" rel="noopener ugc nofollow" target="_blank">ripa-2018.datasettes.cimarron.io/</a></p><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pa"><img src="../Images/1fef7048428003d4c77ad652a3bf0b12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fuSRYs18jGBzkvlN60pDLA.gif"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="http://ripa-2018.datasettes.cimarron.io/" rel="noopener ugc nofollow" target="_blank">http://ripa-2018.datasettes.cimarron.io/</a></p></figure><p id="1700" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对许多人来说，这将是这个过程的结束。我们已经成功地获取和转换了一些数据，并将其部署到云中，供其他人探索和交互。我们还包括一个HTML描述，为用户描述我们的<strong class="ki jk">数据集</strong>，甚至还有一些<em class="li">预设查询</em>，供人们重现2020年年度报告中公布的一些事实。</p><h1 id="6dd2" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">自动化一切</h1><p id="bbcd" class="pw-post-body-paragraph kg kh jj ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">虽然您提供的底层数据可能不会经常改变，但是您可能会发现自己出于许多原因想要自动化部署您的<strong class="ki jk">dataset</strong>实例。例如，当我开始这个项目<strong class="ki jk">时，datasette】的版本是0.40，而当我写这篇文章时，它的版本是0.42。大多数版本你都不想更新你的datasette实例，但是0.41版本包含了创建自定义页面的能力(<a class="ae jg" href="https://datasette.readthedocs.io/en/stable/changelog.html#v0-41" rel="noopener ugc nofollow" target="_blank"> changelog </a>)。</strong></p><blockquote class="nn no np"><p id="ac55" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated">例如，添加一个名为<code class="fe le lf lg lh b">templates/pages/about.html</code>的模板文件将导致在实例的<code class="fe le lf lg lh b">/about</code>处提供一个新页面。</p></blockquote><p id="218c" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着我们可以在实例中为用户添加更多的上下文。也许包括一个帮助人们为项目做贡献的逐步指南，其他有用的链接，或者一个简单的介绍你自己的页面，这样使用这些数据的人可以更多地了解你。</p><p id="162c" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可能还想包含更多的<em class="li">固定查询</em>或者修改你描述中的一个错别字。不管是什么原因，自动化部署很容易实现。最终你需要做的就是运行<code class="fe le lf lg lh b">datasette heroku publish</code>,这是GitHub动作的一个完美用例</p><blockquote class="nn no np"><p id="925a" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated"><em class="jj">🚨</em> <strong class="ki jk"> <em class="jj">警告/注意:</em> </strong> <em class="jj">这下一部分变得技术性真快多了。GitHub Actions是一个更高级的主题。如果您不需要/不想定期更新新部署的</em><strong class="ki jk"><em class="jj">dataset</em></strong><em class="jj">实例，我不建议您现在就考虑GitHub动作。</em></p></blockquote></div><div class="ab cl pb pc hx pd" role="separator"><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg"/></div><div class="im in io ip iq"><h1 id="ed80" class="mh lk jj bd ll mi pi mk lo ml pj mn lr mo pk mq lu mr pl mt lx mu pm mw ma mx bi translated">GitHub操作</h1><blockquote class="nn no np"><p id="b25b" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated">GitHub动作帮助您在存储代码和协作处理拉取请求和问题的同一位置自动化您的软件开发工作流程。您可以编写称为操作的单个任务，并将它们组合起来创建自定义工作流。工作流是定制的自动化过程，您可以在存储库中设置它，以便在GitHub上构建、测试、打包、发布或部署任何代码项目。</p><p id="39af" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated"><a class="ae jg" href="https://help.github.com/en/actions/getting-started-with-github-actions/about-github-actions" rel="noopener ugc nofollow" target="_blank">-https://help . github . com/en/actions/getting-started-with-github-actions/about-github-actions</a></p></blockquote><p id="4bfb" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我们不会深入讨论GitHub的行为。你需要知道的是，通过GitHub操作，你可以并行或按顺序运行任务，这些任务由GitHub事件触发，如推送到一个分支，打开一个拉请求，评论一个问题或多个问题的组合。</p><p id="fb04" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些通常以yaml文件的形式存在于你的GitHub repos的<code class="fe le lf lg lh b">.github/workflows/</code>下。基本结构如下</p><pre class="nu nv nw nx gt od lh oe of aw og bi"><span id="6054" class="lj lk jj lh b gy oh oi l oj ok">name: Example of simple GitHub Action</span><span id="c1d9" class="lj lk jj lh b gy pn oi l oj ok">on:<br/>  push: <br/>    branches: [master]</span><span id="0d1e" class="lj lk jj lh b gy pn oi l oj ok">jobs:<br/>  say-hi:<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>    - name: Echo Hello World<br/>      run: |<br/>        echo "Hello World!"</span></pre><p id="9c2e" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每当主分支上有一个推送时，这个动作就会被触发，它将运行作业<code class="fe le lf lg lh b">say-hi</code>，该作业运行在最新的可用ubuntu虚拟机(VM)上。在那个虚拟机中，它将运行代码<code class="fe le lf lg lh b">echo "Hello World!"</code></p><p id="0ab3" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以在repo的<strong class="ki jk">操作</strong>选项卡上查看您的操作的输出/日志。</p><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi po"><img src="../Images/6afccd5bd90347c56abf6c699fe81464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SSxMvEqcCfOyiWB9hidc8A.png"/></div></div></figure><p id="10a3" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以很容易地改变<code class="fe le lf lg lh b">echo "Hello World!"</code></p><pre class="nu nv nw nx gt od lh oe of aw og bi"><span id="455b" class="lj lk jj lh b gy oh oi l oj ok">datasette publish heroku ripa-2018-db.db \\<br/>  --name ripa-2018-db \\<br/>  -m metadata.json \\<br/>  --extra-options="--config default_page_size:50 --config sql_time_limit_ms:30000 --config facet_time_limit_ms:10000"</span></pre><p id="29ab" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者更好的办法是将代码保存在bash脚本<code class="fe le lf lg lh b">heroku_deploy.sh</code>中，然后像运行<code class="fe le lf lg lh b">echo "Hello World!"</code>一样运行<code class="fe le lf lg lh b">sh heroku_deploy.sh</code></p><p id="8d1d" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">幸运的是，Heroku已经安装在我们的GitHub Action runner(<a class="ae jg" href="https://github.com/actions/virtual-environments/blob/master/images/linux/Ubuntu1804-README.md" rel="noopener ugc nofollow" target="_blank">Ubuntu-latest</a>)中，所以我们需要做的就是登录，安装<code class="fe le lf lg lh b">heroku-builds</code>插件并运行我们的脚本<code class="fe le lf lg lh b">heroku_deploy.sh</code>。</p><blockquote class="nn no np"><p id="cc43" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated"><em class="jj">💡在几次GitHub操作失败后，我了解到需要安装<code class="fe le lf lg lh b">heroku-builds</code>。我不确定它是否记录在datasette】或GitHub Actions文档中。</em></p></blockquote><p id="f63b" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以现在我们的GitHub动作应该是这样的</p><pre class="nu nv nw nx gt od lh oe of aw og bi"><span id="972c" class="lj lk jj lh b gy oh oi l oj ok">name: Example of simple GitHub Action</span><span id="af96" class="lj lk jj lh b gy pn oi l oj ok">on:<br/>  push: <br/>    branches: [master]</span><span id="198e" class="lj lk jj lh b gy pn oi l oj ok">jobs:<br/>  publish-to-heroku:<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>    - name: Publish to Heroku<br/>      run: |<br/>        heroku container:login &amp;&amp; heroku plugins:install heroku-builds &amp;&amp; sh heroku_deploy.sh</span></pre><p id="119c" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，这还没有准备好。为了自动登录，您需要包含环境变量<code class="fe le lf lg lh b">HEROKU_API_KEY</code>。这可以通过使用<a class="ae jg" href="https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets" rel="noopener ugc nofollow" target="_blank"> GitHub秘密</a>来实现。</p><p id="14b6" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要创建API密钥，您需要在本地安装heroku cli。运行命令<code class="fe le lf lg lh b">heroku authorizations:create</code>并将其添加到您的repo的<strong class="ki jk">设置&gt;机密</strong>选项卡上。命名为<code class="fe le lf lg lh b">HEROKU_API_KEY</code>。</p><p id="d880" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了让您的GitHub操作能够访问它，您必须将下面一行添加到它的yaml文件中</p><pre class="nu nv nw nx gt od lh oe of aw og bi"><span id="daa1" class="lj lk jj lh b gy oh oi l oj ok">name: Example of simple GitHub Action</span><span id="1846" class="lj lk jj lh b gy pn oi l oj ok">on:<br/>  push: <br/>    branches: [master]</span><span id="d55a" class="lj lk jj lh b gy pn oi l oj ok">jobs:<br/>  publish-to-heroku:<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>    - name: Publish to Heroku<br/>      env:<br/>        HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}<br/>      run: |<br/>        heroku container:login &amp;&amp; heroku plugins:install heroku-builds &amp;&amp; sh heroku_deploy.sh</span></pre><p id="e5a8" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">利斯托。现在，每次你推master，你都会部署一个新版本的datasette】。这意味着你可以更新你的<code class="fe le lf lg lh b">metadata.json</code>，例如，用一个新的<em class="li">预设查询</em>或者给你的<code class="fe le lf lg lh b">templates/pages</code>添加一个新页面。</p><p id="1e3a" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于这个项目，我有一些额外的步骤(也就是GitHub操作步骤),这些步骤处理数据，构建sqlite3数据库，并在每次需要master时将其部署到heroku。我还包含了几个python脚本，它们读取一个单独的yaml文件，在这个文件中，我跟踪所有的<em class="li">固定查询</em>，并将它们添加到一个<code class="fe le lf lg lh b">updated_metadata.json</code>。这是为了让事情更整洁，每个固定的查询都有一个标题、html_description和一个长的SQL查询；在我看来，作为一个单独的文件更容易维护。</p><p id="bb7b" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在这里看到我的GitHub Action yaml文件<a class="ae jg" href="https://github.com/chekos/RIPA-2018-datasette/blob/master/.github/workflows/main.yml" rel="noopener ugc nofollow" target="_blank"/>:</p><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="nz oa l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://github.com/chekos/RIPA-2018-datasette/blob/master/.github/workflows/main.yml" rel="noopener ugc nofollow" target="_blank">https://github.com/chekos/RIPA-2018-datasette/blob/master/.github/workflows/main.yml </a></p></figure><h1 id="8499" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">额外收获:使用github问题来建议查询</h1><p id="09e4" class="pw-post-body-paragraph kg kh jj ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果你访问<a class="ae jg" href="http://ripa-2018.datasettes.cimarron.io" rel="noopener ugc nofollow" target="_blank">ripa-2018 . datasets . cimarron . io</a>并运行查询，你会注意到<strong class="ki jk">在GitHub上提交</strong>按钮</p><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/181dd5fb53cfd646d6866a0441fa984f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hKuWnful3BZbVRBuiIUOuQ.gif"/></div></div></figure><p id="f808" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是通过调整<code class="fe le lf lg lh b">query.html</code>模板来完成的。<strong class="ki jk">dataset</strong>在幕后使用<code class="fe le lf lg lh b">jinja2</code>,它实际上将SQL查询作为url查询参数传递，这意味着您可以使用<code class="fe le lf lg lh b">request.query_string.split('sql=')[-1]</code>来访问它</p><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="nz oa l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://github.com/chekos/RIPA-2018-datasette/blob/fea53ce60ae43f0d7b0dd130109a01496f08e20a/datasette/templates/query.html#L53-L60" rel="noopener ugc nofollow" target="_blank">https://github . com/chekos/RIPA-2018-dataset/blob/FEA 53 ce 60 AE 43 f 0d 7 b 0 DD 130109 a 01496 f 08 e20 a/dataset/templates/query . html # L53-L60</a></p></figure><p id="595f" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦您可以访问它，您就可以在您的回购上创建一个新发行的简单链接:</p><pre class="nu nv nw nx gt od lh oe of aw og bi"><span id="7d47" class="lj lk jj lh b gy oh oi l oj ok">{% set link_to_new_issue = "&lt;https://GitHub.com/&gt;&lt;YOUR_USERNAME&gt;/&lt;YOUR_REPO&gt;/issues/new?title=Query+suggestion&amp;labels=suggestion&amp;body=" + &lt;QUERY_FOR_ISSUE&gt; %}</span></pre><h1 id="ee59" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">花了多长时间</h1><p id="7450" class="pw-post-body-paragraph kg kh jj ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">整个过程总共花费了大约20个小时，分散在3-4周内。大部分时间都是使用GitHub Actions来规划和协调整个自动化过程。我希望这篇教程能帮助你节省这些额外的时间。就像任何其他数据项目一样，最好花一些时间提前思考并勾画出过程的每一步。</p><h1 id="f6b7" class="mh lk jj bd ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu mv mw ma mx bi translated">行动呼吁</h1><p id="5470" class="pw-post-body-paragraph kg kh jj ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">世界变了。这个项目的想法是在四月中旬的某个时候产生的，直到月底我才创建了GitHub repo。我是五月下半月才开始写这个教程的。从那以后一切都变了。</p><p id="96c8" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每天在社交媒体上，我们都会看到有关当局滥用权力、对无辜民众实施暴力的视频和报道。不是全部，但也不应该是全部。</p><p id="a714" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我相信数据是变革、问责和透明的工具。技术和数据永远改变了世界。读者们，作为一名技术专家、数据书呆子、政策专家，或者任何你们选择的自我标榜的标签，我们对我们的同行有责任使用我们的技能、我们强大的工具、我们的知识让世界变得更美好，因为<strong class="ki jk">我们可以</strong>。</p><p id="55e9" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我请你想一想你所扮演的角色。你能用你正在建造的工具让世界变得更美好吗？</p><p id="7387" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将从<a class="ae jg" href="http://d4bl.org/" rel="noopener ugc nofollow" target="_blank">数据4BlackLives </a>中摘录如下:</p><blockquote class="nn no np"><p id="6070" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated"><strong class="ki jk">黑人生活数据</strong>是一项由活动家、组织者和数学家发起的运动，致力于利用数据科学为黑人的生活带来具体而可衡量的变化。自从计算出现以来，大数据和算法已经渗透到我们社会和经济生活的方方面面。这些新的数据系统有着巨大的潜力来增强有色人种社区的力量。统计建模、数据可视化和众包等工具，在合适的人手中，是对抗偏见、建设进步运动和促进公民参与的有力工具。但历史讲述了一个不同的故事，在这个故事中，数据经常被用作压迫的工具，加剧不平等和延续不公正。红线是一个数据驱动的企业，导致黑人社区被系统性地排除在主要金融服务之外。最近的趋势，如预测性警务、基于风险的判决和掠夺性贷款，是同一主题的令人不安的变化。今天，歧视是一个高科技企业。</p><p id="6c18" class="kg kh li ki b kj kk kl km kn ko kp kq nq ks kt ku nr kw kx ky ns la lb lc ld im bi translated"><em class="jj">——</em><a class="ae jg" href="http://d4bl.org/" rel="noopener ugc nofollow" target="_blank"><em class="jj">d4bl.org</em></a></p></blockquote></div></div>    
</body>
</html>