<html>
<head>
<title>Sharpening Pandas Knowledge</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">磨练熊猫的知识</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/improving-pandas-knowledge-e84865ac41f0?source=collection_archive---------18-----------------------#2020-03-10">https://towardsdatascience.com/improving-pandas-knowledge-e84865ac41f0?source=collection_archive---------18-----------------------#2020-03-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0a37" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">三个有用的熊猫方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b03da04b379ffad6cd54e970109d7f3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MOBBcB4d2E0ciH1EeMwQRg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/@diana-silaraja-794257" rel="noopener ugc nofollow" target="_blank">戴安娜·西拉瑞亚</a>在<a class="ae ky" href="https://www.pexels.com/photo/photo-of-panda-and-cub-playing-1661535/" rel="noopener ugc nofollow" target="_blank">像素</a>上拍摄</p></figure><p id="da89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是python中的一个库，通常用于统计分析、数据聚合等等。在这篇文章中，我将讨论熊猫中非常有用的三种方法。我将讨论“read_clipboard()”方法、“query()”方法和“apply()”方法。</p><p id="302c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><h1 id="45c6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">读取剪贴板的方法</strong></h1><p id="6f69" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">“read_clipboard()”方法提供了一种在数据框中存储复制到剪贴板的文本的简单方法。首先，去雅虎财经搜索道琼斯工业平均指数。接下来，单击历史数据并突出显示前几行，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/6978f8e25aca557d57302414d08657cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iy3vSf7FJnXZ0JgoBOhv_A.png"/></div></div></figure><p id="e89e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并按“CTRL + c”。最后，我们可以通过执行以下命令将复制的文本存储在数据框中:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d137" class="my lw it mu b gy mz na l nb nc">import pandas as pd <br/>df = pd.read_clipboard()<br/>print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/399da94354435917aef049dc2b4fb2d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J7cCoflc5Mc4a8kC-VZSpg.png"/></div></div></figure><p id="0a26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将此数据帧写入“csv ”,因为我们将在后续示例中继续使用此数据。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="199f" class="my lw it mu b gy mz na l nb nc">df.to_csv("dow_jones.csv")</span></pre><p id="e5c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们继续讨论“query()”方法。</p><h1 id="c349" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">查询方法</h1><p id="e1c8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">“query()”方法提供了一种使用字符串表达式选择数据的简单方法。让我们使用上面的相同数据来演示这种方法的使用。</p><p id="684d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将csv文件读入数据帧:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="6bad" class="my lw it mu b gy mz na l nb nc">df = pd.read_csv("dow_jones.csv")</span></pre><p id="ddaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将日期列转换成日期时间对象:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="362e" class="my lw it mu b gy mz na l nb nc">df['Date'] = pd.to_datetime(df['Date'])</span></pre><p id="9cca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们创建月和周列:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4d0a" class="my lw it mu b gy mz na l nb nc">df['Month'] = df['Date'].dt.month<br/>df['Week'] = df['Date'].dt.week</span></pre><p id="9535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们也放宽对行和列的显示限制:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="b8f3" class="my lw it mu b gy mz na l nb nc">pd.set_option('display.max_columns', None)<br/>pd.set_option('display.max_rows', None)</span><span id="a71a" class="my lw it mu b gy ne na l nb nc">print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/b23398444378e3346e141c9861c90c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eI0TM1IFuXrPOCqx3dyDeQ.png"/></div></div></figure><p id="8a89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们使用“query()”方法来选择基于周的数据:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="2264" class="my lw it mu b gy mz na l nb nc">df = df.query('Week &lt; 10')<br/>print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/2803adc037b099afaf9605469f2e51c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nBj25kzN1Q29IQ219LW1MQ.png"/></div></div></figure><p id="2273" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以按月份过滤:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4f54" class="my lw it mu b gy mz na l nb nc">df = df.query('Month == 3')<br/>print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/de09125c8acf193170d90bc8198c48d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LpHSMHvaB5jq_xsZP9yQ7w.png"/></div></div></figure><p id="8d6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就此而言，我们也可以基于任何其他列进行筛选。</p><p id="bc67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们继续讨论“apply()”方法。</p><h1 id="27cf" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">该应用方法</h1><p id="3d12" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将讨论的下一个方法是“apply()”方法。假设我们想取“开放”列的平方。要使用“apply()演示这一点，让我们首先从“Open”列中的字符串值中删除逗号，并将字符串值转换为浮点型:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="cb50" class="my lw it mu b gy mz na l nb nc">df['Open'] = df['Open'].str.replace(',', '')<br/>df['Open'] = df['Open'].astype(float)</span></pre><p id="abad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以使用“apply()”方法对列中的值求平方:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="6651" class="my lw it mu b gy mz na l nb nc">df['Open^2'] = df['Open'].apply(lambda x:x**2)<br/>print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/05c29678a1954bf9b532e004bd3e4052.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WKwlurtumPgoRgBR2Xt3cA.png"/></div></div></figure><p id="14af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个更实际的用例是使用带有自定义函数的apply方法。假设我们想从“Open”和“Close*”值计算回报。让我们从“Close*”列的字符串值中删除逗号，并将字符串值转换为浮点数:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4f6e" class="my lw it mu b gy mz na l nb nc">df['Close*'] = df['Close*'].str.replace(',', '')<br/>df['Close*'] = df['Close*'].astype(float)</span></pre><p id="c99b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们定义一个用于计算回报的函数:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="7c92" class="my lw it mu b gy mz na l nb nc">def calculate_returns(df_in):<br/>    returns = (df_in[1] — df_in[0])/(df_in[0])*100<br/>    return returns</span></pre><p id="aa95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回报的公式是:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c6ce" class="my lw it mu b gy mz na l nb nc">(df['Close*'] — df['Open'])/(df['Open'])*100</span></pre><p id="6980" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们使用“apply()”方法和我们的自定义函数来计算将存储在新列中的回报:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="9744" class="my lw it mu b gy mz na l nb nc">df['returns'] = df[['Open', 'Close*']].apply(calculate_returns, axis = 1)</span></pre><p id="0ae0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们打印前五行:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0fda" class="my lw it mu b gy mz na l nb nc">print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/f2d5e4b0af9372b713849dcf3cf84b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*92HVkFEtzjOzauDdZlHNig.png"/></div></div></figure><h1 id="abf4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="aa20" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">总之，在这篇文章中，我们讨论了熊猫的三种方法。我们讨论了“read_clipboard()”方法，该方法允许我们将复制到剪贴板的文本读入数据框。我们还讨论了“query()”方法，它允许我们用字符串表达式选择和过滤数据。最后，我们讨论了“apply()”方法，该方法允许我们用相对简单的代码转换和创建新列。这篇文章的代码可以在GitHub 上找到。感谢您的阅读！</p></div></div>    
</body>
</html>