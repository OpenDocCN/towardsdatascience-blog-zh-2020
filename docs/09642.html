<html>
<head>
<title>Set-up of a personal GPU server for Machine Learning with Ubuntu 20.04</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Ubuntu 20.04 设置用于机器学习的个人 GPU 服务器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/set-up-of-a-personal-gpu-server-for-machine-learning-with-ubuntu-20-04-100e787105ad?source=collection_archive---------2-----------------------#2020-07-09">https://towardsdatascience.com/set-up-of-a-personal-gpu-server-for-machine-learning-with-ubuntu-20-04-100e787105ad?source=collection_archive---------2-----------------------#2020-07-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1551" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">TensorFlowGPU，JupyterLab，CUDA，cuDNN，端口转发，DNS 配置，SSHFS，bash</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6e2aada9862a2e4f519b5c8e90ce5359.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JiUb-XNLZi6CFhPm"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卡斯帕·卡米尔·鲁宾在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。奶昔是可选的 GPU 设置。</p></figure><p id="b0a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在你的 ML 工作流程中使用 GPU 的好处<a class="ae ky" rel="noopener" target="_blank" href="/what-is-a-gpu-and-do-you-need-one-in-deep-learning-718b9597aa0d">已经在前面</a>讨论过了。本文的目标是总结为个人 ML 项目设置机器的步骤。我从 2017 年开始遵循<a class="ae ky" href="https://medium.com/@aragalie/build-your-own-top-spec-remote-access-machine-learning-rig-a-very-detailed-assembly-and-dae0f4011a8f" rel="noopener">一个类似的指南</a>，发现从那时起到 2020 年，很多步骤都变了——变得更好。此外，根据我在攻读博士学位期间使用 DAQ 系统的经验，我将建议一些程序，使您的远程工作流程更简单、更安全。</p><p id="dc05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到本文结束时，您将能够从您的笔记本电脑启动运行在 GPU 主机上的远程 JupyterLab 会话。此外，您将能够从任何地方远程打开机器，并将它的文件系统直接安装到您的笔记本电脑上。</p><h1 id="4492" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">大纲:</h1><ol class=""><li id="efaa" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu mu mv mw mx bi translated">安装和设置<em class="my"> Ubuntu 20.04 </em>(独立/双引导/WLS2)</li><li id="76f6" class="mn mo it lb b lc mz lf na li nb lm nc lq nd lu mu mv mw mx bi translated">设置远程访问(<em class="my"> ssh </em>、WOL、DNS 配置、端口转发)</li><li id="6450" class="mn mo it lb b lc mz lf na li nb lm nc lq nd lu mu mv mw mx bi translated">照顾 NVIDIA 驱动程序和库(CUDA，cuDNN)</li><li id="5688" class="mn mo it lb b lc mz lf na li nb lm nc lq nd lu mu mv mw mx bi translated">为 ML 创建 Python 环境</li><li id="96ad" class="mn mo it lb b lc mz lf na li nb lm nc lq nd lu mu mv mw mx bi translated">易用工具:用 SSHFS 挂载远程目录，将一些常用命令设置为<em class="my"> bash </em>别名</li></ol></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="6fdd" class="lv lw it bd lx ly nl ma mb mc nm me mf jz nn ka mh kc no kd mj kf np kg ml mm bi translated">要求:</h1><ol class=""><li id="8b98" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu mu mv mw mx bi translated">您通常在其上工作的笔记本电脑/台式机。我用的是运行 macOS 10.15 的 MacBook Pro 2015。</li><li id="074b" class="mn mo it lb b lc mz lf na li nb lm nc lq nd lu mu mv mw mx bi translated">一台带有 GPU 的机器，例如，这可以是你当前的游戏 PC。你不需要花费预算在昂贵的 GPU 上来开始训练你的 DNNs！我的硬件目前比较一般:<br/> <strong class="lb iu"> CPU: </strong> AMD 锐龙 5 2600X (3.6 GHz，六核)<br/> <strong class="lb iu"> GPU: </strong>英伟达 GTX 1660(6GB VRAM)<br/><strong class="lb iu">RAM:</strong>16gb(DDR 4 3200 MHz)<br/><strong class="lb iu">存储:</strong> 512 GB <strong class="lb iu"> </strong> NVMe M.2 (SSD)、512 GB HDD <br/> <strong class="lb iu"/></li><li id="1c02" class="mn mo it lb b lc mz lf na li nb lm nc lq nd lu mu mv mw mx bi translated">对路由器设置的管理员级访问权限(可选)</li><li id="c65f" class="mn mo it lb b lc mz lf na li nb lm nc lq nd lu mu mv mw mx bi translated">熟悉 Linux 和终端</li></ol></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="7a24" class="lv lw it bd lx ly nl ma mb mc nm me mf jz nn ka mh kc no kd mj kf np kg ml mm bi translated">1.安装和设置 Ubuntu 20.04</h1><p id="018f" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">在我和其他人看来，Windows 操作系统都不适合做任何 ML 开发或网络工作。因此，我们将为此目的设置一个 Linux 操作系统。Ubuntu Desktop 20.04  ( <a class="ae ky" href="https://ubuntu.com/download/desktop" rel="noopener ugc nofollow" target="_blank">在这里下载</a>)是一个理想的选择，因为许多功能都是现成的，与其他 Linux 发行版相比，它允许我们节省设置时间。您有三种选择:</p><ol class=""><li id="33b1" class="mn mo it lb b lc ld lf lg li nt lm nu lq nv lu mu mv mw mx bi translated"><a class="ae ky" href="https://ubuntu.com/tutorials/install-ubuntu-desktop#1-overview" rel="noopener ugc nofollow" target="_blank">只安装 Ubuntu</a>。</li><li id="168e" class="mn mo it lb b lc mz lf na li nb lm nc lq nd lu mu mv mw mx bi translated">双启动 Ubuntu 和现有的 Windows 操作系统。<strong class="lb iu">此处按照 i </strong> <a class="ae ky" href="https://www.linuxtechi.com/dual-boot-ubuntu-20-04-lts-along-with-windows-10/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">指令</strong> </a> <strong class="lb iu">(推荐选项)。</strong></li><li id="f491" class="mn mo it lb b lc mz lf na li nb lm nc lq nd lu mu mv mw mx bi translated">使用 WSL2 (Windows 子系统 for Linux)；这就是这里讨论的<a class="ae ky" rel="noopener" target="_blank" href="/dual-boot-is-dead-windows-and-linux-are-now-one-27555902a128"/>。<strong class="lb iu">警告</strong>:我从来没有测试过这个选项(这里你自己看吧！).</li></ol><p id="1bb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">我推荐选项#2 </strong>，保留对窗口的访问(例如，出于游戏相关的目的)。确保在安装期间将您的计算机连接到互联网，以获取最新的更新和驱动程序。</p><p id="ad87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装后，登录并更新和安装必要的软件包，例如</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="e917" class="ob lw it nx b gy oc od l oe of">sudo apt-get update &amp;&amp;<br/>sudo apt-get -y upgrade &amp;&amp;<br/>sudo apt-get -y install build-essential gcc g++ make binutils &amp;&amp;<br/>sudo apt-get -y install software-properties-common git &amp;&amp;<br/>sudo apt-get install build-essential cmake git pkg-config</span></pre><h1 id="a2c1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.设置远程访问</h1><p id="ec06" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">在本节中，我们将设置一种安全的远程登录机器的方式。还讨论了从任何网络访问 GPU 机器的选项。</p><h1 id="3443" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">嘘</h1><p id="d924" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">现在，登录 Ubuntu，打开终端并安装 ssh-server:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="928f" class="ob lw it nx b gy oc od l oe of">sudo apt update &amp;&amp;<br/>sudo apt install openssh-server</span></pre><p id="6309" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，验证 ssh-server 安装是否正确</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="517b" class="ob lw it nx b gy oc od l oe of">sudo systemctl status ssh</span></pre><p id="d6aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开防火墙</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="0c4f" class="ob lw it nx b gy oc od l oe of">sudo ufw allow ssh</span></pre><p id="249b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过从您的笔记本电脑 (假设与您的 GPU 机器连接到同一个网络)运行<strong class="lb iu"> <em class="my">来测试您的 ssh 连接</em></strong></p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="0d7f" class="ob lw it nx b gy oc od l oe of">ssh <strong class="nx iu">user</strong>@&lt;<strong class="nx iu">local-ip-address</strong>&gt;</span></pre><p id="61f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<strong class="lb iu"> <em class="my">用户</em> </strong>是你的 Ubuntu 用户名，而你在 Ubuntu 上的本地 IP 地址(如 172.148.0.14)可以用<code class="fe og oh oi nx b">ip add</code>找到，产生(如)</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="b3f7" class="ob lw it nx b gy oc od l oe of"><em class="my">link/ether </em><strong class="nx iu"><em class="my">b3:21:88:6k:17:24</em></strong><em class="my"> brd ff:ff:ff:ff:ff:ff<br/>inet </em><strong class="nx iu"><em class="my">172.148.0.14</em></strong><em class="my">/32 scope global noprefixroute </em><strong class="nx iu"><em class="my">enp7s3</em></strong></span></pre><p id="9420" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记下您的 MAC 地址(如<strong class="lb iu"> b3:21:88:6k:17:24 </strong>)和网卡名称(如<strong class="lb iu"> enp7s3 </strong>)，以备后用。</p><p id="a28c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，按照此处 描述的<a class="ae ky" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys--2" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">设置无密码登录的 ssh 密钥。之后，<em class="my">假设你只想从这台笔记本电脑</em>登录到你的机器，<strong class="lb iu">禁用使用密码登录的选项</strong>。这将只允许来自已经交换了 ssh-key 对的设备的 ssh 连接，<strong class="lb iu">提高了安全性</strong>。在 Ubuntu 上编辑<code class="fe og oh oi nx b">/etc/ssh/sshd_config</code>(使用 sudo 权限)以添加</strong></a></p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="d7aa" class="ob lw it nx b gy oc od l oe of">#only ssh-key logins <br/>PermitRootLogin no<br/>ChallengeResponseAuthentication no<br/>PasswordAuthentication no<br/>UsePAM no<br/>AllowUsers user<br/>PubkeyAuthentication yes</span><span id="8941" class="ob lw it nx b gy oj od l oe of"># keep ssh connection alive <br/>ClientAliveInterval 60<br/>TCPKeepAlive yes<br/>ClientAliveCountMax 10000</span></pre><p id="9ff9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要忘记重新启动 ssh-service，让它通过</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="d988" class="ob lw it nx b gy oc od l oe of">sudo restart ssh</span></pre><h1 id="8e9f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">域名服务器(Domain Name Server)</h1><p id="c6ec" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">如果您想从家庭网络之外通过 ssh 连接到您的计算机，您需要建立一个永久的 DNS“主机名”,它独立于您的计算机的全局 IP 地址，您的 ISP 可以随时更改该地址。我个人使用过 no-IP 的免费服务(<a class="ae ky" href="https://www.noip.com/" rel="noopener ugc nofollow" target="_blank">链接此处</a>，从 Ubuntu 的浏览器 )开始使用“立即创建你的免费主机名”<strong class="lb iu"><em class="my">)；存在替代 DNS 服务，如 FreeDNS、Dynu 等。请创造性地使用您的主机名；我真不敢相信 mlgpu.ddns.net 还没被录取。这个主机名将在本文中作为一个例子。</em></strong></p><p id="b022" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，按照此处描述的<a class="ae ky" href="https://my.noip.com/#!/dynamic-dns/duc" rel="noopener ugc nofollow" target="_blank">安装动态更新客户端(DUC)。这可以确保当您的全局 IP 发生变化时，它会重新链接到您的主机名(即<strong class="lb iu">mlgpu.ddns.net</strong>)。为了确保每次使用 Ubuntu 都能启动 DUC，添加一个新的<em class="my"> cronjob </em>和<code class="fe og oh oi nx b">sudo crontab -e</code>(即在文件末尾添加这一行)</a></p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="98f6" class="ob lw it nx b gy oc od l oe of">@reboot su -l <strong class="nx iu">user</strong> &amp;&amp; sudo noip2</span></pre><p id="545f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重启你的机器。</p><h1 id="9289" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">端口转发</h1><p id="531f" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">默认情况下，ssh 使用端口 22 进行连接。我们需要通过路由器打开这个端口(TCP 和 UDP 协议),以便能够从外部网络 ssh 到机器(您仍然希望从咖啡店提交那些 GPU 密集型作业，对吗？).此设置通常位于“高级/安全”选项卡下。下面是我的路由器设置的截图</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/78d39592a36ed8912bd3524da8b73d94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TAl9z1ElLLVYm_W1xRRiLQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">UDP 和 TCP 协议都允许通过 Ubuntu 网卡的端口 22。</p></figure><p id="8c6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="my">可选</em>:在挖掘你的路由器设置时，将你的 Ubuntu 的网卡<strong class="lb iu"> MAC 地址</strong>和<strong class="lb iu">本地 IP </strong>添加到保留列表(“添加保留规则”)，并将你的路由器设置保存到一个文件中(以防你日后需要重新加载)。</p><p id="72cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="my">最后，在你的笔记本电脑</em> 上 <strong class="lb iu"> <em class="my">，编辑<code class="fe og oh oi nx b">~/.ssh/config</code>用你的 Ubuntu 用户名替换<strong class="lb iu">用户</strong>，用你的 DNS 主机名替换主机名</em></strong></p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="5dc4" class="ob lw it nx b gy oc od l oe of"># keep ssh connection alive<br/>TCPKeepAlive yes<br/>ServerAliveInterval 60</span><span id="f1d8" class="ob lw it nx b gy oj od l oe of"># assign a 'shortcut' for hostname and enable graphical display over ssh (X11) <br/>Host                 <strong class="nx iu">mlgpu</strong><br/>HostName             <strong class="nx iu">mlgpu.ddns.net</strong><br/>GSSAPIAuthentication yes<br/>User                 <strong class="nx iu">user</strong><br/>ForwardX11Trusted         yes<br/>ForwardX11                yes<br/>GSSAPIDelegateCredentials yes</span></pre><p id="7456" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将允许您快速 ssh 到您的机器，并测试 DNS 和端口转发正在工作</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="e245" class="ob lw it nx b gy oc od l oe of">ssh mlgpu</span></pre><p id="8b1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这应该不会要求您输入密码，您现在可以从任何网络 ssh 到您的 GPU 机器！</p><h1 id="617d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">局域网唤醒</h1><p id="22d5" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">想象一个场景，你正在参加一个会议(在 2020 年之前，这些会议在远离你家的地方举行——我知道这很奇怪！)并且你想在你的 GPU 机器上训练你的 DNN。但是等等，你在离开家之前把它关掉了——哦，天哪！</p><p id="3ea7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是<a class="ae ky" href="https://www.techrepublic.com/article/how-to-enable-wake-on-lan-in-ubuntu-server-18-04/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">沃尔和</strong> </a>的神奇之处！</p><p id="7935" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 Ubuntu 上，编辑<code class="fe og oh oi nx b">/etc/systemd/system/wol@.service</code></p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="3f9a" class="ob lw it nx b gy oc od l oe of">[Unit]<br/>Description=Wake-on-LAN for %i<br/>Requires=network.target<br/>After=network.target</span><span id="9eb2" class="ob lw it nx b gy oj od l oe of">[Service]<br/>ExecStart=/sbin/ethtool -s %i wol g<br/>Type=oneshot</span><span id="e03a" class="ob lw it nx b gy oj od l oe of">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="66ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，通过以下方式启用 WOL 服务</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="ea3f" class="ob lw it nx b gy oc od l oe of">sudo systemctl enable wol@enp7s3 &amp;&amp; <br/>systemctl is-enabled wol@np7s3</span></pre><p id="666c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将返回“enabled”；<strong class="lb iu"> enp7s3 </strong>是用<code class="fe og oh oi nx b">ip add</code>命令返回的网卡名称。最后，检查您的 BIOS 设置“wake-on-LAN”= enabled。</p><p id="e162" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，<strong class="lb iu">在你的笔记本电脑</strong>上，通过</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="2fc6" class="ob lw it nx b gy oc od l oe of">brew install wakeonlan</span></pre><p id="de18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要测试 WOL 是否正常工作，请关闭 Ubuntu，并使用您的 DNS 主机名(或 IP 地址)和 MAC 地址从您的笔记本电脑发出以下命令</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="23fd" class="ob lw it nx b gy oc od l oe of">wakeonlan -i <strong class="nx iu">mlgpu.ddns.net</strong> -p 22 <strong class="nx iu">b3:21:88:6k:17:24</strong></span></pre><p id="5947" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将唤醒你的 GPU 机器从睡眠或关机状态(当然，确保它仍然连接到电源！).如果你选择了双引导选项，并且 Ubuntu 不是引导菜单中的第一个操作系统，<a class="ae ky" href="https://www.linuxuprising.com/2018/12/how-to-change-grub-boot-order-or.html" rel="noopener ugc nofollow" target="_blank">用<em class="my"> GRUB </em> </a>调整它。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><p id="eead" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样:从你的 GPU 机器上拔下你的显示器、键盘和鼠标，从这里我们将从你的笔记本电脑上运行的远程 ssh 会话中发出所有命令——太棒了！</p><h1 id="16e8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.管理 NVIDIA 驱动程序和库</h1><p id="5d58" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">更多好消息在前方。Ubuntu 20.04 应该会自动为你安装 Nvidia 驱动(而不是<em class="my">新出的</em>那些)。让我们用<code class="fe og oh oi nx b">nvidia-smi</code>来验证一下</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/0768876904d96945d9cb529196acfe7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5fC-fgdM-9av5KmTcF-Chg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">确认检测到您的 GPU 后，使用正确数量的 VRAM，记下驱动程序和 CUDA 版本。</p></figure><p id="46e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不是最新版本的驱动程序。然而，我们可能想让他们从标准的 Ubuntu 库安装 CUDA 和 cuDNN。</p><h2 id="b8d8" class="ob lw it bd lx om on dn mb oo op dp mf li oq or mh lm os ot mj lq ou ov ml ow bi translated">库达</h2><p id="f55c" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">只需安装 CUDA</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="65d2" class="ob lw it nx b gy oc od l oe of">sudo apt update &amp;&amp;<br/>sudo apt install nvidia-cuda-toolkit</span></pre><p id="4a61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用<code class="fe og oh oi nx b">nvcc --version</code>验证</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/11f583070ce298375bc0929e830db78e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3N-rVSaSEVkNENfUlI50aw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CUDA toolkit (v10.1)是从 Ubuntu 库获得的。</p></figure><p id="f323" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，使用这里的文件<a class="ae ky" href="https://github.com/glukicov/ML_GPU/blob/master/hello.cu" rel="noopener ugc nofollow" target="_blank">构建您的第一个 CUDA“Hello World”示例</a></p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="9c3d" class="ob lw it nx b gy oc od l oe of">nvcc -o hello hello.cu &amp;&amp;<br/>./hello</span></pre><p id="aef8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“最大误差:0.000000”意味着您的 CUDA 库工作正常！</p><h1 id="bbbd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">cuDNN</h1><p id="9142" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">最后，为 CUDA 10.1 (或为您从<code class="fe og oh oi nx b">nvcc --version</code>发布的 CUDA 版本)下载<a class="ae ky" href="https://developer.nvidia.com/rdp/cudnn-download#a-collapse765-101" rel="noopener ugc nofollow" target="_blank">cud nn v 7 . 6 . 5(2019 年 11 月 5 日)。你需要注册一个 NVIDIA 开发者计划的免费帐户来下载 cuDNN。</a></p><p id="0842" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用以下命令从解压缩的 tarball 中复制库:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="436c" class="ob lw it nx b gy oc od l oe of">sudo cp cuda/include/cudnn.h /usr/lib/cuda/include/ &amp;&amp;<br/>sudo cp cuda/lib64/libcudnn* /usr/lib/cuda/lib64/ &amp;&amp;<br/>sudo chmod a+r /usr/lib/cuda/include/cudnn.h  /usr/lib/cuda/lib64/libcudnn*</span></pre><p id="7e82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并将库导出到$LD_LIBRARY_PATH</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="8762" class="ob lw it nx b gy oc od l oe of">echo 'export LD_LIBRARY_PATH=/usr/lib/cuda/lib64:$LD_LIBRARY_PATH' &gt;&gt; ~/.bashrc &amp;&amp;<br/>echo 'export LD_LIBRARY_PATH=/usr/lib/cuda/include:$LD_LIBRARY_PATH' &gt;&gt; ~/.bashrc &amp;&amp;<br/>source ~/.bashrc</span></pre><p id="fb8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任务完成了。</p><h1 id="33dc" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">4.为 ML 创建 Python 环境</h1><p id="95f6" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">在 Linux 和 macOS 上，我个人的偏好是使用<em class="my"> pip </em>而不是<em class="my"> conda </em>来管理 Python 包和环境。下面是设置 ML Python3 环境的说明:</p><p id="ad33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，获取最新的 Python3</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="7f48" class="ob lw it nx b gy oc od l oe of">sudo apt update &amp;&amp;<br/>sudo apt install python3-pip python3-dev</span></pre><p id="a14b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，升级<em class="my"> pip </em>并安装环境管理器</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="b958" class="ob lw it nx b gy oc od l oe of">sudo -H pip3 install --upgrade pip<br/>sudo -H pip3 install virtualenv</span></pre><p id="7498" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将为基于 GPU 的项目创建一个新目录</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="e7f9" class="ob lw it nx b gy oc od l oe of">mkdir ~/gpu_ml &amp;&amp;<br/>cd ~/gpu_ml</span></pre><p id="fc9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并在那里实例化一个新的 Python 环境</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="490a" class="ob lw it nx b gy oc od l oe of">virtualenv gpu_ml_env</span></pre><p id="012f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将允许我们直接在那个环境中安装软件包，而不是“全局”安装。该环境需要用以下命令激活(每次登录)</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="c6d4" class="ob lw it nx b gy oc od l oe of">source ~/gpu_ml/bin/activate</span></pre><p id="8387" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你应该在你的终端里看到<code class="fe og oh oi nx b">(gpu_ml_env)</code>。现在，让我们在那个环境中安装 Python 包(在那个环境中 pip == pip3)</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="8f1e" class="ob lw it nx b gy oc od l oe of">pip install jupyterlab &amp;&amp;<br/>pip install tensorflow &amp;&amp;<br/>pip install tensorflow-gpu</span></pre><p id="e580" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要的任何其他 Python 包都可以类似地安装。</p><h1 id="4e33" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">5.易用的工具</h1><h1 id="2b5b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">尝试</h1><p id="05ca" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">我推荐你在 Ubuntu 的<code class="fe og oh oi nx b">~/.bash_aliases</code>中添加一些命令。他们会在每次登录时激活<code class="fe og oh oi nx b">gpu_ml</code>环境，以及添加一些有帮助的“终端快捷方式”(人生苦短，不能键入‘jupyter lab’而不是‘jlab’，对！？).命令如下(<a class="ae ky" href="https://gist.github.com/glukicov/e882798949f19d374409752afc56cc91" rel="noopener ugc nofollow" target="_blank">替代链接</a>)</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy oz l"/></div></figure><p id="bf82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">在您的笔记本电脑</strong>上，您可能希望将这些行添加到您的<code class="fe og oh oi nx b">~/.profile, </code>中，用您的 DNS 主机名(或 IP 地址)替换 ML，并使用步骤#2 中的 MAC 地址。这些命令如下(<a class="ae ky" href="https://gist.github.com/glukicov/de4b1f37ce383db3aa1c3e9906988df9" rel="noopener ugc nofollow" target="_blank">替代链接</a>)</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy oz l"/></div></figure><h1 id="0244" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">SSHFS</h1><p id="42f0" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">从这里安装 macOS 的 FUSE<a class="ae ky" href="https://osxfuse.github.io/" rel="noopener ugc nofollow" target="_blank">，调整下面的脚本，其中<code class="fe og oh oi nx b">remotedir="user@$ML:/home/user/"</code>，和<code class="fe og oh oi nx b">mountdir="/Users/user/Documents/Ubuntu_mount"</code>是你的 macOS 上的目录，Ubuntu 上的文件将被挂载到这个目录。脚本如下(</a><a class="ae ky" href="https://gist.github.com/glukicov/d843dec124de27c9c158b1b1aec5e723" rel="noopener ugc nofollow" target="_blank">备选链接</a>)</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy oz l"/></div></figure><p id="475e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用运行脚本</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="55e4" class="ob lw it nx b gy oc od l oe of">. ./mount.sh</span></pre><p id="329b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在你的 macOS 上导航到<code class="fe og oh oi nx b">/Users/user/Documents/Ubuntu_mount</code>(或者简单地输入<code class="fe og oh oi nx b">cd_ML</code>)来查看作为“本地文件”的 Ubuntu 文件。你现在可以在你的笔记本电脑上用你最喜欢的编辑器打开和编辑远程 Ubuntu 文件，等等——太棒了！</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><p id="7188" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们做这个设置的最后测试(手指交叉！).<strong class="lb iu">从您的笔记本电脑上</strong></p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="9b2b" class="ob lw it nx b gy oc od l oe of">sg</span></pre><p id="bce3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的“bash shortcuts”中，它代表<code class="fe og oh oi nx b">ssh -L 8899:localhost:8899 mlgpu.ddns.net</code>。这应该会在端口 8899 上打开一个 ssh 隧道，并从该会话类型登录到 Ubuntu</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="27cc" class="ob lw it nx b gy oc od l oe of">jlab</span></pre><p id="4ee5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哪个是<code class="fe og oh oi nx b">jupyter lab --port=8899</code>的 bash 快捷键？</p><p id="87a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在笔记本电脑上打开您最喜欢的网络浏览器，导航至<code class="fe og oh oi nx b"><a class="ae ky" href="http://localhost:8899/lab" rel="noopener ugc nofollow" target="_blank">http://localhost:8899/lab</a></code>。第一次，您需要将令牌从终端粘贴到浏览器中(例如<code class="fe og oh oi nx b">The Jupyter Notebook is running at:http://localhost:8899/?token=<strong class="lb iu">583049XXYZ…</strong></code>)</p><p id="a8aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 JupyterLab 中，检查我们确实是从 Linux 运行这台笔记本</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="464b" class="ob lw it nx b gy oc od l oe of">import platform<br/>platform.system()</span></pre><p id="ff45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">张量流检测 GPU</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="2b2a" class="ob lw it nx b gy oc od l oe of">import tensorflow as tf<br/>tf.config.list_physical_devices(‘GPU’)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/ccd05f2a4db4ea4a37cac1d379a778b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_oC5bAX3aRxkjllFK2E-A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们通过笔记本电脑在远程 GPU 服务器上运行 JupyterLab 笔记本。不太令人兴奋的输出#2 实际上是一个好消息，TensorFlow 检测到了我们的 GPU。</p></figure><p id="00c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这里开始，你就可以实施你的 DNN 培训等。使用图形处理器。如果您遵循了第 1 节到第 5 节中的所有步骤，那么您的工作流程相当简单:</p><p id="6f51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.用<code class="fe og oh oi nx b">sg</code> <br/> 2 打开一个到你的 GPU 服务器的 ssh 隧道。用<code class="fe og oh oi nx b">jlab</code> <br/> 3 在 GPU 服务器上启动 JupyterLab。在笔记本电脑上打开网络浏览器，并转至<code class="fe og oh oi nx b"><a class="ae ky" href="http://localhost:8899/lab" rel="noopener ugc nofollow" target="_blank">http://localhost:8899/lab</a></code> <br/> 4。快乐训练——真正的工作从这里开始！</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="f6fb" class="lv lw it bd lx ly nl ma mb mc nm me mf jz nn ka mh kc no kd mj kf np kg ml mm bi translated">编后记</h1><p id="3d82" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">我希望这篇文章对帮助你设置远程 GPU 服务器以满足你的 ML 需求有所帮助。如果您发现本文中的过程有任何改进，请告诉我，我会尽我所能在这里添加它们。</p></div></div>    
</body>
</html>