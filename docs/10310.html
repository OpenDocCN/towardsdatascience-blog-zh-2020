<html>
<head>
<title>Creating a Monitoring service with EventBridge, AWS Lambda, SNS and Node.js — Serverless-first</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 EventBridge、AWS Lambda、SNS 和 Node.js 创建监控服务—无服务器优先</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-a-monitoring-service-with-eventbridge-aws-lambda-sns-and-node-js-serverless-first-3c2eb8b0dad4?source=collection_archive---------38-----------------------#2020-07-20">https://towardsdatascience.com/creating-a-monitoring-service-with-eventbridge-aws-lambda-sns-and-node-js-serverless-first-3c2eb8b0dad4?source=collection_archive---------38-----------------------#2020-07-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/0c9845b6c412fc5829579320d12a3ae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YvyeCXVytusC4y1z"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">克里斯·利维拉尼在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="c583" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">比方说，我们只想检查服务是否正在运行，如果它停止了，您希望得到通知，就这么简单。</h2><p id="7326" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">此外，这个想法是为了展示我们在 AWS 中使用无服务器概念并尝试总是考虑“无服务器优先”的方法，只使用 3 个服务:Amazon EventBridge、Aws Lambda 和 Amazon Simple Notification Service，可以多么容易地做到这一点。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="85ed" class="me kh it bd ki mf mg mh kl mi mj mk ko ml mm mn ks mo mp mq kw mr ms mt la mu bi translated">先决条件</h1><ul class=""><li id="44c8" class="mv mw it le b lf lg lj lk kp mx kt my kx mz lw na nb nc nd bi translated">AWS 帐户</li><li id="74cc" class="mv mw it le b lf ne lj nf kp ng kt nh kx ni lw na nb nc nd bi translated">Node.js 的基础知识</li></ul></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h2 id="1346" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">亚马逊简单通知服务——SNS</h2><p id="cd92" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated"><a class="ae kf" href="https://aws.amazon.com/sns/" rel="noopener ugc nofollow" target="_blank"> SNS </a>定义:</p><blockquote class="nj nk nl"><p id="3445" class="lc ld nm le b lf nn lh li lj no ll lm np nq lo lp nr ns lr ls nt nu lu lv lw im bi translated">面向微服务、分布式系统和无服务器应用的完全托管发布/订阅消息</p></blockquote><p id="8205" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">在我们的例子中，我们将使用这个服务来发送电子邮件。</p><p id="ec90" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">在 SNS 服务中，让我们创建一个主题，我将使用的名称是<em class="nm"> MonitoringAlert </em></p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/5c5ea2d2c9e8b2c1387a1a894ad4ad79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eym5mVKgxaTXf4zmA4Q5Zg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">社交网络话题</p></figure><p id="f0d8" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">创建主题后，现在让我们创建订阅:</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/a92cb8d4d6f3134dce1808cac1974062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aRQgFHVVJrSoFD9lsCpx3A.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">SNS 主题已创建</p></figure><p id="a994" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">对于订阅，我们需要设置:</p><p id="474e" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">协议:电子邮件</p><p id="3f00" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">端点:您的电子邮件地址</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/b32151be892fbef6f7ba50747ae7bb64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5l3_ihFPxBUK6m2S6mzsSg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">社交网络订阅</p></figure><p id="6a8e" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">下标已创建，状态为“<em class="nm">待确认</em>”:</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oc"><img src="../Images/fe8148062a70ed58c1686c25b2ce69ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zKPQgk5veT_7mOcgLAn_Uw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">SNS 主题等待确认</p></figure><p id="fd96" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">一旦您确认状态消息将发生变化，您将通过电子邮件收到一个确认链接:</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/6a2b283c234423d6acd02ac50e3375c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JKbx4V6SolqU24GWZfy_Qw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">社交网络话题已确认</p></figure><p id="b0ab" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">完成，SNS 话题已经创建并确认。现在是时候创建 Lambda 函数了。</p><h2 id="7ace" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">自动气象站λ</h2><p id="b57a" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated"><a class="ae kf" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank">λ</a>定义:</p><blockquote class="nj nk nl"><p id="b360" class="lc ld nm le b lf nn lh li lj no ll lm np nq lo lp nr ns lr ls nt nu lu lv lw im bi translated">运行代码时不考虑服务器。只为您消耗的计算时间付费。</p></blockquote><h2 id="8abe" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">λ许可</h2><p id="3bdc" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">允许我们成为:</p><figure class="nw nx ny nz gt ju"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="4948" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">λ代码</h2><p id="acb9" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">lambda 将负责检查服务是否正在运行，如果出现问题，将触发 SNS:</p><figure class="nw nx ny nz gt ju"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="dc6e" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">λ环境变量</h2><p id="5a0a" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">我们的 lambda 函数依赖于两个环境变量:</p><ul class=""><li id="80fd" class="mv mw it le b lf nn lj no kp og kt oh kx oi lw na nb nc nd bi translated">社交网站:社交网站创造的 ARN</li><li id="70a4" class="mv mw it le b lf ne lj nf kp ng kt nh kx ni lw na nb nc nd bi translated">serviceToCheck:我们想要检查的 URL，我的情况是我使用的是 NASA 的 API (https://api.nasa.gov/planetary/apod？api_key=DEMO_KEY)</li></ul><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/e680f127e1bfe53bd924b87d26e04211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AhgSmAmdBn3iqMXXByErDw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">AWS Lambda 环境变量</p></figure><p id="cf02" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">现在我们已经创建了 SNS 主题和 Lambda 函数，是时候使用最新的服务 Amazon EventBrigde 了。</p><h2 id="cda5" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">亚马逊事件桥</h2><p id="5f13" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated"><a class="ae kf" href="https://aws.amazon.com/eventbridge/" rel="noopener ugc nofollow" target="_blank">事件桥</a>定义:</p><blockquote class="nj nk nl"><p id="3f42" class="lc ld nm le b lf nn lh li lj no ll lm np nq lo lp nr ns lr ls nt nu lu lv lw im bi translated">连接您自己的应用程序、SaaS 和 AWS 服务的应用程序数据的无服务器事件总线</p></blockquote><p id="5cdb" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">在我们的例子中，我们将使用 EventBrigde 作为调度程序，它将以我们定义的频率运行并触发 Lambda 函数。</p><h2 id="e80b" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">规则模式</h2><p id="cc63" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">关于规则的重要思考是模式。这种模式决定了频率，在我们的例子中，我们将把<em class="nm">计划</em>设置为每 1 分钟一次的固定频率(您可以根据自己的需求进行替换):</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/f4146a08959454c30ff7890ca164e36b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ea9V4TLrKYt8fO9JlqHjXw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">Amazon EventBridge 创建</p></figure><p id="d060" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">其次，在目标中，我们将选择<em class="nm"> Lambda 函数</em>，并在基础中添加我们的<em class="nm"> webAppMonitor: </em></p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ol"><img src="../Images/67d2258af01453bdf3c2bbc42d2de3fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0qPy2vuPh3tPcOOcf8zwsA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">Amazon EventBridge 目标</p></figure><p id="6b0e" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">最后，创建了 EventBrigde 规则:</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/fe3e076d6dfbd9de8348705681a19bcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jWYKjqk5XLcxqDh2H6FhrQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">事件桥规则</p></figure><p id="95ab" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">现在，每次服务离线时，我们都会收到这样的消息:</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi on"><img src="../Images/8cab3112749ac63f39e895d54ee6cb07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VMfu2437L7S0bawI8qpk1g.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">SNS 通知电子邮件</p></figure><p id="02e0" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">也就这些了，希望能对你有用:)</p><p id="6271" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">你怎么想？有没有其他方法可以解决同样的问题？非常感谢您的反馈。</p><p id="c070" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">非常感谢您的宝贵时间！</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><p id="30a7" class="pw-post-body-paragraph lc ld it le b lf nn lh li lj no ll lm kp nq lo lp kt ns lr ls kx nu lu lv lw im bi translated">原帖<a class="ae kf" href="https://devandops.cloud/creating-a-monitoring-service-with-eventbridge-aws-lambda-sns-and-nodejs-serverless-first/" rel="noopener ugc nofollow" target="_blank">https://devan dops . cloud/creating-a-monitoring-service-with-event bridge-AWS-lambda-SNS-and-nodejs-server less-first/</a></p></div></div>    
</body>
</html>