<html>
<head>
<title>How to Make Beautiful Small Multiple US Maps in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在R中制作漂亮的小型多用户地图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-make-beautiful-small-multiple-us-maps-in-r-ad7e557cd463?source=collection_archive---------26-----------------------#2020-02-02">https://towardsdatascience.com/how-to-make-beautiful-small-multiple-us-maps-in-r-ad7e557cd463?source=collection_archive---------26-----------------------#2020-02-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b338" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一行代码就能让你的可视化更上一层楼</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/17047834a8493c469460fc059f01788d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dqXPTzNNZQyT6c1StgMexw.jpeg"/></div></div></figure><p id="df05" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我最近偶然发现了一个关于美国难民接收情况的大型数据集。它包括难民来自的<em class="lr">、</em>以及前接收难民的<em class="lr">各州的数据。</em></p><p id="f9e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<a class="ae lq" href="https://connorrothschild.github.io/map-missing-migrants/" rel="noopener ugc nofollow" target="_blank">之前的项目</a>中，我探索了迁徙是如何在<em class="lr">个地方</em>展开的:迁徙者在哪里旅行，他们在哪里失踪，以及他们的旅程在哪里到达致命的终点。</p><p id="82fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有了这个新的数据集，我想看看<em class="lr">收容国</em>是如何应对移民和难民危机的，特别关注美国。在我看来，美国对日益增加的难民数量的反应的有效可视化需要呈现两件事:难民接受度如何随着时间的推移而变化<em class="lr"/>以及各州难民接受度如何不同<em class="lr">。</em></p><p id="5960" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">呈现这两种趋势的一种有效方式是使用<a class="ae lq" href="https://en.wikipedia.org/wiki/Small_multiple" rel="noopener ugc nofollow" target="_blank">小型多重</a>折线图。出于审美的目的，将这些倍数排列成一种隐约类似美国的形状也是不错的。(这也让读者更容易找到自己感兴趣的状态。)</p><p id="5d34" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">互联网上有这种小型多重地图的例子。《华盛顿邮报》对选举团的概述如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ls"><img src="../Images/325afbd687733b48fde1a808d45f6737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j8stQVRE_uJPhmohaeTlSA.png"/></div></div></figure><p id="7638" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你也可以在<a class="ae lq" href="https://policyviz.com/2016/05/19/small-multiple-tile-grid-map/" rel="noopener ugc nofollow" target="_blank"> PolicyViz </a>博客上找到<em class="lr">为什么</em>有效的概述，以及一些额外的例子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lt"><img src="../Images/a5381c68d780bfe9aeab744d352ccb5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cwh_0UFHR3-k_p193lLcsw.jpeg"/></div></div></figure><h1 id="8041" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">在R制作</h1><p id="44cf" class="pw-post-body-paragraph ku kv it kw b kx mm ju kz la mn jx lc ld mo lf lg lh mp lj lk ll mq ln lo lp im bi translated">在R中创建一个小的多瓦片栅格地图的过程相对容易(就像在R中完成的大多数事情一样)。这在D3.js中要困难得多；如果你对那类事情感兴趣，你可以看看<a class="ae lq" href="https://bl.ocks.org/jinniluo/a95b27b1f4ea65ae94ab6ca3fcfb5934#index.html" rel="noopener ugc nofollow" target="_blank">这个代码</a>寻找灵感。</p><h2 id="d6df" class="mr lv it bd lw ms mt dn ma mu mv dp me ld mw mx mg lh my mz mi ll na nb mk nc bi translated">步骤1:构建基本折线图</h2><p id="072c" class="pw-post-body-paragraph ku kv it kw b kx mm ju kz la mn jx lc ld mo lf lg lh mp lj lk ll mq ln lo lp im bi translated">第一步(在讨厌的数据<a class="ae lq" href="https://github.com/connorrothschild/R/blob/master/refugee-trends/merge.R" rel="noopener ugc nofollow" target="_blank">合并</a>和清理之后)是对基本线图有个感觉。为了做到这一点，我们可以想象出所有州<em class="lr">接受难民的宏观趋势。</em></p><p id="8ec1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(变量名怪怪的；<code class="fe nd ne nf ng b">region_name_3</code>对应年份，<code class="fe nd ne nf ng b">textbox37</code>代表接受的难民人数。)</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="c55b" class="mr lv it ng b gy nl nm l nn no">data %&gt;% <br/>  group_by(region_name_3) %&gt;% <br/>  summarise(textbox37 = sum(textbox37)) %&gt;% <br/>  ggplot(aes(x = region_name_3, y = textbox37)) +<br/>  geom_line() +<br/>  labs(title = "Refugee Acceptance on the Decline",<br/>       subtitle = "Number of refugees accepted annually, 2002 - 2019",<br/>       x = element_blank(),<br/>       y = element_blank()) +<br/>  scale_y_continuous(labels = scales::comma_format()) +<br/>  scale_x_continuous(breaks = c(2002, 2019))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/f23c01f4709ed45aabc195a913c02bd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Voc81O1LfvmEfS-WAx3AA.jpeg"/></div></div></figure><p id="251d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们有了第一个问题的答案:<strong class="kw iu">随着时间的推移，难民接受度发生了怎样的变化？答案是:非常剧烈。美国在2016年接收了近10万名难民；两年后，这个数字刚刚超过20，000。</strong></p><h2 id="b355" class="mr lv it bd lw ms mt dn ma mu mv dp me ld mw mx mg lh my mz mi ll na nb mk nc bi translated">第二步:做小倍数</h2><p id="e4a3" class="pw-post-body-paragraph ku kv it kw b kx mm ju kz la mn jx lc ld mo lf lg lh mp lj lk ll mq ln lo lp im bi translated">接下来，我们制作50行:每一行代表美国的一个州。我们使用瑞安·哈芬的<code class="fe nd ne nf ng b">geofacet</code> <a class="ae lq" href="https://hafen.github.io/geofacet/rd.html" rel="noopener ugc nofollow" target="_blank">软件包</a>来实现。</p><p id="5bc7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这很简单，只需在我们之前的绘图中添加一行代码:</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="9533" class="mr lv it ng b gy nl nm l nn no">facet_geo(~ state)</span></pre><p id="5482" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这使得一个情节看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/6d1c7177f8b205c2ad8865a1a4329023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jG_jIFofxpL3C0kXNYfAEw.jpeg"/></div></div></figure><p id="e548" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">还可以，但不完美！我们肯定可以做一些改进。</p><p id="feeb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，轴标签重叠。我们已经知道年份的范围是2002年到2019年之间(在我们的字幕里！).所以我们可以去掉x轴标签。</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="6757" class="mr lv it ng b gy nl nm l nn no">theme(<br/>  axis.text.x = element_blank(),<br/>  axis.ticks.x = element_blank()<br/>  )</span></pre><p id="d41c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第二，轴线(在两个轴上)似乎是不必要的，并且(特别是x轴)有时可以隐藏那些具有较低值的状态的趋势。让我们把那些也拿掉！</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="47eb" class="mr lv it ng b gy nl nm l nn no">theme(<br/>  axis.line.x = element_blank(),<br/>  axis.line.y = element_blank()<br/>  )</span></pre><p id="cc7f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，我不喜欢我的轴标签周围巨大的灰色方框。我们能让它们透明吗？</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="6a54" class="mr lv it ng b gy nl nm l nn no">theme(<br/>    strip.background = element_rect(color = "white")<br/>)</span></pre><p id="96e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将所有这些加在一起(并调整字体大小)，我们得到这样的结果:</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="7c42" class="mr lv it ng b gy nl nm l nn no">data %&gt;% <br/>  group_by(region_name_3, state) %&gt;% <br/>  summarise(textbox37 = sum(textbox37)) %&gt;% <br/>  ggplot(aes(x = region_name_3, y = textbox37)) +<br/>  geom_line(color = "black") +<br/>  scale_x_continuous(breaks = c(2002,2019)) +<br/>  scale_y_continuous(breaks = c(0,12000)) +<br/>  facet_geo(~ state, grid = "us_state_grid1") +<br/>  labs(title = "Refugee Acceptance on the Decline",<br/>       subtitle = "Number of refugees accepted annually, 2002 - 2019",<br/>       x = element_blank(),<br/>       y = element_blank()) +<br/>  theme(<br/>    axis.text.x = element_blank(),<br/>    axis.ticks.x = element_blank(),<br/>    axis.line.x = element_blank(),<br/>    axis.line.y = element_blank(),<br/>    plot.title = element_text(size = 24),<br/>    plot.subtitle = element_text(size = 18),<br/>    strip.background = element_rect(color = "white")<br/>  )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/7d16cf83d0eb79d895286d09567cbf9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RKQJ1Pj4kavKQvIWSa4YGg.jpeg"/></div></div></figure><p id="16ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好多了。但是我们仍然可以添加一些元素来使我们的可视化更上一层楼。</p><p id="64f0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因为我们的数据跨越了近20年(2002年至2019年)，所以我们可以用其他感兴趣的变量来覆盖我们的小倍数，例如在特定时期谁是总统。</p><p id="4dc8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们使用<code class="fe nd ne nf ng b">geom_rect</code>来实现:</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="320d" class="mr lv it ng b gy nl nm l nn no">geom_rect(mapping=aes(xmin=2009, xmax=2017, ymin=0, ymax=12000),<br/>fill = "#ADD8E6", alpha = .05) +<br/>geom_rect(mapping=aes(xmin=2017, xmax=2019, ymin=0, ymax=12000),<br/>fill = "#FF9999", alpha = .05) +</span></pre><p id="6986" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一行代码创建了一个跨越2009年到2017年(奥巴马任期)的蓝盒子。第二行为特朗普的总统任期创建了一个红框(到目前为止)。</p><p id="5a5d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">综上所述，代码和输出如下所示:</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="6e98" class="mr lv it ng b gy nl nm l nn no">data %&gt;% <br/>  group_by(region_name_3, state) %&gt;% <br/>  summarise(textbox37 = sum(textbox37)) %&gt;% <br/>  ggplot(aes(x = region_name_3, y = textbox37)) +<br/>  geom_line(color = "black") +<br/>  geom_rect(mapping=aes(xmin=2009, xmax=2017, ymin=0, ymax=12000), fill = "#ADD8E6", alpha = .05) +<br/>  geom_rect(mapping=aes(xmin=2017, xmax=2019, ymin=0, ymax=12000), fill = "#FF9999", alpha = .05) +<br/>  scale_x_continuous(breaks = c(2002,2019)) +<br/>  scale_y_continuous(breaks = c(0,12000)) +<br/>  facet_geo(~ state, grid = "us_state_grid1") +<br/>  labs(title = "Refugee Acceptance on the Decline",<br/>       subtitle = "Number of refugees accepted annually, 2002 - 2019",<br/>       x = element_blank(),<br/>       y = element_blank()) +<br/>  theme(<br/>    axis.text.x = element_blank(),<br/>    axis.ticks.x = element_blank(),<br/>    axis.line.x = element_blank(),<br/>    axis.line.y = element_blank(),<br/>    plot.title = element_text(size = 24),<br/>    plot.subtitle = element_text(size = 18),<br/>    strip.background = element_rect(color = "white")<br/>  )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/26bedbc4fa09f03f5b4c950c203da0c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FittmsJFpn5GF-zvEGs7pA.png"/></div></div></figure><p id="83dd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我把这个情节带到Illustrator中，让它看起来漂亮多了。这是最终版本:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/17047834a8493c469460fc059f01788d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dqXPTzNNZQyT6c1StgMexw.jpeg"/></div></div></figure><p id="1e61" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们注意到了什么？几个关键的州(德克萨斯州、加利福尼亚州、佛罗里达州和密歇根州)占了难民接收人数的绝大部分，而其他州几乎不接收难民。自2017年以来，几乎每个州都减少了难民接收量，但这一下降的大部分来自这些较大的州。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><div class="kj kk kl km gt oa"><a href="https://twitter.com/CL_Rothschild" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">康纳·罗斯柴尔德</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">康纳·罗斯柴尔德的最新推文(@CL_Rothschild)。@RiceUniversity本科。对数据感兴趣…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">twitter.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ks oa"/></div></div></a></div><p id="4958" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lr">原载于</em> <a class="ae lq" href="https://connorrothschild.github.io/refugee-trends/" rel="noopener ugc nofollow" target="_blank"> <em class="lr">我的博客</em> </a> <em class="lr">。</em></p></div></div>    
</body>
</html>