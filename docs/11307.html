<html>
<head>
<title>How to make a wordcloud of your blog, programmatically?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何以编程的方式为你的博客制作文字云？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-make-a-wordcloud-of-your-blog-programmatically-6c2bad1baa4?source=collection_archive---------39-----------------------#2020-08-05">https://towardsdatascience.com/how-to-make-a-wordcloud-of-your-blog-programmatically-6c2bad1baa4?source=collection_archive---------39-----------------------#2020-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1338" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python 中的文本语料库可视化工具</h2></div><p id="6a45" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最近，我需要一张我们博客的图片，希望它有一些<em class="le">哇效果</em>，或者至少有一个<em class="le">比我们一直使用的任何典型的<em class="le">更适合</em>。</em>思索了一会儿，云字在脑海中闪过。💡通常，你只需要一长串文本就可以生成一个，但我想到了解析我们的整个博客数据，看看是否有什么有趣的东西冒出来，并获得我们博客使用的关键词的整体视图。所以，我把这个作为自己的周末趣味项目。</p><blockquote class="lf lg lh"><p id="3ec3" class="ki kj le kk b kl km ju kn ko kp jx kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated">PS:形象在营销中非常重要。给它质量！👀</p></blockquote><h1 id="d742" class="ll lm it bd ln lo lp lq lr ls lt lu lv jz lw ka lx kc ly kd lz kf ma kg mb mc bi translated">弄脏你的手:</h1><p id="3e8f" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">我们的博客托管在<strong class="kk iu"><em class="le">Ghost</em></strong><em class="le"/>上，它允许我们将所有的帖子和设置导出到一个单独的、精彩的 JSON 文件中。而且，我们在 python 中内置了<em class="le"> json </em>包，用于解析 json 数据。我们的舞台已经准备好了。🤞</p><p id="b37e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于其他流行的平台，如 WordPress，Blogger，Substack 等。 它可能是一个或多个 XML 文件，你可能需要相应地切换包并在 python 中做基础工作。</p><p id="0bb5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在阅读 python 中的 JSON 之前，您应该了解它的结构、需要阅读的内容、需要过滤的内容等等。为此，使用一些 json 处理器来漂亮地打印你的 JSON 文件，我使用了<a class="ae mi" href="https://www.jqplay.org" rel="noopener ugc nofollow" target="_blank">jqplay.org</a>，它帮助我找出我的帖子位于➡<br/>t0】</p><p id="e674" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，您想调用<code class="fe mj mk ml mm b">pd.json.normalize()</code>将您的数据转换成一个平面表，并保存为一个数据框。</p><blockquote class="lf lg lh"><p id="7978" class="ki kj le kk b kl km ju kn ko kp jx kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated"><em class="it">👉注意:你应该已经为<code class="fe mj mk ml mm b"><em class="it">pd.json.normalize()</em></code>安装了熊猫的更新版本，因为它已经修改了旧版本中的名字。另外，保持编码为 UTF-8，否则，你很可能会遇到 UnicodeDecodeErrors。(我们有这些坏人:' \xa0 '、' \n '和' \t '等。)</em></p></blockquote><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="ba75" class="mv lm it mm b gy mw mx l my mz">import pandas as pd<br/>import json</span><span id="cdd6" class="mv lm it mm b gy na mx l my mz">with open('fleetx.ghost.2020-07-28-20-18-49.json', encoding='utf-8') as file: <br/>    data = json.load(file)  <br/>posts_df = pd.json_normalize(data['db'][0]['data']['posts']) <br/>posts_df.head()</span></pre><figure class="mn mo mp mq gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nb"><img src="../Images/2ee82cbb87703df1260d3697b9a7108d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SWjvfuBgn6nurucA6U-MVA.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">发布数据框架</p></figure><p id="46c5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">查看数据帧，您可以看到<strong class="kk iu"> <em class="le"> ghost </em> </strong>保留了我们创建的帖子的三种格式，<a class="ae mi" href="https://github.com/bustle/mobiledoc-kit/blob/master/MOBILEDOC.md" rel="noopener ugc nofollow" target="_blank"> mobiledoc </a>(没有 HTML 解析器的简单快速呈现器)、HTML 和明文，以及帖子的其他属性范围。我选择使用明文版本，因为它需要最少的清理。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="0e18" class="mv lm it bd ln nu nv dn lr nw nx dp lv kr ny nz lx kv oa ob lz kz oc od mb oe bi translated">清洁工作:</h2><ul class=""><li id="e974" class="of og it kk b kl md ko me kr oh kv oi kz oj ld ok ol om on bi translated">删除丢失的值(你可能有的任何空白帖子),以免在以后绘制图表时妨碍你的分析。我们有一篇草稿中的博客文章，里面什么也没有。🤷‍♂️</li><li id="4972" class="of og it kk b kl oo ko op kr oq kv or kz os ld ok ol om on bi translated">帖子中的<strong class="kk iu"> <em class="le">明文</em> </strong>几乎包含了所有可能不需要的字符，从空格和制表符<em class="le"> (\n，\xao，\t) </em>，到语法标点符号(点、逗号、分号、冒号、破折号、连字符、s 等)的 14 个标记。)甚至是要点。用空格替换它们。</li><li id="b46b" class="of og it kk b kl oo ko op kr oq kv or kz os ld ok ol om on bi translated">接下来，我将每篇博文中的单词拆分到<strong class="kk iu"> <em class="le">明文</em> </strong> <em class="le"> </em>列下，然后将每个单元格的结果列表连接起来，得到一个很长的单词列表。这导致了 34000 字；我们有大约 45 篇已发表的博客，每篇平均 700 字，还有一些草稿，所以算出来是 45*700=31500 字。一致！🤜</li></ul><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="14a6" class="mv lm it mm b gy mw mx l my mz">posts_df.dropna(subset=['plaintext'], axis=0, inplace=True)</span><span id="a3b5" class="mv lm it mm b gy na mx l my mz">posts_df.plaintext = posts_df.plaintext.str.replace('\n', ' ')<br/>.str.replace('\xa0',' ').str.replace('.',' ').str.replace('·', ' ')<br/>.str.replace('•',' ').str.replace('\t', ' ').str.replace(',',' ')<br/>.str.replace('-', ' ').str.replace(':', ' ').str.replace('/',' ')<br/>.str.replace('*',' ')</span><span id="bd93" class="mv lm it mm b gy na mx l my mz">posts_df.plaintext = posts_df.plaintext.apply(lambda x: x.split())<br/>words_list =[]<br/>for i in range(0,posts_df.shape[0]):<br/>    words_list.extend(posts_df.iloc[i].plaintext)</span></pre><p id="5b96" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你现在就渴望得到结果，你可以在那个<code class="fe mj mk ml mm b">words_list</code>上运行<code class="fe mj mk ml mm b">collections.Counter</code>，并获得每个词的频率，从而了解你的词云可能是什么样子。</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="1780" class="mv lm it mm b gy mw mx l my mz">import collections</span><span id="5e6a" class="mv lm it mm b gy na mx l my mz">word_freq = collections.Counter(words_list)<br/>word_freq.most_common(200)</span></pre><p id="cecf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">猜猜博客中最常用的词是什么？🤞<br/>如果你说<strong class="kk iu"><em class="le">【the】</em></strong>你就对了。对于非常长的文本，冠词<strong class="kk iu"><em class="le">‘the’</em></strong>将优先于任何其他单词。而且，不仅仅是“the ”,还有其他几个介词、代词、连词和动作动词出现在最高频率列表中。我们当然不需要它们，要移除它们，我们必须首先定义它们。幸运的是，我们将用来生成 wordcloud 的库自带了默认的停用词，但它相当保守，只有 192 个词。所以，让我们来看看自然语言处理(NLP)中的库，它们处理大量的文本并致力于此类任务。🔎</p><ul class=""><li id="3fe8" class="of og it kk b kl km ko kp kr ot kv ou kz ov ld ok ol om on bi translated">国家语言工具包库(NLTK):它有 179 个停用词，甚至比 wordcloud 停用词库还少。不要仅仅因为这个原因就给它一个邪恶的眼神，这是 python 中领先的 NLP 库。</li><li id="4419" class="of og it kk b kl oo ko op kr oq kv or kz os ld ok ol om on bi translated">Genism:它的集合中有 337 个停用词。</li><li id="b546" class="of og it kk b kl oo ko op kr oq kv or kz os ld ok ol om on bi translated">Sci-kit learn:他们还有一个 318 个单词的停用词库。</li><li id="3aec" class="of og it kk b kl oo ko op kr oq kv or kz os ld ok ol om on bi translated">此外，还有 Spacy:它有 326 个停用词。</li></ul><p id="ef00" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我选择了空间，你可以根据自己的喜好选择。</p><h2 id="5566" class="mv lm it bd ln nu nv dn lr nw nx dp lv kr ny nz lx kv oa ob lz kz oc od mb oe bi translated">但是…😓</h2><p id="7c7e" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">这还不够！不过，从营销的角度来看，有些词看起来不太好，而且我们也没有尽可能地做好清理工作。因此，我将它们放在一个文本文件中(每个单词占一行)，然后读取它，并加入 spacy 的停用词表。</p><blockquote class="lf lg lh"><p id="909c" class="ki kj le kk b kl km ju kn ko kp jx kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated"><a class="ae mi" href="https://spacy.io/usage/models#quickstart" rel="noopener ugc nofollow" target="_blank">设置空间的说明</a>。</p></blockquote><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="58d4" class="mv lm it mm b gy mw mx l my mz">import spacy</span><span id="00e3" class="mv lm it mm b gy na mx l my mz">nlp=spacy.load('en_core_web_sm')<br/>spacy_stopwords = nlp.Defaults.stop_words</span><span id="58a3" class="mv lm it mm b gy na mx l my mz">with open("more stopwords.txt") as file:<br/>    more_stopwords = {line.rstrip() for line in file}</span><span id="2794" class="mv lm it mm b gy na mx l my mz">final_stopwords = spacy_stopwords | more_stopwords</span></pre></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="bf34" class="mv lm it bd ln nu nv dn lr nw nx dp lv kr ny nz lx kv oa ob lz kz oc od mb oe bi translated">设立设计室:</h2><p id="68e9" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">现在我们已经准备好了重新设计的停用词表，我们可以调用神奇的制造者➡的单词云功能了。通过 Jupyter/CLI/Conda 使用 pip 命令安装 wordcloud 库。</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="04af" class="mv lm it mm b gy mw mx l my mz">pip install wordcloud</span><span id="dff0" class="mv lm it mm b gy na mx l my mz">import matplotlib.pyplot as plt<br/>import wordcloud</span><span id="d439" class="mv lm it mm b gy na mx l my mz">#Instantiate the wordcloud object</span><span id="9ecf" class="mv lm it mm b gy na mx l my mz">wc = wordcloud.WordCloud(background_color='white', max_words=300, stopwords=final_stopwords, collocations=False, max_font_size=40, random_state=42)</span><span id="d54f" class="mv lm it mm b gy na mx l my mz"># Generate word cloud<br/>wc=wc.generate(" ".join(words_list).lower())</span><span id="6e03" class="mv lm it mm b gy na mx l my mz"># Show word cloud<br/>plt.figure(figsize=(20,15))<br/>plt.imshow(wc, interpolation='bilinear')<br/>plt.axis("off")<br/>plt.show()</span><span id="eb43" class="mv lm it mm b gy na mx l my mz"># save the wordcloud<br/>wc.to_file('wordcloud.png');</span></pre><p id="436d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于 python 用户来说，上述代码块的大部分内容都是不言自明的，不过让我们做一个简短的介绍:</p><ul class=""><li id="899d" class="of og it kk b kl km ko kp kr ot kv ou kz ov ld ok ol om on bi translated"><code class="fe mj mk ml mm b">background_color</code>:你的文字云的背景，<em class="le">黑</em>白<em class="le">最常见。</em></li><li id="b930" class="of og it kk b kl oo ko op kr oq kv or kz os ld ok ol om on bi translated"><code class="fe mj mk ml mm b">max_words</code>:你想在 wordcloud 中显示的最大字数，默认为 200 个。</li><li id="df5d" class="of og it kk b kl oo ko op kr oq kv or kz os ld ok ol om on bi translated"><code class="fe mj mk ml mm b">stopwords</code>:要从 wordcloud 中删除的停用词集合。</li><li id="3f93" class="of og it kk b kl oo ko op kr oq kv or kz os ld ok ol om on bi translated"><code class="fe mj mk ml mm b">collocations</code>:是否包含两个词的搭配(二元组)，默认为真。</li></ul><h2 id="5eaa" class="mv lm it bd ln nu nv dn lr nw nx dp lv kr ny nz lx kv oa ob lz kz oc od mb oe bi translated">什么是二元模型？</h2><p id="64e6" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">这是两个相邻单词的序列。看看下面的例子。</p><figure class="mn mo mp mq gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ow"><img src="../Images/f70fb0b148f9b272cf9763659cfb2fe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PvOgRYPKOnl8AbLLXxoV1Q.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">句子的二元结构</p></figure><blockquote class="lf lg lh"><p id="d0ce" class="ki kj le kk b kl km ju kn ko kp jx kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated">注意:将所有文本以小写解析到 wordcloud generator，因为所有停用词都是以小写定义的。它不会消除大写停用词。</p></blockquote><p id="568b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好的，输出是这样的:</p><figure class="mn mo mp mq gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ox"><img src="../Images/d6a57c99c0165c5e40567c6d42c6b826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YdqyZxT2Zl4TSODuYSUoiA.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">博客数据的文字云</p></figure><p id="154e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于一个做车队管理的公司来说，这是正确的！车队管理这个关键词比什么都有分量。</p><p id="c0a5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然，上面的图片错过了所有这一切的元素:车辆。幸运的是，你可以用 wordcloud 库在你选择的图片上屏蔽上面的 wordcloud。所以，我们开始吧。</p><ul class=""><li id="7d98" class="of og it kk b kl km ko kp kr ot kv ou kz ov ld ok ol om on bi translated">选择您选择的矢量图像。我从<a class="ae mi" href="https://www.vecteezy.com/vector-art/329166-truck-illustration-isolated-on-a-white-background" rel="noopener ugc nofollow" target="_blank"> Vecteezy </a>中挑选了我的图片。<br/>这次您还需要导入<em class="le"> Pillow </em>和<em class="le"> NumPy </em>库来读取图像并将其转换为 NumPy 数组。</li><li id="96b6" class="of og it kk b kl oo ko op kr oq kv or kz os ld ok ol om on bi translated">下面是生成屏蔽的 wordcloud 的注释代码块，大部分内容和以前一样。</li></ul><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="2be3" class="mv lm it mm b gy mw mx l my mz">import matplotlib.pyplot as plt<br/>from PIL import Image<br/>import numpy as np<br/>import os</span><span id="dbe3" class="mv lm it mm b gy na mx l my mz"># Read your image and convert it to an numpy array.<br/>truck_mask=np.array(Image.open("Truck2.png"))</span><span id="2d57" class="mv lm it mm b gy na mx l my mz"># Instantiate the word cloud object.<br/>wc = wordcloud.WordCloud(background_color='white', max_words=500, stopwords=final_stopwords, mask= truck_mask, scale=3, width=640, height=480, collocations=False, contour_width=5, contour_color='steelblue')</span><span id="4d20" class="mv lm it mm b gy na mx l my mz"># Generate word cloud<br/>wc=wc.generate(" ".join(words_list).lower())</span><span id="671c" class="mv lm it mm b gy na mx l my mz"># Show word cloud<br/>plt.figure(figsize=(18,12))<br/>plt.imshow(wc, interpolation='bilinear')<br/>plt.axis("off")<br/>plt.show()</span><span id="53bb" class="mv lm it mm b gy na mx l my mz"># save the masked wordcloud<br/>wc.to_file('masked_wsordcloud.png');</span></pre><h2 id="16ad" class="mv lm it bd ln nu nv dn lr nw nx dp lv kr ny nz lx kv oa ob lz kz oc od mb oe bi translated">以下是输出结果:</h2><figure class="mn mo mp mq gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oy"><img src="../Images/e2a6f2425106dcc9abf9f323cc99c1a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YAfOTmN107D0RzHzLHmWJQ.png"/></div></div></figure><p id="77a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">瞧啊。我们以编程的方式制作了我们的 wordcloud！🚚💨</p><figure class="mn mo mp mq gt nc"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="2e33" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谢谢你读到这里！🙌</p><h2 id="4af5" class="mv lm it bd ln nu nv dn lr nw nx dp lv kr ny nz lx kv oa ob lz kz oc od mb oe bi translated"><strong class="ak">参考:</strong></h2><ul class=""><li id="9f03" class="of og it kk b kl md ko me kr oh kv oi kz oj ld ok ol om on bi translated"><a class="ae mi" href="https://amueller.github.io/word_cloud/generated/wordcloud.WordCloud.html" rel="noopener ugc nofollow" target="_blank">https://amueller.github.io/word_cloud/generated/wordcloud.WordCloud.html</a></li><li id="6c58" class="of og it kk b kl oo ko op kr oq kv or kz os ld ok ol om on bi translated">【https://nlp.stanford.edu/fsnlp/promo/colloc.pdf】</li></ul></div></div>    
</body>
</html>