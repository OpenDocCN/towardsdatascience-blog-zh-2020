<html>
<head>
<title>Building a Machine Learning Pipeline — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建机器学习管道—第 1 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-machine-learning-pipeline-part-1-b19f8c8317ae?source=collection_archive---------48-----------------------#2020-08-04">https://towardsdatascience.com/building-a-machine-learning-pipeline-part-1-b19f8c8317ae?source=collection_archive---------48-----------------------#2020-08-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="44e1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用软件包 fast_ml</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1a36759401a844e25960fe8cef476876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_whdwP3OWMURwGHr"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@jjying?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> JJ 英</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="cd47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是构建 ML 管道的常用步骤:</p><ol class=""><li id="174d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">输入数据</li><li id="019c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">探索性数据分析</li><li id="e16b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">缺失值插补</li><li id="8c00" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">异常值处理</li><li id="abb0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">特征工程</li><li id="4476" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">模型结构</li><li id="f558" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">特征选择</li><li id="915e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">模型解释</li><li id="18ac" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">保存模型</li><li id="243e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">模型部署*</li></ol></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ade9" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">问题陈述和获取数据</h1><p id="70a6" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我用一个相对更大更复杂的数据集来演示这个过程。参考 Kaggle 竞赛— <a class="ae ky" href="https://www.kaggle.com/c/ieee-fraud-detection/" rel="noopener ugc nofollow" target="_blank"> IEEE-CIS 欺诈检测</a>。</p><p id="936f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导航到数据浏览器，您会看到类似这样的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/66146dd080de9d384eff31a68939927a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F5Z15Hbj59dmX5R37faavw.png"/></div></div></figure><p id="00c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择<em class="no"> train_transaction.csv </em>，它将向您展示数据的大概情况。单击红色箭头突出显示的下载图标获取数据。</p><p id="0dd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了通常的库导入语句，您还需要检查另外两个库——</p><h2 id="d356" class="np mr it bd ms nq nr dn mw ns nt dp na li nu nv nc lm nw nx ne lq ny nz ng oa bi translated">安装 pyarrow</h2><h2 id="e0f4" class="np mr it bd ms nq nr dn mw ns nt dp na li nu nv nc lm nw nx ne lq ny nz ng oa bi translated">pip 安装快速 _ml</h2></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="3db2" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">主要亮点</h1><p id="ea73" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">这是构建机器学习管道系列的第一篇文章。在本文中，我们将重点关注关于在 Jupyter notebook 中导入数据和更快执行的优化。</p><p id="3751" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章中有 3 个关键点需要注意—</p><ol class=""><li id="33e3" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu"> Python zipfile </strong></li><li id="bd7e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">减少数据集的内存使用量</strong></li><li id="0878" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">保存/加载工作数据集的更快捷方式</strong></li></ol></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="336c" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">1:导入数据</h1><p id="0fdf" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">下载压缩文件后。使用 python 来解压文件要好得多。</p><blockquote class="ob oc od"><p id="942e" class="kz la no lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated"><strong class="lb iu">提示 1:<em class="it"/></strong><em class="it">se 函数从 python 的 zipfile 库中解压文件。</em></p></blockquote><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="91a7" class="np mr it oi b gy om on l oo op"><strong class="oi iu">import zipfile</strong></span><span id="2c31" class="np mr it oi b gy oq on l oo op">with zipfile.ZipFile('train_transaction.csv.zip', mode='r') as zip_ref:<br/>    zip_ref.extractall('data/')</span></pre><p id="c958" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建一个文件夹<code class="fe or os ot oi b">data</code>并在该文件夹中解压缩 CSV 文件<code class="fe or os ot oi b">train_transaction.csv</code>。</p><p id="ef70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用 pandas <code class="fe or os ot oi b">read_csv</code>方法将数据集加载到 Jupyter 笔记本中。</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="b7cf" class="np mr it oi b gy om on l oo op">%time trans = pd.read_csv('train_transaction.csv')</span><span id="1920" class="np mr it oi b gy oq on l oo op">df_size = trans.memory_usage().sum() / 1024**2<br/>print(f'Memory usage of dataframe is {df_size} MB')</span><span id="1f6c" class="np mr it oi b gy oq on l oo op">print (f'Shape of dataframe is {trans.shape}')</span><span id="db5d" class="np mr it oi b gy oq on l oo op">---- Output ----<br/>CPU times: user 23.2 s, sys: 7.87 s, total: 31 s<br/>Wall time: 32.5 s</span><span id="5e2b" class="np mr it oi b gy oq on l oo op">Memory usage of dataframe is 1775.1524047851562 MB<br/>Shape of dataframe is (590540, 394)</span></pre><p id="11e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据约为 1.5 GB，包含 50 多万行。</p><blockquote class="ob oc od"><p id="0c52" class="kz la no lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated"><strong class="lb iu">技巧二:<em class="it"> </em> </strong> <em class="it">我们将使用 fast_ml 中的一个函数来减少这种内存占用。</em></p></blockquote><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="cd6c" class="np mr it oi b gy om on l oo op"><strong class="oi iu">from fast_ml.utilities import reduce_memory_usage</strong></span><span id="4ad3" class="np mr it oi b gy oq on l oo op">%time trans = reduce_memory_usage(trans, convert_to_category=False)</span><span id="6705" class="np mr it oi b gy oq on l oo op">---- Output ----<br/>Memory usage of dataframe is 1775.15 MB<br/>Memory usage after optimization is: 542.35 MB<br/>Decreased by 69.4%</span><span id="ffea" class="np mr it oi b gy oq on l oo op">CPU times: user 2min 25s, sys: 2min 57s, total: 5min 23s<br/>Wall time: 5min 56s</span></pre><blockquote class="ou"><p id="4c0c" class="ov ow it bd ox oy oz pa pb pc pd lu dk translated">这一步花了将近 5 分钟，但是它将内存大小减少了将近 70%,这是一个相当显著的减少</p></blockquote><p id="ee1e" class="pw-post-body-paragraph kz la it lb b lc pe ju le lf pf jx lh li pg lk ll lm ph lo lp lq pi ls lt lu im bi translated">为了进一步分析，我们将创建一个包含 20 万条记录的样本数据集，这样我们的数据处理步骤就不会花费很长时间。</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="948b" class="np mr it oi b gy om on l oo op"><em class="no"># Take a sample of 200k records</em><br/>%time trans = trans.sample(n=200000)</span><span id="88d7" class="np mr it oi b gy oq on l oo op">#reset the index because now index would have shuffled<br/>trans.reset_index(inplace = True, drop = True)</span><span id="fdbd" class="np mr it oi b gy oq on l oo op">df_size = trans.memory_usage().sum() / 1024**2<br/>print(f'Memory usage of sample dataframe is <strong class="oi iu">{</strong>df_size<strong class="oi iu">}</strong> MB')</span><span id="63a8" class="np mr it oi b gy oq on l oo op">---- Output ----<br/>CPU times: user 1.39 s, sys: 776 ms, total: 2.16 s<br/>Wall time: 2.43 s<br/>Memory usage of sample dataframe is 185.20355224609375 MB</span></pre><p id="a8c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将把它保存在本地驱动器中— CSV 格式</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="81a6" class="np mr it oi b gy om on l oo op"><strong class="oi iu">import</strong> <strong class="oi iu">os</strong></span><span id="d735" class="np mr it oi b gy oq on l oo op">os.makedirs('data', exist_ok=True) trans.to_feather('data/train_transaction_sample')</span></pre><blockquote class="ob oc od"><p id="6f0d" class="kz la no lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated"><strong class="lb iu">技巧三:<em class="it"> </em> </strong> <em class="it">使用羽化格式代替 csv </em></p></blockquote><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="4bc5" class="np mr it oi b gy om on l oo op"><strong class="oi iu">import</strong> <strong class="oi iu">os</strong></span><span id="d0c2" class="np mr it oi b gy oq on l oo op">os.makedirs('data', exist_ok=True)<br/>trans.to_feather('data/train_transaction_sample')</span></pre><p id="a70f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦从这两个来源加载数据，您将会看到显著的性能改进。</p><p id="8125" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">加载保存的样本数据— CSV 格式</strong></p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="4495" class="np mr it oi b gy om on l oo op">%time trans = pd.read_csv('data/train_transaction_sample.csv')</span><span id="17cb" class="np mr it oi b gy oq on l oo op">df_size = tras.memory_usage().sum() / 1024**2<br/>print(f'Memory usage of dataframe is <strong class="oi iu">{</strong>df_size<strong class="oi iu">}</strong> MB')<br/>print (f'Shape of dataframe is <strong class="oi iu">{</strong>trans<strong class="oi iu">.</strong>shape<strong class="oi iu">}</strong>')</span><span id="8fac" class="np mr it oi b gy oq on l oo op">---- Output ----<br/>CPU times: user 7.37 s, sys: 1.06 s, total: 8.42 s<br/>Wall time: 8.5 s</span><span id="80c6" class="np mr it oi b gy oq on l oo op">Memory usage of dataframe is 601.1964111328125 MB<br/>Shape of dataframe is (200000, 394)</span></pre><p id="6cf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">加载保存的样本数据—羽毛格式</strong></p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="f3b6" class="np mr it oi b gy om on l oo op">%time trans = pd.read_feather('tmp/train_transaction_sample')</span><span id="c082" class="np mr it oi b gy oq on l oo op">df_size = trans.memory_usage().sum() / 1024**2<br/>print(f'Memory usage of dataframe is <strong class="oi iu">{</strong>df_size<strong class="oi iu">}</strong> MB')<br/>print (f'Shape of dataframe is <strong class="oi iu">{</strong>trans<strong class="oi iu">.</strong>shape<strong class="oi iu">}</strong>')</span><span id="9792" class="np mr it oi b gy oq on l oo op">---- Output ----<br/>CPU times: user 1.32 s, sys: 930 ms, total: 2.25 s<br/>Wall time: 892 ms</span><span id="de47" class="np mr it oi b gy oq on l oo op">Memory usage of dataframe is 183.67779541015625 MB<br/>Shape of dataframe is (200000, 394)</span></pre><h2 id="5bd9" class="np mr it bd ms nq nr dn mw ns nt dp na li nu nv nc lm nw nx ne lq ny nz ng oa bi translated">注意这里的两件事:</h2><p id="688c" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">I .加载 CSV 文件所花费的时间几乎是加载羽毛格式数据所花费时间的 10 倍。</p><p id="ec28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">二。加载的数据集的大小以羽化格式保留，而在 CSV 格式中，数据集再次消耗大量内存，我们将不得不再次运行 reduce_memory_usage 函数。</p><h1 id="d030" class="mq mr it bd ms mt pj mv mw mx pk mz na jz pl ka nc kc pm kd ne kf pn kg ng nh bi translated">感谢阅读！</h1><ul class=""><li id="3ddd" class="lv lw it lb b lc ni lf nj li po lm pp lq pq lu pr mb mc md bi translated">如果你喜欢这个，<a class="ae ky" href="https://medium.com/@samarth.agrawal.86" rel="noopener">在 medium </a>上跟随我了解更多。</li><li id="de82" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu pr mb mc md bi translated">你们的掌声对写更多、写得更好是一个巨大的鼓励和帮助。</li><li id="e028" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu pr mb mc md bi translated">有兴趣合作吗？我们在<a class="ae ky" href="https://www.linkedin.com/in/samarth-agrawal-2501/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上连线吧。</li><li id="2989" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu pr mb mc md bi translated">请随意写下您的想法/建议/反馈。</li><li id="1601" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu pr mb mc md bi translated">我们将使用我们创建的新样本数据集进行进一步分析。</li><li id="98f3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu pr mb mc md bi translated">我们将在下一篇文章中讨论探索性数据分析。</li><li id="407f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu pr mb mc md bi translated"><a class="ae ky" href="https://github.com/samarth-agrawal-86/kaggle-ieee-fraud" rel="noopener ugc nofollow" target="_blank"> Github 链接</a></li></ul></div></div>    
</body>
</html>