<html>
<head>
<title>Machine Learning deployment with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python进行机器学习部署</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-deployment-with-python-e64a37c3155a?source=collection_archive---------58-----------------------#2020-06-07">https://towardsdatascience.com/machine-learning-deployment-with-python-e64a37c3155a?source=collection_archive---------58-----------------------#2020-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c28bb663a6f22ac6773f54b4d26ac976.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U6N_ji0Ez8Ln0VzTUT2Mdg.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">鸣谢:L.J. Stroemsdoerfer(无艺术家)</p></figure><p id="0ad7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">机器学习部署绝对是现在的热门话题。我正准备用时下最热门的模因来支持我的第一句话，然而，我觉得业内的每个人都同意我的观点。有许多很酷的方法来部署和操作ML模型。然而，他们大多引入新的工具，使用他们自己的生态系统。这增加了一层新的复杂性，最终可能会产生锁定效应，因为您需要调整代码以最佳地适应平台。</p><p id="1b10" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">开源概念，比如Docker和Kubernetes在这个问题上给予了更多的自由，但是，使用起来非常复杂。因此，我构建了一个Python库，允许您在Kubernetes上专业化、测试和部署您的模型，但是您不必为此而离开Python。听起来好得难以置信？好吧，让我们看看你是怎么想的。</p><h1 id="c647" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">生产化图书馆</h1><p id="10b7" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">除了这个糟糕的包名——建议是非常受欢迎的——这个包允许你做一些漂亮的事情来简化和加速你的部署体验。</p><p id="256d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们先来看看名字朗朗上口的库是做什么的。</p><h2 id="17bc" class="md lb iq bd lc me mf dn lg mg mh dp lk kn mi mj lo kr mk ml ls kv mm mn lw mo bi translated">它是做什么的？</h2><p id="cf65" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">简单回答:它允许你在不离开Python的情况下容器化你的ML模型。最重要的是，它在您的机器上构建一个本地Kubernetes集群来测试容器化的模型是否工作正常。如果你在想，等等，我没有本地的Kubernetes集群，不要担心，我内置了一些函数来处理这个问题。让我们仔细看看。</p><p id="f9dd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要开始您的生产化之旅，您可以首先设置您的本地“工作台”,我称之为“工作台”。这是一个小型集群，带有Docker注册表，运行在您机器上的VM中。任何以前做过这种噱头的人都知道，这样做有点烦人。使用productionize，这是两行Python代码。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/e243735d0cd3a019cec53ff4962908d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FWWlzvIVJ_Y37HGO1QTVjA.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">生产化的工作流。</p></figure><p id="f11c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦这个“工作台”开始运行，productionize库就需要一个已经内置在API结构中的ML模型。为此，您可以使用Flask等工具，也可以使用其他工具。然而，我肯定会推荐Flask，因为我真的很喜欢它的轻量级方法。</p><p id="6f13" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有了几行Python代码，您就可以将API容器化，并将其部署到本地工作台中进行测试。如果一切正常，那么您可以将容器推送到您可能喜欢的任何Kubernetes集群。那么，让我们来看看代码。</p><h2 id="ab78" class="md lb iq bd lc me mf dn lg mg mh dp lk kn mi mj lo kr mk ml ls kv mm mn lw mo bi translated">你怎么能这样做？</h2><p id="2699" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">首先，您需要安装托管在PyPi上的库。我目前不支持康达，请原谅我。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="c22a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">之后，就可以导入库了。请注意，该库目前不支持Jupyter笔记本电脑，因为我没有使用Jupyter内核来设置虚拟机，Minikube集群和所有其他细节组件。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="4c92" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">该库包含两个主要的类。第一个是<code class="fe mw mx my mz b">workbench()</code>类，它负责在您的机器上完成所有这些令人惊奇的事情所需的工具。第二个是<code class="fe mw mx my mz b">product()</code>类，它处理你的API和它的容器化。</p><p id="f233" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们从设置工作台开始。<code class="fe mw mx my mz b">workbench()</code>类将为你安装、管理和卸载Docker、VirtualBox、Kubectl和Minikube。首先，我们初始化这个类。这将检查您的本地机器上的上述组件，并标记那些要安装的组件。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="d1c6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，我们可以安装缺少的组件，并对它们进行配置，使它们能够很好地相互协作。在接下来的步骤中，您可能需要输入您的sudo密码。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="e0f1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果这一步出错，我为此添加了一个调试方法。假设Minikube安装失败，您可以运行:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="823e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦设置步骤完成，您就可以启动工作台，这实际上启动了您机器上的Minikube集群。</p><p id="5cb0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来，您应该在工作台上创建一个项目，这会创建一个Kubernetes名称空间。我建议你这样做，这会在你的集群上产生一些秩序感。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="2f8d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您厌倦了您的工作台，您可以使用<code class="fe mw mx my mz b">stop_cluster()</code>方法轻松地停止集群，甚至可以使用<code class="fe mw mx my mz b">uninstall()</code>方法干净地删除所有不需要的组件。</p><p id="b88d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在让我们继续学习<code class="fe mw mx my mz b">product()</code>课程。这个类将您的ML API转换成一个容器，并将其部署到工作台。首先，我们必须初始化这个类:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="52e4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您现在可以准备部署了，这实际上将创建一个Dockerfile文件。我添加了这个中间步骤，以便您可以根据需要编辑Dockerfile文件。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="cfc8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">无论您是否编辑了docker文件，现在都可以使用<code class="fe mw mx my mz b">deploy()</code>方法将它部署到本地工作台。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="2dc8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这将在Minikube注册表上创建Docker映像，使用您的容器部署一个pod，并将服务公开给外部。在<code class="fe mw mx my mz b">deploy()</code>方法的输出中，您会找到指向您的API的链接。你可以用它来测试你的模型是否工作正常。如果是的话，你可以把它推到任何你想要的Kubernetes集群。您可以使用<code class="fe mw mx my mz b">push_product()</code>方法并传递您的Kubernetes集群的注册表链接来实现。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="792c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">好吧，那是很多。我知道这个结构有点复杂，所以又总结了一遍。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/3eb88f7c31a8eb0a04d2c4990d1d3298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CCFt9DhO8vydzDSMWY1oRw.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">将工作流程生产化到最佳状态。</p></figure><p id="a000" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">GitHub和PyPi上有更多的信息和文档。你可以去看看。此外，当然还有一些有趣的复活节彩蛋。</p><h2 id="0ab9" class="md lb iq bd lc me mf dn lg mg mh dp lk kn mi mj lo kr mk ml ls kv mm mn lw mo bi translated">下一步是什么？</h2><p id="b616" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">正如你所看到的，这个库提供了一些不错的特性，但是，它还远远没有完成。目前，productionize只在macOS上运行。这是因为我使用家酿作为主要的软件包管理器。我已经在为Ubuntu开发一个版本了。任何linux发行版都是可管理的，然而，Windows将是一个相当大的挑战。因此，如果你有建议或想法，请让我知道。此外，如果你给我一个关于<a class="ae nb" href="https://github.com/LJStroemsdoerfer/productionize" rel="noopener ugc nofollow" target="_blank">https://github.com/LJStroemsdoerfer/productionize</a>的问题，我会非常乐意处理任何bug。</p></div></div>    
</body>
</html>