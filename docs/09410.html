<html>
<head>
<title>Building an Investing Model with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 构建投资模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-an-investing-model-with-python-44d779adb6bf?source=collection_archive---------35-----------------------#2020-07-05">https://towardsdatascience.com/building-an-investing-model-with-python-44d779adb6bf?source=collection_archive---------35-----------------------#2020-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="31ee" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用 Python 构建基于财务比率的模型</h2></div><p id="ff76" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将使用 Python 建立一个投资模型，根据财务比率找出有吸引力的股票。我们将筛选纳斯达克交易所的所有科技股。然后，我们将<strong class="kh ir">得到每只股票的主要财务比率</strong>。最后，基于一个定制的排名标准，我们将建立一个模型来寻找最有吸引力的股票。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/397e03b3609393d54d6c1ed1cbcfb036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*7erleB-h9bp6jK9_TIJIwg.jpeg"/></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">照片由<a class="ae ln" href="https://www.pexels.com/@burst?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> <strong class="bd lo">突发</strong> </a>发自<a class="ae ln" href="https://www.pexels.com/photo/1-wtc-america-architecture-buildings-374710/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> <strong class="bd lo">像素</strong> </a></p></figure><p id="a371" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从构建投资模型的 Python 代码开始:</p><h1 id="4d66" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">使用 Python 的投资模型</h1><p id="28a0" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">在我之前的帖子中，我将使用<a class="ae ln" href="https://financialmodelingprep.com/" rel="noopener ugc nofollow" target="_blank">financialmodelingprep API</a>，它在注册后每月提供一些免费的 API 调用。以下是我们根据财务比率构建投资模型时将遵循的主要步骤:</p><ol class=""><li id="c354" class="mm mn iq kh b ki kj kl km ko mo ks mp kw mq la mr ms mt mu bi translated">向财务 API 发出<em class="mv"> Get </em>请求，以<strong class="kh ir">提取在纳斯达克交易的所有公司的股票</strong>并满足我们的选择标准(即科技行业和大于特定规模)</li><li id="098e" class="mm mn iq kh b ki mw kl mx ko my ks mz kw na la mr ms mt mu bi translated">遍历第 1 点筛选的每个公司，并<strong class="kh ir">提取财务比率</strong></li><li id="3947" class="mm mn iq kh b ki mw kl mx ko my ks mz kw na la mr ms mt mu bi translated">将每个公司的每个比率添加到一个 Python 字典中，然后<strong class="kh ir">创建一个熊猫数据框架</strong></li><li id="19e9" class="mm mn iq kh b ki mw kl mx ko my ks mz kw na la mr ms mt mu bi translated"><strong class="kh ir">建立一个投资模型排名标准</strong>并根据我们的模型列出最有吸引力的股票</li></ol><h1 id="6c7a" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">1.提取纳斯达克代码</h1><p id="93c7" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">正如我在以前的一篇文章中所提到的(例如，如何找到高股息股票)，我们将提取在纳斯达克交易的公司股票并将其添加到一个 Python 列表中。请注意，您将需要在<em class="mv"> financialmodelingprep </em>中创建一个帐户，以便每天获得一些免费的 API 调用。</p><p id="d58c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个好主意，选择在同一个部门和类似的规模经营的公司。这将确保这些公司之间可以进行比较。因此，我们选择市值超过 100 亿美元的科技公司。</p><pre class="lc ld le lf gt nb nc nd ne aw nf bi"><span id="3ed4" class="ng lq iq nc b gy nh ni l nj nk">import requests<br/>import pandas as pd</span><span id="b3af" class="ng lq iq nc b gy nl ni l nj nk">companies = []<br/>demo = 'your api key'</span><span id="4955" class="ng lq iq nc b gy nl ni l nj nk">marketcap = str(1000000000)</span><span id="647f" class="ng lq iq nc b gy nl ni l nj nk">url = (f'<a class="ae ln" href="https://financialmodelingprep.com/api/v3/stock-screener?marketCapMoreThan={marketcap}&amp;betaMoreThan=1&amp;volumeMoreThan=10000&amp;sector=Technology&amp;exchange=NASDAQ&amp;dividendMoreThan=0&amp;limit=1000&amp;apikey={demo}'" rel="noopener ugc nofollow" target="_blank">https://financialmodelingprep.com/api/v3/stock-screener?marketCapMoreThan={marketcap}&amp;betaMoreThan=1&amp;volumeMoreThan=10000&amp;sector=Technology&amp;exchange=NASDAQ&amp;dividendMoreThan=0&amp;limit=1000&amp;apikey={demo}'</a>)</span><span id="0ab0" class="ng lq iq nc b gy nl ni l nj nk">#get companies based on criteria defined about<br/>screener = requests.get(url).json()<br/>print(screener)</span><span id="7cea" class="ng lq iq nc b gy nl ni l nj nk">[{'symbol': 'AAPL', 'companyName': 'Apple Inc.', 'marketCap': 1526030790000, 'sector': 'Technology', 'beta': 1.228499, 'pri<br/>ce': 352.08, 'lastAnnualDividend': 3.08, 'volume': 42532806, 'exchange': 'Nasdaq Global Select', 'exchangeShortName': 'NASD<br/>AQ'}, {'symbol': 'MSFT', 'companyName':....</span></pre><h1 id="d0db" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">2.纳斯达克公司的财务比率</h1><p id="5840" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">接下来，我们从上一节获得的纳斯达克公司中提取所有财务比率。对于我们的投资模型，我们将使用以下选定的财务比率。</p><pre class="lc ld le lf gt nb nc nd ne aw nf bi"><span id="0b28" class="ng lq iq nc b gy nh ni l nj nk">add selected companies to a list<br/>for item in screener:<br/> companies.append(item['symbol'])<br/> <br/>#print(companies)</span><span id="10c2" class="ng lq iq nc b gy nl ni l nj nk">value_ratios ={}<br/>#get the financial ratios<br/>count = 0<br/>for company in companies:<br/> try:<br/>  if count &lt;30:<br/>   count = count + 1<br/>   fin_ratios = requests.get(f'<a class="ae ln" href="https://financialmodelingprep.com/api/v3/ratios/{company}?apikey={demo}').json()" rel="noopener ugc nofollow" target="_blank">https://financialmodelingprep.com/api/v3/ratios/{company}?apikey={demo}').json()</a><br/>   value_ratios[company] = {}<br/>   value_ratios[company]['ROE'] = fin_ratios[0]['returnOnEquity']<br/>   value_ratios[company]['ROA'] = fin_ratios[0]['returnOnAssets']<br/>   value_ratios[company]['Debt_Ratio'] = fin_ratios[0]['debtRatio']<br/>   value_ratios[company]['Interest_Coverage'] = fin_ratios[0]['interestCoverage']<br/>   value_ratios[company]['Payout_Ratio'] = fin_ratios[0]['payoutRatio']<br/>   value_ratios[company]['Dividend_Payout_Ratio'] = fin_ratios[0]['dividendPayoutRatio']<br/>   value_ratios[company]['PB'] = fin_ratios[0]['priceToBookRatio']<br/>   value_ratios[company]['PS'] = fin_ratios[0]['priceToSalesRatio']<br/>   value_ratios[company]['PE'] = fin_ratios[0]['priceEarningsRatio']<br/>   value_ratios[company]['Dividend_Yield'] = fin_ratios[0]['dividendYield']<br/>   value_ratios[company]['Gross_Profit_Margin'] = fin_ratios[0]['grossProfitMargin']<br/>   #more financials on growth:<a class="ae ln" href="https://financialmodelingprep.com/api/v3/financial-growth/AAPL?apikey=demo" rel="noopener ugc nofollow" target="_blank">https://financialmodelingprep.com/api/v3/financial-growth/AAPL?apikey=demo</a><br/>   growth_ratios = requests.get(f'<a class="ae ln" href="https://financialmodelingprep.com/api/v3/financial-growth/{company}?apikey={demo}').json()" rel="noopener ugc nofollow" target="_blank">https://financialmodelingprep.com/api/v3/financial-growth/{company}?apikey={demo}').json()</a><br/>   value_ratios[company]['Revenue_Growth'] = growth_ratios[0]['revenueGrowth']<br/>   value_ratios[company]['NetIncome_Growth'] = growth_ratios[0]['netIncomeGrowth']<br/>   value_ratios[company]['EPS_Growth'] = growth_ratios[0]['epsgrowth']<br/>   value_ratios[company]['RD_Growth'] = growth_ratios[0]['rdexpenseGrowth']<br/>        <br/> except:<br/>  pass<br/>print(value_ratios)</span></pre><p id="4ca1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，我们已经包含了一个<em class="mv"> if 语句</em>,将模型中包含的公司数量限制为 30 家。请随意取消这一限制。</p><p id="d2a7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是我们获得的回复样本，包含我们所有纳斯达克公司的财务比率列表。我们已经将它们添加到 Python 字典中，以便能够轻松地访问它们。</p><pre class="lc ld le lf gt nb nc nd ne aw nf bi"><span id="1b87" class="ng lq iq nc b gy nh ni l nj nk">Value Ratio Dictionary outcome:<br/>{'AAPL': {'ROE': 0.6106445053487756, 'ROA': 0.16323009842961633, 'Debt_Ratio': 0.7326921031797611, 'Interest_Coverage': 18.382829977628635, 'Payout_Ratio': 0.25551976255972203, 'Dividend_Payout_Ratio': 0.25551976255972203, 'PB': 12.709658271815046, 'PS': 4.420393881402446, 'PE': 20.81351450883162, 'Dividend_Yield': 0.012276627402416805, 'Gross_Profit_Margin': 0.3781776810903472, 'Revenue_Growth': -0.020410775805267418, 'NetIncome_Growth': -0.07181132519191681, 'EPS_Growth': -0.003330557868442893, 'RD_Growth': 0.1391542568137117}, 'MSFT': {'ROE': 0.3834652594547054, 'ROA': 0.13693658482111698, 'Debt_Ratio': 0.6428970253632798, 'Interest_Coverage': 5.881980640357408, 'Payout_Ratio':0.35196228338430174, 'Dividend_Payout_Ratio': 0.3519622833843017, 'PB': 10.52384979966774, 'PS': 8.557532401484389, 'PE': 27.444076197757386, 'Dividend_Yield': 0.012824708722134454, 'Gross_Profit_Marg</span></pre><h1 id="fdc8" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">3.创建包含财务比率的熊猫数据框架</h1><p id="f667" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">下一步，我们将把 Python 字典转换成熊猫数据帧。这样做的原因很简单，就是从 Pandas 提供的处理我们的数据的所有优秀功能中受益:</p><pre class="lc ld le lf gt nb nc nd ne aw nf bi"><span id="8571" class="ng lq iq nc b gy nh ni l nj nk">DF = pd.DataFrame.from_dict(value_ratios,orient='index')<br/>print(DF.head(4))</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/09f4ec0902959ef5c9fbb921b0549fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zu3oTzB53vtAzwbrzyDY4w.png"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">具有财务比率的数据框架</p></figure><h1 id="e8da" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">4.创建我们的排名投资模型</h1><p id="3404" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">到目前为止，我们已经成功地将选定的纳斯达克公司的所有财务比率添加到 Pandas 数据框架中。</p><p id="dfab" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在是时候创建我们的投资模型，将股票从更有吸引力到不太有吸引力进行排序。排名标准完全取决于我们。我建议每个财务比率的排名标准如下。请根据您的喜好随意更改它们。</p><p id="4beb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正数表示该比率是一个好兆头。数字越大，该比率在我们的投资模型中的相关性就越强。例如，ROE(股本回报率)将比 ROA(资产回报率)有更大的影响，因为 1.2 大于 1.1。</p><p id="110d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，负数会降低股票的吸引力。例如，较高的市净率(PB)可能表明公司被高估。所以我给 PB 比分配了一个负数。</p><p id="8125" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想<a class="ae ln" href="https://codingandfun.com/?s=financial+ratios" rel="noopener ugc nofollow" target="_blank">了解更多关于财务比率的知识</a>，请看看我之前的一些解释了其中大部分的帖子。</p><pre class="lc ld le lf gt nb nc nd ne aw nf bi"><span id="eddb" class="ng lq iq nc b gy nh ni l nj nk">#criteria ranking<br/>ROE = 1.2<br/>ROA = 1.1<br/>Debt_Ratio = -1.1<br/>Interest_Coverage = 1.05<br/>Dividend_Payout_Ratio = 1.01<br/>PB = -1.10<br/>PS = -1.05<br/>Revenue_Growth = 1.25<br/>Net_Income_Growth = 1.10</span></pre><p id="4f47" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，在计算我们的排名之前，我们需要将财务比率标准化，以便进行比较:</p><pre class="lc ld le lf gt nb nc nd ne aw nf bi"><span id="3f4e" class="ng lq iq nc b gy nh ni l nj nk">#mean to enable comparison across ratios<br/>ratios_mean = []<br/>for item in DF.columns:<br/> ratios_mean.append(DF[item].mean())</span><span id="27bf" class="ng lq iq nc b gy nl ni l nj nk">#divide each value in dataframe by mean to normalize values<br/>DF = DF / ratios_mean</span></pre><p id="5f3b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了，我们快到了。最后一步是在我们的 Pandas 数据框架中添加一个新列，包含排名因子:</p><pre class="lc ld le lf gt nb nc nd ne aw nf bi"><span id="db06" class="ng lq iq nc b gy nh ni l nj nk">DF['ranking'] = DF['NetIncome_Growth']*Net_Income_Growth + DF['Revenue_Growth']*Revenue_Growth  + DF['ROE']*ROE + DF['ROA']*ROA + DF['Debt_Ratio'] * Debt_Ratio + DF['Interest_Coverage'] * Interest_Coverage + DF['Dividend_Payout_Ratio'] * Dividend_Payout_Ratio + DF['PB']*PB + DF['PS']*PS</span></pre><p id="0418" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们可以简单地打印数据框架，包括我们投资模型中每只股票的排名因子:</p><pre class="lc ld le lf gt nb nc nd ne aw nf bi"><span id="1d11" class="ng lq iq nc b gy nh ni l nj nk">print(DF.sort_values(by=['ranking'],ascending=False))</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/c1e6450a54203e42765bf261e1779459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Kbe_2pvW5QURPUAweMqAg.png"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">使用 Python 的投资模型</p></figure><p id="0d00" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从上图中我们可以看到，根据我们选择的标准，我们的投资模型预测<em class="mv"> CSCO </em>将是投资的最佳股票，得分为 48 分。当然，这只是一个模型，在投入资金之前，需要对股票进行进一步的分析。</p><h1 id="b916" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">包扎</h1><p id="804e" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">我们在这篇文章中已经谈了很多。我们创建了一个基于关键财务比率和定制排名因子的投资模型。</p><p id="25cb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种投资模型特别有助于初步确定一些潜在的好投资，以便我们对它们进行重点分析。例如，我们可以更深入地分析一些排名最佳的公司的财务比率。我们可以应用<a class="ae ln" href="https://codingandfun.com/analyze-a-firm-roe-with-python/" rel="noopener ugc nofollow" target="_blank">杜邦方法来分析净资产收益率</a>。或者<a class="ae ln" href="https://codingandfun.com/gordon-growth-model-valuing-a-company-with-python/" rel="noopener ugc nofollow" target="_blank">用戈登增长模型</a>对公司进行估值。</p><p id="2594" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我想强调的使用财务比率的一个限制是，<strong class="kh ir">财务比率大多是使用最新可用的公开数据</strong>计算的。因此，如果一家公司的财务数据是 3 个月前发布的，那么使用资产负债表或损益表数据的财务比率可能已经过时。尤其是如果发生了影响公司运营的重大事件。</p></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><p id="6cd2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="mv">来自《走向数据科学》编辑的提示:</em> </strong> <em class="mv">虽然我们允许独立作者根据我们的</em> <a class="ae ln" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="mv">规则和指南</em> </a> <em class="mv">发表文章，但我们并不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae ln" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="mv">读者术语</em> </a> <em class="mv">。</em></p></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><p id="9e89" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mv">原载于 2020 年 7 月 5 日 https://codingandfun.com</em><a class="ae ln" href="https://codingandfun.com/building-an-investing-model-using-financial-ratios-and-python/" rel="noopener ugc nofollow" target="_blank"><em class="mv"/></a><em class="mv">。</em></p></div></div>    
</body>
</html>