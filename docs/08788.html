<html>
<head>
<title>Secure Collaborative XGBoost on Encrypted Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加密数据上的安全协作XGBoost</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/secure-collaborative-xgboost-on-encrypted-data-ac7bc0ec7741?source=collection_archive---------61-----------------------#2020-06-24">https://towardsdatascience.com/secure-collaborative-xgboost-on-encrypted-data-ac7bc0ec7741?source=collection_archive---------61-----------------------#2020-06-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="83b2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个使用安全飞地进行多方训练和XGBoost模型推理的库</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5bcdec7f0273744754c8d1d348a9c4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YDVMWHTJA06-axuqtl-F0g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kv" href="/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片(已修改)。</p></figure><blockquote class="kw kx ky"><p id="6708" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">TL；DR: </strong>在加州大学伯克利分校的<a class="ae kv" href="https://rise.cs.berkeley.edu/" rel="noopener ugc nofollow" target="_blank"> RISE实验室</a>，我们一直在构建<a class="ae kv" href="https://github.com/mc2-project/secure-xgboost" rel="noopener ugc nofollow" target="_blank"> Secure XGBoost </a>，这是一个支持<strong class="lc ir">协作</strong><a class="ae kv" href="https://xgboost.ai/" rel="noopener ugc nofollow" target="_blank"><strong class="lc ir">XGBoost</strong></a><strong class="lc ir">对<em class="iq"> </em>加密数据</strong>进行训练和推理的库。为了便于使用，我们提供了一个与XGBoost几乎相同的Python API，只是增加了一些集成安全性。Secure XGBoost是<a class="ae kv" href="https://github.com/mc2-project/mc2" rel="noopener ugc nofollow" target="_blank"> umbrella MC项目</a>的一部分，在这个项目下，我们正在开发各种保护隐私的机器学习工具。</p><p id="1f4c" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">特别是，Secure XGBoost有助于<strong class="lc ir">安全的协作学习</strong><em class="iq"/>——相互不信任的数据所有者可以在他们的数据上联合训练一个模型，但不会向彼此透露他们的数据。安全协作学习是一种强大的范式，可能是开启更具弹性和稳健模型的关键。我们一直在与行业中的一些团队合作，包括丰业银行和蚂蚁金服，以部署Secure XGBoost来努力实现反洗钱和欺诈检测。</p></blockquote></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="31e9" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">动机</h1><p id="50b5" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">训练机器学习模型需要大量高质量的数据。实现这一点的一种方法是组合来自许多不同数据组织或数据所有者的数据。但是，出于隐私方面的考虑，数据所有者通常不愿意彼此共享他们的数据，这可能源于商业竞争，也可能是法规遵从性的问题。</p><p id="36d0" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">问题是:我们如何减轻这样的隐私问题？</p><p id="ee44" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">安全的协作学习使许多数据所有者能够<strong class="lc ir">在他们的集体数据上建立稳健的模型，但不会相互泄露他们的数据</strong>。银行可以合作开展反洗钱工作，同时保持客户数据的私密性。医疗保健机构可以将他们的患者数据集中在一起，并在医学研究方面进行合作。可能性是巨大的，充满希望的。</p><h1 id="9d73" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">安全XGBoost简介</h1><p id="81e6" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">作为朝着这个方向迈出的一步，我们很高兴推出<a class="ae kv" href="https://github.com/mc2-project/secure-xgboost" rel="noopener ugc nofollow" target="_blank"> Secure XGBoost </a>，这是一个支持<strong class="lc ir">协作</strong> <a class="ae kv" href="https://xgboost.ai/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ir"> XGBoost </strong> </a> <strong class="lc ir">对加密数据</strong>进行训练和推理的库。简而言之，多个客户端(或数据所有者)可以使用这个库，在云环境中基于他们的集体数据联合训练一个XGBoost模型，同时保护他们个人数据的隐私。虽然我们在本文的其余部分关注协作学习，但是Secure XGBoost也支持那些只是想将计算外包给云，但不想以纯文本形式将数据暴露给云的人。</p><p id="6a1d" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">在其核心部分，Secure XGBoost使用<strong class="lc ir">安全飞地</strong>(如英特尔SGX)来保护数据，即使是在充满敌意的云环境中。也就是说，即使培训在云中运行，每个客户端的数据仍然对云提供商和其他客户端隐藏。客户端远程编排训练管道<em class="lb">，但是<em class="lb">协作</em>，并且安全XGBoost保证每个客户端保留对其自身数据的控制。</em></p><h1 id="faca" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">安全的飞地</h1><p id="d619" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">安全区域是计算机处理器技术的最新进展，它允许在不可信的机器上创建安全的内存区域(称为区域)。放置在enclave中的任何数据或软件都与系统的其余部分隔离开来。同一处理器上的任何其他进程都不能访问该内存，即使是操作系统或虚拟机管理程序等特权软件也不能。secure enclave技术的示例包括英特尔SGX、AWS Nitro Enclaves、ARM TrustZone和AMD内存加密。</p><p id="8ed5" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">此外，enclaves通常支持一个名为<em class="lb">远程证明</em>的特性。该特性使客户端能够以加密方式验证云中的enclave正在运行可信的、未经修改的代码。</p><p id="7f30" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">Secure XGBoost构建于<a class="ae kv" href="https://openenclave.io/sdk/" rel="noopener ugc nofollow" target="_blank"> Open Enclave SDK </a>之上，这是一个开源SDK，提供了跨不同Enclave技术的单一统一抽象。Open Enclave的使用使我们的库能够兼容许多不同的Enclave后端，如英特尔SGX和OP-TEE。</p><h1 id="eb30" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">减轻旁道攻击</h1><p id="3a63" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">在飞地之上，Secure XGBoost增加了第二层安全，额外保护数据和计算免受飞地上的大类攻击。</p><p id="a129" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">研究人员已经表明，攻击者可能能够通过利用<a class="ae kv" href="https://en.wikipedia.org/wiki/Side-channel_attack" rel="noopener ugc nofollow" target="_blank">辅助泄漏源</a>(或“旁道”)了解SGX飞地内数据的敏感信息，即使他们无法直接观察数据。存储器访问模式就是这种旁路的一个例子。</p><p id="7898" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">在Secure XGBoost中，我们设计并实现了用于模型训练和推理的<strong class="lc ir">数据无关算法</strong>。在高层次上，我们的算法产生相同的存储器访问序列，而不管输入数据如何。因此，内存访问模式不会向攻击者透露任何有关底层数据的信息。</p><p id="4759" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">然而，额外的安全性是以牺牲性能为代价的。如果这种攻击超出了用户的威胁模型，他们可以禁用这种额外的保护。</p><h1 id="6887" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">系统结构</h1><p id="0e3d" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">安全XGBoost的部署由以下实体组成:(I)多个数据所有者(或客户),他们希望在他们各自的数据上协作训练模型；以及(ii)在飞地机器集群中托管安全XGBoost平台的不可信云服务。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/8c49f20846c019b7ed74c7acfefc0235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tmNlGRhl9nG3QQrB"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">安全XGBoost:架构</p></figure><ul class=""><li id="6c4c" class="nj nk iq lc b ld le lg lh mx nl mz nm nb nn lv no np nq nr bi translated"><strong class="lc ir">嫖客。</strong>客户是指与其他客户一起参与协作学习过程的数据所有者。客户端通过远程调用其API在安全的XGBoost平台上共同执行计算管道。</li><li id="9b97" class="nj nk iq lc b ld ns lg nt mx nu mz nv nb nw lv no np nq nr bi translated"><strong class="lc ir">有飞地的云服务。</strong>云服务由一个虚拟机集群组成，每个虚拟机在一个安全的飞地中托管安全的XGBoost。在训练和推理过程中，Secure XGBoost将计算分布在飞地集群中。飞地通过TLS通道相互通信，TLS通道在飞地内部开始和结束。云还托管一个不受信任的orchestrator服务。orchestrator协调客户机和部署在enclaves中的安全XGBoost平台之间的通信。</li></ul><h1 id="a685" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">工作流程</h1><p id="ee06" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">每个客户端将它们的加密数据上传到云服务，然后共同调用安全的XGBoost API来处理它们的数据。端到端示例工作流如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/9551cc36c76f7d49526851c7b69a1dbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Y1S2bPzKyvAU6AScoMOczw.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">安全XGBoost:工作流</p></figure><ol class=""><li id="3403" class="nj nk iq lc b ld le lg lh mx nl mz nm nb nn lv ny np nq nr bi translated"><strong class="lc ir">客户端认证云上的enclave</strong>(通过enclave的远程认证程序)以验证预期的安全XGBoost代码已经安全地加载到每个enclave中。作为证明的一部分，他们从飞地接收一个公钥pk。每个客户端生成一个对称密钥<em class="lb"> k_i </em>，使用<em class="lb"> pk </em>对其进行加密，并将其发送到Secure XGBoost。</li><li id="ba04" class="nj nk iq lc b ld ns lg nt mx nu mz nv nb nw lv ny np nq nr bi translated"><strong class="lc ir">客户端上传加密数据到云存储</strong>。每个客户端用他们的对称密钥k_i加密数据，并上传到云存储。</li><li id="d0f2" class="nj nk iq lc b ld ns lg nt mx nu mz nv nb nw lv ny np nq nr bi translated">客户端共同协调数据处理。客户端同意预先确定的<em class="lb">命令</em>(一个命令是一个XGBoost API调用)序列，这些命令将在它们的数据上联合执行。客户端提交<em class="lb">一个签名的命令</em>给orchestrator，orchestrator将其转发给Secure XGBoost。命令的结果(例如，加密的训练模型或加密的预测结果)被返回给客户端。</li></ol><p id="e9a4" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">该过程继续，直到所有命令都被执行。</p><h1 id="7039" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">用户API</h1><p id="766f" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">从用户的角度来看，上面工作流的所有复杂性都被抽象到了库中，使用这个库非常简单。在很大程度上，Secure XGBoost保留了常规XGBoost公开的API，只需要很少的添加就可以在enclaves的多方设置中工作。</p><p id="123a" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">假设每个客户端都已经将它们的加密数据上传到了云服务器，这里有一个客户端如何使用Secure XGBoost的例子。</p><ol class=""><li id="f52a" class="nj nk iq lc b ld le lg lh mx nl mz nm nb nn lv ny np nq nr bi translated">每个客户端首先初始化它们的密钥，并连接到云中的安全XGBoost部署。</li></ol><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="813e" class="oe me iq oa b gy of og l oh oi">import securexgboost as xgb</span><span id="6e31" class="oe me iq oa b gy oj og l oh oi">xgb.init_client(user1,<br/>                symmetric_key,<br/>                public_key,<br/>                certificate,<br/>                server_addr)</span></pre><p id="b9a7" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">2.接下来，每个客户端验证enclaves，以验证它们正在运行真实的、未经修改的安全XGBoost代码。</p><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="31c1" class="oe me iq oa b gy of og l oh oi">xgb.attest()</span></pre><p id="a793" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">然后，客户端调用安全的XGBoost APIs。这些与普通的XGBoost非常相似，在支持多个数据所有者方面略有不同。</p><p id="b4a2" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">3.将来自不同数据所有者的数据加载到服务器的单个“数据矩阵”中。</p><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="05f6" class="oe me iq oa b gy of og l oh oi">dtrain = xgb.DMatrix({user1: “/path/to/data/on/server”,<br/>                      user2: “/user2/data/on/server”})</span></pre><p id="0e49" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">4.根据加载的数据训练模型。</p><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="a486" class="oe me iq oa b gy of og l oh oi">params = {"tree_method": "hist",<br/>          "objective": "binary:logistic",<br/>          "min_child_weight": "1",<br/>          "gamma": "0.1",<br/>          "max_depth": "3"}</span><span id="2d6f" class="oe me iq oa b gy oj og l oh oi">num_rounds = 5</span><span id="50b9" class="oe me iq oa b gy oj og l oh oi">booster = xgb.train(params, dtrain, num_rounds)</span></pre><p id="c31a" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">5.使用模型运行预测。Secure XGBoost发送加密的结果，这些结果在客户机上本地解密。</p><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="6400" class="oe me iq oa b gy of og l oh oi">dtest = xgb.DMatrix({username: “path/to/data/on/server”})</span><span id="1edd" class="oe me iq oa b gy oj og l oh oi">predictions, num_preds = booster.predict(dtest)</span></pre><h1 id="d620" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">应用程序</h1><p id="04a1" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">在过去的几个月里，我们一直在与行业中的几个团队合作，包括加拿大丰业银行、爱立信和蚂蚁金服，以开发和部署安全的XGBoost。特别是，我们正在努力使用Secure XGBoost进行反洗钱、欺诈检测和信用风险建模。</p><h1 id="3926" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">资源</h1><p id="719c" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">我们对这个项目的方向及其潜在的应用感到非常兴奋。代码库是开源的。要开始，请查看我们在Github 上的项目页面<a class="ae kv" href="https://github.com/mc2-project/secure-xgboost" rel="noopener ugc nofollow" target="_blank">。如果您想进一步了解该项目或有任何疑问，请</a><a class="ae kv" href="https://github.com/mc2-project/secure-xgboost/issues" rel="noopener ugc nofollow" target="_blank">提出问题</a>或通过以下方式联系我们:</p><ul class=""><li id="f9f2" class="nj nk iq lc b ld le lg lh mx nl mz nm nb nn lv no np nq nr bi translated">里沙卜·波德达尔&lt;<a class="ae kv" href="mailto:rishabhp@eecs.berkeley.edu" rel="noopener ugc nofollow" target="_blank">rishabhp@eecs.berkeley.edu</a>T16】</li><li id="fd37" class="nj nk iq lc b ld ns lg nt mx nu mz nv nb nw lv no np nq nr bi translated">wzheng@eecs.berkeley.edu郑文婷&lt;<a class="ae kv" href="mailto:wzheng@eecs.berkeley.edu" rel="noopener ugc nofollow" target="_blank">T17】</a></li><li id="b92f" class="nj nk iq lc b ld ns lg nt mx nu mz nv nb nw lv no np nq nr bi translated">梁志成&lt;<a class="ae kv" href="mailto:chester@eecs.berkeley.edu" rel="noopener ugc nofollow" target="_blank">chester@eecs.berkeley.edu</a>T18】</li></ul><p id="a18a" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">Secure XGBoost是<a class="ae kv" href="https://github.com/mc2-project/mc2" rel="noopener ugc nofollow" target="_blank"> umbrella MC项目</a>的一部分，在这个项目下，我们正在开发各种保护隐私的机器学习工具。请查看我们的项目页面获取更新。</p><h1 id="ae50" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">作者</h1><p id="72ff" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">里沙布·波德达尔、切斯特·梁、郑文婷、拉卢卡·阿达·波帕和扬·斯托伊察(<em class="lb">里塞拉布，加州大学伯克利分校)</em></p><p id="3a5b" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated"><strong class="lc ir"> <em class="lb">来自《走向数据科学》编辑的提示:</em> </strong> <em class="lb">虽然我们允许独立作者根据我们的</em> <a class="ae kv" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="lb">规则和指导方针</em> </a> <em class="lb">发表文章，但我们并不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae kv" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="lb">读者术语</em> </a> <em class="lb">。</em></p></div></div>    
</body>
</html>