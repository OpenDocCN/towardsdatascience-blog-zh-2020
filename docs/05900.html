<html>
<head>
<title>Predict user churn for Sparkify (a digital music service)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测 Sparkify(一种数字音乐服务)的用户流失</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-churn-for-sparkify-a-music-streaming-service-59f2fd46b3a6?source=collection_archive---------62-----------------------#2020-05-14">https://towardsdatascience.com/predicting-churn-for-sparkify-a-music-streaming-service-59f2fd46b3a6?source=collection_archive---------62-----------------------#2020-05-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8fcc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用 PySpark 构建客户流失预测模型。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/762ee2c46b61c707ee26cfb7a7dd8488.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l6ukY_v43LK9LB9fjV2f0g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Sparkify 是由 Udacity 创建的虚拟音乐流媒体服务</p></figure><p id="8725" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Sparkify 是一种虚构的数字音乐服务，由 Udacity 创建，旨在模拟 Spotify 或 Pandora 等现实世界的公司。在 Sparkify 上，用户可以播放免费计划或高级订阅计划的歌曲，这些计划提供了高级功能，并且没有广告。用户可以随时升级、降级或取消他们的服务。每当用户与服务交互时都会生成数据，包括播放歌曲、将歌曲添加到播放列表、用拇指向上或向下对歌曲进行评级、添加朋友、登录或注销、升级或降级等。根据经验，获得一个新客户比保留一个现有客户的成本更高，保持客户满意并识别那些有取消服务风险的用户是服务公司的高优先级任务。</p><p id="9182" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，这个项目的目的是分析用户活动日志，并建立一个分类器来识别有可能流失的用户——取消了 Sparkify 音乐流媒体服务。此外，考虑到现实压倒性的流数据，我只使用完整 Sparkify 数据(12GB)的一小部分数据(98MB)进行数据探索和模型开发。最终的模型是使用 Spark 构建的，因此它可以扩展到在分布式集群环境中运行。</p><h1 id="deed" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">用户为什么会流失？</h1><p id="80bb" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">在假设中，用户有更多的互动与更少的摩擦应该是满意和积极的。因此，我们首先要考虑的是数据，churns 用户的行为是否与现有用户不同？</p><p id="dba8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在开始回答业务问题之前，让我们探索一下日志中有哪些内容。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mo"><img src="../Images/d8027ef47959cf2804563d15a6f9e208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9q6miPCNHsjcaVC9y0XhWQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">原始数据样本</p></figure><p id="b64a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这里，我描述了我将用于切片和切块的主要功能:</p><ul class=""><li id="8627" class="mp mq iq kx b ky kz lb lc le mr li ms lm mt lq mu mv mw mx bi translated"><strong class="kx ir"> <em class="my"> userId </em> </strong>:用户标识符</li><li id="541c" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq mu mv mw mx bi translated"><strong class="kx ir"> <em class="my"> sessionId </em> </strong>:日志所属的会话</li><li id="bf1e" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq mu mv mw mx bi translated"><strong class="kx ir"> <em class="my">歌曲</em> </strong>:每个用户播放的歌曲</li><li id="61c3" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq mu mv mw mx bi translated"><strong class="kx ir"> <em class="my">注册</em> </strong>:用户注册时间戳</li><li id="79bd" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq mu mv mw mx bi translated"><strong class="kx ir"> <em class="my"> ts </em> </strong>:给定事件的时间戳</li><li id="c0df" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq mu mv mw mx bi translated"><strong class="kx ir"> <em class="my">页面</em> </strong>:用户访问过的页面。</li><li id="37df" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq mu mv mw mx bi translated"><strong class="kx ir"> <em class="my">等级</em> </strong>:免费或付费</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/567dcc8f5890990cffe4848ba5c6117d.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*chR_DZVgQ4eGVWPJZSQVdg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">页面字段显示用户可以在 Sparkify 上进行的活动</p></figure><p id="1f17" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们需要定义<strong class="kx ir">流失</strong>并相应地标记流失用户。流失定义为点击了<code class="fe nf ng nh ni b"><strong class="kx ir">cancellation confirmation</strong></code> <strong class="kx ir"> </strong>页面的用户。</p><p id="9b97" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们将分而治之，看看搅动者用户的参与度是否低于现有用户。</p><p id="2dd2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面我们深入探讨某些维度，看看流失群体和其他用户之间是否存在差异。</p><div class="kg kh ki kj gt ab cb"><figure class="nj kk nk nl nm nn no paragraph-image"><img src="../Images/d17271dd1956087c91b57713b4d82ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*AW-TCBNv6YZ45sbjWP8yWg.png"/></figure><figure class="nj kk np nl nm nn no paragraph-image"><img src="../Images/16e233eee9b3a4b0a8a528ee312ea85d.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*Px3Ud-GeTY5G4AQ7vsFSfA.png"/></figure></div><div class="ab cb"><figure class="nj kk nq nl nm nn no paragraph-image"><img src="../Images/9c0533e6ed76725dd8d59639c51a3702.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*ZADOvZ343VxIQqFaOkH7MA.png"/></figure><figure class="nj kk nr nl nm nn no paragraph-image"><img src="../Images/073c157b54f2a858bf968b7f9dbd3b7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*_GuK9ayDLTNMhJ68BAP9Ag.png"/></figure></div><p id="5b32" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从上面的图表中，我们可以总结出:</p><ol class=""><li id="2a6a" class="mp mq iq kx b ky kz lb lc le mr li ms lm mt lq ns mv mw mx bi translated">流失用户在 Sparkify 上的参与度较低。</li><li id="e0c8" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq ns mv mw mx bi translated">付费用户流失更多。这可能是因为付费服务不够好，或者高级功能让用户感到沮丧。</li><li id="88a2" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq ns mv mw mx bi translated">流失用户的社交联系(朋友)较少，降低了他们对平台的忠诚度。</li></ol><h1 id="f4bc" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">建立机器学习模型来检测客户流失</h1><h2 id="9821" class="nt ls iq bd lt nu nv dn lx nw nx dp mb le ny nz md li oa ob mf lm oc od mh oe bi translated">特征工程</h2><p id="7862" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">我们根据洞察力准备特征。关于工程过程的细节，请查看我的<a class="ae of" href="https://github.com/andypwyu/churn_prediction_for_Sparkify/blob/master/Sparkify.ipynb" rel="noopener ugc nofollow" target="_blank"> Github 笔记本</a>。</p><h2 id="f9e9" class="nt ls iq bd lt nu nv dn lx nw nx dp mb le ny nz md li oa ob mf lm oc od mh oe bi translated">创建新功能</h2><ol class=""><li id="9377" class="mp mq iq kx b ky mj lb mk le og li oh lm oi lq ns mv mw mx bi translated">收听的歌曲总数</li><li id="dcf6" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq ns mv mw mx bi translated">竖起大拇指的次数</li><li id="38b4" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq ns mv mw mx bi translated">竖起大拇指的次数</li><li id="8668" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq ns mv mw mx bi translated">自注册以来的总时间(总寿命)</li><li id="8fbf" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq ns mv mw mx bi translated">每次会话播放的平均歌曲数</li><li id="1116" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq ns mv mw mx bi translated">添加到播放列表的歌曲数量</li><li id="5126" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq ns mv mw mx bi translated">朋友总数</li><li id="9863" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq ns mv mw mx bi translated">降级(分类变量)</li></ol><h2 id="72f0" class="nt ls iq bd lt nu nv dn lx nw nx dp mb le ny nz md li oa ob mf lm oc od mh oe bi translated">设置目标变量</h2><ol class=""><li id="688e" class="mp mq iq kx b ky mj lb mk le og li oh lm oi lq ns mv mw mx bi translated">搅拌</li></ol><h2 id="03cc" class="nt ls iq bd lt nu nv dn lx nw nx dp mb le ny nz md li oa ob mf lm oc od mh oe bi translated">建模和评估</h2><p id="345f" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">最后，我们将所有特征矢量化为一个向量，最重要的是，然后进行标准化，以避免一个较大规模的特征主导整个模型。</p><p id="c46e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">数据集分为 60%用于训练，40%用于测试。每个模型都将获得测试集的准确性和 F1 分数。然而，由于被搅动的用户是一个相当小的子集，我将只使用 F1 分数作为优化模型的指标。</p><p id="184e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这里，我用下面的超参数调整信息来探索三个模型:</p><ul class=""><li id="5732" class="mp mq iq kx b ky kz lb lc le mr li ms lm mt lq mu mv mw mx bi translated">随机森林:numTrees[10，20]，maxDepth[10，20]</li><li id="f5ec" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq mu mv mw mx bi translated">渐变增强树:maxIter[10，20]，maxDepth[10，20]</li><li id="5a22" class="mp mq iq kx b ky mz lb na le nb li nc lm nd lq mu mv mw mx bi translated">支持向量机:maxIter[10，20]</li></ul><p id="782a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">绩效结果排名:</p><p id="8589" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">1.随机森林:F1 分 0.746，准确率 0.781 <br/> 2。梯度提升树:F1 得分 0.731，准确率 0.734 <br/> 3。支持向量机:F-1 得分 0.685，准确率 0.781</p><p id="4e88" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们基于 F1 进行优化，随机森林是最好的模型。</p><h2 id="fb0b" class="nt ls iq bd lt nu nv dn lx nw nx dp mb le ny nz md li oa ob mf lm oc od mh oe bi translated">最佳模型的特征重要性</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/e014f3dd4f822ef687f5e6419752057f.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*m7IfjtYCcqIAGrBaP3FPmQ.png"/></div></figure><p id="0865" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从图表中，我们可以看到总寿命实际上对检测搅动起着非常重要的作用。但这可能会引发一场争论，即自然搅拌的人使用服务的时间更短。然而，也可以解释为，只要用户在平台上保持活跃的时间较长，他们就不容易流失，因为他们已经习惯了流媒体服务。此外，朋友总数很重要，因为我们假设平台上社交联系越多的用户忠诚度越高。每次收听的总歌曲数和平均播放的歌曲数衡量了用户的参与度和活跃程度，也有助于表明用户是否会流失。降级并不能有效预测用户流失，这可能是因为用户仍然留在他们的免费帐户中，尽管他们对付费计划并不满意。</p><h1 id="e7fe" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">结论和今后的改进</h1><p id="95ac" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">在这个项目中，我实现了一个模型来预测 Sparkify 音乐流媒体服务的客户流失。我研究了数据集，以了解哪些特征可能有用，并为建模过程创建特征。在这里，我评估了 3 个模型:随机森林(RF)，梯度推进树(GBT)，和支持向量机(SVM)。调整后的 RF 模型能够实现大约 0.746 的 F1 得分，这仍然优于基线模型——预测每个人都不会流失，F1 得分为 0.685，尽管其性能实际上由于数据集的不平衡而被夸大了。根据 F1 得分，最终模型比基准模型提高了 9%。</p><p id="68b3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于在小数据集中只有 175 个唯一用户，因此数据量越大，模型性能越好，越可靠。因此，下一步将是在云上移动选定的模型，并建立 Spark 集群，如<a class="ae of" href="https://aws.amazon.com/emr/" rel="noopener ugc nofollow" target="_blank">亚马逊 EMR </a>或<a class="ae of" href="https://www.ibm.com/cloud/watson-studio" rel="noopener ugc nofollow" target="_blank"> IBM Watson Studio </a>，以利用分布式计算资源处理真实的完整数据集。</p><p id="a062" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果考虑更多的因素或添加更多的领域知识，这些特性还可以得到改进。它随着公司用户群的增长和从数据中挖掘更多洞察力而发展。</p><p id="8055" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">关于这个项目的更多细节，请查看我的 Github 可用<a class="ae of" href="https://github.com/andypwyu/churn_prediction_for_Sparkify" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div></div>    
</body>
</html>