<html>
<head>
<title>How to Create Animated Visualizations with Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Plotly 创建动画可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-animated-visualizations-with-plotly-c54b9c97b133?source=collection_archive---------52-----------------------#2020-05-31">https://towardsdatascience.com/how-to-create-animated-visualizations-with-plotly-c54b9c97b133?source=collection_archive---------52-----------------------#2020-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1b41" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让你的数据技能更上一层楼。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/21618f415a1450fb9738b10eae1a2d29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sakMUcI-CNN4oxQF.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@danielkcheung?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">张家瑜</a>在<a class="ae ky" href="https://unsplash.com/s/photos/small?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="5583" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们生活在大数据时代。我们可以收集大量数据，从而推断出有意义的结果，做出明智的商业决策。然而，随着数据量的增加，分析和探索数据变得更加困难。当有效和恰当地使用时，可视化是探索性数据分析的伟大工具。可视化也有助于向你的观众传递信息，或者告诉他们你的发现。没有一种通用的可视化方法，因此某些任务需要不同类型的可视化。近年来，动画可视化越来越受欢迎，因为它们使“告诉”比统计可视化更多的东西成为可能。动画可视化非常擅长展示事物如何随着时间的推移而变化。</p><p id="5a48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将介绍如何使用<strong class="lb iu"> Plotly Python </strong> (plotly.py)创建动画可视化，这是一个基于 plotly javascript (plotly.js)构建的开源绘图库。我喜欢 plotly.py 的一点是，它提供了一个高级 API ( <strong class="lb iu"> plotly express </strong>)和一个低级 API ( <strong class="lb iu"> graph objects </strong>)来创建可视化。使用 plotly express，我们可以用很少的代码行创建一个很好的情节。另一方面，我们需要用图形对象编写更多的代码，但是对我们创建的内容有更多的控制。</p><p id="cd89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本帖中，我们将使用 plotly express API。我将写另一篇文章来介绍图形对象的动画可视化。</p><p id="2139" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将合并两个不同的数据集。一个是肥胖率数据集，可在 kaggle 上的<a class="ae ky" href="https://www.kaggle.com/amanarora/obesity-among-adults-by-country-19752016" rel="noopener ugc nofollow" target="_blank">这里</a>获得。原始数据集需要清理和重新格式化。如果你想经历数据清理的步骤，请随意访问我的帖子:</p><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/a-practical-guide-for-data-cleaning-obesity-rate-dataset-aff9d12390c8"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">数据清理实用指南:肥胖率数据集</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">如何清理和重新格式化原始数据集。</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="0578" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是清理后的数据帧的前五行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/d8eafc6285897767fda265966377a7bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GPcis20LCTjJpvUg3HukKw.png"/></div></div></figure><p id="89ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用的另一个数据集不区分性别。因此，我们需要通过按“国家”和“年份”分组并取“肥胖率”的平均值来消除该数据集中的性别:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="503a" class="mt mu it mp b gy mv mw l mx my">import numpy as np<br/>import pandas as pd</span><span id="7370" class="mt mu it mp b gy mz mw l mx my"># fixing data tytpes<br/>obesity_cleaned = df2.astype({'obesity_rate': 'float32', 'year': 'int32'})</span><span id="339a" class="mt mu it mp b gy mz mw l mx my"># eliminating gender<br/>obesity_cleaned = obesity_cleaned.groupby(['country','year']).mean().reset_index()</span><span id="ca0d" class="mt mu it mp b gy mz mw l mx my">obesity_cleaned.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/861a367314d253744c9d60a6647d1ef5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OI-747inKk7GysiHUrMHTg.png"/></div></div></figure><p id="d2b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个数据集可用作 plotly express 的内置数据集。它被称为 gapminder，包括 142 个国家从 1952 年到 2007 年的预期寿命、人均 gdp 和人口(以 5 年为增量)。我们首先导入 plotly express 和数据集:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="935b" class="mt mu it mp b gy mv mw l mx my">import plotly.express as px</span><span id="86f0" class="mt mu it mp b gy mz mw l mx my">df_gdp = px.data.gapminder()</span><span id="ec4e" class="mt mu it mp b gy mz mw l mx my">df_gdp.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/160830fa2c913de1cb899a34e4742dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vy1VkY_u26UTAgPU-o9XOw.png"/></div></div></figure><p id="7a15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用 pandas 的<strong class="lb iu"> merge </strong>功能来合并这两个数据帧。共享列是国家和年份，因此我们将它们传递给参数上的<strong class="lb iu">:</strong></p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="2c25" class="mt mu it mp b gy mv mw l mx my">df_merge = pd.merge(df_gdp, obesity_cleaned, <br/>                    on=['country','year'])</span><span id="1cd5" class="mt mu it mp b gy mz mw l mx my">df_merge.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/e0e0b5a1ed8fc0132f91f743fd20385f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XXumjdptHQI9dzu1ZOn8wg.png"/></div></div></figure><p id="62ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以创建我们的第一个动画可视化。下面是生成动画散点图的代码。我会解释每一个参数，然后显示图。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="c977" class="mt mu it mp b gy mv mw l mx my">px.scatter(</span><span id="ebed" class="mt mu it mp b gy mz mw l mx my">df_merge, x="obesity_rate", y="gdpPercap",<br/>animation_frame="year",<br/>size="pop", color="continent", hover_name="country",<br/>size_max = 50,<br/>range_x=[0.1, 50], range_y=[100,60000],<br/>log_x=True, log_y=True</span><span id="c05d" class="mt mu it mp b gy mz mw l mx my">)</span><span id="070e" class="mt mu it mp b gy mz mw l mx my">fig.show()</span></pre><p id="9260" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先在数据帧的名称上加右键，并指定 x 轴和 y 轴。因此，我们的动画散点图将显示人均 gdp 和肥胖率如何随时间变化。为了使情节动画，我们使用<strong class="lb iu">动画 _ 帧</strong>参数。我们使用“年”作为动画帧，因此值将根据年份而变化。我们将人口分配给<strong class="lb iu">大小</strong>参数，因此散点图中点的大小与国家人口成比例。对于<strong class="lb iu"> color </strong>参数，我们使用大陆列，这样我们可以大致了解每个大陆。<strong class="lb iu"> Size_max </strong>参数允许调整散点图中点的大小。如果不指定，点可能看起来太小，人眼看不出来。<strong class="lb iu"> Range_x </strong>和<strong class="lb iu"> range_y </strong>参数用于指定范围，使所有点在动画期间保持可见。最后，log_x 和 log_y 参数调整对数标度上的轴范围。如果数值相差很大，最好使用对数标度，使绘图看起来更好。</p><p id="4d32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可视化是传递信息的好工具。动画情节甚至更强大，因为它们也考虑了时间。通过我们刚刚创建的图，我们获得了以下信息:</p><ul class=""><li id="3c2f" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">国家人口</li><li id="0a9c" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">各国人均国内生产总值</li><li id="134b" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">各国肥胖率</li><li id="19a4" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">这些值如何随时间变化</li><li id="0692" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">根据这些标准，各大洲是如何不同的</li><li id="0650" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">如果这些度量之间存在相关性</li></ul><p id="618b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看我们创建的动画散点图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/a6738f753cfbabd47fe745388425e92b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HI5lwdrSJSzGLNPky4QLew.gif"/></div></div></figure><ul class=""><li id="e654" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">欧洲国家的人均 gdp 和总体肥胖率都很高。</li><li id="9b99" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">总的来说，非洲和亚洲国家在人均 gpd 和肥胖率方面都远远落后。</li><li id="2875" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">这些年来，亚洲国家的人均国内生产总值已经超过了非洲国家。</li><li id="8544" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">肥胖率和人均 gdp 之间似乎存在正相关关系(当然，我们需要更多的数据来证实)</li><li id="63fa" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">尽管由于人口规模非常小，这一点很难引起注意，但科威特一直是肥胖率最高的国家，人均国内生产总值排名前三。</li></ul></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="fc64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以创建一个动画条形图。例如，肥胖率如何随时间变化可以用柱状图来表示。让我们选择 5 个国家(每个洲一个)在图上显示。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="10ba" class="mt mu it mp b gy mv mw l mx my">countries = ['China', 'Germany', 'Senegal', 'Brazil', 'New Zealand']</span><span id="1aa4" class="mt mu it mp b gy mz mw l mx my">df5 = obesity_cleaned[obesity_cleaned.country.isin(countries)].reset_index(drop=True)</span></pre><p id="fbdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们这次也加个标题。以下是使用 plotly express 创建动画条形图的代码:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="df54" class="mt mu it mp b gy mv mw l mx my">fig = px.bar(</span><span id="3456" class="mt mu it mp b gy mz mw l mx my">df5, x="country", y="obesity_rate",<br/>color="country",<br/>animation_frame="year", animation_group="country",<br/>range_y=[0.1, 50],<br/>title='Obesity Rate from 1975 to 2016'</span><span id="ae1a" class="mt mu it mp b gy mz mw l mx my">)</span><span id="6b69" class="mt mu it mp b gy mz mw l mx my">fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/fca442eb0b35f740060b41f870654dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*TbvUVbH14t9-NqIQFP9bbw.gif"/></div></div></figure><p id="6d6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，全世界的肥胖率一直在上升。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="47e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经介绍了如何使用 plotly express 创建一些基本的动画情节。当然，这只是这个神奇图书馆的一小部分功能。我们可以使用 plotly 动态创建许多其他绘图类型。我还将讲述如何使用 plotly.py 的图形对象创建动画图。语法稍微复杂一点，但它提供了更多的灵活性。最好熟悉这两种 API，选择最适合自己需求的一种。</p><p id="202e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像任何其他主题一样，熟悉 plotly 的最好方法就是实践。因此，我建议创造大量的情节来提高你的技能。</p><p id="096b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>