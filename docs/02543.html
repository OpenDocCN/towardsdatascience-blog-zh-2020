<html>
<head>
<title>FastAI: Classifying Brooklyn Nine-Nine Actors with Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">FastAI:用深度学习对布鲁克林九九演员进行分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/fastai-classifying-brooklyn-nine-nine-actors-with-deep-learning-4b06a8ab3cab?source=collection_archive---------16-----------------------#2020-03-11">https://towardsdatascience.com/fastai-classifying-brooklyn-nine-nine-actors-with-deep-learning-4b06a8ab3cab?source=collection_archive---------16-----------------------#2020-03-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="63de" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">他们看见我在跳舞——他们憎恨我</h2></div><p id="6375" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随着第七季的播出，毫无疑问,<a class="ae le" href="https://www.imdb.com/title/tt2467372/" rel="noopener ugc nofollow" target="_blank">布鲁克林九九</a>是一部受欢迎的电视剧。我不会去探究原因，但是如果你还没有看过这部电影，并且有时间，那就没有理由至少不去尝试一下。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/84e9e4d16cee3b50d9de12836720b3cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oqZGafbS3bfVO7WQgumjKg.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">修改后的图片来自<a class="ae le" href="https://commons.wikimedia.org/wiki/File:Brooklyn_nine-nine_logo.png" rel="noopener ugc nofollow" target="_blank">维基共享资源</a></p></figure><p id="71d3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但这不是一篇电视节目文章——这是一篇<strong class="kk iu">深度学习</strong>文章。更准确地说，这篇文章旨在利用深度学习的力量对节目中演员的图像进行分类。</p><p id="f778" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="lv">好吧，但是，你将从哪里得到这些图像呢？</em>T9】</strong></p><p id="ebd5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好问题。基本上这个想法是从网上下载图片——这并不是说我的意图是在之后出售这个模型(<em class="lv">谁会从中受益？</em>)。下载后，我们只需要做基本的图像操作——裁剪<strong class="kk iu"/>。</p><p id="1943" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本质上，所有的图像都被裁剪成正方形，并且没有做任何准备工作。原因是将使用一个复杂的深度学习库来处理训练过程— <em class="lv"> FastAI </em>。</p><p id="95ab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我以前写过关于它的文章，如果您想继续学习，请确保正确安装和配置了它。这篇文章可能会派上用场:</p><div class="lw lx gp gr ly lz"><a rel="noopener follow" target="_blank" href="/intro-to-fastai-installation-and-building-our-first-classifier-938e95fd97d3"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">FastAI 简介:安装和构建我们的第一个分类器</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">提示:仅用 5 行代码就能在 MNIST 上达到 98%的准确率！</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn lp lz"/></div></div></a></div></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="f386" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">数据结构</h1><p id="38c2" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">以下是我设法找到一些质量不错的照片的角色列表:</p><ul class=""><li id="ea93" class="ns nt it kk b kl km ko kp kr nu kv nv kz nw ld nx ny nz oa bi translated">杰克·佩拉尔塔</li><li id="a901" class="ns nt it kk b kl ob ko oc kr od kv oe kz of ld nx ny nz oa bi translated">艾米·圣地亚哥</li><li id="2e94" class="ns nt it kk b kl ob ko oc kr od kv oe kz of ld nx ny nz oa bi translated">特里·杰福兹</li><li id="a6d0" class="ns nt it kk b kl ob ko oc kr od kv oe kz of ld nx ny nz oa bi translated"><em class="lv">雷蒙德·霍尔特</em></li><li id="93f7" class="ns nt it kk b kl ob ko oc kr od kv oe kz of ld nx ny nz oa bi translated">罗莎·迪亚兹</li><li id="340d" class="ns nt it kk b kl ob ko oc kr od kv oe kz of ld nx ny nz oa bi translated">查尔斯·博伊尔</li></ul><p id="9c9b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以没有希区柯克<em class="lv">和史高丽<em class="lv">不幸的是，因为他们在大多数镜头中都在一起，所以我不想花几个小时在 Photoshop<em class="lv">里。无论如何，对于上面提到的 6 个演员中的每一个，都保存了 25 张质量不错的照片。</em></em></em></p><p id="5034" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以任何标准来看都不是很多，这就是为什么我们将使用<strong class="kk iu"> ResNet </strong>预训练网络来帮助我们一点。如果您决定自己搜索图像，然后制作分类器，下面是您应该如何构建目录:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/514ddb4943b5152320c7acb53249b986.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*FGjIZ0xXfOGbWSu9dfBo3Q.png"/></div></figure><p id="08fc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是的，你没看错。此时，<em class="lv"> FastAI </em>库需要这种结构——或者至少我还没有设法让它工作。如果有，请告诉我。</p><p id="eea9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="lv">还跟着我？</em> </strong></p><p id="64d2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很好，现在我们可以进行模型训练了！</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="oh oi l"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">由<a class="ae le" href="https://giphy.com/gifs/brooklynninenine-brooklyn-99-captain-holt-hot-damn-f3jZ8moRBbEvNJjOtu" rel="noopener ugc nofollow" target="_blank">吉菲</a></p></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="7c5e" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">让我们做一个模型</h1><p id="193c" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">首先，我们需要进行两次导入——并且都来自于<em class="lv"> FastAI </em>库(如果没有安装，请参考上面的文章):</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/1ce8c8c25d9deba6ae81ee7062620cf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*a0WF7ICU2JCItF40Cu7XjA.png"/></div></figure><p id="5d7f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们现在做一点准备。我们将用以下参数创建一个<code class="fe ok ol om on b">ImageDataBunch</code>对象:</p><ul class=""><li id="b586" class="ns nt it kk b kl km ko kp kr nu kv nv kz nw ld nx ny nz oa bi translated"><code class="fe ok ol om on b">path</code>:根图像文件夹的路径</li><li id="a039" class="ns nt it kk b kl ob ko oc kr od kv oe kz of ld nx ny nz oa bi translated"><code class="fe ok ol om on b">train</code>:将用于训练的图像路径。如果图像不是在<em class="lv">训练/测试</em>文件夹中构建的，您可以使用<code class="fe ok ol om on b">.</code>来代替</li><li id="e476" class="ns nt it kk b kl ob ko oc kr od kv oe kz of ld nx ny nz oa bi translated"><code class="fe ok ol om on b">valid_pct</code>:由于我们在<em class="lv">训练/测试</em>文件夹中没有图像，此参数指定了用于验证的图像百分比</li><li id="c4e3" class="ns nt it kk b kl ob ko oc kr od kv oe kz of ld nx ny nz oa bi translated"><code class="fe ok ol om on b">size</code>:每幅图像将要变换的尺寸</li><li id="2a4c" class="ns nt it kk b kl ob ko oc kr od kv oe kz of ld nx ny nz oa bi translated"><code class="fe ok ol om on b">bs</code>:批量大小</li></ul><p id="1b8f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还将随机种子设置为 42，这样读者就可以复制结果。用它给出的代码实现:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/1fbe6368150c9d557da92ca1efaeee74.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*v-nCMYx6FC8dp1jyZzTarg.png"/></div></figure><p id="6521" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们看看来自<strong class="kk iu">单个批次</strong>的几幅图像看起来会是什么样子:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/8fb3f90a2a33f5d61b55218ae89b59b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*KKHQ8tVm74SoopCYa1cxNw.png"/></div></figure><p id="bfe4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">准备工作已经完成！</strong></p><p id="415c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以实例化一个<code class="fe ok ol om on b">cnn_learner</code>:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/f306d67bcb2520a7a5e03d8d4d084fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:460/format:webp/1*swAXS2MNRRS3HBz5jd17Kg.png"/></div></figure><p id="a882" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意我是如何使用<strong class="kk iu"> ResNet101 </strong>网络的预训练权重的。我们只有一些图像，如果我们不从头开始，结果通常会更好。ResNet101 已经知道人类“长什么样”，建议用它来处理类似这样的案例。</p><p id="869d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很好，我们有开始训练模型所需的一切。让我们训练它 15 个周期，看看会发生什么:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi or"><img src="../Images/f73df02ff6660bdafb049d91ed3fc373.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*LytfG_DwmqYd0BIB_MjkEw.png"/></div></figure><p id="e744" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最终，我们的准确率在<strong class="kk iu"> 84% </strong>左右，这对于训练数据如此有限的多类分类问题来说并不算太差。</p><p id="5641" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是接下来让我们更深入的探讨<strong class="kk iu">车型评测</strong>。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="4e8f" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">模型评估</h1><p id="3155" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">对于这种类型的问题，查看一个<strong class="kk iu">混淆矩阵</strong>来看看我们的模型在哪里表现得好，在哪里表现得不好，这将是很好的。</p><p id="ad11" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们可以创建一个<code class="fe ok ol om on b">ClassificationInterpretation</code>的实例来访问混淆矩阵:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi os"><img src="../Images/b06e12d7ac83cf85b57b67ef96cf24c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*7oeVVXZtgEXd53Gv5ca31Q.png"/></div></figure><p id="b4c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很好，现在混乱矩阵本身:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/48651dff97edd0ff511695f0ff560c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*6QrQPUkr30fwOkoYCglwXA.png"/></div></figure><p id="130d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">似乎我们的模型在某些情况下对这两种组合有问题:</p><ol class=""><li id="698e" class="ns nt it kk b kl km ko kp kr nu kv nv kz nw ld ou ny nz oa bi translated"><em class="lv">特里·杰福兹—雷蒙德·霍尔特</em></li><li id="7c11" class="ns nt it kk b kl ob ko oc kr od kv oe kz of ld ou ny nz oa bi translated">艾米·圣地亚哥—罗莎·迪亚兹</li></ol><p id="959a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的意思是，对于这有限数量的图像，可以解释为什么模型是混乱的，但它仍然表现得相当不错——如果你考虑到 FastAI 库需要的时间和精力是多么少的话。</p><p id="9cdb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">FastAI 可以做的另一件很酷的事情是向你展示它最容易与混淆的图像——这种方法被称为<code class="fe ok ol om on b">.plot_top_losses()</code>:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ov"><img src="../Images/a2855b7f5f5254ca99f91eb0887758cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lj4FdZloJ9m2LNw1p3koAA.png"/></div></div></figure><p id="3d2b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，除了第一条，我什么都能理解——对我来说，这似乎是一个清晰的镜头。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="4f9b" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">在你走之前</h1><p id="ebe9" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">现在你知道了，利用如此有限的数据，只需几行代码，我们就可以开发出一种基于深度学习的多类分类算法，准确率约为 84%。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="oh oi l"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">由<a class="ae le" href="https://giphy.com/gifs/KxiRwO7tqXCTDVKobo/html5" rel="noopener ugc nofollow" target="_blank">吉菲</a></p></figure><p id="50c1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的目标是未来在这个问题上花更多的时间，收集更多的图像，也许在<strong class="kk iu"> PyTorch </strong>中编码整个事情。如果你想看的话，请告诉我。</p><p id="9184" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望这对你来说是有趣的。感谢阅读。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="5d5e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">喜欢这篇文章吗？成为 <a class="ae le" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="lv">中等会员</em> </a> <em class="lv">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="lw lx gp gr ly lz"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">通过我的推荐链接加入 Medium-Dario rade ci</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">medium.com</p></div></div><div class="mi l"><div class="ow l mk ml mm mi mn lp lz"/></div></div></a></div></div></div>    
</body>
</html>