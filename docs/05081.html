<html>
<head>
<title>Setup your home JupyterHub on a Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在树莓派上设置您的家庭JupyterHub</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/setup-your-home-jupyterhub-on-a-raspberry-pi-7ad32e20eed?source=collection_archive---------5-----------------------#2020-05-02">https://towardsdatascience.com/setup-your-home-jupyterhub-on-a-raspberry-pi-7ad32e20eed?source=collection_archive---------5-----------------------#2020-05-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="232f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从家中的任何设备启动笔记本。一个家庭中心。</h2></div><p id="8adc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为一名数据科学家，我每天都使用Jupyter笔记本。有时在本地我的笔记本上，有时通过JupyterHub在服务器上。但是为什么不把两者结合起来，在树莓派上运行JupyterHub呢？这样，家庭中的每个人都可以通过浏览器从每台设备启动笔记本电脑。数据总是留在家里，随着Raspberry Pis变得越来越强大，我们实际上可以在它上面进行真正的数据科学。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/e98be07c5640a78c78af1c1b794323ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bheCBl2e9otX5kmfssNRlA.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">我平板电脑上的一点机器学习。旁边:树莓派和咖啡。</p></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="e82e" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">目录</h1><ol class=""><li id="77b6" class="mt mu it kk b kl mv ko mw kr mx kv my kz mz ld na nb nc nd bi translated">准备Python环境</li><li id="06d2" class="mt mu it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">安装JupyterHub</li><li id="0aa0" class="mt mu it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">设置为系统服务</li><li id="bd08" class="mt mu it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">使用JupyterLab</li><li id="8f5a" class="mt mu it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">安装Python库</li><li id="c79f" class="mt mu it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">用户管理</li></ol></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="e3a3" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">准备Python环境</h1><p id="07cf" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">有许多文章描述了如何设置JupyterHub，但是大多数都使用了Anaconda。不幸的是，Anaconda不支持像Raspberry Pi和Miniconda这样的ARM系统，而这两个系统通常被认为是一种替代方案，显然没有得到进一步的维护。所以让我们和皮普一起去。</p><p id="6bd1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我做错什么了吗？当我在新安装的Raspbian Buster中输入“python”时，它打开了“python2”。真的吗？不是2020年吗？所以让我们快速地将系统重定向到python3:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="ced3" class="nr mc it nn b gy ns nt l nu nv">sudo rm /usr/bin/python <br/>sudo ln -s /usr/bin/python3 /usr/bin/python</span></pre><p id="d824" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并安装python包管理器pip:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="f4f8" class="nr mc it nn b gy ns nt l nu nv">sudo apt-get update <br/>sudo apt-get install python3-pip <br/>sudo pip3 install --upgrade pip</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="663b" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">安装JupyterHub</h1><p id="0a1b" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">JupyterHub由三个组件组成:</p><ul class=""><li id="4572" class="mt mu it kk b kl km ko kp kr nw kv nx kz ny ld nz nb nc nd bi translated">一个<em class="oa">单用户笔记本服务器</em>，当系统上的每个用户登录时启动。这基本上就是你已经安装在笔记本电脑上的东西，从<code class="fe ob oc od nn b">jupyter notebook</code>开始。</li><li id="122d" class="mt mu it kk b kl ne ko nf kr ng kv nh kz ni ld nz nb nc nd bi translated">管理用户账户、认证和协调单用户笔记本服务器的<em class="oa">中枢</em>。</li><li id="5ad2" class="mt mu it kk b kl ne ko nf kr ng kv nh kz ni ld nz nb nc nd bi translated">一个<em class="oa">代理</em>，它将用户请求路由到集线器和笔记本服务器。</li></ul><p id="df38" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">相应地，我们需要安装这三个组件。让我们从代理开始:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="1bed" class="nr mc it nn b gy ns nt l nu nv">sudo apt-get install npm <br/>sudo npm install -g configurable-http-proxy</span></pre><p id="3659" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们可以使用pip安装JupyterHub和Jupyter Notebook。因为我们想让多个用户使用JupyterHub，所以我们需要确保安装是系统范围的:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="4f25" class="nr mc it nn b gy ns nt l nu nv">sudo -H pip3 install notebook jupyterhub</span></pre><p id="384f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">JupyterHub是使用python脚本配置的。您可以使用以下命令生成模板。然后，将其移动到主目录之外的位置:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="692f" class="nr mc it nn b gy ns nt l nu nv">jupyterhub --generate-config <br/>sudo mv jupyterhub_config.py /root</span></pre><p id="1acf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在下面的步骤中，当我们在配置文件中进行更改时，我们需要修改这个文件<code class="fe ob oc od nn b">/root/jupyterhub_config.py</code>。由于它位于<code class="fe ob oc od nn b">/root</code>，我们需要使用sudo。</p><p id="97a0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，默认情况下，JupyterHub运行在端口8000上。可能我们已经在使用这个端口了，所以我们把它改成8888吧。为此，取消配置文件中以下语句的注释，并调整端口:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="7074" class="nr mc it nn b gy ns nt l nu nv">c.JupyterHub.bind_url = 'http://:8888'</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="6f0e" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">设置为系统服务</h1><p id="3101" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">我们的JupyterHub已经准备好了。我们可以从<code class="fe ob oc od nn b">jupyterhub -f /root/jupyterhub_config.py &amp;</code>开始(其中<code class="fe ob oc od nn b">-f</code>指向我们刚刚创建的配置文件)。但是，集线器只能存活到下一次系统重启。第一次尝试还好，但是如果我们经常使用它，当然最好将JupyterHub设置为系统服务，这样它会在系统启动时自动启动。</p><p id="b9b0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要将JupyterHub注册为系统服务，创建文件<code class="fe ob oc od nn b">/lib/systemd/system/jupyterhub.service</code>,并用以下内容填充它:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="2120" class="nr mc it nn b gy ns nt l nu nv">[Unit] <br/>Description=JupyterHub Service <br/>After=multi-user.target  </span><span id="ffe7" class="nr mc it nn b gy oe nt l nu nv">[Service] <br/>User=root <br/>ExecStart=/usr/local/bin/jupyterhub --config=/root/jupyterhub_config.py <br/>Restart=on-failure  </span><span id="21ce" class="nr mc it nn b gy oe nt l nu nv">[Install] <br/>WantedBy=multi-user.target</span></pre><p id="764f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">确保以<code class="fe ob oc od nn b">ExecStart</code>开头的行包含JupyterHub二进制文件和配置文件的正确位置，或者进行相应的调整。</p><p id="0142" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，运行以下命令:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="c141" class="nr mc it nn b gy ns nt l nu nv">sudo systemctl daemon-reload <br/>sudo systemctl start jupyterhub <br/>sudo systemctl enable jupyterhub <br/>sudo systemctl status jupyterhub.service</span></pre><p id="8714" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">JupyterHub将在系统启动时启动。最后一个命令显示了状态，希望是“active (running)”。</p><p id="0949" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果是这种情况，请前往<code class="fe ob oc od nn b">http://&lt;address of your raspi&gt;:8888</code>。您应该会看到JupyterHub的登录页面。Raspberry Pi的每个系统用户现在都可以登录并启动他们自己的笔记本服务器！</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="6bf4" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">使用JupyterLab</h1><p id="acc1" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">JupyterLab是Jupyter项目的下一代基于网络的用户界面。它允许您以非常灵活的方式处理文档和笔记本。如果你还不相信:它甚至有一个黑暗模式…</p><p id="814f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用JupyterLab而不是传统的笔记本，我们首先必须使用pip安装它，然后启用扩展(使用sudo在系统范围内完成):</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="97de" class="nr mc it nn b gy ns nt l nu nv">sudo -H pip3 install jupyterlab  <br/>sudo jupyter serverextension enable --py jupyterlab --system</span></pre><p id="5d74" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们必须在配置文件中添加(或取消注释并调整相应的行)以下内容:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="7229" class="nr mc it nn b gy ns nt l nu nv">c.Spawner.default_url = '/user/:username/lab'</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="9952" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">安装Python库</h1><p id="fc81" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">为了进行实际的数据科学，我们当然需要比python标准库更多的东西。我们基本上有两种可能性:我们可以在系统范围内安装它们。或者，每个用户都可以将它们安装在自己的主目录中。</p><p id="8510" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个合理的方法是在系统范围内安装最常用的包，让用户自己安装其他的包。下面是如何在系统范围内安装numpy的一个例子。要使numpy工作，您还必须安装以下系统软件包:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="da01" class="nr mc it nn b gy ns nt l nu nv">sudo apt-get install libatlas-base-dev <br/>sudo -H pip3 install numpy</span></pre><p id="d6f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">没有sudo权限的用户可以在他们的主目录中安装软件包，例如:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="970d" class="nr mc it nn b gy ns nt l nu nv">pip3 install seaborn</span></pre><p id="e413" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您实际上可以从JupyterLab中打开一个终端，因此没有必要为“普通”用户设置ssh连接。只需转到启动窗口，打开一个终端。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi of"><img src="../Images/fa078a55c597b2fb04faf571dd28faea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dAZ5etmJphQQCP-ys6Wd_Q.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">首先打开启动窗口。从那里，您可以打开一个新的笔记本或终端。</p></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="55ab" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">用户管理</h1><p id="0561" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">在我们当前的设置中，用户由操作系统管理。这意味着每一个Raspberry Pi的用户也可以启动他们自己的笔记本服务器。</p><p id="3156" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">管理员有额外的权利。例如，他们可以访问管理面板，在那里他们可以看到哪些用户登录，并启动和停止他们的服务器。管理员权限通过组来处理。例如，如果我们想指定用户“gerold”为admin，我们将首先创建一个组(我们也可以使用一个预先存在的组)并将用户添加到其中。这在Unix系统中通常是这样做的:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="26cf" class="nr mc it nn b gy ns nt l nu nv">sudo addgroup jupyter_admin <br/>sudo usermod -aG jupyter_admin gerold</span></pre><p id="5040" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们需要在配置文件中将该组添加为admin-group:</p><pre class="lf lg lh li gt nm nn no np aw nq bi"><span id="0856" class="nr mc it nn b gy ns nt l nu nv">c.PAMAuthenticator.admin_groups = {'jupyter_admin'}</span></pre><p id="88a2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以在<code class="fe ob oc od nn b">http://&lt;address of your raspi&gt;:8888/hub/admin</code>下找到管理面板。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi og"><img src="../Images/0fc22d7140fdf8af566886e8956277ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PL8tubGlHBIAJuxuIc4Ozw.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">JupyterHub管理面板。</p></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="8ceb" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">参考</h1><ul class=""><li id="646b" class="mt mu it kk b kl mv ko mw kr mx kv my kz mz ld nz nb nc nd bi translated">木星枢纽:<a class="ae oh" href="https://jupyterhub.readthedocs.io/" rel="noopener ugc nofollow" target="_blank">https://jupyterhub.readthedocs.io/</a></li><li id="cf95" class="mt mu it kk b kl ne ko nf kr ng kv nh kz ni ld nz nb nc nd bi translated">木星实验室:<a class="ae oh" href="https://jupyterlab.readthedocs.io/" rel="noopener ugc nofollow" target="_blank">https://jupyterlab.readthedocs.io/</a></li></ul></div></div>    
</body>
</html>