<html>
<head>
<title>Logging Explained in 5 Minutes — Walkthrough with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">5 分钟内解释日志记录 Python 演示</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/logging-explained-in-5-minutes-walkthrough-with-python-8bd7d8c2cf3a?source=collection_archive---------20-----------------------#2020-08-10">https://towardsdatascience.com/logging-explained-in-5-minutes-walkthrough-with-python-8bd7d8c2cf3a?source=collection_archive---------20-----------------------#2020-08-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3df0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">掌握编程和数据科学的必备工具之一。</h2></div><p id="5589" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让您的代码可以投入生产并不是一件容易的事情。需要考虑的事情太多了，其中之一就是能够监控应用程序的流程。这就是日志的用武之地——一个简单的工具，可以节省一些精力和很多很多时间。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/a0455a3f42a4cc237e020cd45ab2272d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*286m6eeG99YBEpNu"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@giamboscaro?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Giammarco Boscaro </a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="1084" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Python 对日志记录有很好的内置支持。它是通过<code class="fe lv lw lx ly b">logging</code>库实现的，与其他主要编程语言中的选项非常相似。</p><p id="031b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你更喜欢视频，或者只是想巩固你的知识，请随意观看我们关于这个主题的视频。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="73c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们进入代码之前，让我们简单地讨论一下为什么您应该关心日志记录，以及它背后的一些理论。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="2d0b" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">伐木——为什么？</h1><p id="82d2" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">我之前提到过，日志记录用于监控应用程序流，以及其他功能。你现在的问题可能是<em class="nf">为什么我们不能只使用打印语句？我们可以，但这并不理想。没有办法通过简单的打印语句来跟踪消息的严重性。这就是伐木业的闪光点。</em></p><p id="a975" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是我认为应该在应用程序中使用日志记录的三大理由:</p><ol class=""><li id="45f3" class="ng nh it kk b kl km ko kp kr ni kv nj kz nk ld nl nm nn no bi translated"><strong class="kk iu">了解你的代码是如何工作的</strong>——你不想在生产中盲目</li><li id="0071" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nl nm nn no bi translated"><strong class="kk iu">捕获并修复意外错误</strong>——检测代码中潜在的更大问题</li><li id="d7d3" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nl nm nn no bi translated"><strong class="kk iu">分析并可视化应用程序如何执行</strong> —更高级的主题</li></ol><p id="89ce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如前所述，<code class="fe lv lw lx ly b">logging</code>库内置于 Python 编程语言中，提供了 5 个严重级别:</p><ul class=""><li id="39a7" class="ng nh it kk b kl km ko kp kr ni kv nj kz nk ld nu nm nn no bi translated">调试</li><li id="27bc" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nu nm nn no bi translated">信息</li><li id="6b1f" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nu nm nn no bi translated">警告</li><li id="1361" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nu nm nn no bi translated">错误</li><li id="ab94" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nu nm nn no bi translated">批评的</li></ul><p id="bd04" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以仅从名称来推断何时应该使用一个而不是另一个，但是需要注意的是，Python 默认显示严重级别为 WARNING 及以上的消息。这种行为是可以改变的。</p><p id="c68f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们用一些简单的代码来探索日志记录。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="70b2" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">记录——如何记录？</h1><p id="ef9b" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">首先，让我们执行几个导入:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="e6ee" class="nz mj it ly b gy oa ob l oc od">import random<br/>import time<br/>from datetime import datetime<br/>import logging</span></pre><p id="a999" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如你所见，这里包括了<code class="fe lv lw lx ly b">logging</code>图书馆。我之前提到过 Python 将只显示严重级别为警告及以上的消息，所以我们可以这样改变:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="2038" class="nz mj it ly b gy oa ob l oc od">logging.basicConfig(<em class="nf">level</em><strong class="ly iu">=</strong>logging.DEBUG)</span></pre><p id="7faf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就是这样！让我们声明一个简单的函数，该函数生成一个从 0 到 4 的随机数，并基于该随机数记录不同严重性级别的消息。显示消息后，程序会休眠一秒钟。该功能仅用于测试:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="90c4" class="nz mj it ly b gy oa ob l oc od">def log_tester():<br/>    x = random.randint(0, 4)<br/>    if x == 0:<br/>        logging.debug(‘Debug message’)<br/>    elif x == 1:<br/>        logging.info(‘Info message’)<br/>    elif x == 2:<br/>        logging.warning(‘Warning message’)<br/>    elif x == 3:<br/>        logging.error(‘Error message’)<br/>    elif x == 4:<br/>        logging.critical(‘Critical message’)</span><span id="98e8" class="nz mj it ly b gy oe ob l oc od">    time.sleep(1)<br/>    return</span></pre><p id="3f29" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们需要在某个地方调用这个函数，为什么不在循环中调用呢？只是为了打印出多条消息:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="4f3f" class="nz mj it ly b gy oa ob l oc od">for i in range(5):<br/>    log_tester()</span></pre><p id="a299" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您现在运行这段代码，您将得到类似于我的输出:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="3095" class="nz mj it ly b gy oa ob l oc od">Output:</span><span id="9ecf" class="nz mj it ly b gy oe ob l oc od">WARNING:root:Warning message<br/>ERROR:root:Error message<br/>DEBUG:root:Debug message<br/>INFO:root:Info message<br/>INFO:root:Info message</span></pre><p id="4c8f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请记住，由于随机化过程，您的输出可能会有所不同。</p><p id="9429" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这种格式在某些情况下很好，但在其他情况下，我们可能需要更多的控制，并且能够进一步定制输出的外观。</p><p id="ebd9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来探索如何。</p><h2 id="9094" class="nz mj it bd mk of og dn mo oh oi dp ms kr oj ok mu kv ol om mw kz on oo my op bi translated">输出格式</h2><p id="d26a" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">让我们稍微改变一下<code class="fe lv lw lx ly b">logging.basicConfig</code>:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="4063" class="nz mj it ly b gy oa ob l oc od">logging.basicConfig(<em class="nf">level</em><strong class="ly iu">=</strong>logging.DEBUG, <em class="nf">format</em><strong class="ly iu">=</strong>’%(levelname)s → %(name)s:%(message)s’)</span></pre><p id="734d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您现在运行此代码，消息将按照指定的方式格式化:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="8f85" class="nz mj it ly b gy oa ob l oc od">Output:</span><span id="2c88" class="nz mj it ly b gy oe ob l oc od">CRITICAL → root:Critical message<br/>WARNING → root:Warning message<br/>DEBUG → root:Debug message<br/>DEBUG → root:Debug message<br/>CRITICAL → root:Critical message</span></pre><p id="6fc5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那很好，但是我喜欢做的是给消息添加当前的日期和时间信息。使用格式字符串很容易做到:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="3018" class="nz mj it ly b gy oa ob l oc od">logging.basicConfig(<em class="nf">level</em><strong class="ly iu">=</strong>logging.DEBUG, <em class="nf">format</em><strong class="ly iu">=</strong>f’%(levelname)s → {datetime.now()} → %(name)s:%(message)s’)</span></pre><p id="2028" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我们新格式的样子:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="53ba" class="nz mj it ly b gy oa ob l oc od">DEBUG → 2020–08–09 10:32:11.519365 → root:Debug message<br/>DEBUG → 2020–08–09 10:32:11.519365 → root:Debug message<br/>DEBUG → 2020–08–09 10:32:11.519365 → root:Debug message<br/>ERROR → 2020–08–09 10:32:11.519365 → root:Error message<br/>WARNING → 2020–08–09 10:32:11.519365 → root:Warning message</span></pre><p id="28b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们有进展了！要获得消息被记录的实际时间，您需要在消息中嵌入对<code class="fe lv lw lx ly b">datetime.now()</code>的调用。</p><p id="cbcb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">唯一的问题是，一旦终端窗口关闭，日志将永远丢失。因此，与其将消息输出到控制台，不如让我们探索如何将它们保存到文件中。</p><h2 id="3b29" class="nz mj it bd mk of og dn mo oh oi dp ms kr oj ok mu kv ol om mw kz on oo my op bi translated">保存到文件</h2><p id="b5f7" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">要将日志消息保存到文件中，我们需要为另外两个参数指定值:</p><ul class=""><li id="f190" class="ng nh it kk b kl km ko kp kr ni kv nj kz nk ld nu nm nn no bi translated"><code class="fe lv lw lx ly b">filename</code> —保存日志的文件的名称</li><li id="6a63" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nu nm nn no bi translated"><code class="fe lv lw lx ly b">filemode</code> —写入或追加模式，我们稍后将探讨这些模式</li></ul><p id="6f5b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们先看看如何使用<code class="fe lv lw lx ly b">write</code>模式。此模式将在每次运行应用程序时用指定的名称覆盖任何现有文件。配置如下:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="0ad7" class="nz mj it ly b gy oa ob l oc od">logging.basicConfig(<br/>    <em class="nf">filename</em><strong class="ly iu">=</strong>’test.log’,<br/>    <em class="nf">filemode</em><strong class="ly iu">=</strong>’w’,<br/>    <em class="nf">level</em><strong class="ly iu">=</strong>logging.DEBUG,<br/>    <em class="nf">format</em><strong class="ly iu">=</strong>’%(levelname)s → {datetime.now()} → %(name)s:%(message)s’<br/>)</span></pre><p id="f731" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您现在运行该程序，控制台中将不会显示任何输出。相反，会创建一个名为<code class="fe lv lw lx ly b">test.log</code>的新文件，它包含您的日志消息:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="b39c" class="nz mj it ly b gy oa ob l oc od">test.log:</span><span id="c560" class="nz mj it ly b gy oe ob l oc od">WARNING → <em class="nf">2020–08–09</em> <em class="nf">10:35:54.115026</em> → root:Warning message<br/>INFO → <em class="nf">2020–08–09</em> <em class="nf">10:35:54.115026</em> → root:Info message<br/>WARNING → <em class="nf">2020–08–09</em> <em class="nf">10:35:54.115026</em> → root:Warning message<br/>DEBUG → <em class="nf">2020–08–09</em> <em class="nf">10:35:54.115026</em> → root:Debug message<br/>CRITICAL → <em class="nf">2020–08–09</em> <em class="nf">10:35:54.115026</em> → root:Critical message</span></pre><p id="8c5c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您再次运行该程序，这 5 行将会丢失并被新的 5 行所替换。在某些情况下，这不是你想要的，所以我们可以使用<code class="fe lv lw lx ly b">append</code>模式来保留以前的数据，并在末尾写入新的行。配置如下:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="95f3" class="nz mj it ly b gy oa ob l oc od">logging.basicConfig(<br/>    <em class="nf">filename</em><strong class="ly iu">=</strong>’test.log’,<br/>    <em class="nf">filemode</em><strong class="ly iu">=</strong>’a’,<br/>    <em class="nf">level</em><strong class="ly iu">=</strong>logging.DEBUG,<br/>    <em class="nf">format</em><strong class="ly iu">=</strong>’%(levelname)s → {datetime.now()} → %(name)s:%(message)s’<br/>)</span></pre><p id="e2b8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您现在运行该程序，并查看我们的文件，您会看到有 10 行:</p><pre class="lf lg lh li gt nv ly nw nx aw ny bi"><span id="7c64" class="nz mj it ly b gy oa ob l oc od">test.log:</span><span id="2dbc" class="nz mj it ly b gy oe ob l oc od">WARNING → <em class="nf">2020–08–09</em> <em class="nf">10:35:54.115026</em> → root:Warning message<br/>INFO → <em class="nf">2020–08–09</em> <em class="nf">10:35:54.115026</em> → root:Info message<br/>WARNING → <em class="nf">2020–08–09</em> <em class="nf">10:35:54.115026</em> → root:Warning message<br/>DEBUG → <em class="nf">2020–08–09</em> <em class="nf">10:35:54.115026</em> → root:Debug message<br/>CRITICAL → <em class="nf">2020–08–09</em> <em class="nf">10:35:54.115026</em> → root:Critical message<br/>DEBUG → <em class="nf">2020-08-09</em> <em class="nf">10:36:24.699579</em> → root:Debug message<br/>INFO → <em class="nf">2020-08-09</em> <em class="nf">10:36:24.699579</em> → root:Info message<br/>CRITICAL → <em class="nf">2020-08-09</em> <em class="nf">10:36:24.699579</em> → root:Critical message<br/>CRITICAL → <em class="nf">2020-08-09</em> <em class="nf">10:36:24.699579</em> → root:Critical message<br/>CRITICAL → <em class="nf">2020-08-09</em> <em class="nf">10:36:24.699579</em> → root:Critical message</span></pre><p id="f6e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">仅此而已。您现在已经了解了日志记录的基本知识。让我们在下一部分总结一下。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="73e0" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">在你走之前</h1><p id="dd30" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">当然，记录并不是最有趣的事情。但是没有它，你基本就是瞎子。花点时间想想，如果不记录日志，您将如何监控已部署应用程序的行为和流程？我知道不容易。</p><p id="1ffb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 5 分钟内，我们已经掌握了基本知识，现在您可以在下一个应用程序中实现日志了。严格来说，它不一定是一个应用程序，您也可以将它用于数据科学项目。</p><p id="5209" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读。保重。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><p id="7172" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">喜欢这篇文章吗？成为 <a class="ae lu" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="nf">中等会员</em> </a> <em class="nf">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="oq or gp gr os ot"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd iu gy z fp oy fr fs oz fu fw is bi translated">通过我的推荐链接加入 Medium-Dario rade ci</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">medium.com</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph lo ot"/></div></div></a></div></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><p id="2527" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">加入我的私人邮件列表，获取更多有用的见解。T11】</p></div></div>    
</body>
</html>