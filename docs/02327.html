<html>
<head>
<title>An Introduction to Betfair API and How to Use it</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Betfair API简介及其使用方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b?source=collection_archive---------8-----------------------#2020-03-05">https://towardsdatascience.com/an-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b?source=collection_archive---------8-----------------------#2020-03-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e97c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">深入了解不断变化的在线赌博世界</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a9490ac2756d9a0caff5091587873ef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6g-meIx8P1PnXZEUaDCLxg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自lbbonline.com的必发标志<a class="ae ky" href="https://i.ytimg.com/vi/3MKaMjt5JLo/maxresdefault.jpg" rel="noopener ugc nofollow" target="_blank"/></p></figure><h1 id="7f0d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="034c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">网上赌博的世界是一个不断变化的野兽，很少有人能在业务之外瞥见他们不断变化的世界。Betfair是为数不多的允许所有人访问其API的在线博彩公司之一。这是因为必发交易所的工作原理与华尔街的股票市场相似，数百万用户支持并下注，希望赚些钱。一些人能够在交易所谋生，但并不是每个人都这样，因为许多人都在使用机器人通过使用API来下注。</p><p id="1a54" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我第一次想开始使用API时，主要是为了跟踪特定市场的赔率如何随时间变化，并在未来分析这些变化，看看是什么导致了价格的变化。当通读Betfair API文档时，并没有关于如何访问它的明确说明，而且文档自上传以来并没有真正更新过。所以下面我创建了一个关于如何访问Betfair API和如何使用它的基本指南。完整的笔记本可以从我的<a class="ae ky" href="https://github.com/JamieBlair1996/Betfair-API" rel="noopener ugc nofollow" target="_blank"> GitHub </a>访问。此外，在开始之前，确保您能够<strong class="lt iu"> <em class="ms">访问/放置</em></strong>Betfair的赌注。我也开始尝试访问谷歌联合实验室的API，但被拒绝访问，因为服务器设在美国，一个不能访问必发的国家。</p><h1 id="01ff" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">获得对API密钥的访问权限</h1><p id="b202" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要开始，你需要有一个必发帐户，以获得访问API的关键。要访问您的API密钥，您首先需要拥有您的SSOID，并使用<a class="ae ky" href="https://docs.developer.betfair.com/visualisers/api-ng-account-operations/" rel="noopener ugc nofollow" target="_blank">API演示工具</a>。当您登录到必发右击并选择检查元素。在Chrome上，你会看到应用程序标签和Cookies。它应该看起来像这样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/964cade9e0917fd58a7360e629212a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*BejSDm43gBcTb6mtQhymSA.jpeg"/></div></figure><p id="adaa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当您将SSOID粘贴到APING演示工具中并添加应用程序名称后，按页面底部的execute。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/14c90b5a65a0559e5655d239c46f4965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gX1jT8Z_FSrcxVMX5BE1gg.jpeg"/></div></div></figure><p id="4ad9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后，您应该会看到一个应用程序，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/4450b2d0380c7a9b8472afaef5c98ddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*FVuME5FE_gA1KwZONcg5PA.jpeg"/></div></figure><p id="001f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意有两个键。对于这个应用程序，我们使用延迟键，因为这是免费的，而另一个没有延迟，价格为200英镑。如果你想使用它，只要确保你有你的必发帐户的金额，因为它将从那里扣除。如果您已经创建了一个应用程序，那么选择getDeveloperAppKeys按钮并按底部的execute，这应该会显示这些键。</p><h1 id="0690" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">是时候获取证书和密钥了</h1><p id="410c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在你可以访问你的API密匙了，你需要下载XCA。从这里开始，遵循创建它们的指南会更有益<a class="ae ky" href="https://docs.developer.betfair.com/display/1smk3cen4v3lu3yomq5qye0ni/Certificate+Generation+With+XCA" rel="noopener ugc nofollow" target="_blank"/>这是我发现的唯一一篇特别有用的文档。在继续之前，请确保再次检查所有信息和设置是否正确，因为这些信息和设置不能更改，如果它们是错误的，则必须重新创建。当您从XCA导出证书和密钥后，就该将证书上传到您的必发帐户了。这是通过进入你的“我的必发帐户”，然后“我的详细信息”下拉菜单，并选择“安全设置”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/9ce63a9ede2a0becd53c31f55c528c4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*MUDwp7omhbbQflLRl8A7Kg.jpeg"/></div></figure><p id="401f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在此页面上，单击“自动投注程序访问”菜单旁边的“编辑”。上传。crt文件，您应该准备好开始编程了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/82ffb380753a4e02cb4f179062d4be5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JODewFUOZaye05aghe3_DA.png"/></div></div></figure><p id="4ae4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在整个例子中，我的键都有扩展名。这是因为我把它从。pem，只要它是您代码中正确的扩展名，这两种方法都有效。</p><h1 id="4af9" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤1:加载库</h1><p id="9aef" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">首先，导入使用的库</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><h1 id="b12a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤2:获取SSOID</h1><p id="a801" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">首先，我使用POST登录并访问SSOID。您在开始时找到的SSOID只是为了获得对API的访问权，一旦您有了您的密钥，您就可以随时以这种方式登录。我设置用户名，密码和应用程序密钥的方式是不必要的，但它会证明以后更省时。在这种情况下，为了方便起见，我将我的证书和密钥保存在与笔记本相同的地方，但是您可以将它们保存在其他地方并使用绝对地址。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><h1 id="e673" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤3:查询API以获取特定的市场</h1><p id="0243" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这里，我们设置将发布到的URL、请求和标题。这个特殊的请求将提供Betfair所有可用运动的列表。下面的URL设置一次，并且是所有请求发送到的相同URL。event_req是发送到URL的请求。这必须设置如下赌注可以改变时，在这种格式。使用<a class="ae ky" href="https://docs.developer.betfair.com/display/1smk3cen4v3lu3yomq5qye0ni/Betting+API" rel="noopener ugc nofollow" target="_blank">这里的</a>可以改变方法。req检索HTML响应，然后转换成json，让我们可以读取它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="dfcd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">json响应由字典和列表组成，或者更准确地说，由包含字典列表的字典组成。结果显示市场名称、市场ID(稍后在过滤即将到来的比赛时使用)和市场计数(可下注的市场数量)。这将提供包括正在播放和即将播放的市场的数量，这可以设置为仅显示即将播放或正在播放，稍后将会提到。下面是上面代码的输出。请注意,“id”没有遵循通常的索引方式，而是从1开始，许多事件甚至没有遵循该约定。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="8461" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是如何查看事件名称的示例。注意前面提到的字典和包含字典的字典列表。如果在任何时候你不确定使用什么样的字典键。像这样的键()</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="2366" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">接下来，我们将继续寻找如何为当前正在进行的特定活动找到可用的市场。通过使用listMarketTypes方法，请求请求所有市场，通过添加过滤器，可以对其进行微调，以查看特定于某个事件的市场。使用的第一个过滤器只查找特定id的事件，在本例中，它是使用id 1的足球。另一个过滤器是它是否是inplay，如果省略它，它将提供inplay和not inplay市场，这样它可以有效地在inplay和not之间切换。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="d5d4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">通过使用listMarketCatalogue方法，上述市场类型可用于找出哪些球队正在所选市场进行比赛。坚持将足球作为事件，并添加了过滤器marketTypeCodes。在本例中，使用了MATCH_ODDS，并显示了该市场的比赛项目。另一个补充是设置时间范围。这是在将它添加到请求之前设置的，因为用单个名称添加到请求比用一大行更容易。响应被排序以显示第一个要开始的夹具，并且将只有1个结果。请注意，最大结果将只接受最大值1000。为了看比赛中的球队，增加了市场预测。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="e36c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从现在开始，我们将关注赛马。让我们为我们的API请求添加更多的细节。您可以看到，我已经从请求中提取了一些变量，这是为了在需要进行更改时更加方便。变量与上面的示例相同，只是增加了元数据和inplay。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="38c3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此请求的结果将在接下来的24小时内给出英国和爱尔兰的所有比赛。当检查每个比赛时，它显示与比赛相关的所有信息，重要的是marketId，这在以后会很有用。它还列出了跑步者和与他们相关的所有元数据，包括马的形态，这也很重要，还有它的selectionId。为了进一步研究这个输出，它和以前一样。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><h1 id="1906" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤4:查询API以获得最新的赔率</h1><p id="74d9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一个API请求可以用来获得你所选择的市场中某个特定团队/个人/马匹的赔率。为此将使用上面的马。为了获得这匹马的赔率，API URL的设置与前面的URL相同，只是将请求listRunnerBook。使用的操作可以在这里找到<a class="ae ky" href="https://docs.developer.betfair.com/display/1smk3cen4v3lu3yomq5qye0ni/listRunnerBook" rel="noopener ugc nofollow" target="_blank">。注意:在该市场中，每个请求只能传入一个marketId和一个selectionId。如果传入的selectionId不是有效的/不属于该市场，则调用仍然有效，但只返回市场数据。</a></p><p id="a608" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要获得必要的id，您可以查看输出并手动输入，也可以将它们设置为变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="86d5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果传递了无效的selectionId，则这是输出。没有显示赔率，因为没有具体的赔率。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="6897" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果传递了有效的selectionId，这就是输出。可以看出，现在有了与所使用的selectionId相关的信息。它显示了它在必发交易所最后交易的价格，以及它可以支持的价格和它可以反对的价格。我将不会进入什么是一个lay bet，对于这个例子，将只看第一个价格可支持。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><h1 id="99f5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">第五步:把所有的加在一起，再加一点数学</h1><p id="6e69" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在，基础知识已经涵盖了如何在24小时内进行比赛，参加比赛的马匹以及特定马匹的赔率。为什么不把它们合并成一个函数，再增加几个功能呢？</p><p id="564e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">将创建的函数将计算每场比赛中每匹马的平均状态。然后，它将确定哪匹马具有最好的平均形式，并将它添加到数据帧中，与所选马、比赛和马的名字的赔率一起。</p><p id="c577" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">马的形态是由它在最近6场比赛中的位置组成的。然而，并不是每匹马都可以排名，有一些不同的代码在赛马中使用，不能添加到马的平均水平。为了解决这个问题，你可以用任何你认为合理的值来衡量这些代码，我在下面已经这样做了。现在，一些代码将很少出现，但这并不意味着他们不会，这就是为什么我已经添加了他们，否则它会崩溃。这个函数也是唯一需要运行的东西，这就是为什么我添加了关于获取SSOID的第一部分。</p><p id="b4e3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该函数的第一部分是将在函数中使用的变量和列表的声明，以及pandas数据帧的创建。之后和之前一样，当得到SSOID，然后得到比赛和跑步者。正是在这一点上，形式是平均的，正如可以看到的，这是一个有点乱，需要一些清理，但目前它按照要求运作。</p><p id="0451" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">可以看出，平均数被添加到列表中。然后遍历这个列表，并对照开始时设置为100的最低平均值进行检查。如果当前列表位置的平均值小于最低平均值，那么新的平均值被设置为新的最低平均值，马的名称和selectionId被附加到列表中。一旦列表被遍历，具有最佳平均值的马的赔率通过使用上面显示的方法被收集。然后将这些值添加到数据帧中。使用horsename[-1]和selectionID[-1]的原因是因为需要列表中的最后一项。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">该函数的输出</p></figure><h1 id="e252" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="6f25" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在你知道了。通过有点混乱的必发API的基本指南。现在，有更多的方法来使用必发API，我只是触及了其中的一些可能性。form函数只是在选择一匹马下注时要遵循的一个指导原则，因为还有许多其他变量没有考虑到，如马的体重、骑师、驯马师、赛道条件或天气。就像任何与预测比赛或比赛结果有关的事情一样，要有所保留，并结合你在决定下赌注时通常会查看的任何其他信息来使用它。</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><p id="1f66" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> <em class="ms">注来自《走向数据科学》的编辑:</em> </strong> <em class="ms">虽然我们允许独立作者根据我们的</em> <a class="ae ky" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="ms">规则和指导方针</em> </a> <em class="ms">发表文章，但我们不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae ky" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="ms">读者术语</em> </a> <em class="ms">。</em></p></div></div>    
</body>
</html>