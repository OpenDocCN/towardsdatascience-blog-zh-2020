<html>
<head>
<title>3 Ways to Transform your SAS Data Workflow with SAS-SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SAS-SQL转变您的SAS数据工作流的3种方式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-ways-to-transform-your-sas-workflow-with-sas-sql-e121968b2029?source=collection_archive---------58-----------------------#2020-06-12">https://towardsdatascience.com/3-ways-to-transform-your-sas-workflow-with-sas-sql-e121968b2029?source=collection_archive---------58-----------------------#2020-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e092" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用SAS？利用SQL来简化您的工作。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b8ac33987d5ca5d664eac0357a7ca8c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32ynegUSgcN3EWvmwZYejA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/photos/f9qtLeroLNQ" rel="noopener ugc nofollow" target="_blank"> Roma Ryabchenko </a>在Unsplash上拍摄</p></figure><ol class=""><li id="173f" class="kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">介绍</li><li id="cfbd" class="kw kx iq ky b kz lo lb lp ld lq lf lr lh ls lj lk ll lm ln bi translated">在SAS中使用SQL的好处</li><li id="8ebd" class="kw kx iq ky b kz lo lb lp ld lq lf lr lh ls lj lk ll lm ln bi translated">示例数据集</li><li id="f446" class="kw kx iq ky b kz lo lb lp ld lq lf lr lh ls lj lk ll lm ln bi translated">示例1:连接数据集</li><li id="135a" class="kw kx iq ky b kz lo lb lp ld lq lf lr lh ls lj lk ll lm ln bi translated">示例#2:向新列添加值</li><li id="8ce3" class="kw kx iq ky b kz lo lb lp ld lq lf lr lh ls lj lk ll lm ln bi translated">示例#3:选择列中的唯一值</li><li id="56a9" class="kw kx iq ky b kz lo lb lp ld lq lf lr lh ls lj lk ll lm ln bi translated">结论</li></ol></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="1fd8" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated"><strong class="ky ir"> 1。简介</strong></p><p id="effb" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">作为一个必须在新的工作场所快速掌握SAS的人，我很高兴看到我可以使用我现有的SQL知识来补充我公司主要使用SAS的分析团队。一般来说，我发现在MySQL和PostgreSQL等其他SQL平台上可以做的大多数事情都是适用的，尽管语法可能会有所不同。</p><p id="6605" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">在对我们现有的SAS代码进行了一些故障排除之后，我能够向我的同事展示SQL可以改进我们工作流的一些方便的方法。下面我用三个例子来演示其中的一些方法。</p><p id="6ef7" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated"><strong class="ky ir"> 2。在SAS中使用SQL的一些好处</strong></p><ol class=""><li id="0e88" class="kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated"><strong class="ky ir">可读性</strong> — SQL可读性强，学习直观。</li><li id="f68b" class="kw kx iq ky b kz lo lb lp ld lq lf lr lh ls lj lk ll lm ln bi translated">SQL可以一步完成<strong class="ky ir">操作、汇总、排序等多种功能。</strong></li><li id="1c78" class="kw kx iq ky b kz lo lb lp ld lq lf lr lh ls lj lk ll lm ln bi translated">如果您已经了解SQL，并且是SAS新手，您可以<strong class="ky ir">立即开始为您的团队做出贡献。</strong></li><li id="a7eb" class="kw kx iq ky b kz lo lb lp ld lq lf lr lh ls lj lk ll lm ln bi translated">结合SQL和SAS数据步骤可以简化工作流程。</li><li id="f31f" class="kw kx iq ky b kz lo lb lp ld lq lf lr lh ls lj lk ll lm ln bi translated">SQL是大多数数据库使用的ANSI标准语言。</li></ol></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="8731" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated"><strong class="ky ir"> 3。我们的示例数据集</strong></p><p id="0424" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">我们在示例中使用的两个表来自Beth Morrison 创建的<a class="ae kv" href="https://www.kaggle.com/kerneler/starter-patagonia-clothing-ded30fa1-c" rel="noopener ugc nofollow" target="_blank">巴塔哥尼亚服装数据集。注意，对于这些例子，我使用的是SAS Studio </a>，尽管同样的语法也可以用在其他SAS平台上，比如SAS Viya或SAS Enterprise。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mn"><img src="../Images/137d3d3ee58f053c3b86dc9a7fb383ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*tGdjkKIvbcuFgkrRQW64dg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">“服装_类别”表。图片作者。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mo"><img src="../Images/e717a3e242445b6eb272d6f44040a2ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*krEYBCLy6_PUISE9bxGkeA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">“服装_列表”表。图片由作者提供。</p></figure><p id="1f07" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated"><strong class="ky ir"> 4。示例1:连接数据集</strong></p><p id="760e" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">假设您想找出“服装列表”表中哪些服装适合陆地或水域。在这种情况下，您需要使用公共列“item_category”将“clothing_category”表连接到“clothing_list”表。</p><p id="1a5f" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">SAS: 在SAS中将表连接或合并在一起的等效操作可能是一个多步骤的过程。<a class="ae kv" href="https://documentation.sas.com/?docsetId=lrcon&amp;docsetTarget=n1tgk0uanvisvon1r26lc036k0w7.htm&amp;docsetVersion=9.4&amp;locale=en#p1ozz99fzn4gtan1hohd44leeod1" rel="noopener ugc nofollow" target="_blank">请在此参考SAS文档</a>。</p><p id="72cb" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated"><strong class="ky ir"> SQL: </strong>用SQL-SAS连接表很简单，可以节省时间。注意，SQL-SAS中的“JOIN”和“LEFT JOIN”是相同的。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="6931" class="mu mv iq mq b gy mw mx l my mz">PROC SQL;<br/>SELECT *<br/>FROM clothing_category<br/>JOIN clothing_list<br/>    ON<br/>clothing_category.item_category = clothing_list.item_category;<br/>QUIT;</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/0acd490fda0962ba97b547e29e6f034f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vuKtYQTmpBuyHXcFYVH2pw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">上述连接产生的输出表。现在，您可以看到“服装列表”表中的“物品类别”与“服装类别”表中的“土地”或“水”值相匹配。图片由作者提供。</p></figure><p id="7b74" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated"><strong class="ky ir"> 5。示例2:向新列添加值</strong></p><p id="1c66" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">假设您希望根据另一列的值为新列赋值。这里，我们将添加一个列，该列的值将指定“clothing_list”中的每件商品的价格是低于100美元还是高于100美元。</p><p id="5126" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated"><strong class="ky ir"> SAS: </strong>在SAS中，您可以运行一个数据步骤，使用LENGTH函数创建一个新列“price_category”，然后使用“IF-THEN-ELSE”语句为该列中的行赋值。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="9a21" class="mu mv iq mq b gy mw mx l my mz">DATA work.output_table;<br/>SET work.clothing_list;<br/>LENGTH price_category $50.; <br/>    IF item_price &lt; 100 THEN price_category = 'Less than $100';<br/>    ELSE IF item_price &gt; 100 THEN price_category = 'More than $100';<br/>    ELSE price_category = 'Not available';<br/>RUN;</span></pre><p id="8545" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated"><strong class="ky ir"> SQL: </strong>您可以在SQL-SAS中使用CASE WHEN语句，而不是使用带有多个IF语句的SAS来运行数据步骤。这也为您提供了在<strong class="ky ir">单步</strong>中进行聚合(分组依据)、排序(排序依据)等操作的灵活性。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="b89e" class="mu mv iq mq b gy mw mx l my mz">PROC SQL;<br/>SELECT item_category, item_name, item_price,<br/> (CASE<br/>        WHEN item_price &lt; 100 THEN 'Less than $100'<br/>        WHEN item_price &gt; 100 THEN 'More than $100'<br/>        ELSE 'Not available'<br/>  END) AS price_category<br/>FROM work.clothing_list<br/>;<br/>QUIT;</span></pre><p id="4c93" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">运行上述任一代码块都将输出下表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/6bf3c1384a1eee607e9c6db36a799c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwAhk-tgPmgyctZGqNEk-g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">请注意“价格类别”列。图片由作者提供。</p></figure><p id="fcd0" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated"><strong class="ky ir"> 6。示例#3:选择列中的唯一值</strong></p><p id="4a69" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">假设您想在一个列中查找唯一值，例如商店中服装的唯一商品价格的数量。这就是SAS-SQL中的<strong class="ky ir"> SELECT DISTINCT </strong>大放异彩的地方。</p><p id="d3f2" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated"><strong class="ky ir"> SAS: </strong>在SAS中，您可以使用PROC SORT找到唯一值:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="4e4b" class="mu mv iq mq b gy mw mx l my mz">PROC SORT DATA = work.clothing_list<br/>          OUT = work.unique_values<br/>          (KEEP = item_price) <br/>          DUPOUT = work.duplicate_table<br/>          (KEEP = item_price) <br/>          NODUPKEY<br/>          ;<br/>    BY item_price; /*this is the column of interest*/<br/>RUN;</span></pre><p id="ffa1" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">在这种情况下，SAS的优点在于,“DUPOUT”选项除了输出包含唯一商品价格列表的“work.unique_values”表之外，还输出“work.duplicate_table”表中额外重复值的表。您还可以选择输出整个匹配行。</p><p id="fdd8" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">“NODUPKEY”告诉SAS只保留输出表中BY语句中列出的列的每个唯一值的第一个匹配项。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/66d6e91d046a06618716c7cd7de95be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*O-FXHuX0gkVsf2ietw6jLA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">工作中的重复项目价格。重复_表格。图片作者。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/96da9c8b6abe42419c91453560e64e70.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*Pi-C-1ZC1zcrOLPygj8h4A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作品中独特的物品价格。唯一值表。这里可以看到“75”和429”也在这个表中。图片由作者提供。</p></figure><p id="7f01" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated"><strong class="ky ir"> SQL: </strong>在SQL中，只需编写如下几行代码，就可以获得与上面的表相同的输出，其中包含唯一的值。注意:这不会输出带有额外重复行的表。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="698b" class="mu mv iq mq b gy mw mx l my mz">PROC SQL;<br/>SELECT DISTINCT item_price<br/>FROM clothing_list;<br/>QUIT;</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="2eb7" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">7。结论</p><p id="97cc" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">我希望这能帮助您更多地了解在SAS中使用SQL的潜力！在实践中，我发现使用SAS数据步骤和SQL代码块最适合我的数据准备工作。</p><p id="75e0" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">您如何在SAS中使用SQL来改进您的工作流程？想了解SQL-SAS如何节省您的时间并简化您的代码吗？请在下面的评论中告诉我！</p><p id="5fc5" class="pw-post-body-paragraph ma mb iq ky b kz la jr mc lb lc ju md ld me mf mg lf mh mi mj lh mk ml mm lj ij bi translated">—吉米</p></div></div>    
</body>
</html>