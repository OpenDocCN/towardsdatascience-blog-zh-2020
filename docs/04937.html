<html>
<head>
<title>Why computing standard deviation in pandas and NumPy yields different results?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么计算熊猫和 NumPy 的标准差会产生不同的结果？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-computing-standard-deviation-in-pandas-and-numpy-yields-different-results-5b475e02d112?source=collection_archive---------36-----------------------#2020-04-29">https://towardsdatascience.com/why-computing-standard-deviation-in-pandas-and-numpy-yields-different-results-5b475e02d112?source=collection_archive---------36-----------------------#2020-04-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fbb0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">好奇？让我们来谈谈统计数据、人口和样本…</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bd3b8f5e1339c81c5af7331031de291f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f4Q_KDYnLfv2BIcNIOm-ig.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1044090" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>的 Gerd Altmann 提供</p></figure><p id="61da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有多少人注意到当你用 pandas 计算标准差并与 NumPy 函数的结果比较时，你会得到不同的数字？</p><blockquote class="lv"><p id="79e2" class="lw lx it bd ly lz ma mb mc md me lu dk translated">我打赌你们中的一些人没有意识到这个事实。即使你知道，你也可能会问:为什么？</p></blockquote><p id="379c" class="pw-post-body-paragraph kz la it lb b lc mf ju le lf mg jx lh li mh lk ll lm mi lo lp lq mj ls lt lu im bi translated">在这篇短文中，我们将证明:</p><blockquote class="mk ml mm"><p id="f0e4" class="kz la mn lb b lc ld ju le lf lg jx lh mo lj lk ll mp ln lo lp mq lr ls lt lu im bi translated">使用两个库的标准偏差结果确实是不同的(至少乍一看是这样)，</p><p id="31be" class="kz la mn lb b lc ld ju le lf lg jx lh mo lj lk ll mp ln lo lp mq lr ls lt lu im bi translated">讨论为什么会这样(关注总体、样本，以及这如何影响每个库的标准偏差的计算)</p><p id="c892" class="kz la mn lb b lc ld ju le lf lg jx lh mo lj lk ll mp ln lo lp mq lr ls lt lu im bi translated">最后，向您展示如何使用 pandas 和 NumPy 获得相同的结果(最后，他们应该就标准差这样一个简单的计算达成一致)</p></blockquote><p id="62b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始吧。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="9057" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">NumPy 和 pandas 的标准差</strong></p><p id="9dbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先创建一个带有权重和高度的简单数据框，稍后我们可以使用它来计算标准差。</p><pre class="kj kk kl km gt my mz na nb aw nc bi"><span id="c3d8" class="nd ne it mz b gy nf ng l nh ni">import pandas as pd</span><span id="c38b" class="nd ne it mz b gy nj ng l nh ni">df = pd.DataFrame({'height' : [161, 156, 172], <br/>                   'weight': [67, 65, 89]})<br/>df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/bad66460a469610f5da3bf4e43439e32.png" data-original-src="https://miro.medium.com/v2/resize:fit:270/format:webp/1*AQFYY5k-nvGQHZ3pURG9TQ.png"/></div></figure><p id="aeba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个只有两列三行的数据框。我们将只关注一个列，即<em class="mn"> weight </em>，并比较这个特定列的 pandas 和 NumPy 的标准偏差结果。</p><p id="d2c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">先从<strong class="lb iu">熊猫</strong>说起吧:</p><pre class="kj kk kl km gt my mz na nb aw nc bi"><span id="bd33" class="nd ne it mz b gy nf ng l nh ni">df.weight.std()<br/>13.316656236958787</span></pre><p id="87b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们使用<strong class="lb iu"> NumPy </strong>做同样的事情:</p><pre class="kj kk kl km gt my mz na nb aw nc bi"><span id="02a4" class="nd ne it mz b gy nf ng l nh ni">import numpy as np<br/>np.std(df.weight)<br/>10.873004286866728</span></pre><blockquote class="lv"><p id="5a97" class="lw lx it bd ly lz nl nm nn no np lu dk translated">我们得到 13.31 和 10.87。它们确实是完全不同的数字，为什么会这样呢？</p></blockquote></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="7d40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">人口标准差</strong></p><p id="7e3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出现上述数字差异的原因是软件包使用不同的公式来计算标准偏差。最常见的标准差公式是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/c60cba03c76b6768fea267b588ec1f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*s0bAPk3p8oqTd8nmBxg8aA.png"/></div></figure><p id="7a54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中:</p><p id="fa32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mn"> σ </em> =总体标准差</p><p id="62bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">人口数量</p><p id="b2a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mn"> xi </em> =来自总体的每个值</p><p id="e4c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mn"> </em> =人口的意思</p><p id="0093" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个等式指的是<strong class="lb iu">总体标准差</strong>，这是<strong class="lb iu"> NumPy </strong>默认使用的。</p><p id="3956" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们收集这些数据时，实际上很少与人群打交道。更有可能的是，我们将研究人口样本，而不是整个人口本身。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="2c21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">样本标准偏差</strong></p><p id="79ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们研究样本而不是人群时，问题会有所改变。因此，标准差的新公式为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/5804114959b40fc916917c3f17ee62ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*NSHdb6u4vKISMqJWHPjubw.png"/></div></figure><p id="4bee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中:</p><p id="5daf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mn"> σ </em> =样本标准偏差</p><p id="6562" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mn"> N </em> =样本的大小</p><p id="1ca2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mn"/>=来自样本的每个值</p><p id="3557" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mn"> </em> =样本意思</p><p id="6a90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个等式指的是<strong class="lb iu">样本标准差</strong>，这是<strong class="lb iu">熊猫</strong>默认使用的。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="89a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">总体和样本之间的差异</strong></p><p id="f6de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你已经注意到的，区别在于等式的分母。当我们计算<strong class="lb iu">样本标准差</strong>时，我们除以<em class="mn"> N- 1 </em>，而不是像我们计算<strong class="lb iu">总体标准差时那样只使用<em class="mn"> N </em>。</strong></p><p id="89ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为在统计学中，当从样本中计算总体标准差时，为了得到一个无偏估计量，我们应该使用(N-1)。这就是所谓的一个自由度，我们减去 1 是为了得到一个无偏估计量。</p><p id="9776" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将不讨论为什么我们应该使用一个自由度的细节，因为这是一个相当复杂的概念。如果你愿意，你可以看这个视频来更好地理解。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="fdc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">那么熊猫标准差是正确的吗？</strong></p><p id="a27b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我告诉过你，为了得到无偏估计量，你应该用 N-1。这是通常的情况，因为大多数情况下你要处理的是样本，而不是整个群体。这就是为什么熊猫的默认标准差是使用一个自由度计算的。</p><p id="2807" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，情况可能并不总是如此，所以在使用其中一个之前，请确定您的数据是什么。同样，如果您想使用一个特定的库来实现其中一个，您可以使用参数 ddof 来控制两个包中的自由度。</p><p id="44e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一下以前的例子，在这个例子中，我们使用 pandas 得到了 13.31σ=，使用 NumPy 得到了 10.87σ。</p><pre class="kj kk kl km gt my mz na nb aw nc bi"><span id="3e4f" class="nd ne it mz b gy nf ng l nh ni">df.weight.std()<br/>13.316656236958787</span><span id="f726" class="nd ne it mz b gy nj ng l nh ni">import numpy as np<br/>np.std(df.weight)<br/>10.873004286866728</span></pre><p id="41fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过使用<em class="mn"> ddof </em>参数来更改 NumPy 中的自由度，以将其更改为无偏估计量:</p><pre class="kj kk kl km gt my mz na nb aw nc bi"><span id="b479" class="nd ne it mz b gy nf ng l nh ni">import numpy as np<br/>np.std(df.weight, ddof=1)<br/>13.316656236958787</span></pre><p id="1b24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到，现在结果与熊猫计算给出的默认标准差相同。</p><p id="533f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，您可以更改默认的熊猫标准差计算，使其不使用自由度:</p><pre class="kj kk kl km gt my mz na nb aw nc bi"><span id="aa54" class="nd ne it mz b gy nf ng l nh ni">df.weight.std(ddof=0)<br/>10.873004286866728</span></pre></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="2496" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">总结</strong></p><p id="4f7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们讨论了计算样本和总体的标准差，并触及了统计学中自由度的概念。</p><p id="6750" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经演示了如何在 pandas 和 NumPy 中计算标准偏差，以及如何能够控制两个包中的自由度。</p><p id="8ea8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这解决了最初的好奇心，并解释了为什么在使用一个库或另一个库时，标准差结果最初似乎是不同的。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="fa94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mn">最初发表于 aboutdatablog.com: </em> <a class="ae ky" href="https://www.aboutdatablog.com/post/why-computing-standard-deviation-in-pandas-and-numpy-yields-different-results" rel="noopener ugc nofollow" target="_blank">为什么计算熊猫和 NumPy 的标准差会得出不同的结果？</a>，<em class="mn">2020 年 4 月 29 日。</em></p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="ce03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mn"> PS:我正在 Medium 和</em><a class="ae ky" href="https://www.aboutdatablog.com/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="mn">aboutdatablog.com</em></strong></a><em class="mn">上撰写以简单易懂的方式解释基本数据科学概念的文章。你可以订阅我的</em> <a class="ae ky" href="https://medium.com/subscribe/@konkiewicz.m" rel="noopener"> <strong class="lb iu"> <em class="mn">邮件列表</em> </strong> </a> <em class="mn">在我每次写新文章的时候得到通知。如果你还不是中等会员，你可以在这里加入</em><a class="ae ky" href="https://medium.com/@konkiewicz.m/membership" rel="noopener"><strong class="lb iu"><em class="mn"/></strong></a><em class="mn">。</em></p><p id="e435" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面还有一些你可能喜欢的帖子</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><div class="kj kk kl km gt nr"><a rel="noopener follow" target="_blank" href="/what-are-lambda-functions-in-python-and-why-you-should-start-using-them-right-now-75ab85655dc6"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">python 中的 lambda 函数是什么，为什么你现在就应该开始使用它们</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">初学者在 python 和 pandas 中开始使用 lambda 函数的快速指南。</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of ks nr"/></div></div></a></div><div class="og oh gp gr oi nr"><a rel="noopener follow" target="_blank" href="/jupyter-notebook-autocompletion-f291008c66c"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">Jupyter 笔记本自动完成</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">数据科学家的最佳生产力工具，如果您还没有使用它，您应该使用它…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="oj l oc od oe oa of ks nr"/></div></div></a></div><div class="og oh gp gr oi nr"><a rel="noopener follow" target="_blank" href="/7-practical-pandas-tips-when-you-start-working-with-the-library-e4a9205eb443"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">当你开始与图书馆合作时，7 个实用的熊猫提示</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">解释一些乍一看不那么明显的东西…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="ok l oc od oe oa of ks nr"/></div></div></a></div><div class="og oh gp gr oi nr"><a rel="noopener follow" target="_blank" href="/pandas-data-manipulation-functions-7b3519fc1370"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">Pandas 数据操作函数:apply()、map()和 applymap()</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">以及如何在熊猫身上正确使用它们…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="ol l oc od oe oa of ks nr"/></div></div></a></div></div></div>    
</body>
</html>