<html>
<head>
<title>Reshape pandas dataframe with melt in Python — tutorial and visualization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 中的 melt 重塑熊猫数据框—教程和可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/reshape-pandas-dataframe-with-melt-in-python-tutorial-and-visualization-29ec1450bb02?source=collection_archive---------3-----------------------#2020-05-16">https://towardsdatascience.com/reshape-pandas-dataframe-with-melt-in-python-tutorial-and-visualization-29ec1450bb02?source=collection_archive---------3-----------------------#2020-05-16</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="c614" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph">PYTHON 熊猫数据帧重塑</h2><div class=""/><div class=""><h2 id="7903" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">使用 pd.melt 将宽转换为长</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/b80f3a1030a1b42616b5f9dc7b256dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMO1eRvaGs3cnhMCkmeYyw@2x.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">如何在 Python 中使用 pd.melt()将 pandas 数据帧由宽变长(此处运行代码<a class="ae li" href="https://beta.deepnote.com/project/d1350ad6-bcb4-4c3d-857b-c29d01b8a803#%2Fmelt.ipynb" rel="noopener ugc nofollow" target="_blank"/>)</p></figure><p id="d962" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">有许多不同的方法可以将熊猫的数据帧从宽 T7 变成长 T8。但是<code class="fe mf mg mh mi b">melt()</code>方法是最灵活的，并且可能是你一旦学好就需要使用的唯一方法，就像你只需要学习一种<a class="ae li" rel="noopener" target="_blank" href="/reshape-pandas-dataframe-with-pivot-table-in-python-tutorial-and-visualization-2248c2012a31">方法</a> <code class="fe mf mg mh mi b"><a class="ae li" rel="noopener" target="_blank" href="/reshape-pandas-dataframe-with-pivot-table-in-python-tutorial-and-visualization-2248c2012a31">pivot_table()</a></code>就可以从<strong class="ll je">长到宽进行整形(</strong>见下面我的另一篇文章)。</p><div class="mj mk gq gs ml mm"><a rel="noopener follow" target="_blank" href="/reshape-pandas-dataframe-with-pivot-table-in-python-tutorial-and-visualization-2248c2012a31"><div class="mn ab fp"><div class="mo ab mp cl cj mq"><h2 class="bd je gz z fq mr fs ft ms fv fx jd bi translated">用 Python 中的 pivot_table 重塑熊猫数据框—教程和可视化</h2><div class="mt l"><h3 class="bd b gz z fq mr fs ft ms fv fx dk translated">使用 pd.pivot_table 将 long 转换为 wide</h3></div><div class="mu l"><p class="bd b dl z fq mr fs ft ms fv fx dk translated">towardsdatascience.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na lc mm"/></div></div></a></div><p id="a130" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">本教程将带你通过使用与熊猫数据帧相关的<code class="fe mf mg mh mi b">pd.melt()</code>或<code class="fe mf mg mh mi b">melt</code>方法来重塑数据帧。在像 R 这样的其他语言中，melt 也被称为 gather。另外，R 也有一个<code class="fe mf mg mh mi b">melt</code>函数，以同样的方式工作。</p><div class="mj mk gq gs ml mm"><a rel="noopener follow" target="_blank" href="/reshape-r-dataframes-wide-to-long-with-melt-tutorial-and-visualization-ddf130cd9299"><div class="mn ab fp"><div class="mo ab mp cl cj mq"><h2 class="bd je gz z fq mr fs ft ms fv fx jd bi translated">利用熔体重塑宽到长的 R 数据帧——教程和可视化</h2><div class="mt l"><h3 class="bd b gz z fq mr fs ft ms fv fx dk translated">你唯一需要的函数和教程</h3></div><div class="mu l"><p class="bd b dl z fq mr fs ft ms fv fx dk translated">towardsdatascience.com</p></div></div><div class="mv l"><div class="nb l mx my mz mv na lc mm"/></div></div></a></div><p id="14e9" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我强烈建议您在阅读本文时尝试一下 Python 中的代码。打开我的<a class="ae li" href="https://beta.deepnote.com/project/d1350ad6-bcb4-4c3d-857b-c29d01b8a803" rel="noopener ugc nofollow" target="_blank"> <strong class="ll je"> DeepNote 笔记本</strong> </a>(你只能运行但不能编辑这个笔记本)，边看这篇文章边运行单元格。</p><p id="4c49" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">另外，你可能想看看官方的熊猫文档和我的 numpy 重塑教程:</p><div class="mj mk gq gs ml mm"><a rel="noopener follow" target="_blank" href="/reshaping-numpy-arrays-in-python-a-step-by-step-pictorial-tutorial-aed5f471cf0b"><div class="mn ab fp"><div class="mo ab mp cl cj mq"><h2 class="bd je gz z fq mr fs ft ms fv fx jd bi translated">在 Python 中重塑 numpy 数组—一步一步的图形教程</h2><div class="mt l"><h3 class="bd b gz z fq mr fs ft ms fv fx dk translated">本教程和备忘单提供了可视化效果，帮助您理解 numpy 如何重塑数组。</h3></div><div class="mu l"><p class="bd b dl z fq mr fs ft ms fv fx dk translated">towardsdatascience.com</p></div></div><div class="mv l"><div class="nc l mx my mz mv na lc mm"/></div></div></a></div></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><h1 id="ef89" class="nk nl iu bd nm nn no np nq nr ns nt nu kj nv kk nw km nx kn ny kp nz kq oa ob bi translated">宽与长数据帧</h1><p id="e0dd" class="pw-post-body-paragraph lj lk iu ll b lm oc ke lo lp od kh lr ls oe lu lv lw of ly lz ma og mc md me in bi translated">如果我们观察一个<strong class="ll je">宽的</strong>数据帧并将其与一个长的<strong class="ll je"> </strong>数据帧进行比较，就很容易理解它是什么或者看起来是什么样子。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div class="gi gj oh"><img src="../Images/705bffcbf9ec5a3124669dfd25c772fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*vjY-jXg_gEfDQK4h_eAY6g@2x.png"/></div><p class="le lf gk gi gj lg lh bd b be z dk translated">可以使用 pd.melt()(运行代码<a class="ae li" href="https://beta.deepnote.com/project/d1350ad6-bcb4-4c3d-857b-c29d01b8a803#%2Fmelt.ipynb" rel="noopener ugc nofollow" target="_blank">此处</a>)来熔化/堆叠宽熊猫数据帧</p></figure><p id="78e6" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">下面是相应的数据帧(具有相同的信息),但以<strong class="ll je">长</strong>的形式:</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div class="gi gj oi"><img src="../Images/486bbc62442e66338d187d2fe9d4a9a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*GeRb2RrGLgkicEm-PKMm4w@2x.png"/></div><p class="le lf gk gi gj lg lh bd b be z dk translated">可以使用 pd.pivot_table()来“解除”Long pandas 数据帧(本文未涉及)</p></figure><p id="bf1e" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">在开始我们的<code class="fe mf mg mh mi b">pd.melt</code>教程之前，让我们用<code class="fe mf mg mh mi b">pd.DataFrame</code>用 Python 重新创建上面的宽数据帧。</p><pre class="kt ku kv kw gu oj mi ok ol aw om bi"><span id="f050" class="on nl iu mi b gz oo op l oq or">import pandas as pd</span><span id="7052" class="on nl iu mi b gz os op l oq or"># create wide dataframe<br/>df_wide = pd.DataFrame(<br/>  {"student": ["Andy", "Bernie", "Cindy", "Deb"],<br/>   "school":  ["Z", "Y", "Z", "Y"],<br/>   "english": [10, 100, 1000, 10000],  # eng grades<br/>   "math":    [20, 200, 2000, 20000],  # math grades<br/>   "physics": [30, 300, 3000, 30000]   # physics grades<br/>  }<br/>)</span></pre></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><h1 id="ac63" class="nk nl iu bd nm nn no np nq nr ns nt nu kj nv kk nw km nx kn ny kp nz kq oa ob bi translated">熔体实施例 1</h1><p id="828f" class="pw-post-body-paragraph lj lk iu ll b lm oc ke lo lp od kh lr ls oe lu lv lw of ly lz ma og mc md me in bi translated">我们通过<code class="fe mf mg mh mi b">id_vars</code>指定标识符列来融合数据帧。“剩余的”非标识符列(英语、数学、物理)将被融合或堆叠成一列。</p><p id="3eea" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">将创建一个新的指示器列(包含值英语、数学、物理)，我们可以通过<code class="fe mf mg mh mi b">var_name</code>重命名这个新列(类)。我们也可以通过<code class="fe mf mg mh mi b">value_name</code>重命名包含所有实际成绩的列(gRaDe)。</p><pre class="kt ku kv kw gu oj mi ok ol aw om bi"><span id="a534" class="on nl iu mi b gz oo op l oq or">print(df_wide)<br/>&gt; student school  english   math  physics<br/>     Andy      Z       10     20       30<br/>   Bernie      Y      100    200      300<br/>    Cindy      Z     1000   2000     3000<br/>      Deb      Y    10000  20000    30000</span><span id="abfe" class="on nl iu mi b gz os op l oq or">df_wide.melt(id_vars=["student", "school"],<br/>             var_name="cLaSs",  # rename<br/>             value_name="gRaDe")  # rename</span><span id="66d1" class="on nl iu mi b gz os op l oq or">&gt;  student school    cLaSs  gRaDe<br/>0     Andy      Z  english     10<br/>1   Bernie      Y  english    100<br/>2    Cindy      Z  english   1000<br/>3      Deb      Y  english  10000<br/>4     Andy      Z     math     20<br/>5   Bernie      Y     math    200<br/>6    Cindy      Z     math   2000<br/>7      Deb      Y     math  20000<br/>8     Andy      Z  physics     30<br/>9   Bernie      Y  physics    300<br/>10   Cindy      Z  physics   3000<br/>11     Deb      Y  physics  30000</span></pre><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ot"><img src="../Images/dbcac278b2402f9719d7986d23d606d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KcNGMpinfFULBmqrFSI3OA@2x.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">从宽到长:新的指示器列“等级”+熔化/堆积值“等级”列(运行代码<a class="ae li" href="https://beta.deepnote.com/project/d1350ad6-bcb4-4c3d-857b-c29d01b8a803#%2Fmelt.ipynb" rel="noopener ugc nofollow" target="_blank">此处为</a>)</p></figure><h1 id="ee16" class="nk nl iu bd nm nn ou np nq nr ov nt nu kj ow kk nw km ox kn ny kp oy kq oa ob bi translated">熔体实施例 2</h1><p id="5911" class="pw-post-body-paragraph lj lk iu ll b lm oc ke lo lp od kh lr ls oe lu lv lw of ly lz ma og mc md me in bi translated">你可以用<code class="fe mf mg mh mi b">value_vars</code>来指定你想把哪些列融掉或者堆到列里(这里我们排除了物理列，所以<code class="fe mf mg mh mi b">value_vars=["english", "math"]</code>)。我们也从<code class="fe mf mg mh mi b">id_vars</code>中删除了学校一栏。</p><pre class="kt ku kv kw gu oj mi ok ol aw om bi"><span id="cd87" class="on nl iu mi b gz oo op l oq or">print(df_wide)<br/>&gt; student school  english   math  physics<br/>     Andy      Z       10     20       30<br/>   Bernie      Y      100    200      300<br/>    Cindy      Z     1000   2000     3000<br/>      Deb      Y    10000  20000    30000</span><span id="1c67" class="on nl iu mi b gz os op l oq or">df_wide.melt(id_vars="student", <br/>             value_vars=["english", "math"], <br/>             var_name="cLaSs",  # rename<br/>             value_name="gRaDe")  # rename</span><span id="b8c3" class="on nl iu mi b gz os op l oq or">&gt; student    cLaSs  gRaDe<br/>0    Andy  english     10<br/>1  Bernie  english    100<br/>2   Cindy  english   1000<br/>3     Deb  english  10000<br/>4    Andy     math     20<br/>5  Bernie     math    200<br/>6   Cindy     math   2000<br/>7     Deb     math  2000</span></pre><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj oz"><img src="../Images/d7dfb48bab712b99f59e8fc744186433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4sChDY0EdsWANKLBegZdFQ@2x.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">宽到长:原栏目学校和物理已被删除(运行代码<a class="ae li" href="https://beta.deepnote.com/project/d1350ad6-bcb4-4c3d-857b-c29d01b8a803#%2Fmelt.ipynb" rel="noopener ugc nofollow" target="_blank">此处</a>)</p></figure><h1 id="f98c" class="nk nl iu bd nm nn ou np nq nr ov nt nu kj ow kk nw km ox kn ny kp oy kq oa ob bi translated">熔体实施例 3</h1><p id="2794" class="pw-post-body-paragraph lj lk iu ll b lm oc ke lo lp od kh lr ls oe lu lv lw of ly lz ma og mc md me in bi translated">最后，让我们看看如果我们只指定学生列作为标识符列(<code class="fe mf mg mh mi b">id_vars="student"</code>)而不指定<strong class="ll je"> </strong>您想要通过<code class="fe mf mg mh mi b">value_vars</code>堆叠哪些列会发生什么。因此，所有非标识符列(学校、英语、数学、物理)将被堆叠到一列中。</p><p id="1440" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">产生的长数据帧看起来是错误的，因为现在 cLaSs 和 gRaDe 列包含了不应该在那里的值。这里的重点是向你展示<code class="fe mf mg mh mi b">pd.melt</code>是如何工作的。</p><pre class="kt ku kv kw gu oj mi ok ol aw om bi"><span id="9725" class="on nl iu mi b gz oo op l oq or">print(df_wide)<br/>&gt; student school  english   math  physics<br/>     Andy      Z       10     20       30<br/>   Bernie      Y      100    200      300<br/>    Cindy      Z     1000   2000     3000<br/>      Deb      Y    10000  20000    30000</span><span id="b41e" class="on nl iu mi b gz os op l oq or">df_wide.melt(id_vars="student",<br/>             var_name="cLaSs",  # rename<br/>             value_name="gRaDe")  # rename</span><span id="8d72" class="on nl iu mi b gz os op l oq or">&gt;  student    cLaSs  gRaDe<br/>0     Andy   school      Z<br/>1   Bernie   school      Y<br/>2    Cindy   school      Z<br/>3      Deb   school      Y<br/>4     Andy  english     10<br/>5   Bernie  english    100<br/>6    Cindy  english   1000<br/>7      Deb  english  10000<br/>8     Andy     math     20<br/>9   Bernie     math    200<br/>10   Cindy     math   2000<br/>11     Deb     math  20000<br/>12    Andy  physics     30<br/>13  Bernie  physics    300<br/>14   Cindy  physics   3000<br/>15     Deb  physics  30000</span></pre><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pa"><img src="../Images/efb24b028d9fcf45c8ea72003ba87c2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*swIp-nJFUkyO5ZTHhhTaBg@2x.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">宽到长:学校列不是标识符列(运行代码<a class="ae li" href="https://beta.deepnote.com/project/d1350ad6-bcb4-4c3d-857b-c29d01b8a803#%2Fmelt.ipynb" rel="noopener ugc nofollow" target="_blank">此处为</a>)</p></figure></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><h1 id="1b4a" class="nk nl iu bd nm nn no np nq nr ns nt nu kj nv kk nw km nx kn ny kp nz kq oa ob bi translated">结束语</h1><p id="6644" class="pw-post-body-paragraph lj lk iu ll b lm oc ke lo lp od kh lr ls oe lu lv lw of ly lz ma og mc md me in bi translated">我希望现在你对<code class="fe mf mg mh mi b">pd.melt</code>如何重塑数据帧有了更好的理解。期待大家的想法和评论。</p><p id="3a9b" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">如果你觉得这篇文章有用，请关注我并访问<a class="ae li" href="http://hausetutorials.netlify.com/" rel="noopener ugc nofollow" target="_blank">我的网站</a>获取更多数据科学教程和我的其他文章:</p><div class="mj mk gq gs ml mm"><a rel="noopener follow" target="_blank" href="/two-simple-ways-to-loop-more-effectively-in-python-886526008a70"><div class="mn ab fp"><div class="mo ab mp cl cj mq"><h2 class="bd je gz z fq mr fs ft ms fv fx jd bi translated">在 Python 中更有效地循环的两种简单方法</h2><div class="mt l"><h3 class="bd b gz z fq mr fs ft ms fv fx dk translated">使用枚举和压缩编写更好的 Python 循环</h3></div><div class="mu l"><p class="bd b dl z fq mr fs ft ms fv fx dk translated">towardsdatascience.com</p></div></div><div class="mv l"><div class="pb l mx my mz mv na lc mm"/></div></div></a></div><div class="mj mk gq gs ml mm"><a href="https://medium.com/better-programming/4-keyboard-shortcuts-to-edit-text-efficiently-and-improve-productivity-66894c8d51b8" rel="noopener follow" target="_blank"><div class="mn ab fp"><div class="mo ab mp cl cj mq"><h2 class="bd je gz z fq mr fs ft ms fv fx jd bi translated">4 个键盘快捷键，可高效编辑文本并提高工作效率</h2><div class="mt l"><h3 class="bd b gz z fq mr fs ft ms fv fx dk translated">高效地在文本中导航和移动光标</h3></div><div class="mu l"><p class="bd b dl z fq mr fs ft ms fv fx dk translated">medium.com</p></div></div><div class="mv l"><div class="pc l mx my mz mv na lc mm"/></div></div></a></div><div class="mj mk gq gs ml mm"><a rel="noopener follow" target="_blank" href="/real-or-spurious-correlations-attractive-people-you-date-are-nastier-fa44a30a9452"><div class="mn ab fp"><div class="mo ab mp cl cj mq"><h2 class="bd je gz z fq mr fs ft ms fv fx jd bi translated">真实或虚假的关联:你约会的有魅力的人更令人讨厌</h2><div class="mt l"><h3 class="bd b gz z fq mr fs ft ms fv fx dk translated">使用 Python 模拟数据、测试直觉并提高数据科学技能</h3></div><div class="mu l"><p class="bd b dl z fq mr fs ft ms fv fx dk translated">towardsdatascience.com</p></div></div><div class="mv l"><div class="pd l mx my mz mv na lc mm"/></div></div></a></div><div class="mj mk gq gs ml mm"><a href="https://medium.com/better-programming/code-and-develop-more-productively-with-terminal-multiplexer-tmux-eeac8763d273" rel="noopener follow" target="_blank"><div class="mn ab fp"><div class="mo ab mp cl cj mq"><h2 class="bd je gz z fq mr fs ft ms fv fx jd bi translated">使用终端多路复用器 tmux 提高编码和开发效率</h2><div class="mt l"><h3 class="bd b gz z fq mr fs ft ms fv fx dk translated">简单的 tmux 命令来提高您的生产力</h3></div><div class="mu l"><p class="bd b dl z fq mr fs ft ms fv fx dk translated">medium.com</p></div></div><div class="mv l"><div class="pe l mx my mz mv na lc mm"/></div></div></a></div><div class="mj mk gq gs ml mm"><a rel="noopener follow" target="_blank" href="/free-online-data-science-courses-during-covid-19-crisis-764720084a2"><div class="mn ab fp"><div class="mo ab mp cl cj mq"><h2 class="bd je gz z fq mr fs ft ms fv fx jd bi translated">新冠肺炎危机期间的免费在线数据科学课程</h2><div class="mt l"><h3 class="bd b gz z fq mr fs ft ms fv fx dk translated">像 Udacity、Codecademy 和 Dataquest 这样的平台现在免费提供课程</h3></div><div class="mu l"><p class="bd b dl z fq mr fs ft ms fv fx dk translated">towardsdatascience.com</p></div></div><div class="mv l"><div class="pf l mx my mz mv na lc mm"/></div></div></a></div><p id="349d" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><em class="pg">更多帖子，</em> <a class="ae li" href="https://hauselin.ck.page/587b46fb05" rel="noopener ugc nofollow" target="_blank"> <em class="pg">订阅我的邮件列表</em> </a> <em class="pg">。</em></p></div></div>    
</body>
</html>