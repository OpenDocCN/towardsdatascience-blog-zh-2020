# 面向数据科学家的软件工程——测试驱动开发

> 原文：<https://towardsdatascience.com/software-engineering-for-data-scientist-test-driven-development-65f1cdf52d58?source=collection_archive---------50----------------------->

![](img/415a6d9f99b043ca0a14c4b0cedac63a.png)

照片由来自[佩克斯](https://www.pexels.com/photo/man-in-white-shirt-using-macbook-pro-52608/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)的[蒂姆·高](https://www.pexels.com/@punttim?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)拍摄

这是本系列的第三篇文章。有关该系列文章的列表，请查看**部分的前几篇文章**。

**简介**

测试驱动开发(TDD)在软件工程实践中非常流行。当涉及到数据科学/机器学习项目时，它收缩到验证和交叉验证。在最好的情况下，我们将讨论 A/B 测试模型。在目前的情况下，ML 模型正在成为 leger IT 系统组件的一部分。现在是企业在数据科学和机器学习项目中考虑 TDD 的时候了。

TDD 是一种软件工程实践，它要求在代码被验证之前编写单元测试。我们不打算讨论软件工程中测试驱动开发的内容和方式。关于这个主题有大量的资源。我们的主要焦点是讨论如何将 DS/ML 项目中的测试范围扩展到交叉验证和测试数据之外。

**数据科学中的代码生命周期**

数据科学项目有从业务理解到模型操作化的坚实阶段。在每个阶段，我们都会产生不同的结果，并且依赖于多种工具或平台。简而言之，数据理解和分析(或探索性数据分析)、特征选择和工程、模型构建和模型操作化是关键阶段。exploration(或 EDA)阶段实际上是在输入数据中执行一些测试(没有明确地将其称为测试)。之后执行的唯一测试是使用维持数据的验证/测试。从特征工程到模型构建的代码总是在模型操作化部分被重用。这是最关键的阶段，你的 AI ops(AI/ML 的 DevOps)团队将开始与你互动。测试用例的可用性将使 AiOps 的生命周期和部署的验证更加顺利。

**考哪里，考什么？**

机器学习/数据科学过程中的几乎每一步都是编写测试用例的候选。但是有一些特定的领域需要编写测试用例。需要测试用例的阶段包括:

探索性数据分析

数据预处理

特征工程(非统计)

数据管道

模型和模型管道

部署脚本和 API

有些情况下，我们可能不坚持测试用例。在对数据(不是概念证明)和纯探索性数据分析阶段应用 ML/DS 的可行性研究中，可以忽略测试用例/TDD。在这个阶段，TDD 是一个奢侈和妥协的交付时间。让我们探索一下提到的测试途径。

**TDD 和探索性数据分析**

在这个阶段，编写测试用例不是必须的。大多数时候，我们可能会检查数据类型、属性特征和数据的统计属性。这个阶段对构建数据管道有很大的帮助。这些管道显然是测试用例的目标。如果我们觉得我们将在固定的时间间隔内重复数据探索，那么最好创建可重用的代码工件。和可重用的工件是测试用例的候选对象！请记住，如果探索性数据分析是唯一的目标，那么就不值得投资创建测试用例。

**数据预处理**

数据预处理函数是测试用例的优秀候选者，这是必须的。让我们检查一些用例场景来证明我们的论点。

用例-

这个团队正在研究一个文本分类问题。数据的来源是员工和客户之间的公司电子邮件通信。项目的目标是确定意图和主题。

预处理—从 exchange 服务器中提取电子邮件文本，它可以作为。txt 文件。回复和通信线程包含带有唯一标记(如“> > > .”)的以前的消息有电子邮件 ID，电子邮件签名，个人身份信息，如身份证号码，信用卡等。预处理的目的是清理这些数据。

数据科学家或数据工程师将获取可用样本，并开发数据清理功能。由于此活动包括正则表达式的使用，因此有可能出现误报。在这种情况下，最好与脚本一起编写测试用例。这将确保对功能的增量更改不会破坏初始功能或必要的行为。应该为测试用例确定一组覆盖各种场景和组合的输入数据。

注意——作为数据科学家或数据工程师，人们可能会觉得这是一项费力的工作。但是这个测试用例将会帮助你减少有时候等待你的惊喜。

对于文本和结构化数据场景，我们可以考虑同样多的用例。

**特色工程**

将数据从源系统提取到数据框并创建新要素是一个标准流程。建议测试为特征工程生成的代码。我们将在生产中重复/重新使用相同的代码。这一步使得编码成为编写测试脚本的候选。当代码准备好进行部署时，可以运行一个快速测试来确保流水线在生产线上按预期运行。让我们用一个简单的用例来检验一下。

用例——团队在时间序列数据集中工作。数据科学家根据时间戳创建了两个新属性。时间戳作为 Unix 时间戳存储在数据库中。在构建要素之前，需要对数据进行日期时间格式化并创建要素。

通常，数据科学家/数据工程师会编写一个效用函数。这一职能将是生产管道的一部分。在这种情况下，花时间编写测试用例是值得的。

**数据管道**

数据管道是机器学习工作流不可或缺的一部分。数据提取、数据验证和数据准备是三个高层次的过程。取决于源系统(Hadoop、SQL、文件和流数据等)..)，涉及到转换，我们可能需要设计全面的测试用例。这些测试用例可能包括测试执行数据提取所需的时间，确保数据类型和属性以及输出属性和类型。人们应该计划为这个场景编写一些测试用例。我们将写一篇单独的文章，介绍用例及工作示例。

**模型和模型管道**

教科书上的说明是模型测试是使用验证和测试数据集。度量标准是根据问题类型选择的，项目目标仍然是标准流程。就一会儿，想想如果我们的模型在做随机预测会怎么样？！这种测试在监督和非监督模型中都是有用的。我们可以写一个虚拟的分类器或者抑制类来模仿这个行为。如果你觉得写一个不舒服，sklearn 就是来救你一命的。sklearn 提供了一个虚拟分类器和回归类。对于聚类来说，这就变得棘手了；我们可能需要创建自定义的集群分配器。

最重要的测试用例之一是预测一致性，这是必需的，但从未讨论过。预测一致性背后的直觉是，对于给定的模型，如果我们将一个输入传递任意次，它应该返回相同的结果。不管模型类型如何，这应该是正确的，也许强化学习是一个例外情况。如果您在一个受监管的环境中工作，这个测试用例是必要的。有时候这个测试可以发现一些惊喜！

最后一个但正在出现的领域是对抗性测试用例。由于人工智能/人工智能将成为几乎每个 IT 系统的一部分，下一轮网络攻击将以对抗性人工智能的形式出现。这种对抗性攻击的影响包括毒害你的自动化训练管道；甚至没有模型漂移检测设置就发出警报。对抗性机器学习是 2010 年代早期的一个感兴趣的领域。深度学习极度火爆之后，成为了一个活跃的讨论话题。无论深度学习还是传统的机器学习，对抗性攻击都可能危及你的 AI/ML 系统。准备测试对你的模型的不利影响。

机器学习框架和平台提供管道 API。sklearn 管道和 Azure 管道 API 就是例子。确保无缝集成和预期行为的测试用例是一个很好的实践。当我们向 AIOps 进行部署时，测试用例将确保部署顺利进行。

我们将在本系列中润色一篇详细的技术文章。

**测试模型部署**

模型部署是 AI/ML 项目中一个不断发展的领域。创建 Flask API 来利用容器和容器编排平台的能力是技术前景的一部分。如果涉及到 API，我们应该考虑 API 的测试用例。无论我们有一个容器还是容器编排系统，它都是我们所期望的——对于批处理和特别推理系统来说都是一样的。

**下一步**

到目前为止，awe 以技术不可知的方式讨论了数据科学中的 TDD 途径。在随后的文章中，我们将通过示例和用例详细讨论其中的一些概念。

尽管如此，还是有很多争论的空间。普遍的理解是测试驱动开发会增加 10%到 15%的开发时间。但同时，投入的时间会保证 95%的 bug 和惊喜。一个成熟的 AI/ML 团队应该考虑在正确的测试策略上投入时间。

**往期文章**

[1]AI/ML/数据科学项目的软件工程，[https://medium . com/@ jaganadhg/Software-Engineering-for-AI-ML-Data-Science-Projects-bb73 e 556620 e](https://medium.com/@jaganadhg/software-engineering-for-ai-ml-data-science-projects-bb73e556620e)

[2]面向数据科学家的软件工程—编写干净代码的艺术，[https://medium . com/@ jaganadhg/Software-Engineering-for-Data-Scientist-Art-of-Writing-Clean-Code-f 168 bf8a 6372](https://medium.com/@jaganadhg/software-engineering-for-data-scientist-art-of-writing-clean-code-f168bf8a6372)

*最初发表于*[*【https://www.linkedin.com】*](https://www.linkedin.com/pulse/software-engineering-data-scientist-test-driven-gopinadhan-jagan-/)*。*