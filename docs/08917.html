<html>
<head>
<title>Hands on Churn Prediction with R and comparison of Different Models for Churn Prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 R 进行客户流失预测，并比较不同的客户流失预测模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/hands-on-churn-prediction-with-r-and-comparison-of-different-models-for-churn-prediction-4b79011a082a?source=collection_archive---------10-----------------------#2020-06-27">https://towardsdatascience.com/hands-on-churn-prediction-with-r-and-comparison-of-different-models-for-churn-prediction-4b79011a082a?source=collection_archive---------10-----------------------#2020-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4e62" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 GLM、决策树和随机森林来预测流失，并比较模型的准确性和 AUC 值</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d107233ddc05664d7515d4a905dfcd3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QmEPLrT72A_RBc6V"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@sctgrhm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯科特·格雷厄姆</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="7b20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">什么是客户流失？</strong></p><p id="9af3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当应用于客户群时，流失率是指在给定时间段内离开供应商的合同客户或订户的比例。(<a class="ae ky" href="https://en.wikipedia.org/wiki/Churn_rate" rel="noopener ugc nofollow" target="_blank">维基百科</a>)</p><p id="8422" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">为什么客户流失预测很重要？</strong></p><p id="44b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">流失率直接关系到公司的盈利能力。一些人对顾客行为了解得越多，就能获得越多的利润。这也有助于识别和改进客户服务不足的领域。</p><h2 id="ab14" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">获取和处理数据</h2><p id="5315" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">数据是从 IBM 收集的。首先加载所需的库和数据，并查看数据。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="fa9d" class="lv lw it mu b gy my mz l na nb">library(tidyverse)<br/>library(caret)<br/>library(repr)<br/>library(caTools)<br/>library(rpart)<br/>library(rpart.plot)<br/>library(ggpubr)</span><span id="bfe2" class="lv lw it mu b gy nc mz l na nb"># input the data and take a look on the variables<br/>data &lt;- read.csv("telco.csv")<br/>glimpse(data)</span><span id="1fe6" class="lv lw it mu b gy nc mz l na nb">data &lt;- data[complete.cases(data),] # removing na's</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/85f15a51e297397870e6dba7d0a04a99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*4FvpHTEeElgTCqTC9OoE_A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 1:看一下数据</p></figure><p id="5773" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于数据:</p><ul class=""><li id="145a" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nj nk nl nm bi translated">在这个数据中，所有的行代表不同的客户，每一列代表他们的属性。</li><li id="c408" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">“流失”列表示客户在上个月离开。</li><li id="6518" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">客户订购的服务—电话、多条线路、互联网、在线安全、在线备份、设备保护、技术支持以及流媒体电视和电影。</li><li id="c772" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">每个客户的账户信息——合同、支付方式、无纸化账单、每月费用和总费用。</li><li id="8144" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">人口统计信息——性别、年龄范围，以及他们是否有伴侣和家属</li></ul><p id="51e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">数据角力:</strong></p><ol class=""><li id="a05a" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu ns nk nl nm bi translated">为了方便起见，像“没有互联网服务”和“没有电话服务”这样的术语应该改为“没有”。</li></ol><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="40d9" class="lv lw it mu b gy my mz l na nb">data &lt;- data.frame(lapply(data, function(x) {<br/>  gsub("No internet service", "No", x)}))</span><span id="4f2a" class="lv lw it mu b gy nc mz l na nb">data &lt;- data.frame(lapply(data, function(x) {<br/>  gsub("No phone service", "No", x)}))</span></pre><p id="2c03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.SeniorCitizen 用 1 和 0 回答，分别改为“是”或“否”。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d3ab" class="lv lw it mu b gy my mz l na nb">data$SeniorCitizen &lt;- as.factor(ifelse(data$SeniorCitizen==1, 'YES', 'NO'))</span></pre><p id="4867" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.将 double 类型变量转换为 numeric 类型，并将它们作为数据框存储在变量中。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="963f" class="lv lw it mu b gy my mz l na nb">num_columns &lt;- c("tenure", "MonthlyCharges", "TotalCharges")<br/>data[num_columns] &lt;- sapply(data[num_columns], as.numeric)</span><span id="61df" class="lv lw it mu b gy nc mz l na nb">data_int &lt;- data[,c("tenure", "MonthlyCharges", "TotalCharges")]<br/>data_int &lt;- data.frame(scale(data_int))</span></pre><p id="6283" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.任期以月为单位。我们应该把它换算成年。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="ed94" class="lv lw it mu b gy my mz l na nb">data &lt;- mutate(data, tenure_year = tenure)</span><span id="7095" class="lv lw it mu b gy nc mz l na nb">data$tenure_year[data$tenure_year &gt;=0 &amp; data$tenure_year &lt;= 12] &lt;- '0-1 year'<br/>data$tenure_year[data$tenure_year &gt; 12 &amp; data$tenure_year &lt;= 24] &lt;- '1-2 years'<br/>data$tenure_year[data$tenure_year &gt; 24 &amp; data$tenure_year &lt;= 36] &lt;- '2-3 years'<br/>data$tenure_year[data$tenure_year &gt; 36 &amp; data$tenure_year &lt;= 48] &lt;- '3-4 years'<br/>data$tenure_year[data$tenure_year &gt; 48 &amp; data$tenure_year &lt;= 60] &lt;- '4-5 years'<br/>data$tenure_year[data$tenure_year &gt; 60 &amp; data$tenure_year &lt;= 72] &lt;- '5-6 years'</span><span id="8f13" class="lv lw it mu b gy nc mz l na nb">data$tenure_year &lt;- as.factor(data$tenure_year)</span></pre><p id="36ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.准备用于分析的最终数据，排除我们在整个分析过程中不需要的选定变量。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="87fb" class="lv lw it mu b gy my mz l na nb">data$tenure_year &lt;- as.factor(data$tenure_year)</span><span id="1eb9" class="lv lw it mu b gy nc mz l na nb">data_req &lt;- data[,-c(1,6,19,20)]<br/>x &lt;- data.frame(sapply(data_req,function(x) data.frame(model.matrix(~x-1,data =data_req))[,-1]))</span><span id="829c" class="lv lw it mu b gy nc mz l na nb">x &lt;- na.omit(x) # omit the NA's<br/>data_int &lt;- na.omit(data_int) # omit the NA's</span><span id="725b" class="lv lw it mu b gy nc mz l na nb">data_final &lt;- cbind(x, data_int)</span></pre><h1 id="f157" class="nt lw it bd lx nu nv nw ma nx ny nz md jz oa ka mg kc ob kd mj kf oc kg mm od bi translated">探索性分析</h1><ol class=""><li id="2501" class="ne nf it lb b lc mo lf mp li oe lm of lq og lu ns nk nl nm bi translated">数字变量之间的相关图:</li></ol><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4a9f" class="lv lw it mu b gy my mz l na nb">nv &lt;- sapply(data_int, is.numeric)<br/>cormat &lt;- cor(data_int[,nv])<br/>ggcorrplot::ggcorrplot(cormat, title = "Correlation of Numeric Variables")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/636af6fd2b7a1aadf8e3722076e94205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*staiPEmdap3WiT73IfjAxg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 2:数值变量的相关图</p></figure><p id="96ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.流失率表明上个月大约有 26.58%的客户离开。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="2224" class="lv lw it mu b gy my mz l na nb">churn &lt;- data %&gt;% <br/>  group_by(Churn) %&gt;% <br/>  summarise(Count = n())%&gt;% <br/>  mutate(percentage = prop.table(Count)*100)<br/>ggplot(churn, aes(reorder(Churn, -percentage), percentage), fill = Churn)+<br/>  geom_col(fill = c("green", "red"))+<br/>  geom_text(aes(label = sprintf("%.2f%%", percentage)))+<br/>  xlab("Churn") + <br/>  ylab("Percent")+<br/>  ggtitle("Churn Percentage")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/c29b149c7fbd01004c40f0d1ed5af556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*HlQYuCtnjGRsTqqLRPryXg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 3:流失率</p></figure><p id="f538" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.条形图显示分类变量中的流失率。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5a7a" class="lv lw it mu b gy my mz l na nb">fig1 &lt;-   ggarrange(ggplot(data, aes(x=gender,fill=Churn))+ geom_bar() ,<br/>          ggplot(data, aes(x=SeniorCitizen,fill=Churn))+ geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=Partner,fill=Churn))+ geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=Dependents,fill=Churn))+ geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=PhoneService,fill=Churn))+ geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=MultipleLines,fill=Churn))+ geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=InternetService,fill=Churn))+ geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=OnlineSecurity,fill=Churn))+ geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=OnlineBackup,fill=Churn))+ geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=DeviceProtection,fill=Churn))+ geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=TechSupport,fill=Churn))+ geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=StreamingTV,fill=Churn))+ geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=StreamingMovies,fill=Churn))+ <br/>geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=Contract,fill=Churn))+ <br/>geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=PaperlessBilling,fill=Churn))+ <br/>geom_bar(position = 'fill'),<br/>          ggplot(data, aes(x=PaymentMethod,fill=Churn))+<br/>geom_bar(position = 'fill')+theme_bw()+<br/>          rremove("x.text"), <br/>          ncol = 3, nrow = 6,<br/>          common.legend = TRUE, legend = "bottom")<br/>annotate_figure(fig1, bottom  = text_grob("Churn Percentage in categorical variables", col = "blue", face = "bold", size = 14))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/235d553f5154c1247fcd0a791402d643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zCFmrWMZ17ipHP17rTguAg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 4:分类变量中的流失百分比</p></figure><p id="3164" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.以数字变量显示流失百分比的条形图。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="57d2" class="lv lw it mu b gy my mz l na nb">fig2 &lt;-   ggarrange(<br/>          ggplot(data, aes(y= tenure, x = "", fill = Churn))<br/>+geom_boxplot() + xlab(" "),<br/>          ggplot(data, aes(y= MonthlyCharges, x = "", fill = Churn))                                   +geom_boxplot() + xlab(" "),<br/>          ggplot(data, aes(y= TotalCharges, x = "", fill = Churn)) <br/>+geom_boxplot() + xlab(" "),<br/>          rremove("x.text"),<br/>          ncol = 2, nrow = 2, common.legend = TRUE, legend = "bottom")</span><span id="c026" class="lv lw it mu b gy nc mz l na nb">annotate_figure(fig2, bottom  = text_grob("Churn Percentage in numeric variables", col = "red", face = "bold", size = 14))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/3a45055de68bf6af5bfdeaad08cf4ae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*CbkmyqtbZMdoBJJ6KiUnQQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 5:数字变量中的流失率</p></figure><h1 id="6732" class="nt lw it bd lx nu nv nw ma nx ny nz md jz oa ka mg kc ob kd mj kf oc kg mm od bi translated">不同模型的分析</h1><h2 id="40fd" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">逻辑回归</h2><ol class=""><li id="b7c3" class="ne nf it lb b lc mo lf mp li oe lm of lq og lu ns nk nl nm bi translated">将数据拆分为训练集和测试集</li></ol><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c618" class="lv lw it mu b gy my mz l na nb">set.seed(123)<br/>split &lt;- sample.split(data_final$Churn, SplitRatio = 0.70)<br/>train &lt;- data_final[split,]<br/>test &lt;- data_final[!(split),]</span></pre><p id="c945" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.计算基线精度</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4412" class="lv lw it mu b gy my mz l na nb">prop.table(table(train$Churn))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/7fc9d2591f0823d36321a5b4e42cce3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*wy2VtiGmdBGPJ9Ls-JpghQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 6:基线精度</p></figure><p id="b548" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.使用 glm()函数拟合模型</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="649f" class="lv lw it mu b gy my mz l na nb">glm &lt;- glm(Churn ~., data = train, family = "binomial")<br/>summary(glm)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/17e88901ca61fef1fa663649ed8e9b30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*aUm3a6I8vsFQYOiF1XunTA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 7:来自 GLM 的总结</p></figure><p id="e2a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.计量精度</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="dadd" class="lv lw it mu b gy my mz l na nb">pred &lt;- predict(glm, data = train, type = "response")</span><span id="39bc" class="lv lw it mu b gy nc mz l na nb"># confusion matrix on training set</span><span id="24a9" class="lv lw it mu b gy nc mz l na nb">glmtab1 &lt;- table(train$Churn, pred &gt;= 0.5)<br/>acc_glm_train &lt;- (3275+708)/nrow(train)</span><span id="b297" class="lv lw it mu b gy nc mz l na nb"># observations on the test set<br/>predtest &lt;- predict(glm, newdata = test, type = "response")<br/>glmtab2 &lt;- table(test$Churn, predtest &gt;= 0.5)<br/>acc_glm_test &lt;- (1382+307)/nrow(test)<br/></span></pre><p id="103d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ol">精度= 0.80 </em> </strong></p><p id="431d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.重要变量</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/a07cb69bdfb1efc273b318b21ac345ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*srPD4IhiGkcy2RTi9UcnhQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 8:来自 GLM 的重要变量</p></figure><h2 id="5d3f" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">随机森林</h2><ol class=""><li id="323b" class="ne nf it lb b lc mo lf mp li oe lm of lq og lu ns nk nl nm bi translated">拟合模型</li></ol><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="dfee" class="lv lw it mu b gy my mz l na nb">fit_rf &lt;- randomForest(Churn ~ ., data=train, proximity=FALSE,importance = FALSE)<br/>fit_rf</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/99b6635924fc11e460b65b202fbecdef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wTrQ_YwntsOvhohYxFbFuQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 9:来自 RF 的摘要</p></figure><p id="c2d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.计算精度</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="27c1" class="lv lw it mu b gy my mz l na nb">predrf &lt;- predict(fit_rf, data = "train", type = "response")</span><span id="965b" class="lv lw it mu b gy nc mz l na nb">rftab &lt;- table(predrf, train$Churn)<br/>acc_rf_train &lt;- (3248+694)/nrow(train)<br/>acc_rf_train</span></pre><p id="4880" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ol">精度= 0.80 </em> </strong></p><p id="8099" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.误差和重要变量图</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="2926" class="lv lw it mu b gy my mz l na nb">plot(fit_rf)<br/>varImpPlot(rf)</span></pre><div class="kj kk kl km gt ab cb"><figure class="oo kn op oq or os ot paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/ef5a71a5313aee9058e547d6b81d7959.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*GTv2juHc59z8yY1M4rlOLw.png"/></div></figure><figure class="oo kn ou oq or os ot paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/2ba6f266c1049cebbabdc3debe6c9495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*2lXLglb7UEk6xZKDIDQCkQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk ov di ow ox translated">图 10:RF 方法的误差和重要变量图</p></figure></div><h1 id="a353" class="nt lw it bd lx nu nv nw ma nx ny nz md jz oa ka mg kc ob kd mj kf oc kg mm od bi translated">决策树</h1><ol class=""><li id="9cc4" class="ne nf it lb b lc mo lf mp li oe lm of lq og lu ns nk nl nm bi translated">符合模型</li></ol><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a564" class="lv lw it mu b gy my mz l na nb">rpart &lt;- rpart(Churn ~. , data = train, method = "class", control = rpart.control((cp = 0.05)))<br/>summary(rpart)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/959966e50fe6f7f6e61bbd374437e25d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*vSy9Kik0kG647dO9qF85ng.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 11:决策树摘要的一部分</p></figure><p id="40d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.计算精度</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="cf83" class="lv lw it mu b gy my mz l na nb">rpred &lt;- predict(rpart, data = train, type = "class")<br/>dtab1 &lt;- table(rpred, train$Churn)<br/>acc_rpart_train &lt;- (3380+522)/nrow(train)<br/></span><span id="43bb" class="lv lw it mu b gy nc mz l na nb">rpredt &lt;- predict(rpart, newdata = test, type = "class")<br/>dtab2 &lt;- table(rpredt, test$Churn)<br/>acc_rpredt_test &lt;- (1435+218)/nrow(test)<br/></span></pre><p id="728c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ol">精度= 0.78 </em> </strong></p><p id="6ba0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.重要变量</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/f97685c6b00dd020b5ad926699f2c31e.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*v1mC24NSYw_30VFBbo0Iaw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 12:来自 DT 的重要变量。</p></figure><p id="4eb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">所有三款车型的 AUC</strong></p><p id="b060" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本代码参考:<a class="ae ky" href="http://rstudio-pubs-static.s3.amazonaws.com/277278_427ca6a7ce7c4eb688506efc7a6c2435.html" rel="noopener ugc nofollow" target="_blank"> rstudio-pubs </a>。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="aacf" class="lv lw it mu b gy my mz l na nb">library(pROC)</span><span id="f54d" class="lv lw it mu b gy nc mz l na nb">glm.roc &lt;- roc(response = test$Churn, predictor = as.numeric(predtest))<br/>rpart.roc &lt;- roc(response = train$Churn, predictor = as.numeric(predrf))<br/>rf.roc &lt;- roc(response = test$Churn, predictor = as.numeric(rpredt))</span><span id="ec55" class="lv lw it mu b gy nc mz l na nb">plot(glm.roc,      legacy.axes = TRUE, print.auc.y = 1.0, print.auc = TRUE)<br/>plot(rpart.roc, col = "blue", add = TRUE, print.auc.y = 0.65, print.auc = TRUE)<br/>plot(rf.roc, col = "red" , add = TRUE, print.auc.y = 0.85, print.auc = TRUE)</span><span id="3752" class="lv lw it mu b gy nc mz l na nb">legend("bottom", c("Random Forest", "Decision Tree", "Logistic"),<br/>       lty = c(1,1), lwd = c(2, 2), col = c("red", "blue", "black"), cex = 0.75)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/65b460ce5db71ffd360d4c72ac8aebab.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*aifoA1HFM6vi3KqmYrFtXQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 13:这些模型的 AUC</p></figure><p id="e512" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结论:</p><ul class=""><li id="118e" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nj nk nl nm bi translated">比较准确性和 AUC 值，逻辑模型比随机森林和决策树更好地预测该特定数据集中的流失。</li><li id="44be" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">任期、合同、无纸账单、互联网服务是最重要的特征。</li><li id="addc" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">一些特征如性别、伴侣等对客户流失没有影响。</li></ul><p id="528e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他故事:</p><ol class=""><li id="32e8" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu ns nk nl nm bi translated"><a class="ae ky" href="https://medium.com/@aashiqreza/time-series-forecasting-in-r-80a0e5834a4f?source=friends_link&amp;sk=317b90e40789464ba9651de10910efca" rel="noopener">R 中的时间序列预测</a></li><li id="de15" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu ns nk nl nm bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/an-approach-to-make-comparison-of-arima-and-nnar-models-for-forecasting-price-of-commodities-f80491aeb400">比较 ARIMA 和 NNAR 模型预测商品价格的方法。</a></li><li id="3361" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu ns nk nl nm bi translated"><a class="ae ky" href="https://medium.com/@aashiqreza/market-share-prediction-with-r-57d9145ac97b" rel="noopener">R</a>市场份额预测</li></ol></div></div>    
</body>
</html>