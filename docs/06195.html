<html>
<head>
<title>Multicollinearity in Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">回归中的多重共线性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/multi-collinearity-in-regression-fe7a2c1467ea?source=collection_archive---------2-----------------------#2020-05-19">https://towardsdatascience.com/multi-collinearity-in-regression-fe7a2c1467ea?source=collection_archive---------2-----------------------#2020-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="68b8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">为什么这是个问题？如何检查和修理</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/55d360df3e08b29791994e295c20690d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GMB-vVME1gZ0mJyTvKXkgg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:by @jjying来自<a class="ae ky" href="https://unsplash.com/photos/PDxYfXVlK2M" rel="noopener ugc nofollow" target="_blank"> unsplash </a></p></figure><p id="da32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当回归模型中的独立变量彼此高度相关时，会发生多重共线性。这使得很难解释模型，并且还产生过拟合问题。人们在选择回归模型中的变量之前会进行测试，这是一个常见的假设。</p><p id="1af8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我以前在为时间序列数据构建回归模型时遇到过严重的多重共线性问题。我根据不同的时间段创建了多个特征，如1个月的总回报、6个月的总回报和1年的总回报，以获得更多的输入变量。然而，这些特征彼此高度相关。例如，如果一只股票在过去一年表现良好，那么它很可能在最近一个月表现良好。我需要放弃这些变量中的一些，或者找到一种方法使它们不那么相关。我将在文章的后面解释解决这个问题的不同方法。</p><h2 id="3577" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">为什么多重共线性是一个问题？</h2><p id="7edb" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">当独立变量高度相关时，一个变量的变化会引起另一个变量的变化，因此模型结果波动很大。如果数据或模型发生微小变化，模型结果将会不稳定且变化很大。这将产生以下问题:</p><ol class=""><li id="89a2" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">如果模型每次给你不同的结果，你将很难<strong class="lb iu">选择模型的重要变量列表</strong>。</li><li id="d7dd" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu">系数估计不稳定</strong>，你很难解释这个模型。换句话说，如果你的一个预测因子改变了1个单位，你就无法判断输出的变化程度。</li><li id="c463" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">模型的不稳定性可能导致<strong class="lb iu">过度拟合</strong>。如果将该模型应用于另一个数据样本，则与训练数据集的准确性相比，准确性会显著下降。</li></ol><blockquote class="nh ni nj"><p id="eebe" class="kz la nk lb b lc ld ju le lf lg jx lh nl lj lk ll nm ln lo lp nn lr ls lt lu im bi translated">根据具体情况，如果仅出现轻微或中等程度的共线性问题，则对于您的模型来说可能不是问题。但是，如果存在严重的共线性问题(例如，两个变量之间的相关性&gt; 0.8或方差膨胀因子(VIF) &gt;20)，强烈建议解决该问题</p></blockquote><h2 id="6a11" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">如何检查是否出现多重共线性？</h2><p id="741c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><strong class="lb iu">第一个简单的方法</strong>是画出所有自变量的相关矩阵。</p><p id="741b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用了Kaggle竞赛的住房数据。竞赛的目标是使用房屋数据输入来正确预测销售价格。我在这里选择了一些数值变量来包含在我的模型中。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="8e90" class="lv lw it np b gy nt nu l nv nw">#plot color scaled correlation matrix<br/>corr=house_selected.corr()<br/>corr.style.background_gradient(cmap='coolwarm')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/218561c4455689603e20c38c9fe2426c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2jbAL4FMHQa5XaieXjMRhA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">住房数据的彩色标度相关矩阵</p></figure><p id="09c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在绘制相关矩阵并对背景进行颜色缩放后，我们可以看到所有变量之间的成对相关性。我还在这里加入了因变量“销售价格”。这是因为当我试图选择包含在模型中的独立变量时，这是我的一个秘密技巧。</p><blockquote class="nh ni nj"><p id="d8b9" class="kz la nk lb b lc ld ju le lf lg jx lh nl lj lk ll nm ln lo lp nn lr ls lt lu im bi translated">当你不知道模型中包含哪些变量时，只需做一个相关矩阵，选择那些与因变量高度相关的自变量。</p></blockquote><p id="25dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到多重共线性问题，我们可以看到，从相关矩阵中，有相当多的变量是相互关联的。有一对相关系数大于0.8的自变量是地下室总表面积和一层表面积。具有较大地下室面积的房屋往往也具有较大的一楼面积，因此高相关性是可以预期的。</p><p id="792c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">检查多重共线性的第二种方法</strong>是对每个自变量使用方差膨胀因子(VIF)。它是多重回归变量集合中多重共线性的度量。VIF值越高，该变量与其他变量的相关性越高。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="48a8" class="lv lw it np b gy nt nu l nv nw">#Compute VIF data for each independent variable<br/>from statsmodels.stats.outliers_influence import variance_inflation_factor<br/>vif = pd.DataFrame()<br/>vif["features"] = house_selected.columns<br/>vif["vif_Factor"] = [variance_inflation_factor(house_selected.values, i) for i in range(house_selected.shape[1])]<br/>vif</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/50b6341a7689d9314cc45f5d137249a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*oxTLMyeUvlbOD9vsMl59DQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">住房模型数据的VIF结果-原始</p></figure><p id="8906" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果VIF值高于10，通常被认为与其他自变量有很高的相关性。然而，接受范围受到要求和约束。从结果中，我们可以看到大多数特征与其他自变量高度相关，只有两个特征可以通过低于10的阈值。</p><h2 id="a18a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">如何修复多重共线性问题？</h2><ol class=""><li id="c2e3" class="mt mu it lb b lc mo lf mp li nz lm oa lq ob lu my mz na nb bi translated"><strong class="lb iu">变量选择</strong></li></ol><p id="8bb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最直接的方法是删除一些与其他变量高度相关的变量，将更重要的变量留在集合中。例如，当我们绘制包含“销售价格”的相关矩阵时，我们可以看到整体质量和地面居住面积与因变量“销售价格”的相关性最高，因此我将尝试将它们包含在模型中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/9c6fcf4ab52684dee0ca327829e64f53.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*i4PwxOmtybQg167ufe_l3Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">住房模型数据的VIF结果-选择后</p></figure><p id="e350" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，使用简单的消去法，我们能够显著降低VIF值，同时保留重要的变量。然而，一些变量如整体质量和建造年限仍然有很高的VIF值，它们在预测房价时很重要。<strong class="lb iu">如何？</strong>有时我们可以使用第二种方法中描述的小技巧来转换变量。</p><p id="bc79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.<strong class="lb iu">变量转换</strong></p><p id="3da5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二种方法是<strong class="lb iu">转换一些变量，使它们不那么相关，但仍然保持它们的特征</strong>。我这么说是什么意思？在房屋模型示例中，我可以通过用建造年份减去当前年份，将“建造年份”转换为“房屋年龄”。例如，如果建筑年份是1994年，那么房子的年龄是2020–1994 = 26年。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/c3e684182eb2c73dcd58ae8da784bee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:386/format:webp/1*Xlok1HWLNOxEEK804MjVGA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">住房模型数据的VIF结果-转换为house_age后</p></figure><p id="9bb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我将建筑年限转换为房龄后，新的“房龄”因子的VIF下降到一个可接受的范围，整体质量的VIF值也下降了。</p><p id="e056" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我开始提到的时间序列分析的例子中，我也转换了变量，使它们不那么相关。例如，过去1个月的总回报与过去6个月的总回报高度相关。我从过去6个月的回报中减去过去1个月的回报，得到不包括过去一个月的前5个月回报的新变量。相关性结果更容易接受，我能够将这两个变量作为我的模型特征。</p><p id="ceeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.<strong class="lb iu">主成分分析</strong></p><p id="b35f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">主成分分析(PCA)通常用于通过将数据分解成多个独立的因子来降低数据的维度。它有许多应用，如通过减少预测因子的数量来简化模型计算。然而，在我们的例子中，我们将只使用PCA的变量独立性来消除模型中的多重共线性问题。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="4ce5" class="lv lw it np b gy nt nu l nv nw">#Create the new data frame by transforming data using PCA<br/>import numpy as np<br/>from sklearn.decomposition import PCA<br/>pca = PCA(n_components=6)<br/>components=pca.fit_transform(house_adjusted)<br/>componentsDf=pd.DataFrame(data=components,columns=['component 1','component 2','component 3','component 4','component 5','component 6'])</span><span id="4ee6" class="lv lw it np b gy oe nu l nv nw">#Calculate VIF for each variable in the new data frame<br/>vif = pd.DataFrame()<br/>vif["features"] = componentsDf.columns<br/>vif["vif_value"] = [variance_inflation_factor(componentsDf.values, i) for i in range(componentsDf.shape[1])]<br/>vif</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/358c221da2d2272ed2d7371bc7833f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:374/format:webp/1*YFASAvJjN-j3RAY6WA8Vbg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">住宅模型数据的VIF结果PCA转换后</p></figure><p id="2ab9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与原始数据相比，我仍然保留相同数量的变量，我们可以看到，现在这6个变量彼此完全不相关。我们可以用新的6个变量作为自变量来预测房价。</p><p id="bd65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种方法的弊端也非常明显。在PCA变换之后，我们没有每个变量的同一性，并且将很难解释结果。</p><h2 id="2fdd" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结论和建议</h2><p id="3430" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在建立回归模型之前，我们每次都应该检查多重共线性的问题。VIF是一种简单的方法，可以观察每个独立变量，看它们是否与其他变量高度相关。当您不确定为模型选择哪些变量时，相关矩阵将有助于选择重要的因素。相关矩阵还有助于理解为什么某些变量具有高VIF值。</p><p id="8df2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就修复多重共线性问题的方法而言，我个人不喜欢这里的PCA，因为模型解释将会丢失，当您想要将模型应用于另一组数据时，您需要再次进行PCA转换。因此，我们应该尽最大努力通过选择正确的变量来减少相关性，并在需要时进行转换。当变量具有相对较高的VIF值，而且对预测结果也很重要时，您可以决定是否保留该变量。试错法总是包括不同的变量集，建立模型并根据测试数据进行测试，以查看是否有任何过度拟合。</p><p id="d6d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你认为在构建模型之前，你已经完成了所有的统计假设检查了吗？不，你不是！如果你想了解更多关于回归模型中的其他统计假设，请参考我下面的另一篇关于回归模型中的正态假设的文章。</p><div class="og oh gp gr oi oj"><a rel="noopener follow" target="_blank" href="/is-normal-distribution-necessary-in-regression-how-to-track-and-fix-it-494105bc50dd"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">回归中正态分布有必要吗？如何跟踪修复？</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">博克斯-考克斯变换，夏皮罗-维尔克检验，QQ图</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox ks oj"/></div></div></a></div></div></div>    
</body>
</html>