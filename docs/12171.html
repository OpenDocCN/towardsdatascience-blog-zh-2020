<html>
<head>
<title>My Time Series Toolkit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的时间序列工具包</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/my-time-series-toolkit-4aa841d08325?source=collection_archive---------13-----------------------#2020-08-22">https://towardsdatascience.com/my-time-series-toolkit-4aa841d08325?source=collection_archive---------13-----------------------#2020-08-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="19f6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我选择的时间序列分析模型</h2></div><p id="7271" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">说到时间序列预测，我坚信模型越简单越好。</p><p id="aa63" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，并非所有的时间序列都是一样的。一些时间序列具有明确的趋势，例如，我们经常在经济数据中看到这种趋势:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi le"><img src="../Images/8e70dd73d4fea88af326cc7f772c86e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*vzKSG25tQ_58BJzJz8jVqg.png"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">资料来源:美联储经济数据</p></figure><p id="ed7f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其他的则显示出更稳定的模式，例如每月的航空乘客人数:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/4c87696f2938e1b29a1eef2c1b50656b.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*ZX5UTD4Rk9eNV12NwE6H8g.png"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">资料来源:旧金山公开数据</p></figure><p id="b0cc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">时间序列模型的选择在很大程度上取决于所处理的时间序列的类型。以下是我遇到的一些最有用的时间序列模型。</p><h1 id="557b" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">1.ARIMA</h1><p id="6a03" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">以我的经验来看，ARIMA 在建模有强烈趋势的时间序列时最有用。该模型还擅长模拟季节性模式。</p><p id="9d1e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们举个例子。</p><p id="c0d8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们希望对一段时间内<a class="ae mo" rel="noopener" target="_blank" href="/arima-vs-prophet-forecasting-air-passenger-numbers-4e01b2d93608">每月的航空乘客数量</a>进行建模。原始数据来源于<a class="ae mo" href="https://data.sfgov.org/Transportation/Air-Traffic-Passenger-Statistics/rkru-6vcg" rel="noopener ugc nofollow" target="_blank">三藩市公开数据</a>。</p><p id="dfdc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样的时间序列将有一个季节性的组成部分(例如，假日季节往往有较高的乘客人数)以及一个趋势的证据，当序列分解如下所示。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/9331905de394548a05595125488eed51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*kBbZvy2hdjp36f1cIrLGhw.png"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">资料来源:RStudio</p></figure><p id="f181" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用 ARIMA 模型的目的是捕捉趋势以及说明时间序列中固有的季节性。</p><p id="6d6d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，可以使用 R 中的<strong class="kk iu"> auto.arima </strong>函数，该函数可以为模型选择最合适的<em class="mq"> p，d，q </em>坐标以及适当的季节分量。</p><p id="5409" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于上述示例，就最低 BIC 而言，表现最佳的模型如下:</p><pre class="lf lg lh li gt mr ms mt mu aw mv bi"><span id="d89e" class="mw ls it ms b gy mx my l mz na">Series: passengernumbers <br/>ARIMA(1,0,0)(0,1,1)[12]Coefficients:<br/>         ar1     sma1<br/>      0.7794  -0.5001<br/>s.e.  0.0609   0.0840sigma^2 estimated as 585834:  log likelihood=-831.27<br/>AIC=1668.54   AICc=1668.78   BIC=1676.44</span></pre><p id="a3b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是预测的图像。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/0a1a830df2821264e552b8b3b846ea7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*MOzlkO_J6B3YCnG0_odY8Q.png"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">资料来源:RStudio</p></figure><p id="47d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到，ARIMA 是充分预测的季节模式系列。就模型性能而言，RMSE(均方根误差)和 MFE(平均预测误差)如下:</p><ul class=""><li id="8365" class="nb nc it kk b kl km ko kp kr nd kv ne kz nf ld ng nh ni nj bi translated"><strong class="kk iu"> RMSE: </strong> 698</li><li id="242e" class="nb nc it kk b kl nk ko nl kr nm kv nn kz no ld ng nh ni nj bi translated"><strong class="kk iu"> MFE: </strong> -115</li></ul><p id="9655" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">给定验证集内每月平均<strong class="kk iu"> 8，799 </strong>名乘客，记录的误差与平均值相比非常小，表明该模型在预测航空乘客数量方面表现良好。</p><h1 id="07f0" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">2.先知</h1><p id="9218" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">让我们再来看一下空中乘客的例子，但是这次使用的是<a class="ae mo" href="https://facebook.github.io/prophet/" rel="noopener ugc nofollow" target="_blank">脸书的先知</a>。Prophet 是一个时间序列工具，允许根据附加模型进行预测，尤其适用于具有强烈季节性趋势的数据。</p><p id="470b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">航空乘客数据集似乎符合这个要求，所以让我们来看看这个模型与 ARIMA 相比表现如何。</p><p id="cdd1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本例中，Prophet 可用于确定航空乘客数量的长期趋势，以及全年的季节性波动:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi np"><img src="../Images/e3853ad5828f15be3d76fc7420649800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*eUu3dNJzuG-3VenOud2lrw.png"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><pre class="lf lg lh li gt mr ms mt mu aw mv bi"><span id="7fff" class="mw ls it ms b gy mx my l mz na">prophet_basic = Prophet()<br/>prophet_basic.fit(train_dataset)</span></pre><p id="4284" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">标准的 Prophet 模型可以自动选择趋势和季节成分，尽管这些也可以由用户手动配置。</p><p id="a91d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Prophet 的一个特别有用的组件是包含了<strong class="kk iu">变点</strong>，或者时间序列中的重大结构突变。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nq"><img src="../Images/9f7ec83e51007868c2380ad1b68a7187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYrYBAat94YUMW30xkFSwQ.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="b518" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过反复试验，显示了 4 个变点来最小化 MFE 和 RMSE:</p><pre class="lf lg lh li gt mr ms mt mu aw mv bi"><span id="3e75" class="mw ls it ms b gy mx my l mz na">pro_change= Prophet(n_changepoints=4)<br/>forecast = pro_change.fit(train_dataset).predict(future)<br/>fig= pro_change.plot(forecast);<br/>a = add_changepoints_to_plot(fig.gca(), pro_change, forecast)</span></pre><p id="f61a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">RMSE 和 MAE 现在可以计算如下:</p><pre class="lf lg lh li gt mr ms mt mu aw mv bi"><span id="5eee" class="mw ls it ms b gy mx my l mz na">&gt;&gt;&gt; from sklearn.metrics import mean_squared_error<br/>&gt;&gt;&gt; from math import sqrt<br/>&gt;&gt;&gt; mse = mean_squared_error(passenger_test, yhat14)<br/>&gt;&gt;&gt; rmse = sqrt(mse)<br/>&gt;&gt;&gt; print('RMSE: %f' % rmse)</span><span id="5b38" class="mw ls it ms b gy nv my l mz na">RMSE: 524.263928</span><span id="19c1" class="mw ls it ms b gy nv my l mz na">&gt;&gt;&gt; forecast_error = (passenger_test-yhat14)<br/>&gt;&gt;&gt; forecast_error<br/>&gt;&gt;&gt; mean_forecast_error = np.mean(forecast_error)<br/>&gt;&gt;&gt; mean_forecast_error</span><span id="730b" class="mw ls it ms b gy nv my l mz na">71.58326743881493</span></pre><p id="4d0c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Prophet 的 RMSE 和 MFE 均低于使用 ARIMA 获得的结果，表明该模型在预测每月航空乘客人数方面表现更好。</p><h1 id="ed4b" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">3.张量流概率</h1><p id="cfb9" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">在新冠肺炎事件之后，许多时间序列预测被证明是错误的，因为它们是在错误的假设下做出的。</p><p id="4b94" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">越来越多的人开始认识到，能够产生一系列预测的时间序列模型可以得到更实际的应用，因为它们允许对未来可能发生的事情进行“情景分析”。</p><p id="3582" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，使用上述航空乘客数据建立的 ARIMA 模型不可能预测到新冠肺炎导致的乘客数量的急剧下降。</p><p id="3b53" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，使用更多最近的航空乘客数据，让我们看看使用<a class="ae mo" rel="noopener" target="_blank" href="/forecasting-air-passenger-numbers-with-tensorflow-probability-1b53e5e5fea2">张量流概率</a>建立的模型会如何表现:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nw"><img src="../Images/89c9606ba53d1c4a548fed1986100d2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LTEZiKwXx6AmNZhdLm9unw.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">来源:张量流概率</p></figure><p id="a507" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然该模型没有预测到最终发生的急剧下降，但我们确实看到该模型预测乘客数量将下降到低于<strong class="kk iu"> 150，000 </strong>。使用这种模型可以进行更多的“假设”系列预测，例如，航空公司可以预测特定机场的每月乘客人数，并注意到乘客人数可能比平时低得多，这可以为公司管理资源(例如机队利用率)提供信息。</p><p id="eea1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">具体来说，张量流概率使用后验分布的假设进行预测，后验分布由先验分布(先验数据)和似然函数组成。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nx"><img src="../Images/ffce557bd9ae8c959375435db92fbc9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1yEjf5a0ETp9WZOD_KXAwQ.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">来源:图片由作者创建</p></figure><p id="e8e7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为参考，此处举例说明的示例使用了 TensorFlow Probability tutorial 中的<a class="ae mo" href="https://blog.tensorflow.org/2019/03/structural-time-series-modeling-in.html" rel="noopener ugc nofollow" target="_blank">结构化时间序列建模</a>的模板，其原作者(版权 2019 tensor flow 作者)已经在 Apache 2.0 许可下提供了该模板。</p><h1 id="d2ea" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">结论</h1><p id="cb2e" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">时间序列分析是关于使用适合数据的模型进行可靠的预测。对于具有确定趋势和季节性成分的数据，根据我的经验，这些模型工作得相当好。</p><p id="f582" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">希望你发现了上面这篇有用的文章，欢迎在评论区留下任何问题或反馈。</p><p id="2a05" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mq">免责声明:本文是在“原样”的基础上编写的，没有任何担保。本文旨在提供数据科学概念的概述，不应以任何方式解释为专业建议。</em></p></div></div>    
</body>
</html>