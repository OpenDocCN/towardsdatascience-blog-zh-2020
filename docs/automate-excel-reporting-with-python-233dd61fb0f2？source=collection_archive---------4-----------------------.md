# 自动化你的(无聊！)用 Python 做 Excel 报表！

> 原文：<https://towardsdatascience.com/automate-excel-reporting-with-python-233dd61fb0f2?source=collection_archive---------4----------------------->

## 创建 Excel 报表(包括图表！)却从未接触过 Excel！

![](img/b0560c5ebbb466aad9f3afd981e37143.png)

Excel 和 Python 可以成为朋友！资料来源:Nik Piepenbreier

# 没有什么能逃过 Excel，这没关系！

Excel 无处不在。这是不可避免的，即使有 Python 这样强大的工具供您使用。

没关系！你的老板和同事仍然需要简单的方法来访问重要的数据。

但这并不意味着您不能通过使用 Python 使您的 Excel 工作变得更容易，所有这些都不需要接触 Excel！

# 使用 Python 自动生成 Excel 报表

你知道你每月、每周(每天)做的那些 Excel 报表吗？)依据？你为不同的客户做同样的事情四五次？

让 Python 来帮你做吧！

## 我们将要自动化的东西

让我们快速看一下我们将自动化什么！我们将使用我的[熊猫数据透视表教程](/a-step-by-step-guide-to-pandas-pivot-tables-e0641d0c6c70)中的数据(我真的建议去看看！).

数据格式与您可能期望从包含客户销售数据的公司数据库中获得的数据格式相匹配。

我们将按区域划分这些数据，并创建两个汇总表，包括格式和图表。所有这些都不需要接触 Excel！

![](img/32ccaf5536f88927fb1ea00db221b120.png)

我们的最终数据流—一个工作簿到四个格式化报告。资料来源:Nik Piepenbreier

# 让我们加载我们的库

我们将依靠熊猫和 Openpyxl。我在我的故事[中提到了 Openpyxl 很多，自动化这 3 个(无聊！！)用 Python 做 Excel 任务！](/automate-these-3-boring-excel-tasks-with-python-666b4ded101b)它很好地介绍了它是如何运作的。

我们将使用两个库:

1.  **熊猫**负责转换我们的数据并创建初始的 Excel 文件
2.  Openpyxl 格式化我们的工作簿并插入图表

# 加载我们的数据

让我们加载数据，快速浏览一下我们正在处理的内容！

正如我提到的，这些数据意味着类似于您可能从企业数据库系统中获得的数据。

这里，我们使用 pandas 读取 Excel 文件，将*日期*列解析为日期。

# 创建我们的数据透视表

让我们创建最终报告中需要的汇总表。

举例来说，让我们为东部地区创建一个数据透视表来测试我们的代码。

# 创建我们的第一个 Excel 文件

现在我们有了数据透视表，让我们将它加载到一个 Excel 文件中。

为此，我们将使用熊猫来加载它:

让我们快速看一下我们正在做什么:

*   我们创建一个文件路径变量来标识我们希望文件存储在哪里，
*   我们使用 ExcelWriter 来保存文件
*   我们将两个数据透视表保存到单独的工作表中，从第 3 行开始(为以后的标题留下)

# 让我们的报告更漂亮

Pandas 有利于将数据导入 Excel。现在它已经在那里了，让我们稍微美化一下，并添加一些可视化效果。

这里发生了很多事情。让我们更详细地探索一下吧！

在第 5 节中，我们将工作簿和工作表加载到 Openpyxl 可以处理的独立对象中。

**第六节**还有一点儿事儿:

*   我们在单元格 A1 和 A2 中向 sheet1 添加标题和副标题。
*   我们更改季度列的标题以更好地反映数据。
*   我们对标题和副标题应用样式。
*   我们把金融领域的细胞换成货币。这需要一次应用于单个单元格。这就是我们使用 for 循环的原因。

在**第 7 节**中，我们添加了我们的条形图:

*   我们创建一个条形图对象，并标识存储数据和类别的字段。
*   然后将数据和类别应用于对象。
*   最后，我们添加一个描述性的标题和样式。Openpyxl 使用了许多不同的样式——尝试一下吧！

这是我们的床单现在的样子:

![](img/60890314721a3cc4b1bc340b1122580d.png)

我们得到的工作簿之一。资料来源:Nik Piepenbreier

# 为多个工作簿自动执行此工作流

虽然这已经很方便了，但是为一个地区这样做只会节省我们一点点时间。让我们用 for 循环对所有区域都这样做。

让我们仔细看看这里:

在第 8 节中，我们创建了一个列表，其中包含了我们想要覆盖的不同地区的所有唯一值。

在**第 9 节**中，我们在 for 循环中重复前面的代码:

*   我们创建一个新的变量来保存我们想要保存文件的文件夹的路径。
*   稍后，我们使用 f 字符串将区域名称插入到我们的脚本中，使其对每个区域都是动态的。

# 接下来呢？

Python 的好处在于它可以让重复的任务变得可伸缩。

想象一下，每天都收到这个文件，并且每天都必须创建这些工作簿。你每天都为自己节省了大量的时间！

# 结论

在这个简短的教程中，我们学到了不少东西！我们将一个工作簿转换成一组数据透视表，将它们导出到单独的工作簿中，并对每个工作簿应用格式和图形！

给自己一个鼓励！

如果你对更多类似的内容感兴趣，可以看看我关于 Excel 的其他故事，比如下面这个:

[](/automate-these-3-boring-excel-tasks-with-python-666b4ded101b) [## 自动化这 3 个(无聊！！)用 Python 做 Excel 任务！

### 不用再打开数百个 Excel 文件

towardsdatascience.com](/automate-these-3-boring-excel-tasks-with-python-666b4ded101b)