<html>
<head>
<title>Face Landmarks Detection With PyTorch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 PyTorch 检测人脸标志点</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/face-landmarks-detection-with-pytorch-4b4852f5e9c4?source=collection_archive---------9-----------------------#2020-07-15">https://towardsdatascience.com/face-landmarks-detection-with-pytorch-4b4852f5e9c4?source=collection_archive---------9-----------------------#2020-07-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cd10" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">计算机真的能看懂人脸吗？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/edf19a39e861c83d9f0980818847a20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KOTz0VB7prmgtWc0wRKFew.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@armedshutter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Ayo Ogunseinde </a>从<a class="ae kv" href="https://unsplash.com/s/photos/girls?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片上的地标检测样本</p></figure><p id="b356" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想知道 Instagram 如何将令人惊叹的滤镜应用到你的脸上吗？该软件检测你脸上的关键点，并在上面投射一个面具。本教程将指导您如何使用 Pytorch 构建这样一个软件。</p><h1 id="b8f8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Colab 笔记本</h1><p id="d2eb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">完整的代码可以在下面的交互式 Colab 笔记本中找到。</p><div class="mp mq gp gr mr ms"><a href="https://colab.research.google.com/drive/1TOw7W_WU4oltoGZfZ_0krpxmhdFR2gmb" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">人脸标志检测</h2><div class="mz l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">colab.research.google.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf kp ms"/></div></div></a></div><h1 id="3acc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">资料组</h1><p id="5987" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在本教程中，我们将使用官方的<a class="ae kv" href="http://dlib.net/files/data/ibug_300W_large_face_landmark_dataset.tar.gz" rel="noopener ugc nofollow" target="_blank"> DLib 数据集</a>，其中包含了<strong class="ky ir"> 6666 张不同尺寸</strong>的图像。此外，<em class="ng">labels _ ibug _ 300 w _ train . XML</em>(随数据集提供)包含每张脸的<strong class="ky ir"> 68 个地标的坐标。下面的脚本将下载数据集并将其解压缩到 Colab Notebook 中。</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="6d7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是数据集中的一个示例图像。我们可以看到，面部占据了整个图像的很小一部分。如果我们将完整的图像输入神经网络，它也会处理背景(无关信息)，使模型难以学习。因此，我们需要裁剪图像，只填充人脸部分。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/448a72f154e8d590516ceaba81100f53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*I2tP9jaHvRH3QCBhqm08oQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据集的样本图像和地标</p></figure><h2 id="f136" class="nk lt iq bd lu nl nm dn ly nn no dp mc lf np nq me lj nr ns mg ln nt nu mi nv bi translated">数据预处理</h2><p id="3104" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为了防止神经网络过度拟合训练数据集，我们需要随机转换数据集。我们将对训练和验证数据集应用以下操作:</p><ul class=""><li id="9f10" class="nw nx iq ky b kz la lc ld lf ny lj nz ln oa lr ob oc od oe bi translated">由于人脸在整个图像中只占很小的一部分，所以请裁剪图像并仅使用人脸进行训练。</li><li id="7fee" class="nw nx iq ky b kz of lc og lf oh lj oi ln oj lr ob oc od oe bi translated">将裁剪后的面调整为(224x224)图像。</li><li id="7c00" class="nw nx iq ky b kz of lc og lf oh lj oi ln oj lr ob oc od oe bi translated">随机更改调整后的面部的亮度和饱和度。</li><li id="555c" class="nw nx iq ky b kz of lc og lf oh lj oi ln oj lr ob oc od oe bi translated">以上三种变换后随机旋转人脸。</li><li id="2376" class="nw nx iq ky b kz of lc og lf oh lj oi ln oj lr ob oc od oe bi translated">将图像和地标转换为火炬张量，并在[-1，1]之间归一化。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="bdcb" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">数据集类</h1><p id="594f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在我们已经准备好了转换，让我们编写数据集类。<em class="ng">labels _ ibug _ 300 w _ train . XML</em>包含图像路径、界标和边界框的坐标(用于裁剪面部)。我们将这些值存储在列表中，以便在培训期间轻松访问。在本教程中，将对灰度图像训练神经网络。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="aa04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong> <code class="fe ok ol om on b">landmarks = landmarks - 0.5</code>是为了使地标以零为中心，因为以零为中心的输出更易于神经网络学习。</p><p id="35d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">预处理后数据集的输出将类似于这样(图像上标出了地标)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/d1e30480ab848164b6d164d15a9c071c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*xeuEE-BpDiFXptkWZqYWYg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">预处理数据样本</p></figure><h1 id="30de" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">神经网络</h1><p id="8b1e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们将使用 ResNet18 作为基本框架。我们需要修改第一层和最后一层，以适应我们的目的。在第一层中，我们将使输入通道计数为 1，以便神经网络接受灰度图像。类似地，在最终层中，输出通道计数应该等于<strong class="ky ir"> 68 * 2 = 136 </strong>，以便模型预测每个面的 68 个标志的(x，y)坐标。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="5b0f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">训练神经网络</h1><p id="e8f8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们将使用预测界标和真实界标之间的均方误差作为损失函数。请记住，学习率应该保持较低，以避免爆炸梯度。每当验证损失达到新的最小值时，将保存网络权重。训练至少 20 个纪元才能获得最佳表现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="a4a3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">根据看不见的数据预测</h1><p id="b869" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">使用下面的代码片段来预测看不见的图像中的地标。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><blockquote class="op oq or"><p id="e72f" class="kw kx ng ky b kz la jr lb lc ld ju le os lg lh li ot lk ll lm ou lo lp lq lr ij bi translated">上面的代码片段在 Colab Notebook 中不起作用，因为 Colab 还不支持 OpenCV 的某些功能。要运行上述单元，请使用您的本地机器。</p></blockquote><p id="a36d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> OpenCV Harr Cascade </strong> <strong class="ky ir">分类器</strong>用于检测图像中的人脸。使用 Haar 级联的对象检测是一种基于机器学习的方法，其中用一组输入数据训练级联函数。OpenCV 已经包含了许多预先训练好的人脸、眼睛、行人等分类器。在我们的例子中，我们将使用人脸分类器，为此您需要下载<a class="ae kv" href="https://github.com/opencv/opencv/blob/master/data/haarcascades/haarcascade_frontalface_default.xml" rel="noopener ugc nofollow" target="_blank">预训练的分类器 XML 文件</a>，并将其保存到您的工作目录中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/3862253eab312993e1334ce4b6df41cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7W6u3wsmfsUjGbTwyS6Egw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">人脸检测</p></figure><p id="2a05" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，输入图像中检测到的人脸被裁剪，调整大小到<strong class="ky ir"> (224，224) </strong>，并被馈送到我们训练过的神经网络，以预测其中的地标。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/c8adffac56ac8d55621c54f2ecad7f29.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*kkIE48WSTcw9TWKCooyCKg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">裁剪人脸上的标志点检测</p></figure><p id="00bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，裁剪后的面部中的预测界标被覆盖在原始图像的顶部。结果如下图所示。印象深刻，对吧！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/edf19a39e861c83d9f0980818847a20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KOTz0VB7prmgtWc0wRKFew.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">决赛成绩</p></figure><p id="f759" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">类似地，多个面部上的标志检测:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/297262983f5a3d281baaae0ac58185f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7jRTy-SD8sWbObRygVPAA.png"/></div></div></figure><p id="5540" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，你可以看到<strong class="ky ir"> OpenCV Harr 级联分类器</strong>已经检测到多个人脸，包括一个误报(一个拳头被预测为一个人脸)。所以，网络已经在那上面画了一些地标。</p><h1 id="a28e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">那都是乡亲们！</h1><p id="dc26" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你成功了，向你致敬！你刚刚训练了你自己的神经网络来检测任何图像中的面部标志。尝试在您的网络摄像头上预测面部标志！！</p><p id="5c6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有什么建议请留言评论。我定期写文章，所以你应该考虑关注我，在你的订阅中获得更多这样的文章。</p><p id="af30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢这篇文章，你可能也会喜欢这些:</p><div class="mp mq gp gr mr ms"><a rel="noopener follow" target="_blank" href="/machine-learning-visualized-11965ecc645c"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">机器学习-可视化</h2><div class="oy l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">理解机器学习的视觉方法</h3></div><div class="mz l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">towardsdatascience.com</p></div></div><div class="na l"><div class="oz l nc nd ne na nf kp ms"/></div></div></a></div><div class="mp mq gp gr mr ms"><a rel="noopener follow" target="_blank" href="/principal-component-analysis-visualized-17701e18f2fa"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">主成分分析-可视化</h2><div class="oy l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">使用主成分分析(PCA)的数据压缩</h3></div><div class="mz l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">towardsdatascience.com</p></div></div><div class="na l"><div class="pa l nc nd ne na nf kp ms"/></div></div></a></div><p id="fadc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">访问我的<a class="ae kv" href="http://arkalim.github.io/" rel="noopener ugc nofollow" target="_blank">网站</a>了解更多关于我和我的工作。</p></div></div>    
</body>
</html>