<html>
<head>
<title>Automating Portfolio Optimization and Allocation using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 自动化投资组合优化和分配</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automating-portfolio-optimization-using-python-9f344b9380b9?source=collection_archive---------8-----------------------#2020-06-07">https://towardsdatascience.com/automating-portfolio-optimization-using-python-9f344b9380b9?source=collection_archive---------8-----------------------#2020-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2d8a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Python 中的现代投资组合理论为您的投资组合计算优化的资产权重和分配</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ffa71992b5cca6216fc7ec6c0b8e70b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pz3VluN9AiOg4WE8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尼克·崇在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="ac63" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">现代投资组合理论——(MPT)</strong></h2><p id="364e" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">现代投资组合理论(MPT)或均值-方差分析是一种数学模型/研究，用于开发和创建投资组合，旨在使给定风险的回报最大化。这种数学很大程度上基于一种假设和经验，即普通人更喜欢风险较低的投资组合。降低风险可以通过投资于传统的安全港或多样化来实现，这是 MPT 倡导的一项事业。</p><p id="3680" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这个理论是由亨利·马科维茨在 20 世纪 50 年代提出的，他因此获得了诺贝尔奖。虽然 MPT 受到了相当多的批评，部分原因是其向后看的倾向以及无法将商业和经济中的不可抗力/趋势考虑在内，但我发现，通过衡量波动率作为代理，这一工具对于衡量一个人投资组合的风险很有价值。</p><h2 id="4a61" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">模型的基础知识</strong></h2><p id="7553" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我将使用 Python 来自动优化投资组合。该理论的概念简述如下</p><ol class=""><li id="1cea" class="mt mu it lx b ly mo mb mp li mv lm mw lq mx mn my mz na nb bi translated"><strong class="lx iu">投资组合预期收益- </strong></li></ol><p id="ab2b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">投资组合的预期回报的计算方法是将资产的权重乘以其回报，然后将所有资产的价值相加。为了引入前瞻性估计，可以引入概率来生成和合并商业和经济中的特征。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/65a40e14898531ef097388e34e6a3a85.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*DhdKNHNyjSKR4DJ7bZF4Og.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">投资组合预期收益</p></figure><p id="81bc" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> 2。投资组合差异- </strong></p><p id="4848" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">在该模型中，投资组合方差被用作风险的度量。较高的方差表明资产类别和投资组合的风险较高。该公式表示为</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/69483ecdf289f1333a8e412e2dd60ca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*qXOZlX9JkBp_g_502rFo6Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">投资组合风险(方差)|ρ—资产 i/j 之间的相关系数</p></figure><p id="a6f2" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> 3。夏普比率</strong></p><p id="bee7" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">夏普比率衡量与无风险利率(国债利率)及其风险状况相关的投资回报。一般来说，夏普比率值越高，表明投资越好，利润越大。因此，如果比较两个具有相似风险特征的投资组合，在其他条件相同的情况下，最好投资具有较高夏普比率的投资组合。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/c0531addca6b9a4e2497fd92a1676eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:184/format:webp/1*X93MzKyq8Nxw9aCNOv4ESw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">夏普比率</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/76babfc98b0bed17b81b703632e34d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*tmG1hyHueaEZXsyXlFtijw.png"/></div></figure><p id="74a5" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> 4。有效前沿- </strong></p><p id="4abc" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">该图衡量风险与回报，用于在考虑风险状况和投资者特征后选择最佳投资组合。根据目标和投资者的能力/特征，有效边界是第一和第二象限曲线的重要部分。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/a798e65121aafb7e694e7e033d2c096f.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*PqDzg-_WjlpRr4dbqDJyCA.png"/></div></figure><p id="daf1" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">资本配置线(CAL)本质上是有效边界的切线。切线和边界之间的交点被认为是最佳投资，在正常情况下，对于给定的风险状况，它具有最大的回报</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h2 id="88a6" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">在 Python 中自动化投资组合优化</strong></h2><ol class=""><li id="d938" class="mt mu it lx b ly lz mb mc li no lm np lq nq mn my mz na nb bi translated"><strong class="lx iu">导入库</strong></li></ol><p id="d438" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们将首先导入所有相关的库，以便随着我们的进展使我们的生活变得更容易。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="ac05" class="kz la it ns b gy nw nx l ny nz">#Importing all required libraries<br/>#Created by Sanket Karve<br/>import matplotlib.pyplot as plt<br/>import numpy as np<br/>import pandas as pd<br/>import pandas_datareader as web<br/>from matplotlib.ticker import FuncFormatter</span></pre><p id="88e3" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">此外，一个重要的库是 PyPortfolioOpt，它包含了帮助我们优化投资组合的函数。我们将使用以下命令安装该库</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="622f" class="kz la it ns b gy nw nx l ny nz">!pip install PyPortfolioOpt</span><span id="a90d" class="kz la it ns b gy oa nx l ny nz">#Installing the Portfolio Optimzation Library</span></pre><p id="1e77" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">导入将进一步需要的函数-</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="95a2" class="kz la it ns b gy nw nx l ny nz">from pypfopt.efficient_frontier import EfficientFrontier</span><span id="d089" class="kz la it ns b gy oa nx l ny nz">from pypfopt import risk_models</span><span id="fa99" class="kz la it ns b gy oa nx l ny nz">from pypfopt import expected_returns</span><span id="57e6" class="kz la it ns b gy oa nx l ny nz">from pypfopt.cla import CLA</span><span id="5a94" class="kz la it ns b gy oa nx l ny nz">from pypfopt.plotting import Plotting</span><span id="2ee8" class="kz la it ns b gy oa nx l ny nz">from matplotlib.ticker import FuncFormatter</span></pre><p id="de16" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> 2。从网上删除股票和金融数据</strong></p><p id="82aa" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们将从雅虎获取数据！各种股票报价机的融资。我用过的代码有 Boston Scientific、Berkshire Hathway、Invesco Trust、S&amp;P 指数基金、AES Corp .和 Sealed Air Corp .这些代码被选择用于分散各种行业的投资。</p><p id="8121" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">输入报价器后，我们需要创建一个空白的数据框架，用于通过循环捕捉所有股票的价格。出于本练习的目的，我进行了过滤，以捕捉我们正在研究的股票的调整后收盘价。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="b30d" class="kz la it ns b gy nw nx l ny nz">tickers = ['BSX','AES','BRK-B','SEE','QQQ','SPY']</span><span id="dba2" class="kz la it ns b gy oa nx l ny nz">thelen = len(tickers)</span><span id="8e8c" class="kz la it ns b gy oa nx l ny nz">price_data = []</span><span id="2427" class="kz la it ns b gy oa nx l ny nz">for ticker in range(thelen):</span><span id="19b8" class="kz la it ns b gy oa nx l ny nz">prices = web.DataReader(tickers[ticker], start='2015-01-01', end = '2020-06-06', data_source='yahoo')</span><span id="dc9a" class="kz la it ns b gy oa nx l ny nz">price_data.append(prices.assign(ticker=ticker)[['Adj Close']])</span><span id="750b" class="kz la it ns b gy oa nx l ny nz">df_stocks = pd.concat(price_data, axis=1)</span><span id="072f" class="kz la it ns b gy oa nx l ny nz">df_stocks.columns=tickers</span><span id="5188" class="kz la it ns b gy oa nx l ny nz">df_stocks.head()</span></pre><p id="d4fe" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">检查捕获的值是否为“NaN”。较不重要的是零值。如果有 NaN 值，好的做法是考虑不同的时间序列，或者用 D-1，D+1 的平均价格填充数据。如果出现大的空白，我宁愿不考虑和删除时间序列数据，也不愿插入零值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/d517bae0f1c59adb5c534d311b7bb864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*AFPaoCpvxXfOjBRg4TXC2A.png"/></div></figure><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="92f6" class="kz la it ns b gy nw nx l ny nz">#Checking if any NaN values in the data</span><span id="6a31" class="kz la it ns b gy oa nx l ny nz">nullin_df = pd.DataFrame(df_stocks,columns=tickers)</span><span id="01d5" class="kz la it ns b gy oa nx l ny nz">print(nullin_df.isnull().sum())</span></pre><p id="a138" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> 3。计算</strong></p><p id="67ba" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们将继续进行投资组合优化的计算。从获取所选投资组合的预期收益和方差开始。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="6f8b" class="kz la it ns b gy nw nx l ny nz">#Annualized Return</span><span id="3ead" class="kz la it ns b gy oa nx l ny nz">mu = expected_returns.mean_historical_return(df_stocks)</span><span id="17a9" class="kz la it ns b gy oa nx l ny nz">#Sample Variance of Portfolio</span><span id="2d07" class="kz la it ns b gy oa nx l ny nz">Sigma = risk_models.sample_cov(df_stocks)</span></pre><p id="467b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">接着分别计算并存储具有最大夏普比率和最小波动性的投资组合权重值。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="29f6" class="kz la it ns b gy nw nx l ny nz">#Max Sharpe Ratio - Tangent to the EF</span><span id="af99" class="kz la it ns b gy oa nx l ny nz">ef = EfficientFrontier(mu, Sigma, weight_bounds=(-1,1)) #weight bounds in negative allows shorting of stocks</span><span id="751a" class="kz la it ns b gy oa nx l ny nz">sharpe_pfolio=ef.max_sharpe() #May use add objective to ensure minimum zero weighting to individual stocks</span><span id="b8af" class="kz la it ns b gy oa nx l ny nz">sharpe_pwt=ef.clean_weights()</span><span id="fe36" class="kz la it ns b gy oa nx l ny nz">print(sharpe_pwt)</span></pre><p id="7288" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这将为你提供不同持股的权重。如果你想最小化“零”持有或重量，请随意使用 L2 回归。此外，weight_bounds 被设置为从-1 到 1，以允许计算“做空”股票。最小方差投资组合也将进行同样的操作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/ad8958f53c376b0e369dbdf1d9344767.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*jKSYv1yeTX89CNMtWr4Xxg.png"/></div></figure><p id="e082" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> 4。绘制有效边界并优化投资组合配置</strong></p><p id="0386" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">最后一步是为了直观的目的绘制有效边界，并计算投资组合中给定美元金额的资产分配(即购买或卖空的股票数量)。出于本练习的目的，我考虑了 10，000 美元 investopedia 上的默认起始值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/b98be0555095b2abe16f2d6fb89e7f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*HEs0cEf-f5djoecPkb980g.png"/></div></figure><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="bf7f" class="kz la it ns b gy nw nx l ny nz">latest_prices = discrete_allocation.get_latest_prices(df_stocks)</span><span id="5ce0" class="kz la it ns b gy oa nx l ny nz"># Allocate Portfolio Value in $ as required to show number of shares/stocks to buy, also bounds for shorting will affect allocation</span><span id="c331" class="kz la it ns b gy oa nx l ny nz">#Min Volatility Portfolio Allocation $10000</span><span id="9fab" class="kz la it ns b gy oa nx l ny nz">allocation_minv, rem_minv = discrete_allocation.DiscreteAllocation(minvol_pwt, latest_prices, total_portfolio_value=10000).lp_portfolio()</span><span id="b40e" class="kz la it ns b gy oa nx l ny nz">print(allocation_minv)</span><span id="bd0c" class="kz la it ns b gy oa nx l ny nz">print("Leftover Fund value in$ after building minimum volatility portfolio is ${:.2f}".format(rem_minv))</span></pre><p id="f2f4" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这将为您提供优化的投资组合，如下所示</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/f988510324e3df2a775d6cd92d1e1567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*7hVm7W-dOmU6oIh0mw8kIw.png"/></div></figure><p id="ef6e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">对于计算具有最大夏普比率的投资组合，也可以这样做。</p><h2 id="aae4" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">结论</strong></h2><p id="8f1e" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">据说投资既是艺术又是科学。Python 和它的库允许我们自动化优化，并在这个过程中节省宝贵的时间。然而，必须注意的是，这些孤立的技术不太可能是最好的投资方法。</p><p id="f878" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">接下来，我将发布关于我们如何通过机器学习选择股票来复制指数基金，以建立我们的投资组合和 Python 可以帮助我们的许多其他功能。最后，我还创建了一个程序，用蒙特卡洛模拟来计算股价的潜在损失或变动。这个工具可以和这个投资组合优化器一起使用。</p><div class="of og gp gr oh oi"><a rel="noopener follow" target="_blank" href="/var-calculation-using-monte-carlo-simulations-40b2bb417a67"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">使用蒙特卡罗模拟的风险值计算</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">自动计算风险价值(VaR ),使用 Monte 管理 Python 中的投资组合风险、股权和股票…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ks oi"/></div></div></a></div></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><p id="d128" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><em class="ox">以上信息绝不是专业的投资建议或实践，而仅仅是我讨论如何通过现代投资组合理论(MPT)使用 Python 来自动化投资组合优化所做的努力。如需完整的源代码或任何讨论，请随时联系</em></p></div></div>    
</body>
</html>