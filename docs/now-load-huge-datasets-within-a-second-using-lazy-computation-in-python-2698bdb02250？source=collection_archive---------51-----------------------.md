# ç°åœ¨ï¼Œä½¿ç”¨æƒ°æ€§è®¡ç®—åœ¨ä¸€ç§’é’Ÿå†…åŠ è½½å·¨å¤§çš„æ•°æ®é›†ğŸ˜´ç”¨ Pythonï¼Ÿ

> åŸæ–‡ï¼š<https://towardsdatascience.com/now-load-huge-datasets-within-a-second-using-lazy-computation-in-python-2698bdb02250?source=collection_archive---------51----------------------->

## åŒå€¦äº†ç”¨ pandas åŠ è½½æ•°æ®é›†â€¦äº†è§£ Vaex å¦‚ä½•é€šè¿‡ Python å®ç°åœ¨å‡ ç§’é’Ÿå†…åŠ è½½å¤§é‡æ•°æ®ã€‚

![](img/3f0b640566add4f4094accde4b924831.png)

æ¥æº:https://vaex.readthedocs.io/en/latest/tutorial.html

æœ¬æ–‡ç®€è¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Vaex å°†å¤§æ•°æ®é›†åŠ è½½åˆ° Python å†…æ ¸ä¸­ï¼Œå¹¶ç»™å‡ºäº†å®é™…çš„å®ç°ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ã€‚åœ¨æ·±å…¥çœŸæ­£çš„å®ç°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ Vaexã€‚

## Vaex æ˜¯ä»€ä¹ˆï¼Ÿ

1.  Vaex æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ Python åº“ï¼Œç”¨äºæ‡’æƒ°çš„æ ¸å¤–æ•°æ®å¸§(ç±»ä¼¼äº Pandas)ï¼Œä»¥å¯è§†åŒ–å’Œæ¢ç´¢å¤§å‹è¡¨æ ¼æ•°æ®é›†ã€‚
2.  å®ƒåœ¨ä¸€ä¸ª n ç»´ç½‘æ ¼ä¸Šæ¯ç§’è®¡ç®—è¶…è¿‡ 10 äº¿(10â¹)ä¸ªæ ·æœ¬/è¡Œçš„ç»Ÿè®¡æ•°æ®ï¼Œå¦‚å¹³å‡å€¼ã€æ€»å’Œã€è®¡æ•°ã€æ ‡å‡†åå·®ç­‰ã€‚
3.  å¯è§†åŒ–æ˜¯ä½¿ç”¨ç›´æ–¹å›¾ã€å¯†åº¦å›¾å’Œ 3d ä½“ç»˜åˆ¶å®Œæˆçš„ï¼Œå…è®¸å¯¹å¤§æ•°æ®è¿›è¡Œäº¤äº’å¼æ¢ç´¢ã€‚Vaex ä½¿ç”¨å†…å­˜æ˜ å°„ã€é›¶å†…å­˜å¤åˆ¶ç­–ç•¥å’Œæƒ°æ€§è®¡ç®—æ¥è·å¾—æœ€ä½³æ€§èƒ½(ä¸æµªè´¹å†…å­˜)ã€‚

çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å»ºè®®ä½ å»è¿™é‡Œ çœ‹çœ‹ Vaex[T3 çš„æ–‡æ¡£](https://vaex.readthedocs.io/en/latest/)

## ä¸‹è½½å’Œå®‰è£…åŒ…

ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨ä»»ä½•åŒ…ç®¡ç†å™¨å¦‚ **pip** æˆ– **conda** ä¸‹è½½å¹¶å®‰è£… **vaex** åº“ã€‚

```
pip install vaex
```

æˆ–è€…

```
conda install -c conda-forge vaex
```

> è®°å¾—ç”¨â€œï¼â€å¦‚æœæ‚¨ç›´æ¥å°†å®ƒè¾“å…¥åˆ° iPython ç¯å¢ƒä¸­ï¼Œè¯·åœ¨å‘½ä»¤ä¹‹å‰ã€‚

## å¯¼å…¥åŒ…

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†è¿™ä¸ªåº“å¯¼å…¥åˆ°æˆ‘ä»¬çš„å·¥ä½œç¯å¢ƒä¸­ã€‚æˆ‘ä»¬å°†å¯¼å…¥ **pandas** æ¥è®¡ç®—ä¸¤ä¸ªåº“çš„æ‰§è¡Œæ—¶é—´ã€‚

```
import vaex
import pandas as pd
```

## èµ„æ–™ç»„

ç°åœ¨ï¼Œåœ¨æœ¬æ¼”ç¤ºä¸­ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å« 100 ä¸‡è¡Œ 100 åˆ—çš„å¤§å‹æ•°æ®é›†ï¼Œè¿™ç¡®å®æ˜¯ä¸€ä¸ªå¤§å‹æ•°æ®é›†ã€‚

```
n_rows = 100000
n_cols = 10
df = pd.DataFrame(np.random.randint(0, 100, size=(n_rows, n_cols)), columns=['c**%d**' % i **for** i **in** range(n_cols)]) 
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€äº›å…³äºåŠ è½½çš„æ•°æ®é›†çš„ä¿¡æ¯ã€‚

```
df.info(memory_usage='deep')
```

![](img/49a3c497b4ed502e9130dd5979b0b5b8.png)

## åˆ›é€ ã€‚csv æ–‡ä»¶

æˆ‘ä»¬å°†æŠŠä¸Šé¢åˆ›å»ºçš„æ¼”ç¤ºæ•°æ®å¸§ä¿å­˜ä¸º**çš„å½¢å¼ã€‚csv** æ–‡ä»¶å®ç°åŠ è½½ã€‚

```
file_path = 'main_dataset.csv'
df.to_csv(file_path, index=**False**)
```

## åˆ›å»º Hdf5 æ–‡ä»¶

æˆ‘ä»¬éœ€è¦ä»¥ **hdf5** æ ¼å¼å­˜å‚¨æ•°æ®é›†ï¼Œä½œä¸º vaex è´Ÿè½½çš„è¾“å…¥ã€‚

> è¯·æ³¨æ„ï¼Œæ‰€æœ‰è¿™äº›è¿‡ç¨‹åªæ˜¯ä¸ºäº†åˆ›å»ºæ¼”ç¤ºæ•°æ®é›†ï¼Œç”¨äºæ¼”ç¤ºç›®çš„ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€äº›æ•°æ®ï¼Œè€Œå®ç°åŸºäº vaex çš„æ•°æ®åŠ è½½åªæ˜¯ä¸€è¡Œä»£ç ã€‚

```
vaex_df = vaex.from_csv(file_path, 
                        convert=**True**, 
                        chunk_size=5_000_000)
```

åœ¨æ£€æŸ¥æˆ‘ä»¬å¾—åˆ°çš„è¿™ä¸ªæ•°æ®å¸§çš„ç±»å‹æ—¶ï¼Œ

```
type(vaex_df)
```

![](img/79e17727f1a93b95f14288fed5ac23cb.png)

## ä½¿ç”¨ Vaex åº“è¯»å– Hdf5 æ–‡ä»¶

ç°åœ¨ï¼Œæˆ‘ä»¬ç»ˆäºåˆ°äº†æ¼”ç¤ºä¸­æœ€é‡è¦çš„ä¸€æ­¥ï¼Œæ‰€ä»¥è¯·æ³¨æ„ã€‚ä½¿ç”¨ Vaex åŠ è½½ Hdf5 æ ¼å¼çš„æ•°æ®é›†ã€‚

```
vaex_df = vaex.open('main_dataset.csv.hdf5')
vaex_df.head()
```

![](img/047835fd05c11a88d35f57ee73426049.png)

## è¡¨è¾¾ç³»ç»Ÿ

ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ Vaex çš„è®¡ç®—é€Ÿåº¦æœ‰å¤šå¿«ã€‚æˆ‘ä»¬å®ç°äº†ä¸¤åˆ—çš„ä¹˜æ³•ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨æ•°æ®å¸§ä¸­çš„ä¸€ä¸ªæ–°åˆ—ä¸­ï¼Œå¹¶ä¼°è®¡äº†è¿™ä¸ªè¿‡ç¨‹æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚ç»“æœå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚

```
%%time
vaex_df['multiplication_col13']=vaex_df.c1*vaex_df.c3
```

çœ‹åˆ°è¿™ä¸€åˆ—ä¸­çš„å†…å®¹ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª vaex å®šä¹‰çš„è¡¨è¾¾å¼**ç±»ä¼¼äºç†ŠçŒ«æ•°æ®æ¡†ä¸­çš„ä¸€åˆ—ã€‚**

```
vaex_df['multiplication_col13']
```

![](img/1bdac65fe2c6f9f428736eba4150ac01.png)

## æ ¸å¤–æ•°æ®å¸§

åšæŒ Vaex å¼€å‘èƒŒåçš„ä¸»è¦æ¦‚å¿µï¼Œæˆ‘ä»¬éœ€è¦è®°ä½ä»¥ä¸‹æ³¨æ„äº‹é¡¹ï¼Œ

> "ç­›é€‰å’Œè®¡ç®—è¡¨è¾¾å¼ä¸ä¼šå› ä¸ºå¤åˆ¶è€Œæµªè´¹å†…å­˜ï¼›æ•°æ®åœ¨ç£ç›˜ä¸Šä¿æŒä¸å˜ï¼Œä»…åœ¨éœ€è¦æ—¶è¿›è¡Œæµå¼ä¼ è¾“ã€‚åœ¨éœ€è¦é›†ç¾¤ä¹‹å‰å»¶è¿Ÿæ—¶é—´ã€‚â€

æ¯”å¦‚â€¦

```
vaex_df[vaex_df.c2>70]
```

> æ‰€æœ‰çš„ç®—æ³•éƒ½åœ¨å†…æ ¸ä¹‹å¤–å·¥ä½œï¼Œæé™æ˜¯ä½ çš„ç¡¬ç›˜é©±åŠ¨å™¨çš„å¤§å°

æ¯”å¦‚â€¦

```
dff.c2.minmax(progress='widget')
```

> Vaex å®ç°äº†å¹¶è¡Œã€é«˜æ€§èƒ½çš„ groupby æ“ä½œï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨ç±»åˆ«(> 10 äº¿/ç§’)æ—¶ã€‚

å®ç°ä¸ºâ€¦

```
%%time
vaex_df_group = vaex_df.groupby(vaex_df.c1,
                                agg = vaex.agg.mean(vaex_df.c4))
vaex_df_group
```

![](img/5f80985f6f647184e7a60813804b195f.png)

```
%%time
vaex_df.groupby(vaex_df.c1,agg='count')
```

![](img/202073331da103cdfd783d5999c0cb29.png)

## å‚è€ƒ

ã€https://vaex.readthedocs.io/en/latest å·

å…³äºè¿™æ¬¡æ¼”ç¤ºçš„å®Œæ•´ä»£ç ï¼Œè¯·ä»æˆ‘çš„ [Github](https://github.com/blurred-machine) ä¸­è·å– [Jupyter ç¬”è®°æœ¬](https://github.com/blurred-machine/Data-Science/blob/master/VAEX%20Implementation/Vaex%20Implementation.ipynb)ã€‚

**è°¢è°¢ï¼**