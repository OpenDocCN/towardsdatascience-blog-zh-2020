<html>
<head>
<title>How I built a corona stats Twitter bot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何建立一个电晕统计 Twitter 机器人</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-i-built-a-corona-stats-twitter-bot-4f0dc90cf96e?source=collection_archive---------65-----------------------#2020-05-19">https://towardsdatascience.com/how-i-built-a-corona-stats-twitter-bot-4f0dc90cf96e?source=collection_archive---------65-----------------------#2020-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7b08" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我如何用 Python，Pandas 和 Tweepy 制作了一个包含新冠肺炎每日统计数据的机器人。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0b6542c90b33968b4e2a7662bafaed37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4bgpmmg4feCrk3FV"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">迪米特里·卡拉斯泰列夫在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9b00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">编者按:</em> </strong> <em class="lv"> </em> <a class="ae ky" href="http://towardsdatascience.com" rel="noopener" target="_blank"> <em class="lv">走向数据科学</em> </a> <em class="lv">是一份以数据科学和机器学习研究为主的中型刊物。我们不是健康专家或流行病学家，本文的观点不应被解释为专业建议。想了解更多关于疫情冠状病毒的信息，可以点击</em> <a class="ae ky" href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports" rel="noopener ugc nofollow" target="_blank"> <em class="lv">这里</em> </a> <em class="lv">。</em></p><p id="7793" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2020 年 3 月初，新冠肺炎疫情在德国获得了牵引力。每一个主要的新闻版面和报纸都刊登了关于新感染和事实的图表和统计数据。大多数人有一个共同点:他们从约翰·霍普金斯大学获取数据，并在 GitHub 免费发布数据集。我在玩 Python 和熊猫，我在寻找一个好的项目。这是我决定创建一个从 JHU 获取所有数据的 Twitter 机器人的时刻。我在清理数据，创造情节，发推文。这篇文章描述了我如何使用和清理数据集，以及如何用不到 150 行代码发布推文。<a class="ae ky" href="https://github.com/casarock/covid-twitter-bot" rel="noopener ugc nofollow" target="_blank">全部代码在我的 GitHub </a>。</p><h2 id="ef56" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">获取数据并清理干净！</h2><p id="b2ef" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">在我们用统计数据创建一个机器人之前，我们需要一些数据。这是我的计划:</p><ul class=""><li id="8369" class="mu mv it lb b lc ld lf lg li mw lm mx lq my lu mz na nb nc bi translated">我的机器人应该显示全球和德国的感染人数。</li><li id="3b53" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">我希望显示与前一天相比的新感染。</li><li id="2dd2" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">我在计算一周内的增长百分比。</li><li id="f880" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">该机器人应该有一个与人口相关的感染线图附加的图像。</li></ul><p id="54ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，<a class="ae ky" href="https://github.com/CSSEGISandData/COVID-19/blob/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv" rel="noopener ugc nofollow" target="_blank"> JHU 有一个数据集</a>，它提供了我需要的一切。我已经创建了一个小助手模块来做清理和绘图。主要的方法是“get_clean_data”和“plot_diagram”。让我们深入研究数据清理。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="3c42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步是将 CSV 读入 Pandas 数据帧并删除未使用的列。熊猫可以从给定的 URL 读取 CSV。由于 JHU 提供每日更新的时间序列数据 CSV，我不必担心获得最新的 CSV。在该数据集中，一些国家深入到其所在的州。要获得一个国家的所有汇总数字，我必须按“国家/地区”分组。分组之后，我得到了德国的数据框架，并对其进行了总结。我对所有数字做了同样的处理，得到未分组数据的总和。现在我有了两个新的数据框，分别是德国和世界各地的数据。最后一步是删除未使用的列，并添加与人群相关的感染的计算值。相应的方法是自我解释。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="4311" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">清洁就这些了。现在让我们添加一些我在 Twitter 机器人中使用的更有趣的事实。</p><h2 id="8e1c" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">计算一些有趣的数据</h2><p id="281d" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">为了检索实际被感染的人数，我编写了一个返回数据的函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="c4f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我增加了一个方法来得到与前一周相比的增长</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h2 id="93e9" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">绘制简单的图表</h2><p id="dc00" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">因为我想为每条 tweet 添加一张图片，所以我用 Matplotlib 绘制了一个简单的线图，并将其保存为 PNG。我写了一个小方法来绘制我的图表。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="b625" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该方法获取必要的参数并保存图像。对于我的感染相关人群的图表，我添加了一个方便的方法用于我的机器人。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h2 id="48f6" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">撰写一条推文并发送出去</h2><p id="28d7" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">我使用<a class="ae ky" href="http://www.tweepy.org/" rel="noopener ugc nofollow" target="_blank"> Tweepy </a>与 Twitter API 对话。Tweepy 很容易理解，大约十行代码就可以发布推文。为了能够发推特，你必须在<a class="ae ky" href="https://developer.twitter.com/en/apps" rel="noopener ugc nofollow" target="_blank">推特开发者门户</a>注册一个应用程序以获得 API 密钥。一旦你得到了你的密钥和秘密，Tweepy 就可以使用了。</p><p id="8406" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">机器人本身是一个简单的 Python 脚本</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="b4b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码易于管理。我正在用 CSV 的 URL 实例化我的助手模块，获取数据，绘图并用我的 Tweet 文本组成一个字符串。最后一步是启动 Tweepy，用给定的文本发布一条推文。</p><p id="f974" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在家里用覆盆子酱运行我的机器人。机器人脚本每天早上由 cron 作业执行。该机器人从 3 月 11 日开始运行，到目前为止没有任何故障。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我的推特机器人在推特上发布电晕统计数据</p></figure><p id="3a0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，编写一个简单的 Twitter 机器人很容易。如果你想进入主题，我建议你创建一些小项目。对我来说，用熊猫来清理和使用项目中的数据，并每天在我的 twitter 账户上发布我的见解，这很有趣。</p></div></div>    
</body>
</html>