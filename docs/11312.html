<html>
<head>
<title>Can Prophet Accurately Forecast Web Page Views?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Prophet 能准确预测网页浏览量吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/can-prophet-accurately-forecast-web-page-views-3537fe72e11b?source=collection_archive---------44-----------------------#2020-08-05">https://towardsdatascience.com/can-prophet-accurately-forecast-web-page-views-3537fe72e11b?source=collection_archive---------44-----------------------#2020-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="28a5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Prophet 预测网页流量</h2></div><p id="1c71" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">预测网页浏览量可能相当棘手。这是因为页面浏览量往往会在数据中看到显著的“峰值”，即浏览量远远高于平均水平。</p><p id="95ab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们根据 2016 年 1 月至 2020 年 8 月维基媒体工具库的统计数据，以“地震”一词的页面浏览量为例:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi le"><img src="../Images/183b90791899a02127a30f22c298a15f.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*JuYBhV9QD5YDSP50ipS-gQ.png"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">来源:维基媒体工具锻造</p></figure><p id="619e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到，虽然总体趋势有所下降，但在特定时间点，页面浏览量仍有大幅上升。这符合我们的预期——人们很自然地认为“地震”一词的峰值会出现在实际发生地震的地方。</p><p id="f3c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然时间序列不可能预测这种峰值，但仍然可以使用时间序列模型来预测更普遍的趋势。</p><p id="38aa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这方面，为了预测该搜索项的页面浏览量，建立了一个 Prophet 模型。</p><h1 id="f2fd" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">模型配置</h1><p id="86dd" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated"><strong class="kk iu"> Prophet </strong>是脸书开发的一个预测模型，它通过对季节性、假期和变点等因素进行特殊调整来预测时间序列。</p><p id="20e6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是用 Python 对上述时间序列的分解:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/18381158d0b5e094d483b08d243c475a.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*ahzXG3QqdSKi112TzEF0DQ.png"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="ffff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从上面可以看出，随着时间的推移，我们可以观察到一个强有力的下降趋势。此外，对季节性图表的直观检查表明了每年的波动。</p><p id="6750" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">具有年度季节性且傅立叶阶为 10 的加性模型定义如下:</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="00a4" class="mt lr it mp b gy mu mv l mw mx">prophet_basic = Prophet(seasonality_mode='additive')<br/>prophet_basic.add_seasonality('yearly_seasonality', period=12, fourier_order=10)<br/>prophet_basic.fit(train_dataset)</span></pre><p id="e3b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是 Prophet 指出的组件的分解。</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="0eaa" class="mt lr it mp b gy mu mv l mw mx">fig1 = prophet_basic.plot_components(forecast)</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi my"><img src="../Images/516cfd3a8d6b1b4e5edf9a753eaa29ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*7Rp4WdQh284g9VkP1gS9IA.png"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="5a18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">既然已经确定了趋势和季节性因素，下一个任务就是确定数据中的变点数量。</p><p id="1512" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">简单地说，变点是时间序列的轨迹发生重大变化的地方。正确识别这些有助于提高模型的准确性。</p><p id="4f34" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这点上，改变变点参数，并计算测试集的 RMSE(均方根误差)分数:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/0677a0f732158e1e8a9f6fde72830718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JWHazVPcHZD2RvgpUQ7ZlQ.png"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">来源:作者的计算</p></figure><p id="8c53" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">RMSE 通过<strong class="kk iu"> 6 </strong>变点最小化，因此该型号将配置相同的变点。</p><p id="f580" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个转变点的图表:</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="3f34" class="mt lr it mp b gy mu mv l mw mx">import matplotlib.pyplot as plt</span><span id="6d87" class="mt lr it mp b gy na mv l mw mx">figure = pro_change.plot(forecast)<br/>for changepoint in pro_change.changepoints:<br/>    plt.axvline(changepoint,ls='--', lw=1)</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/4eb4dcaa0488c2807d2ba3c0c2bcccd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EWLg2cnV7X2ceoTFUdKeUg.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><h1 id="f4eb" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">结果</h1><p id="13f7" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">上面的 Prophet 模型是在 80%的数据集(训练集)上训练的。现在，针对数据集(测试集)的后 20%生成预测，并计算出<strong class="kk iu">均方根误差</strong>和<strong class="kk iu">平均预测误差</strong>。</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="00df" class="mt lr it mp b gy mu mv l mw mx">&gt;&gt;&gt; from sklearn.metrics import mean_squared_error<br/>&gt;&gt;&gt; from math import sqrt<br/>&gt;&gt;&gt; mse = mean_squared_error(actual, predicted)<br/>&gt;&gt;&gt; rmse = sqrt(mse)<br/>&gt;&gt;&gt; print('RMSE: %f' % rmse)</span><span id="4270" class="mt lr it mp b gy na mv l mw mx">RMSE: 1747.629375</span><span id="4593" class="mt lr it mp b gy na mv l mw mx">&gt;&gt;&gt; forecast_error = (actual-predicted)<br/>&gt;&gt;&gt; mean_forecast_error = np.mean(forecast_error)<br/>&gt;&gt;&gt; mean_forecast_error</span><span id="9d6c" class="mt lr it mp b gy na mv l mw mx">-681.8562874251497</span></pre><p id="dc78" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">测试集中的均方根误差为<strong class="kk iu"> 1，747 </strong>，最大值为<strong class="kk iu"> 9，699 </strong>，与最大值相比，误差似乎是合理的(误差大小约为整个范围的<strong class="kk iu"> 17% </strong>)。</p><p id="414d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当将第 90 百分位作为最大范围时(为了排除异常大的值)，获得最大值<strong class="kk iu">5378</strong>。</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="947d" class="mt lr it mp b gy mu mv l mw mx">&gt;&gt;&gt; np.quantile(actual, 0.9)</span><span id="6336" class="mt lr it mp b gy na mv l mw mx">5378.3</span></pre><p id="c230" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设该值为最大值，均方根误差的大小占总范围的<strong class="kk iu">32%</strong>——这明显更高。</p><p id="9185" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是预测值与实际值的对比图:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/c9401bddbeaa87dcbccbd77e869c98ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*4ZFsbmzRynZqBehxlZAcjg.png"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="6a54" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到，虽然 Prophet 模型通常预测整体趋势，但它未能预测数据中的这些大“峰值”，这导致了更高的预测误差。</p><p id="a3f1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从这个角度来看，虽然 Prophet 在确定数据的长期趋势方面仍然很有用，但使用蒙特卡罗分布可以更有效地预测异常。</p><p id="fafd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">具体而言，网页查看统计似乎遵循帕累托分布，例如，在任何给定的 100 天中，80%的页面查看将在 20%的日子中被记录。如果您感兴趣，参考资料部分包含了关于这个主题的另一篇文章。</p><h1 id="8a8f" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">结论</h1><p id="254b" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">在这个例子中，我们看到 Prophet 是一个有用的时间序列工具，可以用来预测序列的整体趋势，并识别时间序列中的变点或重大的突变。</p><p id="d282" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，网页浏览量在某种程度上是独特的，因为它们受到高度异常的影响，并且 Prophet 在预测不一定依赖于季节性或其他时间相关因素的极值方面可能是有限的。</p><p id="9710" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">非常感谢您的阅读，欢迎任何问题或反馈。</p><p id="311e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nh">免责声明:本文是在“原样”的基础上编写的，没有担保。本文旨在提供数据科学概念的概述，不应以任何方式解释为专业建议。</em></p><h1 id="f6dc" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">参考</h1><ul class=""><li id="96d2" class="ni nj it kk b kl mi ko mj kr nk kv nl kz nm ld nn no np nq bi translated"><a class="ae nr" href="https://facebook.github.io/prophet/docs/trend_changepoints.html" rel="noopener ugc nofollow" target="_blank">预言者:趋势转折点</a></li><li id="b78a" class="ni nj it kk b kl ns ko nt kr nu kv nv kz nw ld nn no np nq bi translated"><a class="ae nr" rel="noopener" target="_blank" href="/pareto-distributions-and-monte-carlo-simulations-bee46113211d">走向数据科学——帕累托分布和蒙特卡洛模拟</a></li><li id="8700" class="ni nj it kk b kl ns ko nt kr nu kv nv kz nw ld nn no np nq bi translated"><a class="ae nr" href="https://pageviews.toolforge.org/?project=en.wikipedia.org&amp;platform=all-access&amp;agent=user&amp;redirects=0&amp;start=2015-07-01&amp;end=2020-08-02&amp;pages=Earthquake" rel="noopener ugc nofollow" target="_blank"> Wikimedia Toolforge:浏览量分析</a></li></ul></div></div>    
</body>
</html>