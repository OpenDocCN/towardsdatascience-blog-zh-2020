<html>
<head>
<title>Efficient Use of TigerGraph and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TigerGraph 和 Docker 的有效使用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/efficient-use-of-tigergraph-and-docker-5e7f9918bf53?source=collection_archive---------39-----------------------#2020-07-12">https://towardsdatascience.com/efficient-use-of-tigergraph-and-docker-5e7f9918bf53?source=collection_archive---------39-----------------------#2020-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="32b5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">TigerGraph 可以与 Docker 结合，在几乎任何操作系统上运行。在本文中，我们解决了大型 TigerGraph 图像及其未使用潜力的问题。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/09f1318335e43c06d91ea749ba2d07f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PFeIPgAyzMRzUGghEhk_eg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。Logos 分别来自<a class="ae kv" href="https://www.tigergraph.com/" rel="noopener ugc nofollow" target="_blank"> TigerGraph </a>和<a class="ae kv" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker 的</a>网站。</p></figure><p id="ca00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">TigerGraph 是我首选的图形数据库和图形分析平台，因为它速度快、可扩展，并且有一个活跃的开源社区。由于附近没有<a class="ae kv" href="https://tgcloud.io/" rel="noopener ugc nofollow" target="_blank"> TigerGraph Cloud </a>服务器，我经常在本地使用 TigerGraph。</p><p id="e092" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在撰写本文时，<a class="ae kv" href="https://docs-beta.tigergraph.com/admin/admin-guide/hw-and-sw-requirements" rel="noopener ugc nofollow" target="_blank"> TigerGraph 软件要求</a>规定支持以下操作系统:</p><ul class=""><li id="c5ac" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">Redhat 和 Centos 版本 6.5–6.9、7.0–7.4 和 8.0–8.2</li><li id="c972" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">Ubuntu 14.04、16.04 和 18.04</li><li id="716d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">Debian 8</li></ul><p id="b886" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于使用这个列表之外的操作系统的人来说，一个合理的解决方案是使用容器化:Docker，在本文的例子中。</p><p id="a51e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将涵盖:</p><ol class=""><li id="b49a" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">如何使用官方 TigerGraph 和里面的内容</li><li id="85ce" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">剥离不必要的臃肿的官方码头形象</li><li id="45a6" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">修改入口点以添加:</li></ol><ul class=""><li id="1433" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">启动时运行<code class="fe mh mi mj mk b">gadmin</code></li><li id="d3d0" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">运行绑定在某个目录下的 GSQL 脚本</li><li id="9704" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">将日志文件的输出发送到<code class="fe mh mi mj mk b">STDOUT</code></li></ul><p id="1624" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4.使用 Docker Compose 运行 TigerGraph 图像</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="1442" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">官方 TigerGraph 图像</h1><p id="449f" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">运行开发人员版的官方 TigerGraph 映像可以通过以下命令获得:</p><pre class="kg kh ki kj gt np mk nq nr aw ns bi"><span id="1b15" class="nt mt iq mk b gy nu nv l nw nx">docker pull docker.tigergraph.com/tigergraph-dev:latest</span></pre><p id="3e6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行方式:</p><pre class="kg kh ki kj gt np mk nq nr aw ns bi"><span id="382e" class="nt mt iq mk b gy nu nv l nw nx">docker run -d -p 14022:22 -p 9000:9000 -p 14240:14240 --name tigergraph_dev --ulimit nofile=1000000:1000000 -v ~/data:/home/tigergraph/mydata -t docker.tigergraph.com/tigergraph-dev:latest</span></pre><p id="900b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该<a class="ae kv" href="https://github.com/tigergraph/ecosys/tree/master/demos/guru_scripts/docker" rel="noopener ugc nofollow" target="_blank">源</a>给出了关于如何构建图像的更深入的说明，但概括来说:</p><ul class=""><li id="b792" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">使用 Ubuntu 16.04 的基本映像</li><li id="71d4" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">所有必需的软件，如 tar、curl 等。已安装</li><li id="0764" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">可选软件，如 emacs、vim、wget 等。已安装</li><li id="f12b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">GSQL 101 和 102 教程以及 GSQL 算法库已下载</li><li id="113c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">SSH 服务器、REST++ API 和 GraphStudio 是 3 个值得注意的端口，它们可以暴露出来并用于与服务器通信</li></ul><p id="bf2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">整个映像的下载量接近 1.8-2.0 GB(取决于版本)，这给带宽带来了相当大的压力，尤其是对于 CI/CD 这样的资源敏感型使用情形。另一个值得注意的点是，使用 TigerGraph 所需要的只是一个 GSQL 套接字连接，它可以通过诸如<a class="ae kv" href="https://github.com/Optum/giraffle" rel="noopener ugc nofollow" target="_blank"> Giraffle </a>和<a class="ae kv" href="https://pypi.org/project/pyTigerGraph/" rel="noopener ugc nofollow" target="_blank"> pyTigerGraph </a>之类的工具进行接口。</p><p id="9058" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我已经确定了膨胀的两个主要来源:</p><ul class=""><li id="cf3f" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">可选和不必要的软件，如 vim 和 GSQL 教程 101</li><li id="2e32" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">TigerGraph Developer Edition 的最小操作不需要 GraphStudio 和二进制文件</li></ul><h1 id="3dfa" class="ms mt iq bd mu mv ny mx my mz nz nb nc jw oa jx ne jz ob ka ng kc oc kd ni nj bi translated">剥离老虎图像</h1><p id="c122" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">我用 Bitnami 的<a class="ae kv" href="https://github.com/bitnami/minideb" rel="noopener ugc nofollow" target="_blank"> MiniDeb 映像</a>替换了基本映像<code class="fe mh mi mj mk b">ubuntu:16.04</code>，以便去掉几兆字节的不必要空间。这是黛比·杰西的作品。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="07c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是删除在官方映像的<code class="fe mh mi mj mk b">apt-get</code>阶段安装的不必要的二进制文件。我将 Vim 作为唯一的命令行文本编辑器，但保留了诸如<code class="fe mh mi mj mk b">wget</code>、<code class="fe mh mi mj mk b">git</code>、<code class="fe mh mi mj mk b">unzip</code>、<code class="fe mh mi mj mk b">emacs</code>等二进制文件。不再安装。</p><p id="17c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在 TigerGraph 安装期间，严格执行<a class="ae kv" href="https://docs-beta.tigergraph.com/admin/admin-guide/hw-and-sw-requirements" rel="noopener ugc nofollow" target="_blank">硬件要求</a>，如果不满足，安装将失败。因为我想让 DockerHub runners 自动构建和推送我的映像，所以我破解了这个检查，以便资源不足的 runners 可以继续构建映像。</p><p id="a775" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是通过用我的版本替换<code class="fe mh mi mj mk b">os_utils</code>二进制来实现的，这使得<code class="fe mh mi mj mk b">check_cpu_number()</code>和<code class="fe mh mi mj mk b">check_memory_capacity()</code>函数更加宽松。这个二进制文件可以在下面找到:</p><pre class="kg kh ki kj gt np mk nq nr aw ns bi"><span id="c189" class="nt mt iq mk b gy nu nv l nw nx">/home/tigergraph/tigergraph-${DEV_VERSION}-developer/utils/os_utils</span></pre><p id="10a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这已经减少了大约 400MB 的膨胀，我的 DockerHub 图像报告了 1.52GB 的压缩大小 TigerGraph 3.0.0(我注意到下载这些层表明它大约为 1.62GB)。</p><p id="c182" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:我曾试图随意删除 GraphStudio 二进制文件，但这无法通过<code class="fe mh mi mj mk b">gadmin start</code>脚本，因此必须进行更细致的调整，以便从 TigerGraph 中删除更多内容，例如编辑<code class="fe mh mi mj mk b">gadmin</code> Python 脚本。</p><p id="5e68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我下载并解压缩了这两个图像，它们之间的最终结果可以通过调用<code class="fe mh mi mj mk b">docker images</code>来查看:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="c79c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我构建的源代码可以在这里找到<a class="ae kv" href="https://github.com/DavidBakerEffendi/tigergraph" rel="noopener ugc nofollow" target="_blank">我鼓励任何有建议的人联系我！</a></p><p id="0317" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">更新(2020 年 2 月 11 日):感谢 Bruno imi 在这项工作的基础上精简了 TigerGraph 企业版，并与我分享了他的代码。以下额外的剥离是他的工作，已经在这个形象实施。</strong></p><p id="4b96" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装目录下似乎有文档和不必要的构建工件(比如许多<code class="fe mh mi mj mk b">node_modules</code>)。可以在以下位置找到这些示例:</p><ul class=""><li id="0783" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><code class="fe mh mi mj mk b">${INSTALL_DIR}/app/${DEV_VERSION}/document/</code></li><li id="af1e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe mh mi mj mk b">${INSTALL_DIR}/app/${DEV_VERSION}/bin/gui/server/node_modules</code></li><li id="ddc9" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe mh mi mj mk b">${INSTALL_DIR}/app/${DEV_VERSION}/bin/gui/node/lib/node_modules</code></li><li id="ff27" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe mh mi mj mk b">${INSTALL_DIR}/app/${DEV_VERSION}/gui/server/node_modules/</code></li><li id="b811" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe mh mi mj mk b">${INSTALL_DIR}/app/${DEV_VERSION}/.syspre/usr/share/</code></li><li id="05d4" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe mh mi mj mk b">${INSTALL_DIR}/app/${DEV_VERSION}/.syspre/usr/lib/jvm/java-8-openjdk-amd64–1.8.0.171/</code></li></ul><p id="c758" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中<code class="fe mh mi mj mk b">INSTALL_DIR</code>是 TigerGraph Developer Edition v3 的<code class="fe mh mi mj mk b">/home/tigergraph/tigergraph</code>，而<code class="fe mh mi mj mk b">DEV_VERSION</code>是特定版本，例如<code class="fe mh mi mj mk b">3.0.0</code>。</p><p id="5b68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">执行 tiger graph Developer Edition v3.0.5 的新版本，并将其与我的新版本 v 3 . 0 . 5 进行比较，我们看到使用了以下数量的磁盘空间:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><h1 id="cd20" class="ms mt iq bd mu mv ny mx my mz nz nb nc jw oa jx ne jz ob ka ng kc oc kd ni nj bi translated">修改入口点</h1><p id="d76c" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">在我们添加功能之前，让我们先来看看最初的<code class="fe mh mi mj mk b">ENTRYPOINT</code>:</p><pre class="kg kh ki kj gt np mk nq nr aw ns bi"><span id="d93f" class="nt mt iq mk b gy nu nv l nw nx">ENTRYPOINT /usr/sbin/sshd &amp;&amp; su — tigergraph bash -c “tail -f /dev/null”</span></pre><p id="999a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这做了两件事:</p><ol class=""><li id="6457" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">SSH 服务器通过运行<code class="fe mh mi mj mk b">/usr/sbin/ssh</code>启动。</li><li id="756b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">通过以用户<code class="fe mh mi mj mk b">tigergraph</code>的身份运行<code class="fe mh mi mj mk b">tail</code>命令，容器保持活动状态。这样做的目的是不断地从<code class="fe mh mi mj mk b">/dev/null</code>读取输出，这也是为什么容器的<code class="fe mh mi mj mk b">STDOUT</code>是空的。</li></ol><h2 id="b875" class="nt mt iq bd mu of og dn my oh oi dp nc lf oj ok ne lj ol om ng ln on oo ni op bi translated">启动时启动“gadmin”</h2><p id="d35a" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">为了改善用户体验，我添加了一行代码，在 Docker 入口点启动<code class="fe mh mi mj mk b">gadmin</code>服务</p><pre class="kg kh ki kj gt np mk nq nr aw ns bi"><span id="f89a" class="nt mt iq mk b gy nu nv l nw nx">ENTRYPOINT /usr/sbin/sshd &amp;&amp; su - tigergraph bash -c "tail -f /dev/null"</span></pre><p id="ae1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到</p><pre class="kg kh ki kj gt np mk nq nr aw ns bi"><span id="c305" class="nt mt iq mk b gy nu nv l nw nx">ENTRYPOINT /usr/sbin/sshd &amp;&amp; su - tigergraph bash -c "/home/tigergraph/tigergraph/app/cmd/gadmin start all &amp;&amp; tail -f /dev/null"</span></pre><p id="9403" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个很简单却很有价值的改变！</p><h2 id="959d" class="nt mt iq bd mu of og dn my oh oi dp nc lf oj ok ne lj ol om ng ln on oo ni op bi translated">使用卷在启动时运行 GSQL 脚本</h2><p id="2342" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">TigerGraph Docker 映像缺少(MySQL、MariaDB 和 PostgreSQL 等其他数据库映像有)一个名为 Something 的目录，类似于<code class="fe mh mi mj mk b">docker-entrypoint-init.d</code>，用户可以在其中绑定数据库脚本以在启动时运行，例如用于模式创建或数据库填充。</p><p id="7b40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有多种方法可以实现这一点，但我选择了一个相当简单的方法，在<code class="fe mh mi mj mk b">gadmin</code>和<code class="fe mh mi mj mk b">tail</code>命令之间添加下面一行:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="ca79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该命令的工作原理是:</p><ol class=""><li id="1186" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">命令<code class="fe mh mi mj mk b">if</code>将检查一个名为<code class="fe mh mi mj mk b">/docker-entrypoint-initdb.d</code>的目录是否存在，除非存在，否则不会执行下一步。</li><li id="65f6" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe mh mi mj mk b">for file in /docker-entrypoint-initdb.d/*.gsql; do</code>行将对入口点文件夹中以扩展名<code class="fe mh mi mj mk b">gsql</code>结尾的所有文件开始 for-each 循环。</li><li id="d683" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe mh mi mj mk b">su tigergraph bash -c</code>行将对 for-each 循环给出的文件运行 GSQL 命令。</li><li id="5492" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">通过添加<code class="fe mh mi mj mk b">|| continue</code>，如果脚本执行失败，容器和循环都不会停止。</li></ol><p id="39b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果放入<code class="fe mh mi mj mk b">entrypoint.sh</code>中，这看起来会更整洁，但这取决于你！最终结果看起来像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><h2 id="f319" class="nt mt iq bd mu of og dn my oh oi dp nc lf oj ok ne lj ol om ng ln on oo ni op bi translated">将日志路由到标准输出</h2><p id="d8b1" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">为了弄清楚日志属于哪里，可以运行<code class="fe mh mi mj mk b">gadmin log</code>，它将返回如下内容</p><pre class="kg kh ki kj gt np mk nq nr aw ns bi"><span id="f65f" class="nt mt iq mk b gy nu nv l nw nx">ADMIN  : /home/tigergraph/tigergraph/log/admin/ADMIN#1.out<br/>ADMIN  : /home/tigergraph/tigergraph/log/admin/ADMIN.INFO<br/>CTRL   : /home/tigergraph/tigergraph/log/controller/CTRL#1.log<br/>CTRL   : /home/tigergraph/tigergraph/log/controller/CTRL#1.out<br/>DICT   : /home/tigergraph/tigergraph/log/dict/DICT#1.out<br/>DICT   : /home/tigergraph/tigergraph/log/dict/DICT.INFO<br/>ETCD   : /home/tigergraph/tigergraph/log/etcd/ETCD#1.out<br/>EXE    : /home/tigergraph/tigergraph/log/executor/EXE_1.log<br/>EXE    : /home/tigergraph/tigergraph/log/executor/EXE_1.out<br/>...etc</span></pre><p id="6768" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我最感兴趣的是管理日志，所以我将把<code class="fe mh mi mj mk b">tail</code>命令改为从<code class="fe mh mi mj mk b">/home/tigergraph/tigergraph/log/admin/ADMIN.INFO</code>而不是<code class="fe mh mi mj mk b">/dev/null</code>中读取。</p><p id="2bbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，写入管理日志的任何内容都将自动传输到容器的日志中。所有三个步骤的最终产品现在是:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><h1 id="e636" class="ms mt iq bd mu mv ny mx my mz nz nb nc jw oa jx ne jz ob ka ng kc oc kd ni nj bi translated">使用 Docker 编写 TigerGraph</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="3a03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，我添加了一个健康检查，它每 5 秒钟调用一次 REST++ echo 端点来确定容器是否健康。如果您使用官方映像，您将需要 SSH 到容器中来手动启动所有服务:</p><p id="ecc6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您希望 GSQL 脚本在启动时运行，请在<code class="fe mh mi mj mk b">volumes</code>下添加以下条目:</p><pre class="kg kh ki kj gt np mk nq nr aw ns bi"><span id="7a98" class="nt mt iq mk b gy nu nv l nw nx">- my_script.gsql:/docker-entrypoint-initdb.d/my_script.gsql</span></pre><p id="c62c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，我添加了一个健康检查，它每 5 秒钟调用一次 REST++ echo 端点来确定容器是否健康。这对于许多应用程序都很有用，在我的用例中，用于在开始测试之前检查容器在集成测试期间是否准备好了。</p><p id="1aa8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您使用官方映像，您将需要 SSH 到容器中来手动启动所有服务:</p><p id="72b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">默认密码是“tigergraph ”,在此之后您可以调用该命令</p><pre class="kg kh ki kj gt np mk nq nr aw ns bi"><span id="54f9" class="nt mt iq mk b gy nu nv l nw nx">gadmin start all (v3.0.0 &gt;=)<br/>gadmin start (v3.0.0&lt;)</span></pre><p id="8162" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">GraphStudio 可以在您的网络浏览器的<code class="fe mh mi mj mk b">localhost:14240</code>中找到，Rest++可以在<code class="fe mh mi mj mk b">localhost:9000</code>中找到。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="7a0c" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">结论</h1><p id="0c87" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">在这篇文章中，我们有:</p><ul class=""><li id="6106" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">检查了官方文件，</li><li id="1892" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">识别并删除明显不必要的文件，</li><li id="795e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">构建了一个精简版的 TigerGraph 图像，节省了大量的磁盘空间，</li><li id="8825" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">修改了<code class="fe mh mi mj mk b">ENTRYPOINT</code>以向容器添加额外的自动化，以及</li><li id="dbd1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">使用 Docker Compose 运行此图像。</li></ul><p id="6b9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你对进一步减小图片的大小有任何建议或想法，那么留下评论、问题或分叉，并在<a class="ae kv" href="https://github.com/DavidBakerEffendi/tigergraph" rel="noopener ugc nofollow" target="_blank"> GitHub 库</a>上对本文中的代码提出请求。如果你想看更多 Docker 相关的指南，为数据库如 JanusGraph 建立自定义设置，请在下面留下评论。</p><p id="3306" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在<a class="ae kv" href="https://hub.docker.com/repository/docker/dbakereffendi/tigergraph" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>上找到这些图片，我会随着新版本的出现继续更新这些图片，或者直到 TigerGraph 推出正式的更瘦版本。</p><p id="7824" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想加入 TigerGraph 社区并做出贡献，或者启动令人敬畏的项目并深入了解 TigerGraph 的未来，请在以下平台上加入我们:</p><ul class=""><li id="48aa" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><a class="ae kv" href="https://discord.gg/F2c9b9v" rel="noopener ugc nofollow" target="_blank">不和</a></li><li id="4f53" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://www.reddit.com/r/tigergraph/" rel="noopener ugc nofollow" target="_blank"> Reddit </a></li><li id="e493" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://www.twitch.tv/tigergraph" rel="noopener ugc nofollow" target="_blank">抽动</a></li></ul><p id="79a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你有兴趣看我的其他作品，那就看看我在 https://davidbakereffendi.github.io/的个人主页。</p><p id="e454" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">TigerGraph 的 Jon Herke 在社区中发挥了领导作用，让我们能够以有意义的方式做出贡献，Bruno imi 分享了他在精简 TigerGraph 企业版图像方面的发现，这些发现可在<a class="ae kv" href="https://hub.docker.com/r/xpertmind/tigergraph" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/r/xpertmind/tigergraph</a>找到。</p></div></div>    
</body>
</html>