<html>
<head>
<title>Pandas Tricks that Expedite Data Analysis Process</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加快数据分析过程的熊猫技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandas-tricks-that-expedite-data-analysis-process-e941dbfc3e75?source=collection_archive---------43-----------------------#2020-06-02">https://towardsdatascience.com/pandas-tricks-that-expedite-data-analysis-process-e941dbfc3e75?source=collection_archive---------43-----------------------#2020-06-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2cf9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用这些简单的技巧加速你的数据分析过程。</h2></div><p id="b9f4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Pandas 是一个非常强大和通用的 Python 数据分析库，它加速了数据科学项目的预处理步骤。它提供了许多在数据分析中非常有用的函数和方法。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/c601ea32313a83218fe1f2334d2d0bef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Xo1hKPwzSZ8lWTbu.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated"><a class="ae lu" href="https://unsplash.com/@danielkcheung?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">张家瑜</a>在<a class="ae lu" href="https://unsplash.com/s/photos/small?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="faaa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一如既往，我们从进口熊猫开始。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="8122" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span></pre><p id="ab14" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们创建一个样本数据帧来处理。Pandas 是一个多功能库，通常提供多种方式来完成一项任务。因此，有许多方法可以创建数据帧。一种常见的方法是传递包含列作为键值对的字典。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="d126" class="ma mb it lw b gy mc md l me mf">values = np.random.randint(10, size=10)</span><span id="0106" class="ma mb it lw b gy mg md l me mf">years = np.arange(2010,2020)</span><span id="bcad" class="ma mb it lw b gy mg md l me mf">groups = ['A','A','B','A','B','B','C','A','C','C']</span><span id="41f4" class="ma mb it lw b gy mg md l me mf">df = pd.DataFrame({'group':groups, 'year':years, 'value':values})</span><span id="79ce" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mh"><img src="../Images/f5fcf6f7123a62fe42f20ee3ef7d3c79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vtU-1dpPBqh1cMRrJDd74Q.png"/></div></div></figure><p id="d1d3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还使用 numpy 创建数组，用作列中的值。<strong class="kk iu"> np.arange </strong>返回指定区间内的范围值。<strong class="kk iu"> np.random.randint </strong>根据指定的范围和大小返回随机整数值。</p><p id="1c26" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据框架包含 3 个不同组的一些年值。我们可能只对每年的值感兴趣，但在某些情况下，我们也需要一个累计和。Pandas 提供了一个简单易用的函数来计算累计和，即<strong class="kk iu"> cumsum </strong>。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="f175" class="ma mb it lw b gy mc md l me mf">df['cumsum'] = df['value'].cumsum()</span><span id="24b2" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mi"><img src="../Images/d7277a329965f3666fd72a3bd120c219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGFf9iqwh3wxOmhqHnwX9g.png"/></div></div></figure><p id="bbdc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们创建了一个名为“cumsum”的列，它包含值列中数字的累积和。但是，它不考虑群体。这种累积值在某些情况下可能没有用，因为我们无法区分不同的组。放心吧！这个问题有一个非常简单方便的解决方案。我们可以应用<strong class="kk iu"> groupby </strong>函数。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="5d46" class="ma mb it lw b gy mc md l me mf">df['cumsum'] = df[['value','group']].groupby('group').cumsum()</span><span id="2b38" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mj"><img src="../Images/e8f19bc79ce8258c8f6323f083d43ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qvju-gP7rs4I07r45GigDg.png"/></div></div></figure><p id="42f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们首先对“组”列应用<strong class="kk iu"> groupby </strong>，然后应用<strong class="kk iu"> cumsum </strong>函数。现在，每组内的值相加。为了使数据框看起来更好，我们可能希望根据组而不是年份对值进行排序，这样我们可以直观地将组分开。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="2250" class="ma mb it lw b gy mc md l me mf">df.sort_values(by='group').reset_index()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mk"><img src="../Images/d56b4713d3ca9cfe448a3a1080734a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4blaZQ4oWzpK6rUt2Rqs-w.png"/></div></div></figure><p id="abcc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们应用了<strong class="kk iu"> sort_values </strong>函数，并用<strong class="kk iu"> reset_index </strong>函数重置索引。正如我们在返回的数据帧中看到的，原始索引作为一列保存。我们可以通过将 reset_index 函数的<strong class="kk iu"> drop </strong>参数设置为 True 来消除。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="baf9" class="ma mb it lw b gy mc md l me mf">df = df.sort_values(by='group').reset_index(drop=True)</span><span id="f5ab" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ml"><img src="../Images/d7d1e5e40c777389ecc8df11c652279c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eRIy-9cwoZ-G47tdNb6zMQ.png"/></div></div></figure><p id="2ab4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在看起来好多了。当我们想在数据帧中添加一个新列时，默认情况下它会被添加到末尾。然而，pandas 提供了使用<strong class="kk iu">插入</strong>功能在任意位置添加新列的选项。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="5680" class="ma mb it lw b gy mc md l me mf">new = np.random.randint(5, size=10)</span><span id="507d" class="ma mb it lw b gy mg md l me mf">df.insert(2, 'new_col', new)</span><span id="6d1b" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mm"><img src="../Images/79d7c9843b6f2e9bc93c5991b11bae91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q9wBLTVAoGkM8wdlJYRhww.png"/></div></div></figure><p id="0cf9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们通过传递一个索引作为第一个参数来指定位置。该值必须是整数。列索引从零开始，就像行索引一样。第二个参数是列名，第三个参数是包含值的对象，这些值可以是<strong class="kk iu">系列</strong>或类似<strong class="kk iu">数组的</strong>对象。</p><p id="7cac" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们想从数据帧中删除一列，但又想将该列保留为一个单独的序列。一种方法是将该列分配给一个系列，然后使用<strong class="kk iu"> drop </strong>功能。更简单的方法是使用<strong class="kk iu"> pop </strong>功能。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="1056" class="ma mb it lw b gy mc md l me mf">value = df.pop('value')</span><span id="21e7" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mn"><img src="../Images/7b17c9070e6a20c43ed9902262f9fcb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VuOi7QRLJ6JvQQfL6Wypew.png"/></div></div></figure><p id="f69c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过一行代码，我们从 dataframe 中删除了 value 列，并将其存储在 pandas 系列中。</p><p id="f933" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有时需要根据条件过滤数据帧或应用掩码来获得某些值。过滤数据帧的一个简单方法是<strong class="kk iu">查询</strong>函数。我将使用我们一直使用的样本数据框架。让我们首先将“值”列插回:</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="1e03" class="ma mb it lw b gy mc md l me mf">df.insert(2, 'value', value)</span><span id="cb7c" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mo"><img src="../Images/d273bda23ba95479e43c3d961d17e33b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5ebiD4Hjj0dGNMdsuOnyA.png"/></div></div></figure><p id="4423" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用查询函数非常简单，只需要条件。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="bfef" class="ma mb it lw b gy mc md l me mf">df.query('value &lt; new_col')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mh"><img src="../Images/fd3a99712f3921edce87ed7f802ce49f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OiVqN1Kj_ZKTGrxbsvfpqw.png"/></div></div></figure><p id="0bd8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它返回“值”小于“新列”的行。我们可以设置更复杂的条件，也可以使用额外的操作符。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="c510" class="ma mb it lw b gy mc md l me mf">df.query('2*new_col &gt; value')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mp"><img src="../Images/2556995d47160d3c19a4b546861bde47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*68vfimXV2olvS6zO59NmVQ.png"/></div></div></figure><p id="d803" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以将多个条件组合成一个查询。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="1aa2" class="ma mb it lw b gy mc md l me mf">df.query('2*new_col &gt; value &amp; cumsum &lt; 15')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mq"><img src="../Images/a4e75722c0bb57b2f54ddb584714e116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CZe9IS-jbtsdgtx1TV-MKQ.png"/></div></div></figure><p id="ffbc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用许多聚合函数来计算列的基本统计信息，如平均值、总和、计数等。我们可以将这些函数中每一个应用于一个列。然而，在某些情况下，我们可能需要检查不止一种类型的统计数据。例如，在某些情况下，计数和平均值可能都很重要。pandas 没有单独应用函数，而是提供了 agg 函数来应用多个聚合函数。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="17f5" class="ma mb it lw b gy mc md l me mf">df[['group','value']].groupby('group').agg(['mean','count'])</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mr"><img src="../Images/0c46b728e8bcbf20f4a907772eea409c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uZLZaApJ1yP5va1pwjQ27w.png"/></div></div></figure><p id="c433" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">既看均值又看计数更有意义。我们可以很容易地检测出异常值，这些异常值具有极端的平均值，但观察次数非常少。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="6cdc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我认为熊猫的成功和流行来自于其多功能、强大且易于使用的操作和分析数据的功能。和熊猫一起完成一项任务几乎总是有多种方式。由于花在数据科学项目上的大部分时间都花在了数据清理和预处理步骤上，Pandas 是您武库中的宝贵资产。</p><p id="9328" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>