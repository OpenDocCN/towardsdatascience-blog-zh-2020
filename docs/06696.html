<html>
<head>
<title>Pie Charts in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的饼图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pie-charts-in-python-302de204966c?source=collection_archive---------13-----------------------#2020-05-26">https://towardsdatascience.com/pie-charts-in-python-302de204966c?source=collection_archive---------13-----------------------#2020-05-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7b55" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用Python创建饼图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/45529b90aa99e1deb0f183f18b9a0bae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EJUtcsaCubKHSY-8ipmRCQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pexels.com/photo/lights-blue-wire-lighbulbs-91413/" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="6214" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">饼图是一种数据可视化类型，用于说明数据中的数字比例。python库“matplotlib”为创建漂亮的可视化效果提供了许多有用的工具，包括饼状图。在这篇文章中，我们将讨论如何使用“matplotlib”在python中创建饼状图。</p><p id="22e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><p id="7784" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于我们的目的，我们将使用<em class="lv">网飞电影和电视节目</em>数据集，可以在<a class="ae ky" href="https://www.kaggle.com/shivamb/netflix-shows" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="5745" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们将数据读入熊猫数据框；</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="8c56" class="mb mc it lx b gy md me l mf mg">import pandas as pd <br/>df = pd.read_csv("netflix_titles.csv")</span></pre><p id="9dc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们使用。head()'方法:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="a1e3" class="mb mc it lx b gy md me l mf mg">print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/87cc351b4c7655e895dda81ed2d878df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3cDjvDqkK39FtvwIBO2qKA.png"/></div></div></figure><p id="a21b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，数据包含具有各种分类值的列。饼图通常显示数据集中不同类别的相对比例。对于我们的饼图可视化，“评级”、“国家”和“类型”列是我们可以分组和可视化的带有分类值的数据的很好的例子。</p><p id="b667" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了了解这些列的分类值的分布情况，我们可以使用collections模块中的“Counter”方法。让我们将“计数器”方法应用于“类型”列:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="aaed" class="mb mc it lx b gy md me l mf mg">from collections import Counter<br/>print(Counter(df['type']))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/0aa8aa89e980a2dfd95bae776b6101b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*5P2Bw7GaOm2PS_EV1JvjWA.png"/></div></figure><p id="b160" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看“评级”栏:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="e595" class="mb mc it lx b gy md me l mf mg">print(Counter(df['rating']))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/e1057aef782869ce1fd4b89c2acc5113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0WbFYca0UISfYLM-bpO7NQ.png"/></div></div></figure><p id="da07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们按照每个“类型”类别的值的数量对数据进行分组:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="f80e" class="mb mc it lx b gy md me l mf mg">title_type = df.groupby('type').agg('count')<br/>print(title_type)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/151b9df9583ea3c6584ec72a7173ca43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i5W8jGPxHOKJekrnDov2wA.png"/></div></div></figure><p id="0149" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们从“matplotlib”导入几个模块:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="f75f" class="mb mc it lx b gy md me l mf mg">import matplotlib.ticker as ticker<br/>import matplotlib.cm as cm<br/>import matplotlib as mpl<br/>from matplotlib.gridspec import GridSpec<br/>import matplotlib.pyplot as plt</span></pre><p id="cbf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们对聚合类型的指数和计数进行排序:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="76b3" class="mb mc it lx b gy md me l mf mg">type_labels = title_type.show_id.sort_values().index <br/>type_counts = title_type.show_id.sort_values()</span></pre><p id="31b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们指定图形细节:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="23ff" class="mb mc it lx b gy md me l mf mg">plt.figure(1, figsize=(20,10)) <br/>the_grid = GridSpec(2, 2)</span></pre><p id="91eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并指定颜色映射信息:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="b162" class="mb mc it lx b gy md me l mf mg">cmap = plt.get_cmap('Spectral')<br/>colors = [cmap(i) for i in np.linspace(0, 1, 8)]</span></pre><p id="4973" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们绘制饼图:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="60b6" class="mb mc it lx b gy md me l mf mg">plt.subplot(the_grid[0, 1], aspect=1, title='Types of Netflix Titles')<br/>type_show_ids = plt.pie(type_counts, labels=type_labels, autopct='%1.1f%%', shadow=True, colors=colors)<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/987052a00b99749e63618fd0477aa73f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*UVY3F3PgWDCbOe-eVwwxgg.png"/></div></figure><p id="aa0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到这个数据集中的大多数网飞电影都是电影。我们还可以为评级生成一个饼图。让我们按评级汇总:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="e583" class="mb mc it lx b gy md me l mf mg">title_rating = df.groupby('rating').agg('count')<br/>rating_labels = title_rating.show_id.sort_values().index <br/>rating_counts = title_rating.show_id.sort_values()</span></pre><p id="a53f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">绘制我们的图表:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="e5ef" class="mb mc it lx b gy md me l mf mg">plt.figure(1, figsize=(40,20))<br/>the_grid = GridSpec(2, 2)<br/>cmap = plt.get_cmap('Spectral')<br/>colors = [cmap(i) for i in np.linspace(0, 1, 8)]</span><span id="50a0" class="mb mc it lx b gy mm me l mf mg">plt.subplot(the_grid[0, 1], aspect=1, title='Ratings of Netflix Titles')<br/>type_show_ids = plt.pie(rating_counts, labels=rating_labels, autopct='%1.1f%%', shadow=True, colors=colors)<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/f9d4de14569bd01df051085be159f116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qsbYTTndyozA81dIY1H4WQ.png"/></div></div></figure><p id="fea1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到“TV-14”和“TV-MA”是数据中最常见的收视率。饼图的一个缺点是，一列中出现的类别越多，它们的用处就越小。例如，在我们的评级饼图中，“G”、“NC-17”和“ur”评级重叠，这在视觉上看起来并不令人愉快。你可以想象，随着类别数量的增加，情况会变得更糟。为了解决这个问题，让我们定义一个函数来计算第75个百分位数，并将较少的计数组合在“其他”类别中:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="5fec" class="mb mc it lx b gy md me l mf mg">def group_lower_ranking_values(column):<br/>    rating_counts = df.groupby(column).agg('count')<br/>    pct_value = rating_counts[lambda x: x.columns[0]].quantile(.75)<br/>    values_below_pct_value = rating_counts[lambda x: x.columns[0]].loc[lambda s: s &lt; pct_value].index.values<br/>    def fix_values(row):<br/>        if row[column] in values_below_pct_value:<br/>            row[column] = 'Other'<br/>        return row <br/>    rating_grouped = df.apply(fix_values, axis=1).groupby(column).agg('count')<br/>    return rating_grouped</span></pre><p id="9a30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以使用这个函数来聚集我们的数据:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="51ad" class="mb mc it lx b gy md me l mf mg">rating_grouped = group_lower_ranking_values('rating')<br/>rating_labels = rating_grouped.show_id.sort_values().index <br/>rating_counts = rating_grouped.show_id.sort_values()</span></pre><p id="ee44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并绘制出结果:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="6f2a" class="mb mc it lx b gy md me l mf mg">plt.subplot(the_grid[0, 1], aspect=1, title='Rating of Netflix Titles')<br/>type_show_ids = plt.pie(rating_counts, labels=rating_labels, autopct='%1.1f%%', shadow=True, colors=colors)<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/b1197bf5c841f62f9d7955f703802f29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qXLr4lnf6Vltffg9xA0Hmg.png"/></div></div></figure><p id="2cee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到这看起来比以前的情节好多了。让我们为country列做同样的事情。这里，我们将考虑第99百分位:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="d6cc" class="mb mc it lx b gy md me l mf mg">def group_lower_ranking_values(column):<br/>    ...<br/>    pct_value = rating_counts[lambda x: x.columns[0]].<strong class="lx iu">quantile(.99)</strong><br/>    ...<br/>    return rating_grouped</span><span id="7d8f" class="mb mc it lx b gy mm me l mf mg">country_grouped = group_lower_ranking_values('country')<br/>country_labels = country_grouped.show_id.sort_values().index <br/>country_counts = country_grouped.show_id.sort_values()</span><span id="3308" class="mb mc it lx b gy mm me l mf mg">plt.subplot(the_grid[0, 1], aspect=1, title='Country of Netflix Titles')<br/>type_show_ids = plt.pie(country_counts, labels=country_labels, autopct='%1.1f%%', shadow=True, colors=colors)<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/982cd45a090f52c5cd3dcc58ea3a1f14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C6WVhDv7zVQx9zBqMTVe8w.png"/></div></div></figure><p id="ab9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我就讲到这里，但是您可以自己随意摆弄代码。</p><h2 id="d459" class="mb mc it bd mq mr ms dn mt mu mv dp mw li mx my mz lm na nb nc lq nd ne nf ng bi translated">结论</h2><p id="4877" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">总之，在这篇文章中，我们讨论了如何用python创建饼状图。我们表明，代表相应的标题类型，评级和网飞标题国家类别的比例。我们还展示了如何通过计算排名最高的类别并将排名较低的值分组到一个“其他”组中，来解决可视化具有太多类别类型的列的问题。我希望你觉得这篇文章有趣/有用。这篇文章的代码可以在GitHub 上找到。感谢您的阅读！</p></div></div>    
</body>
</html>