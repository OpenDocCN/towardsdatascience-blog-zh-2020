<html>
<head>
<title>The Art of Geofencing in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的地理围栏艺术</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-art-of-geofencing-in-python-e6cc237e172d?source=collection_archive---------17-----------------------#2020-03-16">https://towardsdatascience.com/the-art-of-geofencing-in-python-e6cc237e172d?source=collection_archive---------17-----------------------#2020-03-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4f8d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">教程-触发通知并向用户推送GPS位置。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e3cbf075d222458e25dbd9a3ca6d14f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*G6L1Y7ka3Q7pqh8jjQi28A.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">地图框中的地理围栏示例:伦敦拥堵— <a class="ae ky" href="https://labs.mapbox.com/bites/00223/" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="2540" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">地理围栏是地理数据科学中常用的工具，尤其是在营销、安全和分区应用中。上面GIF中的例子显示了一个应用程序，它根据车辆的位置和伦敦的拥堵费区(CCZ)向车辆发出警报。该应用程序计算拥堵费，并跟踪给定时间拥堵区域内的车辆数量。</p><p id="21d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">地理围栏的概念很简单，但它是一种增强定位应用的强大技术。简单地说，<strong class="lb iu">地理围栏是地理对象或区域周围的定义虚拟边界，以便用户每次进入或离开边界周界时，都可以触发操作或通知。</strong>随着智能手机、GPS和定位服务使用的增加，地理围栏成为位置数据分析和情报中不可或缺的工具。</p><p id="b7fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们使用GPS轨迹数据集。它包含带有时间戳的GPS <br/>点(纬度和经度)。它还为每个轨迹提供唯一的track_id。让我们用熊猫图书馆读数据。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ec53" class="ma mb it lw b gy mc md l me mf">import pandas as pd<br/>import geopandas as gpd<br/>import plotly_express as px<br/>import matplotlib.pyplot as plt</span><span id="9cb2" class="ma mb it lw b gy mg md l me mf">!wget <a class="ae ky" href="https://www.dropbox.com/s/ejev7z29lzirbo5/GPSTrajectory.zip" rel="noopener ugc nofollow" target="_blank">https://www.dropbox.com/s/ejev7z29lzirbo5/GPSTrajectory.zip</a><br/>!unzip GPSTrajectory.zip</span><span id="dc00" class="ma mb it lw b gy mg md l me mf">df = pd.read_csv(‘GPSTrajectory/go_track_trackspoints.csv’)<br/>df.head()</span></pre><p id="600a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集的前五行如下所示。我们有纬度和经度以及track_id和时间。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/beb24219bc7c528c89b77748a350b68b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*DT92IVvROtEUGEFSO5600Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">轨迹数据帧</p></figure><p id="692e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将数据框架转换为地理数据框架，从而可以执行地理围栏。使用Geopandas将数据框转换为地理数据框非常简单。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c114" class="ma mb it lw b gy mc md l me mf">gdf = gpd.GeoDataFrame( df, geometry=gpd.points_from_xy(df.longitude, df.latitude))</span><span id="a1ee" class="ma mb it lw b gy mg md l me mf">gdf.head()</span></pre><p id="6c73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们绘制数据集的地图。我们在这里使用Plotly Express，因为它为Plotly绘图提供了一个简单的接口和高级API。我们需要在这里设置Mapbox标记。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c4fb" class="ma mb it lw b gy mc md l me mf">px.set_mapbox_access_token(“pk.eyJ1Ijoic2hha2Fzb20iLCJhIjoiY2plMWg1NGFpMXZ5NjJxbjhlM2ttN3AwbiJ9.RtGYHmreKiyBfHuElgYq_w”)</span><span id="ce9d" class="ma mb it lw b gy mg md l me mf">px.scatter_mapbox(gdf, lat=”latitude”, lon=”longitude” ,size_max=6, zoom=8, width=1200, height=800)</span></pre><p id="f015" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了数据集中的所有点。如你所见，这些轨迹落在三个不同的城市。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/96f9d9a6f3f60f42d0898ad3c771378e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SyuczZfu1ox74X-O3FL7bg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Plotly Express轨迹图</p></figure><p id="4150" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们过滤掉其他城市，把注意力集中在中心城市(Aracuja ),因为大部分数据都在这里。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f54a" class="ma mb it lw b gy mc md l me mf">gdf = df[(gdf[‘latitude’]&lt;-10.80) &amp; (gdf[‘longitude’]&gt;-37.5)]</span><span id="4736" class="ma mb it lw b gy mg md l me mf">px.scatter_mapbox(gdf, lat=”latitude”, lon=”longitude” ,size_max=6, zoom=8, width=1200, height=800)</span></pre><p id="bce0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们只对巴西的Aracuja市感兴趣。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/1bca7dd3a35112f5aa447ab7cc2bd397.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QRRAsB3zfVzZ8XwU_itAZA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">干净的轨迹图</p></figure><p id="96d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经清理了数据，让我们做地理围栏。</p><h2 id="c269" class="ma mb it bd mj mk ml dn mm mn mo dp mp li mq mr ms lm mt mu mv lq mw mx my mz bi translated">地理围栏</h2><p id="2755" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">首先，我们需要一个标记地理围栏的区域。让我们下载一个我在市中心创建的区域。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="fdc9" class="ma mb it lw b gy mc md l me mf"># Get the data<br/>!wget <a class="ae ky" href="https://www.dropbox.com/s/e9g5n7e7iwnue4x/CENTERAREA.zip" rel="noopener ugc nofollow" target="_blank">https://www.dropbox.com/s/e9g5n7e7iwnue4x/CENTERAREA.zip</a><br/>!unzip CENTERAREA.zip</span><span id="21a7" class="ma mb it lw b gy mg md l me mf">polygon = gpd.read_file(“CENTERAREA.geojson”)</span></pre><p id="8f48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用Geopandas绘制多边形，并叠加这些点以查看两个数据。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4b39" class="ma mb it lw b gy mc md l me mf"># Plot track_id 1 points over the Buffer Polygon</span><span id="c5d8" class="ma mb it lw b gy mg md l me mf">fig, ax = plt.subplots(figsize=(10,10))</span><span id="0ef2" class="ma mb it lw b gy mg md l me mf">gdf.plot(ax=ax, color=’black’)</span><span id="7628" class="ma mb it lw b gy mg md l me mf">polygon.plot(ax=ax)</span><span id="e39e" class="ma mb it lw b gy mg md l me mf">#plt.tight_layout()</span><span id="fc9a" class="ma mb it lw b gy mg md l me mf">#plt.axis(‘off’)</span><span id="da6d" class="ma mb it lw b gy mg md l me mf">plt.show()</span></pre><p id="efca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是覆盖面和点数据的地图，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/2f347dfa2cd50bad966c8093242d8a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*va2YK-nXdhSocUZIe4I5kA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Geopandas图-带多边形的点</p></figure><p id="13bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们执行我们所谓的多边形中的点(PIP)。我们可以在Geopandas中使用“within”操作来检查点是否在多边形内。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1a51" class="ma mb it lw b gy mc md l me mf">mask = (polygon.loc[0, ‘geometry’])</span><span id="4852" class="ma mb it lw b gy mg md l me mf">pip_mask_geofence = gdf.within(mask)</span></pre><p id="8bcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码将根据点是否在多边形内返回一系列的假值和真值。让我们在数据中添加一列来标记假值和真值。我们称之为“地理围栏”。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f2fd" class="ma mb it lw b gy mc md l me mf">#Create PIP mask</span><span id="29dc" class="ma mb it lw b gy mg md l me mf">gdf.loc[:,’geofence’] = pip_mask_geofence</span><span id="6431" class="ma mb it lw b gy mg md l me mf">gdf.sample(5)</span></pre><p id="9933" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们的数据有一个“地理围栏”栏。让我们来看一个数据样本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/0033d16decade6d92619f2ee113654ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C11qQHwD7J-w0n-_4AHEgw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">具有地理围栏列的轨迹地理数据框架</p></figure><p id="e487" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，数据中有一个附加列:geofence。前四行表示它们不在geofence内，而最后一行表示它们在geofence内。让我们分别用输入和输出值来代替假值和真值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8507" class="ma mb it lw b gy mc md l me mf"># Replace True with In and False with Out</span><span id="3b82" class="ma mb it lw b gy mg md l me mf">gdf[‘geofence’] = gdf[‘geofence’].replace({True: ‘In’, False: ‘Out’})</span></pre><p id="b3a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以看到，如果我们用Plotly Express绘制地图，并使用geofence作为颜色，哪些点在geofencing区域内部或外部。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6ccf" class="ma mb it lw b gy mc md l me mf">px.scatter_mapbox(gdf, lat=”latitude”, lon=”longitude”, color=”geofence”, size=’track_id’ ,</span><span id="eb8f" class="ma mb it lw b gy mg md l me mf">size_max=6, zoom=12, width=1200, height=800)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/e9f6a28681a78e8704ee0ff19af760bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PjnJM3K05rYUeqwWghSCgw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用地理围栏着色的地图</p></figure><p id="b104" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以用轨迹运动动画化这些点。用Plotly Express可以很容易地完成这种概括。然而，由于某些限制，它不能一次可视化我们所有的点。现在让我们设想一个轨道ID。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f429" class="ma mb it lw b gy mc md l me mf">px.scatter_mapbox(gdf[gdf[“track_id”]== 23], lat=”latitude”, lon=”longitude”, color=”geofence”, size=’track_id’, animation_frame=’time’, size_max=10, zoom=12, width=1200, height=800)</span></pre><p id="e8ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们简单地理围栏例子的GIF动画。一旦轨迹进入地理围栏区域，这些点将变为红色，而在标记区域之外则为蓝色。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f8a67badadaf51f728ee178a7d44816c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*txOvui0r7T9Y4DA06fgAnA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">地理围栏动画</p></figure><h2 id="b6f2" class="ma mb it bd mj mk ml dn mm mn mo dp mp li mq mr ms lm mt mu mv lq mw mx my mz bi translated">结论</h2><p id="b656" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">在本教程中，我们看到了如何使用Pandas、Geopandas和Plotly Express用Python做一个简单的地理围栏示例。如果你想试验代码，这里有Google Colab笔记本的链接。</p><div class="nh ni gp gr nj nk"><a href="https://colab.research.google.com/drive/18HvxO82GGDQc3wXHrGkIygdJYFE0y-Fg" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">谷歌联合实验室</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">编辑描述</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">colab.research.google.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ks nk"/></div></div></a></div></div></div>    
</body>
</html>