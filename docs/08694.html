<html>
<head>
<title>Automated Anomaly Detection Using PyCaret</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 PyCaret 的自动化异常检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automated-anomaly-detection-using-pycaret-5e40df75fe36?source=collection_archive---------33-----------------------#2020-06-23">https://towardsdatascience.com/automated-anomaly-detection-using-pycaret-5e40df75fe36?source=collection_archive---------33-----------------------#2020-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="eef8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个开源的机器学习库——py caret！！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/310fd50d8a9dd769f54b8bdb8e44de4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H-g1DneQQIZAqmmtHlOK8g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源——un splash</p></figure><p id="f134" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PyCaret 是一个<strong class="la iu">开源库</strong>，它通过各种模块提供了各种机器学习功能，其中之一就是异常检测。</p><p id="1b66" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PyCaret 的异常检测模块是一个<strong class="la iu">无人监管的</strong>机器学习模块，用于识别数据中存在的极值，这些极值有时可能表明可疑活动或异常情况。</p><p id="d97e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PyCaret 的异常检测模块提供了<strong class="la iu">十二种不同的</strong>异常检测技术，根据您正在处理的问题进行选择。它还允许我们通过一个名为“<strong class="la iu">setup”</strong>的函数，使用传递给该函数的各种参数值来执行特征工程任务。</p><p id="e166" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我们将对 PyCaret 本身提供的一个数据集应用 PyCaret 提供的三种异常检测技术。本文涵盖的三种技术是— <em class="lu">隔离林、K 最近邻和聚类。</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="5665" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们实现这些技术之前，让我们先来看看我们需要按照特定的顺序执行的步骤，以便通过使用下面的函数来识别数据中的异常。这些步骤对于 PyCaret 为异常检测提供的所有技术都是通用的。</p><ul class=""><li id="b6e5" class="mc md it la b lb lc le lf lh me ll mf lp mg lt mh mi mj mk bi translated"><strong class="la iu"> get_data() </strong> —此函数用于访问 PyCaret 数据集。这是一个可选步骤。</li><li id="dd7b" class="mc md it la b lb ml le mm lh mn ll mo lp mp lt mh mi mj mk bi translated"><strong class="la iu"> setup() </strong> —该函数初始化环境，并在异常检测之前执行所需的预处理任务。它唯一需要的参数是“数据”参数中的数据帧，但下面是可以通过设置功能实现的各种预处理任务的示例。</li></ul><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="5a29" class="mv mw it mr b gy mx my l mz na"><strong class="mr iu">setup</strong>(<em class="lu">data, categorical_features = None, categorical_imputation = ‘constant’, ordinal_features = None, high_cardinality_features = None, numeric_features = None, numeric_imputation = ‘mean’, date_features = None, ignore_features = None, normalize = False, normalize_method = ‘zscore’, transformation = False, transformation_method = ‘yeo-johnson’, handle_unknown_categorical = True, unknown_categorical_method = ‘least_frequent’, pca = False, pca_method = ‘linear’, pca_components = None, ignore_low_variance = False, combine_rare_levels = False, rare_level_threshold = 0.10, bin_numeric_features = None, remove_multicollinearity = False, multicollinearity_threshold = 0.9, group_features = None, group_names = None, supervised = False, supervised_target = None, session_id = None, profile = False, verbose=True</em>)</span></pre><ul class=""><li id="d60e" class="mc md it la b lb lc le lf lh me ll mf lp mg lt mh mi mj mk bi translated"><strong class="la iu"> create_model() </strong> —此函数创建模型，并在设置阶段作为参数传递的数据集上对其进行训练。因此，该函数要求在使用之前调用 setup()函数。</li></ul><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="a711" class="mv mw it mr b gy mx my l mz na">df = pd.read_csv(path_to_csv) # to access your own dataset<br/>or<br/>df = get_data(“anomaly”) # to access PyCaret’s anomaly dataset</span><span id="dc9d" class="mv mw it mr b gy nb my l mz na">setup_data = setup(data=df)<br/>sample_model = create_model(“iforest”)</span></pre><ul class=""><li id="9c0f" class="mc md it la b lb lc le lf lh me ll mf lp mg lt mh mi mj mk bi translated"><strong class="la iu"> plot_model() </strong> —该函数获取 create_model()函数期间创建的训练模型，并绘制 setup()函数期间传递的数据。因此，该方法要求在调用之前调用 setup()和 create_model()函数。返回的图用不同的颜色清楚地显示异常数据。</li></ul><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="3da0" class="mv mw it mr b gy mx my l mz na">plot_model(sample_model)</span></pre><ul class=""><li id="1381" class="mc md it la b lb lc le lf lh me ll mf lp mg lt mh mi mj mk bi translated"><strong class="la iu"> predict_model() </strong> —此函数获取经过训练的模型，并使用它对新数据进行预测。新数据必须是熊猫数据帧的形式。该函数的输出是一个数据帧，其中包含名为“<strong class="la iu">标签</strong>的预测以及相关的决策得分。</li></ul><blockquote class="nc nd ne"><p id="a6fa" class="ky kz lu la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">Label = 0 表示正常数据或内嵌数据</p><p id="7dcf" class="ky kz lu la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">标签= 1 表示异常或异常值</p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="f8c6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，当我们对 PyCaret 异常检测函数的工作原理有了一个基本的了解后，让我们开始实际的实现吧。</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="c045" class="mv mw it mr b gy mx my l mz na"><strong class="mr iu"># Importing PyCaret dependencies.</strong><br/>from pycaret.datasets import get_data<br/>anomaly = get_data(“anomaly”)</span><span id="d82d" class="mv mw it mr b gy nb my l mz na"><strong class="mr iu"># Importing anomaly detection module.</strong><br/>from pycaret.anomaly import *</span><span id="7f02" class="mv mw it mr b gy nb my l mz na"><strong class="mr iu"># Initializing the setup function used for pre-processing.</strong><br/>setup_anomaly_data = setup(anomaly)</span></pre><h1 id="dd74" class="ni mw it bd nj nk nl nm nn no np nq nr jz ns ka nt kc nu kd nv kf nw kg nx ny bi translated">隔离林实现</h1><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="ba09" class="mv mw it mr b gy mx my l mz na"># Instantiating Isolation Forest model.<br/>iforest = create_model(“iforest”)</span><span id="0c45" class="mv mw it mr b gy nb my l mz na"># Plotting the data using Isolation Forest model.<br/>plot_model(iforest)</span><span id="0335" class="mv mw it mr b gy nb my l mz na"># Generating the predictions using Isolation Forest trained model.<br/>iforest_predictions = predict_model(iforest, data = anomaly)<br/>print(iforest_predictions)</span><span id="5f36" class="mv mw it mr b gy nb my l mz na"># Checking anomaly rows. Label = 1 is the anomaly data.<br/>iforest_anomaly_rows = iforest_predictions[iforest_predictions[“Label”] == 1]<br/>print(iforest_anomaly_rows.head())</span><span id="640b" class="mv mw it mr b gy nb my l mz na"># Checking the number of anomaly rows returned by Isolaton Forest.<br/>print(iforest_anomaly_rows.shape) <strong class="mr iu"># returned 50 rows</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/66c86d2edb20cd4ce87fd7fcd839f4e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*uU9T73lgcWAlxhi4dLPrjg.png"/></div></figure><p id="c855" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">前 5 个异常行(标签 1) </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/d60bb81a8323d70d98bce4dbd094f8bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*wMCI8vdZs2-Tjx85zSZmuQ.png"/></div></figure><p id="7416" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">使用隔离林创建的异常图(异常以黄色突出显示)</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/12c556150005b7a21ec1d64237493eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*zzzzRns2-dQrxJjTTqBGMQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基于隔离林的异常图</p></figure><h1 id="320f" class="ni mw it bd nj nk nl nm nn no np nq nr jz ns ka nt kc nu kd nv kf nw kg nx ny bi translated"><strong class="ak"> K 最近邻(KNN)实现</strong></h1><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="d676" class="mv mw it mr b gy mx my l mz na"># Instantiating KNN model.<br/>knn = create_model(“knn”)</span><span id="3fda" class="mv mw it mr b gy nb my l mz na"># Plotting the data using KNN model.<br/>plot_model(knn)</span><span id="b0bb" class="mv mw it mr b gy nb my l mz na"># Generating the predictions using KNN trained model.<br/>knn_predictions = predict_model(knn, data = anomaly)<br/>print(knn_predictions)</span><span id="a8c0" class="mv mw it mr b gy nb my l mz na"># Checking KNN anomaly rows. Predictions with Label = 1 are anomalies.<br/>knn_anomaly_rows = knn_predictions[knn_predictions[“Label”] == 1]<br/>knn_anomaly_rows.head()</span><span id="f9c3" class="mv mw it mr b gy nb my l mz na"># Checking the number of anomaly rows returned by KNN model.<br/>knn_anomaly_rows.shape <strong class="mr iu"># returned 46 rows</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/62789db8f931f92c6d708f178b1cfc42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*0cDEBV3QPkMQTmNu7zU5zA.png"/></div></figure><p id="d71c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">前 5 个异常行(标签 1) </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/e559c6a35d556fe438b65612c23618c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*EuhQKang_FOdbsOweQFExg.png"/></div></figure><p id="3c3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">使用 K 个最近邻创建的异常图(异常以黄色突出显示)</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/d98a19e7eccffd223878b15d8af4afbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*iRtip4DYEBG8zRiyVbpZEw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基于 KNN 的异常图</p></figure><h1 id="19bf" class="ni mw it bd nj nk nl nm nn no np nq nr jz ns ka nt kc nu kd nv kf nw kg nx ny bi translated"><strong class="ak">聚类</strong>实现</h1><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="1f06" class="mv mw it mr b gy mx my l mz na"># Instantiating Cluster model.<br/>cluster = create_model(“cluster”)</span><span id="86d5" class="mv mw it mr b gy nb my l mz na"># Plotting the data using Cluster model.<br/>plot_model(cluster)</span><span id="5091" class="mv mw it mr b gy nb my l mz na"># Generating the predictions using Cluster trained model.<br/>cluster_predictions = predict_model(cluster, data = anomaly)<br/>print(cluster_predictions)</span><span id="13b0" class="mv mw it mr b gy nb my l mz na"># Checking cluster anomaly rows. Predictions with Label = 1 are anomalies.<br/>cluster_anomaly_rows = cluster_predictions[cluster_predictions[“Label”] == 1]<br/>print(cluster_anomaly_rows.head())</span><span id="0ee2" class="mv mw it mr b gy nb my l mz na"># Checking the number of anomaly rows returned by Cluster model.<br/>cluster_anomaly_rows.shape # returned 50 rows</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/5b75160484be0f15a9333988197d7882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*P6SdzPc7SzK0ocjehr2nPg.png"/></div></figure><p id="76e4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">前 5 个异常行(标签 1) </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/ed962ec620e72bdca22e2406ef694351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*W3hfP5BFeb-uKkqkkFo5Jw.png"/></div></figure><p id="3612" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">使用聚类创建的异常图(异常以黄色突出显示)</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/5c5e600652f91c6e12daf13cd338b930.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*rR59AItVeJndHVAZwWPnCw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基于聚类的异常图</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8528" class="ni mw it bd nj nk od nm nn no oe nq nr jz of ka nt kc og kd nv kf oh kg nx ny bi translated">参考</h1><ul class=""><li id="3c6c" class="mc md it la b lb oi le oj lh ok ll ol lp om lt mh mi mj mk bi translated"><a class="ae on" href="https://pycaret.org/" rel="noopener ugc nofollow" target="_blank">https://pycaret.org/</a></li></ul></div></div>    
</body>
</html>