<html>
<head>
<title>Collect Stock and Options Data Easily using Python and Ally Financial API — 3 Example Queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 和 Ally Financial API 轻松收集股票和期权数据— 3 个示例查询</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/collect-stock-and-options-data-easily-using-python-and-ally-financial-api-3-example-queries-45d162e4f055?source=collection_archive---------15-----------------------#2020-02-04">https://towardsdatascience.com/collect-stock-and-options-data-easily-using-python-and-ally-financial-api-3-example-queries-45d162e4f055?source=collection_archive---------15-----------------------#2020-02-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="287a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简短的备忘单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/34f2d116a008b4304efe3e92c3330c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_rb7SlTWj4o4Ge9CNeEZg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由 pikrepo 提供</p></figure><h1 id="8cea" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">尝试交易</h1><p id="489e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我生命中的一段时间里，我痴迷于金融市场，想成为一名日间交易者。我晚上工作，所以早上很容易被电脑显示器包围，显示器上显示着从股票、期权、新闻到交易聊天室的一切。剧透…我放弃了日内交易，但没有放弃投资。最终，我知道我喜欢分析数据胜过交易，然后<a class="ae ky" rel="noopener" target="_blank" href="/enter-analytics-from-boot-camp-to-working-in-data-science-8a5a6f563d7d">我让自己走上了学习数据分析和进入数据科学的道路</a>。</p><p id="c01a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我在探索<a class="ae ky" href="https://www.kaggle.com/bendgame/options-market-trades" rel="noopener ugc nofollow" target="_blank">收集股票和期权数据的方法时，</a>我查看了我的一个经纪人 Ally Financial 提供的 API。它可以免费使用并且易于编码。这是我为使用 Ally Financial API 收集以下信息而整理的备忘单:</p><ul class=""><li id="fdf5" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">股票的时间和销售</li><li id="eca2" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">期权市场深度</li><li id="1a19" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">选项扩展报价</li></ul><p id="2c7a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你不熟悉 API，<a class="ae ky" href="https://www.google.com/search?q=What+is+an+API&amp;oq=What+is+an+API" rel="noopener ugc nofollow" target="_blank">看看这些资源</a>。通过它们的 API 实现交易自动化是可能的，但我从未深入研究过。探索文档中的所有功能。</p><div class="ng nh gp gr ni nj"><a href="https://www.ally.com/api/invest/documentation/getting-started/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">Ally Invest API 文档</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">构建您的应用程序，连接到我们的投资平台和与之相连的 250，000 名交易者…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">www.ally.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx ks nj"/></div></div></a></div><p id="6caa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你可以在文章底部或者我的 GitHub 上找到完整的备忘单！</p><div class="ng nh gp gr ni nj"><a href="https://github.com/bendgame/Ally-API-Cheat-Sheet" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">bend game/Ally-API-备忘单</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">Ally Financial API 入门。通过创建一个帐户，为 bendgame/Ally-API-Cheat-Sheet 开发做出贡献…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">github.com</p></div></div><div class="ns l"><div class="ny l nu nv nw ns nx ks nj"/></div></div></a></div><p id="bf43" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">继续编码！</p><h1 id="e1de" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">导入依赖项</h1><p id="a277" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">连接到 API 使用<strong class="lt iu"> OAuth1 </strong>。你可以在 OAuth 网站<a class="ae ky" href="http://oauth.net/code/" rel="noopener ugc nofollow" target="_blank">这里</a>找到 OAuth 客户列表。我使用 OAuth 库<strong class="lt iu"> requests_oauthlib </strong>。根据需要使用<em class="nz"> pip 安装请求-oauthlib </em>。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="fce4" class="of la it ob b gy og oh l oi oj">import requests<br/>from requests_oauthlib import OAuth1<br/>from config import (api_key, secret, oath_token, oath_secret)<br/><br/>import pandas as pd<br/>import sqlalchemy<br/>import numpy as np<br/><br/>import sqlite3<br/>from sqlite3 import Error<br/><br/>import matplotlib.pyplot as plt<br/>import datetime as dt</span></pre><p id="ca19" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意，我使用一个配置文件来导入<em class="nz"> api_key、secret、oath_token、oath_secret </em>。这样，我就不需要在代码中包含那些个人令牌。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="f032" class="of la it ob b gy og oh l oi oj"><em class="nz">#authentication </em><br/>auth = OAuth1(api_key, secret, oath_token, oath_secret)</span></pre><p id="1347" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我把进口令牌递给<strong class="lt iu"><em class="nz">oauth 1</em>T23】。这将在我们向 API 发出请求时使用。</strong></p><h1 id="7c61" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">股票的时间和销售示例</h1><p id="e9f6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这个 API 调用将根据作为查询参数传递的符号返回时间和销售报价数据。有关所有查询参数的列表，请查阅文档。示例 URL 由<strong class="lt iu"> <em class="nz">基础 url </em> </strong>、<strong class="lt iu"> <em class="nz"> api 路由</em> </strong>和<strong class="lt iu"> <em class="nz">查询</em> </strong>组成。</p><p id="e17d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">基础网址</strong>:<a class="ae ky" href="https://api.tradeking.com/" rel="noopener ugc nofollow" target="_blank">https://api.tradeking.com/</a><br/><strong class="lt iu">路线</strong>:v1/market/timesales . JSON<br/><strong class="lt iu">查询</strong>:？symbols=MSFT &amp;开始日期= 2019–05–03&amp;间隔= 1 分钟</p><p id="e3e3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">文档</strong>:<a class="ae ky" href="https://www.ally.com/api/invest/documentation/market-timesales-get/" rel="noopener ugc nofollow" target="_blank">https://www . ally . com/API/invest/Documentation/market-timesales-get/</a></p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="1360" class="of la it ob b gy og oh l oi oj"><em class="nz">#url call to the api</em><br/>url = 'https://api.tradeking.com/v1/market/timesales.json?symbols=MSFT&amp;startdate=2019-05-03&amp;interval=1min'</span><span id="9420" class="of la it ob b gy ok oh l oi oj"><em class="nz">#api request</em><br/>response = requests.get(url, auth = auth).json()</span></pre><p id="51da" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意，我将 URL 和 oAuth 值传递给请求，并将响应作为<a class="ae ky" href="https://en.wikipedia.org/wiki/JSON" rel="noopener ugc nofollow" target="_blank"> json </a>返回。这是一个响应示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/68e1df763885803dd8598aedbdc9e931.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*7NOzgWVGS0SD41onxZJzMw.png"/></div></figure><p id="bc73" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我将报价数据放入 Panda 的数据帧中，并格式化数据类型。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="d137" class="of la it ob b gy og oh l oi oj"><em class="nz">#send to data frame and format data types</em><br/>df = pd.DataFrame(response["response"]["quotes"]["quote"])<br/>df = df.sort_values(['datetime'], ascending = <strong class="ob iu">False</strong>)<br/>df['date'] = pd.to_datetime(df['date'])</span><span id="8d5c" class="of la it ob b gy ok oh l oi oj">df['datetime'] = pd.to_datetime(df['datetime'],  utc=<strong class="ob iu">False</strong>).dt.tz_convert('US/Central')</span><span id="47e8" class="of la it ob b gy ok oh l oi oj">df['hi'] = df["hi"].astype(float)<br/>df['incr_vol'] = df["incr_vl"].astype(float)<br/>df['last'] = df["last"].astype(float)<br/>df['lo'] = df["lo"].astype(float)<br/>df['opn'] = df["opn"].astype(float)<br/>df['vl'] = df['vl'].astype(float)</span><span id="2828" class="of la it ob b gy ok oh l oi oj">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/8e6b8bd651f9aa0274d3cb9ebad4b778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jdfqH5jjejjVjBEfX9-uQQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例数据</p></figure><p id="9cb0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">日期时间值需要转换，以便能够对其进行重新采样。重采样允许您操纵时间序列的频率。根据文档，对象必须有一个类似于<em class="nz"> datetime 的</em>索引(<em class="nz"> DatetimeIndex </em>、<em class="nz"> PeriodIndex </em>或<em class="nz"> TimedeltaIndex </em>)，或者将类似于<em class="nz"> datetime </em> - <em class="nz">的</em>值传递给 on 或 level 关键字。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="7afd" class="of la it ob b gy og oh l oi oj"><em class="nz">#resample the time value to be greater than 1 min as needed. Example: 30 min resample for last price</em><br/>df.set_index(df['datetime'], inplace = <strong class="ob iu">True</strong>)<br/>df.head()<br/>df_resample30 = df.resample(rule = '30min', label = 'right').last()<br/>df_resample30.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/5e01811e9f7bb542849930ba641b299f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZxwZemWiuqmiJuwzl6E_8Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">重采样数据帧</p></figure><p id="171a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请注意，<strong class="lt iu"> <em class="nz">日期时间</em> </strong>在重采样后增加了 30 分钟，而不是 1 分钟。</p><h1 id="34a7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">选项搜索示例</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/9cb8eaa1195b438df9d3135a5740c240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*hQ-Wxm5XIJQpvQs-5N4SBw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pxfuel.com/en/search?q=stock+market+data" rel="noopener ugc nofollow" target="_blank">由 pxfuel </a>提供</p></figure><p id="a745" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这个 api 调用为选项提供了<a class="ae ky" href="https://www.investopedia.com/terms/m/marketdepth.asp" rel="noopener ugc nofollow" target="_blank">市场深度</a>。该调用将返回给定符号的可用选项击的完整列表。虽然这种请求类型是 GET，但是也可以使用 POST，并且推荐用于较长的查询。</p><p id="ffcc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">文档</strong>:<a class="ae ky" href="https://www.ally.com/api/invest/documentation/market-options-search-get-post/" rel="noopener ugc nofollow" target="_blank">https://www . ally . com/API/invest/Documentation/market-options-search-get-post/</a></p><p id="cb71" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">基地网址</strong>:<a class="ae ky" href="https://api.tradeking.com/" rel="noopener ugc nofollow" target="_blank">https://api.tradeking.com/</a><br/>T5】路线:v1/market/timesales . JSON<br/><strong class="lt iu">查询</strong>:？symbol = MSFT&amp;query = xy ear-eq % 3a 2019% 20 and % 20x month-eq % 3a 06% 20 and % 20 strike price-eq % 3a 140</p><h2 id="9924" class="of la it bd lb op oq dn lf or os dp lj ma ot ou ll me ov ow ln mi ox oy lp oz bi translated">查询细分:</h2><p id="67c2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">到期年份等于 2019 年</strong> : <br/> xyear-eq%3A 2019</p><p id="9f28" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">和</strong>:<br/>%20 和% 20</p><p id="6b8b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">到期月份等于 06 </strong> : <br/> xmonth-eq%3A 06</p><p id="98a0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">和执行价格等于 140</strong>:<br/>%20 和% 20 执行价格-eq%3A 140</p><h2 id="5899" class="of la it bd lb op oq dn lf or os dp lj ma ot ou ll me ov ow ln mi ox oy lp oz bi translated">操作员:</h2><p id="338b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu"> lt </strong>:小于<br/> <strong class="lt iu"> gt </strong>:大于<br/> <strong class="lt iu"> gte </strong>:大于等于<br/> <strong class="lt iu"> lte </strong>:小于等于<br/> <strong class="lt iu"> eq </strong>:等于</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="2792" class="of la it ob b gy og oh l oi oj">url = 'https://api.tradeking.com/v1/market/options/search.json?symbol=MSFT&amp;query=xyear-eq%3A2019%20AND<strong class="ob iu">%20x</strong>month-eq%3A06%20AND<strong class="ob iu">%20s</strong>trikeprice-eq%3A140'</span><span id="fd2d" class="of la it ob b gy ok oh l oi oj">#api call<br/>response = requests.get(url, auth = auth).json()</span><span id="9806" class="of la it ob b gy ok oh l oi oj">#load the response into the dataframe<br/>df = pd.DataFrame(response["response"]["quotes"]["quote"])<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/e9778af52ae1f03581aef275810274eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*kS_qMioxMHYxN0rhv-a_TQ.png"/></div></figure><h1 id="452f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">扩展报价示例(可选)</h1><p id="1ff5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这条路线适用于股票，但这是一个期权看涨的例子，因为它们有点复杂。该调用将返回作为查询参数传递的符号或符号列表的引号。</p><p id="c09e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">文档</strong>:<a class="ae ky" href="https://www.ally.com/api/invest/documentation/market-ext-quotes-get-post/" rel="noopener ugc nofollow" target="_blank">https://www . ally . com/API/invest/Documentation/market-ext-quotes-get-post/</a><br/><strong class="lt iu">基础网址【https://api.tradeking.com/】:<br/><strong class="lt iu">路线</strong>:v1/market/ext/quotes . JSON<br/><strong class="lt iu">查询</strong>:？symbols=MSFT190607C00140000</strong></p><h2 id="bcbd" class="of la it bd lb op oq dn lf or os dp lj ma ot ou ll me ov ow ln mi ox oy lp oz bi translated">选项符号命名约定:</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/679d4de058fe2b3bab56840d4ac07103.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*qvRsZgjIl1DzcI05i56Acg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自文档</p></figure><p id="960e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">基础符号— MSFT </strong> <br/> 2 位到期年份— 19 <br/> 2 位到期月份— 06 <br/> 2 位到期日—07<br/>“C”代表买入或“P”代表卖出— C <br/> 8 位执行价格— 00140000 <br/> <strong class="lt iu">根据需要使用 fids 在查询中指定所需字段:<br/>即 fids=ask、bid、vol </strong></p><p id="b1e0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">尽管命名约定有几个组成部分，但通过几个例子就可以看出它相当简单。同时，使用文档或备忘单中提供的示例图像！</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="893a" class="of la it ob b gy og oh l oi oj">url = 'https://api.tradeking.com/v1/market/ext/quotes.json?symbols=MSFT190607C00140000'</span><span id="7b70" class="of la it ob b gy ok oh l oi oj">#api call<br/>response = requests.get(url, auth = auth).json()</span><span id="37f0" class="of la it ob b gy ok oh l oi oj">#load the response into the dataframe<br/>df = pd.DataFrame(response["response"]["quotes"]["quote"], index = [0])<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/b3c1589049011c27625f7ee3964e0a38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pid9Ue4q0dFUOVTjYfcFjg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">扩展报价示例</p></figure><h1 id="e3fb" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">将这些点连接起来</h1><p id="8b61" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">使用 Pandas，很容易将数据保存到 CSV 或 SQL 数据库中。如果你不熟悉<a class="ae ky" href="https://docs.python.org/2/library/sqlite3.html" rel="noopener ugc nofollow" target="_blank"> SQLite </a>，它非常容易使用。引用文档:</p><blockquote class="pd pe pf"><p id="ce45" class="lr ls nz lt b lu mn ju lw lx mo jx lz pg mp mc md ph mq mg mh pi mr mk ml mm im bi translated">SQLite 是一个 C 库，它提供了一个轻量级的基于磁盘的数据库，不需要单独的服务器进程，并允许使用 SQL 查询语言的非标准变体来访问数据库。</p></blockquote><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="5a42" class="of la it ob b gy og oh l oi oj">conn = sqlite3.connect('stockdata.sqlite')<br/>df.to_sql(table_name, conn)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/012052b090d905bf39880213406f95e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*s8TuiwknvxaV-QE36C-bLQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.flickr.com/photos/nodstrum/28511200247" rel="noopener ugc nofollow" target="_blank">由 Flickr 提供</a></p></figure><h2 id="6c65" class="of la it bd lb op oq dn lf or os dp lj ma ot ou ll me ov ow ln mi ox oy lp oz bi translated">完全码</h2><p id="3817" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">使用这三个查询，很容易开始使用 Ally Financial API 收集股票和期权数据。将数据放入 Panda 的 dataframe 中可以很容易地理解 JSON 信息并将数据存储为 CSV 或 SQLite 文件。如果您想探索股票数据的其他 API，也可以查看一下<a class="ae ky" href="https://www.alphavantage.co/" rel="noopener ugc nofollow" target="_blank"> Alphavantage </a>。</p><p id="fdb1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="https://github.com/bendgame/Ally-API-Cheat-Sheet/blob/master/Ally_API_Cheat_Sheet.ipynb" rel="noopener ugc nofollow" target="_blank">在我的 github 上找到包含文档的备忘单</a>！</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="4851" class="of la it ob b gy og oh l oi oj">import requests<br/>from requests_oauthlib import OAuth1<br/>from config import (api_key, secret, oath_token, oath_secret)<br/><br/>import pandas as pd<br/>import sqlalchemy<br/>import numpy as np<br/><br/>import sqlite3<br/>from sqlite3 import Error<br/><br/>import matplotlib.pyplot as plt<br/>import datetime as dt</span><span id="bdb4" class="of la it ob b gy ok oh l oi oj"><em class="nz">#authentication </em><br/>auth = OAuth1(api_key, secret, oath_token, oath_secret)</span><span id="62aa" class="of la it ob b gy ok oh l oi oj"><em class="nz">#url </em><br/>url = 'https://api.tradeking.com/v1/market/timesales.json?symbols=MSFT&amp;startdate=2019-05-03&amp;interval=1min'</span><span id="9544" class="of la it ob b gy ok oh l oi oj"><em class="nz">#api request</em><br/>response = requests.get(url, auth = auth).json()</span><span id="bf6f" class="of la it ob b gy ok oh l oi oj"><em class="nz">#send to data frame and format data types</em><br/>df = pd.DataFrame(response["response"]["quotes"]["quote"])<br/>df = df.sort_values(['datetime'], ascending = <strong class="ob iu">False</strong>)<br/>df['date'] = pd.to_datetime(df['date'])<br/>df['datetime'] = pd.to_datetime(df['datetime'],  utc=<strong class="ob iu">False</strong>).dt.tz_convert('US/Central')<br/>df['hi'] = df["hi"].astype(float)<br/>df['incr_vol'] = df["incr_vl"].astype(float)<br/>df['last'] = df["last"].astype(float)<br/>df['lo'] = df["lo"].astype(float)<br/>df['opn'] = df["opn"].astype(float)<br/>df['vl'] = df['vl'].astype(float)<br/>df.head()</span><span id="f3b8" class="of la it ob b gy ok oh l oi oj"><em class="nz">#resample the time value to be greater than 1 min as needed. Example: 30 min resample for last price</em><br/>df.set_index(df['datetime'], inplace = <strong class="ob iu">True</strong>)<br/>df.head()<br/>df_resample30 = df.resample(rule = '30min', label = 'right').last()<br/>df_resample30.head()</span><span id="b611" class="of la it ob b gy ok oh l oi oj">#Options Search Example</span><span id="fdfd" class="of la it ob b gy ok oh l oi oj">url = 'https://api.tradeking.com/v1/market/options/search.json?symbol=MSFT&amp;query=xyear-eq%3A2019%20AND<strong class="ob iu">%20x</strong>month-eq%3A06%20AND<strong class="ob iu">%20s</strong>trikeprice-eq%3A140' </span><span id="68bc" class="of la it ob b gy ok oh l oi oj">response = requests.get(url, auth = auth).json()<br/>  <br/>df = pd.DataFrame(response["response"]["quotes"]["quote"]) <br/>df.head()</span><span id="edaa" class="of la it ob b gy ok oh l oi oj">#Extended Quote Example</span><span id="10e4" class="of la it ob b gy ok oh l oi oj">url = 'https://api.tradeking.com/v1/market/ext/quotes.json?symbols=MSFT190607C00140000'</span><span id="075a" class="of la it ob b gy ok oh l oi oj">response = requests.get(url, auth = auth).json()</span><span id="17db" class="of la it ob b gy ok oh l oi oj">df = pd.DataFrame(response["response"]["quotes"]["quote"], index = [0])<br/>df.head()</span></pre><h1 id="6054" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">谢谢大家！</h1><ul class=""><li id="8c5e" class="ms mt it lt b lu lv lx ly ma pk me pl mi pm mm mx my mz na bi translated"><em class="nz">如果你喜欢这个，</em> <a class="ae ky" href="https://medium.com/@erickleppen" rel="noopener"> <em class="nz">跟我上 Medium </em> </a> <em class="nz">了解更多</em></li><li id="d079" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><a class="ae ky" href="https://erickleppen.medium.com/membership" rel="noopener"> <em class="nz">通过订阅</em> </a>获得完全访问权限并帮助支持我的内容</li><li id="79ac" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><em class="nz">我们连线上</em><a class="ae ky" href="https://www.linkedin.com/in/erickleppen01/" rel="noopener ugc nofollow" target="_blank"><em class="nz">LinkedIn</em></a></li><li id="bb4c" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><em class="nz">用 Python 分析数据？查看我的</em> <a class="ae ky" href="https://pythondashboards.com/" rel="noopener ugc nofollow" target="_blank"> <em class="nz">网站</em> </a></li></ul><p id="32cf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="http://pythondashboards.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> —埃里克·克莱本</strong> </a></p><p id="8940" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">查看我的其他教程，了解更多 python 和 sql！</p><div class="ng nh gp gr ni nj"><a href="https://medium.com/@erickleppen01/learn-sql-techniques-selecting-data-and-more-in-sql-server-624f81dd16b2" rel="noopener follow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">学习 SQL 技术:在 SQL Server 中选择数据和更多内容</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">SQL 语句介绍和查找重复数据的查询。学习 SQL</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">medium.com</p></div></div><div class="ns l"><div class="pn l nu nv nw ns nx ks nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a href="https://medium.com/swlh/dashboards-in-python-for-beginners-and-everyone-else-using-dash-f0a045a86644" rel="noopener follow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">Python 中的仪表盘，适用于初学者和使用 Dash 的其他人</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">使用 Python 中的 Dash 初学者教程构建一个基本的和高级的仪表板</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">medium.com</p></div></div><div class="ns l"><div class="po l nu nv nw ns nx ks nj"/></div></div></a></div></div></div>    
</body>
</html>