<html>
<head>
<title>How to Automate Multiple Excel Workbooks and Perform Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何自动化多个Excel工作簿并执行分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-automate-multiple-excel-workbooks-and-perform-analysis-13e8aa5a2042?source=collection_archive---------5-----------------------#2020-05-10">https://towardsdatascience.com/how-to-automate-multiple-excel-workbooks-and-perform-analysis-13e8aa5a2042?source=collection_archive---------5-----------------------#2020-05-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7852" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">应用这个循序渐进的指南来解决问题，使用神奇的元数据注入PDI。</h2></div><p id="73f0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设您被分配了一项任务，研究微软或苹果的供应商，并进行分析以做出更好的决策。这意味着要研究数百个不同格式、结构、名称等的供应商。现在，整理来自不同供应商的信息、标准化并对其进行分析是一个非常耗时的过程，对吗？</p><p id="d885" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们必须在一定的频率后执行相同的活动，以了解更新的趋势。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/be2ac1997af845531b29430ff468cbc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lxQIjnaIhUTlLCuC"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">在<a class="ae lr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae lr" href="https://unsplash.com/@kmuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Carlos Muza </a>拍摄的照片</p></figure><p id="00b3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我们自动化和构建数据管道的一个很好的用例。当今工业中使用了多种方法。有些人编写python/java程序，有些人使用VBA宏，有些人使用ETL工具等等。</p><p id="ef79" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用Pentaho Data Integration (Kettle)这个强大的ETL工具来执行这个活动。如果你是这个工具的新手，那么我会推荐你浏览关于使用PDI构建第一个数据管道的帖子，这里有链接。</p><div class="ls lt gp gr lu lv"><a href="https://medium.com/swlh/build-your-first-data-pipeline-in-just-ten-minutes-2a490867b901" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">仅用10分钟构建您的第一条数据管道</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">通过使用PDI的真实用例，逐步构建您的第一个数据管道。</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">medium.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj ll lv"/></div></div></a></div><h2 id="e478" class="mk ml iq bd mm mn mo dn mp mq mr dp ms ko mt mu mv ks mw mx my kw mz na nb nc bi translated">用户故事——让我们定义我们的用例</h2><p id="abe0" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">让我们为上述用例编写我们的用户故事。使用简单的英语编写用户故事和创建故事板是跟踪状态或理解整个流程的好方法。这也有助于我们定义架构。</p><p id="fe14" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如上一篇文章中提到的，用户故事是从用户的角度写的，下面是我们用例的实例。</p><ul class=""><li id="1291" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">我想读取多个供应商的excel文件。</li><li id="0e12" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">我想在同一个流程中处理不同的结构和定制。</li><li id="8dbd" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">我想以一种单一的标准化格式(xlsx)存储输出。</li></ul><p id="5fd6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是三个简单的用户故事。然而，对于大多数程序来说，这并不是一个简单的用例。因此，让我们通过下面的分步指南来了解如何实现这一点。</p><h2 id="b1cb" class="mk ml iq bd mm mn mo dn mp mq mr dp ms ko mt mu mv ks mw mx my kw mz na nb nc bi translated"><strong class="ak">输入数据</strong></h2><p id="0771" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">让我们了解我们的各种供应商和输入数据。这将有助于我们设计数据管道流。</p><ol class=""><li id="6cf0" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nw no np nq bi translated"><strong class="kh ir"> Supplier-1 - </strong>我们有一张来自ABC公司的excel格式的发票收据，其中数据从第7行开始，有5列。</li></ol><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nx"><img src="../Images/a4fb7beb5e3dc77970e06c3fc7f47448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PXhF0Yp6z7SGpjmv_6NHOA.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">来自供应商-1的假发票数据</p></figure><ol class=""><li id="7dd7" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nw no np nq bi translated"><strong class="kh ir">供应商-2 - </strong>我们还有另一张来自XYZ公司的excel格式的发票收据，这里的数据从第5行开始，有6列。</li></ol><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ny"><img src="../Images/7ab0d422861ac54125f82ea11f4fa245.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AbdKXIW05I8LXublgq9U6w.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">来自供应商-1的假发票数据</p></figure><p id="9552" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以看到这两种数据结构，列顺序，命名规则是不同的。然而，两者都非常干净，在真实的场景中不会这样。</p><h2 id="9a81" class="mk ml iq bd mm mn mo dn mp mq mr dp ms ko mt mu mv ks mw mx my kw mz na nb nc bi translated">测试案例</h2><p id="190c" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">让我们为这个管道定义我们的测试用例。</p><ul class=""><li id="0b79" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">检查日志中的错误。</li><li id="b182" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">检查输出文件及其格式(xlsx)。</li><li id="4b15" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">在标准化输出文件中交叉验证来自两家供应商的两个随机发票行项目。</li></ul></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><h1 id="a63b" class="og ml iq bd mm oh oi oj mp ok ol om ms jw on jx mv jz oo ka my kc op kd nb oq bi translated">步骤1:项目设置</h1><p id="dacc" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">让我们为我们的项目创建一个框架。我们将创建以下文件夹和文件。我更喜欢将所有与工作相关的东西存放在一个名为<strong class="kh ir"> Work的普通文件夹中。</strong></p><ol class=""><li id="d124" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nw no np nq bi translated"><strong class="kh ir">输入- </strong>这是我们存储所有供应商文件的地方。我们可以在输入文件夹中创建两个子文件夹，即。<strong class="kh ir">供应商1 </strong>和<strong class="kh ir">供应商2 </strong>(这是完全可选的)</li><li id="ffb3" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nw no np nq bi translated"><strong class="kh ir">输出- </strong>显然用于存储输出文件。</li><li id="af4c" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nw no np nq bi translated"><strong class="kh ir">元数据- </strong>这是我们存储文件元数据(关于文件结构的信息)的地方。</li><li id="7295" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nw no np nq bi translated"><strong class="kh ir">转换- </strong>这是我们存储转换的地方，我们需要创建三个转换<strong class="kh ir"> ReadInputFiles.ktr，InjectMetadata.ktr </strong>和<strong class="kh ir">processeachinputfile . ktr</strong>。</li><li id="c556" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nw no np nq bi translated"><strong class="kh ir"> Main.kjb - </strong>我们的PDI作业文件，用于执行第4点中提到的所有转换。</li></ol><p id="b254" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，结构应该如下图所示。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi or"><img src="../Images/3c1ea63e2618c45c871f7a5dddfa0d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mn10XzcptjEgVPi3-uFCfg.png"/></div></div></figure><p id="08e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你有任何困难理解上述步骤或勺子(桌面应用程序)，然后要求你通过下面的链接。</p><div class="ls lt gp gr lu lv"><a href="https://medium.com/ai-in-plain-english/what-is-the-pdi-client-spoon-in-pentaho-data-integration-kettle-df65b33879ac" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">Pentaho数据集成(Kettle)中的PDI客户端(勺子)是什么？</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">了解勺子- PDI桌面应用程序的各种功能。拖放UI有助于减少…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">medium.com</p></div></div><div class="me l"><div class="os l mg mh mi me mj ll lv"/></div></div></a></div><h1 id="688e" class="og ml iq bd mm oh ot oj mp ok ou om ms jw ov jx mv jz ow ka my kc ox kd nb oq bi translated">步骤2:让我们阅读输入文件</h1><p id="7c55" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">根据这个故事，我们已经阅读了多个文件夹中的多个文件。所以，我们也这样做吧。这个想法是循环遍历每个文件并在每个文件级别执行操作，有意义吗？</p><ol class=""><li id="2d87" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nw no np nq bi translated">我们需要在Spoon(桌面应用程序)中打开转换ReadInputFiles.ktr</li><li id="f077" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nw no np nq bi translated">在<strong class="kh ir">设计</strong>选项卡中，搜索插件/库‘获取文件名’并将其拖到画布上。</li></ol><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/8c866c809603075e66ecfd3095edc6a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*D16oqVrbPra1qzmgpWtoHw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">搜索“获取文件名”步骤</p></figure><p id="d469" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，双击小部件或右键单击并选择edit来添加我们的自定义属性。PDI给了我们很多配置选项。</p><ul class=""><li id="d2f5" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">让我们把步骤名改成‘read _ input _ files’；遵守标准命名约定。</li><li id="c393" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">我们可以在<strong class="kh ir">文件或目录</strong>选项中浏览或直接粘贴输入文件夹路径(D:\ Work \ automatemuletipleexcel \ Input)。</li><li id="8678" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">因为我们必须阅读不同供应商的所有文件。我们将使用一个正则表达式。我将详细介绍相同的内容，但这是一种非常强大的文本搜索技术。在我们的<strong class="kh ir">通配符(RegExp) </strong>字段中，我们将使用正则表达式'<strong class="kh ir"> a*。*</strong>；这意味着包括所有文本，然后点击<strong class="kh ir">添加</strong>按钮。</li><li id="b8f1" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">添加后，我们需要将<strong class="kh ir">包含子文件夹</strong>字段中的布尔值更改为‘Y’。</li></ul><p id="9ce6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个插件会给我们指定目录下的文件夹和文件列表；在我们的例子中<strong class="kh ir">输入</strong>目录。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oz"><img src="../Images/e53c87b76399b2c35d33e249ec361e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*crtzQ4t4rbBBSmHGX34xhw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">获取文件名配置</p></figure><p id="e379" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们通过点击<strong class="kh ir">预览行</strong>按钮来快速检查它是否给出期望的输出。您的预览行应该如下所示。如果匹配，那么您可以点击前几行的<strong class="kh ir">关闭</strong>和该步骤的<strong class="kh ir">确定</strong>来保存更改。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pa"><img src="../Images/49c17797085d959aba1c0c1ee72a0946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HrmRw2wgYjkcbilkT228EQ.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">读取输入文件步骤的预览行</p></figure><p id="32a3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如您可能已经观察到的，我们既可以看到文件，也可以看到文件夹。我们只需要文件进行进一步处理。因此，让我们使用“过滤行”插件进行过滤；再次相同的过程在<strong class="kh ir">设计</strong>选项卡中搜索相同的，双击直接创建跳转。</p><blockquote class="pb pc pd"><p id="112a" class="kf kg pe kh b ki kj jr kk kl km ju kn pf kp kq kr pg kt ku kv ph kx ky kz la ij bi translated">PDI用最好的方式给插件命名，这样就不会有歧义了。</p></blockquote><p id="fffc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">“过滤行”是应用条件逻辑的一个步骤，在我们的例子中，我们只想通过文件而不是文件夹的行。如果您观察我们上一步(获取文件名)的<strong class="kh ir">预览行</strong>输出，PDI会给我们每行的“类型”列；我们可以用同样的逻辑。</p><ul class=""><li id="8e3c" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">我们需要更改名称以匹配我们的命名约定“filter_only_files”</li><li id="73e2" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">我们需要选择“type”列作为第一个变量，然后选择equals(我们还有许多其他选项)，最后在value选项中键入硬编码单词“file ”,如下图所示。</li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pi"><img src="../Images/a9d651d1ffd08bed5c3df95a03fd23ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nUYmg8Gt89PwpmDlflBAjg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">筛选行步骤配置</p></figure><p id="2ba6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们有了一个文件名列表，我们需要将它传递给另一个转换，在那里我们将进一步处理相同的内容。</p><p id="816c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，我们需要使用步骤'复制行到结果'插件/步骤来复制内存中的列表。搜索步骤名称并双击该名称。我们不需要添加任何进一步的配置。</p><p id="428a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在可以保存并执行<strong class="kh ir">单元测试</strong>这个读取文件模块的转换。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pj"><img src="../Images/c81053ba42f9ffc75790c08b9bd603bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ekvDa2J0dXmn1z2acCmqJg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">我们的阅读文件转换</p></figure><h1 id="9d22" class="og ml iq bd mm oh ot oj mp ok ou om ms jw ov jx mv jz ow ka my kc ox kd nb oq bi translated">步骤3:创建模板</h1><p id="831d" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">我们需要创建一个空白模板，包含我们想要用于数据操作的所有步骤/插件。因此，对于我们的用例，我们只需要两个步骤，一个是excel阅读器，另一个是excel编写器。我们需要在这里使用<strong class="kh ir">processeeachinputfile . ktr</strong>文件，并执行以下步骤。</p><p id="ca09" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用“Microsoft Excel input”、“Select value”和“Microsoft Excel writer”插件。</p><ul class=""><li id="172a" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">让我们将这些步骤分别重命名为input、rename_and_remove和output，而不是Microsoft Excel input、Select value和Microsoft Excel writer。</li><li id="f9fe" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">在“Microsoft Excel input”插件中，将<strong class="kh ir">电子表格类型(引擎)</strong>字段中的引擎更改为<strong class="kh ir"> Excel 2007 XLSX (Apache POI) </strong>。在<strong class="kh ir">附加输出字段</strong>选项卡中，在<strong class="kh ir">短文件名字段</strong>中添加<strong class="kh ir">供应商名称</strong>。</li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pk"><img src="../Images/f39369f94edce6db9f5c515fa586c26a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OupBwvkXbSuP81KhGXFWQQ.png"/></div></div></figure><ul class=""><li id="73d8" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">在“Microsoft Excel writer”插件和<strong class="kh ir">文件&amp;工作表标签</strong>中，添加输出文件的文件路径(D:\ Work \ automatemulelexcel \ Output \ supplier Output File)，在<strong class="kh ir">扩展名</strong>字段中将扩展名更改为<strong class="kh ir">xlsx【Excel 2007及以上】</strong>，如果输出文件存在字段，选择<strong class="kh ir">使用现有文件写入<strong class="kh ir">中的</strong>，选择<strong class="kh ir">写入现有文件</strong></strong></li><li id="b148" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">在“Microsoft Excel writer”插件和<strong class="kh ir">内容选项卡</strong>中，选择<strong class="kh ir">中的<strong class="kh ir">在写入行</strong>时将现有单元格下移</strong>，勾选<strong class="kh ir">在工作表末尾开始写入(追加行)</strong>并勾选<strong class="kh ir">省略标题</strong>字段。</li><li id="d612" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">我们不需要触及“选择值”这一步。</li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pl"><img src="../Images/89bf265b4f2c74b911e2a95d99e06739.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xcRbr8WZVzvB1R_xkGHniA.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">带有核心逻辑的空白模板文件</p></figure><p id="708d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就这样，我们准备好了模板。我们不需要添加任何额外的属性，我们将在运行时注入文件路径、工作表名称、字段名称等属性。</p><blockquote class="pb pc pd"><p id="94ee" class="kf kg pe kh b ki kj jr kk kl km ju kn pf kp kq kr pg kt ku kv ph kx ky kz la ij bi translated">请注意，所有的PDI插件都不支持元数据注入。你可以在这里查看支持<a class="ae lr" href="https://help.pentaho.com/Documentation/7.1/0L0/0Y0/0K0/ETL_Metadata_Injection/Steps_Supporting_MDI" rel="noopener ugc nofollow" target="_blank">的插件/步骤。</a></p></blockquote><h1 id="74ab" class="og ml iq bd mm oh ot oj mp ok ou om ms jw ov jx mv jz ow ka my kc ox kd nb oq bi translated">步骤4:创建元数据</h1><p id="62a2" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">我们需要创建元数据来读写文件。元数据是“描述其他数据的数据”，例如描述我们的excel输入和输出的信息。我们将在一个excel文件中存储所有可配置的属性(这也可以从数据库中获得)。</p><p id="8964" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将在Metadata文件夹中创建Metadata.xlsx文件，它有两个选项卡，如下所述。</p><ol class=""><li id="42fd" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nw no np nq bi translated">Master -我们将在此存储所有的主信息，如文件格式起始行、工作表名称等。</li><li id="ac1e" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nw no np nq bi translated">source file meta——我们将存储每个源文件的所有字段级信息。这些列与Microsoft Excel输入步骤中的<strong class="kh ir">字段</strong>选项卡有些匹配。</li><li id="29a3" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nw no np nq bi translated">TargetFileMeta -我们将存储所有需要的输出字段。</li></ol><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pm"><img src="../Images/49cb1475790f9b699abc4a7e8d565346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hhBBp_2UWOKq87MpSuy3bw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">母版页信息</p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pn"><img src="../Images/ef28199f5deb8362c3c885b0776c7085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f6suO1KLkwbtYmHqz3YuCg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">源文件元工作表信息</p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi po"><img src="../Images/6cb8eb2f8b8d0bb767a0ac6a649ff517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YUXCLSO6hP8QaGFeUKSB3Q.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">目标文件元工作表信息</p></figure><blockquote class="pb pc pd"><p id="fa38" class="kf kg pe kh b ki kj jr kk kl km ju kn pf kp kq kr pg kt ku kv ph kx ky kz la ij bi translated">请注意，PDI从0开始按照行列索引读取文件。因此，我们需要确保元数据信息按照输入文件是正确的。</p></blockquote><h1 id="b1f8" class="og ml iq bd mm oh ot oj mp ok ou om ms jw ov jx mv jz ow ka my kc ox kd nb oq bi translated">步骤5:注入元数据</h1><p id="ee36" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">正如在我们的用户故事中提到的，我们将接收多种文件格式，但为了便于工作流维护；我们希望建立一个通用的数据管道来处理所有这样的场景。</p><p id="1b2d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我想介绍一下PDI <strong class="kh ir">极其强大的功能；ETL元数据注入</strong>。</p><p id="2bf5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">元数据注入——顾名思义，将元数据/可配置属性注入到我们的核心逻辑步骤中。本质上，它有助于注入属性，如读取哪些文件(文件名)，从哪里读取(开始和结束行/列)，做什么(操作)，如何保存..如此等等。</p><p id="ea1c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用InjectMetadata.ktr文件来注入元信息，如下所示。</p><ul class=""><li id="afcd" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">如果您还记得，我们传递了文件列表，但没有获取它。这里是我们每次获取每个文件信息的地方。因此，我们的第一个插件是“从结果中获取行”。让我们快速地将其重命名，以匹配我们的命名约定“get_file_information”。</li><li id="bdfb" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">我们需要添加两个字段，即。从结果中获取行步骤中的文件名和短文件名。</li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/fbce20bd45b65fdcf80d8204914929ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*Dlkzf3puUmWBRiGip10z8w.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">从结果中获取行将从上一步中获取信息</p></figure><ul class=""><li id="a89a" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">我们需要多个“Microsoft Excel输入”和“连接行”步骤来读取元数据、主数据和输出数据。其思想是在执行过程中只从元数据Excel文件中获取相关信息。</li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pq"><img src="../Images/c74e955f87bc970d6090fbbb3e45f1f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vBqi7iFZqlWTb40AiiPRBQ.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">元数据注入器数据管道</p></figure><ul class=""><li id="05d4" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">我们需要在这里连接多跳。请观察跳跃的方向。另外，当从单步连接多跳时会给你下面的警告，请点击<strong class="kh ir">复制</strong>按钮。</li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pr"><img src="../Images/88cafc2edea4c29071068a41d00b2bef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyELwMBPNs_pIoEkzISSgA.png"/></div></div></figure><ul class=""><li id="3fa0" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">在master_information步骤中，我们需要在<strong class="kh ir">文件或目录</strong>中浏览Metadata.xlsx。在<strong class="kh ir">的</strong>页签中，我们需要选择<strong class="kh ir">主</strong>作为我们的<strong class="kh ir">页名</strong>和<strong class="kh ir"> 0 </strong>作为我们的<strong class="kh ir">起始行</strong>和<strong class="kh ir">起始列。</strong>在<strong class="kh ir">字段</strong>选项卡中，点击<strong class="kh ir">从标题行获取字段..</strong>按钮。</li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ps"><img src="../Images/da89d614a9963fb0730c1dfc0ab13a2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pWmzbYwfdCKEe2DXIclaJw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">主信息的字段选项卡</p></figure><ul class=""><li id="f26c" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">在meta_information和select_value excel步骤中，我们需要再次浏览<strong class="kh ir">文件或目录</strong>中的Metadata.xlsx。在<strong class="kh ir">工作表</strong>页签中，我们需要选择<strong class="kh ir">源文件元数据</strong>作为我们的<strong class="kh ir">工作表名称</strong>，并选择相同的<strong class="kh ir"> 0 </strong>作为我们的<strong class="kh ir">开始行</strong>和<strong class="kh ir">开始列。</strong>在<strong class="kh ir">字段</strong>选项卡中，点击<strong class="kh ir">从标题行获取字段..</strong>按钮。</li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pt"><img src="../Images/3f60c7a330ff25dc2452cd7f780027e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4YkEAdnzPjQ46_Tea8ug6g.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">元信息和选择值将具有相同的字段</p></figure><ul class=""><li id="f3c4" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">在target_information excel步骤中，我们需要再次浏览<strong class="kh ir">文件或</strong>目录中的Metadata.xlsx。在<strong class="kh ir">工作表</strong>页签中，我们需要选择<strong class="kh ir"> TargetFileMeta </strong>作为我们的<strong class="kh ir">工作表名称</strong>和相同的<strong class="kh ir"> 0 </strong>作为我们的<strong class="kh ir">开始行</strong>和<strong class="kh ir">开始列。</strong>在<strong class="kh ir">字段</strong>选项卡中，点击<strong class="kh ir">从标题行获取字段..</strong>按钮。</li><li id="5589" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">我们将在所有步骤中使用<strong class="kh ir">Excel 2007 XLSX(Apache POI)</strong>作为我们的引擎。</li><li id="9aa5" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">在<strong class="kh ir"> join_meta </strong>、<strong class="kh ir"> join_select_values </strong>和<strong class="kh ir"> join_master、</strong>中，我们将添加以下条件。这是为了过滤Metadata.xlsx文件中的行。我们使用了<strong class="kh ir"> short_filename </strong>作为我们的唯一标识符(在现实世界中我们不会得到这样的额外津贴)。</li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/07740f878dd1d17335731193b6b1a82c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*cagfXBk0NoUAlWBoQitWUw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">join_meta和join_master联接行步骤条件</p></figure><ul class=""><li id="de4c" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">现在让我们搜索并拖动“ETL元数据注入”插件到画布上。我们需要浏览我们的模板文件(D:\ Work \ automatemuletipleexcel \ Transformation \ processeeachinputfile . ktr)。</li><li id="9ade" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">它将自动读取我们的模板转换并列出所有可配置的属性。现在，我们只需要用属性映射各自的元数据字段。下面是映射。</li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pv"><img src="../Images/0f17e585502833f3f0543d3b94ad774e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wl04sHYUzSAjuqmMz2ibzg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">输入步骤映射</p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pw"><img src="../Images/7813aa3c2333f0c27b6bfdcd7a3a00e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oklNmDK8U09k7LuUItfR9A.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">移除并重命名步骤映射</p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi px"><img src="../Images/e8a0279cac579063fc5b417498bfbdbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*08NlK1ne0CuTRyrnd151Vw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">输出步骤映射</p></figure><p id="dd2f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这应该是注射器改造。让我们巩固和执行相同的。</p><h1 id="1ca7" class="og ml iq bd mm oh ot oj mp ok ou om ms jw ov jx mv jz ow ka my kc ox kd nb oq bi translated">第六步:连接圆点，创建主循环</h1><p id="8747" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">最后，我们到了连接各个部分和执行主要工作的最后一步。如上所示，我们将使用一个作业文件(Main.kjb)来做同样的事情。</p><p id="a0df" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作业应该总是以名为“开始”的步骤/插件开始，以“成功”步骤结束。让我们用两个“转换”步骤来拖动这些步骤；一个用于ReadInputFiles.ktr，另一个用于InjectMetadata.ktr(因为我们已经在injector步骤中使用了ProcessEachInputFile.ktr)。哦是的！我现在可以联系关系了。</p><ul class=""><li id="2f83" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">在第一个转换中，浏览我们的ReadInputFiles(D:\ Work \ AutomateMultipleExcel \ Transformation \ ReadInputFiles . ktr)转换。</li><li id="fe8b" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">在第二个转换中，浏览我们的inject metadata(D:\ Work \ automatemuletipleexcel \ Transformation \ inject metadata . ktr)转换，并检查<strong class="kh ir">执行每个输入行。</strong></li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi py"><img src="../Images/5b0fd2931bdf0b1e50aee21f1bb503cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*80oNLpeOh-1or5rMUnRUXg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">选中执行每个输入行以循环列表</p></figure><p id="0476" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">执行每个输入行将为每个文件创建我们的主循环，注入元数据并进行相同的处理。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi pz"><img src="../Images/b02cb195379869c58ad7e55358ba74f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iAReLCOA1jbiXXdlUOxIwg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">我们的主要工作是读取和执行文件</p></figure><p id="49f5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们开始行动，执行我们的数据管道。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi qa"><img src="../Images/25cc8e967a06c5d6b361ac31774cad6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T5hDcD1RXkTrh-KK8S0X1w.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">成功</p></figure><p id="802e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在可以在输出目录中检查我们的文件。让我们使用测试用例来执行测试。</p><p id="cb37" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在可以根据我们的要求分析数据。</p><p id="eda3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">结论</strong></p><p id="84b9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自动化多个excel电子表格可能是一项有趣的活动。上述实现并不完美，但将解决我们的问题陈述。我们可以通过添加变量而不是硬编码的值来进一步推广这个管道。我们可以按照我们的要求类似地构建/定制这个管道，接下来我们将从电子邮件用例中下载数据。</p><h1 id="355c" class="og ml iq bd mm oh ot oj mp ok ou om ms jw ov jx mv jz ow ka my kc ox kd nb oq bi translated">下一篇文章再见。快乐的ETL</h1></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><p id="e5f5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你喜欢类似的内容，那么我会推荐你使用下面的链接订阅。</p><div class="ls lt gp gr lu lv"><a href="https://wryteex.com/" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">WryteEx -开发、数据工程、项目管理等</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">我写的博客涉及数据工程、金融、Python、Python Django、项目管理、Web开发等等</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">wryteex.com</p></div></div><div class="me l"><div class="qb l mg mh mi me mj ll lv"/></div></div></a></div></div></div>    
</body>
</html>