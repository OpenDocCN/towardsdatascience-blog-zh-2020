<html>
<head>
<title>Azure Machine Learning Service — Run a Simple Experiment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure 机器学习服务——运行一个简单的实验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/azure-machine-learning-service-run-python-script-experiment-1a9b2fc1b550?source=collection_archive---------54-----------------------#2020-05-18">https://towardsdatascience.com/azure-machine-learning-service-run-python-script-experiment-1a9b2fc1b550?source=collection_archive---------54-----------------------#2020-05-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="caf7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">第 2 部分:如何使用 Azure 机器学习服务编写一个 ML 模型并执行实验。</h2></div><h1 id="29a0" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">摘要</h1><p id="f805" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在本系列的<a class="ae lw" href="https://www.kaggle.com/pankaj1234/azure-machine-learning-introduction" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iu"> <em class="lx">第一部分</em> </strong> </a> <strong class="lc iu"> </strong>中，我主要介绍了关于 Azure 机器学习(AML)服务的概述和介绍，在那篇文章中，我介绍了设置、配置和这种云管理服务提供的各种 OOB 功能。我还详细讨论了反洗钱工作区、反洗钱实验和反洗钱服务实验的仪表板。</p><p id="6571" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj ma ll lm ln mb lp lq lr mc lt lu lv im bi translated">在第 2 部分中，我将讨论如何创建一个独立的实验脚本来封装云上 ML 模型的核心实现，即通过重复实验运行进行训练和跟踪。此外，我将演示如何设置执行实验脚本所需的先决环境和配置。</p><blockquote class="md"><p id="00ea" class="me mf it bd mg mh mi mj mk ml mm lv dk translated">这篇特别的帖子摘自 Kaggle 笔记本托管— <a class="ae lw" href="https://www.kaggle.com/pankaj1234/azure-machine-learning-introduction-ii" rel="noopener ugc nofollow" target="_blank">此处</a>。使用链接来设置和执行实验</p></blockquote><figure class="mo mp mq mr ms mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mn"><img src="../Images/e133d8167133f22bc1878a8209bde633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PDPmjO_DxPxjIZ1b1ILkew.jpeg"/></div></div></figure></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="c3a4" class="ki kj it bd kk kl nh kn ko kp ni kr ks jz nj ka ku kc nk kd kw kf nl kg ky kz bi translated">机器学习实验脚本</h1><p id="b457" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">一旦连接到 Azure 机器学习工作空间，下一步是定义一个模型实验脚本，这是一个非常通用的 python 脚本，它从实验的“工作空间”计算上下文中加载和执行。这还要求数据文件的根目录(文件夹)必须与加载该脚本的位置相同，如下所示</p><figure class="nn no np nq gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nm"><img src="../Images/113a210592d1b9f536f559249ccf02f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wf8MzQhu_q-uZVsMNNApRQ.png"/></div></div><p class="nr ns gj gh gi nt nu bd b be z dk translated"><strong class="bd nv">图 1: </strong>实验脚本快照——必须导入<strong class="bd nv"> azureml.core.Run </strong>类并执行其<strong class="bd nv"> get_context() </strong>方法</p></figure><p id="917d" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj ma ll lm ln mb lp lq lr mc lt lu lv im bi translated"><strong class="lc iu">实验输出文件夹— </strong>大多数情况下，运行一个实验会生成一些输出文件，例如保存的模型，这些文件保存在工作区的<strong class="lc iu">输出</strong>文件夹中，如下图所示—</p><pre class="nn no np nq gt nw nx ny nz aw oa bi"><span id="ee6c" class="ob kj it nx b gy oc od l oe of">os.makedirs("outputs", exist_ok=True)<br/>joblib.dump(value=model, filename='outputs/iris_simple_model.pkl')<br/><em class="lx"># Complete the run</em><br/>run.complete()</span></pre><p id="913a" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj ma ll lm ln mb lp lq lr mc lt lu lv im bi translated">也可以在如下所示的实验文件代码中使用<strong class="lc iu"> Run </strong>对象的<strong class="lc iu"> upload_file </strong>方法，这使得在计算上下文中写入<strong class="lc iu"> outputs </strong>文件夹的任何文件都可以在运行完成时自动上传到运行的<strong class="lc iu"> outputs </strong>文件夹，例如</p><pre class="nn no np nq gt nw nx ny nz aw oa bi"><span id="df50" class="ob kj it nx b gy oc od l oe of">run.upload_file(name='outputs/IRIS.csv', path_or_stream='./sample.csv') # upload from local</span></pre><h1 id="d977" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">进行实验</h1><h2 id="ff02" class="ob kj it bd kk og oh dn ko oi oj dp ks lj ok ol ku ln om on kw lr oo op ky oq bi translated">运行配置和脚本运行配置</h2><p id="5321" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在实现 ML 模型的脚本准备好之后，下一步是定义<code class="fe or os ot nx b"><em class="lx">RunConfiguration</em></code> <em class="lx"> </em>对象——它定义脚本将在其中运行的 Python 环境，以及<code class="fe or os ot nx b"><em class="lx">ScriptRunConfig</em></code> <em class="lx"> </em>对象<em class="lx">——</em>，它将运行环境与脚本相关联。下面的代码片段通过调用<code class="fe or os ot nx b">RunConfiguration()</code>方法实例化了 Python 环境，并且<code class="fe or os ot nx b">ScriptRunConfig()</code>封装了相同的脚本执行环境:</p><pre class="nn no np nq gt nw nx ny nz aw oa bi"><span id="bdfd" class="ob kj it nx b gy oc od l oe of">from azureml.core import Experiment, <strong class="nx iu">RunConfiguration, ScriptRunConfig</strong></span><span id="665b" class="ob kj it nx b gy ou od l oe of"><em class="lx"># create a new RunConfig object</em><br/>experiment_run_config = <strong class="nx iu">RunConfiguration()</strong><br/>experiment_run_config.environment.python.user_managed_dependencies = True</span><span id="fca8" class="ob kj it nx b gy ou od l oe of"><em class="lx"># Create a script config</em><br/>src = <strong class="nx iu">ScriptRunConfig</strong>(source_directory=experiment_folder, <br/>                      script='iris_simple_experiment.py',<br/>                      run_config=experiment_run_config)</span></pre><blockquote class="ov ow ox"><p id="a58c" class="la lb lx lc b ld ly ju lf lg lz jx li oy ma ll lm oz mb lp lq pa mc lt lu lv im bi translated"><code class="fe or os ot nx b"><em class="it">RunConfig</em></code>对象还允许额外包含脚本执行所必需的 Python 包。</p></blockquote><h2 id="965d" class="ob kj it bd kk og oh dn ko oi oj dp ks lj ok ol ku ln om on kw lr oo op ky oq bi translated">仪表板结果</h2><p id="4a8d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">访问<a class="ae lw" href="https://ml.azure.com/" rel="noopener ugc nofollow" target="_blank"><em class="lx">Azure Machine Learning Studio</em></a>来导航样本实验运行，并在仪表板上的结果中验证结果。在这里，显示了<em class="lx">实验的</em>运行历史的全部细节，如下所示——运行<em class="lx">的统计、历史、结果、度量、日志、输出、错误、诊断等的细节..可从仪表板上轻松获得:</em></p><figure class="nn no np nq gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi pb"><img src="../Images/655d1882ca43f80fe40003c2660b03b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hEo9blkVbbbQdIIBdfJbWA.png"/></div></div><p class="nr ns gj gh gi nt nu bd b be z dk translated"><strong class="bd nv">图 2:</strong>Iris-sample-experiment 的仪表板结果视图，观察运行统计和其他可用指标。</p></figure><figure class="nn no np nq gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi pc"><img src="../Images/b12508e6d0c0621d8b96d960f29db560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mMK66e0MYzx8kLSkJcrLuw.png"/></div></div><p class="nr ns gj gh gi nt nu bd b be z dk translated"><strong class="bd nv">图 3: </strong>更详细的结果也可用于任何选定的实验，例如试验# 20</p></figure><figure class="nn no np nq gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi pd"><img src="../Images/8405460e704f87769c8f25a07ddd1a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FgTyaoczWoVxh8iLksxRXg.png"/></div></div><p class="nr ns gj gh gi nt nu bd b be z dk translated"><strong class="bd nv">图 4: Outputs </strong>文件夹中有一个使用实验脚本上传的模型文件</p></figure><h1 id="b132" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="b4d2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在系列的这一部分，我试图涵盖 Azure 机器学习服务的最基本概念，即准备和执行机器学习实验并生成模型二进制文件。在下一篇文章中，我将介绍一种稍微高级一点的方法来设置和控制脚本的执行环境，安装或更新所需的依赖项和包。所以请保持关注！</p><h1 id="2b41" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">接下来呢？</h1><p id="b13c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这是一系列博客帖子，包含各种 Azure 机器学习功能的详细概述，其他帖子的 URL 如下:</p><ul class=""><li id="9f3b" class="pe pf it lc b ld ly lg lz lj pg ln ph lr pi lv pj pk pl pm bi translated">帖子 1: <a class="ae lw" rel="noopener" target="_blank" href="/azure-machine-learning-service-part-1-an-introduction-739620d1127b"> Azure 机器学习服务:第一部分——简介</a></li><li id="fc6b" class="pe pf it lc b ld pn lg po lj pp ln pq lr pr lv pj pk pl pm bi translated">岗位 2 <em class="lx">(这个)</em> : <a class="ae lw" rel="noopener" target="_blank" href="/azure-machine-learning-service-run-python-script-experiment-1a9b2fc1b550"> Azure 机器学习服务——运行一个简单的实验</a></li><li id="e57d" class="pe pf it lc b ld pn lg po lj pp ln pq lr pr lv pj pk pl pm bi translated">帖子 3: <a class="ae lw" rel="noopener" target="_blank" href="/azure-machine-learning-service-train-a-model-df72c6b5dc"> Azure 机器学习服务——训练一个模型</a></li><li id="d36d" class="pe pf it lc b ld pn lg po lj pp ln pq lr pr lv pj pk pl pm bi translated">帖子 4: <a class="ae lw" rel="noopener" target="_blank" href="/azure-machine-learning-service-where-is-my-data-pjainani-86a77b93ab52"> Azure 机器学习服务——我的数据在哪里？</a></li><li id="7d90" class="pe pf it lc b ld pn lg po lj pp ln pq lr pr lv pj pk pl pm bi translated">帖子 5: <a class="ae lw" rel="noopener" target="_blank" href="/azure-machine-learning-service-what-is-the-target-environment-cb45d43530f2"> Azure 机器学习服务——目标环境是什么？</a></li></ul><blockquote class="ov ow ox"><p id="ed53" class="la lb lx lc b ld ly ju lf lg lz jx li oy ma ll lm oz mb lp lq pa mc lt lu lv im bi translated"><em class="it">与我连线</em><a class="ae lw" href="https://www.linkedin.com/in/p-jainani/" rel="noopener ugc nofollow" target="_blank"><strong class="lc iu"><em class="it">LinkedIn</em></strong></a><em class="it">进一步讨论</em></p></blockquote><h2 id="ab73" class="ob kj it bd kk og oh dn ko oi oj dp ks lj ok ol ku ln om on kw lr oo op ky oq bi translated">参考</h2><p id="ab96" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">[1]笔记本&amp;代码— <a class="ae lw" href="https://www.kaggle.com/pankaj1234/azure-machine-learning-introduction-ii" rel="noopener ugc nofollow" target="_blank"> Azure 机器学习—简介</a>，Kaggle。<br/>【2】<a class="ae lw" href="https://docs.microsoft.com/en-in/azure/machine-learning/" rel="noopener ugc nofollow" target="_blank">Azure 机器学习服务</a>官方文档，微软 Azure。</p></div></div>    
</body>
</html>