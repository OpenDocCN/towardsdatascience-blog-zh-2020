<html>
<head>
<title>Predicting e-Commerce Sales with a Random Forest Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用随机森林回归预测电子商务销售额</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-e-commerce-sales-with-a-random-forest-regression-3f3c8783e49b?source=collection_archive---------25-----------------------#2020-08-25">https://towardsdatascience.com/predicting-e-commerce-sales-with-a-random-forest-regression-3f3c8783e49b?source=collection_archive---------25-----------------------#2020-08-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7c26" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用真实生活数据的基础教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e880eb8346983b2fa0e2751d1bc901f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wav8f2Mx1ZFoQBHH"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@rupixen?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">rupixen.com</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h1 id="eb67" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">数据集</h1><p id="e0ac" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了演示随机森林回归，将使用流行的在线零售商 Wish 的电子商务销售数据集。这些数据来自<a class="ae ky" href="https://www.kaggle.com/jmmvutu/summer-products-and-sales-in-ecommerce-wish" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>，并且只展示了夏季服装的销售信息。这些属性包括产品描述、评级、是否使用了广告宣传、产品列表中是否添加了紧急文本以及售出的数量等。</p><p id="8799" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了显示随机森林回归的威力，将预测售出的单位数。不仅对于需要估计订购或生产多少产品的库存计划人员来说，而且对于需要了解产品在电子商务环境中如何移动的销售人员来说，做出良好、准确的预测都是非常宝贵的。</p><h1 id="1c30" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">导入和清理数据</h1><p id="334c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">所有的数据导入和操作都将通过 python 以及 pandas 和 numpy 库来完成。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="22dd" class="mx la it mt b gy my mz l na nb">import pandas as pd<br/>import numpy as np</span><span id="18bf" class="mx la it mt b gy nc mz l na nb"># import the data saved as a csv<br/>df = pd.read_csv("Summer_Sales_08.2020.csv")</span></pre><p id="0ba2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">前两行只是导入 pandas 和 numpy 库。最后一行读取先前保存并重命名为“Summer_Sales_08.2020”的 CSV 文件，并创建一个数据框。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="dfff" class="mx la it mt b gy my mz l na nb">df["has_urgency_banner"] = df["has_urgency_banner"].fillna(0)</span><span id="e482" class="mx la it mt b gy nc mz l na nb">df["discount"] = (df["retail_price"] - df["price"])/df["retail_price"]</span></pre><p id="fdf8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">查看数据时,“has_urgency_banner”列编码不正确，该列指示是否对产品列表应用了紧急横幅。当横幅没有被使用时，它只是留下空白，而不是使用 1 和 0。第一行代码用 0 填充这些空白。</p><p id="569c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">第二行创建一个名为“discount”的新列，它计算产品相对于列出的零售价格的折扣。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="441f" class="mx la it mt b gy my mz l na nb">df["rating_five_percent"] = df["rating_five_count"]/df["rating_count"]<br/>df["rating_four_percent"] = df["rating_four_count"]/df["rating_count"]<br/>df["rating_three_percent"] = df["rating_three_count"]/df["rating_count"]<br/>df["rating_two_percent"] = df["rating_two_count"]/df["rating_count"]<br/>df["rating_one_percent"] = df["rating_one_count"]/df["rating_count"]</span></pre><p id="f33e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">原始数据集包括几个专用于产品评级的列。除了平均评级，它还包括评级总数以及五星、四星、三星、二星和一星评论的数量。因为已经考虑了评论的总数，所以最好将星级作为总评分的百分比来看，这样可以在产品之间进行直接比较。</p><p id="8ca4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面几行简单地创建了五个新列，给出了数据集中每个产品的五星、四星、三星、二星和一星评论的百分比。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="69c3" class="mx la it mt b gy my mz l na nb">ratings = [<br/>    "rating_five_percent",<br/>    "rating_four_percent",<br/>    "rating_three_percent",<br/>    "rating_two_percent",<br/>    "rating_one_percent"<br/>]</span><span id="24b7" class="mx la it mt b gy nc mz l na nb">for rating in ratings:<br/>    df[rating] = df[rating].apply(lambda x: x if x&gt;= 0 and x&lt;= 1 else 0)</span></pre><p id="9161" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">虽然 pandas 在除以 0 时不会抛出错误，但在试图分析数据时会产生问题。在这种情况下，评分为 0 的产品在上一步计算时会产生问题。</p><p id="d800" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面的代码片段遍历所有新生成的列，并检查输入的值是否在 0 和 1 之间，包括 0 和 1。如果不是，它们会被替换为 0，这是一个合适的替代。</p><h1 id="913e" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">数据探索</h1><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="c3c0" class="mx la it mt b gy my mz l na nb">import seaborn as sns</span><span id="c4fb" class="mx la it mt b gy nc mz l na nb"># Distribution plot on price<br/>sns.distplot(df['price'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/52cd4c61fb4360c818bc3f7e02e2cb70.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*pxrpuqJDtmn6v_VFp_60aA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">价格分布图。图由作者制作。</p></figure><p id="7455" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面的代码生成了数据集中所有产品的价格分布图。最明显也是最有趣的发现是，没有任何产品花费€10 英镑。这可能是商家为了让他们的产品出现在“€10 岁及以下”名单上而故意做出的努力。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="17f2" class="mx la it mt b gy my mz l na nb">sns.jointplot(x = "rating", y = "units_sold", data = df, kind = "scatter")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/ed726b0007f23d5e490e7ecd4a80b57c.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*FynUzmeD_nq3yFFpZe8k8A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">收视率和销售量之间的散点图。图由作者制作。</p></figure><p id="207e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上图显示，绝大多数销售都是在三星和四星半之间。它还显示，大多数产品的销量不到 2 万件，少数产品的销量分别为 6 万件和 10 万件。</p><p id="a459" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">作为一个旁白，散点图组织成线的趋势表明，销售单位更可能是一个估计，而不是硬数字。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="da4c" class="mx la it mt b gy my mz l na nb">sns.jointplot(x = "rating_count", y = "units_sold", data = df, kind = "reg")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/604abe44425fb5727eae9c6a403f6abc.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*H4Wh218vTdyISekVb8c7_w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">收视率和销售量之间的散点图。图由作者制作。</p></figure><p id="ebea" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这张图表展示了评级的另一面。评级的数量和产品销售的可能性之间有一种松散但积极的关系。这可能是因为消费者在考虑购买时会同时考虑总体评分和评分数量，或者是因为高销量的产品自然会产生更多的评分。</p><p id="b3ec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果没有关于购买时间和评级发布时间的额外数据，如果没有额外的领域知识，很难辨别相关性的原因。</p><h1 id="97ca" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是随机森林回归？</h1><p id="7d44" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">简而言之，随机森林回归是一系列决策树的平均结果。决策树就像一个流程图，它提出一系列问题，并根据这些问题的答案做出预测。例如，试图预测网球运动员是否会去球场的决策树可能会问:正在下雨吗？如果是，球场在室内吗？如果没有，玩家能找到伴侣吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/36b2b9f8957a2d0203312428b762c287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*e7mavy4eJtbt-ysSK5v6fQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个简单的决策树。图由作者制作。</p></figure><p id="b68f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">决策树将在做出预测之前回答每一个问题。虽然容易理解，而且根据一些专家的说法，比其他机器学习技术更好地模拟实际的人类行为，但它们经常过度拟合数据，这意味着它们经常可以在类似的数据集上给出非常不同的结果。</p><p id="e74b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了解决这个问题，从相同的数据集中取出多个决策树，打包，并返回结果的平均值。这就是所谓的随机森林回归。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/d61da9fe28fc2a8d59a9f397ca06f365.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gX5XSHrCwjUwuU4hfuBQCg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个简单的随机森林。图由作者制作。</p></figure><p id="9abd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">它的主要优势是对高度非线性的数据做出准确的预测。在愿望数据集中，在评级中可以看到非线性关系。没有一个很好的，容易看到的相关性，但低于三颗星和高于四颗半的截止点是显而易见的。随机森林回归可以识别这种模式，并将其纳入结果中。然而，在一个更传统的线性回归中，它只会混淆它的预测。</p><p id="a839" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，随机森林分类器是高效的，可以处理许多输入变量，并且通常做出准确的预测。这是一个非常强大的工具，并且不需要太多代码来实现。</p><h1 id="c421" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">实现随机森林回归</h1><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="3f9b" class="mx la it mt b gy my mz l na nb">from sklearn.model_selection import train_test_split<br/>from sklearn.ensemble import RandomForestRegressor</span><span id="d4dd" class="mx la it mt b gy nc mz l na nb"># Divide the data between units sold and influencing factors<br/>X = df.filter([<br/>    "price",<br/>    "discount",<br/>    "uses_ad_boosts",<br/>    "rating",<br/>    "rating_count",<br/>    "rating_five_percent",<br/>    "rating_four_percent",<br/>    "rating_three_percent",<br/>    "rating_two_percent",<br/>    "rating_one_percent",<br/>    "has_urgency_banner",<br/>    "merchant_rating",<br/>    "merchant_rating_count",<br/>    "merchant_has_profile_picture"<br/>])</span><span id="32b2" class="mx la it mt b gy nc mz l na nb">Y = df["units_sold"]</span><span id="77f4" class="mx la it mt b gy nc mz l na nb"># Split the data into training and testing sets<br/>X_train, X_test, Y_train, Y_test = train_test_split(X, Y, test_size=0.33, random_state = 42)</span></pre><p id="17b6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在运行任何模型之前，前两行导入相关的库。下一组行创建两个变量 X 和 Y，然后将它们分成训练和测试数据。测试大小为 0.33，这确保了大约三分之二的数据将用于训练数据，三分之一将用于测试数据的准确性。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="0a6a" class="mx la it mt b gy my mz l na nb"># Set up and run the model<br/>RFRegressor = RandomForestRegressor(n_estimators = 20)<br/>RFRegressor.fit(X_train, Y_train)</span></pre><p id="3f31" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">接下来，模型实际上被初始化并运行。注意，参数 n_estimators 表示要使用的决策树的数量。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="0bab" class="mx la it mt b gy my mz l na nb">predictions = RFRegressor.predict(X_test)<br/>error = Y_test - predictions</span></pre><p id="8b1d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，新拟合的随机森林回归被应用于测试数据，并且取差来产生误差阵列。这就是全部了！</p><h1 id="1223" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="2e54" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Wish 数据集提供了一个数字游戏场，可用于解决现实世界的问题。通过最少的数据操作，随机森林回归被证明是分析这些数据并提供实际结果的无价工具。</p></div></div>    
</body>
</html>