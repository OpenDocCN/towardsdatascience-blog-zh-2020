<html>
<head>
<title>Using Python to insert data into SAP with PyRFC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 PyRFC 使用 Python 将数据插入 SAP</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-python-to-insert-data-into-sap-with-pyrfc-5eb2ceeda79b?source=collection_archive---------9-----------------------#2020-08-24">https://towardsdatascience.com/using-python-to-insert-data-into-sap-with-pyrfc-5eb2ceeda79b?source=collection_archive---------9-----------------------#2020-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/6969f02f65e29552c5781796b5269a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FL87a22aOm4pFXq9"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">约翰·汤纳在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><div class=""/><div class=""><h2 id="a518" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">如何用使用最多的语言将一个机器学习方法的结果插入到 SAP 中开发机器学习模型？</h2></div><p id="32be" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">今天，我们看到机器学习(ML)开发的日益增长，最大的开发工具是 Python，每天都有越来越多的人试图将 ML 模型的结果返回到他们的企业资源规划系统(ERPs)中。</p><p id="7a18" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">SAP 是最常用的 ERP 系统之一，要将 ML 模型的结果插入其中，我们有两种选择，一种是在自定义 SAP 事务中手动插入，另一种是使用远程函数调用(RFC ),这是 SAP 系统和其他系统之间通信的标准 SAP 接口，因此 RFC 调用要在远程系统中执行的函数。</p><p id="02a3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设您可以使用机器人流程自动化系统(RPA)自动上传事务中的结果文件，那么我们应该选择哪一个呢？</p><p id="a417" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">嗯，如果我必须选择其中一个，我会选择第二个选项，因为它往往比第一个变化更小，更新更少，所以你可能会有更少的问题与未被注意的更新。</p><p id="b55e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">需要指出的重要一点是，RFC 有许多目标和方法有待开发，我们想要使用的是将数据插入表格</p><p id="1d3a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以使用 PyRFC 包用 Python 来实现，但是它的第一次使用并不那么简单，所以为了帮助我们，我创建了一些函数和文档。</p><p id="55b9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们开始吧！</p><h1 id="6053" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">装置</h1><h2 id="3e08" class="mm lv jj bd lw mn mo dn ma mp mq dp me lh mr ms mg ll mt mu mi lp mv mw mk mx bi translated">-第一步:下载 SAP NW RFC SDK</h2><p id="0a53" class="pw-post-body-paragraph ky kz jj la b lb my kk ld le mz kn lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">SAP NW RFC SDK 是 SAP NetWeaver 远程函数调用系统开发工具包的缩写，它允许您管理 RFC。</p><p id="925f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我从<strong class="la jk"> Informatica </strong> of <strong class="la jk"> </strong>找到了一本非常好的如何下载它的手册，但它是针对旧版本的，现在一些图标已经完全不同了，所以我写下了步骤并重印了图片以更新它。</p><p id="27de" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果想看 Informatica 的手册，文末有链接作为出处。</p><p id="acf4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下载这些内容的一个困难是你需要一个 SAP 账户，所以在开始这个旅程之前，试着去申请一个。</p><p id="4017" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">回来，下载步骤:</p><ul class=""><li id="1f16" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">前往 SAP 服务市场:<a class="ae jg" href="http://service.sap.com/support" rel="noopener ugc nofollow" target="_blank">http://service.sap.com/support</a></li><li id="1504" class="nd ne jj la b lb nm le nn lh no ll np lp nq lt ni nj nk nl bi translated">输入您的 SAP 服务市场用户名和密码。将出现“SAP 支持门户”页面。</li></ul><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nr"><img src="../Images/ee6e9c3c8de7c857c41d0f82611a5c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3DqgYUFEEp358YsrEMUnww.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nw"><img src="../Images/2a507d4c86c21e97a05251dcfc3dc298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MONXScp7bZOc_RYjKDXyxA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/a55b0ab5701ff88f96e0c3dae791fb06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3xNv1HbWw0JGlZGpr04rg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><ul class=""><li id="da9e" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">单击下载软件图标。</li></ul><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ny"><img src="../Images/4fe2ead3aed1fc14cc4c8a0a4abaebba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WjSFa1fXO3yumyTlxe5r-Q.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><p id="3a9e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">观察，一旦您登录，用户图标的颜色会变成蓝色</p><ul class=""><li id="2b95" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">单击支持包和修补程序选项卡。</li></ul><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nz"><img src="../Images/e49bfa4812081c500ca282386da1b167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GupJHfzOUwApm5rCbTWVrA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><ul class=""><li id="4ecd" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">从列表中单击“按类别”。</li></ul><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/f54687d7ede6232cd7ca5fa9d3cb4d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zH9i37eTp4HEoqFc2Vdmeg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><ul class=""><li id="da18" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">从列表中单击其他组件。</li></ul><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/04d07b8d4da304385b7b055a76570f19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqfWye0P_9ttQA3aBe6HtQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><ul class=""><li id="8e29" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">从列表中单击 SAP NW RFC SDK。</li></ul><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/7b992a23622375afc4d401b9777287f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9d5bqzImCoY5FTeYINKh2Q.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><ul class=""><li id="3160" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">单击 SAP NW RFC SDK 的最新版本。</li></ul><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/a3615abe231bf10bbc7ae6ae09930a6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*upnFAs-TqgrANAuSVHqG6Q.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><ul class=""><li id="bae8" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">选择要下载的操作系统</li></ul><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oe"><img src="../Images/fea950322ebf7575a00f733501d3f4d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PPeg5-opwzK42jjWriz6Dg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><ul class=""><li id="0986" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">单击超链接。zip 文件来下载库。</li></ul><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi of"><img src="../Images/68b4d8f02a2a6e36fb08880b04478be9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*24oavxIVoqvFxCgMQML5CQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><ul class=""><li id="8359" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">提取中的文件和文件夹。压缩到您的 SAP 文件夹</li></ul><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi og"><img src="../Images/6b8b9224903dabe72548fbbda70b0960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cYfy_89PV13CSppFIm0mUQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><p id="d1b5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">突出显示的文件夹和文件是. zip 文件中的内容。</p><p id="30f3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦你做到了这一点，一切都从 SAP 端设置好了。</p><h2 id="6c75" class="mm lv jj bd lw mn mo dn ma mp mq dp me lh mr ms mg ll mt mu mi lp mv mw mk mx bi translated">-第二步:安装软件包</h2><p id="47d0" class="pw-post-body-paragraph ky kz jj la b lb my kk ld le mz kn lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">这比上一步简单一点，只需在 Python 终端上分别编写和运行这两行代码。</p><pre class="ns nt nu nv gt oh oi oj ok aw ol bi"><span id="2ab8" class="mm lv jj oi b gy om on l oo op">pip install pyrfc</span><span id="1630" class="mm lv jj oi b gy oq on l oo op">pip install pynwrfc</span></pre><p id="aabb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我想你可能只需要运行第二个，但是我已经安装了它们，我更愿意告诉你也安装它们，而不是你不能使用 PyRFC 包。</p><h1 id="148a" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">编码</h1><p id="c2d0" class="pw-post-body-paragraph ky kz jj la b lb my kk ld le mz kn lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">酷，现在你已经到了有趣的部分！</p><blockquote class="or os ot"><p id="16bb" class="ky kz ou la b lb lc kk ld le lf kn lg ov li lj lk ow lm ln lo ox lq lr ls lt im bi translated">Obs:如果您必须打开虚拟专用网络(VPN)才能访问 SAP，那么在使用这些功能时您也需要打开它。</p></blockquote><p id="7d7a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于这个开发，我们将有两个文件:<strong class="la jk">常量</strong>。和<strong class="la jk"> sap_rfc_connection </strong> .py</p><p id="e121" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">里面的<strong class="la jk">常数</strong>。我们存储三样东西，带有 SAP 登录凭证的字典，RFC 函数和表名，以及每次 RFC 调用要插入的行数。</p><p id="7bb9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，在<strong class="la jk"> sap_rfc_connection </strong>中。py 我们有两个主要功能:</p><ul class=""><li id="17b4" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">desc 功能区</li></ul><pre class="ns nt nu nv gt oh oi oj ok aw ol bi"><span id="171c" class="mm lv jj oi b gy om on l oo op">def rfc_func_desc(dict_sap_con, func_name):<br/>    '''consult the RFC description and needed input fields<br/>    <br/>    Parameters<br/>    ----------<br/>    dict_sap_con : dict<br/>        key to create connection with SAP, must contain: user, passwd, ashost, sysnr, client<br/>    func_name : str<br/>        name of the function that you want to verify<br/>        <br/>    Returns<br/>    -------<br/>    funct_desc : pyrfc.pyrfc.FunctionDescription<br/>        RFC functional description object<br/>    '''<br/>    print(f'{time.ctime()}, Start getting function description from RFC')<br/>    print(f'{time.ctime()}, Start SAP connection')<br/>    # create connection with SAP based on data inside the dict<br/>    with Connection(**dict_sap_con) as conn:<br/>        print(f'{time.ctime()}, SAP connection stablished')<br/>        # get data from the desired RFC function<br/>        funct_desc = conn.get_function_description(func_name)<br/>        # display the information about the RFC to user<br/>        display(funct_desc.parameters[0],funct_desc.parameters[0]['type_description'].fields)<br/>        # return it as a variable<br/>        return funct_desc<br/>    # how the whole command is inside the 'with' when it ends the connection with SAP is closed<br/>    print(f'{time.ctime()}, SAP connection closed')<br/>    print(f'{time.ctime()}, End getting function description from RFC')</span></pre><p id="c16e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在是它如何工作的一个例子，这个函数的主要目标是让你得到完整的 RFC 描述，并把它存储到一个变量中，这样你以后可以参考它(你也可以查看 PyDrive 文档，看看你可以用它做的所有事情)，并向你显示使用 RFC 需要什么，比如字段名和数据类型。</p><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oy"><img src="../Images/4b16a5cc5ba76edef304ac0f4a4f57a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7IveF_FD2t8burOA16tnKw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ny"><img src="../Images/8e54d0aea3a3923387825b5cd3f4f5d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4fUZSBwW7-jVd7A-0SuaBA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><p id="4d20" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这很有用，因为有了它们，我们就知道了数据框的结构/列名以及每个字段中必须使用的数据类型，以免出错。</p><p id="f2e0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的例子中，我创建了下面这个数据框来测试。</p><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oz"><img src="../Images/74a71a080f01584c2a222b1ae56fd67c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fTJyBa2iaPgUwuSpZKh22g.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><p id="594b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">数据框创建后，我们可以继续第二个功能。</p><ul class=""><li id="8fed" class="nd ne jj la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">df_to_sap_rfc</li></ul><pre class="ns nt nu nv gt oh oi oj ok aw ol bi"><span id="d6b9" class="mm lv jj oi b gy om on l oo op">def df_to_sap_rfc(df, dict_sap_con, func_name, rfc_table):<br/>    '''ingest data that is in a data frame in SAP using a defined RFC, checking if the dataframe has the same size, column names and data types<br/>    <br/>    Parameters<br/>    ----------<br/>    df : pandas.DataFrame<br/>        dataframe that is going to be used to insert data to SAP<br/>    dict_sap_con : dict<br/>        dictionary with SAP logon credentials (user, passwd, ashost, sysnr, client)<br/>    func_name : string<br/>        name of the RFC function<br/>    rfc_table : string<br/>        name of the rfc table you are going to populate<br/>        <br/>    Returns<br/>    -------<br/>    None<br/>    '''<br/>    # get needed parameters from RFC<br/>    lst_param = get_rfc_parameters(dict_sap_con, func_name)<br/>    # check dataframe input<br/>    check_input_format(df, lst_param)<br/>    # insert data<br/>    lst_res = insert_df_in_sap_rfc(<br/>        df, dict_sap_con, func_name, rfc_table)</span></pre><p id="18fc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个函数包含了另外三个方法，但是为了不在它们上面浪费太多时间，前两个方法是检查数据帧是否符合 RFC 请求的格式(列名和数据类型)，如果不符合，它就停止执行，以免将错误的数据插入 SAP。</p><p id="5795" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">真正的“神奇”发生在第三个函数中，insert_df_in_sap_rfc 函数:</p><pre class="ns nt nu nv gt oh oi oj ok aw ol bi"><span id="3307" class="mm lv jj oi b gy om on l oo op">def insert_df_in_sap_rfc(df, dict_sap_con, func_name, rfc_table):<br/>    '''Ingest data that is in a data frame in SAP using a defined RFC<br/>    <br/>    Parameters<br/>    ----------<br/>    df : pandas.DataFrame<br/>        dataframe that is going to be used to insert data to SAP<br/>    dict_sap_con : dict<br/>        dictionary with SAP logon credentials (user, passwd, ashost, sysnr, client)<br/>    func_name : string<br/>        name of the function that you want to remotelly call<br/>    rfc_table : string<br/>        name of the table which your RFC populates<br/>        <br/>    Returns<br/>    -------<br/>    lst_res : list<br/>        list of dictionaries with field names and data types used in RFC<br/>    '''<br/>    print(f'{time.ctime()}, Start data ingestion to SAP process')<br/>    # create an empty list that is going to recive the result<br/>    lst_res = []<br/>    # get the quantity of rows of the dataframe<br/>    rows_qty = len(df)<br/>    # define the number of execution, getting the entire part of the division and <br/>    # adding 1 to it, to execute the last rows that don't achieve the quantity of <br/>    # an extra execution<br/>    iter_qty = (rows_qty // c.rows_per_exec) + 1<br/>    print(f'{time.ctime()}, Start SAP connection')<br/>    # create connection with SAP based on data inside the dict<br/>    with Connection(**dict_sap_con) as conn:<br/>        print(f'{time.ctime()}, SAP connection stablished')<br/>        # for each iteration<br/>        for i in range(iter_qty):<br/>            # define the first and last row for this execution<br/>            f_r = i*c.rows_per_exec<br/>            l_r = min((i+1)*c.rows_per_exec, rows_qty)<br/>            # define an auxiliar dataframe with only the rows of this iteration<br/>            df_aux = df.iloc[f_r:l_r]<br/>            print(f'{time.ctime()}, Rows defined')<br/>            # convert this dataframe to a json format, oriented by records<br/>            # this is the needed format to do a multirow input with a RFC<br/>            # by last all the json data must be inside of a list<br/>            lst_dicts_rows = eval(df_aux.to_json(orient='records'))<br/>            # once we have the desired rows well formatted we must tell for<br/>            # which table we are going to insert it<br/>            dict_insert = {rfc_table: lst_dicts_rows}<br/>            print(f'{time.ctime()}, RFC input format applied')<br/>            print(f'{time.ctime()}, Start sending rows {f_r} to {l_r-1}')<br/>            # with everything set just call the RFC by its name <br/>            # and pass the connection dict<br/>            try:<br/>                result = conn.call(func_name, **dict_insert)<br/>                exec_ind = True<br/>            except:<br/>                result = None<br/>                exec_ind = False<br/>            print(f'{time.ctime()}, Rows {f_r} to {l_r-1} sent')<br/>            # save the row's numbers, execution indicator and the result of the call in the list<br/>            # as a dict<br/>            lst_res.append({'row':f'{f_r}_{l_r-1}', 'exec_ind':exec_ind, 'rfc_result':result})<br/>    # how the whole command is inside the 'with' when it ends the connection with SAP is closed<br/>    print(f'{time.ctime()}, SAP connection closed')<br/>    print(f'{time.ctime()}, End data ingestion to SAP process')<br/>    return lst_res</span></pre><p id="36c6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">长话短说，这段代码获取 constants.py 中定义的每次执行的行数，并计算将数据框完全插入 SAP 的迭代次数。</p><p id="4ef6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">之后，它会将您的数据框分割成多个片段，将它们转换成一个面向记录格式的. json 文件，并将其全部放入一个列表中，最后，它会存储在一个字典中，该字典的关键字是 RFC 表名。</p><p id="4433" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种来来去去可能有点混乱，但是它创建了一个字典，允许我们一次向 SAP 表中插入多行。</p><p id="c818" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，如果一切都设置好了，您将得到如下结果:</p><figure class="ns nt nu nv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pa"><img src="../Images/703f6ccde91fe8a63ea6438553e56cc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3kF2x0xizdCyrPOV5Y8_mQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作家</p></figure><p id="5b6a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你对这些文件感兴趣，你可以通过下面的链接在我的<strong class="la jk"> Git Hub </strong>中看到它们:</p><div class="is it gp gr iu pb"><a href="https://github.com/rfpcordeiro/python-sap-rfc-connection" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd jk gy z fp pg fr fs ph fu fw ji bi translated">rfpcordeiro/python-sap-RFC-connection</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">使用远程函数调用(RFC)更容易地使用 PyRFC 将数据插入 SAP 的函数 GitHub 是 over…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">github.com</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp ja pb"/></div></div></a></div><p id="1df0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您正在考虑在一个必须定期重复的过程中使用 PyRFC，也许下面的这篇文章可以帮助您安排它。</p><div class="is it gp gr iu pb"><a href="https://medium.com/better-programming/automate-and-schedule-your-python-code-executions-22c3ed27794e" rel="noopener follow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd jk gy z fp pg fr fs ph fu fw ji bi translated">自动化并安排 Python 代码的执行</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">让您的代码按照您的计划工作</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">medium.com</p></div></div><div class="pk l"><div class="pq l pm pn po pk pp ja pb"/></div></div></a></div><h1 id="7658" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">这就是了！</h1><p id="b44c" class="pw-post-body-paragraph ky kz jj la b lb my kk ld le mz kn lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">嗯，有了这个，我想你现在可以使用 Python 和 RFC 更轻松地将数据插入 SAP 了！</p><p id="afde" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">希望这篇文章对你有帮助！</p><blockquote class="or os ot"><p id="7bc0" class="ky kz ou la b lb lc kk ld le lf kn lg ov li lj lk ow lm ln lo ox lq lr ls lt im bi translated">特别感谢莱昂纳多·拉莫斯和安德森·泰西托利，当我和他们一起解决了一百万个 RFC 问题的时候，他们忍受了我</p></blockquote><h1 id="5d1e" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">来源:</h1><p id="2f18" class="pw-post-body-paragraph ky kz jj la b lb my kk ld le mz kn lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated"><a class="ae jg" href="https://kb.informatica.com/h2l/HowTo%20Library/1/0953-HowtoDownloadandInstallSAPNetWeaverRFCSDKlibraries-H2L.pdf" rel="noopener ugc nofollow" target="_blank">https://kb . informatica . com/h2l/how to % 20 library/1/0953-howtodownloadandstallsapnetweaverrfcsdklibraries-h2l . pdf</a></p><p id="bfef" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae jg" href="https://python.hotexamples.com/examples/pyrfc/Connection/call/python-connection-call-method-examples.html" rel="noopener ugc nofollow" target="_blank">https://python . hotexamples . com/examples/pyrfc/Connection/call/python-Connection-call-method-examples . html</a></p><p id="7036" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae jg" href="https://sap.github.io/PyRFC/client.html#examples" rel="noopener ugc nofollow" target="_blank">https://sap.github.io/PyRFC/client.html#examples</a></p><p id="7dfe" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae jg" href="https://sap.github.io/PyRFC/install.html#sap-nw-rfc-sdk-installation" rel="noopener ugc nofollow" target="_blank">https://sap . github . io/py RFC/install . html # sap-NW-RFC-SDK-installation</a></p></div></div>    
</body>
</html>