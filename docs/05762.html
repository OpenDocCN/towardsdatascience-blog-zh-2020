<html>
<head>
<title>Create an Ordered JSONObject in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Java创建一个有序的JSONObject</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-an-ordered-jsonobject-in-java-fb9629247d76?source=collection_archive---------9-----------------------#2020-05-13">https://towardsdatascience.com/create-an-ordered-jsonobject-in-java-fb9629247d76?source=collection_archive---------9-----------------------#2020-05-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="edc7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为什么创建有序JSONObject这么复杂？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bd7b965b8b6033c7e982d38d2b493f2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OMWww1whrSeldlQHHKi3xg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">米歇尔·亨德森在Unsplash上的照片</p></figure><p id="961c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Java中使用JSONObject时，您可能会注意到，当您打印出对象时，顺序并不完全是您所期望的。</p><p id="ae33" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们要做的就是把它改成订购的，对吗？</p><p id="1e3b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">嗯，事情比这要复杂一点，幸运的是，我已经找到了这个常见问题的迷人解决方案。</p><p id="394c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，我们进入幕后，操纵底层的数据结构，使之成为我们所需要的。</p><p id="cba9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将首先解释这个问题，然后给你提供一个解决方案。然后，我们将讨论您处理此问题的其他方式。</p><p id="7017" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们开始吧！</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="90de" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">问题是</h1><p id="90ec" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">JSONObject的底层数据结构是HashMap。为什么？HashMap允许快速检索键值对，使它们成为JSON对象的完美数据结构。</p><p id="59cb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，正如我们在数据结构和算法课程中所记得的，默认情况下，HashMaps是无序的，这意味着您的数据是随机分布在内存中的。</p><p id="2419" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这意味着，如果我们想在日志、浏览器或电子邮件中打印JSONObject，顺序可能会显得不规则。</p><p id="9872" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里有一个例子，我们用四个元素创建了一个JSONObject。请注意我们向JSONObject添加对象的顺序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="1dac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在看看这些对象在我们的日志中是如何显示的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/0deb31b0f2fd2fe0cbdc94e588730e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*tb1IHrIse2r-GalFQX9R4w.png"/></div></figure><p id="6ce9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">顺序应该是“一”、“二”、“三”、“四”。</p><p id="c723" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们以特定的顺序期待我们的结果，这是不好的。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="83f5" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">解决方案</h1><p id="2315" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">有几种方法可以处理这个问题，但是我将挖掘一个我非常感兴趣的解决方案。</p><p id="fd2f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将利用我以前只在单元测试中使用过的API:反射。</p><p id="7cf7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">反射是一个运行时API，用于修改方法、接口和类的行为。这是一个很好的工具，我们可以用它来改变“幕后”的代码。</p><p id="5ffc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你看一下<code class="fe nb nc nd ne b">JSONObject.class</code>，你会看到这个构造函数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/540019fc18c7ca9f9bb628149cb1e28c.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*iaHRGmGpD5W4hrTUO8VdSA.png"/></div></figure><p id="7aa3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是创建JSONObject的默认构造函数。我们必须将底层数据结构(HashMap)改为有序的。对此的完美解决方案是LinkedHashMap。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="fd1e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们一行一行地检查这段代码:</p><ul class=""><li id="7210" class="ng nh it la b lb lc le lf lh ni ll nj lp nk lt nl nm nn no bi translated">第14行:我们仍然在创建之前使用过的JSONObject。</li><li id="a3e7" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated">第15行:我们需要处理这些方法抛出的异常(<code class="fe nb nc nd ne b">IllegalAccessException </code>和<code class="fe nb nc nd ne b">NoSuchFieldException</code>)。因此，我们使用一个try-catch块。</li><li id="efcf" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated">第16行:Field是我前面提到的反射API中的一个类。这有助于我们访问JSONObject类中声明的“map”字段。我们创造了一个“反射物体”</li><li id="f9de" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated">第17行:在上面JSONObject.class的截图中你可能已经注意到了，<code class="fe nb nc nd ne b">nameValuePairs</code>变量是私有的。我们需要让它变得容易接近。</li><li id="fb56" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated">第18行:既然变量是可访问的，我们可以将<code class="fe nb nc nd ne b">HashMap&lt;&gt;()</code>改为<code class="fe nb nc nd ne b">LinkedHashMap&lt;&gt;()</code>。</li><li id="7f27" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated">第19行:出于安全考虑，我们将把该变量的可访问性设置回false。</li></ul><p id="202d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将这个JSONObject记录到控制台后，您会看到输出现在是有序的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/c18b1c60860392a8e4ddcbdd712c1c13.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*GRT24QqH0zpJq3oIgeeptw.png"/></div></div></figure><p id="35ea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">大获成功！</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="ed40" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">替代解决方案</h1><p id="cb5f" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">这肯定不是解决这个问题的唯一办法。这只是我感兴趣的一个解决方案，并且被证明是有效的。</p><p id="bdbf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还有其他库可以用来构建JSON对象，它们很可能提供对有序JSON的支持；然而，这是我使用<code class="fe nb nc nd ne b">org.json.JSONObject</code>的一个要求，所以我决定为这个JSON对象找到一个解决方案。</p><p id="490c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">JSONArrays可能会提供您正在寻找的解决方案，因为订单遵循一个索引。</p><p id="f38e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一个可能的解决方案是实现您自己的JSONObject。您可以使用LinkedHashMap &lt;&gt;()或其他有序的数据结构，而不是使用HashMap &lt;&gt;()来实现。</p><p id="f1a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如何解决这个问题的机会是无限的，但是使用反射API是一个很棒的选择。</p><p id="68af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您有任何问题、意见或顾虑，请告诉我！</p></div></div>    
</body>
</html>