<html>
<head>
<title>Scraping weather data using Python to get umbrella reminder on email</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python抓取天气数据以在电子邮件中获得雨伞提醒</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scraping-weather-data-using-python-to-get-umbrella-reminder-on-email-8d00c7827c71?source=collection_archive---------53-----------------------#2020-05-31">https://towardsdatascience.com/scraping-weather-data-using-python-to-get-umbrella-reminder-on-email-8d00c7827c71?source=collection_archive---------53-----------------------#2020-05-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4369" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Python获得自动“雨伞提醒”电子邮件</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0c06e787dd13043efcbe34a7b9f6edf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ipk6Xeowueq40fBcdf72vA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://unsplash.com/@cgower" rel="noopener ugc nofollow" target="_blank">克里斯多佛·高尔</a>——<a class="ae kv" href="https://unsplash.com/photos/m_HRfLhgABo" rel="noopener ugc nofollow" target="_blank">Unsplash</a></p></figure><p id="bf27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Python在脚本编写、自动化、web抓取、数据分析等方面创造了奇迹，这样的例子不胜枚举。在本文中，我混合了web脚本和自动化——因此，如果城市的天气是阴雨天，Python脚本将发送一封“雨伞提醒”电子邮件。</p><p id="13c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">库导入</strong></p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="548c" class="lx ly iq lt b gy lz ma l mb mc">from bs4 import BeautifulSoup<br/>import smtplib<br/>import requests as rq</span></pre><p id="6e4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“美丽的汤”用于从网站、Html和XML页面中提取数据。“Requests”库用于发送HTTP请求，而“smtplib”用于向任何机器发送电子邮件。</p><p id="9f39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">获取天气数据</strong></p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="d5ad" class="lx ly iq lt b gy lz ma l mb mc">url = rq.get('https://forecast.weather.gov/MapClick.php?lat=40.71455000000003&amp;lon=-74.00713999999994')<br/><br/>soup = BeautifulSoup(url.text, 'html.parser')<br/><br/>weather = (soup.select('#current_conditions-summary p')[0]).text<br/>temperature = (soup.select('#current_conditions-summary p')[1]).text</span></pre><p id="3887" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我使用过<a class="ae kv" href="https://forecast.weather.gov/" rel="noopener ugc nofollow" target="_blank">国家气象局</a>网站搜集纽约的天气数据。requests.get()函数接受要下载的URL字符串。BeautifulSoup()函数需要用一个包含它将解析的HTML的字符串来调用。</p><p id="25ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，BeautifulSoup对象已经创建，您可以使用一个<em class="md"> "select" </em>方法从web页面中检索天气和温度的web元素。</p><p id="83cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">构建smtplib对象</strong></p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="ba69" class="lx ly iq lt b gy lz ma l mb mc">server = smtplib.SMTP('smtp.gmail.com', 587)<br/>print(server.ehlo())<br/>print(server.starttls())<br/><br/>server.login('Enter your email', 'Password')</span></pre><p id="a63a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我创建了一个带有参数“smtp.gmail.com”和587的SMTP对象。创建SMTP对象后，您可以使用您的电子邮件地址和密码登录。</p><blockquote class="me mf mg"><p id="2940" class="kw kx md ky b kz la jr lb lc ld ju le mh lg lh li mi lk ll lm mj lo lp lq lr ij bi translated">注意:smtplib中的参数可能会更改。SMTP()取决于域的SMTP服务器。如果您有Gmail帐户，您必须为您的电子邮件地址生成特定于应用程序的密码。否则，当您的程序试图登录时，您将得到一个特定于应用程序的需要密码的错误消息。</p></blockquote><p id="3311" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以使用本<a class="ae kv" href="https://support.google.com/accounts/answer/185833?hl=en" rel="noopener ugc nofollow" target="_blank">指南</a>创建您的Gmail应用程序专用密码</p><p id="0637" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">发送电子邮件</strong></p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="0ccc" class="lx ly iq lt b gy lz ma l mb mc">if weather == 'Raining' or weather == 'Overcast' :<br/><br/>    subject = "Umbrella Reminder"<br/>    body = f"Take an umbrella with you. Weather condition for today is {weather} and temperature is {temperature} in New York."<br/><br/>    msg = f"Subject:{subject}\n\n{body}\n\nRegards,\nVishal".encode('utf-8')<br/>    print(msg)<br/><br/>    server.sendmail('Sender's Email', 'Recipient Email', msg)<br/><br/>    print("Email Sent!")<br/><br/>    server.quit()<br/>else :<br/>    print("There is going to be {} and temperature is {} in New York".format(weather, temperature))</span></pre><p id="c578" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果来自web元素的天气结果是下雨或阴天，发件人将向收件人发送一封带有“雨伞提醒”消息的电子邮件。</p><p id="0fae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是你如何使用Python从一小步开始并自动化你生活中的小事情。开始您的脚本之旅。</p><p id="edf1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请联系我，在<a class="ae kv" href="https://www.linkedin.com/in/vishal-sharma-239965140/" rel="noopener ugc nofollow" target="_blank">维沙尔·夏尔马</a>寻求反馈或讨论！</p></div></div>    
</body>
</html>