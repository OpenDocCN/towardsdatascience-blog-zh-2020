<html>
<head>
<title>Handling Missing Values with Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用熊猫处理缺失值</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/handling-missing-values-with-pandas-b876bf6f008f?source=collection_archive---------2-----------------------#2020-02-12">https://towardsdatascience.com/handling-missing-values-with-pandas-b876bf6f008f?source=collection_archive---------2-----------------------#2020-02-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e7ab" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于如何检测和处理缺失值的完整教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/c930edf598482aba12bef914720990d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*MEtcAekhpIV7WkujwcCKJw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">由<a class="ae ku" href="https://unsplash.com/s/photos/pandas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ku" href="https://unsplash.com/@chuttersnap?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> chuttersnap </a>拍摄</p></figure><p id="1728" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">数据科学项目中最耗时的部分是数据清理和准备。然而，有许多强有力的工具可以加速这个过程。其中之一是Pandas，它是一个广泛使用的Python数据分析库。</p><p id="67df" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">处理缺失值是数据清理和准备过程中必不可少的一部分，因为现实生活中几乎所有的数据都带有一些缺失值。在这篇文章中，我将解释如何使用Pandas来检测丢失的值并以一种正确有效的方式处理它们。</p><p id="4e25" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们先创建一个缺少值的数据帧。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/8ca104615a051722eee0c332f9528b4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*wOMjQyjGmR45wrfVSfOaBQ.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/baa35198fba21bceeb7e494ab3951fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*9f8Ei_tU0Cf68GQqgvrkOg.png"/></div></figure><p id="29bb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">np.nan、None和NaT(对于datetime64[ns]类型)是熊猫的标准缺失值。</p><p id="5826" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">注意:</strong>Pandas 1.0中引入了一种新的缺失数据类型(&lt; NA &gt;)，它是一种整数类型的缺失值表示。</p><p id="f6f7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">np.nan是浮点型的，所以如果你在一列整数中使用它们，它们将被转换成浮点数据类型，正如你在我们创建的dataframe的“column_a”中看到的。但是，<na>可以和整数一起使用，不会导致向上转换。让我们使用<na>向dataframe再添加一列，可以通过显式请求dtype Int64Dtype()来使用它。</na></na></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/97d1835345a58e623f3a17d2075a1d93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*wJU8R0xcCn8TfNVtaD43Iw.png"/></div></figure><h1 id="6790" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">查找缺失值</strong></h1><p id="f894" class="pw-post-body-paragraph kv kw it kx b ky mm ju la lb mn jx ld le mo lg lh li mp lk ll lm mq lo lp lq im bi translated">Pandas提供了<strong class="kx iu"> isnull() </strong>，<strong class="kx iu"> isna() </strong>函数来检测缺失值。他们俩做着同样的事情。</p><p id="67f6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu"> df.isna() </strong>返回带有布尔值的dataframe，该值表示缺少的值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/36ac1778eaf1e99dc8ebb3f5e7901588.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*R87i76nNpu1BNs0hCZ3LYA.png"/></div></figure><p id="7c83" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">也可以选择使用与isna()正好相反的<strong class="kx iu"> notna() </strong>。</p><p id="164c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu"> df.isna()。any() </strong>为每一列返回一个布尔值。如果该列中至少有一个值缺失，则结果为真。</p><p id="8ef7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu"> df.isna()。sum() </strong>返回每列中缺失值的数量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/2b67884c6cb4cb572b7122881871ba27.png" data-original-src="https://miro.medium.com/v2/resize:fit:304/format:webp/1*qz1glLAySiY1LX3WD1eYXA.png"/></div></figure><h1 id="090f" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">处理缺失值</h1><p id="2b23" class="pw-post-body-paragraph kv kw it kx b ky mm ju la lb mn jx ld le mo lg lh li mp lk ll lm mq lo lp lq im bi translated">并非所有缺失的值都是简洁明了的np.nan或None格式。比如，“？”数据帧c列中的“---”字符没有给我们任何有价值的信息或见解，因此本质上它们是缺失值。但是，这些字符无法被熊猫检测为缺失值。</p><p id="3e8d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果我们知道哪种字符用作数据集中的缺失值，我们可以在使用<strong class="kx iu"> na_values </strong>参数创建数据帧时处理它们:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mt"><img src="../Images/f429f231a0790e576b28b3072dc78585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*h4QvH2I2CDQCpKHJcDWMVQ.png"/></div></div></figure><p id="3cc1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">另一种选择是在创建数据帧后使用pandas <strong class="kx iu"> replace() </strong>函数来处理这些值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/c27546dcbd51fd534a72e5688e7a9681.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*7yhEfyaYt46FWuF3ov_9Zw.png"/></div></figure><p id="7109" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们已经用NaN值替换了非信息单元格。<strong class="kx iu">就地</strong>参数保存数据帧中的变化。inplace的默认值为False，因此如果将其设置为True，将不会保存更改。</p><p id="128b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">没有处理缺失值的最佳方法。根据数据集和任务的特征，我们可以选择:</p><ul class=""><li id="cf33" class="mz na it kx b ky kz lb lc le nb li nc lm nd lq ne nf ng nh bi translated">删除缺少的值</li><li id="d3cb" class="mz na it kx b ky ni lb nj le nk li nl lm nm lq ne nf ng nh bi translated">替换丢失的值</li></ul><h2 id="4fc3" class="nn lv it bd lw no np dn ma nq nr dp me le ns nt mg li nu nv mi lm nw nx mk ny bi translated">删除缺少的值</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/30c3fac4ab952283381df42df47b3405.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*muS6jTVlkpVt9mgAgp4F3A.png"/></div></figure><p id="5366" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们可以使用<strong class="kx iu"> dropna() </strong>函数删除带有缺失值的行或列。<strong class="kx iu">如何用</strong>参数设置条件下降。</p><ul class=""><li id="fd41" class="mz na it kx b ky kz lb lc le nb li nc lm nd lq ne nf ng nh bi translated">how='any ':如果有任何缺少的值，则删除</li><li id="d7a2" class="mz na it kx b ky ni lb nj le nk li nl lm nm lq ne nf ng nh bi translated">how='all ':如果所有值都丢失，则删除</li></ul><p id="6af7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">此外，使用<strong class="kx iu"> thresh </strong>参数，我们可以根据非缺失值的数量设置一个阈值，以便删除一行/一列。</p><p id="2127" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">thresh参数要求一行或一列至少要有指定数量的非缺失值才能不被删除。例如，如果我们将thresh参数的值设置为3，则一列或一行必须至少有3个非缺失值才不会被删除。没有3个或更多非缺失值的行或列(取决于轴参数的值)将被删除。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/406a90793f0fde08220ed2ebfe3c77f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*8JcQbPb86ZNIzeeUgWva2w.png"/></div></figure><p id="3a8a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">轴</strong>参数用于选择行(0)或列(1)。</p><p id="3983" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们的dataframe没有一行充满缺失值，因此设置how='all '不会删除任何行。缺省值是' any '，所以如果我们想使用how='any '，就不需要指定它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/bfd820a30d4b23e345a7bc7901535589.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*IQ3h_l56h5U-94Mf9gsFwA.png"/></div></figure><p id="bce3" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">至少有一个值缺失的行已被删除。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/f7880b604b5a5269a2c6f25d757566e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*DA9QSE38vhBPGuGKdWeWwA.png"/></div></figure><p id="a24c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">将thresh参数设置为至少有3个非缺失值的3个已删除行。</p><p id="9096" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">数据是宝贵的资产，所以我们不应该轻易放弃它。此外，机器学习模型几乎总是倾向于在更多数据的情况下表现更好。因此，根据具体情况，我们可能更喜欢替换丢失的值，而不是丢弃。</p><p id="930c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">替换缺失值</strong></p><p id="480c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu"> fillna() </strong>熊猫的功能方便处理缺失值。使用fillna()，缺失值可以由特殊值或聚合值(如平均值、中值)替换。此外，缺失的值可以用它之前或之后的值替换，这对时间序列数据集非常有用。</p><ul class=""><li id="b518" class="mz na it kx b ky kz lb lc le nb li nc lm nd lq ne nf ng nh bi translated">用标量替换丢失的值:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/42b3211b7c977849253a1a433f8adca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*U_Jw7wfYDbN4U8Iu7njSsQ.png"/></div></figure><ul class=""><li id="510b" class="mz na it kx b ky kz lb lc le nb li nc lm nd lq ne nf ng nh bi translated">fillna()也可以用于特定的列:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/7fd62bfec7e1df1bd54c13198e62863d.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*WSbjzUrGt3fvgbMFOjB4og.png"/></div></figure><ul class=""><li id="3f42" class="mz na it kx b ky kz lb lc le nb li nc lm nd lq ne nf ng nh bi translated">使用<strong class="kx iu">方法</strong>参数，缺失的值可以用它们之前或之后的值替换。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/a32f9d976e510ad74348281129b78bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*2WKBQ_Nr3YcrGKQ5si5mYA.png"/></div></figure><p id="f35d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu"> ffill </strong>代表“向前填充”用前一行的值替换缺失的值。您也可以选择<strong class="kx iu"> bfill </strong>代表“反向填充”。</p><p id="3be6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果一列或一行中有许多连续的缺失值，您可能希望<strong class="kx iu">限制</strong>向前或向后填充的缺失值的数量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/56e943e8321f322730b39e323ff3de29.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*1ZdUVVXfVJR2olroxFEwvg.png"/></div></figure><p id="e43e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">极限参数设置为1，因此只有一个缺失值被向前填充。</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="d6f2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p><h1 id="7305" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">我的其他帖子</h1><ul class=""><li id="1270" class="mz na it kx b ky mm lb mn le on li oo lm op lq ne nf ng nh bi translated"><a class="ae ku" rel="noopener" target="_blank" href="/support-vector-machine-explained-8d75fe8738fd">支持向量机—解释</a></li><li id="033a" class="mz na it kx b ky ni lb nj le nk li nl lm nm lq ne nf ng nh bi translated"><a class="ae ku" rel="noopener" target="_blank" href="/decision-tree-and-random-forest-explained-8d20ddabc9dd">决策树和随机森林——解释</a></li><li id="3f44" class="mz na it kx b ky ni lb nj le nk li nl lm nm lq ne nf ng nh bi translated"><a class="ae ku" rel="noopener" target="_blank" href="/predicting-used-car-prices-with-machine-learning-fea53811b1ab">用机器学习预测二手车价格</a></li><li id="a745" class="mz na it kx b ky ni lb nj le nk li nl lm nm lq ne nf ng nh bi translated"><a class="ae ku" rel="noopener" target="_blank" href="/data-cleaning-and-analysis-with-a-bonus-story-36b3ae39564c">数据清理和分析，附带一个奖励故事</a></li></ul></div></div>    
</body>
</html>