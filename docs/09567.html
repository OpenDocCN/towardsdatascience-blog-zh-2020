<html>
<head>
<title>Data Visualisation of Bollywood: Pt. 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">宝莱坞的数据可视化。一</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-visualisation-of-bollywood-365fd57ff1d3?source=collection_archive---------64-----------------------#2020-07-07">https://towardsdatascience.com/data-visualisation-of-bollywood-365fd57ff1d3?source=collection_archive---------64-----------------------#2020-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="aa99" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">角。1～网页抓取</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b5d55473e069a50ce4816828df9e93b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ft0pBHiZ9_a4z08l"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">布莱恩·麦高恩在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c191" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你曾经有机会和印度人谈论电影，你一定已经意识到宝莱坞在他们的生活中扮演了多么重要的角色。代表我所有的同胞，我们就是离不开他们~无论是对着<em class="ls"> 3 个白痴、</em>笑，还是过着<em class="ls"> Zindagi Na Milengi Dobara </em>(我个人一直最喜欢的)的常青时光，还是跟着<em class="ls">沙鲁克·汗</em>到<em class="ls">chamk Challo 一起跳舞！</em></p><p id="ecd0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个小项目的灵感来自于我对宝莱坞的热爱。由于这是一个巨大的产业，我想比较一下有史以来票房最高的电影。</p><p id="3187" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我会把这个项目分成几个部分，这样更容易理解。这篇文章将围绕如何使用 Python 中的<strong class="ky ir"> BeautifulSoup 收集数据展开。</strong></p><h2 id="3dae" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">1.网络抓取简介，美丽的群组和请求</h2><h2 id="a422" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">网页抓取</h2><p id="6244" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">手动收集数据是一个乏味且耗时的过程，这时网络搜集就派上了用场。这是一种用于从网站自动检索信息的技术，几乎不费吹灰之力。</p><blockquote class="mr ms mt"><p id="dd98" class="kw kx ls ky b kz la jr lb lc ld ju le mu lg lh li mv lk ll lm mw lo lp lq lr ij bi translated">这是一种复制形式，从网络上收集并复制特定数据，通常复制到中央本地数据库或电子表格中，供以后检索或分析。——<a class="ae kv" href="https://en.wikipedia.org/wiki/Web_scraping#cite_note-Boeing2016JPER-1" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></blockquote><h2 id="78e7" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">美丽的声音</h2><p id="1939" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">BeautifulSoup 是一个 Python 库，有助于网络抓取。它位于 HTML 或 XML 解析器之上，为迭代、搜索和修改解析树提供 Pythonic 式的习惯用法。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/7f3eb6464ecd80893ea5ac917e418f44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rRHLAipggIos8dJB"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@kmuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡洛斯·穆扎</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="30ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了成功地使用 BeautifulSoup，必须了解 HTML 代码的基础知识，以便从页面中收集正确的信息。</p><p id="b785" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当打开一个页面时，例如这个<a class="ae kv" href="https://en.wikipedia.org/wiki/List_of_highest-grossing_Indian_films" rel="noopener ugc nofollow" target="_blank">维基百科页面，</a>可以通过右击页面，然后转到“inspect”来访问 HTML 代码。对于初学者来说，那里的代码量肯定是巨大的，所以要快速找到具体的数据，必须突出显示表中的一个文本，右键单击它，然后转到“inspect”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/4571c888e7a85ac8897b3a580bf9290c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0obfMUgkyR7kWVrbNzboQ.png"/></div></div></figure><p id="98f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个元素都有一个特定的标签和类。</p><ul class=""><li id="ea11" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ne nf ng nh bi translated"><table>表示整个表格，如下面的截图所示。它给出了一个“类”,从这个类中可以识别表。该表的各个组件都在此标签下。</table></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/fa3db14939171c5c4328405bb10b117d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5K7eeru4vopKtmzddR3BiQ.png"/></div></div></figure><ul class=""><li id="2e75" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ne nf ng nh bi translated">接下来是<thead>标签，用来表示表格的表头。</thead></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/9023b15de6b333d6e8c7a7c5e9f0aacb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gClpRf_560ZnQeDReNEFjg.png"/></div></div></figure><ul class=""><li id="f3d8" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ne nf ng nh bi translated"><tbody>标识表格的所有行。</tbody></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/5f15462ac3378093256184e8ce9fd331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S2kV_lCH659kL40nce1Jog.png"/></div></div></figure><ul class=""><li id="0718" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ne nf ng nh bi translated"><tr>标识单个行。</tr></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/18ac5570a9c6741f8af492f9beef21b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uO1mSJp8glyuKdOZLuBt7A.png"/></div></div></figure><ul class=""><li id="e50d" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ne nf ng nh bi translated"><td>代表一行中的每个单独的单元格。</td></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/a23eb969a98569c6a2ce16d81af31fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RrjURIvTUinLWNX5fQsSsw.png"/></div></div></figure></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="1028" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始刮吧！</p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><h2 id="a84b" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">2.入门指南</h2><p id="cb01" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">为了下载页面以执行 web 抓取，必须安装 R <em class="ls"> equests </em>包。它不仅允许用户下载页面内容，还允许用户发送 HTTP 请求。</p><p id="d502" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可以使用终端中的 pip 命令来安装。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="0b41" class="lt lu iq ns b gy nw nx l ny nz">pip install requests<br/>pip install beautifulsoup4</span></pre><h2 id="a309" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">3.导入库</h2><p id="3685" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">对于这一部分，这是收集数据所需的 4 个库。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="f18a" class="lt lu iq ns b gy nw nx l ny nz">import pandas as pd<br/>import numpy as np<br/>import requests<br/>from bs4 import BeautifulSoup</span></pre><ol class=""><li id="3c3a" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr oa nf ng nh bi translated"><strong class="ky ir"> Pandas: </strong>用于将数据转换成结构化的形式(表格)。</li><li id="cf28" class="mz na iq ky b kz ob lc oc lf od lj oe ln of lr oa nf ng nh bi translated"><strong class="ky ir"> Numpy: </strong>一个流行的库，允许用户简单快速地执行数组操作。</li><li id="0060" class="mz na iq ky b kz ob lc oc lf od lj oe ln of lr oa nf ng nh bi translated"><strong class="ky ir"> BeautifulSoup: </strong>检索页面的 HTML 结构。</li></ol><h2 id="3ab4" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">4.启动代码</h2><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="f8d7" class="lt lu iq ns b gy nw nx l ny nz">website='<a class="ae kv" href="https://en.wikipedia.org/wiki/List_of_highest-grossing_Indian_films'" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/List_of_highest-grossing_Indian_films'</a><br/>website_url=requests.get(website).text<br/>soup=BeautifulSoup(website_url,'html.parser')</span></pre><p id="ed4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码定义了从中检索数据的网站，并调用 soup 函数来下载数据。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="01d3" class="lt lu iq ns b gy nw nx l ny nz">s = requests.Session() <br/>response = s.get(website, timeout=10) <br/>response</span></pre><p id="8fde" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这段代码确保页面的下载已经完成。您应该得到输出为<response>，这意味着它是完整的。</response></p><h2 id="b7d5" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">5.阅读表格</h2><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="b437" class="lt lu iq ns b gy nw nx l ny nz">my_table = soup.find('table', {"class":'wikitable sortable'})</span></pre><p id="1ccd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Soup.find 函数用于通过定义标签和类来查找页面中的特定元素。正如我上面所说的，页面中的表有“table”标记，所以如果整个页面中只有一个表，就没有必要指定它的类。在这种情况下，有多个表，我只想要其中的一个。当鼠标悬停在表上方时，可以看到我想要的表具有类‘wiki table sortable ’,所以我指定了它。</p><p id="f643" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您运行 print(my_table)函数时，您会看到它打印出标签内的所有内容(在 HTML 代码中从<table>到</table>)，这非常难以阅读。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/bc324de4dba42c227a5d26a041440491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*yhdHuScqU8_oG9OzSSMKSg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">如果你想知道，这就是结果的样子。这幅图只是整个结果的一小部分。</p></figure><p id="a578" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您担心是否检索到了正确的表，此代码可用于确认。它打印出列标题和列数。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="a69b" class="lt lu iq ns b gy nw nx l ny nz">header = [th.text.rstrip() for th in rows[0].find_all('th')]<br/>print(header)<br/>print('------------')<br/>print(len(header))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/d8cac2963b40be430366d368ce985796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UhVCfH5dJj8tRwpwyMfADA.png"/></div></div></figure><p id="15ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了收集每行中的信息，下面的代码是</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="4ba9" class="lt lu iq ns b gy nw nx l ny nz">my_table_data = []<br/>for row in rows[1:]:<br/>            data = [d.text.rstrip() for d in row.select('td')]<br/>            my_table_data.append(data)</span></pre><p id="41fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然数据已经收集完毕，就可以使用 pandas 将它们组成一个数据框。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="3044" class="lt lu iq ns b gy nw nx l ny nz">df = pd.DataFrame(my_table_data)</span></pre><p id="56f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打印出来后，应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/b1bc8d8010b13719fb856f62f06d49eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*186uikCmgmCKNRF8g_ts8Q.png"/></div></div></figure><p id="befe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">耶！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj nq l"/></div></figure><p id="b3ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不过任务还没有结束…在我们保存它之前，最好根据我们的喜好重命名和清理数据。</p><h2 id="bd75" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">6.清洁和保存</h2><p id="f430" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">我使用这段代码重命名了列名并删除了不需要的信息。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="905c" class="lt lu iq ns b gy nw nx l ny nz">df.rename(columns = {0:"Rank"}, inplace = True)<br/>df.rename(columns = {1:"Peak"}, inplace = True)<br/>df.rename(columns = {2:"Film"}, inplace = True)<br/>df.rename(columns = {3:"Year"}, inplace = True)<br/>df.rename(columns = {4:"Director"}, inplace = True)<br/>df.rename(columns = {5:"Producer"}, inplace = True)<br/>df.rename(columns = {6:"Language"}, inplace = True)<br/>df.rename(columns = {7:"Worldwide_Gross_INR"}, inplace = True)<br/>df = df.drop(columns=[8])</span><span id="8cec" class="lt lu iq ns b gy ok nx l ny nz">df.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/82547af9082cc719b7e18387bc3d12d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1SXX25NFf9tIIgUAw7glcw.png"/></div></div></figure><p id="1e82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我对我的数据满意了，我就把它保存到一个 excel 文件中。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="98d2" class="lt lu iq ns b gy nw nx l ny nz">df.to_excel('Bollywood_movies1.xlsx', index=True)</span></pre><p id="366c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧啊。我们刚刚使用网络抓取创建了我们的第一个数据表！</p><p id="a468" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请继续关注我对这个数据集的可视化。:)</p></div></div>    
</body>
</html>