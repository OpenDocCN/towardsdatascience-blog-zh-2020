<html>
<head>
<title>Apache YARN &amp; Zookeeper</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阿帕奇纱线和动物园管理员</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/apache-yarn-zookeeper-61e17a958215?source=collection_archive---------21-----------------------#2020-05-08">https://towardsdatascience.com/apache-yarn-zookeeper-61e17a958215?source=collection_archive---------21-----------------------#2020-05-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3a63" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Hadoop 中的资源分配和高可用性</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f2a3f7fe20c6019e7055855df8d78fb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uay_Vnlcg2muYmy4.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">纱线结构</p></figure><h2 id="55da" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">建筑和工作</h2><p id="a34e" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">YARN 或“又一个资源谈判者”正如它的名字所表示的那样，它为运行一个任务进行资源谈判。</p><p id="c44f" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">YARN 就像任何其他 Hadoop 应用一样，遵循“主-从”架构，其中<em class="mp">资源管理器</em>是主节点，而<em class="mp">节点管理器</em>是从节点。主设备将作业和资源分配给从设备，并监控整个周期。从机接收作业并请求(额外的)资源来完成作业，并实际承担作业的执行。</p><ol class=""><li id="0d9c" class="mq mr iq lt b lu mk lx ml le ms li mt lm mu mj mv mw mx my bi translated">客户机向资源管理器(RM)发送一个作业(大多数情况下是 jar 文件)。</li><li id="7b19" class="mq mr iq lt b lu mz lx na le nb li nc lm nd mj mv mw mx my bi translated">RM 包含两个部分，即调度程序和应用程序管理器(AM)。调度器接收作业请求，并请求 AM 搜索可用的节点管理器(NM)。所选的 NM 产生应用程序主机(App Master)。请注意，RM 调度程序只调度作业。它不能监视或重新启动失败的作业。AM 监控作业的端到端生命周期，如果 NM 出现故障，可以重新分配资源。它还可以在 App Master 中重新启动失败的作业。</li><li id="3ead" class="mq mr iq lt b lu mz lx na le nb li nc lm nd mj mv mw mx my bi translated">App Master 检查容器中为作业提供的资源。该作业现在驻留在 App Master 中。请注意，它将作业的状态传达给 AM。</li><li id="3134" class="mq mr iq lt b lu mz lx na le nb li nc lm nd mj mv mw mx my bi translated">需要注意的是，只有当应用程序管理员提供了容器启动上下文(CLC)证书时，才能使用 Yarn 容器。它就像一把打开容器资源的钥匙。这是纱线的内部。App Master 作业现在在容器中执行。但是，如果提供的资源不够，那么</li><li id="86c1" class="mq mr iq lt b lu mz lx na le nb li nc lm nd mj mv mw mx my bi translated">App Master 创建一个请求列表</li><li id="5aea" class="mq mr iq lt b lu mz lx na le nb li nc lm nd mj mv mw mx my bi translated">该列表直接发送给 RM 调度程序(不通过 NM)。RM 再次向 AM 请求更多的资源。</li><li id="02fb" class="mq mr iq lt b lu mz lx na le nb li nc lm nd mj mv mw mx my bi translated">一个新的容器通过一个新的 NM 启动，没有应用程序主。作业成功执行，资源被释放。</li></ol></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="c638" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">RM 是一个主进程，这是一个单点故障，因此让我们在 GCP 的 Cloudera Manager 设置中为 YARN 的资源管理器添加高可用性。</p><div class="nl nm gp gr nn no"><a href="https://medium.com/@prathamesh.nimkar/yarn-high-availability-enable-disable-59375159c182" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">纱线高可用性—启用/禁用</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">纱线资源管理器高可用性</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc kp no"/></div></div></a></div></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h2 id="fc2c" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">纱线调度器</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/6e53b51454f5ebf2833f1ac23e46da5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*q_gZIzv9is4mG7p-.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">不同类型的纱线调度器</p></figure><p id="848f" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated"><strong class="lt ir">先进先出调度</strong></p><p id="2abc" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">顾名思义，先进先出或 FIFO 是 YARN 中提供的最基本的调度方式。目前(很可能)在 Hadoop 3.x 中停止使用，FIFO 将客户端提交的作业放在队列中，并根据先来先服务的原则按顺序执行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/8c6afd65e555aaee5273eca7d0470b8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pmQsU2Emc6z3DCLl.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">先进先出调度</p></figure><p id="5d07" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">作业 1、2 和 3 具有不同的存储和内存要求。虽然我们可以一起运行多个任务，但在 FIFO 中，它们将按顺序运行。这就是浪费。因此，这种调度方法在生产/共享集群上并不可取，因为它的资源利用率很低。</p><p id="78bd" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">由于 FIFO 是按顺序工作的，所以存在大量未充分利用的资源。现实生活中的一个缺点是，由于其顺序排队，客户/用户不得不进行不必要的等待，因此违反了关键的客户服务级别协议。这导致在一个组织内创建私有集群，其中每个部门都从中央系统(数据湖)断开连接以避免等待。这进一步降低了利用率，并大幅增加了运营成本，而这些成本本来是可以节省下来的。</p><p id="13fc" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">引入了容量调度程序以最大化利用率。</p><p id="c614" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated"><strong class="lt ir">产能调度</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/5784a147a69fc6e09933df310847c8d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PwAU-pOR7LJuobS0.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">产能调度</p></figure><p id="140c" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">中心思想是多个部门资助中央集群或“根”,表示为 100%的可用资源，如上图顶部所示。每个部门或“叶子”都保证有一个特定的能力范围，以便在需要时执行其工作，而无需等待。这可以是百分比或绝对数字。这是层次结构中的第二行，其中，最小值得到保证，最大值受到限制，并根据整个群集中可用的空闲资源进行分配。因此，最小范围在每个层级上总是等于 100%。自然，每片叶子的最大值也不能超过 100%。此外，我们总是将每个叶片的最大值限制在 100%以下。80%似乎是生产中首选的最大值。</p><p id="b42b" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">我们可以通过在层次结构中创建一个新的子级别来隔离叶子，以便更准确地划分资源。这支持详细的容量规划，例如，上图中的“ETL”获得 60%的根资源，即所有资源的 36%作为最低保证。在这一级，最小值加起来也是 100%。最后，如果有 2 个“ETL”作业，优先级基于 FIFO。取决于具体情况的优先级功能是产能调度的一个缺点。</p><p id="de59" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated"><strong class="lt ir">公平调度</strong></p><p id="8d5e" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">您需要理解公平和容量调度是如何工作的，因为公平调度是建立在它的缺点之上的。</p><p id="effa" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">如果单个作业正在运行，公平调度(FS)将会投入所有的资源。如果添加另一个作业，它将确保添加“公平”数量的资源来完成该作业。因此，FIFO 调度问题在这里得到了解决。它基本上防止了新工作缺乏资源。</p><p id="dfc3" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">如果进行了配置，FS 还可以执行容量计划，它会自动在叶/部门级别添加资源。此外，它可以根据可在叶或作业级别添加的“权重”或优先级来确定作业的优先级，从而实现最大的容量利用率。</p><p id="715c" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">中心思想是确保所有的作业都能获得“公平”的资源来成功执行。当有 2 个工作，其中一个是小工作时，尤其如此。即使小作业属于同一个叶/队列/部门，小作业也会获得足够的资源来执行，而不是被搁置，直到大作业完成。这可以被认为是动态资源平衡。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="6d1f" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">最后，您可能还应该在 HDFS 上启用高可用性:</p><div class="nl nm gp gr nn no"><a href="https://medium.com/@prathamesh.nimkar/hdfs-high-availability-enable-disable-41f31b8824f0" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">HDFS 高可用性—启用/禁用</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">HDFS 哈</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div><div class="nx l"><div class="og l nz oa ob nx oc kp no"/></div></div></a></div></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h2 id="9ba7" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">阿帕奇动物园管理员</h2><p id="2d0a" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">动物园管理员是在动物园里管理动物的人。你可能已经注意到，大多数 Hadoop 应用程序图标都以某种方式与动物相关。无论如何，Apache Zookeeper 类似地是一个管理“动物园”(即 Hadoop 生态系统)中的“动物”(即应用程序)的应用程序。</p><h2 id="ece4" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">那么，它到底是做什么的？</h2><p id="555e" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated"><strong class="lt ir">协调</strong></p><p id="f103" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">任何大规模分布式应用的一个痛点是<em class="mp">大规模的协调</em>。例如，如果您有 100 个节点，并且您希望在所有节点中实施配置更改，则必须在所有节点上手动执行。<br/>你能想象在 100 个节点上编写配置更改吗？可行吗？什么事？</p><p id="bb9e" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">那么这个怎么样——雅虎一度有 40，000 个 Hadoop 节点。你能想象为他们所有人写一个配置变更吗？你会做吗？</p><p id="cc59" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">您可能正在考虑编写一段代码，将配置更改部署到所有节点上。虽然这是一个很好的想法，但是也有很多问题，比如对脚本的每一个小的改变都要进行繁琐和频繁的更新/定制，等等。，我们不会深入讨论，但我相信你已经明白了。</p><p id="8cbf" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">这就是 Zookeeper 的用武之地，其中更改/更新可以很容易地应用到所有节点，而不会产生任何开销。它是无缝的，必须在主节点上完成一次，然后自动应用到所有节点。</p><p id="8001" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">Zookeeper 的主要用途不是协调。它保持高可用性。</p><p id="2c4a" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated"><strong class="lt ir">保持高可用性</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/4bbd8a1be7c48dd9ee7a3767d470c242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GseZIJaW6PN88r_Z.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Apache Zookeeper 基本架构</p></figure><p id="dbca" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">它通过一个简单的反馈回路做到这一点。Zookeeper 通过其故障转移控制器来监控领导者和追随者/备用节点。</p><p id="1c9e" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">它接收每个节点当前健康/状态的心跳或即时通知。当一个领导者失败时，Zookeeper 会立即选举一个备用节点作为新的领导者。选举完成后，新领导人向底层应用程序发送消息，应用程序向新领导人“报告”该消息。</p><p id="f948" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">这就把我带到了阿帕奇纱线和动物园管理员的结尾。</p><p id="a1f8" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">有问题吗？不要犹豫地问！</p><p id="94ba" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">参考资料:</p><p id="5182" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">[1]<a class="ae oi" href="https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/YARN.html" rel="noopener ugc nofollow" target="_blank">Apache Hadoop YARN</a>(2019)，Apache Hadoop，ASF</p><p id="9016" class="pw-post-body-paragraph lr ls iq lt b lu mk jr lw lx ml ju lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">[2] <a class="ae oi" href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/ProjectDescription" rel="noopener ugc nofollow" target="_blank">项目描述— Apache Zookeeper </a>，Apache Hadoop，ASF</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><div class="kg kh ki kj gt no"><a href="https://medium.com/@prathamesh.nimkar/cloudera-manager-startup-shutdown-869482034f0" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">GCP 上的 Cloudera Manager 启动/关闭</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">断断续续地</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div></div></a></div><div class="nl nm gp gr nn no"><a href="https://medium.com/@prathamesh.nimkar/big-data-analytics-using-the-hadoop-ecosystem-411d629084d3" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">使用 Hadoop 生态系统的大数据分析渠道</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">登录页面</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div><div class="nx l"><div class="oj l nz oa ob nx oc kp no"/></div></div></a></div></div></div>    
</body>
</html>