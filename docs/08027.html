<html>
<head>
<title>Moving our local Jupyter notebooks to GPU’s on cloud — Deep learning on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将我们本地的 Jupyter 笔记本电脑迁移到云上的 GPU——AWS 上的深度学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/moving-our-local-jupyter-notebooks-to-gpus-on-cloud-deep-learning-on-aws-cab4d8de389f?source=collection_archive---------52-----------------------#2020-06-13">https://towardsdatascience.com/moving-our-local-jupyter-notebooks-to-gpus-on-cloud-deep-learning-on-aws-cab4d8de389f?source=collection_archive---------52-----------------------#2020-06-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3bf7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不再受本地系统资源的限制，将深度学习工作负载迁移到云 GPU</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b8c408bdb192727b4849eceb432c5a82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*89Gojk4tIycJy5A9G2Ih8A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@anarchist?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">齐·米勒</a>在<a class="ae ky" href="/s/photos/gpu?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="f43f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">从 AWS 获取 GPU</h1><p id="2472" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们为深度学习工作负载创建一个 GPU 实例。为此，我们需要一个 AWS EC2 实例。登录<a class="ae ky" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank"> AWS web 控制台</a>，查找<strong class="lt iu"> EC2 服务</strong>，点击<strong class="lt iu">启动实例</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/394b58fa00c815cebb02354def47c926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DkkrUALcjrb0tLDr.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/093748b8ca5ebf7d5609db2ef7e137e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_hK5HzavZx2ov0Yj.png"/></div></div></figure><p id="d51c" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">寻找<strong class="lt iu">深度学习 AMI </strong>的。这些是更好的，因为它们预装了 Python3、Jupyter 和许多其他库。选择可能适合您的实例类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/9c6c2434c1083e3353a2188ae4b52c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bgVVpD0AWdit9kAT.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/2e1e1df32567a6f50f439580bf8654d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8dA498SnVNI7Fvhp.png"/></div></div></figure><h1 id="691f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">安全细节</h1><p id="07c3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Jupyter 笔记本有两种访问方式:</p><ul class=""><li id="4ece" class="mt mu it lt b lu mo lx mp ma mv me mw mi mx mm my mz na nb bi translated"><strong class="lt iu">方法 1 </strong> —隧道到 EC2 实例(推荐)</li><li id="db25" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated"><strong class="lt iu">方法 2 </strong> —暴露 HTTP 和 TCP 端口与 Jupyter 对话</li></ul><p id="93a4" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">对于方法 1，我们只需要安全组中的 SSH 配置。默认情况下，它应该存在，不需要任何更改。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/2e9f30a88fd0ae408d6fa27e9bf39668.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mCy3WbAqKazc9SWq.png"/></div></div></figure><p id="1103" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">不太推荐方法 2，因为它将实例进一步开放给了互联网。然而，这可以通过<strong class="lt iu"> HTTPS 端口 443 和自定义 TCP 端口 8888 来完成。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/d3e8945bc110582244103da6864e5528.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gpEMR6v7_V3hC_MM.png"/></div></div></figure><h1 id="3458" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">密钥对/ pem 文件</h1><p id="e4f5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">另一个需要注意的重要步骤是访问用于创建实例的<strong class="lt iu">密钥对</strong>。如果您没有密钥对，可以在创建时生成一个。如果您决定创建一个密钥，AWS 将为您下载该密钥。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/4de06b41b6a038a13c72d1f4700b94ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hb4CLDmGW0ERm2k3.png"/></div></div></figure><p id="9cae" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><strong class="lt iu">注意:</strong>如果有多个团队成员在这个盒子上工作，那么<strong class="lt iu">通过 Last pass 或其他密码共享服务来共享密钥对(pem)文件</strong>是非常重要的。不要使用电子邮件/ slack 来交换密码/密钥文件。</p><h1 id="7500" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">创建实例</h1><p id="8555" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">以上是所有的配置，<strong class="lt iu">创建实例</strong>。这将需要 2-3 分钟。获取创建的机器的 IP 地址。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/f32d02e0d8a4b8b345bfde00d496b60e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZRHWnPDpksBNqOMa.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/8f3410b1f88b517a01c840e7380c1a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kQ4yj0bYXsgidUKm.png"/></div></div></figure><h1 id="533c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">登录到机器</h1><p id="47cc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们现在可以登录这个盒子-</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="1bf0" class="nm la it ni b gy nn no l np nq"># The downloaded key-pair (pem) file is more permissive. <br/># Fix permissions. <br/># chmod 400 &lt;path to pem file&gt; </span><span id="a4c2" class="nm la it ni b gy nr no l np nq">chmod 400 ~/path/to/key.pem </span><span id="48cb" class="nm la it ni b gy nr no l np nq"># Get in the box <br/># ssh -i &lt;path to pem file&gt; -L &lt;local box:port&gt;:&lt;remote box:port&gt; ubuntu@&lt;ec2 ip address&gt; </span><span id="c539" class="nm la it ni b gy nr no l np nq">ssh -i ~/path/to/key.pem -L localhost:9999:localhost:8888 ubuntu@11.11.11.11</span></pre><p id="8a55" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><strong class="lt iu">注意</strong>:我建议对上面的命令<code class="fe ns nt nu ni b">localhost:9999:localhost:8888</code>使用端口 9999，因为您本地安装的 Jupyter 可能会干扰这个设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/6a521f239f14e21da87abdb84b94a487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*L6In_Oyff25E05kQ.png"/></div></div></figure><h1 id="2a02" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">让 Jupyter 开始</h1><p id="4e05" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在远程盒(EC2 盒)的端子上启动 Jupyter。建议在屏幕会话中启动 Jupyter，这样您可以关闭终端，Jupyter 服务器仍然保持活动状态。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="6b57" class="nm la it ni b gy nn no l np nq"># Create a new screen session <br/>screen -S jupyter_session </span><span id="e324" class="nm la it ni b gy nr no l np nq"># Start Jupyter <br/>jupyter notebook</span></pre><p id="10eb" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">这应该为我们的 Jupyter 笔记本— <code class="fe ns nt nu ni b"><a class="ae ky" href="http://localhost:8888/?token=thisisalongsecrettoken." rel="noopener ugc nofollow" target="_blank">http://localhost:8888/?token=thisisalongsecrettoken</a></code> <a class="ae ky" href="http://localhost:8888/?token=thisisalongsecrettoken." rel="noopener ugc nofollow" target="_blank">提供一个 URL 和一个密码(令牌)。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/cc3459e88b41af833ff38b57dba59ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NasUoyAFEiOSnJb9.png"/></div></div></figure><h1 id="4fcf" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">跑起来</h1><p id="038e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你现在应该可以在你的本地机器上访问 Jupyter 了<a class="ae ky" href="http://localhost:9999" rel="noopener ugc nofollow" target="_blank"> http://localhost:9999 </a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/0ca4f0b279168906452132b853185cd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qkwMrYYgddjmQMc0.png"/></div></div></figure><h1 id="67ca" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">我的数据在哪里</h1><p id="4a6e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你可以从你的终端或通过 python 从 S3(亚马逊推荐的存储)下载你的数据。我在 Google drive 上有我的数据，所以我正在使用这个很酷的实用程序库<strong class="lt iu"> googledrivedownloader </strong>将我的数据放入这个盒子。您需要为这个库创建一个 sharabele 链接，链接到 G-Drive 中的数据。lib 也为我们创建子目录和解压数据。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="3e1c" class="nm la it ni b gy nn no l np nq">! pip3 install "googledrivedownloader==0.4" </span><span id="24d8" class="nm la it ni b gy nr no l np nq">from google_drive_downloader import GoogleDriveDownloader as gdd</span><span id="1df7" class="nm la it ni b gy nr no l np nq"># file_id - id of the sharable link of the file <br/># from Google Drive. </span><span id="f29f" class="nm la it ni b gy nr no l np nq">gdd.download_file_from_google_drive(           <br/>    file_id='1jgSl1thisisafakekeyRleIGpIO3Q', <br/>    dest_path='./data/Flikr8k_text.zip', <br/>    unzip=True)</span></pre><h1 id="6ca9" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">清理很重要$$$</h1><p id="d57f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">确保在不使用时停止/终止实例。否则亚马逊得到$$$。停止实例时，数据将保留在节点存储上，不会向您收费。请<a class="ae ky" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Stop_Start.html" rel="noopener ugc nofollow" target="_blank">阅读官方文件</a>了解更多信息。</p><p id="3250" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><strong class="lt iu">重要提示:</strong>您的笔记本和下载的数据将在<strong class="lt iu">终止</strong>实例时被删除，您必须再次完成上述所有步骤。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/f190274c2663e85e45f186d6c2da9b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*n1aAVtGT94aYE762.png"/></div></div></figure><h1 id="4134" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">那是一个包裹</h1><p id="fb5d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在未来的帖子中，我们将关注亚马逊 Sagemaker，它为数据科学笔记本提供了更加统一的体验。</p><p id="66e8" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">这就是这篇文章的全部内容。希望对你有用。让模型运行起来。</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="3491" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><em class="oc">原载于 2020 年 6 月 13 日</em><a class="ae ky" href="https://confusedcoders.com/data-science/deep-learning/moving-our-local-jupyter-notebooks-to-gpus-on-cloud-deep-learning-on-aws" rel="noopener ugc nofollow" target="_blank"><em class="oc">https://confusedcoders.com</em></a><em class="oc">。</em></p></div></div>    
</body>
</html>