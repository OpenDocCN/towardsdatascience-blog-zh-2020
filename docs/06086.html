<html>
<head>
<title>Is your website leaking sensitive information?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的网站是否泄露了敏感信息？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/xs-leaks-is-your-website-leaking-the-sensitive-information-c190eff5d548?source=collection_archive---------56-----------------------#2020-05-17">https://towardsdatascience.com/xs-leaks-is-your-website-leaking-the-sensitive-information-c190eff5d548?source=collection_archive---------56-----------------------#2020-05-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5778" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对于导致用户信息泄露的XSLeaks(跨站点泄露)缺乏关注</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5ff0ae202b9ce8219f7157f2633053e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XD4XSvpbiGdygxkI"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/photos/fPxOowbR6ls" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="5dc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数开发人员都熟悉并了解这些安全漏洞<a class="ae ky" href="https://www.youtube.com/watch?v=L5l9lSnNMxg" rel="noopener ugc nofollow" target="_blank">【XSS】</a>(跨站脚本)、<a class="ae ky" href="https://www.youtube.com/watch?v=vRBihr41JTo" rel="noopener ugc nofollow" target="_blank">【CSRF】</a>(跨站请求伪造)或<a class="ae ky" href="https://www.youtube.com/watch?v=_jKylhJtPmI" rel="noopener ugc nofollow" target="_blank"> SQL注入</a>，但对可能导致用户信息泄露的XSLeaks(跨站泄漏)却缺乏关注。在这篇博客中，我将对它做一个简单的介绍。</p><h2 id="2b2d" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><strong class="ak">什么是XSLeaks？</strong></h2><p id="48c3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">XSLeaks是一类漏洞，第三方恶意网站能够发送请求或将用户重定向到目标服务，然后测量侧信道信号(例如，响应时间、浏览器中的静态资源缓存、HTTP响应状态代码、响应内容等)..)来基于这样的副信道信号推断和收集关于用户的信息。</p><h2 id="5f47" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><strong class="ak">现实世界</strong>举例:你在看我的博客，如果我知道你是谁呢？？</h2><p id="2c15" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">2013年，有一个<a class="ae ky" href="http://patorjk.com/blog/2013/03/01/facebook-user-identification-bug/" rel="noopener ugc nofollow" target="_blank">报告的错误</a>允许网站使用脸书来检测访问者是否是特定的人。脸书徽章的预览图像是基于当时用户的脸书ID动态生成的。如果用户1234567已经登录，图像将类似于图1。如果其他用户试图加载用户1234567的徽章图像，则会加载脸书徽标图像，而不是个人资料图像(图2)。基本上，只有用户自己可以查看他们的个人资料徽章预览。</p><blockquote class="mt mu mv"><p id="2e06" class="kz la mw lb b lc ld ju le lf lg jx lh mx lj lk ll my ln lo lp mz lr ls lt lu im bi translated"><img src="”https://facebook.com/badge_edit.php?userid=1234567″"/></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/bbe18c66dc36071496c1bd9b211a7bfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:240/format:webp/0*22vHaZzhlOEzeTI4.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图一。有效的登录用户。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/7086bb857b3ebcf8c7a52deb3c10627c.png" data-original-src="https://miro.medium.com/v2/resize:fit:350/format:webp/0*8KDiwt6suCwIypHE.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图二。无效的登录用户。</p></figure><p id="7a1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管脸书已经很好地屏蔽了姓名和电子邮件地址的信息，但它仍然泄露了用户身份。黑客可以使用JavaScript悄悄加载预定义用户id列表的配置文件出价预览，然后检查响应图像的高度和宽度，以了解特定用户正在查看他们的页面。</p><p id="7f5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果上面的例子对你来说已经相当过时了，2018年年中还有另一个<a class="ae ky" href="https://www.tomanthony.co.uk/blog/facebook-bug-confirm-user-identities/" rel="noopener ugc nofollow" target="_blank">报告的bug </a>。汤姆·安东尼发现了一种可以达到类似结果的方法。今天，与2013年相比，大多数脸书后端端点都受到了很好的保护，它们加载了<code class="fe nc nd ne nf b">access-control-allow-origin</code>、<code class="fe nc nd ne nf b">x-frame-options </code>标头，以防止恶意网站使用XHR请求、iframe、图像标签等嵌入和调查FB内容。然而，Tom发现一个api(以用户ID作为参数)为匹配用户和非匹配用户提供了不同的<code class="fe nc nd ne nf b">content-type</code>。然后，他使用了一个简单的JavaScript脚本，该脚本将获取一个用户id列表，并生成许多带有等同于端点的<code class="fe nc nd ne nf b">src</code>的<code class="fe nc nd ne nf b">script</code>标签。<code class="fe nc nd ne nf b">script</code>标签当然会失败，但是由于响应内容类型的不同，它们会以不同的方式失败，并且可以通过<code class="fe nc nd ne nf b">onload</code>和<code class="fe nc nd ne nf b">onerror</code>事件处理程序检测到。此外，该端点似乎没有任何速率限制，他可以在一分钟内检查数千个id。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="07af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果上述漏洞没有被修复，人们可能会利用它们来跟踪特定的人(比如老板、前女友、名人..)阅读他们的博客，或者他们可以根据访问者显示不同的内容。更多关于XS泄露攻击的真实例子可以在这里找到。</p><h1 id="c9ee" class="ni lw it bd lx nj nk nl ma nm nn no md jz np ka mg kc nq kd mj kf nr kg mm ns bi translated">怎么防守？</h1><p id="8109" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">web应用程序的本质通常会导致大量暴露在web中的端点暴露用户的敏感数据，并且浏览器实现使网站很容易受到XSLeak攻击。幸运的是，XSLeak已经引起了浏览器制造商的注意，并且有一些机制可以避免它。</p><p id="bebe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">X-帧-选项</strong> </a></p><p id="9b3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe nc nd ne nf b">X-Frame-Options: DENY</code>会导致任何在框架中加载页面的尝试失败。它不仅能防御<a class="ae ky" href="https://en.wikipedia.org/wiki/Clickjacking" rel="noopener ugc nofollow" target="_blank">点击劫持</a>，还能帮助防御XSLeaks。如果页面需要嵌入到其他站点(广告、小部件等等)，那么页面中包含的信息应该尽可能的稳定和可预测。</p><p id="dfda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">same site cookie</strong></a></p><p id="8f81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在某些情况下，恶意网站可以删除受攻击网站的特定资源的缓存，迫使浏览器再次呈现这些信息，并检查浏览器是否确实缓存了最初删除的资源。这使得攻击者能够判断网站是否加载了特定的资源(如图像、脚本或样式表),从而识别用户或泄露用户的一些信息。</p><p id="7875" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">严格的同站点cookies有助于避免上述情况，因为它将用户手动键入URL、单击书签或单击当前站点的链接所生成的请求与其他网站发起的请求区分开来。</p><p id="d0db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以参考这个<a class="ae ky" href="https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多关于这种攻击的细节。</p><p id="e828" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.w3.org/TR/fetch-metadata/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">获取元数据请求头</strong> </a></p><p id="3be3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现代浏览器实现了sec fetch头，为服务器提供了更多的关于请求被触发的原因/位置的上下文。这些信息帮助服务器基于测试一组先决条件快速拒绝请求。</p><p id="bf1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，由<code class="fe nc nd ne nf b">img</code>元素生成的请求将导致包含以下HTTP请求头的请求:</p><pre class="kj kk kl km gt nt nf nu nv aw nw bi"><span id="9e69" class="lv lw it nf b gy nx ny l nz oa">Sec-Fetch-Dest: image<br/>Sec-Fetch-Mode: no-cors<br/>Sec-Fetch-Site: cross-site</span></pre><p id="92cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">服务器可以对端点实施策略检查，并使用<code class="fe nc nd ne nf b">Sec-Fetch-Dest</code>快速拒绝非图像内容的请求。</p><h1 id="1362" class="ni lw it bd lx nj nk nl ma nm nn no md jz np ka mg kc nq kd mj kf nr kg mm ns bi translated">结论</h1><p id="3088" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">XSLeak攻击领域的研究正在进行中，我相信在接下来的几年里会有更多的技术出现。作为一名开发者，重要的是要意识到这个问题有多严重，并开始更加注意保护你的网站免受这种攻击。</p><h2 id="bbb9" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">参考资料:</h2><ol class=""><li id="fd98" class="ob oc it lb b lc mo lf mp li od lm oe lq of lu og oh oi oj bi translated"><a class="ae ky" href="https://portswigger.net/research/xs-leak-leaking-ids-using-focus" rel="noopener ugc nofollow" target="_blank">https://ports wigger . net/research/xs-leak-leaking-ids-using-focus</a></li><li id="23f0" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><a class="ae ky" href="https://github.com/xsleaks/xsleaks/wiki/Defenses" rel="noopener ugc nofollow" target="_blank">https://github.com/xsleaks/xsleaks/wiki/Defenses</a></li><li id="9261" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><a class="ae ky" href="http://patorjk.com/blog/2013/03/01/facebook-user-identification-bug/" rel="noopener ugc nofollow" target="_blank">http://patorjk . com/blog/2013/03/01/Facebook-user-identificati on-bug/</a></li><li id="b424" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><a class="ae ky" href="https://www.tomanthony.co.uk/blog/facebook-bug-confirm-user-identities/" rel="noopener ugc nofollow" target="_blank">https://www . tomanthony . co . uk/blog/Facebook-bug-confirm-user-identities/</a></li><li id="6a28" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><a class="ae ky" href="https://portswigger.net/daily-swig/new-xs-leak-techniques-reveal-fresh-ways-to-expose-user-information" rel="noopener ugc nofollow" target="_blank">https://ports wigger . net/daily-swig/new-xs-leak-techniques-reveal-fresh-ways-to-expose-user-information</a></li><li id="cab9" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><a class="ae ky" href="https://medium.com/bugbountywriteup/cross-site-content-and-status-types-leakage-ef2dab0a492" rel="noopener">https://medium . com/bugbountywriteup/cross-site-content-and-status-types-leakage-ef 2 dab 0a 492</a></li><li id="71de" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><a class="ae ky" href="https://scarybeastsecurity.blogspot.com/2009/12/cross-domain-search-timing.html" rel="noopener ugc nofollow" target="_blank">https://scarybestsecurity . blogspot . com/2009/12/cross-domain-search-timing . html</a></li></ol></div></div>    
</body>
</html>