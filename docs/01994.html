<html>
<head>
<title>How to Create Interactive Plots with Altair</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Altair创建交互式剧情</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-interactive-and-elegant-plot-with-altair-8dd87a890f2a?source=collection_archive---------14-----------------------#2020-02-25">https://towardsdatascience.com/how-to-create-interactive-and-elegant-plot-with-altair-8dd87a890f2a?source=collection_archive---------14-----------------------#2020-02-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0922" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在5行简单的Python代码中利用您的数据分析</h2></div><h1 id="3ceb" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">牛郎星是什么？</h1><p id="6201" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您是否曾经想要通过放大来仔细查看您的数据，突出显示感兴趣的点，或者使用滚动条来查看数据如何随时间变化？通过对静态图有更多的控制，你会发现你可以对数据有更多的了解。</p><p id="8687" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">但是你可以想象创造一个互动的情节一定很有挑战性。所以你决定不参与互动部分。如果有一个python库可以让你用几行Python代码就能做到这一点，那会怎么样呢？</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/897128adf24838a7cc509d402d4c6d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/1*8Zr1yr0yo-0nvrMnfmXL-Q.gif"/></div></figure><p id="a7f1" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">上图是用Altair创建的。<a class="ae mj" href="https://altair-viz.github.io/" rel="noopener ugc nofollow" target="_blank"> Altair </a>是Python的统计可视化库，基于Vega和Vega-Lite。Altair提供了强大而简洁的可视化语法，用于快速构建各种各样的统计图形。您只需要声明数据字段、颜色、大小等之间的链接，而让其余的绘图细节自动处理。有了Altair，你可以<strong class="lc iu">花更多的时间</strong> <strong class="lc iu">理解你的数据和它的意义，而不是找出代码。</strong></p><h1 id="01fb" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">开始</h1><p id="e772" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">安装Altair</p><pre class="mc md me mf gt mk ml mm mn aw mo bi"><span id="6b00" class="mp kj it ml b gy mq mr l ms mt">$ pip install altair</span></pre><p id="fcbb" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">Altair可以和示例数据集一起安装在<a class="ae mj" href="https://github.com/altair-viz/vega_datasets" rel="noopener ugc nofollow" target="_blank"> vega_datasets </a>中:</p><pre class="mc md me mf gt mk ml mm mn aw mo bi"><span id="52c7" class="mp kj it ml b gy mq mr l ms mt">$ pip install altair vega_datasets</span></pre><p id="13ea" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在Jupyter笔记本上导入Altair</p><pre class="mc md me mf gt mk ml mm mn aw mo bi"><span id="a3ab" class="mp kj it ml b gy mq mr l ms mt">import altair as alt<br/>import pandas as pd</span></pre><p id="5781" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">Altair中的一些数据集是围绕熊猫数据框架建立的。这是什么意思？这意味着你可以在Altair中操作数据，就像你处理熊猫数据帧一样。</p><p id="7b4a" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我们将使用vega_data中的gapminder数据来显示一些国家1995年至2005年期间的全球健康和人口数据。</p><pre class="mc md me mf gt mk ml mm mn aw mo bi"><span id="af85" class="mp kj it ml b gy mq mr l ms mt">from vega_datasets import data as vega_data<br/>gap = pd.read_json(vega_data.gapminder.url)</span><span id="45e3" class="mp kj it ml b gy mu mr l ms mt">gap.head(10)</span></pre><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/d69f95a73b9e17a68770c9830afcbd80.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*YjzuBQa7nTvYfrgdiBFsxA.png"/></div></figure><p id="2788" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">找出此数据中有多少独特的年份:</p><pre class="mc md me mf gt mk ml mm mn aw mo bi"><span id="b731" class="mp kj it ml b gy mq mr l ms mt">&gt;&gt;&gt; gap.year.unique()</span><span id="b300" class="mp kj it ml b gy mu mr l ms mt">array([1955, 1960, 1965, 1970, 1975, 1980, 1985, 1990, 1995, 2000, 2005])</span></pre><p id="7767" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">既然我们最感兴趣的是最新的数据，那就让我们看看2005年的数据吧。</p><pre class="mc md me mf gt mk ml mm mn aw mo bi"><span id="9afc" class="mp kj it ml b gy mq mr l ms mt">gap2005 = gap.loc[gap['year'] == 2005]</span></pre><h1 id="f53e" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">形象化</h1><h2 id="9da8" class="mp kj it bd kk mw mx dn ko my mz dp ks lj na nb ku ln nc nd kw lr ne nf ky ng bi translated">指定X轴和Y轴</h2><p id="1176" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们对生育率和预期寿命之间的相关性很好奇。所以我们指定了我们想要用<code class="fe nh ni nj ml b">mark_point()</code>绘制的图的类型，以点的形式显示数据。我们还可以使用<code class="fe nh ni nj ml b">mark_*</code>以其他几何形状呈现数据</p><pre class="mc md me mf gt mk ml mm mn aw mo bi"><span id="7fd3" class="mp kj it ml b gy mq mr l ms mt">alt.Chart(gap2005).mark_point().encode(<br/>    alt.X('fertility'),<br/>    alt.Y('life_expect')<br/>)</span></pre><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="40b5" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">看起来数据不在图表的中心。通常我们需要用<code class="fe nh ni nj ml b">matplotlib</code>来指定比例，但是用牛郎星，你只需要用<code class="fe nh ni nj ml b">scale</code>的方法</p><h2 id="1378" class="mp kj it bd kk mw mx dn ko my mz dp ks lj na nb ku ln nc nd kw lr ne nf ky ng bi translated">调整比例</h2><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nm nl l"/></div></figure><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="3b29" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">不错！但是如果我们想知道人口数量与生育率和预期寿命的关系呢？我们可以利用另一个维度:<strong class="lc iu">大小</strong></p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nm nl l"/></div></figure><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="8d6b" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">太棒了。左侧的图例给出了每个圆圈大小的含义。我们能增加另一个维度吗？绝对的！x轴，y轴，尺寸，我们遗漏了什么？<strong class="lc iu">颜色</strong>！</p><h2 id="c488" class="mp kj it bd kk mw mx dn ko my mz dp ks lj na nb ku ln nc nd kw lr ne nf ky ng bi translated">添加颜色维度并指定数据类型</h2><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nm nl l"/></div></figure><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7830" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">正如您在上面看到的，我们还可以指定数据的<strong class="lc iu">类型:</strong>N-名义(类别名称)、Q-数量(数字数据)、O-序数(有序数据)或T-时间(时间点或时间间隔)。在上面的代码中，因为我想将聚类解释为类别数据，所以我使用了<code class="fe nh ni nj ml b">:N</code></p><p id="3814" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">为了让我们的圆圈看起来更好，我们用<code class="fe nh ni nj ml b">filled=True.</code>填充颜色，用<code class="fe nh ni nj ml b">alt.OpacityValue(0.5)</code>添加一些不透明度来看大点后面的小点</p><h2 id="e390" class="mp kj it bd kk mw mx dn ko my mz dp ks lj na nb ku ln nc nd kw lr ne nf ky ng bi translated">显示每个点的信息</h2><p id="b389" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">但是图中有很多点。有没有一种方法，当我们<strong class="lc iu">点击每一个点</strong>来显示<strong class="lc iu"> </strong>关于国家、生育率和预期寿命的信息？是的，当然。这可以通过添加<code class="fe nh ni nj ml b">Tooltip</code>来完成</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nm nl l"/></div></figure><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="2ef4" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">能够看到每个点上的信息是很好的。但是如果我们想一次看到多个点的信息呢？不用再等了，让我们直接跳到如何用Altair创造一个互动的剧情！</p><h1 id="e519" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">互动情节</h1><h2 id="1120" class="mp kj it bd kk mw mx dn ko my mz dp ks lj na nb ku ln nc nd kw lr ne nf ky ng bi translated">选择单点</h2><p id="5d1b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe nh ni nj ml b">Selection_single()</code>使我们能够<strong class="lc iu">点击一个点来突出显示它</strong>。当我们单击该点时，我们希望其他点变得与灰色无关。这可以通过<code class="fe nh ni nj ml b">alt.condition()</code>完成</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nm nl l"/></div></figure><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="ddcf" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">现在，我们可以查看感兴趣点的信息，而不会被其他点分散注意力</p><h2 id="22d9" class="mp kj it bd kk mw mx dn ko my mz dp ks lj na nb ku ln nc nd kw lr ne nf ky ng bi translated">选择多个点</h2><p id="866b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">但是我们可能同时对几个点感兴趣。或者更好，到<strong class="lc iu">选择一个区间</strong>的点。两者都可以用<code class="fe nh ni nj ml b">selection_multi()</code>和<code class="fe nh ni nj ml b">selection_interval()</code>来完成</p><p id="33a3" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">因为我们想一次尝试不同的选择工具，所以让我们创建一个函数来完成它。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nm nl l"/></div></figure><p id="778d" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">现在使用<code class="fe nh ni nj ml b">alt.hconcat()</code>尝试不同的选择，并连接这些选择的图形</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nm nl l"/></div></figure><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="7eb4" class="mp kj it bd kk mw mx dn ko my mz dp ks lj na nb ku ln nc nd kw lr ne nf ky ng bi translated">时间间隔</h2><p id="5d22" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们已经看到了2005年的数据。如果我们想看到数据随时间的变化呢？通过为<code class="fe nh ni nj ml b">alt.selection_single</code>添加更多的条件，例如<code class="fe nh ni nj ml b">name=’select’, fields = [‘year’]</code>、初始年份<code class="fe nh ni nj ml b">init={‘year’: 1955} </code>和范围<code class="fe nh ni nj ml b">bind=alt.binding_range(min=1955, max=2005, step=5)</code>，可以很容易地做到这一点</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nm nl l"/></div></figure><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="nn nl l"/></div></figure><p id="1914" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">不错！现在，通过在<code class="fe nh ni nj ml b">select-year</code>栏上拖动鼠标，我们可以很容易地看到数据随时间的变化</p><h1 id="0a3d" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">保存情节</h1><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi no"><img src="../Images/4e4427af07cfd66b4493bfd1cd77b8b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*xgEhDGiqEqjmVzfj_1xjuw.png"/></div></figure><p id="5079" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">创建图形后，我们希望从图形中得到的最后一个函数是什么？保存我们的图表以展示我们的网站或社交媒体！这可以通过点击图表左上角的按钮轻松完成。</p><h1 id="a40c" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="66d7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">恭喜你！您已经学习了如何利用Altair进行高效的数据分析。这篇<strong class="lc iu"> </strong>文章并没有详尽地涵盖你可以用Altair做的所有事情，比如创建一个<strong class="lc iu">堆叠条形图、热图、面积图、地图</strong>或其他交互功能。你可以在这里找到更多关于牛郎星图书馆<a class="ae mj" href="https://altair-viz.github.io/gallery/index.html" rel="noopener ugc nofollow" target="_blank">的信息，或者关注</a><a class="ae mj" href="https://github.com/uwdata/visualization-curriculum" rel="noopener ugc nofollow" target="_blank"> Github教程</a>。我最希望你从这篇文章中得到的是:用Python创建一个<strong class="lc iu">有趣而漂亮的图形</strong>可以是<strong class="lc iu">难以置信的简单和有趣！</strong></p><p id="bf4b" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在<a class="ae mj" href="https://github.com/khuyentran1401/Data-science/blob/master/visualization/altair/altair.ipynb" rel="noopener ugc nofollow" target="_blank">这个Github repo </a>中，您可以随意使用本文的代码。</p><p id="296f" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我喜欢写一些基本的数据科学概念，并尝试不同的算法和数据科学工具。你可以在LinkedIn和Twitter上与我联系。</p><p id="3658" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">如果你想查看我写的所有文章的代码，请点击这里。在Medium上关注我，了解我的最新数据科学文章，例如:</p><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/how-to-learn-data-science-when-life-does-not-give-you-a-break-a26a6ea328fd"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">当生活不给你喘息的机会，如何学习数据科学</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">我努力为数据科学贡献时间。但是发现新的策略使我能够提高我的学习速度和…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og mh ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/what-graphical-excellence-is-and-how-to-create-it-db02043e0b37"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">什么是卓越的图形以及如何创建它</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">作为一名数据科学家，了解如何制作重要的图表至关重要</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="oh l od oe of ob og mh ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/dictionary-as-an-alternative-to-if-else-76fe57a1e4af"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">字典作为If-Else的替代</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">使用字典创建一个更清晰的If-Else函数代码</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="oi l od oe of ob og mh ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/maximize-your-productivity-with-python-6110004b45f7"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">使用Python最大化您的生产力</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">你创建了一个待办事项清单来提高效率，但最终却把时间浪费在了不重要的任务上。如果你能创造…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="oj l od oe of ob og mh ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/python-tricks-for-keeping-track-of-your-data-aef3dc817a4e"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">跟踪数据的Python技巧</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">如何用列表、字典计数器和命名元组来跟踪信息</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="ok l od oe of ob og mh ns"/></div></div></a></div><h1 id="c7e0" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">参考</h1><p id="430a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">赫尔，杰佛里。github:<a class="ae mj" href="https://github.com/uwdata/visualization-curriculum" rel="noopener ugc nofollow" target="_blank">https://github.com/uwdata/visualization-curriculum</a>。2017年1月。</p></div></div>    
</body>
</html>