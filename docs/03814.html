<html>
<head>
<title>How to Deploy Models at Scale with AI Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何利用人工智能平台大规模部署模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-deploy-models-at-scale-with-ai-platform-fd1badf449ea?source=collection_archive---------35-----------------------#2020-04-09">https://towardsdatascience.com/how-to-deploy-models-at-scale-with-ai-platform-fd1badf449ea?source=collection_archive---------35-----------------------#2020-04-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="435f" class="pw-subtitle-paragraph jv ip iq bd b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dk translated">将机器学习模型部署到云中，并将其作为 API 提供给世界其他地方。</h2></div><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/b506933efc544125b183bec18f3cbd03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w0xrIjWLtjn9DLrfoaulsA.jpeg"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">马里乌斯·马萨拉尔在<a class="ae ld" href="https://unsplash.com/s/photos/machine-learning?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片由作者编辑。</p></figure><p id="b75c" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">通常，当我们都开始学习机器学习时，我们会发现大量关于如何建立模型的信息，这当然是主题的核心。但是在数据科学的学术世界中，ML 还有一个同样重要的方面很少被教授，那就是<strong class="lg ir">如何部署这些模型。我如何与世界上的其他人分享我做的这件有用的事情？因为，在一天结束的时候…这就是我们工作的目的，对吗？让人们的生活更轻松😊。</strong></p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><p id="cbd8" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在本帖中，我们将学习如何将机器学习模型部署到云中，并将其作为 API 提供给世界其他地方。</p><h1 id="7ae9" class="mh mi iq bd mj mk ml mm mn mo mp mq mr ke ms kf mt kh mu ki mv kk mw kl mx my bi translated">工作流程</h1><p id="6faf" class="pw-post-body-paragraph le lf iq lg b lh mz jz lj lk na kc lm ln nb lp lq lr nc lt lu lv nd lx ly lz ij bi translated">我们将首先将模型存储在 Firebase 存储中，以将其部署到 AI 平台，我们可以在生产中对其进行版本化和分析。最后，我们将通过具有 Firebase 云功能的 API 来提供我们的模型。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ne"><img src="../Images/4e41b1e0b829ed1962d8059c91cb1cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JFaVER4Hp9Ap-Yky4waKkQ.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">图片由作者提供。</p></figure><h2 id="bc86" class="nf mi iq bd mj ng nh dn mn ni nj dp mr ln nk nl mt lr nm nn mv lv no np mx nq bi translated">AI 平台是什么？🧠</h2><p id="e0fb" class="pw-post-body-paragraph le lf iq lg b lh mz jz lj lk na kc lm ln nb lp lq lr nc lt lu lv nd lx ly lz ij bi translated">AI Platform 是<a class="ae ld" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a> (GCP)的一项服务，通过不必担心维护自己的基础设施，让你只为使用付费，可以轻松管理整个生产和部署过程。这将使您能够为快速增长的项目大规模扩展您的产品。</p><p id="7ea0" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">你可以利用 GCP 的 12 个月、300 美元的免费试用来免费尝试这个和更多的实验<strong class="lg ir">。</strong></p><h2 id="c903" class="nf mi iq bd mj ng nh dn mn ni nj dp mr ln nk nl mt lr nm nn mv lv no np mx nq bi translated">什么是 Firebase 云函数？🔥</h2><p id="621d" class="pw-post-body-paragraph le lf iq lg b lh mz jz lj lk na kc lm ln nb lp lq lr nc lt lu lv nd lx ly lz ij bi translated">本质上，对于本文的目的，云函数将作为一个 API 工作。我们将通过一个任何人都可以提出请求的链接来提供我们模型的预测，并实时接收我们模型的响应。</p><h1 id="8504" class="mh mi iq bd mj mk ml mm mn mo mp mq mr ke ms kf mt kh mu ki mv kk mw kl mx my bi translated">你需要什么</h1><ul class=""><li id="6bbf" class="nr ns iq lg b lh mz lk na ln nt lr nu lv nv lz nw nx ny nz bi translated">一个准备分享✔的模型</li><li id="83fc" class="nr ns iq lg b lh oa lk ob ln oc lr od lv oe lz nw nx ny nz bi translated">一个谷歌账户✔</li></ul><p id="0d6e" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">是的，就这些</p><h1 id="4cfa" class="mh mi iq bd mj mk ml mm mn mo mp mq mr ke ms kf mt kh mu ki mv kk mw kl mx my bi translated">入门指南</h1><p id="558d" class="pw-post-body-paragraph le lf iq lg b lh mz jz lj lk na kc lm ln nb lp lq lr nc lt lu lv nd lx ly lz ij bi translated">为了简单起见，我假设这个模型是用 Python 开发的，并且存在于一个 Jupyter 笔记本中。但是当然，这些步骤可以适用于任何其他环境。</p><h2 id="4dae" class="nf mi iq bd mj ng nh dn mn ni nj dp mr ln nk nl mt lr nm nn mv lv no np mx nq bi translated">1.登录 Firebase</h2><p id="9243" class="pw-post-body-paragraph le lf iq lg b lh mz jz lj lk na kc lm ln nb lp lq lr nc lt lu lv nd lx ly lz ij bi translated">首先，用你的谷歌账户登录到<a class="ae ld" href="https://console.firebase.google.com" rel="noopener ugc nofollow" target="_blank"> Firebase 控制台</a>，创建一个新项目。现在你在 Firebase 仪表板里面，进入<em class="of">项目设置</em> &gt; <em class="of">服务账户</em> &gt; <em class="of"> Firebase 管理 SDK </em>，(在这种情况下)你选择 Python 选项并点击<em class="of">生成新私钥</em>。这将给出您的服务帐户的 JSON 文件，您可以将其保存在笔记本的目录中。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi og"><img src="../Images/f7b70a5cd0b9d0a6a6d1792cf22140d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Hf5XwxlmK_z-IJ-u2J16A.png"/></div></div></figure><p id="a798" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">然后，安装 Firebase Admin SDK 包:<code class="fe oh oi oj ok b">pip install firebase-admin</code></p><h2 id="7f76" class="nf mi iq bd mj ng nh dn mn ni nj dp mr ln nk nl mt lr nm nn mv lv no np mx nq bi translated">2.燃料库中的存储模型</h2><p id="3e44" class="pw-post-body-paragraph le lf iq lg b lh mz jz lj lk na kc lm ln nb lp lq lr nc lt lu lv nd lx ly lz ij bi translated">一旦你训练和测试了你的模型，它就可以上传到人工智能平台了。但在此之前，我们需要先将模型导出并存储在 Firebase 存储中，这样 AI 平台才能访问它。</p><p id="d9d1" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果您使用笔记本，在末尾创建一个新的单元格，并添加以下脚本。这将启用您的 firebase 帐户:</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="3dda" class="nf mi iq ok b gy op oq l or os">import firebase_admin<br/>from firebase_admin import credentials<br/>from firebase_admin import firestore</span><span id="ad9b" class="nf mi iq ok b gy ot oq l or os"># Use a service account<br/>if (not len(firebase_admin._apps)):<br/>	cred = credentials.Certificate(r'service_account.json')<br/>	firebase_admin.initialize_app(cred)</span><span id="c84f" class="nf mi iq ok b gy ot oq l or os">db = firestore.client()</span></pre><p id="b48e" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，要运行下面的代码，您需要获取项目 ID，您可以在 Firebase 项目设置中再次找到它。</p><p id="9810" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">一旦我们有了我们的项目 ID，我们就通过运行下面的代码来上传模型(您应该首先用您的项目 ID 来更改它)。</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="d820" class="nf mi iq ok b gy op oq l or os">from sklearn.externals import joblib<br/>from firebase_admin import storage</span><span id="1f78" class="nf mi iq ok b gy ot oq l or os">joblib.dump(clf, 'model.joblib')<br/>bucket = storage.bucket(name='[YOUR PROJECT ID HERE].appspot.com')<br/>b = bucket.blob('model-v1/model.joblib')<br/>b.upload_from_filename('model.joblib')<br/>print('model uploaded!')</span></pre><p id="0747" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，我们可以通过检查指定目录(在我们的例子中是<code class="fe oh oi oj ok b">model-v1/</code>)中的 Firebase 存储来验证模型已经被正确上传。</p><h2 id="ba4d" class="nf mi iq bd mj ng nh dn mn ni nj dp mr ln nk nl mt lr nm nn mv lv no np mx nq bi translated">3.在人工智能平台中部署模型</h2><p id="3166" class="pw-post-body-paragraph le lf iq lg b lh mz jz lj lk na kc lm ln nb lp lq lr nc lt lu lv nd lx ly lz ij bi translated">现在模型已经存储好了，可以接入 AI 平台了。</p><p id="10c3" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们需要在<a class="ae ld" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>中启用几个 API。在左侧面板上，在<em class="of">库</em>部分中，我们找到 API<em class="of">“AI 平台训练&amp;预测 API”</em>和<em class="of">“云构建 API”</em>并启用它们。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/cdeaf7965c416d6111a9b2355d61478b.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*4oEjHEUu32PojbWY4WX5kw.png"/></div></figure><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ov"><img src="../Images/6892dbfb67d99ed241c19c4acfa22230.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M2OLxkn_qdgJLiVPy_QObA.png"/></div></div></figure><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ow"><img src="../Images/67248d32c07dc1add34cbd510b5e0d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GWXTNQVYluPLF-VPLAVtEg.png"/></div></div></figure><p id="6277" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，在左侧面板上，我们点击<em class="of">人工智能平台&gt;模型</em>，我们<em class="of">创建新模型</em>并输入相应的信息。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/973a8a4ab761b7ec38f469ba131fd81f.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*ZNa9OT8K-ApGMD9vd_t5ew.png"/></div></figure><p id="7270" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">一旦我们创建了模型，是时候创建它的一个版本了，它将指向<em class="of">。我们之前存储的 joblib </em>文件。我们点击<em class="of">型号</em> &gt; <em class="of">新版本</em>并填写信息。重要的是，我们选择用于训练模型的相同 Python 版本。我们选择 scikit-learn 作为框架。当指定它的版本时，我们可以通过在笔记本中运行下面的代码来获得它。</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="99a6" class="nf mi iq ok b gy op oq l or os">import sklearn<br/>print('The scikit-learn version is {}.'.format(sklearn.__version__))</span></pre><p id="8539" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在选择 ML 运行时版本时，您应该选择推荐的版本。机器类型可以暂时默认保留。</p><p id="91f1" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">最后，我们指定我们的<em class="of">所在的文件夹。joblib </em>文件被定位。重要的是选择文件夹，而不是文件！其余字段可以保留默认并保存。那时，我们模型的一个实例将被部署在人工智能平台上。</p><p id="9c26" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，我们将能够从命令行或其他 Google APIs 进行预测，如 Cloud Function，我们将在接下来看到。此外，我们将能够获得模型的一些性能指标。</p><h2 id="6c0c" class="nf mi iq bd mj ng nh dn mn ni nj dp mr ln nk nl mt lr nm nn mv lv no np mx nq bi translated">4.创建云函数</h2><p id="347a" class="pw-post-body-paragraph le lf iq lg b lh mz jz lj lk na kc lm ln nb lp lq lr nc lt lu lv nd lx ly lz ij bi translated">让我们看看如何实现该功能！</p><p id="634b" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们将在终端上运行一些命令，但为此，您需要确保您的计算机上安装了<a class="ae ld" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>。以下命令特定于 Windows，但是您应该能够在 Unix 和 Mac OS 设备中使用它们，方法是在每个命令的开头添加<code class="fe oh oi oj ok b">sudo</code>。</p><p id="65f5" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">让我们从安装 Firebase 客户端开始:<code class="fe oh oi oj ok b">$ npm install -g firebase-tools</code></p><p id="2c8a" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们进入谷歌账户:<code class="fe oh oi oj ok b">$ firebase login</code></p><p id="e922" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">初始化一个新的项目目录(确保你在你想要初始化它的目录中):<code class="fe oh oi oj ok b">$ firebase init</code></p><p id="923d" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">运行最后一个命令时，将会询问您几个问题。当询问您想要在目录中包含的 Firebase 项目时，您必须选择包含我们之前导出的 ML 模型的项目。选择 JavaScript 作为编程语言。我们不使用 ESLint，所以回答<em class="of">否</em>。最后，用<em class="of"> npm </em>安装依赖项，回答<em class="of">是</em>。</p><p id="db77" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">创建项目后，目录将具有以下结构:</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi oy"><img src="../Images/85590e9566bccf21f656f673f4f592ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OMdeAB4TQ_tnp07-Wj9eFg.png"/></div></div></figure><p id="f9cf" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在这个目录中，我们将只修改<em class="of"> index.js </em>和<em class="of"> package.json </em>文件。</p><p id="ed08" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们安装 Google API 的包:<code class="fe oh oi oj ok b">$ npm i googleapis</code></p><p id="8a88" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，我们通过打开<em class="of"> package.json </em>文件来检查软件包是否已经正确安装。如果你想在你的代码中使用任何其他的外部包，你也应该把它和它相应的版本一起添加到这个文件中。</p><p id="2a5a" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">目前，它应该具有类似于以下的结构:</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="6c1b" class="nf mi iq ok b gy op oq l or os">"dependencies"​: {<br/>	​"firebase-admin"​: ​"~7.0.0"​,​<br/>	"firebase-functions"​: ​"^2.3.0"​,​<br/>	"googleapis"​: ​"^39.2.0"​<br/>}</span></pre><p id="72ee" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我将简要说明它们的作用:</p><ul class=""><li id="499d" class="nr ns iq lg b lh li lk ll ln oz lr pa lv pb lz nw nx ny nz bi translated">firebase-admin :它是管理 SDK，允许从特权环境与 firebase 交互。</li><li id="5171" class="nr ns iq lg b lh oa lk ob ln oc lr od lv oe lz nw nx ny nz bi translated">firebase-functions:这是一个定义 firebase 中<a class="ae ld" href="https://firebase.google.com/docs/functions" rel="noopener ugc nofollow" target="_blank">云函数</a>的 SDK。</li><li id="8dcb" class="nr ns iq lg b lh oa lk ob ln oc lr od lv oe lz nw nx ny nz bi translated"><em class="of">Google APIs</em>:是 Google API 使用的客户端库 Node.js。</li></ul><p id="db70" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在让我们看看函数的实现(我们正在编辑<em class="of"> index.js </em>文件)，你也可以在<a class="ae ld" href="https://github.com/ElsaScola/sample_cloud_function" rel="noopener ugc nofollow" target="_blank">这个 GitHub 库</a>中找到。作为一个例子，我将使用代码访问一个简单的假账户检测模型。</p><p id="4f7f" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们首先加载<em class="of"> firebase-functions </em>和<em class="of"> firebase-admin </em>模块。</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="6ffa" class="nf mi iq ok b gy op oq l or os">const​​ functions ​​= ​​require​(​'firebase-functions'​);<br/>const ​​admin​​ =​​ require​(​'firebase-admin'​);</span></pre><p id="accf" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们加载<em class="of"> googleapis </em>模块，并添加对 ml 版本 1 的引用。</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="d2c6" class="nf mi iq ok b gy op oq l or os">admin​.​initializeApp​(​functions​.​config​().​firebase​);<br/>const​​ googleapis_1​​ =​​ require​(​"googleapis"​);<br/>const​​ ml​​ = ​​googleapis_1​.​google​.​ml​(​'v1'​);</span></pre><p id="d37d" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">这些请求将被发送到一个 http 函数。</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="31be" class="nf mi iq ok b gy op oq l or os">exports​.​predictSPAM​​ = ​​functions​.​https​.​onRequest​(​async​​(request,​​response)​​=&gt;<br/>{</span></pre><p id="3c0a" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们指定函数的输入值。在这个例子中，我得到了一些关于社交媒体账户的数据，我的模型将使用这些数据来分类虚假与否。您应该指定您计划随后输入到模型中的字段。</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="72f4" class="nf mi iq ok b gy op oq l or os">const ​​account_days_old​​ = ​​request​.​body​.​account_days_old​;​<br/>const​​ followers_count​​ =​​ request​.​body​.​followers_count​;​<br/>const ​​following_count ​​= ​​request​.​body​.​following_count​;<br/>​const​​ publications_count​​ =​​ request​.​body​.​publications_count​;</span></pre><p id="ffe9" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">之后，我们构建模型的输入，也就是我们将发送给模型以获得预测的输入参数。请注意，这些输入应遵循与模型训练时相同的结构(要素顺序)。</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="eb37" class="nf mi iq ok b gy op oq l or os">const​​ instance ​​= <br/>[[account_days_old,followers_count,following_count,publications_count]]</span></pre><p id="2a66" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，让我们向 Google API 发出请求，这个请求需要认证，这将把我们的 Firebase 凭证与 Google API 连接起来。</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="0765" class="nf mi iq ok b gy op oq l or os">const ​​model​​ =​​ "[HERE THE NAME OF YOUR MODEL]"​;​<br/>const​ { ​credential​ } ​=​​ await<br/>googleapis_1​.​google​.​auth​.​getApplicationDefault​();</span></pre><p id="54d8" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在一个变量中存储了我们的模型的名称之后(这个名称应该与您在 AI 平台控制台中给它的名称相同)，我们通过发送我们的凭证、模型的名称和我们想要预测的实例来对 AI 平台进行预测调用。</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="93fd" class="nf mi iq ok b gy op oq l or os">const ​​modelName​​ =​​ `projects/[YOUR PROJECT ID HERE]/models/​${​model​}​`​;<br/>const​​ preds ​​= ​​await ​​ml​.​projects​.​predict​({<br/>		auth​:​​ credential, <br/>		name​:​​ modelName,  <br/>		requestBody​:​​ {<br/>			​instance<br/>		​}​<br/>	});​<br/>	response​.​send​(​preds​.​data​[​'predictions'​][​0​]);<br/>});</span></pre><h2 id="5100" class="nf mi iq bd mj ng nh dn mn ni nj dp mr ln nk nl mt lr nm nn mv lv no np mx nq bi translated">5.将云功能部署为 API</h2><p id="f219" class="pw-post-body-paragraph le lf iq lg b lh mz jz lj lk na kc lm ln nb lp lq lr nc lt lu lv nd lx ly lz ij bi translated">一旦我们创建了访问模型的云函数，我们只需要将它上传到 Firebase，将其作为 API 进行部署。</p><p id="93bc" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">为了上传 Firebase 函数，我们在终端中运行以下命令:<code class="fe oh oi oj ok b">$ firebase deploy --only functions</code></p><p id="6f54" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">一旦完成加载，将获得一个 URL，通过该 URL 可以访问该功能，这可以通过登录 Firestore，在<em class="of">功能</em>部分，在<em class="of">请求</em>下以较小的字体找到。</p><p id="a10a" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">就这样，现在你的模型已经建立并运行了，可以开始分享了！🎉🎉🎉</p><p id="071b" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">你可以从一个移动应用程序、一个网站向这个 API 发出请求…它可以被集成到任何地方！</p><h2 id="82b4" class="nf mi iq bd mj ng nh dn mn ni nj dp mr ln nk nl mt lr nm nn mv lv no np mx nq bi translated">6.用失眠测试你的 API</h2><p id="9010" class="pw-post-body-paragraph le lf iq lg b lh mz jz lj lk na kc lm ln nb lp lq lr nc lt lu lv nd lx ly lz ij bi translated">当然，这是一个可选的步骤，如果您遵循了前面的指南，您的模型应该准备好接收请求。然而，作为一名程序员，我喜欢测试东西，以检查一切工作正常。</p><p id="e242" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我最喜欢的测试 API 的方法是使用<a class="ae ld" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠</a>。失眠症是一个 REST API 客户端，它让您可以轻松地测试您的 API。这款免费的桌面应用适用于 Windows、MacOS 和 Ubuntu。让我们检查一下我们新做的 API 是否工作正常！</p><p id="9e44" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">安装桌面应用程序后，我们可以创建新的请求。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/4a60b0e7ff763d4ebabe3842dec6430e.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/1*mVc6aNrPNQjJ9v-JxIne2w.png"/></div></figure><p id="698c" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们将编写请求名，并选择 POST 作为方法，JSON 作为其结构。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pd"><img src="../Images/69b3f7ba89c38998ffb6a6d463f62e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*URg454ZulffimzCYzb7pbQ.png"/></div></div></figure><p id="3761" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">一旦我们创建了请求，我们就复制云函数的 URL，并将其粘贴到顶栏中。</p><p id="c218" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们现在将按照我们在函数中指定的格式编写请求，在我的例子中，它是这样的:</p><pre class="ko kp kq kr gt ol ok om on aw oo bi"><span id="5511" class="nf mi iq ok b gy op oq l or os">{  <br/>  "account_days_old": 32,<br/>  "followers_count": 162,<br/>  "following_count": 152,<br/>  "publications_count": 45,<br/>}</span></pre><p id="57ce" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们现在点击<em class="of">发送</em>，我们将得到响应，以及响应时间和大小。如果有任何错误，您也应该收到错误代码，而不是<code class="fe oh oi oj ok b">200 OK</code>消息。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/827ffb707f4eea0877de49103aa15f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*aLslaet8meYqhnJf84GXZQ.png"/></div></figure><p id="6aa5" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">当然，您得到的响应会因您的型号而异。但是如果一切正常，那么恭喜你！您已经准备好与全世界分享您的模型了！🌍</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><p id="7fac" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果你做到了这一步，感谢你的时间，我希望你能从这篇文章中得到一些价值😊</p><p id="a584" class="pw-post-body-paragraph le lf iq lg b lh li jz lj lk ll kc lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">下一集再见！🚀</p></div></div>    
</body>
</html>