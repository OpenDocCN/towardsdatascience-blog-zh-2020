# pytolemaic——模型质量工具箱

> 原文：<https://towardsdatascience.com/pytolemaic-package-for-model-quality-analysis-2b7bea751cfd?source=collection_archive---------28----------------------->

![](img/c53f7273bacfb3f68334ccc5bca2ac6c.png)

图像由 PxFuel 提供

## Pytolemaic 软件包简介

这篇博文简要介绍了 Pytolemaic 包( [github](https://github.com/Broundal/Pytolemaic) )及其功能。该员额包括以下组成部分:

## 模型分析技术

1.  特征敏感度
2.  得分和置信区间
3.  协变量移位测量

## 模型预测分析

1.  预测的不确定性
2.  石灰解释

# 介绍

如今，构建机器学习(ML)模型相当容易。然而，构建一个好的模型仍然需要经验来避免过程中的许多陷阱。幸运的是，有几种技术可以用来识别这些陷阱。

Pytolemaic 软件包使用这样的技术来分析 ML 模型并测量它们的质量。考虑到方便性，该软件包有一个简单的界面，使其易于使用。

该员额组织如下:

1.  **入门** —介绍如何安装 Pytolemaic 包和初始化 PyTrust 对象
2.  **特征敏感度** —涵盖特征敏感度报告和漏洞报告。
3.  **评分报告** —该部分分为两个部分:一部分是关于回归任务的评分报告，包括置信区间和协方差偏移，随后是关于分类任务的类似部分
4.  **预测的不确定性** —软件包支持的不确定性方法概述
5.  **石灰说明** —石灰整合部分。

# 入门指南

Pytolemaic 软件包是为基于结构化数据(泰坦尼克号在，MNIST 号在)训练的监督模型(回归和分类)而构建的。该模型被视为黑盒，因此不需要关于该模型的额外信息。如果在估算器之前有一个预处理阶段(如插补)，则需要将其封装到一个单一的预测函数中，如通过使用 Sklearn 的管道类。

分析本身是相对轻量级的。但是，一些分析技术需要创建新的预测(例如 Lime)，这一过程可能非常耗时且计算量大，具体取决于模型的复杂性和数据集的大小。

> 这种包装不适合搬运重物。如果它需要更多的肌肉，请让我知道。

## 装置

Pytolemaic 包托管在 [github](https://github.com/Broundal/Pytolemaic) 上，并且在 Pypi.org 上可用，因此只需使用 pip:

```
pip install pytolemaic
```

## 启动 PyTrust 对象

要分析模型，只需使用以下信息启动一个 *PyTrust* 对象:

1.  [必需]定型模型、定型集、维持测试集和用于评估模型的度量。
2.  [可选]类别标签，拆分策略
3.  [可选]列的元数据:例如，功能名称、功能类型、功能编码
4.  [可选]样品的元数据:例如样品重量

虽然启动 PyTrust 对象非常简单，但它是包中最复杂的部分。因此，在第一次使用时，考虑只提供所需的信息。

让我们看看它是怎么做的

**示例#0:启动 PyTrust**

使用加州住房数据集启动 Pytrust

# 分析**报道**

**A .特征敏感度(FS)**
Pytolemaic 包实现了 FS 的 2 种变化——对混洗的敏感度，对缺失值的敏感度。调用*py trust . sensitivity _ report()*将计算这两种类型并返回一个 *SensitivityFullReport* 对象。

> 注意:如果你不熟悉特征敏感度方法，[请看这篇伟大的文章](https://medium.com/@einat_93627/understand-your-black-box-model-using-sensitivity-analysis-practical-guide-ef6ac4175e55)。

检索 FS 信息有两种方式:
1 .API-*sensitivity _ report . to _ dict()*将报告导出为字典。
2。图形化-*sensitivity _ report . plot()*将绘制任何可绘制的信息。

**示例**
对于这个示例，我们将使用在数据集[加州住房](https://scikit-learn.org/stable/modules/generated/sklearn.datasets.fetch_california_housing.html#sklearn.datasets.fetch_california_housing)上训练的随机森林回归器(完整示例[此处为](https://github.com/Broundal/Pytolemaic/blob/master/examples/interesting_examples/california_housing_dataset.py))。加州住房数据集将一个地区的特征与该地区的中值房价相关联。

**例#1:特征灵敏度分析**

将敏感度完整报告导出为字典

像大多数报告一样，有些字段不清楚。因此，为了提供方便的文档，这个包提供了一个 *to_dict_meaning()* 功能。

**示例#2:检索字典字段的文档:**

敏感度报告字典中项目的说明

我们通过调用 *to_dict()* 看到了 FS 报告，并通过 *to_dict_meaning()看到了可用的文档。*现在我们通过调用 *plot()* 来图形化的看看。

**示例#3:为特性敏感度报告创建图表**

由创建的图表。plot()功能。

> 注意:函数 *to_dict()* 、to_dict_meaning()、a *nd plot()* 在 Pytolemaic 的所有报告中都有。

正如您所看到的，在特性敏感度报告中有 3 个质量度量:

1.  插补—通过测量对洗牌的敏感度和对缺失值的敏感度之间的差异来测量插补的脆弱性。
2.  泄漏—通过比较敏感度得分来衡量数据泄漏的可能性。
3.  Too _ many _ features 通过计算低敏感度要素的数量来测量是否使用了过多的要素。

> 注意:漏洞报告背后的逻辑将在另一篇文章中解释。

**B .评分报告对于一个与上述 *pytrust* 对象相同的回归任务
，我们调用 *pytrust.scoring_report()* 来分析评分质量并创建一个 *ScoringFullReport* 对象。**

和以前一样，我们将对加州住房数据集使用随机森林回归变量。

**示例#4:创建评分报告**

评分报告信息，回归任务

**置信区间** *metric _ scores*为每个指标提供模型的性能*(值)*以及置信区间限制( *ci_low & ci_high* )。此外，它还提供了 *ci_ratio* —一个无量纲值，表示分数计算中的不确定性(越低越好)。在大多数情况下，性能评估的质量可以通过扩大测试集来提高。

**协方差移位**
*分离 _ 质量 m* 使用 ROC-AUC 测量训练集和测试集是否来自同一分布(也称为*协变量移位)*。因为这是一个“质量”指标，所以值越高越好。此处和[处](https://blog.bigml.com/2014/01/03/simple-machine-learning-to-detect-covariate-shift/)可以找到进一步的解释。

如前所述，使用*为评分报告创建图表。剧情()*

**示例#5:为评分报告创建图表**

评分报告图表，回归任务

可以看出，散点图包含误差线。这些误差线代表模型预测的不确定性。有关模型预测分析部分中不确定性计算的更多信息。

**C .分类任务评分报告** 分类任务评分报告结构相同，但提供的信息不同。

对于这个例子，我们将使用在 [UCI 的成人数据集](https://archive.ics.uci.edu/ml/datasets/Adult)上训练的随机森林分类器。

**例 6:创建评分报告**

评分报告信息，分类任务

> 注意:在该数据集中，训练集和测试集具有不同的分布。在现实生活的数据集中，如此低的值会引起关注。

和以前一样，我们可以绘制一些图表。

**示例#7:为评分报告创建图表**

评分报告图表，分类任务

# 模型预测分析

**A .预测的不确定性** Pytolemaic 软件包可以对模型预测中的不确定性进行估计。在回归任务的情况下，不确定性值代表误差条，与目标变量具有相同的标度。另一方面，在分类任务的情况下，不确定性值表示模型在预测中的不确定性，范围为 0(最大置信度)到 1(无置信度)。

该包支持几种技术，如下所列。因此，不确定度值的确切含义取决于所使用的方法。

**回归:**
* **MAE** :基于对测试集预测的绝对误差进行训练的回归量的绝对误差估计。
* **RMSE** :根据测试集预测的平方误差训练的回归量对绝对误差的估计。

**分类:**
* **概率**:基于第一和第二最可能类的概率值之比的不确定性度量。
* **置信度**:基于测试集预测训练的分类器的不确定性度量。

**示例**
对于不确定性示例，我们将像以前一样使用成人数据集。然而，这一次我们将只使用测试集的一半来初始化 PyTrust 对象，并使用另一半(姑且称之为*预测集*)来查看不确定性度量与预测误差之间的关系。

**例 8:根据“置信度”计算不确定度**

[完整代码在此](https://github.com/Broundal/Pytolemaic/blob/master/examples/interesting_examples/prediction_uncertainty_adult_dataset.py)

我们预计，不确定性较高的样本被错误分类的几率较高。现在，我们将根据预测集的样本各自的不确定性，通过宁滨验证这一点，然后测量每个箱中样本的召回率。

按照这个过程([代码，此处为](https://github.com/Broundal/Pytolemaic/blob/master/examples/interesting_examples/prediction_uncertainty_adult_dataset.py))我们得到了下图，它的行为就像我们预期的那样。

整个数据集的召回分数是 0.762。频段为[0–0.2，0.2–0.4，0.4–0.6，0.6–0.8，0.8–1.0]

**B .石灰说明**

对模型预测的时间解释是一种众所周知的方法。Pytolemaic 包本质上包装了 lime 的功能，同时在两个重要方面对其进行了改进:

1.  引入一种简单的插补方法来克服 lime 对缺失值的脆弱性。
2.  引入收敛机制以克服 lime 对生成的样本的敏感性。

# 摘要

该包实现了帮助验证模型是否按预期工作的技术。该软件包易于使用，旨在模型构建阶段使用，所以试试吧，让我知道你的想法。

在以后的文章中，我将详细阐述各种质量度量背后的逻辑，以及该软件包如何帮助您识别错误。

未来的工作将侧重于模型的预测(解释和不确定性)和测量数据集的质量。

我希望你喜欢这篇文章，并且发现 Pytolemaic 软件包很有趣。