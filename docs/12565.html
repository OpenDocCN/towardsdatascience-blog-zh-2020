<html>
<head>
<title>Data Labelling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ•°æ®æ ‡è®°</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/the-triple-barrier-method-251268419dcd?source=collection_archive---------5-----------------------#2020-08-30">https://towardsdatascience.com/the-triple-barrier-method-251268419dcd?source=collection_archive---------5-----------------------#2020-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="ae7d" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" rel="noopener" target="_blank" href="/feature-engineering-feature-selection-8c1d57af18d2">ğŸ“ˆPython for finance ç³»åˆ—</a></h2><div class=""/><div class=""><h2 id="f72e" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">ä¸‰é‡å±éšœæ³•</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/532fa590a169b098739bf728638c6be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bVGbvLJ6RPr3pxEOe335JA.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">ç”±<a class="ae lh" href="http://skuawk.com/" rel="noopener ugc nofollow" target="_blank">æˆ´å¤«Â·ç”˜è¿ª</a>æ ¹æ®<a class="ae lh" href="https://creativecommons.org/licenses/publicdomain/" rel="noopener ugc nofollow" target="_blank">å…¬å…±é¢†åŸŸä¸“ç”¨è®¸å¯</a>æ‹æ‘„çš„ç…§ç‰‡</p></figure><p id="7642" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> <em class="me">æ¥è‡ªã€Šèµ°å‘æ•°æ®ç§‘å­¦ã€‹ç¼–è¾‘çš„æç¤º:</em> </strong> <em class="me">è™½ç„¶æˆ‘ä»¬å…è®¸ç‹¬ç«‹ä½œè€…æ ¹æ®æˆ‘ä»¬çš„</em> <a class="ae lh" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="me">è§„åˆ™å’ŒæŒ‡å—</em> </a> <em class="me">å‘è¡¨æ–‡ç« ï¼Œä½†æˆ‘ä»¬å¹¶ä¸è®¤å¯æ¯ä¸ªä½œè€…çš„è´¡çŒ®ã€‚ä½ ä¸åº”è¯¥åœ¨æ²¡æœ‰å¯»æ±‚ä¸“ä¸šå»ºè®®çš„æƒ…å†µä¸‹ä¾èµ–ä¸€ä¸ªä½œè€…çš„ä½œå“ã€‚è¯¦è§æˆ‘ä»¬çš„</em> <a class="ae lh" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="me">è¯»è€…æœ¯è¯­</em> </a> <em class="me">ã€‚</em></p><p id="d242" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">è­¦å‘Š:è¿™é‡Œæ²¡æœ‰ç¥å¥‡çš„å…¬å¼æˆ–åœ£æ¯ï¼Œå°½ç®¡ä¸€ä¸ªæ–°çš„ä¸–ç•Œå¯èƒ½ä¼šä¸ºä½ æ‰“å¼€å¤§é—¨ã€‚</p><p id="707c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">æ³¨ 1: </strong>å¦‚ä½•å®‰è£…<a class="ae lh" href="https://github.com/hudson-and-thames/mlfinlab" rel="noopener ugc nofollow" target="_blank"> mlfinlab </a>åŒ…æ²¡æœ‰é”™è¯¯ä¿¡æ¯å¯ä»¥åœ¨<a class="ae lh" href="https://medium.com/@kegui/how-to-install-mlfinlab-without-error-messages-896e2fb43c2f" rel="noopener">è¿™é‡Œæ‰¾åˆ°</a>ã€‚</p><p id="17b9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">æ³¨ 2: </strong>å¦‚æœä½ æ­£åœ¨è¯»é©¬ç§‘æ–¯Â·æ™®æ‹‰å¤šçš„<a class="ae lh" href="https://www.amazon.com/Advances-Financial-Machine-Learning-Marcos/dp/1119482089" rel="noopener ugc nofollow" target="_blank">é‡‘èæœºå™¨å­¦ä¹ è¿›å±•</a>ã€‚<strong class="lk jd">ç¬¬ä¸ƒæœŸ<em class="me">ã€‚</em> </strong> <a class="ae lh" href="https://medium.com/swlh/fractionally-differentiated-features-9c1947ed2b55" rel="noopener"> <strong class="lk jd"> <em class="me">ç»†åˆ†ç‰¹å¾</em></strong></a><strong class="lk jd"><em class="me"/></strong>æ˜¯ç¬¬äº”ç« å…³äº<a class="ae lh" href="https://medium.com/swlh/fractionally-differentiated-features-9c1947ed2b55" rel="noopener">ç»†åˆ†ç‰¹å¾</a>ã€‚<strong class="lk jd"> <em class="me"> 8ã€‚</em> </strong> <a class="ae lh" rel="noopener" target="_blank" href="/the-triple-barrier-method-251268419dcd"> <strong class="lk jd"> <em class="me">æ•°æ®æ ‡æ³¨</em> </strong> </a>æ˜¯ç¬¬ä¸‰ç« å…³äºä¸‰é‡éšœæ³•ã€‚<em class="me">å’Œ</em> <strong class="lk jd"> <em class="me"> 9ã€‚</em> </strong> <a class="ae lh" rel="noopener" target="_blank" href="/meta-labeling-and-stacking-f17a7f9804ec"> <strong class="lk jd"> <em class="me">å…ƒæ ‡æ³¨</em></strong></a><strong class="lk jd"><em class="me"/></strong><em class="me">æ˜¯ç¬¬ 50 é¡µç¬¬ 3.6 ç« ã€‚æˆ‘è®¡åˆ’ä¸€æ­¥ä¸€æ­¥åœ°çœ‹å®Œæ¯ä¸€ç« ï¼Œå› ä¸ºæˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°æ¯ä¸€ç« ä¸­é‚£äº›æ¦‚å¿µçš„è¯¦ç»†è§£é‡Šã€‚æ•¬è¯·å…³æ³¨ï¼</em></p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="3174" class="mm mn it bd mo mp mq dn mr ms mt dp mu lr mv mw mx lv my mz na lz nb nc nd iz bi translated">ğŸ“ˆPython For Finance ç³»åˆ—</h2><ol class=""><li id="b687" class="ne nf it lk b ll ng lo nh lr ni lv nj lz nk md nl nm nn no bi translated"><a class="ae lh" href="https://medium.com/python-in-plain-english/identifying-outliers-part-one-c0a31d9faefa" rel="noopener">è¯†åˆ«å¼‚å¸¸å€¼</a></li><li id="9376" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md nl nm nn no bi translated"><a class="ae lh" href="https://medium.com/better-programming/identifying-outliers-part-two-4c00b2523362" rel="noopener">è¯†åˆ«å¼‚å¸¸å€¼â€”ç¬¬äºŒéƒ¨åˆ†</a></li><li id="62cb" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md nl nm nn no bi translated"><a class="ae lh" href="https://medium.com/swlh/identifying-outliers-part-three-257b09f5940b" rel="noopener">è¯†åˆ«å¼‚å¸¸å€¼â€”ç¬¬ä¸‰éƒ¨åˆ†</a></li><li id="58d2" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md nl nm nn no bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/data-whispering-eebb77a422da">ç¨‹å¼åŒ–çš„äº‹å®</a></li><li id="53ed" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md nl nm nn no bi translated"><a class="ae lh" href="https://medium.com/@kegui/feature-engineering-feature-selection-8c1d57af18d2" rel="noopener">ç‰¹å¾å·¥ç¨‹&amp;ç‰¹å¾é€‰æ‹©</a></li><li id="eae1" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md nl nm nn no bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/data-transformation-e7b3b4268151">æ•°æ®è½¬æ¢</a></li><li id="2d00" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md nl nm nn no bi translated"><a class="ae lh" href="https://medium.com/swlh/fractionally-differentiated-features-9c1947ed2b55" rel="noopener">å¾®å°å·®å¼‚ç‰¹å¾</a></li><li id="6243" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md nl nm nn no bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/the-triple-barrier-method-251268419dcd">æ•°æ®æ ‡ç­¾</a></li><li id="d898" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md nl nm nn no bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/meta-labeling-and-stacking-f17a7f9804ec">å…ƒæ ‡ç­¾å’Œå †å </a></li></ol></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="10ad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">ä¸‰é‡éšœç¢æ³•æ ¹æ®é©¬ç§‘æ–¯Â·æ™®æ‹‰å¤šåœ¨<a class="ae lh" href="https://www.amazon.com/Advances-Financial-Machine-Learning-Marcos/dp/1119482089" rel="noopener ugc nofollow" target="_blank">é‡‘èæœºå™¨å­¦ä¹ è¿›å±•</a>ç¬¬ä¸‰ç« ä¸­ä»‹ç»çš„ä¸‰ä¸ªéšœç¢ä¸­çš„ç¬¬ä¸€ä¸ªéšœç¢æ¥æ ‡è®°è§‚å¯Ÿç»“æœã€‚æ ‡è®°æ•°æ®çš„ä¼ ç»Ÿæ–¹æ³•æ˜¯ä½¿ç”¨ç¬¬äºŒå¤©(æ»å)å›æŠ¥å’Œå›ºå®šæ—¶é—´èŒƒå›´æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•å¯ä»¥æè¿°å¦‚ä¸‹ã€‚</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/6c6c96a354cd4940be760830cfe1e07a.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*AWMzL20Y5dEb-s3plU9AZw.png"/></div></figure><p id="d9c0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">å’Œ</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/0c0aa39c975f310f4120864850c155fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*zL47Cf0sWlBoFhyUV7i5og.png"/></div></figure><p id="4ade" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">è¿™ç§æµè¡Œçš„ä¼ ç»Ÿæ ‡ç­¾æ–¹æ³•æœ‰å‡ ä¸ªç¼ºç‚¹ã€‚é¦–å…ˆï¼Œæ—¶é—´æ¡æ²¡æœ‰è¡¨ç°å‡ºè‰¯å¥½çš„ç»Ÿè®¡ç‰¹æ€§ã€‚ç¬¬äºŒï¼Œä¸ç®¡è§‚å¯Ÿåˆ°çš„æ³¢åŠ¨æ€§å¦‚ä½•ï¼Œéƒ½åº”ç”¨ç›¸åŒçš„é˜ˆå€¼ğœã€‚åŸºæœ¬ä¸Šï¼Œæ ‡ç­¾ä¸èƒ½åæ˜ æŠ•èµ„çš„å½“å‰çŠ¶æ€ã€‚</p><p id="0aad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">æ­¤å¤–ï¼Œåœ¨çœŸå®æƒ…å†µä¸‹ï¼Œç¬¬äºŒå¤©ä½ å¯èƒ½ä¸æƒ³å–å‡ºã€‚å› æ­¤ï¼Œä¸‰é‡å±éšœæ–¹æ³•åœ¨å®è·µä¸­æ›´æœ‰æ„ä¹‰ï¼Œå› ä¸ºå®ƒæ˜¯è·¯å¾„ç›¸å…³çš„ã€‚ä½ å¯ä»¥æ ¹æ®ä½ è®¡åˆ’æŒæœ‰è‚¡ç¥¨çš„å¤©æ•°ä»¥åŠåœ¨æ­¤æœŸé—´è‚¡ç¥¨çš„å˜åŒ–åšå‡ºåˆç†çš„å†³å®šã€‚</p><p id="1f91" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">æ¥è‡ª<a class="ae lh" href="https://www.amazon.com/Advances-Financial-Machine-Learning-Marcos/dp/1119482089" rel="noopener ugc nofollow" target="_blank">é‡‘èæœºå™¨å­¦ä¹ è¿›å±•</a>ç¬¬ä¸‰ç« çš„åŸä»£ç æ˜¯ä¸ºé«˜é¢‘äº¤æ˜“è€Œåˆ›å»ºçš„ï¼Œä½¿ç”¨é«˜é¢‘æ•°æ®ï¼Œè€Œä¸”å¤§éƒ¨åˆ†æ˜¯æ—¥å†…æ•°æ®ã€‚å¦‚æœæ‚¨ä½¿ç”¨æ¯æ—¥æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ç¨å¾®è°ƒæ•´ä¸€ä¸‹ä»£ç ã€‚æˆ‘è¿˜ä»ä¹¦ä¸­æ‘˜å½•äº†å¤§éƒ¨åˆ†ä»£ç ï¼Œé€šè¿‡å¤§é‡ä½¿ç”¨<code class="fe nw nx ny nz b">padas</code> <code class="fe nw nx ny nz b">DataFrame</code>ç»“æ„å°†æ‰€æœ‰ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œä½¿å…¶å¯¹åˆå­¦è€…å‹å¥½ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå½“ä½ å¼€å§‹åˆ†ææˆ–ç»˜åˆ¶æ•°æ®æ—¶ï¼Œä»¥åçš„ç”Ÿæ´»ä¼šå˜å¾—å®¹æ˜“å¾—å¤šã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘é‡‡ç”¨äº†æ›´å¤æ‚çš„æ–¹æ³•ï¼Œå¦‚<a class="ae lh" href="https://en.wikipedia.org/wiki/Average_true_range" rel="noopener ugc nofollow" target="_blank">å¹³å‡çœŸå®èŒƒå›´</a>ä½œä¸ºæ¯æ—¥æ³¢åŠ¨ç‡ã€‚ä½ å¯ä»¥åœ¨æœ¬æ–‡æœ«å°¾çœ‹åˆ°æ‰€æœ‰çš„ä»£ç ã€‚</p><h1 id="f079" class="oa mn it bd mo ob oc od mr oe of og mu ki oh kj mx kl oi km na ko oj kp nd ok bi translated">ç›´è§‰</h1><p id="7fe8" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ol lt lu lv om lx ly lz on mb mc md im bi translated">è¿™ç§ç›´è§‰å°±åƒæˆ‘ä»¥å‰çš„æ–‡ç« ä¸­æè¿°çš„å‘ç°å¼‚å¸¸å€¼ä¸€æ ·ã€‚å¼‚å¸¸å€¼å°±åƒè‚¡ç¥¨äº¤æ˜“ä¸­çš„çªç ´ï¼Œå®ƒå®šä¹‰äº†æ‰€æœ‰çš„éšœç¢ï¼Œä¸ºä½ åšå‡ºä¹°å…¥æˆ–å–å‡ºçš„å†³å®šæä¾›äº†ä¸€ä¸ªçª—å£ã€‚å¦‚æœä½ æ²¡çœ‹è¿‡ï¼Œä½ å¯ä»¥éšæ—¶å›åˆ°<a class="ae lh" href="https://medium.com/python-in-plain-english/identifying-outliers-part-one-c0a31d9faefa" rel="noopener">è¿™é‡Œ</a>ï¼Œè¿™é‡Œ<a class="ae lh" href="https://medium.com/@kegui/identifying-outliers-part-two-4c00b2523362" rel="noopener">è¿™é‡Œ</a>ï¼Œè¿™é‡Œ<a class="ae lh" href="https://medium.com/swlh/identifying-outliers-part-three-257b09f5940b" rel="noopener">è¿™é‡Œ</a>ã€‚</p><p id="d10a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">æ ¹æ®é©¬ç§‘æ–¯Â·æ™®æ‹‰å¤šçš„<a class="ae lh" href="https://www.amazon.com/Advances-Financial-Machine-Learning-Marcos/dp/1119482089" rel="noopener ugc nofollow" target="_blank">é‡‘èæœºå™¨å­¦ä¹ è¿›å±•</a>ï¼Œä¸‰é‡éšœç¢æ³•æ˜¯:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oo"><img src="../Images/b3b321ade6e314c2e1ad8cff2651cc1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TLOp56_F6TcJadpiG9y6UQ.png"/></div></div></figure><p id="d8b6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬ç°åœ¨åšçš„æ˜¯:</p><p id="b0c5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">æˆ‘ä»¬ä¼šä¹°å…¥ä¸€åªè‚¡ç¥¨(æ¯”å¦‚è‹¹æœ)ï¼Œå¹¶æŒæœ‰ 10 å¤©ã€‚å¦‚æœä»·æ ¼ä¸‹è·Œå¹¶è§¦å‘æ­¢æŸè­¦æŠ¥ï¼Œæˆ‘ä»¬åœ¨æ­¢æŸç‚¹é€€å‡ºï¼Œæˆ–è€…å¦‚æœä»·æ ¼ä¸Šæ¶¨ï¼Œæˆ‘ä»¬åœ¨æŸä¸€ç‚¹è·åˆ©ã€‚åœ¨ä¸€ä¸ªæç«¯çš„ä¾‹å­ä¸­ï¼Œè‚¡ä»·æ¨ªå‘æ³¢åŠ¨ï¼Œæˆ‘ä»¬æŒæœ‰ä¸€æ®µæ—¶é—´ååœ¨æŸä¸€å¤©é€€å‡ºã€‚</p><p id="da6e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„è‚¡æƒç®¡ç†è§„åˆ™:</p><ul class=""><li id="e8ec" class="ne nf it lk b ll lm lo lp lr op lv oq lz or md os nm nn no bi translated">åœ¨ä¸€æ¬¡äº¤æ˜“ä¸­ï¼Œä¸è¦å†’é™©è¶…è¿‡ä½ æ€»èµ„æœ¬çš„ 2%ã€‚</li><li id="160e" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md os nm nn no bi translated">æ°¸è¿œåªçœ‹é‚£äº›ä½ ä¼šæœ‰ 3:1 æ”¶ç›Šæ¯”çš„äº¤æ˜“æœºä¼šã€‚</li></ul><p id="8114" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">åŸºäºè¿™äº›ç®€å•çš„è§„åˆ™ï¼Œæˆ‘ä»¬åœ¨æŠ•èµ„è‚¡ç¥¨ä¹‹å‰ä¼šåˆ¶å®šä¸€ä¸ªäº¤æ˜“è®¡åˆ’ã€‚è¦æŠŠè¿™ä¸ªäº¤æ˜“è®¡åˆ’èå…¥è‚¡ä»·è¿åŠ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸‰ä¸ªéšœç¢ã€‚è¿™ä¸‰ä¸ªéšœç¢æ˜¯ä»€ä¹ˆï¼Ÿå››æ¡çº¿å½¢æˆä¸€ä¸ªæ¡†æ¶ï¼Œå®šä¹‰ä¸€ä¸ªçª—å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ot"><img src="../Images/064ce6bd2540d67ac6edf0e998f81826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*613xZLRkVcV9KtG5V6QqUQ.png"/></div></div></figure><p id="8662" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">x è½´æ˜¯æ—¥æœŸæ—¶é—´ï¼Œy è½´æ˜¯è‚¡ç¥¨ä»·æ ¼ã€‚aã€d çº¿å±äº x è½´ï¼Œå³ datatime æŒ‡æ•°ï¼Œbã€c çº¿å±äº y è½´ï¼Œå³è‚¡ä»·ã€‚</p><p id="9e5a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">ç”²:å¼€å§‹æ—¥æœŸ</p><p id="747f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">b:æ­¢æŸå‡ºåœºä»·æ ¼</p><p id="cef2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">c:è·åˆ©é€€å‡ºä»·æ ¼</p><p id="e191" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">d:å¼€å§‹æ—¥æœŸ+æ‚¨è®¡åˆ’æŒæœ‰çš„å¤©æ•°ã€‚</p><p id="03ce" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">b å’Œ c ä¸å¿…ç›¸åŒã€‚è¯·è®°ä½ï¼Œæˆ‘ä»¬è¦è®¾ç½®è·åˆ©äº†ç»“å’Œæ­¢æŸé™é¢ï¼Œå®ƒä»¬æ˜¯æŠ¼æ³¨é£é™©çš„å‡½æ•°ã€‚æˆ‘ä»¬æ€»æ˜¯å¸Œæœ›åªäº¤æ˜“é‚£äº›ç›ˆåˆ©ç‡ä¸º 3:1 çš„æœºä¼šã€‚è¿™é‡Œè®¾ç½®<em class="me"> c = 3 * b </em>å°±è¡Œäº†ã€‚</p><p id="af7a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">å…³äºè¿™ä¸ªè¯é¢˜çš„è§†é¢‘å¾ˆå°‘ï¼Œæˆ‘åˆšåœ¨ YouTube ä¸Šæ‰¾åˆ°ä¸€ä¸ªã€‚</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="c066" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">å¥½äº†ï¼Œäº‹ä¸å®œè¿Ÿï¼Œè®©æˆ‘ä»¬æ·±å…¥ä»£ç ã€‚</p><h1 id="539f" class="oa mn it bd mo ob oc od mr oe of og mu ki oh kj mx kl oi km na ko oj kp nd ok bi translated">1.æ•°æ®å‡†å¤‡</h1><p id="9b72" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ol lt lu lv om lx ly lz on mb mc md im bi translated">ä¸ºäº†ä¿æŒä¸€è‡´ï¼Œåœ¨æ‰€æœ‰çš„<a class="ae lh" href="https://medium.com/swlh/identifying-outliers-part-three-257b09f5940b" rel="noopener">ğŸ“ˆPython for finance ç³»åˆ—</a>ï¼Œæˆ‘ä¼šå°½é‡é‡ç”¨ç›¸åŒçš„æ•°æ®ã€‚å…³äºæ•°æ®å‡†å¤‡çš„æ›´å¤šç»†èŠ‚å¯ä»¥åœ¨<a class="ae lh" href="https://medium.com/python-in-plain-english/identifying-outliers-part-one-c0a31d9faefa" rel="noopener">è¿™é‡Œ</a>ï¼Œè¿™é‡Œ<a class="ae lh" href="https://medium.com/@kegui/identifying-outliers-part-two-4c00b2523362" rel="noopener">è¿™é‡Œ</a>å’Œ<a class="ae lh" href="https://medium.com/swlh/identifying-outliers-part-three-257b09f5940b" rel="noopener">è¿™é‡Œ</a>æ‰¾åˆ°ï¼Œæˆ–è€…ä½ å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„<a class="ae lh" href="https://medium.com/@kegui/feature-engineering-feature-selection-8c1d57af18d2" rel="noopener">æ–‡ç« </a>ã€‚æˆ–è€…ï¼Œå¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥å¿½ç•¥ä¸‹é¢çš„æ‰€æœ‰ä»£ç ï¼Œä½¿ç”¨ä½ æ‰‹å¤´ä¸Šä»»ä½•å¹²å‡€çš„æ•°æ®ï¼Œè¿™ä¸ä¼šå½±å“æˆ‘ä»¬å°†è¦ä¸€èµ·åšçš„äº‹æƒ…ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="48d7" class="mm mn it nz b gy pa pb l pc pd">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>plt.style.use('seaborn')</span><span id="ff9d" class="mm mn it nz b gy pe pb l pc pd">plt.rcParams['figure.figsize'] = [16, 9]<br/>plt.rcParams['figure.dpi'] = 300<br/>plt.rcParams['font.size'] = 20<br/>plt.rcParams['axes.labelsize'] = 20<br/>plt.rcParams['axes.titlesize'] = 24<br/>plt.rcParams['xtick.labelsize'] = 16<br/>plt.rcParams['ytick.labelsize'] = 16<br/>plt.rcParams['font.family'] = 'serif'</span><span id="155e" class="mm mn it nz b gy pe pb l pc pd">import yfinance as yf</span><span id="efa4" class="mm mn it nz b gy pe pb l pc pd">def get_data(symbols, begin_date=None,end_date=None):<br/>    df = yf.download('AAPL', start = begin_date,<br/>                     auto_adjust=True,#only download adjusted data<br/>                     end= end_date) <br/>    #my convention: always lowercase<br/>    df.columns = ['open','high','low',<br/>                  'close','volume'] <br/>    <br/>    return df</span><span id="a500" class="mm mn it nz b gy pe pb l pc pd">Apple_stock = get_data('AAPL', '2000-01-01', '2010-12-31')   <br/>price = Apple_stock['close']</span></pre><h1 id="d5e6" class="oa mn it bd mo ob oc od mr oe of og mu ki oh kj mx kl oi km na ko oj kp nd ok bi translated">2.æ¯æ—¥æ³¢åŠ¨</h1><p id="df98" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ol lt lu lv om lx ly lz on mb mc md im bi translated">è·å–æ—¥æ³¢åŠ¨ç‡çš„åŸå§‹ä»£ç (å¦‚ä¸‹)æ˜¯é’ˆå¯¹æ—¥å†…æ•°æ®çš„ï¼Œæ—¥å†…æ•°æ®æ˜¯æ²¡æœ‰å‘¨æœ«ã€éå·¥ä½œæ—¥ç­‰çš„è¿ç»­æ•°æ®<em class="me">ã€‚</em>ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="cb8f" class="mm mn it nz b gy pa pb l pc pd">def getDailyVol(close,span0=100):<br/>    # daily vol, reindexed to close<br/>    df0=close.index.searchsorted(close.index-pd.Timedelta(days=1))<br/>    df0=df0[df0&gt;0]<br/>    df0=pd.Series(close.index[df0 â€“ 1], <br/>                  index=close.index[close.shape[0]-df0.shape[0]:])<br/>    df0=close.loc[df0.index]/close.loc[df0.values].values-1 <br/>    # daily returns<br/>    df0=df0.ewm(span=span0).std()<br/>    return df0</span></pre><p id="be01" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">å¦‚æœä½ è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯:<code class="fe nw nx ny nz b"><strong class="lk jd">SyntaxError:</strong> invalid character in identifier</code>ï¼Œé‚£æ˜¯å› ä¸º<code class="fe nw nx ny nz b">close.index[df0â€“1]</code>ã€‚å¯ä»¥è¿™æ ·è§£å†³:</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="5c76" class="mm mn it nz b gy pa pb l pc pd">def getDailyVol(close,span0=100):<br/>    # daily vol, reindexed to close<br/>    df0=close.index.searchsorted(close.index-pd.Timedelta(days=1))<br/>    df0=df0[df0&gt;0]<br/>    a = df0 -1 #using a variable to avoid the error message.<br/>    df0=pd.Series(close.index[a], <br/>                  index=close.index[close.shape[0]-df0.shape[0]:])<br/>    df0=close.loc[df0.index]/close.loc[df0.values].values-1 <br/>    # daily returns<br/>    df0=df0.ewm(span=span0).std()<br/>    return df0</span></pre><p id="aed3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">å¦‚æœä½ ä½¿ç”¨æ¯æ—¥æ•°æ®è€Œä¸æ˜¯æ—¥å†…æ•°æ®ï¼Œä½ å°†ä¼šå¾—åˆ°å¾ˆå¤šé‡å¤çš„æ•°æ®ï¼Œå› ä¸ºæ—¥æœŸå‘åç§»åŠ¨äº†ä¸€å¤©ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´å¾ˆå¤šéå·¥ä½œæ—¥çš„æ•°æ®ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="06b9" class="mm mn it nz b gy pa pb l pc pd">df0=close.index.searchsorted(close.index-pd.Timedelta(days=1))<br/>pd.Series(df0).value_counts()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/e781b3264889045c2cbe82113a993bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/format:webp/1*dsn3HsFwu7aXn-USFSITkg.png"/></div></figure><p id="3713" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">2766â€“2189 = 577 ä¸ªå‰¯æœ¬ã€‚</p><p id="6a32" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">å¯¹äºæ¯æ—¥æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç®€å•çš„ç™¾åˆ†æ¯”å›æŠ¥ç‡çš„æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡çº¿(EWM)ä½œä¸ºæ³¢åŠ¨ç‡ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="cbec" class="mm mn it nz b gy pa pb l pc pd">def get_Daily_Volatility(close,span0=20):<br/>    # simple percentage returns<br/>    df0=close.pct_change()<br/>    # 20 days, a month EWM's std as boundary<br/>    df0=df0.ewm(span=span0).std()<br/>    df0.dropna(inplace=True)<br/>    return df0</span><span id="6a87" class="mm mn it nz b gy pe pb l pc pd">df0 = get_Daily_Volatility(price)<br/>df0</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/7a4d35c7e7eb2ae69b5b35e0363dbbca.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*RI6cQOsfki7QxKohiWvMPg.png"/></div></figure><p id="cf53" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">æ ¹æ®é—®é¢˜çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ›´å¤æ‚çš„æ–¹æ³•ï¼Œå¦‚<a class="ae lh" href="https://www.investopedia.com/terms/a/atr.asp#:~:text=Average%20true%20range%20(ATR)%20is%20a%20technical%20indicator%20measuring%20market,to%20all%20types%20of%20securities." rel="noopener ugc nofollow" target="_blank">å¹³å‡çœŸå®èŒƒå›´</a>(æŠ€æœ¯åˆ†ææŒ‡æ ‡<a class="ae lh" href="https://www.investopedia.com/articles/trading/08/average-true-range.asp" rel="noopener ugc nofollow" target="_blank">è¡¡é‡å¸‚åœºæ³¢åŠ¨</a>)ã€‚</p><p id="c02d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">ATR çš„å…¬å¼æ˜¯:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/442a713c7c083f3b10af05cc22552d39.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*gscL3oGZ-RDfQEwUSkFjxA.png"/></div></figure><p id="67a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">è®¡ç®— ATR çš„ç¬¬ä¸€æ­¥æ˜¯æ‰¾åˆ°ä¸€ç³»åˆ—è‚¡ç¥¨ä»·æ ¼çš„çœŸå®èŒƒå›´å€¼ã€‚ç»™å®šäº¤æ˜“æ—¥çš„èµ„äº§ä»·æ ¼èŒƒå›´å°±æ˜¯å…¶æœ€é«˜ä»·å‡å»æœ€ä½ä»·ï¼Œè€ŒçœŸå®èŒƒå›´æ˜¯å½“å‰æœ€é«˜ä»·å‡å»å½“å‰æœ€ä½ä»·ï¼›å½“å‰é«˜ç‚¹çš„<a class="ae lh" href="https://www.investopedia.com/terms/a/absolute-value.asp" rel="noopener ugc nofollow" target="_blank">ç»å¯¹å€¼</a>å‡å»å‰ä¸€æ¬¡æ”¶ç›˜ï¼›å’Œå½“å‰ä½ç‚¹å‡å»å‰ä¸€ä¸ªæ”¶ç›˜ç‚¹çš„ç»å¯¹å€¼ã€‚å¹³å‡çœŸå®èŒƒå›´æ˜¯çœŸå®èŒƒå›´çš„<a class="ae lh" href="https://www.investopedia.com/terms/m/movingaverage.asp" rel="noopener ugc nofollow" target="_blank">ç§»åŠ¨å¹³å‡</a>ï¼Œé€šå¸¸ä½¿ç”¨ 14 å¤©ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="ccbd" class="mm mn it nz b gy pa pb l pc pd">def get_atr(stock, win=14):<br/>    <br/>    atr_df = pd.Series(index=stock.index)<br/>    high = pd.Series(Apple_stock.high.rolling( \<br/>                     win, min_periods=win))<br/>    low = pd.Series(Apple_stock.low.rolling( \<br/>                    win, min_periods=win))<br/>    close = pd.Series(Apple_stock.close.rolling( \<br/>                      win, min_periods=win))    <br/>          <br/>    for i in range(len(stock.index)):<br/>        tr=np.max([(high[i] - low[i]), \<br/>                  np.abs(high[i] - close[i]), \<br/>                  np.abs(low[i] - close[i])], \<br/>                  axis=0)</span><span id="caf4" class="mm mn it nz b gy pe pb l pc pd">        atr_df[i] = tr.sum() / win<br/>     <br/>    return  atr_df</span><span id="6240" class="mm mn it nz b gy pe pb l pc pd">get_atr(Apple_stock, 14)<br/>atr_df</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/faa3ae3632ec8e517c0b503c45044c1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:418/format:webp/1*3ke517e0fmhUesmN2Csi7g.png"/></div></figure><h1 id="8e41" class="oa mn it bd mo ob oc od mr oe of og mu ki oh kj mx kl oi km na ko oj kp nd ok bi translated">3.ä¸‰é‡å±éšœ</h1><p id="c869" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ol lt lu lv om lx ly lz on mb mc md im bi translated">åœ¨æˆ‘ä»¬å¼€å§‹ç ”ç©¶æŠ¤æ ä¹‹å‰ï¼Œéœ€è¦ç¡®å®šå‡ ä¸ªå‚æ•°ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="175a" class="mm mn it nz b gy pa pb l pc pd">#set the boundary of barriers, based on 20 days EWM<br/>daily_volatility = get_Daily_Volatility(price)<br/># how many days we hold the stock which set the vertical barrier<br/>t_final = 10 <br/>#the up and low boundary multipliers<br/>upper_lower_multipliers = [2, 2]</span><span id="6432" class="mm mn it nz b gy pe pb l pc pd">#allign the index<br/>prices = price[daily_volatility.index]</span></pre><p id="7f9c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">è¿™é‡Œï¼Œæˆ‘å°†ä½¿ç”¨<code class="fe nw nx ny nz b">pd.DataFrame</code>ä½œä¸ºå®¹å™¨ï¼Œå°†æ‰€æœ‰ä¿¡æ¯æ·»åŠ åˆ°ä¸€ä¸ªåœ°æ–¹ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="7d12" class="mm mn it nz b gy pa pb l pc pd">def get_3_barriers():<br/>    #create a container<br/>    barriers = pd.DataFrame(columns=['days_passed', <br/>              'price', 'vert_barrier', \<br/>              'top_barrier', 'bottom_barrier'], \<br/>               index = daily_volatility.index)</span><span id="5fb2" class="mm mn it nz b gy pe pb l pc pd">    for day, vol in daily_volatility.iteritems():<br/>        days_passed = len(daily_volatility.loc \<br/>                      [daily_volatility.index[0] : day])</span><span id="790d" class="mm mn it nz b gy pe pb l pc pd">        #set the vertical barrier <br/>        if (days_passed + t_final &lt; len(daily_volatility.index) \<br/>            and t_final != 0):<br/>            vert_barrier = daily_volatility.index[<br/>                                days_passed + t_final]<br/>        else:<br/>            vert_barrier = np.nan</span><span id="69e7" class="mm mn it nz b gy pe pb l pc pd">        #set the top barrier<br/>        if upper_lower_multipliers[0] &gt; 0:<br/>            top_barrier = prices.loc[day] + prices.loc[day] * \<br/>                          upper_lower_multipliers[0] * vol<br/>        else:<br/>            #set it to NaNs<br/>            top_barrier = pd.Series(index=prices.index)</span><span id="9767" class="mm mn it nz b gy pe pb l pc pd">        #set the bottom barrier<br/>        if upper_lower_multipliers[1] &gt; 0:<br/>            bottom_barrier = prices.loc[day] - prices.loc[day] * \<br/>                          upper_lower_multipliers[1] * vol<br/>        else: <br/>            #set it to NaNs<br/>            bottom_barrier = pd.Series(index=prices.index)</span><span id="f387" class="mm mn it nz b gy pe pb l pc pd">        barriers.loc[day, ['days_passed', 'price', <br/>        'vert_barrier','top_barrier', 'bottom_barrier']] = \<br/>         days_passed, prices.loc[day], vert_barrier, <br/>         top_barrier, bottom_barrier</span><span id="785f" class="mm mn it nz b gy pe pb l pc pd">   return barriers</span></pre><p id="d27b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">è®©æˆ‘ä»¬çœ‹çœ‹æ‰€æœ‰çš„éšœç¢ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="a974" class="mm mn it nz b gy pa pb l pc pd">barriers = get_barriers()<br/>barriers</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/c96d5bb19d2763cd9eb349ecfbf8169c.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*A_OeDEWBu22MfrYDL66Axg.png"/></div></figure><p id="215b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">å¹¶ä»”ç»†æŸ¥çœ‹æ‰€æœ‰æ•°æ®ä¿¡æ¯ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="8b06" class="mm mn it nz b gy pa pb l pc pd">barriers.info()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/bcd18097ae8d1d5f6e5ea9c34a9a8798.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*gUlCa1wtPET-l5LNRJ_gww.png"/></div></figure><p id="a9aa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">åªæœ‰<code class="fe nw nx ny nz b">vert_barrier</code>æœ€åæœ‰ 11 ä¸ª<code class="fe nw nx ny nz b">NaN</code>å€¼ï¼Œå› ä¸º<code class="fe nw nx ny nz b">t_final</code>è¢«è®¾ç½®ä¸º 10 å¤©ã€‚</p><p id="9aa4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">ä¸‹ä¸€æ­¥æ˜¯æ ¹æ®å“ªä¸ªéšœç¢é¦–å…ˆè¢«è§¦åŠæ¥æ ‡è®°æ¯ä¸ªæ¡ç›®ã€‚æˆ‘åœ¨<code class="fe nw nx ny nz b">barriers</code>çš„æœ«å°¾æ·»åŠ äº†ä¸€ä¸ªæ–°åˆ—<code class="fe nw nx ny nz b">â€˜outâ€™</code>ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="bbd8" class="mm mn it nz b gy pa pb l pc pd">barriers['out'] = None<br/>barriers.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/15cf15cab292cad727f5f8d22a42a25b.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*1FxoHFStXTw1xOx9rOwBbg.png"/></div></figure><p id="b27c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ ‡ç­¾ä¸Šå·¥ä½œã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="185b" class="mm mn it nz b gy pa pb l pc pd">def get_labels():<br/>'''<br/>start: first day of the window<br/>end:last day of the window<br/>price_initial: first day stock price<br/>price_final:last day stock price<br/>top_barrier: profit taking limit<br/>bottom_barrier:stop loss limt<br/>condition_pt:top_barrier touching conditon<br/>condition_sl:bottom_barrier touching conditon</span><span id="931a" class="mm mn it nz b gy pe pb l pc pd">'''</span><span id="9150" class="mm mn it nz b gy pe pb l pc pd">    for i in range(len(barriers.index)):</span><span id="d11b" class="mm mn it nz b gy pe pb l pc pd">        start = barriers.index[i]<br/>        end = barriers.vert_barrier[i]</span><span id="300e" class="mm mn it nz b gy pe pb l pc pd">        if pd.notna(end):<br/>            # assign the initial and final price<br/>            price_initial = barriers.price[start]<br/>            price_final = barriers.price[end]</span><span id="beac" class="mm mn it nz b gy pe pb l pc pd">            # assign the top and bottom barriers<br/>            top_barrier = barriers.top_barrier[i]<br/>            bottom_barrier = barriers.bottom_barrier[i]</span><span id="d15b" class="mm mn it nz b gy pe pb l pc pd">            #set the profit taking and stop loss conditons<br/>            condition_pt = (barriers.price[start: end] &gt;= \<br/>             top_barrier).any()<br/>            condition_sl = (barriers.price[start: end] &lt;= \<br/>             bottom_barrier).any()</span><span id="baea" class="mm mn it nz b gy pe pb l pc pd">            #assign the labels<br/>            if condition_pt: <br/>                barriers['out'][i] = 1<br/>            elif condition_sl: <br/>                barriers['out'][i] = -1    <br/>            else: <br/>                barriers['out'][i] = max(<br/>                          [(price_final - price_initial)/ <br/>                           (top_barrier - price_initial), \<br/>                           (price_final - price_initial)/ \<br/>                           (price_initial - bottom_barrier)],\<br/>                            key=abs)<br/> return</span><span id="4207" class="mm mn it nz b gy pe pb l pc pd">get_labels()<br/>barriers</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/8c6e9f0486a0d8792cd538d5b7ff0467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*7sQVW9YvSAHEL0sk7kxk-w.png"/></div></figure><p id="6f4e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">æˆ‘ä»¬å¯ä»¥ç”»å‡ºâ€˜outâ€™æ¥çœ‹å®ƒçš„åˆ†å¸ƒã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="fa51" class="mm mn it nz b gy pa pb l pc pd">plt.plot(barriers.out,'bo')</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/db1c0e76f4468a264b4e4de8f053bfbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*8q08G8hZz9Fe0QsbmI1bbQ.png"/></div></figure><p id="2816" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">å¹¶è®¡ç®—è§¦å‘äº†å¤šå°‘è·åˆ©å›åå’Œæ­¢æŸé™åˆ¶ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="5fac" class="mm mn it nz b gy pa pb l pc pd">barriers.out.value_counts()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi po"><img src="../Images/df7baf6cac179c82f652d309587531ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*Dybc4iHXwbKGa2FRfCqX0w.png"/></div></figure><p id="e327" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">2764 ä¸ªæ•°æ®ç‚¹ä¸­æœ‰ 1385 ä¸ªè·åˆ©äº†ç»“ï¼Œ837 ä¸ªæ­¢æŸã€‚542 ä¸ªæ¡ˆä¾‹é€€å‡ºæ˜¯å› ä¸ºæ—¶é—´åˆ°äº†ã€‚</p><p id="2760" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©ä¸€ä¸ªéšæœºçš„æ—¥æœŸï¼Œå¹¶åœ¨å›¾è¡¨ä¸Šæ˜¾ç¤ºå‡ºæ¥ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="0474" class="mm mn it nz b gy pa pb l pc pd">fig,ax = plt.subplots()<br/>ax.set(title='Apple stock price',<br/>       xlabel='date', ylabel='price')<br/>ax.plot(barriers.price[100: 200])</span><span id="ce19" class="mm mn it nz b gy pe pb l pc pd">start = barriers.index[120]<br/>end = barriers.vert_barrier[120]<br/>upper_barrier = barriers.top_barrier[120]<br/>lower_barrier = barriers.bottom_barrier[120]<br/>ax.plot([start, end], [upper_barrier, upper_barrier], 'r--');<br/>ax.plot([start, end], [lower_barrier, lower_barrier], 'r--');<br/>ax.plot([start, end], [(lower_barrier + upper_barrier)*0.5, \<br/>                       (lower_barrier + upper_barrier)*0.5], 'r--');<br/>ax.plot([start, start], [lower_barrier, upper_barrier], 'r-');<br/>ax.plot([end, end], [lower_barrier, upper_barrier], 'r-');</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ot"><img src="../Images/7ee5ec76cd232f8d0ca67fb75636a89a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LE9GlD1dVy-M1Y7hmOON4Q.png"/></div></div></figure><p id="0560" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">æˆ‘ä»¬è¿˜å¯ä»¥ç”¨ easy ç»˜åˆ¶ä¸€ä¸ªåŠ¨æ€å›¾ã€‚</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="0d1a" class="mm mn it nz b gy pa pb l pc pd">fig,ax = plt.subplots()<br/>ax.set(title='Apple stock price',<br/>       xlabel='date', ylabel='price')<br/>ax.plot(barriers.price[100: 200])</span><span id="892d" class="mm mn it nz b gy pe pb l pc pd">start = barriers.index[120]<br/>end = barriers.index[120+t_final]<br/>upper_barrier = barriers.top_barrier[120]<br/>lower_barrier = barriers.bottom_barrier[120]<br/>ax.plot(barriers.index[120:120+t_final+1], barriers.top_barrier[start:end], 'r--');<br/>ax.plot(barriers.index[120:120+t_final+1], barriers.bottom_barrier[start:end], 'r--');<br/>ax.plot([start, end], [(lower_barrier + upper_barrier)*0.5, \<br/>                       (lower_barrier + upper_barrier)*0.5], 'r--');<br/>ax.plot([start, start], [lower_barrier, upper_barrier], 'r-');<br/>ax.plot([end, end], [barriers.bottom_barrier[end], barriers.top_barrier[end]], 'r-');</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/53acb4908669d5f48b98dc5967f3e630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*aRd48lCCxHeESnOptLW7ag.png"/></div></figure><p id="f436" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">å›é¡¾æˆ‘ä»¬æ‹¥æœ‰çš„å‚æ•°:</strong></p><ul class=""><li id="f12a" class="ne nf it lk b ll lm lo lp lr op lv oq lz or md os nm nn no bi translated">æ•°æ®:è‹¹æœ 10 å¹´è‚¡ä»·</li><li id="3b18" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md os nm nn no bi translated">ä¿æŒæ—¶é—´:ä¸è¶…è¿‡ 10 å¤©</li><li id="7483" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md os nm nn no bi translated">è·åˆ©å›åç•Œé™:20 å¤©è¿”å› EWM æ ‡å‡†çš„ 2 å€</li><li id="567d" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md os nm nn no bi translated">æ­¢æŸè¾¹ç•Œ:20 å¤©è¿”å› EWM æ ‡å‡†çš„ 2 å€</li></ul><p id="124f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">æˆ‘ä»¬åœ¨çœŸå®æ¡ˆä¾‹ä¸­æœŸå¾…çš„è§„åˆ™:</strong></p><ul class=""><li id="908f" class="ne nf it lk b ll lm lo lp lr op lv oq lz or md os nm nn no bi translated">æ°¸è¿œåªå…³æ³¨é‚£äº›ä½ å°†ä¼šæœ‰ 3:1 ç›ˆåˆ©ç‡çš„äº¤æ˜“æœºä¼šã€‚</li><li id="0fe7" class="ne nf it lk b ll np lo nq lr nr lv ns lz nt md os nm nn no bi translated">åœ¨ä¸€æ¬¡äº¤æ˜“ä¸­ï¼Œä¸è¦å†’é™©è¶…è¿‡ä½ æ€»èµ„æœ¬çš„ 2%ã€‚</li></ul><p id="ddee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">ç¬¬ä¸€æ¡è§„åˆ™å¯ä»¥é€šè¿‡è®¾ç½®<code class="fe nw nx ny nz b">upper_lower_multipliers = [3, 1]</code>è½»æ¾å®ç°ã€‚ç¬¬äºŒä¸ªæ˜¯å…³äºäº¤æ˜“è§„æ¨¡ï¼Œè¾¹ä¹˜ä»¥è§„æ¨¡å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¡ç®—é£é™©(ä¿è¯é‡‘/ä¼˜åŠ¿)ã€‚è¿™å°†æ˜¯ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­çš„å…ƒæ ‡ç­¾ã€‚æ‰€ä»¥ï¼Œæ•¬è¯·æœŸå¾…ï¼</p><p id="a2d8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">ä»¥ä¸‹æ˜¯æ‰€æœ‰ä»£ç :</p><pre class="ks kt ku kv gt ow nz ox oy aw oz bi"><span id="b156" class="mm mn it nz b gy pa pb l pc pd">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>plt.style.use('seaborn')</span><span id="4558" class="mm mn it nz b gy pe pb l pc pd">plt.rcParams['figure.figsize'] = [16, 9]<br/>plt.rcParams['figure.dpi'] = 300<br/>plt.rcParams['font.size'] = 20<br/>plt.rcParams['axes.labelsize'] = 20<br/>plt.rcParams['axes.titlesize'] = 24<br/>plt.rcParams['xtick.labelsize'] = 16<br/>plt.rcParams['ytick.labelsize'] = 16<br/>plt.rcParams['font.family'] = 'serif'</span><span id="4fb2" class="mm mn it nz b gy pe pb l pc pd">import yfinance as yf</span><span id="0b88" class="mm mn it nz b gy pe pb l pc pd">def get_data(symbols, begin_date=None,end_date=None):<br/>    df = yf.download('AAPL', start = begin_date,<br/>                     auto_adjust=True,#only download adjusted data<br/>                     end= end_date) <br/>    #my convention: always lowercase<br/>    df.columns = ['open','high','low',<br/>                  'close','volume'] <br/>    <br/>    return df</span><span id="375c" class="mm mn it nz b gy pe pb l pc pd">Apple_stock = get_data('AAPL', '2000-01-01', '2010-12-31')   <br/>price = Apple_stock['close']</span><span id="858a" class="mm mn it nz b gy pe pb l pc pd">def get_Daily_Volatility(close,span0=20):<br/>    # simple percentage returns<br/>    df0=close.pct_change()<br/>    # 20 days, a month EWM's std as boundary<br/>    df0=df0.ewm(span=span0).std()<br/>    df0.dropna(inplace=True)<br/>    return df0</span><span id="95bd" class="mm mn it nz b gy pe pb l pc pd">df0 = get_Daily_Volatility(price)</span><span id="a35f" class="mm mn it nz b gy pe pb l pc pd">def get_atr(stock, win=14):<br/>    <br/>    atr_df = pd.Series(index=stock.index)<br/>    high = pd.Series(Apple_stock.high.rolling( \<br/>                     win, min_periods=win))<br/>    low = pd.Series(Apple_stock.low.rolling( \<br/>                    win, min_periods=win))<br/>    close = pd.Series(Apple_stock.close.rolling( \<br/>                      win, min_periods=win))    <br/>          <br/>    for i in range(len(stock.index)):<br/>        tr=np.max([(high[i] - low[i]), \<br/>                  np.abs(high[i] - close[i]), \<br/>                  np.abs(low[i] - close[i])], \<br/>                  axis=0)</span><span id="2a7b" class="mm mn it nz b gy pe pb l pc pd">    atr_df[i] = tr.sum() / win<br/>     <br/>    return  atr_df</span><span id="6a7d" class="mm mn it nz b gy pe pb l pc pd">#set the boundary of barriers, based on 20 days EWM<br/>daily_volatility = get_Daily_Volatility(price)<br/># how many days we hold the stock which set the vertical barrier<br/>t_final = 10 <br/>#the up and low boundary multipliers<br/>upper_lower_multipliers = [2, 2]</span><span id="c310" class="mm mn it nz b gy pe pb l pc pd">#allign the index<br/>prices = price[daily_volatility.index]</span><span id="acef" class="mm mn it nz b gy pe pb l pc pd">def get_3_barriers():<br/>    #create a container<br/>    barriers = pd.DataFrame(columns=['days_passed', <br/>              'price', 'vert_barrier', \<br/>              'top_barrier', 'bottom_barrier'], \<br/>               index = daily_volatility.index)</span><span id="1742" class="mm mn it nz b gy pe pb l pc pd">   for day, vol in daily_volatility.iteritems():<br/>        days_passed = len(daily_volatility.loc \<br/>                      [daily_volatility.index[0] : day])</span><span id="8556" class="mm mn it nz b gy pe pb l pc pd">        #set the vertical barrier <br/>        if (days_passed + t_final &lt; len(daily_volatility.index) \<br/>            and t_final != 0):<br/>            vert_barrier = daily_volatility.index[<br/>                                days_passed + t_final]<br/>        else:<br/>            vert_barrier = np.nan</span><span id="de67" class="mm mn it nz b gy pe pb l pc pd">        #set the top barrier<br/>        if upper_lower_multipliers[0] &gt; 0:<br/>            top_barrier = prices.loc[day] + prices.loc[day] * \<br/>                          upper_lower_multipliers[0] * vol<br/>        else:<br/>            #set it to NaNs<br/>            top_barrier = pd.Series(index=prices.index)</span><span id="a457" class="mm mn it nz b gy pe pb l pc pd">        #set the bottom barrier<br/>        if upper_lower_multipliers[1] &gt; 0:<br/>            bottom_barrier = prices.loc[day] - prices.loc[day] * \<br/>                          upper_lower_multipliers[1] * vol<br/>        else: <br/>            #set it to NaNs<br/>            bottom_barrier = pd.Series(index=prices.index)</span><span id="863e" class="mm mn it nz b gy pe pb l pc pd">        barriers.loc[day, ['days_passed', 'price', \<br/>        'vert_barrier','top_barrier', 'bottom_barrier']] = \<br/>         days_passed, prices.loc[day], vert_barrier, \<br/>         top_barrier, bottom_barrier</span><span id="9485" class="mm mn it nz b gy pe pb l pc pd">return barriers</span><span id="95ed" class="mm mn it nz b gy pe pb l pc pd">def get_labels():<br/>'''<br/>start: first day of the window<br/>end:last day of the window<br/>price_initial: first day stock price<br/>price_final:last day stock price<br/>top_barrier: profit taking limit<br/>bottom_barrier:stop loss limt<br/>condition_pt:top_barrier touching conditon<br/>condition_sl:bottom_barrier touching conditon</span><span id="9d7f" class="mm mn it nz b gy pe pb l pc pd">'''</span><span id="d9df" class="mm mn it nz b gy pe pb l pc pd">for i in range(len(barriers.index)):</span><span id="7d0b" class="mm mn it nz b gy pe pb l pc pd">start = barriers.index[i]<br/>        end = barriers.vert_barrier[i]</span><span id="bc15" class="mm mn it nz b gy pe pb l pc pd">if pd.notna(end):<br/>            # assign the initial and final price<br/>            price_initial = barriers.price[start]<br/>            price_final = barriers.price[end]</span><span id="7545" class="mm mn it nz b gy pe pb l pc pd"># assign the top and bottom barriers<br/>            top_barrier = barriers.top_barrier[i]<br/>            bottom_barrier = barriers.bottom_barrier[i]</span><span id="e94a" class="mm mn it nz b gy pe pb l pc pd">#set the profit taking and stop loss conditons<br/>            condition_pt = (barriers.price[start: end] &gt;= \<br/>             top_barrier).any()<br/>            condition_sl = (barriers.price[start: end] &lt;= \<br/>             bottom_barrier).any()</span><span id="6808" class="mm mn it nz b gy pe pb l pc pd">#assign the labels<br/>            if condition_pt: <br/>                barriers['out'][i] = 1<br/>            elif condition_sl: <br/>                barriers['out'][i] = -1    <br/>            else: <br/>                barriers['out'][i] = max(<br/>                          [(price_final - price_initial)/ <br/>                           (top_barrier - price_initial), \<br/>                           (price_final - price_initial)/ \<br/>                           (price_initial - bottom_barrier)],\<br/>                            key=abs)<br/> return</span><span id="5a9e" class="mm mn it nz b gy pe pb l pc pd">get_labels()<br/>barriers</span><span id="ff8a" class="mm mn it nz b gy pe pb l pc pd">fig,ax = plt.subplots()<br/>ax.set(title='Apple stock price',<br/>       xlabel='date', ylabel='price')<br/>ax.plot(barriers.price[100: 200])</span><span id="a1ff" class="mm mn it nz b gy pe pb l pc pd">start = barriers.index[120]<br/>end = barriers.vert_barrier[120]<br/>upper_barrier = barriers.top_barrier[120]<br/>lower_barrier = barriers.bottom_barrier[120]<br/>ax.plot([start, end], [upper_barrier, upper_barrier], 'r--');<br/>ax.plot([start, end], [lower_barrier, lower_barrier], 'r--');<br/>ax.plot([start, end], [(lower_barrier + upper_barrier)*0.5, \<br/>                       (lower_barrier + upper_barrier)*0.5], 'r--');<br/>ax.plot([start, start], [lower_barrier, upper_barrier], 'r-');<br/>ax.plot([end, end], [lower_barrier, upper_barrier], 'r-');</span><span id="0974" class="mm mn it nz b gy pe pb l pc pd">#dynamic graph<br/>fig,ax = plt.subplots()<br/>ax.set(title='Apple stock price',<br/>       xlabel='date', ylabel='price')<br/>ax.plot(barriers.price[100: 200])</span><span id="5a22" class="mm mn it nz b gy pe pb l pc pd">start = barriers.index[120]<br/>end = barriers.index[120+t_final]<br/>upper_barrier = barriers.top_barrier[120]<br/>lower_barrier = barriers.bottom_barrier[120]<br/>ax.plot(barriers.index[120:120+t_final+1], barriers.top_barrier[start:end], 'r--');<br/>ax.plot(barriers.index[120:120+t_final+1], barriers.bottom_barrier[start:end], 'r--');<br/>ax.plot([start, end], [(lower_barrier + upper_barrier)*0.5, \<br/>                       (lower_barrier + upper_barrier)*0.5], 'r--');<br/>ax.plot([start, start], [lower_barrier, upper_barrier], 'r-');<br/>ax.plot([end, end], [barriers.bottom_barrier[end], barriers.top_barrier[end]], 'r-');</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="91fd" class="oa mn it bd mo ob pq od mr oe pr og mu ki ps kj mx kl pt km na ko pu kp nd ok bi translated">å‚è€ƒ</h1><ol class=""><li id="1f9c" class="ne nf it lk b ll ng lo nh lr ni lv nj lz nk md nl nm nn no bi translated"><a class="ae lh" href="https://www.quantopian.com/posts/introduction-to-advances-in-financial-machine-learning-by-lopez-de-prado" rel="noopener ugc nofollow" target="_blank">æ´›ä½©å…¹Â·å¾·Â·æ™®æ‹‰å¤šçš„ã€Šé‡‘èæœºå™¨å­¦ä¹ çš„è¿›å±•ã€‹ç®€ä»‹</a></li></ol></div></div>    
</body>
</html>