<html>
<head>
<title>Updating a Quip Spreadsheet with Python API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python API 更新 Quip 电子表格</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/updating-a-quip-spreadsheet-with-python-api-1b4bb24d4aac?source=collection_archive---------18-----------------------#2020-07-26">https://towardsdatascience.com/updating-a-quip-spreadsheet-with-python-api-1b4bb24d4aac?source=collection_archive---------18-----------------------#2020-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a3a0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">什么是妙语，你为什么要在意？</h2></div><blockquote class="kf kg kh"><p id="5a83" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">Quip 是一个用于移动和网络的协作生产力软件套件。它允许多组人员作为一个组来创建和编辑文档和电子表格，通常用于商业目的。(<a class="ae lf" href="https://en.wikipedia.org/wiki/Quip_(software)" rel="noopener ugc nofollow" target="_blank">维基百科</a>)</p></blockquote><p id="8c6d" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">Quip 和 Google Docs/Sheets 的一个主要区别是 Quip 有一个原生的桌面应用程序。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lj"><img src="../Images/8d0886ec84271ca220d702979cf73d35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v1SY8CifsSYaAuTNeJB5Rw.png"/></div></div><p class="lv lw gj gh gi lx ly bd b be z dk translated">Quip 电子表格截图(Lynn Zheng)</p></figure><p id="bda7" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">在这篇文章中，我将向您展示如何使用其<a class="ae lf" href="https://github.com/quip/quip-api" rel="noopener ugc nofollow" target="_blank"> Python API 客户端</a>来自动化创建、插入和更新 Quip 电子表格的过程。为了增强 API 的功能，我对它的官方 GitHub 库做了一个分支，并加入了一些有用的 pull 请求，这些请求还没有合并到主分支中。从<a class="ae lf" href="https://github.com/RuolinZheng08/quip-api" rel="noopener ugc nofollow" target="_blank">我的库</a>下载<code class="fe lz ma mb mc b">quip.py</code>继续本教程。</p><h1 id="8252" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">Quip API 基础</h1><p id="1cd6" class="pw-post-body-paragraph ki kj iq kl b km mv jr ko kp mw ju kr lg mx ku kv lh my ky kz li mz lc ld le ij bi translated"><a class="ae lf" href="https://quip.com/dev/automation/documentation" rel="noopener ugc nofollow" target="_blank">官方 API 文档位于本网站</a>。您将需要一个访问令牌来与 Quip 的 API 进行交互。访问页面<a class="ae lf" href="https://quip.com/dev/token" rel="noopener ugc nofollow" target="_blank">https://quip.com/dev/token</a>生成个人访问令牌。</p><p id="8bc5" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">要打开 Python 客户端:</p><pre class="lk ll lm ln gt na mc nb nc aw nd bi"><span id="d3bf" class="ne me iq mc b gy nf ng l nh ni">import quip<br/>ACCESS_TOKEN = "" # your access token<br/>client = quip.QuipClient(access_token=ACCESS_TOKEN)</span></pre><p id="435c" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">Quip API 的一个基本实体是<strong class="kl ir">线程。</strong></p><blockquote class="kf kg kh"><p id="1d0a" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">Quip 将文档和消息集成到一个单元中，我们称之为线程。Quip Automation API 中的大多数操作都是在线程上进行的。线索可以简单地是消息列表，即聊天线索，或者除了消息列表之外，它们还可以具有文档。(<a class="ae lf" href="https://quip.com/dev/automation/documentation#overview" rel="noopener ugc nofollow" target="_blank">装备 API 文件</a></p></blockquote><h1 id="8521" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">在 Quip 中创建电子表格</h1><p id="3ef8" class="pw-post-body-paragraph ki kj iq kl b km mv jr ko kp mw ju kr lg mx ku kv lh my ky kz li mz lc ld le ij bi translated">向<code class="fe lz ma mb mc b">new_document</code>传递一个空字符串作为第一个参数，告诉 Quip 使用它的默认 HTML 模板。</p><pre class="lk ll lm ln gt na mc nb nc aw nd bi"><span id="2b37" class="ne me iq mc b gy nf ng l nh ni">jso = client.new_document("", title="My Spreadsheet", type="spreadsheet")</span></pre><p id="8e21" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">您还可以指定一个 HTML 字符串作为第二个代码段中的模板。如下创建一个名为<strong class="kl ir">template.html</strong>的文件。这个电子表格模板只包含两列。</p><pre class="lk ll lm ln gt na mc nb nc aw nd bi"><span id="4fe3" class="ne me iq mc b gy nf ng l nh ni">&lt;table&gt;<br/> &lt;thead&gt;<br/>  &lt;tr&gt;<br/>   &lt;th&gt;&lt;/th&gt;<br/>   &lt;th&gt;&lt;/th&gt;<br/>  &lt;/tr&gt;<br/> &lt;/thead&gt;<br/> &lt;tbody&gt;<br/> &lt;/tbody&gt;<br/>&lt;/table&gt;</span><span id="71af" class="ne me iq mc b gy nj ng l nh ni">with open("template.html", "rt") as f:<br/>    template = f.read()<br/>jso = client.new_document(template, title="My Spreadsheet", type="spreadsheet")</span></pre><p id="d3a6" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">抓住<code class="fe lz ma mb mc b">thread_id</code>发来的服务器响应。我们将需要它作为我们创建的电子表格的参考，以插入/更新记录。</p><pre class="lk ll lm ln gt na mc nb nc aw nd bi"><span id="570a" class="ne me iq mc b gy nf ng l nh ni">thread_id = jso["thread"]["id"]</span></pre><p id="c0da" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">让我们将标题(默认为 A 和 B)更新为更具描述性的内容。</p><pre class="lk ll lm ln gt na mc nb nc aw nd bi"><span id="7531" class="ne me iq mc b gy nf ng l nh ni">client.update_spreadsheet_headers(thread_id, "Name", "Email")</span></pre><p id="9cb3" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">检查标题设置是否正确:</p><pre class="lk ll lm ln gt na mc nb nc aw nd bi"><span id="749b" class="ne me iq mc b gy nf ng l nh ni">spreadsheet = client.get_first_spreadsheet(thread_id)<br/>headers = client.get_spreadsheet_header_items(spreadsheet)<br/>print(headers) # prints ['Name', 'Email']</span></pre><h2 id="00c2" class="ne me iq bd mf nk nl dn mj nm nn dp mn lg no np mp lh nq nr mr li ns nt mt nu bi translated">按标题检索电子表格</h2><pre class="lk ll lm ln gt na mc nb nc aw nd bi"><span id="7f1d" class="ne me iq mc b gy nf ng l nh ni">title = "My Spreadsheet"<br/>jso = client.get_matching_threads(title, only_match_titles=True)<br/># get the id of the first thread<br/>thread_id = jso[0]["thread"]["id"]</span></pre><h1 id="644f" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">将记录插入电子表格</h1><pre class="lk ll lm ln gt na mc nb nc aw nd bi"><span id="fc2c" class="ne me iq mc b gy nf ng l nh ni">client.add_to_spreadsheet(thread_id, ["John Doe", "jdoe@gmail.com"])<br/>client.add_to_spreadsheet(thread_id, ["Jane Doe", "jane@gmail.com"])</span></pre><h1 id="b13e" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">更新电子表格中的记录</h1><p id="9979" class="pw-post-body-paragraph ki kj iq kl b km mv jr ko kp mw ju kr lg mx ku kv lh my ky kz li mz lc ld le ij bi translated">假设简将她的电子邮件地址更新为 jd12@gmail.com，让我们更新电子表格来反映这一变化。</p><pre class="lk ll lm ln gt na mc nb nc aw nd bi"><span id="ab4b" class="ne me iq mc b gy nf ng l nh ni">client.update_spreadsheet_row(thread_id, "Name", "Jane Doe", {"Email": "jd12@gmail.com"})</span></pre><p id="6fd8" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">一个警告:Quip 的 API 实现了严格的速率限制，默认为每分钟 50 个请求，这意味着每分钟最多只能插入/更新 50 条记录。在<a class="ae lf" href="https://quip.com/dev/automation/documentation#rate-limit" rel="noopener ugc nofollow" target="_blank">文档</a>中阅读更多关于自定义标题<code class="fe lz ma mb mc b">X-Ratelimit-Limit</code>的信息。</p><h1 id="3b70" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">与您组织中的其他 Quip 用户共享电子表格</h1><p id="f041" class="pw-post-body-paragraph ki kj iq kl b km mv jr ko kp mw ju kr lg mx ku kv lh my ky kz li mz lc ld le ij bi translated">假设您想与电子邮件地址为 smith@gmail.com 的同事共享该电子表格。</p><pre class="lk ll lm ln gt na mc nb nc aw nd bi"><span id="02bc" class="ne me iq mc b gy nf ng l nh ni">email = "smith@gmail.com"<br/>jso = client.get_user(email)<br/>member_id = jso["id"]<br/>client.add_thread_members(thread_id, [member_id])</span></pre><p id="732a" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">这些是 Quip 的电子表格 API 的基础。感谢阅读！</p></div></div>    
</body>
</html>