<html>
<head>
<title>Image Classification: Using AI to Detect Pneumonia</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图像分类:利用人工智能检测肺炎</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-ai-to-detect-pneumonia-3ec4601acd07?source=collection_archive---------60-----------------------#2020-07-20">https://towardsdatascience.com/using-ai-to-detect-pneumonia-3ec4601acd07?source=collection_archive---------60-----------------------#2020-07-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1e38" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用 Python (Keras)实现神经网络对 X 射线图像进行分类</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b5e400423fc370252dc83adb8c3364f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kRmdHCnsFKBQa2t_i6le3Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">正常肺(左)与肺炎(右)(<a class="ae kv" href="https://www.drbeen.com/blog/the-basics-of-chest-x-ray-interpretation/" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></figure><p id="73f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://medium.com/the-sports-scientist/using-ai-to-hack-your-fantasy-lineup-2fe022886769" rel="noopener">我的上一篇博客</a>中，我向你们展示了如何创建一个神经网络来预测一名 NBA 球员在任何特定夜晚的表现。虽然这是一个非常有趣的项目，但由于新冠肺炎的原因，我无法在常规赛中测试它。考虑到全球疫情，我真的很犹豫是否要开始一个新项目，因为今年不仅在体育方面，而且在金融和情绪分析方面都被认为是异常值。带着这个问题，我开始搜索 Kaggle，发现了一个充满正常和非正常肺部(肺炎)X 射线图像的数据集。这引起了我的兴趣，所以我继续搜索更多的数据库，找到了更多带标签的照片。我能够将两个数据集合并到一个文件夹中(没有重复)，总共有 6000 张图像。使用这些图像，我将向您展示如何创建一个卷积神经网络，它可以预测一个人是否患有肺炎，准确率约为 98%(测试集)。</p><p id="87f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">数据集</strong></p><ul class=""><li id="d224" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">科罗纳哈克</li><li id="0376" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://github.com/HeeebsInc/covid-chestxray-dataset" rel="noopener ugc nofollow" target="_blank"> GitHub </a> COVID 数据集</li><li id="da32" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://drive.google.com/drive/folders/1XsUTrl65JuLQvQeoSGvxqPHvZCWb6tM7?usp=sharing" rel="noopener ugc nofollow" target="_blank"> GoogleDrive </a>(包含组合数据集、pickles 和带有图像路径/标签的 csv)</li></ul><h1 id="0d40" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">卷积神经网络</h1><p id="a374" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">虽然我们看到的图像有颜色和形状，但在最基本的层面上，它们是数字列表，每个数字对应一个 RGB 值，然后由计算机处理，向您显示图像。卷积神经网络在图像处理中获得了牵引力，因为它们能够将 RGB 阵列分成(1×1)、(2×2)或(3×3)个像素，以便学习图像中的模式</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/3d7e47b6ff9fcc8c12ba4e5747b60dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Thdyo1SzUtPUNJHj3Y4WzQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自等人的<a class="ae kv" href="https://www.mdpi.com/2076-3417/9/21/4500/htm" rel="noopener ugc nofollow" target="_blank"> Van Hiep Phung。铝</a></p></figure></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="f70e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nl">* *下面显示的所有代码都可以在我的</em><a class="ae kv" href="https://github.com/HeeebsInc/NN_Pneumonia_Detection" rel="noopener ugc nofollow" target="_blank"><em class="nl">GitHub</em></a><em class="nl">* * *</em>上找到</p><h1 id="8422" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">密码</h1><p id="4303" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">带有的数据集。csv 太大了，无法上传到我的 GitHub 上，所以我在我的 GoogleDrive 上公开了它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">包导入</p></figure><p id="2575" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">套餐</strong></p><ul class=""><li id="5bda" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">Sklearn</li><li id="d46b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">克拉斯</li><li id="680a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">张量流</li><li id="b555" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">熊猫</li><li id="c121" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">Numpy</li><li id="7263" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">泡菜</li><li id="661f" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">马特普罗德利卜和西伯恩</li></ul></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h2 id="a9e7" class="no mh iq bd mi np nq dn mm nr ns dp mq lf nt nu ms lj nv nw mu ln nx ny mw nz bi translated">列车测试分离</h2><p id="5440" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">因为这是我的第一个图像分类项目，我花了几个小时去理解一个将数据恰当地分成测试和训练的架构——特别是因为我从<em class="nl">多个</em>来源收集了数据。我最终采用的方法是这样的:(1)我首先创建一个 CSV 文件，其中包含每个图像的路径和标签，(2)像往常一样分割训练和测试，根据标签对每个组进行分层，(3)然后我遍历每个图像路径并提取其 RGB 值</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://github.com/HeeebsInc/NN_Pneumonia_Detection/blob/master/Train_Test.ipynb" rel="noopener ugc nofollow" target="_blank">列车试分裂</a></p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/8f44150b71bd04e157893c1c7352fe9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*LnMX8rogDpBvXMOvMLtufw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">x 列车等级频率</p></figure><p id="c429" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据计算机的速度，获取每个图像及其 RGB 数组可能需要几分钟的时间，所以我腌制了每个样本，以避免每次我想训练新模型时都这样做(<a class="ae kv" href="https://drive.google.com/drive/folders/1XsUTrl65JuLQvQeoSGvxqPHvZCWb6tM7?usp=sharing" rel="noopener ugc nofollow" target="_blank"> GoogleDrive </a>)。</p><p id="6d8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在挽救了泡菜之后，现在是时候开始构建神经网络了。下面是模型架构的截图。ReLU 激活函数用于除输出层以外的每一层。Sigmoid 用于激活层，因为分类集是二进制的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/6b084aa5089d923eea410e17e416f5d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*xhysNWdve4qEKQpJSW31VA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">CNN 模型架构</p></figure><p id="0889" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我发现 sigmoid 激活对这个模型更好，因为它对二元分类更准确。如果你调整这个模型来预测肺炎的类型(病毒性，真菌性，等等。)，则 softmax 激活对输出图层更好，使用 categorical _ crossentropy 比 binary_crossentropy 更好。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://github.com/HeeebsInc/NN_Pneumonia_Detection/blob/master/CNN.ipynb" rel="noopener ugc nofollow" target="_blank"> CNN 型号</a></p></figure><p id="5aea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在同一个笔记本中运行下面的单元，开始培训过程。early_stopping 将防止模型过度拟合，而模型检查点在每次 val_loss 减少时保存权重。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://github.com/HeeebsInc/NN_Pneumonia_Detection/blob/master/CNN.ipynb" rel="noopener ugc nofollow" target="_blank">运行模型</a></p></figure><h2 id="fc5b" class="no mh iq bd mi np nq dn mm nr ns dp mq lf nt nu ms lj nv nw mu ln nx ny mw nz bi translated">模型评估</h2><p id="2bea" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">模型检查点参数能够在 30 个时期停止模型，以防止进一步过度拟合。从下面的图表中，我们可以看到训练和测试的准确率保持在 96%以上。然而，我学到的一件事是永远不要相信表面的准确性。为了更好地研究模型的性能，我绘制了 AUC、ROC 和决策边界曲线，以确定使用不同阈值时模型如何变化。同样，这些图形的所有代码都可以在我的<a class="ae kv" href="https://github.com/HeeebsInc/NN_Pneumonia_Detection" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/c9f62c7cb35dec427a10dde7f86c7629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p1t4oGohDiID-BZQaCCARA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">验证/培训损失和准确性</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/b6cc8c9ba1ed6d1f07f052e32618b1e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OS3ENMY-8IrYzX1-tFvCkg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">F1，AUC，ROC 分数</p></figure><p id="52cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该模型的 F1、AUC 和 ROC 评分分别为 0 . 935、0 . 972 和 0 . 994。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/97182b46830dfbcff44a6844b3cd1b18.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*4wLy8xek9R7JKhFAa4h2YQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">TPR 和 FPR 与阈值</p></figure><p id="4b64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在选择阈值之前，首先重要的是要了解您试图解决的问题的背景，以及这将如何影响您想要的结果。在我们的病例中，我们希望对肺炎进行分类。另一方面，如果我们将一个正常的肺归类为患有肺炎，只要我们经常检测到肺炎，这并不是那么糟糕。决定这个问题的决策阈值是在产生最低<em class="nl">成本的最佳值- </em>之间进行选择，这在每个机器学习问题中都是不同的。下面，您可以看到不同阈值. 2、. 5 和. 6 的混淆矩阵</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/5933d92a08b5f29ce6500a2baa1ebd12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W4iSvdcF8XOXON1lG_KJXA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">不同阈值的混淆矩阵</p></figure><p id="ef50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了在外部数据上测试这个模型，我从谷歌上收集了 17 张图片，并使用了 0.65 的概率阈值。正如你在下面看到的，这个模型有 100%的正确率和 56%的正确率。如果你下载了我的回购中的代码，有一个文件夹，你可以自己尝试一个预测。你所要做的就是下载图像，将文件命名为正常或非正常以记住它的标签，然后运行<a class="ae kv" href="https://github.com/HeeebsInc/NN_Pneumonia_Detection/blob/master/CNN.ipynb" rel="noopener ugc nofollow" target="_blank">代码</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/b2b7023178eb2398e47898eaeddbe808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VYBo48y5yQGuH0xiI7vUuw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://github.com/HeeebsInc/NN_Pneumonia_Detection/blob/master/CNN.ipynb" rel="noopener ugc nofollow" target="_blank">使用谷歌图片的预测</a></p></figure><h2 id="6f83" class="no mh iq bd mi np nq dn mm nr ns dp mq lf nt nu ms lj nv nw mu ln nx ny mw nz bi translated">未来方向</h2><ul class=""><li id="6250" class="ls lt iq ky b kz my lc mz lf oh lj oi ln oj lr lx ly lz ma bi translated">对肺炎的类型进行分类(病毒性、真菌性等。)</li><li id="d34a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">使用灰度(1D 阵列)</li><li id="fdde" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">应用<a class="ae kv" href="https://machinelearningmastery.com/smote-oversampling-for-imbalanced-classification/" rel="noopener ugc nofollow" target="_blank">重击</a>来改变职业不平衡</li><li id="2bcf" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">使用尺寸为(96，96，3)或(204，204，4)的较大图像。我最初尝试使用更大的尺寸，但我的电脑太低了。拥有更大的图像可以使检测更准确，因为比后者有更多的细节。</li></ul></div></div>    
</body>
</html>