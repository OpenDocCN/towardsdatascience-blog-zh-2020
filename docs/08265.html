<html>
<head>
<title>Line Chart Animation with Plotly on Jupyter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jupyter 上 Plotly 的折线图动画</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/line-chart-animation-with-plotly-on-jupyter-e19c738dc882?source=collection_archive---------13-----------------------#2020-06-17">https://towardsdatascience.com/line-chart-animation-with-plotly-on-jupyter-e19c738dc882?source=collection_archive---------13-----------------------#2020-06-17</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="8117" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">Plotly 统一悬停模式，按钮，等等</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/eae9474e92fb63cefd331b931dd295be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HG6CFTML_dzOzg2x"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@guykawasaki?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">盖伊·川崎</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="8059" class="lf lg iu lb b gz lh li l lj lk"><strong class="lb iv">Table of Contents</strong></span><span id="d9d4" class="lf lg iu lb b gz ll li l lj lk"><a class="ae kz" href="#0c1e" rel="noopener ugc nofollow"><strong class="lb iv">Introduction</strong></a></span><span id="bf5b" class="lf lg iu lb b gz ll li l lj lk">1. <a class="ae kz" href="#0dc9" rel="noopener ugc nofollow">Data preparation</a><br/>2. <a class="ae kz" href="#90a6" rel="noopener ugc nofollow">All countries line chart</a><br/>3. <a class="ae kz" href="#a093" rel="noopener ugc nofollow">Adding LOG and LINEAR buttons</a><br/>4. <a class="ae kz" href="#2b8b" rel="noopener ugc nofollow">Changing hovermode</a><br/>5. <a class="ae kz" href="#7b32" rel="noopener ugc nofollow">Line chart animation</a><br/>6. <a class="ae kz" href="#e0ab" rel="noopener ugc nofollow">Scatter and bar chart animations</a></span><span id="8338" class="lf lg iu lb b gz ll li l lj lk"><a class="ae kz" href="#2bbc" rel="noopener ugc nofollow"><strong class="lb iv">Conclusion</strong></a><br/></span></pre><h1 id="0c1e" class="lm lg iu bd ln lo lp lq lr ls lt lu lv ka lw kb lx kd ly ke lz kg ma kh mb mc bi translated">介绍</h1><p id="e612" class="pw-post-body-paragraph md me iu mf b mg mh jv mi mj mk jy ml mm mn mo mp mq mr ms mt mu mv mw mx my in bi translated">在本文中，我将尝试使用 Jupyter 上的<a class="ae kz" href="https://plotly.com/python/animations/" rel="noopener ugc nofollow" target="_blank"> Plotly 动画</a>在数据图表中重现我们的世界之一。</p><p id="8454" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">ourworldindata.org 是一个优秀的网站，我非常喜欢他们的视觉效果。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ne"><img src="../Images/81a2cb3d6772517d3e9e7900764496e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*voX1gjiVI5V_GwG7_rkAuQ.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图片来自<a class="ae kz" href="https://ourworldindata.org" rel="noopener ugc nofollow" target="_blank">ourworldindata.org</a></p></figure><p id="382a" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated"><a class="ae kz" href="https://ourworldindata.org/epi-curve-covid-19" rel="noopener ugc nofollow" target="_blank">上图</a>可以动画显示图形，高亮显示线条，在右侧选择不同的案例，选择线性和对数按钮，选择想要显示的国家。</p><p id="beb1" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">该项目是一个开源项目，你可以探索他们的 GitHub repo。</p><p id="781a" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">它是一个基于 JavaScript 的 app，使用 MySQL 作为数据库和 React、Mobx、TypeScript、Node、Express、D3 和<a class="ae kz" href="https://github.com/owid/owid-grapher/blob/master/package.json" rel="noopener ugc nofollow" target="_blank">其他 JavaScript</a>。</p><p id="e2a9" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated"><a class="ae kz" href="https://plotly.com/python/animations/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>支持创建动画、按钮和可选线条。</p><p id="2f0f" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">然而，目前的 Plotly 动画有一些限制<a class="ae kz" href="https://plotly.com/python/animations/#current-animation-limitations-and-caveats" rel="noopener ugc nofollow" target="_blank"/>，平滑的帧间过渡只可能用于散点图和条形图。它不支持复选框，尽管用于构建 web 应用程序的 Python 框架 PlotlyDash 支持<code class="fe nf ng nh lb b"><a class="ae kz" href="https://dash.plotly.com/dash-core-components/checklist" rel="noopener ugc nofollow" target="_blank">Checklist</a></code>。</p><blockquote class="ni nj nk"><p id="a409" class="md me nl mf b mg mz jv mi mj na jy ml nm nb mo mp nn nc ms mt no nd mw mx my in bi translated"><em class="iu">本文假设你已经熟悉 JupyterLab/Jupyter 笔记本的基本操作。</em></p></blockquote><p id="a987" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated"><strong class="mf iv"> Plotly 安装</strong></p><p id="d84e" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">plotly.py 可以使用 pip 安装。</p><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="5567" class="lf lg iu lb b gz lh li l lj lk">$ pip install plotly==4.8.1</span></pre><p id="81ff" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">或者康达。</p><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="d1a9" class="lf lg iu lb b gz lh li l lj lk">$ conda install -c plotly plotly=4.8.1</span></pre><h2 id="4141" class="lf lg iu bd ln np nq dn lr nr ns dp lv mm nt nu lx mq nv nw lz mu nx ny mb nz bi translated">JupyterLab 支持(Python 3.5 以上)</h2><p id="2f2c" class="pw-post-body-paragraph md me iu mf b mg mh jv mi mj mk jy ml mm mn mo mp mq mr ms mt mu mv mw mx my in bi translated">使用画中画:</p><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="c4e4" class="lf lg iu lb b gz lh li l lj lk">$ pip install jupyterlab "ipywidgets&gt;=7.5"</span></pre><p id="8929" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">或康达:</p><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="11ac" class="lf lg iu lb b gz lh li l lj lk">$ conda install jupyterlab "ipywidgets=7.5"</span></pre><p id="c5a0" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">然后运行以下命令(您需要安装节点):</p><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="4dc6" class="lf lg iu lb b gz lh li l lj lk"># JupyterLab renderer support <br/>$ jupyter labextension install jupyterlab-plotly@4.8.1  <br/># OPTIONAL: Jupyter widgets extension <br/>$ jupyter labextension install @jupyter-widgets/jupyterlab-manager plotlywidget@4.8.1</span></pre></div><div class="ab cl oa ob hy oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu oh"><a rel="noopener follow" target="_blank" href="/how-to-run-jupyter-notebook-on-docker-7c9748ed209f"><div class="oi ab fp"><div class="oj ab ok cl cj ol"><h2 class="bd iv gz z fq om fs ft on fv fx it bi translated">如何在 Docker 上运行 Jupyter 笔记本</h2><div class="oo l"><h3 class="bd b gz z fq om fs ft on fv fx dk translated">不再有 Python 环境和包更新</h3></div><div class="op l"><p class="bd b dl z fq om fs ft on fv fx dk translated">towardsdatascience.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov kt oh"/></div></div></a></div><div class="ow ox gq gs oy oh"><a rel="noopener follow" target="_blank" href="/how-to-create-an-animated-bar-chart-in-jupyter-9ee1de8d0e80"><div class="oi ab fp"><div class="oj ab ok cl cj ol"><h2 class="bd iv gz z fq om fs ft on fv fx it bi translated">如何在 Jupyter 中创建动画条形图</h2><div class="oo l"><h3 class="bd b gz z fq om fs ft on fv fx dk translated">使用 Plotly Python 显示最新美国失业率的数据可视化</h3></div><div class="op l"><p class="bd b dl z fq om fs ft on fv fx dk translated">towardsdatascience.com</p></div></div><div class="oq l"><div class="oz l os ot ou oq ov kt oh"/></div></div></a></div><div class="ow ox gq gs oy oh"><a rel="noopener follow" target="_blank" href="/how-to-create-an-animated-choropleth-map-with-less-than-15-lines-of-code-2ff04921c60b"><div class="oi ab fp"><div class="oj ab ok cl cj ol"><h2 class="bd iv gz z fq om fs ft on fv fx it bi translated">如何用不到 15 行代码创建一个动画的 Choropleth 地图</h2><div class="oo l"><h3 class="bd b gz z fq om fs ft on fv fx dk translated">在 Jupyter 上使用 Python 中的 Plotly Express</h3></div><div class="op l"><p class="bd b dl z fq om fs ft on fv fx dk translated">towardsdatascience.com</p></div></div><div class="oq l"><div class="pa l os ot ou oq ov kt oh"/></div></div></a></div></div><div class="ab cl oa ob hy oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="in io ip iq ir"><h1 id="0dc9" class="lm lg iu bd ln lo pb lq lr ls pc lu lv ka pd kb lx kd pe ke lz kg pf kh mb mc bi translated">数据准备</h1><p id="6582" class="pw-post-body-paragraph md me iu mf b mg mh jv mi mj mk jy ml mm mn mo mp mq mr ms mt mu mv mw mx my in bi translated">你可以从<a class="ae kz" href="https://ourworldindata.org/epi-curve-covid-19" rel="noopener ugc nofollow" target="_blank">我们的数据世界</a>或<a class="ae kz" href="https://raw.githubusercontent.com/shinokada/covid-19-stats/master/data/daily-new-confirmed-cases-of-covid-19-tests-per-case.csv" rel="noopener ugc nofollow" target="_blank">本报告</a>中下载数据集。</p><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="1598" class="lf lg iu lb b gz lh li l lj lk">import pandas as pd<br/>import plotly.express as px<br/>df = pd.read_csv('<a class="ae kz" href="https://raw.githubusercontent.com/shinokada/covid-19-stats/master/data/daily-new-confirmed-cases-of-covid-19-tests-per-case.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/shinokada/covid-19-stats/master/data/daily-new-confirmed-cases-of-covid-19-tests-per-case.csv</a>')</span><span id="6072" class="lf lg iu lb b gz ll li l lj lk">display(df.head())<br/>display(df.shape)</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pg"><img src="../Images/f9d2e31ef9526c50330ddc704f912b78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZhtjVL3TStRIpQqDkwSaZA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">原始数据集。它有 26123 行 x 5 列。作者图片</p></figure><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="9cae" class="lf lg iu lb b gz lh li l lj lk">import pandas as pd<br/>import plotly.express as px</span><span id="ec7e" class="lf lg iu lb b gz ll li l lj lk">df = pd.read_csv('https://raw.githubusercontent.com/shinokada/covid-19-stats/master/data/daily-new-confirmed-cases-of-covid-19-tests-per-case.csv') </span><span id="4754" class="lf lg iu lb b gz ll li l lj lk">excludes = ["World", "Africa", "North America", "South America", "Asia", "Europe", "European Union", "High income", "Low income", "Lower middle income", "Oceania", "Upper middle income", "World excl. China", "World excl. China and South Korea", "International",            "World excl. China, South Korea, Japan and Singapore","Asia excl. China"] </span><span id="1444" class="lf lg iu lb b gz ll li l lj lk">df=df[~df['Entity'].isin(excludes)]<br/>df.columns = ['Country','Code','Date','Confirmed','Days since confirmed']<br/>df['Date']= pd.to_datetime(df['Date']).dt.strftime('%Y-%m-%d')<br/>df_all=df[(df['Date']&gt;'2020-03-01') &amp; (df['Date'] &lt;'2020-06-14')]</span></pre><ul class=""><li id="2bad" class="ph pi iu mf b mg mz mj na mm pj mq pk mu pl my pm pn po pp bi translated">导入必要的库、Pandas 和 Plotly.express，将一个<strong class="mf iv">逗号分隔值(csv) </strong>文件读入 DataFrame。</li><li id="f5d8" class="ph pi iu mf b mg pq mj pr mm ps mq pt mu pu my pm pn po pp bi translated"><code class="fe nf ng nh lb b">excludes</code>是我们想要排除的<code class="fe nf ng nh lb b">Entity</code>列中的名称列表。</li><li id="cd18" class="ph pi iu mf b mg pq mj pr mm ps mq pt mu pu my pm pn po pp bi translated"><code class="fe nf ng nh lb b">isin</code>方法在<code class="fe nf ng nh lb b">Entity</code>列中找到<code class="fe nf ng nh lb b">excludes</code>值，我们使用<code class="fe nf ng nh lb b">~</code>来排除这些行。</li><li id="8091" class="ph pi iu mf b mg pq mj pr mm ps mq pt mu pu my pm pn po pp bi translated">我们将列名重命名为 Country、Code、Date、Confirmed、Days since confirmed。</li><li id="20e1" class="ph pi iu mf b mg pq mj pr mm ps mq pt mu pu my pm pn po pp bi translated">我们将<code class="fe nf ng nh lb b">Date</code>列的数据类型从<code class="fe nf ng nh lb b">object</code>更改为<code class="fe nf ng nh lb b">datetime</code>。我们也将它格式化为年-月-日。</li><li id="6bf9" class="ph pi iu mf b mg pq mj pr mm ps mq pt mu pu my pm pn po pp bi translated">我们在<code class="fe nf ng nh lb b">Date</code>列中选择从<code class="fe nf ng nh lb b">2020-03-01</code>到<code class="fe nf ng nh lb b">2020-06-14</code>的行。</li></ul><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="d3cf" class="lf lg iu lb b gz lh li l lj lk">display(df.head())<br/>display(df.shape)</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pv"><img src="../Images/ae05e9f4adbda8b4a3ccda79285d289a.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*4kvq1rkEQMn9kHlgsIgmjg.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">准备好的数据集。它有 23414 行 x 5 列。作者图片</p></figure><h1 id="90a6" class="lm lg iu bd ln lo lp lq lr ls lt lu lv ka lw kb lx kd ly ke lz kg ma kh mb mc bi translated">所有国家折线图</h1><p id="1662" class="pw-post-body-paragraph md me iu mf b mg mh jv mi mj mk jy ml mm mn mo mp mq mr ms mt mu mv mw mx my in bi translated">让我们使用<code class="fe nf ng nh lb b">df_all</code>创建一个折线图。我们设置<code class="fe nf ng nh lb b">Date</code>为 x 轴，<code class="fe nf ng nh lb b">Confirmed</code>为 y 轴，使用<code class="fe nf ng nh lb b">Country</code>为线条颜色。</p><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="a946" class="lf lg iu lb b gz lh li l lj lk">fig = px.line(df_all, x="Date", y="Confirmed", color="Country")<br/>fig.show()</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pw"><img src="../Images/c64aaab2a28aa8dbe30b58dac4d5ec90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7fFSXGee9DsE-mOaMFEd5g.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">折线图。作者图片</p></figure><p id="d704" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">通过将鼠标光标移动到数据点上，图表能够揭示关于该数据点的更多信息。我们可以通过点击右侧的国家名称来隐藏或显示线条。</p><h1 id="a093" class="lm lg iu bd ln lo lp lq lr ls lt lu lv ka lw kb lx kd ly ke lz kg ma kh mb mc bi translated">添加对数和线性按钮</h1><p id="e6fe" class="pw-post-body-paragraph md me iu mf b mg mh jv mi mj mk jy ml mm mn mo mp mq mr ms mt mu mv mw mx my in bi translated">我们将添加两个改变 y 轴刻度的按钮。</p><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="95c2" class="lf lg iu lb b gz lh li l lj lk">fig = px.line(df_all, x="Date", y="Confirmed", color="Country")<br/> <br/>fig.update_layout(<br/>    updatemenus=[<br/>        dict(<br/>            type = "buttons",<br/>            direction = "left",<br/>            buttons=list([<br/>                dict(<br/>                    args=[{"yaxis.type": "linear"}],<br/>                    label="LINEAR",<br/>                    method="relayout"<br/>                ),<br/>                dict(<br/>                    args=[{"yaxis.type": "log"}],<br/>                    label="LOG",<br/>                    method="relayout"<br/>                )<br/>            ]),<br/>        ),<br/>    ]<br/>)<br/>fig.show()</span></pre><p id="e0e0" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">使用<code class="fe nf ng nh lb b"><a class="ae kz" href="https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html#plotly.graph_objects.Figure.update_layout" rel="noopener ugc nofollow" target="_blank">update_layout</a></code>方法更新图形布局的属性。增加<code class="fe nf ng nh lb b">LINEAR</code>和<code class="fe nf ng nh lb b">LOG</code>两个按钮，并将<code class="fe nf ng nh lb b">yaxis.type</code>相应改为<code class="fe nf ng nh lb b">linear</code>和<code class="fe nf ng nh lb b">log</code>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj px"><img src="../Images/3476a4d625cf8812237f3c2e87daa3d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*b0uXro_VGy33LjWc5wGqpw.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">线性和对数按钮。作者图片</p></figure><h1 id="2b8b" class="lm lg iu bd ln lo lp lq lr ls lt lu lv ka lw kb lx kd ly ke lz kg ma kh mb mc bi translated">更换<code class="fe nf ng nh lb b">hovermode</code></h1><p id="21d5" class="pw-post-body-paragraph md me iu mf b mg mh jv mi mj mk jy ml mm mn mo mp mq mr ms mt mu mv mw mx my in bi translated">Plotly 有三种不同的<code class="fe nf ng nh lb b"><a class="ae kz" href="https://plotly.com/python/hover-text-and-formatting/" rel="noopener ugc nofollow" target="_blank">hovermode</a></code>。默认设置是<code class="fe nf ng nh lb b">hovermode='closest'</code>，正如我们在上图中看到的，光标正下方的点会出现一个悬停标签。</p><p id="18e9" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">对于这个图表，我们将使用统一的<code class="fe nf ng nh lb b">hovermode='x unified'</code>。它显示一个包含所有数据信息的悬停标签。为了清楚起见，我们选择了四个国家。</p><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="2880" class="lf lg iu lb b gz lh li l lj lk">import numpy as np<br/>import pandas as pd<br/>import plotly.graph_objects as go  #plotly 4.0.0rc1 </span><span id="52d1" class="lf lg iu lb b gz ll li l lj lk">df = pd.read_csv('https://raw.githubusercontent.com/shinokada/covid-19-stats/master/data/daily-new-confirmed-cases-of-covid-19-tests-per-case.csv')<br/>df.columns = ['Country','Code','Date','Confirmed','Days since confirmed']<br/>df['Date']= pd.to_datetime(df['Date']).dt.strftime('%Y-%m-%d')<br/>df=df[(df['Date']&gt;'2020-03-15') &amp; (df['Date'] &lt;'2020-06-14')] </span><span id="216a" class="lf lg iu lb b gz ll li l lj lk">includes=['United States','Russia', 'India','Brazil']df_selected=df[df['Country'].isin(includes)] </span><span id="403f" class="lf lg iu lb b gz ll li l lj lk">fig = px.line(df_selected, x="Date", y="Confirmed", color="Country") </span><span id="453d" class="lf lg iu lb b gz ll li l lj lk">fig.update_layout(<br/>    hovermode='x unified',<br/>    updatemenus=[<br/>        dict(<br/>            type = "buttons",<br/>            direction = "left",<br/>            buttons=list([<br/>                dict(<br/>                    args=[{"yaxis.type": "linear"}],<br/>                    label="LINEAR",<br/>                    method="relayout"<br/>                ),<br/>                dict(<br/>                    args=[{"yaxis.type": "log"}],<br/>                    label="LOG",<br/>                    method="relayout"<br/>                )<br/>            ]),<br/>        ),<br/>    ]<br/>)<br/>fig.show()</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj py"><img src="../Images/8e55bf29e00af6f144308ff7ee6eaf42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ImiV-XL7lD44qVta78Oa4Q.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><code class="fe nf ng nh lb b">hovermode='x unified' in a line chart. Image by the author</code></p></figure><h1 id="7b32" class="lm lg iu bd ln lo lp lq lr ls lt lu lv ka lw kb lx kd ly ke lz kg ma kh mb mc bi translated">折线图动画</h1><p id="9077" class="pw-post-body-paragraph md me iu mf b mg mh jv mi mj mk jy ml mm mn mo mp mq mr ms mt mu mv mw mx my in bi translated">Plotly 动画有一些限制，并且不支持折线图。</p><p id="c165" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">可以制作折线图动画，但它不如其他动画(如条形图和散点图)简洁。</p><pre class="kk kl km kn gu la lb lc ld aw le bi"><span id="551d" class="lf lg iu lb b gz lh li l lj lk">import numpy as np<br/>import pandas as pd<br/>import plotly.graph_objects as go</span><span id="d4ef" class="lf lg iu lb b gz ll li l lj lk">df = pd.read_csv('<a class="ae kz" href="https://raw.githubusercontent.com/shinokada/covid-19-stats/master/data/daily-new-confirmed-cases-of-covid-19-tests-per-case.csv'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/shinokada/covid-19-stats/master/data/daily-new-confirmed-cases-of-covid-19-tests-per-case.csv'</a>)<br/>df.columns = ['Country','Code','Date','Confirmed','Days since confirmed']<br/>df['Date']= pd.to_datetime(df['Date']).dt.strftime('%Y-%m-%d')<br/>df=df[(df['Date']&gt;'2020-03-15') &amp; (df['Date'] &lt;'2020-06-14')]</span><span id="d85c" class="lf lg iu lb b gz ll li l lj lk">usa=df[df['Country'].isin(['United States'])]<br/>brazil=df[df['Country'].isin(['Brazil'])]<br/>india=df[df['Country'].isin(['India'])]<br/>russia=df[df['Country'].isin(['Russia'])]</span><span id="373d" class="lf lg iu lb b gz ll li l lj lk">trace1 = go.Scatter(x=usa['Date'][:2],<br/>                    y=usa['Confirmed'][:2],<br/>                    mode='lines',<br/>                    line=dict(width=1.5))</span><span id="0b54" class="lf lg iu lb b gz ll li l lj lk">trace2 = go.Scatter(x = brazil['Date'][:2],<br/>                    y = brazil['Confirmed'][:2],<br/>                    mode='lines',<br/>                    line=dict(width=1.5))</span><span id="337c" class="lf lg iu lb b gz ll li l lj lk">trace3 = go.Scatter(x = india['Date'][:2],<br/>                    y = india['Confirmed'][:2],<br/>                    mode='lines',<br/>                    line=dict(width=1.5))</span><span id="eb2e" class="lf lg iu lb b gz ll li l lj lk">trace4 = go.Scatter(x = russia['Date'][:2],<br/>                    y = russia['Confirmed'][:2],<br/>                    mode='lines',<br/>                    line=dict(width=1.5))</span><span id="62b5" class="lf lg iu lb b gz ll li l lj lk">frames = [dict(data= [dict(type='scatter',<br/>                           x=usa['Date'][:k+1],<br/>                           y=usa['Confirmed'][:k+1]),<br/>                      dict(type='scatter',<br/>                           x=brazil['Date'][:k+1],<br/>                           y=brazil['Confirmed'][:k+1]),<br/>                      dict(type='scatter',<br/>                           x=india['Date'][:k+1],<br/>                           y=india['Confirmed'][:k+1]),<br/>                      dict(type='scatter',<br/>                           x=russia['Date'][:k+1],<br/>                           y=russia['Confirmed'][:k+1]),<br/>                     ],<br/>               traces= [0, 1, 2, 3],  <br/>              )for k  in  range(1, len(usa)-1)]</span><span id="0db3" class="lf lg iu lb b gz ll li l lj lk">layout = go.Layout(width=700,<br/>                   height=600,<br/>                   showlegend=False,<br/>                   hovermode='x unified',<br/>                   updatemenus=[<br/>                        dict(<br/>                            type='buttons', showactive=False,<br/>                            y=1.05,<br/>                            x=1.15,<br/>                            xanchor='right',<br/>                            yanchor='top',<br/>                            pad=dict(t=0, r=10),<br/>                            buttons=[dict(label='Play',<br/>                            method='animate',<br/>                            args=[None, <br/>                                  dict(frame=dict(duration=3, <br/>                                                  redraw=False),<br/>                                                  transition=dict(duration=0),<br/>                                                  fromcurrent=True,<br/>                                                  mode='immediate')]<br/>                            )]<br/>                        ),<br/>                        dict(<br/>                            type = "buttons",<br/>                            direction = "left",<br/>                            buttons=list([<br/>                                dict(<br/>                                    args=[{"yaxis.type": "linear"}],<br/>                                    label="LINEAR",<br/>                                    method="relayout"<br/>                                ),<br/>                                dict(<br/>                                    args=[{"yaxis.type": "log"}],<br/>                                    label="LOG",<br/>                                    method="relayout"<br/>                                )<br/>                            ]),<br/>                        ),<br/>                    ]              <br/>                  )</span><span id="8b53" class="lf lg iu lb b gz ll li l lj lk">layout.update(xaxis =dict(range=['2020-03-16', '2020-06-13'], autorange=False),<br/>              yaxis =dict(range=[0, 35000], autorange=False));</span><span id="e606" class="lf lg iu lb b gz ll li l lj lk">fig = go.Figure(data=[trace1, trace2, trace3, trace4], frames=frames, layout=layout)<br/>fig.show()</span></pre><p id="51c9" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">如果我们愿意，我们可以增加更多的国家。</p><ul class=""><li id="d262" class="ph pi iu mf b mg mz mj na mm pj mq pk mu pl my pm pn po pp bi translated">我们创建四个独立的数据帧。您可以增加或减少国家的数量。</li><li id="3fe6" class="ph pi iu mf b mg pq mj pr mm ps mq pt mu pu my pm pn po pp bi translated">我们用自己的<code class="fe nf ng nh lb b">x</code>、<code class="fe nf ng nh lb b">y</code>、<code class="fe nf ng nh lb b">mode</code>和<code class="fe nf ng nh lb b">line</code>值创建四个轨迹。如果你改变了国家的数量，你也需要在这里进行调整。</li><li id="e8f4" class="ph pi iu mf b mg pq mj pr mm ps mq pt mu pu my pm pn po pp bi translated">我们用<code class="fe nf ng nh lb b">data</code>列表值创建框架。<code class="fe nf ng nh lb b">traces=[0,1,2,3]</code>用于迭代<code class="fe nf ng nh lb b">frame[k]['data'][0]</code>、<code class="fe nf ng nh lb b">frame[k]['data'][1]</code>等。如果您更改国家的数量，同样，您需要调整这里的代码。如<code class="fe nf ng nh lb b">traces=[0,1,2,3,4,5]</code>。</li><li id="62ff" class="ph pi iu mf b mg pq mj pr mm ps mq pt mu pu my pm pn po pp bi translated">我们设置了<code class="fe nf ng nh lb b">width</code>、<code class="fe nf ng nh lb b">height</code>、<code class="fe nf ng nh lb b">hovermode</code>和<code class="fe nf ng nh lb b">updatemenus</code>。我们设置了两种按钮，一种用于播放，另一种用于<code class="fe nf ng nh lb b">LINEAR</code>和<code class="fe nf ng nh lb b">LOG</code>。</li><li id="c7a7" class="ph pi iu mf b mg pq mj pr mm ps mq pt mu pu my pm pn po pp bi translated"><code class="fe nf ng nh lb b"><a class="ae kz" href="https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html?highlight=update#plotly.graph_objects.Figure.update" rel="noopener ugc nofollow" target="_blank">update</a></code>用带有关键字参数的<code class="fe nf ng nh lb b">dict</code>更新图形的属性。</li></ul><p id="0b46" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">我们创建一个新的<code class="fe nf ng nh lb b">Figure</code>实例，并添加我们在第 15–33 行创建的所有跟踪。如果您更改了国家的数量，您需要更新这一行。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pz"><img src="../Images/7430184e6de2e4520c72a036fb0aa06b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2jxMQxyghAyeloKWeC1C0g.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Plotly 折线图动画。图片由作者提供。</p></figure><h1 id="e0ab" class="lm lg iu bd ln lo lp lq lr ls lt lu lv ka lw kb lx kd ly ke lz kg ma kh mb mc bi translated">散点图和条形图动画</h1><p id="0ced" class="pw-post-body-paragraph md me iu mf b mg mh jv mi mj mk jy ml mm mn mo mp mq mr ms mt mu mv mw mx my in bi translated">Plotly 支持散点图和条形图动画。</p><p id="4373" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">你可以在这里找到代码<a class="ae kz" href="https://gist.github.com/shinokada/8f8cdaa23e25c963eb6429696b4b5679" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj qa"><img src="../Images/72b1b644fc3c45c17818573d10821077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*PXfowa_b_keYU-ULoIPe1w.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">散点图动画。图片由作者提供。</p></figure><p id="84bd" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">您可以通过添加<code class="fe nf ng nh lb b">fig["layout"].pop("updatemenus")</code>来删除动画按钮，并将其用作滑块。</p><p id="c192" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated"><a class="ae kz" href="https://gist.github.com/shinokada/ad63d4cfa393ae326bcf4bbb960c7a61" rel="noopener ugc nofollow" target="_blank">代码</a></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj qb"><img src="../Images/a4cedd7908f00bee75577c59153f45c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tkMb_G0aNqIpX2wUfrDiGQ.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">pop("updatemenus ")放下动画按钮。图片由作者提供。</p></figure><p id="059a" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">在条形图动画中，我们可以悬停以查看更多详细信息，并且可以通过单击右侧菜单来隐藏/显示项目。</p><p id="359f" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated"><a class="ae kz" href="https://gist.github.com/shinokada/6505c9b94ad5ec02272e01101f0a57f9" rel="noopener ugc nofollow" target="_blank">代码</a></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj qa"><img src="../Images/5021d3ba9d5c11cba0101135af36d6ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZOTr7b022ZwAH2eUiwfy5Q.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">条形图动画。图片由作者提供。</p></figure><h1 id="2bbc" class="lm lg iu bd ln lo lp lq lr ls lt lu lv ka lw kb lx kd ly ke lz kg ma kh mb mc bi translated">结论</h1><p id="82c4" class="pw-post-body-paragraph md me iu mf b mg mh jv mi mj mk jy ml mm mn mo mp mq mr ms mt mu mv mw mx my in bi translated">它与我们在数据网站中的世界并不完全相同，但我们学会了如何创建折线图、折线图动画、添加统一的悬停模式以及添加按钮。</p><p id="cbd1" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated">目前，Plotly 需要更多代码来制作折线图动画。此外，如果散点图可以为动画绘制轨迹线和速度控制参数，那就太好了。</p></div><div class="ab cl oa ob hy oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="in io ip iq ir"><p id="9b29" class="pw-post-body-paragraph md me iu mf b mg mz jv mi mj na jy ml mm nb mo mp mq nc ms mt mu nd mw mx my in bi translated"><strong class="mf iv">通过</strong> <a class="ae kz" href="https://blog.codewithshin.com/membership" rel="noopener ugc nofollow" target="_blank"> <strong class="mf iv">成为</strong> </a> <strong class="mf iv">会员，获得媒体上所有故事的访问权限。</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj qc"><img src="../Images/0be3ee559fee844cb75615290e4a8b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*DjTM9iFtVc2wlcWcOms7VQ.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://blog.codewithshin.com/subscribe" rel="noopener ugc nofollow" target="_blank">https://blog.codewithshin.com/subscribe</a></p></figure></div><div class="ab cl oa ob hy oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu oh"><a rel="noopener follow" target="_blank" href="/how-to-create-a-grouped-bar-chart-with-plotly-express-in-python-e2b64ed4abd7"><div class="oi ab fp"><div class="oj ab ok cl cj ol"><h2 class="bd iv gz z fq om fs ft on fv fx it bi translated">如何用 Python 中的 Plotly Express 创建分组条形图</h2><div class="oo l"><h3 class="bd b gz z fq om fs ft on fv fx dk translated">Python melt 函数将数据帧从宽到长格式化</h3></div><div class="op l"><p class="bd b dl z fq om fs ft on fv fx dk translated">towardsdatascience.com</p></div></div><div class="oq l"><div class="qd l os ot ou oq ov kt oh"/></div></div></a></div><div class="ow ox gq gs oy oh"><a rel="noopener follow" target="_blank" href="/how-to-create-an-attractive-bubble-map-5cf452c244e9"><div class="oi ab fp"><div class="oj ab ok cl cj ol"><h2 class="bd iv gz z fq om fs ft on fv fx it bi translated">如何在 Jupyter 中创建一个有吸引力的气泡图</h2><div class="oo l"><h3 class="bd b gz z fq om fs ft on fv fx dk translated">从 Github repo 抓取数据的分步指南</h3></div><div class="op l"><p class="bd b dl z fq om fs ft on fv fx dk translated">towardsdatascience.com</p></div></div><div class="oq l"><div class="qe l os ot ou oq ov kt oh"/></div></div></a></div><div class="ow ox gq gs oy oh"><a rel="noopener follow" target="_blank" href="/how-to-create-an-interactive-dropdown-in-jupyter-322277f58a68"><div class="oi ab fp"><div class="oj ab ok cl cj ol"><h2 class="bd iv gz z fq om fs ft on fv fx it bi translated">如何在 Jupyter 中创建交互式下拉列表</h2><div class="oo l"><h3 class="bd b gz z fq om fs ft on fv fx dk translated">用下拉菜单更新图表</h3></div><div class="op l"><p class="bd b dl z fq om fs ft on fv fx dk translated">towardsdatascience.com</p></div></div><div class="oq l"><div class="qf l os ot ou oq ov kt oh"/></div></div></a></div></div></div>    
</body>
</html>