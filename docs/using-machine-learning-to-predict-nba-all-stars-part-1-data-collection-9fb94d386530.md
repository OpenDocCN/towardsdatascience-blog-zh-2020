# 使用机器学习预测 NBA 全明星赛，第 1 部分:数据收集

> 原文：<https://towardsdatascience.com/using-machine-learning-to-predict-nba-all-stars-part-1-data-collection-9fb94d386530?source=collection_archive---------49----------------------->

## 一个端到端的深度调查，以定量研究 NBA 全明星选拔。

![](img/e43f2077581d39d137f400553d80726a.png)

照片由 Abhishek Chandra 拍摄(Unsplash)

成为 NBA 全明星到底需要什么？作为一个长期的篮球迷，这是一个有趣且值得探究的问题。

本文将介绍我用来构建解决这个问题所需的历史数据集的各种数据搜集技术。

## 链接查看建模、预测和解释！

***如果你想开门见山，跳过数据收集过程，直接去*** [***第二部分:建模***](/using-machine-learning-to-predict-nba-all-stars-part-2-modelling-a66e6b534998?source=friends_link&sk=98afe5974104d088d4d3c99e0d305a38) ***看预测！***

## 链接到回购！

***点击*** [***此处***](https://github.com/cjporteo/ml-NBA-asg-predictor) ***查看我的 Github 上的完整回购(附自述)！***

# 背景和动机

NBA 全明星赛是一年一度的表演赛，展示了联盟中的 24 名顶级球员。炫目而迷人，这一事件是全明星周末的最大亮点，一线名人经常成群结队地前来观看这一事件。

鉴于该联盟由全球排名前 450 位的球员组成，入选全明星是一项重大荣誉——许多球员甚至在被选中之前就为自己设定了一个雄心勃勃的目标。当我们在一个球员的职业生涯结束时评估他的遗产时，我们经常把他们的全明星选择带入谈话中，作为衡量他们伟大的一种方式。

考虑到这一点，除了潜在的工资奖金影响之外，人们还希望选拔系统是公平、公正的，并植根于某种客观性。然而，可悲的是，事实并非如此。

首发由球迷、球员和媒体投票决定，而主教练选择替补。这种主观过程尽最大努力选择在当前赛季有精英个人表现记录的候选人，但它也不是没有缺陷。像球队记录和社交媒体存在这样的事情会泄露到这个决定过程中，每年公布名单后，球迷们都会不可避免地抗议，抱怨他们最喜欢的球员被错误地冷落。

![](img/3143740f1548df1c0ef2d0a1b1f42487.png)

从本质上来说，我们可能会期望被选中的球员仅仅是大家一致认同的*“联盟 24 名最佳球员”…* 但是我们到底如何定义*“最佳”*？显然，像得分和篮板这样的比赛数据很重要，但是比赛场地并不总是公平的。对于任何一个长期的 NBA 球迷来说，球队排名在我们如何评价球员个人方面起着很大的作用，这不是什么秘密；很明显，如果你的球队发现自己排名垫底，就很难获得球迷和同行的尊重和认可。

这种对失败球队的负面偏见让许多想成为全明星的人无法入选，比如 2016-2017 赛季的卡尔-安东尼·唐斯，但这种影响很难量化描述。与好球队相比，差球队的球员的球门柱要窄多少？同样的担忧也出现在伤病上。错过延长时间的玩家将会发现很难得到一个位置，即使他们在实际比赛时给出了很高的数字。但是什么才算是*“延长时间”*？我们用来做这个决定的强制截止值到底在哪里？

为了试图揭开一些迷雾，客观地了解成为 NBA 全明星需要什么，我去挖掘相关数据，并应用机器学习技术来具体模拟这一选择过程。

# 蓝图

![](img/7662397e1662b7ed1381ea015390284e.png)

在机器学习中，有一个被称为“ ***垃圾输入，垃圾输出”*** 的概念——意思是一个模型的输出只会和驱动它的数据一样好。如果我们想要准确而有洞察力的预测，我们必须确保我们提供的数据集是一致的、有用的，并且来源可靠。

我们将需要收集几个赛季的历史数据，但在我们拿出任何 Jupyter 笔记本之前，我们需要坐下来思考一下全明星选择中需要考虑的所有可能的特征。对于一个给定的玩家，什么信息可以帮助我们做出决定？

首先，我们需要传统的数据，比如得分，篮板，助攻等等。我们可以增加一些高级的统计数据，包括使用率、真实命中率、防守胜率和 PIE。PIE 代表[玩家影响力评估器](https://stats.nba.com/help/faq/)、[、*nba.com*、](http://www.nba.com)的 PER(玩家效率等级)版本，作为玩家表现的总括指标。

投票时的团队排名也很重要，所以我们也会用到它。对于受伤和错过的时间，我们可以比较个人和团队的比赛次数，并提取适当的百分比。

> 至关重要的是，我们只考虑前半个赛季。

声誉和粉丝偏爱是需要考虑的重要因素，但在这里很难实现。在 Instagram 和 Twitter 等平台上抓取玩家的社交媒体存在是(a)一个非常复杂的数据争论挑战,( b)由于社交媒体的疯狂变化，不可能可靠地向后扩展——此外，它直到 2010 年才真正存在。

在这个地方，我们可以用一个便宜的声誉代理:这个球员在职业生涯中有多少次入选全明星赛。它将与年轻和未经证实的球员斗争，但似乎这个功能可以做足够的工作来获得球迷和媒体的长期欢迎。

我们的目标是构建一个数据集，包含自 1996 年以来每个赛季的每个 NBA 球员的所有这些特征(最早的赛季是在[stats.nba.com](http://stats.nba.com)追踪的)。至关重要的是，我们只考虑赛季的前半段，因为这是挑选球员的时候，之后的一切都无关紧要。我选择每年的 1 月 21 日作为截止日期，因为这大概是开始做出选择决定的时间。

我们的输出标签将简单地表示该球员是否被选中(1)参加那年的全明星赛(0)。这是我们的基本事实。尽管 2020 年 ASG 已经发生，并且名单也早已确定，但我将从标记的数据集中忽略当前赛季(2019-20)，以便我们可以稍后运行模型，并将预测与已知结果进行比较。

一旦我们有了一个满意的模型，我们就可以窥视黑盒子，定量地探索全明星标准的内部运作，以及它们之间到底是如何相互作用的，希望能够平息我们的好奇心。

# 构建数据集

## 获取数据

![](img/ea4273dd573e69945dddfd9f3ae008f7.png)

Stats.nba.com 的[](http://stats.nba.com)*将是我们满足需求的首要资源。它支持在自定义日期范围内查询统计数据的功能，这对于我们想要做的事情是必不可少的。他们的网页本质上是动态的(AJAX ),所以从他们那里抓取并不简单——稍后会有更多的介绍。*

*来自这个资源的数据可以追溯到 1996-97 赛季，为我们的模型提供了一个不错的训练数据池。*

***例如，来自两个不同时代的 NBA 观众可能对防守有不同的侧重。因此，1996-1997 年的临界值在这里是完全可以接受的。***

*![](img/9dbcaa2f0fd972befadb7e9c1d12ad88.png)*

*2018-2019 赛季前半段球员的“传统”表。在这里链接到表[。](https://stats.nba.com/players/traditional/?sort=PTS&dir=-1&Season=2018-19&SeasonType=Regular%20Season&DateTo=01%2F21%2F2019)*

*在*传统*、*高级、*和*防御*牌桌之间，我们可以得到我们所需要的大部分。接下来是团队排名和团队游戏(我们需要设计游戏百分比)。我决定使用团队会议排名而不是总排名，因为出于讨论的目的，会议内部排名通常是人们最关心的。所有这些都可以在*团队*表中找到。*

*![](img/47aa3af27427e20b629f11181f1bff65.png)*

*2018-2019 赛季中途的东部“球队”表。在此链接到表格[。](https://stats.nba.com/teams/traditional/?sort=W_PCT&dir=-1&Season=2018-19&SeasonType=Regular%20Season&Conference=East&DateTo=01%2F21%2F2019)*

*请注意，在球员表中，球队以他们的简写符号(例如，CHI)列出，但是在球队表中使用全名(例如，芝加哥公牛)。当我们将这些合并在一起时，我们需要创建某种查找结构来链接它们。*

*剩下的就是球员的全明星选择历史，这是我们的输出标签和“之前全明星选择的数量”功能所需要的。幸运的是，这不依赖于赛季中的任何日期过滤器——所以我们可以使用另一个很好的篮球统计资源:[篮球参考](http://basketball-reference.com) [。](http://www.basketball-reference.com)这些网页是静态的 HTML，这意味着从这些网页中抓取会更加轻量和简单。*

*![](img/ca87abff154a65c8404affa0511a5b83.png)*

*2015 年 ASG 花名册(东部)，也列出了入选但因伤不能参赛的球员。在此链接到表格[。](https://www.basketball-reference.com/allstar/NBA_2015.html)*

*这里值得注意的是，我们不应该忽视那些入选全明星但由于受伤而无法参加的球员。即使他们没有正式占据一个花名册的位置，他们最初被选中，并将在整个分析中被视为全明星，以及他们的替代者。*

*随着游戏的发展，联赛节奏在过去几年里稳步增长，所以我们将通过除以节奏来标准化适用的游戏统计数据。我们可以很容易地从篮球参考资料中得到每年的联盟平均速度。*

*由于停摆，1999 年没有全明星赛，我们在构建数据集时将完全跳过 1998-1999 赛季。*

## *抓取网页:美丽的 Soup 和硒*

*![](img/5b295ed7cc5d09b62236402d85947007.png)*

*由于位于 [Basketball Reference](http://basketball-reference.com) 的网页是静态的(意味着内容直接嵌入到其 HTML 中),我们可以简单地使用`requests`库来加载 HTML 文档。*

*然后我们将使用`BeautifulSoup`来解析文档，并有选择地提取我们感兴趣的数据。使用`pd.read_html( … )`方法，我们可以将数据加载到一个熟悉的熊猫数据框架中，然后我们开始比赛。*

*即使我们的标签数据集将从 1996-1997 赛季开始，我们也需要比这更早的全明星阵容数据。例如，哈基姆·奥拉朱旺在 96 年是一名活跃的球员，但他的第一次全明星选择是在 85 年。我们用 1970 年来初始化我们的 ASG 刮擦，以确保我们绝对没有错过任何人的机会。*

*我们在这里构建的数据结构将是一个集合字典，将球员姓名映射到他们入选全明星的所有年份的集合。我们`pickle`这个字典(序列化它)并导出它以备将来调用。*

*对于那些好奇的人来说，下面是实现这一切的代码:*

*用于从[篮球参考](https://www.basketball-reference.com/)中抓取历史全明星出场数据的脚本。*

*![](img/50614e6f3496eeca1be53a8f999f3f55.png)*

*此导出数据结构的预览。*

*下一步，我们需要从 stats.nba.com 收集表格数据，这是事情变得有点复杂的地方。这些网页有一个使用 **AJAX** (异步 JavaScript 和 XML)的动态实现，所以显示的表格在 HTML 文档中是找不到的。*

*相反，网页会向 API 端点发送一个请求(附带数据过滤器),并返回一个 JSON 响应。我们必须经历识别相关端点的过程，然后自己手动管理数据。这将变得令人难以置信的乏味，因为现在我们讨论的是在给定一个日期范围内的每个玩家的高级统计数据，而不是给定一大堆盒子分数。*

*所以我们有两个真正的选择:*

*   *使用一个预建的实用程序来做这件事，像`[nba-api](https://pypi.org/project/nba-api/)` [，](https://pypi.org/project/nba-api/)阅读所有的文档来学习功能*
*   *使用自动化浏览器软件，如 Selenium WebDriver*

*尽管这是一种更暴力的方法，但为了节省时间，我还是选择了使用 Selenium。*

*![](img/58c7022f906f81207501ec1d1ba6f0ed.png)*

*使用 Selenium ChromeDriver 进行网页抓取。*

*Selenium 是一个允许我们调用自动化浏览器(WebDriver)的框架，使用 Python 中的 API，我们可以控制这个浏览器导航到相关网页。经过一段延迟时间后，一旦从后端收到响应，我们就可以最终加载 HTML 文档(包含重要数据)并像以前一样使用`BeautifulSoup`和`Pandas`。*

*在这一过程中，我还遇到了一些困难，但大多数问题都与保管有关(就像夏洛特黄蜂队在前山猫队时代被称为 CHH，后来被称为查)，这些问题都通过评论得到了解释。*

*剧本将从 1996 年到今天的每个赛季为每个 NBA 球员刮*stats.nba.com*。数据集经过适当的处理和合并，然后使用我们之前创建的全明星查找字典进行扩充。两个数据集以 csv 格式导出，一个包含从 1996-97 赛季到 2018-19 赛季的**所有带标签的数据**，另一个包含当前赛季的**未带标签的数据**。*

*超过 200 行，这个脚本有点太长了，不能在这里发布，但是可以在回购的[这里](https://github.com/cjporteo/ml-NBA-asg-predictor/blob/master/Data%20Collection/statsnba_full_scrape.py)找到。*

*下面是这两个数据集的前几行，其中许多要素隐藏在视图之外:*

*![](img/dfde12b12366355354fec7e7ae5bc0d8.png)*

*带标签的数据集(9595 条记录)，为了适合此处，许多要素隐藏在视图之外。*

*![](img/a38a988fa0708b4d4c3d83521fc6b245.png)*

*2019–2020 年的未标记数据集(486 条记录)。*

***原始**特征的完整列表:*

*   *年份(季节开始的日历年)*
*   *平均值。速度(该赛季联盟平均速度)*
*   *运动员*
*   *组*
*   *团队会议排名*
*   *GP(玩过的游戏)*
*   *团队 GP(团队参加的比赛)*
*   *w(赢的游戏-玩家必须玩过)*
*   *每场比赛得分*
*   *每场篮板数*
*   *AST(场均助攻数)*
*   *每场比赛抢断次数*
*   *BLK(每场比赛盖帽数)*
*   *每场比赛失误数*
*   *TS%(真实拍摄百分比)*
*   *下午 3 点(每场比赛 3 分)*
*   *防御赢股*
*   *USG%(使用率)*
*   *玩家影响力评估器*
*   *之前在 ASG 出现过*
*   *和去年一样？*

*这些游戏统计的正式定义可以在 https://stats.nba.com/help/glossary/找到。*

# *接下来…*

*在本次深度探讨的第二部分[中，我们将使用我们在此构建的数据集来研究*模拟*NBA 全明星选拔流程。感谢阅读！](/using-machine-learning-to-predict-nba-all-stars-part-2-modelling-a66e6b534998?source=friends_link&sk=98afe5974104d088d4d3c99e0d305a38)*