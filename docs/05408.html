<html>
<head>
<title>Using Folium to Generate Choropleth Map with Customised Tooltips (Python)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 leav 生成带有自定义工具提示的 Choropleth 地图(Python)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-folium-to-generate-choropleth-map-with-customised-tooltips-12e4cec42af2?source=collection_archive---------10-----------------------#2020-05-07">https://towardsdatascience.com/using-folium-to-generate-choropleth-map-with-customised-tooltips-12e4cec42af2?source=collection_archive---------10-----------------------#2020-05-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ea8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用数据标签在地图上显示香港选民和人口数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2f11c0445181a9a59bdc7714031cfcb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M-hXOanCMSWQzdBa4Nez1g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://cydalytics.blogspot.com/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄</p></figure><p id="35ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Folium 是在交互式地图上可视化数据的一个非常好的软件包。在这个演示中，使用了香港<a class="ae ky" href="https://www.voterregistration.gov.hk/chi/statistic2019.html" rel="noopener ugc nofollow" target="_blank">选民统计</a>和<a class="ae ky" href="https://www.censtatd.gov.hk/hkstat/sub/sp150.jsp?productCode=B1130301" rel="noopener ugc nofollow" target="_blank">人口数据</a>。数据经过预处理后存储在<a class="ae ky" href="https://github.com/cydalytics/HK_Voters_Distribution/blob/master/Consolidated%20Data.xlsx" rel="noopener ugc nofollow" target="_blank"> Consolidated Data.xlsx </a>中。随意摆弄数据集=)</p><p id="83fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以直接从<a class="ae ky" href="https://github.com/cydalytics/HK_Voters_Distribution" rel="noopener ugc nofollow" target="_blank">我的 Github repo </a>中克隆文件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e690" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">包裹</h1><p id="9b63" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">薄层</p><h1 id="9262" class="mc md it bd me mf mz mh mi mj na ml mm jz nb ka mo kc nc kd mq kf nd kg ms mt bi translated">功能</h1><p id="0ba7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe ne nf ng nh b">folium</code>建立在 Python 生态系统的数据优势和<code class="fe ne nf ng nh b">leaflet.js</code>库的映射优势之上。用 Python 处理你的数据，然后通过<code class="fe ne nf ng nh b">folium</code>在活页地图上可视化。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bc1d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">示范</h1><ol class=""><li id="dd11" class="ni nj it lb b lc mu lf mv li nk lm nl lq nm lu nn no np nq bi translated">用不同的图块生成简单的地图</li><li id="86d6" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">准备定制的数据标签并在悬停时显示在地图上</li></ol><h1 id="c09c" class="mc md it bd me mf mz mh mi mj na ml mm jz nb ka mo kc nc kd mq kf nd kg ms mt bi translated">数据</h1><p id="1b1b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Consolidated Data.xlsx</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/71bf9d357b190266cdeac9cdfcd988a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mSwNtS0W3V53gQYYLfggkA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://cydalytics.blogspot.com/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄</p></figure><p id="b58b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">任务 1:用不同的图块生成简单的地图</strong></p><pre class="kj kk kl km gt nx nh ny nz aw oa bi"><span id="5abf" class="ob md it nh b gy oc od l oe of">hk_geo = r’hkg_adm1.geojson’<br/>voter_proportion = data[['Eng_name','Proportion']]</span><span id="d553" class="ob md it nh b gy og od l oe of">map1 = folium.Map([22.38, 114.15], tiles='cartodbpositron', zoom_start=10)</span><span id="ae0e" class="ob md it nh b gy og od l oe of">tiles = ['stamenwatercolor', 'cartodbpositron', 'openstreetmap', 'stamenterrain']</span><span id="b926" class="ob md it nh b gy og od l oe of">for tile in tiles:<br/>    folium.TileLayer(tile).add_to(map1)<br/>    <br/>choropleth = folium.Choropleth(<br/>    geo_data = hk_geo,<br/>    name = 'choropleth',<br/>    data = voter_proportion,<br/>    columns = ['Eng_name', 'Proportion'],<br/>    key_on = 'feature.properties.name_1',<br/>    fill_color = 'YlGn',<br/>    fill_opacity = 0.7,<br/>    line_opacity = 0.2,<br/>    legend_name = '2019 年選民登記比例', # Voter Proportion (%) in 2019<br/>    highlight = True<br/>).add_to(map1)</span><span id="d9f7" class="ob md it nh b gy og od l oe of">folium.LayerControl().add_to(map1)</span><span id="201f" class="ob md it nh b gy og od l oe of"># Display Region Label<br/>choropleth.geojson.add_child(<br/>    folium.features.GeoJsonTooltip(['name_1'], labels=False)<br/>)</span><span id="c0a8" class="ob md it nh b gy og od l oe of">map1</span></pre><p id="48d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">逐步解释:</p><pre class="kj kk kl km gt nx nh ny nz aw oa bi"><span id="61cb" class="ob md it nh b gy oc od l oe of">hk_geo = r’hkg_adm1.geojson’</span></pre><p id="f006" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在地图上绘制数据，需要一个地图 json 文件来定位位置。本演示中使用的 json 文件是从<a class="ae ky" href="https://abhijeet.carto.com/tables/hkg_adm1/public" rel="noopener ugc nofollow" target="_blank">这个站点</a>下载的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/a30557569062dafc93f9ea413e553f23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dMFzPduTgQOKMwSGu86hyQ.png"/></div></div></figure><p id="1934" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这定义了底图的初始设置。</p><pre class="kj kk kl km gt nx nh ny nz aw oa bi"><span id="c55e" class="ob md it nh b gy oc od l oe of">tiles = ['stamenwatercolor', 'cartodbpositron', 'openstreetmap', 'stamenterrain']</span><span id="5090" class="ob md it nh b gy og od l oe of">for tile in tiles:<br/>    folium.TileLayer(tile).add_to(map1)</span></pre><p id="b94c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Folium 支持在同一个地图中显示不同的地图框，下面是一些常见的地图框。您可以在每张图片的标题中找到瓷砖类型。</p><pre class="kj kk kl km gt nx nh ny nz aw oa bi"><span id="9fbe" class="ob md it nh b gy oc od l oe of">folium.LayerControl().add_to(map1)</span></pre><p id="c7f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此代码将图层选择按钮(显示在右上角)添加到地图，如果此代码丢失，地图将显示最后添加的图块，并且图块样式不能更改。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/9dcde7876ff3cf7ef5ff1c467540d503.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dkz5Z53WksbmL1HF0ZwUNQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">tiles = ' cartodbpositron '，照片由<a class="ae ky" href="https://cydalytics.blogspot.com/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/65f0c81363deb1e3deb5f83197a85d43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*13fyelcTjmqBvo9yDoRykQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">tiles=“雄蕊水彩”，照片由<a class="ae ky" href="https://cydalytics.blogspot.com/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/d733b68c1a5ae503d91d4a978363bab1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ssEiUb_DbpTuPwGNC8IHxQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">tiles='openstreetmap '，照片由<a class="ae ky" href="https://cydalytics.blogspot.com/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/b64f20d71aac93d8dbf860a77987f8bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JNdfaiKjoxTy74gt865N7g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">tiles='stamenterrain '，照片由<a class="ae ky" href="https://cydalytics.blogspot.com/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄</p></figure><pre class="kj kk kl km gt nx nh ny nz aw oa bi"><span id="0239" class="ob md it nh b gy oc od l oe of">choropleth = folium.Choropleth(<br/>    geo_data = hk_geo,<br/>    name = 'choropleth',<br/>    data = voter_proportion,<br/>    columns = ['Eng_name', 'Proportion'],<br/>    key_on = 'feature.properties.name_1',<br/>    fill_color = 'YlGn',<br/>    fill_opacity = 0.7,<br/>    line_opacity = 0.2,<br/>    legend_name = '2019 年選民登記比例', # Voter Proportion (%) in 2019<br/>    highlight = True<br/>).add_to(map1)</span></pre><p id="9ac2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="om">叶。Choropleth </em>根据数据“比例”将彩色层添加到地图中。“Eng_name”是要与 geojson 文件的位置进行映射的数据的关键字。请确保 json 文件中位置名称的拼写与数据中的关键字相同。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/102450e0c12a81341bfd2aef597f51e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*021wn-EMqUhLRzHWRvtFCw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://cydalytics.blogspot.com/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄</p></figure><p id="d0fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">任务 2:准备定制的数据标签并在悬停时显示在地图上</strong></p><p id="36b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要向地图添加自定义数据标签，使用<em class="om">follow . features . geojsontooltip</em>。通过使用此代码，带标签的值将被追加到 geojson 文件中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/8f588ca9f25d28ea602e6e449aab300a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*12pLfuUfdoPIDXHRSiNpDQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://cydalytics.blogspot.com/" rel="noopener ugc nofollow" target="_blank"> cyda </a></p></figure><p id="2931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，您需要研究 json 文件的结构，并将工具提示数据添加到“属性”中。上面的脚本还允许您找出要在<em class="om">leav 的<em class="om"> key_on </em>中使用的映射键。Choropleth </em>。</p><pre class="kj kk kl km gt nx nh ny nz aw oa bi"><span id="29f2" class="ob md it nh b gy oc od l oe of">key_on='feature.properties.name_1',</span></pre><p id="bbac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在工具提示中，我想用中文显示地区名称和数据值。运行代码后，您将看到附加的工具提示数据。</p><pre class="kj kk kl km gt nx nh ny nz aw oa bi"><span id="43fb" class="ob md it nh b gy oc od l oe of"># prepare the customised text<br/>tooltip_text = []<br/>for idx in range(len(data2)):<br/> tooltip_text.append(data2[‘Chi_name’][idx]+’ ‘+ <br/> str(int(round(data2[‘18–35 (Proportion in 2019)’][idx]*100)))+’%’)<br/>tooltip_text</span><span id="0480" class="ob md it nh b gy og od l oe of"># Append a tooltip column with customised text<br/>for idx in range(len(tooltip_text)):<br/>    map_data['features'][idx]['properties']['tooltip1'] = tooltip_text[idx]</span></pre><p id="9b70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">预期产出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/ffb691d406250345ae7bf3773012bac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Ya-Sq4n2a55zVPb28BgRg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://cydalytics.blogspot.com/" rel="noopener ugc nofollow" target="_blank"> cyda </a></p></figure><pre class="kj kk kl km gt nx nh ny nz aw oa bi"><span id="2d97" class="ob md it nh b gy oc od l oe of">hk_geo = map_data<br/>voter_proportion = data2[['Eng_name','18-35 (Proportion in 2019)']]</span><span id="bb80" class="ob md it nh b gy og od l oe of">map2 = folium.Map([22.38, 114.15], tiles='cartodbpositron', zoom_start=10)</span><span id="ad11" class="ob md it nh b gy og od l oe of">choropleth = folium.Choropleth(<br/>    geo_data=hk_geo,<br/>    name='選民比例',<br/>    data=voter_proportion,<br/>    columns=['Eng_name','18-35 (Proportion in 2019)'],<br/>    key_on='feature.properties.name_1',<br/>    fill_color='YlOrBr', # ‘BuGn’, ‘BuPu’, ‘GnBu’, ‘OrRd’, ‘PuBu’, ‘PuBuGn’, ‘PuRd’, ‘RdPu’, ‘YlGn’, ‘YlGnBu’, ‘YlOrBr’, and ‘YlOrRd’.<br/>    fill_opacity=0.7,<br/>    line_opacity=0.2,<br/>    legend_name='2019 年 18-35 歲選民 vs 18-35 歲人口比例',<br/>    highlight=True<br/>).add_to(map2)</span><span id="81f2" class="ob md it nh b gy og od l oe of">folium.LayerControl().add_to(map2)<br/>choropleth.geojson.add_child(<br/>    folium.features.GeoJsonTooltip(['tooltip1'], labels=False)<br/>)</span><span id="4fc7" class="ob md it nh b gy og od l oe of">map2.save('map2.html')<br/>IFrame('map2.html', width=700, height=450)</span></pre><p id="86eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">绘图脚本类似于任务 1 中显示的脚本。在<em class="om">leav . features . geojsontooltip</em>中，请选择您存储工具提示数据的变量名称。在我的例子中，它是“tooltip1”。<em class="om"> labels = False </em>隐藏变量名(即‘tool tip 1’)不与数据标签一起显示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b9124054a0406d199f1ea96d9f3fec6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*93Nlzh544VK2dlr2k3myDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">cyda 拍摄的照片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/78f13dca77eb28521279cf098e501c38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9F21o5da0ZMgB3kIbftMqw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">cyda 拍摄的照片</p></figure><p id="175a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也有一些替代方法将数据标签添加到绘图中，但我发现这种方法更方便。如果你知道添加标签的其他方法，请随意评论。希望你喜欢我的文章=)</p><p id="829f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要了解更多关于使用 leav 的信息，请前往<a class="ae ky" href="https://github.com/python-visualization/folium" rel="noopener ugc nofollow" target="_blank">官方 Github 资源库</a>。</p><p id="3984" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你觉得我的文章有用，请在我的 linkedIn 页面上为我的技能背书，鼓励我写更多的文章。</p><p id="2d96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原载于<a class="ae ky" href="https://cydalytics.blogspot.com" rel="noopener ugc nofollow" target="_blank">cydalytics.blogspot.com</a></p></div></div>    
</body>
</html>