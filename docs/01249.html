<html>
<head>
<title>How to make an Analysis Tool with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 制作分析工具</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-make-an-analysis-tool-using-python-c3e4477b6d8?source=collection_archive---------13-----------------------#2020-02-04">https://towardsdatascience.com/how-to-make-an-analysis-tool-using-python-c3e4477b6d8?source=collection_archive---------13-----------------------#2020-02-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/74b5db0ad5d1e4e96084b6f001327f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qiLMpHZZ9DHPMceajckxgg.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">在<a class="ae jg" href="https://unsplash.com/s/photos/analysis?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae jg" href="https://unsplash.com/@kmuza?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Carlos Muza </a>拍摄的照片</p></figure><div class=""/><p id="d940" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated"><span class="l lf lg lh bm li lj lk ll lm di"> S </span>自从去年 10 月的新政策以来，Medium 以不同的方式计算<strong class="ki jk">收益</strong>并且<strong class="ki jk">每天更新它们</strong>。在改变之前，它是基于成员的鼓掌次数和他们自己鼓掌的数量，但现在它是基于<strong class="ki jk">阅读时间</strong>。类似于 youtube 的算法，就是观看时间。</p><p id="50e7" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">重要的是，它每天都在更新，你想知道在过去的 30 天里，你的故事制作了多少，有多少<strong class="ki jk">浏览量</strong>。</p><p id="b715" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为制作这个简单分析工具的示例网站，我们就拿<strong class="ki jk">中</strong>来说。但是你基本上可以在任何有你需要的统计数据的网站上做这件事。</p><p id="dceb" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是 Python 的一个非常简单的用法，你不需要任何特殊的或者相当惊人的技能来和我一起做这件事。我们将一步一步来，从头开始建设一切。</p><p id="329a" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们直接投入进去吧！</p><figure class="lo lp lq lr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ln"><img src="../Images/dbc0f5ceaf64df09ad66abb5d93fe2a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GWMwSh3hac3AT72B"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">马克斯·杜济在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="4dc0" class="ls lt jj bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">编码</h1><h2 id="d537" class="mq lt jj bd lu mr ms dn ly mt mu dp mc kr mv mw mg kv mx my mk kz mz na mo nb bi translated">规划流程</h2><p id="075e" class="pw-post-body-paragraph kg kh jj ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">构建这样一个工具需要几个步骤，首先，我们必须了解如何获得我们想要的东西。这是我们进入<a class="ae jg" href="http://medium.com" rel="noopener"> Medium </a>欢迎页面的地方。</p><figure class="lo lp lq lr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nh"><img src="../Images/d2b6d2301edd6471b3a0ad993b32e148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KiQe7oPcW0H31Oaw3y3JMQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">媒体的欢迎屏幕</p></figure><p id="511f" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它相当简单，我们有登录/注册按钮。我们将使用这些来登录我们的个人资料。我们将使这个工具自动化，让它点击、填写电子邮件、密码并让我们登录。之后，我们将得到我们需要的数据。</p><h2 id="a8ac" class="mq lt jj bd lu mr ms dn ly mt mu dp mc kr mv mw mg kv mx my mk kz mz na mo nb bi translated">设置环境</h2><p id="4ed0" class="pw-post-body-paragraph kg kh jj ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">你将不得不安装一个 chrome 驱动程序，它将使我们能够操作浏览器并向它发送命令以供测试和使用。</p><p id="afa8" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">打开链接并下载适用于您的操作系统的文件。我推荐<strong class="ki jk">最新稳定版</strong>，除非你已经知道自己在做什么。</p><p id="6940" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，您需要解压缩该文件。我建议进入文件，通过右键单击手动操作，然后单击“Extract here”。</p><figure class="lo lp lq lr gt iv gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d3263c9088abcac201882b0396b5d7fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/0*6rkm7L2Std90kWmh.png"/></div></figure><p id="361c" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在文件夹里面，有一个名为“chromedriver”的文件，我们必须将它移动到你电脑上的特定文件夹中。</p><p id="87af" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">打开终端，键入以下命令:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="e1a5" class="mq lt jj nk b gy no np l nq nr"><strong class="nk jk">sudo su</strong> #enter the root mode<br/><strong class="nk jk">cd</strong>      #go back to base from the current location<br/><strong class="nk jk">mv /home/*your_pc_name*/Downloads/chromedriver /usr/local/bin</strong> <br/>#move the file to the right location</span></pre><p id="f0a4" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请插入您的实际电脑名称，而不是*您的电脑名称*。</p><p id="672f" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完成后，我们打开编辑器。我个人选择的是<a class="ae jg" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio 代码</a>。它简单易用，可定制，并且对你的计算机来说很轻。</p><p id="6166" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">打开一个新项目，创建两个新文件。这是一个我的例子，看起来可以帮助你:</p><figure class="lo lp lq lr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ns"><img src="../Images/4c0fa9f9259f4a6897fe3187ba1c5d35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tfFgajEsUWYjEIsnUTDkXA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">Visual Studio 代码—项目设置</p></figure><p id="8545" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 VS 代码中，有一个“Terminal”选项卡，您可以使用它打开 VS 代码中的内部终端，这对于将所有内容放在一个地方非常有用。</p><p id="da55" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当你打开它时，我们还需要安装一些东西，那就是虚拟环境和用于 web 驱动程序 selenium。在您的终端中键入这些命令。</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="7500" class="mq lt jj nk b gy no np l nq nr">pip3 install virtualenv<br/>source venv/bin/activate<br/>pip3 install selenium</span></pre><p id="b796" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">激活虚拟环境后，我们就完全准备好了。</p><h2 id="f174" class="mq lt jj bd lu mr ms dn ly mt mu dp mc kr mv mw mg kv mx my mk kz mz na mo nb bi translated">创建工具</h2><p id="a873" class="pw-post-body-paragraph kg kh jj ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">我们将把它创建为一个类，并为它创建函数。所以我们开始吧！</p><p id="030e" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用任何名字创建你的工具并启动 Chrome 的驱动程序。</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="c61a" class="mq lt jj nk b gy no np l nq nr">class MediumBot():<br/>  def __init__(self):<br/>    self.driver = webdriver.Chrome()</span></pre><p id="1af8" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是我们开始发展所需要的一切。现在转到您的终端并键入:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="6949" class="mq lt jj nk b gy no np l nq nr">python -i scrape.py</span></pre><p id="1f4f" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个命令让我们把我们的文件作为一个互动的游乐场。浏览器的新选项卡将会打开，我们可以开始向它发出命令。<br/>如果你想试验，你可以使用命令行，而不是直接输入到你的源文件中。只是用<strong class="ki jk"> bot </strong>代替<strong class="ki jk"> self </strong>。</p><p id="9733" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于终端:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="40ce" class="mq lt jj nk b gy no np l nq nr">bot = MediumBot()<br/>bot.driver.get('https://medium.com/')</span></pre><p id="e97b" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在来看看源代码:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="2ff8" class="mq lt jj nk b gy no np l nq nr">self.driver.get('https://medium.com/')</span></pre><p id="4517" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们转到了灵媒欢迎页面，接下来我们需要登录。我们检查元素(键盘上的 F12)并复制元素 XPath。</p><figure class="lo lp lq lr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ns"><img src="../Images/896dcb888db525ac83e24b4db9ef4e10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VgejWdyfmC4BIEkXNwCNNw.png"/></div></div></figure><p id="4d34" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">右键单击标记为蓝色代码部分，并通过 XPath 进行复制。接下来，我们必须发出命令来为我们单击那个按钮。</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="5997" class="mq lt jj nk b gy no np l nq nr"><strong class="nk jk">sign_in</strong> = self.driver.find_element_by_xpath('//*[@id="root"]/div/div[4]/div/div/div[3]/div/div[2]/h4/a')<br/>sign_in.click()</span></pre><p id="1643" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">单引号(')是我的 XPath，如果你在做其他网站，你必须调整你的 XPath。</p><p id="6e3f" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将 XPath 保存到一个变量中，并对其执行 click()函数。</p><p id="4381" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我已经做了两种类型的登录，分别是谷歌和脸书，你也可以选择哪种方法更适合你，但关闭双因素认证，这样这个过程会更容易。</p><p id="a76b" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于脸书方法，您将选择“使用脸书登录”按钮，获取它的 XPath 并再次单击它。</p><figure class="lo lp lq lr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nh"><img src="../Images/f5a26f16be2fc865d261a4cc58b125ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jfVgvcpjKGhJH83foo8GkQ.png"/></div></div></figure><p id="fc82" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们必须输入我们的用户名和密码，我们通过 send_keys()函数来完成。</p><figure class="lo lp lq lr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nt"><img src="../Images/49508ce235b3949add977659bfd4acf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vghReYxMPEI9eEfqVzZ3jA.png"/></div></div></figure><p id="5021" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">再次选择文本框，现在只需向该字段发送文本，如下所示:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="9b47" class="mq lt jj nk b gy no np l nq nr">email_in = self.driver.find_element_by_xpath('//*[@id="email"]')</span><span id="1fc7" class="mq lt jj nk b gy nu np l nq nr">email_in.send_keys(username)</span></pre><p id="5bac" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对密码做同样的操作，然后用 click()函数登录。登录后，我们可以访问我们想要的数据，我写了两个独立的函数来获得收入和你的故事的浏览量。</p><p id="31c5" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一次查看:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="497d" class="mq lt jj nk b gy no np l nq nr">def stats(self):<br/>  self.driver.get('https://medium.com/me/stats')<br/>  sleep(3)<br/>  total_views = self.driver.find_element_by_xpath('/html/body/div[1]/div[2]/div/div[3]/div/ul/li[1]/div/div[1]')<br/>  print(total_views.text)</span></pre><p id="b521" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在是收益:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="3aa5" class="mq lt jj nk b gy no np l nq nr">def earnings(self):<br/>  self.driver.get('https://medium.com/me/partner/dashboard')<br/>  sleep(3)<br/>  total_earnings = self.driver.find_element_by_xpath('/html/body/div[1]/div[2]/div/div[3]/section/div/div[2]/div/div/div/div[3]')<br/>  print(total_earnings.text)</span></pre><p id="e567" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这两个示例中，我使用了 sleep()函数，该函数允许我将进一步的执行暂停一段时间，因此 sleep(1)将暂停 1 秒钟。你必须在代码的开头导入它。</p><p id="5a42" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦你提取完数据。您现在所要做的就是在类外创建这个工具的一个实例，并对它执行一个函数。</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="e1be" class="mq lt jj nk b gy no np l nq nr">bot = MediumBot()<br/>bot.login_facebook()</span></pre><p id="9246" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">保存并运行脚本。亲眼目睹奇迹的发生！</p><figure class="lo lp lq lr gt iv gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/24f86035f42fc67551263430d684fa4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*XR9sCSDNn76VVoN_tsTGcQ.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">我的分析</p></figure><p id="b433" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是我的 GitHub 页面上的完整代码:</p><div class="is it gp gr iu nw"><a href="https://github.com/lazargugleta/mediumBot/blob/master/scrape.py" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd jk gy z fp ob fr fs oc fu fw ji bi translated">lazargugleta/mediumBot</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">为你的故事收集收入和数据。通过在…上创建帐户，为 lazargugleta/mediumBot 的发展做出贡献</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok ja nw"/></div></div></a></div><p id="2195" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，您可以更改 creditentials.py 并用您自己的数据填充它以便登录。</p><blockquote class="ol"><p id="89d7" class="om on jj bd oo op oq or os ot ou ld dk translated">我们完了！</p></blockquote><h1 id="8711" class="ls lt jj bd lu lv lw lx ly lz ma mb mc md ov mf mg mh ow mj mk ml ox mn mo mp bi translated">后续步骤</h1><p id="79ed" class="pw-post-body-paragraph kg kh jj ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">如果你想更进一步，你还可以实现一些功能，比如在你达到某个目标时发送电子邮件，或者提取你想要跟踪数据的特定故事的数据。</p><p id="d02d" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望你喜欢这个小教程，并关注我更多！</p><p id="0525" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki jk">感谢阅读！</strong></p><figure class="lo lp lq lr gt iv gh gi paragraph-image"><a href="https://medium.com/@lazar.gugleta"><div class="gh gi oy"><img src="../Images/be10e7a3911b6f5a7dc0d973baafc3cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:200/format:webp/1*lr0F9J5kBTqSpVRXyZTxYQ.png"/></div></a><p class="jc jd gj gh gi je jf bd b be z dk translated">跟着我上<a class="ae jg" href="https://medium.com/@lazar.gugleta" rel="noopener">中型</a></p></figure><figure class="lo lp lq lr gt iv gh gi paragraph-image"><a href="https://twitter.com/intent/user?screen_name=LazarGugleta"><div class="gh gi oy"><img src="../Images/f57531852f6a5e67742319cb55c98fcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:200/format:webp/1*ZrXqWUPT9NkYwSRQDcD1eg.png"/></div></a><p class="jc jd gj gh gi je jf bd b be z dk translated">在推特上关注我</p></figure></div></div>    
</body>
</html>