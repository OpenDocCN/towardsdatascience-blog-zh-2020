<html>
<head>
<title>Churn prediction using Spark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Spark进行流失预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/churn-prediction-using-spark-d9c2da720bc8?source=collection_archive---------52-----------------------#2020-05-10">https://towardsdatascience.com/churn-prediction-using-spark-d9c2da720bc8?source=collection_archive---------52-----------------------#2020-05-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e0647d63b58169661fb5589c2536423a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dvcM-ReOfrEgwGzM"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">扎拉克·汗在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="4d68" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">项目描述</h1><p id="7b8e" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi mc translated"><span class="l md me mf bm mg mh mi mj mk di">下面这个项目试图预测一个名为<em class="ml"> Sparkify </em>的虚拟音乐流媒体服务的用户流失率。</span></p><p id="ca14" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">我在Amazon Web Services ( <strong class="lg iu"> AWS </strong>)中使用Spark和一个由3台<strong class="lg iu"> m5.xlarge </strong>机器组成的弹性Map Reduce ( <strong class="lg iu"> EMR </strong>)集群。一名司机和两名工人。数据集大小为12gb，以JSON格式从AWS简单存储服务(S3)桶中读取。该文件包含用户每天使用服务时注册的活动。</p><p id="8adb" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">至于软件库，我用过PySpark，Python的Spark API。AWS EMR版本5.29.0。逻辑回归、随机森林、梯度提升树(GBT)分类器和朴素贝叶斯形成了Spark的机器学习库。来自标准数据科学Python堆栈的Pandas和Matplotlib。</p><h1 id="b2ab" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">商业理解</h1><p id="3d28" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">客户流失预测是银行、保险公司、电信公司、有线电视运营商以及网飞、Hulu、Spotify和Apple Music等流媒体服务的一个重要分类用例。能够预测更有可能取消其服务订阅的客户的公司可以实施更有效的客户保留策略。</p><p id="e0f4" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">根据一家领先的客户参与度分析公司的研究，客户流失每年给公司带来大约1360亿美元的损失。</p><blockquote class="mr ms mt"><p id="06b4" class="le lf ml lg b lh mm lj lk ll mn ln lo mu mo lr ls mv mp lv lw mw mq lz ma mb im bi translated">贝恩公司所做的研究显示，增加<em class="it">客户保留率，仅增加</em><strong class="lg iu"><em class="it"/></strong><em class="it">5%</em><strong class="lg iu"><em class="it">25%至95% </em> </strong> <a class="ae kf" href="www2.bain.com/Images/BB_Prescription_cutting_costs.pdf" rel="noopener ugc nofollow" target="_blank"> 2 </a>。</p></blockquote><p id="b1d5" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">在减少客户流失方面投入资源的理由是基于Lee Resource Inc .的一项研究，该研究表明，吸引新客户的成本是保持现有客户的五倍以上！<a class="ae kf" href="www.forbes.com/sites/alexlawrence/2012/11/01/five-customer-retention-tipsfor-entrepreneurs/" rel="noopener ugc nofollow" target="_blank"> 3 </a>。</p><h1 id="ab7c" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">数据理解</h1><p id="bf3b" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">数据集总共有<strong class="lg iu">543705行</strong>和<strong class="lg iu"> 18列</strong>。该模式如下所示:</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/7cf25f5aa06ad0b854a9bc678727dd4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*ZWDH4VA0DOazDKBjMAdWpA.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">数据集架构</p></figure><p id="46b3" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">在<em class="ml">页面</em>类别中，我们总共有22个唯一的条目。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/eea3ee5acb391fbef883e0dbc2326da7.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*SAVftMyXyCyVmfmwKrgS1g.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd nd">页面</strong>栏目内容</p></figure><p id="a4d9" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">我定义了一个名为<strong class="lg iu"> <em class="ml">流失</em> </strong>的新列，它由任何<strong class="lg iu"> <em class="ml">取消确认</em> </strong>或<strong class="lg iu"> <em class="ml">提交降级</em> </strong>事件组成，作为用户已经离开服务或停止付费(免费订阅)的确认。每页的点击量分布如下:</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/86ddf0faa412eeb6070f0020563e4609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*6MVQZLuuWuEtE12VqGSNvA.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">每页点击量的分布</p></figure><p id="b920" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">我们可以看到<strong class="lg iu"> <em class="ml"> NextSong </em> </strong>页面被大量访问，这是有意义的，因为它表明用户正在听歌。接下来，是<strong class="lg iu"> <em class="ml">首页</em> </strong>后跟三个表示与服务交互的:<strong class="lg iu"> <em class="ml">竖起大拇指</em> </strong>，<strong class="lg iu"> <em class="ml">添加到播放列表</em> </strong>，<strong class="lg iu"> <em class="ml">添加好友</em> </strong>。这三项表明对服务的积极体验。另一方面，我们有<strong class="lg iu"> <em class="ml">滚动广告</em></strong><strong class="lg iu"><em class="ml">拇指向下</em> </strong>和<strong class="lg iu"> <em class="ml">错误</em> </strong>作为用户对服务的不良体验的可能指标。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/fd5ea31be5d58ffeda29a18815bcd500.png" data-original-src="https://miro.medium.com/v2/resize:fit:224/format:webp/1*DsBDubk3jbWKOosFwnDUvA.png"/></div></figure><p id="896d" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">从总结中可以看出，我们面对的是一个非常不平衡的数据集。未流失(0)和流失(1)的比率为<strong class="lg iu">2516</strong>。</p><p id="bc40" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">总共有<strong class="lg iu"> 225，393名女性</strong>和<strong class="lg iu"> 302，612名男性</strong>用户，其中有15，700名用户没有透露他们的性别，我将其归类为<strong class="lg iu"><em class="ml"/></strong>(不可用):</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/d92bd405a2c88c5c7905ea78d472f4ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*lWHnk30lnl16gXjsGcxnjg.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">性别栏分布</p></figure><p id="66d0" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">我们在<strong class="lg iu"><em class="ml"/></strong>计划/服务中共有<strong class="lg iu"> 428，597 <em class="ml">付费</em> </strong>用户和<strong class="lg iu"> 115，108 </strong>用户。正如我们之前所说的，我们必须确保尽可能多地保留这些付费用户，以最大化收入(或最小化损失)。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/81ebb52ab07aca6c9e4d67c956d9856f.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*-9AkHJ7_o82i5-l2u8N0Hw.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">付费用户与免费用户</p></figure><h1 id="8002" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">数据准备</h1><p id="a658" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我首先着手解决的是不平衡的问题。我用了一种叫做<strong class="lg iu"> <em class="ml">过采样</em> </strong>的技术。这是一个非常基本的方法，我利用PySpark的<em class="ml"> explode </em> dataframe特性从代表不足的类中选择尽可能多的事件(在本例中，流失等于1)来填充差异，直到我得到一个平衡的数据集来处理。</p><p id="f7ac" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">我读到过一些更高级的方法，但它们大多是为<strong class="lg iu">Pandas/Numpy</strong>data frames/sets构建的，在我的Spark环境中不能很好地并行化。这肯定需要更多的时间和调查，以找到一个更强大的解决方案。我了解到的最有希望的方法是<strong class="lg iu">击打</strong>，感兴趣的读者可以在这里<a class="ae kf" href="https://machinelearningmastery.com/smote-oversampling-for-imbalanced-classification/" rel="noopener ugc nofollow" target="_blank">和</a><a class="ae kf" href="https://arxiv.org/abs/1106.1813" rel="noopener ugc nofollow" target="_blank">找到更多细节。</a></p><p id="6cf9" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">应用这种技术后，我扩展并平衡了数据帧，使其增加了<strong class="lg iu"> ~50% </strong>:</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/a43ec060815e2177724b6b4204dc05b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:222/format:webp/1*jTXl1PVKIyLYT2Kjl0tydQ.png"/></div></figure><p id="08dc" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">从总共<strong class="lg iu"> 543，705 </strong>个条目到总共<strong class="lg iu"> 1，086，945 </strong>个条目。这被证明是非常有用的，因为我的模型的准确性提高了，我大大减少了没有它时我所面临的过度拟合问题。尽管它并不完美，还可以进一步改进。</p><p id="f971" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated"><strong class="lg iu"> <em class="ml"> userAgent </em> </strong>提供了我构建的两个特性的一些信息，我使用了:<strong class="lg iu"> <em class="ml"> os </em> </strong>和<strong class="lg iu"> <em class="ml">浏览器</em> </strong>。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/c1f87cad8179417a8e21798a75d9cd48.png" data-original-src="https://miro.medium.com/v2/resize:fit:284/format:webp/1*y38xb7xWufakj_Pitwd59w.png"/></div></figure><p id="cbea" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">从<em class="ml">浏览器</em>可以看到<strong class="lg iu">642801</strong>使用<strong class="lg iu"> Safari </strong>和<strong class="lg iu">249372</strong>使用<strong class="lg iu"> Firefox </strong>。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/66b6ee85dc798e2684b3bbba75781870.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/format:webp/1*Nw1t7RUUfm7rW0KPH_KEUg.png"/></div></figure><p id="7bf1" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated"><strong class="lg iu"> Windows </strong>是使用较多的操作系统，其次是<strong class="lg iu"> Macintosh </strong>和<strong class="lg iu"> X11 </strong> (Linux)。<strong class="lg iu"> iPhone </strong>是第四个更常用的，兼容<em class="ml">的</em>可能是指安卓？</p><p id="6bef" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">我使用了<strong class="lg iu"> <em class="ml"> ts </em> </strong>(时间戳)列来构建更多的特性。从<em class="ml"> ts </em>我构造了<strong class="lg iu"> <em class="ml">星期几</em> </strong>和<strong class="lg iu"> <em class="ml">小时</em> </strong>列。</p><p id="87ed" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">使用这些新的栏目，我们可以看到用户倾向于在一天结束时听更多的歌曲。用户在午饭后开始收听，下午4-5点达到高峰(在通勤开车期间？).</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/11f550ed70a6526ac49638903e6dfac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*SerPK2N5mxcEXKbwG9tnJw.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">一天中每小时播放的歌曲数量</p></figure><p id="081f" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">用户在工作日也更多地听歌。周四似乎是引人注目的一天，但并不能得出什么结论。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/4195f284a5d07a54336230cbeb388927.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*4ROccNcU2cDb9FUmSufCxA.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">按星期几播放的歌曲数量</p></figure><p id="98e1" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">我构建了以下特征:</p><ul class=""><li id="6a0f" class="nn no it lg b lh mm ll mn lp np lt nq lx nr mb ns nt nu nv bi translated"><strong class="lg iu"><em class="ml">saved _ Settings</em></strong>所有按“<em class="ml"> userId </em>分组的“<em class="ml">保存设置</em>”页面事件的计数</li><li id="26f1" class="nn no it lg b lh nw ll nx lp ny lt nz lx oa mb ns nt nu nv bi translated"><strong class="lg iu"> <em class="ml"> num_songs </em> </strong>用户播放的'<em class="ml">歌曲</em>'的数量统计(按'<em class="ml"> userId </em>'分组)</li><li id="c1f7" class="nn no it lg b lh nw ll nx lp ny lt nz lx oa mb ns nt nu nv bi translated"><strong class="lg iu"> <em class="ml">拇指向上</em> </strong>按“<em class="ml">用户标识</em>”分组的所有“<em class="ml">拇指向上</em>”页面事件的计数</li><li id="6bfa" class="nn no it lg b lh nw ll nx lp ny lt nz lx oa mb ns nt nu nv bi translated"><strong class="lg iu"><em class="ml">num _ advertisement</em></strong>按“<em class="ml"> userId </em>”分组的所有“<em class="ml">滚动广告</em>”页面事件的计数</li><li id="7165" class="nn no it lg b lh nw ll nx lp ny lt nz lx oa mb ns nt nu nv bi translated"><strong class="lg iu"> <em class="ml"> thumbs_down </em> </strong>按“<em class="ml"> userId </em>”分组的所有“<em class="ml"> Thumbs Down </em>页面事件的计数</li><li id="56ca" class="nn no it lg b lh nw ll nx lp ny lt nz lx oa mb ns nt nu nv bi translated"><strong class="lg iu"><em class="ml">Playlist _ added</em></strong>所有按“<em class="ml"> userId </em>”分组的“<em class="ml"> Add to Playlist </em>”页面事件的计数</li><li id="9075" class="nn no it lg b lh nw ll nx lp ny lt nz lx oa mb ns nt nu nv bi translated"><strong class="lg iu"> <em class="ml">好友_添加</em> </strong>所有按“<em class="ml"> userId </em>”分组的“<em class="ml">添加好友</em>”页面事件计数</li><li id="7f29" class="nn no it lg b lh nw ll nx lp ny lt nz lx oa mb ns nt nu nv bi translated"><strong class="lg iu"> <em class="ml"> errors_pages </em> </strong>按“<em class="ml"> userId </em>”分组的所有“<em class="ml"> Error </em>”页面事件的计数</li><li id="1c66" class="nn no it lg b lh nw ll nx lp ny lt nz lx oa mb ns nt nu nv bi translated"><strong class="lg iu"><em class="ml">songs _ persession</em></strong>用户(按'<em class="ml"> userId' </em>)在给定会话(<em class="ml"> sessionId' </em>)上播放的平均歌曲数(按'<em class="ml">下一首歌</em>'页面事件分组)</li></ul><p id="ce40" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">我使用了PySpark ML特性库中的StringIndexer、VectorAssembler和Normalizer。<strong class="lg iu"> StringIndexer </strong>将一列标签编码成一列标签索引。<strong class="lg iu"> VectorAssembler </strong>是一个转换器，它根据ML算法的要求，将给定的列/特征列表组合成一个向量列。最后，<strong class="lg iu">规格化器</strong>是一个<strong class="lg iu">转换器</strong>，它转换一个数据集的<em class="ml">向量</em>行，<em class="ml">规格化</em>每个<em class="ml">向量</em>以具有单位规格化。它采用参数p，该参数指定用于归一化的p范数。(默认情况下p=2。)这种规范化可以帮助标准化您的输入数据，并改进学习算法的行为。</p><h1 id="ed6c" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">建模</h1><p id="2907" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我已经在训练集和测试集中分别分割了80–20%的数据集，以进入建模阶段。</p><p id="17dc" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">对于建模，我使用了来自Spark ML库中的逻辑回归、随机森林分类器、GBT分类器和朴素贝叶斯算法。我衡量了表现最好的人，使用F-1评分标准作为所有人的参数来选择最好的并进行微调。</p><p id="82fc" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">F-1分数对我们的流失率预测模型更有意义，因为我们对<strong class="lg iu">假阴性</strong>和<strong class="lg iu">假阳性</strong>更感兴趣。第一个是因为它表明我们预测用户不会离开，不会流失。第二个表示我们预测要离开但没有离开的用户。综上所述，我并不是说<strong class="lg iu">真阴性</strong>(预测离开服务的用户不会离开)也不重要！</p><h1 id="30a4" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">型号选择</h1><p id="76d3" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我用“训练”数据集上的默认参数训练了<strong class="lg iu">逻辑回归</strong>、<strong class="lg iu">随机森林分类器</strong>、<strong class="lg iu"> GBT分类器</strong>和<strong class="lg iu">朴素贝叶斯</strong>算法，并用“测试”数据集对其进行了评估。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/8dc210a4d35334ea47cf243701149a24.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*hJ81-sKDqdNlEzlIFVdAzg.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">表1 —模型结果总结</p></figure><p id="b724" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">其中:</p><p id="5d3d" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated"><strong class="lg iu"> F1- </strong> F-1得分</p><p id="d013" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated"><strong class="lg iu"> WP - </strong>加权精度</p><p id="01f4" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated"><strong class="lg iu"> WR </strong> -加权召回</p><h1 id="13b5" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">最佳型号选择</h1><p id="c4b6" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">从<strong class="lg iu">表1 </strong>中我们可以看到性能最好的型号是<strong class="lg iu"> GBTClassifier </strong>。我对这个模型进行了微调，运行了一个<strong class="lg iu">交叉验证</strong>，带有<strong class="lg iu"> 5个</strong>折叠和一个参数网格，如下所示:</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/8ba3b4a01bae61c30ec06ee5743840e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*4WlDQo4xKaN6xDRP2ZJmig.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">用于模型微调的参数网格</p></figure><p id="1786" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">在获得以下值之前，我使用相同的指标对模型进行了评估:</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div class="gh gi od"><img src="../Images/30637cd9ac067c0f1576f2298d088b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*BXfyrTNIrSzHpPlz7Wdb1A.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">表2 —最佳模型参数汇总</p></figure><h1 id="6a04" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论</h1><p id="930a" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">正如我们所看到的，与之前的运行相比，这个经过微调的模型的所有指标都提高了<strong class="lg iu"> 4% </strong>，与其他模型相比几乎提高了<strong class="lg iu"> 10% </strong>！</p><p id="aa0f" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">我们的模型预测了46，435名离开的用户(真正)和58，499名没有离开的用户(真负)。该模型还预测了<strong class="lg iu"> 13，790个</strong>用户离开，而<em class="ml">没有</em>离开(假阳性)，以及<strong class="lg iu"> 4，047个</strong>用户没有离开(假阴性)。</p><p id="4ef1" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">尽管我们的模型远非完美。用一个<strong class="lg iu"><em class="ml"/></strong>的精度只有<strong class="lg iu"><em class="ml"/>的77%</strong>和一个<strong class="lg iu"> <em class="ml">的召回</em></strong><strong class="lg iu"><em class="ml"/></strong>的92%<em class="ml">意味着我们准确地正确预测了2/3的流失案例。</em></p><p id="ad39" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">GBTClassifier 是我在这个项目中尝试的所有算法中最好的，也是需要更长时间训练的一个，因为它一个接一个地训练树。我在EMR集群的性能方面遇到了问题，必须进行一些配置才能成功地在Spark中训练所有这些模型。对于所有这些细节，请前往我的<a class="ae kf" href="https://github.com/pwolter/sparkify" rel="noopener ugc nofollow" target="_blank"> GitHub </a>仓库。</p><p id="ecb8" class="pw-post-body-paragraph le lf it lg b lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx mq lz ma mb im bi translated">正如我之前提到的，这个不平衡数据集的过采样/欠采样还有很大的改进空间。如果时间和预算允许，可以使用比我在这里使用的更多的超参数进行更广泛的网格搜索，以提高模型性能，但这将需要时间和预算，因为EMR不是免费服务。</p></div></div>    
</body>
</html>