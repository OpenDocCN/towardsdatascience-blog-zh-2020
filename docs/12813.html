<html>
<head>
<title>Increase Frame Per Second (FPS) rate in the Custom Object Detection Step by step</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">逐步增加自定义对象检测中的每秒帧数(FPS)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/no-gpu-for-your-production-server-a20616bb04bd?source=collection_archive---------7-----------------------#2020-09-03">https://towardsdatascience.com/no-gpu-for-your-production-server-a20616bb04bd?source=collection_archive---------7-----------------------#2020-09-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/f2f1c2433345d05efcca98de526a2b6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rlkkNE2FTisysPmc"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae jg" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> chuttersnap </a>拍摄</p></figure><div class=""/><div class=""><h2 id="f38a" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated"><em class="ky">如何提高物体检测中的 FPS 率</em></h2></div><p id="a666" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能用过很多机器学习或者深度学习模型。但是，当谈到在云中或任何服务器上部署您的模型时，我们面临许多问题。如果你正在云中部署深度学习模型，那么主要问题是 GPU。云对在你的模型中使用 GPU 收取大量费用。您的行业不想投资 GPU，但仍然需要更好的准确性和对象检测速度。那你来对地方了。在本文中，我将介绍如何在云机器或“本地主机”机器上使用 CPU 获得更好的性能和准确性。</p><p id="72ad" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">喝杯茶，好好休息，享受旅程。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><blockquote class="mc md me"><p id="092b" class="kz la mf lb b lc ld kk le lf lg kn lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated"><strong class="lb jk">物体检测</strong>是一种计算机视觉技术，它允许我们<strong class="lb jk">识别、定位、</strong>和<strong class="lb jk">跟踪图像或视频中的物体</strong>。通过这种识别、定位和跟踪，<strong class="lb jk">对象检测</strong>可以对场景中的<strong class="lb jk">对象</strong>进行计数，并确定和跟踪它们的精确位置，同时准确标记它们。</p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="434a" class="mj mk jj bd ml mm mn mo mp mq mr ms mt kp mu kq mv ks mw kt mx kv my kw mz na bi translated"><strong class="ak">所需步骤:</strong></h1><p id="7a1a" class="pw-post-body-paragraph kz la jj lb b lc nb kk le lf nc kn lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在这里，我将简要地向您介绍我们计划提高每秒帧数(FPS)的所有其他必要步骤。FPS(每秒帧数)定义了对象检测模型处理视频并生成所需输出的速度。</p><ol class=""><li id="c4a0" class="ng nh jj lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">任何自定义对象检测的第一步都是获取图像进行标记。你可以从互联网上抓取照片，或者你可以出去寻找需要训练你的模型的对象，然后自己点击一些图像。</li><li id="4823" class="ng nh jj lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb jk">给你的图片贴上标签。为这一步提供大量数据，因为这对你的准确性至关重要。您可以使用任何工具来标注数据。没有自动标记自定义数据的方法。你必须手动操作。这是客体滞留中最令人沮丧也是最费时的部分，但是如果你把你的奉献给这一部分，你肯定会得到一个丰硕的成果。我使用了“LabelImg”工具进行标注。要了解更多关于这个工具是如何工作的，请跟随这篇文章<a class="ae jg" href="https://medium.com/@pranjalAI/how-to-label-images-for-object-detection-step-by-step-7ee317f98583" rel="noopener">如何为物体检测标记图像</a>。</strong></li><li id="c959" class="ng nh jj lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">您必须选择适当的对象检测算法。在这里，我们将使用 YOLO-泰尼。您可以参考这里的自定义对象检测代码<a class="ae jg" href="https://github.com/pranjalAI/Yolo-tiny-insurance" rel="noopener ugc nofollow" target="_blank">https://github.com/pranjalAI/Yolo-tiny-insurance</a>。</li><li id="9d22" class="ng nh jj lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">在从步骤 3 中获得 Yolo 体重文件后，您需要将 Yolo 生成的体重文件转换为 TensorFlow 服务，以便使用 TensorFlow 服务于我们的网页。</li><li id="1caa" class="ng nh jj lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">要将暗网格式的重量文件转换为 TensorFlow 格式，您需要遵循以下步骤。</li></ol><p id="e178" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">克隆这个目录【https://github.com/pranjalAI/tensorflow-yolov4-tflite T2】</p><figure class="nv nw nx ny gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nu"><img src="../Images/01c797582502f3e5094993b67b347ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xMpMs4T1jf7TX_-S"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@joshuas?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">约书亚·苏考夫</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="781e" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要使用命令提示符进入目录。</p><blockquote class="mc md me"><p id="dabb" class="kz la mf lb b lc ld kk le lf lg kn lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">安装库</p></blockquote><p id="e8d3" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您安装了 Anaconda，您需要按照下面指定的命令在一个环境中安装所有需要的库。执行完命令后，将创建一个新环境。环境名的名称可以在。yml 文件。</p><pre class="nv nw nx ny gt nz oa ob oc aw od bi"><span id="9627" class="oe mk jj oa b gy of og l oh oi"># Tensorflow CPU<br/>conda env create -f conda-cpu.yml<br/>conda activate yolov4-cpu<br/><br/># Tensorflow GPU<br/>conda env create -f conda-gpu.yml<br/>conda activate yolov4-gpu</span></pre><p id="dc32" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您没有安装 Anaconda，那么请使用 pip 命令。我建议使用 Anaconda。</p><pre class="nv nw nx ny gt nz oa ob oc aw od bi"><span id="d203" class="oe mk jj oa b gy of og l oh oi"># TensorFlow CPU<br/>pip install -r requirements.txt<br/><br/># TensorFlow GPU<br/>pip install -r requirements-gpu.txt</span></pre><p id="6b52" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，创建了具有各自依赖性的新环境。现在，要使用新创建的环境，您需要激活它。(这一步是为那些使用 Anaconda 创建环境的人准备的。)</p><figure class="nv nw nx ny gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/29394422aa952cf3ff8cf31c8e9fd00f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sYuZgXb_AjJx6YmA"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@sergeytrofimov?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Serghei Trofimov </a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><blockquote class="mc md me"><p id="5701" class="kz la mf lb b lc ld kk le lf lg kn lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">环境激活</p></blockquote><pre class="nv nw nx ny gt nz oa ob oc aw od bi"><span id="1b88" class="oe mk jj oa b gy of og l oh oi">conda activate yolov4-gpu</span></pre><p id="b3e9" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里“yolov4-gpu”是环境名。您可以在中更改它。yml 文件。(这一步是为那些使用 Anaconda 创建环境的人准备的。)如果您使用的是 pip，那么直接进行下一步。</p><p id="615e" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果您进入了刚刚克隆的文件夹，并且已经激活了环境，最后，您需要在克隆的文件夹中进行两项更改。</p><p id="7a0f" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，复制并粘贴您的自定义。重量文件到'数据'文件夹，并复制和粘贴您的自定义。“数据/类/”文件夹中。</p><p id="1d57" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其次，您需要对代码进行的唯一更改是“core/config.py”文件的第 14 行。更新代码以指向您的自定义。names 文件，如下所示。(我的习俗”。names”文件称为“custom.names ”,但您的文件可能会有不同的名称)</p><figure class="nv nw nx ny gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ok"><img src="../Images/78ce4f6e605e94651b9ea8957a4abf60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*POMDyYmK0S6RLiAH.png"/></div></div></figure><p id="bd74" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb jk">注意:</strong>如果你使用的是已经训练好的 yolov4，确保第 14 行保持<strong class="lb jk"> coco.names </strong>。</p><p id="edb1" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开始了。！现在，我们需要一个命令行来使代码 TensorFlow 兼容。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="529b" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">python save_model.py - weights。/data/your _ weight _ file . weights-output。/check points/yolo-tiny-416-input _ size 416-model yolov 4</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="0d3e" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，416 是您在训练“Yolo-tiny”模型时在配置文件中定义的图像大小。运行上面的命令后，您将得到一个“.pb”文件</p><figure class="nv nw nx ny gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ol"><img src="../Images/752bb0ee1b944347a8c1b07ce58b0d36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VDLGMeoWmAzZ1dxBcJkPoQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">的”。pb”文件给 yolo-tiny</p></figure><p id="84f5" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您需要在检测对象时给出这个文件夹的位置。而且，跑了”。py”文件来使用您训练过的对象检测器。</p><figure class="nv nw nx ny gt iv"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="70a4" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，使用 GPU，我用 YoloV4-Tiny 达到了 70 FPS，甚至有更好的准确性，可以进一步提高。使用 CPU，我达到了大约每秒 7 帧的速度。</p><blockquote class="mc md me"><p id="488f" class="kz la mf lb b lc ld kk le lf lg kn lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">进一步提高 FPS 速度的技巧</p></blockquote><p id="b1f7" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用过 416 的图像尺寸。通过将图像大小缩小到 32 的倍数，可以获得更高的帧速率。这里是速度和准确性之间的权衡。您可以减小图像尺寸，直到您的用例达到满意的精度。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><blockquote class="mc md me"><p id="c4be" class="kz la mf lb b lc ld kk le lf lg kn lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated"><em class="jj">你走之前……</em></p></blockquote><p id="8394" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这篇文章，并希望<strong class="lb jk">关注更多关于<strong class="lb jk"> Python &amp;数据科学</strong>的<strong class="lb jk">精彩文章</strong>——请点击这里<a class="ae jg" href="https://pranjalai.medium.com/membership" rel="noopener">https://pranjalai.medium.com/membership</a>考虑成为中级会员。</strong></p><p id="3d59" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请考虑使用<a class="ae jg" href="https://pranjalai.medium.com/membership" rel="noopener">我的推荐链接</a>注册。通过这种方式，会员费的一部分归我，这激励我写更多关于 Python 和数据科学的令人兴奋的东西。</p><p id="9cdc" class="pw-post-body-paragraph kz la jj lb b lc ld kk le lf lg kn lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有，可以随时订阅我的免费简讯:<a class="ae jg" href="https://pranjalai.medium.com/subscribe" rel="noopener"> <strong class="lb jk"> Pranjal 的简讯</strong> </a>。</p></div></div>    
</body>
</html>