# è¥é”€åˆ†æä¸­çš„ K-Means:èšç±» 210 ä¸ªç¾å›½ DMA

> åŸæ–‡ï¼š<https://towardsdatascience.com/k-means-in-marketing-analysis-clustering-210-us-dmas-deb9e60e3fe5?source=collection_archive---------30----------------------->

## ä»å¤´åˆ°å°¾çš„ K-Means èšç±»åˆ†æ

![](img/bd793975f07b9ec4202b0cf1acf220b6.png)

ä½©å¾·ç½—Â·æ‹‰æ–¯ç‰¹æ‹‰åœ¨ [Unsplash](https://unsplash.com/s/photos/chicago?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šçš„ç…§ç‰‡

å½“æˆ‘å¯ä»¥å°†æœºå™¨å­¦ä¹ æŠ€æœ¯åº”ç”¨äºæ—¥å¸¸è¥é”€é—®é¢˜æ—¶ï¼Œè¿™è®©æˆ‘éå¸¸å…´å¥‹ã€‚ç»™ä½ ä¸€äº›èƒŒæ™¯ï¼Œæˆ‘åœ¨ä¸€å®¶å¤§å‹å¹¿å‘Šå…¬å¸å·¥ä½œï¼Œæˆ‘çš„ä¸€äº›å®¢æˆ·æ˜¯ç¾å›½çš„é¡¶çº§å¹¿å‘Šå•†ï¼Œä»–ä»¬çš„äº§å“å’ŒæœåŠ¡è¦†ç›–æ•´ä¸ªå›½å®¶ï¼Œä»–ä»¬æœ‰å¾ˆå¤šè¥é”€é¢„ç®—è¦èŠ±(æ¯å¹´å¤§çº¦ 9 ä½æ•°ï¼).æ‰€ä»¥æˆ‘ä»¬çš„å·¥ä½œå°±æ˜¯å¸®åŠ©ä»–ä»¬èªæ˜é«˜æ•ˆåœ°èŠ±é’±ï¼

æŒ‘æˆ˜ä¹‹ä¸€æ˜¯ä¸ºæ‰€æœ‰å½“åœ°å¸‚åœºåˆ¶å®šæˆ˜ç•¥ï¼Œå³ DMA(**DMA**ä»£è¡¨â€œ**æŒ‡å®šå¸‚åœºåŒºåŸŸ**â€ï¼Œä¹Ÿå¯èƒ½è¢«ç§°ä¸ºåª’ä½“å¸‚åœº)ã€‚ç¾å›½æœ‰ 210 ä¸ª DMAï¼Œä½ å½“ç„¶å¯ä»¥æŒ‰åœ°åŒºåˆ’åˆ†ï¼Œæˆ–è€…ç®€å•åœ°æŒ‰è¥¿éƒ¨ã€ä¸œéƒ¨å’Œä¸­éƒ¨åˆ’åˆ†ã€‚ç„¶è€Œï¼Œè€ƒè™‘åˆ°å¤§åŒºåŸŸå†…çš„äººå£ç»Ÿè®¡å’Œç»æµå·®å¼‚ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›ä½¿ç”¨ä¸€äº›æ›´æ•°æ®é©±åŠ¨çš„æ–¹å¼æ¥æŸ¥çœ‹æ‰€æœ‰è¿™äº› DMAã€‚å› æ­¤ï¼Œä»Šå¤©æˆ‘å°†ä½¿ç”¨èšç±»æ¥è·å¾—å‡ ä¸ªå¸‚åœºèšç±»ï¼Œæ¯ä¸ªèšç±»ä¸­å…·æœ‰æœ€å¤§çš„ç›¸ä¼¼æ€§ã€‚

åœ¨æ·±å…¥ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘æƒ³ç»™ä½ çœ‹ä¸€ä¸‹æˆ‘åœ¨æ¢ç´¢æœºå™¨å­¦ä¹ æ—¶æœ€å–œæ¬¢çš„å›¾è¡¨ã€‚

![](img/50f5fdd0402d4e7ac2200d739c419b21.png)

èšç±»å±äº**æ— ç›‘ç£å­¦ä¹ **çš„åˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯åœ¨æ²¡æœ‰é¢„å…ˆå­˜åœ¨æ ‡ç­¾çš„æ•°æ®é›†ä¸­å¯»æ‰¾ä»¥å‰æœªæ£€æµ‹åˆ°çš„æ¨¡å¼ã€‚èšç±»èƒŒåçš„ä¸»è¦æ€æƒ³æ˜¯ï¼Œæ‚¨å¸Œæœ›ä»¥ä¸€ç§æ–¹å¼å°†å¯¹è±¡åˆ†ç»„åˆ°ç›¸ä¼¼çš„ç±»ä¸­ï¼Œå³åŒä¸€ç»„çš„æˆå‘˜ä¹‹é—´çš„ç›¸ä¼¼æ€§é«˜ï¼Œè€Œä¸åŒç»„çš„ç›¸ä¼¼æ€§ä½ã€‚

æœ€æµè¡Œå’Œæœ€å¹¿æ³›ä½¿ç”¨çš„ç®—æ³•æ˜¯ **K-Means èšç±»ç®—æ³•ã€‚**k-means èšç±»ç®—æ³•æ˜¯ä¸€ç§è¿­ä»£ç®—æ³•ï¼Œåœ¨æœªæ ‡è®°çš„æ•°æ®é›†ä¸­è¾¾åˆ°é¢„å®šæ•°é‡çš„èšç±»ï¼ŒåŸºæœ¬å·¥ä½œæ–¹å¼å¦‚ä¸‹:

1.  é€‰æ‹©ğ‘˜åˆå§‹ç§å­
2.  å°†æ¯ä¸ªè§‚å¯Ÿå€¼åˆ†é…ç»™å…·æœ‰æœ€è¿‘å¹³å‡å€¼(æœ€å°å¹³æ–¹æ¬§å‡ é‡Œå¾—è·ç¦»)çš„èšç±»
3.  ä¸ºåˆ†é…ç»™æ¯ä¸ªèšç±»çš„è§‚æµ‹å€¼é‡æ–°è®¡ç®—èšç±»è´¨å¿ƒ
4.  ç»§ç»­è¿­ä»£ï¼Œç›´åˆ°è´¨å¿ƒæ²¡æœ‰å˜åŒ–

![](img/b3fa8308a4fab01285cbe6f1bb773325.png)

k è¡¨ç¤ºèšç±»ç¤ºä¾‹(k = 7)

å¯¹äº k-means èšç±»ç®—æ³•æ¥è¯´ï¼Œä¸¤ä¸ªå‡è®¾éå¸¸é‡è¦:

1.  è¦è®¡ç®—â€œèšç±»ä¸­å¿ƒâ€ï¼Œéœ€è¦è®¡ç®—å±äºè¯¥èšç±»çš„æ‰€æœ‰ç‚¹çš„(ç®—æœ¯)å¹³å‡å€¼ã€‚åœ¨æ¯æ¬¡æ–°çš„è¿­ä»£å¼€å§‹æ—¶ï¼Œé‡æ–°è®¡ç®—æ¯ä¸ªèšç±»ä¸­å¿ƒ
2.  åœ¨é‡æ–°è®¡ç®—èšç±»ä¸­å¿ƒä¹‹åï¼Œå¦‚æœç»™å®šç‚¹ç°åœ¨æ¯”å…¶å½“å‰èšç±»çš„ä¸­å¿ƒæ›´é è¿‘ä¸åŒçš„èšç±»ä¸­å¿ƒï¼Œåˆ™è¯¥ç‚¹è¢«é‡æ–°åˆ†é…ç»™æœ€è¿‘çš„ä¸­å¿ƒ

æˆ‘å°†ç”¨ä¸€ä¸ªè¥é”€æ”¯å‡ºæ•°æ®é›†æ¥æ¼”ç¤ºå®ƒåœ¨ Python ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™ä¸ªæ•°æ®é›†æ˜¯æˆ‘ä»ä¸€å®¶ç ”ç©¶å…¬å¸ Kantar æ”¶é›†çš„ï¼Œå®ƒæ˜¯è¿‡å»ä¸¤å¹´ä¸­æ’åå‰ 30 ä½çš„ç§‘æŠ€å…¬å¸çš„æ•°æ®ã€‚

```
market.head(5)
```

![](img/a419fc094d77eb6b68748df94ad10719.png)

**æ•°æ®å­—å…¸**

*   å¸‚åœº:æŒ‡å®šå¸‚åœºåŒºåŸŸ(DMA)æ˜¯æŒ‡äººä»¬å¯ä»¥æ¥æ”¶ç›¸åŒç”µè§†å’Œå¹¿æ’­ç”µå°èŠ‚ç›®çš„åŒºåŸŸï¼Œä¹Ÿå¯èƒ½åŒ…æ‹¬å…¶ä»–ç±»å‹çš„åª’ä½“ï¼ŒåŒ…æ‹¬æŠ¥çº¸å’Œäº’è”ç½‘å†…å®¹
*   åª’ä½“:10 ç§å¸¸è§åª’ä½“ç±»å‹ï¼ŒåŒ…æ‹¬ç”µè§†ã€å¹¿æ’­ã€æˆ·å¤–ã€æ•°å­—ç­‰ã€‚
*   è§‚ä¼—äººå£:12 å²ä»¥ä¸Šçš„ç”µè§†/å¹¿æ’­è§‚ä¼—äººå£
*   å…¬å¸/å“ç‰Œ:åœ¨è¯¥å¸‚åœºåšå¹¿å‘Šçš„å…¬å¸/å“ç‰Œæ•°é‡
*   IsTop31:ç”µä¿¡è¡Œä¸šå¯¹å¸‚åœºé‡è¦æ€§çš„ä¸»è§‚åˆ†ç±»ã€‚0 è¡¨ç¤ºä¸æ˜¯å‰ 31 åå¸‚åœºï¼Œ1 è¡¨ç¤ºå‰ 31 åå¸‚åœº
*   Spend_K:ä»¥åƒç¾å…ƒè®¡çš„åª’ä½“æ”¯å‡º(000)

**é¢„å¤„ç†åˆ†ç±»å€¼**

```
#Change MARKETS to categorical 
market['DMA_Code']=market['DMA_Code'].astype('category')#One Hot Encoding for Media and Industryfrom sklearn.preprocessing import LabelBinarizerdef labelcoder(data, column):
    onehot = data.copy()
    lb=LabelBinarizer()
    lb_results = lb.fit_transform(onehot[column])
    lb_results_df = pd.DataFrame(lb_results, columns=lb.classes_)
    return lb_results_dfmedia_features = labelcoder(market, 'MEDIA')
industry_features = labelcoder(market, 'INDUSTRY')
division_features = labelcoder(market, 'Division_Name')#Put them all together
market_df = pd.concat([market['DMA_Code'],scaled_features, media_features, industry_features, division_features], axis=1)
```

**æ ‡å‡†åŒ–æ•°å­—ç‰¹å¾**

```
num_features = market[['Audience Population','BRAND','Company','IsTop31','Spend_K']]from sklearn.preprocessing import MinMaxScaler
#Scale the numerical features
scaler = MinMaxScaler()
scaled = scaler.fit_transform(num_features)
scaled_features = pd.DataFrame(scaled, columns = num_features.columns)
```

## **è®¾ç½® K-Means**

**ç”¨è‚˜æ³•æ±‚æœ€ä¼˜ K**

è¿™ä¸€æ­¥éå¸¸é‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä»…æƒ³è¦ä»»æ„æ•°é‡çš„èšç±»ï¼Œè¿˜æƒ³è¦æ‰¾åˆ°å°½å¯èƒ½å¤šåœ°åˆ†éš”æ•°æ®ç‚¹è€Œä¸å¼•å…¥æ•´ä½“å¤æ‚æ€§çš„ K çš„æ•°é‡ã€‚å¸¸ç”¨çš„åº¦é‡æ˜¯**æƒ¯æ€§â€”â€”æ ·æœ¬åˆ°å…¶æœ€è¿‘èšç±»ä¸­å¿ƒçš„å¹³æ–¹è·ç¦»ä¹‹å’Œ**

```
import matplotlib.pyplot as plt
from sklearn.cluster import KMeanssum_of_squared_distances = []K = range(1,20)
for k in K:
    km = KMeans(n_clusters=k) 
    km = km.fit(market_df)
    sum_of_squared_distances.append(km.inertia_) plt.plot(K, sum_of_squared_distances, 'bx-')
plt.xlabel('k')
plt.ylabel('Sum of Squared Distances to the Nearest Cluster')
plt.title('Elbow Method For Optimal k')
plt.show()
```

![](img/14eb183d3caecac2c0ce03e307b6d2ce.png)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ”¶ç›Šé€’å‡è¾¾åˆ° k = 3ã€‚åœ¨ k =3 ä¹‹åï¼Œåº¦é‡ä»¥æ…¢å¾—å¤šçš„é€Ÿåº¦å˜å¾—æ›´å¥½ã€‚

```
#Fit the model with k = 3
k_means = KMeans(n_clusters=3, random_state=0).fit(market_df)
cluster_preds = k_means.predict(market_df)
k_means.get_params
```

**ä½¿ç”¨ Calinski Harabasz è¯„åˆ†(æ–¹å·®æ¯”)è¯„ä¼°èšç±»é€‚åˆåº¦**

```
from sklearn.metrics.cluster import calinski_harabasz_score calinski_harabasz_score(market_df, cluster_preds)39451.77110587817
```

## è§£é‡Š

ç†è§£ k-means èšç±»ç»“æœä¸åƒè§£é‡Šç›‘ç£å­¦ä¹ ç»“æœé‚£æ ·å®¹æ˜“ï¼Œå› ä¸ºæˆ‘ä»¬æœ¬è´¨ä¸Šæ˜¯åœ¨å¯»æ‰¾æ•°æ®çš„â€œåº•å±‚â€æ¨¡å¼ï¼Œå¹¶ä¸”ç»å¸¸éœ€è¦é¢†åŸŸçŸ¥è¯†ã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æè¿°æ€§ç»Ÿè®¡æ•°æ®æ¥äº†è§£è¿™äº›åˆ†ç±»ã€‚

```
n_clusters = 3
k_means_cluster_stats = pd.DataFrame()for i in range(n_clusters):
    k_means_cluster_stats['Cluster ' + str(i+1)] = market_df[k_means.labels_ == i].mean(axis=0)

k_means_cluster_stats = k_means_cluster_stats.T
```

![](img/3933daa23e9bb57ac6fc4a1581a40cf5.png)![](img/755821fef602f2adccb54e4dfc963458.png)

æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œé›†ç¾¤ 2 æ‹¥æœ‰æœ€å¤§çš„å¹³å‡å—ä¼—ç¾¤ä½“å’Œæœ€é«˜çš„å¹³å‡æ”¯å‡ºæ°´å¹³ï¼Œè¿™å¯èƒ½è¡¨æ˜è¿™ä¸€ç»„å¸‚åœºæ˜¯æ’åå‰ 30 ä½çš„ç§‘æŠ€å…¬å¸çš„ä¸»è¦å…³æ³¨ç‚¹æˆ–é¢†åŸŸã€‚

*   é›†ç¾¤ 0 å’Œé›†ç¾¤ 2 æ··åˆäº†ä¸åŒçš„éƒ¨é—¨ï¼Œè€Œé›†ç¾¤ 1 åªæœ‰è¥¿éƒ¨å¸‚åœº
*   é›†ç¾¤ 0 çš„æœ¬åœ°æ”¯å‡ºä¸­å€¼æœ€é«˜ï¼Œæ•°å­—æ”¯å‡ºçš„ç™¾åˆ†æ¯”ä¹Ÿå¾ˆé«˜
*   ç¬¬ 1 ç»„ä¸»è¦æ˜¯æˆ·å¤–æ´»åŠ¨ï¼Œæ•°å­—æ¶ˆè´¹ç›¸å¯¹è¾ƒä½
*   ç¾¤ç»„ 2 çš„å¹¿å‘Šç”µè§†æ”¯å‡ºæœ€é«˜

æ„Ÿè°¢æ‚¨çš„å…³æ³¨ï¼Œå¸Œæœ›è¿™å¯¹æ‚¨çš„é›†ç¾¤é¡¹ç›®æœ‰æ‰€å¸®åŠ©ï¼

å®Œæ•´çš„ä»£ç å¯ä»¥åœ¨æˆ‘çš„ github [è¿™é‡Œ](https://github.com/bonniema/Competitive_Spend_Classifier)æ‰¾åˆ°ã€‚