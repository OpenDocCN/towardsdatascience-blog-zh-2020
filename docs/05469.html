<html>
<head>
<title>Pandas Query for SQL-like Querying</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫查询类似SQL的查询</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandas-query-for-sql-like-querying-279dc8cbfe3f?source=collection_archive---------18-----------------------#2020-05-08">https://towardsdatascience.com/pandas-query-for-sql-like-querying-279dc8cbfe3f?source=collection_archive---------18-----------------------#2020-05-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="02a0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用pandas查询函数查询数据帧的数据科学家python教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fd83b39c45b09ff50ffb4abf6acfdd2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KvVwf88T9KVTLTWTPN_-wQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/s/photos/panda?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">un splash</a>【1】上的<a class="ae ky" href="https://unsplash.com/@melodyp?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Mélody P </a>拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="dbe3" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">目录</h1><ol class=""><li id="ba50" class="ly lz it ma b mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">资料组</li><li id="8025" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">熊猫</li><li id="56a9" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">询问</li><li id="1210" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">教程代码</li><li id="4019" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">摘要</li><li id="aadc" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">参考</li></ol><h1 id="a7a8" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">资料组</h1><p id="79f7" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">本分析和pandas查询教程中使用的数据集是一个虚拟数据集，创建该数据集是为了模拟具有文本和数字特征的数据帧。请随意使用您自己的。csv文件，包含文本和/或数字列，以遵循教程。</p><h1 id="ec1c" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">熊猫</h1><p id="0a9b" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated"><a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">Pandas</a>【2】是数据科学家和机器学习工程师最常用的库之一。它主要用于构建模型的探索性数据分析步骤，以及模型结果的即席分析。它还包含几个功能，包括查询功能。</p><h1 id="6644" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">询问</h1><p id="d317" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">pandas中的查询函数是一个有用的函数，它的作用类似于SQL中的<em class="nn">‘where’</em>子句。然而，它的好处是，你不需要不断地从pandas、Jupyter Notebook和你目前使用的SQL平台切换。下面列出了其他一些好处:</p><ul class=""><li id="72a1" class="ly lz it ma b mb no md np mf nq mh nr mj ns ml nt mn mo mp bi translated"><em class="nn">编译几个条件</em></li><li id="0bfe" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml nt mn mo mp bi translated"><em class="nn">一个简单的函数，可以处理你的熊猫数据帧</em></li><li id="f9f6" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml nt mn mo mp bi translated"><em class="nn">引用描述性统计数据，而不是必须进行子查询</em></li></ul><h1 id="727e" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">教程代码</h1><p id="a282" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">我已经编写了几个如何使用pandas查询功能的例子。下面的屏幕截图总结了一些有用的查询示例。下面，您可以看到如何同时满足文本和数字条件。查找特定列包含特定文本值的行，或者使用<em class="nn"> '@' </em>符号创建描述性统计。例如，<em class="nn"> '@mean_of_column' </em>引用了您使用<em class="nn">建立的值。</em>函数均值()'。在第65行，返回的行具有一个<em class="nn">‘蓝色’</em>值和一个<em class="nn">‘已确认_恢复’</em>值，该值大于<em class="nn">‘已确认_恢复’</em>本身的平均值，同时还包括<em class="nn">‘标签_ 3’</em>值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/4295541bbc224b2cb65050bf4329bc6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nikBDk1cxmhGSNR0iRLwEg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">返回相等的行以及其他几个条件的示例。作者截图[3]。</p></figure><p id="4344" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nv nf ng mh nw ni nj mj nx nl nm ml im bi translated">灰色框中引用的教程代码是用于演示查询函数的所有代码。首先，我进口了熊猫并读取了我的数据帧。然后，我添加新的行，我知道这些行将满足某些条件，以显示如何使用查询函数。<em class="nn">‘append’</em>函数在这里也很有用，因为它可以快速地向数据帧中添加新行，而不必显式地以序列格式调用每一列。我返回了<em class="nn"> 'df.tail()' </em>,以查看返回的行是否是我所期望的。</p><p id="1fc4" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nv nf ng mh nw ni nj mj nx nl nm ml im bi translated">然后，我返回一列中的值等于另一列中的值的行。您也可以使用相同的逻辑，但是反过来看看您指定的列的哪些值不相等。接下来，您可以比较一列的值是否大于另一列的值，反之亦然。</p><p id="22be" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nv nf ng mh nw ni nj mj nx nl nm ml im bi translated">我认为，query最有用的特性是<em class="nn"> '@' </em>方法。就像SQL中可以使用子查询来引用选择满足特定条件的行一样，这个方法也可以。<em class="nn"> '@' </em>方法保存您想要比较的值。对于下面的例子，我查看了一列的平均值进行比较。</p><p id="7e02" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nv nf ng mh nw ni nj mj nx nl nm ml im bi translated">最后，通过输入类似于SQL中的<em class="nn">和</em>的<em class="nn"> ' &amp; ' </em>，可以使用查询函数在一行代码中执行多个条件。</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="2267" class="od lh it nz b gy oe of l og oh"># All the python code below for use:</span><span id="636b" class="od lh it nz b gy oi of l og oh"># import library</span><span id="e813" class="od lh it nz b gy oi of l og oh">import pandas as pd</span><span id="4200" class="od lh it nz b gy oi of l og oh"><br/># read in your dataframe</span><span id="38f1" class="od lh it nz b gy oi of l og oh">df = pd.read_csv('/Users/example.csv')</span><span id="0350" class="od lh it nz b gy oi of l og oh"># write out new rows</span><span id="a76e" class="od lh it nz b gy oi of l og oh">rows = [pd.Series([100, 100, 20,'Blue','Label_1'], index=df.columns),</span><span id="586f" class="od lh it nz b gy oi of l og oh">pd.Series([100, 80, 60,'Blue','Label_1'], index=df.columns),</span><span id="4299" class="od lh it nz b gy oi of l og oh">pd.Series([80, 60, 100,'Blue','Label_1'], index=df.columns)]</span><span id="a408" class="od lh it nz b gy oi of l og oh"># append the multiple rows</span><span id="1d07" class="od lh it nz b gy oi of l og oh">new_df = df.append(rows , ignore_index=True)</span><span id="e8f1" class="od lh it nz b gy oi of l og oh"># check the newest 3 rows you made</span><span id="464a" class="od lh it nz b gy oi of l og oh">new_df.tail(3)</span><span id="c125" class="od lh it nz b gy oi of l og oh"># return rows where values from one column equal that of another</span><span id="910d" class="od lh it nz b gy oi of l og oh"># they do not for this comparison</span><span id="1188" class="od lh it nz b gy oi of l og oh">new_df.query('Confirmed_Test == Confirmed_New')</span><span id="8430" class="od lh it nz b gy oi of l og oh"># return rows where values from one column equal that of another</span><span id="1fb0" class="od lh it nz b gy oi of l og oh"># they do for this comparison</span><span id="b7ad" class="od lh it nz b gy oi of l og oh">new_df.query('Confirmed_Test == Confirmed_Recovery')</span><span id="70bf" class="od lh it nz b gy oi of l og oh"># return rows where values from one column do not equal that of another</span><span id="6c1e" class="od lh it nz b gy oi of l og oh"># they do for this comparison</span><span id="d938" class="od lh it nz b gy oi of l og oh">new_df.query('Confirmed_New != Confirmed_Recovery').head()</span><span id="46d0" class="od lh it nz b gy oi of l og oh"># return rows where values from one column are bigger than that of another</span><span id="9cda" class="od lh it nz b gy oi of l og oh">new_df.query('Confirmed_New &gt; Confirmed_Recovery').head()</span><span id="8943" class="od lh it nz b gy oi of l og oh"># see which rows where the 'Confirmed_New' values</span><span id="1f18" class="od lh it nz b gy oi of l og oh"># are greater than the mean of the total column</span><span id="b72b" class="od lh it nz b gy oi of l og oh"># use the '@' to reference 'cn_mean'</span><span id="de3e" class="od lh it nz b gy oi of l og oh">cn_mean = new_df['Confirmed_New'].mean()</span><span id="1d3e" class="od lh it nz b gy oi of l og oh">new_df.query('Confirmed_New &gt; @cn_mean').head()</span><span id="0cfa" class="od lh it nz b gy oi of l og oh"># multiple conditions example</span><span id="9d7f" class="od lh it nz b gy oi of l og oh">cn_min = new_df['Confirmed_New'].min()</span><span id="d029" class="od lh it nz b gy oi of l og oh">cn_max = new_df['Confirmed_New'].max()</span><span id="7183" class="od lh it nz b gy oi of l og oh">new_df.query('Confirmed_New &gt; @cn_min &amp; Confirmed_New &lt; @cn_max').head()</span><span id="7514" class="od lh it nz b gy oi of l og oh"># text conditions</span><span id="990c" class="od lh it nz b gy oi of l og oh"># use double quotes for matching on the string value</span><span id="62e4" class="od lh it nz b gy oi of l og oh"># all the rows returned have 'Blue' for the 'Text_Feature' column</span><span id="e90c" class="od lh it nz b gy oi of l og oh">new_df.query('Text_Feature == "Blue"').head()</span><span id="9253" class="od lh it nz b gy oi of l og oh"># return rows which have a 'Blue' value, and a 'Confirmed_Recovery' that is greater</span><span id="ce37" class="od lh it nz b gy oi of l og oh"># than the mean of 'Confirmed_Recovery' itself, while also satisfying the 'Label_3' value</span><span id="56c2" class="od lh it nz b gy oi of l og oh"># only 3 return here (did not print out head())</span><span id="ddba" class="od lh it nz b gy oi of l og oh">cr_mean = new_df['Confirmed_Recovery'].mean()</span><span id="30c8" class="od lh it nz b gy oi of l og oh">new_df.query('Text_Feature == "Blue" &amp; Confirmed_Recovery &gt; @cr_mean &amp; Text_Predictor == "Label_3"')</span></pre><p id="04bd" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nv nf ng mh nw ni nj mj nx nl nm ml im bi translated">要查看python格式的代码而不是写出的代码，下面是嵌入的<a class="ae ky" href="https://gist.github.com/mprzybyla123/1e564183cb64ba29fa17b23e94459db2" rel="noopener ugc nofollow" target="_blank">要点</a>【4】:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure><h1 id="1dd8" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">摘要</h1><p id="ed23" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">pandas的查询功能是操作数据框架的一种简单快捷的方式。您可以使用类似SQL的子句返回满足您确定的条件的某些行。这是有益的，如果你已经在你的Jupyter笔记本。ipynb文件或。py文件，而不必在SQL平台上重新上传或执行SQL命令。熊猫查询也很直观，不需要很长时间就能学会。我希望本文中的例子对您有用。感谢您的阅读！</p><h1 id="3361" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">参考</h1><p id="e32d" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">[1] <a class="ae ky" href="https://unsplash.com/@melodyp?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">梅洛迪P </a>，<a class="ae ky" href="https://unsplash.com/s/photos/panda?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a> (2017)</p><p id="3513" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nv nf ng mh nw ni nj mj nx nl nm ml im bi translated">[2]熊猫，<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫</a> (2020)</p><p id="5b7e" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nv nf ng mh nw ni nj mj nx nl nm ml im bi translated">[3] M.Przybyla，截图(2020年)</p><p id="78a7" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nv nf ng mh nw ni nj mj nx nl nm ml im bi translated">[4] M.Przybyla，<a class="ae ky" href="https://gist.github.com/mprzybyla123/1e564183cb64ba29fa17b23e94459db2" rel="noopener ugc nofollow" target="_blank">要点</a> (2020)</p></div></div>    
</body>
</html>