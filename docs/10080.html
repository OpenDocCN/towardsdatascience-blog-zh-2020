<html>
<head>
<title>Five Tidyverse Tricks You May Not Know About</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你可能不知道的五个小技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/five-tidyverse-tricks-you-may-not-know-about-c5026d5a19da?source=collection_archive---------14-----------------------#2020-07-16">https://towardsdatascience.com/five-tidyverse-tricks-you-may-not-know-about-c5026d5a19da?source=collection_archive---------14-----------------------#2020-07-16</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="0f9b" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">这些例子说明了为什么 R 现在是直观数据操作的首选语言</h2></div><p id="3275" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">最近通过与 tidyverse 的许多其他用户合作，我突然意识到，有许多人并不知道这个软件包集合为他们提供的帮助他们处理日常数据争论的所有东西。特别是，两个关键的软件包在过去的一年中进行了重大更新，并引入了我认为具有变革性的新功能——允许用户在控制数据和提高代码效率方面加快步伐。</p><p id="5efb" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">2019 年末，<code class="fe lg lh li lj b">tidyr 1.0.0</code>发布。在众多更新中，最关键的是引入了函数<code class="fe lg lh li lj b">pivot_longer()</code>和<code class="fe lg lh li lj b">pivot_wider()</code>来更好地管理和控制数据帧从宽格式到长格式的转换——这是最常见的数据争论任务之一。取代了<code class="fe lg lh li lj b">gather()</code>和<code class="fe lg lh li lj b">spread()</code>，这些新功能引入了更多管理转换细节的能力，在用户如何定制其输出方面为他们节省了时间。</p><p id="ca0c" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">2020 年初，<code class="fe lg lh li lj b">dplyr 1.0.0</code>上映。这个版本中的新功能范围很广，但特别是引入了作为副词与<code class="fe lg lh li lj b">summarise()</code>和<code class="fe lg lh li lj b">mutate()</code>一起使用的<code class="fe lg lh li lj b">across()</code>和<code class="fe lg lh li lj b">c_across()</code>，简化了用户需要处理的范围变量的数量，并且像<code class="fe lg lh li lj b">tidyr</code>变化一样，允许更好地控制输出的外观。</p><p id="b8be" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">这两个更新都利用了 R 生态系统中的重大创新，包括<code class="fe lg lh li lj b">rlang</code>、<code class="fe lg lh li lj b">vctrs</code>和<code class="fe lg lh li lj b">glue</code>等的更新。</p><p id="466f" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">因此，如果您还没有查看这些更新，现在是查看 tidyverse 包的好时机。在本文中，我想向您展示它们如何让您的生活变得更加轻松，以及如何使用它们用更少的代码来处理数据。为此，我将展示五个你可能不知道的简单例子。</p><h1 id="d298" class="lk ll iv bd lm ln lo lp lq lr ls lt lu kb lv kc lw ke lx kf ly kh lz ki ma mb bi translated">1.在<code class="fe lg lh li lj b">tidyr::pivot_wider()</code>中任意组合列名</h1><p id="0c0a" class="pw-post-body-paragraph kk kl iv km b kn mc jw kp kq md jz ks kt me kv kw kx mf kz la lb mg ld le lf io bi translated"><code class="fe lg lh li lj b">pivot_wider()</code>的整体思想是，你想要获取长格式的数据，并将其转换为宽格式。例如，假设您的数据如下所示:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="ded0" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">现在，假设您有兴趣查看每种风暴状态每年的平均压力和中值压力。您可以使用<code class="fe lg lh li lj b">pivot_wider()</code>,它很聪明地知道您正在尝试做什么，并在默认情况下将列名粘贴在一起:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="c23f" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">您还受益于<code class="fe lg lh li lj b">names_glue</code>参数，它允许您使用简单而直观的<code class="fe lg lh li lj b">glue</code>语法按照自己的意愿构造组合的列名:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><h1 id="6415" class="lk ll iv bd lm ln lo lp lq lr ls lt lu kb lv kc lw ke lx kf ly kh lz ki ma mb bi translated">2.使用<code class="fe lg lh li lj b">tidyr::pivot_longer()</code>任意分解列维度</h1><p id="cb44" class="pw-post-body-paragraph kk kl iv km b kn mc jw kp kq md jz ks kt me kv kw kx mf kz la lb mg ld le lf io bi translated">如果您有表示多个维度的宽数据，您可以将其转换为长数据，并在<code class="fe lg lh li lj b">pivot_longer()</code>的<code class="fe lg lh li lj b">names_pattern</code>参数中使用 regex 从列名中分离出任意数量的维度。例如，要将之前的表格移回长表格，我们可以这样做:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><h1 id="f8bb" class="lk ll iv bd lm ln lo lp lq lr ls lt lu kb lv kc lw ke lx kf ly kh lz ki ma mb bi translated">3.使用<code class="fe lg lh li lj b">dplyr::across()</code>对任意多的列进行汇总或变异</h1><p id="9b1c" class="pw-post-body-paragraph kk kl iv km b kn mc jw kp kq md jz ks kt me kv kw kx mf kz la lb mg ld le lf io bi translated"><code class="fe lg lh li lj b">across()</code>是 dplyr 中的一个新副词，它允许您灵活地处理任意数量的列，并更好地控制输出。以前，如果您想在许多列上进行许多操作，您需要使用<code class="fe lg lh li lj b">summarise()</code>和<code class="fe lg lh li lj b">mutate()</code>的作用域变体来实现这一点，并且默认输出不容易控制。例如:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="c6e6" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">现在副词<code class="fe lg lh li lj b">across()</code>可以用于所有情况，以达到相同的目的，所以你不再需要使用<code class="fe lg lh li lj b">_if</code>、<code class="fe lg lh li lj b">_at</code>和<code class="fe lg lh li lj b">_all</code>的变体。它充当在<code class="fe lg lh li lj b">summarise()</code>或<code class="fe lg lh li lj b">mutate()</code>中使用的选择函数，并提供对<code class="fe lg lh li lj b">.names</code>参数的简单使用，以使用<code class="fe lg lh li lj b">glue</code>语法控制输出的列名:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><h1 id="0362" class="lk ll iv bd lm ln lo lp lq lr ls lt lu kb lv kc lw ke lx kf ly kh lz ki ma mb bi translated">4.使用<code class="fe lg lh li lj b">dplyr::nest_by()</code>对嵌套数据运行模型</h1><p id="4f0e" class="pw-post-body-paragraph kk kl iv km b kn mc jw kp kq md jz ks kt me kv kw kx mf kz la lb mg ld le lf io bi translated">需要对数据帧的子集执行操作是很常见的，这需要您根据某些变量来嵌套数据。以前，这只能通过组合像<code class="fe lg lh li lj b">tidyr::nest()</code>、<code class="fe lg lh li lj b">dplyr::group_by()</code>和<code class="fe lg lh li lj b">dplyr::rowwise()</code>这样的函数来实现，但是新的<code class="fe lg lh li lj b">dplyr::nest_by()</code>函数现在可以处理所有这些，并减少你需要键入的代码量。</p><p id="1c43" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">假设您想在<code class="fe lg lh li lj b">mtcars</code>上运行一个线性模型，但是您想对不同的圆柱体模型分别执行。对于<code class="fe lg lh li lj b">nest_by()</code>来说，这是一份完美的工作。当您使用<code class="fe lg lh li lj b">nest_by()</code>时，嵌套数据帧的“列表列”在名为<code class="fe lg lh li lj b">data</code>的列中生成，如下所示:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="ce8a" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">然后，您可以在进一步的命令中引用该列，允许您执行非常复杂的操作，如运行模型，或者执行您自己的函数:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="bb61" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">现在，为了使我们的输出更加漂亮和用户友好，我们可以使用我们之前学到的一些技巧:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><h1 id="a032" class="lk ll iv bd lm ln lo lp lq lr ls lt lu kb lv kc lw ke lx kf ly kh lz ki ma mb bi translated">5.使用<code class="fe lg lh li lj b">dplyr::summarise()</code>和<code class="fe lg lh li lj b">dplyr::mutate()</code>生成对象——不仅仅是值</h1><p id="7008" class="pw-post-body-paragraph kk kl iv km b kn mc jw kp kq md jz ks kt me kv kw kx mf kz la lb mg ld le lf io bi translated">列表列的美妙之处在于，您可以在其中存储许多不同的内容，而不仅仅是值。现在，您可以使用我们的老朋友<code class="fe lg lh li lj b">summarise()</code>和<code class="fe lg lh li lj b">mutate()</code>来生成不仅包含值，还包含数据框架、模型甚至图表的列。</p><p id="a691" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">在这个例子中，我使用<code class="fe lg lh li lj b">ggplot2</code>创建了一些简单的函数来生成散点图和箱线图。然后，我嵌套我的数据并变异生成这些图的新列。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="0c32" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">如您所见，所有的图现在都存储在我们创建的两个列表列中。我们现在可以方便地把它们拿出来使用。例如，使用<code class="fe lg lh li lj b">patchwork</code>:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mm mn l"/></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mo"><img src="../Images/d4471371bc714aa5be0efaa17066c568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ApKOrFXbUFZ3WYnC"/></div></div></figure></div><div class="ab cl mv mw hz mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="io ip iq ir is"><p id="4e02" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">最初我是一名纯粹的数学家，后来我成为了一名心理计量学家和数据科学家。我热衷于将所有这些学科的严谨性应用到复杂的人的问题上。我也是一个编码极客和日本 RPG 的超级粉丝。在<a class="ae nd" href="https://www.linkedin.com/in/keith-mcnulty/" rel="noopener ugc nofollow" target="_blank"><em class="nc">LinkedIn</em></a><em class="nc">或</em><a class="ae nd" href="https://twitter.com/dr_keithmcnulty" rel="noopener ugc nofollow" target="_blank"><em class="nc">Twitter</em></a><em class="nc">上找我。也可以看看我在</em><a class="ae nd" href="http://drkeithmcnulty.com/" rel="noopener ugc nofollow" target="_blank"><em class="nc">drkeithmcnulty.com</em></a><em class="nc">上的博客。</em></p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi ne"><img src="../Images/65d4f77ddca316f42bc17a19593721f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fPwBdQkX2V3PxKldwteopA.jpeg"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">维基共享照片</p></figure></div></div>    
</body>
</html>