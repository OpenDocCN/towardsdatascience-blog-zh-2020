<html>
<head>
<title>tSNE vs. UMAP: Global Structure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多伦多证交所与UMAP:全球结构</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tsne-vs-umap-global-structure-4d8045acba17?source=collection_archive---------1-----------------------#2020-03-04">https://towardsdatascience.com/tsne-vs-umap-global-structure-4d8045acba17?source=collection_archive---------1-----------------------#2020-03-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="f51d" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/stats-ml-life-sciences" rel="noopener" target="_blank">生命科学的数理统计和机器学习</a></h2><div class=""/><div class=""><h2 id="6792" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">为什么保护全球结构很重要</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi kr"><img src="../Images/e97d64bda5a6086a18457330887c3a92.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*3aJ1OUXZGxs-ffv2AQUidA.jpeg"/></div><p class="kz la gj gh gi lb lc bd b be z dk translated"><a class="ae ld" href="http://mathworld.wolfram.com/Gyroid.html" rel="noopener ugc nofollow" target="_blank">图片来源</a></p></figure><p id="238a" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">这是来自专栏<a class="ae ld" href="https://towardsdatascience.com/tagged/stats-ml-life-sciences?source=post_page---------------------------" rel="noopener" target="_blank"> <strong class="lg jd">生命科学的数理统计和机器学习</strong> </a>的第十五篇文章，我试图以简单的方式解释生物信息学和计算生物学中使用的一些神秘的分析技术。诸如<a class="ae ld" href="https://en.wikipedia.org/wiki/T-distributed_stochastic_neighbor_embedding" rel="noopener ugc nofollow" target="_blank"> <strong class="lg jd"> tSNE </strong> </a> <strong class="lg jd">和</strong><a class="ae ld" href="https://umap-learn.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"><strong class="lg jd">UMAP</strong></a><strong class="lg jd">之类的降维技术对于许多类型的数据分析来说绝对是核心</strong>，然而令人惊讶的是，人们对它们到底是如何工作的却知之甚少。之前，我开始在我的文章<a class="ae ld" rel="noopener" target="_blank" href="/how-exactly-umap-works-13e3040e1668">中比较tSNE和UMAP,</a><a class="ae ld" rel="noopener" target="_blank" href="/how-to-program-umap-from-scratch-e6eff67f55fe">UMAP到底是如何工作的</a>,如何从零开始为UMAP编程<a class="ae ld" rel="noopener" target="_blank" href="/why-umap-is-superior-over-tsne-faa039c28e99">以及</a><a class="ae ld" rel="noopener" target="_blank" href="/why-umap-is-superior-over-tsne-faa039c28e99">为什么UMAP优于tSNE </a>。今天，我将分享我对tSNE和UMAP在多大程度上能够保持你的数据中的全局结构的看法，以及为什么它很重要。我将尝试使用真实世界的scRNAseq数据以及已知基本事实的合成数据，展示UMAP更好地保存全球结构的T28数学原因。我将特别提出<strong class="lg jd">大困惑/ n_neighbors的限制</strong>，其中两种算法大概都可以保留全局结构信息。</p><h1 id="aaed" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">UMAP组件上的聚类</h1><p id="d262" class="pw-post-body-paragraph le lf it lg b lh ms kd lj lk mt kg lm ln mu lp lq lr mv lt lu lv mw lx ly lz im bi translated">如果你只把tSNE和UMAP用于高维数据的可视化，你可能从来没有想过它们能保留多少全局结构。事实上，tSNE和UMAP都被设计为主要保留<strong class="lg jd">局部结构</strong>，即将相邻的数据点组合在一起，这确实为数据中的<strong class="lg jd">异质性</strong>提供了非常丰富的可视化信息。数据可视化的质量，即保留局部结构，在tSNE和UMAP之间是<strong class="lg jd">可比的</strong>，前提是您正确地<a class="ae ld" rel="noopener" target="_blank" href="/how-to-tune-hyperparameters-of-tsne-7c0596a18868"> <strong class="lg jd">调整了它们的超参数</strong> </a>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi mx"><img src="../Images/fc1cf0b40e0ef6022a2c8e65fd3fd34b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gENT6BciUf2x3PkktMH-1g.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">tSNE和UMAP同样很好地可视化细胞群体(保留局部结构)，<a class="ae ld" href="https://satijalab.org/seurat/v3.0/mca.html" rel="noopener ugc nofollow" target="_blank">图像来源</a></p></figure><p id="8c71" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">然而，如果您想进行下一步并了解数据点聚类之间的<strong class="lg jd">相关性</strong>，这可能会很麻烦，因为tSNE和UMAP作为邻居图算法<strong class="lg jd">不能保证聚类间的距离被正确保留</strong>。评估聚类之间的相关性实质上意味着在聚类之间建立<strong class="lg jd">层次和边界</strong>，以便查看聚类的起点和终点。因此，我们到达了<strong class="lg jd">集群</strong>问题。由于<a class="ae ld" href="https://en.wikipedia.org/wiki/Curse_of_dimensionality" rel="noopener ugc nofollow" target="_blank">维数灾难</a>和选择适当的距离度量，在原始数据上运行聚类不是一个好主意。取而代之的是<strong class="lg jd">在降维上的聚类</strong> <strong class="lg jd">(使用PCA、tSNE或UMAP) </strong>可以更健壮。降低聚类的维度正是你开始看到tSNE和UMAP之间差异的地方。</p><p id="e92a" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">为了证明这一点，我使用来自<a class="ae ld" href="https://www.ncbi.nlm.nih.gov/pubmed/26878113" rel="noopener ugc nofollow" target="_blank">bjrklund等人</a>的scRNAseq数据，并在1)原始表达数据、2)显著的30个PCA主成分(PCs)、3) tSNE 2D投影和4) 30个UMAP成分上比较K均值聚类。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nc"><img src="../Images/52a928adb3b7d46f5d16250bea71bc15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I2ErNq2tppdms4w22OqIFQ.png"/></div></div></figure><p id="f59d" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">如我们所见，由于scRNAseq数据的维数灾难和非线性，当在原始表达数据(~15 000个基因)上进行聚类时，K-means <strong class="lg jd">与降维图像</strong>不一致，并且30个PC显然也是K-means难以成功的高维空间。相反，仅在2个tSNE分量和30个UMAP分量上的聚类导致聚类和tSNE降维图像之间几乎完美的一致。tSNE上的聚类应该与tSNE图一致，这并不奇怪，但是2D tSNE表示可能没有捕捉到数据中的大量变化，因此tSNE上的聚类被广泛认为是一个糟糕的想法。然而，由于算法的限制，增加tSNE组件的数量几乎是不可能的。相比之下，UMAP提供2个以上的分量，例如，在我们的例子中是30个，与30个PCA分量相比，它可以捕获数据中更多的<strong class="lg jd">变化</strong>。总之，虽然使用tSNE的2D降维过于极端，但使用PCA的30D降维可能无法捕捉到数据中的足够多的变化，因此在数量为 <strong class="lg jd">的UMAP组件</strong>上的<strong class="lg jd">聚类在极端降维的聚类(例如2D tSNE)和使用PCA的非最优降维(过于线性或仍然过于高维)的聚类之间给出了一个很好的折衷。</strong></p><blockquote class="nd"><p id="bf53" class="ne nf it bd ng nh ni nj nk nl nm lz dk translated">30个UMAP分量比30个PCA分量在数据中保留更多的变化，因此更适于聚类</p></blockquote><h1 id="50b2" class="ma mb it bd mc md me mf mg mh mi mj mk ki nn kj mm kl no km mo ko np kp mq mr bi translated">量化全局结构保存</h1><p id="3612" class="pw-post-body-paragraph le lf it lg b lh ms kd lj lk mt kg lm ln mu lp lq lr mv lt lu lv mw lx ly lz im bi translated">在上一节中，我解释了UMAP组件上的集群如何比tSNE或PCA组件上的集群更有益。然而，如果我们决定在UMAP组件上进行聚类，我们需要确保UMAP正确地保留了聚类内(局部结构)和聚类之间(全局结构)的数据点之间的距离<strong class="lg jd">，因此我们将花费一些时间来尝试理解如何通过PCA、tSNE和UMAP来观察和量化全局结构保留。通过使用真实世界的scRNAseq数据集的算法来量化全局结构保留可能不太容易，因为一般来说<strong class="lg jd">基本事实</strong>是未知的。这就是具有已知原始结构</strong>的<strong class="lg jd">合成数据</strong> <strong class="lg jd">非常方便的地方，这里我们将使用具有5个集群/大陆(不包括南极洲)的点的2D世界地图集合，有关如何从头构建数据集的详细信息，请参见我的<a class="ae ld" href="https://github.com/NikolayOskolkov/tSNE_vs_UMAP_GlobalStructure" rel="noopener ugc nofollow" target="_blank"> github </a>上的完整笔记本。</strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nq"><img src="../Images/c7faa84da2d5a957a94ccbaed5a0a401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2SQFbn6LK9tiRfusKEtH-Q.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">合成2D数据集(世界地图),包含5个集群/大洲</p></figure><p id="c889" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">由于我们对大陆之间的距离以及它们的T2形状有一些感觉，这就是我们可以直观地称之为“全球结构”，我们可以通过运行PCA、tSNE和UMAP降维算法来尝试重建原始数据。由于原始数据集是线性/平面流形，我们可以预期线性降维比非线性降维做得更好。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi mx"><img src="../Images/3ba645bc2a75d8dbb099109458b6fd42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a6RNdzCoKTNc-yUgW9bFQQ.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">用PCA、tSNE(困惑= 500)和UMAP (n_neighbor = 500)重建世界地图</p></figure><p id="9957" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">不出所料，<strong class="lg jd"> PCA能够完美地重建原始数据集</strong>，除了翻转极点，这很好，因为PCA对数据的仿射变换是不变的，如翻转、旋转、平移等。tSNE和UMAP的表现比PCA差，但方式不同，尽管我对它们使用了相同的PCA初始化。我们可以立即观察到，tSNE将南美洲置于非洲和北美洲之间，而当UMAP重建时，它或多或少地保持了原来的距离。为了量化所有点对之间的原始距离保持得有多好，我们可以计算原始和重建的成对欧几里德距离之间的<a class="ae ld" href="https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient" rel="noopener ugc nofollow" target="_blank"> <strong class="lg jd">斯皮尔曼相关系数</strong> </a> <strong class="lg jd"> </strong>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nq"><img src="../Images/c1760a529019979c5ba0d58b123e3a92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UmVyYjAyc13GRQByYE0V9Q.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">通过降维算法量化成对距离保持</p></figure><p id="2bca" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">执行<a class="ae ld" href="https://en.wikipedia.org/wiki/Mann%E2%80%93Whitney_U_test" rel="noopener ugc nofollow" target="_blank"> Mann-Whitney U检验</a>，我们可以得出结论<strong class="lg jd"> UMAP比tSNE </strong>更好地保持了成对欧几里德距离(p值= 0.001)。箱线图中的置信区间是通过自举程序建立的，详见我的<a class="ae ld" href="https://github.com/NikolayOskolkov/tSNE_vs_UMAP_GlobalStructure" rel="noopener ugc nofollow" target="_blank"> Github </a>上的代码。现在让我们计算原始的和重建的大陆间距离之间的Spearman相关性。测量聚类的质心之间的距离，即忽略数据中的变化，可能不是一个很好的主意，因为聚类被拉长了。因此，一个更好的想法是计算所有聚类对之间的<strong class="lg jd">马氏距离</strong>。<a class="ae ld" href="https://en.wikipedia.org/wiki/Mahalanobis_distance" rel="noopener ugc nofollow" target="_blank"> Mahalanobis距离</a>首先计算一个聚类的每个点到第二个聚类的质心之间的距离，并通过第二个聚类中变化的“厚度”(假设该聚类具有椭球对称性)来归一化这些距离。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nr"><img src="../Images/4be26a2f1660490a2ded549e40d6d83a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XWlJeZV5Ta19mlYAxycYhg.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">世界地图中各大洲/星团之间成对马氏距离的保持</p></figure><p id="3d6e" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">在这里，我们观察到，虽然对于南美、澳洲和非洲不清楚，至少对于北美和欧亚大陆，UMAP比tSNE更好地保留了这些集群和其他集群之间的原始Mahalanobis距离。对所有聚类进行平均(上图中的最后一个图)并执行Mann-Whitney U检验，我们证明了<strong class="lg jd"> UMAP确实更好地保留了大陆/聚类之间的原始马氏距离</strong> (p值= 0.034)。最后，让我们将聚类的<strong class="lg jd">形状</strong>的保持作为数据的全局结构的另一种度量。为此，我们将使用聚类周围边界框的大小。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ns"><img src="../Images/60a298fc9ec69f681036c878274c9898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2T8Hoqq6i-jfWOgzvmeYIg.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">环绕世界地图各大洲的边界框作为聚类形状的度量</p></figure><p id="87a5" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">再次计算原始大陆和重建大陆周围的边界框大小(高度和宽度)之间的Spearman相关系数，我们可以观察到，尽管有很多变化<strong class="lg jd">，UMAP明显比tSNE</strong>(Mann-Whitney U检验p值= 0.021)更好地保留了集群的形状，见下图。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nt"><img src="../Images/7e547f68806b5238520a8ead14018d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4fu_DL60jj8GCrPtqw40Kw.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">世界地图各大陆原始形状和重建形状之间的相关性</p></figure><p id="8666" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">这里我特意省略了自举过程，以表明tSNE著名的<strong class="lg jd">随机性仅仅来源于默认随机初始化</strong>的 <strong class="lg jd">。用PCA或图拉普拉斯算子初始化，tSNE成为一个<strong class="lg jd">确定性</strong>方法。相比之下，<strong class="lg jd"> UMAP由于通过<a class="ae ld" href="https://en.wikipedia.org/wiki/Stochastic_gradient_descent" rel="noopener ugc nofollow" target="_blank">随机梯度下降(SGD) </a>对其代价函数(交叉熵)进行优化，即使用PCA或图拉普拉斯算子进行非随机初始化也能保持其随机性。绝对清楚的是，上面所有的tSNE与UMAP的定量比较都是用<strong class="lg jd">相同的PCA初始化</strong>对两种方法进行的，因此初始化不能成为解释它们在全局结构保留方面差异的因素。</strong></strong></p><h1 id="8cc1" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">初始化与成本函数</h1><p id="a402" class="pw-post-body-paragraph le lf it lg b lh ms kd lj lk mt kg lm ln mu lp lq lr mv lt lu lv mw lx ly lz im bi translated">为tSNE和UMAP指定相同的PCA初始化，我们避免了文献中关于仅由不同初始化场景驱动的tSNE与UMAP的比较的<a class="ae ld" href="https://www.biorxiv.org/content/10.1101/2019.12.19.877522v1" rel="noopener ugc nofollow" target="_blank">混淆。记住，两种算法都利用梯度下降来计算最佳嵌入。根据定义，梯度下降规则从一些<strong class="lg jd">随机或非随机(PCA)初始化</strong>开始，并通过计算成本函数的梯度来优化<strong class="lg jd">成本函数</strong>。</a></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nu"><img src="../Images/13cdfafd55eed74a76586a9fd4b67d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Si9c4cx86qKqKU0zKW8cuw.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">梯度下降规则:最终嵌入依赖于初始化和成本函数</p></figure><p id="eb8f" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">假设tSNE和UMAP都已经用PCA进行了非随机初始化，我们观察和量化的输出中的所有差异都源于<strong class="lg jd">内在的算法特性，例如成本函数</strong>。我在这里<a class="ae ld" rel="noopener" target="_blank" href="/how-exactly-umap-works-13e3040e1668">和</a><a class="ae ld" rel="noopener" target="_blank" href="/why-umap-is-superior-over-tsne-faa039c28e99">展示了UMAP对成本函数的更明智选择促进了更好的全局结构保存。</a></p><h1 id="08d8" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">非线性流形的tSNE与UMAP</h1><p id="6653" class="pw-post-body-paragraph le lf it lg b lh ms kd lj lk mt kg lm ln mu lp lq lr mv lt lu lv mw lx ly lz im bi translated">以前，我们在线性平面(世界地图)上使用合成的2D数据点集合。现在让我们将2D数据点嵌入到<strong class="lg jd"> 3D非线性流形</strong>中。例如，这可以是球体/地球仪，然而，事实证明，这种嵌入<a class="ae ld" href="https://en.wikipedia.org/wiki/Mercator_projection" rel="noopener ugc nofollow" target="_blank">不是无足轻重的，因为它导致数据的<strong class="lg jd">严重</strong> <strong class="lg jd">失真</strong>。因此，我们将把世界地图嵌入到经典的<strong class="lg jd">瑞士卷</strong>非线性流形中，它代表了3D空间中的一种阿基米德螺旋。我们将再次运行PCA，tSNE和UMAP降维，试图重建原始的世界地图。请注意，数据的固有维度仍然是2D，因此良好的降维应该<strong class="lg jd">展开瑞士卷</strong>。</a></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nv"><img src="../Images/e8a4eaf208da6d04726e1439ce5f9d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hifenKGiQWd2pzSjw5Ts8w.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">用PCA、tSNE(困惑=50)和UMAP (n_neighbor=50)重建投影在三维瑞士卷上的世界地图</p></figure><p id="6eb3" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">我们首先看到的是PCA未能解开瑞士卷，即重建原始的2D世界地图。这是因为PCA作为线性算法为所有成对距离分配相等的权重，而相比之下，非线性流形学习器如tSNE和UMAP优先考虑邻居之间的距离，这种策略允许他们计算出数据的内在2D维度。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nw"><img src="../Images/d864002344b71dae8f96bca7e6d768e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tow2mi86HQ1rogqiWQInLw.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">通过非线性流形上的PCA、tSNE和UMAP保持成对距离，<a class="ae ld" href="https://jakevdp.github.io/PythonDataScienceHandbook/05.10-manifold-learning.html" rel="noopener ugc nofollow" target="_blank">图像源</a></p></figure><p id="5614" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">此外，查看tSNE世界地图重建，我们可以立即注意到，如果一个人沿着从南美洲到非洲的路线，他会经过<strong class="lg jd">欧亚大陆，因为某种原因tSNE将它放置在南美洲和非洲</strong>之间。相比之下，<strong class="lg jd"> UMAP正确地将非洲置于南美洲和欧亚大陆之间</strong>。</p><p id="a5b3" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">有一个<a class="ae ld" href="https://stats.stackexchange.com/questions/263539/clustering-on-the-output-of-t-sne" rel="noopener ugc nofollow" target="_blank"> <strong class="lg jd">假设</strong></a>tSNE和UMAP能够在非常大的困惑/ n邻居超参数值下重建原始数据。让我们用嵌入到3D中的世界地图来检验它是否正确。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nx"><img src="../Images/a48b4e9d261582fba68e0e5ee03b5308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRLP3fhECgy_R7TdmoNb0Q.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">tSNE在瑞士卷上投影世界地图的大困惑极限</p></figure><p id="1446" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">这里我们观察到一个有趣的效应。<strong class="lg jd">在较大的困惑值下，tSNE的数据重建质量没有提高而是下降</strong>。困惑= 2000的tSNE可视化没有提醒你什么吗？正确，这看起来像上面的PCA重建。增加学习率和迭代次数并不能解决问题，欢迎大家来查。但是发生了什么？显然，tSNE在大的困惑值下存在收敛问题，<a class="ae ld" rel="noopener" target="_blank" href="/how-to-tune-hyperparameters-of-tsne-7c0596a18868">查看轴</a>。仔细观察tSNE在大困惑值时的梯度，发现<strong class="lg jd">非常接近0 </strong>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ny"><img src="../Images/37905a7acf4bb91113ad0a398b8db9e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*As-eWIBtpjNHrgVMSA-U5g.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">tSNE梯度在大的困惑值处消失</p></figure><p id="ca36" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">根据上面的梯度下降规则，当成本函数的梯度接近零时，<strong class="lg jd"> tSNE不更新初始PCA初始化</strong>。因此它看起来像</p><blockquote class="nd"><p id="8588" class="ne nf it bd ng nh ni nj nk nl nm lz dk translated">如果您用PCA初始化tSNE并增加困惑值，您将面临最终只使用PCA的风险</p></blockquote><p id="b6cd" class="pw-post-body-paragraph le lf it lg b lh nz kd lj lk oa kg lm ln ob lp lq lr oc lt lu lv od lx ly lz im bi translated">在下一节中，我们将展示这个结论是如何从tSNE的梯度方程中得出的。到目前为止，让我们看看<strong class="lg jd">UMAP在n_neighbor </strong>的表现，这是UMAP对tSNE困惑的模拟。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi oe"><img src="../Images/15e5cf98b61588912d2b18649b4b65de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L1_1m7y__SYIak4Fn_RQNw.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">瑞士卷上世界地图投影的UMAP大近邻限制</p></figure><p id="87eb" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">这非常有趣，<strong class="lg jd"> UMAP似乎对n_neighbor </strong>超参数不太敏感。在下一节中，我们将再次理解这种行为背后的数学原理。</p><h1 id="9fe8" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">全局结构保存背后的数学</h1><p id="149f" class="pw-post-body-paragraph le lf it lg b lh ms kd lj lk mt kg lm ln mu lp lq lr mv lt lu lv mw lx ly lz im bi translated">假设tSNE和UMAP都用PCA相同地初始化，UMAP保留更多全局结构的一个原因是成本函数 的<a class="ae ld" rel="noopener" target="_blank" href="/why-umap-is-superior-over-tsne-faa039c28e99"> <strong class="lg jd">更好选择。然而，在这里，我将试图从不同的角度来看UMAP的更好的全球结构保存，暂时忽略tSNE和UMAP之间的成本函数的差异。tSNE和UMAP都定义了高维度的<strong class="lg jd">概率，以观察某个距离</strong>处的点，这些点属于以下指数族:</strong></a></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi of"><img src="../Images/eeb4103f9ea3e693a695011d16157544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*IbB0YzRcZPFxQymV5hGtJg.png"/></div></figure><p id="2963" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">这里<em class="og"> σ </em>是一个参数，负责<strong class="lg jd">细胞/样品能够在多大程度上相互“感觉”</strong>。由于<em class="og"> σ </em>是一个<strong class="lg jd">有限值，即不趋向于无穷大</strong>，每个数据点只能“感觉”到其<strong class="lg jd">最近邻居</strong>的存在，而不能感觉到远点的存在，因此tSNE和UMAP都是<strong class="lg jd">邻居图</strong>算法，因此保留了数据的<strong class="lg jd">局部结构</strong>。然而，在极限<em class="og"> σ </em> →∞中，每个点都有机会“记住”其他每个点，因此在这个极限<strong class="lg jd">中，理论上tSNE和UMAP都可以保留全局结构</strong>。然而，不是<em class="og"> σ </em>本身才是tSNE和UMAP的实际超参数，而是分别为<strong class="lg jd">困惑度</strong>和<strong class="lg jd">最近邻数n_neigbor </strong>。让我们检查什么样的困惑和n_neighbors值导致极限<em class="og"> σ </em> →∞。为此，我们将采用真实世界的scRNAseq数据集，即<a class="ae ld" href="https://www.nature.com/articles/s41467-018-07582-3" rel="noopener ugc nofollow" target="_blank">癌症相关成纤维细胞(CAFs) </a>基因表达，并计算均值<em class="og"> σ </em>如何依赖于困惑和n_neighbor超参数。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi oh"><img src="../Images/1b3ef878c98770eb7e684ced1e855750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KB8Z0_zx2PJvvjv9CqbkmQ.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">对于tSNE / UMAP，作为困惑度/ n_neighbor的函数的平均sigma的行为</p></figure><p id="5447" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">事实证明，当增加n_neighbor超参数时，<strong class="lg jd"> UMAP的均值sigma非常快地达到平稳状态</strong>，而tSNE似乎对困惑更敏感，因为<strong class="lg jd"> tSNE的均值sigma在接近数据集大小的困惑处双曲线发散</strong>。请查看我的<a class="ae ld" href="https://github.com/NikolayOskolkov/tSNE_vs_UMAP_GlobalStructure" rel="noopener ugc nofollow" target="_blank"> github </a>上的笔记本了解计算的细节。请注意，UMAP平均西格玛(平台水平)的绝对值可以由两个附加的UMAP超参数调节:<strong class="lg jd">带宽和local_connectivity </strong>，然而，相关性平均西格玛对n_neighbor将具有相同的缓慢对数增长。因此，我们证实了我们之前的经验观察，即<strong class="lg jd"> tSNE对困惑比UMAP对n_neighbor </strong>更敏感。tSNE的均值sigma在大范围内的近似双曲线散度对tSNE成本函数(KL-散度)的梯度有<strong class="lg jd">的显著影响。在极限<em class="og"> σ </em> →∞中，上述方程中的高维概率变为1，这导致KL-散度梯度的退化。</strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi oi"><img src="../Images/8196610c9823230cc36605f060ea797a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6w3O8bXiWBAzjQn-94Xdog.png"/></div></div></figure><p id="99a4" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">这就是为什么对于大困惑，我们有一个tSNE嵌入，看起来类似于瑞士卷的PCA图像。因此，当在大的困惑极限中使用tSNE时需要小心，并且<strong class="lg jd">监控KL-散度<strong class="lg jd">的梯度</strong>，以便tSNE不会退化到类似PCA / MDS </strong>的线性。最后，请注意，合成世界地图2D和3D数据集的相关性均值sigma与困惑度/ n_neighbor看起来非常类似于上面为CAFs scRNAseq数据计算的值，可以在我的<a class="ae ld" href="https://github.com/NikolayOskolkov/tSNE_vs_UMAP_GlobalStructure" rel="noopener ugc nofollow" target="_blank"> github </a>上的Jupyter笔记本中找到。</p><h1 id="5f34" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">摘要</h1><p id="39ec" class="pw-post-body-paragraph le lf it lg b lh ms kd lj lk mt kg lm ln mu lp lq lr mv lt lu lv mw lx ly lz im bi translated">在这篇文章中，我们已经了解到当使用tSNE和UMAP超越数据可视化时，全局结构保持是非常重要的。使用线性和非线性流形，我们从不同的角度展示了<strong class="lg jd"> UMAP保存了更多的数据全局结构</strong>。这与成本函数的<strong class="lg jd">选择和相对于n_neighbor </strong> UMAP超参数的 <strong class="lg jd">均值sigma的</strong> <strong class="lg jd">非常慢的对数</strong> <strong class="lg jd">依赖性有关。相比之下，tSNE在较大的困惑值下显示出平均sigma的近似<strong class="lg jd">双曲线发散</strong>，这可能会导致tSNE成本函数</strong>的梯度<strong class="lg jd">消失以及算法收敛的严重问题。</strong></p><p id="e38f" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">在下面的评论中让我知道生命科学中的哪些分析技术对你来说似乎特别神秘，我会在以后的文章中尽量介绍它们。在我的<a class="ae ld" href="https://github.com/NikolayOskolkov/tSNE_vs_UMAP_GlobalStructure" rel="noopener ugc nofollow" target="_blank"> Github </a>上查看帖子中的代码。在媒体<a class="oj ok ep" href="https://medium.com/u/8570b484f56c?source=post_page-----4d8045acba17--------------------------------" rel="noopener" target="_blank">关注我，在Twitter @NikolayOskolkov关注我，在Linkedin </a>关注我。下一次，我将转向进化生物学，并展示如何利用古代DNA来估算种群数量，敬请关注。</p></div></div>    
</body>
</html>