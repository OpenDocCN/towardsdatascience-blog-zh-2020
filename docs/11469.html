<html>
<head>
<title>Google Sheets, Meet Pandas DataFrame</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌床单，遇见熊猫数据框</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/google-sheets-pandas-dataframe-6b8666f9cf6?source=collection_archive---------11-----------------------#2020-08-09">https://towardsdatascience.com/google-sheets-pandas-dataframe-6b8666f9cf6?source=collection_archive---------11-----------------------#2020-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3e43" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">🐍跳电子表格之舞:简单的方法。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/35c44f8d3938cfa9c12b6ad2dfae239d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*56FJ_Xjo5YsYhszg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@mbaumi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米卡·鲍梅斯特</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="8aa0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可能是因为在键盘后面呆的时间太长了。但是有时候我在网上的阅读和观看让我觉得我是一个濒临灭绝的开发者。在电子表格中工作的人。每一天。</p><p id="af24" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你能相信吗？开发人员，像不存在的电子表格一样过他们的生活。如果你是这些人中的一员，我想见见你。要知道<em class="ls">你</em>的存在，这并不全是我耳畔的狂言。</p><p id="b24c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于我们其余的人来说，电子表格是非常重要的东西。爱他们或者恨他们，那些二进制的行和列是没有用的。简而言之，哲学课就是<em class="ls">电子表格就是</em>。每个非开发人员的员工都在电子表格中拯救了清洁工的生命。</p><blockquote class="lt lu lv"><p id="19bb" class="kw kx ls ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><em class="iq">“电子表格是。”把这个存在主义的重磅炸弹交给一所大学；哲学荣誉博士学位肯定会随之而来。</em></p></blockquote><p id="5414" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Excel 和 Google Sheets，它们毫无用处；除非我们把自动化和知识工作者传递电子表格的仪式分开，否则我们的生产力也不会提高。</p><h1 id="ce6c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">我的三段两分钱</h1><p id="4460" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">就个人而言，我喜欢好的电子表格。对于管理数据，快速和肮脏的计算，可视化一维时间序列…5 次中有 4 次我会打开 Excel 或 Google 工作表，而不是启动 Jupyter 服务器。</p><p id="d044" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除此之外，<em class="ls">业务中的 spreadsheetitis </em>是不知道如何移动数据的一种症状。我亲眼见过“人肉路由器”问题严重到 20 多个(20 个！)人们在最终——幸运的是——将一个版本的电子表格放入“数据库”(另一个电子表格)之前接触过它。</p><p id="2248" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还有电子表格。当有一个大写的“S”的电子表格时，你就知道这个行业是数据地狱。经理们认为<em class="ls">就是</em>业务。</p><h1 id="c973" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">自动化你的理智之路</h1><p id="f945" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们将讨论几个用于 Python 中 Google Sheets I/O 的库。无论是哪种方法，你都必须在谷歌云平台(谷歌版的 AWS 和 Azure)的迷宫般的控制台内启用 Google Sheets API。幸运的是，Google——go figure——在控制台中有一个很棒的搜索功能，我们将使用它来帮助您进行设置。</p><h2 id="45b3" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">疯狂第一——从谷歌云平台获取一个<code class="fe ni nj nk nl b">credentials.json</code>文件</h2><p id="e583" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">前往<a class="ae kv" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">console.cloud.google.com/</a>，使用谷歌账户登录，访问您想要自动化的电子表格。该 API 可用于 GSuite 和免费的 Google 账户。如果这是一个工作拥有的电子表格，与 GCP 访问的管理员将不得不按照这些步骤，给你的凭证文件。</p><p id="0c86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选择顶部导航栏中的项目。每个资源都保存在项目中，就像 Azure 中的资源组一样。如果您还没有，请选择项目下拉列表和“新建项目”。然后搜索“Google Sheets API”，如果你是个虐待狂，想用鼠标探索仪表盘，就在“APIs &amp; Services”下面。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/ecfdd15b85725a83acfe845407275620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p0Utb-hqsMhwN7Kli3w1CA.png"/></div></div></figure><p id="11c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“启用”API。</p><p id="0a5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在你需要为 Google Drive API 做同样的事情。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/5e162ad7e0ae7585f1128fa91b39e9d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_N33qFWGP6XIkjS2bpyzgA.png"/></div></div></figure><p id="b5b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，您需要创建一个服务帐户，然后您将为其创建凭据。</p><p id="3592" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">步骤:</p><ul class=""><li id="eca1" class="no np iq ky b kz la lc ld lf nq lj nr ln ns lr nt nu nv nw bi translated">你在谷歌云平台&gt;谷歌工作表 API 在<a class="ae kv" href="console.cloud.google.com/apis/api/sheets.googleapis.com" rel="noopener ugc nofollow" target="_blank">console.cloud.google.com/apis/api/sheets.googleapis.com</a></li><li id="aea4" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">前往侧边栏上的凭证<code class="fe ni nj nk nl b">🗝 Credentials</code>。</li><li id="068c" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">选择<code class="fe ni nj nk nl b">+ CREATE CREDENTIALS</code> &gt;服务账号。OAuth 是一个不同的故事。本文涵盖了服务器端的内部使用。创建服务帐户。</li><li id="08ba" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">下一个视图是为服务帐户选择 IAM 角色。这是可选的，跳过它。</li><li id="06e1" class="no np iq ky b kz nx lc ny lf nz lj oa ln ob lr nt nu nv nw bi translated">接下来是“授予用户对此服务帐户的访问权限(可选)”。也跳过。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/62571126964d3c529116eba717ef7fbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PIQajqCphqWw87KMnnS2cA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/61093b2d7c5de0d0af7c8e42015a13c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPRXI9DM1mZ-nufhd1XIHA.png"/></div></div></figure><p id="6c72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您将回到“项目[项目名称]的服务帐户”屏幕。点击超链接<code class="fe ni nj nk nl b">Email</code>字段或汉堡菜单(三点)&gt; <code class="fe ni nj nk nl b">Create key</code>，选择表格中的服务账户。</p><p id="f291" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">无论哪种方式，<code class="fe ni nj nk nl b">ADD KEY</code>或<code class="fe ni nj nk nl b">Create key</code>，选择 JSON 键类型和<code class="fe ni nj nk nl b">CREATE</code>。这会将一个 JSON 文件下载到您的计算机上。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/f408772d8c75c43359f146ed5b5345cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UvY9BlC816XXKDInHLbAGw.png"/></div></div></figure><p id="fd81" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后一件事:电子表格。这里我为这个例子创建了一个。请注意 Omnibar 中 URL 的突出显示部分。这是文档的 ID。大多数库都给出了引用整个 URL 或者只引用这个 ID 的选择。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/0ba1a393fcdb734f6bce437c4a5bc441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jRH_QHUeNJdIYk-9aKFrgg.png"/></div></div></figure><p id="43f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以从<a class="ae kv" href="https://docs.google.com/spreadsheets/d/11zmk55OFpFL5HW_MhPfqfC-GjRQvHlI_M-jtHcBzyzA/edit?usp=sharing" rel="noopener ugc nofollow" target="_blank">这里</a>查看并下载电子表格。</p><p id="c5d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为服务帐户打开从 GCP 下载的<code class="fe ni nj nk nl b">credentials.json</code>文件。复制<code class="fe ni nj nk nl b">client_email</code>属性中的电子邮件值。用这封邮件分享谷歌表单。这使服务帐户可以访问在另一个帐户(不是服务帐户)上创建的电子表格。</p><p id="f09e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">唷。这是所有谷歌基础设施的东西。我保证。</p><p id="dd36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以开始写 Python 代码了。</p><h2 id="a48c" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">尝试开源库</h2><p id="8df3" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">谷歌有一个用于<a class="ae kv" href="https://developers.google.com/sheets/api/" rel="noopener ugc nofollow" target="_blank">工作表</a>的 API，就像它用于所有谷歌驱动产品一样。有了它的<a class="ae kv" href="https://developers.google.com/sheets/api/quickstart/python" rel="noopener ugc nofollow" target="_blank"> Python 库</a>，没有什么是你做不到的。</p><p id="dcea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管如此，你还是会疯狂地使用它。</p><p id="d3fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我对电子表格的强硬态度是，它们是向商业用户传递数据的一种可移植的、可视化的方式。数据矩形，左上角的单元格 A1。不是玩鲍勃·罗斯🎨具有条件格式的🖌，在同一工作表中形成群岛的数据岛，或创建类似 Tableau 的图表仪表板。</p><p id="703a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并不是说所有这些事情都不好。我已经用电子表格自动化掉进那些兔子洞很多次了。只是，当你深入研究 Google Sheets 这些年来内置的所有功能时，编码的回报时间比下降得很快。</p><p id="cca8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章是关于数据输入和数据输出的。最快解决问题的时间胜出。</p><p id="4950" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在 Python 数据方面，这意味着使用 pandas <a class="ae kv" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.htmlhttps://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank">数据帧</a>。在 Google Sheets 连接器方面，它更悬而未决。是时候去 GitHub 购物了。</p><p id="7d3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，这里有三个我最喜欢的包装 Google Sheets API 的第三方 Python 库:</p><p id="c41c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">EZSheets</p><p id="f01f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">阿尔·斯威加特不会做错事。他的书<em class="ls">用 Python 自动化枯燥的东西</em>一手教会了我如何为金钱编码。我还是一个月参考几次。</p><p id="39b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">斯威加特是一个巨大的大脑，他有能力把复杂的东西分解成我能消化的婴儿食品。EZSheets  (GitHub)是他的创造，还有 Gmail、日历和 Drive 的兄弟界面。</p><p id="d7f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">EZSheets 以其一次更新一组数据的清晰方法而大放异彩。也用于选择列和行。我还没有找到另一个库能像这个库一样捕捉到遍历单元格的复杂性。其他库并不比 Sheets API 更好，其中用于处理数据的嵌套的<code class="fe ni nj nk nl b">for</code>循环让我眩晕。</p><p id="af0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">gspread</p><p id="354f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">gspread  (GitHub)是另一个大脑 Anton Burnashev 设计的库。gspread 非常受欢迎，已经成为希望使用 Google Sheets 的 Python 开发人员的事实上的库。</p><p id="a921" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有充分的理由。文档<a class="ae kv" href="https://gspread.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">很棒，源代码清晰，布局合理，文档字符串也不错。另外，gspread 的界面包装了一些 Google Sheets 格式功能。它也有处理熊猫和 NumPy 数组的方法。</a></p><p id="5810" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">gspread-dataframe(获胜者)</p><p id="dab6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个由罗宾·托马斯构建的 gspread 库的包装器，<a class="ae kv" href="https://github.com/robin900/gspread-dataframe" rel="noopener ugc nofollow" target="_blank">gspread-data frame</a>(GitHub)是我用 DataFrames 读写 Google Sheets 的首选包。</p><p id="a248" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">文档<a class="ae kv" href="https://pythonhosted.org/gspread-dataframe/" rel="noopener ugc nofollow" target="_blank">很好，但是有点多余。源代码很简短，有两个函数，<code class="fe ni nj nk nl b">get_as_dataframe</code>和<code class="fe ni nj nk nl b">set_with_dataframe</code>。</a></p><p id="ced6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">gspread-dataframe 是我们将在本教程中使用的。</p><h2 id="9405" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">密码</h2><p id="b1e3" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">场景:我们有一个正在进行的电影之夜的数据表。同事需要每天手动向列中添加值。当我们安排新的电影之夜时，我们需要收集输入到表单中的手写数据，并在顶部添加新的电影。</p><p id="f4a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个例子是虚构的，但是我有多个中型科技公司的客户要求这个功能。你可以想象有一个数据库，里面有像<code class="fe ni nj nk nl b">movies</code>和<code class="fe ni nj nk nl b">movienights</code>这样的表，有一个视图功能将这些表连接到这个表中，电影之夜的协调员帮助填写这个表。</p><p id="dae7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了成熟的 web 应用程序或表单软件，使用电子表格作为表示层和数据输入层实际上非常方便。</p><blockquote class="lt lu lv"><p id="9eb8" class="kw kx ls ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><em class="iq">奖励:有了 pandas 1.1.0，我们可以从 DataFrame 上的一个方法生成一个没有索引的减价表！</em></p><p id="1504" class="kw kx ls ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><em class="iq">df . head①。to _ markdown(index = False)<br/><br/>' | IMDB URL | IMDB Score | Length | Attendees | Mood | Staff Notes | \ n |:——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————Length | enders | Mood |😓|克星开飞机✈ |' </em></p></blockquote><p id="c12c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的数据:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="fd02" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">写入 Google 工作表</h2><p id="c282" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">先安装<code class="fe ni nj nk nl b">gspread_dataframe</code>。因为它是<code class="fe ni nj nk nl b">gspread</code>的包装器，我们将需要那个库和它的<code class="fe ni nj nk nl b">oauth2client</code>依赖。</p><pre class="kg kh ki kj gt og nl oh oi aw oj bi"><span id="7c28" class="mw ma iq nl b gy ok ol l om on">pip install gspread_dataframe gspread oauth2client</span></pre><p id="ab17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查您是否可以连接到工作表:</p><pre class="kg kh ki kj gt og nl oh oi aw oj bi"><span id="4a4b" class="mw ma iq nl b gy ok ol l om on">$ ipython<br/>Python 3.8.1 (tags/v3.8.1:1b293b6, Dec 18 2019, 23:11:46) [MSC v.1916 64 bit (AMD64)]<br/>Type 'copyright', 'credits' or 'license' for more information<br/>IPython 7.12.0 -- An enhanced Interactive Python. Type '?' for help.<br/>In [1]: import gspread<br/>   ...: from gspread_dataframe import (get_as_dataframe,<br/>   ...:                                set_with_dataframe)<br/>   ...: from oauth2client.service_account import ServiceAccountCredentials<br/>   ...: scope = ["https://spreadsheets.google.com/feeds",<br/>   ...:          "https://www.googleapis.com/auth/drive"]<br/>   ...: credentials = ServiceAccountCredentials.from_json_keyfile_name("./credentials.json", scope)<br/>   ...: gc = gspread.authorize(credentials)<br/>   ...: gc.open_by_key("11zmk55OFpFL5HW_MhPfqfC-GjRQvHlI_M-jtHcBzyzA")<br/>Out[1]: &lt;Spreadsheet 'Google Sheets Automation! 🐍' id:11zmk55OFpFL5HW_MhPfqfC-GjRQvHlI_M-jtHcBzyzA&gt;</span></pre><p id="dfd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果连接有问题，请阅读由<code class="fe ni nj nk nl b">gspread</code>抛出的异常，它非常有用。记住，JSON 文件下载的密钥有一个<code class="fe ni nj nk nl b">client_email</code>。该电子邮件需要与其共享工作表。OAuth 库需要在正确的文件路径下访问<code class="fe ni nj nk nl b">credentials.json</code>。记得把文件重命名为<code class="fe ni nj nk nl b">credentials.json</code>。</p><p id="8a01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在来给 Google Sheets 写信。</p><pre class="kg kh ki kj gt og nl oh oi aw oj bi"><span id="b84e" class="mw ma iq nl b gy ok ol l om on"># gsheets.py<br/>​<br/>import gspread<br/>from gspread_dataframe import (get_as_dataframe,<br/>                               set_with_dataframe)<br/>from oauth2client.service_account import ServiceAccountCredentials<br/>import pandas as pd<br/>​<br/>​<br/>FILE_KEY: str = "11zmk55OFpFL5HW_MhPfqfC-GjRQvHlI_M-jtHcBzyzA"<br/>SHEET_NAME: str = "movie night"<br/>​<br/>​<br/>def _get_worksheet(<br/>    key:str,<br/>    worksheet_name:str,<br/>    creds:"filepath to Google account credentials"="credentials.json",<br/>    ) -&gt; gspread.Worksheet:<br/>    """ return a gspread Worksheet instance for given Google Sheets workbook/worksheet """<br/>    scope = ["https://spreadsheets.google.com/feeds",<br/>             "https://www.googleapis.com/auth/drive"]<br/>    credentials = ServiceAccountCredentials.from_json_keyfile_name(creds, scope)<br/>    gc = gspread.authorize(credentials)<br/>    wb = gc.open_by_key(key)<br/>    sheet = wb.worksheet(worksheet_name)<br/>    return sheet<br/>​<br/>​<br/>def write(sheet: gspread.Worksheet, df: pd.DataFrame, **options) -&gt; None:<br/>    set_with_dataframe(sheet, df,<br/>                     include_index=False,<br/>                     resize=True,<br/>                     **options)</span></pre><p id="22f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用这些函数:</p><pre class="kg kh ki kj gt og nl oh oi aw oj bi"><span id="ba35" class="mw ma iq nl b gy ok ol l om on">sh: gspread.Worksheet = _get_worksheet(FILE_KEY, SHEET_NAME)<br/>​<br/>""" Here you are getting your data. Usually this would be a<br/>database. But it could be another spreadsheet, serialized data,<br/>generated from Python code... wherever. """<br/>df = pd.read_pickle("./movienight2.pickle")<br/>​<br/>write(sh, df)</span></pre><p id="fd72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ni nj nk nl b">set_as_dataframe</code>(信用罗宾·托马斯，<code class="fe ni nj nk nl b">gspread-dataframe.py</code>)选项:</p><pre class="kg kh ki kj gt og nl oh oi aw oj bi"><span id="c09b" class="mw ma iq nl b gy ok ol l om on">:param worksheet: the gspread worksheet to set with content of DataFrame.<br/>:param dataframe: the DataFrame.<br/>:param include_index: if True, include the DataFrame's index as an<br/>        additional column. Defaults to False.<br/>:param include_column_header: if True, add a header row or rows before data with<br/>        column names. (If include_index is True, the index's name(s) will be<br/>        used as its columns' headers.) Defaults to True.<br/>:param resize: if True, changes the worksheet's size to match the shape<br/>        of the provided DataFrame. If False, worksheet will only be<br/>        resized as necessary to contain the DataFrame contents.<br/>        Defaults to False.<br/>:param allow_formulas: if True, interprets `=foo` as a formula in<br/>        cell values; otherwise all text beginning with `=` is escaped<br/>        to avoid its interpretation as a formula. Defaults to True.</span></pre><p id="1890" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Python 写 Google Sheets！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/5495949e4cc490ca43c1fdca59ac7958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8lFw4C1xLCm2UKb98Q3hUA.png"/></div></div></figure><p id="b2b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不错！(我喜欢看电脑做苦工。意味着我不用工作了。😄)注意<code class="fe ni nj nk nl b">resize=True</code>选项是如何使工作表适应数据框形状的。</p><p id="1e1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不过，还可以更好。在写入工作表之前，将对数据帧进行一些调整。日期格式为 datetime。同样，让我们使用单元格公式的力量来整理 IMDB 链接。</p><pre class="kg kh ki kj gt og nl oh oi aw oj bi"><span id="2bee" class="mw ma iq nl b gy ok ol l om on">def _to_string(df: pd.DataFrame, *cols) -&gt; pd.DataFrame:<br/>    for col in cols:<br/>        if col in df.columns:<br/>            df[col] = df[col].astype(str)<br/>    return df<br/>​<br/>def hyperlink_formula(df: pd.DataFrame, textcol: str, linkcol: str) -&gt; pd.DataFrame:<br/>    ix: int = df.columns.tolist().index(textcol)<br/>    vals: pd.Series = \<br/>        '=HYPERLINK("' + df["IMDB URL"] + '", "' + df["Movie"] + '")'<br/>    df.insert(ix, textcol+"_temp", vals)<br/>    df.drop([textcol, linkcol], axis=1, inplace=True)<br/>    df.rename(columns={textcol+"_temp": textcol}, inplace=True)<br/>    return df<br/>​<br/>sh: gspread.Worksheet = _get_worksheet(FILE_KEY, SHEET_NAME)<br/>df = pd.read_pickle("./movienight1.pickle")<br/>​<br/>df = _to_string(df, "Date", "Movie")<br/>df = hyperlink_formula(df, "Movie", "IMDB URL")<br/>​<br/>write(sh, df)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/c6307a7566a9a07b5ad33a0d5b5580e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5eRANbS3PHl-73nBhYv_3A.png"/></div></div></figure><p id="704f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">干净多了。现在，<code class="fe ni nj nk nl b">Movie</code>栏有了有效的超链接！</p><p id="3e3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当新的电影之夜被插入到数据库中时，运行 Python 脚本的调度程序更新该表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/9f4697e74aadf44348579841d8cfbf36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T1J6Es68YayLhY5ue6Q-OQ.png"/></div></div></figure><h2 id="a1c7" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">从谷歌工作表中读取</h2><p id="3a41" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">电影《夜秘》统计人头，解读人群，写下对事件的评论。人类仍然比机器做得更好的事情。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/d000e0058a65f66e2c590766b6222dad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1UshBncXGPWXcI6fFlNMQ.png"/></div></div></figure><p id="0a88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让 Python 来吃吧。要插入数据库，保存在 S3 桶，文件系统或其他地方。</p><p id="837a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我们使用<code class="fe ni nj nk nl b">gspread_dataframe</code> : <code class="fe ni nj nk nl b">get_as_dataframe</code>提供的另一个函数。</p><p id="d6c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ni nj nk nl b">set_as_dataframe</code>选项(再次感谢罗宾·托马斯，<code class="fe ni nj nk nl b">gspread-dataframe.py</code>):</p><pre class="kg kh ki kj gt og nl oh oi aw oj bi"><span id="0016" class="mw ma iq nl b gy ok ol l om on">:param worksheet: the worksheet.<br/>:param evaluate_formulas: if True, get the value of a cell after<br/>        formula evaluation; otherwise get the formula itself if present.<br/>        Defaults to False.<br/>:param nrows: if present and not None, limits the number of rows read from the worksheet.<br/>                Defaults to None. See pandas documentation for more info on this parameter.<br/>:param \*\*options: all the options for pandas.io.parsers.TextParser,<br/>        according to the version of pandas that is installed.<br/>        (Note: TextParser supports only the default 'python' parser engine,<br/>        not the C engine.)</span></pre><p id="a23d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码:</p><pre class="kg kh ki kj gt og nl oh oi aw oj bi"><span id="3a8f" class="mw ma iq nl b gy ok ol l om on">def read(sheet: gspread.Worksheet, **options) -&gt; pd.DataFrame:<br/>    return get_as_dataframe(sheet,<br/>                     evaluate_formulas=False,<br/>                     **options)<br/>​<br/>df = read(sh)<br/>(df[df["Movie"].str.contains("Rambo")]<br/>    .values.tolist()<br/>)</span></pre><p id="3d6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将返回:</p><pre class="kg kh ki kj gt og nl oh oi aw oj bi"><span id="51c0" class="mw ma iq nl b gy ok ol l om on">[['2020-08-28',<br/>  '=HYPERLINK("https://m.imdb.com/title/tt1206885/?ref_=m_ttls_tt_119", "Rambo: Last Blood")',<br/>  6.2,<br/>  89,<br/>  1.0,<br/>  '😭😭😭😭',<br/>  'WHY AM I THE ONLY ONE HERE???']]</span></pre><h1 id="50c5" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="822a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">电子表格是一个强大的工具。有了像 EZSheets、gspread 和 gspread_dataframe 这样的令人惊叹的 Google Sheets API 包装器，用 Python 管理它们的大量工作已经完成了。</p><p id="3967" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用电子表格作为 Python 工具链的一部分，而不是妨碍业务自动化…这为我们节省了大量时间和工作。最重要的是，它停止了“传递电子表格”的仪式。这是一件美妙的事情！</p><p id="b1cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是本文中使用的<a class="ae kv" href="https://docs.google.com/spreadsheets/d/11zmk55OFpFL5HW_MhPfqfC-GjRQvHlI_M-jtHcBzyzA/edit?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Google 工作表</a>的链接。</p></div></div>    
</body>
</html>