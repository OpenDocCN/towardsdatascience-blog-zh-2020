# 利用卡尔曼滤波器预测冠状病毒传播

> 原文：<https://towardsdatascience.com/using-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8?source=collection_archive---------0----------------------->

## 本文介绍了在线实时卡尔曼滤波算法的实现，以预测每个给定区域的新冠肺炎传播。

冠状病毒(新冠肺炎)最近引起了世界范围的关注。
据报道，随着冠状病毒病例数量的增加，新冠肺炎的传播对全球健康构成了严重威胁。在这项工作中，我们将尝试预测冠状病毒在每个感染区域的传播。拟合时间序列分析和统计算法，以产生最佳的短期和长期预测。自适应在线卡尔曼滤波器为我们提供了每个地区非常好的一天预测。

首先，让我们简单地将新冠肺炎病毒与一种更古老的致命病毒——伊波拉病毒进行比较。埃博拉不是一种新疾病(第一例病例于 1976 年发现)，但在 2014 年和 2018 年，它再次爆发，直到这些天。
*与新冠肺炎约 3.9%的死亡率相比，埃博拉病毒的死亡率更高，可能达到 75%的死亡病例。必须注意的是，新冠肺炎是一种持续的疾病，因此死亡率不是最终的，很可能会增加。
*地点和国家明显不同，埃博拉病毒主要危害非洲和中国及亚洲的新冠肺炎。
*新冠肺炎似乎最有可能在寒冷的天气传播，而埃博拉在温暖的天气传播。
*两者之间的喷发趋势似乎非常相似，两种疾病都表现出迅速有力的喷发。

为了预测冠状病毒的传播，我使用了卡尔曼滤波算法和其他线性模型。优化问题是用 Python 解决的，而脚本可以在 Google Colab 笔记本中找到。这个项目的过程描述如下，完整的代码可以在 Github [这里](https://github.com/Rank23/COVID19)找到。

**预处理数据:** *从 Github 中读取数据-包含世界卫生组织数据下每个地点每日确诊、死亡和康复的总病例数。
*固定地区名称并将国家和省连接到一列“地区”。然后，清除数据集中的一些错误字符。

**获取人口:** 我使用了 python 的“qwikidata”包，它根据地区坐标(经度，纬度)从维基百科中提取人口数据。我们将使用这些数据来评估每个区域的感染率，并在模型中进行测试。

**创建时间序列和图表** 该脚本允许我们生成每个区域的可视化图表，以获得关于数据的初步见解。绝大多数病例发生在中国湖北(82%)，因此提取了不同的地块。
以下是每日总病例数排名靠前的区域。
*证实* **:**

![](img/914e04dac8c81d78117d492a7baca792.png)

*湖北等地区确诊病例总数*

我们可以看到一个明显的喷发趋势在湖北与异常日 13.02.20 的一个高跳。在那一天，计数方法发生了变化，这将在以后影响模型。我们无法验证数据的可信度，但假设数据是可靠的。在其他顶级领域，趋势似乎有所不同，也不那么明显。钻石公主号游轮似乎与众不同，自 2 月中旬以来出现了急剧的趋势。(粉色线)

*死亡:*
*死亡病例以湖北居多，超过 2000 例。之后，河南以 19。
*湖北死亡率为 2.1978%，河南为 1.5055%。在其他地区，人数太少。

![](img/974f2f4d6ffc0e27fa4833bc5088bab2.png)

*湖北等地区总死亡病例*

*痊愈:*
*所有地区的痊愈病例呈急剧趋势，主要在湖北，这可能暗示我们有一个积极的未来。

![](img/254619993cb98902eb147f6f71d133e2.png)

*湖北等地区痊愈病例总数*

**拟合预测模型阶段 1-一日预测卡尔曼滤波器**

我实现了一个卡尔曼滤波算法来解决这个问题，并为每个病例生成 1 天的预测——确诊、死亡、康复；对于每个地区。
卡尔曼滤波器是一种递归算法，它使用随时间推移的时间序列测量值，包含统计噪声并产生未知变量的估计值。我建立了一个在线实时算法。这种算法是自适应的，意味着它不需要大量的历史/训练数据。每天，该算法都会根据新的观察结果进行更新，在完成估计后，它可以生成第二天的预测。
**卡尔曼滤波器显示出预测第二天观测值的非常好的结果。它分别跟踪每个区域的趋势，快速调整序列并生成预测。由于我们不需要训练集和测试集，所以评估模型很容易。没有过度拟合或偏见——这是一个在线算法。**

**实现:** 我写了一个 R 脚本来实现一个在线卡尔曼算法，然后使用了 Python 的‘rpy 2’包，它允许我们在 Python 笔记本内部组合 R 脚本并传递结果变量。
短暂初始化后，算法开始跟踪序列，并为每个区域生成 1 天预测。它在每个可能的区域运行。

**结果和评估:** 为了评估结果，我为每个区域添加了一些基本的误差估计参数:MSE——均方误差，RMSE——均方根误差，MAE——平均绝对误差。我将它们与其他方法进行了比较，以优化模型并找到最佳方法。
该模型也可通过如下所示的图表进行评估。
该脚本允许选择区域并获得合适的绘图和预测。它对每个区域迭代运行。以下是几个例子:

A.**北京**:橙色线是卡尔曼预测，蓝色线是真实的**证实的**病例——如前所述，这不是偏差预测，它总结了以前的在线预测。
我们可以看到近乎完美的契合:

![](img/1aa0331abe155dcf8a68ffe411a75e11.png)

卡尔曼预测与实际值-北京

下表显示了预测值与实际值的接近程度。
例如，2010 年 2 月 19 日，卡尔曼预测 394 例，其中 7 例为新确诊病例，而实际为 6 例。明天(20.02.20)卡尔曼预测北京新增 5 例确诊病例。

![](img/5f4d6b53de3c8259fcc1c5ae4d30bc5d.png)

每日确认的预测与实际-北京

B.**湖北**但它适应得很快，几天后，将获得更好的预测。

![](img/c254f454c3854e249348757439950db2.png)

*卡尔曼预测 vs 湖北实际确诊病例*

下图显示了**湖北**死亡**病例的高预测率**

![](img/b6d6c6584fad74270c1b6ed6c8c2cc44.png)

*卡尔曼预测 vs 湖北实际死亡病例*

下表以数字显示了预测和实际**死亡**，在**湖北**。例如，在 18.02，卡尔曼预测有 140 人死亡，而实际死亡人数是 132 人。2002 年 19 月 19 日，卡尔曼预测有 129 人死亡，而实际死亡人数是 108 人。对于明天(20.02)，卡尔曼预测另外 132 个新的死亡病例。预测值非常接近真实值。

![](img/57de31207943c4c75e08b3d389d98981.png)

每日死亡预测与实际-湖北

**痊愈**每日预测:对于**湖北**痊愈病例的急剧趋势，我们可以得到一些积极的见解。
卡尔曼预测适应了这一趋势，并预测最近恢复的病例数量会增加。

![](img/119649d7b7132f78744e35baf57206a9.png)

*卡尔曼预测与湖北实际恢复案例*

C.**上海——证实了**的预测。这里也有非常接近真实值的每日预测

![](img/1b49f62c52c10849c14c3283b2bbaa39.png)

卡尔曼预测与实际值-上海

D.**河南**——有超过 1200 例**确诊**病例的地区——再次非常好的预测，采用了最近几天确诊病例较少的趋势。

![](img/24b13aed276c5f6e4c761da7cc0700f6.png)

卡尔曼预测与实际值-河南

**河南收复**预测:

![](img/d13541d0870e415df3780a53c7f01152.png)

卡尔曼预测与实际值-河南

20 年 2 月 19 日，卡尔曼预测有 56 个新的恢复案例，最终有 51 个。明天它预测又有 48 个新的康复病例。
与湖北类似，我们可以看到最近恢复案例的良好趋势和算法的良好适应性。

![](img/fb06b8765519a70bfcd5a48df19c47d2.png)

每日恢复预测与实际—河南

E.另一个有趣的地区是靠近日本的知名**钻石公主号游轮**。
**这个系列的行为与其他地区完全不同，尽管如此，卡尔曼的预测还是做得很好。**2 月初船上爆发过病例，随后急剧增加。卡尔曼预测明日(20.02.2020)又有 46 宗新个案。

![](img/0f965ada836e87f1f82ba939852e7ec5.png)

卡尔曼预测与实际值-钻石公主号游轮

**拟合预测模型第 2 阶段—随时间传播和新病例**

卡尔曼算法是非常强大的，并提供了一个很好的指示什么将是明天。
但要预测更长的时期，这是不够的。(提醒这是在线算法)。
我拟合了一个线性模型来预测新冠肺炎随时间的传播。
想法是使用时间序列算法，如 Kalman，并将它们作为另一个机器学习算法的特征发送，以及其他应该考虑的特征，如天气、人口、感染率等。
数据不稳定，因此随机森林回归等 ML 模型不太适用。最终，我使用了一个依赖于卡尔曼预测的线性模型。

**创建数据集** 线性模型的数据集包含不同的结构，其中:
*每行代表日期和地区。
*每列代表特征/变量，其中目标变量为确诊/死亡/恢复病例数。

**特征工程:**
**天气数据:** 我已经使用 python 'pyweatherbit '包提取每个区域坐标(经度，纬度)的历史和预报天气数据。这个包需要一个 API 密匙，每天限制为 500 个调用，所以我运行了几天，然后将数据存储在 CSV 文件(w.csv 和 w_forecast.csv)中，以将其与 Github 数据合并。我已经提取了每天和每个地点的最低和最高温度。(预测限于 14 天，对于更长的时间，我已经做了一个班轮温度预测)。

![](img/3acb978fa4fb66648de021fe9c812de7.png)

湖北每日最低和最高温度

下表显示了最高感染地区的平均温度(从 2010 年 1 月 22 日至 2010 年 2 月 17 日)。我们可以看到大部分地区(除了广东)天气相当寒冷，最高平均温度不超过 12-13 度，最低不超过 5 度。

![](img/4efb4116784f3a08c931181cc335b521.png)

大多数受感染地区的平均温度

**疫区数据:** 我用人口数据和每天的总确诊病例，计算出每个地区每天的感染率，用百分比表示。这个特性在最终的模型中很重要。

**特性列表:** 模型中被测试的特性:
1。最低-最高温度。
2。每个地区的感染率。
3。最后一天总计。
4。最近 X 天的变化(x=1，3，7)。
5。过去 X 天的变化率。
6。卡尔曼的预测。
7。地区。
8。人口。
9。确认/死亡/康复—目标变量。

**相关矩阵:**
在下图中我们可以看到变量之间的相关矩阵。
*不出所料，它们之间有 X 天的变化/速率相关。(所有时变特征)
*卡尔曼和时变变量与目标相关。
*感染率也与目标有较高的相关性。
*最低-最高温度与目标的相关性非常低。(但这并不意味着它们没有帮助)。

![](img/7171fa07b87b8dc112a800135587ecb4.png)

所有变量之间的相关矩阵

**功能重要性** 我已经使用了 python‘H20’包，并为湖北地区运行了一个单独的模型。
下面的结果显示了最重要的特征:
**卡尔曼的预测是显著的**，只要其他与时间有关的特征。
**感染率是**的一个重要特征，将在最终模型中使用。

![](img/6fd8dfdc6232bfd96cd998fd0b69c0e0.png)

随机森林特征重要性

**最终模型** 通常在训练 ML 模型时，我们需要将我们的数据分成训练/测试集(~75%到~25%)。
由于我们处理的是时变非平稳序列，这种方法并不适合。我通过模仿一个每天训练模型并预测第二天的迭代“在线”系统解决了这个问题。
然后，我没有得到真实值的反馈，而是用上一次预测加上一些计算出来的噪声更新了下一个时间戳值，并再次预测。
每天所有的功能都在更新(卡尔曼、感染率、天气预报和最近 X 天的计算)。
在评估了几个模型后，我选择了一个使用 python‘sk learn’包的简单线性回归模型。

**结果:** 脚本允许我们选择每个地区并得到总确诊、死亡和痊愈病例的预测。这里我展示了湖北和其他主要地区的地图。

**湖北** — **确诊** :
预测显示湖北未来确诊病例越来越少，但预计下个月会超过 10 万例确诊病例。

![](img/becaccabaf11db62c69c696a22144a6e.png)

一个月证实了湖北预测

根据预测，下个月湖北将有 3100 人死于新冠肺炎。到目前为止，湖北已有 2156 人死亡(19.02.20)。

![](img/86c3d3f57967a4d3242c515e3d52a6c5.png)

一个月死亡预测湖北

**康复-** 这种正向预测显示了湖北康复人的良好步伐。根据这一预测，下个月将有 8 万多人从冠状病毒中康复。

![](img/3b75b748b19aa27f36df2475a1a0ff04.png)

一个月恢复预测湖北

**主要地区:** *我们可以看到，在许多地区，下个月的预测显示几乎没有扩散。所有的底线和曲线的斜率不变。

*基于这一预测，大规模爆发已经过去，趋势显示确诊病例越来越少，甚至在顶部地区，如**浙江**、**河南**、**安徽**、**广东**(图表中的前 4 行)。

* **钻石船**预计会得到越来越多的确认发布——直到船上的人全部撤离。这应该很快就会发生，然后就不会有更多的预测了。(第 5 行浅蓝色)

![](img/e24ee61769638ebf626bf585a4d4bf0c.png)

一个月证实了主要地区预测

**死亡**:根据大部分地区的预测，我们不会看到死亡病例的增加。主要关注的地区是河南，预计下个月将有近 40 人死亡(今天有 19 人)

![](img/d165241d7643e794e90a1da6dba69f4d.png)

主要地区一个月死亡预测

**恢复** —预测显示下个月恢复率将增加。越来越多的人将从新冠肺炎被解救出来。

![](img/6ce14708ea19c5a15a2e7fa68635aba8.png)

一个月恢复了主要地区预测

**热图:** 为了呈现预测的另一种可视化，我使用 python 包“gmplot”来显示谷歌地图上的预测。
该地图根据该区域的坐标显示了具有高感染位置的热点。
观测是对每个地区下个月的预测。谷歌的 API 不再是免费的，所以这个版本是有限的，但它确实显示了受感染的位置。

![](img/a8413b7c0623f42e000bbe7c0377d65b.png)

基于下个月预测的受感染位置热图

![](img/228d0ac5419131fec25b5b54d1ae901b.png)

基于下个月预测的受感染位置热图。不包括湖北

**结论**

*   最终模型预测未来 30 天或更长时间内新冠肺炎病毒的趋势。**一天的卡尔曼预测非常准确和强大**，而更长时间的预测更具挑战性，但提供了未来趋势。
*   看起来感染的高峰已经过去了，这一趋势的预测显示，确诊人数减少，痊愈人数增加。
*   在分析结果时，有必要将湖北与其他地区分开。
*   天气特征不可能是一个重要特征，因为模型从未看到新冠肺炎传播在炎热天气中的表现，但温度确实稍微改善了结果。根据感染最严重地区的平均天气，我们可以假设，一旦这些地区天气变暖(~20 度或更高)，确诊病例将会减少。在湖北，这样的天气预计从 4 月中旬开始。
*   **感染率是影响传播的主要特征之一**——该模型发现它尤其与**湖北**和**钻石公主船**相关。该模型无法预测影响感染率的地区之间的人员流动。因此，根据这一数据，预测哪些新的国家将受到影响是不相关的，但一旦它们受到影响，该模型将预测这些新地区的传播。
*   根据积极的复苏趋势预测、中国政府对湖北的隔离以及中国即将出现的温暖天气****我认为新冠肺炎疫情在三月底会大幅减少**。但在此之前，感染者向其他地区的转移可能会改变现状…**

**就这样，感谢您的阅读。请随时联系我，分享您的想法、问题或反馈。**

## **更新的预测可以在[这里](https://medium.com/analytics-vidhya/coronavirus-updated-prediction-using-kalman-filter-3ef8b7a72409)找到**