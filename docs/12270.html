<html>
<head>
<title>Python done the R (Markdown) way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 采用了 R (Markdown)方式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-done-the-r-markdown-way-d03bec4b96b?source=collection_archive---------25-----------------------#2020-08-24">https://towardsdatascience.com/python-done-the-r-markdown-way-d03bec4b96b?source=collection_archive---------25-----------------------#2020-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/73d0cacbabd320f1198120daab3cd850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xIvHbmO_rjdGgpHIWw5LaA.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://www.data-must-flow.com/projects/photos/photos.html" rel="noopener ugc nofollow" target="_blank">维特·加布雷</a>拍摄</p></figure><h1 id="e613" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">介绍</h1><p id="c903" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">开始使用一种新工具可能并不容易，尤其是当那个<em class="mc">“工具”</em>意味着一种新的编程语言的时候。与此同时，可能会有机会在已知的基础上再接再厉，让过渡更平稳，痛苦更少。</p><p id="b34d" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">对我来说，是从<strong class="lg iu"> R </strong>到<strong class="lg iu"> Python </strong>的过渡。不幸的是，我以前的同事 pythonians 没有分享我对 R 的真正喜爱。此外，不管 R 爱好者喜欢与否，<strong class="lg iu"> Python </strong>是数据分析/工程/科学等领域广泛使用的工具。因此，我得出结论，至少学习一些 Python 是一件合理的事情。</p><p id="f3f2" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">对我来说，最初的步骤可能是最困难的。在舒适的 RStudio 中，像 Pycharm 或 Atom 这样的 ide 并不熟悉。这一经历促使我们决定从众所周知的环境开始，并在使用 Python 时测试它的极限。</p><p id="9b20" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">说实话，我最终并没有将 RStudio 作为在一般环境下使用 Python 的首选武器。希望下面的文字能传达为什么的信息。然而，我确信对于一些用例，比如以特别分析 R Markdown 的方式集成 R 和 Python，<em class="mc"> RStudio </em>仍然是一条可行的道路。</p><p id="34e4" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">更重要的是，对于在 R 有<strong class="lg iu">初级背景的人来说，这可能是一个方便的<strong class="lg iu">起跑线</strong>。</strong></p><p id="5c31" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">那么，我发现了什么？</p><h1 id="de34" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">分析</h1><h1 id="3c4d" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">包装和环境</h1><p id="7028" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">首先，让我们设置环境并加载所需的包。</p><ul class=""><li id="1a38" class="mi mj it lg b lh md ll me lp mk lt ml lx mm mb mn mo mp mq bi translated"><strong class="lg iu">全球环境:</strong></li></ul><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="01a7" class="na kh it mw b gy nb nc l nd ne"><em class="mc"># Globally round numbers at decimals</em><br/><strong class="mw iu">options</strong>(digits=2)</span><span id="0cff" class="na kh it mw b gy nf nc l nd ne"><em class="mc"># Force R to use regular numbers instead of using the e+10-like notation</em><br/><strong class="mw iu">options</strong>(scipen = 999)</span></pre><ul class=""><li id="b0f1" class="mi mj it lg b lh md ll me lp mk lt ml lx mm mb mn mo mp mq bi translated"><strong class="lg iu"> R 库:</strong></li></ul><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="260e" class="na kh it mw b gy nb nc l nd ne"><em class="mc"># Load the required packages. </em><br/><em class="mc"># If these are not available, install them first.</em><br/>ipak &lt;- <strong class="mw iu">function</strong>(pkg){<br/>  new.pkg &lt;- pkg[!(pkg %in% <strong class="mw iu">installed.packages</strong>()[, "Package"])]<br/>  <strong class="mw iu">if</strong> (<strong class="mw iu">length</strong>(new.pkg)) <br/>    <strong class="mw iu">install.packages</strong>(new.pkg, <br/>                     dependencies = TRUE)<br/>  <strong class="mw iu">sapply</strong>(pkg, <br/>         require, <br/>         character.only = TRUE)<br/>}</span><span id="2f1a" class="na kh it mw b gy nf nc l nd ne">packages &lt;- <strong class="mw iu">c</strong>("tidyverse", <em class="mc"># Data wrangling</em><br/>              "gapminder", <em class="mc"># Data source</em><br/>              "knitr", <em class="mc"># R Markdown styling</em><br/>              "htmltools") <em class="mc"># .html files manipulation</em></span><span id="531a" class="na kh it mw b gy nf nc l nd ne"><strong class="mw iu">ipak</strong>(packages)</span><span id="a1a7" class="na kh it mw b gy nf nc l nd ne">tidyverse gapminder     knitr htmltools <br/>     TRUE      TRUE      TRUE      TRUE</span></pre><p id="76a6" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">在这个分析中，我将使用 RStudio 开发的包<code class="fe ng nh ni mw b">reticulate</code> <a class="ae kf" href="https://rstudio.github.io/reticulate/" rel="noopener ugc nofollow" target="_blank">库</a>。但是，可以随意寻找<a class="ae kf" href="https://www.datacamp.com/community/tutorials/using-both-python-r" rel="noopener ugc nofollow" target="_blank">的替代品</a>。</p><p id="4d08" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">此外，为了更清晰的流程，我将单独导入<code class="fe ng nh ni mw b">reticulate</code>包。</p><ul class=""><li id="f427" class="mi mj it lg b lh md ll me lp mk lt ml lx mm mb mn mo mp mq bi translated"><strong class="lg iu"> Python 激活:</strong></li></ul><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="d013" class="na kh it mw b gy nb nc l nd ne"><em class="mc"># The "weapon of choice"</em><br/><strong class="mw iu">library</strong>(reticulate)</span><span id="b814" class="na kh it mw b gy nf nc l nd ne"><em class="mc"># Specifying which version of python to use.</em><br/><strong class="mw iu">use_python</strong>("/home/vg/anaconda3/bin/python3.7", <br/>           required = T) <em class="mc"># Locate and run Python</em></span></pre><ul class=""><li id="90a5" class="mi mj it lg b lh md ll me lp mk lt ml lx mm mb mn mo mp mq bi translated"><strong class="lg iu"> Python 库:</strong></li></ul><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="6d0d" class="na kh it mw b gy nb nc l nd ne">import pandas as pd <em class="mc"># data wrangling</em><br/>import numpy as np <em class="mc"># arrays, matrices, math</em><br/>import statistics as st <em class="mc"># functions for calculating statistics</em><br/>import plotly.express as px <em class="mc"># plotting package</em></span></pre><p id="204f" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">在<strong class="lg iu"> R </strong> <em class="mc"> (Studio) </em>中使用<strong class="lg iu"> Python </strong>的一个限制是，在某些情况下，默认情况下你不会收到 Python 回溯。这是一个问题，因为，如果我把事情过于简化，追溯可以帮助你确定问题出在哪里。意思是它能帮你解决问题。所以，把它当作一个<strong class="lg iu">错误信息</strong>(或者没有它)。</p><ul class=""><li id="702d" class="mi mj it lg b lh md ll me lp mk lt ml lx mm mb mn mo mp mq bi translated">例如，当调用一个您没有安装的库时，R Markdown 中的 Python 块给了您绿灯(所以一切看起来都在运行)，但这并不意味着代码以您期望的方式运行(例如，它导入了一个库)。</li></ul><p id="18c0" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">为了解决这个问题，我建议确保你已经在<code class="fe ng nh ni mw b">Terminal</code>中安装了你的库。如果没有，您可以安装它们，然后再导入。</p><p id="384d" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">例如，我将首先导入已经安装在我的机器上的<code class="fe ng nh ni mw b">json</code>包。我将在<em class="mc"> RStudio </em>中使用<strong class="lg iu">端子</strong>来完成此操作。另外，让我试着导入<code class="fe ng nh ni mw b">TensorFlow</code> <a class="ae kf" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank">包</a>。</p><p id="add3" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">从下图可以看出没有包<code class="fe ng nh ni mw b">TensorFlow</code>。所以，让我切换回<strong class="lg iu"> bash </strong>并安装这个包:</p><p id="b24e" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">然后转到新安装的包<code class="fe ng nh ni mw b">TensorFlow</code>所在的目录，切换到<strong class="lg iu"> Python </strong>，再次导入包:</p><p id="5efb" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">好吧。有关更多信息，请查看<a class="ae kf" href="https://docs.python.org/3.4/installing/index.html" rel="noopener ugc nofollow" target="_blank">安装 Python 模块</a>页面。</p><h1 id="014c" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">数据</h1><p id="e5cf" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在我们已经有了<strong class="lg iu"> R </strong>和<strong class="lg iu"> Python </strong>集合，让我们导入一些数据来玩玩。我将使用来自 Gapminder 的样本，这是一个关于世界人口社会人口学的有趣项目。更具体地说，我将使用<a class="ae kf" href="https://cran.r-project.org/web/packages/gapminder/README.html" rel="noopener ugc nofollow" target="_blank"> GapMinder </a>库中最新的可用数据。</p><ul class=""><li id="f070" class="mi mj it lg b lh md ll me lp mk lt ml lx mm mb mn mo mp mq bi translated"><strong class="lg iu">R 中的数据导入:</strong></li></ul><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="7ebd" class="na kh it mw b gy nb nc l nd ne"><em class="mc"># Let us begin with the most recent set of data</em><br/>gapminder_latest &lt;- gapminder %&gt;%<br/>          <strong class="mw iu">filter</strong>(year == <strong class="mw iu">max</strong>(year))</span></pre><p id="1d67" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">所以，现在我们在<strong class="lg iu"> R </strong>中加载了一个数据。不幸的是，无法通过<strong class="lg iu"> Python </strong>直接访问<strong class="lg iu"> R 对象</strong>(例如<em class="mc">向量</em>od<em class="mc">tibles</em>)。所以，我们需要先转换 R 对象。</p><ul class=""><li id="efd8" class="mi mj it lg b lh md ll me lp mk lt ml lx mm mb mn mo mp mq bi translated"><strong class="lg iu">Python 中的数据导入:</strong></li></ul><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="b24b" class="na kh it mw b gy nb nc l nd ne"><em class="mc"># Convert R Data Frame (tibble) into the pandas Data Frame</em><br/>gapminder_latest_py = r['gapminder_latest']</span></pre><p id="cc6a" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">当使用<em class="mc"> Python 对象</em>(例如<em class="mc">数组</em>或<code class="fe ng nh ni mw b">pandas</code> <em class="mc">数据帧</em>)时，要意识到的一件重要事情是，它们是<strong class="lg iu">而不是</strong> <a class="ae kf" href="https://community.rstudio.com/t/rstudio-ide-global-environment-variable-when-running-python/17999" rel="noopener ugc nofollow" target="_blank">显式地<strong class="lg iu">存储在环境</strong></a>中的，就像<em class="mc"> R 对象</em>一样。</p><ul class=""><li id="9ce2" class="mi mj it lg b lh md ll me lp mk lt ml lx mm mb mn mo mp mq bi translated">换句话说，如果我们想知道工作区中存储了什么，我们必须调用像<code class="fe ng nh ni mw b">dir()</code>、<code class="fe ng nh ni mw b">globals()</code>或<code class="fe ng nh ni mw b">locals()</code>这样的函数:</li></ul><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="03b9" class="na kh it mw b gy nb nc l nd ne">['R', '__annotations__', '__builtins__', '__doc__', '__loader__', '__name__', '__package__', '__spec__', 'contact_window_days', 'contact_window_days_style', 'fig', 'gapminder_latest_count_py', 'gapminder_latest_max_lifeExp_py', 'gapminder_latest_mean_lifeExp_py', 'gapminder_latest_median_lifeExp_py', 'gapminder_latest_min_lifeExp_py', 'gapminder_latest_py', 'gapminder_latest_shape', 'gapminder_latest_stdev_lifeExp_py', 'lifeExpHist', 'np', 'pd', 'px', 'r', 'st', 'sys', 'variable', 'variable_grouping', 'variable_name']</span></pre><p id="e07b" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">太好了，在现在的对象中，我们可以清楚地看到数据(<code class="fe ng nh ni mw b">gapminder_latest_py</code>)或库(如<code class="fe ng nh ni mw b">px</code>)。</p><p id="6527" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">那么，让我们来探究一下这些数据吧！</p><h1 id="fb89" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">预期寿命</h1><p id="20fa" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">出于演示的目的，我将把重点放在预期寿命(T21)或一个人预期的平均寿命上。</p><h1 id="a283" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">描述统计学</h1><p id="7c49" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">让我们从使用<strong class="lg iu"> Python </strong>计算一些<strong class="lg iu">描述性统计数据</strong>开始，如<em class="mc">表示</em>、<em class="mc">中位数</em>或<em class="mc">数据中的行数</em>:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="ec45" class="na kh it mw b gy nb nc l nd ne"><em class="mc"># Descriptive statistics for the inline code in Python</em></span><span id="35c5" class="na kh it mw b gy nf nc l nd ne"><em class="mc">## Data Frame Overview</em></span><span id="5cd9" class="na kh it mw b gy nf nc l nd ne"><em class="mc">### Number of rows</em><br/>gapminder_latest_shape = gapminder_latest_py.shape[0] <br/><em class="mc">### Number of distinct values within the life expectancy variable</em><br/>gapminder_latest_count_py = gapminder_latest_py['lifeExp'].nunique()</span><span id="0532" class="na kh it mw b gy nf nc l nd ne"><em class="mc">## Life Expectancy</em></span><span id="174b" class="na kh it mw b gy nf nc l nd ne"><em class="mc">### Median (Life Expectancy)</em><br/>gapminder_latest_median_lifeExp_py = st.median(gapminder_latest_py['lifeExp']) <br/><em class="mc">### Mean</em><br/>gapminder_latest_mean_lifeExp_py = st.mean(gapminder_latest_py['lifeExp'])<br/><em class="mc">### Minimum</em><br/>gapminder_latest_min_lifeExp_py = min(gapminder_latest_py['lifeExp']) <br/><em class="mc">### Maximum</em><br/>gapminder_latest_max_lifeExp_py = max(gapminder_latest_py['lifeExp'])<br/><em class="mc">### Standard deviation</em><br/>gapminder_latest_stdev_lifeExp_py = st.stdev(gapminder_latest_py['lifeExp'])</span></pre><p id="ab52" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">很好。不幸的是，我们无法使用<strong class="lg iu"> Python 对象</strong>进行<strong class="lg iu">内联编码</strong>，这是<a class="ae kf" href="https://en.wikipedia.org/wiki/Literate_programming#:~:text=Literate%20programming%20is%20a%20programming,source%20code%20can%20be%20generated." rel="noopener ugc nofollow" target="_blank"><strong class="lg iu"/></a>中<a class="ae kf" href="https://rmarkdown.rstudio.com/lesson-4.html" rel="noopener ugc nofollow" target="_blank"> <em class="mc"> R Markdown </em> </a>的关键特性之一。因此，如果我们想要将结果用于内联代码，我们需要将<strong class="lg iu"> Python 对象</strong>转换回<strong class="lg iu"> R </strong>:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="6e5a" class="na kh it mw b gy nb nc l nd ne"><em class="mc"># Descriptive statistics for the inline code in Python - transformed to R</em></span><span id="f421" class="na kh it mw b gy nf nc l nd ne"><em class="mc">## Data Frame Overview</em></span><span id="9ee4" class="na kh it mw b gy nf nc l nd ne"><em class="mc">## Number of rows</em><br/>gapminder_latest_nrow_r = py$gapminder_latest_shape<br/><em class="mc">### Number of distinct values within the life expectancy variable</em><br/>gapminder_latest_count_r = py$gapminder_latest_count_py</span><span id="201d" class="na kh it mw b gy nf nc l nd ne"><em class="mc">## Life Expectancy</em></span><span id="7d5c" class="na kh it mw b gy nf nc l nd ne"><em class="mc">### Median (Life Expectancy)</em><br/>gapminder_latest_median_lifeExp_r = py$gapminder_latest_median_lifeExp_py<br/><em class="mc">### Mean</em><br/>gapminder_latest_mean_lifeExp_r = py$gapminder_latest_mean_lifeExp_py<br/><em class="mc">### Minimum</em><br/>gapminder_latest_min_lifeExp_r = py$gapminder_latest_min_lifeExp_py<br/><em class="mc">### Maximum</em><br/>gapminder_latest_max_lifeExp_r = py$gapminder_latest_max_lifeExp_py<br/><em class="mc">### Standard deviation</em><br/>gapminder_latest_stdev_lifeExp_r = py$gapminder_latest_stdev_lifeExp_py</span></pre><p id="796e" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">那么，关于<strong class="lg iu"> 2007 </strong>中的<strong class="lg iu">寿命</strong>，我们能说些什么呢？</p><p id="5613" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">首先，有<strong class="lg iu"> 142 个国家</strong>上榜。预期寿命的<strong class="lg iu">最小值</strong>为<strong class="lg iu"> 39.61 </strong>岁，最大值<strong class="lg iu"> 82.6 </strong>岁。</p><p id="fc3a" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">平均预期寿命值为 67.01 岁，平均预期寿命中位数为 71.94 岁或更长。最后，标准差是<strong class="lg iu"> 12.07 </strong>年。</p><h1 id="7594" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">图表(使用 Plotly)</h1><p id="26e4" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">好吧，我们换个话题，比如图表。</p><p id="d69a" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">例如，我们可以使用<code class="fe ng nh ni mw b">Plotly</code>来看看<em class="mc">全球的预期寿命是如何分布的</em>:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="7eb5" class="na kh it mw b gy nb nc l nd ne">fig = px.histogram(gapminder_latest_py, <em class="mc"># package.function; Data Frame</em><br/>                   x="lifeExp", <em class="mc"># Variable on the X axis</em><br/>                   range_x=(gapminder_latest_min_lifeExp_py, <br/>                            gapminder_latest_max_lifeExp_py), <em class="mc"># Minimum and maximum values for the X axis</em><br/>                   labels={'lifeExp':'Life expectancy - in years'}, <em class="mc"># Naming of the interactive part</em><br/>                   color_discrete_sequence=['#005C4E']) <em class="mc"># Colour of fill </em></span><span id="56e8" class="na kh it mw b gy nf nc l nd ne">lifeExpHist = fig.update_layout(<br/>  title="Figure 1. Life Expectancy in 2007 Across the Globe - in Years", <em class="mc"># The name of the graph</em><br/>  xaxis_title="Years", <em class="mc"># X-axis title</em><br/>  yaxis_title="Count", <em class="mc"># Y-axis title</em><br/>  font=dict( <em class="mc"># "css"</em><br/>    family="Roboto",<br/>    size=12,<br/>    color="#252A31"<br/>  ))</span><span id="afa6" class="na kh it mw b gy nf nc l nd ne">lifeExpHist.write_html("lifeExpHist.html") <em class="mc"># Save the graph as a .html object</em></span></pre><p id="2736" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">遗憾的是，无法通过<strong class="lg iu"> Python </strong>在<strong class="lg iu"> R Markdown </strong>中打印交互式<code class="fe ng nh ni mw b">Plotly</code>图形。或者，更准确地说，你将通过打印(如<code class="fe ng nh ni mw b">print(lifeExpHist)</code>)得到一个<code class="fe ng nh ni mw b">Figure object</code>:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="9d35" class="na kh it mw b gy nb nc l nd ne">Figure({<br/>    'data': [{'alignmentgroup': 'True',<br/>              'bingroup': 'x',<br/>              'hovertemplate': 'Life expectancy - in years=%{x}&lt;br&gt;count=%{y}&lt;extra&gt;&lt;/extra&gt;',<br/>              'legendgroup': '',<br/>              'marker': {'color': '#005C4E'},<br/>              'name': '',<br/>              'offsetgroup': '',<br/>              'orientation': 'v',<br/>              'showlegend': False,<br/>              'type': 'histogram',<br/>              'x': array([43, 76, 72, 42, 75, 81, 79, 75, 64, 79, 56, 65, 74, 50, 72, 73, 52, 49,<br/>                          59, 50, 80, 44, 50, 78, 72, 72, 65, 46, 55, 78, 48, 75, 78, 76, 78, 54,<br/>                          72, 74, 71, 71, 51, 58, 52, 79, 80, 56, 59, 79, 60, 79, 70, 56, 46, 60,<br/>                          70, 82, 73, 81, 64, 70, 70, 59, 78, 80, 80, 72, 82, 72, 54, 67, 78, 77,<br/>                          71, 42, 45, 73, 59, 48, 74, 54, 64, 72, 76, 66, 74, 71, 42, 62, 52, 63,<br/>                          79, 80, 72, 56, 46, 80, 75, 65, 75, 71, 71, 71, 75, 78, 78, 76, 72, 46,<br/>                          65, 72, 63, 74, 42, 79, 74, 77, 48, 49, 80, 72, 58, 39, 80, 81, 74, 78,<br/>                          52, 70, 58, 69, 73, 71, 51, 79, 78, 76, 73, 74, 73, 62, 42, 43]),<br/>              'xaxis': 'x',<br/>              'yaxis': 'y'}],<br/>    'layout': {'barmode': 'relative',<br/>               'font': {'color': '#252A31', 'family': 'Roboto', 'size': 12},<br/>               'legend': {'tracegroupgap': 0},<br/>               'margin': {'t': 60},<br/>               'template': '...',<br/>               'title': {'text': 'Figure 1. Life Expectancy in 2007 Across the Globe - in Years'},<br/>               'xaxis': {'anchor': 'y', 'domain': [0.0, 1.0], 'range': [39.613, 82.603], 'title': {'text': 'Years'}},<br/>               'yaxis': {'anchor': 'x', 'domain': [0.0, 1.0], 'title': {'text': 'Count'}}}<br/>})</span></pre><p id="66d5" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">所以，我们<strong class="lg iu">导入</strong>先前创建的<em class="mc">。html </em>文件(例如使用<code class="fe ng nh ni mw b">htmltools</code>包中的<code class="fe ng nh ni mw b">includeHTML</code>功能):</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="dfa4" class="na kh it mw b gy nb nc l nd ne">htmltools::<strong class="mw iu">includeHTML</strong>("lifeExpHist.html") <em class="mc"># Render the graph</em></span></pre><p id="5d36" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">所以，这里有一个基本的，然而是用 Python 版本的<code class="fe ng nh ni mw b">Plotly</code>制作的<a class="ae kf" href="https://www.data-must-flow.com/posts/python-in-r/lifeexphist" rel="noopener ugc nofollow" target="_blank">交互式直方图</a>。</p><p id="95dc" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">然而，在<strong class="lg iu"> RStudio </strong>中生成这个图表需要一种变通方法。同时，以这种方式产生的图形的大小可以很容易地达到几十兆字节。</p><ul class=""><li id="6fb8" class="mi mj it lg b lh md ll me lp mk lt ml lx mm mb mn mo mp mq bi translated">因此，包含这些图表的. html 报告需要<strong class="lg iu">大量数据来下载</strong>给读者，并且需要<strong class="lg iu">更多时间来呈现页面</strong>。</li></ul><h1 id="453f" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">汇总表(使用熊猫)</h1><p id="b60e" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe ng nh ni mw b">pandas</code>的一个常见用例是提供数据描述。各自的代码运行良好。但是，由于您在<code class="fe ng nh ni mw b">pandas</code>中使用了样式，因此无法对输出进行样式化。</p><ul class=""><li id="2049" class="mi mj it lg b lh md ll me lp mk lt ml lx mm mb mn mo mp mq bi translated">说到<code class="fe ng nh ni mw b">pandas</code>，我们可以很容易地为常用的统计数据创建一个汇总表，如<strong class="lg iu">个大洲</strong>的<strong class="lg iu">预期寿命</strong>的平均值或标准差:</li></ul><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="8b31" class="na kh it mw b gy nb nc l nd ne"><em class="mc"># Create a pandas Data Frame object containing the relevant variable,</em><br/><em class="mc"># conduct formatting.</em><br/>  <br/>  gapminder_latest_py['continent'] = gapminder_latest_py['continent'].astype(str)<br/>  variable = 'continent'<br/>  variable_name = 'Continents'<br/>  <br/>  gapminder_latest_py['lifeExp'] = gapminder_latest_py['lifeExp'].astype(int)<br/>  variable_grouping = 'lifeExp'<br/>  <br/>  contact_window_days = gapminder_latest_py.groupby([<br/>                          pd.Grouper(key=variable)])\<br/>                          [variable_grouping]\<br/>                          .agg(['count',<br/>                                'min',<br/>                                'mean',<br/>                                'median',<br/>                                'std',<br/>                                'max'])\<br/>                          .reset_index()<br/>  <br/>  contact_window_days_style = contact_window_days\<br/>                          .rename({'count': 'Count',<br/>                                   'median': 'Median',<br/>                                   'std': 'Standard Deviation',<br/>                                   'min': 'Minimum', <br/>                                   'max': 'Maximum',<br/>                                   'mean': 'Mean',}, axis='columns')</span></pre><p id="d13a" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">输出:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="05b4" class="na kh it mw b gy nb nc l nd ne">continent  Count  Minimum       Mean  Median  Standard Deviation  Maximum<br/>  0    Africa     52       39  54.326923    52.0            9.644100       76<br/>  1  Americas     25       60  73.040000    72.0            4.495183       80<br/>  2      Asia     33       43  70.151515    72.0            7.984834       82<br/>  3    Europe     30       71  77.100000    78.0            2.916658       81<br/>  4   Oceania      2       80  80.500000    80.5            0.707107       81</span></pre><p id="3868" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">另外，请注意<strong class="lg iu"> Python 环境设置覆盖了 R </strong>中的设置。例如，看看均值或标准差的位数。有六个数字，而不是开头的两个数字。</p><h1 id="1152" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结束语</h1><p id="11b8" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">好了，现在够了。如果你渴望更高级的东西，比如使用<strong class="lg iu"> R </strong>中的<code class="fe ng nh ni mw b">scikit-learn</code> <a class="ae kf" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank">包</a>进行无监督学习，看看<a class="ae kf" href="https://www.r-bloggers.com/r-and-python-using-reticulate-to-get-the-best-of-both-worlds/" rel="noopener ugc nofollow" target="_blank">的</a>。</p><p id="eeb2" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">然而，在结束这篇文章之前，让我说一下，如果你考虑切换到<strong class="lg iu"> Python </strong>并经常使用它，考虑一下 IDE 替代<em class="mc"> RStudio </em>。</p><p id="1d3c" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">许多分析师相信<a class="ae kf" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> Jupyter 笔记本</strong> </a>的交互性，集成<code class="fe ng nh ni mw b">markdown</code>或选择运行各种语言的代码，如<code class="fe ng nh ni mw b">R</code>、<code class="fe ng nh ni mw b">Julia</code>或<code class="fe ng nh ni mw b">JavaScript</code>。<a class="ae kf" href="https://jupyter.org/hub" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> JupyterHub </strong> </a>是基于 Jupyter 笔记本的平台，增加了版本控制。通常，用户在集装箱环境中运行分析)。另一个关于交互性和协作的例子可能是<a class="ae kf" href="https://colab.research.google.com/notebooks/intro.ipynb#recent=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> Colab </strong> </a>，基本上就是运行在谷歌云上的 Jupyter 笔记本。</p><p id="4471" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">最后，有一个伟大的软件叫做<a class="ae kf" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> Visual Studio 代码</strong> </a>。它不仅允许你用多种语言创建和运行代码，或者在纯 Python 代码和交互式 Jupyter 笔记本之间无缝流动。也许更重要的是，它为您提供了非常有效的版本控制管理(比如 Git 集成和扩展)。如果选择这个 IDE，可以像 RStudio 一样设置<a class="ae kf" href="https://stevenmortimer.com/setting-up-vs-code-for-python-development-like-rstudio/#settings-json-file" rel="noopener ugc nofollow" target="_blank"> VS 代码进行 Python 开发。</a></p><p id="23b1" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">但是不管你选择什么样的 Python 之路，不要忘记它是一个适合某些情况的工具，而对其他人可能就不那么适合了。就像 r 一样，在了解不同工具的优点的同时，尽量利用它的优点。</p></div></div>    
</body>
</html>