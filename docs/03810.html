<html>
<head>
<title>A Simple Song Recommender System in Python (Tutorial)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个简单的 Python 歌曲推荐系统(教程)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-simple-song-recommender-system-in-python-tutorial-3e4c111198d6?source=collection_archive---------31-----------------------#2020-04-09">https://towardsdatascience.com/a-simple-song-recommender-system-in-python-tutorial-3e4c111198d6?source=collection_archive---------31-----------------------#2020-04-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c947" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">协同过滤和推荐系统的基础，以及为什么脸书和谷歌似乎知道你在说什么，即使他们不记录你的谈话。</h2></div><p id="ded0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本材料基于我在 2020 年 4 月教授的一个研讨会的内容。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/1b1c6cb4d1d8ab782c0198d9170a57c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6rsoJvIcvGTWiUpYc81Q1w.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">DJ R3X 在 Oga 的酒吧策划歌曲。<a class="ae lv" href="https://www.billboard.com/articles/news/8528161/disneys-star-wars-galaxys-edge-cantina-music-album-playlist-one" rel="noopener ugc nofollow" target="_blank">图片来源</a> : <a class="ae lv" href="https://disneyparks.disney.go.com/blog/author/joshua-sudock/" rel="noopener ugc nofollow" target="_blank">约书亚·苏多克</a>(迪斯尼公园)</p></figure><p id="82d0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们大多数人现在每天都在使用基于人工智能的推荐系统:在网飞上寻找一个节目，在社交媒体上滚动，在 YouTube 上观看“up next”视频，在 Spotify 上收听“Discover Weekly”播放列表。</p><p id="39a2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么这些推荐器是如何工作的呢？</p><p id="94e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">他们变得非常好，在某些情况下，好得令人毛骨悚然。我们中的许多人都收到了一些推荐和广告，这让我们不禁要问:“<em class="le">他们在给我录音吗？</em>“一般来说，公司不会通过窃听你的麦克风，录下你的对话来做推荐。相反，他们会给你做一个模型，或者像特里斯坦·哈里斯所说的那样，“一个小小的巫毒娃娃，你的化身版本”，然后对那个娃娃做出预测。我会把这个娃娃称为你品味的数学模型。</p><p id="68bf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本教程中的方法远没有谷歌、脸书和 Spotify 使用的方法复杂，它们不会产生任何令人毛骨悚然的好推荐。尽管如此，大多数建议的工作原理都是一样的，分为三个步骤:</p><ol class=""><li id="b6e1" class="lw lx it kk b kl km ko kp kr ly kv lz kz ma ld mb mc md me bi translated">公司为你和其他人建立了一个数学模型</li><li id="ff99" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mb mc md me bi translated">他们利用这些模型来寻找和你相似的人</li><li id="4cd0" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mb mc md me bi translated">他们发现那些相似的人喜欢什么，并推荐给你</li></ol><p id="08c2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将重复这三个步骤两次，首先是一个简单的可视化示例，然后是一个更大的基于代码的示例。</p><h1 id="6423" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">第 1 部分:视觉介绍</h1><h2 id="b590" class="nc ml it bd mm nd ne dn mq nf ng dp mu kr nh ni mw kv nj nk my kz nl nm na nn bi translated">为你的品味建立一个数学模型</h2><p id="b8e6" class="pw-post-body-paragraph ki kj it kk b kl no ju kn ko np jx kq kr nq kt ku kv nr kx ky kz ns lb lc ld im bi translated">让我们首先考虑三个人(杰克、尼克和特雷弗)以及他们如何在 1 到 5 的范围内给三首歌曲(一支舞、向前一步和向日葵)评分。这是一个简单的表格:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="b1ab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在有了一个简单的音乐品味的数学模型。在现实世界中，Spotify 使用其他信号来确定这个评级，比如你听了一首歌多少次。不管怎样，原则是<em class="le">把你的喜好转化成一串数字，</em>其中<em class="le"> </em>也被称为向量、矩阵或数组。不管你怎么称呼它们，把这些数字形象化在图表上是很有帮助的。下面，我们将“一支舞”的评分放在 x 轴上，将“倚在”的评分放在 y 轴上:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nv"><img src="../Images/97ee941ca0371b8505dd63c0cb362596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SzCLj1hkwcbaUoURqOLvCw.png"/></div></div></figure><h2 id="f1c7" class="nc ml it bd mm nd ne dn mq nf ng dp mu kr nh ni mw kv nj nk my kz nl nm na nn bi translated">使用该模型寻找相似的人</h2><p id="2822" class="pw-post-body-paragraph ki kj it kk b kl no ju kn ko np jx kq kr nq kt ku kv nr kx ky kz ns lb lc ld im bi translated">我们现在有了一个记录你音乐品味的数字列表，所以我们可以进入下一步:找到有相似品味的人。让我们回到图表:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nw"><img src="../Images/5e88fd4af343245aa49bc0e9dfa15b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S5YYwC9Pbjs_G4k3Z-Q6sg.png"/></div></div></figure><p id="db18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在视觉表征中，相似的人只是附近的人。因此，找出谁与杰克“最相似”只是找出谁与杰克最接近的问题。我们可以用中学几何中古老的毕达哥拉斯定理来测量这个距离:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nx"><img src="../Images/083a8077f90770e49071f73c798e7a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U0RJZv2fVk-TCQ2ExrWnOQ.png"/></div></div></figure><p id="9a7f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">酷！我们快到了。我们已经可以看出，杰克最像尼克，而不是特雷弗，但让我们把它正式化:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ny"><img src="../Images/e9e8f7b120ed47ade29ec74609ab98d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z4sOeaFLahNluUV4srXEFw.png"/></div></div></figure><p id="ab2d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数学证实:在歌曲品味的小宇宙中，杰克离特雷弗有 3.2 个单位的距离，但离尼克只有 1.4 个单位。</p><h2 id="fa34" class="nc ml it bd mm nd ne dn mq nf ng dp mu kr nh ni mw kv nj nk my kz nl nm na nn bi translated">推荐相似的人喜欢的东西</h2><p id="add9" class="pw-post-body-paragraph ki kj it kk b kl no ju kn ko np jx kq kr nq kt ku kv nr kx ky kz ns lb lc ld im bi translated">现在我们知道杰克和尼克有相似的品味，我们可以根据尼克是否喜欢向日葵来预测杰克是否会喜欢《向日葵》。只需要在表中查找:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="66b0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">尼克给了“向日葵”5/5 的评分，所以我们可以预测杰克可能也会喜欢这首歌。</p><p id="40b8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">显然，这个微小宇宙的规模比 Spotify 的宇宙要小很多。我们看了三首歌和三个人，而 Spotify <a class="ae lv" href="https://newsroom.spotify.com/company-info/" rel="noopener ugc nofollow" target="_blank">据称拥有超过 5000 万首歌曲和超过 2.71 亿活跃用户</a>。所以现在，我们要扩大规模。</p><h1 id="dec4" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">第 2 部分:用 Python 编写示例代码</h1><h2 id="0a5d" class="nc ml it bd mm nd ne dn mq nf ng dp mu kr nh ni mw kv nj nk my kz nl nm na nn bi translated">为你的品味建立一个数学模型</h2><p id="13e8" class="pw-post-body-paragraph ki kj it kk b kl no ju kn ko np jx kq kr nq kt ku kv nr kx ky kz ns lb lc ld im bi translated">为了生成更大的数据集，我们将加载一个更大的表。<a class="ae lv" href="https://gist.github.com/jackbandy/5cd988ab5c3d95b79219364dce7ee5ae" rel="noopener ugc nofollow" target="_blank">这里的</a>是一个有 25 首歌和 8 个人的:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="3da2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 Python 中，您可以使用 Pandas 通过以下命令加载这些数据:</p><pre class="lg lh li lj gt nz oa ob oc aw od bi"><span id="0a0b" class="nc ml it oa b gy oe of l og oh">from pandas import read_csv</span><span id="0986" class="nc ml it oa b gy oi of l og oh">data_url = 'https://gist.githubusercontent.com/jackbandy/5cd988ab5c3d95b79219364dce7ee5ae/raw/731ecdbecc7b33030f23cd919e6067dfbaf42feb/song-ratings.csv'</span><span id="3616" class="nc ml it oa b gy oi of l og oh">ratings = read_csv(data_url,index_col=0)</span></pre><h2 id="54c9" class="nc ml it bd mm nd ne dn mq nf ng dp mu kr nh ni mw kv nj nk my kz nl nm na nn bi translated">使用该模型寻找相似的人</h2><p id="4b03" class="pw-post-body-paragraph ki kj it kk b kl no ju kn ko np jx kq kr nq kt ku kv nr kx ky kz ns lb lc ld im bi translated">现在，让我们试着预测一下我(还是杰克)会不会喜欢《7 响》这首歌。就像在视觉示例中一样，我们会找到离我最近的人。使用勾股定理，二维空间中的距离函数就是<code class="fe oj ok ol oa b">distance=sqrt(a^2 + b^2)</code>，我们可以这样写:</p><pre class="lg lh li lj gt nz oa ob oc aw od bi"><span id="3c10" class="nc ml it oa b gy oe of l og oh">def distance(person1,person2):<br/>  a_squared = (person1[0] - person2[0])**2<br/>  b_squared = (person1[1] - person2[1])**2<br/>  c = sqrt(a_squared+b_squared)<br/>  return c</span></pre><p id="2fcc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但这一次，有 25 个维度，而不仅仅是 2 个。当我们有 25 个维度而不是只有一个 x 轴和一个 y 轴时，我们如何找到最接近的人？</p><p id="557b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">事实证明，可信的毕达哥拉斯定理非常普遍。(大多数推荐器使用其他距离度量，如余弦距离，但在本教程中我们将忽略它)。如果有三个维度，我们可以称之为<code class="fe oj ok ol oa b">a</code>、<code class="fe oj ok ol oa b">b</code>、<code class="fe oj ok ol oa b">c</code>，然后在平方根下面加上:<code class="fe oj ok ol oa b">distance=sqrt(a^2 + b^2 + c^2)</code>就可以了。实际上我们可以在任何维度上这样做:<code class="fe oj ok ol oa b">distance=sqrt(a^2 + b^2 + c^2 + d^2 + ... + n^2)</code>。</p><p id="319c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">scipy 库编写了一个函数来完成我们需要的功能:计算任意维数的欧几里德距离。让我们使用它:</p><pre class="lg lh li lj gt nz oa ob oc aw od bi"><span id="2458" class="nc ml it oa b gy oe of l og oh">from scipy.spatial.distance import euclidean</span><span id="e403" class="nc ml it oa b gy oi of l og oh">def distance(person1,person2):<br/>  distance = euclidean(person1,person2)<br/>  return distance</span></pre><p id="faba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们可以使用距离函数来查看任何两个人之间的相似性。唯一的问题是我们需要使用<code class="fe oj ok ol oa b">fillna</code>用“0”填充空白。下面的块执行该操作，然后检索这三个人的数据行:</p><pre class="lg lh li lj gt nz oa ob oc aw od bi"><span id="cd2c" class="nc ml it oa b gy oe of l og oh">ratings=ratings.fillna(0)</span><span id="ac01" class="nc ml it oa b gy oi of l og oh">jack=ratings.loc['Jack']<br/>nick=ratings.loc['Nick']<br/>trevor=ratings.loc['Trevor']</span></pre><p id="81c7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们可以看看杰克和另外两个人之间的距离:</p><pre class="lg lh li lj gt nz oa ob oc aw od bi"><span id="1d01" class="nc ml it oa b gy oe of l og oh">print("Distance between Jack and Nick:")<br/>print(distance(jack,nick))<br/># 10.63014581273465</span><span id="c404" class="nc ml it oa b gy oi of l og oh">print("Distance between Jack and Trevor:")<br/>print(distance(jack,trevor))<br/># 13.490737563232042</span></pre><p id="794e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就像在《小宇宙》中，杰克离尼克(10.63 个单位远)比离特雷弗(13.49 个单位远)更近。但实际上，我们想看看杰克和其他人之间的距离。下面是一个使用“for 循环”来实现这一目的的函数:</p><pre class="lg lh li lj gt nz oa ob oc aw od bi"><span id="b29e" class="nc ml it oa b gy oe of l og oh">def most_similar_to(name):<br/>  person = ratings.loc[name]<br/>  closest_distance=float('inf')<br/>  closest_person=''</span><span id="530c" class="nc ml it oa b gy oi of l og oh">  for other_person in ratings.itertuples():<br/>    if other_person.Index==name:<br/>      # don't compare a person to themself<br/>      continue</span><span id="8aac" class="nc ml it oa b gy oi of l og oh">    distance_to_other_person = distance(person,ratings.loc[other_person.Index])</span><span id="18ca" class="nc ml it oa b gy oi of l og oh">  if distance_to_other_person &lt; best_similarity:<br/>      # new high score! save it<br/>      closest_distance = distance_to_other_person<br/>      closest_person = other_person.Index</span><span id="930b" class="nc ml it oa b gy oi of l og oh">  return closest_person</span></pre><p id="a88f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">开头是这样说的:“到目前为止最亲近的人，在无限远的地方。”然后，它循环查看每个人，并询问“这个人比目前为止最亲近的人更亲近吗？”回答“和 Jack 最相似的人是 Jack”并没有太大帮助，这也是为什么名字相同的话循环会跳过(即<code class="fe oj ok ol oa b">continue</code>)。</p><p id="747f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们可以只调用<code class="fe oj ok ol oa b">most_similar_to</code>来查看谁与任何人最接近。让我试试(杰克):</p><pre class="lg lh li lj gt nz oa ob oc aw od bi"><span id="dece" class="nc ml it oa b gy oe of l og oh">print("Jack is most similar to:")<br/>person_most_similar_to_jack = most_similar_to('Jack')<br/>print(person_most_similar_to_jack)<br/>print(distance)</span><span id="87a9" class="nc ml it oa b gy oi of l og oh"># Meg<br/># 8.660254037844387</span></pre><h2 id="bd7c" class="nc ml it bd mm nd ne dn mq nf ng dp mu kr nh ni mw kv nj nk my kz nl nm na nn bi translated">推荐相似的人喜欢的东西</h2><p id="8a33" class="pw-post-body-paragraph ki kj it kk b kl no ju kn ko np jx kq kr nq kt ku kv nr kx ky kz ns lb lc ld im bi translated">最后，我们可以通过看和我最相似的用户来预测我是否会喜欢“7 环”。当时资料上说这是梅格，那我们来看看梅格是怎么评价这首歌的:</p><pre class="lg lh li lj gt nz oa ob oc aw od bi"><span id="b49b" class="nc ml it oa b gy oe of l og oh">print(ratings.at['Meg', '7 Rings (Ariana Grande)'])<br/># 3.0</span></pre><p id="3710" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">梅格对这首歌的评价是 3/5，所以我可能不会对它太着迷。</p><p id="720d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">一个 Google Colab 笔记本全部代码都有</em> <a class="ae lv" href="https://colab.research.google.com/drive/1HdMr5uPnCstdpfObJkxAZxDYOcspYP2i" rel="noopener ugc nofollow" target="_blank"> <em class="le">这里</em> </a> <em class="le">。</em></p></div><div class="ab cl om on hx oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="im in io ip iq"><h1 id="8175" class="mk ml it bd mm mn ot mp mq mr ou mt mu jz ov ka mw kc ow kd my kf ox kg na nb bi translated">后续步骤</h1><p id="9ab9" class="pw-post-body-paragraph ki kj it kk b kl no ju kn ko np jx kq kr nq kt ku kv nr kx ky kz ns lb lc ld im bi translated">如果你真的想做 Spotify 正在做的事情，你会利用每个 T21 人的音乐品味做出预测，而不仅仅是最亲近的人。例如，也许如果我知道特雷弗和我一直有非常不同的品味，认识到特雷弗喜欢《7 环》可能会告诉我，我会不喜欢这首歌。我可能会在未来的教程中涉及到这一点，所以如果您感兴趣，请告诉我！</p></div></div>    
</body>
</html>