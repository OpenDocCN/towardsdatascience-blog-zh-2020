<html>
<head>
<title>Interactive climate data visualizations with Python &amp; Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python &amp; Plotly实现交互式气候数据可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-climate-data-visualizations-with-python-plotly-de0472490b09?source=collection_archive---------15-----------------------#2020-01-31">https://towardsdatascience.com/interactive-climate-data-visualizations-with-python-plotly-de0472490b09?source=collection_archive---------15-----------------------#2020-01-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0ada" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用plotly可视化时间序列数据，包括条形图(柱形图)和子图(源代码和数据在我的<a class="ae ki" href="https://gitlab.com/jphwang/online_articles" rel="noopener ugc nofollow" target="_blank"> GitLab repo </a>中)</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/c74b8361ce3e5f99db68cd7411bcfc59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SgVHuLEkMikDva79snQ8wQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">肯里克·米尔斯在<a class="ae ki" href="https://unsplash.com/s/photos/weather?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的原始照片</p></figure><p id="23a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">条形图(确切地说是柱形图)是非常非常有效的数据可视化形式。它们在感觉上很棒，通常不需要像一些不寻常的情节那样多的解释。支线剧情并不经常被提及，但是它们会非常强大和有效。以某种方式使用，它们可以让我们在4维中展示数据，因为二维图表可以是二维网格。有时，它们只是允许我们在一个图形中很好地展示多个图形。</p><p id="1b32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近一直在看澳大利亚气象局的气温数据。美国气象局提供了大量高质量的数据，许多气象站的温度观测可以追溯到1910年。</p><p id="149b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我将分享如何使用Python和Plotly / Plotly Express创建这样的图，使用这个温度数据集。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lv"><img src="../Images/f8e9d68c103ceee2bfc82d8a40ea7a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TspkvxwKA8sxI8gGfBe3CA.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lw"><img src="../Images/3e0d9413a3e45f35fc184852f8062744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61pUpVzbDtJ0yZQvgEHK7w.png"/></div></div></figure><p id="1737" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lx">和往常一样，我在我的</em><a class="ae ki" href="https://gitlab.com/jphwang/online_articles" rel="noopener ugc nofollow" target="_blank"><em class="lx">git lab repo here</em></a><em class="lx">(</em><strong class="lb iu"><em class="lx">climate _ data</em></strong><em class="lx">目录)中包含了这方面的代码，所以请随意下载并使用/改进它。</em></p><h1 id="1388" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">在开始之前</h1><h2 id="e3f7" class="mq lz it bd ma mr ms dn me mt mu dp mi li mv mw mk lm mx my mm lq mz na mo nb bi translated">数据</h2><p id="dc73" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">原始数据来自BOM的<a class="ae ki" href="http://www.bom.gov.au/climate/data/acorn-sat/" rel="noopener ugc nofollow" target="_blank"> ACORN-SAT数据集</a>。这是一个高质量的数据集，我根本不用做太多的预处理。尽管如此，该数据集相对较大，包含一百年来来自一百多个站点的每日观察结果——所以我在git repo中提供了一个经过处理的数据集文件。</p><h2 id="ffc7" class="mq lz it bd ma mr ms dn me mt mu dp mi li mv mw mk lm mx my mm lq mz na mo nb bi translated">包装</h2><p id="6137" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我假设您熟悉python。但是，即使你相对较新，这个教程不应该太棘手。如果你有什么不确定的，可以随时在推特上或这里联系。</p><p id="3676" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你需要用一个简单的<code class="fe nh ni nj nk b">pip install [PACKAGE NAME]</code>将<code class="fe nh ni nj nk b">plotly</code>和<code class="fe nh ni nj nk b">pandas.</code>安装到你的虚拟环境中。</p><h1 id="9658" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">Plotly Express条形图</h1><h2 id="8ee4" class="mq lz it bd ma mr ms dn me mt mu dp mi li mv mw mk lm mx my mm lq mz na mo nb bi translated">数据</h2><p id="2645" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">数据集包括来自多个气象观测站的数据。为了对数据有所了解，让我们加载它，快速浏览一下，然后绘制一个站的数据。</p><p id="7680" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像往常一样，用以下内容加载数据:</p><pre class="kk kl km kn gt nl nk nm nn aw no bi"><span id="9c86" class="mq lz it nk b gy np nq l nr ns">import pandas as pd<br/>flat_avg_df = pd.read_csv('climate_data/srcdata/flat_avg_data.csv', index_col=0)</span></pre><p id="dff7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nh ni nj nk b">index_col</code>参数向<code class="fe nh ni nj nk b">pandas</code>指定哪一列将被用作索引。</p><p id="d19a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不使用该参数加载CSV文件会导致索引列重复，从而产生如下输出。注意重复的索引列，其中索引列已经保存为<code class="fe nh ni nj nk b">‘Unnamed: 0’</code>。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">请注意重复的索引列</p></figure><p id="b6f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除此之外，列应该是直截了当的。<code class="fe nh ni nj nk b">avg_temp_C</code>显示的是年平均温度，<code class="fe nh ni nj nk b">rel_avg_temp_C</code>是一个相对的数字，是该站点的中值，我还包括了站点名称字符串、年份和数据类型。<code class="fe nh ni nj nk b">datatype</code>为<code class="fe nh ni nj nk b">tmax</code>或<code class="fe nh ni nj nk b">tmin</code>，表示是否与日最高或最低温度有关。</p><h2 id="adcc" class="mq lz it bd ma mr ms dn me mt mu dp mi li mv mw mk lm mx my mm lq mz na mo nb bi translated">简单条形图</h2><p id="5d46" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">现在，让我们只绘制一个站点的<code class="fe nh ni nj nk b">tmax</code>数据。我们将根据站点名称(到<code class="fe nh ni nj nk b">simple_df</code>)过滤数据帧，并将其传递给Plotly Express。</p><pre class="kk kl km kn gt nl nk nm nn aw no bi"><span id="4fdd" class="mq lz it nk b gy np nq l nr ns">import plotly.express as px<br/>simple_df = flat_avg_df[(flat_avg_df.site_name == 'ALBANY AIRPORT') &amp; (flat_avg_df.datatype == 'tmax')]<br/>fig = px.bar(simple_df, x='year', y='rel_avg_temp_C', color='rel_avg_temp_C')<br/>fig.show()</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nv"><img src="../Images/30379195bb9b9c17dafe0208b409d166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KmRgP_CsLWp_p5XceT3e1w.png"/></div></div></figure><p id="c9b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像那样，我们可以看到奥尔巴尼机场测量的年相对温度。</p><p id="5b87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自1910年开始测量以来，这一数字呈上升趋势。但是这种情况是否到处都存在呢？如果我们选择多个地点呢？看起来怎么样？</p><h1 id="fc90" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">支线剧情</h1><h2 id="6117" class="mq lz it bd ma mr ms dn me mt mu dp mi li mv mw mk lm mx my mm lq mz na mo nb bi translated">用Plotly Express</h2><p id="53bd" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">支线剧情允许你在一个图形中包含多个情节。Plotly允许创建支线剧情，无论是快速版还是经典版。</p><p id="87f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所料，Plotly Express更快更容易使用，尽管控制更少。让我们开始吧。</p><p id="2e22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“情节表达”子情节功能基于其<code class="fe nh ni nj nk b">facet_row</code>和<code class="fe nh ni nj nk b">facet_col</code>参数，允许使用这些分类变量创建子情节。让我们将来自不同站点的数据放在行上，将tmin / tmax值放在列上。</p><p id="bcd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行<code class="fe nh ni nj nk b">len(flat_avg_df.site_name.unique())</code>，它告诉我们有112个唯一的名字——现在可能有太多的行需要查看。我将只选择前5个名字，并像这样绘制数据:</p><pre class="kk kl km kn gt nl nk nm nn aw no bi"><span id="b911" class="mq lz it nk b gy np nq l nr ns">site_names = flat_avg_df.site_name.unique()<br/>short_df = flat_avg_df[flat_avg_df.site_name.isin(site_names[:5])]<br/>fig = px.bar(short_df, x='year', y='rel_avg_temp_C', color='rel_avg_temp_C', facet_row='site_name', facet_col='datatype')<br/>fig.show()</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nw"><img src="../Images/9829eba53f53282b52daf7415343cec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nj8faRAAMnA4QPm8GUrGiA.png"/></div></div></figure><p id="8e53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这难道不是非常高效吗！</p><p id="004d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">x轴是共享的，并且很好地对齐，这使我们可以快速看到哪些数据点丢失了。例如，右下角的数据(来自Scone机场)可能只是从1963年开始的。我们的Y轴刻度和彩色轮廓刻度也是统一的，便于比较。</p><p id="135d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这在视觉上有点混乱——但是记住，我们只用了4行代码就创建了它。我们可以清理它，但我们现在不会这样做。我想强调我们可以多快地可视化，比较数据集以及数据本身的质量和属性。</p><p id="d395" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种方法的一个限制是子情节行和列需要与特定的分类变量相关联。为了使用Plotly Express绘制来自10个不同站点的数据，我可以创建一个新列，比如说叫做<code class="fe nh ni nj nk b">subplot_cols</code>，根据要放入列中的图分配值(比如<code class="fe nh ni nj nk b">1</code>或<code class="fe nh ni nj nk b">2</code>，并传递参数<code class="fe nh ni nj nk b">facet_col=’subplot_cols'</code>。我也必须对行做同样的事情。</p><p id="b5e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很好，但这实际上是一种变通方法，而不是按照预期使用该特性。毕竟，Plotly Express是用于探索性分析和组织良好的数据。它不是最灵活的工具。</p><p id="2cba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，接下来让我们看看如何用常规情节来生成支线剧情，这会给我们更多的灵活性。</p><h2 id="5d9b" class="mq lz it bd ma mr ms dn me mt mu dp mi li mv mw mk lm mx my mm lq mz na mo nb bi translated">与(经典)情节地</h2><p id="2f0f" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在Plotly中创建支线剧情的最基本语法如下:</p><pre class="kk kl km kn gt nl nk nm nn aw no bi"><span id="10f1" class="mq lz it nk b gy np nq l nr ns">fig = make_subplots(rows=n_rows, cols=n_rows)  # Create subplot grid<br/># Add subplot trace &amp; assign to each grid<br/>fig.add_trace(<br/>    go.Bar(<br/>        x=[X_DATA],<br/>        y=[X_DATA],<br/>    ),<br/>    row=[SUBPLOT_ROW], col=[SUBPLOT_ROW],<br/>)</span></pre><p id="c7e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你会看到<code class="fe nh ni nj nk b">add_trace</code>功能需要为每个使用的支线剧情重复。优选地，使用循环而不是手动添加轨迹。尤其是随着支线剧情数量的增长。</p><p id="a6cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从小处着手。我们将创建一个2乘2的子绘图网格，并绘制来自前四个站点(按站点名称)的数据，仅绘制<code class="fe nh ni nj nk b">‘tmax’</code>值。</p><p id="e0ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们之前看到，并不是某些台站明显缺少某些年份的数据。这在上面并不重要，因为Plotly Express通过省略来处理丢失的数据，但在这里我们不能这样做。我们将传递一个列表或者一个数组作为Y值，跳过这些值将会导致数据错位。</p><p id="9d32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们处理相对值时，让我们用零填充缺失的数据。(这是否是最好的做法还有待商榷，但我们可以改天再讨论。)当我们将数据传递给绘图时，我们必须记住这样做。</p><p id="8767" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，让我们对每个子图进行循环，每个循环a)收集要绘制的年份的Y数据(温度)，并将该数据<em class="lx">从循环内部传递到plottly</em>。这相对来说很简单，请看下面的代码片段:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="1dae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我创建了一个名字列表(<code class="fe nh ni nj nk b">site_names</code> ) &amp;一个年份列表(<code class="fe nh ni nj nk b">year_list</code>)。我对年份列表进行排序，然后循环遍历子情节的数量(<code class="fe nh ni nj nk b">4</code>)，用一个内部循环遍历这一年，当没有这一年的数据时，我简单地指定一个零值。</p><p id="ffb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我使用数据添加一个简单的轨迹到我们的图中，使用<code class="fe nh ni nj nk b">.add_trace</code>方法。我已经参数化了第&amp;行的列号(末尾的+1确保数字从1和1开始，而不是从0和0开始)。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/2ac74ec49c0cb70d6c6f2e7335d6cadb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8XoPdjn2W3GcIKS-Ed5zvA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">不幸的是，作品越多，支线剧情越好。</p></figure><p id="592c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，不幸的是，我得说这看起来更糟。我们以相同的格式绘制了相同的数据，但是颜色现在没有意义，轨迹名称也消失了，我们使用了大约25行代码。哦。</p><p id="b3df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是让我们继续前进——它会变得更好，我保证。</p><p id="a4ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单地添加支线剧情标题、标记说明、添加公共y轴参数和更新布局以隐藏无意义的图例会产生奇迹:</p><pre class="kk kl km kn gt nl nk nm nn aw no bi"><span id="0989" class="mq lz it nk b gy np nq l nr ns">fig = make_subplots(<br/>    rows=2, cols=2,<br/>    subplot_titles=site_names<br/>)<br/>go.Bar(<br/>    ...<br/>    marker=dict(color=temp_vals, colorscale='RdYlBu_r'),<br/>),<br/>fig.update_yaxes(tickvals=[-2, 0, 2], range=[-2.5, 2.5], fixedrange=True)<br/>fig.update_layout(showlegend=False)</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/ed05cffe185f8806e253e3995408b41b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PCpW9fvIPL1FTGThC20cqg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">看看这有多好！</p></figure><p id="8e5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们扩展这个概念，建立我们的下一个图表，尽可能多的支线剧情。</p><p id="8384" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些修改看起来很冗长，但实际上并不冗长。我所做的是:</p><ul class=""><li id="6801" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated">在我们的子情节中参数化行数和列数(<code class="fe nh ni nj nk b">subplot_rows = …</code>)</li><li id="97a4" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">参数化图形的高度和宽度(<code class="fe nh ni nj nk b">height=120 * subplot_rows, width=230 * subplot_cols</code>)，以保持子图大小一致，而不是随着行数或列数的变化而缩小或放大。</li><li id="724c" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">根据观察次数对站点名称(<code class="fe nh ni nj nk b">names_by_obs = …</code>)进行排序，这样我们可以优先绘制数据最多的站点</li><li id="db1c" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">减少支线剧情之间的间距(<code class="fe nh ni nj nk b">horizontal_spacing=…</code>)，以及</li><li id="14e3" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">缩小字体大小(<code class="fe nh ni nj nk b">font=dict(...</code>)。</li></ul><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nt nu l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lw"><img src="../Images/3e0d9413a3e45f35fc184852f8062744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61pUpVzbDtJ0yZQvgEHK7w.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">性感支线剧情！</p></figure><p id="f3c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编辑:这篇文章的早期版本使用了下面的代码来设置标题——因为我不知道有一种方法可以访问这些代码:</p><pre class="kk kl km kn gt nl nk nm nn aw no bi"><span id="32aa" class="mq lz it nk b gy np nq l nr ns">for i in fig['layout']['annotations']:<br/>    i['font'] = dict(size=10, color='#404040')</span></pre><p id="055b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，您可以这样使用:</p><pre class="kk kl km kn gt nl nk nm nn aw no bi"><span id="624e" class="mq lz it nk b gy np nq l nr ns">fig.update_annotations(patch=dict(font=dict(size=10, color='#404040')))</span></pre><p id="2b74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您*确实*需要手动访问这些属性中的任何一个，那么<code class="fe nh ni nj nk b">fig</code>对象允许您非常容易地做到这一点，这很好。</p><h1 id="84cc" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">Plotly Express的堆积条形图</h1><p id="e29f" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">这会让你大吃一惊的。我假设您仍然将主数据帧加载到内存中。好吧。准备好了吗？只需运行这段代码:</p><pre class="kk kl km kn gt nl nk nm nn aw no bi"><span id="f9c1" class="mq lz it nk b gy np nq l nr ns">fig = px.bar(flat_avg_df, x='year', y='rel_avg_temp_C', color='rel_avg_temp_C')<br/>fig.show()</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi om"><img src="../Images/bca4b84656594aa578e3c94defb8ad37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yBbeXfKEOvUXYyWyiP8Zog.png"/></div></div></figure><p id="dfd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我看到这个情节时，我只是头晕。是的，它并不完美。但是在仅仅两行代码中，我就能可视化整个年度数据集，显示112个站的温度变化的年度总趋势。</p><p id="2647" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只是为了比较，我用常规Plotly重新创建了这个，用了大约30-40行代码，主要是在数据和格式上。(我这里没收录。)</p><p id="c2cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个图中，我叠加了tmax和tmin值，这并不理想。让我们把他们分开。此外，由于我们正在绘制温度，让我们坚持红色=热，蓝色=冷的惯例，确保色标的中点在零。(你会注意到上面的零与刻度的中点不太一致)</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nt nu l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi om"><img src="../Images/27429e4821bef350c851ab8d47c4d84f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v21QYyOZ2qZ0VzBTECGfGg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">现在有了美味的支线剧情！</p></figure><p id="78e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">老实说，我对这个样子非常满意。但是有几个大问题——我将温度叠加到没有任何意义的数字上，虽然Plotly Express处理缺失的数据，但其中一些堆栈由比其他更多的观察值组成，这扭曲了输出。</p><p id="518d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据可视化不仅仅是制作漂亮的图片，<em class="lx">它是向读者传达信息</em>。我们可以做得更好；让我们将温度归一化，以表示一个合理的值，比如每年气象观测站的冷热变化之和。</p><p id="01d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在数据框中创建了一个新列，其中温度值除以当年的样本数:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="c514" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦完成，我们可以像以前一样简单地绘制它，唯一的变化是<code class="fe nh ni nj nk b">y=’norm_rel_avg_temp_C’</code>。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi om"><img src="../Images/6b754309dd0109a821f2d84f3347bea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eDodBcNJ6fK2f5E0Fz0X-A.png"/></div></div></figure><p id="c8f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到，图像左侧的数字(更远的过去)已被放大，以说明样本较少的事实。</p><p id="5923" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为最后一步，我们包括格式元素——图形标题、轴标题、图例标题和注释。图例的大小会随边框一起调整，并按比例缩小。这是结果:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lv"><img src="../Images/f8e9d68c103ceee2bfc82d8a40ea7a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TspkvxwKA8sxI8gGfBe3CA.png"/></div></div></figure><p id="9796" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很好，不是吗？我对结果很满意。<a class="ae ki" href="https://jolly-snyder-46e349.netlify.com/202001_climate/aus_weather_aggregate_trend_subplot.html" rel="noopener ugc nofollow" target="_blank">这里是互动版</a>。</p><p id="6955" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">条形图是数据可视化工具箱中非常重要的工具。条形图允许对值进行简单的比较，在需要时将值组合在一起，并且易于理解。</p><p id="0f93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">支线剧情没有那么关键，但是有很高的实用性。任何看过pairplots的人都可以证明这一点。我个人也发现，我经常有最好的可视化数据分割，并经常想使用支线剧情。“Plotly Express”功能允许通过功能生成子图，节省了大量时间，因为它减少了可视化某些分类变量的效果所需的工作。</p><p id="8a4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">常规Plotly的支线剧情功能更强大，但也更冗长。它允许像用Plotly的支线剧情操纵网格大小这样的事情，所以如果你对进一步定制支线剧情布局感兴趣，你可能希望探索那个选项。</p><p id="3cf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望以上内容对你展示使用Plotly / Plotly Express可以轻松创建的好看的可视化效果是有用的。尝试使用参数——列数、行数、色彩映射表、字体大小等等。我发现我通过这种方式学到了很多东西。</p><p id="985a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如往常一样，如果你有任何问题或意见，打电话给我。</p></div><div class="ab cl on oo hx op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="im in io ip iq"><p id="d42e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这个，比如说👋/关注<a class="ae ki" href="https://twitter.com/_jphwang" rel="noopener ugc nofollow" target="_blank"> twitter </a>，或关注更新。我还写了一些关于用Plotly制作交互式地图和可视化篮球数据的文章。</p><div class="ou ov gp gr ow ox"><a rel="noopener follow" target="_blank" href="/interactive-basketball-data-visualizations-with-plotly-8c6916aaa59e"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd iu gy z fp pc fr fs pd fu fw is bi translated">用Plotly实现交互式篮球数据可视化</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">用hexbin shot图表分析体育数据，用Plotly和Plotly Express分析气泡图(源代码&amp;我自己的数据…</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">towardsdatascience.com</p></div></div><div class="pg l"><div class="ph l pi pj pk pg pl kt ox"/></div></div></a></div><div class="ou ov gp gr ow ox"><a rel="noopener follow" target="_blank" href="/interactive-maps-with-python-pandas-and-plotly-following-bloggers-through-sydney-c24d6f30867e"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd iu gy z fp pc fr fs pd fu fw is bi translated">Python、pandas和Plotly的交互式地图:跟随博主穿越悉尼</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">在这篇文章和其他几篇文章中，我将探索Python和Plotly，把一些不同的看起来很棒的…</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">towardsdatascience.com</p></div></div><div class="pg l"><div class="pm l pi pj pk pg pl kt ox"/></div></div></a></div></div></div>    
</body>
</html>