<html>
<head>
<title>BYOL: Bring Your Own Loss</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BYOL:带来你自己的损失</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/byol-bring-your-own-loss-c5292cb8e9e3?source=collection_archive---------56-----------------------#2020-06-18">https://towardsdatascience.com/byol-bring-your-own-loss-c5292cb8e9e3?source=collection_archive---------56-----------------------#2020-06-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9775" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们如何用客户损失函数改进交货时间估计</h2></div><p id="bd9b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">亲爱的鉴赏家们，我邀请你们去看一看<a class="ae le" href="http://careem.com/" rel="noopener ugc nofollow" target="_blank"> Careem的</a>送餐平台。具体来说，我们将看看我们如何使用机器学习来改善交付时间跟踪的客户体验。</p><h2 id="006d" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated"><strong class="ak">简介</strong></h2><p id="c8f9" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">计划一顿饭时，时机至关重要。这就是为什么我们非常小心地估计订单的交货时间。然而，交付时间取决于几个复杂的因素——出于这个原因，机器学习是预测预计到达时间的正确选择。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/abab36e8d9144d0d85cf8841d45c625c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Bp7jZ3KPALo9eT9YFfSbQ.jpeg"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">Careem的食品交付平台界面，用于交付时间估算</p></figure><p id="f7c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">乍一看，这只是一个典型的回归问题:获取一些功能，根据历史交付时间训练一个合理的模型以最小化RMSE，使用合适的交叉验证策略估计平均误差的预期下降，并与领导层分享，部署，广泛宣布，并获得尊重，信任，晋升…</p><p id="85e3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将尝试解释这种方法的错误。我将描述我们对这个问题的解决方案以及我们衡量用户影响的方式。然后，我将向您展示我们如何构建一个自定义损失函数来更好地优化用户订单满意度。</p><h2 id="3cd5" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">有什么问题吗</h2><ol class=""><li id="f438" class="mt mu it kk b kl ly ko lz kr mv kv mw kz mx ld my mz na nb bi translated"><em class="nc">训练你的模特对抗RMSE </em>。RMSE、梅、胡伯等损失是大多数回归问题的典型选择。然而，这些损失反映了我们客户的感受吗？最大的问题是它们是对称的——它们不能区分提前20分钟或晚20分钟送达的订单。我的直觉肯定能看出区别…如果我们的模特表现出更多一点的同理心，那就太酷了。</li><li id="9f36" class="mt mu it kk b kl nd ko ne kr nf kv ng kz nh ld my mz na nb bi translated"><em class="nc">通过平均误差评估成功。<br/> </em>又来了。想象一下，您的团队已经努力工作了一个月，用其昂贵的基础设施设置实时交通数据流，以获得减少错误的功能，现在，它最终从平均3分钟下降到2.5分钟！20%的涨幅，什么结果！这绝对值得…是吗？实际上很难说，这在很大程度上取决于一个特定的问题。对于我们和许多其他应用程序来说，客户很可能甚至不会注意到这种变化。</li><li id="7821" class="mt mu it kk b kl nd ko ne kr nf kv ng kz nh ld my mz na nb bi translated">获得尊重、信任、晋升。<br/> 这个挺简单的！工作是为了乐趣，而不是为了升职！</li></ol><h2 id="4352" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">那么，我们该怎么办？</h2><p id="6509" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated"><em class="nc">免责声明:出于法律原因，此处显示的所有数据都是合成的，但它是以代表真实行为的方式构建的。</em></p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/a2633eac32947e672abb1d4f78963194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*Y1XCrHVBzbcj1-921FshLg.png"/></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">目标分布</p></figure><p id="1122" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们从找到衡量成功的方法开始。在某些情况下，测量MAE是有意义的。然而，在交货时间估计的情况下，这在很大程度上是没有意义的。它没有告诉我们对客户有什么影响。</p><p id="986c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们关心的是客户体验。你关心的是对你的客户体验的影响，这可以通过多种方式来衡量:交付率、流失率、保留率、LTV、呼叫中心联系率、NPS评分。例如，在Careem，我们使用反映业务状态的呼叫中心联系率、流失率、交付时间和交付评级的加权组合。</p><p id="b0e3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">问题是这些很难优化。因此，数据科学家经常求助于RMSE、梅、胡伯等作为代理人。然后只在部署后测试真实的用户影响。</p><p id="f857" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们假设我们项目的目标是提高平均交付率。我们需要了解我们的模型将对交付ratting产生什么影响。做到这一点的一个方法是查看历史交付时间估计，并查看当出现各种交付时间错误时，客户评级会发生什么变化。下面我们看到一个图表，显示了平均行程等级，显示的交付时间误差估计中不同程度的误差:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nj"><img src="../Images/4d146d1742423bd34bcdda77c05dec98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ll1IuuIibUu8vhRF56oSYw.jpeg"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">左图是Careem的反馈页面，订单完成后发送。在右图中，根据交货时间估计经验，给出了每个仲裁箱的平均等级(见免责声明)</p></figure><p id="a635" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有许多直观的见解:</p><ul class=""><li id="8c82" class="mt mu it kk b kl km ko kp kr nk kv nl kz nm ld nn mz na nb bi translated">人们喜欢准时或早一点得到食物</li><li id="c430" class="mt mu it kk b kl nd ko ne kr nf kv ng kz nh ld nn mz na nb bi translated">如果送货时间过长，你会感到失望</li><li id="d62a" class="mt mu it kk b kl nd ko ne kr nf kv ng kz nh ld nn mz na nb bi translated">不要对过早得到食物感到太兴奋，但是仍然，感觉它比延迟交付更积极</li></ul><p id="5658" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果食物晚送了22分钟以上，那么分数应该在1.9分左右(见顶部的免责声明)。利用这一点，我们有一个清晰的方法将我们的交货时间误差转化为对订货周转时间的估计。然后在一个验证数据集上，当使用我们的模型时，我们能够估计旅行的预期平均评级。因此，我们找到了一种为我们的模型评估有意义的度量的方法。</p><p id="a265" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nc">查看图表，同样重要的是要强调，最佳模型不一定是MAE等于0的模型。如果我有一个完美的模型，我可能会将预测稍微向左移动一点，以确保我们做顾客最喜欢的事情——比我们最初承诺的时间提前几分钟交付食物。</em></p><p id="c6f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好了，回到正轨，我们的<strong class="kk iu">目标已经确定</strong>。</p><h2 id="5e41" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">典型解决方案</h2><p id="1ecf" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">一个非常合理的下一步是针对这个目标运行您最喜欢的超参数优化算法。对于下面的图，我们针对这个目标在120次迭代中使用RMSE损失来调整Catboost。我们先来比较一下这两位会把我们带向何方。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nj"><img src="../Images/3e994f977634058376d1d13e0556aae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zs-yf3cOlRbF6EafJ8tRSA.jpeg"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">在左图中，有一个对120回合HPO的评估，当时RMSE既用了客观又用了失败。在右图中，针对RMSE进行了优化，但评估是使用评级目标进行的。</p></figure><p id="b2c7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不伟大，也不可怕。这是一个小小的改进，但它是免费的。此外，现在，你对你的工作的潜在影响有了更好的理解，而不是说“新的实施将交付时间估计提高了U%”，你会添加一个微小而重要的后缀:“…预计将带来大约K星的评级提高”，或“保留率提高了P%，或“收入增加了H%，或“人们微笑的次数增加了28%”。</p><h2 id="17d4" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">定制损失函数</h2><p id="c13d" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">当然，这不是我们能做的全部。是的，我们提高了一点分数，但是仍然面临着RMSE对称性的问题。想出一个自定义损失函数是相当常见的，尤其是在各种深度学习领域。我喜欢这个<a class="ae le" href="https://heartbeat.fritz.ai/research-guide-advanced-loss-functions-for-machine-learning-models-aee68ed8a38c" rel="noopener ugc nofollow" target="_blank">帖子</a>，它很好地总结了高级损失函数。</p><p id="b6b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但令人惊讶的是，经典的机器学习应用程序并没有广泛采用损失函数定制，尽管它们有时肯定会从中受益。让我们考虑一个围绕MSE的通用形式调整:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi no"><img src="../Images/0b92c128110c6f987bced9e2982b9002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bUJFcw6QHH1juAa_d6sRRQ.png"/></div></div></figure><p id="581e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">函数<em class="nc"> g </em>可以像数据科学家幻想的那样复杂，只要你的应用从中受益……而且函数<em class="nc"> g </em>有某种形式的导数。但是，即使不深入兔子洞，我们也可以挑选最简单的误差g步函数:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi np"><img src="../Images/be9e0036dfbc33c93b93b8d6d6bbfee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XiE2UiYzJOQh4dHBAdLErw.png"/></div></div></figure><p id="fdd3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，<em class="nc"> g </em>只不过是一个动态权重，它是根据误差为每个对象选择的。姑且称之为分段MSE吧。最明显的参数选择是使它们与每个错误的等级成比例。这样，模型会比早期交付更努力地避免延迟交付，变得不那么乐观。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nq"><img src="../Images/5d06d5f0a58e53283b5466f3a5a4d42d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MuKitXQgAxaQPN62rlD4Dg.png"/></div></div></figure><p id="6517" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，没有什么比计算预测的一阶和二阶导数更容易的了:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nr"><img src="../Images/a541e6ffe015bfcfbdee3d75bdc8e573.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cm1oDFQJR2Je9wwzPmsQoQ.png"/></div></div></figure><p id="7cb4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是我们在您最喜欢的梯度推进实施之上运行所需的全部内容，并具有广泛的超参数优化</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ns"><img src="../Images/8d3b81d8ea9a781d467755d920ab68e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jbGQx_luSGhI7s-mI-ZEDA.png"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">左图显示了与每个篮子的预期评级成比例的损失函数形状。右图显示了超参数优化目标(评级)</p></figure><p id="97cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在与香草RMSE的比赛中取得了一点成绩，但前面还有很长的路要走。事实是，我们新的损失函数形状不是最优的，即使它看起来像。</p><p id="ca8d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">考虑一个简单的例子。数据集有一个异常对象，它完全是凭空出现的:一个快递员(我们称他们为队长)的自行车在距离目的地仅一个街区的地方坏了，送货花了3个小时。您的数据集中没有可以帮助区分这种特殊情况的要素，而且很可能该对象会损害整体算法的性能。如果损失函数不太关注异常值，那就更好了。</p><p id="c212" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">反对这种固定客户损失的第二个理由是优化。机器学习中的大多数模型都是通过某种形式的梯度下降来优化的。在这个顺序的(而且往往是随机的)过程中，任何变化:不同的初始化、学习速率、批量洗牌都会导致不同的结果。因此，正如我们改变采用不同数据集的模型的学习率一样，调整损失函数的系数可能有助于提高性能。</p><h2 id="b23a" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">损失函数选择的自动化</h2><p id="15bd" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">遗憾的是，我们无法做出模型的c_k参数。但是让它们成为超参数并不太坏。现在，在其他模型的参数中(我使用的是<a class="ae le" href="https://catboost.ai/docs/concepts/parameter-tuning.html" rel="noopener ugc nofollow" target="_blank"> Catboost </a>)，我们将使用相同的超参数优化程序来调整c_k。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nt"><img src="../Images/a7a40241b9c73650e5a6d7e7f2f2bb1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mMhWTY_feQotc19Dobt2Lw.gif"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">左图显示了一系列考虑的损失函数(五分位数损失)。右图显示了超参数优化目标(评级)</p></figure><p id="b987" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，分数明显更高了。毫不奇怪。这是因为损失是为<strong class="kk iu">这个特定问题</strong>和<strong class="kk iu">这个特定数据集</strong>定制的。</p><p id="a42f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，通过这种设置，HPO直接(嗯，几乎)优化了您关心的指标——平均预期评级，而不是抽象的和业务不可知的MSE。</p><p id="382d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一个图显示了我们的赢家损失函数的形状，它是在第151次迭代中发现的。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nu"><img src="../Images/352f5338637d18e5e7927f7ac9e8088a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bKxDInpzeO9EHj4Bv4JS4g.png"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">分段均方误差的最佳损失。是由HPO程序与240轮选择。</p></figure><p id="02dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">误差低于18的地方看起来到处都是倾斜的MSE。然后，它将误差大于18的对象去优先级化。看着上面的柱状图，它可能看起来是反直觉的:18分钟的误差预计是最需要避免的！</p><p id="8f12" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但我们不应该忘记，HPO过程不仅着眼于柱状图，而且整体考虑数据集、模型性能、模型的其他超参数和目标的组合。可能没有一个物体的模型会犯如此大的错误。因此，相反，它专注于将物体从<em class="nc">篮11–18</em>移动到<em class="nc">篮5–11</em>。或者，这种行为可能有其他原因。因此，损失函数形状不必是直观的，以便提供最好的分数。当综合考虑所有因素时，这个损失函数在这个特定的背景下是不成立的。</p><h2 id="7f41" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">又一次海关损失</h2><p id="c525" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">所以，我们已经取得了很大的进步。让我们再做一点小小的改变。先前的损失函数通过缩放RSE来修改它。很好，但是不够灵活。向前迈进了一步，通过增加一个偏差来概括它:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nv"><img src="../Images/14fd6c2e24669479fd451f10f55d9d61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mPSX1YuJkQBoOeTgSkhvwQ.png"/></div></div></figure><p id="809d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们称之为有偏分段MSE。</p><p id="f4fa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，我们执行HPO的相同操作，但是现在与我们的<em class="nc"> c </em>和<em class="nc"> b </em>一起运行，与算法的其余超参数一起运行。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nt"><img src="../Images/e9f8b3545e2b9ec88bcf0fc05619a673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gx0md_x6Y-p2OZO0FNI6BQ.gif"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">左图显示了一系列考虑的损失函数(有偏差的分段MSE损失)。右图显示了超参数优化目标(评级)</p></figure><p id="6712" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最好的分数是我们以前最好成绩的又一次增加。新获得的定制损失的形状看起来更像弗兰肯斯坦，但仍然很漂亮。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nw"><img src="../Images/516598138db8a3d5879f5ca95e84fb7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xMrvapVMevHerjq3EEqT9g.png"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">有偏分段均方误差的最佳损失。是通过HPO程序用360轮选出来的。</p></figure><h2 id="3da8" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">其他损失</h2><p id="2ca3" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">上面将定制的可调物镜与RMSE进行了比较，尽管后者是最广泛采用的一种物镜，但对于当前应用来说，它有一个主要缺点—它是对称的。但是还有其他类型的非对称损失函数。一个流行的例子是<em class="nc">五分位数</em>损失。我们要把这个和我们的分段函数进行比较。同样，它的主要参数<em class="nc">α</em>将被视为超参数，与之前实验中的方式相同。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nt"><img src="../Images/89fafc9c3e461281bdc1fe909b4e6540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yBt_fgloubC61EiU33kJrg.gif"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">左图显示了一系列考虑的损失函数(五分位数损失)。右图显示了超参数优化目标(评级)</p></figure><p id="b276" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">分位数回归的结果比任何以前调整过的RMSE要好，但是仍然会因调整过的分段损失而损失很大。</p><p id="ee96" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nc">值得注意的是，除了损耗特定参数外，上述所有实验都使用了相同的超参数集。此外，对于模型的超参数的数量增加的HPO运行，迭代的数量也增加以说明这一点(例如，对于分段需要7个额外的超参数，而对于有偏差的分段MSE有14个额外的超参数)。</em></p><h2 id="7a98" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">基于模型的目标</h2><p id="fe51" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">事实是，这里我们已经使用了一个非常简单的方法来评估预期评级，但是没有什么(几乎没有什么)阻止你使用一个复杂的ML模型来评估你的目标。比方说，你想把客户流失降到最低，而客户流失取决于配送时间误差。答对了。这是完美的婚姻，尤其是当客户流失模型已经开发出来的时候。唯一的问题可能是，整个训练变得非常慢，但是在很多应用中，这根本不是一个限制。</p><h2 id="5380" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">非凸物镜</h2><p id="c7a0" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在这个特殊的例子中，我们的主要度量评级几乎是凸的，这就是为什么即使RMSE，五分之一正在失去，差距不是那么大。例如，如果我们的交付时间经验分布看起来更像下图中的分布，分段损失的边际收益将显著增加。在<a class="ae le" href="https://github.com/pashna/gbm_custom_loss" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">链接</strong> </a>部分，你将可以找到一个笔记本，在它周围玩耍。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nx"><img src="../Images/fe695ae497a065bf16bc0bcafe81066e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*40IQ7zzpbzwfpVH8d0sf9w.png"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">取决于交付时间估计经验的平均评级示例。</p></figure><h2 id="48d5" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">结论</h2><p id="77fb" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">损失函数只受你的幻想和你的计算能力的限制，而且通常来说，实现和调整一个定制的损失函数实际上是有益的。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ny"><img src="../Images/c6d1f1a9654dcc0349a385f43f972313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EgMR6MN3yy6BF-FOtYkgWw.png"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">一览表</p></figure><p id="ddb9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">尽管这些特定的价值是合成的，但我们的生产设置以非常相似的方式工作，该模型在我们平台上的实际影响是极好的:我们已经将超过25%的订单转移到交付时间体验更好的篮子中。它不仅帮助我们更好地理解什么是重要的以及为什么重要，而且它也为我们的客户带来了很好的体验(我们知道它变得有多好！).</p><h2 id="c6cc" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated"><strong class="ak">链接</strong></h2><p id="7a8d" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">与文章相关的代码位于数据集的<a class="ae le" href="https://github.com/pashna/custom_lose_medium" rel="noopener ugc nofollow" target="_blank">中(见免责声明)。</a></p><p id="342a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，如果有人想使用任何损失函数，你可以安装这个小的<a class="ae le" href="https://github.com/pashna/gbm_custom_loss" rel="noopener ugc nofollow" target="_blank">库</a>(顺便说一句，它对任何贡献都非常开放)。</p></div></div>    
</body>
</html>