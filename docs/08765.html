<html>
<head>
<title>R and Python Plotting in Google Sheets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌工作表中的 r 和 Python 绘图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/r-and-python-plotting-in-google-sheets-255e974aed91?source=collection_archive---------38-----------------------#2020-06-24">https://towardsdatascience.com/r-and-python-plotting-in-google-sheets-255e974aed91?source=collection_archive---------38-----------------------#2020-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d6c5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用自定义 Google Sheets 函数来改进绘图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a722f06f0e4edecb741fefe2726359ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lzvdXLWl_g8BaX9L"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卢卡斯·布拉塞克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="3d1e" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">上次</h1><p id="900a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是关于在 Google Sheets 公式中使用 R 和 Python 函数的 n 部分系列的第 2 部分。如果您还没有阅读第 1 部分，<a class="ae ky" rel="noopener" target="_blank" href="/using-r-and-python-in-google-sheets-formulas-b397b302098">在 Google Sheets 公式中使用 R 和 Python</a>，我建议您去看看所有对您有用的魔法。总之，通过在 Google Cloud Run 中设置一个简单的 API 并创建 Google Apps 脚本函数来调用您的 API，您可以使用 R 和 Python 代码来支持自定义 Google Sheets 单元格公式。在初始设置之后，在任何 Google Sheet 中使用 R 和 Python 都是快速而简单的。</p><p id="54c8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以下是一些亮点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/f3c9331ae20540664c7b0d4de252752b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*m9w1_5uJxaOKoePJwz7dmw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/31cdff692c8af586c4dff93bbb57f4a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*65GVtcUtTG-jdBP8ddZU8w.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/906a917a342f2e5c1bab050fd2bd4180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DnnRPqo4OwUfv2HWxRDw2Q.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">技术上不在第 1 部分，但本着同样的精神。作者图片</p></figure><h1 id="8ea5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">在谷歌工作表中绘图(以及更多)</h1><p id="6f8a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如我之前所说的，我认为谷歌工作表是惊人的。我袖手旁观这一声明，并警告说，在谷歌工作表中绘图是非常糟糕的。它花费了最长的时间，甚至有一个合理的线性回归可用，图形选项是非常有限的。然而，现在您可以通过使用以前开发的技术，使用 R 和 Python 在 Google Sheets 中动态地创建漂亮的图形。事实上，许多生成图像文件的函数都可以在 Google Sheets 公式中使用，只需很少的额外设置。</p><p id="60c1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里有一些例子。</p><ol class=""><li id="e80f" class="mt mu it lt b lu mn lx mo ma mv me mw mi mx mm my mz na nb bi translated"><strong class="lt iu">基地 R 标绘</strong></li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/1dd652b36f3666b9dd8b227990533fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FGPJBgneVs9yAFlWmk-XkQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="38e1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">2.<strong class="lt iu"> ggplot2 绘图</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/e6fd3395ac36bed8ee692ea6d910c6a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*46q-_m14qzDu8ObwDxzF5Q.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="badf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">3.<strong class="lt iu">使用 matplotlib 进行 Python 绘图</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/b841ac4d61964ca1459a1d94c5913c53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*kjN7TAsPEyzUjwXOpeA0BQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0f2a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">4.<strong class="lt iu">k-均值聚类图</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/bc8cb42e07a4689f7c51d5365a9f32b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CPrXXkaVN4AItVbWqAJ41g.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="cb97" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">5.<strong class="lt iu">字云</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/6df90a4457f4f8ed32b2e2a1e0f57c29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vuA6580NuY048vFMm_wXAQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="9826" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">这是如何工作的？</h1><p id="77a7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Google Sheets 函数 IMAGE 将图像的 URL 作为参数，并将其显示在单元格内。基于第 1 部分中的技术，<a class="ae ky" href="https://developers.google.com/apps-script/guides/sheets/functions" rel="noopener ugc nofollow" target="_blank">自定义 Google Apps 脚本函数</a> rplot 和 pyplot 对设置在<a class="ae ky" href="https://cloud.google.com/run" rel="noopener ugc nofollow" target="_blank"> Google Cloud Run </a>上的 my /rplot 和/pyplot 端点进行 API 调用。这些 API 调用将 rscript 和 pyscript 参数作为代码运行，生成输出的 PNG，通过它们的 API 将 PNG 上传到<a class="ae ky" href="https://imgur.com/" rel="noopener ugc nofollow" target="_blank">imgur.com</a><a class="ae ky" href="https://api.imgur.com/" rel="noopener ugc nofollow" target="_blank">，并返回上传图像的 URL。</a></p><p id="c5e1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在 Google Sheets 中开始使用 rplot 或 pyplot 最简单的方法是克隆<a class="ae ky" href="https://github.com/samterfa/rpysheets" rel="noopener ugc nofollow" target="_blank">my rpyssheets GitHub repo</a>并使用<a class="ae ky" href="https://code.markedmondson.me/googleCloudRunner/index.html" rel="noopener ugc nofollow" target="_blank"> GoogleCloudRunner R 包</a>为<a class="ae ky" href="https://github.com/samterfa/rpysheets/tree/master/rsheets_plotting" rel="noopener ugc nofollow" target="_blank">RS Sheets _ plotting</a>目录和<a class="ae ky" href="https://github.com/samterfa/rpysheets/tree/master/pysheets_plotting" rel="noopener ugc nofollow" target="_blank"> pysheets_plotting </a>目录部署一个 Google Cloud Run 服务。然后将 Google Cloud Run 服务 URL 复制并粘贴到<a class="ae ky" href="https://docs.google.com/spreadsheets/d/1a2wOFlatsvrdVWg3STfICgZXYAXxc18MRhrIxSrEwb4/copy" rel="noopener ugc nofollow" target="_blank">这个 Google Sheets 模板</a>中并播放。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="bf88" class="nh la it nd b gy ni nj l nk nl">googleCloudRunner::cr_deploy_run('{LocalPath}/rsheets_plotting/')</span><span id="5af2" class="nh la it nd b gy nm nj l nk nl">googleCloudRunner::cr_deploy_run('{LocalPath}/pysheets_plotting/')</span></pre><h1 id="da4b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">细节</h1><p id="7e97" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">参数 rscript 和 pyscript 是/rplot 和/pyplot 端点的工作平台，并且每个端点都有自己的端点。rscript 参数作为字符串读入，并使用 R 的<a class="ae ky" href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/eval" rel="noopener ugc nofollow" target="_blank"> eval()函数</a>运行，而 pyscript 则混合使用 Python 的<a class="ae ky" href="https://docs.python.org/3/library/functions.html#exec" rel="noopener ugc nofollow" target="_blank"> exec() </a>和<a class="ae ky" href="https://docs.python.org/3/library/functions.html#eval" rel="noopener ugc nofollow" target="_blank"> eval() </a>函数读入并运行。我知道允许不可信的来源将代码传递给 eval()或 exec()函数是很危险的。根据您的用例，我会考虑如何修改我编写的代码来保护这些功能。</p><p id="6e16" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">传递给 rscript 和 pyscript 的每个变量都被标识并转换为具有列名、数组、向量或单个值的 dataframe。rscript 和 pyscript 可以修改这些变量，也可以访问内置值，但必须生成图像。因为 R 可以捕获 PNG 文件形式的情节，这是在幕后处理的，所以所有需要做的就是尝试一个情节。然而，据我所知，Python 并没有一种一致的方式将图形捕获到 PNG 中，pyscript 代码必须显式地将图形保存为 PNG 文件。在工作目录中找到的第一个 PNG 文件在后台被上传到 imgur.com。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="4985" class="nh la it nd b gy ni nj l nk nl"><strong class="nd iu">rplot Google Sheets Formula<br/></strong>=IMAGE(rplot("g &lt;- ggplot(data = a, mapping = aes(x,y)) + geom_point() + geom_smooth(color = 'red') + ggtitle('Sample ggplot') + theme_minimal(); plot(g)", B2:C12))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/ba66e25835b4d7f43ef04a420d542a53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EssrvblwSoyea6Gst1s10w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="06bf" class="nh la it nd b gy ni nj l nk nl"><strong class="nd iu">pyplot Google Sheets Formula<br/></strong>=IMAGE(pyplot("import matplotlib.pyplot as plt; plot = a.plot(x = 0, y = 1, kind = 'scatter', title = 'Sample Python Scatterplot'); fig = plot.get_figure(); fig.savefig('output.png')", B2:C12))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/56d93366f5f39ceea0494830ec870082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*udfLbU857inmKRi-qKnhXA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="efc1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">图像托管</strong></h1><p id="a5a6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">对于/rplot 和/pyplot，我都使用了 imgur.com 的<a class="ae ky" href="https://imgur.com/" rel="noopener ugc nofollow" target="_blank">图像托管。如果你愿意，你可以使用不同的图片托管网站，但是要使用我上面所做的，你需要一个 imgur 客户端 ID。为了获得一个账户，</a><a class="ae ky" href="https://imgur.com/register" rel="noopener ugc nofollow" target="_blank">创建一个 imgur 账户</a>，然后<a class="ae ky" href="https://api.imgur.com/oauth2/addclient" rel="noopener ugc nofollow" target="_blank">添加一个客户到你的账户</a>。一旦您有了客户端 ID，您就可以将它复制并粘贴到上面的脚本中，或者您也可以创建一个. creds 目录，其中的文件 imgur.json <strong class="lt iu"> </strong>以下面的方式定义。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="ca93" class="nh la it nd b gy ni nj l nk nl">{"clientID":"{YourImgurClientID}"}</span></pre><p id="f605" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我将我的客户机设置为授权类型“无用户授权的匿名使用”,并简单地上传公开可用的图像用于演示目的。您可以选择上传到私人相册。虽然每次更新谷歌表单上的图片都会为上传的图片生成一个唯一的 imgur URL，这是一种浪费，但每个客户每天可以上传多达 1250 张图片，这对我来说已经足够了。如果您在生产中使用它，您将希望在更新时修改图像，而不是每次上传不同的图像。请记住，如果你想用 imgur.com 赚钱，你有特殊的要求，它不是免费的。</p><h1 id="f878" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">资源</strong></h1><ol class=""><li id="d391" class="mt mu it lt b lu lv lx ly ma np me nq mi nr mm my mz na nb bi translated"><a class="ae ky" href="https://docs.google.com/spreadsheets/d/1a2wOFlatsvrdVWg3STfICgZXYAXxc18MRhrIxSrEwb4/copy" rel="noopener ugc nofollow" target="_blank">这是 Google Sheet </a>您可以简单地复制并使用为 pyscript、pyplot、rscript 和 rplot 预定义的自定义 Google Sheets 函数。所有你需要做的就是粘贴你的 R 和 Python Google Cloud 运行 URL，一旦它们被设置好。</li><li id="7e27" class="mt mu it lt b lu ns lx nt ma nu me nv mi nw mm my mz na nb bi translated"><a class="ae ky" href="https://github.com/samterfa/rpysheets" rel="noopener ugc nofollow" target="_blank">这里是我的 GitHub repo </a>上面引用的 R 和 Python 代码。</li></ol><p id="53af" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">尽情享受吧！</p></div></div>    
</body>
</html>