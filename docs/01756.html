<html>
<head>
<title>Deploying a Simple Machine Learning Model into a WebApp using TensorFlow.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 TensorFlow.js 将简单的机器学习模型部署到 WebApp 中</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-a-simple-machine-learning-model-into-a-webapp-using-tensorflow-js-3609c297fb04?source=collection_archive---------2-----------------------#2020-02-18">https://towardsdatascience.com/deploying-a-simple-machine-learning-model-into-a-webapp-using-tensorflow-js-3609c297fb04?source=collection_archive---------2-----------------------#2020-02-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ce76" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你好，今天，你要构建一个简单的 WebApp，可以识别数字。看看下面的演示。</h2></div><p id="1f65" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请在您的浏览器或手机中尝试一下:</p><p id="c763" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://carlos-aguayo.github.io/tfjs.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu"/>https://carlos-aguayo.github.io/tfjs.html</a></p><p id="076c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">TensorFlow.js 的美妙之处在于，您可以使用 Keras 或 TensorFlow 在 Python 中训练机器学习模型，并使用 TensorFlow.js 将其部署在浏览器上。无需外部服务来运行您的查询。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/e805cf63402a93133267fd1751b4fa3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*eF4oRCsFduoH3aEuHyJkKg.gif"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">数字识别 WebApp</p></figure><p id="777f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个有趣而简单的应用程序让你画一个一位数，它使用简单的机器学习工具识别它。</p><p id="d210" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想直接看的话，下面是完整的代码:</p><ul class=""><li id="acf2" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated"><a class="ae le" href="https://colab.research.google.com/gist/carlos-aguayo/e56a341190c4a252c4f66289b9228a69/mnist-on-gpu.ipynb" rel="noopener ugc nofollow" target="_blank">谷歌 Colab 笔记本生成机器学习模型</a></li><li id="bfbf" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated"><a class="ae le" href="https://github.com/carlos-aguayo/carlos-aguayo.github.io/blob/master/tfjs.html" rel="noopener ugc nofollow" target="_blank"> HTML 文件</a></li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="02ff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们开始吧；这些是构建这个演示所需的<em class="mq">成分</em>和<em class="mq">步骤</em>。</p><p id="6128" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">配料和步骤:</p><ul class=""><li id="2801" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated">培训用数据</li><li id="a2b1" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">培训环境</li><li id="2713" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">预处理数据</li><li id="f0b2" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">机器学习</li><li id="63b4" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">将 Keras 模型转换为 Tensorflow.js</li><li id="fab8" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">HTML5 画布</li><li id="0ab2" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">把一切都连接起来</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="f28e" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">培训用数据</h1><p id="eb34" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">任何机器学习模型都需要高质量的数据。我们将使用<a class="ae le" href="https://en.wikipedia.org/wiki/MNIST_database" rel="noopener ugc nofollow" target="_blank"> MNIST 数据集</a>，这是一个手写数字的数据集。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/e7620493a3de60425cfd89c7d99be1f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*Ft2rLuO82eItlvJn5HOi9A.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">约瑟夫·斯泰潘[ <a class="ae le" href="https://creativecommons.org/licenses/by-sa/4.0" rel="noopener ugc nofollow" target="_blank"> CC BY-SA </a></p></figure><p id="b19d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个数据集中，有 60，000 幅图像，所有图像的灰度都是 28 x 28 像素，像素值从 0 到 255。</p><p id="b72b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有关加载和查看 MNIST 数据集的信息，请参见下面的代码片段。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="f5bd" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated"><strong class="ak">培训环境</strong></h1><p id="e84e" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated"><a class="ae le" href="https://colab.research.google.com/notebooks/intro.ipynb" rel="noopener ugc nofollow" target="_blank"> Google Colab </a>允许你在浏览器中编写和执行 Python。</p><p id="a061" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Colab 是一个非常方便的<a class="ae le" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter Notebook </a> Python 平台，预装了您需要的大部分 Python 机器学习库，这是一种让您快速启动并运行 ML 项目的便捷方法。</p><p id="9f37" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，它让您可以免费访问 GPU/CPU。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="2108" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated"><strong class="ak">数据预处理</strong></h1><p id="b69e" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">来自 MNIST 的数据需要进行一个小的预处理:</p><ol class=""><li id="fc5d" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld nr mb mc md bi translated">规范化输入:数据带有从 0 到 255 的值，我们应该将它们规范化为从 0 到 1 的范围。</li><li id="e5af" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld nr mb mc md bi translated"><a class="ae le" href="https://en.wikipedia.org/wiki/One-hot" rel="noopener ugc nofollow" target="_blank">一键编码</a>输出。</li></ol><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="4907" class="nx ms it nt b gy ny nz l oa ob"># Normalize Inputs from 0–255 to 0–1</span><span id="09a4" class="nx ms it nt b gy oc nz l oa ob"><strong class="nt iu">x_train = x_train / 255</strong></span><span id="07dc" class="nx ms it nt b gy oc nz l oa ob"><strong class="nt iu">x_test = x_test / 255</strong></span><span id="3dc6" class="nx ms it nt b gy oc nz l oa ob"># One-Hot Encode outputs</span><span id="d8eb" class="nx ms it nt b gy oc nz l oa ob"><strong class="nt iu">y_train = np_utils.to_categorical(y_train)</strong></span><span id="03a7" class="nx ms it nt b gy oc nz l oa ob"><strong class="nt iu">y_test = np_utils.to_categorical(y_test)</strong></span><span id="a7d1" class="nx ms it nt b gy oc nz l oa ob">num_classes = 10</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="1271" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">机器学习</h1><p id="b458" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">我们终于准备好做一些机器学习了。我们可以从一个非常简单的模型开始。我们将使用一个简单的<em class="mq">神经网络</em>，只有一个隐藏层。这个简单的模型足以获得 98%的准确率。</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="260a" class="nx ms it nt b gy ny nz l oa ob">x_train_simple = x_train.reshape(60000, 28 * 28).astype(‘float32’)</span><span id="8927" class="nx ms it nt b gy oc nz l oa ob">x_test_simple = x_test.reshape(10000, 28 * 28).astype(‘float32’)</span><span id="f058" class="nx ms it nt b gy oc nz l oa ob">model = Sequential()</span><span id="7b33" class="nx ms it nt b gy oc nz l oa ob"><strong class="nt iu">model.add(Dense(28 * 28, input_dim=28 * 28, activation=’relu’))</strong></span><span id="9456" class="nx ms it nt b gy oc nz l oa ob"><strong class="nt iu">model.add(Dense(num_classes, activation=’softmax’))</strong></span><span id="ba17" class="nx ms it nt b gy oc nz l oa ob">model.compile(loss=’categorical_crossentropy’, optimizer=’adam’, metrics=[‘accuracy’])</span><span id="5993" class="nx ms it nt b gy oc nz l oa ob">model.fit(x_train_simple, y_train, validation_data=(x_test_simple, y_test), epochs=30, batch_size=200, verbose=2)</span></pre><p id="9bb2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想变得花哨，你可以尝试一个<em class="mq">深度学习模型</em>。有了它，你可以把准确率提高到 99%。</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="32c5" class="nx ms it nt b gy ny nz l oa ob">x_train_deep_model = x_train.reshape((60000, 28, 28, 1)).astype(‘float32’)</span><span id="f287" class="nx ms it nt b gy oc nz l oa ob">x_test_deep_model = x_test.reshape((10000, 28, 28, 1)).astype(‘float32’)</span><span id="aa99" class="nx ms it nt b gy oc nz l oa ob">deep_model = Sequential()</span><span id="4775" class="nx ms it nt b gy oc nz l oa ob"><strong class="nt iu">deep_model.add(Conv2D(30, (5, 5), input_shape=(28, 28, 1), activation=’relu’))</strong></span><span id="737b" class="nx ms it nt b gy oc nz l oa ob"><strong class="nt iu">deep_model.add(MaxPooling2D())</strong></span><span id="6164" class="nx ms it nt b gy oc nz l oa ob"><strong class="nt iu">deep_model.add(Conv2D(15, (3, 3), activation=’relu’))</strong></span><span id="6a68" class="nx ms it nt b gy oc nz l oa ob"><strong class="nt iu">deep_model.add(MaxPooling2D())</strong></span><span id="0dad" class="nx ms it nt b gy oc nz l oa ob"><strong class="nt iu">deep_model.add(Dropout(0.2))</strong></span><span id="7cb2" class="nx ms it nt b gy oc nz l oa ob">deep_model.add(Flatten())</span><span id="dae5" class="nx ms it nt b gy oc nz l oa ob">deep_model.add(Dense(128, activation=’relu’))</span><span id="d936" class="nx ms it nt b gy oc nz l oa ob">deep_model.add(Dense(50, activation=’relu’))</span><span id="09da" class="nx ms it nt b gy oc nz l oa ob">deep_model.add(Dense(num_classes, activation=’softmax’))</span><span id="2171" class="nx ms it nt b gy oc nz l oa ob">deep_model.compile(loss=’categorical_crossentropy’, optimizer=’adam’, metrics=[‘accuracy’])</span><span id="1886" class="nx ms it nt b gy oc nz l oa ob">deep_model.fit(x_train_deep_model, y_train, validation_data=(x_test_deep_model, y_test), epochs=30, batch_size=200, verbose=2)</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="67ef" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated"><strong class="ak">将 Keras 模型转换为 Tensorflow.js </strong></h1><p id="8ca7" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">现在我们有了一个训练好的模型，我们需要转换它，以便可以在 TensorFlow.js 中使用它。</p><p id="624f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们需要将模型保存到 HDF5 模型中。</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="2a9f" class="nx ms it nt b gy ny nz l oa ob">model.save(“model.h5”)</span></pre><p id="359e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">之后，您可以通过点击左侧导航中的文件夹图标来访问保存的文件。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi od"><img src="../Images/64d37d648dfa27c4fbd2abd512aa9cf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_vJYyfDU3O9wddu0p3AfpQ.png"/></div></div></figure><p id="fd6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有几种方法可以转换模型。笔记本中的一个简单例子是这样的:</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="103c" class="nx ms it nt b gy ny nz l oa ob">!pip install tensorflowjs</span><span id="5907" class="nx ms it nt b gy oc nz l oa ob">!tensorflowjs_converter --input_format keras ‘/content/model.h5’ ‘/content/model’</span></pre><p id="c52e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">/content/model.h5 是输入，输出保存在/content/model 文件夹中。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oe"><img src="../Images/a45a060104aa2974b482ca1efe6b8b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aWpOEdhY2XNk1v3xoojGyw.png"/></div></div></figure><p id="8251" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">TensorFlow.js 需要指向 JSON 文件(<em class="mq"> model.json </em>)，需要一个名为“<em class="mq"> group1-shard1of1.bin </em>”的兄弟文件。你需要这两份文件。下载这两个文件。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ea6d" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated"><strong class="ak"> HTML5 画布</strong></h1><p id="e668" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">让我们有一个简单的<a class="ae le" href="https://github.com/carlos-aguayo/carlos-aguayo.github.io/blob/master/tfjs.html" rel="noopener ugc nofollow" target="_blank"> HTML 页面</a>，它使用 HTML5 Canvas 组件让我们在上面绘图。姑且称这个文件为“<em class="mq">tfjs.html</em>”。</p><p id="1c99" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">核心绘图代码来自<a class="ae le" href="https://www.html5canvastutorials.com/labs/html5-canvas-paint-application/" rel="noopener ugc nofollow" target="_blank">本网站</a>:</p><p id="9e18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用 HTML5 Canvas 组件，我们可以将鼠标事件挂钩到画布中。</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="601b" class="nx ms it nt b gy ny nz l oa ob">canvas.addEventListener('mousedown', function(e) {<br/>  context.moveTo(mouse.x, mouse.y);<br/>  context.beginPath();<br/>  canvas.addEventListener('mousemove', onPaint, false);<br/>}, false);</span><span id="01e7" class="nx ms it nt b gy oc nz l oa ob">var onPaint = function() {<br/>  context.lineTo(mouse.x, mouse.y);<br/>  context.stroke();<br/>};</span></pre><p id="acd3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们添加触摸事件，使其在移动设备上工作。</p><p id="ebea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">添加触摸动作以禁用滚动。这个代码的灵感来自于这个网站。</p><p id="9764" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们可以绘制，让我们在鼠标抬起时获取图像。我们将把它缩小到 28 乘 28 像素，以便它与训练好的模型相匹配。</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="5936" class="nx ms it nt b gy ny nz l oa ob">canvas.addEventListener('<strong class="nt iu">mouseup</strong>', function() {<br/>  $('#number').html('&lt;img id="spinner" src="spinner.gif"/&gt;');<br/>  canvas.removeEventListener('mousemove', onPaint, false);<br/><strong class="nt iu">  var img = new Image();<br/>  img.onload = function() {<br/>    context.drawImage(img, 0, 0, 28, 28);<br/>    </strong>data = context.getImageData(0, 0, 28, 28).data;<strong class="nt iu"><br/></strong>    var input = [];<br/>    for(var i = 0; i &lt; data.length; i += 4) {<br/>      input.push(data[i + 2] / 255);<br/>    }<br/>    predict(input);<br/><strong class="nt iu">  };<br/>  img.src = canvas.toDataURL('image/png');<br/></strong>}, false);</span></pre><p id="cbac" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们获取数据，将它保存在一个“输入”数组中，并将其传递给一个预测函数，我们将在后面定义该函数。</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="6d67" class="nx ms it nt b gy ny nz l oa ob">canvas.addEventListener('mouseup', function() {<br/>  $('#number').html('&lt;img id="spinner" src="spinner.gif"/&gt;');<br/>  canvas.removeEventListener('mousemove', onPaint, false);<br/>  var img = new Image();<br/>  img.onload = function() {<br/>    context.drawImage(img, 0, 0, 28, 28);<br/><strong class="nt iu">    data = context.getImageData(0, 0, 28, 28).data;<br/>    var input = [];<br/>    for(var i = 0; i &lt; data.length; i += 4) {<br/>      input.push(data[i + 2] / 255);<br/>    }<br/>    predict(input);<br/></strong>  };<br/>  img.src = canvas.toDataURL('image/png');<br/>}, false);</span></pre><p id="84ce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mq">数据</em>是一个 1D 数组，其值为<a class="ae le" href="https://en.wikipedia.org/wiki/RGBA_color_model" rel="noopener ugc nofollow" target="_blank"> RGBA 值</a>。我们的模型只取 0 到 1 的值(或者从 255 的灰度中取 0)。假设我们正在画布上绘制 B lue，我们可以将数组分成四块，每隔一个元素取一个。</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="5381" class="nx ms it nt b gy ny nz l oa ob">RG<strong class="nt iu">B</strong>ARG<strong class="nt iu">B</strong>ARG<strong class="nt iu">...</strong><br/>01<strong class="nt iu">2</strong>345<strong class="nt iu">6</strong>789...</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="3ac1" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated"><strong class="ak">把所有东西都挂起来</strong></h1><p id="187d" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">最后，让我们加载 TensorFlow.js 并运行预测。</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="2545" class="nx ms it nt b gy ny nz l oa ob">&lt;script src=”https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.5.2/dist/tf.min.js"&gt;&lt;/script&gt;</span></pre><p id="7bce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你应该已经下载了文件<em class="mq"> model.json </em>和<em class="mq"> group1-shard1of1.bin </em>，并将它们保存到一个名为<em class="mq"> model </em>的文件夹中，这个文件夹与你保存 HTML 文件的文件夹相同。</p><p id="b4de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">加载后，我们可以通过简单地执行以下操作来加载训练好的模型:</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="a855" class="nx ms it nt b gy ny nz l oa ob"><strong class="nt iu">tf.loadLayersModel</strong>(‘<strong class="nt iu">model/model.json</strong>’).then(function(model) {<br/> window.model = model;<br/>});</span></pre><p id="a457" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">鼠标一放，一旦我们有了数据，我们就可以把它输入到模型中:</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="2606" class="nx ms it nt b gy ny nz l oa ob"><strong class="nt iu">window.model.predict</strong>([tf.tensor(<strong class="nt iu">input</strong>).reshape([1, 28, 28, 1])]).array().then(function(scores){<br/>  scores = scores[0];<br/>  predicted = scores.indexOf(Math.max(...scores));<br/>  $('#number').html(predicted);<br/>});</span></pre><p id="2f25" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本地测试很简单，并且可以很容易地设置一个 HTTP 服务器来用 Python 进行测试:</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="05f6" class="nx ms it nt b gy ny nz l oa ob">python3 -m http.server 8080</span></pre><p id="8dc5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想用手机测试，你可以利用这个叫做<a class="ae le" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> ngrok </a>的漂亮工具。</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="7ca1" class="nx ms it nt b gy ny nz l oa ob">$ ngrok http 8080</span></pre><p id="81da" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就打开了一个可以通过手机访问的 URL 的通道。</p><p id="8724" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦你对结果感到满意，你就可以将你的 HTML 部署到一个虚拟主机站点。一个简单的地方就是 Github。如果你从未用 Github 创建过静态网站，你需要创建一个名为“{username}.github.io”的资源库。例如，我的存储库是:</p><p id="4b18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://github.com/carlos-aguayo/carlos-aguayo.github.io" rel="noopener ugc nofollow" target="_blank">https://github.com/carlos-aguayo/carlos-aguayo.github.io</a></p><p id="149e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，您可以通过以下方式访问它:</p><p id="856d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://carlos-aguayo.github.io/tfjs.html" rel="noopener ugc nofollow" target="_blank">https://carlos-aguayo.github.io/tfjs.html</a></p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="f645" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated"><strong class="ak">结论</strong></h1><p id="df4a" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">请注意，我们可以多么轻松地在 Google Colab 中训练模型，导出训练好的模型，并在 JavaScript 中查询它，而无需离开浏览器！</p><p id="f4a0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我是<a class="ae le" href="https://www.appian.com/" rel="noopener ugc nofollow" target="_blank"> Appian </a>的<a class="ae le" href="https://www.linkedin.com/in/carlosaguayo" rel="noopener ugc nofollow" target="_blank">软件开发总监兼机器学习工程师</a>。我在 Appian 工作了 15 年，我一直很开心。如果你想知道我们是如何制作软件的，请给我发消息，让我们的客户开心！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi of"><img src="../Images/a00fee7962778ec2420807be61ad5c2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IWIarGJdlI-tF8MKr2wP9A.png"/></div></div></figure></div></div>    
</body>
</html>