<html>
<head>
<title>Time Series Analysis: Resampling, Shifting and Rolling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列分析:重采样、移位和滚动</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-analysis-resampling-shifting-and-rolling-f5664ddef77e?source=collection_archive---------3-----------------------#2020-04-14">https://towardsdatascience.com/time-series-analysis-resampling-shifting-and-rolling-f5664ddef77e?source=collection_archive---------3-----------------------#2020-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="82db" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何重新组织时间序列数据</h2></div><p id="5046" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">时间序列数据有许多定义，所有这些定义都以不同的方式表示相同的含义。一个直截了当的定义是，时间序列数据包括附加到连续时间戳的数据点。时间序列数据的来源是周期性的测量或观察。我们观察很多行业的时间序列数据。仅举几个例子:</p><ul class=""><li id="f9c7" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">一段时间内的股票价格</li><li id="2859" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">每日、每周、每月销售额</li><li id="bbab" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">过程中的定期测量</li><li id="73b8" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">一段时间内的电力或天然气消耗率</li></ul><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi ls"><img src="../Images/94a17425f6c7c0711349dd5fd1cea1c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bnc6XQfNbXR6QIX3tNVK8g.jpeg"/></div></div><p class="me mf gj gh gi mg mh bd b be z dk translated">克里斯·利维拉尼在<a class="ae mi" href="https://unsplash.com/s/photos/stock-price?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="d420" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">机器学习的进步增加了时间序列数据的价值。公司将机器学习应用于时间序列数据，以做出明智的商业决策，进行预测，比较季节性或周期性趋势。欧洲粒子物理研究所的大型强子对撞机(LHC)通过对亚原子粒子的测量产生了大量的时间序列数据。所以，它无处不在。处理好时间序列数据对于这类领域的数据分析过程至关重要。Pandas 是由 Wes Mckinney 创建的，旨在提供一个高效灵活的工具来处理财务数据。因此，对时间序列数据进行处理是一个非常好的选择。</p><p id="ee80" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将介绍三种非常有用的操作，它们可以对时间序列数据进行操作。</p><ul class=""><li id="adcc" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">重采样</li><li id="2d15" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">改变</li><li id="7d94" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">旋转</li></ul><p id="0214" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们先导入数据。我将使用 Kaggle 上的<a class="ae mi" href="https://www.kaggle.com/jessevent/all-crypto-currencies" rel="noopener ugc nofollow" target="_blank">加密货币数据集</a>。</p><p id="bafe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">和往常一样，我们从导入我们需要的库开始:</p><pre class="lt lu lv lw gt mj mk ml mm aw mn bi"><span id="5bc7" class="mo mp it mk b gy mq mr l ms mt">import numpy as np<br/>import pandas as pd</span><span id="2755" class="mo mp it mk b gy mu mr l ms mt">import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>sns.set_style("darkgrid")<br/>%matplotlib inline</span></pre><p id="301f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个巨大的数据集，但我将只使用莱特币的开盘价，这足以证明如何重采样，移动和滚动窗口的工作。</p><pre class="lt lu lv lw gt mj mk ml mm aw mn bi"><span id="64a6" class="mo mp it mk b gy mq mr l ms mt">df = pd.read_csv("crypto-markets.csv", parse_dates=["date"], index_col="date")</span><span id="79cc" class="mo mp it mk b gy mu mr l ms mt">df = df[df.slug == "litecoin"][["open"]]</span><span id="553f" class="mo mp it mk b gy mu mr l ms mt">df.shape<br/>(2042,1)</span><span id="3526" class="mo mp it mk b gy mu mr l ms mt">df.head()</span></pre><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/08febd8249925422b77db28e3bc3420c.png" data-original-src="https://miro.medium.com/v2/resize:fit:248/format:webp/1*OxgDQoProgKpaFsjO3zQlg.png"/></div></figure><p id="d693" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在处理时间序列数据时，最好使用日期作为数据帧的索引。</p><h1 id="a86a" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated"><strong class="ak">重采样</strong></h1><p id="0991" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">重采样基本上意味着用不同的频率表示数据。假设我们有一个每分钟都进行测量的温度传感器。如果我们不需要分钟级的精度，我们可以取一小时内 60 分钟测量值的平均值，并显示每小时的温度变化。这是下采样，意味着转换到较低的频率。</p><p id="5145" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以使用<strong class="kk iu"> resample() </strong>或<strong class="kk iu"> asfreq() </strong>函数进行重采样。</p><ul class=""><li id="00d5" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated"><strong class="kk iu">重采样</strong>:根据指定的频率和聚合函数聚合数据。</li><li id="b050" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><strong class="kk iu"> Asfreq </strong>:根据指定的频率选择数据，并在指定的间隔结束时返回值。</li></ul><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/f824a2f68b870ec23dfd299d86b595f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*60Xzg45SRqJhFueqtOlQ8Q.png"/></div></figure><p id="1fd9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看它在真实数据集上的样子。</p><pre class="lt lu lv lw gt mj mk ml mm aw mn bi"><span id="b7f6" class="mo mp it mk b gy mq mr l ms mt">fig, ax = plt.subplots(3, sharex=True)</span><span id="d3ca" class="mo mp it mk b gy mu mr l ms mt">df[-500:].plot(figsize=(12,8), ax=ax[0], title="Original Data",<br/>legend=False)</span><span id="a663" class="mo mp it mk b gy mu mr l ms mt">df[-500:].resample('10D').mean().plot(figsize=(12,8), ax=ax[1], <br/>title="Down-sampled to 10-day periods",legend=False)</span><span id="1dd7" class="mo mp it mk b gy mu mr l ms mt">df[-500:].resample('30D').mean().plot(figsize=(12,8), ax=ax[2],<br/>title="Down-sampled to 30-day periods",legend=False)</span></pre><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi nt"><img src="../Images/a23bf0c1c42fa9409a1514ee96e63f42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y_6Ffz_JeXWTjDitbnUjYQ.png"/></div></div><p class="me mf gj gh gi mg mh bd b be z dk translated">带重采样的下采样()</p></figure><p id="346f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见，随着频率的增加，下采样使数据更加平滑。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi nt"><img src="../Images/b7599d3368579c48adaab0b72cbfa2d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tgtmTtBUlqkfOIHIrA7nQw.png"/></div></div><p class="me mf gj gh gi mg mh bd b be z dk translated">使用 asfreq()进行下采样</p></figure><p id="3775" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> Asfreq </strong>选择指定间隔结束时的值，as <strong class="kk iu">重采样</strong>聚合(通常是平均值)指定间隔内的值。</p><p id="8c60" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">顾名思义，上采样是下采样的反义词。频率增加了。当我们增加频率时，会有一些数据丢失。</p><p id="9219" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以将这些缺失值留空(缺失),或者选择一种方法来填充这些缺失值，如向前填充或向后填充。</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="f580" class="mw mp it bd mx my ob na nb nc oc ne nf jz od ka nh kc oe kd nj kf of kg nl nm bi translated"><strong class="ak">换挡</strong></h1><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi og"><img src="../Images/d988aa926f1ad4efab271f6096a99a0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BP3bAHaaUtw7iyhM8W9BsQ.jpeg"/></div></div><p class="me mf gj gh gi mg mh bd b be z dk translated">由<a class="ae mi" href="https://unsplash.com/@candelarms?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> LumenSoft Technologies </a>在<a class="ae mi" href="https://unsplash.com/s/photos/watches?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3d8b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">时间序列数据分析可能需要移动数据点来进行比较。<strong class="kk iu">移位</strong>和<strong class="kk iu">t 移位</strong>功能及时移位数据。</p><ul class=""><li id="1697" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">移位:移位数据</li><li id="e873" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">tshift:移动时间索引</li></ul><p id="1136" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">shift 和 tshift 之间的区别可以用可视化来更好地解释。让我们从数据集中抽取一个样本并应用移位:</p><pre class="lt lu lv lw gt mj mk ml mm aw mn bi"><span id="be41" class="mo mp it mk b gy mq mr l ms mt">data = df.iloc[:20,:]</span></pre><p id="3098" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在可以绘制原始数据和移位版本:</p><pre class="lt lu lv lw gt mj mk ml mm aw mn bi"><span id="6ea4" class="mo mp it mk b gy mq mr l ms mt">fig, ax = plt.subplots(nrows=3, figsize=(10,6), sharey=True)<br/>fig.tight_layout(pad=2)</span><span id="67e9" class="mo mp it mk b gy mu mr l ms mt">data.plot(ax=ax[0], title="Original Data", legend=None)<br/>data.shift(5).plot(ax=ax[1], title="Shifting Data", legend=None)<br/>data.tshift(5).plot(ax=ax[2], title="Shifting Index", legend=None)</span></pre><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/3ecfc880f7d94c91666d11cad64b6953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*zc77BZ3ZC2g9CZxEyrJUzg.png"/></div></figure><p id="3e1b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据任务的不同，我们可以移动数据点或索引。</p><blockquote class="oi oj ok"><p id="717f" class="ki kj ol kk b kl km ju kn ko kp jx kq om ks kt ku on kw kx ky oo la lb lc ld im bi translated"><strong class="kk iu">matplotlib 的 tight_layout </strong>函数允许使用<strong class="kk iu"> pad </strong>参数调整子情节之间的间隙。</p></blockquote></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="95fe" class="mw mp it bd mx my ob na nb nc oc ne nf jz od ka nh kc oe kd nj kf of kg nl nm bi translated"><strong class="ak">滚动</strong></h1><p id="b90c" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">滚动是对时间序列数据非常有用的操作。滚动意味着创建一个指定大小的滚动窗口，并对该窗口中的数据执行计算，当然，该窗口会滚动数据。下图解释了滚动的概念。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi op"><img src="../Images/5a03dc2c30dda788d86a8c30e0c1b9e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*jqix0WWK_zDf5iIICpMVjw.png"/></div></figure><p id="f86f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">值得注意的是，计算是在整个窗口都在数据中时开始的。换句话说，如果窗口的大小为三，则第一次聚合在第三行完成。让我们将大小为 5 的滚动应用于我们在上一部分中创建的示例数据帧:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/03903450a189ac4fb21f8ccbad8bc93e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*9U9EUqr0E-J_2cGajkWuSw.png"/></div></figure><p id="3c95" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">滚动后 2013 年 5 月 2 日的值是原始数据中前 5 个值的平均值。2013–05–03 上的值是原始数据中第二到第六个值的平均值，依此类推。</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><p id="fbbf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">时间序列数据是预测分析旨在解决的许多问题的核心。因此，如果你打算在预测分析领域工作，你肯定应该学习如何处理好时间序列数据。</p><p id="62a9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>