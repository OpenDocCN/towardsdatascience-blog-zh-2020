<html>
<head>
<title>Mastering Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">驾驭熊猫</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mastering-pandas-4e0018c9658f?source=collection_archive---------25-----------------------#2020-02-06">https://towardsdatascience.com/mastering-pandas-4e0018c9658f?source=collection_archive---------25-----------------------#2020-02-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a69b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">熊猫的数据操作</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fc0b37d7d46f2d4871a20d903242f6a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJXlf6vOCf7_iHCxsHcirg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/photo/adult-apple-device-business-code-340152/" rel="noopener ugc nofollow" target="_blank">像素</a>上的<a class="ae ky" href="https://www.pexels.com/@hiteshchoudhary" rel="noopener ugc nofollow" target="_blank"> Hitesh Choudhary </a>拍摄</p></figure><p id="d183" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas 是一个流行的 python 库，用于数据操作和分析。它支持多种数据格式的各种读取功能。它还提供了各种数据操作工具，如合并、连接和连接。在本帖中，我们将重点介绍如何使用 pandas 的计算工具进行统计分析、开窗和生成滚动统计数据。熊猫的文档可以在<a class="ae ky" href="https://pandas.pydata.org/docs/user_guide/index.html#user-guide" rel="noopener ugc nofollow" target="_blank">这里</a>找到，熊猫计算工具的文档可以在<a class="ae ky" href="https://pandas.pydata.org/docs/user_guide/computation.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="d8fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><p id="6923" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用“TSLA”和“AAPL”的历史股票价格(过去 5 年的数据)在熊猫身上演示这些方法。“TSLA”的数据可以在这里<a class="ae ky" href="https://finance.yahoo.com/quote/TSLA/history?p=TSLA" rel="noopener ugc nofollow" target="_blank">找到</a>，而“AAPL”的数据可以在这里找到<a class="ae ky" href="https://finance.yahoo.com/quote/AAPL/history?p=AAPL" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="f308" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们使用 pandas 导入数据:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5416" class="ma mb it lw b gy mc md l me mf">import pandas as pd <br/>pd.set_option('display.max_columns', None)<br/>pd.set_option('display.max_rows', None)</span><span id="0305" class="ma mb it lw b gy mg md l me mf">df_TSLA = pd.read_csv("TSLA.csv")</span></pre><p id="6cd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们打印前五行:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0def" class="ma mb it lw b gy mc md l me mf">print(df_TSLA.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/d1e326866f4d47f72de022bf5ab9c439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*9ecmLcII7KiAFwmzKSmRWw.png"/></div></figure><p id="be7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以做的第一件事是使用“pct_change”方法，该方法可用于熊猫系列和数据帧。让我们在“开放”栏中尝试一下:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4c1b" class="ma mb it lw b gy mc md l me mf">print(df_TSLA[‘Open’].pct_change().head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/9eb67a7fde20f8b0e73357c680f50577.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*2RZhMcG-chWJJ4dI-d_z0g.png"/></div></figure><p id="fdd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以对“打开”、“高”、“低”和“关闭”进行同样的操作:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0b6f" class="ma mb it lw b gy mc md l me mf">print(df_TSLA[["Open", "High", "Low", "Close"]].pct_change().head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/4cd5e1350fdfb67fed76a9368b25693b.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*DfC8o7b0zdsp7kNT54RfdQ.png"/></div></div></figure><p id="f03e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以在“pct_change”方法中指定一个期间。例如，如果我们想计算每列每 3 条记录的百分比变化:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="268c" class="ma mb it lw b gy mc md l me mf">print(df_TSLA[["Open", "High", "Low", "Close"]].pct_change(periods = 3).head(6))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/f53c68c93be9dc17d74568adddf07e91.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*V8C8NMYchmpZC-gB9EFY2A.png"/></div></figure><p id="0b49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以计算列之间的协方差。让我们计算“TSLA”价格和“AAPL”价格之间的协方差。首先，让我们读入‘AAPL’的数据:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5743" class="ma mb it lw b gy mc md l me mf">df_AAPL = pd.read_csv("AAPL.csv")</span></pre><p id="4034" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们指定两个系列，一个是“TSLA”公开价格，另一个是“AAPL”公开价格:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3b6b" class="ma mb it lw b gy mc md l me mf">Series_TSLA = df_TSLA['Open']<br/>Series_AAPL = df_AAPL['Open']</span></pre><p id="0f37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们打印协方差:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="15f4" class="ma mb it lw b gy mc md l me mf">print("Covariance Between TSLA and AAPL:", Series_TSLA.cov(Series_AAPL))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/b524b0f5293cad1b942a2469add7e8fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*MvO1RT4UX9Sn9EfAoENcHg.png"/></div></figure><p id="a41b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以计算数据框中系列之间的成对协方差。对于“TSLA”，我们得到:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4097" class="ma mb it lw b gy mc md l me mf">print(df_TSLA.cov().head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/cf0fa593ffa84c2b55520e357a8a38ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*GufWtJ9hyrPwLofiUJN6UA.png"/></div></figure><p id="3c0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于“AAPL”:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7aee" class="ma mb it lw b gy mc md l me mf">print(df_AAPL.cov().head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/6939d0c648a17ad5111f1cc75f0ff347.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*kNZaALsCAai9HilU08hO0w.png"/></div></figure><p id="2f51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以对相关性做同样的事情:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="01b6" class="ma mb it lw b gy mc md l me mf">print("Correlation Between TSLA and AAPL:", Series_TSLA.corr(Series_AAPL))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/7d397a5e67bbceb15df8c2bc02c92150.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*RN5HWitO-RoEXgtaJcW4KQ.png"/></div></figure><p id="5b92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于“TSLA”数据帧内的系列的成对相关:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="20b4" class="ma mb it lw b gy mc md l me mf">print(df_TSLA.corr().head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/3d2b6a9f3956ea6809622a01f1caeac1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*xQB6kLhtlI3jiMJNfr_IDw.png"/></div></figure><p id="7121" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于“AAPL”:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5846" class="ma mb it lw b gy mc md l me mf">print(df_AAPL.corr().head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/4b94f336cd81e804980e85f009339e4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*pFEBUP2j4IniWhDGj08ZdA.png"/></div></figure><p id="e5e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">pandas 中提供了几种计算窗口和滚动统计的方法。这包括总和、平均值、中间值、相关性等等。我们将在下面演示其中的一些。</p><p id="f5bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们计算未平仓“AAPL”价格的累计总和:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c473" class="ma mb it lw b gy mc md l me mf">print(df_AAPL['Open'].cumsum().head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/ab567651125594fcfa4df84d9c7aaa3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*T5LPKU0YVMWAXLKyb3-mwg.png"/></div></figure><p id="2a78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以用我们选择的窗口大小来计算滚动平均值。让我们计算窗口大小为 10 的“AAPL”的滚动平均开盘价:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9ccf" class="ma mb it lw b gy mc md l me mf">print(df_AAPL['Open'].rolling(window = 10).mean().head(20))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/c6adf5c09bc7620b3f7f2940c290501b.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*9nNtb5Sc7zhDJJBB54lZrg.png"/></div></figure><p id="989d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以将这些结果可视化。首先，让我们将日期转换为日期-时间对象，将日期-时间设置为数据框索引，并选择“打开”列:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8e04" class="ma mb it lw b gy mc md l me mf">df_AAPL = df_AAPL[['Date', 'Open']]<br/>df_AAPL['Date'] = pd.to_datetime(df_AAPL['Date'])<br/>df_AAPL.set_index('Date', inplace = True)<br/>df_AAPL = df_AAPL['Open']</span></pre><p id="4d42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们使用 matplotlib 和 seaborn 绘图:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3e06" class="ma mb it lw b gy mc md l me mf">import seaborn as sns<br/>import matplotlib.pyplot as plt</span><span id="5a26" class="ma mb it lw b gy mg md l me mf">sns.set()<br/>plt.xlabel('Date')<br/>plt.ylabel('Price')<br/>df_AAPL.plot(style = 'k--')</span><span id="58f0" class="ma mb it lw b gy mg md l me mf">df_AAPL.rolling(window = 10).mean().plot(style = 'k')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/289feb86f078cb9f1236ca2c90615dba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HN3R9kKgqvf30pxVsOrz1g.png"/></div></div></figure><p id="39f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我就说到这里，但是你可以随意使用我在这篇文章中提到的一些方法。尝试寻找额外的数据集，这些方法可以提供对数据趋势的有用见解。我也鼓励你探索 pandas 中的一些额外的计算工具，比如自定义函数应用、时间感知窗口、聚合等等。</p><p id="7ee4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">概括地说，在这篇文章中，我讨论了 python pandas 库中可用的一些计算工具。我讲述了如何生成汇总统计数据，如熊猫系列之间的协方差和相关性，以及如何生成滚动统计数据，如累积和及滚动平均值。我希望这篇文章对你有用。这篇文章的代码可以在 GitHub 上找到。感谢您的阅读！</p></div></div>    
</body>
</html>