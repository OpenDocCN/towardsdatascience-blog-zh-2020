<html>
<head>
<title>Build your own open dashboard to keep track of COVID-19</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建您自己的开放式仪表板来跟踪新冠肺炎</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-your-own-open-dashboard-to-keep-track-of-covid-19-f2b09e817320?source=collection_archive---------52-----------------------#2020-05-03">https://towardsdatascience.com/build-your-own-open-dashboard-to-keep-track-of-covid-19-f2b09e817320?source=collection_archive---------52-----------------------#2020-05-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="96a2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">跟踪对您自己的RaspberryPi有影响的派生指标</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/900924f34241b4eef5686e01089facc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JCSf2U19VyjbSywDqjr8CA.png"/></div></div></figure><p id="4754" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们生活在一个相对前所未有的时代，因为今天活着的人(除了1918年左右的少数人)没有一个在他们生活的任何时候经历过疫情。这意味着，与任何其他情况相比，我们更有理由收集尽可能多的数据，以便做出更明智的决策。其中一部分是通过密切监测新病例、死亡和康复的数量，以及许多重要的指标(病毒扩散率、增长率、死亡率、达到ICU满负荷前的估计天数等)。)可以从那些数字中推断出来。</p><p id="6922" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">自从疫情开始以来，我已经看到世界各地的工程师和数据科学家做出了令人印象深刻的努力，提供可以帮助解决问题的工具。从<a class="ae lq" href="https://cults3d.com/en/collections/useful-3d-printed-coronavirus-covid19-tool" rel="noopener ugc nofollow" target="_blank"> 3D打印的面罩</a>，到<a class="ae lq" href="https://www.hackster.io/news/an-open-source-ventilator-powered-by-raspberry-pi-and-arduino-goes-into-testing-in-colombia-6c3f04b1ca94" rel="noopener ugc nofollow" target="_blank"> RaspberryPi+Arduino驱动的呼吸机</a>，到构建快速管道来处理大量基因组数据或<a class="ae lq" href="https://foldingathome.org/" rel="noopener ugc nofollow" target="_blank">计算病毒‘蛋白质’的结构</a>，到构建API和仪表板来帮助共享数据，在疫情期间，各种类型的工程师都面临着大量挑战。</p><p id="7e86" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我将尝试再写几篇关于工程师和数据科学家如何在此时积极帮助世界的文章，从如何构建一个定制的仪表板开始，该仪表板在可用时自动提取关于传染的新数据，计算任何所需的派生指标，并将数据显示在Grafana仪表板上。收集尽可能多的关于这种疫情的准确数据对于有效地抗击它至关重要，同样至关重要的是计算并向最广泛的公众显示正确的衍生指标，以便更好地理解(或评估)政府的决策，或者比较世界上不同政策的不同国家如何产生不同的结果，或者甚至某个国家的病例数在实施某些措施前后如何变化。</p><p id="99ba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用PostgreSQL存储数据(但是任何关系数据库都可以)，使用Grafana显示数据，使用<a class="ae lq" href="https://github.com/BlackLight/platypush/" rel="noopener ugc nofollow" target="_blank"> platypush </a>填充数据并自动更新数据。不久前，我给<a class="ae lq" rel="noopener" target="_blank" href="/how-to-build-your-home-infrastructure-for-data-collection-and-visualization-and-be-the-real-owner-af9b33723b0c">写了一篇文章</a>，讲述如何用这些工具构建你的定制仪表板，以存储和显示任何类型的数据(从你浴室中的湿度传感器到你一天中的位置)。可以参考一下，了解一下这些工具是如何配合使用的，以及如何入门。</p><h1 id="4790" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">问题1:数据可用性和质量</h1><p id="28b7" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">新冠肺炎统计的第一个问题是公布数据的可用性和质量。首先，并不是世界上所有的国家都同样努力让尽可能多的人接受检测。第二，并非所有国家在报告所有数字时都具有相同的透明度或可靠性——包括恢复情况、死亡人数和进行检测的次数。在紧急情况下，可用数据的质量远非完美，这是完全可以预料的。虽然我们作为个人对数据的质量没有太多的控制，但我们仍然可以推断出有趣的信息，并根据手头的不完整数据建立模型。例如，可以查看每个人口单位进行测试次数最多的国家的数据，以更好地了解真实的死亡率和住院率。有可能将病毒扩散的时间线与政府采取措施的时间线重叠，以推断这些措施如何影响了疫情的扩散。考虑到该国现有的重症监护室床位数量，可以推断按照目前的增长速度，卫生系统达到满负荷需要多少天。考虑到这些模型是基于不完整的数据，所有这些信息都应该有所保留，但是根据不完整的数据做出的决策总是比没有数据的决策要好。</p><h1 id="ff8f" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">问题2:数据可视化</h1><p id="7f84" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">像疫情这样的现象按照相对简单的指数定律传播。一般来说，时间<em class="mo"> t </em>的<em class="mo">增长率</em>定义为<em class="mo"> t </em>日确诊病例数与前一日<em class="mo"> t-1 </em>确诊病例数之比:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/46af8d2e06950226d377e22d1cb2f621.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*SkWO2oEaENEYdUIShT3s3g.png"/></div></figure><p id="9887" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果增长率保持不变(如果没有采取控制措施，情况大致如此)，那么只需给出初始病例数和增长率，就可以估计第<em class="mo"> t </em>天的病例数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/44895631305e9f96de7e9af67cd3c3f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*OOVTeH6EhNzuaQxC6rng-w.png"/></div></figure><p id="7771" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你关注过这一时期的任何新闻，你可能会经常听说另一个数字——<em class="mo">R0</em>，也被称为<em class="mo">基本再生数</em>。这是每个感染者携带病原体时感染的平均人数。增长率<em class="mo"> γ </em>和<em class="mo"> R0 </em>相互关系如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/c5d58c5b7cba083dca6fdb2faac75cb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*JV0LBUlRkGbe0lcdHqP9Ow.png"/></div></figure><p id="222b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其中<em class="mo"> w(τ) </em>为疾病的<a class="ae lq" href="https://www.ncbi.nlm.nih.gov/pubmed/17476782" rel="noopener ugc nofollow" target="_blank"> <em class="mo">世代时间分布</em> </a>(基本上是描述一个传播链中连续感染之间时间分布的概率密度函数)。如果我们有一个好的分布规律和关于增长率的准确数据，我们可以很好地估计疾病将传播多少，以及在采取一些行动后它的传播如何变化。</p><p id="957f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然数学定律相对简单，但我们很难理解这种现象究竟是如何发生的。在我们的日常经验中，我们非常习惯于涉及线性定律的现象。如果你把某样东西翻倍或减半，那么其他东西可能会翻倍或减半，或者增加/减少4倍，等等。对于我们来说，处理指数定律的现象通常更难描绘。这个术语在媒体上经常被滥用，这并没有什么帮助:大多数时候，你听到一个经济体、一个公司或一个行业的“指数增长”，你实际上听到的是一个任意大幅度的线性或多项式增长。</p><p id="5e2c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了描述指数增长的真正含义，假设你的田里长了一些杂草，如果不加限制，它每天都会比前一天扩大一倍(换句话说，<em class="mo"> γ=2 </em>)。假设这种杂草如果任其自由生长，需要60天才能覆盖整个田地。如果你应用上面的公式，你会发现在第59天，杂草只覆盖了一半的田地，在第54天，杂草只覆盖了大约1.5%的田地。</p><p id="0eab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">指数增长现象的反直觉性意味着，在做决定时，我们不能只依靠我们的本能或共同的经验。这确实需要以正确的方式可视化正确的数据，以了解是否、何时以及如何控制疫情。以正确的方式看待数据也很重要。虽然你正处于指数增长曲线的中间，但仅仅通过观察线性范围内确诊病例的数量，很难判断增长有多“糟糕”。你只会注意到曲线增长了“很多”，但几个小数点的差异意味着在相对较短的时间框架内出现数十万或数百万的新确诊病例。对数标度给出了曲线实际增长多少的更好的图像，但它也能产生一种虚假的保证感。一条持续指数增长的曲线在对数标度上看起来像一条直线，所以你应该记住，一条在对数标度上持续增长甚至一点点的直线通常不是一个好兆头。</p><p id="cd54" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">许多新的网站和仪表板出现在网络上，以跟踪这种疫情的传播，但尽管它们都在线性和对数标度上显示病例、恢复和死亡的累积数量方面做得相对较好，但它们缺乏一些派生指标的可视化，这些指标将真正有助于更好地掌握问题。例如，随着时间的推移，在某个国家对每单位人口进行了多少次测试，或者在给定的增长率和严重率下ICU床位达到满负荷需要多少天，或者死亡率/严重率如何随着被测试人口的比例而变化。这就是为什么我最终决定制作自己的开放式仪表板，以跟踪我希望跟踪的指标，按国家过滤，并且可以根据每个人的需求轻松定制。</p><h1 id="b037" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">问题3: API可用性</h1><p id="5bf0" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">尽管已经有许多仪表板可以用来跟踪疾病的传播，但大多数仪表板都在后端呈现数据，没有公开任何API。我个人非常喜欢<a class="ae lq" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank"> Worldometers </a>提供的数据质量和数量，它提供了许多其他仪表板上没有的数据(如每个国家人口的检测数量，住院病例数量等)。)，但是我前面提到的一些派生指标并不容易获得，另外，也没有为数据提供API。对于platypush集成，我最终选择了covid19api.com<a class="ae lq" href="https://covid19api.com/" rel="noopener ugc nofollow" target="_blank">提供的数据，即使它没有提供Worldometers上可用的许多指标——我仍然用Worldometers上发布的每日数据手动填充数据库中缺失的指标。作为下一步，我计划为Worldometers数据开发一个刮刀，如果你知道谁已经完成了这项工作，请让我知道:)，对于那些开发这些仪表板的人，非常感谢你的工作，但也请确保公开一个API，以便其他开发人员可以轻松地提取数据或将其集成到其他项目中。</a></p><h1 id="6ef7" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">设置环境</h1><p id="a8d4" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我们将使用三种工具来设置仪表板:</p><ul class=""><li id="ec06" class="ms mt it kw b kx ky la lb ld mu lh mv ll mw lp mx my mz na bi translated">PostgreSQL(但是任何其他关系数据库都可以)</li><li id="bb08" class="ms mt it kw b kx nb la nc ld nd lh ne ll nf lp mx my mz na bi translated">格拉夫纳</li><li id="9f43" class="ms mt it kw b kx nb la nc ld nd lh ne ll nf lp mx my mz na bi translated">鸭嘴兽</li></ul><p id="fd0b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">仪表板可以在任何电脑上运行，包括RaspberryPi。如果你想了解更多关于这些解决方案的信息，请参考我之前关于PostgreSQL+platypush+Grafana的文章。</p><p id="0975" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我假设您的系统上安装了PostgreSQL或另一个RDBMS，以及Grafana。如果您的系统上还没有安装platypush，您可以通过pip轻松安装:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="0339" class="nl ls it nh b gy nm nn l no np">pip install platypush</span></pre><p id="807d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">还要安装并启动Redis，platypush将使用它作为后端来传递消息。</p><p id="804a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">设置数据库:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="be6c" class="nl ls it nh b gy nm nn l no np">initdb -D covid19</span></pre><p id="dd57" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后创建我们将用来管理统计数据的表和触发器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="19f7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">基本思想是将新的非规范化行转储到<code class="fe ns nt nu nh b">tmp_covid19_data</code>表，然后让触发器管理数据的规范化，而视图<code class="fe ns nt nu nh b">vcovid19</code>将用于连接和计算我们想要的派生指标。</p><p id="1a51" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，您可以使用一个利用<a class="ae lq" href="https://platypush.readthedocs.io/en/latest/platypush/plugins/covid19.html" rel="noopener ugc nofollow" target="_blank"> platypush Covid19插件</a>的简单Python脚本来填充您想要跟踪的国家的所有历史数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="79ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，配置<a class="ae lq" href="https://platypush.readthedocs.io/en/latest/platypush/backend/covid19.html" rel="noopener ugc nofollow" target="_blank"> Covid19后端</a>来自动提取您感兴趣的国家的数据，方法是将以下代码行添加到<code class="fe ns nt nu nh b">~/.config/platypush/config.yaml</code>:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="5af2" class="nl ls it nh b gy nm nn l no np">backend.covid19:<br/>    country:<br/>        - nl<br/>        - it<br/>        - us<br/>        - es<br/>        - gb<br/>        - cn<br/>        - fr<br/>        - ru</span></pre><p id="59c5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">每当有这些国家的新数据时，platypush就会触发一个<code class="fe ns nt nu nh b"><a class="ae lq" href="https://platypush.readthedocs.io/en/latest/platypush/events/covid19.html" rel="noopener ugc nofollow" target="_blank">Covid19UpdateEvent</a></code>。您可以用钩子捕获这个事件，并将新行存储在数据库中，但是您还可以做其他任何事情——发送通知、SMS或设置任何类型的自动化。在<code class="fe ns nt nu nh b">~/.config/platypush/scripts</code>下创建一个名为<code class="fe ns nt nu nh b">covid19.py</code>的脚本(还要确保这个文件夹中有一个<code class="fe ns nt nu nh b">__init__.py</code>文件，这样它就会被识别为一个包):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="bcaa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">启动<code class="fe ns nt nu nh b">platypush</code>服务。既然您已经获得了数据和更新数据的自动化，那么是时候去Grafana并创建一些面板来从<code class="fe ns nt nu nh b">vcovid19</code>视图中提取和显示数据了。一些示例报告查询:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="c714" class="nl ls it nh b gy nm nn l no np">SELECT<br/>  report_date AS "time",<br/>  confirmed<br/>FROM vcovid19<br/>WHERE<br/>  country = '&lt;country name&gt;' AND<br/>  $__timeFilter(report_date)<br/>ORDER BY 1</span></pre><p id="5763" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以将这些查询组合在一起，构建您喜欢的仪表板:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/a1b4da9e28d8af896c586502eb1ba264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1WfU6ZFoKLlviRN7drPx-Q.png"/></div></div></figure></div></div>    
</body>
</html>