<html>
<head>
<title>5 Top Tips for Data Scraping Using Selenium in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Python 中使用 Selenium 进行数据搜集的 5 个技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-top-tips-for-data-scraping-using-selenium-d8b83804681c?source=collection_archive---------23-----------------------#2020-08-09">https://towardsdatascience.com/5-top-tips-for-data-scraping-using-selenium-d8b83804681c?source=collection_archive---------23-----------------------#2020-08-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6391" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 Python 中使用 selenium 的最佳数据搜集实践</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/a26efce1622c0694f7a16763369afbee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*b2mv0425w1rhn1YcFylEcw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图片由 istock 通过<a class="ae ku" href="https://www.istockphoto.com/portfolio/AdaYokota?mediatype=illustration" rel="noopener ugc nofollow" target="_blank"> Ada Yokota </a>提供</p></figure><h2 id="0354" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">用于网刮的硒</h2><p id="6bc7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">Selenium 是一个浏览器自动化库。Selenium 最常用于测试 web 应用程序，可以用于任何需要与浏览器自动交互的任务。这可以包括网络抓取。</p><p id="0f41" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">下面的教程将是一个用户引导的使用 selenium 进行 web 抓取的最佳实践指南。我列出了我的 5 个顶级技巧，它们将帮助用户使用 Python 尽可能高效地抓取他们请求的任何数据，并使用尽可能少的代码。</p><h2 id="4c24" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">目标:</h2><p id="fa2b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">从 BBC 新闻中提取冠状病毒全球头条。</p><h2 id="d5d0" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">先决条件</h2><p id="8169" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">要学习本教程，您需要:</p><ol class=""><li id="b253" class="mp mq it lt b lu mk lx ml le mr li ms lm mt mj mu mv mw mx bi translated">下载 selenium 驱动程序。chrome 驱动程序可用于与 chrome 交互，此处<a class="ae ku" href="https://chromedriver.storage.googleapis.com/index.html?path=85.0.4183.38/" rel="noopener ugc nofollow" target="_blank">提供。</a></li><li id="7393" class="mp mq it lt b lu my lx mz le na li nb lm nc mj mu mv mw mx bi translated"><code class="fe nd ne nf ng b">pip install selenium</code></li></ol></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h2 id="aa8e" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">5 个硒最佳实践技巧</h2><h2 id="4945" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">技巧 1:将 webdriver 可执行文件放在 PATH 中</h2><p id="3cd9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">要开始我们的网页抓取任务，我们必须首先导航到下面的页面，<a class="ae ku" href="https://www.bbc.co.uk/news" rel="noopener ugc nofollow" target="_blank">https://www.bbc.co.uk/news</a>。这一步只用三行代码就可以完成。首先我们从 selenium 导入 webdriver，创建 chrome webdriver 的一个实例，最后在名为 driver 的 webdriver 对象上调用 get 方法。</p><p id="3ae3" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">为了使代码简短易读，chromedriver 可执行文件可以放在用户选择的文件夹中。然后，可以将该目的地添加到环境变量下的 PATH 中。简单地使用 webdriver，webdriver 就准备好了。括号中没有传递给 Chrome 的参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nq"><img src="../Images/9facdd9f6a9623c03097fae787390d12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C_9XL1ovkmfB0lNJOXrtQQ.png"/></div></div></figure><h2 id="120d" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">技巧二。使用控制台查找任何 webelement</h2><p id="0f9b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">当我们导航到网页时，我们希望找到搜索框，点击它并开始键入“冠状病毒全球更新”。</p><p id="05a9" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">要找到这个 webelement，我们只需右键单击 chrome 并选择 inspect。在我们检查时打开的页面的左上角，我们可以使用光标悬停并选择感兴趣的 web 元素。如图所示，搜索框有一个输入标签，id 值为‘orb-search-q’。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nv"><img src="../Images/c0364c22ab4367d845713d06f75fc1a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WjC__7TuQmw4tYKb3pt6eA.png"/></div></div></figure><p id="40a2" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">我们如何确保这是我们唯一感兴趣的搜索元素？</p><p id="c3ae" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">我们可以简单地选择控制台选项卡窗口，然后键入两个美元符号，后面跟着括号和引号。在引号内，我们写标记输入，后跟方括号。在那些方括号中，我们可以添加 id 及其值。</p><p id="a5f5" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated"><code class="fe nd ne nf ng b">Format to find CSS selectors</code></p><p id="c7c3" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated"><code class="fe nd ne nf ng b">$$('tag[attribute="attribute value"]')</code></p><p id="71b7" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">如图所示，只返回一个元素的数组。我们可以确信我们现在有正确的搜索框可以点击，并开始输入我们的搜索查询。</p><p id="bc2d" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">控制台中引号的内容是一个<strong class="lt iu">有效的 CSS 选择器</strong>，我们可以在脚本中使用它来查找 webelement。</p><p id="58b0" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">这就引出了下一个技巧。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nx"><img src="../Images/b9ddf74a660022b62aca2d65434af5c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p8kNWiMZr0MoMzFWixQ1PQ.png"/></div></div></figure><h2 id="408a" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">技巧 3:强大的数据搜集一行程序:动作链和键</h2><p id="faed" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">我们现在可以调用 webdriver 对象驱动程序上的<code class="fe nd ne nf ng b">find_element_by_css_selector</code>方法。</p><p id="b9b1" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">我们希望我们的 webdriver 移动到这个 webelement，单击它，键入我们的搜索查询“全球冠状病毒更新”，然后按 enter 键。</p><p id="8433" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">这可以使用 selenium 的 ActionChains 和 Keys 类轻松完成。我们简单地将驱动程序传递给 ActionChains，方法链使用方法，<code class="fe nd ne nf ng b">move_to_element</code>，<code class="fe nd ne nf ng b">click</code>，<code class="fe nd ne nf ng b">send_keys</code>来输入类型，<code class="fe nd ne nf ng b">key_down</code>使用传递的<code class="fe nd ne nf ng b">Keys.ENTER</code>来模拟输入。要运行这个命令，请在 ActionChain 的末尾添加<code class="fe nd ne nf ng b">perform</code>方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="8393" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">运行 ActionChain 将我们带到这里:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi ny"><img src="../Images/7b905c8964f9502b36ad122af0d9e94e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4qF1NAtAS7lolpkn1G1wbg.png"/></div></div></figure><h2 id="133c" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">技巧 4:捕获数据</h2><p id="7f22" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">所示的 webelement 返回图像、标题、副标题和一些附件信息，如出版日期。</p><p id="293c" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">我们如何从每个故事中捕捉到标题？</p><p id="006c" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">如果我们在控制台中键入如下所示的 webelement，它将返回 10 个 web 元素的列表。我们想从这些故事中提取标题。</p><p id="0cdb" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">为此，我们可以简单地迭代这 10 个故事。为此，我们调用传递了 web 元素的<code class="fe nd ne nf ng b">find_elements_by_css_selector</code>。这个方法返回一个我们可以迭代的类似列表的对象。</p><p id="216a" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">我们可以将它赋给变量名 top_titles，并使用 for 循环遍历它们。在 for 循环中，我们可以使用 2 号提示找到与每个标题相关的元素，并通过调用 webelement 上的<code class="fe nd ne nf ng b">.text</code>提取文本。</p><p id="2a56" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">除了打印到终端控制台，我们还可以写入一个. txt 文件，这样无论何时运行脚本，我们都有一个标题的永久副本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nz"><img src="../Images/a47bd689a398f72334592f919224d1fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LAuSLsqv58TXNE4RCj6Ygg.png"/></div></div></figure><h2 id="428d" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">技巧 5:无头 webdriver</h2><p id="7f1a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">当我们运行脚本来提取标题时，会弹出一个浏览器窗口，如下面的视频所示。</p><p id="e2d6" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">虽然这看起来很有趣，但在很大程度上，这可能不是我们想要的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa np l"/></div></figure><p id="6a6e" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">要删除浏览器，从 selenium 模块导入 Options 类，创建该类的一个实例，并使用传递的字符串参数'— headless '调用该实例上的<code class="fe nd ne nf ng b">add_argument</code>方法。最后，在 webdriver 中，在 options 参数下，添加指向 headless 浏览器的变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="a48f" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">额外提示:在慢速连接的情况下，添加等待来查找元素</h2><p id="4cc7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">Webdriver 等待、等待和预期条件</p><p id="0863" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">为了确保网络抓取成功，我们可以在脚本中引入一个等待。这个特性在网页加载缓慢的情况下特别有用。为此，我们导入所示的三个类。</p><p id="ea82" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">引入等待的好处在于，当它们被构造时，几乎可以写成一个句子。此外，只要我们愿意，他们就可以搜索 webelement。如果 web 元素发现得更早，脚本也会执行得更早。</p><p id="571b" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">这里，我们传递我们的驱动程序对象 WebDriverWait 类，告诉它最多等待 10 秒钟，直到找到元素。在<code class="fe nd ne nf ng b">until</code>方法中，我们传递别名为 EC 的<code class="fe nd ne nf ng b">ExpectedConditons</code>类，并在其上调用定位元素的方法。然后，我们向这个方法传递一个定位器元组，详细说明我们正在搜索什么元素(通过。CSS_SELECTOR)和 webelement。</p><p id="fd19" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">等待将使您的脚本更健壮，更不容易出现超时异常。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="01ac" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">这里显示了这些示例的脚本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h2 id="224d" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">将自动化脚本转换成类</h2><h2 id="15bd" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">冠状病毒标题类</h2><p id="248e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">当我们确信 web 自动化工作正常时，我们现在可以将代码转换成一个类。为了让这个类的潜在用户简单明了，我决定把这个类叫做<code class="fe nd ne nf ng b">CoronaVirusHeadlines</code>。</p><p id="847e" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">在<code class="fe nd ne nf ng b">init</code>构造函数中，我在指向 Chrome webdriver 的对象中设置了一个驱动属性。</p><p id="36a5" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">该代码与前面几节中展示的过程代码完全相同(除了我已经删除了 headless 选项)。唯一的例外是驱动程序已被设置为对象中的一个属性。驱动程序在 init 方法中被初始化，并在<code class="fe nd ne nf ng b">get_headlines</code>方法中被用来检索标题。</p><p id="b701" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">为了获得标题，我简单地创建了这个类的一个实例，名为<code class="fe nd ne nf ng b">virus_data</code>。然后我调用这个类上的<code class="fe nd ne nf ng b">get_headlines</code>方法来检索. txt 文件中的标题。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="44cd" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">在我的本地目录中，我现在可以检查名为“冠状病毒 _ 头条新闻. txt”的文件。</p><p id="e1eb" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">如下图，标题已经被刮成了一个. txt 文件。请记住，如果你自己运行代码，标题当然会有所不同，因为冠状病毒疫情不断演变，每天都有新的故事发布到 BBC。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi ob"><img src="../Images/189d39cce586badbefd6c5817f7d615b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*trDGNjPkMfLdfimu9pGpXQ.png"/></div></div></figure><h2 id="da8a" class="kv kw it bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">摘要和扩展</h2><p id="e34d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz le ma mb mc li md me mf lm mg mh mi mj im bi translated">这些是我使用硒来刮痧的一些最好的技巧。一些技巧，包括 actionchain 和 wait 技巧，可读性很强，也很容易被其他阅读你的代码的人理解。</p><p id="4efe" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">该脚本很容易扩展。您也可以导航到第二页来检索接下来的 10 个标题。或者，您可能希望将标题通过电子邮件发送或转换成可执行文件，这样标题就可以与您和您感兴趣的同事/朋友共享，他们可能不一定使用 Python。这可以分别使用<code class="fe nd ne nf ng b">smtplib</code>或<code class="fe nd ne nf ng b">PyInstaller </code>模块来实现。</p><p id="7edb" class="pw-post-body-paragraph lr ls it lt b lu mk ju lw lx ml jx lz le mm mb mc li mn me mf lm mo mh mi mj im bi translated">感谢阅读。</p></div></div>    
</body>
</html>