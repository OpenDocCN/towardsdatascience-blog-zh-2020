<html>
<head>
<title>Tutorial: Poisson regression with CatBoost</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:使用CatBoost进行泊松回归</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tutorial-poisson-regression-with-catboost-33a1e39badc?source=collection_archive---------31-----------------------#2020-04-29">https://towardsdatascience.com/tutorial-poisson-regression-with-catboost-33a1e39badc?source=collection_archive---------31-----------------------#2020-04-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c979" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用泊松回归和CatBoost来提高基于计数的数据的准确性…并预测一条推文获得的赞数。</h2></div><h1 id="cd37" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">在本教程中，我们将讨论以下主题:</h1><ul class=""><li id="a432" class="kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">基于计数的数据的概念</li><li id="3f1b" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">什么是泊松回归，为什么它适用于基于计数的数据</li><li id="bb60" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">如何用CatBoost包建立泊松回归模型</li><li id="eaea" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">如何预测埃隆·马斯克的推文会获得多少赞</li></ul><h1 id="eb6c" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">什么是基于计数的数据？</h1><p id="998b" class="pw-post-body-paragraph lu lv iq kz b la lb jr lw lc ld ju lx le ly lz ma lg mb mc md li me mf mg lk ij bi translated">根据定义<strong class="kz ir">计数数据</strong>是一种数据类型，其中:</p><ul class=""><li id="7350" class="kx ky iq kz b la mh lc mi le mj lg mk li ml lk ll lm ln lo bi translated">观察值只能取非负整数值{0，1，2，3，…}</li><li id="020a" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">这些整数来自<em class="mm">计数</em></li></ul><p id="4000" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">更具体地说，在我们的教程中，我们将关注基于计数的数据，其中每个点都是在某个固定时间单位<em class="mm"> t </em>内发生的事件数量。我们还将假设在时间单元<em class="mm"> t </em>期间平均发生事件<em class="mm"> λ </em>的数量。<em class="mm"> λ </em>则称为<strong class="kz ir">事件率</strong>。<strong class="kz ir">事件发生率可能会随着时间的推移而变化，也可能会随着观察的不同而变化。</strong>以下是此类数据的一些示例:</p><ul class=""><li id="36dd" class="kx ky iq kz b la mh lc mi le mj lg mk li ml lk ll lm ln lo bi translated">每周看医生的人数</li><li id="b2fd" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">过桥车辆数量</li><li id="9e82" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">每天发布在Instagram上的照片数量</li><li id="302e" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">乔治·r·r·马丁每两年写的“冰之歌”的数量</li></ul><p id="5428" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">值得注意的是，基于计数的数据的分布可能是相当偏斜的，因为大多数数据点具有完全相同的值。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/90608adfafc3651b8053db376567d44e.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*YeNOnytHnNHo4xlf1MqCaw.jpeg"/></div></figure><h1 id="012f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">泊松回归</h1><h2 id="1d20" class="my kg iq bd kh mz na dn kl nb nc dp kp le nd ne kr lg nf ng kt li nh ni kv nj bi translated">泊松分布</h2><p id="ea29" class="pw-post-body-paragraph lu lv iq kz b la lb jr lw lc ld ju lx le ly lz ma lg mb mc md li me mf mg lk ij bi translated">泊松分布的概率质量函数如下:</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/d451d71a5fc794041ed08f520499170f.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*4ynM6D0yUUyVO8YjZVvulg.png"/></div><p class="nl nm gj gh gi nn no bd b be z dk translated">泊松分布的PMF</p></figure><p id="8d52" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">其中<em class="mm"> P(k) </em>是在给定事件率的时间单位内看到<em class="mm"> k </em>个事件的概率(=每时间单位的事件数)<em class="mm"> λ </em>。</p><p id="0845" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">我们可以用泊松分布来模拟基于计数的数据。</p><p id="50a8" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">常数为<em class="mm"> λ </em>的泊松分布示例如下:</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="gh gi np"><img src="../Images/9afe6592d093ded23594a09ec366515f.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*8poqd7ZDJO3Hu-xn0uDYAQ.png"/></div></figure><p id="f73d" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">生成泊松分布样本的代码:</p><figure class="mr ms mt mu gt mv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h1 id="8655" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">事件率λ作为因变量</h1><p id="f249" class="pw-post-body-paragraph lu lv iq kz b la lb jr lw lc ld ju lx le ly lz ma lg mb mc md li me mf mg lk ij bi translated">泊松回归的思想是说事件率<em class="mm"> λ </em>是因变量。</p><p id="868e" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">例如，每天过桥的自行车数量取决于天气、一年中的时间、一周中的日期等。我们可以建立一个普通的RMSE回归模型，但是，这样的模型不能解释基于计数的数据属性。所以在泊松回归中，我们希望最大化泊松分布的对数似然。假设<em class="mm"> X </em>，<em class="mm"> y </em>是我们用于泊松回归任务的数据集(意味着<em class="mm"> y </em>是基于计数的)，那么我们想要最大化对数似然性:</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ns"><img src="../Images/fda30e56ffe599b073f4d1a6ff76413b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VRx0HmmGHU_6dnL6n3ldSw.png"/></div></div></figure><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi nx"><img src="../Images/ac04290967df6f4412dd3ab38186c356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QU57uJ0Bvm-QMQP6ZgHzuA.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">数据集(X，y)上泊松分布的对数似然性</p></figure><p id="7474" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">自日志<em class="mm">(咦！)</em>不依赖于<em class="mm"> X </em>我们去掉这一项，尽量减少以下损失:</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ny"><img src="../Images/52a48329f6e2d26d0d242fcdb1c33ba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qlz3_1eEg7NZvcevZ1cbaQ.png"/></div></div></figure><p id="9576" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">这种损失可以用不同的模型和优化方法来优化。在我们的教程中，我们使用CatBoost包。</p><h1 id="1ca3" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">定型泊松回归模型</h1><h1 id="9fe0" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">资料组</h1><p id="9857" class="pw-post-body-paragraph lu lv iq kz b la lb jr lw lc ld ju lx le ly lz ma lg mb mc md li me mf mg lk ij bi translated">我们的数据集是用Twitter API收集的。它由埃隆·马斯克的推文组成。我们将使用2019年3月至2020年1月的推文作为训练集，2020年2月上半月的推文作为验证集，2020年2月下半月的推文作为测试集。我们的<strong class="kz ir">目标是推特收到的赞数</strong>。在实践中，大多数推文在发布后的前两周内收到了所有的赞，所以我们假设我们的时间单位是两周。我们收集了至少两周前的推文。</p><h1 id="2836" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">特征</h1><p id="46ce" class="pw-post-body-paragraph lu lv iq kz b la lb jr lw lc ld ju lx le ly lz ma lg mb mc md li me mf mg lk ij bi translated">我们为我们的任务提取了一些非常简单的特征:</p><ul class=""><li id="c9f7" class="kx ky iq kz b la mh lc mi le mj lg mk li ml lk ll lm ln lo bi translated">推文长度</li><li id="06a5" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">其他Twitter用户提及的次数</li><li id="6d38" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">推文中的URL数量</li><li id="306e" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">月</li><li id="295e" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">一天</li><li id="5e7d" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">小时</li><li id="dab6" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">星期几</li><li id="de50" class="kx ky iq kz b la lp lc lq le lr lg ls li lt lk ll lm ln lo bi translated">大小为500的TF-IDF特征向量(用<code class="fe nz oa ob oc b">stop_words="english"</code>提取<code class="fe nz oa ob oc b">sklearn.feature_extraction.text.TfidfVectorizer</code>)</li></ul><figure class="mr ms mt mu gt mv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi od"><img src="../Images/52e53569afd084ee570bab6bf7f2450f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AcEc7g0qHcPX4kj5WMDrYw.png"/></div></div></figure><figure class="mr ms mt mu gt mv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="7756" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">现在，我们将使用客观泊松来训练CatBoost模型。我们将使用我们的验证数据集来选择迭代次数。</p><figure class="mr ms mt mu gt mv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><pre class="mr ms mt mu gt oe oc of og aw oh bi"><span id="96df" class="my kg iq oc b gy oi oj l ok ol">bestIteration = 972<br/><br/>Shrink model to first 973 iterations.<br/>R2 score: 0.555<br/>RMSE score: 39844.35</span></pre><p id="f230" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">56%的决定系数R2值表明，我们的模型对测试数据集的预测解释了超过一半的目标可变性，考虑到任务的复杂性和我们方法的简单性，这并不坏。<br/>此外，为了进行比较，我们将训练一个具有标准RMSE目标的CatBoost模型:</p><figure class="mr ms mt mu gt mv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><pre class="mr ms mt mu gt oe oc of og aw oh bi"><span id="5970" class="my kg iq oc b gy oi oj l ok ol">bestIteration = 44<br/><br/>Shrink model to first 45 iterations.<br/>R2 score: 0.483<br/>RMSE score: 42936.22</span></pre><p id="ad80" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">鉴于RMSE模型的最佳迭代次数为45，而泊松回归的最佳迭代次数为972，我们可能会怀疑CatBoost自动选择的学习率0.055185对于RMSE模型来说太大了。为了解决这种可能的不公平，我们还训练了一个学习率小30倍的RMSE模型:</p><figure class="mr ms mt mu gt mv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><pre class="mr ms mt mu gt oe oc of og aw oh bi"><span id="9d3a" class="my kg iq oc b gy oi oj l ok ol">bestIteration = 748<br/><br/>Shrink model to first 749 iterations.<br/>R2 score: 0.470<br/>RMSE score: 43470.15</span></pre><p id="9401" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">然而，较小的学习率无助于RMSE模型。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="gh gi om"><img src="../Images/96595404e94362278fa1308d61b5b2c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*DIM84TLFmnU9FJYFNdj8cA.png"/></div></figure><p id="3905" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated">可以看出，考虑数据集性质的损失比标准RMSE损失产生更好的结果。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi on"><img src="../Images/95cc0fdc0a0a27dc747bb4fbc7c7ffc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ANEYE3kaIN3D8ogRQcWq_g.png"/></div></div></figure><p id="271a" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated"><strong class="kz ir">感谢您的关注！希望这篇教程对你有用。</strong></p><p id="4d45" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated"><a class="ae oo" href="https://colab.research.google.com/github/catboost/tutorials/blob/master/regression/poisson.ipynb" rel="noopener ugc nofollow" target="_blank">在Colab中打开</a></p><p id="7682" class="pw-post-body-paragraph lu lv iq kz b la mh jr lw lc mi ju lx le mn lz ma lg mo mc md li mp mf mg lk ij bi translated"><a class="ae oo" href="https://github.com/catboost/catboost/blob/master/catboost/tutorials/regression/poisson.ipynb" rel="noopener ugc nofollow" target="_blank">GitHub上的视图</a></p></div></div>    
</body>
</html>