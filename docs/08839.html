<html>
<head>
<title>6 Lesser-Known Yet Awesome Tricks in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫的6个鲜为人知却令人敬畏的把戏</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/6-lesser-nown-yet-awesome-tricks-in-pandas-32236f3785c8?source=collection_archive---------26-----------------------#2020-06-25">https://towardsdatascience.com/6-lesser-nown-yet-awesome-tricks-in-pandas-32236f3785c8?source=collection_archive---------26-----------------------#2020-06-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/f18e907b4a0d2abc1995bbc736cd5870.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUi3vkj06Vqp_sXeiI-UbQ.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图片来源:<a class="ae jg" href="https://unsplash.com/photos/vpOeXr5wmR4" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><div class=""/><div class=""><h2 id="6e40" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">我希望我能早点知道的技巧，以便从熊猫身上获得更多的价值</h2></div><p id="5c0e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为最流行的用于分析的Python库，Pandas是一个提供各种数据操作和处理能力的大项目。毫不夸张地说，包括我在内的数据科学家在我们的日常工作中都会用到熊猫。</p><p id="0a9d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个博客是我致力于分享熊猫十大鲜为人知但最受欢迎的特征的迷你系列的第一部分。希望您可以带着一些灵感离开，使您自己的代码更加健壮和高效。</p><p id="4bed" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个迷你系列的数据集来自<a class="ae jg" href="https://en.wikipedia.org/wiki/Table_of_food_nutrients" rel="noopener ugc nofollow" target="_blank">食物营养成分表</a>，这是一个维基百科页面，包含16个按食物类型分类的基本食物及其营养成分的列表。在这个演示中，我们将使用<strong class="la jk">乳制品表</strong>的一个子集，如下所示。</p><figure class="lv lw lx ly gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lu"><img src="../Images/73ca77af1edd15d14ff2e5a18856443b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7jJxrZFTFD-_HjWL25W-rg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:<a class="ae jg" href="https://en.wikipedia.org/wiki/Table_of_food_nutrients" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></figure><p id="07ea" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> 1。用</strong> <code class="fe lz ma mb mc b"><strong class="la jk">read_html(match)</strong></code>从HTML中抓取表格</p><p id="ffa4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">说到Python中的web抓取，我的首选库曾经是<code class="fe lz ma mb mc b">BeautifulSoup</code>，直到我发现了熊猫中的<code class="fe lz ma mb mc b">read_html()</code>。没有解析HTML页面的麻烦，我们可以直接提取存储为HTML表的数据，</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="686f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意到参数。<code class="fe lz ma mb mc b">match = ‘Fortified milk’</code>在码？它仅用于选择包含指定字符串或正则表达式的表，在我们的例子中，就是dairy表。<code class="fe lz ma mb mc b">match</code> arg。当我们的HTML页面变大时将会非常方便。</p><p id="a825" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，查看输出显示，我们意识到相当多的行和列被截断了！</p><p id="e259" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> 2。自动加载定制的</strong><code class="fe lz ma mb mc b"><strong class="la jk">options</strong></code><strong class="la jk"/></p><p id="3189" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">和熊猫一起工作一段时间，你可能知道它允许用户在它的<a class="ae jg" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/options.html" rel="noopener ugc nofollow" target="_blank">选项系统</a>中配置显示相关的选项。例如，设置<code class="fe lz ma mb mc b">pd.options.display.max_rows = 1000</code>解决了上面的显示问题，这简直让我回到了第一次学习熊猫的时候！</p><p id="3ffd" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，我的挫折越积越多，因为我不得不重写相同的配置。选项，每次我开始一个新的IPython会话。我不知道这些选项可以编译到IPython启动文件中，</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="d98c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后我们只需设置<code class="fe lz ma mb mc b">PYTHONSTARTUP</code>环境变量指向这个启动文件，所有方便的设置都会在Python启动时自动加载。这是启动文件执行后的打印输出，</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="afee" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"><em class="mf">* * *更新2022:加入我们的YouTube社区🎦</em> </strong> <a class="ae jg" href="https://www.youtube.com/channel/UCbGx9Om38Ywlqi0x8RljNdw" rel="noopener ugc nofollow" target="_blank"> <strong class="la jk"> <em class="mf">【数据说话带吉】</em> </strong> </a> <strong class="la jk"> <em class="mf">😄</em> </strong></p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="mg me l"/></div></figure><p id="84c0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> 3。从</strong> <code class="fe lz ma mb mc b"><strong class="la jk">.iterrows()</strong></code> <strong class="la jk">切换到</strong> <code class="fe lz ma mb mc b"><strong class="la jk">.itertuples()</strong></code></p><p id="268a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我们刚刚看到的，由于“Food”列中的子类别，该数据包含缺失值，</p><figure class="lv lw lx ly gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mh"><img src="../Images/33fe17f91f37cca2f8e4c52748495e4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rc30-0pa4t3j4i3XpCHkfA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:<a class="ae jg" href="https://en.wikipedia.org/wiki/Table_of_food_nutrients" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></figure><p id="a49b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">直觉上，我们的下一步是通过删除带有<em class="mf"> NA </em> s的行或者用所需的值填充它们来删除丢失的值。不管我们决定使用哪一个选项，我们首先需要连接“Food”列，因为它们都包含唯一的信息。众所周知，这可以通过用<code class="fe lz ma mb mc b">.iterrows()</code>方法循环遍历行来实现。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="54e4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，一个更好的循环熊猫的方法是<code class="fe lz ma mb mc b">.itertuples()</code>，顾名思义，它返回一个元组而不是一个pd。系列如<code class="fe lz ma mb mc b">.iterrows()</code>所示。</p><p id="853f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我经常发现<code class="fe lz ma mb mc b">.itertuples()</code>比<code class="fe lz ma mb mc b">.iterrows()</code>运行得快，因为前者消除了调用<code class="fe lz ma mb mc b">.iterrows()</code>方法的一些开销，例如检查数据类型。更多细节可以在这里<a class="ae jg" href="http://Since this is beyond the scope of this blog, I will not discuss it here, however, more details regarding how to (create ODBC or JDBC connections) can be found here." rel="noopener ugc nofollow" target="_blank">找到</a>如果你有兴趣的话。</p><p id="d25c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们探索如何将我们的“食物”价值观与<code class="fe lz ma mb mc b">.itertuples()</code>联系起来，</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="ef0b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该语法中的技巧包括(1)初始化两个全局变量以存储当前的“Food”值和行索引，该行索引恰好是“row”元组中的第一个元素；(2)通过分配回新的串联“食物”值来修改原始的dairy表。</p><p id="dfd9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里显示了我们预想的输出，</p><figure class="lv lw lx ly gt iv gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/c153fc4c5a9f156c8e574dd983898606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*N1ALPeiL9A_Xs9uYUu5Qyg.png"/></div></figure><p id="ea3c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> 4。用</strong> <code class="fe lz ma mb mc b"><strong class="la jk">.fillna(method)</strong></code>输入缺失值</p><p id="7c28" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我们简要提到的，处理缺失值的另一种方法是用所需的值填充它们，在我们的例子中，这些值是下一个连续行中的值。现在<code class="fe lz ma mb mc b">fillna()</code>函数派上了用场，</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="b4a1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">只用一行代码，我们丢失的值就被估算出来了，</p><figure class="lv lw lx ly gt iv gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/540c32ccab058d09d3bcb157db0a2094.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*93l2nowaXvzY05Id5pB3UA.png"/></div></figure><p id="1125" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里我们指定参数。<code class="fe lz ma mb mc b">method = ‘bfill’</code>:反向填充，反向传播第一个非空值。另一个选项是<strong class="la jk"> 'ffill' </strong>:向前填充，在时序数据中特别有用。关于该参数及其多值选项的更多详细信息，请点击链接<a class="ae jg" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.fillna.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="5837" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">事实上，当我第一次学习<code class="fe lz ma mb mc b">.fillna()</code>时，我非常喜欢它，因为它允许我估算<em class="mf"> NA </em> s，而无需首先用<em class="mf"> NA </em> s对行进行子集化。<code class="fe lz ma mb mc b">method</code>这个功能很快成为我最喜欢的熊猫功能之一。</p><p id="2395" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> 5。用</strong>和<code class="fe lz ma mb mc b"><strong class="la jk">cumsum()</strong></code>处理布尔值</p><p id="adc2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随着NA被填充，现在我们采取不同的方法来连接“食物”值怎么样？第一步，让我们创建一些关键变量来指示<strong class="la jk">哪些行将被合并</strong>，即，两个连续的行在除“食物”之外的变量上具有相同的值，</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="0886" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里有两个技巧:(1)使用<code class="fe lz ma mb mc b">shift(1)</code>选择前一行，然后与当前行进行比较；(2)调用<code class="fe lz ma mb mc b">cumsum()</code>对于转换成整数向量的布尔值(即1 =真，0 =假)如果两行不同时进行“计算”。</p><p id="d4e4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为我们比较了数据集中的所有3列，所以从<code class="fe lz ma mb mc b">cumsum()</code>创建了3个额外的关键变量(例如，Measure_)。一旦我们将它们与dairy表合并，我们将看到下面的输出，对于要合并的行，所有3个关键变量保持不变，</p><figure class="lv lw lx ly gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mk"><img src="../Images/07eac22c6d654050b11a8efbb97c7a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xdhRVo_8q6Fzap1lFST7fA.png"/></div></div></figure><p id="0812" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> 6。用</strong> <code class="fe lz ma mb mc b"><strong class="la jk">.get_group()</strong></code>自省 <code class="fe lz ma mb mc b"><strong class="la jk">GroupBy</strong></code> <strong class="la jk">对象</strong></p><p id="f5e6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有了关键变量，我们可以继续使用另一个有利的技巧连接“Food”值:<code class="fe lz ma mb mc b">.groupby() + .apply()</code>，下面的代码返回与第3项相同的输出，</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="b1a4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">类似于SQL中的GROUPBY操作，Pandas中的<code class="fe lz ma mb mc b">.groupby()</code>将我们的数据分成由关键变量定义的组。但是它到底是如何工作的呢？为了自省对象<code class="fe lz ma mb mc b">.DataFrameGroupBy</code>，我们可以利用较少使用的<code class="fe lz ma mb mc b">.groups</code>和<code class="fe lz ma mb mc b">.get_group()</code>，</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="61f9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从下面的部分打印输出中，我们可以看到，每个组都是由原始数据集拼接而成的<strong class="la jk">微小数据帧，当我们调用<code class="fe lz ma mb mc b">apply()</code>时，相同的操作(例如，在我们的例子中是join)将迭代通过单个<strong class="la jk">组</strong>，直到到达末尾。</strong></p><figure class="lv lw lx ly gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ml"><img src="../Images/4d080d1a4b9b5f8670baa7a808f1dfa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rb9E392Cg9USKwTRikIYfQ.png"/></div></div></figure><p id="2f2d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，显式可视化<code class="fe lz ma mb mc b">GroupBy</code>对象非常有助于确保我们对正确的子数据集应用操作。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="ac1b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你有它！提高熊猫编程水平的6个不常用技巧，我希望这个主题对你有所帮助。在这个迷你系列的第二部分，我将分享我最喜欢的熊猫的另外四个特征，所以请密切关注🙂一如既往，所有代码都可以在我的<a class="ae jg" href="https://github.com/YiLi225/Pandas_Tricks" rel="noopener ugc nofollow" target="_blank"> Github repo这里找到</a>，快乐学习！</p><p id="1fd8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="mf">想要更多数据科学和编程技巧？使用</em> </strong> <a class="ae jg" href="https://yilistats.medium.com/membership" rel="noopener"> <strong class="la jk"> <em class="mf">我的链接</em> </strong> </a> <strong class="la jk"> <em class="mf">注册Medium，获得我所有内容的全部访问权限。</em>T25】</strong></p><p id="cdb0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="mf">还订阅我新创建的YouTube频道</em> </strong> <a class="ae jg" href="https://www.youtube.com/channel/UCbGx9Om38Ywlqi0x8RljNdw" rel="noopener ugc nofollow" target="_blank"> <strong class="la jk"> <em class="mf">【数据与Kat会谈】</em></strong></a><strong class="la jk"><em class="mf"/></strong></p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="mg me l"/></div></figure><h1 id="5ce1" class="mt mu jj bd mv mw mx my mz na nb nc nd kp ne kq nf ks ng kt nh kv ni kw nj nk bi translated">更多有趣的数据科学博客:</h1><div class="is it gp gr iu nl"><a rel="noopener follow" target="_blank" href="/6-sql-tricks-every-data-scientist-should-know-f84be499aea5"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd jk gy z fp nq fr fs nr fu fw ji bi translated">每个数据科学家都应该知道的6个SQL技巧</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">提高分析效率的SQL技巧</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">towardsdatascience.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz ja nl"/></div></div></a></div><div class="is it gp gr iu nl"><a rel="noopener follow" target="_blank" href="/data-reshaping-in-sql-r-and-python-d44ca19e71b8"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd jk gy z fp nq fr fs nr fu fw ji bi translated">SQL、R和Python中的数据整形</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">从Python vs. R到Python &amp; R</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">towardsdatascience.com</p></div></div><div class="nu l"><div class="oa l nw nx ny nu nz ja nl"/></div></div></a></div></div></div>    
</body>
</html>