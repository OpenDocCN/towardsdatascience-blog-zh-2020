<html>
<head>
<title>Free base-maps for static maps using Geopandas and Contextily</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Geopandas 和 Contextily 为静态地图提供免费底图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/free-base-maps-for-static-maps-using-geopandas-and-contextily-cd4844ff82e1?source=collection_archive---------31-----------------------#2020-06-05">https://towardsdatascience.com/free-base-maps-for-static-maps-using-geopandas-and-contextily-cd4844ff82e1?source=collection_archive---------31-----------------------#2020-06-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7cb1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何在 Python 中添加免费底图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d62779e0bb1bf04b0d84da271058c9f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mm83yBO1oAziq9Um2gZzWQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:https://github.com/darribas/contextily</p></figure><p id="df3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/darribas/contextily" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="lv">context ily</em></strong></a>是 Python 中对上下文瓦片的一个包。在这个快速教程中，我将向您展示如何在 Jupyter Notebook 中使用上下文和 Geopandas 来制作一些漂亮的地图。首先，我们需要确保安装了这些包，在 anaconda 提示符下键入:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="2dfa" class="mb mc it lx b gy md me l mf mg">conda install -c conda-forge geopandas<br/>conda install -c conda-forge contextily</span></pre><p id="c717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我假设你已经安装了 matplotlib 包，如果没有，确保你先安装它。</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="4718" class="mb mc it lx b gy md me l mf mg">conda install -c conda-forge matplotlib</span></pre><p id="f6e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们需要将包导入笔记本:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="1d4b" class="mb mc it lx b gy md me l mf mg">import geopandas as gpd<br/>import contextily as ctx<br/>import matplotlib.pyplot as plt</span></pre><p id="8c9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我将使用北达尔富尔州/苏丹的冲突点数据及其边界形状文件，<strong class="lb iu">该数据和本教程的完整代码可在</strong><a class="ae ky" href="https://github.com/wathela/Contextily-Basemaps" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="lv">Github</em></strong></a><strong class="lb iu"><em class="lv">找到。</em>T19】</strong></p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="00dc" class="mb mc it lx b gy md me l mf mg"># Read in the conflict points and the boundary shape files using geopandas<br/>conf_data = gpd.read_file("NorthDarfurConf.shp")<br/>ND_Boundary = gpd.read_file("NorthDarfurBoundary.shp")</span></pre><p id="56dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了快速浏览数据，您可以简单地打印地理数据帧的标题，以查看它们有哪些列。</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="1860" class="mb mc it lx b gy md me l mf mg">conf_data.columns</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/198a020bd3c6bc51956326a20660298b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0-AVog0cvpGmLECunAW0Og.png"/></div></div></figure><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="f343" class="mb mc it lx b gy md me l mf mg">ND_Boundary.columns</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/70c8807f97f1ec45f52b0ccc66671c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bpphtoZDteRb7gnjka70ug.png"/></div></div></figure><p id="8fb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们只需要冲突地理数据帧中的 event_type 列，它包含所记录事件的类型。显示这些数据只有一行代码:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="daac" class="mb mc it lx b gy md me l mf mg"># we specify the column that is going to be used for the symbology<br/>conf_data.plot(column = 'event_type');</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/5c08bde594e7ba4be6557a29d2aca1f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*LwOVWlBEsEVaxkJfH1HZtg.png"/></div></figure><p id="2633" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使它更好，需要设置一些参数，我们还将使用边界地理数据框架来显示州的边界。但是首先，我们需要定制情节的颜色(如果你已经意识到它是随机生成的)。简单地说，我们将为 even_type 列中的唯一值创建一个字典，并为每个值分配一个唯一的自定义颜色代码。</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="9482" class="mb mc it lx b gy md me l mf mg"># get the uniques values in event_type column<br/>categories = conf_data.event_type.unique()</span><span id="3b54" class="mb mc it lx b gy mj me l mf mg"># create a list for our custom colors<br/>c = ['m', 'k', 'g', 'r', 'y', 'c']</span><span id="95e0" class="mb mc it lx b gy mj me l mf mg"># create a dictionary to combine both lists, categories are keys and # color codes are values<br/>colorDict = dict(zip(categories,c))<br/>print(colorDict)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/e6a0c01c702c97150f3deb2b792e1734.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r6FKjUQlN0e7Mhw2yfdcwg.png"/></div></div></figure><p id="c86c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用自定义颜色绘制我们的点，我们需要按照 event_type 列对 conf_data geo-dataframe 进行分组，以便每个唯一的事件类型都能从颜色字典中获得其指定的颜色。</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="0ea1" class="mb mc it lx b gy md me l mf mg"># plot the state's boundary with black edge color only and line width of 2<br/>ax = ND_Boundary.geometry.boundary.plot(figsize = (10,15), color = None, edgecolor = 'K', linewidth=2)</span><span id="d222" class="mb mc it lx b gy mj me l mf mg"># Loop through each event type group </span><span id="2620" class="mb mc it lx b gy mj me l mf mg">for eventType, data in conf_data.groupby('event_type'):<br/>    color  = colorDict[eventType]<br/>    data.plot(ax = ax,  color = color, label = eventType)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/4d91f3273d814575e3196c1bffe21f81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ymXHv9J2_673ptc34FffOw.png"/></div></div></figure><h1 id="4c6d" class="mm mc it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">上下文地</h1><p id="dc0a" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">现在我们准备探索上下文，看看我们如何使用它在我们的地图中包含一个底图。Contextily 有一个完整的供应商列表。它们都存储为字典，因此您可以在 python 中轻松地浏览和切换它们:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="9b71" class="mb mc it lx b gy md me l mf mg">print(ctx.providers.keys())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/77007aa0c1fdc3af363df47aa03c51d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8mon6kKGCZ_EZgpRDKobWQ.png"/></div></div></figure><p id="3171" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要查看每个提供者包含哪个切片，您可以使用提供者名称来打印其切片。例如，让我们看看开放街道地图提供商有哪些切片:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="33a6" class="mb mc it lx b gy md me l mf mg">print(ctx.providers.OpenStreetMap.keys())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/af41a46dcd6a988c034b399fd675e8ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I7zvIUglLJ15NIMbn_NGgQ.png"/></div></div></figure><p id="a7e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要将基础地图添加到前面的地图中，我们只需将一行代码添加到前面的代码中，其中我们指定:</p><ul class=""><li id="cc5c" class="nk nl it lb b lc ld lf lg li nm lm nn lq no lu np nq nr ns bi translated">轴:以确保我们一起策划一切。</li><li id="df85" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated">坐标参考系统(crs):对于 crs，将使用 conf_data 或 ND_Boundary 的相同 crs(两者具有相同的 crs ),否则它将不起作用。</li><li id="56e4" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated">提供者:例如带有 Mapnik 磁贴的开放街道地图。</li></ul><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="4907" class="mb mc it lx b gy md me l mf mg"># add open street map basemap<br/>ctx.add_basemap(ax, crs = ND_Boundary.crs, url = ctx.providers.OpenStreetMap.Mapnik)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/670c3cdd7cfa61bbc667df54ffdd6114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J4wS5O-RgyDk7SBDx8uf2A.png"/></div></div></figure><p id="4ddb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，将为我们的地图添加一个图例和标题:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="1cd0" class="mb mc it lx b gy md me l mf mg">ax.legend(bbox_to_anchor = (0.31,1), prop={'size':10}) # set legend's position and size</span><span id="93a3" class="mb mc it lx b gy mj me l mf mg">ax.set(title="Conflict in North Darfur/Sudan (1997-2020)") # add a title to the map</span><span id="8153" class="mb mc it lx b gy mj me l mf mg">ax.set_axis_off() # remove the axis ticks <br/>plt.tight_layout() # adjust the padding between figure edges<br/>plt.savefig('norhtDarfur_conf_OSM_Map.png')# Save the map as an image<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/7da0d68bd8964efc31ee41301c4e68dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xdUPGOKLTbfMkMFBp2fD7A.png"/></div></div></figure><p id="a18f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是一些其他提供商:</p><div class="kj kk kl km gt ab cb"><figure class="ny kn nz oa ob oc od paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/138f3485ba2af970c2f1b88e233753a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*HKCNu92yzwTvxGqdrjkaOg.png"/></div></figure><figure class="ny kn oe oa ob oc od paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/e6213a1423d1aa5407a1f7676a23c5af.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*NK68EXWIYuTkenf0sWLR7Q.png"/></div></figure><figure class="ny kn nz oa ob oc od paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/d675aaf9468750897aeae98c8f8a9712.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*q4Wfdyjo6sE6LoTh1z88Cg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk of di og oh translated">从左至右:Esri 世界影像、Esri 地形和开放地形底图。</p></figure></div><h1 id="93e6" class="mm mc it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated"><strong class="ak">参考文献</strong></h1><div class="oi oj gp gr ok ol"><a href="https://geopandas.org/" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">GeoPandas 0.7.0 - GeoPandas 0.7.0 文档</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">GeoPandas 的目标是简化 python 中地理空间数据的处理。它结合了熊猫的能力…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">geopandas.org</p></div></div></div></a></div><div class="oi oj gp gr ok ol"><a href="https://github.com/darribas/contextily" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">达里巴斯/语境地</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">contextily 是一个小的 Python 3 (3.6 及以上版本)包，用于从互联网上检索切片地图。它可以添加那些瓷砖…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">github.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz ks ol"/></div></div></a></div><div class="oi oj gp gr ok ol"><a href="https://data.humdata.org/dataset/acled-data-for-sudan" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">苏丹-冲突数据</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">ACLED 项目代码报告的信息类型，代理人，确切位置，日期和其他特点…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">data.humdata.org</p></div></div><div class="ou l"><div class="pa l ow ox oy ou oz ks ol"/></div></div></a></div></div></div>    
</body>
</html>