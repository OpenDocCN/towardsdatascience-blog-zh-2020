<html>
<head>
<title>NoSQL on the Cloud With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 实现云上的 NoSQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/nosql-on-the-cloud-with-python-55a1383752fc?source=collection_archive---------6-----------------------#2020-08-07">https://towardsdatascience.com/nosql-on-the-cloud-with-python-55a1383752fc?source=collection_archive---------6-----------------------#2020-08-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0bd2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">与 Google Firestore ——(最好的)NoSQL 数据库交流</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2bf97fdf35a9a9193e9bc5e3bc8f0170.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5xCzpAh2Lm49O5K6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@yaoqiqiqilai?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">赖</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="6102" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为数据科学家、机器学习工程师或开发人员，熟悉云是改变游戏规则的技能之一。</p><p id="2b8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论我们在哪个领域工作，数据总是关注的焦点，我们的最终用户紧随其后。一个好的基于云的数据库服务将满足这两种需求。</p><p id="23ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将数据卸载到最终用户能够通过任何人都可以使用的界面访问的位置。这个界面可以是一个网络应用——或者是面向更多技术终端用户的 API。</p><p id="7292" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Firestore 是谷歌的云托管 NoSQL 数据库服务。该服务有几个主要优势，即:</p><ul class=""><li id="3c9f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">灵活的</strong>数据存储(NoSQL)</li><li id="5165" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">本地库支持大多数流行的语言(<strong class="lb iu"> Python </strong>)</li><li id="d72b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">你为<strong class="lb iu">免费</strong>学习(超越免费层限制需要大量数据)</li><li id="b477" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">一切都很简单——我们可以建立一个比煮咖啡还快的数据库</li><li id="4c25" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">认证</strong>(可以)由谷歌处理，我们以最少的工作实现最大的安全性</li><li id="345b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">自动缩放</strong>以满足需求</li><li id="de21" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">直观的文档</strong>，可能是三大云提供商(Azure、AWS、GCP)中最好的</li></ul><p id="b11e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将设置我们的 Firebase 项目(托管 Firestore 的平台)，使用 web-UI 创建一个数据库，并创建一个执行所有基本 Firestore 功能的简单 Python 脚本。它看起来会像这样:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="543e" class="mo mp it mk b gy mq mr l ms mt"><strong class="mk iu">In Firebase</strong><br/>&gt; Create a Project<br/>&gt; Initialize Database<br/>&gt; Get Credentials<br/><strong class="mk iu">In Python</strong><br/>&gt; Install <strong class="mk iu">gcloud </strong>Libraries (+ venv)<br/>&gt; Authenticate<br/>&gt; Connect to Firestore<br/>&gt; Get<br/>&gt; Create<br/>&gt; Modify<br/>&gt; Delete<br/>&gt; Queries</span></pre><p id="8713" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始吧。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="fd5a" class="nb mp it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">重火力点</h1><h2 id="7e09" class="mo mp it bd nc ns nt dn ng nu nv dp nk li nw nx nm lm ny nz no lq oa ob nq oc bi translated">创建项目</h2><p id="0a6b" class="pw-post-body-paragraph kz la it lb b lc od ju le lf oe jx lh li of lk ll lm og lo lp lq oh ls lt lu im bi translated">幸运的是，谷歌擅长让事情变得简单。进入<a class="ae ky" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase 网站</a>并点击大<strong class="lb iu">开始</strong>按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/e126854cd9f3d447713bff1cf96c04ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BJL1NH9v4lHWr_H6RetzkQ.png"/></div></div></figure><p id="991f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在应该看到上面的“欢迎使用 Firebase”页面——创建一个项目，并给它起一个很酷的名字(它应该也与您的项目相关)。</p><p id="40ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我把它命名为“反重力”。</p><p id="2025" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到一个窗口，询问我们是否希望启用 Google Analytics——这完全是您的选择，我们不会使用它，但它也不会花费您任何费用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/a310c6d5cd92d811b03e19b90b366c3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TCVsMYlN1Pi_FjPdWjv4bA.png"/></div></div></figure><p id="6f23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的项目将初始化，单击<strong class="lb iu">继续，</strong>我们将进入新项目的项目概述页面。</p><h2 id="37b7" class="mo mp it bd nc ns nt dn ng nu nv dp nk li nw nx nm lm ny nz no lq oa ob nq oc bi translated">初始化数据库</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/bd8129c43d2d2b51d0c89299c90618c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gy_Xo7Bsvb-akxaza7F-yw.png"/></div></div></figure><p id="d061" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了初始化我们的 Firestore 数据库，我们导航到侧栏并单击<strong class="lb iu">开发</strong> &gt; <strong class="lb iu">数据库</strong>。在这里，我们将看到上面的“云 Firestore”页面—单击<strong class="lb iu">创建数据库</strong>。</p><p id="d40b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们将被询问是以生产模式还是测试模式开始。我们将使用<strong class="lb iu">测试模式</strong>。</p><p id="9db6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，选择您的位置——这是您或您的用户请求数据的地方，所以选择最近的选项！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/e7660d79ff6e364947a40e942dcae13a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6hu4psScFZmi6s_4-MZrvA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">点击<strong class="bd om">开始收藏</strong>添加“地点”收藏和“罗马”文档——这也是真正的旅行建议。</p></figure><p id="dd23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以访问我们的数据库。对于本教程，我们需要一个名为“places”的集合和一个名为“rome”的文档，如上所示——只需点击<strong class="lb iu"> Start collection </strong>来添加它们(<code class="fe on oo op mk b">where_to_go</code>是一个数组)。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="69e4" class="nb mp it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">移交给 Python</h1><h2 id="2585" class="mo mp it bd nc ns nt dn ng nu nv dp nk li nw nx nm lm ny nz no lq oa ob nq oc bi translated">安装依赖项</h2><p id="168c" class="pw-post-body-paragraph kz la it lb b lc od ju le lf oe jx lh li of lk ll lm og lo lp lq oh ls lt lu im bi translated">我们需要 pip 安装<code class="fe on oo op mk b">firebase_admin</code>包:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="63c9" class="mo mp it mk b gy mq mr l ms mt">pip install firebase-admin</span></pre><p id="0ab7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于 Python 以上的任何版本，当将<code class="fe on oo op mk b">firebase_admin</code>导入到我们的脚本时，我们都会收到一个语法错误:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/26596d9711e708ea3ab209db01e94aeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FpryJ3JPW9XvJ4n0DNhGEw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如果使用从 3.7 开始的任何版本的 Python，我们将引发一个<strong class="bd om">语法错误</strong>。</p></figure><p id="b576" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python 3.7 中添加了<code class="fe on oo op mk b">async</code>标识符，打破了<code class="fe on oo op mk b">firebase_admin</code>模块。我们有两个选择:</p><ol class=""><li id="dcea" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu or mb mc md bi translated">修改<code class="fe on oo op mk b">firebase_admin</code>，用<code class="fe on oo op mk b">_async</code> <em class="os">(或者你选择的任何关键字)</em>替换<code class="fe on oo op mk b">async</code>的每一个实例。</li><li id="fe61" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu or mb mc md bi translated">通过虚拟环境(venv)使用 Python 3.6。</li></ol><p id="3a9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选项(1)可能是个坏主意。因此，让我们快速介绍一个使用 Anaconda 的 venv 设置(关于如何在其他环境中使用，请咨询 Google 或我)。</p><p id="0b36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开 Anaconda 提示符并创建一个新的 venv(我们称之为<code class="fe on oo op mk b">fire36</code>):</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="8b8b" class="mo mp it mk b gy mq mr l ms mt">conda create --name fire36 python</span></pre><p id="593b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">启动 venv 并安装<code class="fe on oo op mk b">firebase_admin</code>组件:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="cbaa" class="mo mp it mk b gy mq mr l ms mt">conda activate fire36<br/>pip install firebase_admin</span></pre><p id="9422" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您使用 Jupyter 或 Spyder，只需输入<code class="fe on oo op mk b">jupyter</code> | <code class="fe on oo op mk b">jupyter lab</code> | <code class="fe on oo op mk b">spyder</code>就可以使用这个 venv 编写代码。PyCharm 和 VSCode 也可以使用这个 venv。</p><h2 id="2b33" class="mo mp it bd nc ns nt dn ng nu nv dp nk li nw nx nm lm ny nz no lq oa ob nq oc bi translated">鉴定</h2><p id="1d47" class="pw-post-body-paragraph kz la it lb b lc od ju le lf oe jx lh li of lk ll lm og lo lp lq oh ls lt lu im bi translated">要访问 Firestore，我们需要大量凭证。谷歌再次让这变得简单。</p><p id="c044" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase 控制台</a>中导航到您的项目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/216db2addc27ad1f5e7d9f978736cf78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-O9V0q6ygGNH7HLKjBzvyw.png"/></div></div></figure><p id="939c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在左上角的“项目概述”旁边，点击齿轮图标并选择<strong class="lb iu">项目设置</strong>。</p><p id="e49c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们单击“服务帐户”选项卡，在这里可以找到关于使用 Firebase Admin SDK 进行身份验证的说明。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/7657b7937af46a9cde460c47f513e9aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bPctLSsYV3eoI3-PjSquMQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">点击<strong class="bd om">生成新的私有密钥</strong>以 JSON 文件的形式下载我们的凭证。</p></figure><p id="b95c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们需要点击<strong class="lb iu">生成新的私钥</strong>。我们下载该文件，将其重命名为<code class="fe on oo op mk b">serviceAccountKey.json</code>(或其他名称)，并将其存储在 Python 脚本可访问的位置。</p><p id="1196" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe on oo op mk b">serviceAccountKey.json</code>存储在同一个目录中进行测试是可以的——但是保持 JSON 内容的私有性。<em class="os"> Public GitHub repos 是一个可怕的</em> <strong class="lb iu"> <em class="os"> </em> </strong> <em class="os">的地方，为凭据。</em></p><p id="e8c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在同一个 Firebase Admin SDK 页面上，我们可以将 Python 代码复制并粘贴到脚本的顶部。我们需要做的就是更新到<code class="fe on oo op mk b">serviceAccountKey.json</code>的路径，并将<code class="fe on oo op mk b">firestore</code>添加到我们的导入中——我们的脚本应该是这样的:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="aec5" class="mo mp it mk b gy mq mr l ms mt">import firebase_admin<br/>from firebase_admin import credentials, <strong class="mk iu">firestore</strong></span><span id="1846" class="mo mp it mk b gy ov mr l ms mt">cred = credentials.Certificate(<strong class="mk iu">"path/to/serviceAccountKey.json"</strong>)<br/>firebase_admin.initialize_app(cred)</span></pre><p id="c4f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们认证所需要的一切。现在我们(终于)开始写一些代码了！</p><h2 id="cd43" class="mo mp it bd nc ns nt dn ng nu nv dp nk li nw nx nm lm ny nz no lq oa ob nq oc bi translated">连接到 Firestore</h2><p id="dad4" class="pw-post-body-paragraph kz la it lb b lc od ju le lf oe jx lh li of lk ll lm og lo lp lq oh ls lt lu im bi translated">我们的联系有三层:</p><blockquote class="ow ox oy"><p id="5fa3" class="kz la os lb b lc ld ju le lf lg jx lh oz lj lk ll pa ln lo lp pb lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">数据库&gt;收藏&gt;文档</em> </strong></p></blockquote><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="e623" class="mo mp it mk b gy mq mr l ms mt">db = firestore.client()  # this connects to our Firestore database<br/>collection = db.collection('places')  # opens 'places' collection<br/>doc = collection.document('rome')  # specifies the 'rome' document</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/4636ac33d8d49a8e4eebd32b388ce64c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iaYWsG-SRd3Y8dukd6LZoQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们依次访问每一层——从<strong class="bd om">数据库</strong>(反重力-207f8) &gt; <strong class="bd om">集合</strong>(地点)&gt; <strong class="bd om">文档</strong>(罗马)。</p></figure><p id="3a95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每一层都有自己的一套方法，允许我们在数据库、集合或文档级别执行不同的操作。</p><h2 id="0fed" class="mo mp it bd nc ns nt dn ng nu nv dp nk li nw nx nm lm ny nz no lq oa ob nq oc bi translated">得到</h2><p id="4990" class="pw-post-body-paragraph kz la it lb b lc od ju le lf oe jx lh li of lk ll lm og lo lp lq oh ls lt lu im bi translated">我们使用<strong class="lb iu"> get </strong>方法来检索数据。让我们用这个方法得到我们的<code class="fe on oo op mk b">rome</code>文档:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="efcd" class="mo mp it mk b gy mq mr l ms mt">doc = collection.document('rome')<br/>res = doc<strong class="mk iu">.get()</strong>.to_dict()<br/>print(res)</span><span id="8036" class="mo mp it mk b gy ov mr l ms mt"><strong class="mk iu">[Out]:</strong> {<br/>    'lat': 41.9028, 'long': 12.4964,<br/>    'where_to_go': [<br/>        'villa_borghese',<br/>        'trastevere',<br/>        'vatican_city'<br/>    ]<br/>}</span></pre><p id="4c7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以对<code class="fe on oo op mk b">collection</code>执行<code class="fe on oo op mk b">.get()</code>操作，返回包含其中所有文档的数组。如果我们有两个文档，它看起来会像这样:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="a38f" class="mo mp it mk b gy mq mr l ms mt">docs = collection<strong class="mk iu">.get()</strong><br/>print(docs)</span><span id="e0d5" class="mo mp it mk b gy ov mr l ms mt"><strong class="mk iu">[Out]: </strong>[<br/>  &lt;google.cloud.firestore_v1.document.DocumentSnapshot object ...&gt;, <br/>  &lt;google.cloud.firestore_v1.document.DocumentSnapshot object ...&gt;<br/>]</span></pre><p id="0bb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些文档被存储为 DocumentSnapshot 对象——与我们在使用上面的<code class="fe on oo op mk b">.document(&lt;doc-id&gt;).get()</code>方法时收到的对象类型相同。和第一个<code class="fe on oo op mk b">get</code>例子一样——我们可以使用<code class="fe on oo op mk b">.to_dict()</code>将这些对象转换成字典。</p><h2 id="d907" class="mo mp it bd nc ns nt dn ng nu nv dp nk li nw nx nm lm ny nz no lq oa ob nq oc bi translated">创造</h2><p id="082a" class="pw-post-body-paragraph kz la it lb b lc od ju le lf oe jx lh li of lk ll lm og lo lp lq oh ls lt lu im bi translated">我们在<code class="fe on oo op mk b">collection</code>上使用<code class="fe on oo op mk b">.document(&lt;doc-id&gt;)</code>和<code class="fe on oo op mk b">.set()</code>方法创建文档。<code class="fe on oo op mk b">.set()</code>方法获取一个字典，其中包含我们希望存储在新<code class="fe on oo op mk b">&lt;doc-id&gt;</code>中的所有数据，如下所示:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="1d50" class="mo mp it mk b gy mq mr l ms mt">res = collection.document('barcelona')<strong class="mk iu">.set(</strong>{<br/>    'lat': 41.3851, 'long': 2.1734,<br/>    'weather': 'great',<br/>    'landmarks': [<br/>        'guadí park',<br/>        'gaudí church',<br/>        'gaudí everything'<br/>    ]<br/>}<strong class="mk iu">)</strong><br/>print(res)</span><span id="ce3b" class="mo mp it mk b gy ov mr l ms mt"><strong class="mk iu">[Out]:</strong> update_time {<br/>    seconds: 1596532394<br/>    nanos: 630200000<br/>}</span></pre><p id="6c00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果操作成功，我们将在响应中收到<code class="fe on oo op mk b">update_time</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/f3bbf826fcaf180939f170fdc9f3ea89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uZd9B5OKfsWQgwJghLvPkw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新数据将出现在我们的 Firestore GUI 上。</p></figure><p id="fb59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过导航回 Firestore 界面，我们可以看到如上所示的新文档数据。</p><h2 id="9ad8" class="mo mp it bd nc ns nt dn ng nu nv dp nk li nw nx nm lm ny nz no lq oa ob nq oc bi translated">修改</h2><p id="7f67" class="pw-post-body-paragraph kz la it lb b lc od ju le lf oe jx lh li of lk ll lm og lo lp lq oh ls lt lu im bi translated">有时，我们需要修改现有的文档，而不是创建一个全新的文档。有几种方法可以做到这一点，这取决于我们想要改变什么。</p><p id="8d2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更新完整的键-值对，我们使用<code class="fe on oo op mk b">update</code>:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="dc53" class="mo mp it mk b gy mq mr l ms mt">res = collection.document('barcelona')<strong class="mk iu">.update(</strong>{<br/>    'weather': 'sun'<br/>}<strong class="mk iu">)</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/f44a4f7aa507f862b0102579220130b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mhN45foGW3s9y9MCfUhrng.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd om"> update </strong>方法允许我们只修改语句中的键值对。</p></figure><p id="b5ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe on oo op mk b">update</code>方法适用于大多数值，但是当我们只想添加或删除数组中的一个条目时，它就没那么有用了。这里我们使用<code class="fe on oo op mk b">firestore.ArrayUnion</code>和<code class="fe on oo op mk b">firestore.ArrayRemove</code>方法分别添加和删除单个数组值，如下所示:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="b4b8" class="mo mp it mk b gy mq mr l ms mt">collection.document('rome').update({<br/>    'where_to_go': <strong class="mk iu">firestore.ArrayUnion(</strong>['colosseum']<strong class="mk iu">)</strong><br/>})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/b9bc5e9c58a3fc23f9c1637eeb82086a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BxsQQwVwfjg5CjSLoMZV7w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们已经更新了<strong class="bd om"> where_to_go </strong>数组以包含<strong class="bd om">斗兽场</strong>。</p></figure><p id="9c88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">移除<code class="fe on oo op mk b">vatican_city</code>和<code class="fe on oo op mk b">trastevere</code>:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="f7e1" class="mo mp it mk b gy mq mr l ms mt">collection.document('rome').update({<br/>    'where_to_go': <strong class="mk iu">firestore.ArrayRemove(<br/>        </strong>['vatican_city', 'trastevere']<br/><strong class="mk iu">)</strong>})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/f4c25a3c587a8ca57560a1aa3941d671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G8k0R7bH6x3mahMb_FkH_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从<strong class="bd om">去向</strong>阵列中移除<strong class="bd om">梵蒂冈城</strong>和<strong class="bd om">斗兽场</strong>后。</p></figure><h2 id="78bb" class="mo mp it bd nc ns nt dn ng nu nv dp nk li nw nx nm lm ny nz no lq oa ob nq oc bi translated">删除</h2><p id="79dc" class="pw-post-body-paragraph kz la it lb b lc od ju le lf oe jx lh li of lk ll lm og lo lp lq oh ls lt lu im bi translated">其他时候，我们可能需要删除全部文档。我们用<code class="fe on oo op mk b">delete</code>方法来做这件事:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="57d7" class="mo mp it mk b gy mq mr l ms mt">collection.document('rome')<strong class="mk iu">.delete()</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/e28c1c34dfb62a2f90dcdd04a0264d4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H7_Qne8GzT_EJHtABU6-og.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的 Firestore 数据库不再包含罗马文件。</p></figure><p id="0c18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们想删除文档中的单个字段，我们可以像这样使用<code class="fe on oo op mk b">firestore.DELETE_FIELD</code>:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="0126" class="mo mp it mk b gy mq mr l ms mt">collection.document('barcelona').update({<br/>    'weather': <strong class="mk iu">firestore.DELETE_FIELD</strong>})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/a053382fc0fc13fb0bcffb2ebba46305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9AaUBcAj11whdJ0G31Oxg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd om">巴塞罗那</strong>文档不再包含<strong class="bd om">天气</strong>字段。</p></figure><h2 id="328a" class="mo mp it bd nc ns nt dn ng nu nv dp nk li nw nx nm lm ny nz no lq oa ob nq oc bi translated">询问</h2><p id="0793" class="pw-post-body-paragraph kz la it lb b lc od ju le lf oe jx lh li of lk ll lm og lo lp lq oh ls lt lu im bi translated">更进一步，我们可以具体说明我们到底想要什么。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/720adcc2a54728be0143c96ea425e1ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_gNV3v0ADzYY_6U2XE8DxA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的 Firestore 现在包含巴塞罗那、布里斯班、纽约和罗马的条目。</p></figure><p id="0387" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个例子，我们已经向 Firestore 添加了几个全球城市(添加它们的代码是<a class="ae ky" href="https://gist.github.com/jamescalam/854a71460ce31be1bcdd4fc40a49ef0b" rel="noopener ugc nofollow" target="_blank">这里是</a>)。</p><p id="fd7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将查询欧洲范围内的所有城市——我们将这些城市定义为经度大于<em class="os"> -9.4989 </em>(西方)且小于<em class="os"> 33.4299 </em>(东方)的城市。为了简单起见，我们将忽略纬度。</p><p id="38b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了查询我们的 Firestore，我们在集合对象上使用了<code class="fe on oo op mk b">where</code>方法。该方法有三个参数，<code class="fe on oo op mk b">where(fieldPath, opStr, value)</code>:</p><ul class=""><li id="14cc" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe on oo op mk b">fieldPath</code> —我们的目标区域，在本例中为<code class="fe on oo op mk b">'long'</code></li><li id="f853" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe on oo op mk b">opStr</code> —比较操作字符串，<code class="fe on oo op mk b">'=='</code>检查相等性</li><li id="a42b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe on oo op mk b">value</code> —我们要比较的价值</li></ul><p id="8698" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的查询将返回任何真值。对于我们的示例，我们将找到包含<code class="fe on oo op mk b">long &gt; 9.4989</code>的文档，我们写为:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="2f65" class="mo mp it mk b gy mq mr l ms mt">collection<strong class="mk iu">.where('long', '&gt;', 9.4989)</strong>.get()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/213e436e2266f4ae9666e99fe8455b5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MTA3wpy-RluGaq5ioEXRwg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从我们的<strong class="bd om"> long &gt; 9.4989 </strong>查询返回的所有文档。</p></figure><p id="0cf8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个查询，我们返回<code class="fe on oo op mk b">barcelona</code>、<code class="fe on oo op mk b">rome</code>和<code class="fe on oo op mk b">brisbane</code>——但是我们也需要排除欧洲东部的任何东西。我们可以通过添加另一个<code class="fe on oo op mk b">where</code>方法来做到这一点，如下所示:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="4f5c" class="mo mp it mk b gy mq mr l ms mt">collection<strong class="mk iu">.where('long', '&gt;', -9.4989)</strong> \<strong class="mk iu"><br/>          .where('long', '&lt;', 33.4299)</strong>.get()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/262570adb9b768ea2827886cdfa49954.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PN6N_ni8_K_iJXQmy6Q-3w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从我们的<strong class="bd om"> long &gt; 9.4989 和 long &lt; 33.4299 </strong>查询返回的所有文档。</p></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="3bc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是对谷歌 Firestore 的介绍。对于简单、安全和健壮的基于云的数据库，Firestore 真的很棒。</p><p id="be1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，云计算不仅仅是数据存储。AWS 和 Azure 都很棒，但 GCP Firebase 配置的易用性是其他任何产品无法比拟的。</p><p id="76f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需很少的时间，就可以轻松学会构建完整应用程序所需的一切，从前端 UI 到数据存储设置。</p><p id="0565" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果云对你来说有些陌生，不要犹豫，马上加入——这是一项非常宝贵的技能，不容错过。</p><p id="ba03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有任何建议或者想和我讨论 Firestore——或者开始使用云——请随时在 Twitter 上或者在下面的评论中联系我。</p><p id="5c0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="fa47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有兴趣了解更多的另一面吗？请随意阅读我对 Angular 的介绍——这是一个神奇而简单的前端框架:</p><div class="pm pn gp gr po pp"><a rel="noopener follow" target="_blank" href="/how-to-use-angular-to-deploy-tensorflow-web-apps-5675b5a042cc"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd iu gy z fp pu fr fs pv fu fw is bi translated">如何使用 Angular 部署 TensorFlow Web 应用程序</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">在角度构建的 web 应用程序中使用 Python 构建的模型</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">towardsdatascience.com</p></div></div><div class="py l"><div class="pz l qa qb qc py qd ks pp"/></div></div></a></div></div></div>    
</body>
</html>