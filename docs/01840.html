<html>
<head>
<title>RetinaNet: Custom Object Detection training with 5 lines of code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RetinaNet:用 5 行代码进行自定义对象检测训练</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/retinanet-custom-object-detection-training-with-5-lines-of-code-37442640d142?source=collection_archive---------17-----------------------#2020-02-20">https://towardsdatascience.com/retinanet-custom-object-detection-training-with-5-lines-of-code-37442640d142?source=collection_archive---------17-----------------------#2020-02-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dde7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Monk，低代码深度学习工具和计算机视觉的统一包装器，使计算机视觉变得简单。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/8059885d04904974f7566411458ef4e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*rgqqp-TlhdoIlEZK1nfhog.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">室内物体检测</p></figure><p id="400a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<a class="ae lq" href="https://medium.com/@akulahemanth/custom-object-detection-using-efficientdet-the-simplest-way-32749fb93359" rel="noopener">之前的文章</a>中，我们已经使用<a class="ae lq" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection" rel="noopener ugc nofollow" target="_blank">和尚</a>的 EfficientDet 构建了一个自定义的对象检测器。在本文中，我们将使用<a class="ae lq" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection" rel="noopener ugc nofollow" target="_blank">和尚</a>的 RetinaNet 构建一个室内物体检测器，构建于<a class="ae lq" href="https://github.com/yhenon/pytorch-retinanet" rel="noopener ugc nofollow" target="_blank"> PyTorch RetinaNet </a>之上。</p><p id="f070" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如今，从自动驾驶汽车到监控摄像头等等，计算机视觉无处不在。要开始学习计算机视觉，我们必须学习各种深度学习框架，如 TensorFlow、PyTorch 和 Mxnet，这是一个乏味的过程。</p><p id="48cd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">借此机会，我想向您介绍一下<a class="ae lq" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection" rel="noopener ugc nofollow" target="_blank"> Monk </a>，这是一个功能齐全、低代码、易于安装的对象检测管道。</p><div class="lr ls gp gr lt lu"><a href="https://github.com/Tessellate-Imaging/Monk_Object_Detection" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd iu gy z fp lz fr fs ma fu fw is bi translated">镶嵌成像/Monk_Object_Detection</h2><div class="mb l"><h3 class="bd b gy z fp lz fr fs ma fu fw dk translated">低代码、易于安装的对象检测管道的一站式存储库。</h3></div><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">github.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi ko lu"/></div></div></a></div><blockquote class="mj"><p id="f76c" class="mk ml it bd mm mn mo mp mq mr ms lp dk translated">我们开始吧！！</p></blockquote></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="306a" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated"><strong class="ak">目录</strong></h1><ol class=""><li id="0e03" class="ns nt it kw b kx nu la nv ld nw lh nx ll ny lp nz oa ob oc bi translated"><strong class="kw iu">数据收集</strong></li><li id="4d50" class="ns nt it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated"><strong class="kw iu">转换为 COCO 格式</strong></li><li id="c8a2" class="ns nt it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated"><strong class="kw iu">培训模式</strong></li><li id="9ed1" class="ns nt it kw b kx od la oe ld of lh og ll oh lp nz oa ob oc bi translated"><strong class="kw iu">检测对象检测器</strong></li></ol></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="b93e" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated"><strong class="ak">数据收集</strong></h1><p id="fb39" class="pw-post-body-paragraph ku kv it kw b kx nu ju kz la nv jx lc ld oi lf lg lh oj lj lk ll ok ln lo lp im bi translated">这里我们使用的是<a class="ae lq" href="https://storage.googleapis.com/openimages/web/index.html" rel="noopener ugc nofollow" target="_blank"> OpenImages </a>。使用<a class="ae lq" href="https://github.com/EscVM/OIDv4_ToolKit" rel="noopener ugc nofollow" target="_blank"> OIDv4_ToolKit </a>收集数据。我从数据集中选择了 25 个类，你可以随意选择。</p><p id="5f3d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用于收集数据的命令示例</p><pre class="kj kk kl km gt ol om on oo aw op bi"><span id="09d6" class="oq nb it om b gy or os l ot ou">python main.py downloader --classes Apple Orange --type_csv validation</span></pre><p id="0bb0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开命令提示符，运行以下命令从整个数据集中收集 Alarm_clock 类。您可以使用这个过程来下载其他类。</p><pre class="kj kk kl km gt ol om on oo aw op bi"><span id="f36e" class="oq nb it om b gy or os l ot ou">$ git clone <a class="ae lq" href="https://github.com/EscVM/OIDv4_ToolKit" rel="noopener ugc nofollow" target="_blank">https://github.com/EscVM/OIDv4_ToolKit</a><br/>$ cd OIDv4_ToolKit<br/>$ python main.py downloader --classes Alarm_clock --type_csv train<br/>$ mv OID/Dataset/train/Alarm\ clock OID/Dataset/train/Alarm_clock<br/></span></pre><p id="784e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以使用直接下载格式化的数据集</p><pre class="kj kk kl km gt ol om on oo aw op bi"><span id="3a45" class="oq nb it om b gy or os l ot ou">$ wget --load-cookies /tmp/cookies.txt "https://docs.google.com/uc?export=download&amp;confirm=$(wget --save-cookies /tmp/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&amp;id=1bXzK3SYRCoUj9-zsiLOSWM86LJ6z9p0t' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/<strong class="om iu">\1\n</strong>/p')&amp;id=1bXzK3SYRCoUj9-zsiLOSWM86LJ6z9p0t" -O OIDv4_ToolKit.zip &amp;&amp; rm -rf /tmp/cookies.txt</span></pre></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="6d6c" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated"><strong class="ak">转换为 COCO 格式</strong></h1><p id="056f" class="pw-post-body-paragraph ku kv it kw b kx nu ju kz la nv jx lc ld oi lf lg lh oj lj lk ll ok ln lo lp im bi translated"><strong class="kw iu"> COCO 格式</strong></p><pre class="kj kk kl km gt ol om on oo aw op bi"><span id="14fc" class="oq nb it om b gy or os l ot ou">./ (root_dir)<br/>      |<br/>      |------Dataset (coco_dir) <br/>              |<br/>              |------Images (set_dir)<br/>              |         |<br/>              |         |----Alarm_clock<br/>              |                 |<br/>              |                 |---------img1.jpg<br/>              |                 |---------img2.jpg<br/>              |                 |---------..........(and so on)<br/>              |<br/>              |         |-----Curtain<br/>              |                 |<br/>              |                 |---------img1.jpg<br/>              |                 |---------img2.jpg<br/>              |                 |---------..........(and so on)<br/>              |<br/>              |         |-----...........(and so on)<br/>              |<br/>              |<br/>              |<br/>              |------annotations <br/>              |----------|<br/>                         |--------------------instances_Images.json  (instances_&lt;set_dir&gt;.json)<br/>                         |--------------------classes.txt</span></pre><ul class=""><li id="58ab" class="ns nt it kw b kx ky la lb ld ov lh ow ll ox lp oy oa ob oc bi translated">instances_Train.json -&gt;正确的 COCO 格式</li><li id="158e" class="ns nt it kw b kx od la oe ld of lh og ll oh lp oy oa ob oc bi translated">classes.txt -&gt;按字母顺序排列的类列表</li></ul><p id="aa22" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于列车组</p><ul class=""><li id="f8de" class="ns nt it kw b kx ky la lb ld ov lh ow ll ox lp oy oa ob oc bi translated">root _ dir = " oid v4 _ ToolKit/OID/"；</li><li id="24af" class="ns nt it kw b kx od la oe ld of lh og ll oh lp oy oa ob oc bi translated">coco _ dir = " Dataset</li><li id="83b0" class="ns nt it kw b kx od la oe ld of lh og ll oh lp oy oa ob oc bi translated">img_dir = "。/";</li><li id="c985" class="ns nt it kw b kx od la oe ld of lh og ll oh lp oy oa ob oc bi translated">set _ dir = " Images</li></ul><p id="1388" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:注释文件名与 set_dir 一致</p><p id="ef29" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">我们通过 Monk 格式</strong>转换成 COCO 格式</p><p id="3aad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">1.从当前格式转换为 Monk 格式。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="12ec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">2.从 Monk 格式转换为 COCO 格式</p><p id="faf3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行 classes.txt</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="1855" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于。“json”文件运行</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="04bd" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated"><strong class="ak">培训模式</strong></h1><p id="2204" class="pw-post-body-paragraph ku kv it kw b kx nu ju kz la nv jx lc ld oi lf lg lh oj lj lk ll ok ln lo lp im bi translated">我们选择“resnet50”来进行这个实验。您可以按照代码中的建议设置超参数。如果你使用的是 GPU，那么设置 use_gpu=True，默认为 False。我们使用 4 个 GPU，所以 gpu_devices=[0，1，2，3]。如果您使用的是一个 GPU，请更改 gpu_devices=[0]。用'设置时期数和型号名称。pt '分机。</p><p id="6f6a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如标题中提到的，我们只需要 5 行代码进行训练，这里是 Train.py</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="ba8b" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated"><strong class="ak">检测物体探测器</strong></h1><p id="7c1a" class="pw-post-body-paragraph ku kv it kw b kx nu ju kz la nv jx lc ld oi lf lg lh oj lj lk ll ok ln lo lp im bi translated">在训练模型之后，我们可以得到权重文件。加载重量并开始预测。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="db80" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一些形象的推论，你可以看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="pc pd di pe bf pf"><div class="gh gi pb"><img src="../Images/c2fb3ec124686c76efd3817e979fcad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e4kszave-R6KBZ4RQHZaeQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">推论 1</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="pc pd di pe bf pf"><div class="gh gi pg"><img src="../Images/eb76ca4eca628e3c5b3062bd583cec13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3iznHW-D9pCCdJsE5jHMQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">推论 2</p></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="5774" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在<a class="ae lq" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection/blob/master/application_model_zoo/Example%20-%20Indoor%20Image%20Object%20Detection%20and%20Tagging.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到完整的代码。如果你喜欢蒙克，给我们 GitHub 回购⭐️。</p><p id="60f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个实验中，我们使用 Retinanet 创建了一个自定义对象检测，只需要基本的编程技能，甚至不需要了解架构和 PyTorch 框架。</p><p id="dbbf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有关自定义对象检测的更多示例，请查看</p><div class="lr ls gp gr lt lu"><a href="https://github.com/Tessellate-Imaging/Monk_Object_Detection/tree/master/example_notebooks" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd iu gy z fp lz fr fs ma fu fw is bi translated">镶嵌成像/Monk_Object_Detection</h2><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">github.com</p></div></div><div class="md l"><div class="ph l mf mg mh md mi ko lu"/></div></div></a></div><p id="ac41" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有问题可以联系<a class="ae lq" href="https://www.linkedin.com/in/abhishek-kumar-annamraju/" rel="noopener ugc nofollow" target="_blank"> Abhishek </a>和<a class="ae lq" href="https://www.linkedin.com/in/akashdeepsingh01/" rel="noopener ugc nofollow" target="_blank"> Akash </a>。请随意联系他们。</p><p id="baf1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我对计算机视觉和深度学习充满热情。我是<a class="ae lq" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection" rel="noopener ugc nofollow" target="_blank"> Monk </a>库的开源贡献者。</p><p id="d3f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你也可以在以下网址看到我的其他作品:</p><div class="lr ls gp gr lt lu"><a href="https://medium.com/@akulahemanth" rel="noopener follow" target="_blank"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd iu gy z fp lz fr fs ma fu fw is bi translated">阿库拉·赫曼思·库马尔培养基</h2><div class="mb l"><h3 class="bd b gy z fp lz fr fs ma fu fw dk translated">阅读阿库拉·赫曼思·库马尔在媒介上的作品。计算机视觉爱好者。每天，阿库拉·赫曼思·库马尔和…</h3></div><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">medium.com</p></div></div><div class="md l"><div class="pi l mf mg mh md mi ko lu"/></div></div></a></div></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="pc pd di pe bf pf"><div class="gh gi pj"><img src="../Images/75bc43faf7656e918f2477df160a437f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J2MG7OzYBzOCiIFrWC3lkw.jpeg"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">照片由<a class="ae lq" href="https://www.instagram.com/_fernwehd_._/" rel="noopener ugc nofollow" target="_blank"> Srilekha </a>拍摄</p></figure></div></div>    
</body>
</html>