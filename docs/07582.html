<html>
<head>
<title>Now, Load huge datasets within a second ⚡ using lazy computation😴 in Python?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现在，使用惰性计算在一秒钟内加载巨大的数据集😴用Python？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/now-load-huge-datasets-within-a-second-using-lazy-computation-in-python-2698bdb02250?source=collection_archive---------51-----------------------#2020-06-07">https://towardsdatascience.com/now-load-huge-datasets-within-a-second-using-lazy-computation-in-python-2698bdb02250?source=collection_archive---------51-----------------------#2020-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c530" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">厌倦了用pandas加载数据集…了解Vaex如何通过Python实现在几秒钟内加载大量数据。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/3f0b640566add4f4094accde4b924831.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*WRB-xOpyNsDEzuGoLnbGyg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">来源:https://vaex.readthedocs.io/en/latest/tutorial.html</p></figure><p id="10da" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">本文简要介绍了如何使用Vaex将大数据集加载到Python内核中，并给出了实际的实现。让我们开始吧。在深入真正的实现之前，让我们了解一下什么是Vaex。</p><h2 id="5201" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">Vaex是什么？</h2><ol class=""><li id="d3b1" class="mk ml it kx b ky mm lb mn le mo li mp lm mq lq mr ms mt mu bi translated">Vaex是一个高性能的Python库，用于懒惰的核外数据帧(类似于Pandas)，以可视化和探索大型表格数据集。</li><li id="2a86" class="mk ml it kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated">它在一个n维网格上每秒计算超过10亿(10⁹)个样本/行的统计数据，如平均值、总和、计数、标准偏差等。</li><li id="57cf" class="mk ml it kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated">可视化是使用直方图、密度图和3d体绘制完成的，允许对大数据进行交互式探索。Vaex使用内存映射、零内存复制策略和惰性计算来获得最佳性能(不浪费内存)。</li></ol><p id="68cb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">看完这篇文章，我建议你去这里 看看Vaex<a class="ae ku" href="https://vaex.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">T3的文档</a></p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h2 id="2e93" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">下载和安装包</h2><p id="ecb3" class="pw-post-body-paragraph kv kw it kx b ky mm ju la lb mn jx ld le nh lg lh li ni lk ll lm nj lo lp lq im bi translated">第一步是使用任何包管理器如<strong class="kx iu"> pip </strong>或<strong class="kx iu"> conda </strong>下载并安装<strong class="kx iu"> vaex </strong>库。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="0a03" class="lr ls it nl b gy np nq l nr ns">pip install vaex</span></pre><p id="c932" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">或者</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="35b1" class="lr ls it nl b gy np nq l nr ns">conda install -c conda-forge vaex</span></pre><blockquote class="nt nu nv"><p id="2260" class="kv kw nw kx b ky kz ju la lb lc jx ld nx lf lg lh ny lj lk ll nz ln lo lp lq im bi translated">记得用“！”如果您直接将它输入到iPython环境中，请在命令之前。</p></blockquote></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h2 id="e290" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">导入包</h2><p id="5cd9" class="pw-post-body-paragraph kv kw it kx b ky mm ju la lb mn jx ld le nh lg lh li ni lk ll lm nj lo lp lq im bi translated">现在，我们需要使用下面的命令将这个库导入到我们的工作环境中。我们将导入<strong class="kx iu"> pandas </strong>来计算两个库的执行时间。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="da30" class="lr ls it nl b gy np nq l nr ns">import vaex<br/>import pandas as pd</span></pre></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h2 id="b02a" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">资料组</h2><p id="bd89" class="pw-post-body-paragraph kv kw it kx b ky mm ju la lb mn jx ld le nh lg lh li ni lk ll lm nj lo lp lq im bi translated">现在，在本演示中，让我们创建一个包含100万行100列的大型数据集，这确实是一个大型数据集。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="50d0" class="lr ls it nl b gy np nq l nr ns">n_rows = 100000<br/>n_cols = 10<br/>df = pd.DataFrame(np.random.randint(0, 100, size=(n_rows, n_cols)), columns=['c<strong class="nl iu">%d</strong>' % i <strong class="nl iu">for</strong> i <strong class="nl iu">in</strong> range(n_cols)]) </span></pre><p id="d499" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，让我们检查一些关于加载的数据集的信息。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="bca7" class="lr ls it nl b gy np nq l nr ns">df.info(memory_usage='deep')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/49a3c497b4ed502e9130dd5979b0b5b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*NFpjBa46734O9a7Rwz6R-A.png"/></div></figure></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h2 id="4368" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">创造。csv文件</h2><p id="5f25" class="pw-post-body-paragraph kv kw it kx b ky mm ju la lb mn jx ld le nh lg lh li ni lk ll lm nj lo lp lq im bi translated">我们将把上面创建的演示数据帧保存为<strong class="kx iu">的形式。csv </strong>文件实现加载。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="f706" class="lr ls it nl b gy np nq l nr ns">file_path = 'main_dataset.csv'<br/>df.to_csv(file_path, index=<strong class="nl iu">False</strong>)</span></pre></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h2 id="d188" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">创建Hdf5文件</h2><p id="c134" class="pw-post-body-paragraph kv kw it kx b ky mm ju la lb mn jx ld le nh lg lh li ni lk ll lm nj lo lp lq im bi translated">我们需要以<strong class="kx iu"> hdf5 </strong>格式存储数据集，作为vaex负载的输入。</p><blockquote class="nt nu nv"><p id="37ca" class="kv kw nw kx b ky kz ju la lb lc jx ld nx lf lg lh ny lj lk ll nz ln lo lp lq im bi translated">请注意，所有这些过程只是为了创建演示数据集，用于演示目的，在实际项目中，我们会有一些数据，而实现基于vaex的数据加载只是一行代码。</p></blockquote><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="c410" class="lr ls it nl b gy np nq l nr ns">vaex_df = vaex.from_csv(file_path, <br/>                        convert=<strong class="nl iu">True</strong>, <br/>                        chunk_size=5_000_000)</span></pre><p id="037b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在检查我们得到的这个数据帧的类型时，</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="123b" class="lr ls it nl b gy np nq l nr ns">type(vaex_df)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/79e17727f1a93b95f14288fed5ac23cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*E96uPjMjsLZ4rgNuXiLwLw.png"/></div></figure></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h2 id="5906" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">使用Vaex库读取Hdf5文件</h2><p id="b736" class="pw-post-body-paragraph kv kw it kx b ky mm ju la lb mn jx ld le nh lg lh li ni lk ll lm nj lo lp lq im bi translated">现在，我们终于到了演示中最重要的一步，所以请注意。使用Vaex加载Hdf5格式的数据集。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="d25a" class="lr ls it nl b gy np nq l nr ns">vaex_df = vaex.open('main_dataset.csv.hdf5')<br/>vaex_df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oc"><img src="../Images/047835fd05c11a88d35f57ee73426049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BYSwu3zPIDmkyClsaMlqrg.png"/></div></div></figure></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h2 id="df0c" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">表达系统</h2><p id="d291" class="pw-post-body-paragraph kv kw it kx b ky mm ju la lb mn jx ld le nh lg lh li ni lk ll lm nj lo lp lq im bi translated">现在让我们看看Vaex的计算速度有多快。我们实现了两列的乘法，并将它们存储在数据帧中的一个新列中，并估计了这个过程所花费的时间。结果可以忽略不计。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="cef0" class="lr ls it nl b gy np nq l nr ns">%%time<br/>vaex_df['multiplication_col13']=vaex_df.c1*vaex_df.c3</span></pre><p id="b081" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">看到这一列中的内容，我们得到一个vaex定义的表达式<strong class="kx iu">类似于熊猫数据框中的一列。</strong></p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="87f8" class="lr ls it nl b gy np nq l nr ns">vaex_df['multiplication_col13']</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oh"><img src="../Images/1bdac65fe2c6f9f428736eba4150ac01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OPX81vkcbmSLKLEEsenRVQ.png"/></div></div></figure></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h2 id="9ac4" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">核外数据帧</h2><p id="dd5e" class="pw-post-body-paragraph kv kw it kx b ky mm ju la lb mn jx ld le nh lg lh li ni lk ll lm nj lo lp lq im bi translated">坚持Vaex开发背后的主要概念，我们需要记住以下注意事项，</p><blockquote class="oi"><p id="044c" class="oj ok it bd ol om on oo op oq or lq dk translated">"筛选和计算表达式不会因为复制而浪费内存；数据在磁盘上保持不变，仅在需要时进行流式传输。在需要集群之前延迟时间。”</p></blockquote><p id="e398" class="pw-post-body-paragraph kv kw it kx b ky os ju la lb ot jx ld le ou lg lh li ov lk ll lm ow lo lp lq im bi translated">比如…</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="f2f2" class="lr ls it nl b gy np nq l nr ns">vaex_df[vaex_df.c2&gt;70]</span></pre><blockquote class="oi"><p id="9f53" class="oj ok it bd ol om ox oy oz pa pb lq dk translated">所有的算法都在内核之外工作，极限是你的硬盘驱动器的大小</p></blockquote><p id="3856" class="pw-post-body-paragraph kv kw it kx b ky os ju la lb ot jx ld le ou lg lh li ov lk ll lm ow lo lp lq im bi translated">比如…</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="b8fe" class="lr ls it nl b gy np nq l nr ns">dff.c2.minmax(progress='widget')</span></pre><blockquote class="oi"><p id="94d8" class="oj ok it bd ol om ox oy oz pa pb lq dk translated">Vaex实现了并行、高性能的groupby操作，尤其是在使用类别(&gt; 10亿/秒)时。</p></blockquote><p id="139b" class="pw-post-body-paragraph kv kw it kx b ky os ju la lb ot jx ld le ou lg lh li ov lk ll lm ow lo lp lq im bi translated">实现为…</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="37b7" class="lr ls it nl b gy np nq l nr ns">%%time<br/>vaex_df_group = vaex_df.groupby(vaex_df.c1,<br/>                                agg = vaex.agg.mean(vaex_df.c4))<br/>vaex_df_group</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi pc"><img src="../Images/5f80985f6f647184e7a60813804b195f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aXNm4oT_XA_nH-5JcQv3jA.png"/></div></div></figure><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="f8bd" class="lr ls it nl b gy np nq l nr ns">%%time<br/>vaex_df.groupby(vaex_df.c1,agg='count')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi pd"><img src="../Images/202073331da103cdfd783d5999c0cb29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c2kvVYyBUdTEvVUdPWtaHg.png"/></div></div></figure></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h2 id="70a7" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">参考</h2><p id="2a88" class="pw-post-body-paragraph kv kw it kx b ky mm ju la lb mn jx ld le nh lg lh li ni lk ll lm nj lo lp lq im bi translated">【https://vaex.readthedocs.io/en/latest T2】号</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><p id="4c34" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">关于这次演示的完整代码，请从我的<a class="ae ku" href="https://github.com/blurred-machine" rel="noopener ugc nofollow" target="_blank"> Github </a>中获取<a class="ae ku" href="https://github.com/blurred-machine/Data-Science/blob/master/VAEX%20Implementation/Vaex%20Implementation.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>。</p><p id="f739" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">谢谢！</strong></p></div></div>    
</body>
</html>