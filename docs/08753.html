<html>
<head>
<title>How to Calculate Discounted Cash Flows with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python计算贴现现金流</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-calculate-discounted-cash-flows-with-python-a88f12a48d5c?source=collection_archive---------26-----------------------#2020-06-24">https://towardsdatascience.com/how-to-calculate-discounted-cash-flows-with-python-a88f12a48d5c?source=collection_archive---------26-----------------------#2020-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="f298" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">面向金融的PYTHON</h2><div class=""/><div class=""><h2 id="ba17" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">用熊猫、考拉和派斯帕克</h2></div><h1 id="76a0" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">时间有价值</h1><p id="292a" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><em class="mf">时间是有价值的——不仅仅是它给你的智慧，还有金钱的时间价值。</em></p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mg"><img src="../Images/bf171ce0e76623281a8df6540dca4a9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PZwXD1UDPA5mp_NF"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">凯文·Ku在<a class="ae mw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="05d1" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">你一定听说过这个:</p><p id="243a" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">今天的100美元比明天的100美元更有价值。</p><p id="b8cd" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">它如此简单，却揭示了我们许多行为和决定背后的潜在原则:</p><ul class=""><li id="956a" class="nc nd it ll b lm mx lp my ls ne lw nf ma ng me nh ni nj nk bi translated">投资或持有现金。投资让你赚取利息，而持有现金不会产生额外的价值。</li><li id="0e1a" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">提前支付或延期支付。推迟付款能让你在付款前通过投资赚钱。</li><li id="c58d" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">是否进行一个项目。是的，如果项目的回报高于初始投资加上它本可以赚取的利息；</li></ul><p id="077e" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">嵌入货币时间价值的其他领域包括保险定价、债券定价、企业估值等。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nq"><img src="../Images/cb0f9cf99956a1b446f82dcb9e8cddbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g0l2pBGVmm6BBKCU"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">照片由<a class="ae mw" href="https://unsplash.com/@aronvisuals?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Aron视觉效果</a>在<a class="ae mw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="dee8" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">时间与估值有什么关系？</h1><p id="90b0" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">为了回答这个问题，我们来输入一个模拟:坐好，挂紧。</p><h2 id="184f" class="nr ks it bd kt ns nt dn kx nu nv dp lb ls nw nx ld lw ny nz lf ma oa ob lh iz bi translated">你的彩票奖金决定</h2><p id="bdc1" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">好消息！你刚刚中了一百万美元的彩票！</p><p id="ea4d" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">你有两个选择来得到现金。</p><ul class=""><li id="c953" class="nc nd it ll b lm mx lp my ls ne lw nf ma ng me nh ni nj nk bi translated">选择一:今天就获得80万美元。</li><li id="f0a3" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">方案二:一年内获得100万美元。</li></ul><p id="3442" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">假设你没有现金短缺，并假设你今天没有不合理地持有现金:你会选择哪个选项？</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="7144" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">要回答这个问题，你肯定会问我:</p><p id="22fa" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated"><em class="mf">如果我投资，我能期望的投资回报是多少？</em></p><p id="0c57" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">问得好！比方说“<strong class="ll jd"> <em class="mf">银行幻想</em> </strong>”提供一项年回报率为10%的无风险投资。现在让我们为自己做出一个好的决定。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="a02b" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">要比较这些选项，最简单的方法是通过考虑<code class="fe oj ok ol om b">Interest Rate</code>(投资回报)和投资期限(<code class="fe oj ok ol om b">t</code>)，将<code class="fe oj ok ol om b">Present Value</code>(今天的价值)转换为<code class="fe oj ok ol om b">Future Value</code>(一年后的价值)。</p><p id="1aac" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">用期权1今天(<code class="fe oj ok ol om b">Present Value</code>)的80万美元，可以投资银行幻想的投资产品，一年(<code class="fe oj ok ol om b">Interest Rate</code>)获得10%的回报(<code class="fe oj ok ol om b">t</code>)。这是80，000美元的投资回报。有了最初的钱，你在年底会有880，000美元。当然，对比年底的现金数额，方案二的100万美元是显而易见的选择。</p><p id="69e1" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">所以现在决定很清楚了，你将选择选项2，一年后获得100万美元。</p><p id="7e64" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">用公式表达我们讨论过的思维过程，它是:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div></figure></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="a9a6" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">80万美元一年的价值是多少，这一点很清楚。现在让我问你另一个问题:</p><p id="724c" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">未来的100万美元今天值多少钱？</p><p id="ed4e" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">为了推导它，我们可以把前面的公式反过来求解PV。让我们试试:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="ebfb" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">将1，000，000美元转换成今天的价值，得出909，091美元。这相当于说，今天有909，091美元，你会把它投资到Bank Fantasy的产品中，到年底会有100万美元(909，091美元加上90，909美元的投资回报)。</p><p id="e70d" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">现在我们可以比较选项1的800，000美元和选项2的909，091美元。这又给了你同样的决定:选择选项2！</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="1391" class="nr ks it bd kt ns nt dn kx nu nv dp lb ls nw nx ld lw ny nz lf ma oa ob lh iz bi translated">分解公式</h2><p id="dc0f" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">您现在知道如何计算今天的价值了。而这个过程叫做<strong class="ll jd"> <em class="mf">贴现</em> </strong>。</p><p id="8b8e" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">为了简化贴现流程，我们可以将其分为两步:</p><ol class=""><li id="2039" class="nc nd it ll b lm mx lp my ls ne lw nf ma ng me op ni nj nk bi translated">计算一个<strong class="ll jd"> <em class="mf">折扣因子；</em>T11】</strong></li><li id="854d" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me op ni nj nk bi translated">计算<strong class="ll jd"> <em class="mf">的现值</em>；</strong></li></ol><p id="ea12" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated"><strong class="ll jd">折扣系数</strong></p><p id="89e1" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">从前面讨论的现值公式中取分母。我们会有折扣因素。现值公式并不复杂，但没有必要重复使用除法和指数。该系数可以计算一次，然后简单地乘以未来的现金支付。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">计算折扣系数</p></figure><p id="9418" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated"><strong class="ll jd">现值</strong></p><p id="82a6" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">计算贴现因子后，将贴现因子应用于未来值将得到现值。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="ea48" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated"><strong class="ll jd">多重未来值</strong></p><p id="073b" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">也可能有多个未来值:</p><p id="02da" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">假设您有一个选项3:第一年收到50万美元，第二年收到50万美元。</p><p id="2558" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">在这种情况下，总现值是用贴现因子分别贴现的所有未来值的总和。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">计算现值</p></figure></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h1 id="5905" class="kr ks it bd kt ku oq kw kx ky or la lb ki os kj ld kl ot km lf ko ou kp lh li bi translated">商业案例</h1><p id="c4b7" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">好了——到现在为止，你已经是用彩票资金做决策的专家了。让我们尝试一个商业案例。</p><p id="d1c1" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">这一次，你从事保险产品定价工作。你被要求估计一项保险产品的价格，该保险产品涵盖五年的洪水风险。</p><p id="9f98" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated"><strong class="ll jd">假设你写了一个合同，它:</strong></p><ul class=""><li id="cacb" class="nc nd it ll b lm mx lp my ls ne lw nf ma ng me nh ni nj nk bi translated">第一年年初从客户处收到12，000美元；</li><li id="71d5" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">五年内每年年底向客户支付约2000美元的索赔；</li><li id="42e0" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">你可以投资利率为2.5%的美国政府债券；</li></ul><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div></figure></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="8fbb" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated"><strong class="ll jd">为了计算现值，我们需要做以下事情:</strong></p><ol class=""><li id="1436" class="nc nd it ll b lm mx lp my ls ne lw nf ma ng me op ni nj nk bi translated">计算每年的贴现因子<code class="fe oj ok ol om b">Discount factor = 1 / (1 + r)^t</code>；</li></ol><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="8f72" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">2.计算每年现金流量的现值<code class="fe oj ok ol om b">Present value = discount factor * Cash flows</code>；</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="d7cf" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">3.把所有现金流的现值加起来；</p><p id="518c" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">总计<code class="fe oj ok ol om b">Present value</code>栏，你将获得2706美元的利润。加上前期收到的12，000美元和贴现到今天的五项未来费用，我们最终保持了2，706美元的利润。</p><p id="3e41" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">💰所以…是的！你的公司将出售这种产品。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h1 id="5621" class="kr ks it bd kt ku oq kw kx ky or la lb ki os kj ld kl ot km lf ko ou kp lh li bi translated">最后用Python代码！</h1><h2 id="6a67" class="nr ks it bd kt ns nt dn kx nu nv dp lb ls nw nx ld lw ny nz lf ma oa ob lh iz bi translated">为什么不超越</h2><p id="c1fd" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">到目前为止，我们看到的例子非常简单。在现实中，我们很少只有几个现金流在未来发生。</p><ul class=""><li id="03ad" class="nc nd it ll b lm mx lp my ls ne lw nf ma ng me nh ni nj nk bi translated">⚡ <strong class="ll jd">卷</strong>:如果你试图一次对多个产品估值，Excel就变得有限；</li><li id="4e65" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated"><strong class="ll jd">🤖自动化</strong>:Python逻辑可以作为函数编写一次，自动应用于类似的未来现金流，避免人工错误；</li><li id="f494" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">🚅<strong class="ll jd">速度</strong>:计算量大的时候Excel打开会比较慢，带收益率曲线的<code class="fe oj ok ol om b">vlookup</code>只会让它更容易崩溃，而Python可以轻松应对；</li></ul><p id="67ee" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">所以这是金融中最适合应用Python的领域之一。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ov"><img src="../Images/d7994dcb567d6bf50f91b45966e7f45f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oCMf4wEdY0tTdbvK"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">照片由<a class="ae mw" href="https://unsplash.com/@lysanderyuen?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">吕山德元</a>在<a class="ae mw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h2 id="97a0" class="nr ks it bd kt ns nt dn kx nu nv dp lb ls nw nx ld lw ny nz lf ma oa ob lh iz bi translated">介绍我们的例子</h2><p id="0793" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">所有的资料和代码都可以在这个代码库中找到<a class="ae mw" href="https://github.com/fyyying/python-in-finance/tree/master/discount_cashflows" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="fc52" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">现在，我们将使用稍微复杂一点的现金流文件和收益率曲线文件作为示例。</p><p id="7c7b" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated"><strong class="ll jd">注意:</strong>这里我们不再使用统一利率。相反，我们使用收益率曲线:更高的利率出现在更长的期限内，以反映更高的回报，如果人们必须将现金投入一种产品更长的时间，通常会要求更高的回报。</p><ul class=""><li id="cead" class="nc nd it ll b lm mx lp my ls ne lw nf ma ng me nh ni nj nk bi translated">我们有两种产品:洪水险和火险；</li><li id="e552" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">两者都是美元；</li></ul><p id="f7d4" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">预计现金流如下表所示:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">两种产品的现金流</p></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ow"><img src="../Images/bcfd38ebb8bd5c638092233b06ac65e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nGA5-HcYV-N0rYp8QdK1_w.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">按年份划分的现金流模式</p></figure><p id="43ad" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">用于贴现的收益率曲线:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">收率曲线</p></figure></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="756b" class="nr ks it bd kt ns nt dn kx nu nv dp lb ls nw nx ld lw ny nz lf ma oa ob lh iz bi translated">来自熊猫的帮助🐼</h2><p id="fadc" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">由于Pandas是按列操作的，所以同样的公式可以一次应用于整个列。</p><p id="d9e5" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated"><strong class="ll jd">步骤:</strong></p><ol class=""><li id="beb8" class="nc nd it ll b lm mx lp my ls ne lw nf ma ng me op ni nj nk bi translated">用<code class="fe oj ok ol om b">1 / (1 + df["Interest rate"])**df["Year"])</code>计算折扣系数；</li><li id="435a" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me op ni nj nk bi translated">基于<code class="fe oj ok ol om b">Year</code>和<code class="fe oj ok ol om b">Currency</code>将收益率曲线文件与现金流文件合并；</li><li id="59a2" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me op ni nj nk bi translated">用<code class="fe oj ok ol om b">df["Cash flows"] * df["Discount factor"]</code>计算每年现金流量的现值；</li><li id="b70c" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me op ni nj nk bi translated">使用<code class="fe oj ok ol om b">groupby</code>汇总每个产品的<code class="fe oj ok ol om b">Present value</code>；</li></ol><p id="ead5" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated"><strong class="ll jd"> <em class="mf"> ⚡注</em> </strong>:在merge函数中，使用left join将确保在这个过程中没有现金流被丢弃。在收益率曲线信息不完整的情况下，我们可以在应用<code class="fe oj ok ol om b">merge</code>后检测现金流文件中的<code class="fe oj ok ol om b">Null</code>值。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="0c7e" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated"><strong class="ll jd">完整的代码和结果:</strong></p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">计算熊猫的贴现现金流</p></figure><p id="697e" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">通过几行代码，您可以在不到一秒的时间内获得贴现现金流。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">熊猫的贴现现金流</p></figure><p id="8552" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">一旦我们按产品汇总了<code class="fe oj ok ol om b">Present value</code>:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">按产品划分的总贴现现金流</p></figure><p id="ffe5" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">我们将看看我们的产品是否有望盈利:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">产品现值</p></figure><p id="7b1d" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">在这种情况下，<strong class="ll jd">是的</strong>又来了两个！</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="cf68" class="nr ks it bd kt ns nt dn kx nu nv dp lb ls nw nx ld lw ny nz lf ma oa ob lh iz bi translated">现在有了考拉🐨</h2><p id="d172" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">Databricks koalas可以让您非常轻松地从小型本地操作过渡到大数据的分布式计算。</p><p id="763e" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">除了导入一个不同的库(以及库的别名<code class="fe oj ok ol om b">ks</code>而不是<code class="fe oj ok ol om b">pd</code>)，其余部分与上面的Pandas代码相同。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">用考拉计算贴现现金流</p></figure></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="a1c4" class="nr ks it bd kt ns nt dn kx nu nv dp lb ls nw nx ld lw ny nz lf ma oa ob lh iz bi translated">闪亮的火花🌟</h2><p id="7028" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">当数据变得足够大，熊猫无法再在内存中读取时，PySpark就派上了用场。</p><p id="6b1e" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">要使用PySpark计算贴现现金流，您需要知道操作中涉及到广泛的转换。</p><p id="5e24" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated"><code class="fe oj ok ol om b">join</code> —加入PySpark是一个广泛的转变。这意味着在要连接的两个表匹配之前，有一个数据交换。</p><ul class=""><li id="d8e0" class="nc nd it ll b lm mx lp my ls ne lw nf ma ng me nh ni nj nk bi translated">默认情况下，要连接的表将被分割成200个更小的文件(所谓的分区)用于分布式计算；</li><li id="ef4f" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">为了保证效率，我们将使用<code class="fe oj ok ol om b">broadcast</code>连接；</li><li id="ec1b" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">join所做的是:它会将您选择的小表广播给大表的每个执行程序；</li><li id="73b9" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">这样避免了数据的交换，因为小表是作为一个整体被所有的执行者消耗的；</li><li id="965c" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">要使用广播，您需要通过<code class="fe oj ok ol om b">broadcast(small_table)</code>或<code class="fe oj ok ol om b">small_table.hint("broadcast")</code>给小桌子一个提示；</li><li id="da87" class="nc nd it ll b lm nl lp nm ls nn lw no ma np me nh ni nj nk bi translated">这一步将在Spark 3.0的新版本中自动处理。但是在你安装新版本之前，我们不要忘记添加一个提示。💡</li></ul><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">使用PySpark计算贴现现金流</p></figure><p id="a832" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">这样，我们又一次得到了和以前一样的结果。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="on oo l"/></div></figure></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h1 id="a4be" class="kr ks it bd kt ku oq kw kx ky or la lb ki os kj ld kl ot km lf ko ou kp lh li bi translated">最后的话</h1><p id="b0f1" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">贴现现金流的应用非常广泛:对你的商业项目、保险产品、债券、甚至公司进行估值。</p><p id="20ba" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">由于容量和速度的限制，在Excel中贴现现金流比必要的要复杂得多&amp;手动错误的几率更高。然而，使用Python，它不超过十行代码。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="b78b" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">现在你已经到了故事的结尾。你干得好！👏</p><p id="6977" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">如果你觉得这篇文章有用，请关注我的<a class="ae mw" href="https://twitter.com/fu_yingying" rel="noopener ugc nofollow" target="_blank">推特</a>简介🐼。我会继续发布关于Python的文章🐍金融、保险和估价。</p><p id="d999" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">请给你的任何问题留言，我会直接回答或者通过以后的文章来回答。</p><p id="5ca7" class="pw-post-body-paragraph lj lk it ll b lm mx kd lo lp my kg lr ls mz lu lv lw na ly lz ma nb mc md me im bi translated">最后，我想感谢<a class="ox oy ep" href="https://medium.com/u/974f70f18518?source=post_page-----a88f12a48d5c--------------------------------" rel="noopener" target="_blank">德扬·西米奇</a>和瑞秋帮我审阅我的帖子。</p><blockquote class="oz pa pb"><p id="d16d" class="lj lk mf ll b lm mx kd lo lp my kg lr pc mz lu lv pd na ly lz pe nb mc md me im bi translated">培养对学习的热情。如果你这样做了，你将永远不会停止成长。</p><p id="29fa" class="lj lk mf ll b lm mx kd lo lp my kg lr pc mz lu lv pd na ly lz pe nb mc md me im bi translated"><em class="it"> —安东尼·j·德安杰洛</em></p></blockquote></div></div>    
</body>
</html>