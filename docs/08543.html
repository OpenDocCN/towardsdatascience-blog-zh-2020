<html>
<head>
<title>Audit using Machine Learning algorithm: A Financial Data Science use case</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用机器学习算法的审计:金融数据科学用例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/audit-using-machine-learning-algorithm-a-financial-data-science-use-case-2316571c024c?source=collection_archive---------21-----------------------#2020-06-21">https://towardsdatascience.com/audit-using-machine-learning-algorithm-a-financial-data-science-use-case-2316571c024c?source=collection_archive---------21-----------------------#2020-06-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="64b4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">ML 算法在现实审计中的应用</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6e1f4398be30c6c1db097829ed45afa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EGr-NYkBn9eF7u7C"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">弗兰克·维西亚在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2362" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据科学的世界充满了奇迹(除了独角兽！).它无处不在，在健康科学、太空探索、图像识别、机器人、欺诈检测等领域都有应用。如果你曾经在网飞或 Prime 上看过一些东西，那么你很有可能已经接触到了令人惊叹的电影推荐算法！</p><blockquote class="lv"><p id="d8c7" class="lw lx it bd ly lz ma mb mc md me lu dk translated">我们如何在一个典型的内部审计职能中运用 ML 技术来减少假阴性和提高效率。副作用:降低成本。</p></blockquote><p id="4736" class="pw-post-body-paragraph kz la it lb b lc mf ju le lf mg jx lh li mh lk ll lm mi lo lp lq mj ls lt lu im bi translated">金融业也不例外，我们已经看到了组织向应用先进的数据科学技术进行见解生成、预测、预算和欺诈风险的巨大转变。</p><p id="6cc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我在日常审计中研究 ML 的用例时，作为一名财务专业人员，我们都面临的一个非常现实的问题是<strong class="lb iu">“与标准有何不同”</strong>？</p><p id="684a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您有 1，600 笔交易(或购买发票)，其中每笔交易代表“购买数量”(体积)和为该数量支付的“金额”。为了识别任何异常值(即不遵循正常模式的交易)，在典型的审计环境中，我们会尝试从总体中抽取随机样本，然后希望我们的“随机”抽样能够检测到任何此类异常。这有时既费时又事与愿违，因为我们有遗漏实际异常值的风险，这些异常值不会被我们的样本发现，因此会报告假阴性。这对审计职能的成本和效率都有不利影响。</p><p id="c301" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我尝试采用一种 ML 算法(KNN，下面会进一步解释)来解决上述问题，并自动进行异常检测。该算法使用发票的数量和金额特征，并计算 1，600 个这种发票集中的异常值。</p><p id="ad72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在好的算法或代码和我们讲的故事一样好。因此，在我讲述准则的本质之前，下面是一份一页的执行摘要或电梯演讲，可以与我们的业务利益相关方分享:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/5ef101874f01407daa03004bca21fe5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V2eopnrGzTrFkb-e1bOsKQ.jpeg"/></div></div></figure><p id="2e42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想知道模型是如何建立的，请继续阅读下面的内容。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="4030" class="ms mt it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated"><strong class="ak">数据科学拯救</strong></h2><p id="ae1a" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">Python 中一个专门用于<strong class="lb iu">离群点检测</strong>建模的包叫做<strong class="lb iu"> PyOD </strong>。这个包(我用<strong class="lb iu"> pip install pyod </strong>安装的)提供了多种算法来检测异常值，并且非常容易实现。然而，在本文中，我将把自己限制在一个基于<strong class="lb iu">邻近度的</strong>模型的用例上，这个模型被称为 KNN 或 K-最近邻。<strong class="lb iu"> KNN </strong>是一种数学模型，它测量到最近的第 K 个<em class="nq">邻居的距离，并根据该距离识别数据中的异常值。这是一种分类算法，将异常值分类为“1”和“0”的二进制结果，或者说“是”或“否”。</em></p><p id="fdfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是分步实施的方法:</p><h2 id="c5b0" class="ms mt it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated"><strong class="ak">第一步:数据集</strong></h2><p id="d5dd" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">对于任何数据科学项目，生成有意义的随机数据集与算法或代码本身一样重要。所以我强烈推荐阅读关于‘随机数据’和‘种子’的好资源。生成的数据集是一组 1600 张购买发票，代表两个特征，即当月购买的“数量”和为该发票支付的“金额”。下面是它看起来的样子(想象的但看起来仍然足够真实！)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/c798cf64e82b6033b9b38df1352a3592.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*hu1W7mRgvUxzptZNH5VmPw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为 KNN 建模生成的随机数据</p></figure><h2 id="1469" class="ms mt it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">第二步:想象</h2><p id="3308" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">让我们使用 Plotly 散点图快速可视化数据。关于<a class="ae ky" rel="noopener" target="_blank" href="/covid-19-data-visualisation-with-plotly-d1c96423942e?source=friends_link&amp;sk=09954119645f71eca5f0684cbff40b29"> <strong class="lb iu">的快速纲要，请参考我的文章</strong> </a> <strong class="lb iu">。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/0ddfbeb3a2ee7fc67c04d7275c2a74f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QG90VlMS1VeObPb75GjHHg.jpeg"/></div></div></figure><h2 id="4ce0" class="ms mt it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">步骤 3:训练和测试模型</h2><p id="519f" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">现在有趣的部分来了，我们实际上建立了我们的模型并训练了算法。这些是我通常会遵循的步骤:</p><ol class=""><li id="d5fa" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated"><strong class="lb iu">预处理和缩放数据:</strong>这有效地将数据标准化并缩放到 0 和 1 之间的值，这有助于处理现实生活中变化很大的大量数据集。然后，我们重塑数据集的特征(体积和数量),以便进一步处理。</li></ol><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="a368" class="ms mt it od b gy oh oi l oj ok">from <strong class="od iu">sklearn.preprocessing </strong>import <strong class="od iu">MinMaxScaler</strong><br/>scaler = MinMaxScaler(feature_range=(0, 1))<br/>df[[‘Volume’,’Amount’]] = scaler.fit_transform(df[[‘Volume’,’Amount’]])</span><span id="921e" class="ms mt it od b gy ol oi l oj ok"><strong class="od iu"># reshape the individual features to numpy arrays</strong><br/>x = df['Volume'].values.reshape(-1,1)<br/>y = df['Amount'].values.reshape(-1,1)</span><span id="c117" class="ms mt it od b gy ol oi l oj ok">X = np.concatenate((x,y),axis=1)</span></pre><p id="ff62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2。分割训练和测试数据:</strong>我使用了 80:20 的训练/测试分割。然后首先使用训练数据训练该模型，并使用测试数据测试该模型。由模型生成的异常分数的可视化为我们提供了正常和异常数据是如何分割的指示。</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="ca0e" class="ms mt it od b gy oh oi l oj ok">from sklearn.model_selection import train_test_split<br/><strong class="od iu">#split dataset into train and test data</strong><br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)<br/>print (‘Train set:’, X_train.shape, y_train.shape)<br/>print (‘Test set:’, X_test.shape, y_test.shape)</span><span id="2345" class="ms mt it od b gy ol oi l oj ok"><strong class="od iu"># train KNN detector</strong><br/>from pyod.models.knn import KNN<br/>clf_name = 'KNN'<br/>clf = KNN(contamination=0.03, n_neighbors = 5) #assuming a 3% outliers based on some historical data<br/>clf.fit(X_train)<br/><strong class="od iu">#raw anomaly score</strong><br/>y_train_scores = clf.decision_scores_<br/><strong class="od iu">#Train predictions</strong><em class="nq"><br/></em>y_train_pred = clf.predict(X_train) <em class="nq">#creates outlier labels (0 or 1)</em><br/><strong class="od iu">#print size for sanity check</strong><br/>print('Train score size: ',y_train_scores.shape)<br/>print('Train prediction size: ',y_train_pred.shape)</span><span id="f494" class="ms mt it od b gy ol oi l oj ok"><strong class="od iu"># Now we have the trained KNN model, let's apply to the test data to get the predictions</strong><br/>y_test_pred = clf.predict(X_test) # outlier labels (0 or 1)<br/><strong class="od iu"># Generate the anomaly score using clf.decision_function:</strong><br/>y_test_scores = clf.decision_function(X_test)<br/><strong class="od iu">#print size for sanity check</strong><br/>print('Test score size: ',y_test_scores.shape)<br/>print('Test prediction size: ',y_test_pred.shape)</span><span id="37fe" class="ms mt it od b gy ol oi l oj ok"><strong class="od iu">Output:</strong></span><span id="9ccb" class="ms mt it od b gy ol oi l oj ok">Train set: (1280, 2) (1280, 1)<br/>Test set: (320, 2) (320, 1)</span><span id="5f31" class="ms mt it od b gy ol oi l oj ok">Train score size:  (1280,)<br/>Train prediction size:  (1280,)</span><span id="a722" class="ms mt it od b gy ol oi l oj ok">Test score size:  (320,)<br/>Test prediction size:  (320,)</span></pre><p id="67b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 3。可视化训练和测试分数:</strong>让我们使用‘y _ train _ scores’和‘y _ test _ scores’将异常分数可视化为一个简单的直方图。注意异常的数量。</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="d555" class="ms mt it od b gy oh oi l oj ok"><strong class="od iu">#visualise training scores</strong><br/>fig = px.histogram(y_train_scores)<br/>fig.show()</span><span id="2424" class="ms mt it od b gy ol oi l oj ok"><strong class="od iu">#visualise test scores</strong><br/>fig = px.histogram(y_test_scores)<br/>fig.show()</span><span id="2068" class="ms mt it od b gy ol oi l oj ok"><strong class="od iu"><br/># lets see the number of anomalies</strong><br/>print('Anomalies in test data: ',np.count_nonzero(y_test_pred))<br/>print('Anomalies in training data: ',np.count_nonzero(y_train_pred))</span><span id="c53f" class="ms mt it od b gy ol oi l oj ok"><strong class="od iu">output:</strong><br/>Anomalies in test data:  10<br/>Anomalies in training data:  33</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/4d1fda45bcc57a2e8c7b2175ff6ae7f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xahunJmj-LHyOYH2nRmryw.jpeg"/></div></div></figure><p id="791b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 4。将模型应用到给定的数据集:</strong>现在，我已经使用了上面为这个示例生成的相同数据集来演示我们如何获得最终结果。</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="fd8a" class="ms mt it od b gy oh oi l oj ok"><strong class="od iu">#Apply model to the given data set</strong><br/>y_pred=clf.predict(X)<br/>y_pred_scores = clf.decision_function(X)</span></pre><p id="3444" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 5。将所有这些放在一起:</strong>在这一步中，我们<strong class="lb iu">将预测标签</strong> s ('0 '和' 1 ')附加到数据集，<strong class="lb iu">可视化</strong>和<strong class="lb iu">对异常值</strong> ('1 ')的过滤，以获得需要进一步调查的发票列表:</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="abb7" class="ms mt it od b gy oh oi l oj ok">df1[‘Outliers’] = y_pred.tolist() #append list to copy of dataframe</span><span id="a83f" class="ms mt it od b gy ol oi l oj ok"><strong class="od iu">#visualise data using plotly fro df1 dataframe</strong><br/>fig = go.Figure(go.Scatter(x=df1['Volume'], y=df1['Amount'],mode='markers',marker=dict(size=df1['Amount']**0.26+3,color=df1['Outliers'],colorscale='rdylgn_r')))</span><span id="a8ec" class="ms mt it od b gy ol oi l oj ok">fig.update_layout(xaxis_showgrid=True, yaxis_showgrid=True, plot_bgcolor='whitesmoke', <br/>        title={<br/>        'text': 'Volume vs transaction size with anomalies',<br/>        'y':.88,<br/>        'x':0.5,<br/>        'xanchor': 'center',<br/>        'yanchor': 'top'},width=800,<br/>    height=600)<br/>fig.update_xaxes(title= '------&gt;Volume' ,showline=True, linecolor='black')<br/>fig.update_yaxes(title= '------&gt;Amount', showline=True,linecolor='black')</span><span id="34e0" class="ms mt it od b gy ol oi l oj ok">#overlay the bars<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/8554cd5475a0b8fc608f776a7d7dcae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TI4Y2e8_HO1zoqh0_MjRXw.jpeg"/></div></div></figure><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="e721" class="ms mt it od b gy oh oi l oj ok"><strong class="od iu"># Filter data on Outliers = 1</strong><br/>Review_sample=df1.loc[df1[‘Outliers’] == 1].reset_index()<br/>Review_sample.drop(‘index’, inplace=True, axis=1)<br/>print(‘Number of invoices to deep-dive:’, len(Review_sample), ‘which is’, round(len(Review_sample)/len(df1)*100,1),’% of total transactions’)<br/>Review_sample.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/adb54fff6c31a769601e1d74e9d9fcec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U0d2nIw4R5rJr8M4mV7W4A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示 43 个“异常”交易中前五张发票的输出</p></figure><p id="e2b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面展示了金融和审计环境中机器学习用例的一个非常简单的例子。在现实世界的问题中，我们肯定需要考虑许多因素和多种模型的使用，但是为了文章的长度，我只把它限制在 KNN。</p><p id="9815" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在以后的文章中，我将深入研究数据科学在金融和会计领域的应用和用例。在自学之旅中，请随时评论或联系，分享关于这方面的想法或想法。</p><p id="24ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关 PyOD 的更多资源，请参考此处 的<a class="ae ky" href="https://pyod.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">文档链接。链接里有一些非常好的文章，给了我很多启发和帮助。</strong></a></p></div></div>    
</body>
</html>