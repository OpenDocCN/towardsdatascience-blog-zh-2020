<html>
<head>
<title>Extracting webpage information with Python for non-programmers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 为非程序员提取网页信息</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/extracting-webpage-information-with-python-for-non-programmer-1ab4be2bb812?source=collection_archive---------16-----------------------#2020-05-16">https://towardsdatascience.com/extracting-webpage-information-with-python-for-non-programmer-1ab4be2bb812?source=collection_archive---------16-----------------------#2020-05-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="60da" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">基本编程必备</h2><div class=""/><div class=""><h2 id="d625" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">用一些基本的数据挖掘技能来增强自己的能力</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/f081440628765130de2154a6433a84e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWDejnolEnD9kxTc_VJjxg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://unsplash.com/@isaacquesada" rel="noopener ugc nofollow" target="_blank"> Isaac Quesada </a>在<a class="ae lh" href="https://unsplash.com/photos/U0apbBgkOeQ" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="49c2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated">知道如何使用脚本从网页中提取数据是很有帮助的。我发现最简单的方法是在 lxml 库的帮助下使用 Python。</p><p id="9924" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最好的部分是，你可能不需要在你的机器上做。你可以把你的脚本放到<a class="ae lh" href="https://www.onlinegdb.com/online_python_interpreter" rel="noopener ugc nofollow" target="_blank"> Python 在线编译器</a>上，然后你得到一些数据。</p><p id="cccd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于一些简单的东西，我们只需要在一个文件中的几行代码，然后它会做非常酷的事情。</p><p id="53c4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面举几个例子。</p><div class="mn mo gp gr mp mq"><a href="https://medium.com/better-marketing/export-personal-medium-partner-program-data-into-excel-spreadsheet-8887cb4d4442" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd jd gy z fp mv fr fs mw fu fw jc bi translated">如何在 Excel 中分析您的中型合作伙伴计划数据</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">在简单的图形中寻找模式</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">medium.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne lb mq"/></div></div></a></div><div class="mn mo gp gr mp mq"><a href="https://medium.com/better-programming/how-to-find-your-mutual-connections-on-medium-d0c586c04e6f" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd jd gy z fp mv fr fs mw fu fw jc bi translated">如何在媒体上找到你们的相互联系</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">使用 Python 脚本和指令，不需要任何编码知识</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">medium.com</p></div></div><div class="mz l"><div class="nf l nb nc nd mz ne lb mq"/></div></div></a></div><h1 id="60fc" class="ng nh it bd ni nj nk nl nm nn no np nq ki nr kj ns kl nt km nu ko nv kp nw nx bi translated">学习网站</h1><p id="50a8" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi translated">为了使学习更加相关，我们将把<a class="ae lh" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank"> Wordometer 冠状病毒网页</a>作为我们的来源。</p><p id="1565" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你访问这个页面，你会看到类似下面的内容。我将学习分成 4 个部分，我称之为练习，如下所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi od"><img src="../Images/51ea9dad63e1c9f55ef07b35dce2ba33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_fdpwxSOrgdydehyBcnMYQ.png"/></div></div></figure><p id="29fc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我已经提供了<a class="ae lh" href="https://gist.github.com/elye/b4197c8db5b0d1380d1f2426fa08add7" rel="noopener ugc nofollow" target="_blank">代码脚本</a>(只有 70 行)，借此复制粘贴并运行它(在<a class="ae lh" href="https://www.onlinegdb.com/online_python_interpreter" rel="noopener ugc nofollow" target="_blank">在线编译器</a>中)，你会看到下面的内容</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oe"><img src="../Images/1e93d879d3255079fcfb3c655db2c46d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0T4iSlr6S7xVO_OsiDXuww.png"/></div></div></figure><p id="7b24" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">并选择每个数字来执行它。这应该会使学习更容易。</p><h1 id="4ef2" class="ng nh it bd ni nj nk nl nm nn no np nq ki nr kj ns kl nt km nu ko nv kp nw nx bi translated">HTML 的基础</h1><p id="1805" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi translated">所有网页都是用 HTML 构建的。</p><p id="b92d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们来看看 HTML 最基本的结构，因为这是我们提取所需信息时需要认识的基本模式。</p><p id="d680" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我能提供的最基本的结构如下。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi of"><img src="../Images/7c7c254915f38949456fdf8277c97c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y2l1tnzh3ZqAB0sRSX2tUw.png"/></div></div></figure><ol class=""><li id="52c2" class="og oh it lk b ll lm lo lp lr oi lv oj lz ok md ol om on oo bi translated">它们都是由包裹着<code class="fe op oq or os b">&lt;</code>和<code class="fe op oq or os b">&gt;</code>的<code class="fe op oq or os b">tag</code>组成。而且它通常带有一个对它的补充，即<code class="fe op oq or os b">&lt;/tag&gt;</code>，或者它只是在<code class="fe op oq or os b">tag</code>中以<code class="fe op oq or os b">/&gt;</code>结尾。</li><li id="713f" class="og oh it lk b ll ot lo ou lr ov lv ow lz ox md ol om on oo bi translated">在<code class="fe op oq or os b">&lt;tag&gt;</code>中，它可能有一个或多个被命名的<code class="fe op oq or os b">attribute</code>。这有助于区分同类型的<code class="fe op oq or os b">tag</code>。</li><li id="917d" class="og oh it lk b ll ot lo ou lr ov lv ow lz ox md ol om on oo bi translated">在<code class="fe op oq or os b">&lt;tag&gt;</code>对周围，我们可以有一个(或多个)标签被包裹在里面，我在上面将其命名为<code class="fe op oq or os b">&lt;sub-tag&gt;</code>。你可以成像，<code class="fe op oq or os b">sub-tag</code>可以有<code class="fe op oq or os b"> sub-sub-tag</code>等等…，它构成了 HTML 的大部分。</li><li id="8ec6" class="og oh it lk b ll ot lo ou lr ov lv ow lz ox md ol om on oo bi translated">有时,<code class="fe op oq or os b">tag</code>可以用一个<code class="fe op oq or os b">text</code>包围它，这通常构成了我们要寻找的信息的核心。</li></ol><p id="9137" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就是这样！给自己拍一下。您已经掌握了 HTML(以及 XML)结构🎉</p><h1 id="5bef" class="ng nh it bd ni nj nk nl nm nn no np nq ki nr kj ns kl nt km nu ko nv kp nw nx bi translated">第一件事:在 HTML 中阅读</h1><p id="275d" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi translated">在提取 HTML 信息之前，我们需要让我们的脚本先读取 HTML。有两种方法可以做到这一点。</p><h2 id="8b7b" class="oy nh it bd ni oz pa dn nm pb pc dp nq lr pd pe ns lv pf pg nu lz ph pi nw iz bi translated">1.直接从网站读取和加载 HTML</h2><p id="f247" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi translated">我们使用 Python 的<a class="ae lh" href="https://realpython.com/python-requests/" rel="noopener ugc nofollow" target="_blank">请求库。别担心，就像下面这条线一样简单，然后就搞定了。</a></p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="d740" class="oy nh it os b gy pn po l pp pq">import requests</span></pre><p id="b575" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">之后，尝试使用下面的代码获取网站内容。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="6076" class="oy nh it os b gy pn po l pp pq">response = requests.get(url)</span></pre><p id="8502" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了更加健壮，万一<code class="fe op oq or os b">url</code>出错或者网站关闭，我添加了以下内容</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="40a4" class="oy nh it os b gy pn po l pp pq">try:<br/>  response = requests.get(url)<br/>except:<br/>  print ('Sorry bad url') <br/>  sys.exit(2)</span><span id="6dba" class="oy nh it os b gy pr po l pp pq">if response.status_code != 200:<br/>  print ('Sorry invalid response ' + str(response.status_code))<br/>  sys.exit(2)</span></pre><p id="8879" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果请求加载成功，那么您可以使用下面的代码获取 Html 内容，并将其提取到一个<em class="ps">树</em>中。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="d7d3" class="oy nh it os b gy pn po l pp pq">tree = html.fromstring(response.text)</span></pre><blockquote class="pt pu pv"><p id="b050" class="li lj ps lk b ll lm kd ln lo lp kg lq pw ls lt lu px lw lx ly py ma mb mc md im bi translated">之所以称之为树，是因为如果我们画出标签关系，它们看起来就像一棵树。</p></blockquote><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/27119d100d817f6d04406935fe737554.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*VUiM-KWu0wZmxqJs25JCGw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">HTML 标签树</p></figure><h2 id="3345" class="oy nh it bd ni oz pa dn nm pb pc dp nq lr pd pe ns lv pf pg nu lz ph pi nw iz bi translated">2.将 HTML 保存在文件中并从中读取</h2><p id="35a1" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi translated">有时这是需要的，因为一些网页需要凭证登录，因此从脚本访问它会更复杂，因为您需要提供所需的凭证。</p><p id="d5e5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是因为你只需要从 HTML 中提取一些数据，你可以把它保存为一个<em class="ps">。html </em>文件，并获取从中读取的脚本。</p><p id="eaa6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">之后，在您的<em class="ps"> python </em>脚本中，您只需要</p><ol class=""><li id="4aaf" class="og oh it lk b ll lm lo lp lr oi lv oj lz ok md ol om on oo bi translated">打开文件，并将其作为一个<em class="ps">字符串</em>(一组字母)读取。</li><li id="8d4d" class="og oh it lk b ll ot lo ou lr ov lv ow lz ox md ol om on oo bi translated">读出 HTML 内容，形成一个<em class="ps">树</em></li></ol><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="49ae" class="oy nh it os b gy pn po l pp pq">inputFile = open(inputfile,"r") <br/>fileContent = str(inputFile.readlines())</span><span id="719d" class="oy nh it os b gy pr po l pp pq">tree = html.fromstring(fileContent)</span></pre><h1 id="3a1a" class="ng nh it bd ni nj nk nl nm nn no np nq ki nr kj ns kl nt km nu ko nv kp nw nx bi translated">准备提取数据！</h1><p id="120e" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di"> 1 </span> <strong class="lk jd">提取单</strong> <code class="fe op oq or os b"><strong class="lk jd">tag</strong></code> <strong class="lk jd">包裹</strong> <code class="fe op oq or os b"><strong class="lk jd">text</strong></code> <strong class="lk jd">。</strong>简单回顾一下，在练习 1 中，我们要提取如下所示的国家名称。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qa"><img src="../Images/dedf36972556f993b4ab4aa6db717e57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X5QhP6ThCXcrWPidV9sPLw.png"/></div></div></figure><p id="a17c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们检查它的 HTML 代码，我们会看到下面的模式。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="652a" class="oy nh it os b gy pn po l pp pq">&lt;a class=”mt_a” href=”country/spain/”&gt;Spain&lt;/a&gt;</span></pre><p id="5563" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了提取<code class="fe op oq or os b">Spain</code>，我们只需要识别具有<code class="fe op oq or os b">"mt_a"</code>的属性<code class="fe op oq or os b">class</code>的<code class="fe op oq or os b">a</code>标签。</p><p id="e5ba" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了提取，我们只需对<em class="ps">树</em>使用<code class="fe op oq or os b">xpath</code>函数。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="3198" class="oy nh it os b gy pn po l pp pq">extracteditems = tree.xpath(‘//a[<a class="ae lh" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>=”mt_a”]/text()’)<br/>print("\n".join(extracteditems))</span></pre><p id="1ed9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将得到一个列表，在这里我们用一个新行(即<code class="fe op oq or os b">"\n"</code>)将它们分开，并打印出来。</p><p id="dee9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们会得到</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="440a" class="oy nh it os b gy pn po l pp pq">USA<br/>Spain<br/>Russia<br/>UK<br/>Italy<br/>... and many more ...</span></pre><p id="9492" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">轻松点。</p><p id="a92d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di"> 2 </span> <strong class="lk jd">抽取</strong> <code class="fe op oq or os b"><strong class="lk jd">tag</strong></code> <strong class="lk jd">和</strong> <code class="fe op oq or os b"><strong class="lk jd">sub-tag</strong></code> <strong class="lk jd">包裹</strong> <code class="fe op oq or os b"><strong class="lk jd">text</strong></code> <strong class="lk jd">。简单回顾一下，在练习 2 中，我们要提取每个国家的人口信息。</strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qb"><img src="../Images/54d46551d6810da8b3bed9d17fdffdf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lsx1qMlG45MzJT9fH34dAw.png"/></div></div></figure><p id="1db2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们检查它的 HTML 代码，我们会看到下面的模式。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="2bff" class="oy nh it os b gy pn po l pp pq">&lt;td style=”font-weight: bold; text-align:right”&gt;<br/>   &lt;a href=”/world-population/spain-population/”&gt;46,752,556&lt;/a&gt; <br/>&lt;/td&gt;</span><span id="0788" class="oy nh it os b gy pr po l pp pq">&lt;td style=”font-weight: bold; text-align:right”&gt;2,467,761&lt;/td&gt;<br/>&lt;td style=”font-weight: bold; text-align:right”&gt;52,783&lt;/td&gt;</span></pre><p id="8c54" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们无法获得<code class="fe op oq or os b"> &lt;a href=”/world-population/spain-population/”&gt;</code>，因为每个国家的<code class="fe op oq or os b">href</code>会有所不同。</p><p id="df2f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们也不能捕获<code class="fe op oq or os b">&lt;td style=”font-weight: bold; text-align:right”&gt;</code>，因为上面显示了许多我们不想要的其他数字(例如<code class="fe op oq or os b">2,467,761</code>)。</p><p id="6644" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，最好是捕获后面跟有<code class="fe op oq or os b">&lt;a&gt;</code>标签的<code class="fe op oq or os b">&lt;td style=”font-weight: bold; text-align:right”&gt;</code>。</p><p id="c99d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了提取，我们只对<em class="ps">树</em>使用<code class="fe op oq or os b">xpath</code>函数。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="5508" class="oy nh it os b gy pn po l pp pq">extracteditems = tree.xpath(<br/>    '//td[<a class="ae lh" href="http://twitter.com/style" rel="noopener ugc nofollow" target="_blank">@style</a>="font-weight: bold; text-align:right"]//a/text()')</span><span id="8306" class="oy nh it os b gy pr po l pp pq">print("\n".join(extracteditems))</span></pre><p id="aadb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将得到一个列表，在这里我们用一个新行(即<code class="fe op oq or os b">"\n"</code>)将它们分开，并打印出来。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="4ffd" class="oy nh it os b gy pn po l pp pq">330,758,784<br/>46,752,556<br/>145,926,781<br/>67,841,324<br/>60,472,650<br/>... and many more ...</span></pre><p id="727e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">轻松点。</p><p id="4395" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di"> 3 </span> <strong class="lk jd">从</strong> <code class="fe op oq or os b"><strong class="lk jd">tag</strong></code> <strong class="lk jd">中提取</strong> <code class="fe op oq or os b"><strong class="lk jd">attrib</strong></code> <strong class="lk jd">值。</strong>简单回顾一下，在练习 3 中，我们想要提取网站的图片 URL。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qc"><img src="../Images/3f8cfbeefcc70262195cf5e2095a8507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BTCAgS7xmB7NbwUl8iBJPQ.png"/></div></div></figure><p id="8dfe" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在 HTML 中，图像 URL 存储为<code class="fe op oq or os b">img</code>标签的<code class="fe op oq or os b">src</code>属性。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="fb3a" class="oy nh it os b gy pn po l pp pq">&lt;img src="/img/alert-plus.png" style="height:16px; width:16px" /&gt;</span></pre><p id="ba10" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要提取它，我们首先需要先提取<code class="fe op oq or os b">img</code>元素，然后使用下面的特殊提取，即<code class="fe op oq or os b">list(map(lambda ...))</code>来提取每个<code class="fe op oq or os b">src</code>属性，即<code class="fe op oq or os b">x.attrib.get(‘src’)</code>。</p><p id="715f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe op oq or os b">x</code>是每个<code class="fe op oq or os b">elements</code>内的一个单项。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="344d" class="oy nh it os b gy pn po l pp pq">elements = tree.xpath(‘//img’)<br/>extracteditems = list(map(lambda x: x.attrib.get(‘src’), elements))<br/>print(“\n”.join(extracteditems))</span></pre><p id="712d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由此，我们现在可以得到</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="d700" class="oy nh it os b gy pn po l pp pq">/img/worldometers-logo.gif<br/>/images/alert.png<br/>/img/alert-plus.png<br/>... and a few others ...</span></pre><p id="ad10" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在<code class="fe op oq or os b">list(map(lambda ...))</code>上有点复杂，但这是一种提取元素列表中各个项目的方法。</p><p id="3f19" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di"> 4 </span> <strong class="lk jd">迭代每个</strong> <code class="fe op oq or os b"><strong class="lk jd">tag</strong></code> <strong class="lk jd">来提取</strong> <code class="fe op oq or os b"><strong class="lk jd">sub-tags</strong></code> <strong class="lk jd">。</strong>简单回顾一下，在练习 4 中，我们想要提取每个大洲的高级数字</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qb"><img src="../Images/a1b074f848aee4bfae56c17060d11cb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IiNHhm0KSpaXxjoLsGFUsg.png"/></div></div></figure><p id="9441" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">更具体地说，当我们进入其中一个大陆时，值如下所示，这就是我们要提取的内容。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qd"><img src="../Images/8615c9344379298f576364fe10cb2d46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zn3g1ARLzNJRSdgLExMh0w.png"/></div></div></figure><p id="9c12" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们查看 HTML，每个大洲的数据都用具有<code class="fe op oq or os b">"total_row_world row_continnet"</code>的<code class="fe op oq or os b">class</code>属性的<code class="fe op oq or os b">tr</code>分组。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="1dac" class="oy nh it os b gy pn po l pp pq">&lt;tr class="total_row_world row_continent" data-continent="Europe" style="display: none"&gt;<br/>  &lt;td&gt;&lt;/td&gt;<br/>  &lt;td style="text-align:left;"&gt;&lt;nobr&gt;Europe&lt;/nobr&gt;&lt;/td&gt;    <br/>  &lt;td&gt;1,741,129&lt;/td&gt;<br/>  &lt;td&gt;&lt;/td&gt;<br/>  &lt;td&gt;160,482&lt;/td&gt;<br/>  &lt;td&gt;&lt;/td&gt;<br/>  &lt;td&gt;739,811&lt;/td&gt;<br/>  &lt;td&gt;840,836&lt;/td&gt;<br/>  &lt;td&gt;12,196&lt;/td&gt;<br/>  &lt;td&gt;&lt;/td&gt;<br/>  &lt;td&gt;&lt;/td&gt;<br/>  &lt;td&gt;&lt;/td&gt;<br/>  &lt;td&gt;&lt;/td&gt;<br/>  &lt;td&gt;&lt;/td&gt;<br/>  &lt;td style="display:none;" data-continent="Europe"&gt;Europe&lt;/td&gt;<br/>&lt;/tr&gt;</span></pre><p id="35d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们提取<code class="fe op oq or os b">"total_row_world row_continnet"</code>作为信息段。</p><p id="6196" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了进一步提取每个部分中的每一项，我们创建了一个单独的函数名<code class="fe op oq or os b">extractElements</code>，如下所示。我们发送<code class="fe op oq or os b">x</code>,它是各个部分中的每个部分。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="6827" class="oy nh it os b gy pn po l pp pq">sections = tree.xpath(<br/>    '//tr[<a class="ae lh" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>="total_row_world row_continent"]')</span><span id="a819" class="oy nh it os b gy pr po l pp pq">extracteditems = list(map(lambda x: <br/>    '\"' + str(<strong class="os jd">extractElements(x)</strong>) + '\"', sections))</span><span id="2af7" class="oy nh it os b gy pr po l pp pq">print("\n".join(extracteditems))</span></pre><p id="5047" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在在函数<code class="fe op oq or os b">extractElements</code>中，我们使用<code class="fe op oq or os b">findall</code>提取出所有的<code class="fe op oq or os b">td</code>标签，并再次使用<code class="fe op oq or os b">list(map(lambda ...))</code>单独提取它的<code class="fe op oq or os b">text</code>。</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="4f01" class="oy nh it os b gy pn po l pp pq">def extractElements(element):<br/>    return list(map(lambda x: x.text, element.findall('.//td')))</span></pre><p id="ed45" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">输出如下所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qe"><img src="../Images/f9bed13842ede0d01bd10d207ce247db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LFdr9JMUq-85VovhSu79XA.png"/></div></div></figure><p id="6882" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就是这样！</p><p id="8d33" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了进一步说明<code class="fe op oq or os b">element.findall(‘.//td’)</code>是如何工作，我使用了一个 for 循环来单独打印每个提取的</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="6119" class="oy nh it os b gy pn po l pp pq">def extractElements(element):<br/><strong class="os jd">  for item in element.findall('.//td'):<br/>    print('  EXTRACTED: ' + str(item.text))</strong></span><span id="ddde" class="oy nh it os b gy pr po l pp pq">return list(map(lambda x: x.text, element.findall('.//td')))</span></pre><p id="9c8a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">输出如下所示</p><pre class="ks kt ku kv gt pj os pk pl aw pm bi"><span id="3c99" class="oy nh it os b gy pn po l pp pq">EXTRACTED: 1,741,129<br/>EXTRACTED: +22,456<br/>EXTRACTED: 160,482<br/>EXTRACTED: +1,414<br/>EXTRACTED: 739,811<br/>... and more ...<br/>EXTRACTED: Europe<br/>EXTRACTED: None<br/>EXTRACTED:</span></pre></div><div class="ab cl qf qg hx qh" role="separator"><span class="qi bw bk qj qk ql"/><span class="qi bw bk qj qk ql"/><span class="qi bw bk qj qk"/></div><div class="im in io ip iq"><p id="5a1e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">学会了这四种方法，你现在就有了探索你感兴趣的网站并提取相关信息进行进一步处理的基本要素。🛠</p><p id="62ff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">干杯。</p></div><div class="ab cl qf qg hx qh" role="separator"><span class="qi bw bk qj qk ql"/><span class="qi bw bk qj qk ql"/><span class="qi bw bk qj qk"/></div><div class="im in io ip iq"><p id="86d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">感谢阅读。你可以在这里查看我的其他话题<a class="ae lh" href="https://medium.com/@elye.project/" rel="noopener"/>。</p><p id="f76c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以在<a class="ae lh" href="https://medium.com/@elye.project" rel="noopener"><em class="ps"/></a><em class="ps"/><a class="ae lh" href="https://twitter.com/elye_project" rel="noopener ugc nofollow" target="_blank"><em class="ps">Twitter</em></a><em class="ps"/><a class="ae lh" href="https://www.facebook.com/elye.project/" rel="noopener ugc nofollow" target="_blank"><em class="ps">脸书</em></a><em class="ps"/>或<a class="ae lh" href="https://www.reddit.com/user/elyeproj/" rel="noopener ugc nofollow" target="_blank"> <em class="ps"> Reddit </em> </a>上关注我，了解关于移动开发、媒体写作等相关主题的小技巧和学习。~Elye~</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="qm qn l"/></div></figure></div></div>    
</body>
</html>