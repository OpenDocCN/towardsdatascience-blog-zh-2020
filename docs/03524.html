<html>
<head>
<title>Creating a simple folium map — COVID-19 worldwide total case</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个简单的叶子地图-新冠肺炎全球总案例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-a-simple-folium-map-covid-19-worldwide-total-case-a0a1429c6e7c?source=collection_archive---------11-----------------------#2020-04-03">https://towardsdatascience.com/creating-a-simple-folium-map-covid-19-worldwide-total-case-a0a1429c6e7c?source=collection_archive---------11-----------------------#2020-04-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="48a2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从数字到互动地图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/59fbc0a742a5b84176219c70bbaf19cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P5M6U2AGBXbzWOHn"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@iambrettzeck?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Brett Zeck </a>拍照</p></figure><p id="657d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文中显示的所有代码都可以在我的GitHub repo <a class="ae ky" href="https://github.com/cornelliusyudhawijaya/Folium_covid" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="3b26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建交互式地图有很多方法，但我最喜欢的方法是通过<a class="ae ky" href="https://python-visualization.github.io/folium/index.html" rel="noopener ugc nofollow" target="_blank">叶子</a>；基于Python语言的地图可视化库。</p><p id="5d8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我想展示如何创建一个很好的交互式地图，以及当前的情况(2020年4月4日)；代表病情的最佳数据应该是世界上新冠肺炎确诊病例的数量。让我们开始吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0617" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建地图</h1><p id="bfa2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于不知道叶子是什么的你；它基本上是一个地图可视化库，有许多内置的专门用于创建交互式地图。我们可以使用下面的命令来安装叶库。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="40a4" class="ne md it na b gy nf ng l nh ni">#Installation via pip<br/>pip install folium</span><span id="d2df" class="ne md it na b gy nj ng l nh ni">#or, installation via conda<br/>conda install folium -c conda-forge</span></pre><p id="1b8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像我们已经安装了我们的库。现在，让我们尝试展示一个简单的交互式地图(或底图)。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2d91" class="ne md it na b gy nf ng l nh ni">import folium</span><span id="1c83" class="ne md it na b gy nj ng l nh ni">#Creating a base map<br/>m = folium.Map()<br/>m</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/e3b966380a12bb96764ca7e647eb3263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YP0NZMZqV82egUwNG40Kkg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用leav的交互式底图示例</p></figure><p id="98bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经有了我们的基本地图。在这种情况下，我想创建一个世界地图，显示截至今天(2020年4月3日)新冠肺炎确诊病例的彩色国家部分(这基本上是我们所说的choropleth地图)。</p><p id="4d0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要做到这一点，我们首先需要有实际的数据。幸运是，现在有许多现有的API提供这种数据。在我的例子中，我会使用来自thevirustracker.com的API。让我们试着从API中提取一些数据。下面是从API提取数据的步骤。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8595" class="ne md it na b gy nf ng l nh ni">#We would use the requests module to pull the data from API<br/>import requests</span><span id="a1a5" class="ne md it na b gy nj ng l nh ni">#Pulling the Worldwide COVID-19 data, we use the get function from requests module with API endpoint(Basically a URL address to request your data) as the function parameter. To know available endpoint, check the API documentation</span><span id="cec5" class="ne md it na b gy nj ng l nh ni">res = requests.get('<a class="ae ky" href="https://api.thevirustracker.com/free-api?countryTotals=ALL'" rel="noopener ugc nofollow" target="_blank">https://api.thevirustracker.com/free-api?countryTotals=ALL'</a>)</span><span id="de92" class="ne md it na b gy nj ng l nh ni">#We turn the data into json. It would become dictionary in the Python.<br/>covid_current = res.json()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/339b6f26f899e3cdbe4469ec71166372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h01VMMcsBTs5klDW4MpvMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从API中以JSON格式提取的数据(字典)</p></figure><p id="d854" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的数据中，我们可以看到有很多可用的数据，但在这种情况下，我只取国家(' title ')和总案例(' total_cases ')的数据。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="cee2" class="ne md it na b gy nf ng l nh ni">#Creating the COVID-19 DataFrame</span><span id="0cf7" class="ne md it na b gy nj ng l nh ni">df = []<br/>for j in range(1,len(covid_current['countryitems'][0])):<br/>    df.append([covid_current['countryitems'][0]['{}'.format(j)]  ['title'],<br/>         covid_current['countryitems'][0]['{}'.format(j)]['total_cases']])</span><span id="72d5" class="ne md it na b gy nj ng l nh ni">df_covid = pd.DataFrame(df, columns = ['Country', 'Total Case'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/62886e9df0d52a5c45ed210d583f3ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*N7wOcaiAOZC0YIJQ0o6C5Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的新冠肺炎数据</p></figure><p id="ccd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于最后一个数据，我们还需要一个世界各国的GeoJSON数据。GeoJSON数据是一种表示地理要素(如国家边界)的数据格式。对于我们的情况，leav已经拥有了我们可以使用的GeoJSON数据。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="da29" class="ne md it na b gy nf ng l nh ni">#Setting up the world countries data URL<br/>url = '<a class="ae ky" href="https://raw.githubusercontent.com/python-visualization/folium/master/examples/data'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/python-visualization/folium/master/examples/data'</a></span><span id="c01c" class="ne md it na b gy nj ng l nh ni">country_shapes = f'{url}/world-countries.json'</span></pre><p id="5c43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还将清理新冠肺炎数据，因为在下一步中，我将在地图上使用由clean提供的世界国家数据。在这种情况下，我需要在新冠肺炎数据集中使用我的国家名称，以跟随由leav提供的国家名称。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ee95" class="ne md it na b gy nf ng l nh ni">#Replacing the country name</span><span id="4af9" class="ne md it na b gy nj ng l nh ni">df_covid.replace('USA', "United States of America", inplace = True)<br/>df_covid.replace('Tanzania', "United Republic of Tanzania", inplace = True)<br/>df_covid.replace('Democratic Republic of Congo', "Democratic Republic of the Congo", inplace = True)<br/>df_covid.replace('Congo', "Republic of the Congo", inplace = True)<br/>df_covid.replace('Lao', "Laos", inplace = True)<br/>df_covid.replace('Syrian Arab Republic', "Syria", inplace = True)<br/>df_covid.replace('Serbia', "Republic of Serbia", inplace = True)<br/>df_covid.replace('Czechia', "Czech Republic", inplace = True)<br/>df_covid.replace('UAE', "United Arab Emirates", inplace = True)</span></pre><p id="981c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们有了数据，可以使用flour创建新冠肺炎确诊病例choropleth地图。下一步，我们只需要将choropleth图层添加到我们的底图中。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a103" class="ne md it na b gy nf ng l nh ni">#Adding the Choropleth layer onto our base map</span><span id="847f" class="ne md it na b gy nj ng l nh ni">folium.Choropleth(<br/>    #The GeoJSON data to represent the world country<br/>    geo_data=country_shapes,<br/>    name='choropleth COVID-19',<br/>    data=df_covid,<br/>    #The column aceppting list with 2 value; The country name and  the numerical value<br/>    columns=['Country', 'Total Case'],<br/>    key_on='feature.properties.name',<br/>    fill_color='PuRd',<br/>    nan_fill_color='white'<br/>).add_to(m)</span><span id="511b" class="ne md it na b gy nj ng l nh ni">m</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/5a2a0d364056c1c42c1da36276896306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4mEQmm8j00Onmz3hrCmjvg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新冠肺炎Choropleth地图</p></figure><p id="c018" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，我们已经有了一张简单的地图，代表了世界上确诊的新冠肺炎病例。我们可以看到，2020年4月3日的美国是最深的颜色。这是因为现在的病例数是最高的。一些国家如意大利、中国、西班牙、意大利的颜色也比其他国家略深，因为他们的确诊病例数仅次于美国。</p><p id="8cb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，我会添加一个可点击的标记来显示国家名称。在这种情况下，我们需要这个<a class="ae ky" href="https://developers.google.com/public-data/docs/canonical/countries_csv" rel="noopener ugc nofollow" target="_blank"> csv </a>文件中提供的每个国家的纬度和经度。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5ef6" class="ne md it na b gy nf ng l nh ni">for lat, lon, name in   zip(country['latitude'],country['longitude'],country['name']):<br/>    #Creating the marker<br/>    folium.Marker(<br/>    #Coordinate of the country<br/>    location=[lat, lon],<br/>    #The popup that show up if click the marker<br/>    popup=name<br/>    ).add_to(m)<br/>m</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/c4dfe8f72d6918ecf533cd8f97cfd8e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VFok0xeX7qvs0NHvUcvBsQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">有标记的choropleth地图</p></figure><p id="6eeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们到了。我们只是根据新冠肺炎确诊病例制作了一个简单的互动地图。我们仍然可以看到很多东西，比如恢复的病例、死亡病例、百分比等等。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5c87" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">结论</strong></h1><p id="c032" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">创建一个简单的交互式地图是很容易的叶库，我们需要的只是数据，现在可以通过API拉。Choropleth是世界上最适合可视化新冠肺炎确诊病例的地图之一。</p><p id="0dcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望有帮助！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="47e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="np">编者按:</em> </strong> <em class="np"> </em> <a class="ae ky" href="http://towardsdatascience.com/" rel="noopener" target="_blank"> <em class="np">走向数据科学</em> </a> <em class="np">是一份以数据科学和机器学习研究为主的中型刊物。我们不是健康专家或流行病学家，本文的观点不应被解释为专业建议。想了解更多关于疫情冠状病毒的信息，可以点击</em> <a class="ae ky" href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports" rel="noopener ugc nofollow" target="_blank"> <em class="np">这里</em> </a> <em class="np">。</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7a42" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如果您喜欢我的内容，并希望获得更多关于数据或数据科学家日常生活的深入知识，请考虑在此订阅我的<a class="ae ky" href="https://cornellius.substack.com/welcome" rel="noopener ugc nofollow" target="_blank">简讯。</a></h1><blockquote class="nq"><p id="b66e" class="nr ns it bd nt nu nv nw nx ny nz lu dk translated">如果您没有订阅为中等会员，请考虑通过<a class="ae ky" href="https://cornelliusyudhawijaya.medium.com/membership" rel="noopener">我的推荐</a>订阅。</p></blockquote></div></div>    
</body>
</html>