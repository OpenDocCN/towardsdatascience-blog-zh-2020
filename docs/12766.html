<html>
<head>
<title>Training a model on Google’s AI Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌的人工智能平台上训练一个模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/training-a-model-on-google-ai-platform-84ceff87b5f3?source=collection_archive---------19-----------------------#2020-09-02">https://towardsdatascience.com/training-a-model-on-google-ai-platform-84ceff87b5f3?source=collection_archive---------19-----------------------#2020-09-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/c2b87cc8724c62188e03cff84fc62b51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*16gqBBWlebCBfLvH"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">尼古拉·塔拉先科在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="0020" class="je jf jg bd b dl jh ji jj jk jl jm dk jn translated" aria-label="kicker paragraph">谷歌 ML 教程</h2><div class=""/><div class=""><h2 id="fb31" class="pw-subtitle-paragraph km jp jg bd b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dk translated">如何使用谷歌云服务在 Python 中训练模型</h2></div><p id="9452" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">欢迎阅读本系列关于在 Google 云平台上进行机器学习的第一篇文章！</p><p id="67f2" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们将看看<a class="ae jd" href="https://cloud.google.com/ai-platform/docs" rel="noopener ugc nofollow" target="_blank">人工智能平台</a>。它是与机器学习严格相关的工具的子集，其中包括:</p><ul class=""><li id="603e" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated"><strong class="lg jq"> AI 平台训练</strong>，用于在云上训练/调优模型</li><li id="ae7c" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated"><strong class="lg jq"> AI 平台预测</strong>，在云上托管训练好的模型</li><li id="a2f1" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated"><strong class="lg jq">人工智能管道</strong>，使用 Kubernetes 和 Docker 图像创建一步一步的流程</li></ul><p id="df94" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">和许多其他人。</p><p id="c8ec" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><em class="mo">免责声明:我与谷歌没有任何关系，我只是决定<br/>写这些文章来分享我在日常工作中使用这些工具获得的知识。</em></p><p id="daa9" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">对于这第一篇文章，我将重点关注<strong class="lg jq"> AI 平台培训</strong>，这是一个使用定制代码和可定制机器在云上运行<br/>培训任务的产品。我认为使用人工智能平台训练你的模型的主要优点是:</p><ul class=""><li id="80f1" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated">你可以使用<strong class="lg jq">更强大的资源</strong>(比如多个内核或者一个 GPU)而没有很多麻烦去实例化它们</li><li id="67e7" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated">你可以<strong class="lg jq">与你的团队共享</strong>代码，然后<strong class="lg jq">使用一个通用的云基础设施复制</strong>相同的结果</li></ul><p id="6765" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在本教程中，我们将使用训练的定义编写实际的<strong class="lg jq"> Python 应用</strong>，运行<strong class="lg jq">本地测试</strong>，并在云平台上执行<strong class="lg jq">训练作业</strong>。</p><h2 id="e7a8" class="mp mq jg bd mr ms mt dn mu mv mw dp mx ln my mz na lr nb nc nd lv ne nf ng jm bi translated">对于本教程，您需要</h2><ul class=""><li id="bff8" class="ma mb jg lg b lh nh lk ni ln nj lr nk lv nl lz mf mg mh mi bi translated">一个活跃的谷歌云平台账户(你可以访问<a class="ae jd" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">主页</a>建立一个新账户)和一个 GCP <em class="mo">项目</em></li><li id="6295" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated">安装在工作站上的 Python 3、<a class="ae jd" href="https://cloud.google.com/sdk/docs" rel="noopener ugc nofollow" target="_blank"> gcloud </a>和<a class="ae jd" href="https://cloud.google.com/storage/docs/gsutil_install" rel="noopener ugc nofollow" target="_blank"> gsutil </a></li><li id="7aa2" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated">用于教程的<a class="ae jd" href="https://archive.ics.uci.edu/ml/machine-learning-databases/00222/bank-additional.zip" rel="noopener ugc nofollow" target="_blank">数据集，UCI 的<strong class="lg jq"> <em class="mo">银行营销数据集</em> </strong>。</a><a class="ae jd" href="https://archive.ics.uci.edu/ml/datasets/Bank+Marketing" rel="noopener ugc nofollow" target="_blank">在这里</a> <br/>你可以找到关于数据集的文档。我们将使用<strong class="lg jq">完整</strong>版本。</li></ul><h1 id="a9b0" class="nm mq jg bd mr nn no np mu nq nr ns mx kv nt kw na ky nu kz nd lb nv lc ng nw bi translated">第一步:将数据存储在谷歌存储器上</h1><p id="154f" class="pw-post-body-paragraph le lf jg lg b lh nh kq lj lk ni kt lm ln nx lp lq lr ny lt lu lv nz lx ly lz ij bi translated">在本地机器上下载数据集之后，转到 GCP 项目的<a class="ae jd" href="https://console.cloud.google.com/storage/" rel="noopener ugc nofollow" target="_blank"> Google 存储控制台</a>。创建一个新的 bucket(我称之为<code class="fe oa ob oc od b">bank-marketing-model</code>)并在其中加载数据集。现在，您的桶应该看起来像这样:</p><figure class="of og oh oi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oe"><img src="../Images/704b11888745c5ed0d197e039a9bcd8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gu9jpjxBDYC76IyO9Z0ZDA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><p id="3f88" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">或者，以一种更古怪的方式，您可以从命令行使用<code class="fe oa ob oc od b">gsutil</code>。进入包含数据集的本地目录并运行</p><pre class="of og oh oi gt oj od ok ol aw om bi"><span id="1c7c" class="mp mq jg od b gy on oo l op oq">gsutil mb gs://bank-marketing-model<br/>gsutil cp ./bank-additional-full.csv gs://bank-marketing-model</span></pre><ul class=""><li id="1a67" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated"><code class="fe oa ob oc od b">gsutil mb</code>创造了水桶</li><li id="2576" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated"><code class="fe oa ob oc od b">gsutil cp </code>将文件从本地路径复制到 GCS 存储桶</li></ul><h1 id="2868" class="nm mq jg bd mr nn no np mu nq nr ns mx kv nt kw na ky nu kz nd lb nv lc ng nw bi translated">步骤 2:编写 Python 培训应用程序</h1><p id="b916" class="pw-post-body-paragraph le lf jg lg b lh nh kq lj lk ni kt lm ln nx lp lq lr ny lt lu lv nz lx ly lz ij bi translated">如果你正在阅读这篇文章，很可能你已经知道如何编写一个端到端的 Python 程序来训练一个机器学习模型。无论如何，因为我们计划在云上训练模型，有一些步骤在某种程度上不同于通常的<em class="mo"> Kaggle-ish </em>代码。</p><p id="6ed1" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">首先要记住的是，<strong class="lg jq">你只能使用 scikit-learn、XGBoost 或<br/> Tensorflow </strong>来训练你的模型(Pytorch 处于测试阶段，有一种方法可以使用定制的 Python 环境，但我们会在另一篇文章中看到)。</p><p id="ec11" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">因此，Python 应用程序的基础是:</p><ul class=""><li id="ef8e" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated">从存储中下载数据集</li></ul><pre class="of og oh oi gt oj od ok ol aw om bi"><span id="d981" class="mp mq jg od b gy on oo l op oq">subprocess.call([<br/>    'gsutil', 'cp',<br/>    # Storage path<br/>    os.path.join('gs://', STORAGE_BUCKET, DATA_PATH),<br/>    # Local path<br/>    os.path.join(LOCAL_PATH, 'dataset.csv')<br/>])</span><span id="f94c" class="mp mq jg od b gy or oo l op oq">df = pd.read_csv(os.path.join(LOCAL_PATH, 'dataset.csv'), sep=';')</span></pre><ul class=""><li id="68fb" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated">做一些数据准备(分割训练测试、缺失插补等)并创建管道</li></ul><pre class="of og oh oi gt oj od ok ol aw om bi"><span id="4b83" class="mp mq jg od b gy on oo l op oq">train, test = train_test_split(df, test_size=args.test_size,<br/>                               random_state=42)</span><span id="b46a" class="mp mq jg od b gy or oo l op oq">...</span><span id="d86b" class="mp mq jg od b gy or oo l op oq">pipeline = Pipeline([<br/>    # The ColumnTransformer divide the preprocessing process between<br/>    # categorical and numerical data<br/>    ('data_prep',<br/>     ColumnTransformer([<br/>        ('num_prep', StandardScaler(), num_features),<br/>        ('cat_prep', OneHotEncoder(), cat_features)<br/>     ])),<br/>    # ML model<br/>    ('model',<br/>     RandomForestClassifier(<br/>         random_state=42,<br/>         n_jobs=args.n_jobs,<br/>         n_estimators=args.n_estimators,<br/>         max_depth=args.max_depth,<br/>         max_features=args.max_features if args.max_features is not<br/>                                              None else 'sqrt',<br/>         min_samples_split=args.min_samples_split,<br/>         class_weight='balanced',<br/>         max_samples=args.max_samples<br/>     ))<br/>])</span></pre><ul class=""><li id="2e0c" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated">训练模型</li></ul><pre class="of og oh oi gt oj od ok ol aw om bi"><span id="f1d5" class="mp mq jg od b gy on oo l op oq">pipeline.fit(train, y_train)</span></pre><ul class=""><li id="ffe2" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated">获取一些性能指标</li></ul><pre class="of og oh oi gt oj od ok ol aw om bi"><span id="4f7a" class="mp mq jg od b gy on oo l op oq">results = pd.DataFrame(<br/>    {'accuracy': [accuracy_score(y_train, pred_train),<br/>                  accuracy_score(y_test, pred_test)],<br/>     'precision': [precision_score(y_train, pred_train, pos_label='yes'),<br/>                   precision_score(y_test, pred_test, pos_label='yes')],<br/>     'recall': [recall_score(y_train, pred_train, pos_label='yes'),<br/>                recall_score(y_test, pred_test, pos_label='yes')],<br/>     'f1': [f1_score(y_train, pred_train, pos_label='yes'),<br/>            f1_score(y_test, pred_test, pos_label='yes')]},<br/>    index=['train', 'test']<br/>)</span></pre><ul class=""><li id="d89a" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated">将训练好的模型和结果存储在存储器上</li></ul><pre class="of og oh oi gt oj od ok ol aw om bi"><span id="50fe" class="mp mq jg od b gy on oo l op oq">subprocess.call([<br/>    'gsutil', 'cp',<br/>    # Local path of the model<br/>    os.path.join(LOCAL_PATH, 'model.joblib'),<br/>    os.path.join(args.storage_path, 'model.joblib')<br/>])<br/>subprocess.call([<br/>    'gsutil', 'cp',<br/>    # Local path of results<br/>    os.path.join(LOCAL_PATH, 'results.csv'),<br/>    os.path.join(args.storage_path, 'results.csv')<br/>])</span></pre><p id="7d2a" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">你可以在<a class="ae jd" href="https://github.com/MatteoFelici/medium/blob/master/ai-platform-training/src/train.py" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到完整的代码。<br/> <br/> <em class="mo">注意:在代码的顶部有一些你可以调整的参数。</em></p><h1 id="e948" class="nm mq jg bd mr nn no np mu nq nr ns mx kv nt kw na ky nu kz nd lb nv lc ng nw bi translated">步骤 3:在本地测试代码</h1><p id="1aee" class="pw-post-body-paragraph le lf jg lg b lh nh kq lj lk ni kt lm ln nx lp lq lr ny lt lu lv nz lx ly lz ij bi translated">在云平台上提交训练过程之前，最好在本地测试代码。无论是本地培训还是云端培训，我们都会使用<code class="fe oa ob oc od b">gcloud</code>；要运行的命令非常相似，但也有一些不同。</p><p id="5a56" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">首先，<strong class="lg jq">用 AI 平台</strong>在本地训练模型，我们可以写一个命令“还原”这个逻辑:<code class="fe oa ob oc od b">gcloud ai-platform</code>(用 AI 平台)<code class="fe oa ob oc od b">local</code>(本地)<code class="fe oa ob oc od b">train</code>(训练模型)。我们添加了一些参数，其中一些特定于训练过程，另一些在我们的定制 Python 应用程序中定义。</p><p id="df5a" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">进入主目录和<code class="fe oa ob oc od b">src</code>目录后，完整的命令如下:</p><pre class="of og oh oi gt oj od ok ol aw om bi"><span id="4b67" class="mp mq jg od b gy on oo l op oq">gcloud ai-platform local train \<br/>    --module-name=src.train \<br/>    --package-path=./src \<br/>    -- \<br/>    --storage-path=gs://bank-marketing-model/test \<br/>    --n-estimators=25</span></pre><p id="afa8" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">让我们来看看参数:</p><ul class=""><li id="aca5" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated"><code class="fe oa ob oc od b">module-name</code>是要运行的 Python 模块的名称，以<code class="fe oa ob oc od b">directory.python_file</code>的形式</li><li id="bc81" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated"><code class="fe oa ob oc od b">package-path</code>是模块目录的路径</li><li id="07a2" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated"><code class="fe oa ob oc od b">—- </code>告诉我们开始发送自定义参数</li></ul><p id="39be" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">由于这是一次测试，我们为随机森林指定了少量的树。</p><p id="b9e4" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">请记住，即使这是一个本地测试运行，它也会创建所有的工件，并将它们保存到您的存储桶中。如果一切运行无误，我们就可以切换到云上的实际训练了！</p><h1 id="f7fe" class="nm mq jg bd mr nn no np mu nq nr ns mx kv nt kw na ky nu kz nd lb nv lc ng nw bi translated">第四步:在人工智能平台上训练</h1><p id="db55" class="pw-post-body-paragraph le lf jg lg b lh nh kq lj lk ni kt lm ln nx lp lq lr ny lt lu lv nz lx ly lz ij bi translated">现在我们已经编写了应用程序并对其进行了测试，我们终于可以在平台上训练我们的模型了。例如，我们可以实例化一个多核机器类型，并将森林的训练并行化。</p><p id="bd7c" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如前所述，bash 代码非常相似，但是我们必须调用另一组命令。我们用<code class="fe oa ob oc od b">jobs submit training</code>代替<code class="fe oa ob oc od b">local train</code>:</p><pre class="of og oh oi gt oj od ok ol aw om bi"><span id="fe2d" class="mp mq jg od b gy on oo l op oq">gcloud ai-platform jobs submit training $JOB_NAME \<br/>    --module-name=src.train \<br/>    --package-path=./src \<br/>    --staging-bucket=gs://bank-marketing-model \<br/>    --region=$REGION \<br/>    --scale-tier=CUSTOM \<br/>    --master-machine-type=n1-standard-8 \<br/>    --python-version=3.7 \<br/>    --runtime-version=2.2 \<br/>    -- \<br/>    --storage-path=gs://bank-marketing-model/$JOB_NAME \<br/>    --n-estimators=500 \<br/>    --n-jobs=8</span></pre><p id="4f01" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">让我们再一次看看新的参数:</p><ul class=""><li id="1fce" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated"><code class="fe oa ob oc od b">module-name</code>和<code class="fe oa ob oc od b">package-path</code>与之前相同</li><li id="49c4" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated"><code class="fe oa ob oc od b">staging-bucket</code>指向存储训练工件的 Google 存储桶</li><li id="7abf" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated"><code class="fe oa ob oc od b">region</code>是谷歌云地区(<a class="ae jd" href="https://cloud.google.com/compute/docs/regions-zones" rel="noopener ugc nofollow" target="_blank">此处</a>为完整列表)。由于为这些作业实例化的机器位于世界各地，您可能希望指定在哪里实例化机器。如果您不确定如何设置该参数，只需设置离您最近的区域即可！</li><li id="ab82" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated"><code class="fe oa ob oc od b">scale-tier</code>指定用于培训的机器类型。这是一个<br/>高级参数，您可以将其设置为默认配置(如<code class="fe oa ob oc od b">BASIC</code>或<code class="fe oa ob oc od b">STANDARD_1</code>)，或者将其设置为<code class="fe oa ob oc od b">CUSTOM</code>并使用<code class="fe oa ob oc od b">master-machine-type</code>参数来使用机器的低级定义。在我们的示例中，我们使用一台带有<strong class="lg jq"> 8 </strong>内核的<em class="mo">标准</em>机器。我们也可以指定<code class="fe oa ob oc od b">highmem</code>(更多内存)或<code class="fe oa ob oc od b">highcpu</code>(更多虚拟 CPU)来代替<code class="fe oa ob oc od b">standard`</code>。这里的<a class="ae jd" href="https://cloud.google.com/ai-platform/training/docs/machine-types#compare-machine-types" rel="noopener ugc nofollow" target="_blank">是<code class="fe oa ob oc od b">scale-tier</code>和可用机器的完整列表</a>。</li><li id="39df" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated"><code class="fe oa ob oc od b">python-version</code>和<code class="fe oa ob oc od b">runtime-version</code>参数指定安装在机器上的软件包的主干。对于每个<em class="mo">运行时</em> ( <a class="ae jd" href="https://cloud.google.com/ai-platform/training/docs/runtime-version-list" rel="noopener ugc nofollow" target="_blank">这里是</a>完整列表)我们都有一个或多个可以使用的 Python 版本，以及一个已经安装的 Python 包列表。</li></ul><blockquote class="os ot ou"><p id="bd90" class="le lf mo lg b lh li kq lj lk ll kt lm ov lo lp lq ow ls lt lu ox lw lx ly lz ij bi translated">额外提示:如果你想安装一个运行时列表中没有的包，在你的应用程序顶部添加一个“pip”命令，比如</p><p id="7f4a" class="le lf mo lg b lh li kq lj lk ll kt lm ov lo lp lq ow ls lt lu ox lw lx ly lz ij bi translated">subprocess.call(["pip "，" install "，包名)</p></blockquote><ul class=""><li id="31fe" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated">对于我们的自定义参数，我们设置了更多的估计器，并指定并行运行 8 个作业。</li></ul><p id="980a" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">注意:上面代码中的<code class="fe oa ob oc od b">$JOB_NAME</code>不是一个有效的名称，但是它是对之前定义的 bash 变量的引用。每次指定一个<br/>不同的工作名称是非常重要的。例如，在<a class="ae jd" href="https://github.com/MatteoFelici/medium/blob/master/ai-platform-training/cloud_train.sh" rel="noopener ugc nofollow" target="_blank"> cloud_train </a>和<br/>脚本中可以看到，我们可以指定</p><pre class="of og oh oi gt oj od ok ol aw om bi"><span id="8394" class="mp mq jg od b gy on oo l op oq">JOB_NAME=bank_marketing_$(date +%Y%m%d_%H%M%S)</span></pre><p id="45c0" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">所以后缀每次都会随着实际的日期和时间而改变。</p><p id="148f" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果你是第一次使用这个工具，它可能会要求你启用一个特定的 Google API(像<code class="fe oa ob oc od b">ml.googleapis.com</code>):接受启用它并继续。如果一切正常，该命令应该返回如下内容</p><figure class="of og oh oi gt is gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/ebdc9b333bd145c35d3c1b0166455135.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*B6Rup99gm8et5zXpqchDQA.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><p id="1f4e" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在你的<a class="ae jd" href="https://console.cloud.google.com/ai-platform/jobs" rel="noopener ugc nofollow" target="_blank">谷歌人工智能平台作业控制台</a>中，你应该会看到新的作业正在运行</p><figure class="of og oh oi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oz"><img src="../Images/beac9bc9b07d3d9f58b44e194ce457ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qXoOMDyKlF9BGu2-hgyxFg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><p id="162c" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，您可以通过两种方式监控培训作业:</p><ul class=""><li id="3e85" class="ma mb jg lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated">使用建议的命令<code class="fe oa ob oc od b">gcloud ai-platform jobs stream-logs $JOB_NAME</code></li><li id="2504" class="ma mb jg lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated">点击作业控制台上的<em class="mo">查看日志</em></li></ul><figure class="of og oh oi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pa"><img src="../Images/9082044ba2abce8119d4506aaf5fc873.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p-lNdAKOJil1xLaXrOeePg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><p id="857a" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">万岁！作业正确结束。让我们来看看我们的储物桶:</p><figure class="of og oh oi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pb"><img src="../Images/f5b360936f875c1773d1e584065f3f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ReHaYgNQc0OY7ox4Scca8Q.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><p id="6ec0" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们有了<code class="fe oa ob oc od b">model.joblib</code>对象、具有模型性能的<code class="fe oa ob oc od b">results.csv</code>文件以及由作业自动创建的用于存储 Python 应用程序的文件夹。</p><p id="1a3b" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">让我们来看看模型的性能…我们可以下载结果文件，或者键入命令</p><pre class="of og oh oi gt oj od ok ol aw om bi"><span id="18b4" class="mp mq jg od b gy on oo l op oq">gsutil cat gs://your-bucket/your/path/to/results.csv</span></pre><p id="eb88" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">直接在命令行上查看文件。</p><p id="d1be" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">对于我的训练模型，我得到了以下结果:</p><pre class="of og oh oi gt oj od ok ol aw om bi"><span id="21b6" class="mp mq jg od b gy on oo l op oq">  Measure    |  Train   |   Test   <br/> ------------|----------|---------- <br/>  Accuracy   |  81.53%  |  81.01%  <br/>  Precision  |  37.00%  |  36.40%  <br/>  Recall     |  91.42%  |  90.05%  <br/>  F1         |  52.68%  |  51.85%</span></pre><p id="e8b5" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">这些是相当好的结果，但是我们可以通过<a class="ae jd" rel="noopener" target="_blank" href="/tuning-a-model-with-bayesian-optimization-on-google-ai-platform-d9fe63b78576"> <strong class="lg jq">调整模型的超参数</strong> </a>来做得更好。在下一篇文章中，我们将看到如何稍微改变训练应用程序，使 AI 平台使用<strong class="lg jq">贝叶斯优化过程</strong>搜索最佳超参数！</p><p id="e6ad" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">感谢阅读，我希望你会发现这是有用的！</p></div></div>    
</body>
</html>