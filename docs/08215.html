<html>
<head>
<title>A Practical Guide to Getting Set-up with PostgreSQL 🐘</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PostgreSQL入门实用指南🐘</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-practical-guide-to-getting-set-up-with-postgresql-a1bf37a0cfd7?source=collection_archive---------27-----------------------#2020-06-16">https://towardsdatascience.com/a-practical-guide-to-getting-set-up-with-postgresql-a1bf37a0cfd7?source=collection_archive---------27-----------------------#2020-06-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2008" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Python的PostgreSQL、pgAdmin和SQLAlchemy入门。将SQL融入Python项目的核心。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cc14bfa254930f50c320e8e5d76b6ea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Lc1LSNIN1prMH0vS"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@bepnamanh?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">南安</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="8959" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为当前的或者有抱负的数据专业人士，我们经常被提醒具有扎实的SQL基础的重要性(如果你不相信，可以看看<a class="ae kv" href="https://www.dataquest.io/blog/why-sql-is-the-most-important-language-to-learn/" rel="noopener ugc nofollow" target="_blank">这个</a>、<a class="ae kv" rel="noopener" target="_blank" href="/the-most-in-demand-skills-for-data-scientists-4a4a8db896db">这个</a>和<a class="ae kv" href="https://learnsql.com/blog/four-reasons-aspiring-data-scientists-must-learn-sql/" rel="noopener ugc nofollow" target="_blank">这个</a>)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/217e1610bb243fa1ecaa2a6e6cadc346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UTOe6uFJ07DTdEJa.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:“<a class="ae kv" href="https://www.dataquest.io/blog/why-sql-is-the-most-important-language-to-learn/" rel="noopener ugc nofollow" target="_blank">想要一份数据方面的工作？学习SQL”，DataQuest博客</a></p></figure><p id="fb9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然，也许没有Python或机器学习那么吸引人，但你很难找到一个不引用SQL的数据科学招聘广告(见上图)。也就是说，有多种语言可供选择，有许多不同的工具可以用来与数据库进行交互，学习SQL时很难知道从哪里开始。</p><p id="8262" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然尝试通过嵌入式ide(如<a class="ae kv" href="https://www.datacamp.com/" rel="noopener ugc nofollow" target="_blank"> DataCamp </a>或<a class="ae kv" href="https://www.dataquest.io/" rel="noopener ugc nofollow" target="_blank"> DataQuest </a>)的在线课程来学习SQL可能很诱人，但真正的学习过程是在我们能够玩和试验自己的个人项目时。要做到这一点，我们必须能够:建立我们自己的数据库，加载相关的数据集，并查询我们的数据。这篇文章的目的是展示我们如何在几分钟内设置好所有这些事情。</p><h1 id="4e46" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">安装PostgreSQL和pgAdmin</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/a20297aa7fb216b4123918fb54b9a8f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qkG8HH1w-B44q7fiy52CYA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PostgreSQL官方logo，来源:<a class="ae kv" href="https://wiki.postgresql.org/wiki/File:PostgreSQL_logo.3colors.svg" rel="noopener ugc nofollow" target="_blank">https://wiki . PostgreSQL . org/wiki/File:PostgreSQL _ logo . 3 colors . SVG</a></p></figure><p id="eeaa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有一系列数据库管理系统(DBMS)可供选择，特别是:PostgreSQL、MySQL、Oracle、SQL Server、SQLite。这里我们将使用<strong class="ky ir"> PostgreSQL </strong>:一个流行的开源解决方案(<a class="ae kv" href="https://www.compose.com/articles/what-postgresql-has-over-other-open-source-sql-databases/" rel="noopener ugc nofollow" target="_blank"><em class="mm">PostgreSQL优于其他开源SQL数据库</em> </a>)。</p><p id="76e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以在这里 安装PostgreSQL <a class="ae kv" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">。</strong></a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mn"><img src="../Images/314c894b934d040d92a159ab9767ad0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*34yPckwRVLlg-5CLLLaCxQ.png"/></div></div></figure><p id="0ed0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在安装过程中，确保勾选<strong class="ky ir"> pgAdmin 4 </strong>框；这将是我们机构的一个重要补充。如果您需要单独安装pgAdmin，您可以在此处<a class="ae kv" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank">安装</a>。</p><h1 id="b9c0" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">pgAdmin入门</h1><p id="8353" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">pgAdmin是Postgres的管理工具；它本质上位于我们的PostgreSQL安装之上，为我们提供了一个优雅的GUI来可视化数据库对象并与之交互。一旦我们安装了Postgres和pgAdmin(如上所述),我们就可以打开pgAdmin 4自己看了。如果这是我们第一次使用它，它应该会在浏览器窗口中弹出，并提示我们设置主密码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/18d446cbc9fbc6fa630de581f41e7435.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WHC0JbpqKzoM227q0Hvavg.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">探索pgAdmin</p></figure><p id="70ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所看到的，有一个服务器可供我们连接，对应于我们的本地PostgreSQL 12安装。在这里，我们可以看到默认的“postgres”数据库和一个包含数据库对象的嵌套列表。对于我们的设置，我们不需要太担心所有这些对象是什么，但是<a class="ae kv" href="https://www.postgresqltutorial.com/postgresql-server-and-database-objects/" rel="noopener ugc nofollow" target="_blank">这篇</a>文章很好地解释了基本概念，并且<a class="ae kv" href="https://www.pgadmin.org/docs/pgadmin4/3.x/managing_database_objects.html" rel="noopener ugc nofollow" target="_blank"> pgAdmin文档</a>更详细。</p><p id="a8db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们创建一个新的数据库，并尝试导入一些数据，这样我们就可以开始查询它了。我们假设没有SQL命令的先验知识，所以现在我们将使用pgAdmin的用户界面与PostgreSQL进行交互。为了保持话题性，我们将使用由欧洲疾病预防和控制中心<a class="ae kv" href="https://www.ecdc.europa.eu/en/publications-data/download-todays-data-geographic-distribution-covid-19-cases-worldwide" rel="noopener ugc nofollow" target="_blank">提供的<em class="mm">新冠肺炎地理病例分布</em>数据集，可以在</a><a class="ae kv" href="https://opendata.ecdc.europa.eu/covid19/casedistribution" rel="noopener ugc nofollow" target="_blank">这里</a>找到该数据集作为CSV。</p><p id="fcfb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建数据库非常简单，只需右键单击'<em class="mm">数据库</em>对象，选择'<em class="mm">创建</em>，然后选择'<em class="mm">数据库</em>，并选择一个合适的名称。同样，我们可以通过右键单击'<em class="mm"> Tables </em>'对象来创建一个表。现在唯一的区别是我们需要指定表中每一列的名称和数据类型。将我们的列的顺序与我们想要导入的数据集中的顺序相匹配是很重要的，尽管名称不一定必须相同。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/3676c8d6e7eb78cd88944966aaca3b04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HNIyxXVCGbkCFXWsixs5Fw.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在pgAdmin中创建新的数据库和表</p></figure><p id="f0a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经创建了数据库和一个表来存放CSV数据集，我们可以继续导入它了。右键单击我们刚刚创建的表对象，我们可以选择“导入/导出”对话框，指定我们要导入数据，选择我们选择的文件，并让pgAdmin知道数据有一个标题，我们希望在导入时跳过它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/fa26965b3f7946609cc92a76ef26b7e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BvXDFMURdm5u5PLvv1F6Gg.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用pgAdmin导入CSV数据集</p></figure><p id="5770" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们已经具备了开始查询项目数据所需的一切。导航到窗口的最顶端，我们可以选择'<em class="mm">工具</em>'菜单，然后是'<em class="mm">查询工具</em>'选项。这将在我们的窗口中打开一个新的选项卡，我们可以在其中编写并执行SQL代码，以便查看数据输出。我们甚至可以选择将输出下载为CSV文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/62e0839f0a134a0fa664b9cd372716fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*n6Zncibqamt1e5GNyt2pdg.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在pgAdmin中查询数据</p></figure><p id="9c26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们有了一个基本的设置，允许我们使用pgAdmin GUI与PostgreSQL数据库进行交互，让我们看看如何进一步扩展它。在下一节中，我们将看到如何以编程方式与PostgreSQL数据库进行交互:一种将Postgres嵌入项目核心的更实用的方法。</p><h1 id="1bab" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">SQLAlchemy和pandas——PostgreSQL的Pythonic接口</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/ffe746fdc59f213f58b908f56f38eef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iBhq9rOtKSmy5XWm"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Artem Maltsev 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2ee2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SQLAlchemy是一个整洁的Python库:自称为“Python的数据库工具包”，它使我们能够以干净、Python化的方式访问数据库的功能。我们可以用SQLAlchemy做的事情超出了这个设置的范围，但是如果你有兴趣进一步探索的话，官方的<a class="ae kv" href="https://www.sqlalchemy.org/" rel="noopener ugc nofollow" target="_blank">文档</a>和<a class="ae kv" href="https://www.tutorialspoint.com/sqlalchemy/index.htm" rel="noopener ugc nofollow" target="_blank">本教程</a>应该是足够的。在这里，我们将了解如何使用SQLAlchemy在Python脚本中向我们的数据库运行原始SQL命令，以及从pandas Dataframe加载数据。</p><h2 id="28e0" class="mv lu iq bd lv mw mx dn lz my mz dp md lf na nb mf lj nc nd mh ln ne nf mj ng bi translated">创建表格</h2><p id="f401" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">让我们从尝试复制上面创建一个表并加载到CSV数据集中的过程开始。创建表的SQL命令很简单；我们只需要提供一个表名和一个我们希望包含在表中的所有列的列表，以及它们对应的数据类型:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="9fed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加<code class="fe nj nk nl nm b">DROP TABLE IF EXISTS</code>意味着如果我们的<em class="mm"> worldwide_cases </em>表已经存在，那么我们将在运行<code class="fe nj nk nl nm b">CREATE TABLE</code>命令之前删除它。</p><p id="d295" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要从Python脚本中运行这些SQL命令，我们首先需要安装SQLAlchemy，这可以通过带有<code class="fe nj nk nl nm b">pip install SQLAlchemy</code>的pip简单地完成。关于替代安装方法，请查阅<a class="ae kv" href="https://docs.sqlalchemy.org/en/13/intro.html#installation-guide" rel="noopener ugc nofollow" target="_blank">官方安装指南</a>。</p><p id="dedd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以使用SQLAlchemy的<code class="fe nj nk nl nm b">create_engine</code>函数连接到Postgres数据库:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="20ad" class="mv lu iq nm b gy nr ns l nt nu"><em class="mm"># Connecting to Postgres</em></span><span id="e8a8" class="mv lu iq nm b gy nv ns l nt nu">from sqlalchemy import create_engine</span><span id="8f50" class="mv lu iq nm b gy nv ns l nt nu">connection_uri = 'postgres://username:password@host:port/database'<br/>engine = create_engine(connection_uri)</span></pre><p id="3e00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们传递给<code class="fe nj nk nl nm b">create_engine</code>的<code class="fe nj nk nl nm b">connection_uri</code>字符串让SQLAlchemy知道在哪里可以找到我们的数据库，它是使用上面给出的一般结构组成的。首先，我们让SQLAlchemy知道我们正在使用'<em class="mm"> postgres' </em>,而不是SQL的其他风格。然后，我们传递我们的'<em class="mm">用户名'</em>和'<em class="mm">密码'</em>(除非您专门创建了一个新用户，否则您可以使用默认用户名' postgres '和您最初设置的密码)。“<em class="mm">主机</em>和“<em class="mm">端口”</em>的值决定了数据库运行的服务器；鉴于我们已经在本地安装了Postgres，这很可能是<code class="fe nj nk nl nm b">localhost:5432</code>的默认设置。最后，我们指定我们试图连接的数据库的名称。关于构建URI的更多信息，你可以在这里找到文档<a class="ae kv" href="https://docs.sqlalchemy.org/en/13/core/engines.html#database-urls" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="28d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我们为数据库创建了一个引擎实例，我们就可以简单地使用以下命令来执行SQL命令:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="82ff" class="mv lu iq nm b gy nr ns l nt nu"># Executing SQL command<br/>with engine.connect() as con:<br/>    con.execute(sql)</span></pre><p id="b92b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将所有这些放在一起，我们可以编写一个<code class="fe nj nk nl nm b">create_table.py</code>脚本，它将连接到我们的数据库，并从我们的<code class="fe nj nk nl nm b">create_table.sql</code>文件中执行所需的SQL命令:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="125a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在应该在我们的<code class="fe nj nk nl nm b">covid-19</code>数据库中有一个名为<code class="fe nj nk nl nm b">worldwide_cases</code>的空白表(如果您按照上一节中的步骤操作，它将会覆盖我们之前创建的表)。您可以在pgAdmin中通过右键单击数据库并选择“Refresh”来验证这一点，这将使我们能够看到嵌套在“Schemas/public/Tables”下的表。或者，打开查询工具并运行命令<code class="fe nj nk nl nm b">SELECT * FROM worldwide_cases</code>。</p><p id="c172" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们将一些数据加载到我们的表中！</p><h2 id="2aa9" class="mv lu iq bd lv mw mx dn lz my mz dp md lf na nb mf lj nc nd mh ln ne nf mj ng bi translated">将数据加载到表中</h2><p id="cab5" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">将SQLAlchemy与熟悉的pandas库结合使用，加载数据再简单不过了。我们可以使用pandas DataFrame类的<code class="fe nj nk nl nm b">df.to_sql()</code>方法将数据直接加载到指定的表中:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="917a" class="mv lu iq nm b gy nr ns l nt nu"><em class="mm"># Load DataFrame into database</em></span><span id="2c3b" class="mv lu iq nm b gy nv ns l nt nu">df.to_sql(<br/>    name='table_name',<br/>    con=engine,<br/>    if_exists='append',<br/>    index=False)</span></pre><p id="3f67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们指定希望填充的表的名称，以及将我们连接到数据库的SQLAlchemy引擎。我们还可以用<code class="fe nj nk nl nm b">if_exists</code>参数来规定表已经存在的情况下的行为。在我们的例子中，由于我们的表已经建立，我们将'<em class="mm">'追加T10'我们的数据帧到表中。然而，我们也可以将该值设置为'<em class="mm"> fail </em>'，如果该表已经存在，这将在我们的代码中引发一个异常，或者设置为'<em class="mm"> replace </em>'，在这种情况下，该表将被删除并从数据中重新创建。</em></p><p id="260a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事实上，在前面的部分中，我们不需要麻烦地预先创建一个表。这是一个很有价值的演示，展示了我们如何使用SQLAlchemy运行原始SQL命令；然而，我们可以简单地运行我们的<code class="fe nj nk nl nm b">df.to_sql()</code>命令，这个表就会神奇地为我们创建。我们可以使用<code class="fe nj nk nl nm b">dtype</code>参数指定表中列的数据类型，该参数采用列名和SQL数据类型的字典，类似于我们在<code class="fe nj nk nl nm b">CREATE TABLE</code>命令中指定它们的方式。如果我们不指定这一点，pandas将从我们的数据帧中的数据推断出数据类型。</p><p id="0e39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将数据集加载到<code class="fe nj nk nl nm b">worldwide_cases</code>表中的完整脚本如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="cf9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里唯一增加的是几行代码，用于根据我们在表中选择的列标题重命名CSV数据集的列。我使用了一些SQLAlchemy技巧，很好地演示了如何用它以Pythonic方式访问数据库对象。导入元数据和表类，我们可以实例化一个表对象，反映我们的<code class="fe nj nk nl nm b">worldwide_cases</code>表；由此，我们可以访问它的<code class="fe nj nk nl nm b">columns</code>属性。这只是保存再次写出所有列名列表的快捷方式，但是我们也可以等效地通过<code class="fe nj nk nl nm b">df.columns = list_of_column_names</code>，所以如果您愿意的话，可以随意这么做。</p><h2 id="2c5c" class="mv lu iq bd lv mw mx dn lz my mz dp md lf na nb mf lj nc nd mh ln ne nf mj ng bi translated">查询数据库</h2><p id="6159" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">最后，我们可以重新创建我们在pgAdmin中演示的过程的最后一部分:查询我们的数据集。</p><p id="ca4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们有兴趣了解哪些国家目前的病例总数最高，我们可能会生成类似于下面的查询。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="8fd5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在上面看到，我们可以通过SQLAlchemy运行原始SQL命令来创建一个表。让我们用我们的<code class="fe nj nk nl nm b">SELECT</code>查询尝试一下，看看会发生什么:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="a38f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行上面的脚本来执行我们的SQL查询并存储结果(可以使用<code class="fe nj nk nl nm b">fetchall()</code>方法以列表的形式访问结果)，返回以下输出:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="82a4" class="mv lu iq nm b gy nr ns l nt nu">('United_States_of_America', 1920061, 109802)<br/>('Brazil', 645771, 35026)<br/>('Russia', 458689, 5725)<br/>('United_Kingdom', 284868, 40465)<br/>('India', 246628, 6929)<br/>         ...<br/>('Papua_New_Guinea', 8, 0)<br/>('British_Virgin_Islands', 8, 1)<br/>('Bonaire, Saint Eustatius and Saba', 7, 0)<br/>('Lesotho', 4, 0)<br/>('Anguilla', 3, 0)</span></pre><p id="98e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们的数据集中的每一行都有一个类似元组的对象，我们可以用任何我们喜欢的方式来解析和操作它，以便将这些数据合并到我们的Python脚本中。这太好了；正是我们需要的。尽管如此，如果我们能把数据直接放入熊猫的数据框架，而不需要任何事先的处理，那不是很好吗？我们很幸运。与pandas提供的将数据加载到数据库的<code class="fe nj nk nl nm b">df.to_sql()</code>方法相同，我们也可以使用它的<code class="fe nj nk nl nm b">pd.read_sql()</code>通过我们的数据库连接执行查询。</p><p id="be73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nj nk nl nm b">pd.read_sql()</code>方法实际上是两个独立方法的组合:<code class="fe nj nk nl nm b">pd.read_sql_table()</code>和<code class="fe nj nk nl nm b">pd.read_sql_query()</code>。前者将第一个参数作为我们希望读取的表的名称，后者是一个SQL查询。因此，使用<code class="fe nj nk nl nm b">pd.read_sql()</code>,我们可以提供两者之一，这取决于我们是想读取单个表还是执行查询。现在，让我们开始实践，执行上面的<code class="fe nj nk nl nm b">query.sql</code>查询:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="4be2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们的查询结果有了一个简洁的DataFrame对象，使我们可以立即访问pandas提供的用于操作数据的资源套件:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="ce96" class="mv lu iq nm b gy nr ns l nt nu">   countries_and_territories   cases  deaths<br/>0  United_States_of_America  1920061  109802<br/>1                    Brazil   645771   35026<br/>2                    Russia   458689    5725<br/>3            United_Kingdom   284868   40465<br/>4                     India   246628    6929</span></pre><h1 id="ca84" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">包扎</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/d48f0f58b405b7209533d7cdfbfb1f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zWyVSoKM2AS4tfen"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Wolfgang Hasselmann 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="21ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章的目的是演示一个简单的设置，使我们能够开始学习SQL，并给我们在自己的项目和数据探索中使用它的自由。我们现在已经在系统上安装了PostgreSQL、pgAdmin，以便通过GUI与它进行交互，我们已经看到可以使用SQLAlchemy从Python脚本中加载和查询数据。</p><p id="47b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在轮到您了:去学习更多关于SQL的知识和它的能力，询问您选择的数据集以找到见解，并将PostgreSQL融入您的Python项目的核心！</p><p id="f268" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="mm">感谢阅读！</em> </strong></p></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><p id="44d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个博客的所有源代码都可以在这里找到:</p><div class="oe of gp gr og oh"><a href="https://github.com/emilegill743/postgres-setup" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">Emile gill 743/postgres-设置</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">Python的PostgreSQL、pgAdmin和SQLAlchemy入门。-Emile gill 743/postgres-设置</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov kp oh"/></div></div></a></div><p id="8e40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢这篇文章，可以看看我的其他文章:</p><div class="oe of gp gr og oh"><a rel="noopener follow" target="_blank" href="/finding-a-grocery-delivery-slot-the-smart-way-f4f0800c4afe"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">聪明的方法是找到一个杂货递送点</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">使用Python、Heroku和Twilio从一个杂货网站的API中抓取数据，并在出现插槽时获得文本通知…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">towardsdatascience.com</p></div></div><div class="oq l"><div class="ow l os ot ou oq ov kp oh"/></div></div></a></div></div></div>    
</body>
</html>