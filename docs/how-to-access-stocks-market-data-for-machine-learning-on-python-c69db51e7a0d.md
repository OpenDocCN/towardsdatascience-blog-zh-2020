# 如何在 Python 上访问股票市场数据进行机器学习

> 原文：<https://towardsdatascience.com/how-to-access-stocks-market-data-for-machine-learning-on-python-c69db51e7a0d?source=collection_archive---------35----------------------->

## 如果你想使用机器学习来交易股票，你需要创建一个股票市场数据的数据集。了解如何使用现成的代码轻松完成这项工作。

![](img/97259d351e9426250dcb255eb4901bac.png)

在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上由 [Austin Distel](https://unsplash.com/@austindistel?utm_source=medium&utm_medium=referral) 拍摄的照片

机器学习和人工智能开发的一个常见瓶颈是获得足够大的数据集，以便你可以用它来训练你的算法。特别是，如果你正在使用深度学习，你会知道获得足够的数据来正确训练神经网络有多难。[谷歌数据集搜索](http://google dataset search)不久前出现，大大改善了这个问题，但仍然很难找到一些主题的数据，如股票交易。

我以前遇到过这个问题，所以我知道这有多难。然而，就在昨天，我发现了[这篇关于构建交易机器人](https://medium.com/swlh/build-an-ai-stock-trading-bot-for-free-4a46bec2a18)的伟大文章，它很好地指向了最近一家名为[羊驼](https://alpaca.markets)的初创公司，该公司提供了一个构建交易算法的 API。有了这个 API，我们可以免费使用他们的 Python SDK 访问股票的实时和历史数据。在本文中，我将向您展示如何实现一个函数来下载股票数据并将其存储在 Pandas Dataframe 中，以便它可以用于机器学习。

> 注意:尽管我在下面的代码中使用了这个 API，但是您可以选择您喜欢的任何其他 API，并根据需要随意修改代码。

# 安装必要的库并连接到服务器

首先:[在这里创建一个新账户](https://app.alpaca.markets/signup)。然后转到纸质账户(模拟器)，点击 API 键上的“查看”。最后，点击“生成密钥”，你将得到你的密钥 id 和你的秘密密钥。有了这些密钥，您将从 Python 连接到服务器，并能够下载我们想要的数据(您可以做更多的事情，但在本文中，我们将只下载数据)。

现在，在您的终端上执行“pip install alpaca_trade_api ”,您就可以使用以下代码连接到 api 了:

你可以在 [Github](https://github.com/alpacahq/alpaca-trade-api-python) 上看到官方文档和代码。

# 下载资产的数据

我们将用于下载资产数据的基本调用如下:

如您所见，我们使用上面实例化的管理器来调用方法 [get_barset](https://alpaca.markets/docs/api-documentation/api-v2/market-data/bars/) ，该方法返回一组条(或者您甚至可以将它们想象为烛台),并具有以下参数集:

*   Symbols:这是一个字符串列表，其中包含我们要下载数据的符号。
*   时间范围:表示数据时间性的字符串，可以是 1 分钟、5 分钟、15 分钟或 1D。
*   Limit:一个介于 1 和 1000 之间的数字，表示我们将下载的最大条数(最大值为 1000)。
*   日期(开始-结束，之后，直到):iso 格式的日期。

这样，您已经可以从股票中下载数据，但是如果您想要获得大量数据(您可能会这样做)，您将必须实现一些代码来处理分步分解时间并为每个步骤进行调用，否则，您将很快达到 1000 的限制(想象一下，如果您使用 1 分钟的临时时间，您将被限制为每次调用 1000 分钟或大约 16 个小时)。

# 长期下载数据

我自己实现了处理这个问题的代码，我把它放在这里，因为我很好:))

## 打破日期中的句点并对其进行格式化

首先，我们需要将周期分解成更小的步骤，这样我们就可以确保不会达到 API 返回的 bar 的限制。为此，我创建了 break_period_in_dates_list 方法，它采用 datetime 对象形式的 start_date 和 end_date，以及带有每步天数的 int。每个步骤的天数不能太大，这一点很重要，因为否则您将达到限制，然后您将无法获得您想要的所有数据。该方法返回一个日期元组列表，其中有开始日期和结束日期。

下一步是按照 API 期望的那样格式化日期。在 format_dates 方法中，我们正是这样做的，并以预期的格式返回列表。

## 创建数据框架

现在，一旦我们得到了条集，我们需要用它创建一个熊猫数据框架。具体来说，每个 barset 都是一个对象，其属性在这里定义为。在下面的方法中，我们转换字典列表中的条集列表，然后用它创建一个 Pandas 数据帧。

## 实际下载数据

最后，我们准备下载我们的数据。为此，我创建了 download_data 方法，该方法将 REST 管理器、我们需要的数据的符号列表、开始和结束日期以及最后将数据存储为 csv 文件的文件名作为参数。请注意，我选择将时间段分为 10 天，这对于示例中使用的 5 分钟临时时间来说很好，但是如果您更改临时时间，应该更改该参数。

# 完全码

作为总结，在这里你可以看到完整的代码:

我希望你发现这篇文章很有用，现在可以为你的机器学习项目获得所有的市场数据。感谢您的阅读！:)