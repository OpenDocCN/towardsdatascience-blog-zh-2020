# é«˜çº§ Streamlit ç¼“å­˜

> åŸæ–‡ï¼š<https://towardsdatascience.com/advanced-streamlit-caching-6f528a0f9993?source=collection_archive---------14----------------------->

![](img/bcfba3661a8ba9da732127c9d73bac10.png)

å›¾ç‰‡æ¥è‡ª [Sasin Tipchai](https://pixabay.com/users/sasint-3639875/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=1822459) æ¥è‡ª [Pixabay](https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=1822459)

## ç¼“å­˜=æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

ç°åœ¨ï¼Œå¦‚ä½•ä½¿ç”¨ Streamlit åˆ›å»º web åº”ç”¨ç¨‹åºéå¸¸ç®€å•ï¼Œä½†æ˜¯å®ƒè¿˜ä¸å…è®¸æ‚¨åšå¾ˆå¤šäº‹æƒ…ã€‚æˆ‘æœ€è¿‘é¢ä¸´çš„ä¸€ä¸ªä¸»è¦é—®é¢˜æ˜¯å…³äºç¼“å­˜çš„ï¼Œå½“æ—¶æˆ‘è¯•å›¾ä½¿ç”¨ä¸€ä¸ªæ–°é—» API åœ¨ Streamlit ä¸­åˆ›å»ºä¸€ä¸ªåˆ†ææ–°é—»ä»ªè¡¨æ¿ã€‚

é—®é¢˜æ˜¯æˆ‘ç»å¸¸ç‚¹å‡»æ–°é—» APIï¼Œå¹¶ä¸”å·²ç»è¾¾åˆ°äº†å…è´¹ API çš„æé™ã€‚æ­¤å¤–ï¼Œæ¯æ¬¡ç”¨æˆ·åˆ·æ–°åº”ç”¨ç¨‹åºæ—¶è¿è¡Œæ–°é—» API å˜å¾—ç›¸å½“æ…¢ã€‚

è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯ç¼“å­˜ API æ•°æ®ã€‚ä½†æ˜¯å½“æˆ‘ä½¿ç”¨`@st.cache` decorator æ—¶ï¼Œé¡µé¢ä¸ä¼šåˆ·æ–°ï¼Œå› ä¸º API è°ƒç”¨çš„å‚æ•°ä¿æŒä¸å˜ã€‚

è¿™ä¹Ÿæ˜¯æˆ‘å¼€å§‹ç†è§£ Streamlit åœ¨ç¼“å­˜æ–¹é¢çš„å±€é™æ€§çš„åŸå› ã€‚

å› æ­¤ï¼Œç®€è€Œè¨€ä¹‹ï¼Œæˆ‘æƒ³è¦çš„æ˜¯ä¸€ç§ä¸ä¼šåœ¨æ¯æ¬¡é¡µé¢åˆ·æ–°æ—¶éƒ½ç‚¹å‡» API çš„æ–¹æ³•ã€‚ä¸æ­¤åŒæ—¶ï¼Œç”±äºæˆ‘æ­£åœ¨è·å–æ–°é—»æ•°æ®ï¼Œæˆ‘è¿˜å¸Œæœ›æ¯éš” 5 åˆ†é’Ÿè®¿é—®ä¸€æ¬¡ APIã€‚

è¿™æ˜¯æˆ‘å®Œæˆè¿™é¡¹å·¥ä½œçš„ç®€å•æ–¹æ³•ã€‚

**æ›´æ–°:**

åœ¨æ˜¨å¤©åˆšåˆšå‡ºæ¥çš„ [0.57.0](https://discuss.streamlit.io/t/version-0-57-0/2301) æ–°å‘è¡Œè¯´æ˜ä¸­ï¼Œstreamlit å¯¹`st.cache`è¿›è¡Œäº†æ›´æ–°ã€‚è¿™ä¸ªç‰ˆæœ¬çš„ä¸€ä¸ªæ˜¾è‘—å˜åŒ–æ˜¯â€œèƒ½å¤Ÿé€šè¿‡è®¾ç½®`max_entries`å’Œ`ttl`å‚æ•°æ¥è®¾ç½®ç¼“å­˜å‡½æ•°çš„åˆ°æœŸé€‰é¡¹â€ã€‚æ¥è‡ª[æ–‡æ¡£](https://docs.streamlit.io/api.html?highlight=cache#streamlit.cache):

*   **max_entries** ( *int æˆ– None* ) â€”ä¿ç•™åœ¨**ç¼“å­˜**ä¸­çš„æœ€å¤§æ¡ç›®æ•°ï¼Œæˆ–è€…å¯¹äºæ— ç•Œç¼“å­˜ä¸º Noneã€‚(å½“ä¸€ä¸ªæ–°æ¡ç›®è¢«æ·»åŠ åˆ°æ»¡ç¼“å­˜æ—¶ï¼Œæœ€æ—§çš„ç¼“å­˜æ¡ç›®å°†è¢«åˆ é™¤ã€‚)é»˜è®¤ä¸ºæ— ã€‚
*   **TTL**(*float or None*)â€”å°†æ¡ç›®ä¿ç•™åœ¨**ç¼“å­˜**ä¸­çš„æœ€å¤§ç§’æ•°ï¼Œå¦‚æœç¼“å­˜æ¡ç›®ä¸åº”è¿‡æœŸï¼Œåˆ™ä¸º Noneã€‚é»˜è®¤å€¼ä¸ºæ— ã€‚

è¿™å¯èƒ½æœ‰æ‰€å¸®åŠ©çš„ä¸¤ä¸ªç”¨ä¾‹æ˜¯:

*   å¦‚æœæ‚¨æ­£åœ¨ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›æœåŠ¡ï¼Œå¹¶ä¸”ä¸å¸Œæœ›ç¼“å­˜æ°¸è¿œå¢é•¿ã€‚
*   å¦‚æœæ‚¨æœ‰ä¸€ä¸ªä» URL è¯»å–å®æ—¶æ•°æ®çš„ç¼“å­˜å‡½æ•°ï¼Œå¹¶ä¸”åº”è¯¥æ¯éš”å‡ ä¸ªå°æ—¶æ¸…é™¤ä¸€æ¬¡ä»¥è·å–æœ€æ–°æ•°æ®

æ‰€ä»¥ç°åœ¨ä½ éœ€è¦åšçš„å°±æ˜¯:

```
[@st](http://twitter.com/st).cache(ttl=60*5,max_entries=20)
def hit_news_api(country, n):
    # hit_api
```

äº‹æƒ…å˜åŒ–ä¹‹å¿«çœŸæ˜¯ä»¤äººéš¾ä»¥ç½®ä¿¡ã€‚

åœ¨æˆ‘å¼€å§‹ä¹‹å‰ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå…³äº streamlit çš„æ•™ç¨‹ï¼Œå¦‚æœä½ ä¸ç†è§£è¿™ç¯‡æ–‡ç« çš„è¯ã€‚

[](/how-to-write-web-apps-using-simple-python-for-data-scientists-a227a1a01582) [## å¦‚ä½•ä¸ºæ•°æ®ç§‘å­¦å®¶ä½¿ç”¨ç®€å•çš„ Python ç¼–å†™ Web åº”ç”¨ï¼Ÿ

### æ— éœ€äº†è§£ä»»ä½• web æ¡†æ¶ï¼Œå³å¯è½»æ¾å°†æ‚¨çš„æ•°æ®ç§‘å­¦é¡¹ç›®è½¬æ¢ä¸ºé…·ç‚«çš„åº”ç”¨ç¨‹åº

towardsdatascience.com](/how-to-write-web-apps-using-simple-python-for-data-scientists-a227a1a01582) 

# ç®€åŒ–ç¼“å­˜åŸºç¡€çŸ¥è¯†:

å½“æˆ‘ä»¬ç”¨ streamlit çš„ç¼“å­˜è£…é¥°å™¨`@st.cache`æ ‡è®°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæ— è®ºä½•æ—¶è°ƒç”¨è¯¥å‡½æ•°ï¼ŒStreamlit éƒ½ä¼šæ£€æŸ¥è°ƒç”¨è¯¥å‡½æ•°æ—¶ä½¿ç”¨çš„è¾“å…¥å‚æ•°ã€‚åç«¯å‘ç”Ÿçš„äº‹æƒ…æ˜¯ï¼Œå½“ä¸€ä¸ªå‡½æ•°ç”¨`@st.cache` streamlit ä¿®é¥°æ—¶ï¼Œå®ƒå°†å‡½æ•°çš„æ‰€æœ‰çŠ¶æ€ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ streamlit åº”ç”¨ç¨‹åºï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
**import** **streamlit** **as** **st**
**import** **time****def** expensive_computation(a, b):
    time.sleep(2)  *# ğŸ‘ˆ This makes the function take 2s to run*
    **return** a * ba = 2
b = 21
res = expensive_computation(a, b)
st.write("Result:", res)
```

å½“æˆ‘ä»¬åˆ·æ–°åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ°`expensive_computation(a, b)`åœ¨æ¯æ¬¡åº”ç”¨ç¨‹åºè¿è¡Œæ—¶éƒ½ä¼šè¢«é‡æ–°æ‰§è¡Œã€‚è¿™å¯¹ç”¨æˆ·æ¥è¯´ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä½“éªŒã€‚

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æ·»åŠ `[@st.cache](https://docs.streamlit.io/api.html#streamlit.cache)`è£…é¥°å™¨:

```
**import** **streamlit** **as** **st**
**import** **time**@st.cache  *# ğŸ‘ˆ Added this*
**def** expensive_computation(a, b):
    time.sleep(2)  *# This makes the function take 2s to run*
    **return** a * ba = 2
b = 21
res = expensive_computation(a, b)
st.write("Result:", res)
```

å› ä¸ºå‚æ•°`a`å’Œ`b`çš„ç»“æœå·²ç»è¢«ç¼“å­˜ï¼Œæ‰€ä»¥`expensive_computation`ä¸ä¼šåœ¨æ¯æ¬¡ç”¨æˆ·åˆ·æ–°é¡µé¢æ—¶å†æ¬¡è¿è¡Œã€‚è¿™å°†å¸¦æ¥æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

# æœ€å°ç¤ºä¾‹

![](img/c5ee0633ec110e6b6dfef0a77fa767a7.png)

ç½—é©¬å¡å¤«åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

***é‚£ä¹ˆå¦‚æœæˆ‘æƒ³æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœé¡µé¢åœ¨è®¾å®šçš„æ—¶é—´æ®µååˆ·æ–°äº†å‘¢ï¼Ÿ*** ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼“å­˜çš„å‡½æ•°å·²ç»æœ‰ä¸€æ®µæ—¶é—´æ²¡æœ‰è¿è¡Œäº†ï¼Œç»“æœéœ€è¦æ›´æ–°ã€‚

ä¸ºäº†ç†è§£è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„å‡½æ•°é‡‡ç”¨ä¸€ä¸ªå‚æ•°`n`å’Œä¸€ä¸ªå‚æ•° countryï¼Œå¹¶è¿”å›è¯¥å›½å®¶çš„å‰ n æ¡æ–°é—»ã€‚

åœ¨è¿™ä¸ªæœ€å°çš„ä¾‹å­ä¸­ï¼Œå®ƒç±»ä¼¼äºè¿”å›ä¸€ä¸ªéšæœºæ•°åˆ—è¡¨ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨æ¥ä¸‹æ¥çš„ 5 åˆ†é’Ÿå†…ç»§ç»­å‘æˆ‘ä»¬çš„ç”¨æˆ·æ˜¾ç¤ºè¿™ä¸ªåˆ—è¡¨ã€‚å¦‚æœç”¨æˆ·åœ¨ 5 åˆ†é’Ÿååˆ·æ–°é¡µé¢ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ—è¡¨è¢«åˆ·æ–°ã€‚è¿™éå¸¸ç±»ä¼¼äºç‚¹å‡»æ–°é—» APIã€‚

æ‰€ä»¥æˆ‘ä»¬çš„åŸºæœ¬åº”ç”¨ç¨‹åºä»£ç çœ‹èµ·æ¥åƒè¿™æ ·:

```
import streamlit as st
import randomdef hit_news_api(country, n):
 st.write("Cache Miss for n:",n)
 return [random.randint(0,1000) for i in range(n)]results = hit_news_api("USA", 5)
st.write(results)
```

è¿™ä¸ªåº”ç”¨ç¨‹åºçœ‹èµ·æ¥åƒ:

![](img/d475e21b657095457e265f75e6a94fef.png)

ç°åœ¨ï¼Œæ¯æ¬¡æˆ‘åˆ·æ–°é¡µé¢ï¼Œå‡½æ•°`hit_news_api`éƒ½ä¼šè¢«å†æ¬¡è°ƒç”¨ï¼Œè¿™æ„å‘³ç€éšç€ç”¨æˆ·æ•°é‡çš„å¢åŠ ï¼Œæˆ‘ä»¬å°†è¾¾åˆ° API çš„æé™ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¼“å­˜ã€‚æ²¡é”™ã€‚æ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœæˆ‘ä»¬ç¼“å­˜`hit_news_api`å‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

```
import streamlit as st
import random[@st](http://twitter.com/st).cache
def hit_news_api(country, n):
 st.write("Cache Miss for n:",n)
 return [random.randint(0,1000) for i in range(n)]results = hit_news_api("USA", 5)
st.write(results)
```

ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœ API å‚æ•°ä¿æŒä¸å˜ï¼Œæˆ‘ä»¬çš„ä»ªè¡¨æ¿åœ¨ç‚¹å‡»ä¸€æ¬¡æ–°é—» API åå°±å†ä¹Ÿä¸ä¼šè°ƒç”¨å®ƒäº†ã€‚æˆ‘ä»¬çœ‹åˆ°åŒä¸€ç»„å‚æ•°çš„é™æ€ç»“æœæ˜¯æ°¸æ’çš„ã€‚æˆ‘ä»¬åšä»€ä¹ˆå‘¢

# æƒ³æ³• 1 â€”è™šæ‹Ÿæ—¶é—´å˜é‡

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•â€”â€”å‘æ¯äº”åˆ†é’Ÿ/ååˆ†é’Ÿæ”¹å˜ä¸€æ¬¡å€¼çš„`hit_news_api`å‡½æ•°è°ƒç”¨ä¼ é€’ä¸€ä¸ªä¾èµ–äºæ—¶é—´çš„ä¼ªå‚æ•°ã€‚å®ç°è¿™ä¸€ç‚¹çš„ä»£ç æ˜¯:

åœ¨è¿™é‡Œï¼Œ`truncate_time`å‡½æ•°å¸®åŠ©æˆ‘ä»¬å°†å½“å‰æ—¥æœŸæ—¶é—´æˆªæ–­ä¸ºè¯¥åˆ†é’Ÿæœ€æ¥è¿‘çš„æœ€å°é™¤æ•°ã€‚ä¾‹å¦‚ï¼Œç»™å®š`dt_time=â€™2020â€“03â€“27 02:32:19.684443'`å’Œ`period = 5`ï¼Œå‡½æ•°è¿”å›`â€˜2020â€“03â€“27 02:30:00.0â€™.`

çœ‹çœ‹æˆ‘ä»¬ç°åœ¨å¦‚ä½•ç”¨æˆªæ–­çš„æ—¶é—´è°ƒç”¨`hit_news_api`å‡½æ•°ã€‚ç°åœ¨ï¼Œæ— è®ºä½•æ—¶ä»`dt_time=â€™2020â€“03â€“27 02:30:00.0' and dt_time=â€™2020â€“03â€“27 02:34:59.99999'`å¼€å§‹è°ƒç”¨`hit_news_api`å‡½æ•°ï¼Œå‡½æ•°è°ƒç”¨çš„å‚æ•°éƒ½ä¿æŒä¸å˜ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šä¸€æ¬¡åˆä¸€æ¬¡åœ°è°ƒç”¨ APIã€‚æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼

# æƒ³æ³• 2-åˆ·æ–°/æ¸…é™¤ç¼“å­˜

![](img/454d40015876a012d7dc30dac2a6cb79.png)

æ¸…ç†ç¼“å­˜ã€‚[å»é£æº…](https://unsplash.com?utm_source=medium&utm_medium=referral)

è¿™ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯æ‚¨èƒ½å‘ç°è¿™ç§æ–¹æ³•çš„é—®é¢˜å—ï¼Ÿç¼“å­˜å¤§å°å°†éšç€æ—¶é—´çš„æ¨ç§»è€Œå¢é•¿ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å®šæœŸæ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ã€‚æˆ‘ä»¬å¦‚ä½•è‡ªåŠ¨åŒ–ç¼“å­˜æ¸…é™¤è¿‡ç¨‹ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç é¡¶éƒ¨ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼Œåœ¨ä¸€å¤©çš„æ—¶é—´å†…æ¸…é™¤æ•´ä¸ªç¼“å­˜ã€‚

```
from streamlit import caching
from datetime import datedef cache_clear_dt(dummy):
   clear_dt = date.today()
   return clear_dtif cache_clear_dt("dummy")<date.today():
   caching.clear_cache()
```

# æœ€ç»ˆåº”ç”¨ä»£ç 

è¿™æ˜¯ä¸Šé¢æ‰€æœ‰åŠŸèƒ½çš„æ•´ä¸ªåº”ç”¨ç¨‹åºçš„å¤–è§‚ã€‚

# ç»“è®º

Streamlit ä½¿åˆ›å»ºåº”ç”¨ç¨‹åºçš„æ•´ä¸ªè¿‡ç¨‹æ°‘ä¸»åŒ–äº†ï¼Œæˆ‘ä¸èƒ½å†æ¨èå®ƒäº†ã€‚

ç„¶è€Œï¼Œæœ‰äº›äº‹æƒ…æˆ‘ä»¬éœ€è¦ç»•é“è€Œè¡Œã€‚åœ¨è¿™ä¸ªä»¤äººæ•¬ç•çš„å¹³å°ä¸Šï¼Œæˆ‘ä»ç„¶å–œæ¬¢æ‹¥æœ‰å¾ˆå¤šä¸œè¥¿ã€‚æˆ‘å·²ç»ä¸ Streamlit å›¢é˜Ÿå°±ä»–ä»¬å°†è¦å¼•å…¥çš„æ–°åŠŸèƒ½è¿›è¡Œäº†è®¨è®ºï¼Œæˆ‘å°†å°½åŠ›è®©æ‚¨äº†è§£æœ€æ–°æƒ…å†µã€‚

ä½ å¯ä»¥åœ¨æˆ‘çš„ Github repo ä¸Šæ‰¾åˆ°æœ€ç»ˆåº”ç”¨çš„å®Œæ•´ä»£ç ã€‚

å¦‚æœä½ æƒ³äº†è§£åˆ›å»ºå¯è§†åŒ–çš„æœ€ä½³ç­–ç•¥ï¼Œæˆ‘æƒ³ä»å¯†æ­‡æ ¹å¤§å­¦è°ƒç”¨ä¸€é—¨å…³äº [**æ•°æ®å¯è§†åŒ–å’Œåº”ç”¨ç»˜å›¾**](https://www.coursera.org/specializations/data-science-python?ranMID=40328&ranEAID=lVarvwc5BD0&ranSiteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&siteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&utm_content=3&utm_medium=partners&utm_source=linkshare&utm_campaign=lVarvwc5BD0) çš„ä¼˜ç§€è¯¾ç¨‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ [**æ•°æ®ç§‘å­¦ä¸“ä¸šçš„ä¸€éƒ¨åˆ†ï¼Œæœ¬èº«å¸¦æœ‰ Python**](https://www.coursera.org/specializations/data-science-python?ranMID=40328&ranEAID=lVarvwc5BD0&ranSiteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&siteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&utm_content=3&utm_medium=partners&utm_source=linkshare&utm_campaign=lVarvwc5BD0) ã€‚ä¸€å®šè¦å»çœ‹çœ‹ã€‚

è°¢è°¢ä½ çš„é˜…è¯»ã€‚å°†æ¥æˆ‘ä¹Ÿä¼šå†™æ›´å¤šåˆå­¦è€…å‹å¥½çš„å¸–å­ã€‚åœ¨ [**åª’ä½“**](https://medium.com/@rahul_agarwal) å…³æ³¨æˆ‘ï¼Œæˆ–è€…è®¢é˜…æˆ‘çš„ [**åšå®¢**](http://eepurl.com/dbQnuX) äº†è§£ä»–ä»¬ã€‚ä¸€å¦‚æ—¢å¾€ï¼Œæˆ‘æ¬¢è¿åé¦ˆå’Œå»ºè®¾æ€§çš„æ‰¹è¯„ï¼Œå¯ä»¥é€šè¿‡ Twitter [@mlwhiz](https://twitter.com/MLWhiz) è”ç³»ã€‚

æ­¤å¤–ï¼Œä¸€ä¸ªå°å°çš„å…è´£å£°æ˜â€”â€”è¿™ç¯‡æ–‡ç« ä¸­å¯èƒ½ä¼šæœ‰ä¸€äº›ç›¸å…³èµ„æºçš„é™„å±é“¾æ¥ï¼Œå› ä¸ºåˆ†äº«çŸ¥è¯†ä»æ¥éƒ½ä¸æ˜¯ä¸€ä¸ªåä¸»æ„ã€‚