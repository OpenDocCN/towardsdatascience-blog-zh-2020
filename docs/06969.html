<html>
<head>
<title>Using face-api.js to build an app that overlays a mask on face images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 face-api.js 构建一个在人脸图像上叠加一个遮罩的应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-face-api-js-to-build-an-app-that-overlays-a-mask-on-face-images-9de9b4848c09?source=collection_archive---------31-----------------------#2020-05-29">https://towardsdatascience.com/using-face-api-js-to-build-an-app-that-overlays-a-mask-on-face-images-9de9b4848c09?source=collection_archive---------31-----------------------#2020-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="95d6" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">构建应用程序教程</h2><div class=""/><div class=""><h2 id="8c39" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">下面是我如何制作一个应用程序，自动为你的个人资料照片添加遮罩。#马斯肯</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi kr"><img src="../Images/9e6307638ea7fcab2b0334b957bc2998.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*zgiKWJJLo26gyG1GQPUZ-g.jpeg"/></div><p class="kz la gj gh gi lb lc bd b be z dk translated">来自 Pexels 的蒂姆·莫斯霍尔德的照片</p></figure><p id="e9f2" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">你听说了吗？<a class="ae ld" href="https://www.cdc.gov/coronavirus/2019-ncov/prevent-getting-sick/cloth-face-cover.html" rel="noopener ugc nofollow" target="_blank"> CDC </a>和<a class="ae ld" href="https://twitter.com/Surgeon_General/status/1264166726230573057?s=20" rel="noopener ugc nofollow" target="_blank">医务总监</a>现在建议并鼓励每个人在公共场合外出时戴口罩。不幸的是，戴口罩仍然会带来很多耻辱。“如果人们认为我生病了怎么办？”“如果他们冲我大喊大叫让我呆在家里怎么办？”这些想法会阻止一个人戴上面具，即使这有助于保护自己和他人。为了帮助宣传戴面具是明智和正确的事情，并让它变得足够普遍，从而成为一种新的社会规范，我决定制作一个应用程序，自动为你的个人资料照片添加面具。我是这样做的。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/dca00653316f08d04dde7e81706ab54b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*MUkKMk6AWgYYlY-NJfnI5Q.gif"/></div><p class="kz la gj gh gi lb lc bd b be z dk translated">https://maskonme.herokuapp.com/<a class="ae ld" href="https://maskonme.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">待建 app 截图</a></p></figure><h1 id="f010" class="mj mk it bd ml mm mn mo mp mq mr ms mt ki mu kj mv kl mw km mx ko my kp mz na bi translated">首先，计划</h1><p id="284c" class="pw-post-body-paragraph le lf it lg b lh nb kd lj lk nc kg lm ln nd lp lq lr ne lt lu lv nf lx ly lz im bi translated">我首先想到了应用程序的核心功能。这包括:</p><ol class=""><li id="fd98" class="ng nh it lg b lh li lk ll ln ni lr nj lv nk lz nl nm nn no bi translated">用户上传自己的照片或粘贴照片链接</li><li id="86d8" class="ng nh it lg b lh np lk nq ln nr lr ns lv nt lz nl nm nn no bi translated">网站检测照片中的人脸及其地标</li><li id="05e6" class="ng nh it lg b lh np lk nq ln nr lr ns lv nt lz nl nm nn no bi translated">网站在鼻子、嘴和下巴区域覆盖了一个面具</li><li id="8388" class="ng nh it lg b lh np lk nq ln nr lr ns lv nt lz nl nm nn no bi translated">用户下载最终图像。</li></ol><p id="0508" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">在谷歌了一番之后，我有了两个选择:1)使用 Flask &amp; OpenCV 用 Python 开发一个应用，或者 2)使用<a class="ae ld" href="https://github.com/justadudewhohacks/face-api.js/" rel="noopener ugc nofollow" target="_blank"> face-api.js </a>用 JavaScript 开发一个独立的应用。尽管我更喜欢 Python，但我还是决定使用 face-api.js &amp; JavaScript，因为它可以在现代浏览器上运行，不需要后端服务器来承担繁重的工作。另外，<a class="ae ld" href="https://itnext.io/@muehler.v" rel="noopener ugc nofollow" target="_blank"> Vincent Mühler </a>已经有了一个很棒的<a class="ae ld" href="https://justadudewhohacks.github.io/face-api.js/face_and_landmark_detection/" rel="noopener ugc nofollow" target="_blank">人脸和地标检测的例子</a>，可以轻松覆盖步骤 1 和 2。</p><div class="ks kt ku kv gt ab cb"><figure class="nu kw nv nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><img src="../Images/a5ad928036594f14dde8bd8c87a2ff0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*fVjR4fbpaeEnv4nOHjjAaw.png"/></div></figure><figure class="nu kw oe nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><img src="../Images/79875760e593b45a39dbc46eb7cbedd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*5WNrlA289LdkkbZOrF_TyQ.png"/></div><p class="kz la gj gh gi lb lc bd b be z dk of di og oh translated">左)face-api.js 的人脸&amp;地标检测 app 右)幽灵面具</p></figure></div><p id="de2d" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">接下来，我做了一个快速搜索，看看是否有任何在脸上覆盖面具的例子，并找到了使用 face-api.js 的<a class="ae ld" href="https://spooky-masks.netlify.app" rel="noopener ugc nofollow" target="_blank">https://ghost-masks . netlify . app</a>，我认为只需要一些调整就可以完成第 3 步。</p><h1 id="c751" class="mj mk it bd ml mm mn mo mp mq mr ms mt ki mu kj mv kl mw km mx ko my kp mz na bi translated">把所有的放在一起</h1><p id="dc1b" class="pw-post-body-paragraph le lf it lg b lh nb kd lj lk nc kg lm ln nd lp lq lr ne lt lu lv nf lx ly lz im bi translated">在<a class="ae ld" href="https://github.com/justadudewhohacks/face-api.js/blob/master/examples/examples-browser/views/faceLandmarkDetection.html" rel="noopener ugc nofollow" target="_blank"> faceLandmarkDetection 演示</a>中，我花了一些时间来理解 face-api.js 是如何工作的。一些基础工作包括用<code class="fe oi oj ok ol b">&lt;script src=”face-api.js”&gt;&lt;/script&gt;</code>在 head 部分加载 face-api.js，并找到加载输入图像和绘图覆盖的部分。</p><pre class="ks kt ku kv gt om ol on oo aw op bi"><span id="96e2" class="oq mk it ol b gy or os l ot ou">&lt;div style="position: relative" class="margin"&gt;      <br/>    &lt;img id="inputImg" src="" style="max-width: 800px;" /&gt;      <br/>    &lt;canvas id="overlay" /&gt;    <br/>&lt;/div&gt;</span></pre><p id="bdc6" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">此外，这里是调用<code class="fe oi oj ok ol b">faceapi</code>来检测输入图像<code class="fe oi oj ok ol b">inputImgEl</code>中的人脸并保存结果的部分。</p><pre class="ks kt ku kv gt om ol on oo aw op bi"><span id="8a7f" class="oq mk it ol b gy or os l ot ou">async function <strong class="ol jd">updateResults()</strong> {<br/>...<br/>const results = await <strong class="ol jd">faceapi.detectAllFaces</strong>(inputImgEl, options).withFaceLandmarks()<br/>...<br/>}</span></pre><p id="d52d" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">我还在《幽灵面具》教程的<a class="ae ld" href="https://github.com/jlengstorf/spooky-masks-facial-recognition/blob/master/src/util/maskify.js" rel="noopener ugc nofollow" target="_blank"> maskify.js </a>中指出了面具是如何被操纵和调整以放置在人脸之上的。它使用 face-api.js 中的方法来获取地标的坐标。例如，要得到鼻子，你可以运行<code class="fe oi oj ok ol b">const nose = landmarks.getNose();</code>或者使用<code class="fe oi oj ok ol b">const jawline = landmarks.getJawOutline();.</code> <a class="ae ld" href="https://github.com/jlengstorf/spooky-masks-facial-recognition/blob/master/src/util/maskify.js" rel="noopener ugc nofollow" target="_blank">得到下颌线，见这里的原始代码。利用这个，我能够快速制作出一个原型，它将检测人脸，并用一个面具覆盖它。点击这里查看完整代码！</a></p><div class="ov ow gp gr ox oy"><a href="https://github.com/jcheong0428/maskon" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd jd gy z fp pd fr fs pe fu fw jc bi translated">jcheong0428/maskon</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">这个应用程序把一个面具放在你的脸上。申请可从 https://maskonme.herokuapp.com face-API . js 获得…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">github.com</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm kx oy"/></div></div></a></div></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><p id="3404" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">不幸的是，我很快意识到这个自动覆盖的面具不会是完美的。面部轻微的旋转和歪斜会导致稍微不准确的下颌线，这会使面具向某个方向倾斜太多。因此，我决定添加一些控件来移动遮罩。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pn"><img src="../Images/66934f8b6a56bbbe2e4b55c6bbb98f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4rPxrXkddyZABgBTQFW9uA.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">还不错，但肯定可以使用一点手动调整。下颌线的估计并不是 100%准确。</p></figure><p id="db59" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">事实证明，手动调整无论如何都是必要的，因为地标可能不会总是检测到下巴的整个轮廓。</p><p id="85cb" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">因此，我决定添加按钮，这将改变小增量的面具的位置。</p><p id="d5cd" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">例如，我添加了一个向右移动蒙版的按钮</p><pre class="ks kt ku kv gt om ol on oo aw op bi"><span id="b9f1" class="oq mk it ol b gy or os l ot ou">&lt;button class=”waves-effect waves-light btn” onclick=”moveright_mask();”&gt;Zoom In&lt;/button&gt;</span></pre><p id="c930" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">由函数定义</p><pre class="ks kt ku kv gt om ol on oo aw op bi"><span id="4da3" class="oq mk it ol b gy or os l ot ou">function moveright_mask() {<br/>    const myNode = document.getElementById("maskdiv").children;<br/>    for (var i = 0; i &lt; myNode.length; i++) {<br/>      var tableChild = myNode[i];<br/>      // Do stuff<br/>      var left = parseFloat(tableChild.style.left)+2;<br/>      tableChild.style.left = `${left}px`;<br/>    };<br/>  }</span></pre><p id="7ea3" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">这将更新<code class="fe oi oj ok ol b">maskdiv.</code>中的掩码</p><p id="1644" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated"><a class="ae ld" href="https://maskonme.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">亲自尝试一下</a>或观看视频:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="po pp l"/></div></figure></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="63a8" class="mj mk it bd ml mm pq mo mp mq pr ms mt ki ps kj mv kl pt km mx ko pu kp mz na bi translated">后续步骤</h1><p id="3328" class="pw-post-body-paragraph le lf it lg b lh nb kd lj lk nc kg lm ln nd lp lq lr ne lt lu lv nf lx ly lz im bi translated">这是一个非常有趣的项目，可以在疫情开始的时候分散我的注意力。当我建造这个的时候，我最终也找到了 https://socialdistancing.works/的<a class="ae ld" href="https://socialdistancing.works/" rel="noopener ugc nofollow" target="_blank">号</a>，它实际上做了同样的事情，除了它纯粹是手动调整。<a class="ae ld" href="http://maskonme.herokuapp.com" rel="noopener ugc nofollow" target="_blank"> MaskOnMe </a>的另一个很好的功能是它还可以同时检测多张脸，这样你就可以发布和每个戴面具的人的合影了！</p><div class="ks kt ku kv gt ab cb"><figure class="nu kw pv nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><img src="../Images/55b613aec4079de1a5ad7e021a7a5843.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*Ylb_pFPQPhCLEDEpapSkvA.jpeg"/></div></figure><figure class="nu kw pw nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><img src="../Images/c9f3a3995e503149603406bfd2b25228.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*zgiKWJJLo26gyG1GQPUZ-g.jpeg"/></div></figure></div><p id="d48d" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">当我有时间的时候，我的下一步是在一个 AR 版本上工作，其中一个将覆盖一个来自网络摄像头的面具！感谢您的阅读，如果您想了解更多关于人脸图像处理的内容，请随时查看我的其他帖子。</p><div class="ov ow gp gr ox oy"><a rel="noopener follow" target="_blank" href="/how-to-extract-facial-expressions-head-pose-and-gaze-from-any-youtube-video-2aa6590c2bb6"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd jd gy z fp pd fr fs pe fu fw jc bi translated">如何从任何 Youtube 视频中提取面部表情、头部姿势和凝视</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">使用 Google Colab &amp; OpenFace 从 Youtube 视频中提取面部特征的教程，无需安装一个…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">towardsdatascience.com</p></div></div><div class="ph l"><div class="px l pj pk pl ph pm kx oy"/></div></div></a></div><div class="ov ow gp gr ox oy"><a rel="noopener follow" target="_blank" href="/four-ways-to-quantify-synchrony-between-time-series-data-b99136c4a9c9"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd jd gy z fp pd fr fs pe fu fw jc bi translated">量化时间序列数据之间同步性的四种方法</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">用于计算同步指标的样本代码和数据，包括皮尔逊相关、时滞交叉相关…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">towardsdatascience.com</p></div></div><div class="ph l"><div class="py l pj pk pl ph pm kx oy"/></div></div></a></div><div class="ov ow gp gr ox oy"><a href="https://jinhyuncheong.medium.com/membership" rel="noopener follow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd jd gy z fp pd fr fs pe fu fw jc bi translated">通过我的推荐链接加入 Medium 金贤昌博士</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">jinhyuncheong.medium.com</p></div></div><div class="ph l"><div class="pz l pj pk pl ph pm kx oy"/></div></div></a></div></div></div>    
</body>
</html>