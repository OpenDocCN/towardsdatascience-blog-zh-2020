<html>
<head>
<title>Recreate Publication-Quality, Interactive Tables in R using reactable</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 reactable 在 R 中重新创建出版物质量的交互式表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/recreate-publication-quality-interactive-tables-in-r-using-reactable-187407bc9702?source=collection_archive---------35-----------------------#2020-06-15">https://towardsdatascience.com/recreate-publication-quality-interactive-tables-in-r-using-reactable-187407bc9702?source=collection_archive---------35-----------------------#2020-06-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9009" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">复制《经济学人》的表格，只在 R</h2></div><p id="d7ff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">《经济学人》</em>最近发布了一系列关于“超额死亡率”的国家级<a class="ae lf" href="https://twitter.com/J_CD_T/status/1261625814854045696" rel="noopener ugc nofollow" target="_blank">数据集</a>，超额死亡率一词用于<a class="ae lf" href="https://www.economist.com/graphic-detail/2020/04/16/tracking-covid-19-excess-deaths-across-countries" rel="noopener ugc nofollow" target="_blank">描述</a>“死于任何原因的总人数与同一地点同一时间的历史平均值之间的差距。”更简单地说，这种方法捕捉到了发生了多少<em class="le">不该发生的</em>死亡事件。</p><p id="fc57" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(免费中！)的文章，我偶然发现了下表:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/f5c3b5fc2579e4aa3c9233bd8cf31d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hnw0H2goMmsbCqEP.png"/></div></div></figure><p id="0e9a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我以为桌子是干净的，发出了明确的信息。内联条形图的添加不会造成干扰，但仍有助于读者了解数据。这是一张相当漂亮的桌子。最近<a class="ae lf" href="https://twitter.com/dataandme/status/1196552930167599106" rel="noopener ugc nofollow" target="_blank">偶然看到</a> Greg Lin 的包<code class="fe ls lt lu lv b"><a class="ae lf" href="https://glin.github.io/reactable/index.html" rel="noopener ugc nofollow" target="_blank">reactable</a></code>，我想这可能是一个很好的机会来尝试重新创作上述作品。</p><p id="310c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(巧合的是，当我在做这个项目的时候，Malcolm Barrett 发布了一个类似的<a class="ae lf" href="https://malco.io/2020/05/16/replicating-an-nyt-table-of-swedish-covid-deaths-with-gt/" rel="noopener ugc nofollow" target="_blank">博客帖子</a>，记录了他使用<code class="fe ls lt lu lv b">gt</code>重新制作 NYT 桌子的过程。看看吧！)</p><h1 id="f3ed" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">装载包</h1><p id="4a61" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">我们的过程使用标准的包:<code class="fe ls lt lu lv b">reactable</code>(显然)，<code class="fe ls lt lu lv b">htmltools</code>作为它的伙伴，<code class="fe ls lt lu lv b">lubridate</code>用于日期和时间，<code class="fe ls lt lu lv b">hrbrthemes</code>用于经济学家的字体，<code class="fe ls lt lu lv b">tidyverse</code>用于通用数据争论。</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="d93c" class="mx lx it lv b gy my mz l na nb">library(reactable)<br/>library(htmltools)<br/>library(lubridate)<br/>library(hrbrthemes)<br/>library(tidyverse)</span></pre><h1 id="9b39" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">收集数据</h1><p id="cba2" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">如果您对数据收集和清理过程不感兴趣，您肯定可以跳过这一步。</p><p id="6175" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不幸的是，这个项目中最耗时的步骤之一是获取与《经济学家》杂志文章中使用的格式相同的数据。他们发布的数据以一系列国家级 CSV 的形式出现。虽然这有助于国家级别的分析，但这意味着我们必须将数据修改为连接格式才能创建一个表。</p><p id="cdc1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们从创建一个函数开始，该函数读入<strong class="kk iu">每个单独的 CSV </strong>，选择相关的列，并将特定的数据帧存储在全局环境中。</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="dcb9" class="mx lx it lv b gy my mz l na nb">create_dataframe &lt;- function(country) {<br/>  ## for URL (below)<br/>  country &lt;- str_replace(country, " ", "_")<br/>  <br/>  ## read in CSV, given country parameter<br/>  data &lt;-<br/>    readr::read_csv(<br/>      paste0(<br/>        '<a class="ae lf" href="https://raw.githubusercontent.com/TheEconomist/covid-19-excess-deaths-tracker/master/output-data/excess-deaths/'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/TheEconomist/covid-19-excess-deaths-tracker/master/output-data/excess-deaths/'</a>, country, '_excess_deaths.csv'<br/>      )<br/>    )<br/>  <br/>  ## select relevant columns<br/>  data &lt;- data %&gt;%<br/>    select(<br/>      country,<br/>      region,<br/>      start_date,<br/>      end_date,<br/>      population,<br/>      total_deaths,<br/>      covid_deaths,<br/>      expected_deaths,<br/>      excess_deaths,<br/>      non_covid_deaths<br/>    )<br/>  <br/>  assign(country, rbind(data), envir = .GlobalEnv)<br/>}</span></pre><p id="0e34" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建了这个函数后，我们想对经济学人包含的每个国家<em class="le">进行循环。</em></p><p id="7b08" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我们从 GitHub 获取他们的来源列表，并将每个国家/地区纳入一个列表:</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="0bd7" class="mx lx it lv b gy my mz l na nb">country_names &lt;-<br/>  readr::read_csv(<br/>    '<a class="ae lf" href="https://raw.githubusercontent.com/TheEconomist/covid-19-excess-deaths-tracker/master/source-data/list_of_sources.csv'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/TheEconomist/covid-19-excess-deaths-tracker/master/source-data/list_of_sources.csv'</a><br/>  ) %&gt;%<br/>  select(country) %&gt;%<br/>  distinct() %&gt;%<br/>  mutate(country = stringr::str_to_lower(country)) %&gt;%<br/>  filter(country != 'all') %&gt;%<br/>  pull()</span></pre><p id="fbe3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们循环！</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="533b" class="mx lx it lv b gy my mz l na nb">for (country in country_names) {<br/>  create_dataframe(country)<br/>}</span></pre><p id="e77e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们有一个数据框架列表，每个框架包含一个国家的超额死亡率数据。</p><p id="6091" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们将这些新数据帧合并成一个主数据集。这里，我们在<code class="fe ls lt lu lv b">dfs</code>中定义了一个全局环境中属于结构化数据框的所有对象的列表。然后，我们一起<code class="fe ls lt lu lv b">rbind</code>他们！</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="db4d" class="mx lx it lv b gy my mz l na nb">dfs = sapply(.GlobalEnv, is.data.frame)</span><span id="c331" class="mx lx it lv b gy nc mz l na nb">data &lt;- do.call(rbind, mget(names(dfs)[dfs]))</span></pre><p id="26bf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但不幸的是，这还不是全部。我们需要过滤我们的数据，只包括在经济学家的表中的地方。更困难的是，该表的标识行被命名为“地区/国家”,并包括来自 CSV 中两个<em class="le">单独的</em>行的数据。</p><p id="4842" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们首先根据经济学家所包含的<em class="le">国家和地区进行手动定义和过滤。(这个选择似乎没有一个顺序；因此，它必须是手动的)。</em></p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="cd09" class="mx lx it lv b gy my mz l na nb">good_countries &lt;-<br/>  c("Britain",<br/>    "Spain",<br/>    "Italy",<br/>    "France",<br/>    "Netherlands",<br/>    "Belgium",<br/>    "Sweden",<br/>    "Austria")</span><span id="5980" class="mx lx it lv b gy nc mz l na nb">good_regions &lt;- c("New York City", "Istanbul", "Jakarta")</span><span id="0fa6" class="mx lx it lv b gy nc mz l na nb">data_filtered_countries &lt;- data %&gt;%<br/>  filter(country %in% good_countries) %&gt;%<br/>  filter(country == region)</span></pre><p id="9d11" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为表格中只有一行国家/地区，并相应地对它们进行分组，所以我们可以将<code class="fe ls lt lu lv b">data_filtered_regions</code>数据框中的<code class="fe ls lt lu lv b">country</code>变量替换为<code class="fe ls lt lu lv b">region</code>。</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="d071" class="mx lx it lv b gy my mz l na nb">data_filtered_regions &lt;- data %&gt;%<br/>  filter(region %in% good_regions) %&gt;%<br/>  # replace for the sake of the table<br/>  mutate(country = region)</span></pre><p id="2165" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并合并:</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="3fa1" class="mx lx it lv b gy my mz l na nb">data_filtered &lt;-<br/>  rbind(data_filtered_countries, data_filtered_regions)</span></pre><p id="ea9a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们注意到表格标题显示“自地区/国家前 50 例 covid 死亡以来的超额死亡率<em class="le">”这意味着我们需要排除在一个地区有 50 例 COVID 死亡之前的超额死亡数。</em></p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="1147" class="mx lx it lv b gy my mz l na nb">data_filtered &lt;- data_filtered %&gt;%<br/>  group_by(country) %&gt;%<br/>  mutate(csum = cumsum(covid_deaths))</span></pre><p id="9b64" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此时(仅选择相关列后)，我们的数据如下所示:</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="6011" class="mx lx it lv b gy my mz l na nb">data_filtered %&gt;% <br/>  select(country, start_date, end_date, covid_deaths, <br/>         excess_deaths, covid_deaths, csum) %&gt;% <br/>  reactable()</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nd"><img src="../Images/0da9d53a33abbe80744aaab7a4242741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sJowEjfAB7x342mk.png"/></div></div></figure><p id="9307" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要根据与新冠肺炎相关的总死亡人数和超额死亡人数对每个国家进行分组。然后，利用这两个数字，我们计算出新冠肺炎造成的超额死亡的百分比。这可以作为一个国家新冠肺炎病例漏报的衡量标准。</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="68fc" class="mx lx it lv b gy my mz l na nb">data_for_table &lt;- data_filtered %&gt;%<br/>  filter(excess_deaths &gt; 0) %&gt;%<br/>  group_by(country) %&gt;%<br/>  summarise(<br/>    excess_deaths = round(sum(excess_deaths)),<br/>    covid_deaths = round(sum(covid_deaths)),<br/>    perc = covid_deaths / excess_deaths<br/>  ) %&gt;%<br/>  select(country, covid_deaths, excess_deaths, perc)</span><span id="a0de" class="mx lx it lv b gy nc mz l na nb">reactable(data_for_table, pagination = FALSE)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ne"><img src="../Images/7b6df19ae7914487b4d1374aab2fe7bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*J9F65UR84MKOmoXp.png"/></div></div></figure><p id="3257" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此时唯一缺少的是日期范围。为了找到并显示日期，我们需要找到给定国家/地区达到 50 个新冠肺炎病例后的第一个<em class="le">日期和该国家/地区数据</em>中的最后一个<em class="le">日期。</em></p><p id="991b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们如何做到这一点？首先，我们将创建一个名为<code class="fe ls lt lu lv b">append_date_suffix</code>的<a class="ae lf" href="https://stackoverflow.com/questions/40039903/r-add-th-rd-and-nd-to-dates" rel="noopener ugc nofollow" target="_blank">函数</a>，它根据给定的日期添加适当的后缀。</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="d905" class="mx lx it lv b gy my mz l na nb">append_date_suffix &lt;- function(dates) {<br/>  suff &lt;- case_when(<br/>    dates %in% c(11, 12, 13) ~ "th",<br/>    dates %% 10 == 1 ~ 'st',<br/>    dates %% 10 == 2 ~ 'nd',<br/>    dates %% 10 == 3 ~ 'rd',<br/>    TRUE ~ "th"<br/>  )<br/>  paste0(dates, suff)<br/>}</span></pre><p id="9cd8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们将按<code class="fe ls lt lu lv b">country</code>变量分组，并找到最小和最大日期(最小日期仅在一个国家出现 50 例 COVID 死亡后出现)。然后，我们对单个的日期和月份进行大量的格式化，并以经济学家<em class="le">的</em>风格将它们用破折号附加在一起。抱歉，这里发生了很多事。</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="1f58" class="mx lx it lv b gy my mz l na nb">dates_data &lt;-<br/>  data_filtered %&gt;%<br/>  # only looking at date ranges starting post-50 deaths<br/>  filter(csum &gt; 50) %&gt;%<br/>  group_by(country) %&gt;%<br/>  summarise(start_date = min(start_date),<br/>            end_date = max(end_date)) %&gt;%<br/>  mutate(<br/>    clean_start_day = format(start_date, "%d"),<br/>    clean_start_day = append_date_suffix(as.numeric(clean_start_day)),<br/>    clean_start_month = format(start_date, "%b"),<br/>    clean_end_day = format(end_date, "%d"),<br/>    clean_end_day = append_date_suffix(as.numeric(clean_end_day)),<br/>    clean_end_month = format(end_date, "%b")<br/>  ) %&gt;%<br/>  mutate(<br/>    clean_range = paste0(<br/>      clean_start_month," ", ## Mar<br/>      clean_start_day, "-", ## 6-<br/>      clean_end_month, " ", ## May<br/>      clean_end_day ## 18<br/>    )<br/>  ) %&gt;%<br/>  select(country, clean_range)</span></pre><p id="9393" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将创建如下所示的日期范围:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nf"><img src="../Images/19575ea7ec3c740b87df74d8351c0bc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xyHSCtX5QOkzr5IH.png"/></div></div></figure><p id="d30c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将这些日期与我们现有的数据结合起来…</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="2b38" class="mx lx it lv b gy my mz l na nb">data_for_table &lt;- data_filtered %&gt;%<br/>  filter(excess_deaths &gt; 0) %&gt;%<br/>  group_by(country) %&gt;%<br/>  summarise(<br/>    excess_deaths = round(sum(excess_deaths)),<br/>    covid_deaths = round(sum(covid_deaths)),<br/>    perc = covid_deaths / excess_deaths<br/>  ) %&gt;%<br/>  left_join(dates_data, by = 'country') %&gt;%<br/>  select(country, clean_range, covid_deaths, excess_deaths, perc)</span></pre><p id="6638" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们得到了最终的数据集:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ng"><img src="../Images/97b9615bf66660ba1385fef93b1de970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-RmAgBBpryWMz6xT.png"/></div></div></figure><h1 id="4d76" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">创建表</h1><p id="3d0e" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">最后，我们准备好获取数据集并创建我们的表。我们可以从定义一些参数开始，这些参数使表格更容易使用，更美观。在这里，我们根据超额死亡进行排序(但不包括箭头)，使其紧凑，并在一页上显示所有结果。</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="3387" class="mx lx it lv b gy my mz l na nb">reactable(<br/>  data_for_table,<br/>  defaultSortOrder = 'desc',<br/>  defaultSorted = 'excess_deaths',<br/>  showSortIcon = FALSE,<br/>  compact = TRUE,<br/>  pagination = FALSE)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nh"><img src="../Images/42981025d0056901cc25a82337a6f2a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xVmPStrtCioT9_7r.png"/></div></div></figure><h1 id="ec72" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">样式标题</h1><p id="b0e6" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">接下来，让我们使列标题在风格上类似于<em class="le"> The Economist </em>。我们使用 reactable 的<code class="fe ls lt lu lv b">defaultColDef</code>来实现这一点，在这里我们定义了一个带有标题和常规单元格样式的<code class="fe ls lt lu lv b">colDef</code>。在这里，我们可以包括 CSS(您可以通过检查手边的表找到它)。在这篇文章中，你会注意到我经常提到<code class="fe ls lt lu lv b">font_es</code>。这是来自鲍勃·鲁迪斯的《T4》。它包含经济学人 Sans Condensed 的字体名称，这是经济学人使用的字体！</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="3b90" class="mx lx it lv b gy my mz l na nb">reactable(<br/>  data_for_table,<br/>  defaultSortOrder = 'desc',<br/>  defaultSorted = 'excess_deaths',<br/>  showSortIcon = FALSE,<br/>  compact = TRUE,<br/>  pagination = FALSE,<br/>  ######## NEW ########<br/>  defaultColDef = colDef(<br/>    ### define header styling<br/>    headerStyle = list(<br/>      textAlign = "left",<br/>      fontSize = "11px",<br/>      lineHeight = "14px",<br/>      textTransform = "uppercase",<br/>      color = "#0c0c0c",<br/>      fontWeight = "500",<br/>      borderBottom = "2px solid #e9edf0",<br/>      paddingBottom = "3px",<br/>      verticalAlign = "bottom",<br/>      fontFamily = font_es<br/>    ),<br/>    ### define default column styling<br/>    style = list(<br/>      fontFamily = font_es,<br/>      fontSize = "14px",<br/>      verticalAlign = "center",<br/>      align = "left"<br/>    )<br/>  )<br/>)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ne"><img src="../Images/f5287c6fe0a361609ab4d33513cc3777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h4nZYnLToCwQWSyL.png"/></div></div></figure><h1 id="d8cf" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">格式化列</h1><p id="df1b" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">现在，我们可以开始适当地格式化特定的列。最简单的三栏是<strong class="kk iu">地区/国家</strong>、<strong class="kk iu">时间段</strong>、<strong class="kk iu">新冠肺炎占总数的百分比</strong>。在每一列中，我们都创建了一个<code class="fe ls lt lu lv b">colDef</code>，它定义了列名以及一些样式。</p><p id="e013" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您会注意到在我们的百分比栏中增加了<code class="fe ls lt lu lv b">JS</code>。这允许我们在列和列标题中包含 JavaScript。我用它来做一些简单的事情，比如换行。你可以将 JS 用于许多更复杂的目的，<a class="ae lf" href="https://glin.github.io/reactable/articles/examples.html" rel="noopener ugc nofollow" target="_blank">这里记录了其中的一些。</a></p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="9826" class="mx lx it lv b gy my mz l na nb">reactable(<br/>  data_for_table,<br/>  defaultSortOrder = 'desc',<br/>  defaultSorted = 'excess_deaths',<br/>  showSortIcon = FALSE,<br/>  compact = TRUE,<br/>  pagination = FALSE,<br/>  defaultColDef = colDef(<br/>    headerStyle = list(<br/>      textAlign = "left",<br/>      fontSize = "11px",<br/>      lineHeight = "14px",<br/>      textTransform = "uppercase",<br/>      color = "#0c0c0c",<br/>      fontWeight = "500",<br/>      borderBottom = "2px solid #e9edf0",<br/>      paddingBottom = "3px",<br/>      verticalAlign = "bottom",<br/>      fontFamily = font_es<br/>    ),<br/>    style = list(<br/>      fontFamily = font_es,<br/>      fontSize = "14px",<br/>      verticalAlign = "center",<br/>      align = "left"<br/>    )<br/>  ),<br/>  ####### NEW #######<br/>  columns = list(<br/>    country = colDef(<br/>      name = "Region / Country",<br/>      style = list(fontFamily = font_es,<br/>                   fontWeight = "400")<br/>    ),<br/>    perc = colDef(<br/>      html = TRUE,<br/>      header = JS("<br/>      function(colInfo) {<br/>        return 'COVID-19 as&lt;br&gt;% of total'<br/>      }"),<br/>      name = "COVID-19 as % of Total",<br/>      align = "right",<br/>      maxWidth = 100,<br/>      format = colFormat(percent = TRUE, digits = 0),<br/>      style = list(fontFamily =  font_es_bold),<br/>      headerStyle = list(<br/>        fontSize = "11px",<br/>        lineHeight = "14px",<br/>        textTransform = "uppercase",<br/>        color = "#0c0c0c",<br/>        fontWeight = "500",<br/>        borderBottom = "2px solid #e9edf0",<br/>        paddingBottom = "3px",<br/>        verticalAlign = "bottom",<br/>        fontFamily = font_es,<br/>        textAlign = "right"<br/>      )<br/>    ),<br/>    clean_range = colDef(<br/>      name = "Time Period",<br/>      style = list(<br/>        color = '#3f5661',<br/>        fontSize = '12px',<br/>        fontFamily = font_es<br/>      )<br/>    )<br/>  )<br/>)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ni"><img src="../Images/9c78f0e4f6558e6ff139478921b3683e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RYSpLvEXLv5SXpjQ.png"/></div></div></figure><h1 id="0415" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">添加条形图</h1><p id="2ec9" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">我们现在可以创建包含条形图的“死亡”列。</p><p id="f789" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于集成了 JavaScript，向表格添加条形图变得非常容易。这里，我从<code class="fe ls lt lu lv b">reactable</code>网站上的一个<a class="ae lf" href="https://glin.github.io/reactable/articles/twitter-followers/twitter-followers.html" rel="noopener ugc nofollow" target="_blank">示例</a>中提取，并使用以下代码:</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="bc85" class="mx lx it lv b gy my mz l na nb">reactable(<br/>  data_for_table,<br/>  defaultSortOrder = 'desc',<br/>  defaultSorted = 'excess_deaths',<br/>  showSortIcon = FALSE,<br/>  compact = TRUE,<br/>  pagination = FALSE,<br/>  defaultColDef = colDef(<br/>    headerStyle = list(<br/>      textAlign = "left",<br/>      fontSize = "11px",<br/>      lineHeight = "14px",<br/>      textTransform = "uppercase",<br/>      color = "#0c0c0c",<br/>      fontWeight = "500",<br/>      borderBottom = "2px solid #e9edf0",<br/>      paddingBottom = "3px",<br/>      verticalAlign = "bottom",<br/>      fontFamily = font_es<br/>    ),<br/>    style = list(<br/>      fontFamily = font_es,<br/>      fontSize = "14px",<br/>      verticalAlign = "center",<br/>      align = "left"<br/>    )<br/>  ),<br/>  columns = list(<br/>    country = colDef(<br/>      name = "Region / Country",<br/>      style = list(fontFamily = font_es,<br/>                   fontWeight = "400")<br/>    ),<br/>    perc = colDef(<br/>      html = TRUE,<br/>      header = JS("<br/>      function(colInfo) {<br/>        return 'COVID-19 as&lt;br&gt;% of total'<br/>      }"),<br/>      name = "COVID-19 as % of Total",<br/>      align = "right",<br/>      maxWidth = 100,<br/>      format = colFormat(percent = TRUE, digits = 0),<br/>      style = list(fontFamily =  font_es_bold),<br/>      headerStyle = list(<br/>        fontSize = "11px",<br/>        lineHeight = "14px",<br/>        textTransform = "uppercase",<br/>        color = "#0c0c0c",<br/>        fontWeight = "500",<br/>        borderBottom = "2px solid #e9edf0",<br/>        paddingBottom = "3px",<br/>        verticalAlign = "bottom",<br/>        fontFamily = font_es,<br/>        textAlign = "right"<br/>      )<br/>    ),<br/>    clean_range = colDef(<br/>      name = "Time Period",<br/>      style = list(<br/>        color = '#3f5661',<br/>        fontSize = '12px',<br/>        fontFamily = font_es<br/>      )<br/>    ),<br/>    ###### NEW ######<br/>    covid_deaths = colDef(<br/>      name = "COVID-19 Deaths",<br/>      cell = function(value) {<br/>        width &lt;- paste0(value * 100 / max(data_for_table$covid_deaths), "%")<br/>        value &lt;- format(value, big.mark = ",")<br/>        value &lt;- format(value, width = 10, justify = "right")<br/>        bar &lt;- div(<br/>          class = "bar-chart",<br/>          style = list(marginRight = "6px"),<br/>          div(<br/>            class = "bar",<br/>            style = list(width = width, backgroundColor = "#F15A3F")<br/>          )<br/>        )<br/>        div(class = "bar-cell", span(class = "number", value), bar)<br/>      }<br/>    ),<br/>    excess_deaths = colDef(<br/>      name = "Total Excess Deaths",<br/>      cell = function(value) {<br/>        width &lt;-<br/>          paste0(value * 100 / max(data_for_table$excess_deaths), "%")<br/>        value &lt;- format(value, big.mark = ",")<br/>        value &lt;- format(value, width = 10, justify = "right")<br/>        bar &lt;- div(<br/>          class = "bar-chart",<br/>          style = list(marginRight = "6px"),<br/>          div(<br/>            class = "bar",<br/>            style = list(width = width, backgroundColor = "#3F5661")<br/>          )<br/>        )<br/>        div(class = "bar-cell", span(class = "number", value), bar)<br/>      }<br/>    )<br/>  )<br/>)</span></pre><p id="112e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们把重点放在<code class="fe ls lt lu lv b">covid_deaths</code>上，一步一步地分解它。</p><p id="0bf5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们需要定义一些 CSS。<code class="fe ls lt lu lv b">reactable</code>允许您轻松地将 CSS is RMarkdown 文档包含在定义为<code class="fe ls lt lu lv b">css</code>的块中。</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="dd7b" class="mx lx it lv b gy my mz l na nb">.bar-cell {<br/>  display: flex;<br/>  align-items: center;<br/>}</span><span id="2391" class="mx lx it lv b gy nc mz l na nb">.number {<br/>  font-size: 13.5px;<br/>  white-space: pre;<br/>}</span><span id="9681" class="mx lx it lv b gy nc mz l na nb">.bar-chart {<br/>  flex-grow: 1;<br/>  margin-left: 6px;<br/>  height: 22px;<br/>}</span><span id="ef42" class="mx lx it lv b gy nc mz l na nb">.bar {<br/>  height: 100%;<br/>}</span></pre><p id="4f72" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，让我们看看我们如何定义<code class="fe ls lt lu lv b">covid_deaths</code>:</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="c507" class="mx lx it lv b gy my mz l na nb">covid_deaths = colDef(<br/>  ### define the name<br/>  name = "COVID-19 Deaths",<br/>  ### create a 'cell' function<br/>  cell = function(value) {<br/>    ### define the bar width according to the specified value<br/>    width &lt;- paste0(value * 100 / max(data_for_table$covid_deaths), "%")<br/>    ### add a comma to the label<br/>    value &lt;- format(value, big.mark = ",")<br/>    ### justify and provide padding with width<br/>    value &lt;- format(value, width = 10, justify = "right")<br/>    ### create the barchart div<br/>    bar &lt;- div(<br/>      ### with a class of 'bar-chart'<br/>      class = "bar-chart",<br/>      ### give the bar a margin<br/>      style = list(marginRight = "6px"),<br/>      ### create the *actual* bar, with the red economist color<br/>      div(<br/>        class = "bar",<br/>        style = list(width = width, backgroundColor = "#F15A3F")<br/>      )<br/>    )<br/>    ### bring it all together, with the 'value' (number) preceding the bar itself<br/>    div(class = "bar-cell", span(class = "number", value), bar)<br/>  }<br/>)</span></pre><p id="05fa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将创建一个如下所示的表:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ng"><img src="../Images/3f1552d7a1ceb32abd64c5a881223f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tF-V0GydBVCr4Ahe.png"/></div></div></figure><h1 id="3e8d" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">添加标题</h1><p id="1299" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">最后，我们可以添加表格标题和副标题。我们通过在我们的环境中存储上表来做到这一点。(这是最终的表码！)</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="2651" class="mx lx it lv b gy my mz l na nb">table &lt;- reactable(<br/>  data_for_table,<br/>  defaultSortOrder = 'desc',<br/>  defaultSorted = 'excess_deaths',<br/>  showSortIcon = FALSE,<br/>  compact = TRUE,<br/>  pagination = FALSE,<br/>  defaultColDef = colDef(<br/>    headerStyle = list(<br/>      textAlign = "left",<br/>      fontSize = "11px",<br/>      lineHeight = "14px",<br/>      textTransform = "uppercase",<br/>      color = "#0c0c0c",<br/>      fontWeight = "500",<br/>      borderBottom = "2px solid #e9edf0",<br/>      paddingBottom = "3px",<br/>      verticalAlign = "bottom",<br/>      fontFamily = font_es<br/>    ),<br/>    style = list(<br/>      fontFamily = font_es,<br/>      fontSize = "14px",<br/>      verticalAlign = "center",<br/>      align = "left"<br/>    )<br/>  ),<br/>  <br/>  columns = list(<br/>    country = colDef(<br/>      name = "Region / Country",<br/>      style = list(fontFamily = font_es,<br/>                   fontWeight = "400")<br/>    ),<br/>    covid_deaths = colDef(<br/>      name = "COVID-19 Deaths",<br/>      # align = "left",<br/>      cell = function(value) {<br/>        width &lt;- paste0(value * 100 / max(data_for_table$covid_deaths), "%")<br/>        value &lt;- format(value, big.mark = ",")<br/>        # value &lt;- str_pad(value, 6, pad = "")<br/>        value &lt;- format(value, width = 10, justify = "right")<br/>        bar &lt;- div(<br/>          class = "bar-chart",<br/>          style = list(marginRight = "6px"),<br/>          div(<br/>            class = "bar",<br/>            style = list(width = width, backgroundColor = "#F15A3F")<br/>          )<br/>        )<br/>        div(class = "bar-cell", span(class = "number", value), bar)<br/>      }<br/>    ),<br/>    excess_deaths = colDef(<br/>      name = "Total Excess Deaths",<br/>      # align = "left",<br/>      cell = function(value) {<br/>        width &lt;-<br/>          paste0(value * 100 / max(data_for_table$excess_deaths), "%")<br/>        value &lt;- format(value, big.mark = ",")<br/>        value &lt;- format(value, width = 10, justify = "right")<br/>        bar &lt;- div(<br/>          class = "bar-chart",<br/>          style = list(marginRight = "6px"),<br/>          div(<br/>            class = "bar",<br/>            style = list(width = width, backgroundColor = "#3F5661")<br/>          )<br/>        )<br/>        div(class = "bar-cell", span(class = "number", value), bar)<br/>      }<br/>    ),<br/>    perc = colDef(<br/>      html = TRUE,<br/>      header = JS("<br/>      function(colInfo) {<br/>        return 'COVID-19 as&lt;br&gt;% of total'<br/>      }"),<br/>      name = "COVID-19 as % of Total",<br/>      align = "right",<br/>      maxWidth = 100,<br/>      format = colFormat(percent = TRUE, digits = 0),<br/>      style = list(fontFamily =  font_es_bold),<br/>      headerStyle = list(<br/>        fontSize = "11px",<br/>        lineHeight = "14px",<br/>        textTransform = "uppercase",<br/>        color = "#0c0c0c",<br/>        fontWeight = "500",<br/>        borderBottom = "2px solid #e9edf0",<br/>        paddingBottom = "3px",<br/>        verticalAlign = "bottom",<br/>        fontFamily = font_es,<br/>        textAlign = "right"<br/>      )<br/>    ),<br/>    clean_range = colDef(<br/>      name = "Time Period",<br/>      style = list(<br/>        color = '#3f5661',<br/>        fontSize = '12px',<br/>        fontFamily = font_es<br/>      )<br/>    )<br/>  ),<br/>)</span></pre><p id="b85c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们可以在表格上方包含一个标题和副标题。我们使用一些<code class="fe ls lt lu lv b">htmltools</code>函数来创建 div、标题和段落。</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="bcc2" class="mx lx it lv b gy my mz l na nb">div(<br/>    div(<br/>      h2("Excess mortality since region/country’s first 50 covid deaths"),<br/>      p(<br/>        ### create the 'Updated on ...' and make it dynamic<br/>        paste0(<br/>          "Updated on ", format(Sys.Date(), "%B "),<br/>          append_date_suffix(<br/>            as.numeric(format(Sys.Date(), "%d"))<br/>            ), " ",<br/>          strftime(Sys.time(), format = "%H:%M"), " UCT"<br/>        )<br/>      ),<br/>    ),<br/>    table)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nj"><img src="../Images/f7b94719149bbc77549021b737760e9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yqTkwgKh_kgkwrxe.png"/></div></div></figure><p id="44ca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">呀！那些字体大小不太符合经济学人的风格。让我们给我们的 div 添加类来匹配它们的风格。</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="0db6" class="mx lx it lv b gy my mz l na nb">.table {<br/>  margin: 0 auto;<br/>  width: 675px;<br/>}</span><span id="bed3" class="mx lx it lv b gy nc mz l na nb">.tableTitle {<br/>  margin: 6px 0;<br/>  font-size: 16px;<br/>  font-family: 'Econ Sans Cnd'<br/>}</span><span id="17ac" class="mx lx it lv b gy nc mz l na nb">.tableTitle h2 {<br/>  font-size: 16px;<br/>  font-weight: bold;<br/>  font-family: 'Econ Sans Cnd'<br/>}</span><span id="c2c3" class="mx lx it lv b gy nc mz l na nb">.tableTitle p {<br/>  font-size: 14px;<br/>  font-weight: 500;<br/>}</span></pre><p id="c4d3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以重新运行上面的代码:</p><pre class="lh li lj lk gt mt lv mu mv aw mw bi"><span id="f24c" class="mx lx it lv b gy my mz l na nb">div(class = "tableTitle",<br/>    div(<br/>      class = "title",<br/>      h2("Excess mortality since region/country’s first 50 covid deaths"),<br/>      p(<br/>        paste0("Updated on ", format(Sys.Date(),"%B "),<br/>          append_date_suffix(<br/>            as.numeric(format(Sys.Date(), "%d"))<br/>            ), " ",<br/>          strftime(Sys.time(), format = "%H:%M"), " UCT"<br/>        )<br/>      ),<br/>    ),<br/>    table)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nk"><img src="../Images/d1a469f90b7dc286926c8bfad8bba5af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6DZoWvk024JVzCQa.png"/></div></div></figure><p id="ac4e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们将它与我们试图复制的表进行比较。请注意，在《经济学家》杂志发表他们的表格和我创建我的表格之间的时间里，有些数据已经改变了。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/8c1420bb9adc4da82cd6db52377d64a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MjIzU4CfAsFDZ9pUz-MVrQ.png"/></div></div></figure><p id="e383" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章的代码可以在我的 GitHub 上找到。你可以把任何关于复制的问题(或任何其他问题)发送给 me@connorrothschild.com，或者在我的推特上。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="b5e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae lf" href="https://twitter.com/CL_Rothschild" rel="noopener ugc nofollow" target="_blank">https://twitter.com/CL_Rothschild</a></p><p id="03c4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最初发表在<a class="ae lf" href="https://www.connorrothschild.com/post/economist-table-replication-using-reactable/" rel="noopener ugc nofollow" target="_blank">我的博客上。</a></p></div></div>    
</body>
</html>