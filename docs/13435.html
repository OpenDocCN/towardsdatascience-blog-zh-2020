<html>
<head>
<title>Time Series Smoothing for better Forecasting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列平滑用于更好的预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-smoothing-for-better-forecasting-7fbf10428b2?source=collection_archive---------13-----------------------#2020-09-15">https://towardsdatascience.com/time-series-smoothing-for-better-forecasting-7fbf10428b2?source=collection_archive---------13-----------------------#2020-09-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b27e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">降低传感器中的噪声，以更好地预测太阳能电池板的发电量</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b0ece71ea785ee17eba75fd3717af28d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PQLi-3CuGkJ3kIsq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">亚历山大·埃里明在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="df77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在时间序列预测中，脏的和杂乱的数据的存在会损害最终的预测。这是真的，尤其是在这个领域，因为时间依赖在处理时间序列时起着至关重要的作用。</p><p id="6345" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">噪声或异常值必须按照特定的解决方案小心处理。在这种情况下，<a class="ae ky" href="https://github.com/cerlymarco/tsmoothie" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> tsmoothie </strong> </a>软件包可以帮助我们在准备时间序列进行分析时节省大量时间。<a class="ae ky" href="https://github.com/cerlymarco/tsmoothie" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Tsmoothie </strong> </a>是一个用于时间序列平滑和异常值检测的 python 库，可以以矢量化的方式处理多个序列。它很有用，因为它可以提供我们需要的预处理步骤，如去噪或剔除异常值，保留原始数据中的时间模式。</p><p id="5b63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本帖中，我们用这些小玩意来改进预测任务。更准确地说，我们试图预测太阳能电池板的日发电量。最后，我们将期望从我们的去噪过程中受益，并产生比没有预处理的情况更好的预测。</p><h1 id="9d4c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据</h1><p id="b5f2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在<a class="ae ky" href="https://www.kaggle.com/fvcoppen/solarpanelspower" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上有一个用于我们目的的真实数据集。该数据存储了安装在私人住宅屋顶上的太阳能电池板的日发电量。数据自 2011 年开始记录，以时间序列格式呈现 3 个不同的来源:</p><ul class=""><li id="fd9a" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">房子每天的煤气消耗量。</li><li id="bad8" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">房子的日常用电量。其中负值表示太阳能超过了当地的电力消耗。</li><li id="eb3e" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">DC 到交流转换器上功率计的每日值。这是目前累积的太阳能电力。我们不需要累计值，而是需要每日的绝对值，因此，我们进行简单的微分运算。这是我们的预测目标。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/b4471911b04c143eed14f698a3569350.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DW3_Xku3tw0BOx3m6Gnqpw.png"/></div></div></figure><p id="50cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们从 raw 系列的图中可以注意到的，存在大量噪声。这对于传感器记录的数据来说是正常的。如果我们的数据源受到外部气象条件的影响，或者如果传感器质量不好，并且位于非最佳位置，情况会更糟。</p><p id="5a8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，我们有知识和工具来实现我们预测任务的良好结果。</p><h1 id="c5bd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">时间序列平滑</h1><p id="e3d7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们工作流程的第一步包括时间序列预处理。我们的策略非常直观有效。我们获取目标时间序列(发电量)，并用一个神奇的工具对其进行平滑:每个数据科学家都必须知道的<strong class="lb iu">卡尔曼滤波器</strong>、<strong class="lb iu">、</strong>。</p><p id="ddb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，在时间序列任务中使用卡尔曼滤波器的最大优点是可以使用状态空间形式来表示未观察到的组件模型。以状态空间形式表示时间序列模型的范围是一组通用算法(包括卡尔曼滤波器)的可用性，用于高斯似然的计算，其可以在数值上最大化以获得模型参数的最大似然估计。著名的软件使用这种表示来拟合像 ARIMA 这样的模型并不是偶然的。在我们的特殊情况下，我们使用卡尔曼滤波器和状态空间表示来建立一个未观察到的组件模型。</p><p id="1e11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，所有这些解释听起来都很棘手，但我想向您保证…<a class="ae ky" href="https://github.com/cerlymarco/tsmoothie" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Tsmoothie</strong></a><strong class="lb iu"/>可以轻松地构建未观察到的组件模型，以非常简单有效的方式操作自定义卡尔曼平滑。在这个阶段，我们可以释放我们的想象力，从<em class="nh">水平、趋势、季节性、长期季节性</em>中检测哪些成分有助于创建我们正在观察的时间序列。365 天的<em class="nh">水平</em>和<em class="nh">长季节性</em>对我们来说听起来不错。我们只需为每个组件假设添加一个“置信度”,就完成了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/cc91b1281cbc9f3294662c9d20c5c1e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g2DNkL9lw12KbgmCMQRljA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">对所有系列进行卡尔曼平滑(仅用于视觉目的)。我们只使用平滑的目标</p></figure><p id="bd07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">得到的平滑时间序列保持原始数据中存在的相同时间模式，但是具有一致且合理的噪声降低。</p><p id="038a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">专业提示:</strong>如果我们的系列出现 NaNs，这不是问题，这个过程非常有效，它是一个非常强大的工具，可以填补我们数据中缺失的空白…这就是卡尔曼平滑的魅力。</p><h1 id="44c4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">时间数列预测法</h1><p id="2cfd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">第二步是建立一个神经网络结构来预测未来几天的发电量。首先，我们在原始数据上拟合一个模型，其次，我们尝试在平滑的序列上拟合。平滑数据仅用作目标变量，所有输入序列保持原始格式。平滑标签的使用旨在帮助模型更好地捕捉真实模式并丢弃噪声。</p><p id="a1ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们选择 LSTM 自动编码器来预测未来 5 天的发电量。使用<a class="ae ky" href="https://github.com/cerlymarco/keras-hypetune" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">keras-hype tune</strong></a><strong class="lb iu">执行训练程序。</strong>该框架以非常直观的方式提供了神经网络结构的<strong class="lb iu">超参数优化</strong>。我们对一些参数组合进行网格搜索。所有涉及的两项培训都是如此。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/185fc934b867ae27ceaa7f776e89f419.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*HRBPpVrh853_ddDfs9x1ow.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基线只是现值的重复</p></figure><p id="303f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以想象，预测误差是时间范围的函数。第二天的预测比未来五天的预测更准确。重要的一点是，就所有时间预测范围的预测精度而言，平滑过程提供了很大的好处。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/4580183016daa10df5ebff59321e8ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SlxIiGlAdW8yk8YywFmbWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">对未知测试数据的预测</p></figure><h1 id="2340" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">摘要</h1><p id="2989" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在这篇文章中，我们利用了预测场景中的时间序列平滑。我们应用卡尔曼滤波器来平滑我们的原始数据并减少噪音的存在。这一选择被证明在预测准确性方面是有利的。我还想指出卡尔曼滤波器在这一应用中的强大功能，以及它在构建未观察到的组件模型时成为一种良好工具的能力。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="f0e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/cerlymarco/MEDIUM_NoteBook" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">查看我的 GITHUB 回购</strong> </a></p><p id="a4aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保持联系:<a class="ae ky" href="https://www.linkedin.com/in/marco-cerliani-b0bba714b/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a></p></div></div>    
</body>
</html>