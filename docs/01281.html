<html>
<head>
<title>Sharing data visualisations in VirtualBox to keep IT departments happy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在VirtualBox中共享数据可视化，让IT部门满意</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sharing-data-visualisations-in-virtualbox-to-keep-it-departments-happy-f978854ea44d?source=collection_archive---------45-----------------------#2020-02-04">https://towardsdatascience.com/sharing-data-visualisations-in-virtualbox-to-keep-it-departments-happy-f978854ea44d?source=collection_archive---------45-----------------------#2020-02-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f8a3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">当您的客户端无法使用容器或云时，如何将Jupyter演示作为独立的VirtualBox映像共享</h2></div><p id="728a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Jupyter或类似的原型环境中从事概念验证模型或演示的数据科学家需要找到一种方法，以便在项目完成时与客户分享。在他们的机器上复制成功运行它的环境并不容易。</p><p id="432c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>提供了再现性的解决方案——环境和工作空间文件可以打包成一个图像。</p><p id="cbf1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，确保它能够在企业环境中轻松部署到客户端并不总是那么简单。他们的IT部门可能没有资源在云或内部服务器上临时托管应用程序；可能不允许在用户自己的计算机上安装Docker Desktop。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/68d7777f510983196ca9b164d7e83a3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UAbfBBjHaDdszkTZ"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">一个路障，就像你的IT部门……(由<a class="ae lb" href="https://unsplash.com/@jamie452?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰米街</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure><p id="1475" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" href="https://www.virtualbox.org/" rel="noopener ugc nofollow" target="_blank"> VirtualBox </a>是一个历史悠久的软件组件，被IT部门普遍接受，在大多数企业中只需很少的繁文缛节就可以安装。</p><p id="8526" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文描述了打包Jupyter笔记本环境的步骤，最初是作为Docker映像，但最终会作为独立文件发送给客户，可以直接导入到他们机器上的VirtualBox中。</p><p id="0097" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个我们可以在<a class="ae lb" href="https://containds.com/" rel="noopener ugc nofollow" target="_blank"> ContainDS </a>为企业客户自动化的过程，但是下面描述的手动步骤将提供最重要的方面。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ls"><img src="../Images/afa34672954582bd2b5363f014ab0b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r6hna_FAaUP0iUFljbYw3Q.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">我们的Jupyter Voila演示样本</p></figure><h2 id="f469" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">保存您的Jupyter体验</h2><p id="b5c6" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">你的项目最重要的部分当然是首先构建可视化。我不会教你如何做到这一点…但就本文的目的而言，我们将假设它在一个本地web应用程序中，如Jupyter notebook，或者如果你希望它对客户端更友好，Jupyter Voila演示。</p><p id="2c0c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种情况下，有大量的<a class="ae lb" rel="noopener" target="_blank" href="/docker-without-the-hassle-b98447caedd8">指南</a>来与Docker一起工作，以建立您的项目的图像，您可以与他人分享，或者如果您想完全不必了解Docker，那么我们的桌面应用程序<a class="ae lb" href="https://containds.com/download/" rel="noopener ugc nofollow" target="_blank"> ContainDS </a>将为您完成这一切，包括将您的基于Jupyter的环境转换为Voila演示。</p><p id="7df2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于这篇文章，我们将只使用一个简单的例子Voila演示，我已经将它打包成一个图像，并<a class="ae lb" href="https://hub.docker.com/r/danlester/voila-sincos" rel="noopener ugc nofollow" target="_blank">上传到Docker Hub </a>。</p><p id="7498" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在Mac上运行这些步骤，但Windows非常相似。</p><h1 id="0b93" class="mr lu iq bd lv ms mt mu ly mv mw mx mb jw my jx me jz mz ka mh kc na kd mk nb bi translated">使用VirtualBox</h1><p id="d978" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">我们有机会首先在自己的计算机上设置我们的VirtualBox虚拟机(VM ),加载Docker映像并设置一些其他配置。然后，我们将其导出为单个“OVA”文件，发送给客户端。</p><h2 id="4fcb" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">创建VirtualBox计算机的副本</h2><p id="9e78" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">我们将从Docker提供的VirtualBox映像开始，以便在VM中运行Docker。这实际上是在Docker Desktop没有在Mac或Windows上本地运行的时候，但它在这里很有用。</p><p id="5855" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从技术上讲，在这个虚拟机中直接与Docker交互是可能的——不需要在我们的计算机上本地安装任何Docker产品——但这需要更多的工作。有一个叫做<a class="ae lb" href="https://docs.docker.com/v17.09/machine/overview/" rel="noopener ugc nofollow" target="_blank"> docker-machine </a>的产品，我们可以用它来初始化VirtualBox虚拟机，使其包含docker守护程序，并使我们能够从主机访问其Docker守护程序。如果我们的机器上有docker命令行工具，事情也会变得更简单。</p><p id="2d6d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，你应该安装<a class="ae lb" href="https://docs.docker.com/toolbox/overview/" rel="noopener ugc nofollow" target="_blank"> Docker工具箱</a>。安装程序包含VirtualBox以及docker-machine和docker命令。你可以从<a class="ae lb" href="https://github.com/docker/toolbox/releases" rel="noopener ugc nofollow" target="_blank"> GitHub发布页面</a>下载最新的pkg安装程序(Mac版)或exe(Windows版)。</p><h2 id="d464" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">创建VirtualBox虚拟机</h2><p id="901a" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">使用docker-machine在VirtualBox上创建一个包含Docker <a class="ae lb" href="https://github.com/boot2docker/boot2docker" rel="noopener ugc nofollow" target="_blank"> boot2docker映像</a>的新虚拟机。我们将该虚拟机称为“dsdeploy”。在终端窗口中运行:</p><pre class="ld le lf lg gt nc nd ne nf aw ng bi"><span id="6a3d" class="lt lu iq nd b gy nh ni l nj nk">docker-machine create --driver virtualbox dsdeploy</span></pre><p id="b127" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后配置我们的终端在VM中访问Docker，而不是期望与在主机上本地运行的Docker守护进程一起工作。</p><pre class="ld le lf lg gt nc nd ne nf aw ng bi"><span id="b2c7" class="lt lu iq nd b gy nh ni l nj nk">docker-machine env dsdeploy</span></pre><p id="105c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将显示需要在计算机上设置的环境变量的详细信息。一旦设置好了(设置这些的命令应该通过你刚才运行的‘env’命令出现在你的屏幕上)，<code class="fe nl nm nn nd b">docker</code>命令现在将与VM中的Docker对话。</p><p id="e7be" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行以下命令来获取我们项目的样本Voila演示Docker映像，并将其设置为作为新容器运行，所有这些都在我们的新VM中:</p><pre class="ld le lf lg gt nc nd ne nf aw ng bi"><span id="5e4a" class="lt lu iq nd b gy nh ni l nj nk">docker pull danlester/voila-sincos:de3b79a7</span><span id="b1cb" class="lt lu iq nd b gy no ni l nj nk">docker run -p 8888:8888 danlester/voila-sincos:de3b79a7</span></pre><p id="5235" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将从Docker Hub获取图像，然后启动一个新的容器，在端口8888上显示Jupyter/Voila服务器。</p><h2 id="e18f" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">自动启动容器</h2><p id="dadb" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">我们可以现在就导出虚拟机，并与客户端共享。然而，我们忽略了一些能让我们的接收者更容易接受的东西。</p><p id="ffe0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当冷导入到他们自己的VirtualBox时，Docker容器将仍然存在，但不会运行。他们必须获得一个进入虚拟机的终端，并让它再次运行。也很难知道他们在网络浏览器中访问Voila服务器需要什么URL，所以我们会想办法通知他们。</p><p id="f927" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在您的主机上创建一个名为<code class="fe nl nm nn nd b">docker_start_webapps</code>的文本文件，包含以下内容:</p><pre class="ld le lf lg gt nc nd ne nf aw ng bi"><span id="5f27" class="lt lu iq nd b gy nh ni l nj nk">echo -e "\n\n Starting all web apps..."</span><span id="9f65" class="lt lu iq nd b gy no ni l nj nk">docker start $(docker ps -a -q)</span><span id="1d65" class="lt lu iq nd b gy no ni l nj nk">echo -e "\n ******* \n\n Please visit this address in your web browser\n"</span><span id="b89b" class="lt lu iq nd b gy no ni l nj nk">ifconfig -a eth1 | grep 'inet addr' | awk -F '[: ]+' -v OFS='' '{print "http://",$4,":8888/"}'</span><span id="4e63" class="lt lu iq nd b gy no ni l nj nk">echo -e "\n ******* \n"</span></pre><p id="00b7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个脚本将启动所有停止的容器，并输出访问Voila演示所需的URL。它非常适合作为我们虚拟机引导过程结束时的启动脚本。</p><p id="1a97" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用以下命令将文件复制到虚拟机:</p><pre class="ld le lf lg gt nc nd ne nf aw ng bi"><span id="23ae" class="lt lu iq nd b gy nh ni l nj nk">docker-machine scp docker_start_webapps dsdeploy:/var/lib/boot2docker/docker_start_webapps</span></pre><p id="448a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们需要ssh到VM来完成引导过程，并确保我们的新脚本在启动时被调用。在您的终端上运行以下命令:</p><pre class="ld le lf lg gt nc nd ne nf aw ng bi"><span id="f59e" class="lt lu iq nd b gy nh ni l nj nk">docker-machine ssh dsdeploy -t</span></pre><p id="5d43" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，在虚拟机中新创建的ssh会话内运行以下命令:</p><pre class="ld le lf lg gt nc nd ne nf aw ng bi"><span id="a060" class="lt lu iq nd b gy nh ni l nj nk">sudo chmod a+x /var/lib/boot2docker/docker_start_webapps</span><span id="71c4" class="lt lu iq nd b gy no ni l nj nk">sudo chmod o+w /var/lib/boot2docker/profile</span><span id="c1cf" class="lt lu iq nd b gy no ni l nj nk">sudo ln -s /var/lib/boot2docker/docker_start_webapps /etc/profile.d/docker_start_webapps.sh</span><span id="e269" class="lt lu iq nd b gy no ni l nj nk">sudo chmod o-w /var/lib/boot2docker/profile</span></pre><p id="bba3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里的要点是将我们的新启动脚本链接到/etc/profile.d文件夹中，这样它将在启动时自动运行。</p><p id="5b73" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">键入<code class="fe nl nm nn nd b">exit</code>退出ssh会话。</p><p id="2765" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每次重启时，虚拟机的很大一部分都会被擦除和重新初始化，因此我们需要一些变通方法来确保我们的启动脚本是永久的。</p><h2 id="8fd8" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">导出VirtualBox虚拟机</h2><p id="4135" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">我们终于准备好将虚拟机导出为文件，与我们的客户端共享。</p><p id="e9f3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行以下命令暂停虚拟机:</p><pre class="ld le lf lg gt nc nd ne nf aw ng bi"><span id="1fc3" class="lt lu iq nd b gy nh ni l nj nk">docker-machine stop dsdeploy</span></pre><p id="a1f8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后使用VirtualBox的VBoxManage命令将虚拟机导出为自包含文件:</p><pre class="ld le lf lg gt nc nd ne nf aw ng bi"><span id="8003" class="lt lu iq nd b gy nh ni l nj nk">VBoxManage export dsdeploy --iso -o voila_sincos_saved.ova</span></pre><p id="9a93" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果由于某种原因无法运行VBoxManage命令，可以使用VirtualBox GUI应用程序完成上述操作。(导出为OCI容器，确保包含ISO映像。)</p><h1 id="b56c" class="mr lu iq bd lv ms mt mu ly mv mw mx mb jw my jx me jz mz ka mh kc na kd mk nb bi translated">与客户分享</h1><p id="5b99" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">OVA文件voila_sincos_saved.ova可以使用大型安全文件的常用通道发送到您的客户端。请注意，它将超过1 GB，所以电子邮件将不足够！</p><p id="7a91" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在他们的计算机上，他们应该像往常一样运行友好的VirtualBox GUI应用程序。在“文件”菜单中选择“导入设备…”</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi np"><img src="../Images/df98d3676554ead12ceb4f721a0ead1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qk8PpKHFSUIf8pjF1BRTbg.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">将OVA文件导入VirtualBox</p></figure><p id="0fb5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">找到OVA文件，并使用默认设置导入它。</p><p id="b09d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当虚拟机启动时，将会有一个有限的屏幕显示，但应该足以看到我们提供的最终说明:“请在您的网络浏览器中访问此地址”以及Voila演示文稿的URL。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nq"><img src="../Images/3452a74eb3019e136a99aef13cad40bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GcFR-XeJ1URePsgphdRKIw.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">当我们的接收者导入时，虚拟机的基本显示</p></figure><p id="f458" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果他们访问这个URL，他们应该能够与我们的演示交互，就像我们创建它一样！</p><h1 id="2e06" class="mr lu iq bd lv ms mt mu ly mv mw mx mb jw my jx me jz mz ka mh kc na kd mk nb bi translated">结论</h1><p id="68bc" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">找到一种在云中托管这个Voila应用程序的方法肯定会更好。但有时这是不可能的，例如，如果你没有权限在云中托管所有相关数据，或者如果你不能指望在预定观看演示的位置可靠地访问互联网。</p><p id="77a1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一种“更纯粹”的方法是以Docker图片的形式直接分享演示文稿。我们的<a class="ae lb" href="https://containds.com/download/" rel="noopener ugc nofollow" target="_blank">包含桌面软件</a>很容易实现这一点，正如最近的另一个教程中的<a class="ae lb" rel="noopener" target="_blank" href="/cut-out-the-cloud-share-interactive-jupyter-dashboards-on-a-usb-stick-c196d01df3e4">所描述的，但是这依赖于Docker可以安装在源机器和目的机器上。</a></p><p id="8ff5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望这篇文章可以帮助你，如果你有这个非常具体的需要，以确保客户可以通过VirtualBox访问你的作品。</p><p id="0618" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在您的本地机器上使用数据科学环境是我们ContainDS每天都在考虑的事情，我将<a class="ae lb" href="https://containds.com/support/" rel="noopener ugc nofollow" target="_blank">非常高兴听到</a>您如何应对这些挑战，或者您是否需要任何帮助。</p></div></div>    
</body>
</html>