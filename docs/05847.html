<html>
<head>
<title>A Very Precise &amp; Fast Way to Pull Google Trends Data Automatically</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个非常精确和快速的自动获取谷歌趋势数据的方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-very-precise-fast-way-to-pull-google-trends-data-automatically-4c3c431960aa?source=collection_archive---------9-----------------------#2020-05-14">https://towardsdatascience.com/a-very-precise-fast-way-to-pull-google-trends-data-automatically-4c3c431960aa?source=collection_archive---------9-----------------------#2020-05-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/765a016c17dcf3cc631a40fae4fe76ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kCwyOKNkBb6eF_8Y78Nfbg.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图片来源:Unsplash 的 Alex Blajan。</p></figure><div class=""/><p id="94aa" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">一个一站式脚本，使用 Pytrends 通过精确的关键字自动拉动 Google trends</em></p><p id="be46" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">新冠肺炎为“谷歌趋势”在美国的使用提供了便利(见下图)。毕竟，它是一个免费的公开可用的工具，提供跨谷歌搜索引擎的实际搜索请求。越来越多的公司利用谷歌趋势来了解类别趋势、消费者热门搜索查询、竞争对手在“黑天鹅”疫情事件中的表现。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lb"><img src="../Images/1cd2386feadb22e7c4964b8f1a8aa5d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NwF0DgfhPDYZJoo-7nbuHA.jpeg"/></div></div></figure><p id="3b7d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">每个 Google Trends 请求包含 5 个独特的参数:</p><ul class=""><li id="0f07" class="lg lh jf ke b kf kg kj kk kn li kr lj kv lk kz ll lm ln lo bi translated"><strong class="ke jg">关键词:</strong>你的关键词在这里。您可以使用下拉框下的提示来选择正确的关键字。</li><li id="4c97" class="lg lh jf ke b kf lp kj lq kn lr kr ls kv lt kz ll lm ln lo bi translated"><strong class="ke jg">国家:</strong>拥有国际足迹的公司可以使用这个功能来获取各国的趋势。</li><li id="fd5f" class="lg lh jf ke b kf lp kj lq kn lr kr ls kv lt kz ll lm ln lo bi translated"><strong class="ke jg">日期区间:</strong>选择趋势的时间范围。请注意，google 趋势数据是基于位置和时间进行标准化的。因此，不同的时间范围会产生不同的结果。</li><li id="f7d8" class="lg lh jf ke b kf lp kj lq kn lr kr ls kv lt kz ll lm ln lo bi translated"><strong class="ke jg">类别:</strong>表示您更喜欢搜索关键字的类别。</li><li id="5932" class="lg lh jf ke b kf lp kj lq kn lr kr ls kv lt kz ll lm ln lo bi translated"><strong class="ke jg">搜索类型:</strong>选择搜索源，即谷歌搜索、图片搜索、新闻搜索、谷歌购物和 YouTube 搜索。</li></ul><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lu"><img src="../Images/9d12643d335e0b63c0a1a93cc6f28214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hulsImkDMUJP-UuKNMNoYA.png"/></div></div></figure><p id="3335" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">挑战:</strong></p><p id="ecc8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">大规模收集谷歌趋势数据面临两大挑战。</p><p id="7147" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg"> <em class="la"> 1。单个关键字手动拉动是费时的。</em> </strong></p><p id="4d53" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">虽然 Google Trends 提供了“比较”功能来比较关键词，但缺点是它根据输入的最流行的术语将结果从 0 到 100 进行缩放。不太受欢迎的关键字会很快失去敏感性，如果你把它与一个受欢迎的。比如你拿“耐克”品牌和“至尊”品牌对比，基本上会得到一条“至尊”的平线。在这种情况下，当报告“最高”搜索增长趋势时，你会犯很大的错误。因此，建议分别单独拉动“耐克”趋势和“至尊”趋势。</p><p id="07ed" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">直到你有太多的关键词需要提取，你还是有时间的。例如，当比较 50 个服装和鞋类品牌时，您需要下载 50 个 excels 并将它们组合在一起。</p><p id="e342" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">②<em class="la">。当前可用的自动化 python 方法不查询精确的关键字，这意味着它们不准确。</em> </strong></p><p id="5a04" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用 python 有许多可用的<a class="ae lv" rel="noopener" target="_blank" href="/google-trends-api-for-python-a84bc25db88f">方法</a>来获取谷歌趋势数据。然而，他们都没有建立自动代码，可以把<strong class="ke jg">精确的</strong> <strong class="ke jg">关键词</strong>。单词通常有多种含义，这并不罕见。例如，“巴塔哥尼亚”可以是一家服装公司，也可以是南美的一个地区。简单地搜索“巴塔哥尼亚”会给我们含糊不清的结果，因为它包含两个搜索词。我们需要确保搜索到正确的关键词。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/55788c61b7cab1efa88dc85a0eff0909.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*txTrQ1kaz-dg7kqCXZw52g.png"/></div></figure><p id="cf67" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">目标:</strong></p><p id="9b08" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们的目标是提供一个解决方案，精确地、单独地、自动地提取多个关键字的 google 趋势数据。</p><p id="b8af" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">具体来说，我们将提取三个国家(美国、英国、德国)的六个服装/鞋类品牌(耐克、阿迪达斯、安德玛、Zara、H&amp;M、路易威登)的谷歌趋势数据。使用 Python，有四个步骤可以实现这一点:</p><ul class=""><li id="fb92" class="lg lh jf ke b kf kg kj kk kn li kr lj kv lk kz ll lm ln lo bi translated">第一步:安装<code class="fe lx ly lz ma b">pytrends</code> API</li><li id="94f6" class="lg lh jf ke b kf lp kj lq kn lr kr ls kv lt kz ll lm ln lo bi translated">第二步:获取准确的关键词</li><li id="ed27" class="lg lh jf ke b kf lp kj lq kn lr kr ls kv lt kz ll lm ln lo bi translated">第三步:按照国家的关键词提取谷歌趋势数据</li><li id="1ec7" class="lg lh jf ke b kf lp kj lq kn lr kr ls kv lt kz ll lm ln lo bi translated">第四步:可视化谷歌趋势</li></ul><figure class="lc ld le lf gt is gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/0b8dc51c3910819a8ed50441b2793392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*X7g-nSdxwH8MMYTYBbvA3g.png"/></div></figure><h1 id="b38a" class="mc md jf bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">步骤 1:安装 pytrends API</h1><p id="f7cc" class="pw-post-body-paragraph kc kd jf ke b kf na kh ki kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz ij bi translated">首先，我们需要安装名为“pytrends”的软件包，该软件包旨在使用 python 拉取 google trends。只需从您的终端执行以下代码。你可以在这里找到 pytrends API <a class="ae lv" href="https://pypi.org/project/pytrends/" rel="noopener ugc nofollow" target="_blank">的完整文档。</a></p><pre class="lc ld le lf gt nf ma ng nh aw ni bi"><span id="dd6a" class="nj md jf ma b gy nk nl l nm nn">pip install pytrends</span></pre><p id="233b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后我们将导入必要的包。</p><pre class="lc ld le lf gt nf ma ng nh aw ni bi"><span id="4418" class="nj md jf ma b gy nk nl l nm nn">import pandas as pd<br/>import pytrends<br/>from pytrends.request import TrendReq<br/>pytrend = TrendReq()</span></pre><h1 id="f57f" class="mc md jf bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">第二步:获取准确的关键词</h1><p id="6d46" class="pw-post-body-paragraph kc kd jf ke b kf na kh ki kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz ij bi translated">如前所述，我们需要精确的关键词以避免歧义。Pytrends 提供了一个名为<code class="fe lx ly lz ma b">pytrend.suggestions</code>的函数，可以为一个关键字返回几个建议。通常，第一个建议是最受欢迎的。“mid”列包含我们想要搜索的确切关键字。</p><pre class="lc ld le lf gt nf ma ng nh aw ni bi"><span id="fc78" class="nj md jf ma b gy nk nl l nm nn">KEYWORDS=['Nike','Adidas','Under Armour','Zara','H&amp;M','Louis Vuitton'] <br/>KEYWORDS_CODES=[pytrend.suggestions(keyword=i)[0] for i in KEYWORDS] <br/>df_CODES= pd.DataFrame(KEYWORDS_CODES)<br/>df_CODES</span></pre><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi no"><img src="../Images/864a68e08fac09838ed0ab5f629521f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXXYPin3bCPRdiFXLGXdiA.png"/></div></div></figure><h1 id="8bb7" class="mc md jf bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">第三步:通过关键词获取谷歌趋势数据</h1><p id="c227" class="pw-post-body-paragraph kc kd jf ke b kf na kh ki kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz ij bi translated">接下来，我们将设置这 5 个参数。</p><pre class="lc ld le lf gt nf ma ng nh aw ni bi"><span id="e458" class="nj md jf ma b gy nk nl l nm nn">EXACT_KEYWORDS=df_CODES['mid'].to_list()<br/>DATE_INTERVAL='2020-01-01 2020-05-01'<br/>COUNTRY=["US","GB","DE"] #Use <a class="ae lv" href="https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes" rel="noopener ugc nofollow" target="_blank">this link</a> for iso country code<br/>CATEGORY=0 # Use <a class="ae lv" href="https://github.com/pat310/google-trends-api/wiki/Google-Trends-Categories" rel="noopener ugc nofollow" target="_blank">this link</a> to select categories<br/>SEARCH_TYPE='' #default is 'web searches',others include 'images','news','youtube','froogle' (google shopping)</span></pre><p id="3122" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后，我们将编写代码，使用上述参数通过国家的精确关键字提取 google trends 数据。</p><pre class="lc ld le lf gt nf ma ng nh aw ni bi"><span id="49ed" class="nj md jf ma b gy nk nl l nm nn">Individual_EXACT_KEYWORD = list(zip(*[iter(EXACT_KEYWORDS)]*1))<br/>Individual_EXACT_KEYWORD = [list(x) for x in Individual_EXACT_KEYWORD]<br/>dicti = {}<br/>i = 1<br/>for Country in COUNTRY:<br/>    for keyword in Individual_EXACT_KEYWORD:<br/>        pytrend.build_payload(kw_list=keyword, <br/>                              timeframe = DATE_INTERVAL, <br/>                              geo = Country, <br/>                              cat=CATEGORY,<br/>                              gprop=SEARCH_TYPE) <br/>        dicti[i] = pytrend.interest_over_time()<br/>        i+=1<br/>df_trends = pd.concat(dicti, axis=1)</span></pre><p id="1bac" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们会做一些清理工作，将这些关键词改回易读的品牌名称。</p><pre class="lc ld le lf gt nf ma ng nh aw ni bi"><span id="8cac" class="nj md jf ma b gy nk nl l nm nn">df_trends.columns = df_trends.columns.droplevel(0) #drop outside header<br/>df_trends = df_trends.drop('isPartial', axis = 1) #drop "isPartial"<br/>df_trends.reset_index(level=0,inplace=True) #reset_index<br/>df_trends.columns=['date','Nike-US','Adidas-US','Under Armour-US','Zara-US','H&amp;M-US','Louis Vuitton-US','Nike-UK','Adidas-UK','Under Armour-UK','Zara-UK','H&amp;M-UK','Louis Vuitton-UK',<br/>'Nike-Germany','Adidas-Germany','Under Armour-Germany','Zara-Germany','H&amp;M-Germany','Louis Vuitton-Germany'] #change column names</span></pre><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/c34e178028be38db5ddd6d07dddb293c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KgLuxH1YcWigJpYtNSqw5g.png"/></div></div></figure><h1 id="b63a" class="mc md jf bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">第四步:可视化谷歌趋势</h1><p id="c749" class="pw-post-body-paragraph kc kd jf ke b kf na kh ki kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz ij bi translated">一眨眼的功夫，我们就得到了谷歌趋势数据。最后，让我们可视化路易威登跨国家的谷歌趋势。正如我们所见，路易威登显然受到了新冠肺炎的沉重打击，就像许多其他品牌和行业一样。</p><pre class="lc ld le lf gt nf ma ng nh aw ni bi"><span id="80d6" class="nj md jf ma b gy nk nl l nm nn">import seaborn as sns<br/>sns.set(color_codes=True)<br/>dx = df_trends.plot(figsize = (12,8),x="date", y=['Louis Vuitton-US','Louis Vuitton-UK','Louis Vuitton-Germany'], kind="line", title = "Louis Vuitton Google Trends")<br/>dx.set_xlabel('Date')<br/>dx.set_ylabel('Trends Index')<br/>dx.tick_params(axis='both', which='both', labelsize=10)</span></pre><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nq"><img src="../Images/44499fd61a56bbc54a22060cfbf521ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_1ZeED5bOmPNolKA3fIwBw.png"/></div></div></figure><h2 id="2f97" class="nj md jf bd me nr ns dn mi nt nu dp mm kn nv nw mq kr nx ny mu kv nz oa my ob bi translated">摘要</h2><p id="4f0f" class="pw-post-body-paragraph kc kd jf ke b kf na kh ki kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz ij bi translated">随着各公司密切关注新冠肺炎期间消费者行为的变化，谷歌趋势工具的使用出现激增。为了帮助实现这一点，我们构建了一个轻量级应用程序来精确、自动地提取 Google 趋势数据。</p><p id="df22" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后，保持积极，感谢阅读！</p></div></div>    
</body>
</html>