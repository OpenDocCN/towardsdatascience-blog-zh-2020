<html>
<head>
<title>Predicting Used Car Prices with Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用机器学习预测二手车价格</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-used-car-prices-with-machine-learning-fea53811b1ab?source=collection_archive---------12-----------------------#2020-01-28">https://towardsdatascience.com/predicting-used-car-prices-with-machine-learning-fea53811b1ab?source=collection_archive---------12-----------------------#2020-01-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0bb3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从数据收集到模型评估的完整数据科学项目</h2></div><p id="5b04" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我打算卖掉我的车，那是一辆4年前的大众polo。二手车通常在土耳其一个名为“<a class="ae le" href="https://www.sahibinden.com/kategori/vasita" rel="noopener ugc nofollow" target="_blank"> sahibinden </a>”的网站上出售。“Sahibinden”的意思是“来自车主”，尽管有许多经销商使用这个网站来出售或购买二手车。卖二手车最关键的部分是确定最优价格。有许多网站给你二手车的价格，但你仍然想在定价前搜索市场。此外，还有其他影响价格的因素，如位置、你想以多快的速度卖车、车内吸烟等。在你在网站上发布广告之前，最好先看看类似汽车的价格。然而，这个过程可能会很累，因为网上有太多的广告。因此，我决定利用机器学习提供的便利来创建一个模型，根据“<a class="ae le" href="https://www.sahibinden.com/kategori/vasita" rel="noopener ugc nofollow" target="_blank"> sahibinden </a>”上的数据预测二手车价格。它不仅有助于解决我的汽车定价问题，还能帮助我学习和实践许多与数据科学相关的主题。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="1373" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本项目分为以下5个子部分:</p><ol class=""><li id="199f" class="lm ln it kk b kl km ko kp kr lo kv lp kz lq ld lr ls lt lu bi translated">数据收集</li><li id="4c00" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld lr ls lt lu bi translated">数据清理</li><li id="d9f4" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld lr ls lt lu bi translated">探索性数据分析</li><li id="bc6c" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld lr ls lt lu bi translated">回归模型与评估</li><li id="6c47" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld lr ls lt lu bi translated">进一步改进</li></ol><p id="bf0b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有的数据和代码都可以在<a class="ae le" href="https://github.com/SonerYldrm/Predicting_used_car_prices" rel="noopener ugc nofollow" target="_blank"> github知识库</a>上获得。请随意使用或分发。</p><h1 id="49b2" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated"><strong class="ak"> 1。数据收集</strong></h1><p id="a07b" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">在“<a class="ae le" href="https://www.sahibinden.com/volkswagen-polo" rel="noopener ugc nofollow" target="_blank"> sahibinden </a>”网站上有六千多件大众马球出售。我不得不做网络搜集，从网站上收集数据。我不是网络搜集专家，但我已经学到了足够的知识来获取我需要的信息。我认为，如果你想在数据科学领域工作或正在工作，学习一定水平的网络抓取是非常重要的，因为数据通常不会放在盘子里提供给我们。我们必须得到我们需要的。</p><p id="5bcc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我使用了<a class="ae le" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank"> beautiful soup </a>，这是一个python库，用于从HTML和XML文件中提取数据。语法非常简单，易于学习。有几个重要的细节你需要注意，特别是如果数据被列在几页上。</p><p id="fed6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">总是先导入依赖项:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="1612" class="ng mb it nc b gy nh ni l nj nk">import pandas as pd<br/>import numpy as np<br/>import requests<br/>from bs4 import BeautifulSoup as bs</span></pre><p id="4154" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我使用python的<strong class="kk iu">请求</strong>库的<strong class="kk iu"> get() </strong>方法从源中检索数据，并将其存储在一个变量中。然后我用美汤提取整理了这个变量的内容。由于数据在几个页面上，我不得不创建list来帮助解析不同的页面，并启动空列表来保存数据。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="b4d7" class="ng mb it nc b gy nh ni l nj nk">#initiate empty lists to save data<br/>model_info = []<br/>ad_title = []<br/>year_km_color = []<br/>price = []<br/>ad_date = []<br/>location = []</span><span id="d018" class="ng mb it nc b gy nl ni l nj nk">#create lists to parse through pages<br/>page_offset = list(np.arange(0,1000,50))<br/>min_km = [0, 50000, 85000, 119000, 153000, 190000, 230000] <br/>max_km = [50000, 85000, 119000, 153000, 190000, 230000, 500000] </span></pre><p id="cdaf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个页面上最多可以显示50个广告。为了搜集大约6000辆汽车的数据，我需要迭代120多页。首先，我将代码组织在一个for循环中，从120页中提取数据。然而，在这个过程完成后，我发现数据在前1000个条目后重复。然后，我决定将数据分成更小的部分，每组不超过1000个条目，所以我使用“km”标准来区分组。我创建了嵌套的for循环来提取大约六千辆汽车的数据，如下所示:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="b7ab" class="ng mb it nc b gy nh ni l nj nk">for i, j in zip(min_km, max_km):<br/>    for page in page_offset:<br/>        r = requests.get(f'https://www.sahibinden.com/volkswagen-   polo?pagingOffset=<strong class="nc iu">{page}</strong>&amp;pagingSize=50&amp;a4_<strong class="nc iu">max={j}</strong>&amp;sorting=date_asc&amp;a4_<strong class="nc iu">min={i}</strong>', headers=headers)<br/>        soup = bs(r.content,'lxml')<br/>        model_info += soup.find_all("td",{"class":"searchResultsTagAttributeValue"})<br/>        ad_title += soup.find_all("td",{"class":"searchResultsTitleValue"})<br/>        year_km_color += soup.find_all("td",{"class":"searchResultsAttributeValue"})<br/>        price += soup.find_all("td",{"class":"searchResultsPriceValue"})<br/>        ad_date += soup.find_all("td",{"class":"searchResultsDateValue"})<br/>        location += soup.find_all("td",{"class":"searchResultsLocationValue"})</span></pre><p id="1621" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在每次迭代中，使用page_offset、max_km和min_km列表中的值修改基本url，以转到下一页。然后根据标签和类别将网站内容分解成预定义的列表。html中的类和标签可以通过在浏览器上检查网站来显示。</p><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/aa61a945eaf1bf19307954188c0a8364.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*kfUfnXXVfUZSjyKF_0iCDQ.png"/></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">“<a class="ae le" href="https://www.sahibinden.com/volkswagen-polo" rel="noopener ugc nofollow" target="_blank">沙希宾登</a>”网站的HTML</p></figure><p id="985b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">得到html的内容后，我提取了文本部分:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="a6b5" class="ng mb it nc b gy nh ni l nj nk">model_info_text = []<br/>for i in range(0,6731):<br/>    model_info_text.append(model_info[i].text)</span></pre><p id="9f9b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对每个列表都进行了这一过程，然后我将这些列表组合起来构建一个熊猫数据框架:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="cd93" class="ng mb it nc b gy nh ni l nj nk">df = pd.DataFrame({"model":model_info_text, "ad_title":ad_title_text,"year":year_text, "km":km_text, "color":color_text,"price":price_text, "ad_date":ad_date_text, "location":location_text})</span><span id="a70d" class="ng mb it nc b gy nl ni l nj nk">print(df.shape)<br/>print(df['ad_title'].nunique())<br/>(6731, 8)<br/>6293</span></pre><p id="9287" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Dataframe包括6731个条目，但根据广告的标题，其中6293个条目似乎是唯一的，我认为这是区分广告的最佳选择。一些用户可能会重新发布相同的广告，或者一些广告的标题可能完全相同。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="e287" class="ma mb it bd mc md nu mf mg mh nv mj mk jz nw ka mm kc nx kd mo kf ny kg mq mr bi translated">2.数据清理</h1><p id="8b34" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">我把从网站上抓取的数据保存为csv文件。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="a57e" class="ng mb it nc b gy nh ni l nj nk">df = pd.read_csv('polo_data.csv')<br/>df.head()</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi nz"><img src="../Images/cc7958215d16779b36dc73dded8e182b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2PYNrJoisGBmjbd7P3v2RQ.png"/></div></div></figure><p id="410b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">必须删除新的线条指示器(\n)。我使用pandas <strong class="kk iu"> remove() </strong>函数，其中<strong class="kk iu"> regex </strong>参数设置为True。类似地，在价格单元中代表土耳其货币的TL必须被移除以进行数值分析。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="d7ee" class="ng mb it nc b gy nh ni l nj nk">df = df.replace('\n','',regex=True)<br/>df.price = df.price.replace('TL','',regex=True)</span></pre><p id="3808" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在尝试进行任何分析之前，我们总是需要寻找缺失值并检查数据类型:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="f732" class="ng mb it nc b gy nh ni l nj nk">df.isna().any()<br/>model       False<br/>ad_title    False<br/>year        False<br/>km          False<br/>color       False<br/>price       False<br/>ad_date     False<br/>location    False<br/>dtype: bool</span><span id="7cdf" class="ng mb it nc b gy nl ni l nj nk">df.dtypes<br/>model        object<br/>ad_title     object<br/>year          int64<br/>km          float64<br/>color        object<br/>price        object<br/>ad_date      object<br/>location     object<br/>dtype: object</span></pre><p id="e0ba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">日期的数据类型是object。为了能够正确使用日期，我将数据dype转换为日期时间<strong class="kk iu"/>。数据是土耳其语的，所以在使用<strong class="kk iu"> astpye() </strong>函数之前，我将月份的名称改为了英语。我用字典来改变月份的名称。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="bd69" class="ng mb it nc b gy nh ni l nj nk">months = {"Ocak":"January", "Şubat":"February", "Mart":"March", "Nisan":"April","Mayıs":"May","Haziran":"June","Temmuz":"July","Ağustos":"August","Eylül":"September", "Ekim":"October", "Kasım":"November", "Aralık":"December"}</span><span id="74d1" class="ng mb it nc b gy nl ni l nj nk">df.ad_date = df.ad_date.replace(months, regex=True)</span><span id="218e" class="ng mb it nc b gy nl ni l nj nk">#change the datatype<br/>df.ad_date = pd.to_datetime(df.ad_date)</span></pre><p id="d800" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在读取csv文件时,“km”列被截断，该列显示汽车已经行驶了多少公里。这是因为“点”在千中使用。例如，25.000，即25，000被检测为25.0。为了解决这个问题，我将“km”列乘以1000。为了能够将“km”列的数据类型改为数字(int或float)，我还删除了“.”和“，”字符。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="3e1c" class="ng mb it nc b gy nh ni l nj nk">df.km = df.km * 1000</span><span id="6fac" class="ng mb it nc b gy nl ni l nj nk">df.iloc[:,5] = df.iloc[:,5].str.replace(r'.','')<br/>df.iloc[:,5] = df.iloc[:,5].str.replace(r',','') </span><span id="3eb0" class="ng mb it nc b gy nl ni l nj nk">#change the datatype<br/>df.price = df.price.astype('float64')</span></pre><p id="e50f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在土耳其，由于人口分布不均，位置可能是决定二手车价格的一个因素。我们的数据框架中的位置数据包括城市和地区。我不认为同一个城市不同区的价格变化。因此，我修改了位置数据，只包含了城市的名称。</p><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/cb952f42821c866fb2d9e0f0d941285d.png" data-original-src="https://miro.medium.com/v2/resize:fit:258/format:webp/1*QLIOqxkHjRaXGhIPew8KIg.png"/></div></figure><p id="16e3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">位置信息的格式为CityDistrict(中间没有空格)。地区名称以大写字母开头，用于区分城市和地区。我用的是python的<strong class="kk iu"> re </strong>模块的<strong class="kk iu"> sub() </strong>函数。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="1792" class="ng mb it nc b gy nh ni l nj nk">import re</span><span id="ec96" class="ng mb it nc b gy nl ni l nj nk">s = df['location']<br/>city_district = []</span><span id="13d9" class="ng mb it nc b gy nl ni l nj nk">for i in range(0,6731):<br/>    city_district.append(re.sub( r"([A-Z, 'Ç', 'İ', 'Ö', 'Ş', 'Ü'])", r" \1", s[i]).split())</span><span id="2b36" class="ng mb it nc b gy nl ni l nj nk">city_district[:5]<br/>[['Ağrı', 'Merkez'],<br/> ['İstanbul', 'Kağıthane'],<br/> ['Ankara', 'Altındağ'],<br/> ['Ankara', 'Çankaya'],<br/> ['Samsun', 'Atakum']]</span></pre><p id="dfae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个for循环以大写字母拆分location列的每个单元格中的字符串。土耳其语字母表包含不在英语字母表[A-Z]范围内的字母。我也在sub函数中添加了这些字母。输出是两项列表的列表。我使用这个列表的第一项创建了另一个名为“city”的列。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="e0d2" class="ng mb it nc b gy nh ni l nj nk">city = []<br/>for i in range(0,6731):<br/>    city.append(city_district[i][0])</span><span id="ca95" class="ng mb it nc b gy nl ni l nj nk">city[:5]<br/>['Ağrı', 'İstanbul', 'Ankara', 'Ankara', 'Samsun']</span><span id="f178" class="ng mb it nc b gy nl ni l nj nk">df['city'] = city</span></pre><p id="d887" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> nunique() </strong>函数计算对探索性数据分析和结果确认都有用的唯一值。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="5404" class="ng mb it nc b gy nh ni l nj nk">df.city.nunique()<br/>81</span></pre><p id="6b67" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">土耳其有81个城市，因此数据集包括每个城市至少一辆汽车。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="c651" class="ma mb it bd mc md nu mf mg mh nv mj mk jz nw ka mm kc nx kd mo kf ny kg mq mr bi translated"><strong class="ak"> 3。探索性数据分析</strong></h1><p id="9cbc" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated"><strong class="kk iu">价格</strong></p><p id="2fc0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">了解目标变量总是好的。在我们的例子中，目标变量或因变量是价格。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="792d" class="ng mb it nc b gy nh ni l nj nk">print(df.price.mean())<br/>print(df.price.median())<br/>83153.7379289853<br/>64250.0</span></pre><p id="89b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">平均值远高于中值，这表明存在异常值或极值。让我们同时检查最大值和最小值:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="fe26" class="ng mb it nc b gy nh ni l nj nk">print(df.price.max())<br/>print(df.price.min())<br/>111111111.0<br/>24.0</span></pre><p id="c321" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这种价值观显然是错误的。除非镀金，否则没有超过1亿英镑的大众马球。同样，24土耳其里拉的价值也是不可能的。在使用<strong class="kk iu"> sort_values() </strong>函数对price列中的值进行排序之后，我检测到了一些异常值，并使用pandas <strong class="kk iu"> drop() </strong>函数通过传递要删除的值的索引来删除它们。让我们检查新的平均值和中间值:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="f9de" class="ng mb it nc b gy nh ni l nj nk">print(df.price.mean())<br/>print(df.price.median())<br/>print(df.price.median())</span><span id="2b0c" class="ng mb it nc b gy nl ni l nj nk">66694.66636931311<br/>64275.0<br/>25000.0</span></pre><p id="75e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">平均值仍高于中值，但差异并不极端。我还检查了mode，这是最常出现的值。平均值高于中值表明数据是正确的或正偏态的，这意味着我们有更多的较低价格和一些具有较高值的异常值。被排序为均值&gt;中值&gt;众数的集中趋势度量是正(右)偏度的指示。我们可以用分布图仔细检查:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="30ef" class="ng mb it nc b gy nh ni l nj nk">x = df.price<br/>plt.figure(figsize=(10,6))<br/>sns.distplot(x).set_title('Frequency Distribution Plot of Prices')</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/56922cc9502d59a953b0a3fd0acf08f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*Qd8344IRf62N_Eb36Luhog.png"/></div></figure><p id="600d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从图中可以看出，数据是右偏的，25000左右的峰值向我们展示了该模式。检查分布和异常值的另一种方法是<strong class="kk iu">箱线图</strong>:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="86c7" class="ng mb it nc b gy nh ni l nj nk">plt.figure(figsize=(8,5))<br/>sns.boxplot(y='price', data=df, width=0.5)</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/3ceaa6d4c35374ac2a4cb66e40bf31f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*6IWjI6UuCBnqZbj58_GrNw.png"/></div></figure><p id="24c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">蓝框的底部和顶部分别代表第一个四分位数(25%)和第三个四分位数(75%)。第一个四分位数意味着25%的数据点低于该点。中间的线是中位数(50%)。异常值用最大线上方的点表示。</p><p id="dafc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">日期</strong></p><p id="d583" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我不认为日期本身对价格有影响，但网站上广告的等待时间是一个需要考虑的因素。更长的等待时间可能会促使业主降价。如果一个广告在网站上停留了很长时间，这可能是因为价格设置不当。因此，我将添加一个列，表明广告已经在网站上的天数。数据于2020年1月18日报废。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="fd02" class="ng mb it nc b gy nh ni l nj nk">df['ad_duration'] = pd.to_datetime('2020-01-18') - df['ad_date']</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/c966ea0adad88f46d9c9cf47492c1225.png" data-original-src="https://miro.medium.com/v2/resize:fit:196/format:webp/1*oGz9caGu2_eIjcWo98Rkng.png"/></div></figure><p id="efd3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Ad_duration必须是数字数据，因此需要删除数字旁边的“天数”。我用熊猫<strong class="kk iu"> replace() </strong>函数去掉了‘天’。</p><p id="d088" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们检查广告持续时间数据的分布:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="8363" class="ng mb it nc b gy nh ni l nj nk">print(df.ad_duration.mean())<br/>print(df.ad_duration.median())<br/>12.641540291406482<br/>10.0</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/185a4d86905f20113b79175148adb0ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*x72rkl3vL21Ith7_w7J0yg.png"/></div></figure><p id="24cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">平均值高于中值，有许多异常值。数据是右偏的。为了更好地理解，我还绘制了小于50的数据点:</p><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/3a9d77786a1a28bf8817708194b4a9b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*48b7W54zN9ggAG4zYv-lRg.png"/></div></figure><p id="f327" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">地点</strong></p><p id="1f93" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有81个不同的城市，但62%的广告都列在前10个城市，伊斯坦布尔占23%的广告。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="2f92" class="ng mb it nc b gy nh ni l nj nk">a = df.city.value_counts()[:10]<br/>df_location = pd.DataFrame({"city": a , "share": a/6726})</span><span id="bca9" class="ng mb it nc b gy nl ni l nj nk">df_location.share.sum()<br/>0.6216176033303599</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/2171caf2e8cba8c988e57dd074d0f34b.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*OJzpO3_XgrxyikL72uoRlw.png"/></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">广告数量排名前十的城市</p></figure><p id="eb7c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">颜色</strong></p><p id="bc42" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看起来大众polo的最佳颜色选择是白色。一半以上的汽车是白色的，其次是红色和黑色。前三种颜色覆盖了72%的汽车。</p><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/383753231af5a35a6af6020b8b612db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*udopj3ratgrwUS_hdcQ5sA.png"/></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">贝亚兹:白色，科勒姆兹:红色，西亚赫:黑色</p></figure><p id="01f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">年</strong></p><p id="4950" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">车龄肯定会影响价格。然而，用is代替汽车的型号年份更有意义。所以我用当年的“年份”一栏来代替。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="6f40" class="ng mb it nc b gy nh ni l nj nk">df['age'] = 2020 - df['year']</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/f1f54cf8b25c906ba80142be0d44c6ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*6amVt8YFqFxCVy7u3BBmBQ.png"/></div></figure><p id="3969" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从分布来看，大部分车龄不到10年。在10处有一个巨大的下降，然后是一个上升的趋势。</p><p id="eced" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">公里</strong></p><p id="9190" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">公里值显示了车开了多少，所以它绝对是决定价格的一个重要因素。Km数据近似呈正态分布。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="0048" class="ng mb it nc b gy nh ni l nj nk">print(df.km.mean())<br/>print(df.km.median())<br/>141011.5676479334<br/>137000.0</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/b65f262ecdc6bfdda05b4197f98743b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*kwUkzQbQJXbiwlyMQGOCLg.png"/></div></figure><p id="cc9a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">广告标题</strong></p><p id="882e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">广告标题是广告的一种说明。卖家试图用数量有限的人物来吸引潜在买家。一旦广告被点击，另一个带有图片和更详细信息的页面就会打开。然而，第一步是让人们点击你的广告，所以广告标题在销售过程中起着至关重要的作用。</p><p id="41c5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们来看看大家一般都在标题里写些什么。我在这个任务中使用了<strong class="kk iu"> wordcloud </strong>。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="c5b9" class="ng mb it nc b gy nh ni l nj nk">#import dependencies<br/>from wordcloud import WordCloud, STOPWORDS</span></pre><p id="c8cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">WordCloud唯一需要的参数是一个文本。您可以通过键入“？其他可选参数。我们无法将列表输入到wordcloud，所以我通过连接ad_title列中的所有标题创建了一个文本:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="9ad8" class="ng mb it nc b gy nh ni l nj nk">text_list = list(df.ad_title)<br/>text = '-'.join(text_list)</span></pre><p id="fec0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后用这段文字生成了一个单词云:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="6e4e" class="ng mb it nc b gy nh ni l nj nk">#generate wordcloud<br/>wordcloud = WordCloud(background_color='white').generate(text)</span><span id="6e46" class="ng mb it nc b gy nl ni l nj nk">#plot wordcloud<br/>plt.figure(figsize=(10,6))<br/>plt.imshow(wordcloud, interpolation='bilinear')<br/>plt.axis("off")<br/>plt.show()</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/19d7b85d909566b4cd420a8c3aa4f6f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*mOZ9hx9feQaD9bG-ZayJvg.png"/></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">无停用词的词云</p></figure><p id="e85b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">单词云的想法非常简单。越频繁出现的单词显示得越大。这是一个信息量大、易于理解的文本分析工具。然而，上面的wordcloud并没有告诉我们太多，因为“大众”、“大众”和“polo”这些词并不是我们要找的。它们展示了我们正在分析的品牌。在这种情况下，我们要使用wordcloud的<strong class="kk iu">停用词</strong>参数，列出需要排除的词。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="2373" class="ng mb it nc b gy nh ni l nj nk">stopwords = ['VW', 'VOLKSWAGEN', 'POLO', 'MODEL', 'KM']<br/>wordcloud = WordCloud(stopwords=stopwords).generate(text)</span><span id="734f" class="ng mb it nc b gy nl ni l nj nk">plt.figure(figsize=(10,6))<br/>plt.imshow(wordcloud, interpolation='bilinear')<br/>plt.axis("off")<br/>plt.show()</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/8a8d87f86d443a4ef1e7805cc8171f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*lPkfj-aWchniOE0pu905yg.png"/></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">带停用词的单词云</p></figure><p id="ab2e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这次我没有使用<strong class="kk iu">背景颜色</strong>参数，只是为了显示不同之处。这些话是土耳其语，所以我会给一个简短的解释:</p><ol class=""><li id="8698" class="lm ln it kk b kl km ko kp kr lo kv lp kz lq ld lr ls lt lu bi translated">“Hatası”:没有任何问题</li><li id="ccf6" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld lr ls lt lu bi translated">“Sahibinden”:从所有者(这很重要，因为人们倾向于从所有者而不是经销商那里购买)。</li><li id="32d6" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld lr ls lt lu bi translated">“Otomatik”:自动变速器</li><li id="dc74" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld lr ls lt lu bi translated">“Boyası”:无油漆(由于裂纹、划痕或维修，汽车的任何部分都没有油漆)</li></ol><p id="0054" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其他的话主要是关于干净，没有任何以前的维修。</p><p id="3bde" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">型号</strong></p><p id="86af" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">型号栏包括三种不同的信息:发动机尺寸、燃料类型和变型。检查完这些值后，我发现对于所有单元，只有引擎大小信息是完整的。大多数单元格都缺少燃料类型和变体，因此我为发动机大小创建了一个单独的列。</p><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/e8a5430dca06fba576aadf423428a6ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:282/format:webp/1*bcJ0FoOtBnXAtnEeM-uhzw.png"/></div></figure><p id="55d4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">空格后的前三个字符代表发动机尺寸。我首先删除了空格，并从model列中提取了前三个字符:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="9989" class="ng mb it nc b gy nh ni l nj nk">#remove spaces<br/>df.model = df.model.replace(' ','',regex=True)</span><span id="d66a" class="ng mb it nc b gy nl ni l nj nk">engine = [x[:3] for x in df.model]<br/>df['engine'] = engine</span></pre><p id="9f94" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看看不同发动机尺寸的价格变化:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="1770" class="ng mb it nc b gy nh ni l nj nk">df.engine.value_counts()<br/>1.4    3172<br/>1.6    1916<br/>1.2    1205<br/>1.0     409<br/>1.9      20<br/>1.3       4<br/>Name: engine, dtype: int64</span><span id="f4ca" class="ng mb it nc b gy nl ni l nj nk">df[['engine','price']].groupby(['engine']).mean().sort_values(by='price', ascending=False)</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/1f1e8940b27ba827c2f10ebe3b63e065.png" data-original-src="https://miro.medium.com/v2/resize:fit:342/format:webp/1*EEMKe7d6Ia_RVQmy2IitEQ.png"/></div></figure><p id="789a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">似乎平均价格随着发动机尺寸的增加而降低。1.3可以忽略，因为只有4辆车采用1.3发动机。与1.0和其他发动机尺寸有很大差距，因为1.0是较新的型号。正如你在下面的图表中看到的，发动机尺寸为1.0的汽车平均车龄和公里数都最低，这表明它们是较新的车型。</p><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/95ba4d617f69ef3682b15eec5ad38baa.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*hWhlOHWxbEg36eKfftw_eg.png"/></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">不同发动机尺寸的平均车龄和公里数</p></figure></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="dbc4" class="ma mb it bd mc md nu mf mg mh nv mj mk jz nw ka mm kc nx kd mo kf ny kg mq mr bi translated"><strong class="ak"> 4。回归模型</strong></h1><p id="dc04" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">线性回归是一种广泛使用的监督学习算法，用于预测连续的因变量(或目标变量)。根据独立变量的数量，它可以是简单或多元线性回归的形式。我创建了一个多元线性回归模型，因为我使用了许多自变量来预测因变量，即二手车的价格。</p><p id="aec6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们不应该只是使用所有的独立变量，而没有任何预处理或事先判断。<strong class="kk iu">特征选择</strong>是决定在模型中使用哪些特征(独立变量)的过程。特征选择是一个非常关键的步骤，因为使用不必要的特征会对性能产生负面影响，而删除重要的特征会妨碍我们获得高精度。</p><p id="a10b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用<strong class="kk iu">回归图</strong>来检查因变量和自变量之间的关系。我检查了km和价格之间的关系，我认为这是高度相关的。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="a12b" class="ng mb it nc b gy nh ni l nj nk">plt.figure(figsize=(10,6))<br/>sns.regplot(x='km', y='price', data=df).set_title('Km vs Price')</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi op"><img src="../Images/aa6745c530fea4eb1f3c098bff9b73bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*JqK0T8QJPHXMMX910x_qwQ.png"/></div></div></figure><p id="582e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">显而易见，随着公里数的增加，价格下降。然而，也有例外。根据上面的回归图，公里数高于400000的汽车可以标记为异常值。为了提高模型的准确性，我去除了这些异常值。离群值往往会使模型过度拟合。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="b00f" class="ng mb it nc b gy nh ni l nj nk">df = df[df.km &lt; 400000]<br/>plt.figure(figsize=(10,6))<br/>sns.regplot(x='km', y='price', data=df).set_title('Km vs Price')</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/fdcbddf8b9acd988c60d0aa66289ad60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*WWr6P6xjc6LDu6s10BAhmw.png"/></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">Km与剔除异常值后的价格</p></figure><p id="91fb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在好多了！</p><p id="53c1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在对年龄和价格应用相同的步骤后，观察到类似的关系:</p><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/565377b5fe2e26d7d49121ce3d7e3af9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*E_agZiyghF2W6G9j2tZ8cA.png"/></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">剔除异常值后的年龄与价格</p></figure><p id="9445" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还检查了广告时长和引擎大小与价格之间的关系。发动机尺寸越大，平均价格越低。然而，广告持续时间似乎对价格几乎没有影响。</p><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/276876b87a6df7e1fdd8b58d2bd19cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*87zHcsajLvzT6BZvGFgTJg.png"/></div></figure><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/325b6683f5a130ad246419de9ef6ee07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*Bfx6NUUMVYx8qMri6rX5LA.png"/></div></figure><p id="2a16" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">检查变量之间关系的另一种方法是<strong class="kk iu">相关矩阵</strong>。熊猫<strong class="kk iu"> corr() </strong>函数计算数值变量之间的相关性。</p><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/df2398b633e3c338c625806e8a439abc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*xGybtXGuF08VZEGRgDgd8g.png"/></div></figure><p id="a6de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该值越接近1，相关性越高。-'号表示负相关。这些值与上面的回归图一致。</p><p id="6dc4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以使用seaborn <strong class="kk iu">热图</strong>来可视化相关矩阵:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="4af8" class="ng mb it nc b gy nh ni l nj nk">corr = df.corr()<br/>plt.figure(figsize=(10,6))<br/>sns.heatmap(corr, vmax=1, square=True)</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/65ff7532997509bba0ad03b334b1b6e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*yWef5XqxG8T5ceIvtpl3kA.png"/></div></figure><p id="2ec7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据右边的颜色表，两个变量相交处的方框颜色显示相关值。</p><p id="854e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">线性回归模型</strong></p><p id="6a26" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在检查了变量的相关性和分布后，我决定用车龄、公里数、引擎大小和广告时长来预测一辆二手车的价格。</p><p id="0474" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我使用了<a class="ae le" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> scikit-learn </a>，它提供了简单有效的机器学习工具。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="b3b1" class="ng mb it nc b gy nh ni l nj nk">from sklearn.model_selection import train_test_split<br/>from sklearn.linear_model import LinearRegression<br/>from sklearn.metrics import r2_score</span></pre><p id="9bcc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我提取了要使用的特性(列):</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="dbad" class="ng mb it nc b gy nh ni l nj nk">X = df[['age','km','engine','ad_duration']] #independent variables<br/>y = df['price'] #dependent (target) variable</span></pre><p id="ff9a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后使用scikit-learn的<strong class="kk iu"> train_test_split </strong>函数，我将数据划分为训练和测试子集。分离训练集和测试集是每个机器学习算法中非常重要的一步。否则，如果我们在同一个数据集上训练和测试，我们将要求模型预测它已经知道的东西。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="d438" class="ng mb it nc b gy nh ni l nj nk">X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=42)</span></pre><p id="30f4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我创建了一个LinearRegression()对象，用训练数据集对它进行了训练。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="d697" class="ng mb it nc b gy nh ni l nj nk">linreg = LinearRegression()</span><span id="6f91" class="ng mb it nc b gy nl ni l nj nk">linreg.fit(X_train, y_train) </span></pre><p id="7269" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是时候衡量模型的准确性了。我在训练和测试数据集上测量了模型的准确性。如果训练数据集上的精度远远高于测试数据集上的精度，我们就有一个严重的问题:<strong class="kk iu">过拟合</strong>。我不会去详细了解过度拟合。这可能是另一个帖子的主题，但我只想简单解释一下。过度拟合意味着模型过于具体，不能很好地概括。过度拟合模型试图捕获训练数据集中的噪声和极值。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="0cfd" class="ng mb it nc b gy nh ni l nj nk">linreg.score(X_train, y_train)<br/>0.8351901442035045</span><span id="5a15" class="ng mb it nc b gy nl ni l nj nk">linreg.score(X_test, y_test)<br/>0.8394139260643358</span></pre><p id="9eed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">比分非常接近，这很好。这里的分数是<a class="ae le" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.r2_score.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> R平方</strong> </a>分数，它是确定实际数据点与拟合回归线有多接近的度量。R平方值越接近1，我们的模型就越准确。r平方度量了我们的模型解释了多少目标变量的变化。</p><p id="f90a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">残差图</strong>用于检查实际值和预测值之间的误差。如果一个线性模型是合适的，我们期望看到误差被随机传播并且具有零均值。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="bacb" class="ng mb it nc b gy nh ni l nj nk">plt.figure(figsize=(10,6))<br/>sns.residplot(x=y_pred, y=y_test)</span></pre><figure class="mx my mz na gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi ot"><img src="../Images/7ef049c82827c80ced741b2c620e6e06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*CZ3EiLICqvJRbo_7z_e4mA.png"/></div></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">实际值和预测值之间的误差</p></figure><p id="3e7a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些点的平均值可能接近于零，但显然它们不是随机分布的。该分布接近U形，这表明线性模型可能不是这项任务的最佳选择。</p><p id="f8e8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，我想使用scikit-learn的<strong class="kk iu"> RandomForestRegressor() </strong>来尝试另一个模型。随机森林是建立在<strong class="kk iu">决策树</strong>上的集成方法。威尔·科尔森的这篇文章对决策树和随机森林做了全面的解释。随机森林通常用于分类任务，但也适用于回归。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="c18c" class="ng mb it nc b gy nh ni l nj nk">from sklearn.ensemble import RandomForestRegressor</span><span id="a3dc" class="ng mb it nc b gy nl ni l nj nk">regr = RandomForestRegressor(max_depth=5, random_state=0, n_estimators=10)</span></pre><p id="c266" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与线性回归不同，随机森林有一些关键的超参数需要优化。<a class="ae le" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">max _ depth</strong></a><strong class="kk iu"/>是一棵树的最大深度(不言自明)，它控制着一棵树有多深或者你想要多少个分支。<a class="ae le" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> n_estimator </strong> </a>是一片森林中的树木数量。决策树容易过度拟合，这意味着你很容易使它过于具体。如果max_depth太高，可能会导致模型过拟合。我手动更改了max_depth，以便检查准确性和过度拟合。但是scikit-learn提供了非常好的超参数调优工具:<a class="ae le" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">RandomizedSearchCV</strong></a><strong class="kk iu">和</strong><a class="ae le" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">GridSearchCV</strong></a><strong class="kk iu">。对于更复杂的任务和模型，我强烈推荐使用它。</strong></p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="4fba" class="ng mb it nc b gy nh ni l nj nk">print('R-squared score (training): {:.3f}'<br/>     .format(regr.score(X_train, y_train)))<br/>R-squared score (training): 0.902</span><span id="f8e5" class="ng mb it nc b gy nl ni l nj nk">print('R-squared score (training): {:.3f}'<br/>     .format(regr.score(X_test, y_test)))<br/>R-squared score (training): 0.899</span></pre><p id="295f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">测试集上的r平方得分是0.899，这表明与线性回归相比有显著的改进。我还尝试将max_depth参数设置为20，结果是在overfit模型上，如下所示。模型在训练集上非常准确，但在测试集上的准确性变得较低。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="705a" class="ng mb it nc b gy nh ni l nj nk">regr = RandomForestRegressor(max_depth=20, random_state=0, n_estimators=10)</span><span id="149b" class="ng mb it nc b gy nl ni l nj nk">regr.fit(X_train, y_train)</span><span id="9f16" class="ng mb it nc b gy nl ni l nj nk">print('R-squared score (training): {:.3f}'<br/>     .format(regr.score(X_train, y_train)))<br/>R-squared score (training): 0.979</span><span id="357f" class="ng mb it nc b gy nl ni l nj nk">print('R-squared score (training): {:.3f}'<br/>     .format(regr.score(X_test, y_test)))<br/>R-squared score (training): 0.884</span></pre><p id="6027" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后我根据车型查了一下我车的价格:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="f296" class="ng mb it nc b gy nh ni l nj nk">regr.predict([[4,75000,1.2,1]])<br/>array([99743.84587199])</span></pre><p id="7137" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">模型建议我以差不多10万英镑的价格卖掉我的车，这比我心目中的价格要高。然而，我的车出了事故，经过修理，价格降低了。这些信息没有被作为独立变量考虑，这就把我们带到了本文的最后一部分:进一步改进。</p><h1 id="f92f" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">4.进一步改进</h1><p id="1469" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">有许多方法可以改进机器学习模型。我觉得最根本最有效的一条就是多收集数据。在我们的例子中，我们可以(1)收集更多汽车的数据，或者(2)收集当前数据集中更多汽车的信息，或者两者都收集。对于第一个，有其他网站出售二手车，所以我们可以通过添加新车来增加数据集的大小。对于第二个问题，我们可以从“<a class="ae le" href="https://www.sahibinden.com/volkswagen-polo?pagingSize=50" rel="noopener ugc nofollow" target="_blank"> sahibinden </a>”网站收集更多关于汽车的数据。如果我们点击一个广告，另一个有详细信息和图片的页面就会打开。在这一页，人们写下汽车的问题，以前的事故或维修等等。这种信息无疑是有价值的。</p><p id="dd39" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一种改进方法是调整模型超参数。我们可以使用<a class="ae le" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html" rel="noopener ugc nofollow" target="_blank"> RandomizedSearchCV </a>来找到最佳的超参数值。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="dd99" class="ma mb it bd mc md nu mf mg mh nv mj mk jz nw ka mm kc nx kd mo kf ny kg mq mr bi translated"><strong class="ak">结论</strong></h1><p id="50eb" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">我试图给你一个机器学习项目如何建立的概述。尽管这不是一项非常复杂的任务，但大多数数据科学项目都遵循类似的模式。</p><ul class=""><li id="3100" class="lm ln it kk b kl km ko kp kr lo kv lp kz lq ld ou ls lt lu bi translated">定义问题或疑问</li><li id="1126" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld ou ls lt lu bi translated">收集和清理数据</li><li id="8397" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld ou ls lt lu bi translated">进行探索性数据分析，以获得一些关于数据的见解</li><li id="fe35" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld ou ls lt lu bi translated">建立一个模型</li><li id="b990" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld ou ls lt lu bi translated">评估模型</li><li id="d025" class="lm ln it kk b kl lv ko lw kr lx kv ly kz lz ld ou ls lt lu bi translated">除非结果令人满意，否则请返回前面的任何步骤。</li></ul></div></div>    
</body>
</html>