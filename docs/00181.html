<html>
<head>
<title>ML Algorithm to Predict Stock Price</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测股票价格的ML算法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-algorithm-to-predict-nasdaq-composite-index-price-27b4e3e1339?source=collection_archive---------22-----------------------#2020-01-06">https://towardsdatascience.com/machine-learning-algorithm-to-predict-nasdaq-composite-index-price-27b4e3e1339?source=collection_archive---------22-----------------------#2020-01-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="d7c2" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">具有技术特征的回归分析</h2><div class=""/><div class=""><h2 id="794b" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">基础特征工程和监督ML</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi kr"><img src="../Images/85051a9e44d7de5a13dba6e105e1bb87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*89FAuZIpPlJLSbRaNonhOQ.png"/></div><p class="kz la gj gh gi lb lc bd b be z dk translated">作者图片</p></figure><p id="bca3" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><a class="ae lz" href="https://sarit-maitra.medium.com/membership" rel="noopener">https://sarit-maitra.medium.com/membership</a></p><p id="4cd9" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi ma translated"><span class="l mb mc md bm me mf mg mh mi di"> A </span> <strong class="lf jd">算法</strong>交易期望遵循规则，此外，它们可以形成客观、无偏见的风险估计，代表着金融艺术和理论的一场革命。</p><p id="80d8" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">在这里，我们将看到机器学习如何解决预测的难题，即预测今天的价格和明天的价格(未知)之间的差异。</p><p id="461f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">数据可以通过世界贸易数据提供的开放API加载。从ML的角度来看，金融时间序列问题是相当复杂的。我们需要更多地考虑金融数据结构，而不是像开盘价、最高价、最低价和收盘价这样的特定事件。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mj"><img src="../Images/803430fa1fc5a6acedc2e189e0a1b87e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nGmK6Jt2vYFyepDh-xcjwA.png"/></div></div></figure><pre class="ks kt ku kv gt mo mp mq mr aw ms bi"><span id="7747" class="mt mu it mp b gy mv mw l mx my"># Plot the Opening prices<br/>dataset['Open'].plot(grid=True, figsize=(10, 6))<br/>plt.title('Nasdaq Composite open price')<br/>plt.ylabel('price ($)')<br/># Show the plot<br/>plt.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mz"><img src="../Images/12a9dd5673855baea61fbecff69ff8d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kx9vsnyYvtxCLMH-LjDgkw.png"/></div></div></figure><p id="81aa" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们开始为分析准备数据。我将基于短窗口简单移动平均线创建一些特征。</p><ul class=""><li id="3f35" class="na nb it lf b lg lh lj lk lm nc lq nd lu ne ly nf ng nh ni bi translated">高/低百分比在市场中提供了一些百分比的波动性。</li><li id="46cf" class="na nb it lf b lg nj lj nk lm nl lq nm lu nn ly nf ng nh ni bi translated">百分比变化反映每日的百分比变化</li><li id="73c1" class="na nb it lf b lg nj lj nk lm nl lq nm lu nn ly nf ng nh ni bi translated">1天窗口开放价格。</li><li id="4a15" class="na nb it lf b lg nj lj nk lm nl lq nm lu nn ly nf ng nh ni bi translated">当前日体积增量。</li><li id="0b09" class="na nb it lf b lg nj lj nk lm nl lq nm lu nn ly nf ng nh ni bi translated">当日成交量变化率。</li><li id="f512" class="na nb it lf b lg nj lj nk lm nl lq nm lu nn ly nf ng nh ni bi translated">当日开盘价增量。</li><li id="41e4" class="na nb it lf b lg nj lj nk lm nl lq nm lu nn ly nf ng nh ni bi translated">公开价格。</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi no"><img src="../Images/cca482ef2fe50d103b4fb36ac251626f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LSq2ky1N7JxfQoq7h4l-mA.png"/></div></div></figure><p id="b163" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在，我们将相关属性保存在数据框中，这些属性在这里是预测变量。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi np"><img src="../Images/4ce0123b0a6328e5463ac0c672935a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yyZAsImhQQiuA6IZ9YepKQ.png"/></div></div></figure><p id="19e0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们没有丢弃所有的NaN值，而是用一些在数据集中被视为异常值的数字来代替NaN。我们将尝试梯度增强树，它通常对异常值很健壮。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nq"><img src="../Images/bc572909bb19a7e7cdbda651349498eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MuYMgpb1qy7slMdVTrqfZg.png"/></div></div></figure><p id="6ab8" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们定义我们的目标变量。我们将有一个分类变量，因为平均价格将在第二天上涨或下跌。因此，我们的目标是预测今天的价格和明天的价格之间的差异。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nr"><img src="../Images/48f6ee1b7e67ea36f92cb526fd3bcde2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BhXVh0WiQFXXdoUQ0c4Jsg.png"/></div></div></figure><p id="5e42" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">从下面的关联图中，我们可以看出，有些属性是相互关联的，可能不是模型所必需的。但是，我们将在稍后从梯度增强特征重要性图中识别这一点。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/f71d3ca85039a9ae0d29f45b9f78dc30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*ZL-jSMiIbpXMHIERTlh5XQ.png"/></div></figure><pre class="ks kt ku kv gt mo mp mq mr aw ms bi"><span id="a836" class="mt mu it mp b gy mv mw l mx my"># Checking Correlation for easy understanding<br/>sns.set(style='darkgrid', context='talk', palette='Dark2')<br/>plt.figure(figsize=(14,5))<br/>dataset.corr()['Open'].sort_values(ascending = False).plot(kind='bar')<br/>plt.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nt"><img src="../Images/d6fe2d8e9a8b7f7cc2d52c84202dd134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t7f55HKIVEWYNBsSu4P5KQ.png"/></div></div></figure><p id="1a72" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们的数据集总共有5158个样本和10个特征。我们使用了时序交叉验证器，它提供了训练/测试指数来分割以固定时间间隔观察的时序数据样本。在每次分割中，测试指数必须比以前高，因此在交叉验证器中进行洗牌是不合适的。</p><pre class="ks kt ku kv gt mo mp mq mr aw ms bi"><span id="bf7d" class="mt mu it mp b gy mv mw l mx my">print('Total dataset has {} samples, and {} features.'.format(dataset.shape[0], dataset.shape[1]))</span><span id="bb80" class="mt mu it mp b gy nu mw l mx my">X = (dataset.drop(['target'], 1))<br/>y = (dataset['target'])<br/>print(len(X), len(y))</span><span id="ec9f" class="mt mu it mp b gy nu mw l mx my">X = np.array(dataset.drop(['target', 'open1'], 1)) # dropping open<br/>y = np.array(dataset['target'])</span><span id="f511" class="mt mu it mp b gy nu mw l mx my">#timeseries split<br/>tscv = TimeSeriesSplit(max_train_size=None, n_splits=5)<br/>for train_samples, test_samples in tscv.split(X):<br/>  #print("TRAIN:", train_samples, "TEST:", test_samples)<br/>  X_train, X_test = X[train_samples], X[test_samples]<br/>  y_train, y_test = y[train_samples], y[test_samples]</span><span id="4875" class="mt mu it mp b gy nu mw l mx my">#separating features names<br/>feature_names = ['ma1','ma2','ma3','HL','pct_change','vol_increment','open_increment','Open']</span><span id="12d7" class="mt mu it mp b gy nu mw l mx my">X_train = pd.DataFrame(data=X_train, columns=feature_names)<br/>X_test = pd.DataFrame(data=X_test, columns=feature_names)<br/>print(X_train.shape, y_train.shape, X_test.shape, y_test.shape)</span></pre><p id="cd1e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们将目标变量转换为二进制分类。价格值的正变化将被分类为1，非正变化将被分类为0。</p><pre class="ks kt ku kv gt mo mp mq mr aw ms bi"><span id="4588" class="mt mu it mp b gy mv mw l mx my">y_train = pd.DataFrame(y_train) # converting to data frame<br/>y_train.rename(columns = {0: 'target'}, inplace=True)<br/>y_test = pd.DataFrame(y_test)<br/>y_test.rename(columns = {0: 'target'}, inplace=True)<br/>def getBinary(val):<br/>  if val&gt;0:<br/>    return 1<br/>  else:<br/>    return 0<br/>y_test_binary = pd.DataFrame(y_test["target"].apply(getBinary))</span></pre><h1 id="34d1" class="nv mu it bd nw nx ny nz oa ob oc od oe ki of kj og kl oh km oi ko oj kp ok ol bi translated">梯度推进回归:</h1><p id="e22c" class="pw-post-body-paragraph ld le it lf b lg om kd li lj on kg ll lm oo lo lp lq op ls lt lu oq lw lx ly im bi translated">我们将启动XGB回归器来测试模型。适应训练集</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi or"><img src="../Images/b0c87c24573414a2e5d65acf4a7ac410.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QQVVq6Uil9u9RisisRtmRQ.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi os"><img src="../Images/89b6f82e35af3f8f77b7153232e61d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W0tzXb8OmmcK596UV1snnA.png"/></div></div></figure><p id="943b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们的模型准确率为78.81%，可以预测未来8个交易日的每日价格变化(平均值)。</p><p id="a3ba" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">一旦构建了提升树，检索每个特征的重要性分数就变得相对容易和直接。这种重要性是为数据集中的每个属性明确计算的，允许对属性进行排序和相互比较。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi ot"><img src="../Images/746e76f55f2ce9705f613e693526df58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K2Uy6I2ZixvFoCJi9MGWmA.png"/></div></div></figure><h2 id="4937" class="mt mu it bd nw ou ov dn oa ow ox dp oe lm oy oz og lq pa pb oi lu pc pd ok iz bi translated">形状特征重要性:</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi pe"><img src="../Images/0d140b48b3d27fdf7489d89e1fd671c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*byLEDTW6b00CTJNE2BYO3Q.png"/></div></div></figure><p id="3136" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">从特征重要性图中我们可以看出，并不是所有的特征对于算法的执行都是重要的；因此，我们可以仅用4个特征来运行算法，以获得相同的准确度分数。该模型可以被进一步训练，丢弃不相关的属性。</p><p id="c57b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这是一个简单的模型，没有很大的复杂性，并且模型获得了相当不错的准确度。因此，我们可以看到，我们不再需要依赖人类产出的描述性统计，作为一种推理的松散证明。</p><p id="2033" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd">我这里可以到达</strong><a class="ae lz" href="https://www.linkedin.com/in/saritmaitra/" rel="noopener ugc nofollow" target="_blank"><strong class="lf jd"/></a><strong class="lf jd">。</strong></p></div></div>    
</body>
</html>