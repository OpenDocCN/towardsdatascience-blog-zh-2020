<html>
<head>
<title>Automate Email with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 自动处理电子邮件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automate-email-with-python-1e755d9c6276?source=collection_archive---------7-----------------------#2020-05-29">https://towardsdatascience.com/automate-email-with-python-1e755d9c6276?source=collection_archive---------7-----------------------#2020-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5858" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Python 自动化枯燥的工作，优化我们的工作流程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d87139e1c9e392b44fe21aeba490e354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PhsRteTDLGi6pPrE"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@epicantus?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Daria Nepriakhina </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="7280" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated">M:我们都是上班族。如果你在工作日阅读这篇文章，你可能已经发送了几封电子邮件，或者很快就会这样做。</p><p id="38f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">典型的工作者总共花 28%的时间阅读和回复电子邮件[1]。对于普通美国人来说，这相当于每天 2 小时 36 分钟。</p><p id="04f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">电子邮件是保持工作世界运转的润滑油。没有它，世界看起来会非常不同。</p><p id="5914" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，花在电子邮件上的时间真的有必要吗？《哈佛商业评论》的一项研究认为，事实并非如此。他们发现，由于电子邮件，我们平均每天浪费 1 小时 21 分钟。</p><p id="1b7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们所拥有的是难以想象数量的人可能被扔进无用的电子邮件任务的空白中。</p><p id="6bfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管 Python 可能无法解决所有这些问题，但它肯定会有所帮助。</p><p id="743d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们中的许多人都有数不清的电子邮件，这些邮件要求我们经历一个重复的过程，一周又一周地向相同的人发送所述过程的重复摘要。这种类型的重复对于自动化来说是成熟的。</p><p id="9983" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将学习如何使用 Python 动态编写电子邮件，包括相关图片，以及附加重要文件。正确实施后，我们将节省大量时间，并消除潜在的人为错误。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="ebdd" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">它是如何工作的</h1><p id="5241" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">对于这个任务，我们将使用两个库，<code class="fe ni nj nk nl b">email</code>和<code class="fe ni nj nk nl b">smtplib</code>。我们使用<code class="fe ni nj nk nl b">email</code>来构建电子邮件消息本身，使用<code class="fe ni nj nk nl b">smtplib</code>来发送消息。</p><p id="a997" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这封邮件将被包含在一个叫做<code class="fe ni nj nk nl b">MIMEMultipart</code>的物体中。这个对象可以包含几个子类，每个子类对应一个不同的媒体类型。我们的电子邮件将使用这些子类/部件构建，它们是:</p><ul class=""><li id="c555" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><code class="fe ni nj nk nl b">MIMEText</code> —纯文本，这将构成我们电子邮件的主体。</li><li id="e1a4" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><code class="fe ni nj nk nl b">MIMEImage</code> —允许我们在电子邮件中添加图像。</li><li id="4edf" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><code class="fe ni nj nk nl b">MIMEAudio</code> —音频文件随该部分一起添加。</li><li id="d1f4" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><code class="fe ni nj nk nl b">MIMEApplication</code> —可以添加任何其他附件。</li></ul><p id="dbdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们使用这些不同的部分建立了我们的电子邮件消息之后，我们切换到<code class="fe ni nj nk nl b">smptlib</code>。</p><p id="e2ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SMTP 指的是简单邮件传输协议。这是通过互联网发送电子邮件最常用的协议。</p><p id="b051" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在使用该协议时，我们将使用传输层安全(TLS)加密协议加密我们的电子邮件。</p><p id="0b7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们与预定的电子邮件服务器建立了连接，我们就发送使用<code class="fe ni nj nk nl b">MIMEMultipart</code>对象构建的电子邮件消息。那我们就完了。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="8b7d" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">哑剧</h1><p id="656a" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">现在，让我们来充实上述过程。首先，我们的电子邮件消息，用<code class="fe ni nj nk nl b">MIMEMultipart</code>构建。</p><p id="58c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ni nj nk nl b">MIMEMultipart</code>允许我们附加几个子类。我们不需要使用它们，我们可以简单地通过<code class="fe ni nj nk nl b">MIMEText</code>添加文本，然后就这样。但是，在大多数情况下，我们可能希望添加一个或多个其他类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/2e6b5cfb154d79c78258cece53c462fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tilW8FquFmTeVgNcSuaXuA.png"/></div></div></figure><p id="de8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ni nj nk nl b">MIMEMultipart</code>的结构如上图所示。右边是我们的零件，<code class="fe ni nj nk nl b">MIMEText</code>、<code class="fe ni nj nk nl b">MIMEImage</code>和<code class="fe ni nj nk nl b">MIMEApplication</code>。在左侧，是其他消息属性，如电子邮件主题。我们将不使用<code class="fe ni nj nk nl b">MIMEAudio</code>，因此它被排除在上面的图像之外。</p><p id="6def" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看一个示例导入和消息创建脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="150d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里发生了一些事情。在前五行中导入所需的库之后，我们初始化<code class="fe ni nj nk nl b">MIMEMultipart</code>对象，将其赋给<code class="fe ni nj nk nl b">msg</code>变量。</p><p id="f154" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们将文本、图像<code class="fe ni nj nk nl b">image.jpg</code>和附件<code class="fe ni nj nk nl b">report.docx</code>附加到我们的消息<code class="fe ni nj nk nl b">msg</code>中。</p><p id="e650" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上面的代码所示，使用<code class="fe ni nj nk nl b">attach</code>方法可以很容易地将每个部分添加到<code class="fe ni nj nk nl b">MIMEMultipart</code>中。</p><p id="59a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以像访问 Python 字典一样访问和修改其他电子邮件和部件属性。例如，电子邮件主题的修改非常简单，如下所示:</p><pre class="kj kk kl km gt od nl oe of aw og bi"><span id="51a2" class="oh mm it nl b gy oi oj l ok ol">msg['Subject'] = "Weekly Sales Report"</span></pre><p id="37e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们还可以通过<code class="fe ni nj nk nl b">'Content-Disposition'</code>键将文件元数据添加到我们的<code class="fe ni nj nk nl b">MIMEApplication</code>对象中。我们这样做:</p><pre class="kj kk kl km gt od nl oe of aw og bi"><span id="b7c0" class="oh mm it nl b gy oi oj l ok ol">with open('report.docx', 'rb') as f:<br/>    file = MIMEApplication(f.read())</span><span id="7092" class="oh mm it nl b gy om oj l ok ol">file['Content-Disposition'] = <strong class="nl iu">"attachment; filename=report"</strong></span><span id="5dce" class="oh mm it nl b gy om oj l ok ol">msg.attach(file)</span></pre><h2 id="3ab8" class="oh mm it bd mn on oo dn mr op oq dp mv li or os mx lm ot ou mz lq ov ow nb ox bi translated">附加几个文件</h2><p id="393c" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">尽管我们在上面的例子中只附加了每个 MIME 子类中的一个，但是我们可以添加任意多个。这样做很简单，只需再次使用相关子类对象的<code class="fe ni nj nk nl b">attach</code>方法:</p><pre class="kj kk kl km gt od nl oe of aw og bi"><span id="c9cd" class="oh mm it nl b gy oi oj l ok ol">for img_path in ['image1.png', 'image2.png']:<br/>    img_data = open(img_path, 'rb').read()<br/>    msg.attach(MIMEImage(img_data, name=os.path.basename(img_path)))</span></pre><p id="28a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们循环遍历一个包含两个图像文件的文件路径的列表— <code class="fe ni nj nk nl b">image1</code>和<code class="fe ni nj nk nl b">image2</code>。</p><p id="3541" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将每个图像加载到<code class="fe ni nj nk nl b">img_data</code>。<em class="oy">注意</em>当我们<code class="fe ni nj nk nl b">open</code>图像时，我们通过指定<code class="fe ni nj nk nl b">'rb'</code>标志将它们读取为二进制——我们必须对加载到<code class="fe ni nj nk nl b">MIMEMultipart</code>子类中的所有内容都这样做。</p><p id="f7d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们创建一个<code class="fe ni nj nk nl b">MIMEImage</code>对象并将它们<code class="fe ni nj nk nl b">attach</code>到我们的<code class="fe ni nj nk nl b">msg</code>对象。创建<code class="fe ni nj nk nl b">MIMEImage</code>时使用的<code class="fe ni nj nk nl b">name</code>参数只是在电子邮件中指定附件名称。我们使用<code class="fe ni nj nk nl b">os.path.basename</code>只返回文件名，没有任何路径或文件扩展名。</p><p id="5add" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码是这个脚本的另一个更加结构化和完整的用例。其中我们包含了添加多个图像和附件的循环，还访问了<code class="fe ni nj nk nl b">'Subject'</code>和<code class="fe ni nj nk nl b">'Content-Disposition'</code>值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="8252" class="ml mm it bd mn mo oz mq mr ms pa mu mv jz pb ka mx kc pc kd mz kf pd kg nb nc bi translated">简单邮件传输协议</h1><p id="9eb6" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">如前所述。使用 SMTP 通过互联网在服务器之间传输电子邮件。幸运的是，<code class="fe ni nj nk nl b">smtplib</code>让这个设置变得非常简单——我们只需要知道我们的电子邮件地址就可以了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/ccdb836e6d485ed5de70b1108ae3b4fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tGCyXhXldhyxxGUsh9Yw6w.png"/></div></div></figure><p id="dded" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个电子邮件提供商都有一个<code class="fe ni nj nk nl b">server</code>地址和<code class="fe ni nj nk nl b">port</code>号码。这些充当街道地址的数字等价物。</p><p id="aaa7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这些地址，我们初始化我们的 SMTP 连接。对于 Outlook，我们写<code class="fe ni nj nk nl b">smtp = smtplib.SMTP('smtp-mail.outlook.com', '587')</code>。</p><p id="2671" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们初始化了连接，我们必须让服务器知道我们想要如何与邮件服务器通信。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="51df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们使用<code class="fe ni nj nk nl b">smtp.ehlo</code>发送一个 EHLO(扩展 Hello)命令。这告诉服务器我们可以使用扩展的 SMTP 协议(ESMTP)。有些服务器使用这个，有些不使用。但是，通过指定 EHLO，我们可以同时与 SMTP 和 ESMTP 服务器进行通信。</p><p id="f2f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们设置传输层安全性(TLS)加密。同样，这很简单，只需<code class="fe ni nj nk nl b">smtp.starttls</code>即可实现。</p><p id="e8a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们用<code class="fe ni nj nk nl b">smtp.login</code>登录 SMTP 服务器，用<code class="fe ni nj nk nl b">smtp.sendmail</code>发送邮件。最后，我们用<code class="fe ni nj nk nl b">smtp.quit</code>关闭与服务器的连接。</p><p id="6a2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oy">注意</em>登录时，我们必须提供我们的电子邮件地址和密码。一般来说，尽量避免对此进行硬编码。相反，将它们保存在一个安全的本地文本文件中，并允许 Python 从那里读取它们。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="90bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至此，我们已经建立了自动化的工作流程。Python 现在可以为我们动态编写电子邮件，包括图像、音频和其他附件。</p><p id="1cba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们使用 SMTP 协议发送这些消息，并使用 TLS 加密保护我们的通信。</p><p id="e0c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章是有用的，并帮助你腾出更多的时间来专注于工作中更有创造性、更深入的任务。</p><p id="9921" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="e84b" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">参考</h1><p id="5648" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">[1] <a class="ae ky" href="https://www.mckinsey.com/industries/technology-media-and-telecommunications/our-insights/the-social-economy" rel="noopener ugc nofollow" target="_blank">《社会经济:通过社会技术释放价值和生产力》</a> (2012)，麦肯锡全球研究所</p><p id="924c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2] M. Plummer，<a class="ae ky" href="https://hbr.org/2019/01/how-to-spend-way-less-time-on-email-every-day" rel="noopener ugc nofollow" target="_blank">如何每天花更少的时间在电子邮件上</a> (2019)，《哈佛商业评论》</p><p id="333f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3] <a class="ae ky" href="https://www.samlogic.net/articles/smtp-commands-reference.htm" rel="noopener ugc nofollow" target="_blank"> SMTP 命令参考</a></p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="608d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了自动报告之外，您还可以做更多的事情，例如机器学习培训更新或数据传输完成通知。当与移动电子邮件结合使用时，这是非常有用的。</p><p id="eb5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有兴趣进一步了解这方面的内容，我已经在另一篇文章《用 Python 通知:</p><div class="pf pg gp gr ph pi"><a rel="noopener follow" target="_blank" href="/notify-with-python-41b77d51657e"><div class="pj ab fo"><div class="pk ab pl cl cj pm"><h2 class="bd iu gy z fp pn fr fs po fu fw is bi translated">用 Python 通知</h2><div class="pp l"><h3 class="bd b gy z fp pn fr fs po fu fw dk translated">使用 Python 构建的电子邮件通知让生活更轻松</h3></div><div class="pq l"><p class="bd b dl z fp pn fr fs po fu fw dk translated">towardsdatascience.com</p></div></div><div class="pr l"><div class="ps l pt pu pv pr pw ks pi"/></div></div></a></div></div></div>    
</body>
</html>