<html>
<head>
<title>Scraping COVID19 data using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 抓取 COVID19 数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scraping-covid19-data-using-python-80120eb5eb66?source=collection_archive---------29-----------------------#2020-06-02">https://towardsdatascience.com/scraping-covid19-data-using-python-80120eb5eb66?source=collection_archive---------29-----------------------#2020-06-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4d5ba736207dd89cb03230886981b098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2wRqmoGberj3zRsI"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">乔希·希尔德在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="d2f4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated"><span class="l lf lg lh bm li lj lk ll lm di">通过各种尝试来抑制 COVID19 对世界的影响，各种研究工作和创新措施依赖于从正确的数据中获得的洞察力。帮助创新所需的大部分数据可能无法通过<a class="ae kf" href="https://en.wikipedia.org/wiki/Application_programming_interface" rel="noopener ugc nofollow" target="_blank">应用编程接口(API) </a>或类似于“<em class="ln">的文件格式获得。CSV</em>’等待下载，但只能作为网页的一部分访问。所有代码片段都可以在这里找到<a class="ae kf" href="https://github.com/codebrain001/COVID19-data-scraping" rel="noopener ugc nofollow" target="_blank"/>。</span></p><p id="810d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://en.wikipedia.org/wiki/Web_scraping" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> Web scraping </strong> </a>是一个术语，用来描述使用程序或算法从 Web 中提取和处理大量数据。无论您是数据科学家、工程师，还是分析大量数据集的任何人，从 web 上抓取数据的能力都是一项有用的技能。</p><p id="c27a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank"> Worldometers </a>在全球拥有可靠的 COVID19 数据来源。在本文中，我们将学习如何使用 python 将下面描述的 COVID19 数据从网页抓取到站点的<a class="ae kf" href="https://docs.dask.org/en/latest/dataframe.html" rel="noopener ugc nofollow" target="_blank"> Dask dataframe </a>。</p><figure class="lp lq lr ls gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lo"><img src="../Images/caeedbe1cf936eb1cd1817d5ae8afbed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e72KQuJk39bpxfCdtae2tw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">来自<a class="ae kf" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank"> Worldometer </a>的 COVID19 病例报告</p></figure><h1 id="bd37" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">为什么是 Dask dataframe？</strong></h1><figure class="lp lq lr ls gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/052f46de5f1e3148d38d56f03041b6cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*btpn5EtavLPWYpzzHTsWsQ.png"/></div></div></figure><p id="12ac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>已经成为<a class="ae kf" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>编程语言中用于数据争论和分析的最流行和最受欢迎的数据科学工具之一。由于算法和本地内存限制，熊猫在大数据方面有自己的局限性。</p><p id="a077" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，<a class="ae kf" href="https://dask.org/" rel="noopener ugc nofollow" target="_blank"> Dask </a>是一个开源的免费的 Python 库。Dask 提供了在<strong class="ki iu">性能和可伸缩性</strong>方面扩展 Pandas、<a class="ae kf" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> Scikit-Learn </a>和<a class="ae kf" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> Numpy </a>的方法。在本文的上下文中，数据集必然会不断增加，这使得 Dask 成为理想的工具。</p><h1 id="ec3c" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">网页的元素</h1><figure class="lp lq lr ls gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/ef1b66cdc3636a264e7043c97ce026f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2tV6SHEZGz_LHQ9V"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@pankajpatel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pankaj Patel </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="c4d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们深入研究网络抓取之前，让我们先弄清楚网页和网站的区别。一个<strong class="ki iu">网页</strong>可以被认为是一个单独的实体，而一个<strong class="ki iu">网站</strong>是多个网页的组合。在网站 HTTP 中，通过浏览器访问网页，并使用 DNS 协议来访问它。网站中的内容根据网页而变化，而网页包含更具体的信息。</p><p id="824c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">网页有四(4)个基本元素，它们是:</p><ol class=""><li id="24b7" class="mt mu it ki b kj kk kn ko kr mv kv mw kz mx ld my mz na nb bi translated">结构</li><li id="7e5e" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated">功能</li><li id="6aad" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated">内容</li><li id="5703" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated">美学</li></ol><p id="d401" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面列出的元素，属于但不限于这些可编程组件，如<a class="ae kf" href="https://html.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu">HTML</strong></a><strong class="ki iu"/>—包含页面的主要内容，<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/CSS" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> CSS </strong> </a> —添加样式使页面看起来更好，最后<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web/JavaScript_basics" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu">JS</strong></a><strong class="ki iu"/>—JavaScript 文件为网页添加交互性。</p><p id="a7c0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们执行 web 抓取时，我们感兴趣的是从 web 页面的主要内容中提取信息，这使得很好地理解 HTML 变得很重要。</p><h1 id="e33e" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">超文本标记语言(HTML)</h1><figure class="lp lq lr ls gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/9bd6df41a1d5d77322bb875a44e2d423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D7JPS0JSoqmo6aaFA4jZ8Q.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">来自<a class="ae kf" href="https://www.logolynx.com/topic/html" rel="noopener ugc nofollow" target="_blank"> Logolynx </a>的 HTML 徽标</p></figure><p id="c6c7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">超文本标记语言(HTML)是一种创建网页的语言。HTML 不像 Python 那样是一种编程语言，相反，它是一种告诉浏览器如何布局内容的标记语言。</p><p id="26a6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们快速浏览一下 HTML，这样我们就有足够的知识来有效地抓取。HTML 由称为标签的元素组成。</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="lp lq lr ls gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/35bd5fb1aa28265bb98a96fc448a1521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFJO-Ljzw7mIK0DqyR4DZQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">HTML 代码的外观</p></figure><p id="cb53" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是 HTML 网页的基本语法。每一个<code class="fe nl nm nn no b">&lt;tag&gt;</code>在网页里面服务一个区块。<code class="fe nl nm nn no b">head</code>标签包含了关于页面标题的数据，而 HTML 文档的可见部分在<code class="fe nl nm nn no b">body</code>标签之间。<code class="fe nl nm nn no b">p</code>标签定义了一个段落，标签内的任何文本都显示为一个单独的段落。最后，从我们的代码片段来看。我们添加了两个<code class="fe nl nm nn no b">a</code>标签，允许输入链接，并告诉浏览器呈现另一个网页的链接。标签的<code class="fe nl nm nn no b">href</code>属性决定了链接的位置。如需标签的完整列表，请点击  <strong class="ki iu">查看<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">。</strong></a></strong></p><p id="8cf3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另外，HTML 标签有时会带有<code class="fe nl nm nn no b">id</code>和<code class="fe nl nm nn no b">class</code>。属性为一个 HTML 标签指定了一个唯一的 id，这个值对于 HTML 文档来说必须是唯一的。<code class="fe nl nm nn no b">class</code>属性用于为同一个类的 HTML 标签定义相等的样式(CSS 操作)。</p><h1 id="f6b6" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">下载用于网络抓取的网页</h1><p id="4bb5" class="pw-post-body-paragraph kg kh it ki b kj np kl km kn nq kp kq kr nr kt ku kv ns kx ky kz nt lb lc ld im bi translated">要抓取一个网页，我们需要做的第一件事是下载页面。我们可以使用 Python <a class="ae kf" href="https://2.python-requests.org/en/latest/" rel="noopener ugc nofollow" target="_blank">请求库</a>下载页面。在我们使用它之前，我们必须安装它。在终端上，下面的代码将安装这个库。</p><pre class="lp lq lr ls gt nu no nv nw aw nx bi"><span id="389f" class="ny lu it no b gy nz oa l ob oc">pip install requests</span></pre><p id="5ff0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请求库将向 web 服务器发出一个<code class="fe nl nm nn no b">GET</code>请求，它将为我们下载给定网页的 HTML 内容。</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="1421" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行我们的请求后，我们得到一个<a class="ae kf" href="https://2.python-requests.org/en/master/user/quickstart/#response-content" rel="noopener ugc nofollow" target="_blank">响应</a>对象。这个对象有一个<code class="fe nl nm nn no b">status_code</code>属性，指示页面是否下载成功。<code class="fe nl nm nn no b">200</code>中的<code class="fe nl nm nn no b">status_code</code>表示页面下载成功。以<code class="fe nl nm nn no b">2</code>开头的状态码通常表示成功，要了解更多关于状态码的信息，请点击链接<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="33db" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">HTML 解析</h1><p id="741c" class="pw-post-body-paragraph kg kh it ki b kj np kl km kn nq kp kq kr nr kt ku kv ns kx ky kz nt lb lc ld im bi translated">解析简单地说就是在语法的指导下把句子结构分解成成分。因此，“HTML 解析”意味着接受 HTML 代码，并从其各种标签中提取相关信息。解析内容的计算机程序称为解析器。在本文中，我们将使用'<a class="ae kf" href="https://www.crummy.com/software/BeautifulSoup/" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> BeautifulSoup </strong> </a>'库来解析我们下载的 HTML 文档并帮助正确提取。在我们使用它之前，我们必须安装它。在终端上，下面的代码将安装这个库。</p><pre class="lp lq lr ls gt nu no nv nw aw nx bi"><span id="7808" class="ny lu it no b gy nz oa l ob oc">pip install beautifulsoup4</span></pre><p id="5bfb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦安装了“BeautifulSoup”包，您就可以开始通过 BeautifulSoup 对象解析 HTML 文档了。</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="8fbf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里使用了“lxml”解析器，因为它可以处理不完整的 html，并且被广泛使用。</p><h1 id="1c3d" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">检查 HTML 网页</strong></h1><p id="e098" class="pw-post-body-paragraph kg kh it ki b kj np kl km kn nq kp kq kr nr kt ku kv ns kx ky kz nt lb lc ld im bi translated">为了从网页中充分提取内容，我们必须检查网页以识别其属性和标签。通过右键单击网页上的任意位置并选择“检查”来检查网页在本文的上下文中，我们正在寻找与“已报告冠状病毒病例”更新表相关的属性和标签。这就是结果的样子。</p><figure class="lp lq lr ls gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/c70b67356a5ddfc33a1080e9f0b2d063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Frkzv7WDUPpFGzBz517GOg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">HTML 检查</p></figure><h1 id="d104" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">提取表格</strong></h1><pre class="lp lq lr ls gt nu no nv nw aw nx bi"><span id="2044" class="ny lu it no b gy nz oa l ob oc">&lt;table id="main_table_countries_today" class="table table-bordered table-hover main_table_countries dataTable no-footer" style="width: 100%; margin-top: 0px !important;"&gt;</span></pre><p id="0865" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">检查之后，属性“id”被识别出来，并将用于过滤 HTML 文档以获得所需的表格元素。</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h1 id="3a98" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">从提取的表格中获取文本</strong></h1><p id="aa93" class="pw-post-body-paragraph kg kh it ki b kj np kl km kn nq kp kq kr nr kt ku kv ns kx ky kz nt lb lc ld im bi translated">可以看出，提取的表格中嵌入了必不可少的 HTML 标签。本文的目标是从网页中取出一个表格，并将其转换成数据帧，以便使用 Python 进行操作。为此，我们首先以列表形式逐行获取所需的数据(文本),然后将该列表转换为 dataframe。</p><p id="09fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">值得注意的是，标签<code class="fe nl nm nn no b">td</code>、<code class="fe nl nm nn no b">tr</code>、<code class="fe nl nm nn no b">th</code>分别代表表格的列、行和表头。</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h1 id="9867" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">转换成 Dask 数据帧</strong></h1><p id="dab7" class="pw-post-body-paragraph kg kh it ki b kj np kl km kn nq kp kq kr nr kt ku kv ns kx ky kz nt lb lc ld im bi translated">下一步是将该列表转换成 Dask 数据帧，以便进行数据操作和清理。如前所述。由于数据每天都在增加，建议使用 Dask 数据框架，它可以更有效地处理大数据。我们将创建一个 pandas 数据帧，并将其转换为 dask 数据帧以实现可伸缩性。生成的表格需要一些清晰的格式。</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h1 id="9585" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">导出到 csv 以供将来使用</h1><p id="199b" class="pw-post-body-paragraph kg kh it ki b kj np kl km kn nq kp kq kr nr kt ku kv ns kx ky kz nt lb lc ld im bi translated">逗号分隔值(<strong class="ki iu"> CSV </strong>)是一种广泛使用的文件格式，它将表格数据(数字和文本)存储为纯文本。它的流行和可行性是由于大量的程序和应用程序支持 csv 文件。</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="fd6d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当视图显示从<a class="ae kf" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank"> Worldometers </a> conoravirus 病例报告网页中成功提取的表格时，生成“csv”</p><figure class="lp lq lr ls gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/ca47c4fc0026efe28fbb20b78e701188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bjNd2WmGGOsrPUFMlPWMzQ.png"/></div></div></figure><p id="ca99" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望这篇文章有助于进一步的研究工作和创新，收集数据来抑制疫情。感谢阅读，并保持安全！</p><figure class="lp lq lr ls gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi of"><img src="../Images/111385a771fee9040a4af2330d72a11c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ChVKg1uGONvSX2hT"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/@kellysikkema?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯利·西克玛</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div></div>    
</body>
</html>