<html>
<head>
<title>How I connect an S3 bucket to a Databricks notebook to do analytics.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何将 S3 桶连接到 Databricks 笔记本进行分析。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-i-connect-an-s3-bucket-to-a-databricks-notebook-to-do-analytics-a7b5258619b8?source=collection_archive---------19-----------------------#2020-04-17">https://towardsdatascience.com/how-i-connect-an-s3-bucket-to-a-databricks-notebook-to-do-analytics-a7b5258619b8?source=collection_archive---------19-----------------------#2020-04-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b707" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">连接亚马逊 S3 和 databricks 笔记本的基本用例。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/cbaf68e34fd0e3460284637059a7a886.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*t0ZRDWQWyGlVb7UaBjtmnw.jpeg"/></div></figure><p id="4152" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在一个项目中，我必须对来自 Kinesis 流并由消防软管排序的数据流进行一些分析，这项技术允许我们简单地将来自流的数据存储在 S3 中。</p><p id="5f1d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">要做这些分析，你首先必须从 kinesis 笔记本连接到 S3 桶，然后使用 SPARK 对其进行查询以分发计算。</p><p id="9592" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在这个用例中，我们将使用 databricks 的社区版，它的优点是完全免费。</p></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="ef34" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">添加新的 AWS 用户</h1><p id="1c41" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">为了能够从我们的 S3 存储桶中读取数据，我们必须提供从 AWS 的访问权限，为此我们需要添加一个新的 AWS 用户:</p><p id="d2e4" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们首先转到 AWS IAM 服务-&gt;用户-&gt;添加用户</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/300f6e1479d5d725b6615c0a973ed279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hvDNnWWgPnXC6461pBQ77A.png"/></div></div></figure><p id="949e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们输入用户名和访问类型。然后，我们授予该用户访问 S3 的权限。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mv"><img src="../Images/4a3b150db9a46b2e4a52a597a8251b3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*psTlFCfLREKwXNV3PKB9Kg.png"/></div></div></figure><p id="2323" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您可以跳过接下来的步骤，直接进入用户验证。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/c64a2e29865ce31c74c88f6b0cb4b3b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UuYN5vPBS9lPghz2FYUfww.png"/></div></div></figure><p id="24b6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们点击“查看”并保存这些密钥以备后用。<br/>现在已经创建了用户，我们可以从 Databricks 转到连接。</p><h1 id="d505" class="lt lu it bd lv lw mw ly lz ma mx mc md jz my ka mf kc mz kd mh kf na kg mj mk bi translated">配置您的数据块笔记本</h1><p id="cdb9" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">现在我们的用户已经可以访问 S3，我们可以在 databricks 中启动这个连接。<br/>如果你的账户刚刚创建，你就必须创建一个新的集群来运行你的笔记本。转到集群选项卡- &gt;创建集群</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nb"><img src="../Images/8ae9e0d0e6c457ee8ec5fd50d1ca19ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zZbKqlDvurQU9Q63YvZ_0A.png"/></div></div></figure><p id="473d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">给它一个你想要的名字和一个最新的稳定运行版本。对于本教程，我将使用 Scala 来处理数据。然后点击“创建集群”</p><p id="1e8b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在，您必须创建一个笔记本来运行您的代码。为此，进入工作区-&gt;“用户名”-&gt;“创建”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nc"><img src="../Images/55f0b64229268094ef862af56e25469e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nMAT9PpZmpEyj4qCYkMldw.png"/></div></div></figure><p id="9c6c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">同样，给它起你想要的名字，选择 Scala 作为语言，然后选择你刚刚创建的集群。你准备好做云编码了吗，这很简单，不是吗？</p><h1 id="d093" class="lt lu it bd lv lw mw ly lz ma mx mc md jz my ka mf kc mz kd mh kf na kg mj mk bi translated">从数据块中连接和检索 S3 数据</h1><h2 id="5d43" class="nd lu it bd lv ne nf dn lz ng nh dp md kz ni nj mf ld nk nl mh lh nm nn mj no bi translated">关系</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi np"><img src="../Images/4539d3220e85c768fb68883fb5d43a00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tM4rhuGCo9u3vwscrBAMPg.png"/></div></div></figure><p id="4d8a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">要将您刚刚创建的笔记本连接到您的 AWS S3 桶，您只需将您的访问和密钥替换为您之前创建用户时保存的密钥，记得吗？<br/>您还必须将“AwsBucketName”属性替换为您的 S3 时段名称。<br/>挂载名称正好对应于包含 S3 数据的变量的本地名称。你可以选择你想要的名字。</p><h2 id="305a" class="nd lu it bd lv ne nf dn lz ng nh dp md kz ni nj mf ld nk nl mh lh nm nn mj no bi translated">检索数据</h2><p id="6d93" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">要从 S3 存储桶中检索数据，请使用以下代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nq"><img src="../Images/00305b3e8c7dbe151321db865eda0b86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2PbSFtaWqx1QfFauZYjI9A.png"/></div></div></figure><p id="971f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这里只是要注意路径。注意 S3 的存储结构，以便只检索您感兴趣的数据。</p><p id="2e44" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在只需使用这行代码将您的数据转换成一个漂亮的数据集。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nr"><img src="../Images/34549210b0be6046d69178a509256ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c2xv8eQtOMJ0BdR634_7fw.png"/></div></div></figure><p id="14ed" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在，我们准备好发出请求并可视化我们的数据集。准备好了吗？</p><h1 id="8c29" class="lt lu it bd lv lw mw ly lz ma mx mc md jz my ka mf kc mz kd mh kf na kg mj mk bi translated">使用 SPARK 实现数据帧的可视化</h1><p id="3f4e" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">为了可视化你的数据框架，你只需要在上面提出请求。</p><p id="cf71" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这是一个如何使用 SPARK 在数据帧上进行请求的例子</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nr"><img src="../Images/0c8c0642e8ab79fef014ad24fa59c0ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l2TQIi4FhDak5YZQOkbLdQ.png"/></div></div></figure><ul class=""><li id="9b5f" class="ns nt it ks b kt ku kw kx kz nu ld nv lh nw ll nx ny nz oa bi translated"><strong class="ks iu"> filter </strong>方法用于选择您感兴趣的数据集部分。</li><li id="25f4" class="ns nt it ks b kt ob kw oc kz od ld oe lh of ll nx ny nz oa bi translated"><strong class="ks iu"> groupBy </strong>用于根据数据框中的分类列对您刚刚选择的数据进行分组。你必须在它之后使用一个聚合函数，比如<strong class="ks iu">计数</strong></li><li id="1912" class="ns nt it ks b kt ob kw oc kz od ld oe lh of ll nx ny nz oa bi translated">最后一种方法，<strong class="ks iu">过滤器</strong>，顾名思义，允许您根据数据帧中的一列对数据进行排序。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi og"><img src="../Images/21fc5a98648934cfb5f06a86ecd99de9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KLejhtYrizyXV7ZJbL2lQw.png"/></div></div></figure><p id="05b6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您将获得一个包含已处理数据的表，作为该请求的输出。</p><p id="e3ad" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了形象化，你只需点击底部的绘图按钮，选择你想要的绘图类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oh"><img src="../Images/9281e536ad6f428d51825e17a1736af7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3utlKTfDrwXjmiymO-_VOw.gif"/></div></div></figure><p id="a4ed" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">你可以从 databricks 中找到一些关于<a class="ae oi" href="https://docs.databricks.com/spark/latest/dataframes-datasets/introduction-to-dataframes-scala.html" rel="noopener ugc nofollow" target="_blank">数据帧用法</a>和关于<a class="ae oi" href="https://docs.databricks.com/notebooks/visualizations/index.html" rel="noopener ugc nofollow" target="_blank">可视化</a>的有趣文档。</p><p id="e4af" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一旦你有了一组精彩的情节，你就可以用它来创建一个仪表板。<br/>只需点击 View - &gt; new Dashboard，选择您想要的图表……瞧，您就拥有了一个出色的 Databricks 仪表板。</p><p id="efed" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这看起来可能是这样的:</p><div class="kj kk kl km gt ab cb"><figure class="oj kn ok ol om on oo paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><img src="../Images/dbc3fa256198549dd4cd24c3ed188285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*Sdj3lBwYhnUvQltN0bkVrQ.png"/></div></figure><figure class="oj kn op ol om on oo paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><img src="../Images/ef0b46068eeec3f5d306e0a5637fc7af.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*oo_ggUId2Zq9hLqmqDDqzg.png"/></div></figure></div><p id="8a26" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">有时很难找到使用这些新的大数据工具的方法。<br/>在本文中，我们一起看了一个详细的用例，如何连接到 S3 桶，并在数据块上创建强大的可视化。<br/>我希望这篇文章能够启发您，并激发您在大数据项目中的创造力。</p></div></div>    
</body>
</html>