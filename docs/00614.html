<html>
<head>
<title>Here’s How to Run SQL in Jupyter Notebooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以下是如何在Jupyter笔记本中运行SQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/heres-how-to-run-sql-in-jupyter-notebooks-f26eb90f3259?source=collection_archive---------0-----------------------#2020-01-18">https://towardsdatascience.com/heres-how-to-run-sql-in-jupyter-notebooks-f26eb90f3259?source=collection_archive---------0-----------------------#2020-01-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bc74" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Jupyter笔记本作为SQL IDE？</h2></div><p id="ce21" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们面对现实——数据库无处不在。即使在学习数据科学时，您只处理过CSV，这也很难与现实相吻合，因为大多数公司都倾向于将数据存储到数据库中。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/9cd2c4cc60e7f763b0c5b1344a0784e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jdFKEeOgpTbwCKfTWlgaWA.jpeg"/></div></div></figure><p id="dcf3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在今天的文章中，我想快速回顾一下将Jupyter笔记本或<strong class="kk iu"> JupyterLab </strong>用作SQL IDE的概念。在此之前，我已经使用了各种Python库来连接数据库，但是这个漂亮的小技巧将为您节省大量的时间和输入。</p><p id="40ef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">阅读完本文后，您将能够直接通过笔记本执行任何SQL查询/过程，还可以将任何查询的结果存储到一个变量中，以便在以后的分析中使用。</p><p id="f7be" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我不想再纠缠于介绍，让我们直接进入正题吧。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="64b8" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">一点设置</h1><p id="2296" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">首先，您需要安装一个库，以确保您可以直接在笔记本上运行SQL，因此将以下内容粘贴到任何Jupyter单元格中:</p><p id="ffce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mu mv mw mx b">!pip install ipython-sql</code></p><p id="f107" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在写这篇文章的时候，我正在处理Oracle数据库。如果你也是，确保安装了<code class="fe mu mv mw mx b">cx_Oracle</code>。如果没有，就在网上快速查找所需的库。在我看来，这些应该是:</p><ul class=""><li id="804d" class="my mz it kk b kl km ko kp kr na kv nb kz nc ld nd ne nf ng bi translated"><code class="fe mu mv mw mx b">pyodbc</code> —适用于SQL Server</li><li id="ef8b" class="my mz it kk b kl nh ko ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><code class="fe mu mv mw mx b">mysql</code> —适用于MySQL</li><li id="9648" class="my mz it kk b kl nh ko ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><code class="fe mu mv mw mx b">psycopg2</code> —用于PostgreSQL</li></ul><p id="ed40" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们将使用<code class="fe mu mv mw mx b">sqlalchemy</code>库来创建一个连接到数据库所需的引擎。每个连接字符串只需要这样做一次——这意味着在建立连接时不必每次都这样做。</p><p id="d6fc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是各种数据库的一些常见连接字符串:</p><ul class=""><li id="4d51" class="my mz it kk b kl km ko kp kr na kv nb kz nc ld nd ne nf ng bi translated"><strong class="kk iu"> PostgreSQL </strong> : <code class="fe mu mv mw mx b">postgresql://scott:tiger@localhost/mydatabase</code></li><li id="2484" class="my mz it kk b kl nh ko ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><strong class="kk iu"> MySQL </strong> : <code class="fe mu mv mw mx b">mysql://scott:tiger@localhost/foo</code></li><li id="d812" class="my mz it kk b kl nh ko ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><strong class="kk iu">甲骨文</strong> : <code class="fe mu mv mw mx b">oracle://scott:tiger@127.0.0.1:1521/sidname</code></li><li id="a841" class="my mz it kk b kl nh ko ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><strong class="kk iu"> SQL Server: </strong> <code class="fe mu mv mw mx b">mssql+pyodbc://scott:tiger@mydsn</code></li><li id="09f1" class="my mz it kk b kl nh ko ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><strong class="kk iu">SQLite:</strong>T10】</li></ul><p id="c512" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是Oracle数据库的一个示例:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/d57a9f271aa086f26b92f1ed9b62e15e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*EYEBKpzKPp1DeoemoicGbw.png"/></div></figure><p id="fdd9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们可以加载先前安装的SQL模块:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/962d6c0fe5691e0183c8bfc43637a803.png" data-original-src="https://miro.medium.com/v2/resize:fit:292/format:webp/1*kPkaNWnh0Z9SreaxuR8kOA.png"/></div></figure><p id="61ba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并使用前面指定的连接字符串连接到数据库。注意列内容是如何以百分比符号作为前缀的:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi no"><img src="../Images/397aad4c6fbdda12b1132c3e593b44eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*N6yj1QlU4LTAOyJNjY5nzQ.png"/></div></figure><p id="edb2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你得到了和我一样的输出，这意味着一切都很顺利，你可以继续了！</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="1241" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">我们开始吧</h1><p id="7b20" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">好了，现在你可以走了。首先，我将展示如何将一个多行SQL查询传递给一个Juypter单元格。如果没有这个神奇的命令，您将不得不导入各种库，连接到数据库，用括号将查询括起来，然后执行它，但现在只是在代码前面加上<code class="fe mu mv mw mx b">%%sql</code>或<code class="fe mu mv mw mx b">%sql</code>的问题，我将在下面演示。</p><h2 id="b0a1" class="np ly it bd lz nq nr dn md ns nt dp mh kr nu nv mj kv nw nx ml kz ny nz mn oa bi translated">将整个单元格标记为SQL块</h2><p id="38bd" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">让我们从这个开始，因为它允许您输入多行SQL语句。唯一的要求是在开头加一个<code class="fe mu mv mw mx b">%%sql</code>前缀。我决定从某个表中选择前五行:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/15b28a98d68170215751557153e00690.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*ysbNzrXdC7dsyNNxMIPDAw.png"/></div></figure><p id="8cc5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是的，就是这样！如果您要执行这个单元格，您将得到以下输出:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oc"><img src="../Images/a875050479d01deb25299327bdfc6089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S1EDY-RcywEcZAy_eOFjMA.png"/></div></div></figure><p id="fc28" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它看起来有点像熊猫数据框，但它不是，它只是展示了桌子的样子。</p><h2 id="2e79" class="np ly it bd lz nq nr dn md ns nt dp mh kr nu nv mj kv nw nx ml kz ny nz mn oa bi translated">单行语句—将结果存储到变量中</h2><p id="320a" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">不限于多行语句，还可以将SQL查询的结果存储到变量中。这里你将只有一个百分号，而不是两个:<code class="fe mu mv mw mx b">%sql</code></p><p id="50d8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看看实际情况——我将从一个<code class="fe mu mv mw mx b">phone_number</code>列中选择一个值:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi od"><img src="../Images/87b06f6a08ee8683d3ea3b79c8845c77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*tSDhOvfsQoPMe_s1lWxdJg.png"/></div></figure><p id="716c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以看到，如果我打印它，输出不是您所期望的，下面是解决这个问题的方法:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/4907616fd767017ce023eef3ba4bd266.png" data-original-src="https://miro.medium.com/v2/resize:fit:318/format:webp/1*qymNpmY1CWjnst4YhI5Gpw.png"/></div></figure><p id="8f35" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这只是一个简单的索引问题，没什么可担心的。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="b1b4" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">你还能做什么？</h1><p id="138f" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">到目前为止都是有趣的游戏，但是你可能想知道<code class="fe mu mv mw mx b">ipython-sql</code>还能为我们提供什么。嗯，很多，我要讲两件事。这不会让你大吃一惊，但知道这一点是件好事。我们开始吧。</p><h2 id="9140" class="np ly it bd lz nq nr dn md ns nt dp mh kr nu nv mj kv nw nx ml kz ny nz mn oa bi translated">转换为熊猫数据框架</h2><p id="30d0" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">这只是<code class="fe mu mv mw mx b">ipython-sql</code>的一个很好的附加功能，可以节省你一点时间，这样你就不必手动转换了。我将从数据库中选择一些数据集，然后调用它的<code class="fe mu mv mw mx b">.DataFrame()</code>方法:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi of"><img src="../Images/befe9700315138b1acdd19954129cb48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*pe_ub8m1KgliL7x7XQiwqg.png"/></div></figure><p id="5c9f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在可以检查数据帧及其类型，只是为了验证一切都符合预期:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi og"><img src="../Images/7448d243fd03e863eca5c17782332873.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0IKCPsnEN4_o4ORlDIpHw.png"/></div></div></figure><p id="1f96" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是的，数据看起来没错，类型没问题，所以我们可以继续。</p><h2 id="5c5a" class="np ly it bd lz nq nr dn md ns nt dp mh kr nu nv mj kv nw nx ml kz ny nz mn oa bi translated">测绘</h2><p id="30c6" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">假设您很着急，想要快速从数据库中获取一些数据，并制作一个条形图。为了演示，我将导入<code class="fe mu mv mw mx b">matplotlib</code>并使一切都变大一点，然后将某个SQL查询的结果存储到一个变量中。</p><p id="73b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦完成，就可以调用<code class="fe mu mv mw mx b">.bar()</code>方法来制作条形图:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/cf2041c7958eeb82df99f65586ba9634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*W5RVUrb4vOGs38p-GJINvA.png"/></div></figure><p id="1f7d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">相应的图应该是这样的:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oi"><img src="../Images/d85ceec6723395fb480dd09a46bce684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IqzuHwI5EyKe6jcev65w2g.png"/></div></div></figure><p id="00bd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就绘图而言，这对于一行代码来说已经很不错了。请注意，您也可以使用<code class="fe mu mv mw mx b">.pie()</code>来显示饼图——您可以自己随意寻找其他选项。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="29fa" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">在你走之前</h1><p id="0237" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">我不认为这篇文章中的任何内容会让您惊叹，但是我也希望您能够欣赏以这种格式执行数据库查询的简单性。</p><p id="e15f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您只需要执行查询，并且不需要任何更高级的东西，这也可以是标准SQL IDE的一种替代方法。</p><p id="9234" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无论如何，我希望你已经设法从这篇文章中得到了一些有用的东西。感谢阅读。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="88b7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">喜欢这篇文章吗？成为 <a class="ae ok" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="oj">中等会员</em> </a> <em class="oj">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="ol om gp gr on oo"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">medium.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc lo oo"/></div></div></a></div></div></div>    
</body>
</html>