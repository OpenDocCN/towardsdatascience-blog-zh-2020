<html>
<head>
<title>5 Minutes to Create an AWS Lambda Function to Stay Updated About COVID-19 in Your Area</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">5分钟创建一个AWS Lambda函数，以保持对您所在地区的新冠肺炎的更新</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-minutes-to-create-an-aws-lambda-function-to-stay-updated-about-covid-19-in-your-area-88a4abe77a04?source=collection_archive---------16-----------------------#2020-03-17">https://towardsdatascience.com/5-minutes-to-create-an-aws-lambda-function-to-stay-updated-about-covid-19-in-your-area-88a4abe77a04?source=collection_archive---------16-----------------------#2020-03-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a313" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">几个简单的步骤，确保您始终拥有最新的信息</h2></div><p id="f55c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下是如何利用AWS在当地政府更新新冠肺炎信息时给自己发短信的方法。我们将使用这些AWS资源:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/9e1097093ae2cb9f4a35ec0a132f897e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xYgu_KfpeoZkyBBJo8OE6A.png"/></div></div></figure><p id="2c71" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ln">注意:我将使用AWS web控制台来完成这些步骤，但您也可以使用boto3和Cloud Formation等工具。</em></p><h1 id="fbf2" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">步骤1:创建一个S3存储桶</h1><p id="c192" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们将创建一个S3存储桶来保存我们想要监控的当前网页的副本。这样，每当lambda函数查看网页的当前版本时，我们就可以将其与以前的版本进行比较。</p><p id="6b38" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您使用的是web控制台:</p><ul class=""><li id="6c36" class="ml mm iq kh b ki kj kl km ko mn ks mo kw mp la mq mr ms mt bi translated">导航至<a class="ae mu" href="https://s3.console.aws.amazon.com/s3/home" rel="noopener ugc nofollow" target="_blank"> S3仪表盘</a></li><li id="bc12" class="ml mm iq kh b ki mv kl mw ko mx ks my kw mz la mq mr ms mt bi translated">点击“创建存储桶”</li><li id="0a86" class="ml mm iq kh b ki mv kl mw ko mx ks my kw mz la mq mr ms mt bi translated">输入存储桶名称。我用了<code class="fe na nb nc nd b">covid-bucket</code>(记住你用的名字)</li><li id="4d84" class="ml mm iq kh b ki mv kl mw ko mx ks my kw mz la mq mr ms mt bi translated">继续点击“下一步”接受默认设置</li></ul><p id="5503" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在从你的电脑上传一个文本文件。我给我的取名<code class="fe na nb nc nd b">current_webpage.txt</code>。它可以是一个空的文本文件，很快就会被覆盖。</p><p id="ac03" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ln">注意:确保它是一个</em> <code class="fe na nb nc nd b"><em class="ln">*.txt</em></code> <em class="ln">文件。并记住这个文件名以备后用。</em></p><h1 id="e1ee" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">步骤2:创建一个Lambda函数</h1><p id="d8a8" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated"><em class="ln">注意:在SNS支持的</em> <a class="ae mu" href="https://docs.aws.amazon.com/sns/latest/dg/sns-supported-regions-countries.html" rel="noopener ugc nofollow" target="_blank"> <em class="ln">这些区域</em> </a> <em class="ln">中的一个进行。</em></p><p id="1ae7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于此步骤，请确保您拥有以下信息:</p><ul class=""><li id="4bda" class="ml mm iq kh b ki kj kl km ko mn ks mo kw mp la mq mr ms mt bi translated">当地政府用来发布新信息的网站。(我住在明尼苏达州，所以我用的是卫生部的网页<a class="ae mu" href="https://www.health.state.mn.us/diseases/coronavirus/situation.html" rel="noopener ugc nofollow" target="_blank"/></li><li id="5ad2" class="ml mm iq kh b ki mv kl mw ko mx ks my kw mz la mq mr ms mt bi translated">您希望向其发送更新的电话号码</li><li id="95cb" class="ml mm iq kh b ki mv kl mw ko mx ks my kw mz la mq mr ms mt bi translated">您刚刚创建的S3存储桶和文件名</li></ul><p id="aaee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">导航至<a class="ae mu" href="https://console.aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> Lambda仪表盘</a>并点击“创建功能”。使用“从头开始创作”选项。</p><p id="535e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">给你的函数起一个名字，并选择一个<strong class="kh ir"> Python3运行时。</strong>现在使用默认权限。</p><p id="40d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以将下面的代码复制并粘贴到控制台的文本编辑器中。确保填写网站URL、本格式<a class="ae mu" href="https://en.wikipedia.org/wiki/E.164#Numbering_formats" rel="noopener ugc nofollow" target="_blank">中的电话号码</a>以及S3桶名。</p><pre class="lc ld le lf gt ne nd nf ng aw nh bi"><span id="d120" class="ni lp iq nd b gy nj nk l nl nm">import boto3<br/>import urllib3</span><span id="8432" class="ni lp iq nd b gy nn nk l nl nm"># Define URL<br/>url = 'https://PUT_YOUR_URL_HERE.gov/virus-updates'</span><span id="2a43" class="ni lp iq nd b gy nn nk l nl nm"># Set up http request maker thing<br/>http = urllib3.PoolManager()</span><span id="7c20" class="ni lp iq nd b gy nn nk l nl nm"># S3 object to store the last call<br/>bucket_name = 'covid-bucket'<br/>file_name = 'current_webpage.txt'</span><span id="9bde" class="ni lp iq nd b gy nn nk l nl nm">object_s3 = boto3.resource('s3') \<br/>                 .Bucket(bucket_name) \<br/>                 .Object(file_name)</span><span id="9ce8" class="ni lp iq nd b gy nn nk l nl nm"># List of phone numbers to send to<br/>phone_numbers = ['+1REDACTED','+1REDACTED']</span><span id="6765" class="ni lp iq nd b gy nn nk l nl nm"># Connect to AWS Simple Notification Service<br/>sns_client = boto3.client('sns')</span><span id="cbe6" class="ni lp iq nd b gy nn nk l nl nm">def lambda_handler(event, context):<br/>    <br/>    # Ping website<br/>    resp = http.request('GET',url)<br/>    new_page = resp.data<br/>    <br/>    # read in old results<br/>    old_page = object_s3.get().get('Body').read()<br/>    <br/>    if new_page == old_page:<br/>        print("No new updates.")<br/>    else:<br/>        print("-- New Update --")<br/>        <br/>        # Loop through phone numbers<br/>        for cell_phone_number in phone_numbers:<br/>            try:<br/>                # Try to send a text message<br/>                sns_client.publish(<br/>                    PhoneNumber=cell_phone_number,<br/>                    Message= f'Local COVID19 Update: {url}',<br/>                )<br/>                print(f"Successfuly sent to {cell_phone_number}")<br/>            except:<br/>                print(f"FAILED TO SEND TO {cell_phone_number}")<br/>        <br/>        # Write new data to S3<br/>        object_s3.put(Body = new_page)<br/>        print("Successfully wrote new data to S3")<br/>        <br/>    print("done")<br/>    return None</span></pre><h1 id="14a3" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">步骤3:更新函数的IAM角色</h1><p id="e191" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">现在我们需要给lambda函数以下权限:</p><ul class=""><li id="4252" class="ml mm iq kh b ki kj kl km ko mn ks mo kw mp la mq mr ms mt bi translated">从我们的S3桶中读写</li><li id="2e43" class="ml mm iq kh b ki mv kl mw ko mx ks my kw mz la mq mr ms mt bi translated">使用社交网络发布消息</li></ul><p id="0ec3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">导航到<a class="ae mu" href="https://console.aws.amazon.com/iam/home#/roles" rel="noopener ugc nofollow" target="_blank"> IAM仪表板</a>，点击侧边栏上的<strong class="kh ir">角色</strong>。</p><p id="9f55" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">找到为您的职能创建的角色。命名约定将包括你的lambda函数的名字<code class="fe na nb nc nd b">&lt;function name&gt;-role-******</code>。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi no"><img src="../Images/9ecf52afe177682c7b16ed3421741b25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ExXCRPc2YMC-0y-4Z6hIrQ.png"/></div></div></figure><p id="a94b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单击“附加策略”</p><p id="7d70" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">搜索“<em class="ln"> S3 </em>和“<em class="ln">社交网络</em>”，并添加<strong class="kh ir">完全访问</strong>策略。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi np"><img src="../Images/2275c423c883848edd0bee01b5851b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3OVR36xmqWCHpqftf4X6uQ.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nq"><img src="../Images/64f854dd5e8c2a704cb55e5cdbdea6c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OauT4ViVZaMylCERIJtYUg.png"/></div></div></figure><p id="783a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击<strong class="kh ir">附加策略</strong></p><h1 id="83fc" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">步骤4:添加一个调度程序来调用Lambda函数</h1><p id="08fe" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">回到web控制台中的lambda function dashboard，然后单击“添加触发器”。然后选择“云观察事件”</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nr"><img src="../Images/17eae7f2c71bf28467ff86d5289be3b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8NzSzBmLJtbd9epgQV_4lg.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ns"><img src="../Images/d3b014b8a39701aa4333f84f06919187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BYB2qog_F85yw7crWOp86w.png"/></div></div></figure><p id="3d18" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用“规则”下拉菜单:</p><ul class=""><li id="fd0a" class="ml mm iq kh b ki kj kl km ko mn ks mo kw mp la mq mr ms mt bi translated">选择“创建新规则”</li><li id="7da9" class="ml mm iq kh b ki mv kl mw ko mx ks my kw mz la mq mr ms mt bi translated">输入规则名称和描述</li><li id="fac3" class="ml mm iq kh b ki mv kl mw ko mx ks my kw mz la mq mr ms mt bi translated">为“规则类型”选择<em class="ln">调度表达式</em></li><li id="821c" class="ml mm iq kh b ki mv kl mw ko mx ks my kw mz la mq mr ms mt bi translated">在“计划表达式”文本字段中输入<code class="fe na nb nc nd b">rate(5 minutes)</code></li><li id="7af7" class="ml mm iq kh b ki mv kl mw ko mx ks my kw mz la mq mr ms mt bi translated">点击“添加”</li></ul><h1 id="b8e2" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">结论</h1><p id="c31f" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">运行这个应用程序应该会让您保持在这些AWS服务的<strong class="kh ir">自由层</strong>(这不是一个保证)。</p><p id="be6b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以通过在web控制台中单击lambda函数配置屏幕顶部的“test”按钮来创建和运行测试。这个测试的输入是什么并不重要，因为输入并不用于lambda函数代码中。</p><p id="e0fb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者你可以等5分钟，看看是否收到短信。</p><p id="6622" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读。注意安全。访问疾病预防控制中心网站获取更多关于新冠肺炎的信息。</p></div></div>    
</body>
</html>