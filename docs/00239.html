<html>
<head>
<title>Doing and reporting your first planned contrasts in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 R 中做并报告你的第一次计划对比</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/doing-and-reporting-your-first-planned-contrasts-in-r-ee77ff277088?source=collection_archive---------5-----------------------#2020-01-08">https://towardsdatascience.com/doing-and-reporting-your-first-planned-contrasts-in-r-ee77ff277088?source=collection_archive---------5-----------------------#2020-01-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0086" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何用方差分析事后检验来检验你的方向假设</h2></div><p id="a8d0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我们很多人都面临的情况:你刚刚进行了方差分析，你的结果是显著的…但是接下来呢？我们基本上知道有些事情正在发生，但具体是什么呢？哪些治疗有所不同？</p><p id="c815" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是有计划的对比的用武之地。它们听起来比实际更复杂，而且它们是一种灵活的统计工具，使得这种方差分析事后检验非常有效。</p><p id="1e5b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我开始之前，有一个小提示:在本教程中，我将只讨论正交对比…你不需要知道这是什么意思，以防你听说过这个术语，我们正在寻找它。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/3bf4d364314268bed6efd7e85fb24329.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*weK9JeFSRxL9X5ji"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">丹尼尔·利维斯·佩鲁西在<a class="ae lu" href="https://unsplash.com/s/photos/contrast?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="572f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">加载数据集并运行方差分析</h1><p id="2c50" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">在本教程中，我们将使用薪水数据集。它包含了不同教授的工资数据。使用以下命令加载它。</p><pre class="lf lg lh li gt mz na nb nc aw nd bi"><span id="2039" class="ne md it na b gy nf ng l nh ni">df=Salaries</span></pre><p id="a2f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一步我们将需要“car”包，所以如果您还没有安装这个包，请使用下面的命令安装它。如果您不确定是否已经安装了这个包，只需运行这个命令。</p><pre class="lf lg lh li gt mz na nb nc aw nd bi"><span id="5dd1" class="ne md it na b gy nf ng l nh ni">install.packages("car")</span></pre><p id="1cb7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们想做的方差分析是看教授的排名对他们的工资有没有影响。我们还想考虑所有其他直观的重要变量…从技术上讲，这是一个协方差。我们运行下面的命令来获得输出。</p><pre class="lf lg lh li gt mz na nb nc aw nd bi"><span id="baa2" class="ne md it na b gy nf ng l nh ni">library(car)</span><span id="8795" class="ne md it na b gy nj ng l nh ni">aov1 = aov(salary ~ sex + rank + yrs.since.phd + yrs.service + discipline, df)</span><span id="c2fb" class="ne md it na b gy nj ng l nh ni">Anova(aov1 ,type="III")</span></pre><p id="086a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这会产生以下结果。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/87f3849c4c2b37d9a2ed44b9d53f1968.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*5kXBgx7xE5wPqjJWmq6i9Q.png"/></div></figure><p id="ea6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们可以看到等级确实影响教授的薪水。但是具体怎么做呢？有计划的对比可以帮助我们找到更多这方面的信息。然而，有计划的对比需要你真正理解你感兴趣的自变量。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="90b6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置计划对比度</h1><p id="155f" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">我们先来看利息这个自变量。“等级”包含什么。为此，运行以下命令来查看“rank”的级别</p><pre class="lf lg lh li gt mz na nb nc aw nd bi"><span id="7888" class="ne md it na b gy nf ng l nh ni">levels(df$rank)</span></pre><p id="199e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将产生以下输出。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/22dc91cd87b46977d15cd777a50607bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*HKjNgDns0obwMYRfs1LwzA.png"/></div></figure><p id="8243" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在美国…这是一个美国的数据集…助理教授和副教授之间有很大的区别。副教授是教师的一部分，通常是终身教授。助理教授不是教师的一部分，通常也不是终身教授。有计划的对比可以帮助我们回答的一个问题是，“成为副教授对教授的薪水重要，还是成为教师的一部分重要？”…你看到我们在这里做什么了吗？我们正在使用数据中的隐含信息，以新的方式对我们的级别进行分组，并揭示关于该效果的真正潜在驱动因素的更多信息。基本上，我们在说…“我们知道有三个级别，但是我们如何将这些级别分组以揭示更多信息？”—我们正在对比各组数据。</p><p id="66f0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，你通常会进行两种有计划的对比:首先，你会想看看成为教员是否会有所不同。第二，你会想看看教员之间的差异是否会产生影响。下面是我们试图实现的目标的图示。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nm"><img src="../Images/040c279c64d82dd468b68ad17492b189.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KuVu7D1iK7uMdk7snUw33g.png"/></div></div></figure><p id="433d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们借助使用特定符号的正交对比将这一点传达给 R。符号由四条规则组成:</p><ul class=""><li id="e27d" class="nn no it kk b kl km ko kp kr np kv nq kz nr ld ns nt nu nv bi translated">我们将零(0)用于从对比中排除的组。</li><li id="1fc9" class="nn no it kk b kl nw ko nx kr ny kv nz kz oa ld ns nt nu nv bi translated">我们对治疗组使用负值(&lt;0) for the baseline group.</li><li id="38b3" class="nn no it kk b kl nw ko nx kr ny kv nz kz oa ld ns nt nu nv bi translated">We use positive values (&gt; 0)。</li><li id="6ee9" class="nn no it kk b kl nw ko nx kr ny kv nz kz oa ld ns nt nu nv bi translated">每个对比度中处理值的总和必须为零(0)。</li></ul><p id="ccfc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这听起来并不容易，但是一旦你看到这个例子是如何进行的，就非常简单了。示意图中的对比将以如下方式传达给 R:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ob"><img src="../Images/7c12ea73642eb6ffd48338217f9efcc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fOV61fbJh0Mhjmg0i_aaiw.png"/></div></div></figure><p id="152c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">对比 1: </strong>在第一个对比中，我们将<em class="oc"> AssocProf </em>和<em class="oc"> Prof </em>归为治疗状态。因此，它们都被赋予一个正值。为了简单起见，我们选择一个较低的值(1)。由于<em class="oc"> AssistProf </em>现在是基线，需要为负，并且总对比度 1 需要加起来为零(0)，我们需要将其赋值为 a -2。</p><p id="1108" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对比 2: 在第二个对比中，我们只想看看终身职位之间的差异是否会影响薪酬。因此，我们通过将<em class="oc">赋值为 0 来排除</em>asst prof。我们选择将<em class="oc"> Prof </em>作为治疗条件，将<em class="oc"> AssocProf </em>作为基线条件……我们也可以将两者互换，但是方向的改变是危险的，因为当我们后来解释结果时可能会忘记它们。为了简单起见，我们保持方向不变(治疗是更高级的条件)。同样，为了简单起见，我们再次选择低值，并将处理条件<em class="oc"> Prof </em>指定为 1。因此，基线条件<em class="oc"> AssocProf </em>必须为 a -1，因为总对比度需要加起来为 0。</p><p id="03ad" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这正是我们向 r 传达指定对比的方式。</p><pre class="lf lg lh li gt mz na nb nc aw nd bi"><span id="f8a8" class="ne md it na b gy nf ng l nh ni">contrast1 = c(-2,1,1)<br/>contrast2 = c(0,-1,1)</span></pre><p id="ec37" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们告诉 R 将这些对比分配给数据集<em class="oc"> df </em>中的变量<em class="oc"> rank </em>。</p><pre class="lf lg lh li gt mz na nb nc aw nd bi"><span id="fe7a" class="ne md it na b gy nf ng l nh ni">contrasts(df$rank) = cbind(contrast1, contrast2)</span></pre><p id="388c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了检查对比度的分配是否正确，我们可以重复 contrast()命令，看看它们现在是如何保存在 r 中的。</p><pre class="lf lg lh li gt mz na nb nc aw nd bi"><span id="f72f" class="ne md it na b gy nf ng l nh ni">contrasts(df$rank)</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi od"><img src="../Images/fde7a508fd3a7325dd4e79bb8738b9cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:438/format:webp/1*ZMoC7sQck6L2S57joNt_bA.png"/></div></figure><p id="64a3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们所看到的，它们已经被正确地实现了。所以现在我们可以继续分析了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="89af" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">分析、解释和报告计划对比</h1><p id="8004" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">我们通过重新运行之前运行的 ANOVA 命令来分析我们的对比。但是，因为现在 R 以对比的形式拥有了更多关于变量<em class="oc"> rank </em>结构的信息，所以输出会有所不同。</p><pre class="lf lg lh li gt mz na nb nc aw nd bi"><span id="123c" class="ne md it na b gy nf ng l nh ni">aov1 = aov(salary ~ sex + rank + yrs.since.phd + yrs.service + discipline, df)</span></pre><p id="e1d3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这一次，我们不想以 ANOVA 输出的形式访问信息，而是以回归输出的形式访问信息。因此，我们使用<em class="oc"> summary.lm </em>命令来请求输出。</p><pre class="lf lg lh li gt mz na nb nc aw nd bi"><span id="0383" class="ne md it na b gy nf ng l nh ni">summary.lm(aov1)</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/294b769425b630ecf9a7e8a78979a69e.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*ys5pEvtcem46C8CDcmGL0Q.png"/></div></figure><p id="e87b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以看到，R 现在产生输出，其中变量<em class="oc"> rank </em>的级别被替换为两个对比度。这两个对比都很明显，这意味着成为终身教授会影响教授的薪水，在终身职位上的晋升也会影响。</p><p id="5235" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将以如下方式报告这一发现:</p><blockquote class="of og oh"><p id="9b8d" class="ki kj oc kk b kl km ju kn ko kp jx kq oi ks kt ku oj kw kx ky ok la lb lc ld im bi translated">方差分析显示，在控制了性别、完成博士学位后的年数、服务年数和所从事的学科后，教授的级别对他们的工资有显著影响(<em class="it">F</em>(2390)= 68.41，<em class="it"> p </em> &lt; .001)。使用计划对比进一步调查教授级别对其工资的影响，发现与助理教授相比，成为教员(副教授或正教授)与工资显著增加有关，<em class="it"> t </em> (390) = 7.64，<em class="it"> p </em> &lt; .001(双尾)，而一旦成为教员，成为正教授而不是副教授与进一步增加有关，<em class="it"> t </em> (390) = 9.08，【T20</p></blockquote></div></div>    
</body>
</html>