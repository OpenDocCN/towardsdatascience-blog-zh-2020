# 交互式可视化中重叠标签的最小化

> 原文：<https://towardsdatascience.com/minimizing-overlapping-labels-in-interactive-visualizations-b0eabd62ef0?source=collection_archive---------47----------------------->

## 一个非常有效的，贪婪的自动标签放置算法，具有惊人的效果。

![](img/cb2390a90866eff22b085fec707bf8df.png)

美国每个州每天新新冠肺炎病例的可视化，没有标签放置算法。

用户控制和实时数据可视化最具挑战性的领域之一是标签放置。在我的许多可视化中，我试图设计标签不可能重叠的可视化——完全避免这个挑战性的问题——但在我最近的可视化中，这不是一个选项。

我的新冠肺炎疫情的 91-DIVOC 可视化允许用户通过使用 d3.js 库构建的交互式可视化来查看来自 T2 约翰霍普金斯大学的最新冠状病毒数据。由于可视化使用每天更新多次的数据，再加上用户能够浏览数据并创建超过 10 亿个不同的可视化，一切都必须以编程方式呈现。

有多种约束条件，这些约束条件对于许多线形图可视化来说是常见的，它们组合在一起使得可读标签具有挑战性:

*   可能有数百条不同的线，都在同一个 x 位置结束。
*   有些行比其他行更重要。在 91-DIVOC 可视化中，用户可以“突出显示”一个或多个国家，线条变暗、变粗，标签变大。
*   大多数用户使用移动设备，限制了可用的计算资源。

在不使用任何标签放置的情况下，具有几个突出显示的状态的每日新新冠肺炎病例的可视化显示了多个不可读的突出显示的标签和更多不可读的非突出显示的标签。

# 常用方法:力定向图

![](img/ad45be2cc06d38e26d13aab6ed32f1b3.png)

具有三个标签的力定向图标签放置算法的仿真步骤。第三步，弗吉尼亚和密西西比的标签被分开。

解决标签放置的一个常见方法是使用 [d3.js 的“力”组件](https://github.com/d3/d3-force)，它实现了一个力定向图。力定向图是一种基于物理的模拟，其中所有元素相对于其他元素都具有“吸引力”或“排斥力”。在标签放置算法的情况下，每个元素都被给予来自其他元素的轻微排斥力，导致模拟在可能创建可读标签时将元素相互推开。当模拟达到稳定的最终状态时，结果非常好，这是一种可靠的方法。

不幸的是，力有向图**慢**。力定向图的运行时间与输入 O(n)成立方增长，并且元素密集的区域在收敛之前需要大量的计算能力。在使用力定向图标签放置算法的早期实验中，花费在运行力定向图上的时间比花费在处理和渲染可视化的整个剩余部分上的时间更多。是时候寻求新的解决方案了。

# 快速解决方案:“渲染或微移”

随着令人沮丧的缓慢力导向图的失败，关键是任何解决方案的运行时间最短。为了尽可能节省处理时间，每个标签的放置都归结为一个决定，即“渲染”或“微移”:

1.  如果该区域中当前没有呈现标签，**呈现**标签。这个决定是即时的，位置永远不会改变。
2.  如果另一个先前渲染的标签已经被渲染并与新标签重叠，**轻推**该标签以尝试找到更好的位置。

![](img/55ac3b9f472bd4cdc5ebb8d8fbbd59d7.png)

“渲染或微移”标签放置策略，显示了三个标签的放置，包括“密西西比”标签的微移。

“轻推”标签的过程试图将标签放置到高于或低于预定位置的标签高度。如果没有找到合适的位置，标签将在其原始位置呈现，从而创建重叠的标签。(将标签推离预期位置往往会导致数据和数据标签之间的视觉不连续。)

由于标签仅被考虑一次，该算法在线性时间 O(n)中运行，并且将被描述为标签放置的“贪婪算法”。

# 结果

在实现了这个算法之后，结果对于算法的速度来说是惊人的。下面，你可以看到的两个高亮标签都是可读的**和**40 多个非高亮标签也是可读的。

![](img/2d773259df8966e911d8fea6aaf40f48.png)![](img/8394ba3c7d6fbe9f59dec5b1b34e313d.png)

美国每个州每天新新冠肺炎病例的可视化，带有“渲染或摆动”标签放置。

当考虑数据可视化中的标注放置时，考虑不需要全球定位的计算成本低廉的解决方案。虽然这种解决方案不能确保每个标签都不会重叠，但它极大地改善了简单的标签放置，并极大地提高了具有几十或几百个标签的任何可视化的可读性。

(你可以在我的 visualization [91-DIVOC #01:“新冠肺炎指数传播的交互式可视化”](https://91-divoc.com/pages/covid-visualization/)上使用这种标签放置算法查看可视化效果。)