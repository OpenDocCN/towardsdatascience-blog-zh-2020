<html>
<head>
<title>Preprocessing Layer in CNN models for TensorFlow2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">张量流 CNN 模型中的预处理层 2</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/preprocessing-layer-in-cnn-models-for-tf2-d471e61ddc2e?source=collection_archive---------22-----------------------#2020-02-20">https://towardsdatascience.com/preprocessing-layer-in-cnn-models-for-tf2-d471e61ddc2e?source=collection_archive---------22-----------------------#2020-02-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4954" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一种使 CNN 模型更不容易出错、更易于开发人员使用的技术</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/234bb05bbc24130efe39df79d61ec5f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G4WHFD-s2vKxHvqpmXoiNQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:pexels.com</p></figure><p id="db0d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">机器学习新手最常犯的一个错误是忘记<strong class="ky ir">标准化输入图像</strong>。难怪！当你进行迁移学习时，每个模型需要不同的输入标准化。<strong class="ky ir">比如 VGG</strong>需要从 RGB 图像中减去这个矢量【123.68，116.779，103.939】。<strong class="ky ir"> MobileNetV2 </strong>需要区间&lt; -1，1 &gt;的输入。PyTorch 模型通常使用不同的归一化方法。这个技巧可以在将来为您节省大量时间和 bug。在将图像输入到模型之前，不需要进行标准化，您可以简单地将该层添加到您的模型中(计算图)。</p><p id="e265" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">使用旧的 TensorFlow 1(安息吧),您可以简单地向图形添加预处理操作，并冻结该模型。然而，在 TensorFlow 2+中，您需要创建自己的预处理层。</em></p><p id="0e49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，首先定义我们的预处理方法(这是针对 MobileNetV2 的):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="f697" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后创建从<em class="ls"> tf.keras.layers.Layer </em>继承的自定义层，并在输入上使用 call 方法中的函数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="faf5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建模型时，在调用预训练模型的基础模型之前插入层(tf.keras 的功能 API):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="94e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">就这样！</strong></p><p id="214e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从现在开始，您的模型总是只接受 RGB [0，255]图像，并且输入的规范化在模型内部完成。如果您以 Keras .h5 格式保存了这样一个模型，那么不要忘记在模型加载期间指定定制对象。我总是建议将模型保存为 SavedModel 或 TFLITE 格式，因为模型中的一切都被冻结了，可以随时部署了！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="af0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">用预处理层你:</strong></p><ul class=""><li id="f500" class="lv lw iq ky b kz la lc ld lf lx lj ly ln lz lr ma mb mc md bi translated">节省了其他人调试你的模型的大量时间。</li><li id="8e7b" class="lv lw iq ky b kz me lc mf lf mg lj mh ln mi lr ma mb mc md bi translated"><strong class="ky ir">在使用您的模型时，您不需要告诉您的客户以任何方式标准化图像。将不同版本/架构的模型部署到移动设备上的计算机视觉应用程序时，这通常很痛苦。</strong></li></ul><p id="57a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下次见！</p><p id="7d3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">米哈尔</p></div></div>    
</body>
</html>