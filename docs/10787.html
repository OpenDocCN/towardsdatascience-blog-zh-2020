<html>
<head>
<title>Automatically migrate your project from DVC≤ 0.94 to DVC 1.x</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动将您的项目从 DVC≤ 0.94 迁移到 DVC 1.x</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automatically-migrate-your-project-from-dvc-0-94-to-dvc-1-x-416a5b9e837b?source=collection_archive---------77-----------------------#2020-07-27">https://towardsdatascience.com/automatically-migrate-your-project-from-dvc-0-94-to-dvc-1-x-416a5b9e837b?source=collection_archive---------77-----------------------#2020-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7fce" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将您的项目从 DVC ≤ 0.94 迁移到 DVC 1.x 可能是一个非常复杂的过程。这里有一个简单的方法。</h2></div><h1 id="daa3" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">DVC 1.0 已经发布了！</h1><p id="b88b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">DVC 1.0 已经发布，并带来了一整套期待已久的功能。如果你对新功能的完整列表感兴趣，你应该看看 DVC 官方发布的。其中一个主要的变化是一个单独的<code class="fe lx ly lz ma b">dvc.yaml</code>文件，它存储了描述管道的所有必要信息。这在充当 git 存储库中缓存文件占位符的<code class="fe lx ly lz ma b">.dvc</code>文件和调用<code class="fe lx ly lz ma b">dvc repro</code>时要运行的管道的描述之间创建了一个清晰的分离。</p><p id="0f01" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">这次升级的一个注意事项是，将包含大量<code class="fe lx ly lz ma b">.dvc</code>文件的存储库迁移到新的格式是一个相当复杂的过程。在这篇文章中，我将带你完成从 DVC ≤ 0.94 到 DVC 1 的迁移过程。x 使用一个<strong class="lc iu">单一自动化脚本</strong>，然后演示一种方法来检查您的迁移是否成功。</p><h2 id="c68e" class="mg kj it bd kk mh mi dn ko mj mk dp ks lj ml mm ku ln mn mo kw lr mp mq ky mr bi translated">迁移一个装满。dvc 文件到新 DVC 1。X YAML 格式</h2><h2 id="6fd8" class="mg kj it bd kk mh mi dn ko mj mk dp ks lj ml mm ku ln mn mo kw lr mp mq ky mr bi translated">设置</h2><ol class=""><li id="3cdb" class="ms mt it lc b ld le lg lh lj mu ln mv lr mw lv mx my mz na bi translated">首先，在终端中打开您的存储库目录。</li></ol><pre class="nb nc nd ne gt nf ma ng nh aw ni bi"><span id="306e" class="mg kj it ma b gy nj nk l nl nm">cd path/to/your/repository</span></pre><p id="aec5" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">2.我强烈建议创建一个新的分支，专门用于这个迁移，这对于以后比较新旧配置也很有用</p><pre class="nb nc nd ne gt nf ma ng nh aw ni bi"><span id="14cf" class="mg kj it ma b gy nj nk l nl nm">git checkout -b dvc-1-migration</span></pre><p id="55bd" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">3.升级至最新的 DVC 1。x 版本(现在是时候了)。</p><pre class="nb nc nd ne gt nf ma ng nh aw ni bi"><span id="60a4" class="mg kj it ma b gy nj nk l nl nm"><strong class="ma iu"># Homebrew (Mac)<br/></strong>brew upgrade dvc</span><span id="4636" class="mg kj it ma b gy nn nk l nl nm"><strong class="ma iu"># Chocolatery (Windows)<br/></strong>choco upgrade dvc</span><span id="3b93" class="mg kj it ma b gy nn nk l nl nm"><strong class="ma iu"># Conda<br/></strong>conda update -c conda-forge dvc</span><span id="7a70" class="mg kj it ma b gy nn nk l nl nm"><strong class="ma iu"># pip<br/></strong>pip install dvc -U</span></pre><h1 id="7f4a" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">运行迁移脚本</h1><h2 id="d8eb" class="mg kj it bd kk mh mi dn ko mj mk dp ks lj ml mm ku ln mn mo kw lr mp mq ky mr bi translated">捷径——不要告诉我细节！</h2><p id="b866" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我建议您继续阅读，看看脚本在做什么，但是如果您只是想运行脚本，您可以在您的目录中执行以下操作:</p><pre class="nb nc nd ne gt nf ma ng nh aw ni bi"><span id="415d" class="mg kj it ma b gy nj nk l nl nm">curl 'https://raw.githubusercontent.com/DAGsHub/Dvc1Migration/master/migrator.py' | python -</span></pre><h2 id="30a8" class="mg kj it bd kk mh mi dn ko mj mk dp ks lj ml mm ku ln mn mo kw lr mp mq ky mr bi translated">漫漫长路——我想明白！</h2><p id="126e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在 DVC ≤ 0.94 阶段以包含其细节的文件命名— <code class="fe lx ly lz ma b">Dvcfile</code>或<code class="fe lx ly lz ma b">&lt;name&gt;.dvc</code>。从 DVC 1 开始，您定义了阶段的名称，而不是包含它的文件的名称。</p><p id="f172" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">由 DVC 的合作者之一提供的这个 python 脚本正在将一个单阶段文件转换成<code class="fe lx ly lz ma b">dvc.yaml</code>和<code class="fe lx ly lz ma b">dvc.lock</code>中的一个阶段。它将原始的<code class="fe lx ly lz ma b">.dvc</code>文件(或<code class="fe lx ly lz ma b">Dvcfile</code>)和应该出现在新管道中的 stage 的名称作为参数。这意味着你必须手动运行<code class="fe lx ly lz ma b">python migrator.py &lt;file.dvc&gt; &lt;stage_name&gt;</code>无数次。当涉及到具有许多阶段的管道时，这可能会变得很麻烦。此外，一些<code class="fe lx ly lz ma b">.dvc</code>文件并不代表管道中的阶段，而只是跟踪文件缓存信息。这意味着它们是由 DVC 在运行命令<code class="fe lx ly lz ma b">dvc add</code>或<code class="fe lx ly lz ma b">dvc import</code>时创建的。这些不应该作为阶段出现在您的<code class="fe lx ly lz ma b">dvc.yaml</code>文件中。</p><p id="3cde" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">我冒昧地修改了脚本，这样它就可以移植一个包含我想要的任意多的<code class="fe lx ly lz ma b">.dvc</code>文件的整个项目。简而言之，它将搜索带有“cmd”键的<code class="fe lx ly lz ma b">.dvc</code>文件，并将它们的内容添加为新格式的 stage。例如，如果您当前有一个名为<code class="fe lx ly lz ma b">train.dvc</code>的阶段文件，脚本将假设您想要调用阶段<code class="fe lx ly lz ma b">train</code>。您可以根据自己的喜好随意改变这种行为！</p><p id="1e1e" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">你可以这样下载:</p><pre class="nb nc nd ne gt nf ma ng nh aw ni bi"><span id="66f2" class="mg kj it ma b gy nj nk l nl nm">curl 'https://raw.githubusercontent.com/DAGsHub/Dvc1Migration/master/migrator.py' -O</span></pre><p id="8111" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">所有原始的<code class="fe lx ly lz ma b">.dvc</code>文件将被备份为<code class="fe lx ly lz ma b">&lt;old_file&gt;.dvc.bak</code>，并且在您的工作目录的根目录下将创建两个新文件</p><ol class=""><li id="800d" class="ms mt it lc b ld mb lg mc lj no ln np lr nq lv mx my mz na bi translated"><a class="ae lw" href="https://dvc.org/doc/user-guide/dvc-files-and-directories#dvcyaml-file" rel="noopener ugc nofollow" target="_blank"> dvc.yaml </a></li><li id="ec98" class="ms mt it lc b ld nr lg ns lj nt ln nu lr nv lv mx my mz na bi translated"><a class="ae lw" href="https://dvc.org/doc/user-guide/dvc-files-and-directories#dvclock-file" rel="noopener ugc nofollow" target="_blank"> dvc.lock </a></li></ol><p id="4f50" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">要运行命令，请执行以下操作:</p><pre class="nb nc nd ne gt nf ma ng nh aw ni bi"><span id="6e84" class="mg kj it ma b gy nj nk l nl nm">python migrator.py</span></pre><p id="b620" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">输出应该如下所示:</p><pre class="nb nc nd ne gt nf ma ng nh aw ni bi"><span id="ab46" class="mg kj it ma b gy nj nk l nl nm">Creating 'dvc.yaml'<br/>Adding stage 'featurization' in 'dvc.yaml'<br/>Generating lock file 'dvc.lock'<br/>Adding stage 'training' in 'dvc.yaml'<br/>Updating lock file 'dvc.lock'<br/>Adding stage 'Dvcfile' in 'dvc.yaml'<br/>Updating lock file 'dvc.lock'<br/>...</span></pre><p id="8934" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">如果你不认识这种模式，请在下面的评论中描述你的问题，我会尽我所能来看看。</p><p id="34ae" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">否则，通过运行以下命令开始跟踪新生成的文件:</p><pre class="nb nc nd ne gt nf ma ng nh aw ni bi"><span id="b17b" class="mg kj it ma b gy nj nk l nl nm">git stage -u .<br/>git add dvc.yaml dvc.lock<br/>git commit -m "migration to dvc 1"<br/>git push -u origin dvc-1-migration</span></pre><p id="bd8f" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">这将:</p><ol class=""><li id="937b" class="ms mt it lc b ld mb lg mc lj no ln np lr nq lv mx my mz na bi translated">在 git 中将旧的<code class="fe lx ly lz ma b">.dvc</code>文件标记为已删除，同时保持工作目录中的备份文件不被跟踪</li><li id="13ad" class="ms mt it lc b ld nr lg ns lj nt ln nu lr nv lv mx my mz na bi translated">将新的<code class="fe lx ly lz ma b">dvc.yaml</code>和<code class="fe lx ly lz ma b">dvc.lock</code>添加到 git 树中</li><li id="cb31" class="ms mt it lc b ld nr lg ns lj nt ln nu lr nv lv mx my mz na bi translated">将分支<code class="fe lx ly lz ma b">dvc-1-migration</code>提交并推送到您的<code class="fe lx ly lz ma b">origin</code>遥控器</li></ol><h2 id="5c55" class="mg kj it bd kk mh mi dn ko mj mk dp ks lj ml mm ku ln mn mo kw lr mp mq ky mr bi translated">差不多完成了</h2><p id="cd9b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">就这样，您现在已经将您的项目迁移到 DVC 1 号了！</p><figure class="nb nc nd ne gt nx gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi nw"><img src="../Images/a63bc7d7b25f958e8691ff5645fb3dd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aN6o43YOhd23DBzt"/></div></div><p class="oe of gj gh gi og oh bd b be z dk translated">由<a class="ae lw" href="https://unsplash.com/@bendavisual?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">本杰明·戴维斯</a>在<a class="ae lw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="fa2a" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">没那么快！您希望确保您的管道也这样做，并且您的所有数据文件都被正确地跟踪。</p><h1 id="e8ee" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">比较您的管道</h1><p id="fb2d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">检查 YAML 文件<br/> </strong>一个选项是手动检查创建的文件，并验证所有阶段、部门、输出和指标都存在，并且运行正确的命令。或者，您可以…</p><p id="c286" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated"><strong class="lc iu">直观地比较管道图<br/> </strong>理想情况下，您会希望轻松地查看新旧管道，直观地描述两个版本的差异。<a class="ae lw" href="https://dagshub.com/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=migrating-to-dvc-1" rel="noopener ugc nofollow" target="_blank"> DAGsHub </a>是一个致力于数据科学社区的平台，可以为您做到这一点，它支持 DVC 1 和更老的版本(也有其他很酷的功能)。欢迎你使用任何你喜欢的其他工具来可视化这些差异，但实际上我是有偏见的；-)</p><figure class="nb nc nd ne gt nx gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi oi"><img src="../Images/5234ffd2b63f48951569df30c3a2d7c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rxFSqkrb6wg8vDJLHRVZgw.png"/></div></div></figure><p id="529f" class="pw-post-body-paragraph la lb it lc b ld mb ju lf lg mc jx li lj md ll lm ln me lp lq lr mf lt lu lv im bi translated">通过将您现有的存储库连接到 DAGsHub，您可以通过切换分支将您以前的管道与您在分支<code class="fe lx ly lz ma b">dvc-1-migration</code>中创建的管道进行比较。</p><figure class="nb nc nd ne gt nx gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/e30624e23425cdd88bdb8f4a7f0c66b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/1*9lfnz1c9QoDdnrPy1rHs-Q.gif"/></div></figure><h2 id="5c98" class="mg kj it bd kk mh mi dn ko mj mk dp ks lj ml mm ku ln mn mo kw lr mp mq ky mr bi translated">注意</h2><p id="fb24" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">计算 DVC 1 管道图时，DAGsHub 执行的计算与原始计算略有不同。dvc 文件。这可能会导致节点以不同的顺序出现。除此之外，节点和边应该还是一样的。</p><h1 id="80a1" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">谢谢大家！</h1><p id="621e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">感谢你阅读了这一点，我希望你觉得有用。如果您有任何建议或反馈，请在下面留下评论，或加入<a class="ae lw" href="https://discord.com/invite/9gU36Y6" rel="noopener ugc nofollow" target="_blank"> DAGsHub discord channel </a>。</p></div></div>    
</body>
</html>