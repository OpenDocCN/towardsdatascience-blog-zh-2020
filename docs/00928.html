<html>
<head>
<title>Interactive basketball data visualizations with Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Plotly 实现交互式篮球数据可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-basketball-data-visualizations-with-plotly-8c6916aaa59e?source=collection_archive---------12-----------------------#2020-01-27">https://towardsdatascience.com/interactive-basketball-data-visualizations-with-plotly-8c6916aaa59e?source=collection_archive---------12-----------------------#2020-01-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d067" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 hexbin shot 图表分析体育数据，使用 Plotly 和 Plotly Express 分析气泡图(源代码&amp;我的<a class="ae ki" href="https://gitlab.com/jphwang/online_articles" rel="noopener ugc nofollow" target="_blank"> GitLab repo </a>中包含的所有 30 支球队的数据)</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/29e1d0021c3369663f7b7e00f8b3b53e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Od5LlCT7_tsLlpnUkc05Qw.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">由<a class="ae ki" href="https://unsplash.com/@izuddinhelmi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Izuddin Helmi Adnan </a>在<a class="ae ki" href="https://unsplash.com/s/photos/basketball?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的原始照片</p></figure><blockquote class="kz la lb"><p id="8a6d" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这篇文章主要是关于观想的。它只会包括非常粗略的篮球信息——基本上，如果你知道它是什么，你会没事的。</p></blockquote><p id="fe24" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我最近一直在摆弄篮球数据分析和可视化，用 matplotlib 绘图。它很强大，但 Plotly 是我通常选择的可视化软件包。</p><p id="a345" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在我看来，Plotly 实现了功能和可定制性的正确平衡，以合理、直观的语法编写，具有很高的文档和开发速度。</p><p id="e2f7" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">所以我最近把我的篮球可视化脚本移植到了 Plotly，取得了很好的效果。在这篇文章中，我想分享一些，包括使用 Plotly 和 Plotly Express 的例子。</p><blockquote class="kz la lb"><p id="99a8" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我在我的<a class="ae ki" href="https://gitlab.com/jphwang/online_articles" rel="noopener ugc nofollow" target="_blank">git lab repo here</a>(<strong class="lf iu">basketball _ plots</strong>目录)中包含了这方面的代码，所以请随意下载并使用它/改进它。</p></blockquote><h1 id="ab19" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在开始之前</h1><h2 id="535f" class="mu md it bd me mv mw dn mi mx my dp mm lz mz na mo ma nb nc mq mb nd ne ms nf bi translated">数据</h2><p id="3048" class="pw-post-body-paragraph lc ld it lf b lg ng ju li lj nh jx ll lz ni lo lp ma nj ls lt mb nk lw lx ly im bi translated">由于这篇文章主要是关于可视化，我将在我的 repo 中包括所有 30 支球队和联盟平均水平的预处理数据输出。</p><h2 id="7c72" class="mu md it bd me mv mw dn mi mx my dp mm lz mz na mo ma nb nc mq mb nd ne ms nf bi translated">包装</h2><p id="0d9c" class="pw-post-body-paragraph lc ld it lf b lg ng ju li lj nh jx ll lz ni lo lp ma nj ls lt mb nk lw lx ly im bi translated">我假设您熟悉 python。即使你相对较新，这个教程也不应该太难。</p><p id="ed1f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">你需要用一个简单的<code class="fe nl nm nn no b">pip install plotly</code>来安装它(在你的虚拟环境中)。</p><h1 id="c169" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">气泡图一闪而过—使用 Plotly Express</h1><p id="c1a8" class="pw-post-body-paragraph lc ld it lf b lg ng ju li lj nh jx ll lz ni lo lp ma nj ls lt mb nk lw lx ly im bi translated">NBA 职业篮球运动员从篮筐右侧投篮，越过离篮筐约 24 英尺的三分线。我想了解距离如何影响投篮的准确性，以及球员从每个距离投篮的频率，并看看是否有一种模式。</p><p id="261b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">这是一个相对简单的练习，所以我们使用 Plotly Express。Plotly Express 是一个相当新的包，它是关于更快更有效地制作图表，所以你可以专注于数据探索。(<a class="ae ki" href="https://plot.ly/python/plotly-express/" rel="noopener ugc nofollow" target="_blank">你可以在这里了解更多信息</a>)</p><p id="9f0e" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我有一个整个赛季(2018-2019 赛季)所有拍摄地点的数据库，大约有 220，000 张照片。该数据库包括每个镜头的位置，以及它是否成功。</p><p id="64d6" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">利用这些数据，我制作了一个摘要(<code class="fe nl nm nn no b">league_shots_by_dist.csv</code>)，其中包括在 1 英尺(最长 32 英尺)的箱子中按距离分组的镜头，以及<code class="fe nl nm nn no b">shots_made</code>、<code class="fe nl nm nn no b">shots_counts</code>、<code class="fe nl nm nn no b">shots_acc</code>和<code class="fe nl nm nn no b">avg_dist</code>列。</p><p id="b645" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">让我们来研究一下这些数据，只需加载以下数据:</p><pre class="kk kl km kn gt np no nq nr aw ns bi"><span id="931d" class="mu md it no b gy nt nu l nv nw">import pandas as pd<br/>grouped_shots_df = pd.read_csv('srcdata/league_shots_by_dist.csv')</span></pre><p id="3701" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">然后在导入包之后，运行下面的两行代码就会在浏览器上神奇地打开一个交互式散点图。</p><pre class="kk kl km kn gt np no nq nr aw ns bi"><span id="633c" class="mu md it no b gy nt nu l nv nw">import plotly.express as px<br/>fig = px.scatter(grouped_shots_df, x="avg_dist", y="shots_accuracy")<br/>fig.show()</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/6aa8cae332e5d0a63ad578d16547a08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m1dTte7V1Xrcn6A4rTHH0Q.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">简单的散点图，只有两行代码</p></figure><p id="3e72" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">要查看玩家从每个距离射击的频率，让我们添加频率数据:只需将<code class="fe nl nm nn no b">shots_counts</code>值传递给<code class="fe nl nm nn no b">‘size'</code>参数，并指定最大气泡大小。</p><pre class="kk kl km kn gt np no nq nr aw ns bi"><span id="ee4f" class="mu md it no b gy nt nu l nv nw">fig = px.scatter(grouped_shots_df, x="avg_dist", y="shots_accuracy", size="shots_counts", size_max=25)<br/>fig.show()</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/1eed317cf88c74c5965058fd0947aae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bqojBceyQUyvhPm-uXOuZA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">简单的气泡图，仍然只有两行代码</p></figure><p id="eedd" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">这很有趣。频率(气泡大小)降低，然后再次回升。这是为什么呢？嗯，我们知道，随着我们走得更远，有些是两分球，有些是三分球，有些是两者的混合。所以让我们试着用镜头类型来给变量着色。</p><pre class="kk kl km kn gt np no nq nr aw ns bi"><span id="a886" class="mu md it no b gy nt nu l nv nw">fig = px.scatter(grouped_shots_df, x="avg_dist", y="shots_accuracy", size="shots_counts", color='shot_type', size_max=25)<br/>fig.show()</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/080492b6faf5a9ec1e1ccee23d1d25da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SmTY1oXc6tpsECd0EZf7CA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">气泡图，仅仅两行代码就包含了类别— <strong class="bd ny">和</strong>！</p></figure><p id="3a5d" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">啊，在那儿。看起来随着球员试图利用三分线，投篮频率增加了。</p><blockquote class="kz la lb"><p id="33a4" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">编辑:<a class="ae ki" href="https://demo.hindsights.io/basketball_plots_simple_scatter.html" rel="noopener ugc nofollow" target="_blank">这里有一个现场演示</a></p></blockquote><p id="5bf4" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">试着将你的鼠标移动到每一个点上——你会愉快地得到一个文本工具提示！你甚至不需要设置任何东西。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/80a961cf72922d2db14578948dbda210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oCemBPbLzudicxjseCz4qg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">详细信息的默认鼠标悬停工具提示</p></figure><p id="cddf" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">移动你的光标，观察各个点，数据告诉我们，在距离篮筐 5 到 10 英尺的范围内，投篮的准确性没有太大的变化。通过投三分球，球员们用大约 15%的命中率下降来换取 50%以上的三分球奖励。三分球比这些‘中端’两分球更受欢迎是有道理的。</p><p id="8090" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">这不完全是一个突破性的结论，但它仍然能够让我们自己看到它。</p><p id="74b2" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">但更重要的是，这不是简单得让人抓狂吗？<strong class="lf iu">我们只用两行代码就创建了最后一个图表！</strong></p><p id="6530" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">只要你有一个经过预处理的“整洁”的日期框架，Plotly Express 就可以像这样快速地进行可视化，你可以从中工作。这是一个很棒的数据探索工具。</p><h1 id="6472" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Hexbin 图，带 Plotly</h1><p id="72ba" class="pw-post-body-paragraph lc ld it lf b lg ng ju li lj nh jx ll lz ni lo lp ma nj ls lt mb nk lw lx ly im bi translated">让我们来看另一个图表，叫做赫克斯宾图表。我在其他地方讨论过，但是 hexbin 图表允许基于区域的数据可视化，通过将整个区域划分为六边形大小的网格，并按颜色(有时也按大小)显示数据，就像这样。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nz"><img src="../Images/4803be9b5394ec71ca5dd3c5ddac6194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZGu4lQWBdCWB2doFMJdPMg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">选举报道中的 hexbins(<a class="ae ki" href="https://www.informationisbeautifulawards.com/showcase/2496-2016-election-forecast" rel="noopener ugc nofollow" target="_blank">信息是美丽的</a> / fivethirtyeight)</p></figure><p id="635f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">虽然 Plotly 本身没有提供从基于坐标的数据点编译 hexbin 数据的函数，但这对我们来说并不重要，因为 a) <code class="fe nl nm nn no b">matplotlib</code>确实(<a class="ae ki" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.hexbin.html" rel="noopener ugc nofollow" target="_blank">在这里</a><code class="fe nl nm nn no b"><a class="ae ki" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.hexbin.html" rel="noopener ugc nofollow" target="_blank">matplotlib</a></code><a class="ae ki" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.hexbin.html" rel="noopener ugc nofollow" target="_blank"/>读取由 <code class="fe nl nm nn no b"><a class="ae ki" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.hexbin.html" rel="noopener ugc nofollow" target="_blank"><em class="le">Polycollection</em></a></code> <a class="ae ki" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.hexbin.html" rel="noopener ugc nofollow" target="_blank">返回的数据，如果你感兴趣的话)，b)我将提供数据集供这里使用。</a></p><p id="dfa7" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">好了，让我们直接进入六邻体蛋白数据的可视化:</p><h2 id="2b10" class="mu md it bd me mv mw dn mi mx my dp mm lz mz na mo ma nb nc mq mb nd ne ms nf bi translated">我们的第一张拍摄图表</h2><p id="e1ba" class="pw-post-body-paragraph lc ld it lf b lg ng ju li lj nh jx ll lz ni lo lp ma nj ls lt mb nk lw lx ly im bi translated">我已经把数据保存成字典格式了。只需加载以下数据:</p><pre class="kk kl km kn gt np no nq nr aw ns bi"><span id="a4d6" class="mu md it no b gy nt nu l nv nw">import pickle<br/>with open('srcdata/league_hexbin_stats.pickle', 'rb') as f:<br/>    league_hexbin_stats = pickle.load(f)</span></pre><p id="2a2e" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">字典包含这些键(自己用<code class="fe nl nm nn no b">print(league_hexbin_stats.keys())</code>查看:</p><pre class="kk kl km kn gt np no nq nr aw ns bi"><span id="a30a" class="mu md it no b gy nt nu l nv nw">['xlocs', 'ylocs', 'shots_by_hex', 'freq_by_hex', 'accs_by_hex', 'shot_ev_by_hex', 'gridsize', 'n_shots']</span></pre><p id="079f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">重要的有:x &amp; y 位置数据<code class="fe nl nm nn no b">xlocs</code>、<code class="fe nl nm nn no b">ylocs</code>、频率数据<code class="fe nl nm nn no b">freq_by_hex</code>和精度数据<code class="fe nl nm nn no b">accs_by_hex</code>。其中每一个都包括来自每个六边形的数据，除了准确性数据，我已经平均到“区域”中以消除局部变化。你看了剧情就知道我的意思了。</p><blockquote class="kz la lb"><p id="bf04" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">注意:X/Y 数据是最初根据标准坐标系捕获的。我以此为基础。基本上，边缘的中心在(0，0)，X &amp; Y 坐标中的 1 看起来是 1/10 英尺。</p></blockquote><p id="41a5" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">让我们把它们画出来。这次我们将使用<code class="fe nl nm nn no b">plotly.graph_objects</code>，因为它给了我们额外的灵活性。这会导致编写稍微长一点的代码，但是不要担心——它仍然不是很长，而且完全值得。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="2bd4" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">让我们过一遍。前几行很明显——我只是给了几个值新的名称，这样我可以更容易地重用绘图代码。<code class="fe nl nm nn no b">go.Figure()</code>创建并返回一个新图形，我们将其分配给<code class="fe nl nm nn no b">fig</code>。</p><p id="8886" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">然后我们添加一个新的散点图，使用<code class="fe nl nm nn no b">markers</code>模式(即没有线条)，我们为这些标记指定参数，包括传递数组/列表作为我们的大小和颜色。</p><p id="ea1b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><code class="fe nl nm nn no b">sizeref</code>参数给出了一个参考尺寸来缩放其余的尺寸——我基本上只是用它来得到正确的尺寸，而<code class="fe nl nm nn no b">sizemode</code>指的是尺寸如何工作——尺寸是否应该根据面积或直径而变化。</p><p id="4d8c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">惯例是应该使用“面积”,因为根据变量改变直径会使面积改变该值的平方，并且会夸大差异。</p><p id="b3b3" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我们还将标记符号指定为一个<code class="fe nl nm nn no b">hexagon</code>(毕竟这是一个 hexbin 图)，并在六边形的外部添加一个<code class="fe nl nm nn no b">line</code>以产生视觉效果。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oc"><img src="../Images/9200b0a2890400d1f2968f50fc2613ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a5cE-ddsrM4KsUNTExvkxw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">我们第一张精心拍摄的图表(或者抽象艺术，我不确定)</p></figure><p id="153f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">看起来…几乎像一张射击图(或者来自我们外星领主的信息)，尽管很明显有问题。法院在哪里，为什么比搞笑？不可能知道这些颜色意味着什么。鼠标悬停工具提示只显示 X-Y 坐标，这不是很有帮助。</p><p id="c4ac" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">让我们来解决这些问题:</p><h2 id="25ce" class="mu md it bd me mv mw dn mi mx my dp mm lz mz na mo ma nb nc mq mb nd ne ms nf bi translated">给我画一幅画</h2><p id="7a5e" class="pw-post-body-paragraph lc ld it lf b lg ng ju li lj nh jx ll lz ni lo lp ma nj ls lt mb nk lw lx ly im bi translated">幸运的是，Plotly 提供了一组方便的命令来绘制你想要的任何东西。通过使用方法<code class="fe nl nm nn no b">fig.update_figure</code>，并向<code class="fe nl nm nn no b">shapes</code>参数传递一个列表，可以很容易地画出您想要的任何东西。</p><p id="7034" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我根据这张<a class="ae ki" href="https://upload.wikimedia.org/wikipedia/commons/6/6c/Basketball_courts.svg" rel="noopener ugc nofollow" target="_blank">方便的维基百科图</a>设计了球场的尺寸，球场是由矩形、圆形和线条混合而成的。我不会讲述这些平凡的细节，但这里有几件事你可能会感兴趣:</p><ul class=""><li id="a5d1" class="od oe it lf b lg lh lj lk lz of ma og mb oh ly oi oj ok ol bi translated">有一件事我很难解决，那就是绘制 SVG 弧线，但是 plotly 论坛上的这篇文章<a class="ae ki" href="https://community.plot.ly/t/arc-shape-with-path/7205/5" rel="noopener ugc nofollow" target="_blank">帮助了我。原来 plotly.js 本身并不支持 arcs！</a></li><li id="9fbb" class="od oe it lf b lg om lj on lz oo ma op mb oq ly oi oj ok ol bi translated">Plotly 允许我固定 x 和 y 的比例——我在这里禁用了缩放，但如果没有，您可以使用<code class="fe nl nm nn no b">yaxis=dict(scaleanchor=”x”, scaleratio=1)</code>将 y 轴固定到 x 轴。</li></ul><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">draw_plotly_court 函数</p></figure><p id="5ced" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">运行与上面相同的命令，但是简单地在<code class="fe nl nm nn no b">fig = go.Figure(),</code>和<code class="fe nl nm nn no b">fig.add_trace(...</code>之间插入<code class="fe nl nm nn no b">draw_plotly_court(fig)</code>，我们得到:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi or"><img src="../Images/40a3762992eb22ab2bd4544ffae62005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UC6q5YVbkF_w3--L1LZfJw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">draw _ plotly _ 法庭在行动</p></figure><h2 id="49b1" class="mu md it bd me mv mw dn mi mx my dp mm lz mz na mo ma nb nc mq mb nd ne ms nf bi translated">将手指放在秤上</h2><p id="10fc" class="pw-post-body-paragraph lc ld it lf b lg ng ju li lj nh jx ll lz ni lo lp ma nj ls lt mb nk lw lx ly im bi translated">虽然有了很大的改进，但我们不能充分利用这些数据。颜色比例和尺寸比例都不太好。</p><p id="13be" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">为了解决这些问题，我们将:</p><ul class=""><li id="aade" class="od oe it lf b lg lh lj lk lz of ma og mb oh ly oi oj ok ol bi translated">通过手动将值限制为我的<code class="fe nl nm nn no b">max_freq</code>值，用列表理解来“剪辑”频率值。</li><li id="e9ae" class="od oe it lf b lg om lj on lz oo ma op mb oq ly oi oj ok ol bi translated">引入不同的色标。我想使用“连续”标度，因为它显示变化的正值。<a class="ae ki" href="https://plot.ly/python/plotly-express/#builtin-color-scales-and-sequences-and-a-way-to-see-them" rel="noopener ugc nofollow" target="_blank">本页</a>显示了 Plotly 附带的所有标准调色板。我选择了“<code class="fe nl nm nn no b">YlOrRd</code>”。</li></ul><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi os"><img src="../Images/0d2f3158f4822d8af57f347e342cb9fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_lsse9hkgNUVCzb3sDsSg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">YlOrRd 色阶</p></figure><ul class=""><li id="5359" class="od oe it lf b lg lh lj lk lz of ma og mb oh ly oi oj ok ol bi translated">指定颜色的最大/最小值，以及</li><li id="3b30" class="od oe it lf b lg om lj on lz oo ma op mb oq ly oi oj ok ol bi translated">在图上添加图例。我选择只指定顶部/底部刻度值，并添加字符<code class="fe nl nm nn no b">+</code>和<code class="fe nl nm nn no b">-</code>来表示它们被裁剪。</li></ul><p id="8152" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">运行下面的代码，你应该能够生成这个图表。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi or"><img src="../Images/09379e6b8fe6179209087a194459ac99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fnWjQl9GPN6AJ1-X90Eznw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">我们的拍摄图表，带有图例，和更好看的六边形。</p></figure><h2 id="7455" class="mu md it bd me mv mw dn mi mx my dp mm lz mz na mo ma nb nc mq mb nd ne ms nf bi translated">工具提示</h2><p id="4c75" class="pw-post-body-paragraph lc ld it lf b lg ng ju li lj nh jx ll lz ni lo lp ma nj ls lt mb nk lw lx ly im bi translated">如果你将鼠标移到图表上，即使在我的 hexbin 数据中频率值为零的区域，你也会得到提示(见右下图)。此外，工具提示数据目前不是很有用——它只是 X&amp;Y 坐标。我们能做什么？</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ot"><img src="../Images/4fcd1299fbab53ceb2f7c5c0a9352c12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FpDlYWPyuYqpxfQlSQUHgw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">无用的工具提示</p></figure><p id="9c4d" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">首先，让我们在频率为零的地方不要有任何值。</p><p id="02a8" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我写了一个简单的函数<code class="fe nl nm nn no b">filt_hexbins</code>来过滤 hexbin 数据，这样如果频率数据为零，它就从所有相同长度的数组中删除那些值。</p><p id="dd08" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">对于工具提示，我们简单地将一个文本列表传递给参数<code class="fe nl nm nn no b">text</code>。同样将<code class="fe nl nm nn no b">hoverinfo</code>参数值更改为<code class="fe nl nm nn no b">text</code>，您就可以开始了！文本字符串可以包含基本的 HTML，如<code class="fe nl nm nn no b">&lt;i&gt;</code>、<code class="fe nl nm nn no b">&lt;b&gt;</code>或<code class="fe nl nm nn no b">&lt;br&gt;</code>标签，所以也要尝试一下。</p><p id="0525" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">把它们放在一起，我们得到了这个代码，这个图表，带有改进的、信息丰富的工具提示。这意味着您可以将鼠标移动到任何值(或散点图)上，并获得任何数量的不同信息！漂亮。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi or"><img src="../Images/f87cb089ca3d01669d50cc9d1b3a526f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1_Qlr7BzHeY-cFE5w3O2w.png"/></div></div></figure><h2 id="5d55" class="mu md it bd me mv mw dn mi mx my dp mm lz mz na mo ma nb nc mq mb nd ne ms nf bi translated">比较数据集+将位图添加到图形中</h2><p id="c36c" class="pw-post-body-paragraph lc ld it lf b lg ng ju li lj nh jx ll lz ni lo lp ma nj ls lt mb nk lw lx ly im bi translated">为了完整起见，让我们看最后一个例子，我们将一个球队的数据与联盟平均数据进行比较。这个例子也能让我们看到不同的色阶，这非常方便。</p><p id="7f90" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我们还将在图中添加一个团队徽标的位图来完成外观。</p><p id="d260" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">加载数据，就像我们以前做的那样，但是这次加载 Hoston 火箭的文件。</p><pre class="kk kl km kn gt np no nq nr aw ns bi"><span id="3d8d" class="mu md it no b gy nt nu l nv nw">teamname = 'HOU'<br/>with open('srcdata/hou_hexbin_stats.pickle', 'rb') as f:<br/>    team_hexbin_stats = pickle.load(f)</span></pre><p id="555b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">对于这个图，我们将保留原始的团队数据，除了射击精度。我们将把投篮命中率数据转换为相对数据，这意味着我们将把它与联盟平均水平进行比较。</p><p id="35c7" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">为此，我们使用:</p><pre class="kk kl km kn gt np no nq nr aw ns bi"><span id="ae21" class="mu md it no b gy nt nu l nv nw">from copy import deepcopy<br/>rel_hexbin_stats = deepcopy(team_hexbin_stats)<br/>base_hexbin_stats = deepcopy(league_hexbin_stats)<br/>rel_hexbin_stats['accs_by_hex'] = rel_hexbin_stats['accs_by_hex'] - base_hexbin_stats['accs_by_hex']</span></pre><p id="e8e0" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">你可能想知道为什么我要用<code class="fe nl nm nn no b">deepcopy</code>。原因是由于 python 的工作方式，如果我只是简单地将<code class="fe nl nm nn no b">team_hexbin_stats</code>复制到<code class="fe nl nm nn no b">rel_hexbin_stats</code>，那么对<code class="fe nl nm nn no b">rel_hexbin_stats </code>中的值的任何修改也会应用到原始字典中(<a class="ae ki" href="https://docs.python.org/3.8/library/copy.html" rel="noopener ugc nofollow" target="_blank">在这里阅读更多信息</a>)。</p><p id="3c88" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我本可以修改<code class="fe nl nm nn no b">team_hexbin_stats</code>，因为我们不会在本教程中再次使用它，但这只是一个糟糕的做法，会导致混乱。</p><p id="65fe" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">使用修改后的<code class="fe nl nm nn no b">rel_hexbin_stats</code>，我们可以继续进行剩余的处理——现在您已经知道该流程了。唯一的变化是颜色图，一个发散图<code class="fe nl nm nn no b">RdYlBu_r</code>(反过来，因为我想红色是“好的”)，并改变比例从-10%到 10%，因为我们显示相对百分比。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi os"><img src="../Images/9a6ec4e365440b23206bef3fc540d382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q38KLRueAazEYs3_3ajGSA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">RdYlBu 颜色图</p></figure><p id="a3db" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">最后，让我们添加团队标志。Basketball-reference 有一个方便的、标准化的 URI 结构用于球队标志，所以我只引用那些带有“teamname”变量的标志。然后，用<code class="fe nl nm nn no b">.add_layout_image</code>方法添加你想要的图像，指定它的大小、位置和图层顺序，这是一件简单的事情。</p><p id="32a6" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">该版本的全部代码如下所示:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="a537" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">看看这些拍摄图表——太棒了！我不能在这里嵌入一个互动版本，但我对他们的结果很满意。</p><blockquote class="kz la lb"><p id="9147" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">(编辑:<a class="ae ki" href="https://demo.hindsights.io/basketball_plots_tor_shotchart.html" rel="noopener ugc nofollow" target="_blank">这里有一个现场演示(针对 TOR)</a>——也针对<a class="ae ki" href="https://demo.hindsights.io/basketball_plots_gsw_shotchart.html" rel="noopener ugc nofollow" target="_blank"> GSW </a>、<a class="ae ki" href="https://demo.hindsights.io/basketball_plots_hou_shotchart.html" rel="noopener ugc nofollow" target="_blank"> HOU </a>、<a class="ae ki" href="https://demo.hindsights.io/basketball_plots_sas_shotchart.html" rel="noopener ugc nofollow" target="_blank"> SAS </a>和<a class="ae ki" href="https://demo.hindsights.io/basketball_plots_nyk_shotchart.html" rel="noopener ugc nofollow" target="_blank"> NYK </a>)</p></blockquote><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ou"><img src="../Images/07b135bce5d1dcca12963ccec97bcb30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r-Bdv6oOaWuUX7qK-onuiw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">去年 NBA 总决赛两队的投篮得分表。</p></figure><p id="c85a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">如您所见，使用 Plotly 绘制空间数据非常简单。此外，在 Plotly Express 和 Plotly 之间，您有一系列选项可以满足您的需求，无论是快速和肮脏的数据探索，还是为您的客户定制的深度可视化。</p><p id="da31" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">你自己试试吧，我已经标出了决赛的队伍，但是你可以在回购中看看你自己的队伍。我把所有团队的数据都放在里面了。我想你会对 Plotly 如此简单地实现可视化印象深刻，同时又非常强大和灵活。</p></div><div class="ab cl ov ow hx ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="im in io ip iq"><p id="8a1a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">以上是我的全部内容——我希望你会觉得有用，如果你有任何问题或意见，请打电话给我！</p><blockquote class="kz la lb"><p id="de9d" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我不确定为这样的教程构建 python 文件的最佳方式是什么，但是我已经将所有内容都写在了一个文件中，所以您可以根据自己的喜好添加注释/取消注释，然后继续学习。</p></blockquote></div><div class="ab cl ov ow hx ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="im in io ip iq"><p id="217c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">如果你喜欢这个，比如说👋/在<a class="ae ki" href="https://twitter.com/_jphwang" rel="noopener ugc nofollow" target="_blank"> twitter </a>上关注，或关注更新。我上周还写了关于用 Plotly 制作交互式地图的文章。</p><div class="pc pd gp gr pe pf"><a rel="noopener follow" target="_blank" href="/interactive-maps-with-python-pandas-and-plotly-following-bloggers-through-sydney-c24d6f30867e"><div class="pg ab fo"><div class="ph ab pi cl cj pj"><h2 class="bd iu gy z fp pk fr fs pl fu fw is bi translated">Python、pandas 和 Plotly 的交互式地图:跟随博主穿越悉尼</h2><div class="pm l"><h3 class="bd b gy z fp pk fr fs pl fu fw dk translated">在这篇文章和其他几篇文章中，我将探索 Python 和 Plotly，把一些不同的看起来很棒的…</h3></div><div class="pn l"><p class="bd b dl z fp pk fr fs pl fu fw dk translated">towardsdatascience.com</p></div></div><div class="po l"><div class="pp l pq pr ps po pt kt pf"/></div></div></a></div></div></div>    
</body>
</html>