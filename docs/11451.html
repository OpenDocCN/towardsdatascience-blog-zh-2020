<html>
<head>
<title>PANDAS: Put Away Novice Data Analyst Status (Part-2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫:收起新手数据分析师的身份(第 2 部分)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandas-put-away-novice-data-analyst-status-part-2-8df616d5ac7c?source=collection_archive---------22-----------------------#2020-08-08">https://towardsdatascience.com/pandas-put-away-novice-data-analyst-status-part-2-8df616d5ac7c?source=collection_archive---------22-----------------------#2020-08-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="185b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用新冠肺炎数据绘制、设计、多索引或透视您的熊猫数据框架。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a3364e7e35dd82c204217a5148f71ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KMJdIdGGVdWxxbUBkHr_UA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">各大洲报告的新病例数:作者</p></figure><p id="cfaa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我正在做的熊猫系列的第二篇文章。如果你是熊猫新手，一定要先看看第一部分。</p><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/pandas-put-away-novice-data-analyst-status-part-1-7e1f0107dae0"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">熊猫:收起新手数据分析师的身份</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">熊猫如何让你成为更好的数据分析师？了解数据分析过程中不同步骤的一行程序。</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="eb7a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我称之为<strong class="la iu">P</strong>ut<strong class="la iu">A</strong>way<strong class="la iu">N</strong>ovice<strong class="la iu">D</strong>ATA<strong class="la iu">A</strong>analyst<strong class="la iu">S</strong>tatus，是一个强大的数据分析和操作库。在第 1 部分中，我们讨论了基本的 Pandas API 在数据分析过程中经历的不同步骤，比如读取数据、过滤、保存等等。在这里，我将重点介绍先进的熊猫 API，它们有助于轻松解决困难的分析问题。为了保持它的吸引力，我将把它作为一个问题解决练习，即首先我们将描述问题，然后我们将使用熊猫 API 用 1 或 2 行代码来解决它。</p><p id="d6b2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将在 Data 中使用<a class="ae lu" href="https://ourworldindata.org/coronavirus-source-data" rel="noopener ugc nofollow" target="_blank">我们的世界提供的开源新冠肺炎数据。请注意，我们仅将此数据用于知识共享，数据中可能存在差异。</a></p><blockquote class="mn"><p id="1866" class="mo mp it bd mq mr ms mt mu mv mw lt dk translated">📚资源:<a class="ae lu" href="https://colab.research.google.com/drive/1LP6SdlTqVafaGAEhfhI5cwvd-gnhiyJk?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Google Colab 实现</a> | <a class="ae lu" href="https://github.com/ankitgoel1602/data-science/tree/master/data-analysis/pandas-advance" rel="noopener ugc nofollow" target="_blank"> Github 仓库</a> | <a class="ae lu" href="https://github.com/ankitgoel1602/data-science/blob/master/data-analysis/pandas-advance/owid-covid-data.csv" rel="noopener ugc nofollow" target="_blank">数据集</a>📚</p></blockquote><p id="2023" class="pw-post-body-paragraph ky kz it la b lb mx ju ld le my jx lg lh mz lj lk ll na ln lo lp nb lr ls lt im bi translated">在这篇文章中，我们将举例说明—</p><ol class=""><li id="8c24" class="nc nd it la b lb lc le lf lh ne ll nf lp ng lt nh ni nj nk bi translated">使用 groupby()和 agg()进行数据聚合。</li><li id="c8dd" class="nc nd it la b lb nl le nm lh nn ll no lp np lt nh ni nj nk bi translated">使用 plot()绘制数据。</li><li id="bba5" class="nc nd it la b lb nl le nm lh nn ll no lp np lt nh ni nj nk bi translated">熊猫数据帧样式使用。样式属性。</li><li id="2a31" class="nc nd it la b lb nl le nm lh nn ll no lp np lt nh ni nj nk bi translated">旋转数据-将长格式数据转换为宽格式。</li><li id="a3af" class="nc nd it la b lb nl le nm lh nn ll no lp np lt nh ni nj nk bi translated">使用 idxmin()和 idxmax()查找具有最小值或最大值的行和列。</li><li id="223e" class="nc nd it la b lb nl le nm lh nn ll no lp np lt nh ni nj nk bi translated">多索引-简化您的查询。</li><li id="0e75" class="nc nd it la b lb nl le nm lh nn ll no lp np lt nh ni nj nk bi translated">将多个索引合并成一个索引。</li></ol><p id="6e91" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在应用操作之前，让我们详细检查一下数据集。</p><h2 id="0509" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">数据集详细信息</h2><blockquote class="oj ok ol"><p id="d539" class="ky kz om la b lb lc ju ld le lf jx lg on li lj lk oo lm ln lo op lq lr ls lt im bi translated"><a class="ae lu" href="https://ourworldindata.org/" rel="noopener ugc nofollow" target="_blank">我们的数据世界</a>维护着每天更新的新冠肺炎数据。它包括确诊病例、死亡人数以及与新冠肺炎相关的检测。我们将使用 2020 年 8 月 7 日的数据，它包含 35 列，包含各种信息，如国家 GDP、洗手设施等。</p></blockquote><p id="8158" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">出于演示目的，我将选择包含以下内容的数据子集—</p><ul class=""><li id="d6b9" class="nc nd it la b lb lc le lf lh ne ll nf lp ng lt oq ni nj nk bi translated">iso_code —国家的 alpha 3 代码。</li><li id="02b3" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">大陆——世界各大洲。</li><li id="6a62" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">位置—国家。</li><li id="4de3" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">日期—报告案例的日期。</li><li id="bfa9" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">new _ cases 当天报告的新病例。</li><li id="9f7c" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">new _ deaths 当天报告的新死亡人数。</li><li id="f80f" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">new_tests —在该日期进行的新电晕测试。</li></ul><p id="9b60" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，我们将仅使用最近 10 天的数据，即从 2020 年 7 月 29 日到 8 月 7 日。如果你想知道如何过滤这些数据，请查看<a class="ae lu" href="https://github.com/ankitgoel1602/data-science/tree/master/data-analysis/pandas-advance" rel="noopener ugc nofollow" target="_blank"> Github </a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/aa370ed3ed80c0c4ac3764b5b64d0863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_mvzUtuBvZ3pA-4S82a34Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用的新冠肺炎数据片段:作者</p></figure><blockquote class="mn"><p id="2dc2" class="mo mp it bd mq mr os ot ou ov ow lt dk translated">我相信你会看到许多与新冠肺炎有关的数据分析。让我们开始看看你如何自己做一个。</p></blockquote><h1 id="9a0a" class="ox nr it bd ns oy oz pa nv pb pc pd ny jz pe ka ob kc pf kd oe kf pg kg oh ph bi translated">1.使用 groupby()和 agg()进行数据聚合</h1><p id="7bf1" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">熊猫提供不同的 API 来聚合数据。让我们看看如何使用它们在一行中执行简单到复杂的聚合。</p><h2 id="0fcc" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">简单聚集</h2><p id="41ba" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">假设，我们需要找到每天报告的新病例总数。我们可以用——</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="b8a0" class="nq nr it po b gy ps pt l pu pv"># here we are chaining multiple operations together</span><span id="390a" class="nq nr it po b gy pw pt l pu pv"># Step 1: grouping data by date.<br/># Step 2: selecting new_cases from the group.<br/># Step 3: calculating the sum of the new_cases.<br/># Step 4: doing a groupby changes the index, so resetting it<br/># Step 5: selecting Last 5 records.</span><span id="9868" class="nq nr it po b gy pw pt l pu pv">data.groupby('date').new_cases.sum().reset_index().tail(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi px"><img src="../Images/2c2a0977228a82a203c0c87f21042937.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*3MCNh3LTMNZFgacHxfksRA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每天报告的新冠肺炎病例总数:作者</p></figure><h2 id="7805" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">聚合多个字段</h2><p id="1cb9" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">在上面的示例中，我们只聚合了一个字段，即“new_cases”。如果我们需要一个组有多个聚合怎么办？在这种情况下，我们可以将 groupby()和 agg()结合起来。比方说，我们需要找到—</p><ul class=""><li id="96aa" class="nc nd it la b lb lc le lf lh ne ll nf lp ng lt oq ni nj nk bi translated">每天报告的病例总数。</li><li id="acff" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">一个国家每天报告的最大病例数。</li><li id="328a" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">每天报告的死亡总数。</li><li id="7e8b" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">一个国家报告的最大死亡人数。</li><li id="8013" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">每天进行的测试总数</li><li id="ab48" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">一天中报告数据的国家总数。</li></ul><p id="b6ea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有这些都可以用一行代码来完成—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="179d" class="nq nr it po b gy ps pt l pu pv"># we are finding totals using sum and maximum using max<br/># Also, we used nunique to find unique number of countries reporting</span><span id="e4c6" class="nq nr it po b gy pw pt l pu pv">data.groupby('date').agg({'new_cases':['sum','max'], <br/>                          'new_deaths':['sum','max'],<br/>                          'new_tests':['sum'],<br/>                          'location':'nunique',<br/>                         }).reset_index().tail(5)</span></pre><p id="39f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这给了我们一个很好的输出—</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi py"><img src="../Images/c70a6be581fc32c59cd936804867de1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d4iV_LCLnkxSyumlzjh1og.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用日期对新冠肺炎数据进行多重聚合:作者</p></figure><p id="c216" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用这种聚合，我们得到了一个多列索引，在博客的后面，我们将看到如何将它组合成一个单一的索引。</p><h2 id="31fb" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">命名聚合</h2><p id="1b66" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">如果您注意到上面的输出，它确实得到了结果，但是列的名称并不友好，因为它只是使用现有的列名。我们可以使用名为 aggregation 的熊猫来命名输出中的每个聚合。对于上面同样的问题，我们可以做—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="92c0" class="nq nr it po b gy ps pt l pu pv"># naming the aggregations, you can use any name for the aggregate<br/>filtered_data.groupby('date').agg(<br/>               total_new_cases = ('new_cases','sum'),<br/>               max_new_cases_country = ('new_cases','max'),<br/>               total_new_deaths = ('new_deaths','sum'),<br/>               max_new_deaths_country = ('new_deaths','max'),<br/>               total_new_tests = ('new_tests','sum'),<br/>               total_countries_reported = ('location','nunique')<br/>              ).reset_index().tail(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pz"><img src="../Images/dafbd2bef31db113ead75fdb06e2cc47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3rQ3CcoVU7Pt62bY_UWiwQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 agg()的命名聚合:作者</p></figure><h1 id="590b" class="ox nr it bd ns oy oz pa nv pb pc pd ny jz qa ka ob kc qb kd oe kf qc kg oh ph bi translated">2.使用 Plot()绘制数据</h1><p id="5da3" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">数据分析师的主要工作是将数据可视化。Pandas 中的每个数据帧都有一个 plot() API 用于绘图。默认情况下，Pandas 使用 Matlplotlib 作为绘图的后端。您可以使用各种其他后端。在这里，我将使用<a class="ae lu" href="https://plotly.com/python/plotly-express/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>库，并将其配置为熊猫绘图后端。如果您没有安装 Plotly，那么您可以使用—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="af8b" class="nq nr it po b gy ps pt l pu pv"># if using anaconda distribution (recommended)<br/>conda install -c conda-forge plotly</span><span id="d8ac" class="nq nr it po b gy pw pt l pu pv"># if using pip<br/>pip install plotly</span></pre><p id="970e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您已经安装了 Plotly，请确保您的版本≥ 4.8，因为它是运行以下代码部分所必需的。我们可以改变熊猫绘图后端使用—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="71e9" class="nq nr it po b gy ps pt l pu pv"># Set plotting backend as plotly<br/>pd.options.plotting.backend = "plotly"</span></pre><p id="340c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们完成了配置。让我们通过几个例子来看看在熊猫中绘图是多么容易。</p><h2 id="07ae" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">每个国家每天报告的新病例。</h2><p id="cb9c" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">假设我们需要绘制每个国家每天报告的新病例。我们可以使用—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="5ed7" class="nq nr it po b gy ps pt l pu pv"># generating a bar plot<br/>data.plot.bar(x='date',y='new_cases', color='location')</span></pre><p id="baac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的命令会生成一个漂亮的交互图(我确实改变了一些风格，请参考 Github) —</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qd"><img src="../Images/eeee4e4df99768a4c9105f01c622ef95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*ZGNnwWJomHGZPT-_2-OGpg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新冠肺炎每日按国家分类的新病例:作者</p></figure><h2 id="583e" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">基于过去 10 天新增病例数的前 10 个国家</h2><p id="0560" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">要获得排名靠前的国家，我们首先需要按“位置”对数据进行分组，然后用以下方式绘制</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="5ce9" class="nq nr it po b gy ps pt l pu pv"># Step 1: generating a new dataset based on each location i.e. country<br/># Step 2: doing the sum on new_cases followed by sorting<br/># Step 3: Selecting top 10 countries from the dataset</span><span id="1103" class="nq nr it po b gy pw pt l pu pv">data.groupby(['location']).new_cases.sum().sort_values(ascending=False).head(10).plot.bar()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qe"><img src="../Images/6410f2dbe855798ed99a9863ce350807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pyt0ffMFXfiaL6_P9wwysg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:作者图片</p></figure><p id="6142" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">同样，您可以为不同的字段或数据的不同部分生成图。很简单，不是吗？</p><h1 id="ea8c" class="ox nr it bd ns oy oz pa nv pb pc pd ny jz qa ka ob kc qb kd oe kf qc kg oh ph bi translated">3.使用样式 API 的数据样式</h1><p id="7df7" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">很多时候我们需要在 Excel 和 Pandas 之间切换来做不同的事情，比如格式化数据或添加一些样式。Pandas 引入了样式 API，可以用来在 Pandas 中设置数据集的样式。我们可以使用样式进行各种操作。让我们看几个例子——</p><h2 id="487b" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">将数字转换为逗号分隔。</h2><p id="fe3d" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">在我们的数据集中，new_cases、new_deaths 和 new_tests 存储为不适合表示的浮点值。使用样式，我们可以把它们改成逗号分隔的值，比如—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="2288" class="nq nr it po b gy ps pt l pu pv"># formatting the data to show numbers as comma separated</span><span id="be64" class="nq nr it po b gy pw pt l pu pv">data.style.format({'new_cases':'{0:,.0f}','new_deaths':'{0:,.0f}','new_tests':'{0:,.0f}',}).hide_index()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qf"><img src="../Images/554177cc3dcdd0f62f765dc5821731af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L0bStvo8kuWoi2lNy1bcBQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可展示格式的数字:作者</p></figure><p id="fe90" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以用它来做其他有趣的事情，比如为金额字段添加货币符号，改变小数点位数等。</p><h2 id="85e8" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">突出显示最大值。</h2><p id="bc09" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">很多时候，我们需要突出显示列中的最大值。这可以通过使用—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="2e00" class="nq nr it po b gy ps pt l pu pv"># This will highlight the maximum for numeric column<br/>data.style.highlight_max().hide_index()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qg"><img src="../Images/0bf08760b835f5b6940b17ffffffb1a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YQM280XubURTzVtNWLPoGg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每列突出显示的最大值:作者</p></figure><h2 id="a185" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">基于数值大小的颜色映射。</h2><p id="8394" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">有时，查看基于数值大小的颜色图是很有用的，即大值用深色显示，小值用浅色显示。熊猫造型提供了一个很好的 API，它用一行代码无缝地做到了这一点</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="a5e9" class="nq nr it po b gy ps pt l pu pv"># Adding blue color map for each numeric field<br/>data.style.hide_index().background_gradient(cmap='Blues')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qh"><img src="../Images/1d7ca7ffefd4b3b5d05a8d9f7bf581f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ueBS5MlgeLDTZhb8VZYGmA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数值字段上的色彩映射表:作者</p></figure><p id="7945" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以使用样式 API 做各种其他事情。如果你想了解更多，请查阅<a class="ae lu" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/style.html" rel="noopener ugc nofollow" target="_blank">熊猫文献</a>。</p><h1 id="d962" class="ox nr it bd ns oy oz pa nv pb pc pd ny jz qa ka ob kc qb kd oe kf qc kg oh ph bi translated">4.透视-将数据从长格式转换为宽格式</h1><p id="d66b" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">如果您熟悉 Excel，您应该听说过数据透视表。Pandas pivot 帮助我们将长数据(即以行存储的数据)转换为宽数据(即以列存储的数据)。熊猫为旋转提供了两种不同的 APIs</p><ul class=""><li id="aae6" class="nc nd it la b lb lc le lf lh ne ll nf lp ng lt oq ni nj nk bi translated">在枢轴上转动</li><li id="4204" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">数据透视表</li></ul><p id="acae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将使用几个例子来检查每一个。</p><h2 id="70b3" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">透视( )</h2><p id="ae37" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">考虑这样一个问题，我们需要为前 10 个国家查找新冠肺炎随时间变化的新案例。</p><p id="0d63" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们需要找到每天排名前 10 位的国家，我们可以使用下面的代码来完成—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="8434" class="nq nr it po b gy ps pt l pu pv"># Step 1: create a group based on date and location<br/># Step 2: order it by number of new cases.</span><span id="1721" class="nq nr it po b gy pw pt l pu pv">grouped_data = data.groupby(['date','location']).new_cases.sum().sort_values(ascending=False)</span><span id="0340" class="nq nr it po b gy pw pt l pu pv"># we have data for each date grouped by location.<br/>grouped_data.head(5)</span><span id="6757" class="nq nr it po b gy pw pt l pu pv">Output:<br/>date        location     <br/>2020-07-30  United States    74985.0<br/>            Brazil           69074.0<br/>2020-07-31  United States    68032.0<br/>2020-08-01  United States    67023.0<br/>2020-08-07  India            62538.0</span><span id="eff2" class="nq nr it po b gy pw pt l pu pv"># Next we need to select top 10 countries for each date<br/># Step 3: create a new group based on date. <br/># Step 4: select top 10 records from each group.</span><span id="5565" class="nq nr it po b gy pw pt l pu pv">top10_countries = grouped_data.groupby('date').head(10).reset_index()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qi"><img src="../Images/251e1d69905f8487866be6f5e3b52ebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*8rMLDzYzZaB7m9-6jn4RFQ.png"/></div></figure><p id="d469" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们有每天的前 10 个国家，但这是以长格式存储的，即每天我们有多行。我们可以使用 pivot 将这些数据转换成宽格式，使用—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="fe87" class="nq nr it po b gy ps pt l pu pv"># Step 5: pivoting data on date and location<br/>top10_countries_pivot = top10_countries.pivot(index='date', columns='location', values='new_cases')</span></pre><p id="b5a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的命令中，我们说对于每个日期，用 new_cases 的值为每个位置创建新列。这将导致—</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qj"><img src="../Images/ad1df24a480fd069963085ddd2a7de8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4gK3-G6v1F19n02KzhVBvw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 Pivot 转换的新冠肺炎数据剪报:作者</p></figure><p id="daf9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们可以直接使用<a class="ae lu" href="https://seaborn.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Seaborn </a>为透视数据生成一个漂亮的热图。</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="43fe" class="nq nr it po b gy ps pt l pu pv"># Step 6: plotting heatmap using Seaborn<br/>sns.heatmap(top10_countries_pivot, annot=True, fmt='.0f')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qk"><img src="../Images/937c9181e30383fbf3ffd4b96e280870.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eF-qnHlAZF0eCAbjRq6iLg.png"/></div></div></figure><h2 id="f39f" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">数据透视表( )</h2><p id="0673" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">在上面的例子中，我们只有一行(日期，地点)的组合，即 2020-08-07，我们只有一行“印度”。如果我们需要找到每个洲的新病例数，该怎么办？在这种情况下，在给定的日期，每个洲有多个行，即行数等于该洲的国家数。为了解决这个问题，Pandas 提供了 pivot_table() API，它可以聚合记录，将其转换为一行。让我们看看它是如何实现的—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="721d" class="nq nr it po b gy ps pt l pu pv"># Creating a pivot table for continent</span><span id="bc4f" class="nq nr it po b gy pw pt l pu pv"># We do not need to select top 10 records here as we have only 6 continents<br/># Notice the aggfunc below, it will actually sum the new_cases for each country in the continent.</span><span id="f269" class="nq nr it po b gy pw pt l pu pv">continent_pivot = filtered_data.pivot_table(index='date',columns='continent', values='new_cases', aggfunc='sum')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ql"><img src="../Images/a7a88fddef5c7a1af33640ece4a86242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fgzze7Bo0bXxi4t3simiDw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">各大洲的新冠肺炎病例:作者</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a3364e7e35dd82c204217a5148f71ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KMJdIdGGVdWxxbUBkHr_UA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">各大洲的新冠肺炎热图:作者</p></figure><h1 id="c33a" class="ox nr it bd ns oy oz pa nv pb pc pd ny jz qa ka ob kc qb kd oe kf qc kg oh ph bi translated">5.使用 idxmin()，idxmax()</h1><p id="b2f4" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">您如何在数据透视表中找到具有最小或最大事例的国家/地区？我们可以使用 idxmin()或 idxmax()来实现。Idxmin()给出给定轴(即行或列)的最小值的索引，Idxmax()给出最大值的索引。</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="ad70" class="nq nr it po b gy ps pt l pu pv"># find country with maximum cases <br/># axis=1 to find max in the row, default is column</span><span id="5c10" class="nq nr it po b gy pw pt l pu pv">top10_countries_pivot.idxmax(axis=1)</span><span id="cd29" class="nq nr it po b gy pw pt l pu pv">Output:<br/>date<br/>2020-07-29    United States<br/>2020-07-30    United States<br/>2020-07-31    United States<br/>2020-08-01    United States<br/>2020-08-02    United States<br/>2020-08-03            India<br/>2020-08-04            India<br/>2020-08-05    United States<br/>2020-08-06           Brazil<br/>2020-08-07            India</span><span id="1336" class="nq nr it po b gy pw pt l pu pv"># find country with minimum cases<br/># axis=1 to find max in the row, default is column</span><span id="2447" class="nq nr it po b gy pw pt l pu pv">top10_countries_pivot.idxmin(axis=1)</span><span id="1cb8" class="nq nr it po b gy pw pt l pu pv"># This is among the top 10 countries<br/>Output:<br/>date<br/>2020-07-29      Bangladesh<br/>2020-07-30      Bangladesh<br/>2020-07-31     Philippines<br/>2020-08-01     Philippines<br/>2020-08-02     Philippines<br/>2020-08-03     Philippines<br/>2020-08-04            Peru<br/>2020-08-05    South Africa<br/>2020-08-06           Spain<br/>2020-08-07           Spain</span></pre><h2 id="6457" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">6.使用 set_index()的多索引</h2><p id="8628" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">Pandas 支持行和列的多重索引。这对于回答简单的问题很方便。例如，如果我们需要找到数据</p><ul class=""><li id="7cff" class="nc nd it la b lb lc le lf lh ne ll nf lp ng lt oq ni nj nk bi translated">在一个特定的大陆的特定的一天。</li><li id="2168" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">在特定的日子特定的地点。</li><li id="852d" class="nc nd it la b lb nl le nm lh nn ll no lp np lt oq ni nj nk bi translated">某些日子的一些地点。</li></ul><p id="bb93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有很多方法可以做到这一点，但是让我们看看使用多索引有多简单。首先，使用 set_index API 创建多索引。</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="87c4" class="nq nr it po b gy ps pt l pu pv"># Creating Index on continent, location and date<br/># The index will be created in the order supplied</span><span id="c7e1" class="nq nr it po b gy pw pt l pu pv">indexed_data = data.set_index(['continent','location','date']).sort_index()</span><span id="116a" class="nq nr it po b gy pw pt l pu pv"># values of the index<br/>indexed_data.index.values</span><span id="b3be" class="nq nr it po b gy pw pt l pu pv">Output:<br/>array([('Africa', 'Algeria', '2020-07-29'),<br/>       ('Africa', 'Algeria', '2020-07-30'),<br/>       ('Africa', 'Algeria', '2020-07-31'), ...,<br/>       ('South America', 'Venezuela', '2020-08-05'),<br/>       ('South America', 'Venezuela', '2020-08-06'),<br/>       ('South America', 'Venezuela', '2020-08-07')], dtype=object)</span></pre><p id="d783" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们对每一行都有多索引，也就是说，要查询第一行，我们需要-</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="eca2" class="nq nr it po b gy ps pt l pu pv">indexed_data.loc[(‘Africa’,’Algeria’,’2020–07–29')]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qm"><img src="../Images/933cca50fcdd081b76a7cc9cd251a5f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*17LLVZ2Lpn8TltHEQqcSMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫的多指标数据:作者</p></figure><p id="fb86" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们看几个例子，看看创建多索引有什么帮助。</p><h2 id="bcc0" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">2020 年 8 月 7 日北美(大陆)美国(所在地)报告的新增病例数。</h2><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="b20a" class="nq nr it po b gy ps pt l pu pv">indexed_data.loc[('North America','United States','2020-08-07'),'new_cases']</span><span id="3729" class="nq nr it po b gy pw pt l pu pv">Output:<br/>59755.0</span></pre><h2 id="230e" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">2020 年 8 月 7 日亚洲报告的新病例</h2><p id="04fe" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">在这里，我们希望获得亚洲所有国家的数据。我们可以通过在 location 中传递 slice(None)来实现，这意味着获取所有位置。</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="c34b" class="nq nr it po b gy ps pt l pu pv">indexed_data.loc[('Asia',slice(None),'2020-08-07'),'new_cases']</span><span id="6228" class="nq nr it po b gy pw pt l pu pv">Output(a snippet):<br/>continent  location              date      <br/>Asia       Afghanistan           2020-08-07       41.0<br/>           Armenia               2020-08-07      233.0<br/>           Azerbaijan            2020-08-07      144.0<br/>           Bahrain               2020-08-07      375.0<br/>           Bangladesh            2020-08-07     2977.0<br/>           Bhutan                2020-08-07        3.0<br/>           Brunei                2020-08-07        0.0<br/>           Cambodia              2020-08-07        0.0<br/>           China                 2020-08-07      132.0<br/>           Georgia               2020-08-07        0.0<br/>           India                 2020-08-07    62538.0</span></pre><h2 id="0c0f" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">8 月 6 日和 7 日印度和美国报告了新病例</h2><p id="b28c" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">我们可以传递任何索引的值列表。在本例中，我们没有提供洲，也没有为位置和日期选择多个值。</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="94aa" class="nq nr it po b gy ps pt l pu pv">indexed_data.loc[(slice(None),[‘India’,’United States’],[‘2020–08–06’,’2020–08–07']),’new_cases’]</span><span id="832a" class="nq nr it po b gy pw pt l pu pv">Output:<br/>continent      location       date      <br/>Asia           India          2020-08-06    56282.0<br/>                              2020-08-07    62538.0<br/>North America  United States  2020-08-06    52804.0<br/>                              2020-08-07    59755.0<br/>Name: new_cases, dtype: float64</span></pre><blockquote class="oj ok ol"><p id="1e43" class="ky kz om la b lb lc ju ld le lf jx lg on li lj lk oo lm ln lo op lq lr ls lt im bi translated">你可以用多索引做很多事情。如果你想了解更多，请参考拜伦·多伦写的一篇好文章’<a class="ae lu" rel="noopener" target="_blank" href="/how-to-use-multiindex-in-pandas-to-level-up-your-analysis-aeac7f451fce">如何在熊猫中使用多指数来提升你的分析</a>。</p></blockquote><h2 id="e4df" class="nq nr it bd ns nt nu dn nv nw nx dp ny lh nz oa ob ll oc od oe lp of og oh oi bi translated">7.将多个索引合并成一个索引。</h2><p id="820b" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">很多时候，当我们进行聚合时，我们会得到多列索引，比如—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="fadd" class="nq nr it po b gy ps pt l pu pv"># multiple aggregations on new_cases<br/>grouped_data = data.groupby('date').agg({'new_cases':['sum','max','min']})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qp"><img src="../Images/6ece10bdb13417b741ca000777fed606.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*sJlZujEPssfsYWsJ-Mjzuw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多列索引:作者</p></figure><p id="c5ad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这使得得到实际结果有点困难。我们可以通过下面的方法将这些转换成一列—</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="0c16" class="nq nr it po b gy ps pt l pu pv"># columns in grouped data<br/>grouped_data.columns</span><span id="cad3" class="nq nr it po b gy pw pt l pu pv">Output:<br/>MultiIndex([('new_cases', 'sum'),<br/>            ('new_cases', 'max'),<br/>            ('new_cases', 'min')],<br/>           )</span></pre><p id="19f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用简单的代码组合上面的列，如 new_cases_sum、new_cases_max、new_cases_min</p><pre class="kj kk kl km gt pn po pp pq aw pr bi"><span id="bd54" class="nq nr it po b gy ps pt l pu pv"># here are we just joining the tuple with '_'<br/># this works for level-2 column indexes only</span><span id="b5cd" class="nq nr it po b gy pw pt l pu pv">new_columns = ['%s%s' % (a, '_%s' % b if b else '') for a, b in grouped_data.columns]<br/>new_columns</span><span id="f1a9" class="nq nr it po b gy pw pt l pu pv">Output:<br/>['new_cases_sum', 'new_cases_max', 'new_cases_min']</span><span id="8b7b" class="nq nr it po b gy pw pt l pu pv"># change grouped_data columns.<br/>grouped_data.columns = new_columns</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qq"><img src="../Images/23d15b0633aa3b1d7466965ba721dadf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mka17X-YG2fVX2gvP9kq1A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多列索引转换为单个索引:作者</p></figure><h1 id="4b8f" class="ox nr it bd ns oy oz pa nv pb pc pd ny jz qa ka ob kc qb kd oe kf qc kg oh ph bi translated">结论</h1><p id="ed73" class="pw-post-body-paragraph ky kz it la b lb pi ju ld le pj jx lg lh pk lj lk ll pl ln lo lp pm lr ls lt im bi translated">我希望这篇文章能帮助你提高数据分析技能，节省分析大型数据集的时间。我知道阅读时很少有事情看起来很复杂，所以我建议你下载这个笔记本来玩。如果你面临任何问题，请在评论中告诉我，并随时在 LinkedIn 上联系我。仍然有许多不错的熊猫 API 我不能浏览，也许我会写一个第 3 部分来涵盖这些。目前，这就是全部。</p></div><div class="ab cl qr qs hx qt" role="separator"><span class="qu bw bk qv qw qx"/><span class="qu bw bk qv qw qx"/><span class="qu bw bk qv qw"/></div><div class="im in io ip iq"><p id="76db" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">干杯！！！注意安全！！！继续学习！！！</p></div></div>    
</body>
</html>