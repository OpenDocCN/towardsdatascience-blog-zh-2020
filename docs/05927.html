<html>
<head>
<title>Interactive Bar Charts with Bokeh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有散景的交互式条形图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-bar-charts-with-bokeh-7230e5653ba3?source=collection_archive---------20-----------------------#2020-05-15">https://towardsdatascience.com/interactive-bar-charts-with-bokeh-7230e5653ba3?source=collection_archive---------20-----------------------#2020-05-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/a2dbe32ceccf823fa6105e3b8f0ce808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S-diWtyDUxT3M0t2"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">照片由<a class="ae jd" href="https://unsplash.com/@dtopkin1?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">戴恩·托普金</a>在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><div class=""/><div class=""><h2 id="9deb" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">和其他视觉增强技术</h2></div><h2 id="de66" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">介绍</h2><p id="041b" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">这篇文章是我的散景爱情故事的第二部分。完整的故事(包括Jupyter笔记本和所有文件)在我的<a class="ae jd" href="https://github.com/ikviatkovski/bokeh_demo.git" rel="noopener ugc nofollow" target="_blank"> Github </a>上。故事的第一部分在媒体文章<a class="ae jd" rel="noopener" target="_blank" href="/top-5-simple-techniques-for-data-visualization-using-bokeh-a7fa4e05d6e6">“使用散景的简单数据可视化技术”</a>中有所描述。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/759e02c97a38cb8939257b664df52018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hZ4DI41e7h_UH4TL"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://unsplash.com/@mariogogh?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马里奥·高</a>在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="0cff" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">条形图</h2><p id="7774" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">没有可视化，你的数据故事是不可能完整的，条形图可以说是最受欢迎的分类数据表示类型之一。这种类似乐高积木的图形有无数种类型、调色板和风格，这就是为什么我决定为它们写一篇单独的文章。</p><p id="1938" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">让我们从简单的垂直和水平条形图开始。我们马上会谈到更复杂的问题。</p><p id="e016" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">用散景绘制条形图非常简单。像往常一样，我们需要指定一种图表类型(或者选择一种字形)并将数据传递给绘图函数。让我们使用相同的联合国世界卫生保健指标数据库创建一个垂直条形图，显示2000-2015年间美国麻疹发病率的变化。</p><pre class="ms mt mu mv gt nb nc nd ne aw nf bi"><span id="567c" class="kv kw jg nc b gy ng nh l ni nj"># Creating a list of categories<br/>years = data[data['country']=='United States of America']['year']</span><span id="7d0b" class="kv kw jg nc b gy nk nh l ni nj">#Creating the list of values<br/>values = data[data['country']=='United States of America']['measles']</span><span id="544a" class="kv kw jg nc b gy nk nh l ni nj"># Initializing the plot<br/>p = figure( plot_height=300, <br/>           title="Measles in the USA 2000-2015",<br/>          tools=TOOLS)</span><span id="3226" class="kv kw jg nc b gy nk nh l ni nj">#Plotting<br/>p.vbar(years,                            #categories<br/>      top = values,                      #bar heights<br/>       width = .9,<br/>       fill_alpha = .5,<br/>       fill_color = 'salmon',<br/>       line_alpha = .5,<br/>       line_color='green',<br/>       line_dash='dashed'<br/>      <br/>  )</span><span id="4765" class="kv kw jg nc b gy nk nh l ni nj">#Signing the axis<br/>p.xaxis.axis_label="Years"<br/>p.yaxis.axis_label="Measles stats"</span><span id="41fd" class="kv kw jg nc b gy nk nh l ni nj">show(p)</span></pre><p id="234d" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">瞧啊。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/28c119c84c23624b24919e7829aa937b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YLF4Y3z9NB9ZgJIp6dcasQ.png"/></div></div></figure><p id="b750" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">完全以同样的方式，我们可以创建水平条形图。让我们以阿根廷2000-2015年报告的脊髓灰质炎发病率为例进行说明。</p><pre class="ms mt mu mv gt nb nc nd ne aw nf bi"><span id="d845" class="kv kw jg nc b gy ng nh l ni nj"># Creating a list of categories<br/>years = data[data['country']=='Argentina']['year']</span><span id="ffdc" class="kv kw jg nc b gy nk nh l ni nj">#Creating the list of values<br/>values = data[data['country']=='Argentina']['polio'].values</span><span id="a4d6" class="kv kw jg nc b gy nk nh l ni nj"># Initializing the plot<br/>p = figure( plot_height=300, <br/>           title="Polio in the Argentina 2000-2015")</span><span id="3c6d" class="kv kw jg nc b gy nk nh l ni nj">#Plotting<br/>p.hbar(years,<br/>       left = 0,<br/>       right = values,<br/>       height = .9,<br/>       fill_color = 'azure',<br/>       line_color='green',<br/>       line_alpha=.5<br/>      <br/>  )</span><span id="b2c5" class="kv kw jg nc b gy nk nh l ni nj">p.xaxis.axis_label="Years"<br/>p.yaxis.axis_label="Polio stats"</span><span id="eb62" class="kv kw jg nc b gy nk nh l ni nj">show(p)</span></pre><p id="82d5" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">代码超级直观；我们只需要记住我们是在练习单杠。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/0ba4aba6c24d180625f00c0ca916e5d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_KzNoSrXBgib66IRLZqJQ.png"/></div></div></figure><p id="55e6" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">我们的条形图以一种非常简单的方式呈现，它们肯定可以从一些附加的构成中受益。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h2 id="539f" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">条形图样式</h2><p id="ead9" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">有关一些可用调色板的列表，请访问<a class="ae jd" href="https://docs.bokeh.org/en/latest/docs/reference/palettes.html" rel="noopener ugc nofollow" target="_blank">散景调色板文档</a>。为了配合散景使用它们，我们需要专门导入它们。</p><p id="0d85" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">让我们来看看2015年一些国家的麻疹数据——我们将使用预设调色板和随机选择的颜色来绘制两个图表，并且我们将使用*gridplot*技术。</p><h2 id="aca0" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">调色板和网格图</h2><pre class="ms mt mu mv gt nb nc nd ne aw nf bi"><span id="4f3b" class="kv kw jg nc b gy ng nh l ni nj">#Importing a pallette</span><span id="cc19" class="kv kw jg nc b gy nk nh l ni nj">from bokeh.palettes import Spectral5, Viridis256, Colorblind, Magma256, Turbo256</span><span id="bd49" class="kv kw jg nc b gy nk nh l ni nj"># Creating a list of categorical values </span><span id="61df" class="kv kw jg nc b gy nk nh l ni nj">values = data[(data['year']==2015)&amp;(data['country'].isin(countries))]['measles']</span><span id="3959" class="kv kw jg nc b gy nk nh l ni nj"># Set the x_range to the list of categories above</span><span id="134c" class="kv kw jg nc b gy nk nh l ni nj">p1 = figure(x_range=countries,<br/>           plot_height=250, <br/>           title="Measles in the world in 2015 (pre-set pallette)")</span><span id="1e80" class="kv kw jg nc b gy nk nh l ni nj"># Categorical values can also be used as coordinates</span><span id="42ea" class="kv kw jg nc b gy nk nh l ni nj">p1.vbar(x=countries, top=values, width=0.9,<br/>      color = Spectral5, fill_alpha=.75)</span><span id="8b5e" class="kv kw jg nc b gy nk nh l ni nj"># Set some properties to make the plot look better</span><span id="6ccc" class="kv kw jg nc b gy nk nh l ni nj">p1.yaxis.axis_label="Measles stats"<br/>p1.xgrid.grid_line_color='gray'<br/>p1.xgrid.grid_line_alpha=.75<br/>p1.xgrid.grid_line_dash = 'dashed'<br/>p1.ygrid.grid_line_color='blue'<br/>p1.ygrid.grid_line_alpha = .55<br/>p1.ygrid.grid_line_dash = 'dotted'</span><span id="c6ac" class="kv kw jg nc b gy nk nh l ni nj">p2 = figure(x_range=countries,<br/>           plot_height=250, <br/>           title="Measles in the world in 2015 (randomly selected colors from a pallette)")</span><span id="215e" class="kv kw jg nc b gy nk nh l ni nj"># Categorical values can also be used as coordinates</span><span id="05c8" class="kv kw jg nc b gy nk nh l ni nj">p2.vbar(x=countries, top=values, width=0.9,<br/>      color = random.sample(Viridis256,5), fill_alpha=.75)</span><span id="7514" class="kv kw jg nc b gy nk nh l ni nj"># Set some properties to make the plot look better</span><span id="390c" class="kv kw jg nc b gy nk nh l ni nj">p2.yaxis.axis_label="Measles stats"<br/>p2.xgrid.grid_line_color='gray'<br/>p2.xgrid.grid_line_alpha=.75<br/>p2.xgrid.grid_line_dash = 'dashed'<br/>p2.ygrid.grid_line_color='blue'<br/>p2.ygrid.grid_line_alpha = .55<br/>p2.ygrid.grid_line_dash = 'dotted'</span><span id="6771" class="kv kw jg nc b gy nk nh l ni nj">p = gridplot([[p1,None],[p2,None]], toolbar_location='right')<br/>show(p)</span></pre><p id="ad55" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">这是结果:</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/96e11c6d3172a26dd7c3b3af48fe0cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*jyCjW0uU-MdAl3yD5t-6gA.jpeg"/></div></figure><p id="e96c" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">这个情节看起来比我们开始时的要友好得多。对颜色和调色板的实验永无止境。</p><h2 id="aa6c" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">分组条形图</h2><p id="5f99" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">有时我们需要绘制分组条形图。例如，我们可能需要对一些国家的健康指标进行分组。为此，我们需要从bokeh.models模块导入一个特殊的过程— FactorRange。让我们看看2014年国家名单中麻疹、脊髓灰质炎和艾滋病毒/艾滋病*1000的数据。</p><pre class="ms mt mu mv gt nb nc nd ne aw nf bi"><span id="a327" class="kv kw jg nc b gy ng nh l ni nj">from bokeh.models import FactorRange</span><span id="cd44" class="kv kw jg nc b gy nk nh l ni nj">#List of used statistics</span><span id="ed00" class="kv kw jg nc b gy nk nh l ni nj">stats = ['measles','polio','hiv/aids*1000']</span><span id="d098" class="kv kw jg nc b gy nk nh l ni nj">#Creating a dictionary of our data</span><span id="db6d" class="kv kw jg nc b gy nk nh l ni nj">mdata = {'countries' : countries,<br/>        'measles'   : data[data['year']==2014][data['country'].isin(countries)]['measles'],<br/>        'polio'   : data[data['year']==2014][data['country'].isin(countries)]['polio'],<br/>        'hiv/aids*1000'   : data[data['year']==2014][data['country'].isin(countries)]['hiv/aids']*1000}</span><span id="4fb3" class="kv kw jg nc b gy nk nh l ni nj"># Creating tuples for individual bars [ ("France", "measles"), ("France", "polio"), ("France", "hiv/aids*1000"), ("Canada", "measles"), ... ]</span><span id="7cc5" class="kv kw jg nc b gy nk nh l ni nj">x = [ (country, stat) for country in countries for stat in stats ]<br/>counts = sum(zip(mdata['measles'], mdata['polio'], mdata['hiv/aids*1000']), ())</span><span id="ad1d" class="kv kw jg nc b gy nk nh l ni nj">#Creating a column data source - Bokeh's own data type with the fields (Country,[stats],[values],[colors]) </span><span id="2088" class="kv kw jg nc b gy nk nh l ni nj">source = ColumnDataSource(data=dict(x=x, counts=counts, color=random.sample(Turbo256,15)))</span><span id="23b6" class="kv kw jg nc b gy nk nh l ni nj">#Initializing our plot</span><span id="c3fe" class="kv kw jg nc b gy nk nh l ni nj">p = figure(x_range=FactorRange(*x), plot_height=350, title="Health Stats by Country")</span><span id="5082" class="kv kw jg nc b gy nk nh l ni nj">#Plotting our vertical bar chart</span><span id="d69f" class="kv kw jg nc b gy nk nh l ni nj">p.vbar(x='x', top='counts', width=0.9  ,fill_color='color',  source=source)</span><span id="6026" class="kv kw jg nc b gy nk nh l ni nj">#Enhancing our graph</span><span id="e782" class="kv kw jg nc b gy nk nh l ni nj">p.y_range.start = 0<br/>p.x_range.range_padding = 0.1<br/>p.xaxis.major_label_orientation = .9<br/>p.xgrid.grid_line_color = None</span><span id="aaec" class="kv kw jg nc b gy nk nh l ni nj">show(p)</span></pre><p id="67cf" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">情节是这样的:</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/a30ae8c166dd4efc6b5a15513e65e91f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tL0bdzdQRncfI3OGNxl9nA.png"/></div></div></figure><p id="ff56" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">我们也可以使用无数种可能的内置方法来根据我们的喜好调整视觉效果。</p><h2 id="9e69" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">颜色转换</h2><p id="eb4d" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">我们经常对预设或随机的调色板不满意，我们需要使用一些额外的色彩映射。我们用bokeh.transform模块导入的factor_cmap函数就是这种情况。我们来看看加拿大分别在2000年、2005年、2010年和2015年的麻疹、脊髓灰质炎和艾滋病*1000的数据。</p><pre class="ms mt mu mv gt nb nc nd ne aw nf bi"><span id="d969" class="kv kw jg nc b gy ng nh l ni nj">from bokeh.transform import factor_cmap</span><span id="bf93" class="kv kw jg nc b gy nk nh l ni nj">#List of used statistics</span><span id="5960" class="kv kw jg nc b gy nk nh l ni nj">stats = ['measles','polio','hiv/aids*1000']<br/>years = ['2000','2005','2010','2015']</span><span id="6869" class="kv kw jg nc b gy nk nh l ni nj">#Creating a dictionary of our data</span><span id="b278" class="kv kw jg nc b gy nk nh l ni nj">mdata = {'years' : years,<br/>        'measles'   : data[data['country']=="Canada"][data['year'].isin(years)]['measles'],<br/>        'polio'   : data[data['country']=="Canada"][data['year'].isin(years)]['polio'],<br/>        'hiv/aids*1000'   : data[data['country']=="Canada"][data['year'].isin(years)]['hiv/aids']*1000}</span><span id="35f7" class="kv kw jg nc b gy nk nh l ni nj"># Creating tuples for individual bars </span><span id="fe2e" class="kv kw jg nc b gy nk nh l ni nj">x = [ (year, stat) for year in years for stat in stats ]<br/>counts = sum(zip(mdata['measles'], mdata['polio'], mdata['hiv/aids*1000']), ())</span><span id="2db2" class="kv kw jg nc b gy nk nh l ni nj">#Creating a column data source  </span><span id="1615" class="kv kw jg nc b gy nk nh l ni nj">source = ColumnDataSource(data=dict(x=x, counts=counts, color=random.sample(Turbo256,12)))</span><span id="f84a" class="kv kw jg nc b gy nk nh l ni nj">#Initializing our plot with random colors</span><span id="f93d" class="kv kw jg nc b gy nk nh l ni nj">p1 = figure(x_range=FactorRange(*x), plot_height=350, title="Health Stats in Canada 2000-2015")</span><span id="2f44" class="kv kw jg nc b gy nk nh l ni nj">#Plotting our vertical bar chart</span><span id="5285" class="kv kw jg nc b gy nk nh l ni nj">p1.vbar(x='x', top='counts', width=0.9  ,fill_color='color',  source=source)</span><span id="6747" class="kv kw jg nc b gy nk nh l ni nj">#Enhancing our graph</span><span id="dd4b" class="kv kw jg nc b gy nk nh l ni nj">p1.y_range.start = 0<br/>p1.x_range.range_padding = 0.1<br/>p1.xaxis.major_label_orientation = .9<br/>p1.xgrid.grid_line_color = None</span><span id="f944" class="kv kw jg nc b gy nk nh l ni nj">#Creating a new column data source without set colors <br/>  <br/>source1 = ColumnDataSource(data=dict(x=x, counts=counts))</span><span id="ff23" class="kv kw jg nc b gy nk nh l ni nj">#Initializing our plot with synchronized fill colors with factor_cmap</span><span id="4b39" class="kv kw jg nc b gy nk nh l ni nj">p2 = figure(x_range=FactorRange(*x), plot_height=350,<br/>            title="Health Stats in Canada 2000-2015, color mapped"<br/>           )</span><span id="bf16" class="kv kw jg nc b gy nk nh l ni nj">p2.vbar(x='x', top='counts', width=0.9,<br/>        source=source1,<br/>       fill_color=factor_cmap('x', palette=['salmon', 'green', 'navy'], <br/>factors=stats, start=1, end=2)</span><span id="7349" class="kv kw jg nc b gy nk nh l ni nj">)</span><span id="2e78" class="kv kw jg nc b gy nk nh l ni nj">p2.xaxis.major_label_orientation = .7<br/>p=gridplot([[p1,None],[p2,None]], toolbar_location='right')</span><span id="6e71" class="kv kw jg nc b gy nk nh l ni nj">show(p)</span></pre><p id="e4b0" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">我们在这里——第一个图表有一些随机的颜色，第二个是颜色因素:</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/09bf6632f34b14559ec7a297ad9fa891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-4-iHdGD-Sn-PO-mQ8H3IA.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/66dc524aa25b8c7b2a870e5b9e20a589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zmUk2dZ8k9Lk1ERJluf6Hg.png"/></div></div></figure><p id="a8c1" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">尽管第一个看起来更怪异，但第二个在色彩映射统计时有更清晰的信息。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h2 id="89ba" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">向视觉效果添加标签</h2><p id="a9e8" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">在散景中绘制单个标签非常简单，不需要任何特殊的技巧。我们只需要从bokeh.models.annotations模块导入Label类，它的语法非常简单。人们只需要知道散景使用一个单独的图层来绘图，另一个图层来标记，等等。我们将使用add_layer()方法来组装我们的视觉效果。让我们看一个例子，并创建一个2000-2015年西班牙麻疹的图表。</p><pre class="ms mt mu mv gt nb nc nd ne aw nf bi"><span id="146f" class="kv kw jg nc b gy ng nh l ni nj">from bokeh.models.annotations import Label</span><span id="1552" class="kv kw jg nc b gy nk nh l ni nj">#Initializing our plot</span><span id="b2cd" class="kv kw jg nc b gy nk nh l ni nj">p = figure(x_range=(2000,2015), title='Measles in Spain 2000-2015')</span><span id="3896" class="kv kw jg nc b gy nk nh l ni nj">#Plotting a line</span><span id="9c0e" class="kv kw jg nc b gy nk nh l ni nj">p.line(data[data['country']=='Spain']['year'],<br/>      data[data['country']=='Spain']['measles'],<br/>       line_color='navy',<br/>      line_width=3)</span><span id="677d" class="kv kw jg nc b gy nk nh l ni nj">#Plotting data points as cirles</span><span id="cbe8" class="kv kw jg nc b gy nk nh l ni nj">p.circle(data[data['country']=='Spain']['year'],<br/>      data[data['country']=='Spain']['measles'],<br/>        radius=.2,<br/>        fill_color='yellow',<br/>        line_color='salmon')</span><span id="b715" class="kv kw jg nc b gy nk nh l ni nj">#Instance of Label class as our 2011 Measles Outbreak label</span><span id="b19f" class="kv kw jg nc b gy nk nh l ni nj">label = Label(x=2011, <br/>              y=max(data[data['country']=='Spain']['measles']),<br/>              x_offset=10, <br/>              text="2011 Outbreak",<br/>              text_baseline="top")</span><span id="7d15" class="kv kw jg nc b gy nk nh l ni nj">#Adding a layout with our label to the graph</span><span id="77de" class="kv kw jg nc b gy nk nh l ni nj">p.add_layout(label)</span><span id="0b7c" class="kv kw jg nc b gy nk nh l ni nj">#Styling the graph</span><span id="1253" class="kv kw jg nc b gy nk nh l ni nj">p.xaxis.axis_label = 'Year'<br/>p.yaxis.axis_label = 'Measles stats'<br/>p.xgrid.grid_line_dash = 'dashed'<br/>p.xgrid.grid_line_color ='gray'<br/>p.ygrid.grid_line_dash ='dotted'<br/>p.ygrid.grid_line_color = 'gray'<br/>p.background_fill_color='green'<br/>p.background_fill_alpha=.05</span><span id="f082" class="kv kw jg nc b gy nk nh l ni nj">show(p)</span></pre><p id="2b5c" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">瞧啊。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/18074e13b045bbe6fb4c523ef279dab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wtvAxrrhcpnlcaH6K4JHHw.png"/></div></div></figure><p id="3ed3" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">添加一个“自定义”标签真的很简单。散景的美妙之处在于，添加一整套标签并没有多一点困难。让我们看看2000-2015年印度的脊髓灰质炎的例子，并尝试给每个数据点添加值。我们只需要使用ColumnDataSource类的一个实例，并从bokeh.models模块导入LabelSet类。</p><pre class="ms mt mu mv gt nb nc nd ne aw nf bi"><span id="da88" class="kv kw jg nc b gy ng nh l ni nj">from bokeh.models import LabelSet</span><span id="d40c" class="kv kw jg nc b gy nk nh l ni nj">#Instance of ColumnDataSource</span><span id="f2e2" class="kv kw jg nc b gy nk nh l ni nj">source = ColumnDataSource(data=dict(<br/>    x=data[data['country']=='India']['year'],<br/>    y=data[data['country']=='India']['polio'],<br/>    labels=data[data['country']=='India']['polio'].values))</span><span id="b6c2" class="kv kw jg nc b gy nk nh l ni nj">#Initializing our plot</span><span id="c22e" class="kv kw jg nc b gy nk nh l ni nj">p = figure(x_range=(1999,2016),<br/>           y_range=(50,90),<br/>           title='Polio in India 2000-2015')</span><span id="f3fb" class="kv kw jg nc b gy nk nh l ni nj">#Plotting data points as vertical bars</span><span id="e577" class="kv kw jg nc b gy nk nh l ni nj">p.vbar(x = 'x',<br/>         top = 'y',<br/>       width = .8,<br/>        fill_color='azure', fill_alpha = 1,<br/>        line_color='navy', line_alpha=.25,<br/>         line_width=2, line_dash='dotted',<br/>        source=source)</span><span id="7a75" class="kv kw jg nc b gy nk nh l ni nj">#Plotting a line</span><span id="7201" class="kv kw jg nc b gy nk nh l ni nj">p.line(x = 'x',<br/>       y = 'y',<br/>       line_color='red',line_width=4,<br/>       line_alpha=.5,<br/>      source=source)</span><span id="0b7e" class="kv kw jg nc b gy nk nh l ni nj">#Plotting data points as circles</span><span id="817b" class="kv kw jg nc b gy nk nh l ni nj">p.circle(x='x',y='y', <br/>         radius=.2, <br/>         fill_color='yellow', line_color='red', line_width=2,<br/>         source=source)</span><span id="0f39" class="kv kw jg nc b gy nk nh l ni nj">#Instance of the LabelSet class</span><span id="fe54" class="kv kw jg nc b gy nk nh l ni nj">labels = LabelSet(x='x',            #positions of labeled datapoints<br/>                  y='y', <br/>                  text='labels',          #labels' text<br/>                  level='glyph',          #labeling level<br/>                 x_offset=-10, y_offset=15, #move from datapoints<br/>                  source=source, <br/>                  render_mode='canvas',<br/>                 text_baseline='bottom'   #relative position to datapoints<br/>                 )</span><span id="3772" class="kv kw jg nc b gy nk nh l ni nj">p.add_layout(labels)</span><span id="a06c" class="kv kw jg nc b gy nk nh l ni nj">p.xaxis.axis_label = 'Year'<br/>p.yaxis.axis_label = 'Measles stats'<br/>p.xgrid.grid_line_dash = 'dashed'<br/>p.xgrid.grid_line_color ='gray'<br/>p.ygrid.grid_line_dash ='dotted'<br/>p.ygrid.grid_line_color = 'gray'<br/>p.background_fill_color='salmon'<br/>p.background_fill_alpha=.05</span><span id="138a" class="kv kw jg nc b gy nk nh l ni nj">show(p)</span></pre><p id="ac29" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">就是这样:</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/448c37160e66d2cb36ba2d921d627d6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nGXlvAG2pfqYtILfL9NjbA.png"/></div></div></figure></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h2 id="5f91" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">其他互动技术</h2><p id="138e" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">有相当多的其他互动技术可以真正重塑你的形象，给你的数据驱动的故事一个全新的维度。仅举几个例子——与平移链接、与刷动链接、悬停等。其中一些在Github上相应的<a class="ae jd" href="https://github.com/ikviatkovski/Bokeh_Demo_Project/blob/master/Code/3%20Bar%20Charts%20and%20Enhancement%20Techniques.ipynb" rel="noopener ugc nofollow" target="_blank">项目的笔记本</a>中有说明。</p><p id="7855" class="pw-post-body-paragraph lr ls jg lt b lu mw kh lw lx mx kk lz le my mb mc li mz me mf lm na mh mi mj ij bi translated">散景确实是灵感的无尽源泉。我对它的简单性、流畅的学习曲线和精彩的互动视觉效果赞不绝口。！</p></div></div>    
</body>
</html>