<html>
<head>
<title>Why and When to Avoid S3 as a Data Platform for Data Lakes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么以及何时避免将S3作为数据湖的数据平台</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-and-when-to-avoid-s3-as-a-data-platform-for-data-lakes-c802947664e4?source=collection_archive---------3-----------------------#2020-03-24">https://towardsdatascience.com/why-and-when-to-avoid-s3-as-a-data-platform-for-data-lakes-c802947664e4?source=collection_archive---------3-----------------------#2020-03-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="2060" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如今，数据湖在大型企业中风靡一时。数据湖是源系统数据的原始副本和转换数据的单一存储，用于报告、可视化、高级分析和机器学习等任务。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/236457e3e4f224dd91da0cdf81227ff6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*W0tiY_P8UcsMquoHcjBRVg.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图1:数据湖生态系统</p></figure><p id="2807" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对象存储(如S3)正成为数据湖的首选平台，这有两个主要原因:</p><ul class=""><li id="e0b9" class="la lb it js b jt ju jx jy kb lc kf ld kj le kn lf lg lh li bi translated">它们在云中提供廉价、耐用和几乎无限的存储</li><li id="f96a" class="la lb it js b jt lj jx lk kb ll kf lm kj ln kn lf lg lh li bi translated">它们实现了计算和存储的分离，允许其中任何一个独立扩展</li></ul><p id="6914" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇博文中，我将深入探讨对象存储的一些优势，这些优势是它们作为数据湖平台受欢迎的原因。我还将研究一些经常被低估的挑战，这些挑战困扰着许多数据湖用例中对象存储的使用。</p><h1 id="b816" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">对象存储的好处:耐用、便宜、几乎无限的存储空间</h1><p id="b795" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">像S3这样的对象商店提供11个9的耐用性(99.9999999999%)和4个9的可用性(99.99%)，并且他们设法以几乎无限的规模做到这一点，价格低得令人难以置信，大约为每月23美元/TB。相比之下，本地数据仓库设备(DWA)在几年前非常流行。不包括企业支持，DWA的成本为每TB数万美元。数百万美元的DWA合同通常只支持几百兆字节。</p><p id="ec79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当IT领导考虑为他们的数据湖选择数据平台时，对象存储每月23美元的价格实在太诱人了。对于数据湖预计要容纳的大量数据(从数百TB到数Pb ),使用最便宜的存储是有意义的。像S3这样的对象商店看起来(不正确，我们将在本文后面看到)比许多大型企业仍在使用的DWA具有千倍的价格优势。</p><h1 id="38d4" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">对象存储的好处:存储和计算的分离</h1><p id="dae7" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">数据湖所需的存储规模使得使用像DWA这样将存储和计算结合在一个包中的体系结构极其昂贵。通过将存储和计算分离开来，我们可以在任何给定时间将适量的按需计算用于需要分析的数据。这大大降低了数据分析解决方案的总体成本。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/bf333bc6273c7c0a554036cec4be12b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*W47utNgyziGwYYqFPyHYrA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图2:存储和计算的分离</p></figure><p id="19db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">可以理解，所有这些优势对于推动S3和其他对象存储作为数据湖平台的流行至关重要。但是对象存储带来了许多没有得到足够重视的挑战。对于来源于RDBMS且经常刷新(每天/每小时)的数据来说尤其如此，这些数据构成了企业中高质量数据的主体。</p><h1 id="2eb5" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">对象存储的缺点:不变性</h1><p id="86d1" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">所有对象存储，包括S3、GCS和Azure Blob存储，都是不可变的。这意味着文件一旦写入对象存储，就永远无法编辑。用户只能硬删除旧文件并创建新文件，或者逻辑删除旧文件并创建新文件(版本控制)。</p><p id="8790" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当使用S3作为来自RDBMS的、频繁刷新的数据的数据平台时，这导致为每个表创建大量的小文件。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/0fa1dda14b882c5338c70e91da2124b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*yMVqhdoNrX6Ys49Qg7gHXw.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图3:来源于RDBMS的数据的许多小文件的问题</p></figure><p id="45dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">随着时间的推移，插入、更新和删除操作越来越多，试图获得表的当前状态变得更加耗费时间和计算。大多数数据科学家回避这项复杂的任务，而是要求直接访问源系统，这违背了使用数据湖的初衷。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/0de62903e1380b9dfdcfd045e4fa2142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*UzELGwoVlOT7SH0pkJmm_w.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图4:在S3上使用原始变更集的问题</p></figure><p id="4d59" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">U =更新，I =插入，D =删除</p><h1 id="4c64" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">解决方案，第1部分:数据分区</h1><p id="8347" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">一种解除最终用户合并变更的责任的解决方案是对数据进行分区，然后重写最近插入、更新和删除所针对的分区。这在一定程度上减轻了最终用户的负担。但是，性能问题仍然存在，特别是如果表有大量的列，而分析只需要这些列的一个子集。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/7ed80c57bd53df7deab4bf8bfef21378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*7GXmymdp2YLpSkcx01yQ-w.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图5:使用分区合并变更集</p></figure><h1 id="f7a4" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">解决方案，第2部分:使用列存储</h1><p id="612a" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">上述解决方案可以通过使用像<a class="ae mr" href="https://parquet.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Parquet </a>或<a class="ae mr" href="https://orc.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache ORC </a>这样的列格式来改进。列格式通过更好的数据压缩和将I/O限制在分析所需的列上，显著提高了性能。然而，从各种语言和工具(如Python、R或Tableau)中读取Parquet文件仍然具有挑战性。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/765ae7efe44d980747c6d894a3c8ce10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*jHF110nVmvZHpgtHDU0SpQ.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图6:列存储有助于提高性能</p></figure><h1 id="57ff" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">解决方案，第3部分:使用SQL接口简化访问</h1><p id="d031" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">为了进一步构建这个解决方案，许多工程师在原始拼花文件上添加了SQL接口(如<a class="ae mr" href="https://aws.amazon.com/athena/" rel="noopener ugc nofollow" target="_blank"> AWS Athena </a>、<a class="ae mr" href="https://prestodb.io/" rel="noopener ugc nofollow" target="_blank"> Presto </a>或<a class="ae mr" href="https://spark.apache.org/sql/" rel="noopener ugc nofollow" target="_blank"> Spark SQL </a>)。这使得最终用户的数据访问更加简化，他们现在可以跨他们喜欢的编程语言和工具(如Python、R或Tableau)发出SQL查询。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/f702667773b86e2179a0bdf59176ce78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*kmh-cK7SKmUJDUjtfmVnGg.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图7: SQL接口简化了对数据湖中数据的访问</p></figure><h1 id="31fa" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">解决方案，第4部分:使用Delta Lake增加功能</h1><p id="cd90" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">上述解决方案可以通过使用类似于<a class="ae mr" href="https://delta.io/" rel="noopener ugc nofollow" target="_blank"> Delta Lake </a>的开源存储层来再次改进。Delta Lake进一步改进了Parquet格式，增加了对ACID(原子性、一致性、隔离性、持久性)事务的支持，支持流和批处理用例的lambda架构，以及访问上一次刷新日期/时间(时间旅行)的数据的能力。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/ca06e7927abd638740d21141081d2ede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*7rBtX_29XCEVLoDOdhYJNw.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图8: Delta Lake增加了事务、同步批处理和流用例，以及时间旅行</p></figure><h1 id="16f5" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">问题解决了？</h1><p id="0749" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">没那么快！上面的架构确实代表了一个可行的解决方案，许多企业为能够设计和实施这样的解决方案而沾沾自喜。公平地说，能够大规模实现这一目标是一项不小的成就。然而，这种架构仍然受到许多问题的困扰，有很大的改进空间。将S3顶部的三角洲湖作为数据湖平台的关键问题包括:</p><ul class=""><li id="3349" class="la lb it js b jt ju jx jy kb lc kf ld kj le kn lf lg lh li bi translated">该架构没有解决变更集的创建问题，而创建变更集是非常具有挑战性的</li><li id="240f" class="la lb it js b jt lj jx lk kb ll kf lm kj ln kn lf lg lh li bi translated">实现和支持企业级的弹性提取、转换和加载(ETL)解决方案非常复杂</li><li id="d24e" class="la lb it js b jt lj jx lk kb ll kf lm kj ln kn lf lg lh li bi translated">编写Parquet和Delta文件需要额外的计算和技术知识，以大规模配置和运行Apache Spark等集群计算平台</li><li id="4c1b" class="la lb it js b jt lj jx lk kb ll kf lm kj ln kn lf lg lh li bi translated">SQL接口访问(通过<a class="ae mr" href="https://aws.amazon.com/athena/" rel="noopener ugc nofollow" target="_blank"> AWS Athena </a>、<a class="ae mr" href="https://prestodb.io/" rel="noopener ugc nofollow" target="_blank"> Presto </a>或<a class="ae mr" href="https://spark.apache.org/sql/" rel="noopener ugc nofollow" target="_blank"> Spark SQL </a>等技术)需要额外的计算基础设施，从而增加了解决方案的整体复杂性和成本</li><li id="0165" class="la lb it js b jt lj jx lk kb ll kf lm kj ln kn lf lg lh li bi translated">该解决方案的复杂性使得支持成本高昂</li><li id="3fbe" class="la lb it js b jt lj jx lk kb ll kf lm kj ln kn lf lg lh li bi translated">S3提供有限的元数据和标记功能</li><li id="4ab9" class="la lb it js b jt lj jx lk kb ll kf lm kj ln kn lf lg lh li bi translated">在S3中集成对象的表级或行级安全性，特别是对于大型复杂的企业来说，可能相当具有挑战性</li><li id="eb74" class="la lb it js b jt lj jx lk kb ll kf lm kj ln kn lf lg lh li bi translated">最后但同样重要的是，这种平台的性能远远落后于它要取代的数据仓库设备的性能</li></ul><blockquote class="nd ne nf"><p id="dad5" class="jq jr ng js b jt ju jv jw jx jy jz ka nh kc kd ke ni kg kh ki nj kk kl km kn im bi translated">G <!-- -->考虑到隐藏的计算和支持成本、安全集成和性能问题，S3作为来自RDBMS、频繁刷新的数据的数据平台与其每月23美元/TB的承诺相去甚远。一旦我们将所有成本加起来，它就会开始攀升到每月每TB数千美元的范围内。对于这样的钱，有更好的选择。</p></blockquote><p id="dcd1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">云规模的托管分析数据库，如<a class="ae mr" href="https://www.snowflake.com/" rel="noopener ugc nofollow" target="_blank">雪花</a>、<a class="ae mr" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank">谷歌BigQuery </a>或<a class="ae mr" href="https://azure.microsoft.com/en-us/services/synapse-analytics/" rel="noopener ugc nofollow" target="_blank"> Azure Synapse Analytics </a>提供了两个世界的最佳选择。通过将存储和计算分开，它们提供了可与S3相媲美的存储成本，以及一个托管数据平台，该平台抽象出了实施云规模分析解决方案的复杂性。它们提供了与S3的Parquet/ORC/Delta Lake相似的TCO，具有AWS Athena/Presto/Spark SQL接口，同时拥有更好的性能、安全集成和模式支持。他们还降低了运营开销，同时将技术&amp;人才风险转移给第三方供应商。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nk"><img src="../Images/e339eb01f5cd085a6abb9ff26e7f413c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*XSQ-jy6xqcUz2QZJ7xm_QQ.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图9:托管分析数据库相对于“对象存储+ Delta Lake + SQL接口”解决方案的优势</p></figure><h1 id="0f71" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">那么来源于RDBMS的大部分静态数据呢？</h1><p id="6061" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">来源于RDBMS的大部分静态数据(即，它在几周或几个月内不会改变)不会像来源于RDBMS的频繁刷新的数据那样产生太多的ETL计算和支持开销。然而，我的建议是，对于此类使用情形，相比基于S3的Parquet/ORC/Delta Lake存储，更倾向于云规模的托管分析数据库，因为围绕元数据管理、安全集成和性能的所有挑战和成本仍然存在。</p><h1 id="f41a" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">半结构化数据呢？</h1><p id="4ce2" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">大多数进入企业的半结构化数据(通过XML、JSON和CSV之类的格式)都有一个相当稳定的模式，可以被吸收到关系表中。大企业中的大多数此类数据经常被分析数据库摄取，如<a class="ae mr" href="https://aws.amazon.com/redshift/" rel="noopener ugc nofollow" target="_blank"> AWS Redshift </a>或通过基于S3的Parquet/ORC/Delta Lake storage的SQL接口访问，如AWS Athena、Presto或Spark SQL。对于这种使用情形，我的建议是考虑将存储和计算分开的托管分析数据库。</p><h1 id="ddec" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">TCO应该是你的北极星</h1><p id="c518" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">最后，应该根据总拥有成本(TCO)来判断解决方案，考虑它们带来的功能和解决方案中固有的风险。如果两个解决方案具有相似的TCO，但其中一个提供了更好的功能，那么选择该解决方案应该是显而易见的。此外，应仔细考虑与内部开发的解决方案相关的技术和人才风险。一般来说，对于大型企业来说，在合理的情况下，将技术和人才风险转移给声誉良好的供应商产品更有意义。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/9ad9fc87985f6908b10da85e5ef76945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*wc2ARN8ZKwFQF5xjxKgX7g.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图10:平衡TCO、性能、特性和风险</p></figure><h1 id="5383" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">那么什么时候对象存储作为数据湖平台有用呢？</h1><p id="4698" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">对象存储(如S3)仍然是其他用例的优秀数据平台，如半结构化和非结构化数据，这些数据不能或不应该(出于成本或效用原因)被吸收到云规模的分析数据库中。例如，将图像、音频文件、视频、电子邮件、PowerPoint演示文稿、Word文档或pdf导入托管分析数据库是没有意义的。此外，许多云计算规模的分布式数据库使用对象存储(如S3)作为数据接收接口，有些甚至使用对象存储作为后台内部管理的存储平台。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nm"><img src="../Images/a8ba452bea3c4e73fff21b169c52a4b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0RrUzMvYnrwHcmi4gaYwEw.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">表1:建议</p></figure><p id="f33a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在未来的帖子中，我们将深入讨论为什么将存储和计算分开的云规模托管分析数据库(如<a class="ae mr" href="https://www.snowflake.com/" rel="noopener ugc nofollow" target="_blank">雪花</a>、<a class="ae mr" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank">谷歌BigQuery </a>或<a class="ae mr" href="https://azure.microsoft.com/en-us/services/synapse-analytics/" rel="noopener ugc nofollow" target="_blank"> Azure Synapse Analytics </a>)与专门构建的CDC工具(如<a class="ae mr" href="https://www.qlik.com/us/products/qlik-replicate" rel="noopener ugc nofollow" target="_blank"> Qlik Replicate </a>、<a class="ae mr" href="https://www.oracle.com/middleware/technologies/goldengate.html" rel="noopener ugc nofollow" target="_blank"> Oracle GoldenGate </a>或<a class="ae mr" href="https://www.hvr-software.com/product/change-data-capture/" rel="noopener ugc nofollow" target="_blank"> HVR CDC </a>)更适合企业数据湖中以RDBMS为来源、频繁刷新的数据。</p><p id="a298" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ng">免责声明:这是个人博文。这里表达的观点代表我自己的观点，不代表我现在或以前的雇主的观点。所有内容仅用于教育目的，不保证适用性。</em></p></div></div>    
</body>
</html>