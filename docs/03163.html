<html>
<head>
<title>Exploratory Data Analysis(EDA) with PySpark on Databricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PySpark在数据块上进行探索性数据分析(EDA)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploratory-data-analysis-eda-with-pyspark-on-databricks-e8d6529626b1?source=collection_archive---------9-----------------------#2020-03-26">https://towardsdatascience.com/exploratory-data-analysis-eda-with-pyspark-on-databricks-e8d6529626b1?source=collection_archive---------9-----------------------#2020-03-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq"><p id="2785" class="jr js it bd jt ju jv jw jx jy jz ka dk translated">再见，熊猫们…</p></blockquote><figure class="kc kd ke kf kg kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kb"><img src="../Images/26481c05c0928178bd804c3b04f408c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*taM2IkQtZ6hRKn5W"/></div></div><p class="ko kp gj gh gi kq kr bd b be z dk translated">由<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ks" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> chuttersnap </a>拍摄</p></figure><p id="59bb" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">EDA加spark的意思是和熊猫说拜拜。由于数据规模大，每次计算都必须并行化，而不是<strong class="kv iu"> <em class="lq">熊猫</em> </strong>，<strong class="kv iu"><em class="lq">pyspark . SQL . functions</em></strong>才是你可以使用的合适工具。毫无疑问，它正在努力改变你争论数据的旧习惯。我希望这篇文章可以给你一个用Spark执行EDA的跳跃性开始。</p><p id="dd07" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">有两种变量，连续变量和分类变量。每种技术都有不同的EDA要求:</p><p id="b4f1" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">连续变量EDA列表:</p><ul class=""><li id="47f4" class="lr ls it kv b kw kx la lb le lt li lu lm lv ka lw lx ly lz bi translated">缺少值</li><li id="80e5" class="lr ls it kv b kw ma la mb le mc li md lm me ka lw lx ly lz bi translated">统计值:平均值、最小值、最大值、标准差、分位数</li><li id="2f8c" class="lr ls it kv b kw ma la mb le mc li md lm me ka lw lx ly lz bi translated">宁滨和分销</li><li id="57d1" class="lr ls it kv b kw ma la mb le mc li md lm me ka lw lx ly lz bi translated">相互关系</li></ul><p id="4f7c" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">分类变量EDA列表:</p><ul class=""><li id="5f22" class="lr ls it kv b kw kx la lb le lt li lu lm lv ka lw lx ly lz bi translated">缺少值</li><li id="f5e1" class="lr ls it kv b kw ma la mb le mc li md lm me ka lw lx ly lz bi translated">频率表</li></ul><p id="8d9f" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">我还将展示如何在没有任何绘图库(如seaborn或matplotlib)的情况下在Databricks上生成图表。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="9eec" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">首先，让我们加载数据。我使用的数据来自一个Kaggle竞赛，桑坦德客户交易预测。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="4ba7" class="mv mw it mr b gy mx my l mz na"># It's always best to manually write the Schema, I am lazy here</span><span id="533c" class="mv mw it mr b gy nb my l mz na">df = (spark<br/>  .read                                              <br/>  .option("inferSchema","true")                 <br/>  .option("header","true")                           <br/>  .csv("/FileStore/tables/train.csv"))</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="2818" class="nc mw it bd nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny bi translated">连续变量的EDA</h1><p id="f694" class="pw-post-body-paragraph kt ku it kv b kw nz ky kz la oa lc ld le ob lg lh li oc lk ll lm od lo lp ka im bi translated">内置函数describe()非常有用。它计算选定变量的计数、平均值、标准偏差、最小值和最大值。例如:</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="e97b" class="mv mw it mr b gy mx my l mz na">df.select('var_0').describe().show()</span></pre><figure class="mm mn mo mp gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oe"><img src="../Images/dbf986a57a49e90b9064c0d3736883b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LKZj6NN7XxUXTQhV85GI9Q.png"/></div></div></figure><p id="a49b" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">但是，当您计算多个变量的统计值时，显示的数据框可能不便于检查，如下所示:</p><figure class="mm mn mo mp gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi of"><img src="../Images/0e6cd35cc2d5e7e1151c68411bd32419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j6pk35_gy8Pbjg396p25ng.png"/></div></div></figure><p id="a7a4" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">记得我们之前说过不要用熊猫来做计算。但是，我们仍然可以用它来显示结果。这里，spark数据框架中内置的describe()函数已经完成了统计值的计算。计算出的汇总表大小不大。所以我们可以用熊猫来展示它。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="8b86" class="mv mw it mr b gy mx my l mz na">df.select('var_0','var_1','var_2','var_3','var_4','var_5','var_6','var_7','var_8','var_9','var_10','var_11','var_12','var_13','var_14').describe().toPandas()</span></pre><figure class="mm mn mo mp gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi og"><img src="../Images/6219a7af8348f4fde921bb768f88cb77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FLXa1QXAO7i6ZoW8qPwhHg.png"/></div></div></figure><p id="aa5b" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated"><strong class="kv iu"> <em class="lq">获取分位数:</em> </strong></p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="42b5" class="mv mw it mr b gy mx my l mz na">quantile = df.approxQuantile(['var_0'], [0.25, 0.5, 0.75], 0)<br/>quantile_25 = quantile[0][0]<br/>quantile_50 = quantile[0][1]<br/>quantile_75 = quantile[0][2]<br/>print('quantile_25: '+str(quantile_25))<br/>print('quantile_50: '+str(quantile_50))<br/>print('quantile_75: '+str(quantile_75))</span><span id="8bd8" class="mv mw it mr b gy nb my l mz na">'''<br/>quantile_25: 8.4537 <br/>quantile_50: 10.5247 <br/>quantile_75: 12.7582<br/>'''</span></pre><p id="a8ff" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated"><strong class="kv iu"> <em class="lq">检查缺失:</em> </strong></p><p id="9e55" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">引入两个函数来做过滤</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="4534" class="mv mw it mr b gy mx my l mz na"># where<br/>df.where(col("var_0").isNull()).count()<br/># filter<br/>df.filter(col("var_0").isNull()).count()</span></pre><p id="3229" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">这两个是一样的。根据spark文档，“where”是“filter”的别名。</p><p id="e0b6" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated"><strong class="kv iu"><em class="lq"/></strong></p><p id="89bc" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">对于连续变量，有时我们希望对它们进行分类，并检查这些分类的分布。例如，在金融相关数据中，我们可以将FICO分数(通常范围为650到850)归入不同的类别。每个桶有25的间隔。比如650–675，675–700，700–725，…然后检查每个桶里有多少人。</p><p id="944d" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">现在让我们用“var_0”来举一个宁滨的例子。根据以前的统计值，我们知道“var_0”的范围是从0.41到20.31。所以我们创建一个0到21的列表，间隔为0.5。</p><figure class="mm mn mo mp gt kh"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="2b77" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated"><strong class="kv iu"> <em class="lq">关联:</em> </strong></p><figure class="mm mn mo mp gt kh"><div class="bz fp l di"><div class="oh oi l"/></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="3f56" class="nc mw it bd nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny bi translated">分类变量的EDA</h1><p id="2e11" class="pw-post-body-paragraph kt ku it kv b kw nz ky kz la oa lc ld le ob lg lh li oc lk ll lm od lo lp ka im bi translated">检查缺失值，和连续变量一样。</p><p id="73ef" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">要查看频率表:</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="1961" class="mv mw it mr b gy mx my l mz na">freq_table = df.select(col("target").cast("string")).groupBy("target").count().toPandas()</span></pre><figure class="mm mn mo mp gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oj"><img src="../Images/4942f750cfb9ae2514e4e8ad67fbf2a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_9rO8bTWS_dTYEkoP1Eapw.png"/></div></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="71e9" class="nc mw it bd nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny bi translated">数据块上的可视化</h1><p id="754a" class="pw-post-body-paragraph kt ku it kv b kw nz ky kz la oa lc ld le ob lg lh li oc lk ll lm od lo lp ka im bi translated">Databricks实际上提供了一个“类似Tableau”的可视化解决方案。display()函数为您提供了一个友好的用户界面来生成您喜欢的任何图形。</p><p id="aafd" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">例如:</p><figure class="mm mn mo mp gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ok"><img src="../Images/3c78c9383e782631670af14ea3f34e67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QlhV6GdCabAp0hpjHIeoaQ.png"/></div></div></figure><p id="8720" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">选择所需的图表类型。</p><figure class="mm mn mo mp gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ol"><img src="../Images/aed6a3205be984e6b243e5f1595e5345.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nzx8hkD6LPh2JsCD8WAkSw.png"/></div></div></figure><p id="545f" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated">您也可以创建包含多个变量的图表。点击“绘图选项”按钮。您可以根据需要修改图:</p><figure class="mm mn mo mp gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi om"><img src="../Images/3d656d7b83f832ea7ef4582a6400edd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dev3Mzn_z7PTryj_0167ww.png"/></div></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="58b9" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ka im bi translated"><em class="lq">如果喜欢讨论更多，在</em> <a class="ae ks" href="https://www.linkedin.com/in/yi-cao-data/" rel="noopener ugc nofollow" target="_blank"> <em class="lq"> LinkedIn </em> </a> <em class="lq">上找我。</em></p></div></div>    
</body>
</html>