<html>
<head>
<title>A Layman’s Guide for Data Scientists to create APIs in minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学家在几分钟内创建API的外行指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-layman-guide-for-data-scientists-to-create-apis-in-minutes-31e6f451cd2f?source=collection_archive---------9-----------------------#2020-06-21">https://towardsdatascience.com/a-layman-guide-for-data-scientists-to-create-apis-in-minutes-31e6f451cd2f?source=collection_archive---------9-----------------------#2020-06-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/26a9b9fba765c1405f1be95649d46597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RhmHIFhsgKI2psk6lVOCww.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图片由<a class="ae jg" href="https://pixabay.com/users/intographics-2633886/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1690452" rel="noopener ugc nofollow" target="_blank">转化为图形</a>来自<a class="ae jg" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1690452" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><div class=""/><div class=""><h2 id="cfb6" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">API创建变得简单了</h2></div><p id="40b3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您是否曾经遇到过这样的情况:您希望将您的模型预测提供给前端开发人员，而他们却无法访问与模型相关的代码？或者有没有开发人员要求您创建一个他们可以使用的API？我已经面对过很多次了。</p><p id="f45a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随着数据科学和Web开发人员试图合作，API成为使代码和技能更加模块化的难题的重要部分。事实上，同样地，不能指望数据科学家对Javascript或nodeJS了解很多，前端开发人员应该能够在不了解任何数据科学语言的情况下应付过去。API在这个抽象中扮演了相当重要的角色。</p><p id="8804" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，API令人困惑。我自己在创建它们并与我的开发团队分享它们时也感到很困惑，我的开发团队使用他们的API术语，如GET request、PUT request、endpoint、Payloads等。</p><p id="a97e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="lu">这篇文章将会简化和理解API是如何工作的，解释上面的一些术语，并使用优秀的API构建框架FastAPI创建一个API，这使得创建API变得轻而易举。</em> </strong></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cdd9" class="mc md jj bd me mf mg mh mi mj mk ml mm kp mn kq mo ks mp kt mq kv mr kw ms mt bi translated">什么是API？</h1><p id="a8c8" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在我们继续深入之前，我们需要理解什么是API。根据维基百科:</p><blockquote class="mz na nb"><p id="ebaa" class="ky kz lu la b lb lc kk ld le lf kn lg nc li lj lk nd lm ln lo ne lq lr ls lt im bi translated">一个<strong class="la jk">应用编程接口</strong> ( <strong class="la jk"> API </strong>)是一个<a class="ae jg" href="https://en.wikipedia.org/wiki/Interface_(computing)" rel="noopener ugc nofollow" target="_blank">计算接口</a>，它定义了多个软件中介之间的交互。它定义了可以进行的调用或请求的种类、如何进行、应该使用的数据格式、应该遵循的约定等等。</p></blockquote><p id="4860" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">我喜欢理解API的方式是它是一个“在线函数”，一个我可以在线调用的函数。</em></p><p id="4624" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如:</p><p id="032b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我可以有一个电影API，当我将“动画”类型作为输入时，它会返回戏剧电影的名称。</p><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/61734a0c9eadc2e780415a412350abab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*r6cfZ3DWKHCe_6aEgFGcsg.png"/></div></figure><p id="2245" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用这种机制的好处是，API用户不必访问整个数据集或源代码，但他们可以获得他们需要的所有信息。  <em class="lu">这是互联网上有多少服务像</em> <a class="ae jg" href="https://aws.amazon.com/rekognition/" rel="noopener ugc nofollow" target="_blank"> <em class="lu">亚马逊Rekognition </em> </a> <em class="lu">，是一个图像和视频API，或者</em> <a class="ae jg" href="https://cloud.google.com/natural-language/pricing" rel="noopener ugc nofollow" target="_blank"> <em class="lu">谷歌自然语言API </em> </a> <em class="lu">，是一个NLP API作品。它们让我们可以使用一些很棒的功能，却不让我们拥有源代码，而源代码通常是很有价值的，而且是隐藏的。例如，我可以将一张图像发送到亚马逊Rekognition API，它可以为我提供人脸检测和分析。</em></p><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nk"><img src="../Images/3b70a0165b0014530d620953b00d51d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h1tXEQkpWcI3ZKMu.jpg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://aws.amazon.com/rekognition/?blog-cards.sort-by=item.additionalFields.createdDate&amp;blog-cards.sort-order=desc" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="a23c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，这里有一个由Open Movie DB提供的免费API，它允许我们使用参数搜索电影:</p><pre class="ng nh ni nj gt nl nm nn no aw np bi"><span id="182d" class="nq md jj nm b gy nr ns l nt nu"><a class="ae jg" href="http://www.omdbapi.com/?i=tt3896198&amp;apikey=9ea43e94" rel="noopener ugc nofollow" target="_blank">http://www.omdbapi.com/?i=tt3896198&amp;apikey=9ea43e94</a></span></pre><p id="766e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里我为电影《银河护卫队2》提供了IMDB id，使用了API的参数<code class="fe nv nw nx nm b">i</code>。如果您在浏览器中打开此链接，您将看到电影的所有信息，如打开的电影数据库所示</p><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ny"><img src="../Images/d3aa2e9e6338e2b737c964fe8ecbf105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pvIcnQIJFlEGasGhUqwn3Q.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来自OMDB的输出</p></figure><p id="d20d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但在我们继续之前，让我们先了解一些术语:</p><ul class=""><li id="ae42" class="nz oa jj la b lb lc le lf lh ob ll oc lp od lt oe of og oh bi translated"><strong class="la jk">端点:</strong>以上API调用中，端点为:<code class="fe nv nw nx nm b">http://www.omdbapi.com/</code>。简单地说，这就是函数代码运行的位置。</li><li id="a66d" class="nz oa jj la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated">API访问键:大多数公共API都会有一些访问键，你可以请求。对于OMDB API，我必须注册并获得API密钥<code class="fe nv nw nx nm b"><a class="ae jg" href="http://www.omdbapi.com/?i=tt3896198&amp;apikey=9ea43e94" rel="noopener ugc nofollow" target="_blank">9ea43e94</a></code>。</li><li id="f53f" class="nz oa jj la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated"><code class="fe nv nw nx nm b"><strong class="la jk">?</strong></code> <strong class="la jk">操作符:</strong>该操作符用于指定我们想要发送给API或我们的“在线函数”的参数这里我们给API两个参数，即IMDB电影ID和使用<code class="fe nv nw nx nm b">?</code>操作符的API访问密钥。由于有多个输入，我们也使用<code class="fe nv nw nx nm b">&amp;</code>操作符。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2151" class="mc md jj bd me mf mg mh mi mj mk ml mm kp mn kq mo ks mp kt mq kv mr kw ms mt bi translated">为什么选择FastAPI？</h1><p id="319c" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated"><em class="lu">“如果你想学习一个构建REST APIs的现代框架，那么试试FastAPI吧……它快速、易用、易学……</em>”—<a class="ae jg" href="https://spacy.io/" rel="noopener ugc nofollow" target="_blank">空间</a>创造者</p><p id="673f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然Python有许多构建API的框架，最常见的是Flask和Tornado，但FastAPI在易用性方面比可用的替代方案好得多，因为与Flask相比，它似乎更Python化。</p><p id="112c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还有，FastAPI很快。正如Github文档所说，<strong class="la jk"> <em class="lu">“非常高的性能，与NodeJS和Go不相上下。”</em> </strong> <em class="lu">我们也可以为自己检查延迟</em> <a class="ae jg" href="https://www.techempower.com/benchmarks/#section=test&amp;runid=7464e520-0dc2-473d-bd34-dbdfd7e85911&amp;hw=ph&amp;test=query&amp;l=z8kflr-v&amp;a=2" rel="noopener ugc nofollow" target="_blank"> <em class="lu">基准</em> </a> <em class="lu">。</em></p><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi on"><img src="../Images/0ac8713f5da99987dccfb9929b2fc155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d2kH0XrlFgkXCF5EYvECvQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://www.techempower.com/benchmarks/#section=test&amp;runid=7464e520-0dc2-473d-bd34-dbdfd7e85911&amp;hw=ph&amp;test=query&amp;l=z8kflr-v&amp;a=23" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="964a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与Flask相比，速度提高了大约2倍，而且没有太多代码更改。当构建一个可以服务数百万客户的API时，这意味着一笔巨大的交易，因为它可以减少生产工作，还可以使用更便宜的硬件来服务。</p><p id="0c85" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">比较和讨论到此为止，让我们尝试使用FastAPI来创建我们的API。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b9c0" class="mc md jj bd me mf mg mh mi mj mk ml mm kp mn kq mo ks mp kt mq kv mr kw ms mt bi translated">如何用FastAPI写一个API？</h1><p id="053e" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">数据科学最常见的用例之一是如何创建一个API来获得模型的预测？让我们假设我们有一个巨大的生存模型来预测一个人是否能生存。并且，它需要一个人的<code class="fe nv nw nx nm b">age</code>和<code class="fe nv nw nx nm b">sex</code>作为输入参数来预测。我们将使用FastAPI以两种方式创建这个API:GET和PUT。不用担心；我会边走边解释。</p><p id="aba0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">什么是GET？— </strong>在GET请求中，我们通常尝试使用嵌入查询字符串本身的查询参数来检索数据。例如，在OMDB API中，我们使用GET请求来指定电影id和访问键，作为查询本身的一部分。</p><p id="2443" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">放的是什么？—</strong>GET请求的另一种选择是PUT请求，我们使用有效载荷发送参数，正如我们将在第二个方法中看到的。有效负载不是查询字符串的一部分，因此PUT更安全。看到第二部就更清楚了。</p><p id="6713" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是在我们继续之前，我们需要安装FastAPI和<code class="fe nv nw nx nm b">uvicorn</code> ASGI服务器:</p><pre class="ng nh ni nj gt nl nm nn no aw np bi"><span id="4394" class="nq md jj nm b gy nr ns l nt nu">pip install fastapi<br/>pip install uvicorn</span></pre><h2 id="9207" class="nq md jj bd me oo op dn mi oq or dp mm lh os ot mo ll ou ov mq lp ow ox ms oy bi translated">1.那位挨道:</h2><p id="2b2a" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">为我们的titanic模型用例编写GET API的一个简单的FastAPI方法如下:</p><pre class="ng nh ni nj gt nl nm nn no aw np bi"><span id="cdce" class="nq md jj nm b gy nr ns l nt nu">from fastapi import FastAPI</span><span id="b6aa" class="nq md jj nm b gy oz ns l nt nu">app = FastAPI()</span><span id="5b37" class="nq md jj nm b gy oz ns l nt nu">@app.get("/predict")<br/>def predict_complex_model(age: int,sex:str):<br/>    # Assume a big and complex model here. For this test I am using a simple rule based model<br/>    if age&lt;10 or sex=='F':<br/>        return {'survived':1}<br/>    else:<br/>        return {'survived':0}</span></pre><p id="ff43" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将上面的代码保存在一个名为<code class="fe nv nw nx nm b">fastapiapp.py</code>的文件中，然后您可以在终端上使用下面的命令运行它。</p><pre class="ng nh ni nj gt nl nm nn no aw np bi"><span id="aa40" class="nq md jj nm b gy nr ns l nt nu">$ uvicorn fastapiapp:app --reload</span></pre><p id="ae67" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以上意味着您的API现在正在您的服务器上运行，<code class="fe nv nw nx nm b">--reload</code>标志表示当您更改<code class="fe nv nw nx nm b">fastapiapp.py</code>文件时，API会自动更新。这在开发和测试时非常有帮助，但是在将API投入生产时，您应该移除这个<code class="fe nv nw nx nm b">--reload</code>标志。现在，您可以在浏览器中访问以下路径，您将获得预测结果:</p><pre class="ng nh ni nj gt nl nm nn no aw np bi"><span id="ebf3" class="nq md jj nm b gy nr ns l nt nu"><a class="ae jg" href="http://127.0.0.1:8000/predict?age=10&amp;sex=M" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/predict?age=10&amp;sex=M</a></span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/0ae3b41f265bad9ce9b938124b571714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*bEVyR5O4L7i1Mva8hdY7IQ.png"/></div></figure><p id="4e09" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当您在浏览器中点击该命令时，它调用<code class="fe nv nw nx nm b"><a class="ae jg" href="http://127.0.0.1:8000/predict?age=10&amp;sex=M" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/</a>predict</code>端点，而端点又调用带有参数<code class="fe nv nw nx nm b">age=10 and sex='M'</code>的关联方法<code class="fe nv nw nx nm b">predict_complex_model </code></p><p id="155b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，它允许我们从浏览器使用我们的功能，但这仍然不是很有帮助。你的开发者朋友需要使用你的predict函数在前端网站上显示输出。你如何让他使用这个功能？</p><p id="55f7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这很简单。例如，如果你的开发者朋友也使用Python，他可以像下面这样使用<code class="fe nv nw nx nm b">requests</code>模块:</p><pre class="ng nh ni nj gt nl nm nn no aw np bi"><span id="0132" class="nq md jj nm b gy nr ns l nt nu">import requests</span><span id="b497" class="nq md jj nm b gy oz ns l nt nu">age = 15<br/>sex = "F"</span><span id="8226" class="nq md jj nm b gy oz ns l nt nu">response = requests.get(f"<a class="ae jg" href="http://127.0.0.1:8000/predict?age=10&amp;sex=M" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/predict?age={age}&amp;sex={</a>sex}")<br/>output = response.json()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pb"><img src="../Images/6cc0751c2ae611f87aa3440d60a2ef0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vIeJyANbKeDo-q0SIWbx8A.png"/></div></div></figure><p id="9744" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我们可以将正在运行的API(在服务器上)的输出放到我们的Python程序中。Javascript用户将使用Javascript请求库，nodeJS开发人员将在nodeJS中使用类似的东西来做这件事。我们只需要向他们提供所需的端点和参数。</p><p id="39e4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要测试您的API，您也可以访问:</p><pre class="ng nh ni nj gt nl nm nn no aw np bi"><span id="0b4e" class="nq md jj nm b gy nr ns l nt nu"><a class="ae jg" href="http://127.0.0.1:8000/docs" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/docs</a></span></pre><p id="d386" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里您可以找到一种测试API的GUI方式。</p><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pc"><img src="../Images/a656b0083e0a380f82bb2f9c7c2096c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fk-KkBlKE8kYG8VE0y_J6w.png"/></div></div></figure><p id="6c16" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是正如我们前面所说的，<strong class="la jk">这是不安全的</strong>，因为GET参数是通过URL传递的。这意味着参数存储在服务器日志和浏览器历史中。这不是有意的。此外，这个玩具示例只有两个输入参数，所以我们可以这样做，考虑一下我们需要为预测函数提供许多参数的情况。</p><p id="686f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下或者我敢说在大多数情况下，我们使用PUT API。</p><h2 id="a5aa" class="nq md jj bd me oo op dn mi oq or dp mm lh os ot mo ll ou ov mq lp ow ox ms oy bi translated">2.推杆方式</h2><p id="6c5f" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">使用PUT API，我们可以通过向函数提供有效负载来调用任何函数。有效负载不过是一个输入参数的JSON字典，不会附加到查询字符串中，因此比get安全得多。</p><p id="69a9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个最小的例子，我们用PUT做同样的事情。我们只是将<code class="fe nv nw nx nm b">fastapiapp.py</code>的内容改为:</p><pre class="ng nh ni nj gt nl nm nn no aw np bi"><span id="13fd" class="nq md jj nm b gy nr ns l nt nu">from fastapi import FastAPI<br/>from pydantic import BaseModel</span><span id="e74e" class="nq md jj nm b gy oz ns l nt nu">class Input(BaseModel):<br/>    age : int<br/>    sex : str</span><span id="20a2" class="nq md jj nm b gy oz ns l nt nu">app = FastAPI()</span><span id="0250" class="nq md jj nm b gy oz ns l nt nu"><a class="ae jg" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.put("/predict")<br/>def predict_complex_model(d:Input):<br/>    if d.age&lt;10 or d.sex=='F':<br/>        return {'survived':1}<br/>    else:<br/>        return {'survived':0}</span></pre><p id="7466" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意，我们在这里用<code class="fe nv nw nx nm b">app.put</code>代替前面的<code class="fe nv nw nx nm b">app.get</code>。我们还需要提供一个新的类<code class="fe nv nw nx nm b">Input</code>，它使用一个名为<code class="fe nv nw nx nm b">pydantic</code>的库来验证我们将从API最终用户那里获得的输入数据类型，而之前在get中，我们使用函数参数列表来验证输入。此外，这一次您将无法使用网络上的URL查看您的内容。例如，使用浏览器指向端点位置给出:</p><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/d94bc2c5b52cc84fe64403a43bb42e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*K81f-8fTyUpgbHql2d3LLw.png"/></div></figure><p id="e9d2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我们可以再次使用Python中使用请求的编程方式进行检查:</p><pre class="ng nh ni nj gt nl nm nn no aw np bi"><span id="60df" class="nq md jj nm b gy nr ns l nt nu">import requests,json<br/>payload = json.dumps({<br/>  "age": 10,<br/>  "sex": "F"<br/>})<br/>response = requests.put("<a class="ae jg" href="http://127.0.0.1:8000/predict" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/predict</a>",data = payload)<br/>response.json()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pe"><img src="../Images/360fa47af66f74976ee0978172d9363a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pWVrZdw8iYCiScqoT1_7pg.png"/></div></div></figure><p id="f79b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意，我们在这里使用了<code class="fe nv nw nx nm b">requests.put</code>，我们使用<code class="fe nv nw nx nm b">requests.put</code>函数中的数据参数提供了有效载荷，我们还使用了<code class="fe nv nw nx nm b">json</code>库将有效载荷从dict对象转换为JSON。</p><p id="6e48" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们也可以像以前一样使用GUI方式:</p><pre class="ng nh ni nj gt nl nm nn no aw np bi"><span id="2de3" class="nq md jj nm b gy nr ns l nt nu"><a class="ae jg" href="http://127.0.0.1:8000/docs" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/docs</a></span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pf"><img src="../Images/f7ea626f706cbd178f37dacb966b4e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aZkWz1DDg_qwa8SJhCF1nw.png"/></div></div></figure><p id="71c4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们已经完成了API的创建。换换口味很简单。</p><p id="5a8c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">FastAPI使得API创建变得更加直观、简单和快速，而API创建曾经是数据科学过程中令人恐惧的部分之一。</p><p id="83cc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在我的<a class="ae jg" href="https://github.com/MLWhiz/data_science_blogs/tree/master/fastapi" rel="noopener ugc nofollow" target="_blank"> GitHub </a>库找到这篇文章的代码以及我所有的文章。</p><p id="0477" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还有很多人在评论“<strong class="la jk"> <em class="lu">中问我，如何在ec2上部署FastAPI API，如何使用图像数据而不是简单的字符串、整数和浮点数作为API的输入？”，</em> </strong>我写了这个帖子的继任者。如果你觉得有趣的话，一定要看一看，</p><div class="is it gp gr iu pg"><a rel="noopener follow" target="_blank" href="/deployment-could-be-easy-a-data-scientists-guide-to-deploy-an-image-detection-fastapi-api-using-329cdd80400"><div class="ph ab fo"><div class="pi ab pj cl cj pk"><h2 class="bd jk gy z fp pl fr fs pm fu fw ji bi translated">部署可能很容易—数据科学家指南使用…部署图像检测FastAPI API</h2><div class="pn l"><h3 class="bd b gy z fp pl fr fs pm fu fw dk translated">使用亚马逊EC2+Pytorch+Fastapi和Docker</h3></div><div class="po l"><p class="bd b dl z fp pl fr fs pm fu fw dk translated">towardsdatascience.com</p></div></div><div class="pp l"><div class="pq l pr ps pt pp pu ja pg"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2007" class="mc md jj bd me mf mg mh mi mj mk ml mm kp mn kq mo ks mp kt mq kv mr kw ms mt bi translated">继续学习</h1><p id="62a8" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">如果你想了解更多关于构建机器学习模型并将其投入生产的知识，这个关于AWS 实现机器学习应用的<a class="ae jg" href="https://coursera.pxf.io/NKERRq" rel="noopener ugc nofollow" target="_blank">课程正好可以满足你的要求。</a></p><p id="b1da" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">谢谢你的阅读。将来我也会写更多初学者友好的帖子。在<a class="ae jg" href="https://medium.com/@rahul_agarwal?source=post_page---------------------------" rel="noopener">媒体</a>上关注我或者订阅我的<a class="ae jg" href="http://eepurl.com/dbQnuX?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">博客</a>来了解他们。一如既往，我欢迎反馈和建设性的批评，可以通过Twitter <a class="ae jg" href="https://twitter.com/MLWhiz?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> @mlwhiz </a>联系到我</p><p id="1ac5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，一个小小的免责声明——这篇文章中可能会有一些相关资源的附属链接，因为分享知识从来都不是一个坏主意。</p></div></div>    
</body>
</html>