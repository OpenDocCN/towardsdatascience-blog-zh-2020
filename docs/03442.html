<html>
<head>
<title>Visualizing Worldwide Coronavirus Spread Using Jupyter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jupyter可视化全球冠状病毒传播</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-worldwide-coronavirus-spread-using-jupyter-dfbf2cd4618?source=collection_archive---------35-----------------------#2020-04-01">https://towardsdatascience.com/visualizing-worldwide-coronavirus-spread-using-jupyter-dfbf2cd4618?source=collection_archive---------35-----------------------#2020-04-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1ae3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建你自己的新冠肺炎传播的可视化</h2></div><p id="30b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="lb">编者按:</em> </strong> <em class="lb"> </em> <a class="ae lc" href="http://towardsdatascience.com/" rel="noopener" target="_blank"> <em class="lb">走向数据科学</em> </a> <em class="lb">是一份以数据科学和机器学习研究为主的中型刊物。我们不是健康专家或流行病学家，本文的观点不应被解释为专业建议。想了解更多关于疫情冠状病毒的信息，可以点击</em> <a class="ae lc" href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports" rel="noopener ugc nofollow" target="_blank"> <em class="lb">这里</em> </a> <em class="lb">。</em></p><p id="8e69" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有很多关于新冠肺炎和冠状病毒在世界各地传播的公共数据集。<a class="ae lc" href="https://coronadatascraper.com/" rel="noopener ugc nofollow" target="_blank"> Corona Data Scraper </a>从经过验证的来源提取新冠肺炎案例数据，找到相应的GeoJSON特征，并添加人口信息。Corona Data Scraper提供了奇妙的可视化效果，比如经过速率调整的2D国家级<a class="ae lc" href="https://coronadatascraper.com/#features.json" rel="noopener ugc nofollow" target="_blank">地图</a>和Antonio Piccolboni对平滑后的新冠肺炎趋势和<a class="ae lc" href="https://piccolbo.shinyapps.io/covid-19/" rel="noopener ugc nofollow" target="_blank">预测的可视化效果</a>。</p><p id="90fb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想尝试对冠状病毒数据进行自己的分析，你也可以使用Jupyter和Python小部件创建一些自己的漂亮的全局可视化，我们将在本文中进行讨论。这里有一个完整的交互式可视化的截图。可以拖动滑块查看从2020年1月22日开始的不同日期的新冠肺炎案例。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ld"><img src="../Images/a3e1c35d811ee32d0d9e1319e6bc2437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MkvpIeiCvUFyNfSUHcaCcQ.png"/></div></div></figure><h1 id="7603" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">导入依赖项和数据集</h1><p id="977d" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">我们将使用的数据集是冠状病毒数据刮刀的时间序列<a class="ae lc" href="https://coronadatascraper.com/timeseries.csv" rel="noopener ugc nofollow" target="_blank">数据</a>。首先导入依赖项并读入数据集。如果尚未安装底图、Networkx和Shapely包，您可能需要安装它们。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="62d9" class="mr lq iq mn b gy ms mt l mu mv">import numpy as np<br/>import pandas as pd<br/>import networkx as nx<br/>import matplotlib.pyplot as plt<br/>from mpl_toolkits.basemap import Basemap as Basemap<br/>from shapely.geometry import Point, MultiPoint<br/>from ipywidgets import interact, widgets<br/>from IPython.display import display</span></pre><p id="3ca4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以下载CSV格式的数据集并在本地读取，也可以在<a class="ae lc" href="https://coronadatascraper.com/timeseries.csv'" rel="noopener ugc nofollow" target="_blank">https://coronadatascraper.com/timeseries.csv</a>读取最新更新的数据集。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="d1bb" class="mr lq iq mn b gy ms mt l mu mv">df = pd.read_csv(‘<a class="ae lc" href="https://coronadatascraper.com/timeseries.csv'" rel="noopener ugc nofollow" target="_blank">https://coronadatascraper.com/timeseries.csv'</a>, parse_dates=[‘date’])</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mw"><img src="../Images/edff353fa35aec0880b97290b0d582cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d1lIkWJEQGnrminjSli_IQ.png"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">查看数据集和列信息。</p></figure><p id="2c52" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的分析将只使用一些数据，特别是国家、纬度、经度和案例列。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="ac0e" class="mr lq iq mn b gy ms mt l mu mv"># Get Country, Lat, Long, Cases, Date<br/>case_df = df[[‘country’, ‘lat’, ‘long’, ‘cases’, ‘date’]]</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/da5359b06923cc92348e7242d6a47ca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*jZSy3eZe_fzYF4-5d4_dbA.png"/></div><p class="mx my gj gh gi mz na bd b be z dk translated">Jupyter笔记本截图</p></figure><h1 id="b949" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">使用底图绘制地图</h1><p id="2be3" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">接下来，我们从包含边列表的Pandas数据帧创建一个NetworkX图。我们的目标是简单地在冠状病毒出现的位置标绘点。使用底图Matplotlib工具包，我们可以在地图背景上绘制点。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nc"><img src="../Images/b067010789b95ed52ee380f8340b5aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54CQLeTmdsW2LX4aShOfQg.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">墨卡托投影。图片鸣谢:<a class="ae lc" href="https://en.wikipedia.org/wiki/File:Mercator_projection_SW.jpg" rel="noopener ugc nofollow" target="_blank">维基百科</a>。来自<a class="ae lc" href="https://commons.wikimedia.org/wiki/Main_Page" rel="noopener ugc nofollow" target="_blank">维基共享资源</a>的原始文件</p></figure><p id="69fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使世界形象化，我们将使用墨卡托投影，一种圆柱形的保形投影。这种投影在高纬度地区产生很大的失真，并且不能完全覆盖极地区域。</p><p id="2bdb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建底图墨卡托投影。参数<em class="lb"> llcrnrlon </em>和<em class="lb"> llcrnrlat </em>代表右下角经度和纬度。参数<em class="lb"> urcrnrlon </em>和<em class="lb"> urcrnrlat </em>代表右下角经度和纬度。右下角(西经150度，南经50度)到左上角(东经160度，北纬75度)似乎很适合我们的显示。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="1404" class="mr lq iq mn b gy ms mt l mu mv">m = Basemap(llcrnrlon=-150., llcrnrlat=-50., urcrnrlon=160., urcrnrlat=75., rsphere=(6378137.00,6356752.3142), resolution=’l’, projection=’merc’, lat_0=0,lon_0=0., lat_ts=20.)</span></pre><p id="28db" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，创建一个没有节点和边的空图。初始化Matplotlib图形以显示地图。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="307b" class="mr lq iq mn b gy ms mt l mu mv">G=nx.Graph()</span><span id="c761" class="mr lq iq mn b gy nd mt l mu mv">plt.figure(figsize = (20,10))</span></pre><p id="7548" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用Matplotlib画空图G。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="f854" class="mr lq iq mn b gy ms mt l mu mv">nx.draw_networkx(G, node_size=200, node_color=’blue’)</span></pre><h1 id="5d6d" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">绘制冠状病毒病例</h1><p id="460b" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">在地图上用点标出冠状病毒病例的位置。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="e0b1" class="mr lq iq mn b gy ms mt l mu mv"># Create a scatter plot of cases on a single date <em class="lb">d</em>.</span><span id="3e16" class="mr lq iq mn b gy nd mt l mu mv">one_date_df = case_df[case_df[‘date’]== <em class="lb">d</em>]<br/>map_points = pd.Series([Point(m(mapped_x, mapped_y)) for mapped_x, mapped_y in zip(one_date_df[‘long’], one_date_df[‘lat’])])</span></pre><p id="ac9c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在地图上画出病例的散点图。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="4fea" class="mr lq iq mn b gy ms mt l mu mv"># Create a scatterplot on the map</span><span id="ee68" class="mr lq iq mn b gy nd mt l mu mv">dev = m.scatter( [geom.x for geom in map_points],  [geom.y for geom in map_points],  20, marker=’o’, lw=.25, facecolor=’#33ccff’, edgecolor=’w’, alpha=0.9,antialiased=True, zorder=3)</span></pre><p id="2e9a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，画地图。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="1add" class="mr lq iq mn b gy ms mt l mu mv"># Now draw the map<br/> m.drawcountries()<br/> m.drawstates()<br/> m.bluemarble()<br/> plt.title(‘Coronavirus’)</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ne"><img src="../Images/19af5953904821c6135a3ca4c23d6336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1odeT3Gv7TtzEVXaQVQ0rg.png"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">2020年1月22日冠状病毒图谱</p></figure><h1 id="ce7e" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">使地图互动</h1><p id="1449" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">将单个地图制作代码组合到一个名为create_map的函数中，以在任意给定日期执行上述地图绘制。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="a19a" class="mr lq iq mn b gy ms mt l mu mv">def create_map(date_d):<br/>    m = Basemap(<br/>            llcrnrlon=-150.,<br/>            llcrnrlat=-50.,<br/>            urcrnrlon=160.,<br/>            urcrnrlat=75.,\<br/>            rsphere=(6378137.00,6356752.3142),\<br/>            resolution='l',projection='merc',\<br/>            lat_0=0,lon_0=0.,lat_ts=20.)</span><span id="b1fc" class="mr lq iq mn b gy nd mt l mu mv">G=nx.Graph()</span><span id="30e5" class="mr lq iq mn b gy nd mt l mu mv">fig = plt.figure(figsize = (20,10))</span><span id="7ba2" class="mr lq iq mn b gy nd mt l mu mv">nx.draw_networkx(G,node_size=200,node_color='blue')</span><span id="6437" class="mr lq iq mn b gy nd mt l mu mv"># Draw scatter<br/>one_date_df = case_df[case_df['date']== date_d]<br/>map_points = pd.Series([Point(m(mapped_x, mapped_y)) for mapped_x, mapped_y in zip(one_date_df['long'], one_date_df['lat'])])</span><span id="aac0" class="mr lq iq mn b gy nd mt l mu mv"># Scatterplot on the map<br/>    dev = m.scatter(<br/>                [geom.x for geom in map_points],<br/>                [geom.y for geom in map_points],<br/>                20, marker='o', lw=.25,<br/>                facecolor='#33ccff', edgecolor='w',<br/>                alpha=0.9,antialiased=True,<br/>                zorder=3)</span><span id="b9d1" class="mr lq iq mn b gy nd mt l mu mv"># Draw the map<br/>    m.drawcountries()<br/>    m.drawstates()<br/>    m.bluemarble()<br/>    plt.title('Global Coronavirus Cases Starting From 1/22/2020')<br/>    return (date_d, fig)</span></pre><p id="6204" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，为每个感兴趣的日期画一张地图。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="deb2" class="mr lq iq mn b gy ms mt l mu mv">all_dates = list(case_df['date'].unique())</span><span id="2862" class="mr lq iq mn b gy nd mt l mu mv"><br/>all_maps = [ ]<br/>for date_d in all_dates:<br/>    all_maps.append(create_map(date_d))</span></pre><p id="9cf1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">定义一个功能<em class="lb"> f </em>用于选择对应于其各自日期的地图。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="a3ea" class="mr lq iq mn b gy ms mt l mu mv">def f(index):<br/>    img = all_maps[index][1]<br/>    display(img)</span></pre><p id="3937" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在创建交互式滑块和地图。</p><pre class="le lf lg lh gt mm mn mo mp aw mq bi"><span id="2d6e" class="mr lq iq mn b gy ms mt l mu mv">interact(f, index=widgets.IntSlider(min=0,max=68,step=1,value=1,<br/> description=’Date Starting From 1/22/2020:’ ))</span></pre><p id="1254" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样！这里有一张gif图，可以看到交互式滑块在整个时间序列中的样子。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/ab2f481229e2a1f3aa893c780abd1d06.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/1*DaxEuoMDwntK2d4ZnslgCQ.gif"/></div><p class="mx my gj gh gi mz na bd b be z dk translated">通过imgflip.com创建的Gif</p></figure><h1 id="95aa" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated"><strong class="ak">参考文献</strong></h1><p id="6817" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">[1]<a class="ae lc" href="https://coronadatascraper.com/#home" rel="noopener ugc nofollow" target="_blank">https://coronadatascraper.com/</a></p><p id="cbfd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[2]<a class="ae lc" rel="noopener" target="_blank" href="/catching-that-flight-visualizing-social-network-with-networkx-and-basemap-ce4a0d2eaea6">https://towards data science . com/catching-the-flight-visualizing-social-network-with-network x-and-base map-ce 4a 0 D2 ea 6</a></p><p id="c141" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[3] NetworkX文档<a class="ae lc" href="https://networkx.github.io/documentation/stable/index.html" rel="noopener ugc nofollow" target="_blank">https://networkx.github.io/documentation/stable/index.html</a></p><p id="c15d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[4]底图文档<a class="ae lc" href="https://matplotlib.org/basemap/" rel="noopener ugc nofollow" target="_blank">https://matplotlib.org/basemap/</a></p></div></div>    
</body>
</html>