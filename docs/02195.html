<html>
<head>
<title>How to Increase Azure Databricks Cluster vCPU Cores Limits</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何提高 Azure Databricks 集群 vCPU 内核限制</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-increase-azure-databricks-cluster-vcpu-cores-limits-37beb07f3905?source=collection_archive---------15-----------------------#2020-03-02">https://towardsdatascience.com/how-to-increase-azure-databricks-cluster-vcpu-cores-limits-37beb07f3905?source=collection_archive---------15-----------------------#2020-03-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/bcabe4938f365ddac0c5594f3c106c59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2WxkpvUaoGDRQlP8"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">Alexandre Debiève 在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="774f" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">Azure Databricks“此帐户可能没有足够的 CPU 内核来满足此请求”警告的解决方案</h2></div><p id="9c71" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我的客户经常会问我:</p><blockquote class="lu lv lw"><p id="a51c" class="ky kz lx la b lb lc kk ld le lf kn lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated">为什么我的 Azure Databricks 集群受到限制？</p></blockquote><p id="00dd" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">具体来说，对于一个默认的 PAYG Azure 订阅，当你想在 Azure Databricks 中创建一个集群时，你可能会被这样一个问题困扰:</p><blockquote class="mb"><p id="2ad0" class="mc md jj bd me mf mg mh mi mj mk lt dk translated">此帐户可能没有足够的 CPU 核心来满足此请求<br/>估计可用:10，请求:**</p></blockquote><p id="3cb9" class="pw-post-body-paragraph ky kz jj la b lb ml kk ld le mm kn lg lh mn lj lk ll mo ln lo lp mp lr ls lt im bi translated">如下图所示。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mq"><img src="../Images/f15d6da312f11fd8d4cc8f4f5d0a0f6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5zgN1XZhbX53StXiUVAQtA.png"/></div></div></figure><p id="d1cb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">即使您单击链接“了解更多关于 CPU 配额的信息”，该文档中也没有直接的答案。然而，如果你耐心地钻研官方文件，你会发现微软故意为所有 PAYG 订阅默认设置这些配额限制，以避免任何令人震惊的账单。</p><p id="4a20" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，这对于 Azure Databricks 集群来说非常不方便。vCPU 核心的数量被限制在 10 个，这也限制了 Azure Databricks 的能力。在大多数情况下，集群通常需要多个节点，每个节点可能至少有 4 个内核运行(推荐的工作虚拟机是 DS3 v2，它有 4 个虚拟内核)。</p><p id="5f52" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，集群将总是被限制为只有一个节点在运行，这变得毫无用处，因为 Spark 需要它的分布式特性来加速计算。请注意，如果我们选择“与 worker 相同”，驱动程序节点将需要另外 4 个内核。因此，发生了以下情况:</p><ul class=""><li id="3a6d" class="mv mw jj la b lb lc le lf lh mx ll my lp mz lt na nb nc nd bi translated">驱动节点(4 核)+1 *工作节点(4 核)= 8 核&lt; 10 cores limitation</li><li id="e054" class="mv mw jj la b lb ne le nf lh ng ll nh lp ni lt na nb nc nd bi translated">Driver node (4 cores) +2 * Worker node (8 cores) = 12 cores &gt; 10 核限制<strong class="la jk">(不允许)</strong></li></ul><p id="2222" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们必须增加限制，数据块才能按预期运行。</p><p id="52d9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">解决这个问题的方法是增加配额，这并不复杂，但是我发现在官方文档页面上并没有直接说明。现在，我将演示如何增加配额和消除约束。</p><h1 id="b2b4" class="nj nk jj bd nl nm nn no np nq nr ns nt kp nu kq nv ks nw kt nx kv ny kw nz oa bi translated">增加配额的步骤</h1><ol class=""><li id="ea7f" class="mv mw jj la b lb ob le oc lh od ll oe lp of lt og nb nc nd bi translated">进入 Azure 门户<strong class="la jk"> </strong> &gt;点击搜索资源字段&gt;输入“帮助”&gt;选择“帮助+支持”</li></ol><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/4e27be09edb4e0ea3ec2595f589c75fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cSSRjWfbcGNaYB0PLcZRXQ.png"/></div></div></figure><p id="d653" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.在左侧导航中，选择“<strong class="la jk">新支持请求</strong>”。然后，在右侧窗格的“<strong class="la jk">基础</strong>选项卡中，</p><ul class=""><li id="d6f3" class="mv mw jj la b lb lc le lf lh mx ll my lp mz lt na nb nc nd bi translated"><strong class="la jk">发行类型</strong>:选择“服务和认购限额(额度)”</li><li id="616b" class="mv mw jj la b lb ne le nf lh ng ll nh lp ni lt na nb nc nd bi translated"><strong class="la jk">订阅</strong>:选择您的订阅</li><li id="0afa" class="mv mw jj la b lb ne le nf lh ng ll nh lp ni lt na nb nc nd bi translated"><strong class="la jk">配额类型</strong>:选择“计算-虚拟机(核心-虚拟 CPU)订阅限额增加”</li></ul><p id="ea27" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">选择所有必填字段后，点击“<strong class="la jk">下一步:解决方案&gt; &gt; </strong>”。请注意，对此不会有任何“解决方案”，因为它需要一个支持人员来审查您的请求并手动批准它。所以“<strong class="la jk">解决</strong>选项卡将被跳过，直接跳转到“<strong class="la jk">详细信息</strong>”。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oi"><img src="../Images/32d78a01a20f027fc96faffd8eba9fa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0ksvc6WQ7bFjCzlyfDNVw.png"/></div></div></figure><p id="3758" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.在“<strong class="la jk">详细信息</strong>选项卡中，单击链接“<strong class="la jk">提供详细信息</strong>”将“<strong class="la jk">配额详细信息</strong>”刀片窗口移至右侧。然后，在窗口:</p><ul class=""><li id="1a4f" class="mv mw jj la b lb lc le lf lh mx ll my lp mz lt na nb nc nd bi translated"><strong class="la jk">部署模式</strong>:选择“资源管理器”。</li><li id="27b1" class="mv mw jj la b lb ne le nf lh ng ll nh lp ni lt na nb nc nd bi translated"><strong class="la jk">位置</strong>:选择您的位置。请注意，您可以一次请求增加多个地点的配额。</li><li id="6d20" class="mv mw jj la b lb ne le nf lh ng ll nh lp ni lt na nb nc nd bi translated"><strong class="la jk">类型</strong>:选择“标准”。</li><li id="33d1" class="mv mw jj la b lb ne le nf lh ng ll nh lp ni lt na nb nc nd bi translated"><strong class="la jk">标准</strong>:选择要增加配额的虚拟机系列。请注意，您可以一次为多个虚拟机系列请求配额增加</li><li id="12da" class="mv mw jj la b lb ne le nf lh ng ll nh lp ni lt na nb nc nd bi translated"><strong class="la jk">新 vCPU 限额</strong>:输入您想要增加的新配额</li></ul><p id="956f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">填写完所有要求的信息后，点击<strong class="la jk">保存并继续</strong>。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/e7468f9e20d510d8621961d6c6ad74c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S3xvqHYCBgMJZqIww5Kgkg.png"/></div></div></figure><p id="1042" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.现在，请求的配额增加显示在“<strong class="la jk">请求摘要</strong>”中。还有一些其他需要填写的信息。根据自己的喜好输入即可，然后点击“<strong class="la jk">下一步:审核+创建&gt; &gt; </strong>”。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ok"><img src="../Images/1a3e42431aff9ae7f435c47d8649c995.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_uqZvmH1_O3FizcPJaETQ.png"/></div></div></figure><p id="a9a8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.审核一切输入完毕后，点击<strong class="la jk">创建</strong>创建该票。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ol"><img src="../Images/e5da7388bc0ce66f39c6285693ff6406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7fswRMuyL2eYs1PnrZjzsw.png"/></div></div></figure><h2 id="6f5f" class="om nk jj bd nl on oo dn np op oq dp nt lh or os nv ll ot ou nx lp ov ow nz ox bi translated">来自 Azure 支持的响应</h2><p id="a2d2" class="pw-post-body-paragraph ky kz jj la b lb ob kk ld le oc kn lg lh oy lj lk ll oz ln lo lp pa lr ls lt im bi translated">根据您选择的“严重程度”，工作人员会及时与您联系。通常，配额增加会在没有任何问题的情况下获得批准，随后会收到支持团队的电子邮件，以便在关闭票证之前进行确认。</p><h1 id="4528" class="nj nk jj bd nl nm nn no np nq nr ns nt kp nu kq nv ks nw kt nx kv ny kw nz oa bi translated">总结和提示</h1><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pb"><img src="../Images/b47d1e20a3b13e6f42f31557d9f116d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q9kkoHPqQxtf93Q0"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://unsplash.com/@stadsa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">塔达斯·萨</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="da4f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">事实上，微软 Azure 对各种服务设置了巨大的配额限制。您可以在这里找到详细信息:</p><div class="is it gp gr iu pc"><a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/azure-subscription-service-limits" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd jk gy z fp ph fr fs pi fu fw ji bi translated">Azure 订阅限制和配额— Azure 资源管理器</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">本文档列出了一些最常见的 Microsoft Azure 限制，有时也称为配额。为了学习…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">docs.microsoft.com</p></div></div><div class="pl l"><div class="pm l pn po pp pl pq ja pc"/></div></div></a></div><p id="4f67" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，使用我在本文中演示的方法，您不仅可以增加 vCPU 核心的配额，还可以增加上面的官方文档中列出的其他服务配额。</p><p id="446d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，你的 Azure Databricks 集群没有任何限制，但请三思而后行，不要在以后产生令人震惊的账单:)</p><div class="is it gp gr iu pc"><a href="https://medium.com/@qiuyujx/membership" rel="noopener follow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd jk gy z fp ph fr fs pi fu fw ji bi translated">通过我的推荐链接加入 Medium 克里斯托弗·陶</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">medium.com</p></div></div><div class="pl l"><div class="pr l pn po pp pl pq ja pc"/></div></div></a></div><p id="7d6b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你觉得我的文章有帮助，请考虑加入 Medium 会员来支持我和成千上万的其他作者！(点击上面的链接)</p></div></div>    
</body>
</html>