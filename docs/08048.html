<html>
<head>
<title>How to Use Angular To Deploy TensorFlow Web Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Angular 部署 TensorFlow Web 应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-angular-to-deploy-tensorflow-web-apps-5675b5a042cc?source=collection_archive---------13-----------------------#2020-06-14">https://towardsdatascience.com/how-to-use-angular-to-deploy-tensorflow-web-apps-5675b5a042cc?source=collection_archive---------13-----------------------#2020-06-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="34ae" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在角度构建的 web 应用程序中使用 Python 构建的模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/54ee802ae98ca3a0114b7afb2c0e8e2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OGwC4JpEosYVZF5n"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">法比安·格罗斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="c3a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">在机器学习和人工智能的新时代，Python 无疑是任何崭露头角的工程师的首选语言。干净、伪代码外观的语法——世界上最大的科学计算和机器学习社区已经为希望让他们的机器更智能的开发人员创造了完美的语言。</span></p><p id="0882" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，向大众部署任何用 Python 构建的东西并不容易。构建任何人都可以使用的东西的最有效途径是 web 开发。</p><p id="db2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几乎每个有电脑的人都可以上网和浏览网页。即使是那些没有手机的人也可以通过手机上网。</p><p id="981b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 Python 进行 Web 开发是可能的。两个最大的框架是 Django 和 Flask——都很好，但是都比不上 JavaScript 可用的框架。</p><p id="1083" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">被全球 96%的网站使用[1] — JavaScript 在客户端 web 浏览器语言中占主导地位。自然，这就是 web 开发的空间。</p><p id="5d13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，像 Angular 和 Node 这样的框架使得构建 web 应用程序变得更加容易。只需很少的时间，我们就可以构建动态、交互式、快速的应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi me"><img src="../Images/d8bfb308713ced313b6435715c6d38ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7jjskxGiwVh63s-iARFeCg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们会建造这个。</p></figure><p id="7970" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将采用 Python 内置的<strong class="lb iu">文本生成</strong>模型，并使用 Angular 将其集成到一个交互式 web 应用程序中。这里有很多细节，所以作为参考:</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="9ef4" class="mk ml it mg b gy mm mn l mo mp"><strong class="mg iu">1. Our Model</strong> - brief description of the model and download links</span><span id="e7e9" class="mk ml it mg b gy mq mn l mo mp"><strong class="mg iu">2. Tensorflow.js</strong> - conversion of model from Python to JS</span><span id="7d30" class="mk ml it mg b gy mq mn l mo mp"><strong class="mg iu">3. Getting Started With Angular</strong> - installation and set-up</span><span id="018f" class="mk ml it mg b gy mq mn l mo mp"><strong class="mg iu">4. Bootstrap</strong> - how to implement Bootstrap CSS styles in Angular</span><span id="4742" class="mk ml it mg b gy mq mn l mo mp"><strong class="mg iu">5. Model Component</strong> - setting up the model component</span><span id="b9b8" class="mk ml it mg b gy mq mn l mo mp"><strong class="mg iu">6. Loading Our Model</strong> - how to load a model using TypeScript</span><span id="5c5f" class="mk ml it mg b gy mq mn l mo mp"><strong class="mg iu">7. Making Predictions</strong> - setup of prediction function in Typescript</span><span id="d403" class="mk ml it mg b gy mq mn l mo mp"><strong class="mg iu">8. TextGenComponent</strong> - implementation of all this code with the app</span></pre></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="e33e" class="my ml it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">1.我们的模型</h1><p id="8a7c" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">我们将保持这一部分很短，所以我们可以更多地集中在角接下来。</p><p id="57b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该模型是一个自然语言生成器。它使用字符级嵌入和一个非常标准的 LSTM 网络。</p><p id="db0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它是用 Python 构建和训练的，使用 TensorFlow 2。</p><p id="35f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">训练数据包括马库斯·奥勒留的《沉思》和塞内卡的《致卢西留的道德书》——这两本书在斯多葛派哲学领域都是有影响力的文本。</p><p id="3b19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个模型产生的是一种特别雄辩的胡言乱语。</p><blockquote class="nu"><p id="1205" class="nv nw it bd nx ny nz oa ob oc od lu dk translated">请记住，理性这个词的本意是表示分散，或者分解成原子，或者湮灭，它要么消失，要么改变。—艾·马库斯·奥勒留，大约 2020 年</p></blockquote><p id="fcdc" class="pw-post-body-paragraph kz la it lb b lc oe ju le lf of jx lh li og lk ll lm oh lo lp lq oi ls lt lu im bi translated">在 Python 中，我们打开控制台，加载模型，并为模型输入一些内容。</p><p id="a20e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来的一切都是模型产生的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/7e69aab5edbd53a59ba5342b4d2c611b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ihw7lKNY8c9g1wKB.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">几个模型迭代产生的句子截图——这里我们对每个句子进行评分，并选择得分最高的<a class="ae ky" rel="noopener" target="_blank" href="/recurrent-ensemble-learning-caffdcd94092">文本</a>。</p></figure><p id="35ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们希望重现这一功能，但在一个易于分发的 web 应用程序中实现。我当然不是设计师——但我们也会努力让它看起来很酷。</p><p id="1707" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你确实想了解更多关于这个模型的信息，这里有<a class="ae ky" href="https://github.com/jamescalam/meditations_ai" rel="noopener ugc nofollow" target="_blank">GitHub repo</a>，我已经在<a class="ae ky" href="https://towardsdatascience.com/tagged/the-meditations" rel="noopener" target="_blank">这些文章</a>中描述了构建过程(第一篇应该足够了)。</p><p id="52e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建需要时间，所以您可以从这里下载模型和映射，分别是<code class="fe ok ol om mg b">model.h5</code>和<code class="fe ok ol om mg b">char2idx.json</code>，<a class="ae ky" href="https://github.com/jamescalam/meditations_ai/tree/master/incl_models/LSTM_e256_sl100_0414" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="e306" class="my ml it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">2.TensorFlow.js</h1><p id="3dbf" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">首先，我们需要将模型翻译成 JavaScript 可读的东西。</p><p id="6216" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，<code class="fe ok ol om mg b">pip install tensorflowjs</code>安装我们需要的模型编译器，将模型从<code class="fe ok ol om mg b">h5</code>翻译到<code class="fe ok ol om mg b">json</code>。</p><p id="3530" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开命令行并导航到包含<code class="fe ok ol om mg b">modelname.json</code>的项目文件夹。在那里，我们可以键入以下内容:</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="dfa5" class="mk ml it mg b gy mm mn l mo mp">tensorflow_js model_type="Keras"<br/>    modelname.h5<br/>    nlg_models/modelname.json</span></pre><p id="5832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这产生了我们的<code class="fe ok ol om mg b">JSON</code>格式的模型，我们稍后将把它加载到我们的 web 应用程序中。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="f3a1" class="my ml it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">3.Angular 入门</h1><p id="d5ff" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">Angular 是一个很棒的 web 应用框架。它是轻量级的，结构良好，并且拥有大量的追随者。</p><p id="581e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要设置我们的环境，我们首先从这里<a class="ae ky" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">安装节点</strong> </a>。我们不会直接使用 Node，但它提供了我们在 Angular 中开发应用程序所需的几个<a class="ae ky" href="https://www.angularjswiki.com/angular/is-node-js-required-for-angular-2-or-angular/#:~:text=Reasons%20why%20we%20need%20Node.&amp;text=%E2%80%9CAngular%E2%80%9D%20is%20entirely%20new%20framework,them%20in%20plain%20JavaScript%20i.e.%2C%20.&amp;text=We%20need%20to%20use%20Node,can%20deploy%20them%20in%20production." rel="noopener ugc nofollow" target="_blank">功能</a>。</p><p id="a14f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完成后，我们可以使用节点包管理器(NPM)来安装包——就像使用 Python 的<code class="fe ok ol om mg b">pip</code>一样。</p><p id="eb90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要的第一个工具是 Angular CLI(命令行界面)，我们将使用它为应用程序的不同部分快速生成模板。我们打开自己的命令行并键入:</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="0bf9" class="mk ml it mg b gy mm mn l mo mp">npm install -g @angular/cli</span></pre><p id="4467" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以使用 Angular CLI 来创建一个项目。仍然在命令行中，首先导航到我们希望项目所在的位置。然后，对于一个名为<code class="fe ok ol om mg b">nlg-project</code>的项目，我们将输入<code class="fe ok ol om mg b">ng new nlg-project</code>——我们将被询问路由和样式表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/a5b42709ed6525294bfc6a6e70460ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*2iitB783suz34zTRi5ab8A.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/7b513f7c316e875e493d276e7c25ce8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*kIgyUq3C0c7qPOOjPQCjfQ.png"/></div></figure><p id="0547" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的新项目目录看起来应该与图中所示类似。我们可以用<code class="fe ok ol om mg b">ng serve</code>为这个项目初始化一个本地服务器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/86afaabe7845c412d965b2a5f7a01975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9KXHA3d_ynPKXzrzWSd6Cw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">默认角度应用程序页面</p></figure><p id="87e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的服务器将被托管在<code class="fe ok ol om mg b">localhost:4200</code>——在我们的浏览器中输入这个会给我们默认的 Angular 应用页面。</p><p id="debd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在应用程序中使用 TensorFlow.js 和 jQuery。这些可以与以下设备一起安装:</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="110c" class="mk ml it mg b gy mm mn l mo mp">npm install @tensorflow/tfjs --save<br/>npm install jquery --save</span></pre><p id="784b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装后，两个库都可以在<code class="fe ok ol om mg b">node_modules</code>目录中找到。为了避免这种情况，在我们的代码中使用任一库之前，还必须重新启动服务器:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/3c165e2c2b71776c826c687634aacadf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c3KdmdxzRPCJuSmzm3hq5Q.png"/></div></div></figure><p id="be14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们所需要的 Angular。大多数编辑器都可以用于我们的 Angular 项目，但我会推荐尝试使用<a class="ae ky" href="http://brackets.io/" rel="noopener ugc nofollow" target="_blank">括号</a>或<a class="ae ky" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank"> VS 代码</a>(我更喜欢后者)。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="1610" class="my ml it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">4.引导程序</h1><p id="e115" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">我们将使用<a class="ae ky" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank"> Bootstrap </a>来设计我们 web 应用程序的大部分样式。Bootstrap 是一个预先格式化的 CSS 框架。它承载了一系列有用的预样式但灵活的元素。多亏了 Bootstrap，我们可以轻松地创建一个干净的动态页面。</p><p id="a0ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要安装，我们键入<code class="fe ok ol om mg b">npm install bootstrap --save</code>。</p><p id="a44d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Angular 使用<code class="fe ok ol om mg b">src/styles.css</code>来设计网络应用。现在我们已经安装了引导程序，我们只需通过向<code class="fe ok ol om mg b">styles.css</code>添加以下内容来导入<code class="fe ok ol om mg b">bootstrap.css</code>:</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="1654" class="mk ml it mg b gy mm mn l mo mp">@import "~bootstrap/dist/css/bootstrap.css";</span></pre><h2 id="d852" class="mk ml it bd mz or os dn nd ot ou dp nh li ov ow nj lm ox oy nl lq oz pa nn pb bi translated">应用程序 HTML</h2><p id="df66" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">我们不想要默认网页，所以让我们更新它。HTML 代码包含在<code class="fe ok ol om mg b">src/app/app.component.html</code>中。</p><p id="5beb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们只放置一个简单的标题和段落，这样我们就可以看到我们已经更改了正确的文件并正确地实现了 Bootstrap:</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="fe69" class="mk ml it mg b gy mm mn l mo mp">&lt;h1&gt;Meditations NLG&lt;/h1&gt;<br/>&lt;textarea&gt;Lorem ipsum dolor...&lt;/textarea&gt;<br/>&lt;button class="btn btn-dark"&gt;Run&lt;/button&gt;</span></pre><div class="kj kk kl km gt ab cb"><figure class="pc kn pd pe pf pg ph paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/e9a901976665f19d38c06891d31e32ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*O6K-PlKy1aMQCXDJc4VfeA.png"/></div></figure><figure class="pc kn pi pe pf pg ph paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/330f3b45b4bde915c60e83ea34d25c47.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*Vsw4cBK_HRyJkMJHG1K9HQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk pj di pk pl translated">无引导(左)和有引导(右)—这是一个开始，但当然还需要做更多的工作。</p></figure></div><p id="e468" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在一切就绪，我们可以开始集成模型本身了。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="105c" class="my ml it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">5.模型组件</h1><p id="6f4a" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">Angular 的工作原理是将我们的应用模块化成不同的部分。我们已经在<code class="fe ok ol om mg b">src/app</code>中看到了“app”组件，它表现为主/顶层，我们将所有其他组件放在其中。</p><p id="9df3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建新组件，我们需要返回 Angular CLI。确保命令行位于项目目录中，并使用以下内容生成我们的<code class="fe ok ol om mg b">text-gen</code>组件:</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="1044" class="mk ml it mg b gy mm mn l mo mp">ng generate component text-gen</span></pre><p id="2d3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们使用 Angular CLI <code class="fe ok ol om mg b">ng</code>到<code class="fe ok ol om mg b">generate</code>一个新的<code class="fe ok ol om mg b">component</code>叫做<code class="fe ok ol om mg b">text-gen</code>。如果我们查看一下<code class="fe ok ol om mg b">app</code>目录，我们会注意到几个新文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/25287afcc114d7ee1864c9c209db1291.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*dokv7wnsfBhg5RR7WbC53A.png"/></div></figure><p id="7552" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们新的<code class="fe ok ol om mg b">text-gen</code>组件。要将组件放在 web 应用程序页面上，我们必须将组件标识符添加到<code class="fe ok ol om mg b">app.component.html</code> —组件选择器的名称包含在下面的<code class="fe ok ol om mg b">text-gen.component.ts</code>中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/67a1e2242ea1fd9f19e817dff226dd62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gx3J9JkX8lliYhD6CxJIhQ.png"/></div></div></figure><p id="c670" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，要在我们的应用程序中包含这个组件，我们只需在<code class="fe ok ol om mg b">app.component.html</code>中将<code class="fe ok ol om mg b">&lt;app-text-gen&gt;&lt;app-text-gen/&gt;</code>添加到我们的代码中。将之前包含在<code class="fe ok ol om mg b">app.component.html</code>中的所有内容移动到<code class="fe ok ol om mg b">text-gen.component.html</code>。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="6b79" class="my ml it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">6.加载我们的模型</h1><p id="913f" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">回到<code class="fe ok ol om mg b">src/app/text-gen</code>我们可以开始组装我们的模型。</p><p id="c3fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，在<code class="fe ok ol om mg b">text-gen.component.ts</code>中，让我们编写加载模型的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="po pp l"/></div></figure><p id="28fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对我来说，这里最令人困惑的部分是<code class="fe ok ol om mg b">async</code>和<code class="fe ok ol om mg b">await</code>——其余部分与 Python 差别不大。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/11035b114d397b12e993d1c752ee4e73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pZQYcAj0V2t8Pudlr-KjYw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">异步执行(左)和同步执行(右)—图片来自作者。</p></figure><p id="bb0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 Python 中，我们一次运行一行代码——等待当前行完成处理，然后移动到下一行。</p><p id="b6af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，JavaScript 可以并行运行我们的代码脚本。所以当第一行还在处理的时候，第二、三、四行已经被执行了——我们称之为异步执行。</p><p id="9c16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果这对你来说听起来像一场逻辑噩梦——相信我，当我说<strong class="lb iu">时，它是</strong>。</p><p id="ed6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ok ol om mg b">loadLayersModel</code>功能是异步的。为了正确处理这个问题，我们需要使用<code class="fe ok ol om mg b">async</code>使加载函数异步——允许我们使用<code class="fe ok ol om mg b">await</code>和<code class="fe ok ol om mg b">loadLayersModel</code>函数。</p><p id="03d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里使用<code class="fe ok ol om mg b">await</code>使得这一小部分代码是同步的(像 Python 一样)。我们在加载和构建<code class="fe ok ol om mg b">char2idx</code>和<code class="fe ok ol om mg b">idx2char</code>映射时也会用到这个。</p><h2 id="2ff9" class="mk ml it bd mz or os dn nd ot ou dp nh li ov ow nj lm ox oy nl lq oz pa nn pb bi translated">整合负载函数</h2><p id="c975" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">目前，我们的加载函数没有内置到我们的<code class="fe ok ol om mg b">text-gen</code>组件中。为了干净地做到这一点，我们可以将它与现有的类定义集成在一起。</p><p id="3516" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ok ol om mg b">TextGenComponent</code>类中，有一个名为<code class="fe ok ol om mg b">ngOnInit</code>的函数——在类初始化时，这个函数会被立即调用。因此，如果我们将 load 函数放入其中，页面一加载，我们就加载模型。</p><p id="a3c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">修改<code class="fe ok ol om mg b">ngOnInit</code>，我们得到如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="po pp l"/></div></figure><p id="5c09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，您可能会(也可能不会)遇到以下错误:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/07cb451f345a1d4dc3b1062022219401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QhGrHWblRTo_esE2UH3Ciw.png"/></div></div></figure><p id="efe5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果是，我们导航到<code class="fe ok ol om mg b">tfconfig.json</code>并将<code class="fe ok ol om mg b">"skipLibCheck": true</code>添加为 TensorFlow 推荐的<a class="ae ky" href="https://www.tensorflow.org/js/tutorials/setup#typescript" rel="noopener ugc nofollow" target="_blank">，如下所示:</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/d8d14f11a2e18714701f11d6d3cb36fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*ypUf92gxkSU-xUw9peJuhw.png"/></div></figure></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="17aa" class="my ml it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">7.做预测</h1><p id="d8cf" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">我们已经加载了模型、字符到索引的映射和字符数组。现在，我们需要编写一个函数，它以文本的形式接受输入，并使用它来输出更多的文本，正如我们的模型所预测的那样。</p><p id="fc19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以把它分成三个部分:</p><ul class=""><li id="a5c7" class="pt pu it lb b lc ld lf lg li pv lm pw lq px lu py pz qa qb bi translated"><strong class="lb iu">要索引的字符</strong> —将文本转换为数字数组</li><li id="2edb" class="pt pu it lb b lc qc lf qd li qe lm qf lq qg lu py pz qa qb bi translated"><strong class="lb iu">预测循环</strong> —下一个最可能值的迭代预测</li><li id="177e" class="pt pu it lb b lc qc lf qd li qe lm qf lq qg lu py pz qa qb bi translated"><strong class="lb iu">字符索引</strong> —将预测数字数组转换回文本</li></ul><h2 id="6996" class="mk ml it bd mz or os dn nd ot ou dp nh li ov ow nj lm ox oy nl lq oz pa nn pb bi translated">要索引的字符</h2><p id="489e" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">第一部分是文本到数字数组的转换。为此，我们使用了<code class="fe ok ol om mg b">getNum</code>功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="po pp l"/></div></figure><p id="202c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ok ol om mg b">getNum</code>接受<code class="fe ok ol om mg b">char2idx</code>和输入文本，并返回相同文本的编码版本。例如，用<a class="ae ky" href="https://github.com/jamescalam/meditations_ai/blob/master/incl_models/LSTM_e256_sl100_0414/char2idx.json" rel="noopener ugc nofollow" target="_blank">这个 char2idx 字典</a>我们得到:</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="a280" class="mk ml it mg b gy mm mn l mo mp">getNum(char2idx, "Hello World")</span></pre><p id="729a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ok ol om mg b"><strong class="lb iu">[Out]:</strong> [20, 45, 52, 52, 55, 1, 35, 55, 58, 52, 44]</code></p><p id="70b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">预测循环</strong></p><p id="1e6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们代码中最复杂的部分，但它只做了一点点:</p><ul class=""><li id="24a4" class="pt pu it lb b lc ld lf lg li pv lm pw lq px lu py pz qa qb bi translated">将由<code class="fe ok ol om mg b">getNum</code>生成的索引数组转换成张量——我们的模型需要的数据类型</li><li id="0890" class="pt pu it lb b lc qc lf qd li qe lm qf lq qg lu py pz qa qb bi translated">将张量输入到我们的模型中，该模型输出一个新的张量，其中包含每个字符的预测概率——由数组索引表示</li><li id="fcb9" class="pt pu it lb b lc qc lf qd li qe lm qf lq qg lu py pz qa qb bi translated">用<code class="fe ok ol om mg b">indexOfMax</code>取最高概率指数，并将其反馈到模型中进行另一次预测</li></ul><p id="f131" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在代码中，这给了我们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="po pp l"/></div></figure><p id="a19b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意,<code class="fe ok ol om mg b"><a class="ae ky" href="https://gist.github.com/jamescalam/b54dba89fc02feb7e08dc5017e6ac38d" rel="noopener ugc nofollow" target="_blank">indexOfMax</a></code>函数查找数组中最大值的索引——我们把它放在我们的类之外。</p><h2 id="d509" class="mk ml it bd mz or os dn nd ot ou dp nh li ov ow nj lm ox oy nl lq oz pa nn pb bi translated">字符索引</h2><p id="01bf" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">这部分是最简单的，实际上我们已经在预测循环的第 39 行实现了它:</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="11dd" class="mk ml it mg b gy mm mn l mo mp">this.text = this.text.concat(this.idx2char[yIdx]);</span></pre><p id="8675" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它所做的只是将预测的索引传递给<code class="fe ok ol om mg b">idx2char</code>，返回英文字符并将其连接到当前文本字符串。迭代生成我们预测的文本。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="cdf2" class="my ml it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">8.TextGenComponent</h1><p id="9fbd" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">这些部分都是通过<code class="fe ok ol om mg b">generate</code>函数实现的——该函数是作为另一个方法添加到<code class="fe ok ol om mg b">TextGenComponent</code>类中的。</p><p id="1a26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ok ol om mg b">getNum</code>和<code class="fe ok ol om mg b">indexOfMax</code>方法都被添加到组件类之外。</p><p id="ad40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们在<code class="fe ok ol om mg b">text-gen.component.ts</code>中将所有这些放在一起时，我们得到了脚本的功能版本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="po pp l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">完整的 text-gen.component.ts 脚本。如果它看起来很多，不要担心——这个代码块也让我害怕，但是一旦你一次一行地完成它，它会出奇地简单。</p></figure><h2 id="6b0a" class="mk ml it bd mz or os dn nd ot ou dp nh li ov ow nj lm ox oy nl lq oz pa nn pb bi translated">连接页面和模型</h2><p id="58cb" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">现在，我们需要做的就是将我们的首页元素——<code class="fe ok ol om mg b">&lt;textarea&gt;</code>和<code class="fe ok ol om mg b">&lt;button&gt;</code>——连接到组件的内部。</p><p id="e866" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导航至<code class="fe ok ol om mg b">src/text-gen/text-gen.component.html</code>并添加以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="po pp l"/></div></figure><p id="25cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要将显示在<code class="fe ok ol om mg b">&lt;textarea&gt;</code>中的文本绑定到包含在<code class="fe ok ol om mg b">TextGenComponent</code>中的<code class="fe ok ol om mg b">text</code>变量。这很容易通过向<code class="fe ok ol om mg b">&lt;textarea&gt;</code>元素添加<code class="fe ok ol om mg b">[value]="text"</code>来完成。</p><p id="b10b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当<code class="fe ok ol om mg b">generate</code>运行时，它用新文本更新<code class="fe ok ol om mg b">TextGenComponent.text</code>——反过来更新<code class="fe ok ol om mg b">&lt;textarea&gt;</code>。</p><p id="f6fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一部分是告诉 Angular 在点击“沉思”按钮时运行<code class="fe ok ol om mg b">generate</code>。还是那句话，这个超级简单，加上<code class="fe ok ol om mg b">(click)="generate( meditationInput.value)"</code>就行了。</p><p id="09fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ok ol om mg b">meditationInput</code>指的是<code class="fe ok ol om mg b">&lt;textarea&gt;</code>元素，而<code class="fe ok ol om mg b">.value</code>捕捉元素内部的文本，并将其传递给我们的<code class="fe ok ol om mg b">generate</code>函数。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="f6b5" class="my ml it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">拍拍自己的背</h1><p id="63c6" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">就这样，我们完成了！这款应用程序谈不上漂亮(正如我说过的——我不是设计师)，但功能齐全:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi me"><img src="../Images/d8bfb308713ced313b6435715c6d38ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7jjskxGiwVh63s-iARFeCg.gif"/></div></div></figure><p id="e1c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简洁起见，我将把进一步的开发、设计和清理工作留到以后的文章中进行——本指南已经远远超出了我的预期！</p><p id="42be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管这篇文章很长，但我希望它是有用的。欢迎提问，或者告诉我不清楚的地方。那些使用过 JavaScript/TypeScript 或 Angular 的人——让我知道什么需要改进。</p><p id="f1a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="850f" class="my ml it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">参考</h1><p id="3fda" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">[1]<a class="ae ky" href="https://w3techs.com/technologies/details/cp-javascript/" rel="noopener ugc nofollow" target="_blank">JavaScript 作为客户端编程语言在</a>、W3 Techs 网站上的使用统计</p></div></div>    
</body>
</html>