<html>
<head>
<title>How to calculate percentage within groupby in Pandas?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何计算熊猫的组内百分比？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/4-useful-tips-of-pandas-groupby-3744eefb1852?source=collection_archive---------7-----------------------#2020-02-03">https://towardsdatascience.com/4-useful-tips-of-pandas-groupby-3744eefb1852?source=collection_archive---------7-----------------------#2020-02-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="7012" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">和其他分组提示</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/7ccddc4f02ed7a735d1c07c1612a8a1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pzZ1TpLZJkxDWHmj"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">伊洛娜·弗罗利希在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9470" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">(这个帖子的所有代码你可以在<a class="ae le" href="https://github.com/andryw/pandas_tips" rel="noopener ugc nofollow" target="_blank">我的 github </a>里找到)</p><p id="aa3a" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">(<a class="ae le" rel="noopener" target="_blank" href="/how-to-show-all-columns-rows-of-a-pandas-dataframe-c49d4507fcf"> #2 关于熊猫的帖子提示:如何显示熊猫数据帧的所有列/行？</a>)</p><p id="bdb5" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">你好！Pandas 是数据科学中最重要的 Python 库之一。Groupby 是对熊猫进行分析的最强大的功能之一。它类似于 SQL 的 GROUP BY。</p><p id="26e1" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在我作为数据科学家的日常生活中，我发现了一些非常有用的分组技巧。但是熊猫群是什么？</p><h1 id="48c9" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">分组依据</h1><p id="e5b7" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">正如 Pandas 文档中所指出的，Groupby 是一个涉及以下一个或多个步骤的过程:</p><ul class=""><li id="5189" class="mi mj it lh b li lj lm ln lq mk lu ml ly mm mc mn mo mp mq bi translated">根据某些标准将数据分组。</li><li id="27d1" class="mi mj it lh b li mr lm ms lq mt lu mu ly mv mc mn mo mp mq bi translated">将函数独立应用于每个组。</li><li id="9eb9" class="mi mj it lh b li mr lm ms lq mt lu mu ly mv mc mn mo mp mq bi translated">将结果组合成数据结构。</li></ul><p id="498e" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在大多数情况下，我们希望将数据分成组，并对这些组做一些事情。通常是聚集，转化，过滤。</p><p id="da95" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我将使用这个玩具销售数据框架来说明这些技巧:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/0ba1c562e20f554c5788ad785cfa32e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:354/format:webp/1*tnmlUtsginZjWTbb_OXzPQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">玩具销售数据框架</p></figure><h1 id="49a5" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">每组内的相对频率</h1><p id="9083" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">这是我用的最多的功能。很多时候我使用 Groupby 来汇总一些值，我想知道每个组中的值所占的百分比，而不是所有数据中的百分比。<br/>如果我们在汇总数据框中直接计算百分比，将使用所有数据计算结果:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="49df" class="nc jr it my b gy nd ne l nf ng">groupped_data = df.groupby(['week', 'day']).agg({'sales': 'sum'})<br/>groupped_data["%"] = groupped_data.apply(lambda x:  100*x / x.sum())<br/>groupped_data</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/8909022c828972d32069b65e2ba4cca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:442/format:webp/1*KkVZ5oPt1fXqy9ssrJ8bPg.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">每天和每周的销售额，但百分比是使用全部数据计算的</p></figure><p id="a762" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">例如，第一行的百分比(19.23%)是 10 除以 52(所有销售额的总和)。要计算与每周相关的百分比，我们必须使用 groupby(level = 0):</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="df6c" class="nc jr it my b gy nd ne l nf ng">groupped_data["%"] = groupped_data.groupby(level=0).apply(<br/>     lambda x:  100*x / x.sum()<br/>)<br/>groupped_data</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/c10c8e8a59d64b71a8ac84d969d74178.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*UrXTump2nV5LIC7LQu2Mag.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">每天和每周的销售额，但百分比仅使用每周的数据计算</p></figure><p id="3b94" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在，第一行中的百分比(55.55%)只比较 a 周的销售额，groupby("level=0 ")选择层次索引的第一级。在我们的例子中，第一级是<em class="nj">天</em>。</p><h1 id="ee30" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">累积和</h1><p id="6949" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">很多时候我想做一个累加和。在我们的示例中，验证我们每天完成了多少销售。为此，我们需要使用 cumsum()函数:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="b87e" class="nc jr it my b gy nd ne l nf ng">groupped_data.cumsum()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/cc80e64ab4b021fe2feca17670b56213.png" data-original-src="https://miro.medium.com/v2/resize:fit:336/format:webp/1*aM0WtK7rY9o2TakGQYCE5g.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">销售的累计总额</p></figure><p id="1ab3" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">要计算每周的累积和，您可以使用上一个主题的相同技巧(groupby(level = 0)):</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="a722" class="nc jr it my b gy nd ne l nf ng">groupped_data.groupby(level=0).cumsum()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/19bdc1962ae461cd11b3b5800e0ccde4.png" data-original-src="https://miro.medium.com/v2/resize:fit:306/format:webp/1*UOZJ1DuNER2ER_h8OMqUSQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">每周的累计销售额</p></figure><h1 id="fec2" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">更改聚集度量的名称</h1><p id="fd44" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">如果希望在聚合时更改聚合指标的列名，只需传递一个包含新列名和聚合函数的元组:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="6ec3" class="nc jr it my b gy nd ne l nf ng">df.groupby("week").agg(<br/>    {"sales": [("max_sales","max"), ("mean_sales","mean")]}<br/>)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nm"><img src="../Images/5451daa78dd8ab9d2a682d6ce7cff522.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F4j_eFFF9Ko_MXPE7p_tXw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">具有不同列名的聚合列。</p></figure><p id="5171" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果您想删除级别<em class="nj"> sales </em>，这可能会很有用:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="39b7" class="nc jr it my b gy nd ne l nf ng">groupped_data.columns = groupped_data.columns.droplevel()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/62f26a705824e7c781487457aeca2625.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*5-xUjpOAEZANMSDRUTc8uQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">移除数据帧的一个级别</p></figure><h1 id="78f9" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">将值放入列表中</h1><p id="7274" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">如果你想把一个组的所有值放入一个列表，你只需要这样做:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="3238" class="nc jr it my b gy nd ne l nf ng">pd.DataFrame(df.groupby('week')['sales'].apply(list))</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi no"><img src="../Images/a25bf5792b209ff3ba7a627f13b8da4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*jD_WJUXQfEcjXliZhnCdeQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">每周的销售额都在列表中</p></figure><p id="aa0e" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">它将<em class="nj">应用</em>函数在每周的每个<em class="nj">组的<em class="nj">销售</em>列中创建一个<em class="nj">列表</em>。</em></p><h2 id="dba4" class="nc jr it bd js np nq dn jw nr ns dp ka lq nt nu ke lu nv nw ki ly nx ny km nz bi translated">来源</h2><ul class=""><li id="5288" class="mi mj it lh b li md lm me lq oa lu ob ly oc mc mn mo mp mq bi translated"><a class="ae le" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html" rel="noopener ugc nofollow" target="_blank">https://pandas . pydata . org/pandas-docs/stable/user _ guide/group by . html</a></li><li id="19a4" class="mi mj it lh b li mr lm ms lq mt lu mu ly mv mc mn mo mp mq bi translated"><a class="ae le" href="https://stackoverflow.com/questions/23377108/pandas-percentage-of-total-with-groupby" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/23377108/pandas-percentage-total-with-group by</a></li><li id="c24d" class="mi mj it lh b li mr lm ms lq mt lu mu ly mv mc mn mo mp mq bi translated"><a class="ae le" href="https://stackoverflow.com/questions/22219004/grouping-rows-in-list-in-pandas-groupby" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/22219004/grouping-rows-in-list-in-pandas-group by</a></li></ul></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="c03a" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lh iu"> <em class="nj">目前就这样。但我会回来发布更多关于熊猫和其他数据科学主题的文章。请随意添加您的评论</em> </strong></p></div></div>    
</body>
</html>