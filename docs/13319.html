<html>
<head>
<title>A guide to building WhatsApp chatbots using Dialogflow and FireBase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Dialogflow 和 FireBase 构建 WhatsApp 聊天机器人指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-guide-to-building-whatsapp-chatbots-using-dialogflow-and-firebase-4ff5e904ac3?source=collection_archive---------9-----------------------#2020-09-13">https://towardsdatascience.com/a-guide-to-building-whatsapp-chatbots-using-dialogflow-and-firebase-4ff5e904ac3?source=collection_archive---------9-----------------------#2020-09-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f3b2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一步一步的教程，为你的企业创建智能聊天机器人，并让他们与你的后端互动</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4d8abd4ccb5b13c5aa4c1f7f699e41bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5KvyE5G3uTrF4-CODxd60Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@danielkorpai?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">丹尼尔·科尔派</a>在<a class="ae ky" href="https://unsplash.com/s/photos/chat?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="e33d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">聊天机器人是对话代理，能够与互联网用户进行对话的程序。在本教程中，我将带领你使用<a class="ae ky" href="https://www.twilio.com/" rel="noopener ugc nofollow" target="_blank"> Twilio </a>平台实现 WhatsApp 聊天机器人。</p><p id="e4e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了静态聊天机器人，我们还将受益于谷歌<a class="ae ky" href="https://dialogflow.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> Dialogflow </a>的强大功能，创造出能够理解人类语言的智能机器人。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="acec" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.WhatsApp 聊天机器人</h1><p id="9a42" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">WhatsApp 是世界上许多地方最受欢迎的 OTT 应用。有了 WhatsApp 聊天机器人，你可以在客户使用的平台上为他们提供支持，并立即回答他们的问题。</p><p id="a47e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<em class="mz"> Twilio、Flask </em>和<em class="mz"> Heroku </em>，以及许多其他高级平台，如<em class="mz"> DialogFlow </em>，我们可以构建令人惊叹的聊天机器人，正如我们将在本教程中所做的那样。</p><h2 id="fbf1" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">特维利奥</h2><p id="7dec" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Twilio 是一家云通信平台即服务(CPaaS)公司，它允许软件开发人员以编程方式拨打和接听电话、发送和接收文本消息，以及使用其 web 服务 API 执行其他通信功能。</p><p id="257c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了 WhatsApp 的 Twilio API，你可以发送通知，进行双向对话，或者构建聊天机器人。</p><p id="0c88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">免费，无需等待你的 Twilio 号码被 WhatsApp 批准，Twilio Sandbox for WhatsApp 使你能够立即创建你的聊天机器人，就像我们在这个项目中将要看到的那样。</p><p id="8526" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.创建一个<a class="ae ky" href="https://www.twilio.com/try-twilio" rel="noopener ugc nofollow" target="_blank"> Twilio 账户</a></p><p id="ca90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.创建一个<a class="ae ky" href="https://www.twilio.com/console/projects/create" rel="noopener ugc nofollow" target="_blank">新项目</a></p><p id="845a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.在项目控制台上，打开可编程 SMS 仪表板</p><p id="43f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.选择 WhatsApp 测试版</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/746e679f6dfefa0d6653621076b23066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BjeSHLvoUEV75BQihRc_rA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nn">作者图片</em></p></figure><p id="2464" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你激活你的沙箱时，你会看到与之相关的电话号码(这里是+1 415 …)以及它的名字(这里是普通音节)</p><h2 id="7673" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">使用 Flask 创建应用程序</h2><p id="a244" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">1.创建新的 Python 虚拟环境:</p><ul class=""><li id="d281" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">在新文件夹中打开终端并执行:<code class="fe nx ny nz oa b">python -m venv myvenv</code></li></ul><p id="d10e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.激活您的虚拟环境:</p><ul class=""><li id="81b2" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">视窗:<code class="fe nx ny nz oa b">myvenv\Scripts\activate</code></li><li id="0a85" class="no np it lb b lc ob lf oc li od lm oe lq of lu nt nu nv nw bi translated">Linux : <code class="fe nx ny nz oa b">source myvenv/bin/activate</code></li></ul><p id="c98e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.安装这两个 Python 包:</p><ul class=""><li id="5e5c" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated"><a class="ae ky" href="https://www.twilio.com/" rel="noopener ugc nofollow" target="_blank"> Twilio </a> : <code class="fe nx ny nz oa b">pip install twilio</code></li><li id="5e66" class="no np it lb b lc ob lf oc li od lm oe lq of lu nt nu nv nw bi translated"><a class="ae ky" href="https://flask.palletsprojects.com/" rel="noopener ugc nofollow" target="_blank">烧瓶</a> : <code class="fe nx ny nz oa b">pip install flask</code></li></ul><blockquote class="og oh oi"><p id="ff4c" class="kz la mz lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">Flask 是一个用 Python 编写的微型 web 框架。这意味着<strong class="lb iu"> flask </strong>为你提供了工具、库和技术，让你可以构建一个网络应用。</p></blockquote><p id="aaa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.创建烧瓶应用程序:</p><p id="a1bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在你的文件夹中，创建一个名为<em class="mz"> app.py </em>的文件，然后<em class="mz">复制&amp;粘贴</em>下面的代码:</p><pre class="kj kk kl km gt om oa on oo aw op bi"><span id="9f2d" class="na md it oa b gy oq or l os ot">from flask import Flask, request<br/>from twilio.twiml.messaging_response import MessagingResponse</span><span id="c8a3" class="na md it oa b gy ou or l os ot">app = Flask(__name__)</span><span id="d6ba" class="na md it oa b gy ou or l os ot">@app.route("/")<br/>def hello():<br/>    return "Hello, World!"</span><span id="b96c" class="na md it oa b gy ou or l os ot">@app.route("/sms", methods=['POST'])<br/>def sms_reply():<br/>    """Respond to incoming calls with a simple text message."""<br/>    # Fetch the message<br/>    msg = request.form.get('Body')</span><span id="8192" class="na md it oa b gy ou or l os ot">    # Create reply<br/>    resp = MessagingResponse()<br/>    resp.message("You said: {}".format(msg))</span><span id="ee36" class="na md it oa b gy ou or l os ot">    return str(resp)</span><span id="cca6" class="na md it oa b gy ou or l os ot">if __name__ == "__main__":<br/>    app.run(debug=True)</span></pre><p id="52f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个基本的 flask web 应用程序，它使我们能够在/ route 中获取<code class="fe nx ny nz oa b">Hello, world!</code>，如果我们将消息发布到<strong class="lb iu"> <em class="mz"> /sms </em> </strong> route，就可以得到我们的消息，正如我们在以下步骤中看到的</p><p id="590b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.运行 app : <code class="fe nx ny nz oa b">python app.py</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/704d5edc42c18ca0e646af6df7aa25b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dci8nIfgIYJoBdlgdK8Sow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nn">作者图片</em></p></figure><p id="eeb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的应用程序现在正在运行。</p><p id="2af7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在浏览器中输入<code class="fe nx ny nz oa b">http://127.0.0.1:5000/</code>来检查。(你会得到<code class="fe nx ny nz oa b">Hello, world!</code>)</p><p id="ec63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，远程机器不可能访问你的应用，因此需要<strong class="lb iu"> <em class="mz"> Ngrok </em> </strong></p><h2 id="f76e" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">使用 Ngrok 获取应用程序的公共地址</h2><p id="538a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Ngrok 将使我们能够为本地运行的应用程序提供一个公共的 URL。</p><p id="1326" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.下载<a class="ae ky" href="https://ngrok.com/download" rel="noopener ugc nofollow" target="_blank"> Ngrok </a>并解压</p><p id="7dc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.通过执行:<code class="fe nx ny nz oa b">./ngrok http 5000</code>从命令行运行它</p><p id="2ace" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.现在，您可以使用提供的 URL(类似于<code class="fe nx ny nz oa b"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/******.ngrok.io)">https://******.ngrok.io</a></code> <a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/******.ngrok.io)"> ) </a>)从远程机器访问本地运行的应用程序</p><p id="5c9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.返回 Twilio sandbox 并将其粘贴为接收邮件的 URL:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/209bb28f9f614f30c3996958b177a3ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kDNBU7sluGV2UJ01u01Oag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nn">作者图片</em></p></figure><p id="5a28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.你现在可以在手机中打开 WhatsApp，添加你在之前步骤中从 Twilio 获得的号码(+1 415 …)，并通过他们告诉你的代码开始对话(在这里加入常规音节)</p><p id="7618" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6.你现在可以发送任何你想要的 WhatsApp 信息，机器人会通过发送回相同的信息来回复。这是一种鹦鹉机器人😃</p><p id="8fc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，我们仍然有一个主要的问题，你的机器应该一直运行，以允许应用程序响应用户的请求。</p><h1 id="167f" class="mc md it bd me mf ox mh mi mj oy ml mm jz oz ka mo kc pa kd mq kf pb kg ms mt bi translated">2.使用 Heroku 摆脱你的机器</h1><p id="4580" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">多亏了 Heroku，我们将能够在云中部署我们的应用程序，以及它有效运行所需的所有需求。因此，我们的机器将受益于关机的奢侈。为此，我们需要:</p><p id="52dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.在我们的虚拟环境中，安装 gunicorn: <code class="fe nx ny nz oa b">pip install gunicorn</code></p><p id="1d75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.在您的文件夹中创建这些文件:</p><ul class=""><li id="e870" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated"><strong class="lb iu"> <em class="mz"> Procfile </em> </strong>:然后将该内容保存在其中<code class="fe nx ny nz oa b">web gunicorn app:app</code></li><li id="2d59" class="no np it lb b lc ob lf oc li od lm oe lq of lu nt nu nv nw bi translated"><strong class="lb iu"> <em class="mz"> runtime.txt </em> </strong>:然后把这个内容保存在里面<code class="fe nx ny nz oa b">python-3.7.2</code></li><li id="9698" class="no np it lb b lc ob lf oc li od lm oe lq of lu nt nu nv nw bi translated"><strong class="lb iu"><em class="mz">requirements . txt</em></strong>:你可以简单的输入<code class="fe nx ny nz oa b">pip freeze &gt; requirements.txt</code>来填充你的 app 需要的所有第三方库。</li><li id="7f0a" class="no np it lb b lc ob lf oc li od lm oe lq of lu nt nu nv nw bi translated"><strong class="lb iu"> <em class="mz">。gitignore </em> </strong>:然后把这个内容保存在里面</li></ul><pre class="kj kk kl km gt om oa on oo aw op bi"><span id="69f0" class="na md it oa b gy oq or l os ot">myvenv/<br/>*.pyc</span></pre><p id="bbba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.下载并安装<a class="ae ky" href="https://git-scm.com/downloads" rel="noopener ugc nofollow" target="_blank">Git</a>；然后在您的虚拟环境中:</p><ul class=""><li id="fcc1" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">在您的项目文件夹中初始化一个新的 git 存储库:<code class="fe nx ny nz oa b">git init</code></li><li id="af01" class="no np it lb b lc ob lf oc li od lm oe lq of lu nt nu nv nw bi translated">将所有未跟踪的文件添加到 git 库:<code class="fe nx ny nz oa b">git add .</code></li><li id="1e04" class="no np it lb b lc ob lf oc li od lm oe lq of lu nt nu nv nw bi translated">将更改提交到 git 存储库:<code class="fe nx ny nz oa b">git commit -m "first commit"</code></li></ul><p id="b155" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.如果你还没有一个新的 Heroku 帐号，请创建一个。然后下载 Heroku <a class="ae ky" href="https://devcenter.heroku.com/articles/heroku-cli#download-and-install" rel="noopener ugc nofollow" target="_blank">命令行界面(CLI) </a>，直接从终端轻松创建和管理您的 Heroku 应用程序。</p><p id="814b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.使用<code class="fe nx ny nz oa b">heroku login</code>从您的虚拟环境连接到您的 Heroku 帐户，然后您将被转到浏览器中基于 web 的界面以完成身份验证阶段。</p><p id="a35f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6.创建一个新的 Heroku 应用程序<code class="fe nx ny nz oa b">heroku create &lt;app-name&gt;</code></p><p id="80f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">7.通过将您的本地 git 存储库推送到远程 Heroku 应用程序的 git 存储库来部署您的应用程序:<code class="fe nx ny nz oa b">git push heroku master</code></p><p id="957d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，当部署完成时，您将在终端中看到您可以访问应用程序的地址。-类似于<code class="fe nx ny nz oa b">https://&lt;app-name&gt;.herokuapp.com/sms</code> -复制它，回到你的沙箱，用新的<em class="mz">Heroku</em>URL 替换<em class="mz"> Ngrok </em> URL。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/f3022d8ed687a38afd8bfc2b13da5149.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98v_hcz68SEkc9CJVBcqaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nn">作者图片</em></p></figure><p id="a13b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你，你的鹦鹉 WhatsApp 机器人现在全天候运行，它不再需要你的机器的帮助了😃你可以关掉它。</p><h1 id="d654" class="mc md it bd me mf ox mh mi mj oy ml mm jz oz ka mo kc pa kd mq kf pb kg ms mt bi translated">3.更新您的代码</h1><p id="e191" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">比方说，你明天想出另一个主意，而不是你做的这个鹦鹉机器人，你需要做的就是修改你的代码(在文件<em class="mz"> app.py </em>中)。如果项目很复杂，您还可以添加更多文件)然后:</p><pre class="kj kk kl km gt om oa on oo aw op bi"><span id="453b" class="na md it oa b gy oq or l os ot"># connect to your virtual environment<br/>&lt;virtual_environment_name&gt;\Scripts\activate #Windows<br/>source &lt;virtual_environment_name&gt;/bin/activate #Linux</span><span id="ea27" class="na md it oa b gy ou or l os ot"># connect to your heroku account<br/>heroku login</span><span id="974f" class="na md it oa b gy ou or l os ot"># prepare all the modified files and push them to Heroku<br/>git add .<br/>git commit -m "first change"<br/>git push heroku master</span></pre><p id="035c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">⚠️:如果你在你的虚拟环境中安装了新的软件包，你必须通过更新文件<strong class="lb iu"> <em class="mz"> requirements.txt </em> </strong>来告诉 Heroku:只需在<code class="fe nx ny nz oa b">git add .</code>前输入<code class="fe nx ny nz oa b">pip freeze &gt; requirements.txt</code>就可以了。</p><h1 id="1aab" class="mc md it bd me mf ox mh mi mj oy ml mm jz oz ka mo kc pa kd mq kf pb kg ms mt bi translated">4.用你自己的号码</h1><p id="7575" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果你想创建一个真正的商业 WhatsApp 机器人，我之前介绍的方法有两个缺点:</p><p id="51ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(1)为了使用这个机器人，你的客户必须用一个奇怪的信息开始对话😑(此处加入正则音节)；</p><p id="7f5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(2)机器人想出的是 Twilio 的 logo，而不是你的。</p><p id="6e63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为我们使用了 Twilio 沙盒，而提供给我们的号码不是我们的。然而，Twilio 为你提供了拥有一个号码的可能性，从而解决了上述问题。为此，您需要遵循以下步骤:</p><p id="a944" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步:买一个<a class="ae ky" href="https://www.twilio.com/console/phone-numbers/search" rel="noopener ugc nofollow" target="_blank"> Twilio 号</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/23f15a7a6e28e0acf52450a9f93b1a13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DUGu0_ZS3mP1oaPMzPXmSQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nn">作者图片</em></p></figure><p id="a4fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二步:通过填写<a class="ae ky" href="https://www.twilio.com/whatsapp/request-access" rel="noopener ugc nofollow" target="_blank"> Twilio 的“请求访问”表格</a>来请求访问，以便在 WhatsApp 上启用您的 Twilio 号码(确保您事先有您的脸书业务经理 ID)</p><p id="d5dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您的请求获得批准后，Twilio 将通过电子邮件通知您提交您的<em class="mz">发件人资料</em>和<em class="mz"> WhatsApp 消息模板</em>的后续步骤，然后另一封电子邮件将向您展示如何<em class="mz">批准 Twilio 代表您发送消息</em>以及如何<em class="mz">验证您的脸书业务经理账户</em>。</p><p id="4728" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，在发出请求后，确保你经常检查你的电子邮件，为接下来的步骤做准备。整个过程需要 2 到 3 周。</p><p id="8704" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.twilio.com/docs/whatsapp/tutorial/connect-number-business-profile" rel="noopener ugc nofollow" target="_blank">关于流程的更多信息</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2a48" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">5.使用 DialogFlow 的高级聊天机器人</h1><p id="04d9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">到目前为止，我们创造了一个聊天机器人，它有能力管理简单的对话和重复一个人说的话😅这不是很酷吗🙄。实际上，我们在前面的章节中关注的是让这个机器人在流行的聊天平台 WhatsApp 上工作。</p><p id="5a13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，我们没有使用我们的任何数据来训练或个性化机器人。在这一部分，我们将训练和微调我们的聊天机器人，并让它与后端交互。让我们以一个购物/送货店的案例研究为例。</p><h2 id="f62c" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">设置 DialogFlow 代理</h2><p id="c466" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Dialogflow <em class="mz">代理</em>是一个虚拟代理，它处理与最终用户的对话。它是一个自然语言理解模块，可以理解人类语言的细微差别。DialogFlow 的代理使用<a class="ae ky" href="https://cloud.google.com/dialogflow/docs/intents-overview" rel="noopener ugc nofollow" target="_blank">意图</a>对每次对话的最终用户意图进行分类，使用<a class="ae ky" href="https://cloud.google.com/dialogflow/docs/entities-overview" rel="noopener ugc nofollow" target="_blank">实体</a>从最终用户的表达中识别和提取特定数据(我们将使用它们将数据发送到后端)。</p><p id="1f99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以首先要做的是..<strong class="lb iu">登录</strong> <a class="ae ky" href="https://dialogflow.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">对话流程控制台</strong> </a> <strong class="lb iu">并创建一个新的代理</strong>..在左侧菜单中，您可以<strong class="lb iu">启用<em class="mz">闲聊</em></strong>。基本上，你的机器人现在能够自动处理“嗨，你好，你好吗，再见……”之类的事情。试试看！(右侧有一个“<em class="mz">立即尝试</em>”部分)</p><p id="beab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当最终用户写或说一些话时，Dialogflow 会将最终用户的表达与您的代理中的最佳意图进行匹配。为了做到这一点，您的代理必须接受一些培训短语(最终用户可能会说的示例短语)的培训。当最终用户表达式类似于这些短语之一时，Dialogflow 匹配意图。你不必定义每个可能的例子，因为 Dialogflow 的内置机器学习会在你的列表上扩展其他类似的短语。</p><ul class=""><li id="459f" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">在左侧菜单中，选择 Intent 并创建一个新的。</li><li id="03af" class="no np it lb b lc ob lf oc li od lm oe lq of lu nt nu nv nw bi translated">在“训练短语”部分，添加一些将触发这一意图的表达。当你添加它们时，你会看到一些实体被自动突出显示(如位置或日期时间等)；如果需要，还可以添加自定义实体。</li><li id="a7ac" class="no np it lb b lc ob lf oc li od lm oe lq of lu nt nu nv nw bi translated">在 action and parameters 部分，您可以将一些实体标记为<em class="mz"> required </em>，这样当意图被触发时，代理将总是请求它们。请注意，如果您将某个参数标记为必需，您必须在<em class="mz">提示</em>栏中添加代理将询问最终用户的问题。</li></ul><p id="a737" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，您必须有可能添加一个默认答案下的反应部分或让后端生成自定义答案。</p><h2 id="68ce" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">数据库</h2><p id="58fc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们将使用谷歌的 Firebase 实时数据库，这是一个云托管的 NoSQL 数据库，允许您使用 JSON 格式在您和您的用户之间实时存储和同步数据。</p><p id="84c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1-转到<a class="ae ky" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase 网站</a>并添加一个新项目。</p><p id="738c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2-在左侧菜单中，选择数据库，然后在测试模式下选择实时数据库。</p><p id="5329" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了能够访问您的数据库，添加和删除数据，您必须拥有数据库凭证。</p><p id="f37f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3-点击<em class="mz">项目概述</em>旁边的齿轮图标，然后选择<em class="mz">项目设置</em>。在<em class="mz"> Firebase SDK 片段</em>中，选择<em class="mz"> config </em>并将凭证复制到您计算机中的一个单独文件中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/d2ee20401ff407c0b5dd132c7b95f1c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SNxA8x33deCGtwvQewmRGA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nn">作者图片</em></p></figure><p id="71ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4-在您的计算机/虚拟环境中，创建一个<em class="mz"> app.py </em>文件并导入这些凭证，以及其他有用的库。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/bfec34bcb4affe759bdbd3e215692980.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SHBRGujvjh0vjfOk252jVw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nn">作者图片</em></p></figure><p id="d9b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5-将您的产品及其特征添加到实时数据库:</p><p id="67a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.1.在单独的文件中，将身份验证配置为 Firebase:</p><pre class="kj kk kl km gt om oa on oo aw op bi"><span id="44cc" class="na md it oa b gy oq or l os ot">import pyrebase            #install pyrebase first using pip install<br/>from firebaseconfig import config # firebase credentials</span><span id="e70b" class="na md it oa b gy ou or l os ot">firebase = pyrebase.initialize_app(config)<br/>db = firebase.database()</span></pre><p id="1d1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.2.以 JSON 格式准备您的产品，并使用以下命令将它们添加到 DB 中:</p><pre class="kj kk kl km gt om oa on oo aw op bi"><span id="47ef" class="na md it oa b gy oq or l os ot">prod1 = {<br/>"ID":"0",<br/>"order":"0",<br/>"number": 10,<br/>"color": "black",<br/>"size":"S",<br/>"address":"-",<br/>"date":"-"<br/>}</span><span id="0bfd" class="na md it oa b gy ou or l os ot"># add a product<br/>db.child("products").push({"shirt":prod1})</span><span id="8454" class="na md it oa b gy ou or l os ot"># update a product<br/>db.child("products").update({"shirt":prod2}) #define prod2 before</span><span id="f76b" class="na md it oa b gy ou or l os ot"># remove the whole chain of products<br/>db.child("products").remove()</span></pre><p id="6113" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以(实时)检查您的数据库的 web 界面，以查看您正在进行的更新。</p><h2 id="ad3e" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">检查我们的库存中是否有产品</h2><p id="3112" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在<em class="mz"> usefulfunction.py </em>文件中，我们定义了我们将在实现中使用的函数，其中有<em class="mz"> is_available() </em>函数，它检查给定的产品是否存在于实时数据库中</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/cf41ba068eab85cf41d74e7782316308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9chkZk0wEpe6NdlGZI7VDQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nn">作者图片</em></p></figure><h2 id="3b01" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">处理来自对话流的数据</h2><p id="80f0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">用户订单的特征来自于一个 JSON 格式的 Dialogflow。下面的函数提取这些特征，并检查是否有满足这些要求的产品。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/2dc4b384b5753eb0bd9754693f39f0f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M_M6BZvZxgaiKcOa1x8zbA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nn">作者图片</em></p></figure><p id="f872" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能会注意到存在两个未定义的函数:<em class="mz"> all_fields() </em>函数只是检查最终用户是否填写了所有必需的字段，而<em class="mz"> location_format() </em>函数将位置变量的格式调整为可读格式。</p><h2 id="0f00" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">把它们放在一起</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/b5454dad0c054e4540de95931d2f525a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*26dXj4J5a8mxzeQ5hpAi6A.png"/></div></div></figure><p id="c4ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的文件<em class="mz"> app.py </em>中，我们设置了 Flask API。</p><p id="85cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">/ main 根显示的只是一个<em class="mz"> hello world </em>..专业人士有标准；)</p><p id="601e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz"> /check </em>路径是我们接收 POST 请求、从 Dialogflow 中提取数据、处理数据、在实时数据库中检查产品的可用性并总是使用 JSON 格式回复用户的地方。</p><p id="0f4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以在本地运行<em class="mz"> app.py </em>并使用<em class="mz"> Ngrok </em>来获取一个公共地址，或者像我们之前所做的那样将您的应用程序推送到 Heroku。</p><h2 id="b7c2" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">完成</h2><p id="1395" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在 Dialogflow 中，默认情况下，您的代理用静态响应来响应匹配的意图。为了使用动态答案，您必须启用<em class="mz">履行</em>选项。</p><p id="cff3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">返回到您的 Dialogflow 控制台，在左侧菜单中单击<em class="mz"> fulfillment </em>，启用<em class="mz"> webhook </em>，将 URL 更改为托管您的应用程序的 URL，并保存更改。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/62740afeea13c933678be6ab79bde0cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E8rerOZi-zu_z5TDuD_noQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nn">作者图片</em></p></figure><p id="d2a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当一个启用了实现功能的意向匹配时，Dialogflow 会向您的<em class="mz"> webhook </em>服务(后端应用程序)发送一个请求，其中包含关于匹配意向的信息。</p><p id="348b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在转到您之前创建的意向(在意向部分下)，在该页面的底部您会看到一个<em class="mz">履行</em>部分，启用<em class="mz"> webhook 调用意向</em>和<em class="mz">填充空位。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/7bed6b0bd97c313bf24213d87e49e26f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R_GKQeTrDXEFVUjykuqm0w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nn">作者图片</em></p></figure><p id="39ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜..您的聊天机器人现在运行正常，请查看<em class="mz">立即尝试</em>部分。</p><h1 id="05d4" class="mc md it bd me mf ox mh mi mj oy ml mm jz oz ka mo kc pa kd mq kf pb kg ms mt bi translated">结论</h1><p id="2d2d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当最终用户开始与<strong class="lb iu">聊天机器人</strong>对话时，后者会尝试将传入的表情与其<strong class="lb iu">意图之一</strong>进行匹配。当它设法这样做时，它将尝试填充所有<strong class="lb iu">必需的实体</strong>，并且它将所有这些实体(在我们的例子中是产品的特征)发送到我们在<strong class="lb iu">实现</strong>部分中提到的链接。</p><p id="272c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的<strong class="lb iu"> Flask </strong> web 应用程序收到这些特征后，它会验证数据库中是否有所请求的产品，如果有，它会在<strong class="lb iu"> Firebase RT DB </strong>中添加命令。然后，向最终用户发送适当的响应。</p><p id="4501" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以按照上面提到的步骤在 WhatsApp 上使用这个聊天机器人，就像你可以使用 DialogFlow 的<strong class="lb iu">集成</strong>选项将其与 Facebook Messenger、Slack、你自己的网站和许多其他平台集成一样。</p></div></div>    
</body>
</html>