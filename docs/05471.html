<html>
<head>
<title>E-Mail Sentiment Analysis Using Python and Microsoft Azure — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 和 Microsoft Azure 进行电子邮件情感分析—第 1 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/e-mail-sentiment-analysis-using-python-and-microsoft-azure-part-1-6212f4cb6ee3?source=collection_archive---------20-----------------------#2020-05-08">https://towardsdatascience.com/e-mail-sentiment-analysis-using-python-and-microsoft-azure-part-1-6212f4cb6ee3?source=collection_archive---------20-----------------------#2020-05-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="334d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的“已发送邮件”文件夹说明了我们的行为举止？我们能利用这些和其他补充数据来确定工作中快乐或悲伤的趋势吗？</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/e3828235fab66e4c94fdf3ad401f9a16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i7X1eUdbZI7FsxBk"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">塞巴斯蒂安·赫尔曼在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><blockquote class="lf"><p id="4656" class="lg lh it bd li lj lk ll lm ln lo kn dk translated">这是由多个部分组成的文章的第 1 部分。</p></blockquote><h1 id="6521" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated"><strong class="ak">简介</strong></h1><p id="f688" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">坦白地说，在大多数与数据相关的事情上，我认为自己是个“菜鸟”。我在传统数据中心和云基础架构方面有相当丰富的经验，但在处理数据方面还是新手。在过去的 12 个月里，卡格尔几乎是我最好的朋友。</p><p id="2232" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">也就是说，我一直在尽可能多的研究我缺乏的技能——微积分、统计学、编码、数据工程概念等等。我认为最好的学习方法之一就是去做，但也要记录下我所经历的过程。此外，确保保持它的乐趣！</p><p id="4545" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我还加入了一个链接，链接到我写这篇文章时创建的笔记本。随意使用和修改你认为合适的！</p><h1 id="eadb" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma ms mc md me mt mg mh mi mu mk ml mm bi translated"><strong class="ak">概念背景</strong></h1><p id="72d7" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">对于我们这些经常使用电子邮件的人来说，我们都发送过几次，或者多次，或者可能每天都发。</p><ul class=""><li id="c6eb" class="mv mw it js b jt ju jx jy kb mx kf my kj mz kn na nb nc nd bi translated">“根据我的最后一封电子邮件…”</li><li id="8d8b" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated">“展望未来，我建议……”</li><li id="d587" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated">“这完全是胡说八道！”</li></ul><p id="976f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些看起来有点眼熟吗？对许多人来说，很容易通过电子邮件有意或无意地显示你当前的情绪状态。你可能厌倦了多次解释同样的情况，也许你的电子邮件反映了你越来越疲惫，或者也许你的车今天早上坏了，你只是今天过得不好。</p><p id="ccdb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不管原因是什么，我们的电子邮件历史实际上可以提供一个有用的视角，让我们了解我们在一个组织中的态度。</p><p id="807b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文的剩余部分将集中在利用 Jupyter 笔记本、Microsoft Azure 文本分析 API 来提供动力，以及使用 Python 来探索、清理和呈现情感分析结果。</p><p id="bb37" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，我也会模糊或消毒某些数据，只是为了确保在这之后我还有一份工作。:)</p><h1 id="452a" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma ms mc md me mt mg mh mi mu mk ml mm bi translated"><strong class="ak">开发环境</strong></h1><p id="b3e0" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">核心环境将包括以下内容:</p><ul class=""><li id="05e6" class="mv mw it js b jt ju jx jy kb mx kf my kj mz kn na nb nc nd bi translated"><strong class="js iu"> Outlook 已发送邮件 CSV 导出</strong></li><li id="6f05" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><strong class="js iu"> Azure 文本分析 API </strong></li><li id="41c9" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><strong class="js iu"> Azure 笔记本(</strong> Jupyter 笔记本<strong class="js iu"> ) </strong></li></ul><p id="23b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">具体到 Python，我们将使用以下包:</p><ul class=""><li id="1d23" class="mv mw it js b jt ju jx jy kb mx kf my kj mz kn na nb nc nd bi translated"><strong class="js iu"> Numpy </strong></li><li id="458e" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><strong class="js iu">熊猫</strong></li><li id="e58b" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><strong class="js iu"> MatPlotLib </strong></li><li id="d01d" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><strong class="js iu"> Azure AI 文本分析</strong></li></ul><p id="8115" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经了解了将要使用的工具的基础，让我们开始构建吧！</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="2bc3" class="lp lq it bd lr ls nq lu lv lw nr ly lz ma ns mc md me nt mg mh mi nu mk ml mm bi translated">步骤 1 —部署 Azure 文本分析 API 实例</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/ad605586b39371ff16861660cf7e524b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SsheKLpzygQUaYQN"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">弗拉基米尔·阿尼奇耶夫在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="7e1c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们首先需要部署一个 API 实例，这是本文剩余部分的目标。导航到<a class="ae le" href="https://portal.azure.com" rel="noopener ugc nofollow" target="_blank">https://portal.azure.com</a>并登录。如果您没有帐户，您可以通过使用以下方式之一创建订阅来访问免费试用/信用点数:</p><p id="0432" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">天蓝色通行证:</strong><a class="ae le" href="https://www.microsoftazurepass.com/" rel="noopener ugc nofollow" target="_blank">https://www.microsoftazurepass.com/</a></p><p id="e3f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> VS 开发要领:</strong><a class="ae le" href="https://visualstudio.microsoft.com/dev-essentials/" rel="noopener ugc nofollow" target="_blank">https://visualstudio.microsoft.com/dev-essentials/</a></p><p id="27c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">登录后，我们需要搜索文本分析 API。</p><ul class=""><li id="63d1" class="mv mw it js b jt ju jx jy kb mx kf my kj mz kn na nb nc nd bi translated">点击<strong class="js iu">创建资源。</strong></li><li id="c59c" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated">键入<strong class="js iu">文本分析</strong>按回车键。</li><li id="6358" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated">点击<strong class="js iu">创建。</strong></li></ul><div class="kp kq kr ks gt ab cb"><figure class="nw kt nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><img src="../Images/4b9c11eef3c4552566e38ee0c50810f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*9IUoNlCb0nEvDOgDTs1EYw.png"/></div></figure><figure class="nw kt oc ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><img src="../Images/cada0db5f971d7f0d3b3902c7cbf7a1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*3UH1RqnUGSHpLX4eQcfrmA.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk od di oe of translated">创建文本分析 API 实例</p></figure></div><p id="5f51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们需要输入关于服务及其定价层的详细信息。键入一个<strong class="js iu">名称</strong>、<strong class="js iu">订阅</strong>(如果您有多个活动)、<strong class="js iu">位置</strong>(建议选择离您最近的一个)、<strong class="js iu">定价层</strong> (F0 是免费的，对此工作正常)，以及一个供它居住的<strong class="js iu">资源组</strong>。如果没有，点击<strong class="js iu">创建新的</strong>并给它命名。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi og"><img src="../Images/56b5c0e4108db0764f45eafd914a48cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*-FV-g0fKf2J-4zoXT5Legg.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">Azure 文本分析 API 信息</p></figure><p id="283a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">部署完成后，从左侧选择<strong class="js iu">所有资源</strong>并点击您的 API 资源。然后，点击<strong class="js iu">键和端点</strong>并将<strong class="js iu">端点</strong>和<strong class="js iu">键 1 </strong>复制到记事本或其他东西中以备后用。</p><div class="kp kq kr ks gt ab cb"><figure class="nw kt oh ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><img src="../Images/a5c210d747678f287799beeb71f4dc7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*3zc6E6tdSA367c35IVzdMA.png"/></div></figure><figure class="nw kt oi ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><img src="../Images/dad0457d75b9669a22c0140fe8e51f8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*J0itR_UGLWPE8tkRvjuhRw.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk oj di ok of translated">关键点和端点检索</p></figure></div></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="1c8d" class="lp lq it bd lr ls nq lu lv lw nr ly lz ma ns mc md me nt mg mh mi nu mk ml mm bi translated"><strong class="ak">步骤 2— Outlook CSV 导出</strong></h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ol"><img src="../Images/6423d5a136100d320d5c1059f50c21c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L3G4WAQFTXYQEak2"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@mbaumi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米卡·鲍梅斯特</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="c7de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一步是获取您的电子邮件发送项目的 CSV 导出。考虑到我们正在寻找我们自己的<em class="om">个人</em>情感分数，我们将只关心我们发送的物品。</p><ul class=""><li id="4bc8" class="mv mw it js b jt ju jx jy kb mx kf my kj mz kn na nb nc nd bi translated"><strong class="js iu">打开展望</strong></li><li id="fa9b" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><strong class="js iu">文件→打开&amp;导出→导入/导出</strong></li><li id="6250" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><strong class="js iu">导出到文件</strong></li><li id="c695" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><strong class="js iu">逗号分隔值(CSV) </strong></li><li id="83af" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><strong class="js iu">选择您的已发送邮件文件夹</strong></li><li id="f464" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><strong class="js iu">选择一个导出位置</strong></li><li id="39f5" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><strong class="js iu">完成导出</strong></li></ul></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="ca42" class="lp lq it bd lr ls nq lu lv lw nr ly lz ma ns mc md me nt mg mh mi nu mk ml mm bi translated">步骤 3—设置和检查 CSV 数据</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi on"><img src="../Images/8691c05f5ea19ceee2a162e16bf22d39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YDa-ITjhkrQD6McP"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@kirillpershin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kirill Pershin </a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="9839" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经有了 CSV，我们需要开始编写代码来探索和准备用于分析的数据。我强烈建议不要打开。csv 文件，因为我们中的许多人拒绝整理或保持我们的邮箱干净。相反，我们将坚持把它加载到熊猫数据帧中。</p><p id="be1d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要创建一个新的<a class="ae le" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter </a>笔记本来工作。我只是暂时把我的名字简单地叫做<em class="om">email 情操. ipynb </em>。如果你没有安装 Jupyter，也不想使用托管版本，我强烈建议你查看一下 Anaconda 获得一个全面的软件包。</p><p id="db6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们有了笔记本，我们需要安装 Python 的 Azure 文本分析 API 包(如果你还没有的话)。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="e3ab" class="ot lq it op b gy ou ov l ow ox">!pip install azure-ai-textanalytics</span></pre><p id="90ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将假设我们的开发环境已经安装了 Pandas 和 Numpy(Anaconda 和 Azure 笔记本都提供了它们)。</p><p id="3f2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我们可以继续导入必要的包。我们还将把我们的 Azure 文本分析 API 密钥和端点信息(来自步骤 1)分配到这个单元格中。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="7e2f" class="ot lq it op b gy ou ov l ow ox">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>from matplotlib.pyplot import figure<br/>from azure.ai.textanalytics import TextAnalyticsClient<br/>from azure.core.credentials import AzureKeyCredential</span><span id="973a" class="ot lq it op b gy oy ov l ow ox">#Key and enpoint from Azure Text Analytics API service<br/>key = "f7c7c91cd70e493ea38521d1cbf698aa"<br/>endpoint = "<a class="ae le" href="https://mediumapi.cognitiveservices.azure.com/" rel="noopener ugc nofollow" target="_blank">https://mediumapi.cognitiveservices.azure.com/</a>"</span></pre><p id="acf4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还需要定义一些我们稍后将在笔记本中使用的函数。为了便于组织，我只是将两者都添加到一个单元格中，这样它们就在笔记本中的相同位置了。</p><p id="c109" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要一个函数来为文本分析 API 提供认证，以及一个用于核心情感分析的函数。我们遵循微软文档中下面的<a class="ae le" href="https://docs.microsoft.com/en-us/azure/cognitive-services/text-analytics/quickstarts/text-analytics-sdk?tabs=version-3&amp;pivots=programming-language-python" rel="noopener ugc nofollow" target="_blank">快速入门</a>中的代码，但是会对核心函数做一些修改以满足我们的特定需求。</p><p id="549c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然 auth 函数很简单，但我们需要修改情感分析函数来迭代一系列列表(与单个硬编码字符串相比)，只检索总得分(我们将在下一篇文章中探索情感得分范围)，并递增我们稍后创建的频率表。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="c080" class="ot lq it op b gy ou ov l ow ox">#Creating the Azure authentication function<br/>def authenticate_client():<br/>    ta_credential = AzureKeyCredential(key)<br/>    text_analytics_client = TextAnalyticsClient(endpoint=endpoint, credential=ta_credential)<br/>    return text_analytics_client</span><span id="6c39" class="ot lq it op b gy oy ov l ow ox">#Core function for running sentiment analysis<br/>#Modified to fit our specific needs<br/>#Added global variables we'll use later in this notebook<br/>def sentiment_analysis_example(client,list_name): <br/>    global senti_results <br/>    senti_results = {'Positive':0,'Neutral':0,'Negative':0,'Unknown':0}<br/>    global senti_errors<br/>    senti_errors = []<br/>    documents = list_name<br/>    for row in documents:<br/>        response = client.analyze_sentiment(documents = row)[0]<br/>        try:<br/>            if response.sentiment == "positive":<br/>                senti_results['Positive'] += 1<br/>            elif response.sentiment == "neutral":<br/>                senti_results['Neutral'] += 1<br/>            elif response.sentiment == "negative":<br/>                senti_results['Negative'] +=1<br/>            else:<br/>                senti_results['Unknown'] +=1<br/>        except:<br/>            senti_errors.append(row)<br/>    return(senti_results,senti_errors)</span><span id="bf5a" class="ot lq it op b gy oy ov l ow ox">#Assigning authentication function to object<br/>client = authenticate_client()</span></pre><p id="0f8d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们有了 Azure API 函数设置，我们准备开始探索和准备我们的数据集。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="091c" class="ot lq it op b gy ou ov l ow ox">#Assign your filename to a variable<br/>emailFile = ‘BenSent.CSV’</span><span id="3b1f" class="ot lq it op b gy oy ov l ow ox">#Display the first 5 rows of our CSV to inspect<br/>#Notice encoding — this seemed to work for our CSV<br/>email_data = pd.read_csv(emailFile,encoding=’ISO 8859–1')<br/>email_data.head()</span></pre><p id="a374" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您运行上面的代码，您应该会看到类似下面的输出。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oz"><img src="../Images/b3e1e2b72912f2c041903cf1a115ae3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D6MTTSvmXUXjMlcZHYnkrw.png"/></div></div></figure><p id="d569" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Outlook 导出提供了大量的列(有用或无用)，但是您会发现缺少一个关键的数据点—时间戳。</p><p id="69b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不幸的是，Outlook 不提供将日期/时间属性映射到 CSV 导出的功能。为了简单起见，我们将只分析我们的数据集作为一个完整的批处理。我们将看看如何在后续帖子中包含日期。</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="576d" class="lp lq it bd lr ls nq lu lv lw nr ly lz ma ns mc md me nt mg mh mi nu mk ml mm bi translated">步骤 4—清理和准备数据集</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pa"><img src="../Images/7e52aff9c8fa43f3881bc3b6aae72658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W8rkmVkMiqilcOY5"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="b6f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据这种情况下的可用数据，我们将重点关注我们在电子邮件中对他人说了什么，并确定总体上是积极、中立还是消极的情绪。我们需要创建一个单独的对象，只包含来自<strong class="js iu"> Body </strong>列的内容。我们将用熊猫来做这件事。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="59bb" class="ot lq it op b gy ou ov l ow ox">#Assign Body column to new object<br/>email_body = email_data['Body']</span><span id="3a31" class="ot lq it op b gy oy ov l ow ox">#Display top 5 rows and the overall length of the series<br/>print(email_body.head())<br/>print('\n')<br/>print("Starting email count:",email_body.shape)</span></pre><p id="541a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我使用按列标签选择，考虑到我们有这些可用的。您也可以使用列索引，或者您喜欢的任何东西。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pb"><img src="../Images/328ecdea6ec2f157124c6902f6dab43a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RicbMehWkUetNuMuIlkEig.png"/></div></div></figure><p id="adef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们可以看到只有正文内容，这是我们将用来执行情感分析的内容。当我们继续清理这个的时候，我们将密切监视我们的系列的形状。我们目前从 1675 行开始。</p><p id="62bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们会注意到前 5 行中有我们不想分析的奇怪字符，比如<code class="fe pc pd pe op b">\r</code>或<code class="fe pc pd pe op b">\n</code>等等。我们将使用一个简单的<code class="fe pc pd pe op b">str.replace</code>来删除这些。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="40db" class="ot lq it op b gy ou ov l ow ox">#Removing \r and \n characters from strings<br/>email_body = email_body.str.replace("\r","")<br/>email_body = email_body.str.replace("\n","")</span><span id="db2c" class="ot lq it op b gy oy ov l ow ox">#Display top 5 rows and the overall length of the series<br/>print(email_body.head())<br/>print('\n')<br/>print("Current e-mail count:",email_body.shape)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pf"><img src="../Images/4dabc0aa980b9456f5c87ba4151417ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ysGle-ua5kcdxRm3Z3DvdA.png"/></div></div></figure><p id="ee58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们将删除不想分析完整电子邮件线程的转发或尾随电子邮件线程。一个例子是行索引 3，其中我们看到在电子邮件线程中我的回复后面有一个日期。</p><p id="3535" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将使用我知道会自动添加到每个已发送邮件中的东西——我的签名块——来清理这些尾随邮件。以此为目标，我们可以根据识别签名词和尾随消息将数据划分到不同的列中。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="e9de" class="ot lq it op b gy ou ov l ow ox">#Removing trailing email threads after start of my email signature<br/>split_df = email_body.str.partition("Regards")<br/>print(split_df[0:3])<br/>print('\n')<br/>print("Current e-mail count:",split_df.shape)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pg"><img src="../Images/c85d71790b9fefa2806e96412f94bccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sk5Pm6GtFIjCsKzswpumHQ.png"/></div></div></figure><p id="0284" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从形状和输出中，我们现在可以看到我们有 3 个不同的分区列——一个用于电子邮件正文内容，一个用于识别签名块单词(在我的例子中是“问候”),一个用于结尾消息。</p><p id="e509" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们现在需要删除这些额外的列，将注意力放回到正文上。我们还将删除被标识为没有信息的行。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="55ff" class="ot lq it op b gy ou ov l ow ox">#Removing extra fluff from partitioning<br/>clean_col = split_df.drop(columns=[1,2]) #1 contains "Regards", 2 contains trailing text<br/>#Removing rows with NaN - no data<br/>clean_nan = clean_col.dropna()</span><span id="d0a9" class="ot lq it op b gy oy ov l ow ox">print("E-mail count before NaN removal:",clean_col.shape[0]) #Display before NaN removal<br/>print("E-mail count after NaN removal:",clean_nan.shape[0]) #Display before NaN removal</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/7f5d5beedcc4f583df5ce5b4921b5056.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*CKm5M1RzgSdYOS2SUyivmQ.png"/></div></figure><p id="ab54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以看到，在分区之前，我们有<strong class="js iu"> 1，675 </strong>行。我们删除了包含我签名前后的两栏内容。删除了 NaN 的行后，我们只剩下<strong class="js iu"> 1，642 </strong>封电子邮件。我们需要通过删除 PTO 邮件和转发邮件来继续清理。我们还将在正文列中添加一个列名。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="d48d" class="ot lq it op b gy ou ov l ow ox">#Updating the primary column with name EmailBody<br/>clean_nan = clean_nan.rename(columns={0:"EmailBody"})</span><span id="7f98" class="ot lq it op b gy oy ov l ow ox">#Remove emails with default out of office reply<br/>clean_pto = clean_nan[~clean_nan.EmailBody.str.contains("Hello,I am currently")]</span><span id="979c" class="ot lq it op b gy oy ov l ow ox">#Remove emails with a forwarded message<br/>cleaned_df = clean_pto[~clean_pto.EmailBody.str.contains("---------- Forwarded message ---------")]</span><span id="986a" class="ot lq it op b gy oy ov l ow ox">print("E-mail count before removals:",clean_nan.shape[0]) #Pre PTO count<br/>print("E-mail count after removing PTO messages:",clean_pto.shape[0]) #Post PTO count<br/>print("E-mail count after also removing forwarded messages:",cleaned_df.shape[0]) #Post fwd removal</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pi"><img src="../Images/4f1dc666dc0c41396665975123b52469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HQE5bB-3VO02Vs6ZE1im1A.png"/></div></div></figure><p id="81ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查形状后，我们可以看到我们从<strong class="js iu">1642</strong>行到<strong class="js iu">1460</strong>行，最后到<strong class="js iu">1399</strong>行。请记住，我们正在清理所有这些内容，以确保我们的情感分析返回尽可能准确的信息。</p><p id="7108" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们打印<code class="fe pc pd pe op b">cleaned_df</code>系列，我们会看到我们的行看起来是空的。我们需要确保我们删除这些，这样我们的分析就不会出错。我们将通过使用 Pandas 的<code class="fe pc pd pe op b">df.replace</code>来做到这一点，并用 NaN 替换空数据。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="a284" class="ot lq it op b gy ou ov l ow ox">#Considering we know we still have rows with no data, we'll replace the empty space with NaN<br/>#We can see all visible rows with nothing now show NaN<br/>cleaned_df['EmailBody'].replace(" ",np.nan,inplace=True)<br/>print(cleaned_df)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pj"><img src="../Images/9c9f5dd44092492496109aff1b8be21a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ivRLLfC8iinEslCzlvO6mg.png"/></div></div></figure><p id="5317" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们的空行将显示 NaN。我们现在可以使用<code class="fe pc pd pe op b">pd.dropna()</code>删除这些行。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="bcbe" class="ot lq it op b gy ou ov l ow ox">#We can now find all rows with NaN and drop them using pd.dropna<br/>cleaned_df = cleaned_df.dropna()<br/>print(cleaned_df)<br/>print('\n')<br/>print("E-mail count after dropping empty rows/rows with NaN:",cleaned_df.shape)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pk"><img src="../Images/28697069d9b49976ef781cdc1bfd7b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UWwS6Q_Z0bCVdewM9P7Aag.png"/></div></div></figure><p id="c06d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">移除 NaN 后，行数减少到<strong class="js iu"> 1，288 </strong>行。请随意继续探索您的数据，以确保您没有应该删除的额外内容。虽然这并不完美，但我们确实希望结果尽可能合理。</p><p id="ba54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">至于最后一步，我们将把数据帧转换成包含字符串的列表。我们将用它发送给我们的 API 并返回我们的结果。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="57fc" class="ot lq it op b gy ou ov l ow ox">#Create an empty list to store values<br/>#Iterate over each row in the dataframe and append it to the list</span><span id="5d24" class="ot lq it op b gy oy ov l ow ox">senti_list = []</span><span id="85bf" class="ot lq it op b gy oy ov l ow ox">for row in range((cleaned_df.shape[0])):<br/>    senti_list.append(list(cleaned_df.iloc[row,:]))<br/>    <br/>#Length of list matches length of old df <br/>print("E-mail count before error removal, ready for analysis:",len(senti_list))</span></pre><p id="9a5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以打印列表的长度，以确保它与我们的 DataFrame 行数相匹配，事实也确实如此。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pl"><img src="../Images/9d1ba908434e2b816dbbb9de25bc5566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T6ETyFtO8jgHh5GSIe3mkA.png"/></div></div></figure></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="61cd" class="lp lq it bd lr ls nq lu lv lw nr ly lz ma ns mc md me nt mg mh mi nu mk ml mm bi translated">步骤 5—执行情感分析</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pm"><img src="../Images/2674670082c149fe0e36dbbbe3e916b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*biw6eKzTxhXigQuY"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@timmossholder?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">蒂姆·莫斯霍尔德</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ef55" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们有了一个“嗯，我清理了”数据的列表，我们可以开始将数据发送到我们的 Azure API，检索结果，并可视化我们的数据。</p><p id="8451" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将提供新创建的列表作为核心情感分析函数中的 list_name 参数。该函数的编写方式不仅提供了结果的频率表，还提供了包含行本身的列表，这些行在分析时可能包含错误。</p><p id="9def" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一部分可能需要一段时间，这取决于有多少行被发送到 API。您可能还会发现自己不得不扩展自己的 API 服务。如果是这样的话，我建议你为了练习的目的，把你的清单削减一下。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="b346" class="ot lq it op b gy ou ov l ow ox">#Trigger the sentiment analysis function, passing in our list of lists<br/>sentiment = sentiment_analysis_example(client,senti_list)</span></pre><p id="9786" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦完成，我们就可以回顾最初的结果。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="d955" class="ot lq it op b gy ou ov l ow ox">print(senti_results)<br/>print("\n")<br/>print("Sentiment errors:",senti_errors)<br/>print("Error count:",len(senti_errors))</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pn"><img src="../Images/290178adcc3eb32daa41a5a0b3e586e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HlRscaMkbzFC4IiltVPVJA.png"/></div></div></figure><p id="df35" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在这里可以看到两件主要的事情:我们的数据的总体情绪结果和在分析时出错的行。我们可以看到总共有 11 行没有被分析，这似乎是因为不同的空白。</p><p id="d8b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要遍历这个列表，遍历我们的原始数据集列表，并删除包含这些列表的所有列表。我们还将制作一份列表的副本，这样我们就有了历史版本，以备将来需要。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="d6de" class="ot lq it op b gy ou ov l ow ox">#Removing the errors from our list of lists<br/>#Assigning to a new variable so we have the unmodified original<br/>senti_cleaned = senti_list</span><span id="7153" class="ot lq it op b gy oy ov l ow ox">for i in senti_errors:<br/>    for row in senti_cleaned:<br/>        if i == row:<br/>            senti_cleaned.remove(row)<br/>            <br/>print("E-mail count after removing error rows. Final used for analysis:",len(senti_cleaned))</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi po"><img src="../Images/0bf94835f20ae8d2a1f2f173711fc533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H5XabVyrt626nFRhLh17rQ.png"/></div></div></figure><p id="e24c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以看到我们正好下降了 11 行，这与错误计数相匹配。我们现在可以对我们的数据副本重新运行分析，以确保没有其他错误。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="50b1" class="ot lq it op b gy ou ov l ow ox">#Triggering next run of analysis on the final dataset<br/>sentiment = sentiment_analysis_example(client,senti_cleaned)</span><span id="1148" class="ot lq it op b gy oy ov l ow ox">#Displaying the sentiment analysis results<br/>print(senti_results)<br/>print("\n")<br/>print("Sentiment errors:",senti_errors)<br/>print("Error count:",len(senti_errors))</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pp"><img src="../Images/a352948d5ebab9df72a53a55dfcbd1bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UM7hr7kTPfLxNNAQ5aK3qw.png"/></div></div></figure><p id="4dca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">查看输出，我们可以验证我们没有更多的错误(您的里程可能会有所不同)，并准备好继续绘制我们的结果。</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="f213" class="lp lq it bd lr ls nq lu lv lw nr ly lz ma ns mc md me nt mg mh mi nu mk ml mm bi translated">第六步——可视化</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pq"><img src="../Images/5a03f4b6fb4bad26d14317b372d8be75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tzKe3KeDWta5BVDJ"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@goumbik?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卢卡斯·布拉塞克</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="4955" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经有了一个很好的字典，我们可以把它们绘制成很好的图表。对于本文，我们将关注两个视图:结果的总体情感百分比和每种情感类型的电子邮件数量。</p><p id="4f0e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为此，我们将使用<code class="fe pc pd pe op b">matplotlib.pyplot</code>库。我们将创建一个饼图(以显示百分比)和一个条形图(以按结果显示电子邮件数量)。在显示之前，我们还将对图进行一些格式更改，例如:颜色更改、字体更改、填充/间距、显示大小等。</p><pre class="kp kq kr ks gt oo op oq or aw os bi"><span id="f659" class="ot lq it op b gy ou ov l ow ox">#Setting our Key/Value pairs from our results<br/>keys = senti_results.keys()<br/>values = senti_results.values()</span><span id="ca9e" class="ot lq it op b gy oy ov l ow ox">#Establishing some format changes for our charts<br/>figure(num=None, figsize=(8,8),dpi=80)<br/>colors = ['seagreen','lightsteelblue','indianred','silver']<br/>explode = (0.1, 0, 0, 0)<br/>plt.rcParams.update({'font.size': 12})</span><span id="ed10" class="ot lq it op b gy oy ov l ow ox">#Creating the first plot (pie chart)<br/>plt.subplot(221)<br/>plt.pie(values,labels=keys,colors=colors, explode=explode,autopct='%1.1f%%',shadow=True,startangle=90)<br/>plt.title('Overall Sentiment Against 1,277 E-mails, by Percentage',bbox={'facecolor':'1','pad':8},y=1.10)</span><span id="8101" class="ot lq it op b gy oy ov l ow ox">#Creating the second plot (bar chart)<br/>plt.subplot(222)<br/>plt.title('E-mail Count by Sentiment Result',bbox={'facecolor':'1','pad':8},y=1.10)<br/>plt.bar(keys,values,width=.8,color=colors)</span><span id="03ba" class="ot lq it op b gy oy ov l ow ox">#Adjusting the spacing/padding between subplots<br/>plt.subplots_adjust(left=0.125, bottom=0.1, right=1.8, top=1.3, wspace=0.2, hspace=0.2)</span><span id="6160" class="ot lq it op b gy oy ov l ow ox">#Displaying the plots<br/>plt.show()</span></pre><p id="6d35" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们可以看到我们的数据有了一个很好的可视化表示！虽然我们仍然有一堆来自 API 的“未知”响应类型，但我们可以说，总体而言，我们的响应并不像我们想象的那样消极。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pr"><img src="../Images/a6ce0fc823e800b4259a88474dec06cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mtDlDPVtRJsoZDerZelr1Q.png"/></div></div></figure><p id="c91b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在接下来的一些帖子中，我们会对每封邮件进行分类，并对其进行分组。我们还希望引入一些其他数据，与我们目前发现的数据进行对比。</p><p id="a40f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">希望这篇文章是有用的或者有趣的，并且你在这个过程中学到了一些东西。请记住，我对此非常陌生，非常感谢您的反馈！</p></div></div>    
</body>
</html>