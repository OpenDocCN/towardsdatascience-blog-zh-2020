<html>
<head>
<title>A True End-to-End ML Example: Lead Scoring</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">真实的端到端ML示例:销售线索评分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-true-end-to-end-ml-example-lead-scoring-f5b52e9a3c80?source=collection_archive---------4-----------------------#2020-03-09">https://towardsdatascience.com/a-true-end-to-end-ml-example-lead-scoring-f5b52e9a3c80?source=collection_archive---------4-----------------------#2020-03-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="3d40" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="d48c" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">从机器学习的想法到用MLflow、AWS Sagemaker、<a class="ae ko" href="https://booklet.ai/" rel="noopener ugc nofollow" target="_blank"> Booklet.ai </a>实现的解决方案</h2></div><h1 id="c180" class="kp kq iq bd kr ks kt ku kv kw kx ky kz kf la kg lb ki lc kj ld kl le km lf lg bi translated">介绍</h1><p id="034f" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">卖东西可能是一项艰苦的工作。一个企业可能有许多潜在客户，但这些客户中的大多数最终不会变成实际的付费客户。销售团队必须整理一长串潜在客户的名单，并想出如何打发他们的时间。这就是领先得分的由来。这是一个系统，它分析每个新线索的属性与该线索实际成为客户的机会的关系，并使用该分析对所有潜在客户进行评分和排名。有了新的排名，销售团队就可以优先安排他们的时间，只将时间花在极有可能成为付费客户的销售线索上。</p><p id="ab83" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated"><em class="mi">酷，听起来棒极了！我该怎么做？</em></p><p id="0073" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">嗯，很高兴你问了！在本帖中，我们将介绍一个定制的销售线索评分模型的完整端到端实现。这包括提取数据、构建模型、部署模型，最后将这些结果直接推送到最重要的地方——销售团队使用的工具。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mj"><img src="../Images/8251899c75f0ad2c632f058e7a6442d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2QzvSSSHA6Ir_wydOBs1kg.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><a class="ae ko" href="https://app.booklet.ai/model/lead-scoring" rel="noopener ugc nofollow" target="_blank">测试Booklet.ai中的模型</a></p></figure><p id="9189" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated"><strong class="lj ja">如果你想测试出这个模型而不经历整个流程，我们在</strong><a class="ae ko" href="https://booklet.ai/" rel="noopener ugc nofollow" target="_blank"><strong class="lj ja">booklet . ai</strong></a><strong class="lj ja">上有一个</strong> <a class="ae ko" href="https://app.booklet.ai/model/lead-scoring" rel="noopener ugc nofollow" target="_blank"> <strong class="lj ja">全功能的线索评分模型</strong> </a> <strong class="lj ja">。</strong>我们已经将所有代码以<a class="ae ko" href="https://github.com/BookletAI/lead-scoring-demo" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本的形式发布在GitHub </a>上。</p><h1 id="f0a8" class="kp kq iq bd kr ks kt ku kv kw kx ky kz kf la kg lb ki lc kj ld kl le km lf lg bi translated">先决条件</h1><p id="39b2" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">这将是一个技术教程，需要一点编码和数据科学的理解才能通过。为了从中获得最大收益，您至少应该接触一些:</p><ul class=""><li id="4ce8" class="mz na iq lj b lk md ln me lq nb lu nc ly nd mc ne nf ng nh bi translated">Python(我们将一直呆在Jupyter笔记本中)</li><li id="58e4" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">机器学习(我们将使用随机森林模型)</li><li id="401c" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">命令行(是的，它可能很吓人，但我们只是使用一些简单的命令)</li><li id="8675" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">AWS(我们可以牵着你的手度过这一关！)</li></ul><p id="c1d4" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">此外，您应该安装一些东西，以确保您可以快速浏览教程:</p><p id="6d37" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">通过awscli访问的AWS用户名(我们将在下面介绍！)</p><p id="c9e6" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">带有几个包的某种Python 3:</p><ul class=""><li id="b445" class="mz na iq lj b lk md ln me lq nb lu nc ly nd mc ne nf ng nh bi translated">熊猫<code class="fe nn no np nq b">pip install pandas</code></li><li id="7ec8" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">MLflow <code class="fe nn no np nq b">pip install mlflow</code></li><li id="a3bb" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">SKlearn <code class="fe nn no np nq b">pip install scikit-learn</code></li><li id="be55" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">Docker(非常快速和容易地安装<a class="ae ko" href="https://hub.docker.com/editions/community/docker-ce-desktop-mac/" rel="noopener ugc nofollow" target="_blank">这里</a></li></ul><h1 id="70f4" class="kp kq iq bd kr ks kt ku kv kw kx ky kz kf la kg lb ki lc kj ld kl le km lf lg bi translated">在我们开始之前…</h1><p id="39c8" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">我们将在很短的时间内接触到很多工具和想法。在我们开始之前，重要的是后退一步了解这里发生了什么。我们将使用一些工具:</p><ul class=""><li id="e4a4" class="mz na iq lj b lk md ln me lq nb lu nc ly nd mc ne nf ng nh bi translated"><a class="ae ko" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>:数据科学家的必备品。允许您以笔记本的形式运行python脚本，并在线获得结果。</li><li id="232d" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated"><a class="ae ko" href="https://mlflow.org/" rel="noopener ugc nofollow" target="_blank"> MLflow </a>:开源的模型管理系统。</li><li id="8e2e" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated"><a class="ae ko" href="https://aws.amazon.com/sagemaker/" rel="noopener ugc nofollow" target="_blank"> Sagemaker </a>:来自AWS的全栈机器学习平台。</li><li id="0fe9" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated"><a class="ae ko" href="https://booklet.ai/" rel="noopener ugc nofollow" target="_blank"> Booklet.ai </a>:模型测试与集成系统。</li><li id="210e" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated"><a class="ae ko" href="https://www.intercom.com/" rel="noopener ugc nofollow" target="_blank">对讲机</a>:客户服务和销售团队常用的管理客户关系的客户信息平台。</li></ul><p id="2735" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">下图概述了这些不同工具的使用方法:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nr"><img src="../Images/a2fc7c69ee0cadc93d4fb82e0d02f5f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jTEHKooNKLlx5BRv5INiqQ.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated">过程概述，作者的工作。利用来自<a class="ae ko" href="https://thenounproject.com/" rel="noopener ugc nofollow" target="_blank">名词项目</a>的图像</p></figure><p id="8156" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">在最高级别，我们将使用Jupyter笔记本来提取销售线索数据并训练模型。接下来，我们将把模型发送到MLflow来跟踪模型版本。然后，我们将把docker容器和模型发送到AWS Sagemaker来部署模型。最后，我们将使用小册子将模型投入使用，并开始将销售线索分数输入内部通信系统。</p><p id="44ad" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">既然我们已经解决了这个问题，那就让我们开始吧！</p><h1 id="fc5e" class="kp kq iq bd kr ks kt ku kv kw kx ky kz kf la kg lb ki lc kj ld kl le km lf lg bi translated">训练模型</h1><h1 id="f440" class="kp kq iq bd kr ks kt ku kv kw kx ky kz kf la kg lb ki lc kj ld kl le km lf lg bi translated">关于数据</h1><p id="e1e6" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">首先，我们需要访问关于我们的线索的数据。该数据应包含两种类型的信息:</p><p id="e60b" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">(一)响应变量:是否导致转化为付费客户</p><p id="7a3d" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">(B)特征:有助于我们了解响应变量的每个线索的详细信息</p><p id="99ba" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">在本练习中，我们将使用来自Kaggle的示例<a class="ae ko" href="https://www.kaggle.com/ashydv/lead-scoring-logistic-regression/output" rel="noopener ugc nofollow" target="_blank">销售线索数据集</a>。该数据集为一家名为X Education的销售在线课程的公司提供了大量模拟销售线索。我们有各种各样的功能，为每一个线索，以及是否有线索转化为付费客户。感谢<a class="ae ko" href="https://www.kaggle.com/ashydv" rel="noopener ugc nofollow" target="_blank"> Ashish </a>提供这个数据集以及对Kaggle的精彩分析。</p><h1 id="423a" class="kp kq iq bd kr ks kt ku kv kw kx ky kz kf la kg lb ki lc kj ld kl le km lf lg bi translated">导入和清理数据</h1><p id="e2b0" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">要导入这些数据，只需将<code class="fe nn no np nq b">leads_cleaned</code>数据集读入Pandas。如果您从数据库中读取这些数据，请用<code class="fe nn no np nq b">pd.read_sql_query</code>代替。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="e692" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">接下来，我们想挑选出几个对我们很重要的列。为此，我们将创建适合不同类别的列列表:数字、分类和响应变量。这将使加工和清洁处理更容易。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="fdba" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">在这里，我们可以创建将用于培训的培训/测试数据集:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="26e8" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">现在我们有了一个测试数据集，让我们继续为数值变量创建一个缩放器。重要的是只在训练数据集上运行，这样我们就不会“泄露”任何关于测试集的信息。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="bcb3" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">现在，我们需要对模型进行一些调整，为建模做准备。我们已经创建了一个函数来执行一些事情:</p><ul class=""><li id="bbe7" class="mz na iq lj b lk md ln me lq nb lu nc ly nd mc ne nf ng nh bi translated">选择我们定义为重要的列</li><li id="c772" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">使用安装的缩放器来居中和缩放数字列</li><li id="d26f" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">将分类变量转换为一次性编码变量</li><li id="8c34" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">确保训练数据集中的所有列也在输出的、已处理的数据集中(这一点很重要，以便创建所有级别的哑变量，即使我们导入的数据集没有每个单独的级别。)</li></ul><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="67c9" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">下面是我们将它们放在一起并通过预处理函数运行训练和测试数据集时的样子:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nu"><img src="../Images/9bcbc78680f335932c744ba29b30760a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zy1FYy8VR4N0pSzYzr5hTw.png"/></div></div></figure><h1 id="810c" class="kp kq iq bd kr ks kt ku kv kw kx ky kz kf la kg lb ki lc kj ld kl le km lf lg bi translated">训练模型</h1><p id="a507" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">这给我们带来了激动人心的部分！让我们使用我们新清理和分割的数据集来训练一个随机森林模型，该模型预测某人转变为X Education的付费客户的机会。首先，让我们定义几个标准超参数并初始化SKLearn模型:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="63d0" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">从这里，我们可以快速计算测试集中的一些准确性指标，以查看模型的表现。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="95b0" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">在我们坚持的测试集中，我们有82%的准确率和80%的AUC分数！不算太寒酸。肯定有改进的空间，但是为了本教程，让我们继续这个模型。</p><h1 id="509d" class="kp kq iq bd kr ks kt ku kv kw kx ky kz kf la kg lb ki lc kj ld kl le km lf lg bi translated">MLflow:管理模型</h1><h2 id="bb30" class="nv kq iq bd kr nw nx dn kv ny nz dp kz lq oa ob lb lu oc od ld ly oe of lf iw bi translated">什么是MLflow？</h2><p id="10d3" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">在我们开始设置之前，让我们快速地聊一下MLflow。官方说法是，MLflow是“机器学习生命周期的开源平台。”Databricks开发了这个开源项目，以帮助机器学习构建者更轻松地管理和部署机器学习模型。让我们来分解一下:</p><p id="f942" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated"><strong class="lj ja">管理模型:</strong>在构建ML模型时，您可能会经历多次迭代并测试各种模型类型。跟踪关于那些测试的元数据以及模型对象本身是很重要的。如果你在100次尝试中的第二次发现了一个很棒的模型，并想回去使用它，该怎么办？MLflow已经覆盖了你！</p><p id="0691" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated"><strong class="lj ja">部署模型:</strong>为了使模型可访问，您需要部署模型。这意味着将您的模型作为API端点来托管，这样就可以很容易地以标准的方式引用您的模型并对其进行评分。为您部署模型的工具有一长串。MLflow实际上不是这些工具之一。相反，MLflow允许将您的托管模型轻松部署到各种不同的工具。它可以在你的本地机器上，微软Azure，或者AWS Sagemaker。我们将在本教程中使用Sagemaker。</p><h2 id="de03" class="nv kq iq bd kr nw nx dn kv ny nz dp kz lq oa ob lb lu oc od ld ly oe of lf iw bi translated">设置MLflow</h2><p id="99b7" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">MLflow跟踪服务器是一个很好的UI和API，它包含了重要的特性。在我们可以使用MLflow开始管理和部署模型之前，我们将需要设置它。</p><p id="da08" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">确保您安装了MLflow软件包(如果没有，请查看先决条件！).从那里，在您的终端中运行以下命令:</p><pre class="mk ml mm mn gt og nq oh oi aw oj bi"><span id="f72d" class="nv kq iq nq b gy ok ol l om on">mlflow ui</span></pre><p id="455b" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">在这之后，您应该会看到闪亮的新UI在<a class="ae ko" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000/ </a>上运行</p><p id="8199" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">如果您在进行此设置时遇到问题，请查看MLflow跟踪服务器文档<a class="ae ko" href="https://www.mlflow.org/docs/latest/tracking.html#mlflow-tracking-servers" rel="noopener ugc nofollow" target="_blank">此处</a>。此外，如果你不想在自己的机器上安装跟踪服务器，Databricks还提供了一个免费的托管版本<a class="ae ko" href="https://www.mlflow.org/docs/latest/quickstart.html#logging-to-a-remote-tracking-server" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="9cc5" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">一旦您运行了跟踪服务器，让我们将Python指向我们的跟踪服务器并设置一个实验。实验是MLflow跟踪服务器内部的模型集合。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="556f" class="nv kq iq bd kr nw nx dn kv ny nz dp kz lq oa ob lb lu oc od ld ly oe of lf iw bi translated">用处理包装我们的模型</h2><p id="a470" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">如果您正在处理一个没有与您的数据相关联的预处理的模型，那么记录模型是相当简单的。在我们的例子中，我们实际上需要在模型本身的旁边设置这个预处理逻辑。这将允许销售线索按原样发送到我们的模型，模型将处理数据准备。展示这一点的快速视频:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi oo"><img src="../Images/8939b2a627d0871fecd05f2f792fca55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I37XhBI3C9eKk2cx"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated">数据处理流程，作者工作。利用来自<a class="ae ko" href="https://thenounproject.com/" rel="noopener ugc nofollow" target="_blank">名词项目</a>的图像</p></figure><p id="c24a" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">为此，我们将利用MLflow的<code class="fe nn no np nq b">pyfunc</code>模型类型(更多信息<a class="ae ko" href="https://www.mlflow.org/docs/latest/models.html#python-function-python-function" rel="noopener ugc nofollow" target="_blank">这里</a>)，它允许我们将模型和预处理逻辑打包到一个不错的Python类中。我们需要向这个类发送两个不同的输入:对象(即数字列列表或随机森林模型本身)和逻辑(即我们创建的预处理函数)。这两个实体都将在类中使用。</p><p id="5eb3" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">现在，让我们设置类。首先，检查代码，然后我们将讨论不同的部分:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="627b" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">该类基于MLflow的<code class="fe nn no np nq b">pyfunc</code>类领导Model by。这将允许我们将这个模型推入MLflow并最终实现Sagemaker。</p><p id="2cf1" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">接下来，我们在<strong class="lj ja"> __init__ </strong>中设置我们需要的所有对象。这包含了对象和逻辑功能。</p><p id="a4c1" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">最后，我们设置预测函数:</p><ul class=""><li id="39fc" class="mz na iq lj b lk md ln me lq nb lu nc ly nd mc ne nf ng nh bi translated">首先，我们接受model_input(这是在部署后发送给被部署对象的数据帧),并确保所有的列名都是小写的。</li><li id="3b48" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">接下来，我们将这个数据帧发送到我们之前创建并用于模型训练的预处理函数中。这一次，我们将响应列留空，因为我们不需要它们来进行部署！</li><li id="32cc" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">然后，我们引用原始训练数据集的列名，并用0填充任何缺少的列。这一点很重要，因为当我们在部署后将数据集发送到模型时，我们将有一些热编码变量级别没有计算。</li><li id="6d45" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">最后，我们将这个漂亮、干净的数据集发送到我们的随机森林模型进行预测。</li></ul><p id="722f" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">既然我们已经准备好了所有的逻辑和对象放入一个类中，我们可以将这个模型登录到MLflow中了！</p><h2 id="e241" class="nv kq iq bd kr nw nx dn kv ny nz dp kz lq oa ob lb lu oc od ld ly oe of lf iw bi translated">将模型记录到MLflow</h2><p id="f694" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">在我们打包所有东西并记录模型之前，我们需要设置Anaconda环境，当模型在Sagemaker上运行时将会用到这个环境。关于Anaconda的更多信息，<a class="ae ko" rel="noopener" target="_blank" href="/get-your-computer-ready-for-machine-learning-how-what-and-why-you-should-use-anaconda-miniconda-d213444f36d6">这里有一个详细的概述</a>。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="c959" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">现在，我们开始在MLflow中运行。在运行过程中，我们记录我们的超参数、准确性指标，最后是模型本身！</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="899f" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">如果您转到我们之前检查过的MLflow UI，您将看到新创建的模型以及我们刚刚定义的所有指标和参数。呜哇呜！</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi op"><img src="../Images/886e9afcc486772e699ff160e17216e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MeKhmLRDWXaW_fXL"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated">MLflow中的日志模型</p></figure><h1 id="97e4" class="kp kq iq bd kr ks kt ku kv kw kx ky kz kf la kg lb ki lc kj ld kl le km lf lg bi translated">Sagemaker:部署模型</h1><h2 id="aa29" class="nv kq iq bd kr nw nx dn kv ny nz dp kz lq oa ob lb lu oc od ld ly oe of lf iw bi translated">什么是Sagemaker？</h2><p id="88fb" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">Sagemaker是亚马逊网络服务(AWS)创建的一套工具，用于支持机器学习的开发和部署。Sagemaker中有大量可用的工具(太多了，无法在此列出)，我们将专门使用他们的模型部署工具。在他们的GitHub repo <a class="ae ko" href="https://github.com/awslabs/amazon-sagemaker-examples" rel="noopener ugc nofollow" target="_blank">这里</a>有一些伟大的Sagemaker例子。</p><h2 id="9fdb" class="nv kq iq bd kr nw nx dn kv ny nz dp kz lq oa ob lb lu oc od ld ly oe of lf iw bi translated">设置Sagemaker</h2><p id="6046" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">首先，你需要得到许可。AWS权限从来都不简单，但是我们会尽量保持简单！您需要设置两个不同的设置:您自己的用户和Sagemaker的角色。</p><p id="1799" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">第一个是用户帐户，这样您就可以在将模型发送到Sagemaker时访问AWS。为此，您需要转到身份和访问管理(IAM)控制台，并设置一个具有管理员权限的用户帐户。如果您的安全团队进行反击，“Sagemaker完全访问”应该也可以工作！在设置流程的最后，您将获得一个AWS访问密钥ID和一个AWS秘密访问密钥。一定要保存好这些！第一次之后就无法访问了。现在，到你的终端键入<code class="fe nn no np nq b">aws configure</code>。这将提示您输入刚刚收集的AWS密钥。完成设置后，您就可以从终端和Python访问AWS了！<a class="ae ko" href="https://docs.aws.amazon.com/sagemaker/latest/dg/gs-account-user.html" rel="noopener ugc nofollow" target="_blank">这里</a>是来自AWS的更多细节。</p><p id="e3d0" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">第二个是Sagemaker的角色(本质上是AWS内服务的用户帐户)。要设置这一点，请访问IAM的角色部分。您需要将这个角色分配给Sagemaker，然后选择名为“SagemakerFullAccess”的策略。在这个过程的最后，你会得到这个角色的ARN奖！部署时我们需要这个，所以把它放在手边。更多细节来自AWS <a class="ae ko" href="https://docs.aws.amazon.com/sagemaker/latest/dg/access-policy-aws-managed-policies.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="3f6c" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">最后，我们需要将一个MLflow docker容器推入AWS。假设您正确设置了上面的权限并安装了docker(参见docker设置的先决条件一节)，您将希望在您的终端中运行以下命令:</p><pre class="mk ml mm mn gt og nq oh oi aw oj bi"><span id="8c2e" class="nv kq iq nq b gy ok ol l om on">mlflow sagemaker build-and-push-container</span></pre><p id="6023" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">这将把一个docker容器推入AWS，该容器将在部署期间使用。</p><h2 id="a80e" class="nv kq iq bd kr nw nx dn kv ny nz dp kz lq oa ob lb lu oc od ld ly oe of lf iw bi translated">部署到Sagemaker</h2><p id="40b5" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">现在我们已经设置好了一切，是时候将我们的模型推送给Sagemaker了！</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="c861" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">部署功能通常需要5到10分钟才能完成，并且在完成之前会经常使用此功能检查状态。一旦部署完成，您将能够在Sagemaker UI中找到一个正在运行的模型！</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi oq"><img src="../Images/c63b1c0753a8f84f01f63a0ca673a3c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_hJmrgrMJBgOUNIBYOk3RA.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated">Sagemaker中部署的模型</p></figure><h1 id="1824" class="kp kq iq bd kr ks kt ku kv kw kx ky kz kf la kg lb ki lc kj ld kl le km lf lg bi translated">小册子:整合模型</h1><p id="a2ba" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">恭喜，您的模型现在已经部署好了！我们的下一个目标是让这个模型对销售团队有所帮助。为此，我们希望使用部署的模型为新的销售线索创建线索得分，并将这些结果发送给销售团队使用的工具。我们现在需要创建一个系统，定期引入新的销售线索，将每个线索的信息发送到我们部署的模型，然后将这些模型结果发送到Intercom，销售团队的工具。</p><p id="a81d" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">有一些定制的方法来设置它:</p><ul class=""><li id="362e" class="mz na iq lj b lk md ln me lq nb lu nc ly nd mc ne nf ng nh bi translated">我们可以设置一个定制的Python脚本，定期在我们的数据仓库中收集新的Intercom用户数据，使用<a class="ae ko" href="https://github.com/aws/sagemaker-python-sdk" rel="noopener ugc nofollow" target="_blank"> Sagemaker Python SDK </a>将数据发送到我们部署的端点，然后使用它们的<a class="ae ko" href="https://developers.intercom.com/intercom-api-reference/reference" rel="noopener ugc nofollow" target="_blank"> API </a>将结果发送回Intercom。</li><li id="d126" class="mz na iq lj b lk ni ln nj lq nk lu nl ly nm mc ne nf ng nh bi translated">我们可以利用Sagemaker的批量转换功能(很好的例子<a class="ae ko" href="https://github.com/awslabs/amazon-sagemaker-examples/blob/master/sagemaker_batch_transform/introduction_to_batch_transform/batch_transform_pca_dbscan_movie_clusters.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>)来对一批内部通信用户进行评分。所有数据都在S3开始和结束批量转换，因此我们需要将数据拉入S3进行评分，然后将数据从S3推送到Intercom，以提供给销售团队</li></ul><p id="eb54" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated"><strong class="lj ja">我们知道必须有一种更有效的方式将模型结果推入最有用的工具中，所以我们构建了</strong><a class="ae ko" href="https://booklet.ai/" rel="noopener ugc nofollow" target="_blank"><strong class="lj ja">booklet . ai</strong></a><strong class="lj ja">来简化这些步骤。</strong></p><h2 id="6979" class="nv kq iq bd kr nw nx dn kv ny nz dp kz lq oa ob lb lu oc od ld ly oe of lf iw bi translated">什么是小册子？</h2><p id="47dc" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated"><a class="ae ko" href="https://booklet.ai/" rel="noopener ugc nofollow" target="_blank"> Booklet </a>为您的每个机器学习端点添加web测试界面和数据集成，无需更改代码。使用Booklet，您可以快速尝试模型测试用例，以确保结果如预期那样执行，并将这些结果发送给最重要的工具。对于销售线索评分模型，我们可以将结果发送回我们的数据仓库(本例中为Redshift)或销售团队的工具(Intercom)。</p><h2 id="6515" class="nv kq iq bd kr nw nx dn kv ny nz dp kz lq oa ob lb lu oc od ld ly oe of lf iw bi translated">测试模型</h2><p id="bdc0" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">使用Booklet，我们快速设置了一个<a class="ae ko" href="https://app.booklet.ai/model/lead-scoring" rel="noopener ugc nofollow" target="_blank">演示来测试销售线索评分模型</a>。这连接到我们到目前为止在本教程中创建的端点。您可以尝试不同的输入，并查看模型如何对每个理论线索进行分类。要自己开发一个网络应用程序，你可以<a class="ae ko" href="https://app.booklet.ai/signup" rel="noopener ugc nofollow" target="_blank">免费注册小册子</a>，查看<a class="ae ko" href="https://booklet.ai/docs/getting_started/" rel="noopener ugc nofollow" target="_blank">入门文档</a>。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi or"><img src="../Images/153919d998a7d50c80d64c2606c467b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LNB3dpLOMR13kcl_fZ57kA.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><a class="ae ko" href="https://app.booklet.ai/model/lead-scoring" rel="noopener ugc nofollow" target="_blank">测试Booklet.ai中的模型</a></p></figure><h2 id="7adb" class="nv kq iq bd kr nw nx dn kv ny nz dp kz lq oa ob lb lu oc od ld ly oe of lf iw bi translated">连接模型</h2><p id="ff71" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">一旦您对测试的模型输出感到满意，您就可以开始将这些结果发送到输出最有用的系统。我们已经在Redshift中设置了我们的<a class="ae ko" href="https://app.booklet.ai/source/redshifts/2/edit" rel="noopener ugc nofollow" target="_blank">源</a>，它将数据导入模型。我们还设置了一个红移<a class="ae ko" href="https://app.booklet.ai/destinations/2/edit" rel="noopener ugc nofollow" target="_blank">目的地</a>和一个对讲机<a class="ae ko" href="https://app.booklet.ai/destinations/3/edit" rel="noopener ugc nofollow" target="_blank">目的地</a>，结果将被发送到那里。要开始一个示例数据流，它从数据源提取数据，用模型对数据进行评分，并将结果发送到两个目的地，您可以在这里尝试一个数据流<a class="ae ko" href="https://app.booklet.ai/dataflow/configs/2/edit" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi os"><img src="../Images/f3b8510b8f0ad91952f4d25fc6852155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vU3OYn_1nF7N91fTFWTq-A.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><a class="ae ko" href="https://app.booklet.ai/model/lead-scoring" rel="noopener ugc nofollow" target="_blank">在Booklet.ai中运行数据流</a></p></figure><h2 id="ae29" class="nv kq iq bd kr nw nx dn kv ny nz dp kz lq oa ob lb lu oc od ld ly oe of lf iw bi translated">让你的模型更有影响力</h2><p id="4ae5" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">Tada！现在，我们通过将结果直接发送到Intercom，使我们的销售线索评分模型更具影响力。为了让销售团队成员了解这一点，您可以看到每个示例线索现在都有一个自定义属性，列出了他们是否有可能转化:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi ot"><img src="../Images/5a498ca545d47e541c97cf254379446d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NowQTfCyEK6hNf-mEz5u_w.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><a class="ae ko" href="https://www.intercom.com/" rel="noopener ugc nofollow" target="_blank">对讲机</a>平台内的销售线索评分示例</p></figure><p id="3309" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">有了每个潜在销售线索的这些标签，销售团队成员可以开始优先安排他们的时间，并选择他们将首先联系的人。这将有望为您的企业带来更高的效率和更多的销售额！有许多方法可以衡量这些结果的成功，但我们将在另一个时间访问它！</p><h1 id="38d3" class="kp kq iq bd kr ks kt ku kv kw kx ky kz kf la kg lb ki lc kj ld kl le km lf lg bi translated">结束语</h1><p id="55b6" class="pw-post-body-paragraph lh li iq lj b lk ll ka lm ln lo kd lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">如果你已经走了这么远，谢谢你！你已经成功导航了一个完整的端到端机器学习项目。从创意开始到商业影响，以及中间的所有步骤。如果你有任何想法，问题，或遇到问题，请在下面留言。</p><p id="6077" class="pw-post-body-paragraph lh li iq lj b lk md ka lm ln me kd lp lq mf ls lt lu mg lw lx ly mh ma mb mc ij bi translated">非常感谢<a class="ae ko" href="https://www.kaggle.com/ashydv" rel="noopener ugc nofollow" target="_blank"> Ashish </a>提供的数据集，<a class="ae ko" href="https://www.linkedin.com/in/liangbing/" rel="noopener ugc nofollow" target="_blank"> Bing </a>提供的有益评论，以及<a class="ae ko" href="https://towardsdatascience.com/@kylegallatin" rel="noopener" target="_blank"> Kyle </a>提供的<a class="ae ko" rel="noopener" target="_blank" href="/deploying-models-to-production-with-mlflow-and-amazon-sagemaker-d21f67909198">牛逼博客</a>供MLflow和Sagemaker参考。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi ou"><img src="../Images/22fea3c86af72efbd0e45d24804990e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xVIGAovyJ23z5uaC"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated">照片由<a class="ae ko" href="https://unsplash.com/@tsunamiholmes?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克洛伊·莱斯</a>在<a class="ae ko" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div></div>    
</body>
</html>