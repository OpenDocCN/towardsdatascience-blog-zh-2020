<html>
<head>
<title>7 steps to run a linear regression analysis using R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 R 运行线性回归分析的 7 个步骤</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/7-steps-to-run-a-linear-regression-analysis-using-r-d5897a66b835?source=collection_archive---------6-----------------------#2020-07-27">https://towardsdatascience.com/7-steps-to-run-a-linear-regression-analysis-using-r-d5897a66b835?source=collection_archive---------6-----------------------#2020-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3a43" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我学会了如何用蛮力在 R 中做回归分析。通过这 7 个复制和粘贴步骤，你也可以做到。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4dd2b9b273bbc12f67143f1ddf2359f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n17LJpkrRQLSQn6mU4o4ew.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@lanceanderson" rel="noopener ugc nofollow" target="_blank">兰斯·安德森</a>在 Unsplash 上拍摄。</p></figure><p id="dff3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的经理认为我知道如何使用 r 进行回归分析。所以，为了保住我的位置，我决定用整个周末来学习如何做。把这篇文章看作是一个速成班介绍，学习如何用蛮力去做一件事。</p><p id="95c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">跳到你想读的部分。下面的目录:</p><ul class=""><li id="0cf4" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><strong class="ky ir">第一部分</strong> | <strong class="ky ir">我开始写这篇文章的知识范围</strong></li><li id="5251" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">第二部分</strong> | <strong class="ky ir">我如何搜索我的资源</strong></li><li id="80fd" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">第三部分 | <strong class="ky ir">回归提示:向工程师学习</strong></li><li id="96b8" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">第四部分</strong> | <strong class="ky ir"> 7 复制&amp;粘贴步骤使用 R </strong>运行线性回归分析</li><li id="fbaf" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">第五部分|下一步:改进你的模型</strong></li></ul><h1 id="efe0" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">开始写这篇文章时，我的知识范围</h1><p id="b51a" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">首先，为了建立基础，让我告诉你我对回归了解多少，以及我能在 r 中做些什么。</p><h2 id="eae9" class="ne mh iq bd mi nf ng dn mm nh ni dp mq lf nj nk ms lj nl nm mu ln nn no mw np bi translated">我对周末线性回归的了解是:</h2><ul class=""><li id="2bd1" class="ls lt iq ky b kz my lc mz lf nq lj nr ln ns lr lx ly lz ma bi translated">该方程的格式为:y=ax+b，其中 y 为因变量，x 为自变量，a 为系数，b 为常数/y 截距。我知道这些术语的意思。</li><li id="89da" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">这是一种计算自变量 x 对因变量 y 的影响的方法。为了做到这一点，您需要使用现有的数据，并根据该方程测试所有情况，以找到最合适的 a 和 b，从而预测您没有数据的 y 值。</li><li id="79c1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">您可以添加任意数量的独立变量，并为每个变量附加一个系数，以查看每个变量对因变量的影响。也就是说，太多的变量不会改善模型，在某些情况下还会损害模型。</li><li id="6122" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">最好将数据标准化，以便使用 0 到 1 之间的值。这样，由于独立变量的性质，系数不会很小或很大(例如，4634 天和 13 年是可以在同一个模型中使用的两个变量，但因为它们的大小如此不同，系数可能会有偏差)。</li></ul><h2 id="03a8" class="ne mh iq bd mi nf ng dn mm nh ni dp mq lf nj nk ms lj nl nm mu ln nn no mw np bi translated">周末我能做的是:</h2><ul class=""><li id="2ee9" class="ls lt iq ky b kz my lc mz lf nq lj nr ln ns lr lx ly lz ma bi translated">dplyr 中的基础数据角力(<code class="fe nt nu nv nw b">mutate</code>、<code class="fe nt nu nv nw b">filter</code>、<code class="fe nt nu nv nw b">select</code>、管道运算符<code class="fe nt nu nv nw b">%&gt;%</code>、<code class="fe nt nu nv nw b">summarize</code>、点占位符、<code class="fe nt nu nv nw b">group_by</code>、<code class="fe nt nu nv nw b">arrange</code>、<code class="fe nt nu nv nw b">top_n</code>)</li><li id="87c5" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">dplyr 中的图(<code class="fe nt nu nv nw b">plot</code>、<code class="fe nt nu nv nw b">hist</code>、<code class="fe nt nu nv nw b">boxplot</code>)</li><li id="dfd3" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">ggplot2 中的图(几何图、<code class="fe nt nu nv nw b">facet_grid</code>、时间序列图、轴变换、<code class="fe nt nu nv nw b">stratify</code>、<code class="fe nt nu nv nw b">boxplot</code>、斜率图)</li><li id="29d6" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">到目前为止，我所知道的关于 R 的一切都是从我参加的两门在线课程中学到的(1。<a class="ae kv" href="https://www.edx.org/course/data-science-r-basics" rel="noopener ugc nofollow" target="_blank"> R 基础知识</a>，2。<a class="ae kv" href="https://www.edx.org/course/data-science-visualization" rel="noopener ugc nofollow" target="_blank">可视化</a>。</li></ul><h1 id="8fad" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">第二部分|我如何搜索我的资源</h1><p id="8a05" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">我是如何想出这个周末该关注什么的。</p><h2 id="3764" class="ne mh iq bd mi nf ng dn mm nh ni dp mq lf nj nk ms lj nl nm mu ln nn no mw np bi translated">1.在学习 R 基础知识时，r-bloggers 对我来说是一个很好的资源，所以我决定从那里开始。我谷歌了一下“r-bloggers 回归”</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/3fdd0fa7b2e0a8b8f24a39b79d992399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*4OAGH2PTITZPCD_zrSj5vA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">谷歌搜索“r-bloggers 回归”结果</p></figure><p id="c04f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我想到的前四个链接:</p><ol class=""><li id="5a65" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated"><a class="ae kv" href="https://www.r-bloggers.com/how-to-apply-linear-regression-in-r/" rel="noopener ugc nofollow" target="_blank">https://www . r-bloggers . com/how-to-apply-linear-regression-in-r/</a></li><li id="9b54" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nz ly lz ma bi translated"><a class="ae kv" href="https://www.r-bloggers.com/linear-regression-using-r/" rel="noopener ugc nofollow" target="_blank">https://www.r-bloggers.com/linear-regression-using-r/</a></li><li id="c08d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nz ly lz ma bi translated"><a class="ae kv" href="https://www.r-bloggers.com/regression-analysis-using-r/" rel="noopener ugc nofollow" target="_blank">https://www.r-bloggers.com/regression-analysis-using-r/</a></li><li id="02d8" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nz ly lz ma bi translated"><a class="ae kv" href="https://www.r-bloggers.com/linear-regression-from-scratch-in-r/" rel="noopener ugc nofollow" target="_blank">https://www . r-bloggers . com/linear-regression-from scratch-in-r/</a></li></ol><h2 id="ced1" class="ne mh iq bd mi nf ng dn mm nh ni dp mq lf nj nk ms lj nl nm mu ln nn no mw np bi translated">2.我浏览了每一个结果，并决定把重点放在第二个结果上，因为我在页面的底部看到它提到它将告诉我如何解决“现实世界的商业问题”</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/fe430af5f59a9a97a26639518034ecd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*In3XgXDSMHX0rTpiGNWjyw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我选择引用的<a class="ae kv" href="https://www.r-bloggers.com/linear-regression-using-r/" rel="noopener ugc nofollow" target="_blank">博客</a>中的一段话。</p></figure><p id="667f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我点击了链接“<a class="ae kv" href="https://www.tatvic.com/blog/predict-bounce-rate-based-on-page-load-time-in-google-analytics/" rel="noopener ugc nofollow" target="_blank">下一篇博客</a>”，结果！"预测跳出率的基础上，在谷歌分析页面加载时间."因为我还没有提到，在这里要注意:我是在性能广告领域，所以这确实是我的拿手好戏。他们甚至做了一个<a class="ae kv" href="https://www.tatvic.com/blog/improving-bounce-rate-prediction-model-for-google-analytics-data/" rel="noopener ugc nofollow" target="_blank"> part 3 </a>上的改进模型！</p><p id="8700" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我已经找到了这个周末我要关注的事情。我要在这里汇编我学到的任何东西！</p><h1 id="c730" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">第三部分|回归技巧:向工程师学习</h1><p id="3e06" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">我和一位工程师进行了一次非常有益的谈话，这位工程师在周末解答了我的问题，我想和你分享一些他分享的技巧。总之，运行回归分析只是评估某些数据是否与其他数据有关系的调查的开始。在这种背景下，这里有一些方法可以确保你得出一个诚实的分析，并帮助你找出下一步。</p><ul class=""><li id="ea34" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><strong class="ky ir">将数据标准化，以便尽可能公平地比较系数。</strong>虽然没有固定的方法来比较自变量之间的系数，但标准化数据至少可以让你看到自变量对因变量的影响。这是一个很好的研究起点:一旦你发现一个系数比另一个系数大，你就可以开始研究是什么导致了任何“高”系数。如果不对数据进行标准化，则每个值的范围可能会很大，从而导致系数的范围也很大，以补偿较大值的权重。</li><li id="8c41" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir"> p 值显著性是确定性的指标。</strong>即使一个系数很高，如果没有统计意义，往好了说是没有意义，往坏了说是毁了模型。(参见<a class="ae kv" href="http://svmiller.com/blog/2014/08/reading-a-regression-table-a-guide-for-students/" rel="noopener ugc nofollow" target="_blank">这篇博文</a>中的“星号”部分，了解如何解读 p 值。)</li><li id="3112" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">运行回归时移除异常值，然后在创建模型后，使用每个异常值测试模型，以比较因变量的预测值和真实值。这可以让你看到你的模型有多健壮。如果离群值的误差很低，那么这个模型就大获全胜；如果误差仍然很高，那么您可以简单地继续断言它们是异常值这一事实。</strong></li><li id="0b16" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">除了查看总体误差，查看每个数据点的误差也很重要。通过这样做，你可以深入了解为什么某个点或一组点可能比其他点有更大的误差的任何原因或趋势。</strong></li><li id="d736" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">废话进，废话出。没有好的数据，你就不会有好的结果。确保你知道你的数据来自哪里，并确保它是高质量的。</strong></li></ul><h1 id="45cb" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">第四部分| 7 使用 R 运行线性回归分析的复制和粘贴步骤</h1><p id="5eb5" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">所以我们在这里。是时候使用 r 实际运行回归分析了。</p><p id="7b40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一般提示和说明:</p><ul class=""><li id="dc3a" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">对于引入代码的每一步，我都添加了一个例子的截屏，然后添加了一个相同的代码块，您可以将其复制并粘贴到您自己的 R 脚本中。</li><li id="2659" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">代码块适用于有 1 个独立变量的情况。如果有一个以上的自变量，请遵循 R 注释中的说明。</li><li id="ef22" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">在每个代码块中，我都用斜体包含了括号，您可以用自己的代码替换它们，比如:<code class="fe nt nu nv nw b"><em class="nd">[[insert your code]]</em></code>。</li><li id="5a59" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">当你用你自己的代码替换时，确保你删除了<em class="nd">和</em>括号和文本。这样做时，不要添加任何空格。</li><li id="7a02" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">使用我的截图作为指导，特别是如果你有一个以上的自变量。您可以在每个步骤中执行，或者在复制并粘贴所有内容后一次性执行。</li></ul><p id="3139" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始了。</p><ol class=""><li id="c5f7" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nz ly lz ma bi translated"><strong class="ky ir">获取一个包含所有要测试的变量的数据集。</strong>选择要建模的因变量和自变量。所有好的回归都是从一个问题开始的。为了弄清楚你想要什么样的变量，问自己一个现实生活中的问题，以确定你需要什么。你想测试的关系是什么？</li><li id="a07a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nz ly lz ma bi translated"><strong class="ky ir">清理您的数据，并将其保存为 csv 文件</strong> —删除所有不需要的变量列。在我的例子中，我想看看转换是否依赖于花费、影响、点击、usv 和 pv，所以我将保留这六个并删除其他所有内容。此外，请确保删除所有包含总计的行。清理后，保存为 csv 文件。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/1bde577a4d19137aaaba1bcdb9b06744.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*2SbMyFRrcQRT41BH2DqBNg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我回归分析要用到的数据。</p></figure><p id="c6b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 3。用函数</strong> <code class="fe nt nu nv nw b"><strong class="ky ir">read.csv()</strong></code>将 csv 文件导入 R Studio。(参见此<a class="ae kv" href="https://osxdaily.com/2015/11/05/copy-file-path-name-text-mac-os-x-finder/#:~:text=Right%2Dclick%20(or%20Control%2B,replaces%20the%20standard%20Copy%20option" rel="noopener ugc nofollow" target="_blank">链接</a>了解如何在 mac 上获取路径名。)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/c39795d6149a9c08c303b6d1fd790de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*An4EeNdS-sIvYOQak5QNfg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将 csv 文件导入 RStudio。</p></figure><pre class="kg kh ki kj gt od nw oe of aw og bi"><span id="e2f6" class="ne mh iq nw b gy oh oi l oj ok">#import data from csv file<br/>data &lt;- read.csv('<em class="nd">[[insert your pathname]]</em>')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/437cd966a5a91dcfe003e684e81dba6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*lJalb7_iN7zmhJVkLhOuAA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从 3055 行数据开始。</p></figure><p id="19ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 4。使用 tidyverse 中的</strong> <code class="fe nt nu nv nw b"><strong class="ky ir">drop_na() </strong></code> <strong class="ky ir">删除因变量的所有 NA 值。</strong>参见<a class="ae kv" href="https://stackoverflow.com/questions/48658832/how-to-remove-row-if-it-has-a-na-value-in-one-certain-column/56183858#:~:text=na.,NA%20is%20in%20column%20B." rel="noopener ugc nofollow" target="_blank">此处的</a>了解描述该功能的参考。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/e5792673aeabfe6bd18df2dc0285c4d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*cTU2nAsuc39OwEl-OclN8A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">删除所有因变量“Conversions”为“NA”的行</p></figure><pre class="kg kh ki kj gt od nw oe of aw og bi"><span id="69fd" class="ne mh iq nw b gy oh oi l oj ok">#install tidyverse if you don't have it already<br/>install.packages("tidyverse")</span><span id="051c" class="ne mh iq nw b gy on oi l oj ok">#launch tidyverse<br/>library(tidyverse)</span><span id="0882" class="ne mh iq nw b gy on oi l oj ok">#remove na values of independent variable<br/>data &lt;- data %&gt;% drop_na(<em class="nd">[[insert column name of your independent variable]]</em>)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/b222424dadade2a603036c2004964ece.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*-7RKWrIvwYxveShFu8fYiA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">删除了因变量的 NA 值(转换)。行数减少到 142。你已经知道这不是最强的数据集。</p></figure><p id="d068" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 5。标准化你的自变量。我在 R 中通过将每个独立变量除以它们各自的最大值来做这个。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/92d2079c3e60e9595894190e9941dd43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/0*idbc8fREFVPA2eWV"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用 mutate 为每个独立变量追加规范化列。</p></figure><pre class="kg kh ki kj gt od nw oe of aw og bi"><span id="7127" class="ne mh iq nw b gy oh oi l oj ok">#normalize data (add additional %&gt;% for any number of independent variables you have)<br/>norm_data &lt;- data %&gt;% <br/>mutate(<em class="nd">[[insert a simple name of independent variable]]</em>_norm = <em class="nd">[[insert column name of independent variable]]</em>/max(<em class="nd">[[insert column name of independent variable]]</em>,na.rm=TRUE))</span></pre><p id="8a60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了分解我在上面所做的事情，让我们看看我对列 Spend 做了什么:<code class="fe nt nu nv nw b">mutate(spend_norm = Spend/max(Spend,na.rm=TRUE))</code></p><ul class=""><li id="5c7b" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><code class="fe nt nu nv nw b">mutate()</code>:用于向现有数据集追加新列的函数</li><li id="a2f3" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe nt nu nv nw b">spend_norm</code>=我的新专栏的名字</li><li id="b975" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe nt nu nv nw b">Spend/max(Spend)</code>:归一化公式</li><li id="e47a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe nt nu nv nw b">na.rm=TRUE</code>:用于删除空值的参数</li></ul><p id="426f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我用新名称改变了每一列，从而创建了 5 个额外的列，所以我使用了函数<code class="fe nt nu nv nw b">select()</code> <strong class="ky ir"> </strong>以便只保留相关的列。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/3e65c4e243360894eb12aca7ff80b5b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9FcvEzavlzRCZEnsmKFltg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">只选择我需要的数据。</p></figure><pre class="kg kh ki kj gt od nw oe of aw og bi"><span id="e324" class="ne mh iq nw b gy oh oi l oj ok">#select relevant columns (add additional commas and variable names for any number of independent variables)<br/>select_data &lt;- norm_data %&gt;% select(<em class="nd">[[insert column name of dependent variable]]</em>,<br/><em class="nd">[[insert new normalized column name of independent variable]]</em>)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi or"><img src="../Images/6292d33bce834ae4da8f587fa38f8c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*jmW00-Aun15t5ATIBewhNg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将数据标准化。行数保持不变，仍然是 141，因为我只是将原始列换成了它们的规范化版本。</p></figure><p id="56a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 6。查找并删除异常值。</strong></p><p id="e2ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于我的数据集，我使用的方法是不考虑第一个四分位数以下四分位数间距(IQR)的 1.5 倍或第三个四分位数以上 IQR 的 1.5 倍。见<a class="ae kv" href="https://www.r-bloggers.com/how-to-remove-outliers-in-r/" rel="noopener ugc nofollow" target="_blank">这里</a>我用来确定这个的参考和我复制的函数。这里有两个小步骤:</p><ul class=""><li id="22bc" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">1.找出异常值。从原始数据集中为每个独立变量确定 IQR 和上/下范围<strong class="ky ir">。</strong></li><li id="c86b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">2.移除异常值。从移除先前独立变量的异常值后获得的更新数据集中，仅选择落在步骤 1 <strong class="ky ir">中找到的上限和下限之间的数据。</strong></li></ul><p id="1463" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我对每个独立变量重复这两步，最终得到子集<code class="fe nt nu nv nw b">removed5</code>。请参见下面 RStudio 中的我的代码。(你会发现我没有以最有效的方式做到这一点。希望有任何建议能让这更有效率。)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/cba1633b9d5bdacfa62381e6f9dc08ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QTZG7Esn4CGWxFWD"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">去除每个自变量的异常值的两个步骤。前两个独立变量的屏幕截图。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/54e4c62b182f8818c1c44f9db8c5c036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HJODTXnwPfVM18-q"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">去除每个自变量的异常值的两个步骤。第三、第四和第五个独立变量的屏幕截图。</p></figure><pre class="kg kh ki kj gt od nw oe of aw og bi"><span id="257f" class="ne mh iq nw b gy oh oi l oj ok">#removing outliers<br/>#1. run this code to determine iqr and upper/lower ranges for independent variable<br/>x &lt;-select_data$<em class="nd">[[insert new normalized column name of independent variable]]</em><br/>Q &lt;- quantile(x,probs=c(.25,.75),na.rm=TRUE)<br/>iqr &lt;- IQR(x,na.rm=TRUE)<br/>up &lt;-  Q[2]+1.5*iqr # Upper Range<br/>low&lt;- Q[1]-1.5*iqr # Lower Range</span><span id="095d" class="ne mh iq nw b gy on oi l oj ok">#2. run this code to select only the data that's between the upper and lower ranges<br/>removed1 &lt;- subset(select_data, <br/>select_data$<em class="nd">[[insert new normalized column name of independent variable]]</em> &gt; <br/>(Q[1] - 1.5*iqr) &amp; select_data$<em class="nd">[[insert new normalized column name of independent variable]]</em> &lt; <br/>(Q[2]+1.5*iqr))</span><span id="3806" class="ne mh iq nw b gy on oi l oj ok">#if you're curious, see the new boxplot<br/>ggplot(removed1,aes(<em class="nd">[[insert new normalized column name of independent variable]]</em>)) + geom_boxplot()</span><span id="1ddb" class="ne mh iq nw b gy on oi l oj ok">#this is the new dataset you'll be working with<br/>View(removed<em class="nd">[[insert # of total independent variables you normalized data for]]</em>)</span><span id="4511" class="ne mh iq nw b gy on oi l oj ok">########if you have two or more independent variables, copy and paste the code below as many times as you need:</span><span id="88c8" class="ne mh iq nw b gy on oi l oj ok">#2nd independent variable ranges - repeating #1 and #2 above<br/>#1. run this code to determine iqr and upper/lower ranges for independent variable<br/>x &lt;-select_data$<em class="nd">[[insert new normalized column name of independent variable]]</em><br/>Q &lt;- quantile(x,probs=c(.25,.75),na.rm=TRUE)<br/>iqr &lt;- IQR(x,na.rm=TRUE)<br/>up &lt;-  Q[2]+1.5*iqr # Upper Range<br/>low&lt;- Q[1]-1.5*iqr # Lower Range</span><span id="a53e" class="ne mh iq nw b gy on oi l oj ok">#2. run this code to select only the data that's between the upper and lower ranges<br/>removed<em class="nd">[[insert # for what number independent variable you are on]]</em> &lt;- subset(select_data, select_data$<em class="nd">[[insert new normalized column name of independent variable]]</em> &gt; (Q[1] - 1.5*iqr) &amp; select_data$<em class="nd">[[insert new normalized column name of independent variable]]</em> &lt; (Q[2]+1.5*iqr))</span><span id="1cc3" class="ne mh iq nw b gy on oi l oj ok">#if you're curious, see the new boxplot<br/>ggplot(removed<em class="nd">[[insert # for what number independent variable you are on]]</em>,aes(<em class="nd">[[insert new normalized column name of independent variable]]</em>)) + geom_boxplot()</span><span id="ca5f" class="ne mh iq nw b gy on oi l oj ok">#this is the new dataset you'll be working with<br/>View(removed<em class="nd">[[insert # of total independent variables you normalized data for]]</em>)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/32feae4af3921a846b53c2a743c25668.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*jYn5Qx_1wSntpEJE4yT-7g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">移除所有独立变量的异常值，行数减少到 14。在这一点上，我不确定这些数据是否真的会对我有所帮助，因为这些行的数量很少，但是无论如何，我将尝试对它们进行回归。</p></figure><p id="659f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 7。</strong>回归时间！<strong class="ky ir">对数据使用 R 函数</strong> <code class="fe nt nu nv nw b"><strong class="ky ir">lm()</strong></code> <strong class="ky ir">。</strong>回到我正在学习的<a class="ae kv" href="https://www.tatvic.com/blog/predict-bounce-rate-based-on-page-load-time-in-google-analytics/" rel="noopener ugc nofollow" target="_blank">原始帖子</a>来了解你在这里做什么的解释。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/3b41cf5e8a15fdb612577d25e7432c0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*QfntTfGwXD815t0J2d36Fg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">此数据集的回归模型。</p></figure><pre class="kg kh ki kj gt od nw oe of aw og bi"><span id="34a8" class="ne mh iq nw b gy oh oi l oj ok">#add additional variables as needed with + sign<br/>Model1 &lt;- lm(removed<em class="nd">[[insert # of total independent variables you normalized data for]]</em>$<em class="nd">[[insert column name of dependent variable]]</em> ~<br/>removed<em class="nd">[[insert # of total independent variables you normalized data for]]</em>$<em class="nd">[[insert new normalized column name of independent variable]]</em>)</span></pre><p id="1175" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您已经创建了您的模型！现在，为了汇总结果，运行回归的最后一段代码:</p><pre class="kg kh ki kj gt od nw oe of aw og bi"><span id="d7a4" class="ne mh iq nw b gy oh oi l oj ok">summary(Model1)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/c700d06bcef05dfc36dd184e4fdb76c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*2s_AOxoCEbbwHxth_TyhGA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">总结(模型 1):回归的结果显示了“转化率”和自变量之间的关系。</p></figure><p id="f12a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我上面提到的工程师看了这些结果，马上说:“是啊，你的数据很烂。”他说每个变量的 T1 与其 T2 相比都太大了。他还提到，对于只有 15 行数据的模型，使用 5 个变量是没有意义的。</p><p id="c167" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是没关系…我们做到了！万岁！</p><h2 id="e78c" class="ne mh iq bd mi nf ng dn mm nh ni dp mq lf nj nk ms lj nl nm mu ln nn no mw np bi translated">第五部分|后续步骤:改进您的模型</h2><p id="aad3" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">所以我们已经进行了回归分析！…但这并不是结束。俗话说“所有的模型都是错的，但有些是有用的。”因此，你的下一步是找出如何改进你的模型，以确保你拉的东西实际上是有用的。从本周末我所学习的系列文章的第三篇<a class="ae kv" href="https://www.tatvic.com/blog/improving-bounce-rate-prediction-model-for-google-analytics-data/" rel="noopener ugc nofollow" target="_blank">文章</a>中，以及一篇<a class="ae kv" href="http://www.sthda.com/english/articles/37-model-selection-essentials-in-r/155-best-subsets-regression-essentials-in-r/#computing-best-subsets-regression" rel="noopener ugc nofollow" target="_blank">更详细的文章</a>的支持下，我发现函数<code class="fe nt nu nv nw b">regsubsets()</code> <strong class="ky ir"> </strong>的组合以及经过调整的 R2、Cp 和 BIC 指标允许我们计算出你的数据集中有多少变量实际上对正在讨论的模型有用。这有助于任何有两个以上自变量的模型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/4403b61451001b4a264952a7206cfd2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/0*Waz7tDZelCejd9ba"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用<code class="fe nt nu nv nw b"><strong class="bd oy">regsubsets</strong></code>函数来看看我的变量是否有用。</p></figure><pre class="kg kh ki kj gt od nw oe of aw og bi"><span id="626a" class="ne mh iq nw b gy oh oi l oj ok">install.packages("leaps")<br/>library(leaps)</span><span id="37c9" class="ne mh iq nw b gy on oi l oj ok">#add any number of independent variables that you need to the equation (note: this will not work if you only have 1 independent variable)<br/>leaps &lt;- regsubsets(removed<em class="nd">[[insert # of total independent variables you normalized data for]]</em>$<em class="nd">[[insert column name of dependent variable]]</em> ~ <br/>removed<em class="nd">[[insert # of total independent variables you normalized data for]]</em>$<em class="nd">[[insert new normalized column name of independent variable]]</em>,<br/>data=removed<em class="nd">[[insert # of total independent variables you normalized data for]]</em>,<br/>nvmax=<em class="nd">[[insert # of total independent variables you normalized data for]]</em>)</span><span id="adf1" class="ne mh iq nw b gy on oi l oj ok">summary(leaps)</span><span id="1d03" class="ne mh iq nw b gy on oi l oj ok">res.sum &lt;- summary(leaps)<br/>data.frame(<br/>  Adj.R2 = which.max(res.sum$adjr2),<br/>  CP = which.min(res.sum$cp),<br/>  BIC = which.min(res.sum$bic)<br/>)</span></pre><p id="a345" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了用我上面链接的帖子的话来解释我在上面做的事情，这里有一个帖子的摘录:</p><blockquote class="oz pa pb"><p id="fc45" class="kw kx nd ky b kz la jr lb lc ld ju le pc lg lh li pd lk ll lm pe lo lp lq lr ij bi translated">R 函数<code class="fe nt nu nv nw b">regsubsets()</code> [ <code class="fe nt nu nv nw b">leaps</code> package]可以用来识别不同尺寸的不同最佳模型。您需要指定选项<code class="fe nt nu nv nw b">nvmax</code>，它代表了要合并到模型中的预测值的最大数量。例如，如果<code class="fe nt nu nv nw b">nvmax = 5</code>，该函数将返回最佳 5 变量模型，即返回最佳 1 变量模型、最佳 2 变量模型、…、最佳 5 变量模型。</p><p id="f83d" class="kw kx nd ky b kz la jr lb lc ld ju le pc lg lh li pd lk ll lm pe lo lp lq lr ij bi translated">在我们的例子中，数据中只有 5 个预测变量。所以，我们就用<code class="fe nt nu nv nw b">nvmax = 5</code>。<em class="iq"> ( </em> <a class="ae kv" href="http://www.sthda.com/english/articles/37-model-selection-essentials-in-r/155-best-subsets-regression-essentials-in-r/#computing-best-subsets-regression" rel="noopener ugc nofollow" target="_blank"> <em class="iq">)来源</em> </a> <em class="iq"> ) </em></p></blockquote><p id="dc58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于上面代码的后半部分:</p><blockquote class="oz pa pb"><p id="edb9" class="kw kx nd ky b kz la jr lb lc ld ju le pc lg lh li pd lk ll lm pe lo lp lq lr ij bi translated"><code class="fe nt nu nv nw b">summary()</code>函数返回一些指标-调整后的 R2、cp 和 BIC(参见第[…]章)-允许我们确定最佳总体模型，其中最佳被定义为最大化调整后的 R2 和最小化预测误差(RSS、Cp 和 BIC)的模型。</p><p id="e750" class="kw kx nd ky b kz la jr lb lc ld ju le pc lg lh li pd lk ll lm pe lo lp lq lr ij bi translated">调整后的 R2 代表结果中由预测值的变化所解释的变化的比例。调整后的 R2 越高，模型越好。<em class="iq"> ( </em> <a class="ae kv" href="http://www.sthda.com/english/articles/37-model-selection-essentials-in-r/155-best-subsets-regression-essentials-in-r/#computing-best-subsets-regression" rel="noopener ugc nofollow" target="_blank"> <em class="iq">来源</em> </a> <em class="iq"> ) </em></p></blockquote><p id="88d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据他们提到的每个度量标准，最好的模型在下面的代码块中，并产生下面的结果。</p><pre class="kg kh ki kj gt od nw oe of aw og bi"><span id="b43e" class="ne mh iq nw b gy oh oi l oj ok">res.sum &lt;- summary(leaps)<br/>data.frame(<br/>  Adj.R2 = which.max(res.sum$adjr2),<br/>  CP = which.min(res.sum$cp),<br/>  BIC = which.min(res.sum$bic)<br/>)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/4da3b44453417f362af90482e90ef858.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*l6q01qRauAi_DiOQNdvk6Q.png"/></div></figure><p id="e2d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于这些结果，调整后的 R2 告诉我们，最好的模型是有一个预测变量的模型，Cp 和 BIC 标准也是如此。它说我应该把模型中的变量数量从五个减少到一个。这并不奇怪，因为我一开始只有 15 行数据。</p><p id="4e93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就这样，我结束了我周末用 r 学习线性回归的大丰收。如果你和我一样，强行通过做来学习是了解一个主题的完美开端。我希望你和我一样从中获益匪浅。前进！</p></div></div>    
</body>
</html>