<html>
<head>
<title>Time Series Analysis with Prophet: Air Passenger Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Prophet 进行时间序列分析:航空乘客数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-analysis-with-prophet-air-passenger-data-6f29c7989681?source=collection_archive---------24-----------------------#2020-08-02">https://towardsdatascience.com/time-series-analysis-with-prophet-air-passenger-data-6f29c7989681?source=collection_archive---------24-----------------------#2020-08-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2800" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Prophet 进行时间序列分析</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b955033d95feba3a25374d4c3cfe7a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wgcylTE86o3z6ueJYT0BNg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:图片由<a class="ae ky" href="https://pixabay.com/users/free-photos-242387/" rel="noopener ugc nofollow" target="_blank"> Free-Photos </a>来自<a class="ae ky" href="https://pixabay.com/photos/plane-trip-journey-explore-841441/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><p id="3d4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> Prophet </strong>是脸书开发的一个预测模型，它通过对季节性、假期和变点等因素进行特殊调整来预测时间序列。</p><p id="cd32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过构建一个预测航空乘客数量的 Prophet 模型来进一步研究这个问题。</p><h1 id="6bbb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">背景</h1><p id="9be7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">数据集来源于<strong class="lb iu">旧金山国际机场关于航空公司</strong>月度客运量统计的报告，该报告可从<em class="ms"> data.world(原始来源:旧金山开放数据)</em>获得，如下文参考资料部分所示。</p><p id="e790" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">具体来说，对航空公司<strong class="lb iu">荷航</strong> (enplaned)调整后的乘客人数进行过滤，作为从 2005 年 5 月<strong class="lb iu">到 2016 年 3 月</strong>期间的时间序列进行分析。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/4c87696f2938e1b29a1eef2c1b50656b.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*ZX5UTD4Rk9eNV12NwE6H8g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="a937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，时间序列显示了一个相当稳定的模式(其中有一个恒定的均值，方差和自相关。</p><p id="42d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们不会在这里正式测试这种情况，但同样明显的是，数据集中似乎存在显著的<strong class="lb iu">季节性</strong>——即在特定时间间隔发生的时间序列趋势的显著变化。</p><p id="4dcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从时间序列的视觉检查来看，似乎这种转变大约每八个月<strong class="lb iu">左右发生一次。</strong></p><h1 id="7630" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">模型结构</h1><p id="73dd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">记住这一点，让我们开始构建预测模型。</p><p id="ccd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步是正确格式化数据，以便使用 Prophet。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="aa58" class="mz lw it mv b gy na nb l nc nd">train_dataset= pd.DataFrame()<br/>train_dataset['ds'] = train_df['Date']<br/>train_dataset['y']= train_df['Adjusted Passenger Count']<br/>train_dataset.head(115)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/d4a2d59337e8ccf750f218165ec3a9c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*wGLtJC2hdlSUgm-ZAGuiqQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="c61a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是将用作测试集的数据帧(我们试图预测的时间序列的一部分)，时间间隔定义为<strong class="lb iu">每月</strong>:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="38e1" class="mz lw it mv b gy na nb l nc nd">future= prophet_basic.make_future_dataframe(periods=14, freq='M')<br/>future.tail(15)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/434319e159744f977a8bd1b414cc8dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:328/format:webp/1*eK1s-99e0QSDKqrWQZ3Gdw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="0363" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先定义一个模型如下:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="66a9" class="mz lw it mv b gy na nb l nc nd">prophet_basic = Prophet()<br/>prophet_basic.fit(train_dataset)</span></pre><p id="c0a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个预测图:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="3b08" class="mz lw it mv b gy na nb l nc nd">forecast=prophet_basic.predict(future)<br/>fig1 =prophet_basic.plot(forecast)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/4e6b7ea3c4d177134b0d227b140c0975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uam7OemwOKp7JUYfpjxqWQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="0c6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是预测的组成部分:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="a601" class="mz lw it mv b gy na nb l nc nd">fig1 = prophet_basic.plot_components(forecast)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/f06c68ae09b19ed6ed475d312eb2dbdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*dfDGtxt2aoPnnl5Z0kZwwA.png"/></div></figure><p id="33be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一些观察结果:</p><ul class=""><li id="e0b2" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">我们可以看到，从 2007 年到 2009 年，这一趋势有显著增长，此后乘客人数趋于平稳。</li><li id="0b78" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">我们还观察到，乘客数量似乎在大约 5-9 月份达到最高，之后我们会看到今年剩余时间乘客数量的下降。</li></ul><p id="64ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们直观地观察到季节性似乎出现在数据集中。然而，考虑到我们正在处理一个月度数据集——在这种情况下，我们不会使用 Prophet 来明确地模拟季节性。</p><p id="3172" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这有两个原因:</p><ol class=""><li id="40e1" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nw no np nq bi translated">如果我们使用每日数据，对季节性的检测会更准确——但我们没有这样做。</li><li id="1aed" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nw no np nq bi translated">在这种情况下，假设年度季节性可能不是特别准确。检查数据集显示，虽然某些季节变化每年都会发生，但其他季节变化每 6 到 8 个月就会发生一次。因此，在这种情况下，在模型中明确定义季节性参数可能弊大于利。</li></ol><h1 id="fa42" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">变革点</h1><p id="943c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">转折点代表时间序列中的重大结构转变。</p><p id="17d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，新冠肺炎疫情爆发后航空乘客数量的大幅下降，将代表着数据中的重大结构性转变。</p><p id="60a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，当适当的参数设置为<strong class="lb iu"> 4 </strong>时，这是模型上显示的变化点。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="3686" class="mz lw it mv b gy na nb l nc nd">pro_change= Prophet(n_changepoints=4)<br/>forecast = pro_change.fit(train_dataset).predict(future)<br/>fig= pro_change.plot(forecast);<br/>a = add_changepoints_to_plot(fig.gca(), pro_change, forecast)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/33317a2b3f8682104fa593ce2aa91653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a-FTNQQVC9POTkoLXc8IEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="b7d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到，模型中显示的重大转折点出现在 2007 年至 2009 年之间。</p><p id="e9d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有趣的是，虽然 2009 年的乘客数量确实出现了显著下降，但平均而言，这一时期的乘客数量仍高于 2005 年至 2007 年，这表明航空旅行的总体需求(至少对于从旧金山出发的荷航航班而言)在近十年内实际上有所增长。</p><h1 id="1776" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">模型验证</h1><p id="abc3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在，预测模型已经建立，预测的乘客数量与测试集进行比较，以确定模型的准确性。</p><p id="2304" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将变点设置为<strong class="lb iu"> 4 </strong>，我们获得以下误差指标:</p><ul class=""><li id="ac0e" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">均方根误差:524</li><li id="d59e" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">平均预测误差:71</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/aa9829b205263f8765f7f076d08e5876.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*TVoV8bNmwNGxotti2SjO-w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:Jupyter 笔记本输出</p></figure><p id="8541" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">平均每月 8，799 名乘客(与该数字相比，误差非常低)，表明该模型在预测每月乘客人数方面表现良好。</p><p id="433a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，重要的是要注意，模型精度受到变点参数的显著影响。</p><p id="e19e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看当变点被修改时，RMSE 会发生什么。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/215a102d2af5bf0d57df8a3af116f269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*UVKvMvUsyrcExAETAuloaA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:作者的计算</p></figure><p id="0abf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，随着更多变点的引入，RMSE 急剧下降——但是 RMSE 在<strong class="lb iu"> 4 </strong>变点处最小化。</p><h1 id="db85" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="9553" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在本例中，您看到了:</p><ul class=""><li id="fd47" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">如何使用 Prophet 进行时间序列预测</li><li id="0ead" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">如何使用 Prophet 分析趋势和季节性波动</li><li id="9d35" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">变点在确定模型准确性中的重要性</li></ul><p id="b64f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望你发现这有用，并感谢任何想法或反馈！</p><p id="78e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ms">免责声明:本文是在“原样”的基础上编写的，没有任何担保。本文旨在提供数据科学概念的概述，不应以任何方式解释为专业建议。</em></p><h1 id="0bbe" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><ul class=""><li id="363f" class="ni nj it lb b lc mn lf mo li ny lm nz lq oa lu nn no np nq bi translated"><a class="ae ky" href="https://kourentzes.com/forecasting/2014/11/09/additive-and-multiplicative-seasonality/" rel="noopener ugc nofollow" target="_blank">加法和乘法季节性——你能正确识别它们吗？</a></li><li id="1683" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><a class="ae ky" href="https://data.world/data-society/air-traffic-passenger-data" rel="noopener ugc nofollow" target="_blank"> data.world:空中交通乘客数据</a>(原始来源:<a class="ae ky" href="https://data.sfgov.org/Transportation/Air-Traffic-Passenger-Statistics/rkru-6vcg" rel="noopener ugc nofollow" target="_blank">三藩市公开数据</a>)</li><li id="e290" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><a class="ae ky" href="https://github.com/facebook/prophet" rel="noopener ugc nofollow" target="_blank"> GitHub: facebook/prophet </a></li><li id="80f2" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">罗布·J·海曼:月度季节性</li></ul></div></div>    
</body>
</html>