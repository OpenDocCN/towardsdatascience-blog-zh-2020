<html>
<head>
<title>Adaptive filtering in Stock Market prediction: a different approach</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">股票市场预测中的自适应滤波:一种不同的方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/adaptive-filtering-in-stock-market-prediction-2db9ad7ae7f9?source=collection_archive---------26-----------------------#2020-03-19">https://towardsdatascience.com/adaptive-filtering-in-stock-market-prediction-2db9ad7ae7f9?source=collection_archive---------26-----------------------#2020-03-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9eec" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用 LMS 线性自适应滤波器预测股票市场价格</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b1cb40ce64d8479f35cacc324b4081fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J8OqQT5fr3gXqEifGxBSxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">莎伦·麦卡琴在<a class="ae ky" href="https://unsplash.com/s/photos/dollar" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> P </span>很可能你在网上看到了很多关于股市预测的内容，但每一条似乎都是空话连篇，或者是看起来不可思议的事情。</p><p id="93c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">预测股票市场价格是数据科学中一个主要领域的一部分，称为<strong class="lb iu">时间序列分析</strong>，在这里我们将看到我们如何用一种非常漂亮、简单且效果不错的非常规方法来处理这个问题:<strong class="lb iu">自适应滤波</strong>。</p><h2 id="0077" class="me mf it bd mg mh mi dn mj mk ml dp mm li mn mo mp lm mq mr ms lq mt mu mv mw bi translated">时间序列</h2><blockquote class="mx my mz"><p id="926a" class="kz la na lb b lc ld ju le lf lg jx lh nb lj lk ll nc ln lo lp nd lr ls lt lu im bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Time_series" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="it">时间序列</em> </strong> </a>是一系列按时间顺序索引(或列出或绘制)的数据点。</p></blockquote><p id="4178" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对计量经济学、统计学和气象学等领域非常重要的是，时间序列的研究是<strong class="lb iu">挑战性问题</strong>之一，激发了信号处理、机器学习和数据分析领域的大量研究，因为它可以用于<strong class="lb iu">聚类</strong>、<strong class="lb iu">分类</strong>，以及在这种情况下的<strong class="lb iu">预测。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/00802632779fad71e4038cf9bcd46073.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*gLhf-LUmgHyrndbMUYIWog.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">股票价格分析是一个时间序列问题！</p></figure><p id="4922" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了有更实际的情况，我们将使用 2019 年 178 天期间的<strong class="lb iu"> ABEV3 (ON) </strong>股票价格。如果你认为这种数据很难获得，那么你就错了。这个数据是我在<a class="ae ky" href="http://www.b3.com.br/pt_br/" rel="noopener ugc nofollow" target="_blank"> b3 网站</a>、<strong class="lb iu">巴西官方股市</strong>得到的，而且是免费的:)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/5de07fec1230abaea1c5f9e63a162a0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*-u3WJOf5NQqEsgKLHwXvCA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ABEV3(上)2019 年 180 天股价</p></figure><p id="308a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很好，一旦我们掌握了数据，我们就来讨论算法</p><h2 id="b729" class="me mf it bd mg mh mi dn mj mk ml dp mm li mn mo mp lm mq mr ms lq mt mu mv mw bi translated">LMS 滤波器</h2><p id="7fae" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Least_mean_squares_filter" rel="noopener ugc nofollow" target="_blank"> LMS 滤波器</a>是一种自适应滤波器，用于解决线性问题。滤波器的思想是通过最小化误差信号的最小均方来模拟系统(找到滤波器系数)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/927d42be566205cdb7e46ab18785b4ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*2E1eg7WLjbCmK7g8UDWHUw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">LMS 滤波器伪代码</p></figure><p id="3cbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="na">总的来说</em>，我们不知道用线性方法是否能很好地解决问题，所以我们通常测试一个<strong class="lb iu">线性</strong>和一个<strong class="lb iu">非线性</strong>算法。由于互联网总是显示非线性方法，我们将使用 LMS 来证明股票市场预测<strong class="lb iu">可以用具有<strong class="lb iu">良好精度</strong>的线性算法</strong>来完成。</p><p id="c9c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是这个滤波器<strong class="lb iu">模仿了</strong>一个系统，也就是说，如果我们在我们的数据中应用这个滤波器，我们将训练<strong class="lb iu">滤波器系数</strong>，当我们输入一个新的向量时，我们的滤波器系数将输出原始系统会输出的响应(在最好的情况下)。因此，我们只需做一个<em class="na">巧妙的</em>修改，就可以使用这个过滤器来预测数据。</p><h2 id="2df7" class="me mf it bd mg mh mi dn mj mk ml dp mm li mn mo mp lm mq mr ms lq mt mu mv mw bi translated">该系统</h2><p id="28c6" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">首先，我们将我们的输入向量延迟<em class="na"> l </em>个位置，其中<em class="na"> l </em>将是我们想要预测的天数，这个<em class="na"> l </em>新位置将由<strong class="lb iu">个零</strong>填充。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/a0822aa6d825702d249eda3b83cfd787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XPGQet-uVBMjZ-8aYzDQlg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">系统的模式</p></figure><p id="53e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们应用 LMS 滤波器时，我们将针对前 178 个数据训练滤波器。之后我们会将误差设置为零，那么系统会开始输出答案作为原系统到最后的<em class="na"> l </em>值。我们将<em class="na">棘手的</em>修改称为<strong class="lb iu"> LMSPred 算法</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/24295fb7f9f052ea240478dff1b30b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Oe1Ibpj4XuO4CQYbi5hxpQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">LMSPred 伪代码</p></figure><h2 id="2ad1" class="me mf it bd mg mh mi dn mj mk ml dp mm li mn mo mp lm mq mr ms lq mt mu mv mw bi translated">最后，我们来编码吧！</h2><p id="610f" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">首先我们必须导入我们将在这段代码中使用的<strong class="lb iu">库</strong>:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="2a63" class="me mf it nn b gy nr ns l nt nu"><strong class="nn iu">import</strong> numpy <strong class="nn iu">as</strong> np<br/><strong class="nn iu">import</strong> matplotlib.pyplot <strong class="nn iu">as</strong> plt</span></pre><p id="0d8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是 LMSPred 的<strong class="lb iu">实现</strong>，你可以边看伪代码边自己尝试，这里是我的实现:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="a687" class="me mf it nn b gy nr ns l nt nu"><strong class="nn iu">def</strong> <strong class="nn iu">lmsPred</strong>(x,l,u,N):<br/>    xd= np.<strong class="nn iu">block</strong>([np.zeros((1,l)), x]).T<br/>    y=np.<strong class="nn iu">zeros</strong>((len(xd),1))<br/>    xn=np.<strong class="nn iu">zeros</strong>((N+1,1))<br/>    xn = np.<strong class="nn iu">matrix</strong>(xn)<br/>    wn=np.<strong class="nn iu">random</strong>.<strong class="nn iu">rand</strong>(N+1,1)/10<br/>    M=<strong class="nn iu">len</strong>(xd)<br/>    <strong class="nn iu">for</strong> n <strong class="nn iu">in</strong> range(0,M):<br/>        xn = np.<strong class="nn iu">block</strong>([[xd[n]], [xn[0:N]]]);<br/>        y[n]= np.<strong class="nn iu">matmul</strong>(wn.T, xn);<br/>        <strong class="nn iu">if</strong>(n&gt;M-l-1):<br/>            e =0;<br/>        <strong class="nn iu">else</strong>:<br/>            e=<strong class="nn iu">int</strong>(x[n]-y[n]);<br/>        wn = wn + 2*u*e*xn;<br/>        <br/>    <strong class="nn iu">return</strong> y,wn;</span></pre><p id="61a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将<strong class="lb iu">定义</strong>我们的向量 x，它具有 ABEV3 (ON)的 178 个值:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="90cb" class="me mf it nn b gy nr ns l nt nu">x = np.<strong class="nn iu">array</strong>([1655, 1648, 1615, 1638, 1685, 1729, 1754, 1770, 1780, 1785, 1800, 1800, 1754, 1718, 1716, 1795, 1787, 1797, 1751, 1811, 1845, 1864, 1809, 1875, 1822, 1871, 1867, 1839, 1859, 1849, 1819, 1832, 1815, 1832, 1832, 1839, 1849, 1836, 1723, 1683, 1637, 1669, 1659, 1711, 1700, 1690, 1666, 1676, 1731, 1719, 1700, 1698, 1672, 1652, 1699, 1654, 1675, 1683, 1682, 1677, 1684, 1732, 1744, 1735, 1769, 1755, 1725, 1706, 1742, 1753, 1705, 1708, 1750, 1767, 1772, 1831, 1829, 1835, 1847, 1795, 1792, 1806, 1765, 1792, 1749, 1730, 1701, 1694, 1661, 1664, 1649, 1649, 1709, 1721, 1721, 1706, 1722, 1731, 1726, 1743, 1755, 1742, 1735, 1741, 1764, 1761, 1765, 1772, 1768, 1785, 1764, 1780, 1805, 1820, 1845, 1830, 1817, 1810, 1805, 1789, 1781, 1813, 1887, 1900, 1900, 1894, 1902, 1869, 1820, 1825, 1810, 1799, 1825, 1809, 1799, 1803, 1796, 1949, 1980, 2050, 2034, 2013, 2042, 2049, 2016, 2048, 2063, 2017, 2007, 1948, 1938, 1901, 1878, 1890, 1911, 1894, 1880, 1847, 1833, 1809, 1817, 1815, 1855, 1872, 1838, 1852, 1880, 1869, 1872, 1887, 1882, 1891, 1937, 1910, 1915, 1943, 1926, 1935]);</span></pre><p id="4f42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了训练该系统，我们将采用前 173 个值，学习率为 2^(-30)，过滤顺序 N=60，l=5 天的预测。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="2fb8" class="me mf it nn b gy nr ns l nt nu">x_train = x[0:173]<br/>u = 2**(-30);<br/>l=5;<br/>N=60;<br/>y,wn = <strong class="nn iu">lmsPred</strong>(x_train,l,u,N)</span></pre><p id="edea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了<strong class="lb iu">可视化</strong>输入数据和学习曲线，我们将绘制如下:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="ee7b" class="me mf it nn b gy nr ns l nt nu">plt.<strong class="nn iu">plot</strong>(x, <strong class="nn iu">color</strong> = 'black')<br/>plt.<strong class="nn iu">plot</strong>(y, <strong class="nn iu">color</strong> = 'red')<br/>plt.<strong class="nn iu">show</strong>()</span></pre><p id="bf32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并评估我们预测的百分误差:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="c15d" class="me mf it nn b gy nr ns l nt nu">pred = y[-l:]<br/>realvalues = x[-l]<br/>error = 100*(pred.T-realvalues)/realvalues<br/><strong class="nn iu">print</strong>(<strong class="nn iu">abs</strong>(error))</span></pre><p id="ac85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，<strong class="lb iu">的完整代码为</strong>:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="8dba" class="me mf it nn b gy nr ns l nt nu"><strong class="nn iu">import</strong> numpy <strong class="nn iu">as</strong> np<br/><strong class="nn iu">import</strong> matplotlib.pyplot <strong class="nn iu">as</strong> plt</span><span id="20b5" class="me mf it nn b gy nv ns l nt nu"><strong class="nn iu">def</strong> <strong class="nn iu">lmsPred</strong>(x,l,u,N):<br/>    xd= np.<strong class="nn iu">block</strong>([np.zeros((1,l)), x]).T<br/>    y=np.<strong class="nn iu">zeros</strong>((len(xd),1))<br/>    xn=np.<strong class="nn iu">zeros</strong>((N+1,1))<br/>    xn = np.<strong class="nn iu">matrix</strong>(xn)<br/>    wn=np.<strong class="nn iu">random</strong>.<strong class="nn iu">rand</strong>(N+1,1)/10<br/>    M=<strong class="nn iu">len</strong>(xd)<br/>    <strong class="nn iu">for</strong> n <strong class="nn iu">in</strong> range(0,M):<br/>        xn = np.<strong class="nn iu">block</strong>([[xd[n]], [xn[0:N]]]);<br/>        y[n]= np.<strong class="nn iu">matmul</strong>(wn.T, xn);<br/>        <strong class="nn iu">if</strong>(n&gt;M-l-1):<br/>            e =0;<br/>        <strong class="nn iu">else</strong>:<br/>            e=<strong class="nn iu">int</strong>(x[n]-y[n]);<br/>        wn = wn + 2*u*e*xn;<br/>        <br/>    <strong class="nn iu">return</strong> y,wn;</span><span id="4e11" class="me mf it nn b gy nv ns l nt nu">x = np.<strong class="nn iu">array</strong>([1655, 1648, 1615, 1638, 1685, 1729, 1754, 1770, 1780, 1785, 1800, 1800, 1754, 1718, 1716, 1795, 1787, 1797, 1751, 1811, 1845, 1864, 1809, 1875, 1822, 1871, 1867, 1839, 1859, 1849, 1819, 1832, 1815, 1832, 1832, 1839, 1849, 1836, 1723, 1683, 1637, 1669, 1659, 1711, 1700, 1690, 1666, 1676, 1731, 1719, 1700, 1698, 1672, 1652, 1699, 1654, 1675, 1683, 1682, 1677, 1684, 1732, 1744, 1735, 1769, 1755, 1725, 1706, 1742, 1753, 1705, 1708, 1750, 1767, 1772, 1831, 1829, 1835, 1847, 1795, 1792, 1806, 1765, 1792, 1749, 1730, 1701, 1694, 1661, 1664, 1649, 1649, 1709, 1721, 1721, 1706, 1722, 1731, 1726, 1743, 1755, 1742, 1735, 1741, 1764, 1761, 1765, 1772, 1768, 1785, 1764, 1780, 1805, 1820, 1845, 1830, 1817, 1810, 1805, 1789, 1781, 1813, 1887, 1900, 1900, 1894, 1902, 1869, 1820, 1825, 1810, 1799, 1825, 1809, 1799, 1803, 1796, 1949, 1980, 2050, 2034, 2013, 2042, 2049, 2016, 2048, 2063, 2017, 2007, 1948, 1938, 1901, 1878, 1890, 1911, 1894, 1880, 1847, 1833, 1809, 1817, 1815, 1855, 1872, 1838, 1852, 1880, 1869, 1872, 1887, 1882, 1891, 1937, 1910, 1915, 1943, 1926, 1935]);</span><span id="cfc5" class="me mf it nn b gy nv ns l nt nu">x_train = x[0:173]<br/>u = 2**(-30);<br/>l=5;<br/>N=60;<br/>y,wn = <strong class="nn iu">lmsPred</strong>(x_train,l,u,N)</span><span id="ff46" class="me mf it nn b gy nv ns l nt nu">plt.<strong class="nn iu">plot</strong>(x, <strong class="nn iu">color</strong> = 'black')<br/>plt.<strong class="nn iu">plot</strong>(y, <strong class="nn iu">color</strong> = 'red')<br/>plt.<strong class="nn iu">show</strong>()</span><span id="982b" class="me mf it nn b gy nv ns l nt nu">pred = y[-l:]<br/>realvalues = x[-l]<br/>error = 100*(pred.T-realvalues)/realvalues<br/><strong class="nn iu">print</strong>(<strong class="nn iu">abs</strong>(error))</span></pre><h2 id="84a2" class="me mf it bd mg mh mi dn mj mk ml dp mm li mn mo mp lm mq mr ms lq mt mu mv mw bi translated">结果</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/85149338c38611f001e04cf08a3bbb03.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*hfjoZaGWbuKHeo6Vy34d8A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">股市预测结果一例</p></figure><p id="9df9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们选择了<strong class="lb iu">的黑色</strong>作为<strong class="lb iu">的真实数据</strong>，而<strong class="lb iu">的红色</strong>作为我们的<strong class="lb iu">预测</strong>，正如你所看到的，最初它们有很大的差异，但是更接近于对应于<strong class="lb iu">滤波器阶数</strong>的值(在这种情况下，60)两条曲线非常接近。</p><p id="f5dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，每天的百分比输出精度为:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="6eaa" class="me mf it nn b gy nr ns l nt nu">[[0.79837693 1.12168626 1.24557245 2.24050302 3.16604697]]</span></pre><p id="4e3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，第 5 天有<strong class="lb iu"> 3.16% </strong>的误差，这是一个相当不错的值，因为我们使用的是一个非常简单的方法。</p><p id="9ef9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要强调的是，对于高值的<em class="na"> l </em>，股票市场预测<strong class="lb iu">不太好</strong>，因为我们要在<em class="na">稳定状态</em>期间分析股票市场，也就是说，不考虑未来可能的<strong class="lb iu">危机</strong>、<strong class="lb iu">政治问题</strong>等。因此，对<em class="na"> l. </em>的<strong class="lb iu">小值</strong>使用股市预测更安全</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><p id="aa0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有任何问题，可以在我的 LinkedIn 个人资料中关注我！</p></div></div>    
</body>
</html>