<html>
<head>
<title>Interactive Reporting in Jupyter Notebook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jupyter 笔记本中的交互式报告</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-reporting-in-jupyter-notebook-92a4fa90c09a?source=collection_archive---------3-----------------------#2020-03-10">https://towardsdatascience.com/interactive-reporting-in-jupyter-notebook-92a4fa90c09a?source=collection_archive---------3-----------------------#2020-03-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e9bf163417fc04ed0108d21f8432f013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PApJhlKa0TvdE-axjiwPAg.png"/></div></div></figure><blockquote class="jy"><p id="d20e" class="jz ka iq bd kb kc kd ke kf kg kh ki dk translated">从新的角度看《纽约时报》的报道</p></blockquote><p id="7a36" class="pw-post-body-paragraph kj kk iq kl b km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ki ij bi translated"><strong class="kl ir"> Jupyter 笔记本</strong>是数据科学家箭囊中的重要一箭。这个开源应用程序是<em class="lg">灵活</em>，最重要的是<em class="lg">交互</em>。这是一个基本数据科学任务所需的工具，如数据清理、构建可视化、创建机器学习模型等。您可以在这里编写 Python 或 R 代码(取决于您使用的内核)，将代码执行的结果保存在单元格中，并与其他人共享。</p><p id="e37d" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">我无法想象没有 Jupyter 笔记本的工作。它们可以共享，设置快速，使用简单，即使您刚刚开始进入数据分析领域或学习 Python。</p><h1 id="3fd5" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">用 Python 分析数据</h1><p id="a081" class="pw-post-body-paragraph kj kk iq kl b km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc mo le lf ki ij bi translated">如果您经常使用 Python 处理数据，您可能会经常看到以<strong class="kl ir">汇总</strong>形式出现的数据。在 Python 中，你可以使用<a class="ae mp" href="https://pandas.pydata.org/pandas-docs/stable/index.html" rel="noopener ugc nofollow" target="_blank"> pandas </a>库中的内置函数<strong class="kl ir">分组</strong>或<strong class="kl ir">透视</strong>你的<strong class="kl ir">数据</strong>。</p><p id="985a" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated"><em class="lg">一种经典的旋转方式是使用古老的</em><a class="ae mp" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html" rel="noopener ugc nofollow" target="_blank"><strong class="kl ir"><em class="lg">pivot _ table</em></strong></a><em class="lg">方法</em>。至于大多数 Python 方法，其语法简单易懂。</p><p id="2711" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">然而，数据透视表布局的逻辑越复杂，编写代码所需的时间就越多。此外，由此产生的<strong class="kl ir">透视表始终是</strong>静态的<strong class="kl ir">而不是交互式的</strong>。每次需要在透视网格上排列数据以便从不同的角度查看时，都需要重写代码。是的，这可能不涉及太多的变化，但是相反，你可以花时间关注你的数据，并对其有更好的理解。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><p id="f8a3" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">今天，我将向您展示另一种在 Jupyter 笔记本中透视数据的方法<strong class="kl ir">。掌握这种方法后，您将很快轻松地生成交互式报告。</strong></p><h1 id="d39a" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">如何使 Python 中的透视数据具有交互性</h1><p id="20ba" class="pw-post-body-paragraph kj kk iq kl b km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc mo le lf ki ij bi translated">我将要展示的方法最棒的一点是，您可以<em class="lg">将生成的带有交互式数据可视化组件的笔记本保存到</em> <strong class="kl ir"> HTML </strong>中，并将其发送给您的朋友和队友。他们可以在浏览器中打开它，玩数据透视表和数据透视图，获得他们个人的见解，保存他们配置的报告并重新发送给您。这可能会使整个<em class="lg">数据分析体验更有成效</em>。</p><p id="453f" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">我们将在<strong class="kl ir"> JupyterLab </strong>工作，因为在那里运行笔记本电脑非常舒适。JupyterLab 只是 Jupyter 笔记本的一个用户界面。你在古典笔记本中使用的所有东西都在这里:笔记本、文件浏览器。但是 JupyterLab 提供了更多的扩展功能:你可以安装扩展，展开和折叠单元格，拖放它们——这是 Jupyter 可能缺少的功能。此外，文本编辑器提供了制表符自动完成功能。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="87d7" class="lm ln iq bd lo lp mx lr ls lt my lv lw lx mz lz ma mb na md me mf nb mh mi mj bi translated">在 JupyterLab 中构建报表</h1><p id="1cf7" class="pw-post-body-paragraph kj kk iq kl b km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc mo le lf ki ij bi translated">所以，运行你的 JupyterLab，让我们开始吧！</p><p id="30e7" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">首先，让我们导入我们需要的 Python 库。其中包括 pandas、json 和 IPython 的显示模块。所有这些库都是 Anaconda 发行版附带的，但是如果您不使用它，您可能需要在全局范围内或者在您的虚拟环境中安装这些库。</p><ul class=""><li id="9fd9" class="nc nd iq kl b km lh kq li ku ne ky nf lc ng ki nh ni nj nk bi translated"><a class="ae mp" href="https://pandas.pydata.org/pandas-docs/stable/index.html" rel="noopener ugc nofollow" target="_blank"> pandas </a>是用 Python 处理数据结构的必备库。</li><li id="a139" class="nc nd iq kl b km nl kq nm ku nn ky no lc np ki nh ni nj nk bi translated"><a class="ae mp" href="https://ipython.org/install.html" rel="noopener ugc nofollow" target="_blank"> IPython </a>是 Python 中用于交互式并行计算的 API。<a class="ae mp" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.display.html" rel="noopener ugc nofollow" target="_blank"> display </a>是它的模块，为 IPython 中的显示工具呈现 API。</li><li id="739d" class="nc nd iq kl b km nl kq nm ku nn ky no lc np ki nh ni nj nk bi translated"><a class="ae mp" href="https://docs.python.org/3/library/json.html" rel="noopener ugc nofollow" target="_blank"> json </a>库提供了 json 编码和解码的 API。如果你曾经使用过“marshal”或“pickle”模块，你应该对它的 API 很熟悉。</li></ul><p id="3619" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">对于数据可视化，我们将使用<a class="ae mp" href="https://www.flexmonster.com/?r=td2" rel="noopener ugc nofollow" target="_blank"> <strong class="kl ir"> Flexmonster 数据透视表&amp;图表</strong> </a>，这是一个 JavaScript 库。</p><p id="c5b1" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated"><strong class="kl ir">数据</strong>呢？出于演示的目的，我选择了一个来自 T21 Kaggle 的<a class="ae mp" href="https://www.kaggle.com/neuromusic/avocado-prices" rel="noopener ugc nofollow" target="_blank">‘牛油果价格’数据集。它是轻量级的，包含合理数量的字段。相反，你可以选择任何你喜欢的数据集。</a></p><p id="34f5" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated"><strong class="kl ir">加载你的数据</strong>。<strong class="kl ir"> </strong>使用 pandas，将 CSV 数据读入 dataframe。删除列“未命名:0”—读取 CSV 文件时经常出现的索引列。</p><figure class="nq nr ns nt gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="c06e" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">调用 dataframe 上的<code class="fe nw nx ny nz b">to_json()</code>方法，将其转换为 JSON 字符串，并保存到<code class="fe nw nx ny nz b">json_data</code>变量中。</p><figure class="nq nr ns nt gt jr"><div class="bz fp l di"><div class="nu nv l"/></div><p class="oa ob gj gh gi oc od bd b be z dk translated">'<code class="fe nw nx ny nz b">orient' </code>'参数定义了预期的 JSON 字符串格式。这里我们将其设置为“记录”值。该值将对象转换为类似列表的结构，即[{column - &gt; value}，…，{column - &gt; value}]。这正是 Flexmonster 使用的格式。</p></figure><p id="cb46" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">现在让我们使用<em class="lg">嵌套字典</em>创建 Flexmonster 的<strong class="kl ir">实例。在这里，我们指定所有必要的初始化参数，并将解码后的数据传递给组件。对于解码 JSON，我们使用<code class="fe nw nx ny nz b">json.loads()</code>的方法。</strong></p><figure class="nq nr ns nt gt jr"><div class="bz fp l di"><div class="nu nv l"/></div><p class="oa ob gj gh gi oc od bd b be z dk translated">如你所见，我们一次设置<strong class="ak">切片</strong>、<strong class="ak">选项</strong>和<strong class="ak">格式</strong>。我们可以跳过这一步，然后数据透视表将显示默认切片，但我认为最好从一开始就学习如何做。</p></figure><p id="8337" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">现在我们使用<code class="fe nw nx ny nz b">json.dumps()</code>将 Python 对象编码成 JSON :</p><figure class="nq nr ns nt gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="eb10" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">下一步是定义一个函数<strong class="kl ir">，该函数将数据透视表</strong>直接呈现在单元格中。为此，我们将定义一个多行字符串，并将其传递给导入的 HTML 函数:</p><figure class="nq nr ns nt gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="12fc" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">最后，我们可以将 JSON 传递给这个渲染函数，并调用它:</p><figure class="nq nr ns nt gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="9484" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">瞧吧！你看到的是页面上的<strong class="kl ir">交互透视表。数据集已准备就绪:您可以重新排列网格上的字段，更改聚合，设置筛选和排序，设置值的格式，并做一切事情来创建您独特的报表。此外，如果您错过了记录在数据框中显示的方式，您可以<em class="lg">从透视模式切换到平面视图</em>。通过这种方式，您将看到来自数据源的数据，但具有交互功能。</strong></p><p id="cdfb" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">下面是数据透视表现在的样子:</p><figure class="nq nr ns nt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/63b80b4720e2e0846dbd219080aaefc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NhNeOaZeq6nn_UNPCnVNQQ.gif"/></div></div></figure><p id="47f1" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">此外，您可以尝试应用条件格式来关注最重要的值。</p><h1 id="e6f2" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">在 Jupyter 笔记本中制作仪表板</h1><p id="0e39" class="pw-post-body-paragraph kj kk iq kl b km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc mo le lf ki ij bi translated">现在，让我们通过<em class="lg">向笔记本</em>添加更多元素来使我们的逻辑变得复杂一点。两个<strong class="kl ir">数据透视图</strong>将使我们的数据可视化更加通用。为此，我们将定义一个额外的函数，该函数接受多个 JSON 组件并将它们呈现在页面上。其逻辑与单个数据透视表相同。数据透视表组件的定义方式与数据透视表相同。</p><p id="f9cc" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">在数据透视表的报表切片中，我们可以设置<strong class="kl ir"> Top X filters </strong>，它可以方便地限制数据透视表上显示的类别数量。这使得它们更加整洁和紧凑。</p><figure class="nq nr ns nt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/7eb91d0269feb664b6d80f0da80ba655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*j_6otYk4q80uX__8AF9cWg.gif"/></div></div></figure><p id="5a31" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">万岁！现在你可以在你的 Jupyter 笔记本中享受一个<strong class="kl ir">交互式仪表盘</strong>！不要犹豫，生成一份关于你的数据分析报告，并与他人分享。</p><h1 id="8dd6" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">最后的想法</h1><p id="112a" class="pw-post-body-paragraph kj kk iq kl b km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc mo le lf ki ij bi translated">今天<strong class="kl ir"> </strong>我们尝试了一种在 Jupyter 笔记本中操作和呈现数据的新方法，<strong class="kl ir">使用 Python 和 JavaScript 数据可视化库</strong>。如您所见，设置一切并不需要太多的代码和时间。</p><p id="8327" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">一旦你这样做了，你就可以在你已经习惯的工作空间中探索你的数据。</p><p id="667e" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">这种方法使您不必在每次需要以不同的方式查看数据时重写代码。<em class="lg">与 Jupyter 笔记本</em> — <em class="lg">的中心思想</em> <strong class="kl ir"> <em class="lg"> </em> </strong> <em class="lg">齐头并进，使数据可视化和数据分析互动灵活。</em></p><p id="f431" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">你可以在<a class="ae mp" href="https://github.com/veronikaro/Interactive-Reporting-In-Jupyter-Notebook" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到完整代码。👈</p><h1 id="1b5d" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">高级选项</h1><p id="10a2" class="pw-post-body-paragraph kj kk iq kl b km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc mo le lf ki ij bi translated">为了满足您对仪表板中还可以增强哪些功能的好奇心，这里有一个主要功能的简要列表，您可以使用这些功能来改善您的报告:</p><ul class=""><li id="8040" class="nc nd iq kl b km lh kq li ku ne ky nf lc ng ki nh ni nj nk bi translated"><strong class="kl ir">映射</strong></li></ul><p id="ce63" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">很多时候，真实世界的数据既不整洁也不一致。字段可以用不同的大小写来命名，它们也可能包含不明显的缩写，等等。为了美化它，我们可以使用<a class="ae mp" href="https://www.flexmonster.com/api/mapping-object/?r=td2" rel="noopener ugc nofollow" target="_blank"> <strong class="kl ir">映射</strong></a>——设置应用于数据源的视图配置的报表属性。其格式化功能带来的另一个好处是数据类型的显式<strong class="kl ir">设置。通过设置类型，您可以告诉组件按照您想要的方式处理字段，例如字符串、数字或日期。这将影响对字段层次结构可用的聚合的选择。</strong></p><p id="2603" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated"><a class="ae mp" href="https://github.com/veronikaro/Interactive-Reporting-In-Jupyter-Notebook/blob/master/Reporting%20with%20pivot%20table.ipynb" rel="noopener ugc nofollow" target="_blank">在 GitHub 示例中，</a>您可以看到如何定义一个映射对象并将其设置到数据透视表。</p><ul class=""><li id="acbc" class="nc nd iq kl b km lh kq li ku ne ky nf lc ng ki nh ni nj nk bi translated"><strong class="kl ir">出口</strong></li></ul><p id="7af5" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">数据透视表带有 JavaScript API 方法和事件。您可以使用<code class="fe nw nx ny nz b"><a class="ae mp" href="https://www.flexmonster.com/api/exportto/?r=td2" rel="noopener ugc nofollow" target="_blank">exportTo</a></code>方法在本地配置不同格式的保存报告或将报告保存到远程目的地，如服务器。</p><ul class=""><li id="e163" class="nc nd iq kl b km lh kq li ku ne ky nf lc ng ki nh ni nj nk bi translated"><strong class="kl ir">计算值</strong></li></ul><p id="4f7e" class="pw-post-body-paragraph kj kk iq kl b km lh ko kp kq li ks kt ku lj kw kx ky lk la lb lc ll le lf ki ij bi translated">要在报告中引入新的公式，您可以添加<a class="ae mp" href="https://www.flexmonster.com/doc/calculated-values/?r=td2" rel="noopener ugc nofollow" target="_blank">计算值</a>。</p></div></div>    
</body>
</html>