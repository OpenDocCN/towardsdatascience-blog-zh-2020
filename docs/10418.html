<html>
<head>
<title>Writing custom scikit-learn transformers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写自定义 scikit-学习变形金刚</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/writing-custom-scikit-learn-transformers-e07a3cf7b559?source=collection_archive---------68-----------------------#2020-07-21">https://towardsdatascience.com/writing-custom-scikit-learn-transformers-e07a3cf7b559?source=collection_archive---------68-----------------------#2020-07-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="16a1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">当您需要量身定制的解决方案时。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/095c0c0558640c517da5175e001a37b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CTI2sk66EK5Q4JSXiqnOTQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@samule?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Samule 孙</a>在<a class="ae ky" href="https://unsplash.com/s/photos/transformer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6e18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">scikit-learn 的 transformers API 是一个用于数据清理、预处理、特征工程和提取的强大工具。然而，有时，在众多可用的变压器中，没有一个能与手头的具体问题相匹配。在这些场合，能够自己写一个是很方便的。幸运的是，很容易利用 scikit-learn 的类来构建一个遵循包约定的转换器，并且可以包含在 scikit-learn 管道中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/4fa79d8e1efffb34c1c49ca6a5ee5eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Hnd_TV9wu8KY5sWnN_sTw.png"/></div></div></figure><h1 id="7de7" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">问题设置</h1><p id="bad7" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">为了实用，我们来看一个例子。我们有一个名为<code class="fe mt mu mv mw b">TAO </code>的数据集，代表热带大气海洋。它包含一些天气测量，如温度、湿度或风速。R 库<code class="fe mt mu mv mw b">VIM</code>提供了这些数据的子样本。这里，我们正在处理一个稍微预处理过的版本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/101a2e0f19e343a30d26d53941868f73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9qtt2aFOMt2GamSPiWrD7w.png"/></div></div></figure><p id="d190" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">快速浏览一下数据框，我们会发现<code class="fe mt mu mv mw b">air_temp</code>变量中有大量缺失值，我们需要在建模前对其进行估算。</p><pre class="kj kk kl km gt my mw mz na aw nb bi"><span id="e624" class="nc lx it mw b gy nd ne l nf ng">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>RangeIndex: 733 entries, 0 to 732<br/>Data columns (total 8 columns):<br/>year                733 non-null int64<br/>latitude            733 non-null int64<br/>longitude           733 non-null int64<br/>sea_surface_temp    733 non-null float64<br/>air_temp            655 non-null float64<br/>humidity            642 non-null float64<br/>uwind               733 non-null float64<br/>vwind               733 non-null float64<br/>dtypes: float64(5), int64(3)<br/>memory usage: 45.9 KB</span></pre><p id="c1a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Scikit-learn 提供了输入转换器，如<code class="fe mt mu mv mw b">SimpleImputer</code>，它通过变量的平均值、中间值或其他一些量来填充变量的缺失值。然而，众所周知，这种插补会破坏数据中的关系。</p><p id="298d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是看，还有另一个叫做<code class="fe mt mu mv mw b">sea_surface_temp</code>的变量没有丢失值！我们可以预期水温与气温高度相关！让我们画出这两个变量的对比图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/d4a413350825cfe8301354bf599d2251.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*U1IS9CbAIScs0zETf43GDA.png"/></div></figure><p id="fb13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所料，存在明显的线性关系。此外，我们可以看到为什么均值或中值插补毫无意义:在水温为 22 或 29 的观测中，将气温设定为 24.5 度的中值完全破坏了这两个变量之间的关系。</p><p id="3c82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">似乎输入<code class="fe mt mu mv mw b">air_temp</code>的一个好策略是使用带有<code class="fe mt mu mv mw b">sea_surface_temp</code>的线性回归作为预测器。从 scikit-learn 0.21 版本开始，我们可以使用<code class="fe mt mu mv mw b">IterativeImputer</code>并将<code class="fe mt mu mv mw b">LinearRegression</code>设置为输入引擎。然而，这将使用数据中的所有变量作为预测值，而我们只需要水温。让我们编写自己的转换器来实现这一点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/4fa79d8e1efffb34c1c49ca6a5ee5eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Hnd_TV9wu8KY5sWnN_sTw.png"/></div></div></figure><h1 id="7f58" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">定制变压器</h1><p id="3032" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">scikit-learn 转换器应该是一个实现三种方法的类:</p><ul class=""><li id="0114" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated"><code class="fe mt mu mv mw b">fit()</code>，它简单地返回<code class="fe mt mu mv mw b">self</code>，</li><li id="e5c7" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><code class="fe mt mu mv mw b">transform()</code>，它将数据<code class="fe mt mu mv mw b">X</code>作为输入，并执行所需的转换，</li><li id="ca8a" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><code class="fe mt mu mv mw b">fit_transform()</code>，如果包含<code class="fe mt mu mv mw b">TransformerMixin</code>作为基类，会自动添加。</li></ul><p id="9c98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这些之上，我们有<code class="fe mt mu mv mw b">__init__()</code>来捕获参数——在我们的例子中是空气和水温列的指数。我们还可以包含<code class="fe mt mu mv mw b">BaseEstimator</code>作为基类，这将允许我们从 transformer 对象中检索参数。</p><p id="b996" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总而言之，所有的工作都归结为实际编写<code class="fe mt mu mv mw b">transform()</code>方法，该方法使用适当的列来拟合线性回归模型，并使用它来估算气温。整个事情只有几行代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ec1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以像使用任何其他 scikit-learn 转换器一样使用我们的 imputer:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="b397" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以提取它的参数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><pre class="kj kk kl km gt my mw mz na aw nb bi"><span id="cf37" class="nc lx it mw b gy nd ne l nf ng">{'air_temp_index': 4, 'sea_temp_index': 3}</span></pre><p id="cb93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过在之前的散点图上绘制估算值来检查估算器是否工作良好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/1685f2f9da0ef61421284a67c477428c.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*cD-uKCjGfiDFuhCvE-EpPg.png"/></div></figure><p id="0ad1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看起来不错:所有估算的数据点都在一条线上，这应该是线性回归预测的情况。更重要的是，估算的数据看起来与观察到的数据相似。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/4fa79d8e1efffb34c1c49ca6a5ee5eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Hnd_TV9wu8KY5sWnN_sTw.png"/></div></div></figure><p id="c6fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！如果你有兴趣学习更高级的插补方法，请查看我在 DataCamp  上教授的<a class="ae ky" href="https://datacamp.com/courses/handling-missing-data-with-imputations-in-r" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">课程。</strong></a></p><p id="4d86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这篇文章，为什么不订阅电子邮件更新我的新文章呢？并且通过<a class="ae ky" href="https://michaloleszak.medium.com/membership" rel="noopener"> <strong class="lb iu">成为媒介会员</strong> </a>，可以支持我的写作，获得其他作者和我自己的所有故事的无限访问权限。</p><p id="5b7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要咨询？你可以问我任何事情，也可以在这里为我预约 1:1<a class="ae ky" href="http://hiretheauthor.com/michal" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"/></a>。</p><p id="0f9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也可以试试<a class="ae ky" href="https://michaloleszak.github.io/blog/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">我的其他文章</strong> </a>中的一篇。不能选择？从这些中选择一个:</p><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/working-with-amazon-s3-buckets-with-boto3-785252ea22e0"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">使用 Boto3 处理亚马逊 S3 桶。</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">完整的备忘单。</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq ks oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/uncertainty-from-imputation-8dbb34a19612"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">插补的不确定性</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">你在预测中考虑到它了吗？</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="or l on oo op ol oq ks oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/a-comparison-of-shrinkage-and-selection-methods-for-linear-regression-ee4dd3a71f16"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">线性回归中收缩法和选择法的比较</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">详细介绍 7 种流行的收缩和选择方法。</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="os l on oo op ol oq ks oc"/></div></div></a></div></div></div>    
</body>
</html>