<html>
<head>
<title>Azure Machine Learning Service — Where is My Data?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure 机器学习服务—我的数据在哪里？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/azure-machine-learning-service-where-is-my-data-pjainani-86a77b93ab52?source=collection_archive---------18-----------------------#2020-07-05">https://towardsdatascience.com/azure-machine-learning-service-where-is-my-data-pjainani-86a77b93ab52?source=collection_archive---------18-----------------------#2020-07-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="517f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">第 4 部分:数据集和数据存储简介</h2></div><h1 id="662f" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">摘要</h1><p id="bd7c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">或许这就是云机器学习平台的重要方面之一。每个机器学习问题的迫切需要是它的数据。这些数据大多来自各种不同的来源，然后经过提炼、修剪和处理，用于各种分析，并用于 ML 模型。由于这个原因，云机器学习定义了数据管理 SDK，它可以定义、保护和管理云平台中的数据源。</p><blockquote class="lw"><p id="258c" class="lx ly it bd lz ma mb mc md me mf lv dk translated">这篇特别的文章摘自 Kaggle 笔记本，这里是<a class="ae mg" href="https://www.kaggle.com/pankaj1234/azure-machine-learning-working-with-data" rel="noopener ugc nofollow" target="_blank">这里是</a>。使用设置的链接来执行实验。</p></blockquote><figure class="mi mj mk ml mm mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mh"><img src="../Images/4256acbe3ad06c0c1e789ce30b49dbdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YyG46pHjhTzI8qrDOgaHeg.jpeg"/></div></div><p class="mu mv gj gh gi mw mx bd b be z dk translated">来自<a class="ae mg" href="https://www.pexels.com/photo/person-holding-blue-ballpoint-pen-on-white-notebook-669610/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">佩克斯</a>的<a class="ae mg" href="https://www.pexels.com/@goumbik?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">卢卡斯</a>的照片</p></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="18c8" class="ki kj it bd kk kl nf kn ko kp ng kr ks jz nh ka ku kc ni kd kw kf nj kg ky kz bi translated">数据存储和数据集</h1><h2 id="ce59" class="nk kj it bd kk nl nm dn ko nn no dp ks lj np nq ku ln nr ns kw lr nt nu ky nv bi translated">数据存储</h2><p id="2e62" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">数据存储是一种数据管理功能，是由 Azure 机器学习服务(AML)提供的 SDK。它使我们能够连接到各种数据源，然后这些数据源可以用于将它们摄取到 ML 实验中，或者写入来自相同实验的输出。Azure 提供各种平台服务，这些服务可以作为数据源，例如 blob store、data lake、SQL database、Databricks 等等。</p><p id="e2aa" class="pw-post-body-paragraph la lb it lc b ld nw ju lf lg nx jx li lj ny ll lm ln nz lp lq lr oa lt lu lv im bi translated">Azure ML workspace 与 Azure 中定义的数据存储有着天然的集成，比如 Blob 存储和文件存储。但是，执行 ML 模型可能需要来自其他外部来源的数据及其依赖性。因此，AML SDK 为我们提供了将这些外部资源注册为模型实验数据源的方法。定义数据存储的能力使我们能够跨多个实验重用数据，而不管实验运行的计算环境如何。</p><h2 id="3267" class="nk kj it bd kk nl nm dn ko nn no dp ks lj np nq ku ln nr ns kw lr nt nu ky nv bi translated">注册数据存储</h2><p id="40e7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如前所述，数据存储有两种类型——默认和用户调配，如存储 Blobs 容器或文件存储。要获取工作区的默认数据存储列表，请执行以下操作:</p><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="62a6" class="nk kj it og b gy ok ol l om on"><strong class="og iu"><em class="oo"># get the name of defult Datastore associated with the workspace.</em></strong><br/>default_dsname = ws.get_default_datastore().name<br/>default_ds = ws.get_default_datastore()<br/>print('default Datastore = ', default_dsname)</span></pre><p id="8c33" class="pw-post-body-paragraph la lb it lc b ld nw ju lf lg nx jx li lj ny ll lm ln nz lp lq lr oa lt lu lv im bi translated">使用 AML SDK 注册数据库—</p><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="4328" class="nk kj it og b gy ok ol l om on">from azureml.core import Workspace, Datastore<br/>ws = Workspace.from_config()</span><span id="f507" class="nk kj it og b gy op ol l om on"><strong class="og iu"># Register a new datastore</strong><br/>blob_ds = Datastore.register_azure_blob_container(workspace=ws,<br/>    datastore_name='blob_data',<br/>    container_name='data_container',<br/>    account_name='az_store_acct',<br/>    account_key='11223312345cadas6abcde789…')</span></pre><p id="5c0b" class="pw-post-body-paragraph la lb it lc b ld nw ju lf lg nx jx li lj ny ll lm ln nz lp lq lr oa lt lu lv im bi translated">要设置或更改默认数据存储—</p><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="28b9" class="nk kj it og b gy ok ol l om on">ws.set_default_datastore('blob_data')</span></pre><figure class="ob oc od oe gt mn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/d14239eb5b1e83efaf1ad6d1a7ff89cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*auLLMvkfdyDguw1zWJRucg.png"/></div><p class="mu mv gj gh gi mw mx bd b be z dk translated">从 Azure ML 查看—数据存储</p></figure><h2 id="3111" class="nk kj it bd kk nl nm dn ko nn no dp ks lj np nq ku ln nr ns kw lr nt nu ky nv bi translated">将文件上传到数据存储</h2><p id="7858" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">将本地文件从本地系统上传到远程数据存储。这允许使用远程数据位置直接运行实验。<em class="oo">目标路径</em>是文件在远程数据存储位置的路径。一旦文件上传到数据存储，就会返回<em class="oo">‘引用路径’</em>。当您想要在实验脚本中使用数据存储时，我们必须向脚本传递一个数据引用</p><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="0540" class="nk kj it og b gy ok ol l om on">default_ds.upload_files(files=['../input/iris-flower-dataset/IRIS.csv'],<strong class="og iu">target_path</strong>='flower_data/',overwrite=True, show_progress=True)</span><span id="588c" class="nk kj it og b gy op ol l om on"><strong class="og iu">flower_data_ref</strong> = default_ds.path('flower_data').as_download('ex_flower_data')<br/>print('<strong class="og iu">reference_path </strong>= ',flower_data_ref)</span></pre><h2 id="f4eb" class="nk kj it bd kk nl nm dn ko nn no dp ks lj np nq ku ln nr ns kw lr nt nu ky nv bi translated">尝试数据存储</h2><p id="f7f1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如上所述，一旦我们有了对数据存储的引用，我们需要将这个引用传递给一个实验脚本，作为来自估计器的脚本参数。此后，可以检索该参数的值，然后将其用作本地文件夹—</p><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="1272" class="nk kj it og b gy ok ol l om on">####</span><span id="7911" class="nk kj it og b gy op ol l om on">run = Run.get_context()</span><span id="2e4a" class="nk kj it og b gy op ol l om on"><em class="oo">#define the regularization parameter for the logistic regression.</em><br/>parser = argparse.ArgumentParser()<br/>parser.add_argument('--reg_rate', type=float, dest='reg', default=0.01)</span><span id="aef4" class="nk kj it og b gy op ol l om on"><strong class="og iu"><em class="oo">#define the data_folder parameter for referencing the path of the registerd datafolder.</em></strong><br/>parser.add_argument('--data_folder', type=str, dest='data_folder', help='Data folder reference', default=0.01)<br/>args=parser.parse_args()<br/>r = args.reg<br/>ex_data_folder = <strong class="og iu">args.data_folder</strong></span><span id="a4c7" class="nk kj it og b gy op ol l om on">####</span></pre><p id="40f2" class="pw-post-body-paragraph la lb it lc b ld nw ju lf lg nx jx li lj ny ll lm ln nz lp lq lr oa lt lu lv im bi translated">将估计值定义为—</p><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="d15d" class="nk kj it og b gy ok ol l om on">####</span><span id="6e58" class="nk kj it og b gy op ol l om on">run = Run.get_context()</span><span id="9538" class="nk kj it og b gy op ol l om on">estimator = SKLearn(source_directory=experiment_folder,<br/>                      entry_script='iris_simple_experiment.py',<br/>                      compute_target='local',<br/>                      use_docker=False,<br/>                      script_params = {'--reg_rate': 0.07, <br/>                                  '--<strong class="og iu">data_folder':flower_data_ref</strong>} <br/>                              <em class="oo"># a</em><strong class="og iu"><em class="oo">ssigned reference path value as   defined above.</em></strong><br/>                  )</span><span id="22b8" class="nk kj it og b gy op ol l om on">####</span></pre><blockquote class="or os ot"><p id="baf9" class="la lb oo lc b ld nw ju lf lg nx jx li ou ny ll lm ov nz lp lq ow oa lt lu lv im bi translated"><em class="it"> ' —数据文件夹'</em>接受数据存储文件夹引用；上传文件的路径。该脚本将从作为参数传递给它的数据引用中加载训练数据，因此我们需要设置脚本参数来传递文件引用以运行实验。</p></blockquote></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h2 id="c93d" class="nk kj it bd kk nl nm dn ko nn no dp ks lj np nq ku ln nr ns kw lr nt nu ky nv bi translated">数据集</h2><p id="fa52" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">数据集是打包的数据对象，易于机器学习管道使用。这是处理数据的推荐方式。帮助启用数据标注、版本控制和漂移监控(将在后续帖子中讨论)。数据集是根据已经存储在“数据存储”中的数据的位置定义的</p><p id="7962" class="pw-post-body-paragraph la lb it lc b ld nw ju lf lg nx jx li lj ny ll lm ln nz lp lq lr oa lt lu lv im bi translated"><strong class="lc iu">数据集类型</strong> —我们可以创建两种数据集</p><ul class=""><li id="e02f" class="ox oy it lc b ld nw lg nx lj oz ln pa lr pb lv pc pd pe pf bi translated"><em class="oo">表格:</em>一种结构化的数据形式，主要从数据存储中导入的表、CSV、RDBMS 等中读取。示例—回归问题的数据框架。</li><li id="1842" class="ox oy it lc b ld pg lg ph lj pi ln pj lr pk lv pc pd pe pf bi translated"><em class="oo"> File: </em>这是针对非结构化数据类型的，文件路径列表可以通过数据存储使用。一个示例用例是读取图像来训练 CNN。</li></ul><h2 id="3908" class="nk kj it bd kk nl nm dn ko nn no dp ks lj np nq ku ln nr ns kw lr nt nu ky nv bi translated">创建数据集</h2><p id="e509" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">数据集首先从数据存储区创建，并且需要注册。以下示例显示了表格和文件数据集的创建。</p><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="5a61" class="nk kj it og b gy ok ol l om on"><em class="oo"># </em><strong class="og iu"><em class="oo">Creating tabular dataset </em></strong><em class="oo">from files in datastore.</em><br/>tab_dataset = Dataset.Tabular.from_delimited_files(path=(default_ds,'flower_data/*.csv'))</span><span id="038c" class="nk kj it og b gy op ol l om on">tab_dataset.take(10).to_pandas_dataframe()</span><span id="6e4b" class="nk kj it og b gy op ol l om on"><em class="oo"># similarly,</em><strong class="og iu"><em class="oo"> creating files dataset from the files</em></strong><em class="oo"> already in the datastore. Useful in scenarios like image processing in deeplearning.</em></span><span id="722d" class="nk kj it og b gy op ol l om on">file_dataset = Dataset.File.from_files(path=(default_ds,'flower_data/*.csv'))</span><span id="a3cb" class="nk kj it og b gy op ol l om on">for fp <strong class="og iu">in</strong> file_dataset.to_path():<br/>    print(fp)</span></pre><h2 id="c927" class="nk kj it bd kk nl nm dn ko nn no dp ks lj np nq ku ln nr ns kw lr nt nu ky nv bi translated">注册数据集</h2><p id="2129" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">定义数据集后，需要将其附加到 AML 工作区。此外，还附加了元数据，如数据集的名称、描述、标签和版本。数据集的版本化允许我们跟踪实验所基于的数据集。如果我们想要在任何特定的版本上训练模型，版本控制也是有用的。以下是注册表格和文件数据集的方法:</p><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="cb6c" class="nk kj it og b gy ok ol l om on"><strong class="og iu"><em class="oo"># register tabular dataset</em></strong><br/>tab_dataset = tab_dataset.register(workspace=ws, name='flower tab ds', description='Iris flower Dataset in tabular format', tags={'format':'CSV'}, create_new_version=True)<br/><strong class="og iu"><em class="oo">#register File Dataset</em></strong><br/>file_dataset = file_dataset.register(workspace=ws, name='flower Files ds', description='Iris flower Dataset in Files format', tags={'format':'CSV'}, create_new_version=True)</span></pre><figure class="ob oc od oe gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi pl"><img src="../Images/3bf88e74fad59c36e37011c8d8bb1053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RN1D2nhAYhOC3WQkPK-2qg.png"/></div></div><p class="mu mv gj gh gi mw mx bd b be z dk translated">Azure 机器学习服务中注册的数据集</p></figure><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="c2af" class="nk kj it og b gy ok ol l om on">print("Datasets Versions:")<br/>for dataset_name <strong class="og iu">in</strong> list(ws.datasets.keys()):<br/>    dataset = Dataset.get_by_name(ws, dataset_name)<br/>    print("<strong class="og iu">\t</strong>", dataset.name, 'version', dataset.version)</span><span id="2214" class="nk kj it og b gy op ol l om on"><strong class="og iu">Output &gt;&gt;</strong><br/>Datasets Versions:<br/>	 flower Files ds version 1<br/>	 flower tab ds version 1</span></pre><h2 id="e899" class="nk kj it bd kk nl nm dn ko nn no dp ks lj np nq ku ln nr ns kw lr nt nu ky nv bi translated">用数据集做实验</h2><ul class=""><li id="fdc1" class="ox oy it lc b ld le lg lh lj pm ln pn lr po lv pc pd pe pf bi translated">在训练分类模型的训练脚本中，<strong class="lc iu">表格数据集</strong>作为<strong class="lc iu">输入</strong>传递给分类模型，方法是将数据集读取为熊猫数据帧</li></ul><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="70ae" class="nk kj it og b gy ok ol l om on">data = run.input_datasets['flower_ds'].to_pandas_dataframe()</span></pre><ul class=""><li id="ac8c" class="ox oy it lc b ld nw lg nx lj oz ln pa lr pb lv pc pd pe pf bi translated">使用<strong class="lc iu"> SKLearn 估算器</strong>的<strong class="lc iu">输入</strong>参数传递注册的数据集，该数据集将由训练脚本使用。</li></ul><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="0a63" class="nk kj it og b gy ok ol l om on">inputs=[tab_dataset.as_named_input(‘flower_ds’)]</span></pre><ul class=""><li id="0834" class="ox oy it lc b ld nw lg nx lj oz ln pa lr pb lv pc pd pe pf bi translated">此外，使用<em class="oo"> pip_packages </em>附加参数使运行时环境能够提供支持 AML pandas 操作所需的包。由于脚本将需要使用一个<strong class="lc iu">数据集</strong>对象，你必须在脚本的计算环境中包含完整的<strong class="lc iu"> azureml-sdk </strong>包或<strong class="lc iu"> azureml-dataprep </strong>包以及 P <strong class="lc iu">和 as </strong>额外的库。</li></ul><pre class="ob oc od oe gt of og oh oi aw oj bi"><span id="d95f" class="nk kj it og b gy ok ol l om on">pip_packages=[‘azureml-dataprep[pandas]’]</span></pre></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="ddfb" class="ki kj it bd kk kl nf kn ko kp ng kr ks jz nh ka ku kc ni kd kw kf nj kg ky kz bi translated">结论</h1><p id="ec0d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在此，我们介绍了 AML 服务的一个最重要的方面，即模型和实验的数据管理。数据是任何机器学习工作负载中的基本元素，因此，在这里我们学习了如何在 Azure 机器学习工作区中创建和管理<em class="oo">数据存储库</em>和<em class="oo">数据集</em>，以及如何在模型训练实验中使用它们。</p><h1 id="c5d7" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">接下来呢？</h1><p id="b13c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这是一系列博客帖子，包含各种 Azure 机器学习功能的详细概述，其他帖子的 URL 如下:</p><ul class=""><li id="9f3b" class="ox oy it lc b ld nw lg nx lj oz ln pa lr pb lv pc pd pe pf bi translated">帖子 1: <a class="ae mg" rel="noopener" target="_blank" href="/azure-machine-learning-service-part-1-an-introduction-739620d1127b"> Azure 机器学习服务:第一部分——简介</a></li><li id="fc6b" class="ox oy it lc b ld pg lg ph lj pi ln pj lr pk lv pc pd pe pf bi translated">帖子 2: <a class="ae mg" rel="noopener" target="_blank" href="/azure-machine-learning-service-run-python-script-experiment-1a9b2fc1b550"> Azure 机器学习服务——运行一个简单的实验</a></li><li id="e57d" class="ox oy it lc b ld pg lg ph lj pi ln pj lr pk lv pc pd pe pf bi translated">帖子 3: <a class="ae mg" rel="noopener" target="_blank" href="/azure-machine-learning-service-train-a-model-df72c6b5dc"> Azure 机器学习服务——训练一个模型</a></li><li id="d36d" class="ox oy it lc b ld pg lg ph lj pi ln pj lr pk lv pc pd pe pf bi translated">岗位 4 <em class="oo">(这个)</em> : <a class="ae mg" rel="noopener" target="_blank" href="/azure-machine-learning-service-where-is-my-data-pjainani-86a77b93ab52"> Azure 机器学习服务——我的数据在哪里？</a></li><li id="7d90" class="ox oy it lc b ld pg lg ph lj pi ln pj lr pk lv pc pd pe pf bi translated">帖子 5: <a class="ae mg" rel="noopener" target="_blank" href="/azure-machine-learning-service-what-is-the-target-environment-cb45d43530f2"> Azure 机器学习服务——目标环境是什么？</a></li></ul><h2 id="472f" class="nk kj it bd kk nl nm dn ko nn no dp ks lj np nq ku ln nr ns kw lr nt nu ky nv bi translated">参考</h2><p id="c545" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">[1]笔记本&amp;代码— <a class="ae mg" href="https://www.kaggle.com/pankaj1234/azure-machine-learning-working-with-data" rel="noopener ugc nofollow" target="_blank"> Azure 机器学习—处理数据</a>，Kaggle。<br/>【2】Azure ML 服务，<a class="ae mg" href="https://aka.ms/AA70zfl" rel="noopener ugc nofollow" target="_blank">数据参考指南</a>，官方文档，微软 Azure。<br/>【3】<a class="ae mg" href="https://docs.microsoft.com/en-in/azure/machine-learning/" rel="noopener ugc nofollow" target="_blank">Azure 机器学习服务</a>官方文档，微软 Azure。</p></div></div>    
</body>
</html>