<html>
<head>
<title>How to manipulate &amp; visualize data for comparative analysis—Crunch time in the NBA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何操纵和可视化数据以进行比较分析NBA的关键时刻</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-manipulate-visualize-data-for-comparative-analysis-crunch-time-in-the-nba-f20540e23b54?source=collection_archive---------16-----------------------#2020-02-12">https://towardsdatascience.com/how-to-manipulate-visualize-data-for-comparative-analysis-crunch-time-in-the-nba-f20540e23b54?source=collection_archive---------16-----------------------#2020-02-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="80f7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python和Pandas和Plotly对数据进行切片、分组和可视化，以获得新的见解(代码和数据在我的<a class="ae ki" href="https://gitlab.com/jphwang/online_articles" rel="noopener ugc nofollow" target="_blank"> GitLab repo </a>中)。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/9a3bc017a6b29f01d52b00cc86aa5d64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BExiZQIeRO2i1boFGu-yQA.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated"><a class="ae ki" href="https://unsplash.com/@jdent?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Jason Dent </a>在<a class="ae ki" href="https://unsplash.com/s/photos/comparison?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的原始照片</p></figure><p id="a5c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我演示了如何操作和可视化数据以获得比较性的洞察力。我从一个数据集开始分析，将对其进行分析以找到合适的分割，并找到与剩余数据进行比较的最佳子集。</p><p id="74af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，这篇文章着眼于上个赛季的NBA数据，以了解接近，比赛后期的情况。有些人喜欢林格氏<a class="ae ki" href="https://twitter.com/BillSimmons" rel="noopener ugc nofollow" target="_blank">比尔·西蒙斯</a>称之为“关键时刻”。</p><p id="445a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用数据来了解这些高风险时刻的更多信息。真正的关键时刻是什么时候？这期间的游戏玩法有什么不同吗？这里采用了什么样的策略？</p><p id="5f0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和往常一样，本文的重点将是适用于您自己的领域和数据的数据分析，而不是特定于篮球的输出。</p><p id="767a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们走吧。</p><h1 id="eda9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在开始之前</h1><h2 id="deca" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">数据和代码</h2><p id="857c" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">我在我的<a class="ae ki" href="https://gitlab.com/jphwang/online_articles" rel="noopener ugc nofollow" target="_blank"> GitLab repo here </a>(在<strong class="lb iu"> basketball_crunchtime </strong>目录中)中包含了这方面的数据和代码，所以请随意下载并使用它/改进它。</p><h2 id="12dc" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">包装</h2><p id="290c" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">我假设您熟悉python。即使你相对较新，这个教程也不应该太难。</p><p id="13c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你需要<code class="fe ne nf ng nh b">pandas</code>和<code class="fe ne nf ng nh b">plotly</code>。用一个简单的<code class="fe ne nf ng nh b">pip install [PACKAGE_NAME]</code>安装每一个(在你的虚拟环境中)。</p><h1 id="9d88" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建“关键时刻”数据</h1><p id="e484" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">这里的假设很简单。在篮球运动中，有些情况会得到不同的对待，会得到球员和教练更多的努力和关注。让我们称之为“关键时刻”，看看数据是否显示出它与游戏其余部分之间的任何差异和模式。</p><p id="e47f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的数据集包括2018-19赛季的详细数据。正如你可能想象的那样，在我可以过滤的数据中没有'<em class="ni"> crunch time </em>'特性。但根据我们的直觉，关键时刻数据与剩余时间有限且分数差异较小的时期相关似乎是合理的。</p><p id="1685" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将研究这些数据，看看选择关键时间子集的合理标准是什么。</p><h2 id="5c1c" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">在熊猫中创建新栏</h2><p id="f360" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">现有数据集不包括剩余时间或得分差异的要素，但它包括这些要素的基础数据。</p><p id="fe07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Pandas中创建新列有多种方法，但我更喜欢使用<code class="fe ne nf ng nh b">.assign</code>方法，因为它<a class="ae ki" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.assign.html" rel="noopener ugc nofollow" target="_blank">返回一个全新的对象</a>。这有助于避免操作错误对象的麻烦。</p><p id="a0f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集特征包括<code class="fe ne nf ng nh b">period</code>，共4分钟，以及每个时间段的<code class="fe ne nf ng nh b">elapsed</code>时间(共12分钟)。<code class="fe ne nf ng nh b">period</code>数据是整数，<code class="fe ne nf ng nh b">elapsed</code>时间是字符串，所以我们想把它们转换成一致的时间单位。</p><p id="85fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ne nf ng nh b">Pandas</code>有一个<code class="fe ne nf ng nh b">timedelta</code>函数可以方便地将字符串转换为时间，而<code class="fe ne nf ng nh b">timedelta64</code>函数<code class="fe ne nf ng nh b">numpy</code>可以将时间转换为秒，所以将它们相加就可以得出游戏所用的总时间。</p><p id="6acc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们也为当前得分差异创建一个新列:</p><pre class="kk kl km kn gt nj nh nk nl aw nm bi"><span id="40ae" class="mn lw it nh b gy nn no l np nq">shots_df = shots_df.assign(tot_time=(shots_df.period-1)*np.timedelta64(60*12, 's') + pd.to_timedelta(shots_df.elapsed, unit='s'))<br/>shots_df = shots_df.assign(score_diff=abs(shots_df.home_score-shots_df.away_score))</span></pre><p id="c622" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以前<code class="fe ne nf ng nh b">max(shots_df.elapsed)</code>给<code class="fe ne nf ng nh b">‘0:12:00'</code>，现在<code class="fe ne nf ng nh b">max(shots_df.tot_time)</code>给<code class="fe ne nf ng nh b">Timedelta(‘0 days 00:48:00’)</code>。<em class="ni">(我暂时排除了超时)</em></p><h2 id="725f" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">过滤数据</h2><p id="3463" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">这些新列现在可以用来过滤我们的数据集。我们将使用它们来生成一些潜在的关键时间子集进行比较。</p><p id="9afa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我想看看镜头的分布是否会改变。在之前的一篇文章中，我们把球场分成了不同的区域，就像这样:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nr"><img src="../Images/bd58570b721f5bdc58a4dd183369ca16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZGsING4TeW4BqvcioPigg.png"/></div></div></figure><p id="0414" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个镜头都有一个特征编码，记录它来自这7个区域中的哪一个。</p><p id="cba8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拍摄位置的改变可能和精度的改变一样有意义。实际上，情况可能更是如此，因为数据可能没有射击精度那么“嘈杂”。</p><p id="835c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，让我们捕捉这些区域的拍摄分布是否发生了变化，将每个区域的拍摄精度/频率等统计数据添加到我们的数据帧中。</p><p id="8b09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了评估各种时间和分数阈值的效果，我构建了一个具有各种时间和分数阈值的嵌套循环，并使用pandas根据循环中的这些值过滤数据帧:</p><pre class="kk kl km kn gt nj nh nk nl aw nm bi"><span id="5cf0" class="mn lw it nh b gy nn no l np nq">for time_thresh in [12, 10, 8, 6, 4, 2]:<br/>    for score_thresh in [2, 4, 6, 8, 10]:<br/>        filt_shots_df = shots_df[<br/>            (shots_df.tot_time &gt; np.timedelta64(60*(48-time_thresh), 's'))<br/>            &amp; (shots_df.score_diff &lt;= score_thresh)<br/>        ]</span></pre><p id="3a3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个统计数据也是作为与整体数据相比较的相对值被捕获的，因为我们希望在关键时刻捕获游戏的<em class="ni">变化</em>。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="51b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不确定如何使用？groupby methods with dataframes，<a class="ae ki" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html" rel="noopener ugc nofollow" target="_blank">这里是文档</a>。</p><p id="7856" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这给了我们一个可行的数据框架进行比较，我们已经准备好开始研究我们的数据集。</p><h1 id="5c9c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">可视化“关键时刻”数据</h1><h2 id="b858" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">健全性检查—样本大小</h2><p id="8b9f" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">每当我处理数据的子集时，我都希望警惕引入随机错误，或无意识的偏差，这可能会导致我得出错误的结论。</p><p id="8beb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，让我们快速看一下分布情况，以了解每场比赛在每个分数差异范围内花费了多少。</p><p id="8803" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的数据库包含整个NBA赛季大约217，000张照片。粗略估计，每分钟包含4500个镜头。将这些绘制成直方图:</p><pre class="kk kl km kn gt nj nh nk nl aw nm bi"><span id="c44a" class="mn lw it nh b gy nn no l np nq">import plotly.express as px<br/>fig = px.histogram(shots_df, x='score_diff', nbins=40, histnorm='probability density', range_y=[0, 0.09])<br/>fig.update_layout(<br/>    title_text='Score differences in an NBA game',<br/>    paper_bgcolor="white",<br/>    plot_bgcolor="white",<br/>    xaxis_title_text='Score difference', # xaxis label<br/>    yaxis_title_text='Probability', # yaxis label<br/>    bargap=0.2,  # gap between bars of adjacent location coordinates<br/>)<br/>fig.show()</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nu"><img src="../Images/65ecd68bc6d824700276e2570baf560c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ISEqmGwInLefJ-w2O1lhLw.png"/></div></div></figure><p id="b181" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，在最后的6分钟里:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nu"><img src="../Images/1fa8167d3ae5a549196fd4463267ed6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7vd7j9DLNNtBlfhYwjC80g.png"/></div></div></figure><p id="c867" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使在最后6分钟，NBA比赛也有约4.5%的比分在1分以内，约10%在3分以内。</p><p id="c26d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在超过215，000张照片的基础上，获得这些子集似乎是合理的，但这是值得关注的事情，特别是当子集是基于时间和分数导出的。</p><h2 id="d50e" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">识别关键时刻</h2><p id="1351" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">我们有两个感兴趣的变量，剩余游戏时间(<code class="fe ne nf ng nh b">time_thresh</code>)和得分差(<code class="fe ne nf ng nh b">score_thresh</code>)。我们还有拍摄区域的变量(<code class="fe ne nf ng nh b">zone_name</code>)。有三个变量要考虑，这对于气泡图来说是完美的，一个变量沿着x轴，另一个是颜色，第三个是支线剧情。</p><p id="aeec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这段代码，我们创建了一个这样的气泡图:</p><pre class="kk kl km kn gt nj nh nk nl aw nm bi"><span id="d48b" class="mn lw it nh b gy nn no l np nq">fig = px.scatter(<br/>    summary_df, x='score_thresh', y='rel_shots_freq', color='time_thresh', size='filt_shots_freq',<br/>    facet_col='zone_name', hover_data=['filt_shots_taken'])<br/>fig.show()</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nv"><img src="../Images/5ce1afc520f3535e7645b5407a9a9a12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GVn1GP2uR4m-DMYxYjTLeQ.png"/></div></div></figure><p id="f3dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">支线剧情/颜色系列可以像这样翻转，产生:</p><pre class="kk kl km kn gt nj nh nk nl aw nm bi"><span id="bf56" class="mn lw it nh b gy nn no l np nq">fig = px.scatter(<br/>    summary_df, x='time_thresh', y='rel_shots_freq', color='score_thresh', size='filt_shots_freq',<br/>    facet_col='zone_name', hover_data=['filt_shots_taken'])<br/>fig.show()</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nv"><img src="../Images/a9f4f8df52a320712289de557edffe13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ILgKck7p6mLQF59lWYwiyA.png"/></div></div></figure><p id="b372" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些图已经告诉我们很多。</p><p id="9d4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们告诉我们，在比赛后期，三分球投得比比赛其他时间多得多。这随着分数差距的增加而增加(即，团队冒更大的风险来追赶)。</p><p id="86ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ki" href="https://fansided.com/2014/11/01/geometry-distance-corner-3s/" rel="noopener ugc nofollow" target="_blank">现代分析指出，最好的投篮来自靠近篮筐和角落的3s </a>，而这里的数据显示，这些投篮变得越来越难。据推测，这是由于防守投入了更多的努力，特别是在比赛的后期，当比分接近时(看看紫色的&lt; 2分比赛数据)。</p><p id="33ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仔细观察底部的情节也可以发现，在大多数次要情节中，大约在8分钟或6分钟处有一个拐点。这一点在第一个支线剧情(4英尺以内)和第五个(短3s)中表现得最为明显。</p><p id="e435" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看射击精度。它告诉我们一个相似的故事吗？</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nw"><img src="../Images/c5ef6ecc48c3eab15524546eb3fcbce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Us32xCzTE2F4B-j3eaQcMA.png"/></div></div></figure><p id="2d7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好像是这样的！随着得分差距的增加，在近距离投篮时，准确性往往会增加，而在远距离投篮时，准确性会降低。这可能是因为领先的球队对三分球保持警惕，以防止他们的对手迅速追上来，而落后的球队更经常从远距离射门。上图中显示的频率证实了这一点。</p><p id="e1a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，这些支线剧情中的许多都表明在游戏还剩6分钟的时候发生了一些变化。这似乎是一个很好的门槛。</p><p id="e689" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分数呢？当我们从越来越大的分数差距中观察数据时，虽然对数据的影响是渐进的，但我的观察是，分数在2分以内的情况下的数据点在大多数这些支线剧情中脱颖而出。(自己看看，如果你不同意，请告诉我。)</p><p id="70bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">所以让我们采用关键时刻的定义，即剩余时间为6分钟或更少，得分在2分以内。</strong></p><h2 id="003c" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">紧缩时间vs常规(平稳？)时间</h2><p id="0d7d" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">既然我们已经为crunch time设置了参数，我们可以创建一个新列来区分这两个数据集。</p><pre class="kk kl km kn gt nj nh nk nl aw nm bi"><span id="9ffb" class="mn lw it nh b gy nn no l np nq">shots_df = shots_df.assign(<br/>    crunchtime=(shots_df.tot_time &gt; np.timedelta64(60*(48-6), 's'))<br/>               &amp; (shots_df.score_diff &lt;= 2))</span></pre><p id="51cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ne nf ng nh b">crunch_df</code>包含3886个镜头，没什么可轻视的。(但我们可能不希望变得更小。)</p><p id="76cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们基于这个属性来比较两个数据集。现在，只需围绕<code class="fe ne nf ng nh b">crunchtime</code>变量的布尔值构建数据，即可轻松实现这一点:</p><pre class="kk kl km kn gt nj nh nk nl aw nm bi"><span id="dcd6" class="mn lw it nh b gy nn no l np nq">for crunch_bool in [True, False]:<br/>    filt_shots_df = shots_df[shots_df.crunchtime == crunch_bool]</span></pre><p id="8416" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或全部:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="c882" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果很有意思。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/5e988197e35874b9871005428c0b5699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmAl30Ko1YabBhM-OkLjbA.png"/></div></div></figure><p id="522a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然比赛很接近，但球队没有采取极端的策略(例如更多的三分球)。但是很明显，想要在1区、4区和5区拍出理想的照片是很难的。或许我们应该看看相对于整体平均值的百分比:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ny"><img src="../Images/f3fbd6db57caaaa9f446d14f8a24a2a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h-xewcFSCkE5Bk1N7pfZCQ.png"/></div></div></figure><p id="4db9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很明显，防守队员的额外努力迫使球队在效率低的位置(2，3，6和7)投篮更多，而在好的位置(1，4和5)投篮更少。虽然这可能只是数据中的噪声，但下降来自已知的理想拍摄区域这一事实使我怀疑这一点。</p><p id="9963" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看拍摄的准确性，画面变得更加有趣。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/095649a23df9c1f35ba8c261131ecc38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RBlomtQF8_1zTc0QYZiPig.png"/></div></div></figure><p id="f605" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在比赛的最后6分钟，当比分接近时，在越过三分线之前，投篮命中率会全面下降，从而变得更加准确<em class="ni">长距离</em>。这令人困惑，但是有一些潜在的解释。</p><p id="fb94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个是<em class="ni">选择偏差</em>，在团队中最优秀的球员这个时候得到这些镜头。另一个是与博弈论相关的，因为防守可能会在某种程度上鼓励球队采取这些相对较低比例的投篮(在正常情况下)。</p><p id="f826" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管如此，研究这些数据的团队会说，进行长时间的三分可能是一个令人惊讶的高价值命题。</p><p id="4d24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了总结这一点，让我们使用拍摄图表来更详细地查看数据。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ns nt l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nz"><img src="../Images/b6b0c0da0de63e3d6c28a11a4abc5bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rg5dn8uaLwYnUWrz__m_ew.png"/></div></div></figure><p id="b12f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在三分线内的几乎所有地方，投篮都变得越来越不准确，三分角球变得明显更加困难，这可能是因为防守增加了压力。</p><p id="8eff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我们预计这些数据可能会有点嘈杂，因为只有3886张照片，而不是超过210，000张)，但这里反映了全面的下降。</p><p id="89d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于这个原因，我不会对方向差异做过多解读。给定小样本量，左/右的差异可能只是噪声，而不是趋势的反映。</p><h1 id="1f56" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">总结</h1><p id="fa32" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">我个人发现，尽管现在找到大型数据集相对容易，但它们并不总是包含允许我轻松地对数据进行切片、进行比较或从中得出结论的功能。</p><p id="c7d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，我经常不得不从现有的数据中创建新的特征，并使用我的直觉来评估创建数据子集的适当截止点。</p><p id="3b56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我希望上面的例子对你有用，也可能有趣。</p><p id="bb76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请下载数据和代码，玩一玩，用你自己的数据集构建类似的东西。我很想听听你的经历或评论！</p></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><p id="d454" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这个，比如说👋/在<a class="ae ki" href="https://twitter.com/_jphwang" rel="noopener ugc nofollow" target="_blank"> twitter </a>上关注，或关注更新。我还写了这些关于篮球数据的文章，可能对本文有帮助，如果你以前没看过的话。</p><div class="oh oi gp gr oj ok"><a rel="noopener follow" target="_blank" href="/how-to-visualize-hidden-relationships-in-data-with-python-analysing-nba-assists-e480de59db50"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">如何用Python可视化数据中的隐藏关系NBA助攻分析</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">使用交互式快照、气泡图和桑基图操纵和可视化数据，使用Plotly(代码和数据…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy kt ok"/></div></div></a></div><div class="oh oi gp gr oj ok"><a rel="noopener follow" target="_blank" href="/interactive-basketball-data-visualizations-with-plotly-8c6916aaa59e"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">用Plotly实现交互式篮球数据可视化</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">用hexbin shot图表分析体育数据，用Plotly和Plotly Express分析气泡图(源代码&amp;我自己的数据…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="oz l ov ow ox ot oy kt ok"/></div></div></a></div></div></div>    
</body>
</html>