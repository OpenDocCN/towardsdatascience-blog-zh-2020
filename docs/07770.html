<html>
<head>
<title>Deploy machine learning models safely without needing admin privileges</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无需管理员权限即可安全部署机器学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploy-machine-learning-models-safely-without-needing-admin-privileges-96c8f98e6823?source=collection_archive---------78-----------------------#2020-06-09">https://towardsdatascience.com/deploy-machine-learning-models-safely-without-needing-admin-privileges-96c8f98e6823?source=collection_archive---------78-----------------------#2020-06-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a559" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过诗歌和 Dash 分享您的本地见解</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/145f146931ecf687d5f8ed489adb4a43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iVmR8ozwVF3ecp-J"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@priscilladupreez?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">普里西拉·杜·普里兹</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h1 id="b4db" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">将洞察力转化为行动</h1><p id="f1ab" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">恭喜你！你在工作中牵头的机器学习项目已经完成。你花了几个月的时间与利益相关者讨论业务问题，将业务问题转化为数据问题，获取和探索数据，当你看到数据一团糟时清理数据，<a class="ae ky" rel="noopener" target="_blank" href="/why-you-should-stop-using-the-roc-curve-a46a9adc728">选择合适的指标</a>，并构建和调整机器学习模型，为你带来出色的结果。你完了！</p><p id="cb4c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">除了…你不是为一个科技巨头工作，你的同事不是程序员，你是唯一一个知道如何从你建立的模型中获得预测的人。你可能不想在可预见的未来导出和发送 CSV 文件，但是你绝对不能在面向公众的云服务上建立你的模型和相关的个人身份信息。同样不言而喻的是，您不被信任管理凭证，您不被允许在您的组织的单点登录门户后保护您自己的 web 服务器，并且您没有预算来购买企业解决方案。</p><p id="15d8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您开始这个项目的目标是帮助您的团队成员更高效、更有效、更经济地完成他们的工作，但是他们需要实际使用您构建的东西来实现这些目标。这篇文章将介绍如何将一款<a class="ae ky" href="https://plotly.com/dash/" rel="noopener ugc nofollow" target="_blank"> Dash </a>应用发给你的同事，而不需要管理员证书，以及如何消除摩擦，以便他们可以轻松使用它。</p><h2 id="83e7" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">虚拟环境</h2><p id="cbe0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我使用<a class="ae ky" href="https://python-poetry.org" rel="noopener ugc nofollow" target="_blank">诗歌</a>为我的项目创建虚拟环境和管理依赖关系。它在 Windows 上运行良好，文档也很棒。在其他计算机上安装您的依赖项就像共享您的<code class="fe nf ng nh ni b">pyproject.toml</code>文件一样简单。</p><p id="e607" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">本指南的其余部分假设你也使用诗歌。</p><h2 id="0df6" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">为什么是 Dash？</h2><p id="5c08" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Dash 与 Plotly 相结合，可以轻松创建具有交互式可视化功能的 web 应用程序，以探索和导出机器学习模型的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/b07a0449333ba5e2df7ebe8b7d544fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r59hNjOu3qCXzf53mT5g2A.png"/></div></div></figure><p id="2150" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如，我构建了一个 web 应用程序，允许最终用户控制模型的大量输入并导出结果。用户可以更改:要建模的会计年度、二元分类模型的决策阈值以及最小和最大捐赠/销售阈值。该应用程序还显示人们在<a class="ae ky" href="https://plotly.com/python/scattermapbox/" rel="noopener ugc nofollow" target="_blank">散点图</a>上的位置，并允许最终用户根据地理位置选择要导出的人。每当控制盒中的任何东西发生变化，应用程序中的每个数字都会立即更新。</p><p id="5335" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最终产品使非技术人员可以轻松地从机器学习模型中获得结果，并在自己的工作流程中使用这些结果。</p><p id="a5fe" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如何构建 Dash 应用程序的细节超出了本文的范围，但我会在以后的文章中解释我是如何做的。</p><h1 id="1a14" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">前期投资</h1><p id="248e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">不幸的是，指导您的同事安装 Python 并确保正确设置路径变量的初始时间投资是无法回避的。但是你只需要做这一步一次，我保证这是值得的。</p><h2 id="49a0" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">编写一个批处理脚本来启动应用程序</h2><p id="0881" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">向非技术用户部署 web 应用的一个重要方面是减少产品发布过程中的摩擦。终端用户不想记住启动应用程序所需的命令，坦率地说，他们也不应该记住。令人欣慰的是，通过编写一个带有三行代码的批处理脚本(一个带有后缀<code class="fe nf ng nh ni b">.bat</code>的文件),可以自动启动 Dash 应用程序。将这些命令复制到新的记事本文件中:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="da9b" class="mt la it ni b gy no np l nq nr">@echo off<br/>start <a class="ae ky" href="http://127.0.0.1:8050/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8050/</a><br/>poetry run python path\to\app_script.py</span></pre><p id="520c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">将<code class="fe nf ng nh ni b">path\to\app_script.py</code>替换为从项目根目录到启动 Dash 应用程序的脚本的路径。将该文件保存在项目的根目录下，并将其命名为类似于<code class="fe nf ng nh ni b">dashboard.bat</code>的名称。</p><p id="b616" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该脚本首先在默认 web 浏览器的新选项卡中打开默认 Dash 应用程序 URL，然后运行包含 Dash 应用程序的 Python 脚本。这意味着 web 浏览器会说网站不可用，直到支持 Dash 的 Flask 服务器启动并运行。一旦服务器启动(这可能需要 5-10 秒)，用户应该刷新浏览器来加载应用程序。</p><p id="51cb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">双击刚刚创建的批处理脚本，确保它能够工作。该文件将是您的团队进入应用程序的入口点。</p><h2 id="6eef" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">与同事共享文件</h2><p id="7b92" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这一步有一些灵活性，取决于有多少人在开发应用程序，有多少人在使用应用程序，以及你计划多久更新一次。如果您不是唯一的开发人员，正在与一个大型团队共享，或者需要频繁更新，您可能更喜欢自动化程度更高的方法。</p><p id="b095" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然而，我是唯一的开发人员，我与五个人共享我的 web 应用程序，每年可能不会有超过几次更新。我决定将项目(包括 Python 文件、<a class="ae ky" href="https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html" rel="noopener ugc nofollow" target="_blank">保存的 XGBoost 模型</a>和用于模型的数据文件)复制到 Google Drive 文件夹，尽管任何文件共享服务都可以类似地工作。</p><p id="719e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该文件夹的内容可能如下所示:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="e3e5" class="mt la it ni b gy no np l nq nr">.<br/>├── dashboard.bat<br/>├── glamtk<br/>│   ├── dashboard<br/>│   │   ├── assets<br/>│   │   │   ├── logo.png<br/>│   │   │   └── styles.css<br/>│   │   ├── __init__.py<br/>│   │   ├── app.py<br/>│   │   ├── glossary.py<br/>│   │   ├── index.py<br/>│   │   ├── layout.py<br/>│   │   ├── load_models.py<br/>│   │   └── navbar.py<br/>│   ├── data<br/>│   │   ├── models<br/>│   │   │   ├── churn_xgboost_2014<br/>│   │   │   ├── churn_xgboost_2015<br/>│   │   │   ├── churn_xgboost_2016<br/>│   │   │   ├── churn_xgboost_2017<br/>│   │   │   ├── churn_xgboost_2018<br/>│   │   │   └── churn_xgboost_2019<br/>│   │   ├── processed<br/>│   │   │   ├── features.csv<br/>│   │   │   └── geolocation.csv<br/>│   │   └── raw<br/>│   │       ├── ...<br/>├── pyproject.toml</span></pre><p id="ef87" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">与所有相关人员共享该文件夹，并要求他们下载其中的内容。最好添加一个说明，告诉他们您将很快完成安装😁</p><h2 id="943b" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">安装 Python</h2><p id="6c81" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在 Windows 电脑上安装 Python 和创建虚拟环境曾经是一项耐心(和故障排除)的练习，但自从微软将 Python 添加到微软商店以来，这个过程变得容易多了。</p><ol class=""><li id="523f" class="ns nt it lt b lu mn lx mo ma nu me nv mi nw mm nx ny nz oa bi translated">通过打开开始菜单(按键盘上的 Windows 键)并键入“store”来打开 Microsoft store。</li><li id="250e" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated">在右上角的搜索框中键入“python ”,然后单击 Python 3.8。</li><li id="4109" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated">单击安装。安装时商店会提示你登录，但你<strong class="lt iu">不需要</strong>。关闭提示继续。</li></ol><p id="8511" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Python 现在安装好了！</p><h2 id="52d2" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">装诗</h2><p id="9899" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一旦您的同事安装了诗歌，他们就可以使用您的<code class="fe nf ng nh ni b">pyproject.toml</code>文件下载您的项目所需的所有依赖项。</p><ol class=""><li id="f4d3" class="ns nt it lt b lu mn lx mo ma nu me nv mi nw mm nx ny nz oa bi translated">打开开始菜单，输入“powershell ”,然后按回车键，打开 Powershell。</li><li id="56b6" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated">根据诗歌的网站，复制这个命令，粘贴到 Powershell 中，然后按 enter: <code class="fe nf ng nh ni b">(Invoke-WebRequest -Uri https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py -UseBasicParsing).Content | python</code></li><li id="50d7" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated">安装完成后，关闭 Powershell。打开一个新的命令提示符(开始菜单-&gt;键入“cmd”并按 enter)并输入命令<code class="fe nf ng nh ni b">poetry --version</code>。如果得到类似<code class="fe nf ng nh ni b">Poetry version 1.0.0</code>的结果，那么继续第 7 步。但是，如果命令返回错误，请继续下一步。</li><li id="a31a" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated">打开开始菜单，输入“环境”。这里有两个非常相似的选项:“编辑系统环境变量”和“编辑您的帐户的环境变量”。由于我们没有管理员凭据，请务必为您的帐户选择<strong class="lt iu">编辑环境变量</strong>。(见下图。)</li><li id="02b9" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated">双击用户变量部分中的“路径”，单击新建，并将其粘贴到文本框:<code class="fe nf ng nh ni b">%USERPROFILE%\.poetry\bin</code></li><li id="0f69" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated"><strong class="lt iu">这很重要:</strong>在“编辑环境变量”窗口和“环境变量”窗口中点击确定。如果您没有在两个窗口中都单击 OK，新的 path 变量将不会被保存。</li><li id="b285" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated">通过在命令提示符窗口中输入以下命令来更改 poems 的默认缓存目录:<code class="fe nf ng nh ni b">poetry config cache-dir "%USERPROFILE%\pypoetry\Cache"</code>。</li><li id="51a9" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated">关闭命令提示符窗口。</li></ol><p id="c1ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">诗词现装！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/8cb794960a32f2d147ff7a074e3392a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*zxnSH2ipw_V4WIU5blsSWw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">确保选择正确的环境变量选项！</p></figure><h2 id="471d" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">安装应用程序</h2><p id="514f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">由于您的同事已经下载了您共享的文件，现在是时候安装您的应用程序的依赖项了。</p><ol class=""><li id="0088" class="ns nt it lt b lu mn lx mo ma nu me nv mi nw mm nx ny nz oa bi translated">打开一个新的命令提示窗口，通过键入<code class="fe nf ng nh ni b">mkdir &lt;project&gt;</code>并按 enter 键为应用程序创建一个文件夹，用您的项目名称替换&lt;项目&gt;。因为我的项目叫做 GLAMtk，所以我让我的团队类型为<code class="fe nf ng nh ni b">mkdir glamtk</code>。这个新文件夹将位于每个人的用户文件夹中，用户文件夹位于<code class="fe nf ng nh ni b">C:\Users\&lt;username&gt;</code>。</li><li id="bf4a" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated">解压缩从 Google drive(或其他服务)下载的存档文件夹，并将内容复制到刚刚创建的文件夹中。使用上面的示例文件树，用户可以复制<code class="fe nf ng nh ni b">dashboard.bat</code>、<code class="fe nf ng nh ni b">glamtk</code>文件夹和<code class="fe nf ng nh ni b">pyproject.toml</code>。</li><li id="c830" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated">在命令提示符窗口中，通过键入<code class="fe nf ng nh ni b">cd &lt;project&gt;</code>并按 enter 键打开您在步骤 1 中创建的文件夹。</li><li id="d259" class="ns nt it lt b lu ob lx oc ma od me oe mi of mm nx ny nz oa bi translated">通过键入<code class="fe nf ng nh ni b">poetry install</code>并按 enter 键安装所需的依赖项。这将需要一段时间，取决于您的项目有多少依赖项。</li></ol><p id="9ae3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您的应用程序现在可以使用了！让每个人通过双击<code class="fe nf ng nh ni b">dashboard.bat</code>来检查它是否工作。</p><h1 id="92b6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">未来更新</h1><p id="741e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这种方法允许您轻松地向团队发送更新。只要不引入新的依赖项或更改启动 Dash 应用程序的 Python 脚本，更新应用程序就像用新版本替换项目文件夹一样简单。批处理脚本仍将工作，并且依赖项已经安装。</p><p id="4e1e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您确实更改了 Dash 应用程序的入口点或向您的应用程序添加了依赖项，请遵循上面针对诗歌和/或批处理脚本的相应步骤。</p><h1 id="bbb4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">包扎</h1><p id="fbd1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这篇文章介绍了如何以 Dash 应用程序的形式向 Windows 计算机上的最终用户提供机器学习模型，而无需管理员凭据。</p><p id="e800" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这需要相当大的前期投资，尤其是如果你带领许多人通过 Zoom 的这些步骤，但要考虑到这是对你未来计划和团队效率的投资。最终用户将能够使用你花了很长时间创建的机器学习模型，而你不需要亲自处理每个请求。</p><p id="d55f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">欢迎在下面留下评论——我很乐意听到你使用过的替代部署方法，或者对这篇文章中的任何其他内容的想法。感谢阅读！</p></div></div>    
</body>
</html>