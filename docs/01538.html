<html>
<head>
<title>What can you do with the new ‘Pandas’?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你能用新的“熊猫”做什么？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-can-you-do-with-the-new-pandas-2d24cf8d8b4b?source=collection_archive---------19-----------------------#2020-02-11">https://towardsdatascience.com/what-can-you-do-with-the-new-pandas-2d24cf8d8b4b?source=collection_archive---------19-----------------------#2020-02-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="35f8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">熊猫1.0.0版本出来了。这些更新不仅是Python社区期待已久的，也是整个数据科学社区期待已久的。在这篇文章中，我谈论了我认为在这个版本中很重要的5个主要变化。</h2></div><p id="3f46" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">欢迎发表评论，让我知道您认为重要的其他变化以及数据科学社区如何利用它们。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/a19ff8c7c5f7017d251a7a01db5f8f59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fdZiokZzHRCkoMLgrn0tpw.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">新熊猫<a class="ae lu" href="https://www.chinadaily.com.cn/a/201910/09/WS5d9da7b1a310cf3e3556f80d.html" rel="noopener ugc nofollow" target="_blank">【来源】</a>。</p></figure><h1 id="798d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">但是，熊猫是什么？</strong></h1><p id="050c" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">Pandas是Python中数据分析使用最多的库。它的框架结构和方法使得来自所有起步背景的数据分析师更容易入门数据科学。这是一个灵活、强大且易于使用的工具。</p><p id="96bf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们开始吧，好吗？👌</p><p id="46c1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> a)使用Numba让熊猫跑得更快</strong></p><p id="afbd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">什么是Numba？它是一个开源的实时(JIT)编译器，将Python和Numpy代码翻译成更快的机器翻译代码。换句话说，它可以帮助在多个CPU内核上执行Numpy表达式。</p><p id="d424" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="ms"> apply() </em> </strong>函数可以通过将引擎关键字指定为‘Numba’来利用Numba。这使得对大型数据集(100万行或更大)执行函数变得更加容易。</p><p id="1902" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于此功能，Numba库应该有版本<strong class="kk iu"> 0.46.0或更高版本。</strong></p><pre class="lf lg lh li gt mt mu mv mw aw mx bi"><span id="2e9b" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu">In [1]: data = pd.Series(range(1000))</strong></span><span id="67c0" class="my lw it mu b gy nd na l nb nc"><strong class="mu iu">In [2]: roll = data.rolling(10)</strong></span><span id="c43d" class="my lw it mu b gy nd na l nb nc"><strong class="mu iu">In [3]: %timeit -r 1 -n 1 roll.apply(lambda x: np.sum(x), engine='numba',  raw=True)<br/></strong>1.15 s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</span><span id="c265" class="my lw it mu b gy nd na l nb nc"><strong class="mu iu">## Function is cached when you run the second time - so faster<br/>In [4]: %timeit roll.apply(lambda x: np.sum(x), engine='numba', raw=True)<br/></strong>368 ms ± 3.65 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span></pre><p id="6706" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> b)一种“专用”管柱类型</strong></p><p id="1b81" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在以前版本的Pandas中，字符串存储在<em class="ms"> object </em> numpy数组中。在新版本中，增加了一个专用于字符串数据的类型— <code class="fe ne nf ng mu b">StringDType</code>。这解决了许多问题，例如:</p><ol class=""><li id="0aa5" class="nh ni it kk b kl km ko kp kr nj kv nk kz nl ld nm nn no np bi translated">它消除了包含字符串和非字符串的混合型数组的混乱</li><li id="9cee" class="nh ni it kk b kl nq ko nr kr ns kv nt kz nu ld nm nn no np bi translated">它帮助我们执行只针对字符串的函数。</li></ol><p id="41f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了使用这个功能，我们可以显式地将<strong class="kk iu">类型</strong>设置为<code class="fe ne nf ng mu b">string</code>。</p><pre class="lf lg lh li gt mt mu mv mw aw mx bi"><span id="3d0d" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu"># Can also string type using `pd.StringDType()` <br/>In [1]: x = pd.Series(['name', None, 'class'], dtype='string')</strong></span><span id="674d" class="my lw it mu b gy nd na l nb nc"><strong class="mu iu">In [2]: x<br/></strong>0     name<br/>1    &lt;NA&gt;<br/>2     class<br/>dtype: string</span></pre><p id="44e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> c)一个‘专用’布尔类型</strong></p><p id="a311" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在以前版本的Pandas中，布尔数组只能保存<code class="fe ne nf ng mu b">True</code>或<code class="fe ne nf ng mu b">False</code>值。丢失的数据无法合并到这些数组中。现在创建了一个专门用于布尔类型的新类型— <code class="fe ne nf ng mu b">BooleanDType</code>，它可以保存缺失值。已经为缺少的值创建了一个新的掩码。</p><p id="ac48" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这对于数据分析师来说很重要，因为他们总是在处理缺失值，使用这种类型会使数据集更加明确。</p><pre class="lf lg lh li gt mt mu mv mw aw mx bi"><span id="6b96" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu"># Can also string type using `pd.BooleanDType()` <br/>In [1]: x = pd.Series([True, None, False], dtype='boolean')</strong></span><span id="dab1" class="my lw it mu b gy nd na l nb nc"><strong class="mu iu">In [2]: x<br/></strong>0     True<br/>1    &lt;NA&gt;<br/>2     False<br/>dtype: boolean</span></pre><p id="9dd0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> d)处理</strong> <code class="fe ne nf ng mu b"><strong class="kk iu">parquet</strong></code> <strong class="kk iu">文件变得更加容易</strong></p><p id="ceaa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于那些一直在使用PySpark的人来说，有时数据分析师会在Spark中处理数据，并将其保存为一个Parquet文件。然后，他们喜欢在拼花地板上用熊猫来做不那么“繁重”的工作。但是如果parquet文件有一个用户定义的模式，Pandas中以前的版本会抛出一个错误，指出它不能集成Pandas中的模式。</p><p id="cfc3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在新版本中，Pandas处理用户定义模式的模式参数。<code class="fe ne nf ng mu b">schema</code>现在与<em class="ms"> pyarrow </em>引擎一起处理模式参数。</p><pre class="lf lg lh li gt mt mu mv mw aw mx bi"><span id="f21f" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu">In [1]: </strong>import pyarrow as pa ## pyspark engine import</span><span id="11c5" class="my lw it mu b gy nd na l nb nc"><strong class="mu iu">In [2]: x = pd.DataFrame({'a': list('abc'), 'b': list(range(1, 4))})</strong></span><span id="8965" class="my lw it mu b gy nd na l nb nc"><strong class="mu iu">In [3]:</strong> <strong class="mu iu">schema = pa.schema([('a', pa.string()), ('b', pa.int64())])</strong></span><span id="8806" class="my lw it mu b gy nd na l nb nc"><strong class="mu iu"># Can also be used for `read_parquet` as well<br/>In [4]: x.to_parquet('test.parquet', schema=schema)</strong></span></pre><p id="64b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> e)要降价的桌子！</strong></p><p id="5804" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当你训练了一个模型或者对数据做了一些分析之后，你就可以生成表格(用于结果)。这些表格需要以markdown或latex的形式填写——在工作过程中或工作后进行报告。</p><p id="3cae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于可以将DataFrame对象转换成<strong class="kk iu"> markdown格式</strong>作为<strong class="kk iu">输出</strong>，因此用新的格式编写文档变得更加容易。这确实是一个很好的特性，因为现在表格的降价可以动态生成。</p><pre class="lf lg lh li gt mt mu mv mw aw mx bi"><span id="78f8" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu">In [1]: </strong>x = pd.DataFrame({'A': [1,2], 'B': [3,4]})</span><span id="85d0" class="my lw it mu b gy nd na l nb nc"><strong class="mu iu">In [2]: print(x.to_markdown())<br/></strong>|    |   A |   B |<br/>|---:|----:|----:| <br/>|  0 |   1 |   3 |<br/>|  1 |   2 |   4 |</span></pre><p id="b4cf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，还修复了多个不同主题的错误，如<em class="ms">绘图</em>、<em class="ms"> I/O </em>、<em class="ms">日期时间</em>等。关于这些的更多信息可以在1.0.0 的<a class="ae lu" href="https://pandas.pydata.org/pandas-docs/version/1.0.0/whatsnew/v1.0.0.html#bug-fixes" rel="noopener ugc nofollow" target="_blank"> Pandas文档中找到。</a></p><h1 id="bfe2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">想安装/升级熊猫？</strong></h1><p id="f3ce" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">要使用pip安装Pandas(针对首次用户):</p><pre class="lf lg lh li gt mt mu mv mw aw mx bi"><span id="e651" class="my lw it mu b gy mz na l nb nc">pip install pandas</span></pre><p id="7c29" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于已经有旧版本Pandas但想升级的用户:</p><pre class="lf lg lh li gt mt mu mv mw aw mx bi"><span id="3c27" class="my lw it mu b gy mz na l nb nc">pip install --upgrade pandas</span></pre><p id="6721" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">也感谢所有管理和开发熊猫的贡献者/开发者🎉。</p><p id="c83e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望你觉得这篇文章有趣并且有用。如果你有，请分享。</p><p id="cadf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，如果你觉得有更重要的变化，请随时写在评论中。</p><p id="7c2c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🐼🐼🐼🐼🐼🐼谢谢大家！</p></div></div>    
</body>
</html>