# 使用 pandas 创建、子集化和组合数据框的不同方式

> 原文：<https://towardsdatascience.com/different-ways-to-create-subset-and-combine-dataframes-using-pandas-e7227330a7f1?source=collection_archive---------21----------------------->

## 熊猫中一些最有用的方法和功能的非常需要的简明指南

# 介绍

在最近 5 年左右的时间里，python 是新的最热门的编码语言，每个人都在努力学习和研究它。其中一个最大的原因是程序员和数据科学家的庞大社区，他们不断地使用和开发语言和资源，使更多人的生活变得更容易。然而，为了有效地使用任何语言，在进入该语言的广阔世界之前，通常需要了解某些框架。对于 python 来说，有三个这样的框架或者我们称之为库，它们被认为是基石。它们是熊猫、Numpy 和 Matplotlib。在这篇文章中，我们将探讨熊猫的一些有用的方法或功能，以了解熊猫是如何做事情的。

![](img/1f7ca59ca4d1d820481cbc47a014d8a8.png)

克里斯里德在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

由于 pandas 具有广泛的功能，我将只介绍一些最重要的功能。在本文中，我们将试图回答以下问题:

*   什么是包？
*   如何安装包和调用包？
*   熊猫是什么？
*   什么是 dataframe 和 series？
*   如何用多种方式初始化一个 dataframe？
*   如何选择/子集化/切片数据帧？
*   如何组合两个数据帧？

python 新手，想在继续学习之前先学习基础知识吗？你可以看看我写的另一篇文章，这篇文章解释了数据科学的 python 基础。

[](https://medium.com/analytics-vidhya/basics-of-python-for-data-science-7c165c76123f) [## 数据科学的 Python 基础

### 用 Python 实现数据科学所需的构件

medium.com](https://medium.com/analytics-vidhya/basics-of-python-for-data-science-7c165c76123f) 

知道 python 的基础，但不确定所谓的“包”是什么？别担心，我会掩护你的。如果你已经知道什么是软件包，你可以跳到“熊猫数据框架和系列”部分来看看直接覆盖的主题。

**什么是包裹？**
在大多数现实世界的应用程序中，实际需求需要一个人做大量的编码来解决一个相对常见的问题。例如，机器学习是一个真实世界的应用程序，世界各地的许多人都在使用，但大多数情况下可能有一个非常标准的方法来解决问题。为了节省编码人员和那些想开发这种代码的人的大量时间，所有这种应用程序或代码片段都被编写并在线发布，其中大多数通常是开源的。这些代码的集合被称为包。这个定义是我想用简单的术语让你理解什么是包，它绝不是一个正式的定义。

**如何安装包和调用包？**
熊猫就是这样一种包装，它无疑是世界上使用最多的包装之一。个人必须先下载这些软件包，然后才能使用它们。使用终端输入 pip 命令可以很容易地做到这一点。一旦下载，这些代码就存在你的电脑里，但不能直接使用。必须做一些被称为“导入”包的事情。简单来说，我们用这个语句告诉计算机“嘿，计算机，我将在这个文件/笔记本中使用这个*名字*的下载代码”。有了这个，计算机就会明白它必须在下载的文件中查找该包中所有可用的功能。

*使用 pip 命令格式化安装包:pip 安装包名
调用包:导入包名作为别名*

**什么是熊猫？**
Pandas 是多个函数和自定义类的集合，称为 dataframes 和 series。它无疑是最常用的软件包之一，世界各地的许多数据科学家都使用它进行分析。这也是大多数数据科学学生学习的第一个包。让我们详细看看使用这个软件包可以做些什么。

**注意:**我们不会查看 pandas 提供的所有功能，而是查看一些人们在日常工作中经常使用和可能需要的有用功能。

# 熊猫数据框和系列

在 Pandas 中，主要有两种数据结构，称为 dataframe 和 series。把 dataframes 想象成你常规的 excel 表格，但是在 python 中。基本上，它是一个二维表，其中每一列都有一种数据类型，如果一列中有多个值，很有可能会转换为 object 数据类型。对于 series，它相当于数据帧中的一列信息，有点类似于列表，但它是 pandas 的原生数据类型。

注意:每个包通常都有其对象类型。这可以在尝试打印类型(对象)时找到

让我们看下面的例子来更好地理解它们的区别。

正如我们在上面看到的，series 创建了一系列列表，但实际上创建了 2 个一维值。另一方面，dataframe 根据需要在二维空间中创建了一个表格样式值。

既然我们已经有了基础知识，现在让我们开始深入学习吧。

# 创建基本数据框架

在进入任何奇特的方法之前，我们应该首先知道如何初始化数据帧和不同的方法。让我们首先看看如何使用不同的方法创建一个简单的 dataframe，其中一列包含两个值。在这样做之前，确保有进口熊猫作为“进口熊猫作为 pd”。请注意，这里我们使用 pd 作为熊猫的别名，大多数社区都使用它。

如上所示，声明或初始化数据帧的基本语法是 pd。DataFrame()和括号中给出的值。因为在括号内只能输入一个变量，所以使用了可以一次保存多个值的数据结构。在上面显示的例子中，列表、元组和集合被用于启动数据帧。如图所示，它们都给出相同或相似的结果。现在让我们看看如何使用字典声明数据帧。

当试图使用简单的字典初始化数据帧时，我们得到如上给出的值错误。我们得到的错误声明该问题是由于字典中的标量值引起的。我们可以通过使用 from_records 方法或使用字典中的值列表来解决这个问题。还要注意，当试图从 dictionary 初始化 dataframe 时，dictionary 中的键被视为单独的列。

注意将值初始化为字典还有什么不同吗？这是本文中我们第一次控制列名。你问还有没有其他方法可以控制列名？是的，我们可以，让我们看看下面的例子。

正如我们在上面看到的，我们可以在 DataFrame 方法中使用 column 关键字初始化列名，语法为 pd。DataFrame(值，列)。我们可以在同一个语句中创建多个列，方法是利用列表列表、元组列表。我们还可以使用列名列表同时为多个列指定名称。

# 选择或索引数据

既然我们知道了如何从头开始创建或初始化新的数据帧，接下来的事情就是查看特定的数据子集。在 python 中，这在某些情况下被指定为索引或切片。让我们看一下我们将在本节中使用的数据帧。

请注意这里是如何指定索引值的。如果没有给定索引值，索引的顺序将从 0 开始到 9 结束。这将有助于我们更好地理解方法之间的差异。如果您想知道代码的 np.random 部分是做什么的，它会创建随机数并输入到数据帧中。

人们主要使用三种不同的方法来选择数据。它们是:

*   通信线路（LinesofCommunication）
*   iloc
*   切片— []

让我们来看看它们，了解它们是如何工作的

## 通信线路（LinesofCommunication）

loc 方法将使用数据帧和/或序列中的索引信息提取数据。这意味着，对于子集化数据，loc 会查找每一行的索引值，以获取所需的信息。让我们看看下面的例子来更好地理解它。

请注意，当我们将 0 作为 loc 输入传递时，结果输出是对应于索引值 0 的行。这就是从 loc 中提取信息的方式。这种方法的主要优点是，可以仅基于索引值从数据集中检索信息，因此我们可以确定每次提取的内容。

## iloc

iloc 方法将使用数据帧和/或序列中的位置信息提取数据。这意味着，对于子集化数据，iloc 不会查找每行的索引值来获取所需的信息，而是根据位置获取所有信息。让我们看看下面的例子来更好地理解它。

注意，这里与 loc 不同，获取的信息来自第一行，对应于 0，因为 python 索引从 0 开始。如果你还记得最初看 df 的时候，指数从 9 开始，到 0 结束。因此，我们现在清楚了，使用 iloc(0)获取第一行，而不考虑索引。

## 切片— []

python 中的切片是使用方括号— []完成的。有多种方法可以根据需要对数据进行切片。让我们看看如何最有效地利用切片。

让我们首先看看数据帧中的行切片。

在这里，我们可以看到括号中输入的数字对应于行的索引级别信息。上面给出的三个不同的例子应该涵盖了行切片的大部分内容。

现在让我们看看数据帧中的列切片。

我们可以看到，对于按列切片，语法是 df[["col_name "，" col_name_2"]]，我们将需要关于列名的信息，因为这将非常清楚我们正在提取哪些列。上述方法在某种程度上类似于 loc，因为它试图匹配精确的列名(loc 匹配索引号)来提取信息。使用这种方法，我们还可以添加多个要提取的列，如上面的第二个示例所示。

最后，如果我们必须按照某种条件进行切片，那该怎么办呢？嗯，那些也可以容纳。让我们看一个例子。

正如我们所看到的，切片的语法是 df[condition]。这里的条件不必仅仅是一个条件，也可以是多个条件的叠加或分层。在上面的第一个例子中，我们想要查看 A 列有正值的所有列。类似地，我们可以将多个条件相加，就像上面的第二个例子一样，以获得所需的信息。

这 3 种方法或多或少涵盖了使用 python 可能需要做的大部分切片和/或索引。

# 组合两个数据帧

我们现在将研究如何以多种方法组合两个不同的数据帧。你问我们为什么一定要这样做？有很多原因可以解释为什么人们会对这样做感兴趣，比如将多个数据源放入一个表中。

有多种方法可以帮助我们做到这一点。它们是:

*   串联
*   附加
*   加入
*   合并

让我们逐一研究一下。

## 串联

Concat 是 method 中最强大的方法之一。在某种程度上，我们甚至可以说所有其他方法都是 concat 的派生方法或子方法。让我们首先看一个简单直接的 concat 例子。

它看起来像一个具有默认设置的简单 concat，只是将一个数据帧添加到另一个数据帧之下，而不考虑索引，同时考虑列的名称，即 df2 的列 A 被添加到 df1 的列 A 之下，以此类推。现在让我们探索一些我们可以在 concat 中调整的附加设置。

让我们首先看看如何在 concat 语句中更改轴值，如下所示。

正如我们所看到的，当我们将 axis 的值更改为 1(默认值为 0)时，数据帧的添加是并排进行的，而不是从上到下。此外，现在不是以列名作为添加两个数据帧的指导，而是以索引值作为指导。

现在，让我们尝试使用另一个附加参数 join。join 参数用于指定我们想要的连接类型。如果您不确定什么是连接，那么在继续阅读文章之前快速阅读一下是个好主意。现在让我们看看下面的例子。

正如我们在上面看到的，当我们使用轴值为 1 的 inner join 时，得到的数据帧由具有公共索引的行(如果轴=0，则为公共列)组成，并并排添加两个数据帧(如果轴=0，则为一个在另一个下面)。让我们看一个 axis=0 的例子来理解这一点。

输出与我们预期的一样，其中只显示了公共列，并且数据帧一个接一个地添加。

Ignore_index 是 concat 方法中另一个经常使用的参数。让我们看看它是做什么的。

正如我们在这里看到的，这里的主要变化是索引值不是连续的，与 df1 和 df2 的索引值无关。因此，这是通过忽略原始数据帧的索引，将现有索引值替换为新的顺序索引。

concat 的最后一个参数是 keys。该参数通过输入自定义键名帮助我们跟踪行或列的来源。让我们看一个例子来更好地理解它。

正如我们所看到的，根据值是如何添加的，keys 标记说明了所提到的键以及列和行中的信息。

## 附加

Append 是 pandas 中的另一种方法，专门用于将数据帧一个接一个地相加。可以说这种方法的功能相当于 concat 方法的子功能。让我们看一个例子。

正如我们从上面看到的，如果我们在 axis=0 的情况下使用 concat，这就是我们将得到的确切输出。然而，因为这个方法是特定于这个操作的，所以 append 方法是 pandas 用户所知道的著名方法之一。让我们看看如何将多个数据帧追加到单个数据帧中。

正如我们在上面看到的，第一个给了我们一个错误。这可以通过使用括号和插入我们想要添加的数据帧的名称来解决。这是因为 append 参数只接受一个用于追加的输入，它可以是一个数据帧，也可以是一组数据帧(在本例中为 list)。concat 中有一个 ignore_index 参数，其工作方式类似于 ignore_index。我们可以看一个例子来更好地理解它。

正如我们所看到的，它忽略了数据帧中的原始索引，并给它们新的顺序索引。

## 加入

Join 是 pandas 中的另一种方法，专门用于将数据帧添加到另一个旁边。可以说这种方法的功能相当于 concat 方法的子功能。让我们看一个例子。

正如我们所看到的，如果我们在 axis=1 的情况下使用 concat，这就是我们将得到的确切输出。尽管大多数人更喜欢使用 merge 方法而不是 join 方法，但 join 方法是 pandas 用户所知道的著名方法之一。现在让我们来看看对于具有不同索引的数据帧，随着参数“how”值的改变，join 将如何表现。

因此，从上面可以确认，当使用 axis=1 并使用指定的 how 参数时，join 方法的行为类似于 concat。

## 合并

Merge 类似于 join，只有一个重要的区别。也就是说，在 join 中，数据帧仅基于索引值添加，但在 merge 中，我们可以根据合并的发生来指定列名。所以，说 merge 比 join 更有用、更强大一点都不会错。让我们看一个例子来更好地理解它。

注意我们在 merge 语句中是如何使用参数“on”的。On 是使用 merge 时必须指定的强制参数。只有当两个数据框架中有相同的列和相同的名称时，这种方法才能很好地工作。如果我们想要合并基于不同名称的列的数据帧呢？还是基于多列合并？Merge 自然也包含所有类型的联接，可以使用“how”参数访问这些联接。让我们看一些例子来了解如何使用它们。

正如我们在上面看到的，我们可以将多个列指定为一个列表，并将其作为 on 参数的输入。如果数据帧有不同的列名，我们可以使用 left_on 和 right_on 参数合并它们，而不是使用 on 参数。

我们将关注的最后一个参数是指标。默认情况下，这是 False，但是当我们将它作为 True 传递时，它将创建另一个附加的 column _merge，该 column _ merge 在行级别通知进行了什么类型的合并。

正如我们在上面看到的，它将通知 left_only，如果该行只有来自左边数据帧的信息，它将说 right_only，如果它有关于右边数据帧的信息，最后如果它有两个数据帧的信息，它将显示两者。

# 结论

在本文中，我们研究了多种情况，包括完成以下任务的多种方法:

*   以多种方式初始化数据帧
*   使用 loc、iloc 和切片子集化数据帧
*   使用 concat、append、join 和 merge 组合多个数据帧

总之，每个人都知道实践使人完美。这句话也适用于技术领域，对吗？为了让你更容易实践我们在本文中讨论的多个概念，我已经创建了一个 Jupiter 笔记本，你可以在这里下载。练习的好时光！！！

![](img/327064580b234665211277e3902eb069.png)

如果有任何疑问、建设性的批评和任何反馈，请随时联系我这里的。