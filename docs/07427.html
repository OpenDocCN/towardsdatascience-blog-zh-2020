<html>
<head>
<title>Kubernetes Local Development: The Correct Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes 地方发展:正确的道路</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/kubernetes-local-development-the-correct-way-1bc4b11570d8?source=collection_archive---------12-----------------------#2020-06-05">https://towardsdatascience.com/kubernetes-local-development-the-correct-way-1bc4b11570d8?source=collection_archive---------12-----------------------#2020-06-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c095" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 Kubernetes 上开发时，痛苦和苦难的无限循环已经成为过去。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cb8820eef68b0efd241baa0c13c72d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IqIXIT-DjkNqIVaXP6stlQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1199580" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a></p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/6f0a9f950a1af6fb3dae6ec6e67c8823.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*0VbDuG4AqtfNFkvyE3DBdA.png"/></div></figure><p id="e02e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae ky" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>是自动化部署、扩展和管理容器化应用程序的优秀工具。然而，Kubernetes 上的当地发展可能是一个痛苦的过程。典型的工作流程由几个不同的步骤组成；在本地检查代码的功能，构建并标记 docker 映像，创建部署配置并在 Kubernetes 上部署。如果有 bug 或需要升级，开发人员需要从头开始遵循相同的过程。在他们的 Next’19 演示中，谷歌工程师称这是痛苦和折磨的无限循环，<strong class="lc iu">那么，有没有一种方法可以自动化降低生产力的部分，让开发人员专注于他们代码的逻辑？</strong>介绍<a class="ae ky" href="https://skaffold.dev/" rel="noopener ugc nofollow" target="_blank">斯卡福德</a>；</p><p id="cb12" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Skaffold 是 Google 的一个轻量级开源项目，它促进了本地 Kubernetes 的开发。它跨环境运行，通过提供一组丰富的特性来优化开发过程，这些特性对于原生 Kubernetes 开发是必不可少的，包括图像标记、资源端口转发和日志记录、文件同步等等。</p><blockquote class="lw lx ly"><p id="d533" class="la lb lz lc b ld le ju lf lg lh jx li ma lk ll lm mb lo lp lq mc ls lt lu lv im bi translated"><a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=article&amp;utm_medium=medium&amp;utm_campaign=skaffold&amp;utm_term=skaffold_kubernetes" rel="noopener ugc nofollow" target="_blank">学习率</a>是为那些对 AI 和 MLOps 的世界感到好奇的人准备的时事通讯。你会在每周五收到我关于最新人工智能新闻和文章的更新和想法。在这里订阅<a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=article&amp;utm_medium=medium&amp;utm_campaign=skaffold&amp;utm_term=skaffold_kubernetes" rel="noopener ugc nofollow" target="_blank"/>！</p></blockquote></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="315b" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">斯卡福德来救援了！</h1><p id="7051" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">Skaffold 提供了一个 CLI(命令行界面),可以在本地和远程集群上进行迭代开发。该工具提供了几个特性，使得在 Kubernetes 上进行本地开发成为一种乐趣。</p><ul class=""><li id="a979" class="nh ni it lc b ld le lg lh lj nj ln nk lr nl lv nm nn no np bi translated"><strong class="lc iu">轻量级开源 CLI 工具。Skaffold 没有服务器端组件，因此您在集群上没有开销或维护负担。</strong></li><li id="23ef" class="nh ni it lc b ld nq lg nr lj ns ln nt lr nu lv nm nn no np bi translated"><strong class="lc iu">检测源代码中的变化，并自动构建/推送/部署。</strong>ska fold 会在源代码发生变化时检测到变化(只要您保存了文件)，自动启动管道来构建、标记、推送和部署您的应用程序。此外，Skaffold 聚合来自运行中的容器的日志，并将容器端口转发到主机。</li><li id="529e" class="nh ni it lc b ld nq lg nr lj ns ln nt lr nu lv nm nn no np bi translated">增加项目的可移植性。斯卡福德让项目共享小菜一碟；您团队中的任何开发人员现在都可以<code class="fe nv nw nx ny b">git clone</code>和<code class="fe nv nw nx ny b">skaffold run</code>项目，并在几秒钟内运行应用程序。此外，让新成员加入您的团队比以往任何时候都容易；不再需要安装指南和配置更改。</li><li id="8122" class="nh ni it lc b ld nq lg nr lj ns ln nt lr nu lv nm nn no np bi translated"><strong class="lc iu">开发与生产。Skaffold 配置文件、用户级配置语句和环境标志可以描述如何在不同的环境中部署应用程序，甚至可以描述应用程序的哪个部分将被部署，从而实现细粒度的功能和集成测试。</strong></li></ul><h1 id="dabf" class="mk ml it bd mm mn nz mp mq mr oa mt mu jz ob ka mw kc oc kd my kf od kg na nb bi translated">装置</h1><p id="8700" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">要安装 Skaffold，请遵循<a class="ae ky" href="https://skaffold.dev/docs/install/" rel="noopener ugc nofollow" target="_blank">文档</a>中提供的说明，或者访问 GitHub <a class="ae ky" href="https://github.com/GoogleContainerTools/skaffold/releases" rel="noopener ugc nofollow" target="_blank">发布页面</a>获取特定版本。Skaffold 提供 Linux、OSX 和微软 Windows 的安装选项，以及 docker 镜像。例如，在 Linux 上安装 Skaffold CLI 就像执行以下命令一样简单:</p><pre class="kj kk kl km gt oe ny of og aw oh bi"><span id="c49c" class="oi ml it ny b gy oj ok l ol om">curl -Lo skaffold https://storage.googleapis.com/skaffold/releases/latest/skaffold-linux-amd64<br/>sudo install skaffold /usr/local/bin/</span></pre><p id="abe1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">该命令安装 Skaffold 的最新稳定版本。如果您想要特定的版本(例如版本 1.10.1 ),只需将命令更改为以下内容:</p><pre class="kj kk kl km gt oe ny of og aw oh bi"><span id="9072" class="oi ml it ny b gy oj ok l ol om">curl -Lo skaffold <a class="ae ky" href="https://storage.googleapis.com/skaffold/releases/v1.10.1/skaffold-linux-amd64" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/skaffold/releases/v1.10.1/skaffold-linux-amd64</a> &amp;&amp; chmod +x skaffold &amp;&amp; sudo mv skaffold /usr/local/bin</span></pre><h1 id="ddf9" class="mk ml it bd mm mn nz mp mq mr oa mt mu jz ob ka mw kc oc kd my kf od kg na nb bi translated">简单的例子</h1><p id="2133" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">在本节中，我们将使用 Skaffold GitHub 页面上提供的简单的<a class="ae ky" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Go </a>应用程序示例。因此，有一个简单的 Go 应用程序可以打印"<em class="lz"> Hello world！</em>“每秒钟:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="fbf6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们需要一个 docker 文件来封装应用程序，并为 Kubernetes 部署做好准备:</p><pre class="kj kk kl km gt oe ny of og aw oh bi"><span id="532f" class="oi ml it ny b gy oj ok l ol om">FROM golang:1.12.9-alpine3.10 as builder<br/>COPY main.go .<br/>RUN go build -o /app main.go</span><span id="5f22" class="oi ml it ny b gy op ok l ol om">FROM alpine:3.10<br/>ENV GOTRACEBACK=single<br/>CMD ["./app"]<br/>COPY --from=builder /app .</span></pre><p id="4d40" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在您可能会注意到这个 Dockerfile 文件的一些奇怪之处:它有两行<code class="fe nv nw nx ny b">FROM</code>。这种技术被称为构建器模式，用于生成较小的容器。在这种情况下，我们使用第一个容器来编译代码，因为<code class="fe nv nw nx ny b">golang:1.12.9-alpine3.1</code>映像为这项工作提供了所有必要的工具，而第二个映像只复制已编译的二进制文件并运行应用程序。因此，我们可以将集装箱的占地面积减少几个数量级。</p><p id="91bc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们有了 Dockerfile 文件，我们需要部署 YAML 配置文件:</p><pre class="kj kk kl km gt oe ny of og aw oh bi"><span id="0fcb" class="oi ml it ny b gy oj ok l ol om">apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  name: getting-started<br/>spec:<br/>  containers:<br/>  - name: getting-started<br/>    image: skaffold-example</span></pre><p id="daa3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">该文件获取图像<code class="fe nv nw nx ny b">getting-started</code>并将其部署在 pod 中。这就是痛苦停止的地方。我们现在可以运行<code class="fe nv nw nx ny b">skaffold init</code>并让工具检测我们的资源并生成斯卡福德 YAML 配置文件。</p><pre class="kj kk kl km gt oe ny of og aw oh bi"><span id="2cdf" class="oi ml it ny b gy oj ok l ol om">apiVersion: skaffold/v2beta4<br/>kind: Config<br/>metadata:<br/>  name: skaffold<br/>build:<br/>  artifacts:<br/>  - image: skaffold-example<br/>deploy:<br/>  kubectl:<br/>    manifests:<br/>    - pod.yaml</span></pre><p id="8873" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们现在可以运行<code class="fe nv nw nx ny b">skaffold run</code>，Skaffold 将构建我们的映像并将其部署到我们本地的 Kubernetes 集群。如果这还不够，尝试运行<code class="fe nv nw nx ny b">skaffold dev</code>。这条语句将完全执行前面的命令，而且还会聚合容器的日志并打印出来。现在，如果您进行了更改并保存了文件，请注意，它会立即检测到更改并再次开始构建/标记/部署周期。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/b3b0fb93484b0df67af678405173b6eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4aVmPfN4b6LZA9-3Pi5_mw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Kubernetes 与 Skaffold 的互动地方发展</p></figure><p id="255d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">默认情况下，Skaffold 使用 Git 标签来管理你的图片，因此如果你运行<code class="fe nv nw nx ny b">docker image ls</code>，你会看到类似这样的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/26a114ba3e578259756a6d14592777c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h2DpN2Oa-Mxo625NY88X5w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">斯卡福德 git 标签</p></figure><p id="0450" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要深入了解，请查看 Skaffold 的<a class="ae ky" href="https://skaffold.dev/docs/quickstart/" rel="noopener ugc nofollow" target="_blank">文档</a>示例或该工具的<a class="ae ky" href="https://github.com/GoogleContainerTools/skaffold/tree/master/examples" rel="noopener ugc nofollow" target="_blank"> GitHub </a>页面。最后但同样重要的是，Skaffold 与其他 Kubernetes 工具配合得很好，例如<a class="ae ky" href="https://kustomize.io/" rel="noopener ugc nofollow" target="_blank"> Kustomize </a>和<a class="ae ky" href="https://github.com/GoogleContainerTools/jib" rel="noopener ugc nofollow" target="_blank"> Jib </a>，因此，您不必改变当前的工作流程。</p><h1 id="4b43" class="mk ml it bd mm mn nz mp mq mr oa mt mu jz ob ka mw kc oc kd my kf od kg na nb bi translated">结论</h1><p id="dea6" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">在这个故事中，我们介绍了每个试图在 Kubernetes 上进行本地开发的开发人员所经历的痛苦和折磨的无限循环。然后，我们介绍了 Skaffold，这是一个开源 CLI，它通过提供一组丰富的特性来优化开发工作流，这些特性对于原生 Kubernetes 开发来说是必不可少的，包括图像标记、资源端口转发和日志记录、文件同步等等。</p><p id="f2ac" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在以后的文章中，我们将通过为 Skaffold 引入一种图形用户界面来使事情变得更简单，在这里你只需按一个按钮就可以做同样的事情。敬请期待！</p><p id="7bfa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">编辑:新的故事现在出版了！点击下面的链接…</p><div class="os ot gp gr ou ov"><a rel="noopener follow" target="_blank" href="/kubernetes-development-beyond-configuration-files-f78d7ab9a43"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd iu gy z fp pa fr fs pb fu fw is bi translated">Kubernetes 开发:超越配置文件</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">关注你的代码，而不是基础设施！</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">towardsdatascience.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj ks ov"/></div></div></a></div><h1 id="268e" class="mk ml it bd mm mn nz mp mq mr oa mt mu jz ob ka mw kc oc kd my kf od kg na nb bi translated">关于作者</h1><p id="e7cb" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">我叫<a class="ae ky" href="https://www.dimpo.me/?utm_source=article&amp;utm_medium=medium&amp;utm_campaign=skaffold&amp;utm_term=skaffold_kubernetes" rel="noopener ugc nofollow" target="_blank">迪米特里斯·波罗普洛斯</a>，我是一名为<a class="ae ky" href="https://www.arrikto.com/" rel="noopener ugc nofollow" target="_blank">阿里克托</a>工作的机器学习工程师。我曾为欧洲委员会、欧盟统计局、国际货币基金组织、欧洲央行、经合组织和宜家等主要客户设计和实施过人工智能和软件解决方案。</p><p id="dfbe" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你有兴趣阅读更多关于机器学习、深度学习、数据科学和数据运算的帖子，请关注我的<a class="ae ky" href="https://towardsdatascience.com/medium.com/@dpoulopoulos/follow" rel="noopener" target="_blank"> Medium </a>、<a class="ae ky" href="https://www.linkedin.com/in/dpoulopoulos/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或 Twitter 上的<a class="ae ky" href="https://twitter.com/james2pl" rel="noopener ugc nofollow" target="_blank"> @james2pl </a>。此外，请访问我的网站上的<a class="ae ky" href="https://www.dimpo.me/resources/?utm_source=article&amp;utm_medium=medium&amp;utm_campaign=skaffold&amp;utm_term=skaffold_kubernetes" rel="noopener ugc nofollow" target="_blank">资源</a>页面，这里有很多好书和顶级课程，开始构建您自己的数据科学课程吧！</p></div></div>    
</body>
</html>