<html>
<head>
<title>A simple way to create python CLI app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建python CLI应用程序的简单方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-simple-way-to-create-python-cli-app-1a4492c164b6?source=collection_archive---------13-----------------------#2020-03-16">https://towardsdatascience.com/a-simple-way-to-create-python-cli-app-1a4492c164b6?source=collection_archive---------13-----------------------#2020-03-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="143b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将机器学习应用程序包装到命令行界面的简单示例</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8d867ace60517aac80568921fcd25bae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hTjBjk0Jq0EWoHOY"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">克里斯里德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="ac93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们创建任何类型的应用程序时，我们必须提供一个其他人有机会使用的接口。我想向您展示一个将ML应用程序包装到CLI界面的简单示例。</p><p id="771a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我认为可以肯定地说，我们希望用最少的努力获得最好的结果。在这种情况下，<code class="fe ls lt lu lv b">fire</code>库将是最好的选择。<code class="fe ls lt lu lv b">fire</code>是一个库，由Google开发并广泛使用。让我们通过具体的例子来探索它的功能:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="3277" class="ma mb iq lv b gy mc md l me mf">main.py</span><span id="6d1a" class="ma mb iq lv b gy mg md l me mf">import fire<br/><br/><br/>def add(a: int, b: int):<br/>    <em class="mh">"""<br/>    Returns sum of a and b<br/>    </em><strong class="lv ir"><em class="mh">:param</em></strong><em class="mh"> a: first argument<br/>    </em><strong class="lv ir"><em class="mh">:param</em></strong><em class="mh"> b: second argument<br/>    </em><strong class="lv ir"><em class="mh">:return</em></strong><em class="mh">: sum of a and b<br/>    """<br/>    </em>return a+b<br/><br/><br/>if __name__ == "__main__":<br/>    fire.Fire({<br/>        "sum": add<br/>    })</span></pre><p id="5119" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里<code class="fe ls lt lu lv b">fire</code>从函数<code class="fe ls lt lu lv b">add</code>创建CLI命令<code class="fe ls lt lu lv b">sum</code>。从python doc中，它创建一个命令描述。</p><p id="9345" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">python main.py sum --help</code>的输出:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="2624" class="ma mb iq lv b gy mc md l me mf">NAME<br/>    main.py sum - Returns sum of a and b</span><span id="21fd" class="ma mb iq lv b gy mg md l me mf">SYNOPSIS<br/>    main.py sum A B</span><span id="34fa" class="ma mb iq lv b gy mg md l me mf">DESCRIPTION<br/>    Returns sum of a and b</span><span id="b21d" class="ma mb iq lv b gy mg md l me mf">POSITIONAL ARGUMENTS<br/>    A<br/>        first argument<br/>    B<br/>        second argument</span><span id="de45" class="ma mb iq lv b gy mg md l me mf">NOTES<br/>    You can also use flags syntax for POSITIONAL ARGUMENTS</span></pre><p id="6bba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，您现在可以通过多种方式使用该命令:</p><p id="7962" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">python main.py 1 2</code></p><p id="10b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">python main.py --a 1 --b 2</code></p><p id="a5ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，您可以通过在函数定义中定义默认值来定义可选的命令参数:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="4569" class="ma mb iq lv b gy mc md l me mf">def add(a: int, b: int = 2):<br/>    <em class="mh">"""<br/>    Returns sum of a and b<br/>    </em><strong class="lv ir"><em class="mh">:param</em></strong><em class="mh"> a: first argument<br/>    </em><strong class="lv ir"><em class="mh">:param</em></strong><em class="mh"> b: second argument (default: 2)<br/>    </em><strong class="lv ir"><em class="mh">:return</em></strong><em class="mh">: sum of a and b<br/>    """<br/>    </em>return a+b</span></pre><p id="a559" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在<code class="fe ls lt lu lv b">python main.py sum --help</code>的结果是:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="8e3d" class="ma mb iq lv b gy mc md l me mf">NAME<br/>    main.py sum - Returns sum of a and b</span><span id="8a0b" class="ma mb iq lv b gy mg md l me mf">SYNOPSIS<br/>    main.py sum A &lt;flags&gt;</span><span id="54bd" class="ma mb iq lv b gy mg md l me mf">DESCRIPTION<br/>    Returns sum of a and b</span><span id="83d7" class="ma mb iq lv b gy mg md l me mf">POSITIONAL ARGUMENTS<br/>    A<br/>        first argument</span><span id="0b7c" class="ma mb iq lv b gy mg md l me mf">FLAGS<br/>    --b=B<br/>        second argument (default: 2)</span><span id="a4a4" class="ma mb iq lv b gy mg md l me mf">NOTES<br/>    You can also use flags syntax for POSITIONAL ARGUMENTS</span></pre><p id="44d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，您现在可以通过多种方式使用该命令:</p><p id="520d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">python main.py 1</code></p><p id="cc32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">python main.py 1 2</code></p><p id="9f52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">python main.py 1 --b 2</code></p><p id="0bf1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">python main.py --a 1 --b 2</code></p><p id="73d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">无需多言，您可以看到CLI应用程序配置是多么简单快捷。</p><p id="37cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们为ML应用程序的一个常见用例创建一个程序框架。假设您需要创建一个具有两个函数<code class="fe ls lt lu lv b">train</code>和<code class="fe ls lt lu lv b">predict</code>的CLI应用程序。训练函数输入是训练数据和一些模型参数，输出是经过训练的模型文件。Predict接受用于预测的输入数据、定型模型，并将预测保存到输出文件中。</p><p id="14a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了函数映射，<code class="fe ls lt lu lv b">fire</code>可以从python类实例创建CLI接口，在这种情况下，这可能是一个更好的选择。在我们的例子中，代码可能是:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="5fda" class="ma mb iq lv b gy mc md l me mf">import fire<br/>import pickle<br/>import logging<br/><br/>import pandas as pd<br/>from sklearn.neighbors import KNeighborsClassifier<br/><br/>logging.basicConfig(level=logging.INFO)<br/>logger = logging.getLogger(__name__)<br/><br/>def load_model(model_path: str):<br/>    <em class="mh">"""Loads model from `model_path`"""<br/>    </em>with open(model_path, 'rb') as file:<br/>        saved_model = pickle.load(file)<br/>        return saved_model<br/><br/>def save_model(model, model_path: str):<br/>    <em class="mh">"""Saves `model` to `model_path`"""<br/>    </em>with open(model_path, 'wb') as file:<br/>        pickle.dump(model, file)<br/><br/>class Classifier:<br/>    <em class="mh">"""<br/>    Some classifier, that makes some random classifications.<br/>    """<br/><br/>    </em>def train(self, train_data_path: str, model_path: str, k: int = 5):<br/>        <em class="mh">"""<br/>        Trains model on `train_data_path` data and saves trained model to `model_path`.<br/>        Additionaly you can set KNN classifier `k` parameter.<br/>        </em><strong class="lv ir"><em class="mh">:param</em></strong><em class="mh"> train_data_path: path to train data in csv format<br/>        </em><strong class="lv ir"><em class="mh">:param</em></strong><em class="mh"> model_path: path to save model to.<br/>        </em><strong class="lv ir"><em class="mh">:param</em></strong><em class="mh"> k: k-neighbors parameter of model.<br/>        """<br/>        </em>logger.info(f"Loading train data from {train_data_path} ...")<br/>        df = pd.read_csv(train_data_path)<br/>        X = df.drop(columns=['y'])<br/>        y = df['y']<br/><br/>        logger.info("Running model training...")<br/>        model = KNeighborsClassifier(n_neighbors=k)<br/>        model.fit(X, y)<br/><br/>        logger.info(f"Saving model to {model_path} ...")<br/>        save_model(model, model_path)<br/><br/>        logger.info("Successfully trained model.")<br/><br/>    def predict(self, predict_data_path: str, model_path: str, output_path: str):<br/>        <em class="mh">"""<br/>        Predicts `predict_data_path` data using `model_path` model and saves predictions to `output_path`<br/>        </em><strong class="lv ir"><em class="mh">:param</em></strong><em class="mh"> predict_data_path: path to data for predictions<br/>        </em><strong class="lv ir"><em class="mh">:param</em></strong><em class="mh"> model_path: path to trained model<br/>        </em><strong class="lv ir"><em class="mh">:param</em></strong><em class="mh"> output_path: path to save predictions<br/>        """<br/>        </em>logger.info(f"Loading data for predictions from {predict_data_path} ...")<br/>        X = pd.read_csv(predict_data_path)<br/><br/>        logger.info(f"Loading model from {model_path} ...")<br/>        model = load_model(model_path)<br/><br/>        logger.info("Running model predictions...")<br/>        y_pred = model.predict(X)<br/><br/>        logger.info(f"Saving predictions to {output_path} ...")<br/>        pd.DataFrame(y_pred).to_csv(output_path)<br/><br/>        logger.info("Successfully predicted.")<br/><br/>if __name__ == "__main__":<br/>    fire.Fire(Classifier)</span></pre><p id="8e2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">python main.py</code>的输出为:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="a988" class="ma mb iq lv b gy mc md l me mf">NAME<br/>    main.py - Some classifier, that makes some random classifications.</span><span id="f30f" class="ma mb iq lv b gy mg md l me mf">SYNOPSIS<br/>    main.py COMMAND</span><span id="5a9a" class="ma mb iq lv b gy mg md l me mf">DESCRIPTION<br/>    Some classifier, that makes some random classifications.</span><span id="1bff" class="ma mb iq lv b gy mg md l me mf">COMMANDS<br/>    COMMAND is one of the following:</span><span id="1c2b" class="ma mb iq lv b gy mg md l me mf">predict<br/>       Predicts `predict_data_path` data using `model_path` model and saves predictions to `output_path`</span><span id="5634" class="ma mb iq lv b gy mg md l me mf">train<br/>       Trains model on `train_data_path` data and saves trained model to `model_path`. Additionaly you can set KNN classifier `k` parameter.</span></pre><p id="50b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以及相应的命令文档:</p><p id="9771" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">python main.py train --help</code>:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="53f8" class="ma mb iq lv b gy mc md l me mf">NAME<br/>    main.py train - Trains model on `train_data_path` data and saves trained model to `model_path`. Additionaly you can set KNN classifier `k` parameter.</span><span id="f790" class="ma mb iq lv b gy mg md l me mf">SYNOPSIS<br/>    main.py train TRAIN_DATA_PATH MODEL_PATH &lt;flags&gt;</span><span id="0649" class="ma mb iq lv b gy mg md l me mf">DESCRIPTION<br/>    Trains model on `train_data_path` data and saves trained model to `model_path`. Additionaly you can set KNN classifier `k` parameter.</span><span id="5b49" class="ma mb iq lv b gy mg md l me mf">POSITIONAL ARGUMENTS<br/>    TRAIN_DATA_PATH<br/>        path to train data in csv format<br/>    MODEL_PATH<br/>        path to save model to.</span><span id="c89e" class="ma mb iq lv b gy mg md l me mf">FLAGS<br/>    --k=K<br/>        k-neighbors parameter of model.</span><span id="cdf4" class="ma mb iq lv b gy mg md l me mf">NOTES<br/>    You can also use flags syntax for POSITIONAL ARGUMENTS</span></pre><p id="a251" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">python main.py predict --help</code>:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="6b19" class="ma mb iq lv b gy mc md l me mf">NAME<br/>    main.py predict - Predicts `predict_data_path` data using `model_path` model and saves predictions to `output_path`</span><span id="e483" class="ma mb iq lv b gy mg md l me mf">SYNOPSIS<br/>    main.py predict PREDICT_DATA_PATH MODEL_PATH OUTPUT_PATH</span><span id="1f04" class="ma mb iq lv b gy mg md l me mf">DESCRIPTION<br/>    Predicts `predict_data_path` data using `model_path` model and saves predictions to `output_path`</span><span id="732c" class="ma mb iq lv b gy mg md l me mf">POSITIONAL ARGUMENTS<br/>    PREDICT_DATA_PATH<br/>        path to data for predictions<br/>    MODEL_PATH<br/>        path to trained model<br/>    OUTPUT_PATH<br/>        path to save predictions</span><span id="cdc6" class="ma mb iq lv b gy mg md l me mf">NOTES<br/>    You can also use flags syntax for POSITIONAL ARGUMENTS</span></pre><p id="3302" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用示例:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="7c68" class="ma mb iq lv b gy mc md l me mf">python main.py train train.csv knn.sav --k 7<br/>python main.py predict test.csv knn.sav out.csv</span></pre><p id="7ea4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您可以使用这个代码片段来创建自己的CLI应用程序。进一步改进的一些提示:</p><ol class=""><li id="fef8" class="mi mj iq ky b kz la lc ld lf mk lj ml ln mm lr mn mo mp mq bi translated">使用日志记录代替打印</li><li id="9c23" class="mi mj iq ky b kz mr lc ms lf mt lj mu ln mv lr mn mo mp mq bi translated">创建参数验证</li><li id="3a86" class="mi mj iq ky b kz mr lc ms lf mt lj mu ln mv lr mn mo mp mq bi translated">为最终用户创建带有简短应用程序使用说明的自述模板。</li><li id="5415" class="mi mj iq ky b kz mr lc ms lf mt lj mu ln mv lr mn mo mp mq bi translated">在<a class="ae kv" href="https://github.com/google/python-fire" rel="noopener ugc nofollow" target="_blank">https://github.com/google/python-fire</a>上探索更多酷炫功能</li></ol><p id="a78e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这篇文章将是有用的和信息丰富的。期待您的反馈！</p></div></div>    
</body>
</html>