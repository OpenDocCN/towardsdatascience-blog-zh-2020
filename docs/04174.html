<html>
<head>
<title>Automatically Update Data Sources in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Python 中自动更新数据源</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automatically-update-data-sources-in-python-e424dbea68d0?source=collection_archive---------17-----------------------#2020-04-16">https://towardsdatascience.com/automatically-update-data-sources-in-python-e424dbea68d0?source=collection_archive---------17-----------------------#2020-04-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="f666" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据科学基本 Python 指南</h2><div class=""/><div class=""><h2 id="a872" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">以新冠肺炎数据集为例的分步指南</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/1ebcfb8d5f00d07a2436fc8010378df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cNncKjtzV4isopEiibHvWA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://www.linkedin.com/in/ChaeyunKim" rel="noopener ugc nofollow" target="_blank"> Chaeyun Kim </a>更新数据集 Python 插图</p></figure><p id="55aa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di">在</span> Data Sciences 中，很多时候，您会从开源网站或 git 存储库中为您的 Python 项目获得一个外部数据源，比如一个<em class="mn"> csv </em>表。其中一些数据集可能会定期更新。然后，您可能会在运行 Python 脚本以获得最新结果之前，打开 web 浏览器下载数据集。本文将向您展示一个基本指南，告诉您如何自动化这个过程，以一种简单的方式保持您的数据是最新的。</p><h1 id="76bc" class="mo mp it bd mq mr ms mt mu mv mw mx my ki mz kj na kl nb km nc ko nd kp ne nf bi translated">从网站(URL)更新数据集</h1><p id="a6df" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">可以从<em class="mn"> URL 中检索几个开源数据集。您</em>可以使用<code class="fe nl nm nn no b">urllib</code>模块直接在 Python 中打开并读取<em class="mn"> URL </em>。它是大多数 Python 版本中预装的模块。所以你可以导入这个模块，使用下面的代码从任何<em class="mn"> URL </em>下载数据。</p><pre class="ks kt ku kv gt np no nq nr aw ns bi"><span id="f1be" class="nt mp it no b gy nu nv l nw nx"><strong class="no jd">import urllib.request</strong></span><span id="c942" class="nt mp it no b gy ny nv l nw nx"><strong class="no jd">url = '</strong><em class="mn">&lt;Your URL Here&gt;</em><strong class="no jd">'<br/>output = '</strong><em class="mn">&lt;Your output filename/location&gt;</em><strong class="no jd">'<br/>urllib.request.urlretrieve(url, output)</strong></span><span id="2181" class="nt mp it no b gy ny nv l nw nx">#.. Continue data analysis with updated output file</span></pre><p id="a8c7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，下面的示例脚本显示了从罗伯特·科赫研究所(RKI，德国疾病控制和预防研究机构)更新德国新冠肺炎数据的示例。该数据为<em class="mn"> csv </em>格式，可通过此<a class="ae lh" href="https://opendata.arcgis.com/datasets/dd4580c810204019a7b8eb3e0b329dd6_0.csv" rel="noopener ugc nofollow" target="_blank"> <em class="mn"> URL </em> </a>获取。在实际操作中，一些<em class="mn">URL</em>可能会随着时间的推移而改变或贬值，这使得 Python 脚本运行出错，因此我们可以包含<code class="fe nl nm nn no b">try/except</code>来检查 URL 是否仍然有效。假设你想保存下载文件的所有版本，你可以使用<code class="fe nl nm nn no b">datetime</code>模块给输出文件名添加一个时间戳。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nz oa l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">从 URL 下载文件的 Python 脚本示例(示例:来自<a class="ae lh" href="https://opendata.arcgis.com/datasets/dd4580c810204019a7b8eb3e0b329dd6_0.csv" rel="noopener ugc nofollow" target="_blank"> RKI </a>的新冠肺炎案例，使用 Python3.8)</p></figure><p id="3fe4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">*请注意，如果使用 macOS，应该先安装 Python 证书，然后才能使用<code class="fe nl nm nn no b">urllib</code>库。你可以通过运行 Macintosh HD&gt;Applications&gt;python 3 . x 文件夹中的<code class="fe nl nm nn no b">install certificates.command</code>文件轻松做到这一点。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h1 id="2d88" class="mo mp it bd mq mr oi mt mu mv oj mx my ki ok kj na kl ol km nc ko om kp ne nf bi translated">从 Git 存储库更新数据集</h1><p id="bc2a" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">如果您的 python 项目依赖于来自 git 存储库的数据。在您克隆存储库并将数据集获取到您的本地机器之后，您可能需要定期执行 git fetch 或 pull 来保持您的数据集是最新的。在这种情况下，您可以使用<code class="fe nl nm nn no b">GitPython</code>模块自动更新您的项目数据集。要使用这个模块，你必须先安装它，你可以很容易地使用<code class="fe nl nm nn no b">pip</code>这样做。</p><pre class="ks kt ku kv gt np no nq nr aw ns bi"><span id="846b" class="nt mp it no b gy nu nv l nw nx"><strong class="no jd">pip install gitpython</strong></span></pre><p id="083b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果遇到错误，您可以查看完整的 GitPython <a class="ae lh" href="https://gitpython.readthedocs.io/en/stable/intro.html" rel="noopener ugc nofollow" target="_blank">文档</a>来检查您的操作系统环境可能没有的需求。安装完模块后，您可以轻松地按照这些代码在每次运行代码时自动执行 git pull。</p><pre class="ks kt ku kv gt np no nq nr aw ns bi"><span id="67d5" class="nt mp it no b gy nu nv l nw nx"><strong class="no jd">import git</strong></span><span id="fb73" class="nt mp it no b gy ny nv l nw nx"><strong class="no jd">repo = git.Repo('&lt;your repository folder location&gt;')<br/>repo.remotes.origin.pull()</strong></span><span id="e2bf" class="nt mp it no b gy ny nv l nw nx">#... Continue with your Code.</span></pre><p id="a7d7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，<a class="ae lh" href="https://github.com/CSSEGISandData/COVID-19" rel="noopener ugc nofollow" target="_blank">JHU·CSSE</a>Github 仓库提供了<code class="fe nl nm nn no b">csv</code>格式的新冠肺炎时间序列数据集，这些数据集每天都在更新。将存储库克隆到您的机器上之后，您可以将上述代码添加到 Python 脚本的开头，以便每次都自动获取最新版本。这样，您可以确保您的结果是最新的。</p><h2 id="05c0" class="nt mp it bd mq on oo dn mu op oq dp my lr or os na lv ot ou nc lz ov ow ne iz bi translated">一些提示</h2><p id="cff1" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">对于 git 认证，如果您使用<code class="fe nl nm nn no b">ssh</code>，这将非常简单。如果您使用<code class="fe nl nm nn no b">HTTPs</code>，将您的用户名和密码保存到您的环境中会更方便。在 Mac 和 Windows 中，首次输入后会自动存储鉴定信息。在 Linux 中，您可以通过更改凭证超时来强制机器记住您的凭证。例如，您可以使用以下命令让您的计算机记住您的凭据一年。(31536000 秒)</p><pre class="ks kt ku kv gt np no nq nr aw ns bi"><span id="0f40" class="nt mp it no b gy nu nv l nw nx">$ <strong class="no jd">git config --global credential.helper 'cache --timeout=31536000'</strong></span></pre></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h2 id="28a9" class="nt mp it bd mq on oo dn mu op oq dp my lr or os na lv ot ou nc lz ov ow ne iz bi translated">作者单词</h2><p id="4701" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">本文展示了在 Python 脚本的开头直接从任何 URL 或 git 存储库更新数据集的分步指南。这样，您可以确保基于最新的数据集运行脚本。</p><p id="a2c3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望你喜欢这篇文章，并发现它对你的日常工作或项目有用。如果您有任何问题或意见，请随时给我留言。</p><p id="fe8a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">关于我&amp;查看我所有的博客内容:<a class="ae lh" href="https://joets.medium.com/about-me-table-of-content-bc775e4f9dde" rel="noopener">链接</a></p><p id="ebe3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">安全<strong class="lk jd">健康</strong>健康<strong class="lk jd">吗！💪</strong></p><p id="2645" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">感谢您的阅读。📚</strong></p></div></div>    
</body>
</html>