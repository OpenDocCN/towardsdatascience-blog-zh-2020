<html>
<head>
<title>Heart arrhythmia detection using Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用深度学习的心律失常检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/heart-arrhythmia-detection-using-deep-learning-a659848f2742?source=collection_archive---------12-----------------------#2020-02-17">https://towardsdatascience.com/heart-arrhythmia-detection-using-deep-learning-a659848f2742?source=collection_archive---------12-----------------------#2020-02-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7d28" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">如何利用 Tensorflow / Keras 结合 CNN 和 LSTM 进行时间序列分类</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/104258a41493f090d15f421dd4ccc610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pMieYxyo8zt7S9Fl"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@simonmigaj?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西蒙·米加杰</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a1e9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">深度学习最近正在帮助解决的一个常见问题涉及时间序列分类。解决这类问题的经典方法是从我们拥有的信号中生成特征，并训练一个机器学习模型。</p><p id="49f9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">手工制作功能的过程可能会占用您项目日程的很大一部分。就此而言，采用卷积神经网络与长短期记忆递归神经网络的组合。这种架构已被证明是有效的，可以减少花费在特征工程上的时间。</p><p id="0ef6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在本文中，我们将训练几个模型来检测不规则的心律。其思想是逐步展示如何为时间序列分类建立一个序列模型。如果你想深入了解这个问题，我强烈推荐<a class="ae kz" href="https://stanfordmlgroup.github.io/projects/ecg/" rel="noopener ugc nofollow" target="_blank">这篇来自斯坦福 ML 小组的文章</a>。</p><h1 id="e27a" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">处理数据集</h1><p id="97de" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">在这个实验中，我们将使用<a class="ae kz" href="https://physionet.org/content/mitdb/1.0.0/" rel="noopener ugc nofollow" target="_blank">麻省理工学院-BIH 心律失常数据库</a>，其中包含从 47 名受试者获得的 48 个半小时的双通道动态心电图记录摘录。心脏病专家对数据集进行了注释，所有标签和对数据收集方式的完整解释可在此处找到<a class="ae kz" href="https://physionet.org/content/mitdb/1.0.0/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="091e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了这个实验的目的，让我们只考虑两类:正常节拍和异常节拍。从标签中丢弃无效的节拍。这些被认为是标签，不在这些列表上的被标记为正常。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="bb2e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">每个记录由一个信号及其注释组成。这两个文件都是通过库<a class="ae kz" href="https://github.com/MIT-LCP/wfdb-python" rel="noopener ugc nofollow" target="_blank"> Python WFDB </a>读取的。可以使用以下方式读取记录:</p><pre class="kk kl km kn gt mv mw mx my aw mz bi"><span id="5019" class="na lx it mw b gy nb nc l nd ne">record = wfdb.rdrecord(filename)<br/>annotation = wfdb.rdann(filename, "atr")</span></pre><p id="4dfc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">注释包含每个节拍注释。在我们的模型中，每个样本将是一个作为目标的节拍标签和一个围绕这个节拍的序列作为输入(每边 3 秒)。</p><p id="c8a7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在让我们定义两个函数来帮助我们处理记录。一个简单的分类记录，给定上面的列表，分为正常和异常的心跳。另一个函数将为我们的 CNN/LSTM·1D 模型构建一个样本。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="3d2c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了更好地理解第二个函数，我们需要理解 CNN 或 LSTM 模型的输入是如何格式化的。你必须输入一个形状为<em class="nf">的三维数组(batch_size，sequence_size，number_of_features)。</em>在这种情况下，每个样本将是<em class="nf"> (1，序列大小，1) </em>，因为我们的模型中只有一个特征。稍后，你会看到，对于 CNN 和 LSTM，我们还需要定义另一个维度(子序列)。</p><p id="41e9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，下面的代码将为每个患者构建一个序列列表(输入)标签列表(目标)和一个地图。其思想是根据异常心跳的比率进行分层训练和验证。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="e4e3" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">培训模式</h1><p id="76ae" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">让我们尝试不同的模型来训练我们的分类器。这里的主要目的是展示如何设置 keras 层，这些架构设计得不是很好。第一个是 CNN 唯一的模型。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ng"><img src="../Images/e079182e86a763fca30047dba8430d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbdMqOYknY-DsPFZtNmfeQ.png"/></div></div></figure><p id="82b2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">该模型如下所示:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/f2f76f88a46ccb61340141d63aaf00cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*DD0ad0heJh5LEGpF8xMQIw.png"/></div></figure><p id="a1ce" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了训练模型，让我们调用 keras 的 fit 方法:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="653f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">使用这种架构，我们可以在验证集中实现 0.82 的准确度。这可能并不意味着一个惊人的模型，尤其是因为没有改善的时代的损失。</p><p id="3cba" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">另一个用于序列模型的通用架构是 CNN 和 LSTM。这个想法是用 CNN 层作为特征提取层，用 LSTM 来解释子序列的顺序。</p><p id="9204" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这种建筑看起来是这样的:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ni"><img src="../Images/e02b5da8135d126a546865c2b54572c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u7hebAjZscogFYN3nQBvig.png"/></div></div></figure><p id="251d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">使用顺序 API 构建模型与上面所做的没有太大变化。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nj"><img src="../Images/110446a45096b7b35d128269c45e81bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9bpg8NEpt-LwXDUuHlszbw.png"/></div></div></figure><p id="ee0c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">使用这种架构，验证集的精确度为 0.8。</p><p id="42d6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">下一步，你可以通过丢弃层或内核正则化来减少过度拟合，从而改进这些模型。</p><p id="c24a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这个实验的代码在这篇文章的<a class="ae kz" href="https://github.com/csaguiar/arrhythmia-detection" rel="noopener ugc nofollow" target="_blank">报告</a>中。</p></div></div>    
</body>
</html>