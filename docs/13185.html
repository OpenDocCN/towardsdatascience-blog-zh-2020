<html>
<head>
<title>7 Different Ways to Filter Pandas Dataframes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">7 种不同的方法来过滤熊猫数据帧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/7-different-ways-to-filter-pandas-dataframes-9e139888382a?source=collection_archive---------22-----------------------#2020-09-10">https://towardsdatascience.com/7-different-ways-to-filter-pandas-dataframes-9e139888382a?source=collection_archive---------22-----------------------#2020-09-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bca3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">灵活性很重要。</h2></div><p id="fb8f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Pandas 是一个非常强大和通用的 Python 数据分析库，它加速了数据分析和探索过程。熊猫的优势之一是它通常提供多种方式来完成一项任务。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/fe9423542017c1bbe8b15cfa2ba985fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AfEEVhYTea7qtv0c.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">在<a class="ae lu" href="https://unsplash.com/s/photos/seven?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae lu" href="https://unsplash.com/@waldemarbrandt67w?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Waldemar Brandt </a>拍照</p></figure><p id="eac5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在数据分析过程中，我们几乎总是需要根据条件或通过选择数据帧的子集进行一些过滤。在这篇文章中，我们将通过 7 种不同的方法来过滤熊猫数据帧。</p><p id="a70f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将在加州住房数据集上做例子，这个数据集在 google colab 的 sample data 文件夹下。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="dde7" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="0069" class="ma mb it lw b gy mg md l me mf">df = pd.read_csv("/content/sample_data/california_housing_train.csv",<br/>usecols =['total_rooms','total_bedrooms','population', 'median_income','median_house_value'])</span><span id="6735" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/ca94d1d7547ee3749b3481b46fea98b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*VzuhoLGOFM1ZH3lYtagoFA.png"/></div></figure><p id="b8d9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最常用的方法是像选择列一样在方括号内指定条件。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="c784" class="ma mb it lw b gy mc md l me mf">#1</span><span id="2070" class="ma mb it lw b gy mg md l me mf">df[df['population'] &gt; 10][:5]</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/982f20b62373f8c409420fcf50871117.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*f8CZKw0tXZaOcl8lYKidHA.png"/></div></figure><p id="6873" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们只得到人口数大于 1000 的行。</p><p id="978c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">特定列中具有最大值的行可以用<strong class="kk iu"> nlargest </strong>函数过滤。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="0c70" class="ma mb it lw b gy mc md l me mf">#2</span><span id="f0ec" class="ma mb it lw b gy mg md l me mf">df.nlargest(5, 'population')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/f1552a1f15963f4ee27ad9926214d3fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*B75QyybrQ0BKFYLhoY2t7Q.png"/></div></figure><p id="21ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将显示人口列中具有 5 个最大值的行。</p><p id="ed2a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">类似地，我们可以选择具有最小值的行。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="4982" class="ma mb it lw b gy mc md l me mf">#3</span><span id="42fd" class="ma mb it lw b gy mg md l me mf">df.nsmallest(5, 'population')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mk"><img src="../Images/bf2c26a32ced86e460d23c97caa58c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*5XJfoCV_ORVPz74xwGYFtQ.png"/></div></div></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="cde1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据列选择最大值或最小值的另一种方法是对行进行排序，然后进行切片。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="c36e" class="ma mb it lw b gy mc md l me mf">#4</span><span id="103b" class="ma mb it lw b gy mg md l me mf">df.sort_values(by='median_income', ascending=False)[:5]</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/9f35c61831494b080f015b58a2655364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*5ft0q21eCinASk9Hk9N_nA.png"/></div></figure><p id="ef2b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">dataframe 根据 median_income 列按降序排序，然后选择前 5 行。</p><p id="8aa9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">熊猫<strong class="kk iu">查询</strong>功能是一种非常灵活的过滤方式。它允许将条件指定为字符串。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="19bc" class="ma mb it lw b gy mc md l me mf">#5</span><span id="287c" class="ma mb it lw b gy mg md l me mf">df.query('5000 &lt; total_rooms &lt; 5500')[:5]</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/6ec8ea59de7ddc89b2b66291964b3e8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*2iAtd5aLa3tfp7VHUdLgfw.png"/></div></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="6390" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在某些情况下，我们可能希望从数据帧中随机选择一个样本。它更像是一个选择而不是过滤，但绝对值得一提。<strong class="kk iu"> sample </strong>函数返回指定大小的随机样本。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="aa06" class="ma mb it lw b gy mc md l me mf">#6</span><span id="bc53" class="ma mb it lw b gy mg md l me mf">df.sample(n=5)</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mu"><img src="../Images/7dfda9ccc9ad5d92cbfe279310648ee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*q358qaNoaD3PllBGyq_3DQ.png"/></div></div></figure><p id="f784" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该示例包含 5 行。也可以指定一个分数。例如，以下代码将返回大小等于原始数据帧 1%的样本。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="ebe2" class="ma mb it lw b gy mc md l me mf">df.sample(frac=0.01)</span></pre></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="9b2c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以选择指定的指数范围。就像 sample 函数一样，这个方法更像是一个选择，而不是基于条件的筛选。但是，对于顺序数据(如时间序列)，可以认为是一种过滤方式。</p><p id="2806" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用的方法是<strong class="kk iu"> iloc </strong>，它返回指定索引范围内的行或列。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="f0e1" class="ma mb it lw b gy mc md l me mf">#7</span><span id="d8a7" class="ma mb it lw b gy mg md l me mf">df.iloc[50:55, :]</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/7bea0d164c1aab5baa475f1f6b5df742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*lxBaTAnZztZsy2ezmFUPKw.png"/></div></figure><p id="72a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">返回索引在(50:55)范围内的行。我们可以选择只选择一些列。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="b011" class="ma mb it lw b gy mc md l me mf">df.iloc[50:55, :3]</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/9291a5fec6348897b3c3c03d992bb301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*cJqGlIN62--G7U-KCg1Gxg.png"/></div></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="bf96" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可能已经注意到返回行的索引没有改变。它们仍然具有与原始数据帧中相同的索引。如果您想在过滤后创建一个新的数据帧，您可能想要重置索引，这可以通过<strong class="kk iu"> reset_index </strong>函数来实现。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="85a4" class="ma mb it lw b gy mc md l me mf">#without reset_index</span><span id="ef49" class="ma mb it lw b gy mg md l me mf">df_new = df.query('total_rooms &gt; 5500')<br/>df_new.head()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/f496c5fbae3e923ed023621732f424c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*zDFlh-Zkm2oPRy6n3f79Lg.png"/></div></figure><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="308f" class="ma mb it lw b gy mc md l me mf">#with reset_index</span><span id="2290" class="ma mb it lw b gy mg md l me mf">df_new = df.query('total_rooms &gt; 5500').reset_index()<br/>df_new.head()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi my"><img src="../Images/1652fb5056414d0ccc5bd9ebaa57a9c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*kchF-flf1EhQDNZeL_Gpxg.png"/></div></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="17d5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经介绍了过滤数据帧或选择其一部分的不同方法。尽管许多方法都可以完成相同的操作，但是由于语法或其他原因，您可能更喜欢其中一种方法。</p><p id="cd64" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">拥有完成一项任务的灵活性和多种方式总是好的。而且，熊猫提供了大量的食物。</p><p id="f44c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>