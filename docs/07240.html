<html>
<head>
<title>Scraping Interactive Line Charts with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python抓取交互式折线图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scraping-interactive-charts-with-python-2bc20a9c7f5c?source=collection_archive---------15-----------------------#2020-06-02">https://towardsdatascience.com/scraping-interactive-charts-with-python-2bc20a9c7f5c?source=collection_archive---------15-----------------------#2020-06-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1824" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">带着<em class="ki">硒</em>穿过生产线</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/3ba50687e2f0a66dcebe605d94adfc70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*obE-AABwRd6kyA5NBZhR2g.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">【www.freepik.com free pik制作的T2商业照片</p></figure><p id="e974" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">假设你想知道今天美元对欧元的表现。快速的谷歌搜索就能搞定，只需输入:“美元欧元”。你会看到这样一个交互式图表:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/e6acf0c3667919cb2a0c90883a07955b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*ETetOIOZGYngvbOjn6hDDw.gif"/></div></figure><p id="e02d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了查看整个周期的值，您需要沿线移动光标，同时包含值和日期的标签会立即更新。</p><p id="f22b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在假设您想从这个图表中获取所有数据，并为自己创建一个数据库。如果标签中的值一直变化，如何从整行中刮出数据？既然你能看见它，你能刮它，就一定有办法。</p><p id="1414" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你要手动完成，你要做的是沿着这条线移动光标，同时在Excel表格中输入每个值，或者甚至在笔记本上手写。在这篇文章中，我们将看到如何让selenium做同样的事情。我们将让它像人一样工作，遍历行并记录值。</p><p id="1132" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">虽然我们使用的是Google的图表，但是这里实现的逻辑可以适用于任何类似的图表。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><p id="514b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们基本上使用的是<em class="me">硒</em>、<em class="me">熊猫、</em>和<em class="me">日期时间</em>模块。好了，在我们导入所有我们要用的东西后，让我们直接打开连接并抓取页面。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="e693" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然后我们实例化<em class="me"> action </em>对象，我们将使用它来移动屏幕上的光标，以及<em class="me"> search_bar </em>和<em class="me"> search_button </em>对象，我们将使用它们来执行我们的搜索。完成后，只需使用<em class="me"> send_keys </em>方法编写搜索，并使用<em class="me"> click </em>方法点击搜索按钮。我们将使用<em class="me"> WebDriverWait </em>,以便它等待元素被完全加载到页面中:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="37ac" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在让我们找到图表元素，并获取它在页面上的大小和位置。这很重要，这样我们就知道将光标移动到哪里。为此，我们还将使用<em class="me"> WebDriverWait </em>。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="b56a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">运行我们到目前为止所做的一切，这样您就可以看到以下输出:</p><pre class="kk kl km kn gt mh mi mj mk aw ml bi"><span id="0f35" class="mm mn it mi b gy mo mp l mq mr">{'x': 514, 'y': 262}<br/>{'height': 134, 'width': 301}</span></pre><p id="3dc5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们有了这个信息，我们可以用它来移动光标到对象的最右边，使用<em class="me">move _ to _ element _ with _ offset</em>。此方法将鼠标移动指定元素的偏移量。偏移量是相对于元素的左上角的，所以我们需要将对象的整个长度作为<em class="me"> xoffset </em>来传递。由于不需要在y轴上移动，<em class="me">yooffset</em>可以设置为零:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="90bc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果我们使用<em class="me"> move_to_element </em>来代替，光标将被移动到元素的中心。</p><p id="22b5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们的光标在这里:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ms"><img src="../Images/663b8097e80b527ae2c7f36e24f11153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FJZhF4XTMSVnGFIxoWUxBw.png"/></div></div></figure><p id="01ab" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">请注意图表最右边的光标。</p><p id="5b2d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然后我们得到第一个日期值对:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="3394" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们现在只需要光标继续向左移动。为此，我们需要设置:</p><ul class=""><li id="075b" class="mt mu it lc b ld le lg lh lj mv ln mw lr mx lv my mz na nb bi translated">光标移动的速度；</li><li id="4b4e" class="mt mu it lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated">光标移动的截止日期。</li></ul><p id="f05a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们将使用<em class="me">动作</em>对象的<em class="me"> move_by_offset </em>方法将光标从其最后一个已知位置移动到下一个位置。无限循环将使光标移动到我们设置的截止日期。当日期超过极限时，我们称之为<em class="me">突破</em>。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="58e9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这是我们预期的行为:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/c09f37577705b0e3dede7ece21ff992e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*sH6l2IyI2I2e9iIioQLllA.gif"/></div></figure><p id="9a7f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">很酷吧。！每次光标向左移动，它都会从标签中抓取一个新的值和日期。就像人类移动鼠标做笔记一样！</p><p id="75ca" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你在谷歌的一个图表中这样做，并且你改变了图表的时间范围，比如说，到年，一些日期可能会被跳过。这些日期即使手动也无法访问。可能是因为x轴对于这么小的图表来说变得太大了。</p><p id="b8e3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">此外，重要的是要明确节奏是由反复试验决定的。如果速度太小，光标将需要很长时间才能移动到图表中的下一个日期。如果太大，它可能会跳过日期。</p><p id="40bf" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然而，不可避免的是，有时光标仍然会在同一个日期，即使它刚刚移动。因此，最好将数据存储在字典中，并用它来丢弃重复的数据。当我们完成抓取时，我们可以将这个字典转换成一个数据帧。这是完整的代码:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="d021" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这是我们刚刚收集的数据:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/0e81dcd95b413107037d46071e3d09a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:270/format:webp/1*Ayo3lJOTO_fcI1ffjrq6cg.png"/></div></figure><p id="114e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">最后一个警告:如果你正在观察光标在这条线上的移动，你会注意到它在每一次循环中都回到了起点。即使<em class="me"> selenium </em>保持最后的位置，也会发生这种情况，但是您也可以注意到，光标在每个新循环中以我们建立的<em class="me">速度</em>继续向左移动。所以，一切都按计划进行。</p><p id="eb1f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">嗯，就是这样。我希望你喜欢它，这可能是有用的。如果你有问题，有建议，或者只是想保持联系，请随时通过<a class="ae kz" href="https://twitter.com/_otavioss" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae kz" href="https://github.com/otavio-s-s/data_science" rel="noopener ugc nofollow" target="_blank"> GitHub </a>或<a class="ae kz" href="https://www.linkedin.com/in/otavioss28/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>联系。</p></div></div>    
</body>
</html>