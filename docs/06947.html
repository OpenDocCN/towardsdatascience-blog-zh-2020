<html>
<head>
<title>Medical images segmentation with Keras: U-net architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于 Keras 的医学图像分割:U-net 架构</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/medical-images-segmentation-using-keras-7dc3be5a8524?source=collection_archive---------9-----------------------#2020-05-29">https://towardsdatascience.com/medical-images-segmentation-using-keras-7dc3be5a8524?source=collection_archive---------9-----------------------#2020-05-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="977f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何构建肝脏分割算法。包括数据预处理、建模和结果可视化的教程。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fb441489e59ba7174dc523dff2ab421f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LLclmYwmsDUseZAY"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Olga Guryanova 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class="kw kx gp gr ky kz"><a href="https://github.com/soribadiaby/Deep-Learning-liver-segmentation" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">soribadiaby/深度学习肝脏分割</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">目的:目的是通过计算机视觉在病人扫描图像上自动描绘肝脏。使用的方法是…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="li l"><div class="lj l lk ll lm li ln kp kz"/></div></div></a></div></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="a7e7" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">介绍</h1><p id="6a87" class="pw-post-body-paragraph mn mo iq mp b mq mr jr ms mt mu ju mv mw mx my mz na nb nc nd ne nf ng nh ni ij bi translated"><a class="ae kv" href="http://www5.cs.fau.de/research/groups/medical-image-segmentation" rel="noopener ugc nofollow" target="_blank"> <strong class="mp ir">医学图像分割</strong>是自动或半自动检测 2D 或 3D 图像内边界的过程</a></p><p id="e2b1" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">医学图像的分割长期以来一直是一个活跃的研究课题，因为人工智能可以帮助对抗许多疾病，如癌症。自动、精确和快速地执行这项任务将有助于专家的工作，并且能够用可靠的方法更好地治疗病人。</p><p id="2579" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">在这篇文章中，我们将看到如何在实际的病人扫描数据集上使用 U-net 架构自动分割肝脏。希望你会喜欢它。</p><h1 id="c932" class="lv lw iq bd lx ly no ma mb mc np me mf jw nq jx mh jz nr ka mj kc ns kd ml mm bi translated">数据</h1><p id="4e10" class="pw-post-body-paragraph mn mo iq mp b mq mr jr ms mt mu ju mv mw mx my mz na nb nc nd ne nf ng nh ni ij bi translated">此处提供 NifTi 格式的数据<a class="ae kv" href="https://www.dropbox.com/s/8h2avwtk8cfzl49/ircad-dataset.zip?dl=0" rel="noopener ugc nofollow" target="_blank">。NifTi(神经成像信息学技术倡议)是一种开放的文件格式，通常用于存储使用磁共振成像方法获得的脑成像数据。有一个叫做 nibabel 的 Python 包，我们将用它来处理这种数据。</a></p><p id="d4f5" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">我们将使用的数据集由 20 个 3D 医学检查组成，它包含源图像以及每个图像的肝脏分割模板。这些数据来自法国的 IRCAD 医学研究中心。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7b3be6ebc8e8e1155f3eb7d09c5e4074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*we3iwCY6Nzfy77ySpZ28Tw.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:<a class="ae kv" href="https://www.ircad.fr/fr/recherche/3d-ircadb-01-fr/" rel="noopener ugc nofollow" target="_blank"> ircad </a></p></figure><p id="8cf3" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">为了执行我们的任务，我们显然不会只使用 20 个数据(这在深度学习中真的很少)。为了增加我们的数据，我们将使用轴向二维切片。</p><h1 id="21a3" class="lv lw iq bd lx ly no ma mb mc np me mf jw nq jx mh jz nr ka mj kc ns kd ml mm bi translated">模型</h1><p id="75bd" class="pw-post-body-paragraph mn mo iq mp b mq mr jr ms mt mu ju mv mw mx my mz na nb nc nd ne nf ng nh ni ij bi translated">我们将训练一个 U-net 架构，一个完全卷积的网络。这种体系结构的原理是在通常的收缩网络层中添加上采样操作符，而不是池。</p><p id="af14" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">这允许网络学习上下文(收缩路径)，然后学习定位(扩展路径)。由于跳过连接，上下文信息被传播到更高分辨率的层。所以我们有和输入一样大小的图像:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/24172dfa24c33281087e9f7e53639aa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EaY7ImL1gy-KFWdBIfYi8g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">U-net 架构</p></figure><h1 id="232f" class="lv lw iq bd lx ly no ma mb mc np me mf jw nq jx mh jz nr ka mj kc ns kd ml mm bi translated">公制的</h1><p id="3859" class="pw-post-body-paragraph mn mo iq mp b mq mr jr ms mt mu ju mv mw mx my mz na nb nc nd ne nf ng nh ni ij bi translated">作为度量，我们使用<a class="ae kv" href="https://en.wikipedia.org/wiki/S%C3%B8rensen%E2%80%93Dice_coefficient" rel="noopener ugc nofollow" target="_blank">骰子系数</a>(与 Jaccard 系数非常相似)。它是衡量两个样本相似性的统计指标:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/0074b36421e13a56bb7afddd0dead397.png" data-original-src="https://miro.medium.com/v2/resize:fit:408/format:webp/1*Ongs3Slhjc6PihFsGRSnyA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">骰子系数公式</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/f06ac010e8b9728f8744b27ab5b01eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N3qxsjyQURQJUr_VaMRB6g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">设置交集</p></figure><p id="24a2" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">在这个图中我们可以清楚地看到:如果 dice 系数等于 1，就表示我们比较的两个样本完全相等！所以越接近 1 越好。</p><p id="a164" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">现在我们已经建立了框架，我们可以开始项目了。</p><h1 id="4938" class="lv lw iq bd lx ly no ma mb mc np me mf jw nq jx mh jz nr ka mj kc ns kd ml mm bi translated">项目结构</h1><p id="6745" class="pw-post-body-paragraph mn mo iq mp b mq mr jr ms mt mu ju mv mw mx my mz na nb nc nd ne nf ng nh ni ij bi translated">在您的项目文件夹中创建一个“原始”文件夹:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/2293257df25c3d9af9c3fe2e90d6a56d.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*zjkbwF7ELD3ysNnm9z-PRw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">项目结构</p></figure><p id="8a87" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">在“原始”文件夹中，创建一个“测试”文件夹和一个“训练”文件夹。</p><p id="ce8d" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">然后将数据分成两组(训练和测试，通常我们对训练集使用 13 个样本，对测试集使用 7 个样本)，并将它们放在相应的目录中。</p><p id="d0c6" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">我们将在最后两部分看到“data.py”和“train.ipynb”中写什么。</p><h1 id="85cc" class="lv lw iq bd lx ly no ma mb mc np me mf jw nq jx mh jz nr ka mj kc ns kd ml mm bi translated">数据预处理</h1><p id="8905" class="pw-post-body-paragraph mn mo iq mp b mq mr jr ms mt mu ju mv mw mx my mz na nb nc nd ne nf ng nh ni ij bi translated">预处理部分在深度学习任务中至关重要，因为神经网络需要某种格式的数据。</p><p id="1dca" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">在这一部分中，我将向您展示将数据转换为 numpy 数组的 python 代码，我们将把这些数组提供给神经网络。为此，我们将把三维数据转换成二维数据。然后把他们救进来”。npy”格式，以便在进一步的培训中使用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">data.py</p></figure><p id="5295" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">现在我们已经准备好了数据，让我们进入最后一步:培训！</p><h1 id="b98b" class="lv lw iq bd lx ly no ma mb mc np me mf jw nq jx mh jz nr ka mj kc ns kd ml mm bi translated">用 Keras 训练神经网络</h1><p id="026b" class="pw-post-body-paragraph mn mo iq mp b mq mr jr ms mt mu ju mv mw mx my mz na nb nc nd ne nf ng nh ni ij bi translated">在这一部分中，我将向您展示设置架构、训练神经网络并将结果存储在文件中的笔记本(代码灵感来自<a class="ae kv" href="https://github.com/jocicmarko/ultrasound-nerve-segmentation" rel="noopener ugc nofollow" target="_blank">这个</a>回购)，请不要犹豫参考注释以了解代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">train.ipynb</p></figure><p id="8f1f" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">多亏了“mark_boundaries”函数，我们将能够看到带有黄色标记的分割结果。</p><h1 id="ad75" class="lv lw iq bd lx ly no ma mb mc np me mf jw nq jx mh jz nr ka mj kc ns kd ml mm bi translated">结果</h1><p id="e21a" class="pw-post-body-paragraph mn mo iq mp b mq mr jr ms mt mu ju mv mw mx my mz na nb nc nd ne nf ng nh ni ij bi translated">终于有结果了！我们的工作得到了回报，这些曲线代表了 20 个时期的训练和测试骰子系数。测试的骰子系数几乎达到了 0.87，这是相当令人满意的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/548f794c96aaea55f8f98961fba1091a.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*6SIScVmyjkQ_eQC9DQHupw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">骰子在时代上的系数</p></figure><p id="bcd5" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">你会在“preds”目录中看到这种代表 2D 切割的结果。用黄色标出的是由算法预测的肝脏:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/73171df8f86a672b2fd727c948349e52.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*7bGin4ps5-M-4Hrg-R3tSg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">分割结果</p></figure><p id="66a3" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">我们现在可以在几秒钟内分割数千次扫描！一项需要专家花费更长时间的任务。</p><h1 id="5977" class="lv lw iq bd lx ly no ma mb mc np me mf jw nq jx mh jz nr ka mj kc ns kd ml mm bi translated">结论</h1><p id="4eb0" class="pw-post-body-paragraph mn mo iq mp b mq mr jr ms mt mu ju mv mw mx my mz na nb nc nd ne nf ng nh ni ij bi translated">最后，我们使用骰子系数几乎达到 0.87 的 U-net 架构成功地训练了我们的神经网络！</p><p id="e7c4" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated"><strong class="mp ir">改进轨迹</strong>:</p><ul class=""><li id="6137" class="oc od iq mp b mq nj mt nk mw oe na of ne og ni oh oi oj ok bi translated">通过堆叠二维分割图像来重建三维扫描。</li><li id="ab08" class="oc od iq mp b mq ol mt om mw on na oo ne op ni oh oi oj ok bi translated">通过沿几个斜轴制作二维切片，将数据放大更多</li></ul><p id="5f41" class="pw-post-body-paragraph mn mo iq mp b mq nj jr ms mt nk ju mv mw nl my mz na nm nc nd ne nn ng nh ni ij bi translated">希望这篇文章对你有用。感谢阅读。</p></div></div>    
</body>
</html>