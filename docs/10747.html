<html>
<head>
<title>Improving massively imbalanced datasets in machine learning with synthetic data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用合成数据改进机器学习中的大规模不平衡数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/improving-massively-imbalanced-datasets-in-machine-learning-with-synthetic-data-7dd3d856bbdf?source=collection_archive---------37-----------------------#2020-07-27">https://towardsdatascience.com/improving-massively-imbalanced-datasets-in-machine-learning-with-synthetic-data-7dd3d856bbdf?source=collection_archive---------37-----------------------#2020-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="df41" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们将使用合成数据和 SMOTE 中的一些概念来提高欺诈、网络安全或任何极少数类别分类的模型准确性</h2></div><p id="b102" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在机器学习中处理不平衡的数据集是一项艰巨的挑战，可能包括支付欺诈、诊断癌症或疾病，甚至网络安全攻击等主题。所有这些交易的共同点是，在所有交易中，只有很小一部分是真正的欺诈，而这些交易才是我们真正关心的。在本帖中，我们将通过训练一个生成合成数据模型来创建额外的欺诈记录，从而提高<a class="ae le" href="https://www.kaggle.com/mlg-ulb/creditcardfraud" rel="noopener ugc nofollow" target="_blank">流行的 Kaggle 欺诈数据集</a>的准确性。独特的是，该模型将结合来自欺诈性记录及其最近邻居的特征，这些特征被标记为非欺诈性的，但与欺诈性记录足够接近，以至于有点“可疑”。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/1c54f7289bcaca44a526e1bb84d6483e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ncKq5awHMpuwL6Ckv0QSXA.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">特征图像 Gretel.ai</p></figure><h1 id="4e43" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">我们不平衡的数据集</h1><p id="f5c3" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">在这篇文章中，我们选择了 Kaggle 上流行的“<a class="ae le" href="https://www.kaggle.com/mlg-ulb/creditcardfraud" rel="noopener ugc nofollow" target="_blank">信用卡欺诈检测</a>”数据集。该数据集包含 2013 年 9 月欧洲信用卡持有者的标记交易。为了保护用户身份，数据集将敏感特征降维为 27 个浮点列(V1–27)和一个时间列(数据集中此事务和第一个事务之间经过的秒数)。在这篇文章中，我们将使用信用卡欺诈数据集中的前 10k 条记录——点击下面的链接，在 Google 联合实验室中生成下面的图表。</p><div class="ms mt gp gr mu mv"><a href="https://colab.research.google.com/github/gretelai/gretel-synthetics/blob/master/examples/research/synthetics_knn_classify_and_visualize.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">分类并可视化欺诈数据集</h2><div class="nc l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">colab.research.google.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni lp mv"/></div></div></a></div><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nj"><img src="../Images/12c0aad756c590774e217ddd92cf5d0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ZeY7mc4B_KxS4lKT3VPOg.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">一个极度不平衡的数据集</p></figure><h1 id="fcfa" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">度量陷阱</h1><p id="84b1" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">让我们看看使用最先进的 ML 分类器检测欺诈记录可以获得什么样的性能。我们首先将数据集分为训练集和测试集。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nk"><img src="../Images/faf5aa84cd407cb6e5f375870aa566f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E_C6xE2vKiCayWSgV_E_Xw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">对我们的默认欺诈数据集进行分类的结果</p></figure><p id="582f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">哇，99.75%的检出率。太棒了，对吧？！也许——查看整体模型准确性只是显示模型在整个集合中的表现有多好，而不是我们在检测欺诈记录方面做得有多好。要了解我们的实际表现，请打印一份混淆矩阵和准确性报告。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nl"><img src="../Images/d0a30906490ee39df4500b450196482e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RYVJjEOQ1qieAoI1zyN77w.png"/></div></div></figure><blockquote class="nm"><p id="3921" class="nn no it bd np nq nr ns nt nu nv ld dk translated">从上面我们可以看到，尽管我们的总体准确率为 99.75%，但在我们的测试集中，我们对 43%的欺诈示例进行了错误分类！</p></blockquote><h1 id="871d" class="lv lw it bd lx ly lz ma mb mc md me mf jz nw ka mh kc nx kd mj kf ny kg ml mm bi translated">用合成数据增加欺诈案例</h1><p id="7a1e" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">在本节中，我们将重点关注如何通过使用<a class="ae le" href="https://github.com/gretelai/gretel-synthetics" rel="noopener ugc nofollow" target="_blank"> gretel-synthetics </a>生成欺诈记录的更多示例，来提高欺诈记录的模型性能和泛化能力。让我们从我们想要完成的事情开始——我们的目标是生成额外的欺诈记录样本，这将帮助我们的分类器进行归纳，并更好地检测我们测试集中的欺诈记录。</p><h1 id="e74c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">合成少数过采样技术</h1><p id="7afb" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">数据科学社区中实现这一点的一种流行技术被称为 SMOTE(<strong class="kk iu">S</strong>yn intestic<strong class="kk iu">M</strong>inority<strong class="kk iu">O</strong>versampling<strong class="kk iu">Te</strong>technique)，由 Nitesh Chawla 等人在他们 2002 年的<a class="ae le" href="https://arxiv.org/abs/1106.1813" rel="noopener ugc nofollow" target="_blank">论文</a>中描述。SMOTE 的工作方式是从少数类中选择样本，在少数类中找到它们最近的邻居，并在它们之间有效地插入新点。SMOTE 不能合并来自少数类之外的记录的数据，在我们的示例中，这些记录可能包含有用的信息——包括欺诈性的或贴错标签的记录。</p><h1 id="978c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Gretel 合成了 SMOTE 的概念</h1><p id="3301" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">我们的训练集中只有 31 个欺诈数据的例子，这给泛化带来了独特的挑战，因为<a class="ae le" href="https://github.com/gretelai/gretel-synthetics" rel="noopener ugc nofollow" target="_blank"> gretel-synthetics </a>利用深度学习技术来学习和生成新的样本，这在传统上需要大量数据才能收敛。打开下面的笔记本，使用 Google Colab 免费生成您自己的合成欺诈数据集。</p><div class="ms mt gp gr mu mv"><a href="https://colab.research.google.com/github/gretelai/gretel-synthetics/blob/master/examples/research/synthetics_knn_generate.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">格雷特-合成-生成-欺诈-数据</h2><div class="nc l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">colab.research.google.com</p></div></div><div class="nd l"><div class="nz l nf ng nh nd ni lp mv"/></div></div></a></div><p id="257b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过借用 SMOTE 找到欺诈集的最近邻居的方法，并结合来自多数类的几个最近邻居，我们有机会扩展我们的训练集示例，并结合从我们的欺诈类(<strong class="kk iu">姑且称之为可疑</strong>)记录中获得的一些知识。这种方法不需要对<a class="ae le" href="https://github.com/gretelai/gretel-synthetics" rel="noopener ugc nofollow" target="_blank"> Gretel Synthetics </a>做任何更改，我们只是智能地从欺诈+最近正邻居(shady)记录中挑选数据集。我们开始吧！</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="50c2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了构建我们的合成模型，将使用 Gretel 的新<a class="ae le" href="https://gretel-synthetics.readthedocs.io/en/stable/api/batch.html" rel="noopener ugc nofollow" target="_blank">数据框架训练模式</a>默认值和以下几个参数集来优化结果:</p><ol class=""><li id="4f90" class="oc od it kk b kl km ko kp kr oe kv of kz og ld oh oi oj ok bi translated"><code class="fe ol om on oo b">epochs: 7</code>。将 epochs 设置为尽可能低的设置，以平衡创建有效记录，而不会过度适应我们有限的训练集。</li><li id="82c8" class="oc od it kk b kl op ko oq kr or kv os kz ot ld oh oi oj ok bi translated"><code class="fe ol om on oo b">dp: False</code>。在这种情况下，不需要考虑运行差分隐私对准确性的影响。</li><li id="c80a" class="oc od it kk b kl op ko oq kr or kv os kz ot ld oh oi oj ok bi translated"><code class="fe ol om on oo b">gen_lines: 1000</code>。我们将生成 1000 条记录，以增强我们现有的 31 个正面示例。注意，并不是所有从我们的模型生成的记录都是正面的，因为我们合并了一些负面的例子——但是我们至少应该有几百个新的正面例子。</li><li id="913b" class="oc od it kk b kl op ko oq kr or kv os kz ot ld oh oi oj ok bi translated"><code class="fe ol om on oo b">batch_size=32</code>。将所有 30 行放入单个神经网络模型中，以保留所有字段-字段相关性，代价是更多记录未通过验证。</li><li id="12cb" class="oc od it kk b kl op ko oq kr or kv os kz ot ld oh oi oj ok bi translated">训练模型，生成行，并且只保留由合成数据模型创建的“欺诈性”记录</li></ol><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h1 id="10a7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">检查我们的合成数据集</h1><p id="dc00" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">现在，让我们来看看我们的合成数据，看看我们是否可以直观地确认我们的合成记录是他们接受培训的欺诈记录的代表。我们的数据集有 30 个维度，因此我们将使用数据科学中的一种称为主成分分析(PCA)的降维技术来以 2D 和 3D 方式可视化数据。</p><p id="d5b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面我们可以看到我们的训练、合成和测试数据集被压缩成二维。从视觉上看，除了 31 个原始训练示例之外，883 个新的欺诈性合成记录可能对分类器非常有帮助。我们添加了 7 个测试集正面例子(其中我们的默认模型误分类了 3/7，我们希望增强的合成数据将有助于提高检测。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ou"><img src="../Images/16f615b1e9af5be0d3552547dc4b2369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bg5JgUkFIbdTYzNWLzbVkA.png"/></div></div></figure><p id="512c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从我们的图表中可以看出，我们合成生成的欺诈示例可能真的很有用！注意在训练负集附近出现的假阳性例子。如果你看到很多这样的例子，试着将<code class="fe ol om on oo b">NEAREST_NEIGHBOR_COUNT</code>从 5 减少到 3 以获得更好的结果。让我们把同样的 PCA 可视化 3 维。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ov"><img src="../Images/9e830d05f02e68d0bb9163149274b37e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_LARl50aGYFjTMaVVxrsKg.png"/></div></div></figure><p id="edcf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">查看上面的数据集，似乎用合成数据增强我们的少数欺诈记录集可能对模型性能有很大帮助。我们试试吧！</p><h1 id="db38" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用合成数据增强我们的训练数据集</h1><p id="b6aa" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">现在，我们重新加载训练和测试数据集，但这一次用新生成的合成记录增加了现有的训练数据。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ow"><img src="../Images/889a149cfaeb131a5ee1a6a2fce546b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_65jW8aRrX1ZvSo9zBrvmw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">增加 852 个合成例子，使我们的负/正比从 257 降低到 9 倍！</p></figure><p id="3b9d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在扩充数据集上训练 XGBoost，针对测试数据集运行模型，并检查混淆矩阵。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ox"><img src="../Images/0ccefa34b7c45793c97daa7d22176194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3AkwQxkfC9tck5kVrxfYDg.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">借助额外的欺诈示例检测，欺诈检测率提高了 14%!</p></figure><p id="d461" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们所见，训练机器学习模型来准确检测极端少数类是一个严峻的挑战。但是，合成数据创造了一种提高准确性的方法，并有可能提高模型归纳到新数据集的能力，并且可以独特地将整个数据集的特征和相关性合并到合成欺诈示例中。</p><p id="e7e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，试着用你自己的数据运行上面的笔记本。想了解更多关于合成数据的信息吗？点击这里的和这里的查看关于数据科学的文章。</p><h1 id="643f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结束语</h1><p id="9569" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">在<a class="ae le" href="https://gretel.ai/" rel="noopener ugc nofollow" target="_blank"> Gretel.ai </a>，我们对使用合成数据来增强训练集以创建 ML 和 ai 模型的可能性感到非常兴奋，这些模型可以更好地概括未知数据，并减少算法偏差。我们很乐意听到您的使用案例——欢迎在评论、<a class="ae le" href="https://twitter.com/gretel_ai" rel="noopener ugc nofollow" target="_blank"> twitter </a>或<a class="ae le" href="mailto:hi@gretel.ai" rel="noopener ugc nofollow" target="_blank"> hi@gretel.ai </a>中联系我们进行更深入的讨论。关注我们，用合成数据跟上最新趋势！</p><p id="3eb7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有兴趣在自己的数据集上进行训练吗？<a class="ae le" href="https://github.com/gretelai/gretel-synthetics" rel="noopener ugc nofollow" target="_blank"> Gretel-synthetics </a>是免费开源的，你可以通过<a class="ae le" href="https://camo.githubusercontent.com/52feade06f2fecbf006889a904d221e6a730c194/68747470733a2f2f636f6c61622e72657365617263682e676f6f676c652e636f6d2f6173736574732f636f6c61622d62616467652e737667" rel="noopener ugc nofollow" target="_blank">联合实验室</a>在几秒钟内开始实验。如果你喜欢 gretel-synthetics，请在 GitHub 上给我们一个⭐！</p></div></div>    
</body>
</html>