<html>
<head>
<title>Local Development Set-Up of PostgreSQL with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Docker进行PostgreSQL的本地开发设置</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/local-development-set-up-of-postgresql-with-docker-c022632f13ea?source=collection_archive---------0-----------------------#2020-04-16">https://towardsdatascience.com/local-development-set-up-of-postgresql-with-docker-c022632f13ea?source=collection_archive---------0-----------------------#2020-04-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a4e1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用Docker容器设置开发SQL的本地环境的简单方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2b32139becb70407cadcd9b6724c49a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HCC9rbkkVXU4bkn9D_oueA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿姆斯特丹的地方设置，来源:由<a class="ae ky" href="https://unsplash.com/s/photos/amsterdam?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@paramir?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Ehud Neuhaus </a>拍摄的照片</p></figure><h1 id="eae0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="b4b1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">当您面临一个必须使用SQL的项目或技术任务时，您要么需要访问数据库，要么需要将它安装在本地。这两种情况都很烦人，所以我将解释当我面临这种情况时我通常会做什么，同时等待提供完整的基础设施和访问。</p><p id="984f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这篇短文中，我将指导您运行一个PostgreSQL容器和一个pgAdmin容器。之后，我将向您展示如何使用pgAdmin门户连接到数据库实例来运行您的查询。您可以将此作为开发SQL的简单设置，作为应用程序的一部分，或者只是为了练习您的SQL技能。</p><p id="6d4b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我将使用<a class="ae ky" href="https://docs.docker.com/docker-for-mac/install/" rel="noopener ugc nofollow" target="_blank"> Docker(版本19.03.8) </a>，所以确保你已经在你的机器上安装了它。</p><h1 id="fd33" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">正在启动PostgreSQL实例</h1><p id="0702" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这里我们要做的是首先下载PostgreSQL映像，检查映像是否准备好，最后用特定的参数运行映像。</p><p id="ae80" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您可以通过在命令行中运行以下命令，从docker hub存储库中下载Postgres的Docker官方映像。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="3760" class="mx la it mt b gy my mz l na nb">$ docker pull postgres</span></pre><p id="795b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你可以在这里找到镜像的文档:<a class="ae ky" href="https://github.com/docker-library/docs/blob/master/postgres/README.md" rel="noopener ugc nofollow" target="_blank"> PostgreSQL镜像文档</a>。</p><p id="7fe1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下载图像后，您可以检查是否可以使用:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="400a" class="mx la it mt b gy my mz l na nb">$ docker images<br/>&gt;&gt;&gt;<br/>REPOSITORY    TAG       IMAGE ID        CREATED        SIZE<br/>postgres      latest    9907cacf0c01    2 weeks ago    314MB</span></pre><p id="3813" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将创建一个本地文件夹，并将其挂载为运行容器的数据卷，以便将所有数据库文件存储在一个已知的位置。在“run”命令中，我们还将把端口从主机映射到正在运行的容器以及Postgres默认用户的密码。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="4d04" class="mx la it mt b gy my mz l na nb">## 1. Create a folder in a known location for you<br/>$ mkdir ${HOME}/postgres-data/</span><span id="57fe" class="mx la it mt b gy nc mz l na nb">## 2. run the postgres image<br/>$ docker run -d \<br/>	--name dev-postgres \<br/>	-e POSTGRES_PASSWORD=Pass2020! \<br/>	-v ${HOME}/postgres-data/:/var/lib/postgresql/data \<br/>        -p 5432:5432<br/>        postgres</span><span id="e323" class="mx la it mt b gy nc mz l na nb">## 3. check that the container is running<br/>$ docker ps<br/>&gt;&gt;&gt;<br/>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES<br/>dfa570d6e843        postgres            "docker-entrypoint.s…"   27 hours ago        Up 3 seconds        0.0.0.0:5432-&gt;5432/tcp   postgres-test</span></pre><p id="4033" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">很好，您有一个正在运行的<strong class="lt iu"> PostgreSQL </strong>实例，您应该能够从命令行进入容器并测试数据库实例:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="1473" class="mx la it mt b gy my mz l na nb">$ docker exec -it dev-postgres bash<br/>&gt;&gt;&gt; Now you are in the container's bash console. Connect to the database<br/>root@dfa570d6e843:/# psql -h localhost -U postgres<br/>&gt;&gt;&gt;<br/>psql (12.2 (Debian 12.2-2.pgdg100+1))</span><span id="3e97" class="mx la it mt b gy nc mz l na nb">Type "help" for help.</span><span id="134e" class="mx la it mt b gy nc mz l na nb">postgres-# \l</span><span id="4201" class="mx la it mt b gy nc mz l na nb">List of databases<br/>Name       |  Owner   | Encoding |  Collate   |   Ctype    |   ...<br/>-----------+----------+----------+------------+------------+------postgres   | postgres |   UTF8   | en_US.utf8 | en_US.utf8 |   ...</span></pre><p id="1fd1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您应该会看到Postgres数据库和与上面类似的输出。</p><p id="2294" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">数据库服务到此结束，现在让我们设置数据库管理工具。</p><h1 id="1778" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">启动pgAdmin实例</h1><p id="80b1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">pgAdmin是PostgreSQL最流行、功能最丰富的开源管理和开发平台。您将使用它来管理DB实例，以及对它的表运行查询。</p><p id="1bfc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您将使用这个<a class="ae ky" href="https://hub.docker.com/r/dpage/pgadmin4/" rel="noopener ugc nofollow" target="_blank"> docker映像</a>将其部署到一个容器中。使用以下命令获取映像并运行映像的实例:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="face" class="mx la it mt b gy my mz l na nb">$ docker pull dpage/pgadmin4<br/>$ docker run \ <br/>    -p 80:80 \<br/>    -e 'PGADMIN_DEFAULT_EMAIL=user@domain.local' \<br/>    -e 'PGADMIN_DEFAULT_PASSWORD=SuperSecret' \<br/>    --name dev-pgadmin \ <br/>    -d dpage/pgadmin4</span></pre><p id="8732" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们传递给docker run命令的参数是:</p><ul class=""><li id="705c" class="nd ne it lt b lu mn lx mo ma nf me ng mi nh mm ni nj nk nl bi translated"><code class="fe nm nn no mt b">-p 80:80</code>:该参数告诉docker将容器中的端口80映射到你的计算机(Docker主机)中的端口80</li><li id="206e" class="nd ne it lt b lu np lx nq ma nr me ns mi nt mm ni nj nk nl bi translated"><code class="fe nm nn no mt b">-e 'PGADMIN_DEFAULT_EMAIL</code>:默认用户电子邮件的环境变量，以后您将使用它登录门户</li><li id="1304" class="nd ne it lt b lu np lx nq ma nr me ns mi nt mm ni nj nk nl bi translated"><code class="fe nm nn no mt b">-e 'PGADMIN_DEFAULT_PASSWORD'</code>:默认用户密码的环境变量</li><li id="5e09" class="nd ne it lt b lu np lx nq ma nr me ns mi nt mm ni nj nk nl bi translated"><code class="fe nm nn no mt b">-d</code>:该参数告诉docker以分离模式启动容器</li><li id="c395" class="nd ne it lt b lu np lx nq ma nr me ns mi nt mm ni nj nk nl bi translated"><code class="fe nm nn no mt b">dpage/pgadmin4</code>:这个参数告诉docker使用我们之前下载的图像</li></ul><p id="ae4b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们检查一下容器是否已经启动并正在运行，您还应该看到前一个容器正在运行:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="e7f9" class="mx la it mt b gy my mz l na nb">$ docker ps<br/>&gt;&gt;&gt;<br/>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                         NAMES<br/>7b15fe4c1cbd        dpage/pgadmin4      "/entrypoint.sh"         43 hours ago        Up 5 seconds        0.0.0.0:80-&gt;80/tcp, 443/tcp   dev-pgadmin</span></pre><p id="38c7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这就是你所有的服务启动和运行。下一步是从pgAdmin控制台连接到PostgreSQL实例。</p><h1 id="54f2" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">从pgAdmin工具访问PostgreSQL</h1><p id="be3c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们没有为这些容器定义任何网络，所以它们应该运行在默认的网络上，如果您试图通过它们的端口访问数据库或web门户，通过“localhost”或“127.0.0.1”连接就可以了；但是如果您尝试从一个容器连接到另一个容器，您可能会遇到一些连接问题。</p><p id="c7fa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们需要在我们的主机上查找PostgreSQL容器的IP地址，您可以为它运行以下命令:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="41d9" class="mx la it mt b gy my mz l na nb">$ docker inspect dev-postgres -f "{{json .NetworkSettings.Networks }}"</span></pre><p id="b615" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe nm nn no mt b">docker inspect</code>返回Docker对象的底层信息，在本例中是'<strong class="lt iu"> dev-postgres </strong>'实例的IP地址。在给定Go模板的情况下，<code class="fe nm nn no mt b">-f</code>参数将输出格式化为JSON。输出应该如下所示:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="5aa3" class="mx la it mt b gy my mz l na nb">{"bridge":{"IPAMConfig":null,"Links":null,"Aliases":null,"NetworkID":"60c21f5cfcaaff424a0e4a22463dc8f9a285993de04e7ac19ce5fd96bba56a47","EndpointID":"be6e45b659c30bd12aa766d7003a2887607053684b68574e426f8823104b18a2","Gateway":"172.17.0.1",<strong class="mt iu">"IPAddress":"172.17.0.2"</strong>,"IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"MacAddress":"02:42:ac:11:00:02","DriverOpts":null}}</span></pre><p id="6433" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">将IPAddress值复制到剪贴板，在我的例子中是172.17.0.2，您需要在pgAdmin工具中定义连接。</p><p id="bf21" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下一步是转到您的web浏览器，键入<a class="ae ky" href="http://localhost:80" rel="noopener ugc nofollow" target="_blank"> http://localhost:80 </a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/ab24eda95cc95a933c773fdb0e2c55b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_3NtB4Sbmnym2DMeAC6DLw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">pgAdmin登录门户，<a class="ae ky" href="http://localhost:80." rel="noopener ugc nofollow" target="_blank"> http://localhost:80。来源:当地</a></p></figure><p id="6206" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您应该键入运行容器时写下的用户电子邮件和密码。</p><p id="e775" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">进入门户后，您需要添加一个新服务器，方法是单击“<strong class="lt iu">添加新服务器</strong>”，并在弹出窗口中添加正确的信息，确保您在连接选项卡下的<em class="nv">主机名/地址</em>中添加了之前复制的IP地址。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/3012484d24d3fe7f0d7e2628a325ae3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9svfWJipuC1rHwC91xSgEw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自pgAdmin工具的欢迎页面。来源:当地</p></figure><p id="ad87" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">创建连接后，您应该会在屏幕右侧看到服务器。此时，您已经准备好开始构建您的数据库和表格，上传数据并查询您的分析或应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/bf4daf9f432029b6d066396b47c93f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T1nnGUHI15bblusIQtbd3Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">pgAdmin工具上的服务器仪表板。来源:当地</p></figure><h1 id="26c8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">包扎</h1><p id="46a8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们回顾一下到目前为止我们所做的工作:</p><ol class=""><li id="2997" class="nd ne it lt b lu mn lx mo ma nf me ng mi nh mm ny nj nk nl bi translated">用Docker独立运行PostgreSQL实例</li><li id="82f0" class="nd ne it lt b lu np lx nq ma nr me ns mi nt mm ny nj nk nl bi translated">用Docker独立运行一个pgAdmin服务器</li><li id="bbee" class="nd ne it lt b lu np lx nq ma nr me ns mi nt mm ny nj nk nl bi translated">设置pgAdmin和PostgreSQL之间的连接</li></ol><p id="0781" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您应该准备好直接在PostgreSQL上开发数据库、表和查询。您可以使用UI将文件直接导入到表中。</p><p id="5e8f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您还可以从本地的python应用程序连接到这个数据库，然后将结果加载到这个Postgres数据库，并使用Python或pgAdmin工具查询这些表。这取决于你如何使用这个堆栈，好的方面是你不需要等待一个基础设施的家伙给你一个数据库的访问权来开始你的主要目标，这是你的分析，应用程序，功能或简单的SQL培训(即使是你的下一个技术面试任务)。</p><p id="09a7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您还可以使用Docker-compose文件来完成所有这些设置，您可以在该文件中定义PostgreSQL服务和pgAdmin服务以及环境变量、卷和端口映射，并运行docker-compose up。结果应该是一样的。</p><p id="d0ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我希望这篇文章为您提供了足够的信息，告诉您如何在您的计算机上用Docker设置一个SQL实例来直接处理数据库、表和查询。如果您有任何问题或建议，请告诉我，我很乐意与您跟进。</p></div></div>    
</body>
</html>