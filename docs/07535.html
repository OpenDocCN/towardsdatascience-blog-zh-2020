<html>
<head>
<title>3 Lines of Python Code to Write A Web Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用3行Python代码编写一个Web服务器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-lines-of-python-code-to-write-a-web-server-46a109666dbf?source=collection_archive---------4-----------------------#2020-06-07">https://towardsdatascience.com/3-lines-of-python-code-to-write-a-web-server-46a109666dbf?source=collection_archive---------4-----------------------#2020-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/2ed50f642ff0e3639c7e1ab09b7f4f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d2fUKehIqos9XidW"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@kalenemsley?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡伦·艾姆斯利</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><div class=""/><div class=""><h2 id="e6e0" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">使用内置库“http.server”用Python编写的最简单的web服务器</h2></div><p id="a21d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要知道Python可以非常有效的用来写web服务器。据了解，目前有许多流行和优秀的框架和库，如Django和Flask，这使得后端开发人员可以专注于业务逻辑，节省了大量的编码时间。</p><p id="2d1c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，你知道Python的内置库<code class="fe lu lv lw lx b">http.server</code>也可以用来写web服务器吗？还有，你知道你甚至可能只用三行代码就写出一个吗？在本文中，我将向您展示如何在一分钟内编写并运行一个web服务器！</p><h1 id="65aa" class="ly lz jj bd ma mb mc md me mf mg mh mi kp mj kq mk ks ml kt mm kv mn kw mo mp bi translated">简单的准备</h1><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mq"><img src="../Images/613f3dcc2ac9325cddeaab851343cd38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PC8a6U6tqknxKW2h"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://unsplash.com/@heftiba?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Toa Heftiba </a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ea5d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">web服务器将需要在某个地方启动，因此您需要考虑要在哪里启动它。然后，你可能想把你的代码放在那里。</p><p id="e1f4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，我们需要导入<code class="fe lu lv lw lx b">http.server</code>库。可选地，建议导入<code class="fe lu lv lw lx b">os</code>库，以确保web服务器确实运行在“当前”目录中。换句话说，使用当前目录作为web服务器的根路径。</p><pre class="mr ms mt mu gt mv lx mw mx aw my bi"><span id="46b1" class="mz lz jj lx b gy na nb l nc nd">import os<br/>from http.server import HTTPServer, CGIHTTPRequestHandler</span></pre><p id="0a22" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从<code class="fe lu lv lw lx b">http.server</code>库中，我们需要<code class="fe lu lv lw lx b">HTTPServer</code>类来实例化服务器对象，以及<code class="fe lu lv lw lx b">CGIHTTPRequestHandler</code>类作为请求处理器。</p><p id="a517" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你不知道什么是<code class="fe lu lv lw lx b">CGI</code>，这里有一个来自维基百科的简短定义:</p><blockquote class="ne nf ng"><p id="dd2f" class="ky kz nh la b lb lc kk ld le lf kn lg ni li lj lk nj lm ln lo nk lq lr ls lt im bi translated">在计算中，<strong class="la jk">公共网关接口</strong> ( <strong class="la jk"> CGI </strong>)是一种接口规范，用于web服务器执行程序，如运行在动态生成网页的服务器上的控制台应用程序(也称为命令行接口程序)。这样的程序被称为CGI脚本或简称为T21 CGI。服务器如何执行脚本的细节由服务器决定。在一般情况下，CGI脚本在发出请求时执行，并生成HTML。[1]</p></blockquote><h1 id="fd8d" class="ly lz jj bd ma mb mc md me mf mg mh mi kp mj kq mk ks ml kt mm kv mn kw mo mp bi translated">三行代码</h1><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nl"><img src="../Images/a51bbf324477d7b92ec5cccd9b4115d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sw2Ta_BQQZ3x5Mhy"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">乔希·里默尔在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3ba2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，让我们用三行代码编写服务器，不开玩笑。</p><h2 id="a356" class="mz lz jj bd ma nm nn dn me no np dp mi lh nq nr mk ll ns nt mm lp nu nv mo nw bi translated">第一行</h2><p id="d64d" class="pw-post-body-paragraph ky kz jj la b lb nx kk ld le ny kn lg lh nz lj lk ll oa ln lo lp ob lr ls lt im bi translated">让我们确保在当前目录下创建服务器，并将其用作根路径。<code class="fe lu lv lw lx b">os.chdir()</code>方法会将路径设置为当前工作目录。这里我们将当前目录<code class="fe lu lv lw lx b">.</code>设置为它的工作目录。</p><pre class="mr ms mt mu gt mv lx mw mx aw my bi"><span id="6fec" class="mz lz jj lx b gy na nb l nc nd"># Make sure the server is created at current directory<br/>os.chdir('.')</span></pre><h2 id="cb47" class="mz lz jj bd ma nm nn dn me no np dp mi lh nq nr mk ll ns nt mm lp nu nv mo nw bi translated">第二行</h2><p id="e7d4" class="pw-post-body-paragraph ky kz jj la b lb nx kk ld le ny kn lg lh nz lj lk ll oa ln lo lp ob lr ls lt im bi translated">让我们从<code class="fe lu lv lw lx b">HTTPServer</code>类创建一个“服务器对象”。它有两个参数，第一个是<code class="fe lu lv lw lx b">server_address</code>,它是</p><ul class=""><li id="ce97" class="oc od jj la b lb lc le lf lh oe ll of lp og lt oh oi oj ok bi translated">侦听的地址，其中空字符串表示侦听本地主机</li><li id="0449" class="oc od jj la b lb ol le om lh on ll oo lp op lt oh oi oj ok bi translated">侦听的端口号。我将使用端口80，这样我就不必输入端口号来访问。您可以选择使用其他端口号，如8080</li></ul><pre class="mr ms mt mu gt mv lx mw mx aw my bi"><span id="6277" class="mz lz jj lx b gy na nb l nc nd"># Create server object listening the port 80<br/>server_object = HTTPServer(server_address=('', 80), RequestHandlerClass=CGIHTTPRequestHandler)</span></pre><p id="7cae" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二个参数是请求处理程序类。这里我们使用已经导入的<code class="fe lu lv lw lx b">CGIHTTPRequestHandler</code>。</p><h2 id="2404" class="mz lz jj bd ma nm nn dn me no np dp mi lh nq nr mk ll ns nt mm lp nu nv mo nw bi translated">第三行</h2><p id="b157" class="pw-post-body-paragraph ky kz jj la b lb nx kk ld le ny kn lg lh nz lj lk ll oa ln lo lp ob lr ls lt im bi translated">没别的，我们跑吧！</p><pre class="mr ms mt mu gt mv lx mw mx aw my bi"><span id="c732" class="mz lz jj lx b gy na nb l nc nd"># Start the web server<br/>server_object.serve_forever()</span></pre><p id="e0a9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">serve_forever()</code>方法将基于我们刚刚创建的服务器对象启动服务器，并确保它持续运行。</p><h2 id="d269" class="mz lz jj bd ma nm nn dn me no np dp mi lh nq nr mk ll ns nt mm lp nu nv mo nw bi translated">所有代码放在一起</h2><pre class="mr ms mt mu gt mv lx mw mx aw my bi"><span id="dc33" class="mz lz jj lx b gy na nb l nc nd">Here is all the code:</span><span id="6af0" class="mz lz jj lx b gy oq nb l nc nd">import os<br/>from http.server import HTTPServer, CGIHTTPRequestHandler</span><span id="9955" class="mz lz jj lx b gy oq nb l nc nd"># Make sure the server is created at current directory<br/>os.chdir('.')<br/># Create server object listening the port 80<br/>server_object = HTTPServer(server_address=('', 80), RequestHandlerClass=CGIHTTPRequestHandler)<br/># Start the web server<br/>server_object.serve_forever()</span></pre><h1 id="e53a" class="ly lz jj bd ma mb mc md me mf mg mh mi kp mj kq mk ks ml kt mm kv mn kw mo mp bi translated">测试服务器以及我们为什么需要它</h1><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi or"><img src="../Images/e5aa5eeda501e40bd9b63c3e150fe7d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pgUDazi2rCqIBJhn"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">本·怀特在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="32ce" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将所有代码保存到一个名为<code class="fe lu lv lw lx b">pyserver.py</code>的文件中。然后，转到命令行并运行Python脚本。</p><pre class="mr ms mt mu gt mv lx mw mx aw my bi"><span id="12d8" class="mz lz jj lx b gy na nb l nc nd">python pyserver.py</span></pre><p id="ac95" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您将在stdout中看到预期的任何输出。去你的浏览器输入<code class="fe lu lv lw lx b">localhost</code>，网络服务器已经开始工作了。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi os"><img src="../Images/817498ea6f53dc5e78b1288f71e35e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*bE1io1TzfdWa_KTs34JImQ.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">web服务器根目录的屏幕截图</p></figure><p id="4d6f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，这个web服务器将允许您从根路径浏览文件。</p><p id="7449" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，你可能会问我为什么需要这个web服务器？对，没那么有用。但是想想你能用网络浏览器做什么？例如，我过去常常下载一些通常是PDF格式的学术研究论文。你会发现在网页浏览器中浏览子文件夹和打开PDF文件比使用Windows资源管理器和Mac OS Finder要快得多。</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/4752944e3d8299f4e5dab9f95078936d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*xKriDb_HGj-HnYidRMvx9w.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">包含PDF文件的文件夹的屏幕截图</p></figure><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ou"><img src="../Images/d61c02b80421681942aa294af78f0c5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BbZNgHbRPZmo5U5vLBQjXg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">打开的PDF文件的屏幕截图</p></figure><p id="8b36" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">同样，在这个例子中，我们在本地机器上运行web服务器。如果您可以在远程机器上运行这个Python脚本，那么您将获得一个非常快速的文件共享服务器！</p><h1 id="fb39" class="ly lz jj bd ma mb mc md me mf mg mh mi kp mj kq mk ks ml kt mm kv mn kw mo mp bi translated">总结和注意事项</h1><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ov"><img src="../Images/570c86319af2ef98451be46f2c10fe3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1cYh5Ala0AoAj6nk"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@gohrhyyan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">吴礼仁</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0154" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我介绍了如何只用三行Python代码编写一个web服务器，让您可以浏览服务器上的文件。</p><p id="149d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，需要注意的是，实现如此简单的<code class="fe lu lv lw lx b">http.server</code>是不安全的。因此，请不要在重要的环境中只使用这三行代码，这可能会成为潜在的安全漏洞。</p><div class="is it gp gr iu ow"><a href="https://medium.com/@qiuyujx/membership" rel="noopener follow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd jk gy z fp pb fr fs pc fu fw ji bi translated">通过我的推荐链接加入Medium克里斯托弗·陶</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">medium.com</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk ja ow"/></div></div></a></div><p id="7d6b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你觉得我的文章有帮助，请考虑加入Medium会员来支持我和其他成千上万的作者！(点击上面的链接)</p><h1 id="f5ad" class="ly lz jj bd ma mb mc md me mf mg mh mi kp mj kq mk ks ml kt mm kv mn kw mo mp bi translated">参考</h1><p id="8416" class="pw-post-body-paragraph ky kz jj la b lb nx kk ld le ny kn lg lh nz lj lk ll oa ln lo lp ob lr ls lt im bi translated">[1]通用网关接口，<em class="nh">维基百科</em><a class="ae jg" href="https://en.wikipedia.org/wiki/Common_Gateway_Interface" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Common_Gateway_Interface</a></p></div></div>    
</body>
</html>