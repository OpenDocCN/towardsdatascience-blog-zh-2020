# CatBoost ä¸­çš„åˆ†ç±»ç‰¹å¾å‚æ•°

> åŸæ–‡ï¼š<https://towardsdatascience.com/categorical-features-parameters-in-catboost-4ebd1326bee5?source=collection_archive---------9----------------------->

## æŒæ¡ä½ ä¸çŸ¥é“å­˜åœ¨çš„å‚æ•°

![](img/b84d0eaf9f852839202078e01e3c3a98.png)

åˆ†ç±»ç‰¹å¾ç¤ºä¾‹:çŒ«çš„è„¸å‹

CatBoost æ˜¯ä¸€ä¸ªå¼€æºçš„æ¸å˜å¢å¼ºåº“ã€‚CatBoost å’Œå…¶ä»–æ¢¯åº¦å¢å¼ºåº“çš„åŒºåˆ«ä¹‹ä¸€æ˜¯å®ƒå¯¹åˆ†ç±»ç‰¹æ€§çš„é«˜çº§å¤„ç†(äº‹å®ä¸Šï¼ŒåŒ…åä¸­çš„â€œCatâ€å¹¶ä¸ä»£è¡¨ğŸ±ä½†å¯¹äºâ€œç»å¯¹çš„â€)ã€‚

CatBoost å¯ä»¥å¾ˆå¥½åœ°å¤„ç†ç°æˆçš„åˆ†ç±»æ•°æ®ã€‚ç„¶è€Œï¼Œå®ƒä¹Ÿæœ‰å¤§é‡çš„è®­ç»ƒå‚æ•°ï¼Œè¿™äº›å‚æ•°æä¾›äº†å¯¹åˆ†ç±»ç‰¹å¾é¢„å¤„ç†çš„ç²¾ç»†æ§åˆ¶ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•æ›´å¥½åœ°ä½¿ç”¨è¿™äº›å‚æ•°ã€‚æœ¬æ•™ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†:

1.  **ç®€ä»‹:æœºå™¨å­¦ä¹ ä¸­çš„åˆ†ç±»ç‰¹å¾**
2.  **CatBoost ä¸­çš„åˆ†ç±»ç‰¹å¾å¤„ç†**
3.  **å®éªŒ:åˆ†ç±»ç‰¹å¾è®¾ç½®å¦‚ä½•å½±å“é¢„æµ‹æ—§è½¦ä»·æ ¼çš„å‡†ç¡®æ€§**ã€‚

# 1.ç®€ä»‹:æœºå™¨å­¦ä¹ ä¸­çš„åˆ†ç±»ç‰¹å¾

**Ñç±»åˆ«ç‰¹å¾**æ˜¯ä¸€ä¸ªå…·æœ‰ä¸€ç»„ç¦»æ•£å€¼çš„ç‰¹å¾ï¼Œè¿™äº›ç¦»æ•£å€¼è¢«ç§°ä¸º*ç±»åˆ«*ï¼Œè¿™äº›ç±»åˆ«*ä¸èƒ½é€šè¿‡<æˆ–>ç›¸äº’æ¯”è¾ƒ*ã€‚åœ¨ç°å®ä¸–ç•Œçš„æ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å¤„ç†åˆ†ç±»æ•°æ®ã€‚åˆ†ç±»è¦ç´ çš„åŸºæ•°ï¼Œå³è¦ç´ å¯ä»¥é‡‡ç”¨çš„ä¸åŒå€¼çš„æ•°é‡ï¼Œåœ¨è¦ç´ å’Œæ•°æ®é›†ä¹‹é—´å˜åŒ–å¾ˆå¤§-ä»å‡ ä¸ªåˆ°æ•°åƒç”šè‡³æ•°ç™¾ä¸‡ä¸ªä¸åŒçš„å€¼ã€‚åˆ†ç±»ç‰¹å¾çš„å€¼å¯ä»¥å‡ ä¹å‡åŒ€åœ°åˆ†å¸ƒï¼Œå¹¶ä¸”å¯èƒ½å­˜åœ¨é¢‘ç‡ç›¸å·®æ•°é‡çº§çš„å€¼ã€‚è¦åœ¨æ¢¯åº¦æå‡ä¸­ä½¿ç”¨åˆ†ç±»ç‰¹å¾ï¼Œéœ€è¦å°†å…¶è½¬æ¢ä¸ºå†³ç­–æ ‘å¯ä»¥å¤„ç†çš„æŸç§å½¢å¼ï¼Œä¾‹å¦‚è½¬æ¢ä¸ºæ•°å­—ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç®€è¦ä»‹ç»å°†åˆ†ç±»ç‰¹å¾å€¼è½¬æ¢ä¸ºæ•°å­—çš„æœ€æµè¡Œçš„æœºå™¨å­¦ä¹ æ–¹æ³•ã€‚åˆ†ç±»ç‰¹å¾é¢„å¤„ç†çš„æ ‡å‡†æ–¹æ³•

*   **ä¸€é”®ç¼–ç **åŒ…æ‹¬ä¸ºæ¯ä¸ªç±»åˆ«åˆ›å»ºä¸€ä¸ªäºŒè¿›åˆ¶ç‰¹å¾ã€‚è¯¥æ–¹æ³•çš„ä¸»è¦é—®é¢˜æ˜¯å…·æœ‰å·¨å¤§åŸºæ•°çš„ç‰¹å¾(ä¾‹å¦‚ç”¨æˆ· id)å¯¼è‡´å¤§é‡ç‰¹å¾ã€‚
*   **æ ‡ç­¾ç¼–ç **æ˜ å°„æ¯ä¸ªç±»åˆ«ï¼Œå³ä¸€ä¸ªåˆ†ç±»ç‰¹å¾å¯ä»¥å–ä¸ºä¸€ä¸ªéšæœºæ•°çš„å€¼ã€‚è¿™éš¾é“ä¸æ˜¯å¾ˆæœ‰é“ç†å—ï¼Ÿå®ƒåœ¨å®è·µä¸­ä¹Ÿä¸å¤ªç®¡ç”¨ã€‚
*   **å“ˆå¸Œç¼–ç **ä½¿ç”¨å“ˆå¸Œå‡½æ•°å°†å­—ç¬¦ä¸²ç±»å‹ç‰¹å¾è½¬æ¢ä¸ºå›ºå®šç»´åº¦å‘é‡ã€‚
*   **é¢‘ç‡ç¼–ç **åŒ…æ‹¬ç”¨æ•°æ®é›†ä¸­ç±»åˆ«çš„é¢‘ç‡æ›¿æ¢åˆ†ç±»ç‰¹å¾å€¼ã€‚
*   **ç›®æ ‡ç¼–ç **ç”¨ä¸€ä¸ªæ•°å­—æ›¿æ¢åˆ†ç±»ç‰¹å¾çš„å€¼ï¼Œè¯¥æ•°å­—æ ¹æ®åˆ†ç±»å˜é‡çš„ç‰¹å®šå€¼çš„ç›®æ ‡å€¼çš„åˆ†å¸ƒè®¡ç®—å¾—å‡ºã€‚æœ‰æ—¶è¢«ç§°ä¸º**è´ªå©ªç›®æ ‡ç¼–ç **çš„æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯å¯¹å±äºè¯¥ç±»åˆ«çš„å¯¹è±¡ä½¿ç”¨ç›®æ ‡çš„å¹³å‡å€¼ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•ä¼šå¯¼è‡´ç›®æ ‡æ³„æ¼å’Œè¿‡æ‹Ÿåˆã€‚è¿™äº›é—®é¢˜çš„ä¸€ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯**ç»´æŒç›®æ ‡ç¼–ç ** â€”è®­ç»ƒæ•°æ®é›†çš„ä¸€éƒ¨åˆ†ç”¨äºè®¡ç®—æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡ç»Ÿè®¡æ•°æ®ï¼Œè€Œè®­ç»ƒæ˜¯åœ¨å…¶ä½™çš„è®­ç»ƒæ•°æ®ä¸Šæ‰§è¡Œçš„ã€‚å®ƒè§£å†³äº†ç›®æ ‡æ³„éœ²é—®é¢˜ï¼Œä½†éœ€è¦æˆ‘ä»¬ç‰ºç‰²ä¸€éƒ¨åˆ†å®è´µçš„è®­ç»ƒæ•°æ®ã€‚ä¸ºæ­¤ï¼Œå®è·µä¸­æœ€æµè¡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯ **K å€ç›®æ ‡ç¼–ç **å’Œ**ç•™ä¸€ç›®æ ‡ç¼–ç **ã€‚K æŠ˜å ç›®æ ‡ç¼–ç èƒŒåçš„æ€æƒ³éå¸¸ç±»ä¼¼äº K æŠ˜å äº¤å‰éªŒè¯-æˆ‘ä»¬å°†è®­ç»ƒæ•°æ®åˆ†æˆå‡ ä¸ªæŠ˜å ï¼Œåœ¨æ¯ä¸ªæŠ˜å ä¸­ï¼Œæˆ‘ä»¬ç”¨åœ¨å…¶ä»–æŠ˜å ä¸Šè®¡ç®—çš„ç±»åˆ«çš„ç›®æ ‡ç»Ÿè®¡æ¥æ›¿æ¢åˆ†ç±»ç‰¹å¾å€¼ã€‚ç•™ä¸€ç›®æ ‡ç¼–ç æ˜¯ K é‡ç¼–ç çš„ç‰¹ä¾‹ï¼Œå…¶ä¸­ K ç­‰äºè®­ç»ƒæ•°æ®çš„é•¿åº¦ã€‚k å€ç¼–ç å’Œç•™ä¸€ç›®æ ‡ç¼–ç ä¹Ÿå¯èƒ½å¯¼è‡´è¿‡æ‹Ÿåˆã€‚è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹:åœ¨è®­ç»ƒæ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå…·æœ‰å•ä¸ªå€¼çš„å•ä¸€åˆ†ç±»ç‰¹å¾ï¼Œä»¥åŠ 5 ä¸ªç±» 0 å¯¹è±¡å’Œ 6 ä¸ªç±» 1 å¯¹è±¡ã€‚æ˜¾ç„¶ï¼Œåªæœ‰ä¸€ä¸ªå¯èƒ½å€¼çš„ç‰¹å¾æ˜¯æ— ç”¨çš„ï¼Œç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬å¯¹æ‰€æœ‰ç±»åˆ« 0 çš„å¯¹è±¡ä½¿ç”¨å…·æœ‰å‡å€¼å‡½æ•°çš„ç•™ä¸€ç›®æ ‡ç¼–ç ï¼Œç‰¹å¾å€¼å°†è¢«ç¼–ç æˆ 0.6ï¼Œè€Œå¯¹æ‰€æœ‰ç±»åˆ« 1 çš„å¯¹è±¡ï¼Œç‰¹å¾ç¼–ç å€¼å°†æ˜¯ 0.5ã€‚è¿™å°†å…è®¸å†³ç­–æ ‘åˆ†ç±»å™¨é€‰æ‹© 0.55 çš„åˆ†å‰²ï¼Œå¹¶åœ¨è®­ç»ƒé›†ä¸Šå®ç° 100%çš„å‡†ç¡®æ€§ã€‚

# 2.CatBoost ä¸­çš„åˆ†ç±»ç‰¹å¾å¤„ç†

CatBoost æ”¯æŒä¸€äº›ä¼ ç»Ÿçš„åˆ†ç±»æ•°æ®é¢„å¤„ç†æ–¹æ³•ï¼Œæ¯”å¦‚ä¸€é”®ç¼–ç å’Œé¢‘ç‡ç¼–ç ã€‚ç„¶è€Œï¼Œè¿™ä¸ªåŒ…çš„ä¸€ä¸ªç‰¹å¾æ˜¯å®ƒçš„åˆ†ç±»ç‰¹å¾ç¼–ç çš„åŸå§‹è§£å†³æ–¹æ¡ˆã€‚

CatBoost åˆ†ç±»ç‰¹å¾é¢„å¤„ç†èƒŒåçš„æ ¸å¿ƒæ€æƒ³æ˜¯**æœ‰åºç›®æ ‡ç¼–ç **:æ‰§è¡Œæ•°æ®é›†çš„éšæœºæ’åˆ—ï¼Œç„¶åä»…ä½¿ç”¨æ”¾ç½®åœ¨å½“å‰å¯¹è±¡ä¹‹å‰çš„å¯¹è±¡ï¼Œå¯¹æ¯ä¸ªç¤ºä¾‹*æ‰§è¡ŒæŸç§ç±»å‹çš„ç›®æ ‡ç¼–ç (ä¾‹å¦‚ï¼Œä»…è®¡ç®—è¯¥ç±»åˆ«å¯¹è±¡çš„ç›®æ ‡å¹³å‡å€¼)ã€‚*

é€šå¸¸ï¼Œåœ¨ CatBoost ä¸­å°†åˆ†ç±»ç‰¹å¾è½¬æ¢ä¸ºæ•°å­—ç‰¹å¾åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤:

1.  **éšæœºæ’åˆ—**è®­ç»ƒå¯¹è±¡ã€‚
2.  **é‡åŒ–**å³æ ¹æ®ä»»åŠ¡ç±»å‹å°†ç›®æ ‡å€¼ä»æµ®ç‚¹è½¬æ¢ä¸ºæ•´æ•°:

*   åˆ†ç±»-ç›®æ ‡å€¼çš„å¯èƒ½å€¼ä¸ºâ€œ0â€(ä¸å±äºæŒ‡å®šçš„ç›®æ ‡ç±»)å’Œâ€œ1â€(å±äºæŒ‡å®šçš„ç›®æ ‡ç±»)ã€‚
*   å¤šåˆ†ç±»-ç›®æ ‡å€¼æ˜¯ç›®æ ‡ç±»çš„æ•´æ•°æ ‡è¯†ç¬¦(ä»â€œ0â€å¼€å§‹)ã€‚
*   å›å½’-å¯¹æ ‡æ³¨å€¼æ‰§è¡Œé‡åŒ–ã€‚**åœ¨å¯åŠ¨å‚æ•°**ä¸­è®¾ç½®æ¡¶çš„æ¨¡å¼å’Œæ•°é‡ã€‚ä½äºå•ä¸ªå­˜å‚¨æ¡¶å†…çš„æ‰€æœ‰å€¼éƒ½è¢«åˆ†é…ä¸€ä¸ªæ ‡ç­¾å€¼ç±»â€”ä¸€ä¸ªç”±å…¬å¼å®šä¹‰çš„èŒƒå›´å†…çš„æ•´æ•°:<å­˜å‚¨æ¡¶ ID â€” 1 >ã€‚

3.**ç¼–ç **åˆ†ç±»ç‰¹å¾å€¼ã€‚

CatBoost åˆ›å»ºäº†è®­ç»ƒå¯¹è±¡çš„å››ç§æ’åˆ—ï¼Œå¯¹äºæ¯ç§æ’åˆ—ï¼Œéƒ½ä¼šè®­ç»ƒä¸€ä¸ªå•ç‹¬çš„æ¨¡å‹ã€‚ä¸‰ä¸ªæ¨¡å‹ç”¨äºæ ‘ç»“æ„é€‰æ‹©ï¼Œç¬¬å››ä¸ªç”¨äºè®¡ç®—æˆ‘ä»¬ä¿å­˜çš„æœ€ç»ˆæ¨¡å‹çš„å¶å­å€¼ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œéšæœºé€‰æ‹©ä¸‰ä¸ªæ¨¡å‹ä¸­çš„ä¸€ä¸ªï¼›è¯¥æ¨¡å‹ç”¨äºé€‰æ‹©æ–°çš„æ ‘ç»“æ„ï¼Œå¹¶è®¡ç®—æ‰€æœ‰å››ä¸ªæ¨¡å‹çš„æ ‘å¶å€¼ã€‚

ä½¿ç”¨å‡ ç§æ¨¡å‹è¿›è¡Œæ ‘ç»“æ„é€‰æ‹©å¢å¼ºäº†åˆ†ç±»ç‰¹å¾ç¼–ç çš„é²æ£’æ€§ã€‚å¦‚æœåœ¨ä¸€ä¸ªæ’åˆ—ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡é è¿‘æ•°æ®é›†çš„å¼€å§‹ï¼Œå¹¶ä¸”åœ¨å¦å¤–ä¸¤ä¸ªæ’åˆ—ä¸­å¯¹å°‘é‡å¯¹è±¡è®¡ç®—ç¼–ç ç»Ÿè®¡ï¼Œåˆ™å®ƒå¯èƒ½æ›´é è¿‘æ•°æ®é›†çš„ç»“å°¾ï¼Œå¹¶ä¸”è®¸å¤šå¯¹è±¡å°†ç”¨äºè®¡ç®—ç»Ÿè®¡ã€‚

å¦ä¸€ä¸ªè¦ç‚¹æ˜¯ **CatBoost å¯ä»¥ç»“åˆç°æœ‰çš„åˆ†ç±»ç‰¹å¾åˆ›å»ºæ–°çš„åˆ†ç±»ç‰¹å¾**ã€‚å¹¶ä¸”å®ƒå®é™…ä¸Šä¼šè¿™æ ·åšï¼Œé™¤éä½ æ˜ç¡®åœ°å‘Šè¯‰å®ƒä¸è¦è¿™æ ·åš:)åŸå§‹ç‰¹å¾å’Œåˆ›å»ºçš„ç‰¹å¾çš„å¤„ç†å¯ä»¥åˆ†åˆ«ç”±è®¾ç½®`simple_ctr`å’Œ`combinations_ctr`å•ç‹¬æ§åˆ¶(æˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºå®ƒä»¬)ã€‚

# 3.åˆ†ç±»ç‰¹å¾å‚æ•°åœ¨å®é™…ä¸­çš„åº”ç”¨:æ—§è½¦ä»·æ ¼é¢„æµ‹

![](img/b62623a271cde8740a80b95faea4a530.png)

[ä¸˜ç‰¹å°”æ–¯çº³æ™®](https://unsplash.com/@chuttersnap?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/s/photos/cars?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹ç…§

# èµ„æ–™ç»„

å¯¹äºæœ¬æ•™ç¨‹ä¸­çš„å®éªŒï¼Œæˆ‘ä»¬å°†ä½¿ç”¨[https://www.kaggle.com/lepchenkov/usedcarscatalog](https://www.kaggle.com/lepchenkov/usedcarscatalog)

è¯¥æ•°æ®é›†ç”±æ—§æ±½è½¦çš„æè¿°åŠå…¶ç‰¹å¾ç»„æˆï¼Œæ—¢æœ‰æ•°å­—çš„ï¼Œå¦‚é‡Œç¨‹ã€ç”Ÿäº§å¹´ä»½ç­‰ï¼Œä¹Ÿæœ‰åˆ†ç±»çš„ï¼Œå¦‚é¢œè‰²ã€åˆ¶é€ å•†åç§°ã€å‹å·åç§°ç­‰ã€‚

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è§£å†³*å›å½’*ä»»åŠ¡ï¼Œå³é¢„æµ‹ä¸€è¾†æ—§è½¦çš„ä»·æ ¼ã€‚

![](img/fc126a58a2a0134ee10de62ee6447f5f.png)

è®©æˆ‘ä»¬çœ‹çœ‹æ¯ä¸ªåˆ†ç±»å˜é‡æœ‰å¤šå°‘ä¸ªå”¯ä¸€å€¼:

```
df[categorical_features_names].nunique()manufacturer_name      55
model_name           1118
transmission            2
color                  12
engine_fuel             6
engine_type             3
body_type              12
state                   3
drivetrain              3
location_region         6
```

ç›®æ ‡å€¼åˆ†å¸ƒå¦‚ä¸‹:

![](img/80bc2f3c59dee23476d2d0b58251a4be.png)

é¦–å…ˆï¼Œæˆ‘ä»¬å°†ç²—ç•¥ä¼°è®¡å®Œæˆè¿™é¡¹ä»»åŠ¡æ‰€éœ€çš„æ ‘çš„æ•°é‡å’Œå­¦ä¹ ç‡ã€‚

```
0:	learn: 5935.7603510	test: 6046.0339243	best: 6046.0339243 (0)	total: 73.2ms	remaining: 6m 5s
2000:	learn: 1052.8405096	test: 1684.8571308	best: 1684.8571308 (2000)	total: 19.5s	remaining: 29.2s
4000:	learn: 830.0093394	test: 1669.1267503	best: 1668.7626148 (3888)	total: 41.4s	remaining: 10.3s
4999:	learn: 753.5299104	test: 1666.7826842	best: 1666.6739968 (4463)	total: 52.7s	remaining: 0usbestTest = 1666.673997
bestIteration = 4463
```

ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œåœ¨ç»™å®šå‚æ•°çš„æƒ…å†µä¸‹æµ‹è¯• CatBoost åœ¨ä¸‰é‡äº¤å‰éªŒè¯ä¸Šçš„æ€§èƒ½ï¼Œå¹¶è¿”å›æœ€åä¸€ä¸ªæ¨¡å‹çš„å®Œæ•´å‚æ•°åˆ—è¡¨ã€‚å¯é€‰åœ°ï¼Œè¯¥å‡½æ•°å°†æ¨¡å‹çš„åº¦é‡ä¸ç”¨é»˜è®¤åˆ†ç±»ç‰¹å¾å‚æ•°è®­ç»ƒçš„æ¨¡å‹çš„ç»“æœè¿›è¡Œæ¯”è¾ƒã€‚

æˆ‘ä»¬å°†ä¼°è®¡å™¨çš„æ•°é‡å›ºå®šä¸º 4500ï¼Œå­¦ä¹ ç‡ä¸º 0.1ã€‚

# CatBoost ä¸­ç¼–ç å‚æ•°çš„åˆ†ç±»ç‰¹å¾

CatBoost ä¸­ä¸åˆ†ç±»ç‰¹å¾å¤„ç†ç›¸å…³çš„å‚æ•°æ•°é‡åºå¤§ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„åˆ—è¡¨:

*   `one_hot_max_size` (int) -å¯¹æ‰€æœ‰å…·æœ‰å°äºæˆ–ç­‰äºç»™å®šå‚æ•°å€¼çš„ä¸åŒå€¼çš„åˆ†ç±»ç‰¹å¾ä½¿ç”¨ä¸€é”®ç¼–ç ã€‚å¯¹è¿™äº›ç‰¹å¾ä¸è¿›è¡Œå¤æ‚çš„ç¼–ç ã€‚*å›å½’ä»»åŠ¡çš„é»˜è®¤å€¼ä¸º 2ã€‚*
*   `model_size_reg`(ä» 0 åˆ° inf æµ®åŠ¨)-æ¨¡å‹å¤§å°æ­£åˆ™åŒ–ç³»æ•°ã€‚è¯¥å€¼è¶Šå¤§ï¼Œæ¨¡å‹å°ºå¯¸è¶Šå°ã€‚è¯¦æƒ…å‚è§â€œæ¨¡å‹å°ºå¯¸æ­£åˆ™åŒ–ç³»æ•°â€éƒ¨åˆ†ã€‚åªæœ‰å…·æœ‰åˆ†ç±»ç‰¹å¾çš„æ¨¡å‹(å…¶ä»–æ¨¡å‹å¾ˆå°)æ‰éœ€è¦è¿™ç§æ­£åˆ™åŒ–ã€‚å¦‚æœåˆ†ç±»ç‰¹å¾å…·æœ‰å¤§é‡å€¼ï¼Œåˆ™å…·æœ‰åˆ†ç±»ç‰¹å¾çš„æ¨¡å‹å¯èƒ½ä¼šæœ‰æ•°ç™¾äº¿å­—èŠ‚æˆ–æ›´å¤šã€‚å¦‚æœæ­£åˆ™é¡¹çš„å€¼ä¸ä¸ºé›¶ï¼Œåˆ™ä½¿ç”¨åˆ†ç±»è¦ç´ æˆ–å…·æœ‰å¤§é‡å€¼çš„è¦ç´ ç»„åˆä¼šäº§ç”Ÿä¸åˆ©å½±å“ï¼Œå› æ­¤åœ¨ç”Ÿæˆçš„æ¨¡å‹ä¸­ä½¿ç”¨çš„åˆ†ç±»è¦ç´ æˆ–è¦ç´ ç»„åˆè¾ƒå°‘ã€‚*é»˜è®¤å€¼ä¸º 0.5*
*   `max_ctr_complexity` -å¯ä»¥ç»„åˆçš„æœ€å¤§ç‰¹å¾æ•°é‡ã€‚æ¯ä¸ªç»“æœç»„åˆç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç±»ç‰¹å¾ç»„æˆï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©åŒ…å«ä»¥ä¸‹å½¢å¼çš„äºŒè¿›åˆ¶ç‰¹å¾:â€œæ•°å­—ç‰¹å¾>å€¼â€ã€‚*å¯¹äº CPU ä¸Šçš„å›å½’ä»»åŠ¡ï¼Œé»˜è®¤å€¼ä¸º 4ã€‚*
*   `has_time` (bool) -å¦‚æœ`true`ï¼Œåˆ†ç±»ç‰¹å¾å¤„ç†çš„ç¬¬ä¸€æ­¥ï¼Œç½®æ¢ï¼Œä¸æ‰§è¡Œã€‚å½“æ•°æ®é›†ä¸­çš„å¯¹è±¡æŒ‰æ—¶é—´æ’åºæ—¶éå¸¸æœ‰ç”¨ã€‚å¯¹äºæˆ‘ä»¬çš„æ•°æ®é›†ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ƒã€‚*é»˜è®¤å€¼ä¸º*
*   `simple_ctr` -ç®€å•åˆ†ç±»ç‰¹å¾çš„é‡åŒ–è®¾ç½®ã€‚
*   `combinations_ctr` -åˆ†ç±»ç‰¹å¾ç»„åˆçš„é‡åŒ–è®¾ç½®ã€‚
*   `per_feature_ctr` -åˆ†ç±»ç‰¹å¾çš„æ¯ç‰¹å¾é‡åŒ–è®¾ç½®ã€‚
*   `counter_calc_method`ç”¨`Counter`å†³å®šæ˜¯å¦ä½¿ç”¨éªŒè¯æ•°æ®é›†(é€šè¿‡`fit`æ–¹æ³•çš„å‚æ•°`eval_set`æä¾›)æ¥ä¼°è®¡ç±»åˆ«é¢‘ç‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯`Full`ï¼Œä½¿ç”¨éªŒè¯æ•°æ®é›†ä¸­çš„å¯¹è±¡ï¼›ä¼ é€’`SkipTest`å€¼ä»¥å¿½ç•¥éªŒè¯é›†ä¸­çš„å¯¹è±¡
*   `ctr_target_border_count` -ç”¨äºåˆ†ç±»ç‰¹å¾ç›®æ ‡é‡åŒ–çš„æœ€å¤§è¾¹ç•Œæ•°ã€‚*å›å½’ä»»åŠ¡çš„é»˜è®¤å€¼ä¸º 1ã€‚*
*   `ctr_leaf_count_limit` -å…·æœ‰åˆ†ç±»ç‰¹å¾çš„å¶å­çš„æœ€å¤§æ•°é‡ã€‚é»˜è®¤*å€¼ä¸ºæ— ï¼Œå³æ²¡æœ‰é™åˆ¶ã€‚*
*   `store_all_simple_ctr` -å¦‚æœå…ˆå‰çš„å‚æ•°åœ¨æŸä¸€ç‚¹ä¸Šæ¢¯åº¦æ¨è¿›æ ‘ä¸å†èƒ½å¤Ÿé€šè¿‡åˆ†ç±»ç‰¹å¾è¿›è¡Œåˆ†å‰²ã€‚é»˜è®¤å€¼ç­‰äº`False`æ—¶ï¼Œé™åˆ¶é€‚ç”¨äºåŸå§‹åˆ†ç±»ç‰¹å¾å’Œ CatBoost é€šè¿‡ç»„åˆä¸åŒç‰¹å¾åˆ›å»ºçš„ç‰¹å¾ã€‚å¦‚æœè¯¥å‚æ•°è®¾ç½®ä¸º`True`ï¼Œåªæœ‰ç»„åˆç‰¹å¾ä¸Šçš„åˆ†å‰²æ•°é‡å—åˆ°é™åˆ¶ã€‚

ä¸‰ä¸ªå‚æ•°`simple_ctr`ã€`combinations_ctr`å’Œ`per_feature_ctr`æ˜¯æ§åˆ¶åˆ†ç±»ç‰¹å¾å¤„ç†çš„ç¬¬äºŒå’Œç¬¬ä¸‰æ­¥éª¤çš„å¤æ‚å‚æ•°ã€‚æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­è¯¦ç»†è®¨è®ºå®ƒä»¬ã€‚

# é»˜è®¤å‚æ•°

é¦–å…ˆï¼Œæˆ‘ä»¬æµ‹è¯•ç°æˆçš„ CatBoost åˆ†ç±»ç‰¹å¾å¤„ç†ã€‚

```
last_model_params = score_catboost_model({}, True)
R2 score: 0.9334(0.0009)
RMSE score: 1659(17)
```

æˆ‘ä»¬å°†ä¿å­˜å…·æœ‰é»˜è®¤åˆ†ç±»ç‰¹å¾å‚æ•°çš„æ¨¡å‹çš„åº¦é‡ï¼Œä»¥ä¾›è¿›ä¸€æ­¥æ¯”è¾ƒã€‚

# ä¸€é”®ç¼–ç æœ€å¤§å°ºå¯¸

æˆ‘ä»¬å°è¯•çš„ç¬¬ä¸€ä»¶äº‹æ˜¯è®© CatBoost å¯¹æˆ‘ä»¬æ‰€æœ‰çš„åˆ†ç±»ç‰¹å¾ä½¿ç”¨ä¸€é”®ç¼–ç (æˆ‘ä»¬æ•°æ®é›†ä¸­çš„æœ€å¤§åˆ†ç±»ç‰¹å¾åŸºæ•°æ˜¯ 1118 < 2000). The documentation says, that for the features for which one-hot encoding is used no other encodings are computed.

*é»˜è®¤å€¼æ˜¯:*

*   å¦‚æœåœ¨ CPU ä¸Šä»¥æˆå¯¹è®¡åˆ†æ¨¡å¼è¿›è¡Œè®­ç»ƒï¼Œåˆ™ä¸é€‚ç”¨
*   255 å¦‚æœåœ¨ GPU ä¸Šæ‰§è¡Œè®­ç»ƒï¼Œå¹¶ä¸”æ‰€é€‰ Ctr ç±»å‹éœ€è¦åœ¨è®­ç»ƒæœŸé—´ä¸å¯ç”¨çš„ç›®æ ‡æ•°æ®
*   10 å¦‚æœåœ¨åˆ†çº§æ¨¡å¼ä¸‹è¿›è¡Œè®­ç»ƒ
*   2 å¦‚æœä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³

```
model_params = score_catboost_model({'one_hot_max_size' : 2000})R2 score: 0.9392(0.0029) +0.6% compared to default parameters
RMSE score: 1584(28) -4.5% compared to default parameters
```

# æ¨¡å‹å°ºå¯¸æ­£åˆ™åŒ–

*å¦‚æœè®­ç»ƒæ•°æ®å…·æœ‰åˆ†ç±»ç‰¹å¾ï¼Œè¯¥å‚æ•°ä¼šå½±å“æ¨¡å‹å¤§å°ã€‚*

*å…³äºåˆ†ç±»ç‰¹å¾çš„ä¿¡æ¯å¯¹æ¨¡å‹çš„æœ€ç»ˆå¤§å°æœ‰å¾ˆå¤§çš„è´¡çŒ®ã€‚ä¸ºæ¨¡å‹ä¸­ä½¿ç”¨çš„æ¯ä¸ªåˆ†ç±»ç‰¹å¾å­˜å‚¨ä»åˆ†ç±»ç‰¹å¾å€¼æ•£åˆ—åˆ°ä¸€äº›ç»Ÿè®¡å€¼çš„æ˜ å°„ã€‚ç‰¹å®šè¦ç´ çš„æ˜ å°„å¤§å°å–å†³äºè¯¥è¦ç´ é‡‡ç”¨çš„å”¯ä¸€å€¼çš„æ•°é‡ã€‚*

*å› æ­¤ï¼Œå½“é€‰æ‹©æ ‘ä¸­çš„åˆ†è£‚ä»¥å‡å°æ¨¡å‹çš„æœ€ç»ˆå°ºå¯¸æ—¶ï¼Œå¯ä»¥åœ¨æœ€ç»ˆæ¨¡å‹ä¸­è€ƒè™‘åˆ†ç±»ç‰¹å¾çš„æ½œåœ¨æƒé‡ã€‚é€‰æ‹©æœ€ä½³åˆ†å‰²æ—¶ï¼Œä¼šè®¡ç®—æ‰€æœ‰åˆ†å‰²åˆ†æ•°ï¼Œç„¶åé€‰æ‹©åˆ†æ•°æœ€é«˜çš„åˆ†å‰²ã€‚ä½†æ˜¯åœ¨é€‰æ‹©å…·æœ‰æœ€ä½³åˆ†æ•°çš„åˆ†å‰²ä¹‹å‰ï¼Œæ‰€æœ‰åˆ†æ•°æ ¹æ®ä»¥ä¸‹å…¬å¼å˜åŒ–:*

![](img/f70e40ba0979d38a2479433411bf12ef.png)

*s_new* æ˜¯æ ¹æ®æŸä¸ªåˆ†ç±»ç‰¹å¾æˆ–ç»„åˆç‰¹å¾è¿›è¡Œåˆ†å‰²çš„æ–°å¾—åˆ†ï¼Œ *s_old* æ˜¯æ ¹æ®è¯¥ç‰¹å¾è¿›è¡Œåˆ†å‰²çš„æ—§å¾—åˆ†ï¼Œ *u* æ˜¯è¯¥ç‰¹å¾çš„å”¯ä¸€å€¼çš„æ•°é‡ï¼Œ *U* æ˜¯æ‰€æœ‰ç‰¹å¾ä¸­æ‰€æœ‰å€¼çš„æœ€å¤§å€¼ï¼Œ *M* æ˜¯`model_size_reg`å‚æ•°çš„å€¼ã€‚

è¿™ç§æ­£åˆ™åŒ–åœ¨ GPU ä¸Šçš„å·¥ä½œæ–¹å¼ç•¥æœ‰ä¸åŒ:ç‰¹æ€§ç»„åˆçš„æ­£åˆ™åŒ–ç¨‹åº¦æ¯”åœ¨ CPU ä¸Šæ›´é«˜ã€‚å› ä¸ºç»„åˆçš„ CPU æˆæœ¬ç­‰äºè®­ç»ƒæ•°æ®é›†ä¸­å­˜åœ¨çš„è¿™äº›ç»„åˆä¸­ä¸åŒç‰¹å¾å€¼çš„æ•°é‡ã€‚åœ¨ GPU ä¸Šï¼Œä¸€ä¸ªç»„åˆçš„æˆæœ¬ç­‰äºè¯¥ç»„åˆæ‰€æœ‰å¯èƒ½çš„ä¸åŒå€¼çš„æ•°é‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç»„åˆåŒ…å«ä¸¤ä¸ªåˆ†ç±»è¦ç´  c1 å’Œ c2ï¼Œåˆ™æˆæœ¬å°†ä¸º c1 ä¸­çš„#categories * C2 ä¸­çš„# categoriesï¼Œå³ä½¿è¯¥ç»„åˆä¸­çš„è®¸å¤šå€¼å¯èƒ½ä¸åœ¨æ•°æ®é›†ä¸­ã€‚

è®©æˆ‘ä»¬å°è¯•å°†æ¨¡å‹å¤§å°æ­£åˆ™åŒ–ç³»æ•°è®¾ç½®ä¸º 0â€”â€”å› æ­¤æˆ‘ä»¬å…è®¸æˆ‘ä»¬çš„æ¨¡å‹ä½¿ç”¨å°½å¯èƒ½å¤šçš„åˆ†ç±»ç‰¹å¾åŠå…¶ç»„åˆã€‚

```
model_params = score_catboost_model({'model_size_reg': 0})R2 score: 0.9360(0.0014) +0.3% compared to default parameters
RMSE score: 1626(26) -2.0% compared to default parametersmodel_params = score_catboost_model({'model_size_reg': 1})R2 score: 0.9327(0.0020) -0.1% compared to default parameters
RMSE score: 1667(30) +0.5% compared to default parameters
```

ä¸ºäº†æ£€æŸ¥æ­¤è®¾ç½®å¦‚ä½•å½±å“æ¨¡å‹çš„å¤§å°ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œç»™å®šå‚æ•°å­—å…¸å°†è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œå°†å…¶ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶è¿”å›æ¨¡å‹çš„æƒé‡:

```
model_size_reg_0 = weight_model({'model_size_reg': 0})model_size_reg_1 = weight_model({'model_size_reg': 1})model_size_reg_0/model_size_reg_112.689550532622183
```

æ­£å¦‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„ï¼Œå…·æœ‰å¼ºæ­£åˆ™åŒ–çš„æ¨¡å‹å‡ ä¹æ¯”æ²¡æœ‰æ­£åˆ™åŒ–çš„æ¨¡å‹å° 13 å€ã€‚

# ç»„åˆçš„åŠŸèƒ½æ•°é‡

# ç»„åˆçš„åŠŸèƒ½æ•°é‡

**ç‰¹å¾ç»„åˆ**:æ³¨æ„ï¼Œå‡ ä¸ªåˆ†ç±»ç‰¹å¾çš„ä»»ä½•ç»„åˆéƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ–°çš„ç»„åˆã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä»»åŠ¡æ˜¯éŸ³ä¹æ¨èï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªåˆ†ç±»ç‰¹å¾:ç”¨æˆ· ID å’ŒéŸ³ä¹æµæ´¾ã€‚æ¯”å¦‚è¯´ï¼Œä¸€äº›ç”¨æˆ·æ›´å–œæ¬¢æ‘‡æ»šä¹ã€‚å½“æˆ‘ä»¬å°†ç”¨æˆ· ID å’ŒéŸ³ä¹æµæ´¾è½¬æ¢ä¸ºæ•°å­—ç‰¹å¾æ—¶ï¼Œæˆ‘ä»¬ä¼šä¸¢å¤±è¿™äº›ä¿¡æ¯ã€‚ä¸¤ä¸ªåŠŸèƒ½çš„ç»„åˆè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªæ–°çš„å¼ºå¤§åŠŸèƒ½ã€‚ç„¶è€Œï¼Œç»„åˆçš„æ•°é‡éšç€æ•°æ®é›†ä¸­åˆ†ç±»ç‰¹å¾çš„æ•°é‡å‘ˆæŒ‡æ•°å¢é•¿ï¼Œå› æ­¤ä¸å¯èƒ½åœ¨ç®—æ³•ä¸­è€ƒè™‘æ‰€æœ‰çš„ç»„åˆã€‚å½“ä¸ºå½“å‰æ ‘æ„é€ æ–°çš„åˆ†è£‚æ—¶ï¼ŒCatBoost ä»¥è´ªå©ªçš„æ–¹å¼è€ƒè™‘ç»„åˆã€‚å¯¹äºæ ‘ä¸­çš„ç¬¬ä¸€æ¬¡æ‹†åˆ†ï¼Œä¸è€ƒè™‘ä»»ä½•ç»„åˆã€‚å¯¹äºæ¥ä¸‹æ¥çš„åˆ†å‰²ï¼ŒCatBoost å°†å½“å‰æ ‘ä¸­å­˜åœ¨çš„æ‰€æœ‰ç»„åˆå’Œåˆ†ç±»ç‰¹å¾ä¸æ•°æ®é›†ä¸­çš„æ‰€æœ‰åˆ†ç±»ç‰¹å¾ç›¸ç»“åˆã€‚ç»„åˆå€¼è¢«åŠ¨æ€è½¬æ¢æˆæ•°å­—ã€‚CatBoost è¿˜ä»¥ä¸‹åˆ—æ–¹å¼ç”Ÿæˆæ•°å­—å’Œåˆ†ç±»ç‰¹å¾çš„ç»„åˆ:æ ‘ä¸­é€‰æ‹©çš„æ‰€æœ‰æ‹†åˆ†éƒ½è¢«è§†ä¸ºå…·æœ‰ä¸¤ä¸ªå€¼çš„åˆ†ç±»ï¼Œå¹¶ä»¥ä¸åˆ†ç±»ç›¸åŒçš„æ–¹å¼ç”¨äºç»„åˆã€‚

*å¯ä»¥ç»„åˆçš„æœ€å¤§ç‰¹å¾æ•°ã€‚æ¯ä¸ªç»“æœç»„åˆç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç±»ç‰¹å¾ç»„æˆï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©æ€§åœ°åŒ…å«ä»¥ä¸‹å½¢å¼çš„äºŒè¿›åˆ¶ç‰¹å¾:â€œæ•°å­—ç‰¹å¾>å€¼â€ã€‚å¯¹äº CPU ä¸Šçš„å›å½’ä»»åŠ¡ï¼Œé»˜è®¤å€¼ä¸º 4ã€‚*

è™½ç„¶æ–‡æ¡£ä¸­æ²¡æœ‰æåˆ°ï¼Œä½†è¯¥å‚æ•°å€¼å¿…é¡»å°äºæˆ–ç­‰äº 15ã€‚(å› ä¸ºæ­¤å‚æ•°åº”å°äºæœ€å¤§æ¢¯åº¦æ¨è¿›æ ‘æ·±åº¦)ã€‚

```
model_params = score_catboost_model({'max_ctr_complexity': 6})R2 score: 0.9335(0.0016) +0.0% compared to default parameters
RMSE score: 1657(24) -0.2% compared to default parametersmodel_params = score_catboost_model({'max_ctr_complexity': 0})R2 score: 0.9286(0.0041) -0.5% compared to default parameters
RMSE score: 1716(30) +3.4% compared to default parameters
```

æ­£å¦‚æˆ‘ä»¬åœ¨æ•°æ®é›†ä¸Šçœ‹åˆ°çš„ï¼Œæ¨¡å‹çš„å‡†ç¡®æ€§å·®å¼‚å¹¶ä¸æ˜¾è‘—ã€‚ä¸ºäº†æ£€æŸ¥æ¨¡å‹çš„å¤§å°æ˜¯å¦‚ä½•å—åˆ°å½±å“çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æˆ‘ä»¬çš„å‡½æ•°å¯¹æ¨¡å‹è¿›è¡ŒåŠ æƒã€‚

```
model_size_max_ctr_6 = weight_model({'max_ctr_complexity': 6})model_size_max_ctr_0 = weight_model({'max_ctr_complexity': 0})model_size_max_ctr_6/model_size_max_ctr_06.437194589788451
```

å¯ä»¥çœ‹å‡ºï¼Œå¯ä»¥ç»„åˆå¤šè¾¾ 6 ä¸ªç‰¹å¾çš„æ¨¡å‹æ¯”æ ¹æœ¬ä¸ç»„åˆç‰¹å¾çš„æ¨¡å‹é‡ 6 å€ã€‚

# æœ‰æ—¶é—´

å¯ç”¨æ­¤è®¾ç½®åï¼Œåœ¨å°†åˆ†ç±»ç‰¹å¾è½¬æ¢ä¸ºæ•°å­—ç‰¹å¾çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šæ‰§è¡Œéšæœºæ’åˆ—ã€‚å½“æ•°æ®é›†çš„å¯¹è±¡å·²ç»æŒ‰æ—¶é—´æ’åºæ—¶ï¼Œè¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚å¦‚æœæ—¶é—´æˆ³ç±»å‹çš„åˆ—å‡ºç°åœ¨è¾“å…¥æ•°æ®ä¸­ï¼Œåˆ™å®ƒç”¨äºç¡®å®šå¯¹è±¡çš„é¡ºåºã€‚

```
model_params = score_catboost_model({'has_time': **True**})R2 score: 0.9174(0.0029) -1.7% compared to default parameters
RMSE score: 1847(29) +11.3% compared to default parameters
```

# `simple_ctr`å’Œ`combinations_ctr`

`simple_ctr`å’Œ`combinations_ctr`éƒ½æ˜¯æä¾›åˆ†ç±»ç‰¹å¾ç¼–ç ç±»å‹è§„åˆ™çš„å¤æ‚å‚æ•°ã€‚è™½ç„¶`simple_ctr`è´Ÿè´£å¤„ç†æœ€åˆå‡ºç°åœ¨æ•°æ®é›†ä¸­çš„åˆ†ç±»è¦ç´ ï¼Œä½†æ˜¯`combinations_ctr`ä¼šå½±å“æ–°è¦ç´ çš„ç¼–ç ï¼Œè¿™äº›æ–°è¦ç´ æ˜¯ CatBoost é€šè¿‡ç»„åˆç°æœ‰è¦ç´ åˆ›å»ºçš„ã€‚å¯ç”¨çš„ç¼–ç æ–¹æ³•ä»¥åŠ`simple_ctr`å’Œ`combinations_ctr`çš„å¯èƒ½å€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸æ‰“ç®—åˆ†å¼€æ¥çœ‹ã€‚ä½†æ˜¯å½“ç„¶ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ä»»åŠ¡ä¸­åˆ†åˆ«è°ƒæ•´å®ƒä»¬ï¼

# æ— ç›®æ ‡é‡åŒ–çš„ç¼–ç 

**ç›®æ ‡é‡åŒ–**æ­£åœ¨ä½¿ç”¨ä¸€äº›è¾¹ç•Œå°†*æµ®ç‚¹*ç›®æ ‡å€¼è½¬æ¢ä¸º*æ•´æ•°*ç›®æ ‡å€¼ã€‚æˆ‘ä»¬å°†é¦–å…ˆè€ƒè™‘ä¸éœ€è¦è¿™ç§è½¬æ¢çš„ç›®æ ‡ç¼–ç æ–¹æ³•ã€‚

## FloatTargetMeanValue(ä»…é™ GPU)

ç¬¬ä¸€ä¸ªé€‰é¡¹ *FloatTargetMeanValue* æ˜¯æœ€ç›´æ¥çš„æ–¹æ³•ã€‚åˆ†ç±»å˜é‡çš„æ¯ä¸ªå€¼è¢«æ›¿æ¢ä¸ºæ”¾ç½®åœ¨å½“å‰å¯¹è±¡ä¹‹å‰çš„ç›¸åŒç±»åˆ«çš„å¯¹è±¡çš„ç›®æ ‡å¹³å‡å€¼ã€‚

```
model_params = score_catboost_model(
{'simple_ctr' : 'FloatTargetMeanValue', 'combinations_ctr' : 'FloatTargetMeanValue', 'task_type' : 'GPU'})R2 score: 0.9183(0.0022) -1.6% compared to default parameters
RMSE score: 1837(32) +10.7% compared to default parameters
```

## FeatureFreq(ä»…é™ GPU)

ç¬¬äºŒä¸ªé€‰é¡¹æ˜¯ *FeatureFreq* ã€‚åˆ†ç±»ç‰¹å¾å€¼è¢«æ›¿æ¢ä¸ºæ•°æ®é›†ä¸­ç±»åˆ«çš„é¢‘ç‡ã€‚åŒæ ·ï¼Œåªä½¿ç”¨æ”¾ç½®åœ¨å½“å‰å¯¹è±¡ä¹‹å‰çš„å¯¹è±¡ã€‚

```
model_params = score_catboost_model(
{'simple_ctr' : 'FeatureFreq', 'combinations_ctr' : 'FeatureFreq', 'task_type' : 'GPU'})R2 score: 0.9170(0.0019) -1.8% compared to default parameters
RMSE score: 1852(12) +11.6% compared to default parameters
```

## è®¡æ•°å™¨

æˆ‘ä»¬å·²ç»åœ¨â€œé»˜è®¤å‚æ•°â€ä¸€èŠ‚ä¸­è®¨è®ºäº† Counter æ–¹æ³•ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ›å»ºç‰¹æ€§ç¼–ç ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥å°†`Counter`ä¼ é€’ç»™`simple_ctr`å’Œ/æˆ–`combinations_ctr`ï¼ŒCatBoost å°†åªä½¿ç”¨*çš„*è®¡æ•°å™¨ç‰¹æ€§ç¼–ç ã€‚

```
model_params = score_catboost_model({'simple_ctr' : 'Counter', 'combinations_ctr' : 'Counter'})R2 score: 0.9288(0.0014) -0.5% compared to default parameters
RMSE score: 1715(12) +3.3% compared to default parameters
```

## `CtrBorderCount`å‚æ•°

å‡è®¾æˆ‘ä»¬å·²ç»è®¡ç®—äº†åˆ†ç±»å˜é‡çš„ç¼–ç ã€‚è¿™äº›ç¼–ç æ˜¯æµ®åŠ¨çš„ï¼Œå®ƒä»¬æ˜¯å¯æ¯”è¾ƒçš„:åœ¨`Counter`çš„æƒ…å†µä¸‹ï¼Œè¾ƒå¤§çš„ç¼–ç å€¼å¯¹åº”äºæ›´é¢‘ç¹çš„ç±»åˆ«ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤§é‡çš„ç±»åˆ«ï¼Œç›¸è¿‘ç±»åˆ«ç¼–ç ä¹‹é—´çš„å·®å¼‚å¯èƒ½æ˜¯ç”±å™ªå£°å¼•èµ·çš„ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æˆ‘ä»¬çš„æ¨¡å‹åŒºåˆ†ç›¸è¿‘çš„ç±»åˆ«ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬å°†æµ®ç‚¹ç¼–ç è½¬æ¢ä¸º int ç¼–ç ğ‘–âˆˆ[0,ğ‘™]iâˆˆ[0,l].é»˜è®¤æƒ…å†µä¸‹`CtrBorderCount=15`è®¾ç½®æ„å‘³ç€ğ‘™=14(15âˆ’1)l=14(15âˆ’1).æˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ä¸€ä¸ªæ›´å¤§çš„å€¼:

```
model_params = score_catboost_model({'combinations_ctr': 
                               ['Counter:CtrBorderCount=40:Prior=0.5/1'],
                                     'simple_ctr':                  ['Counter:CtrBorderCount=40:Prior=0.5/1']})R2 score: 0.9337(0.0013) -0.0% compared to default parameters
RMSE score: 1655(13) +0.2% compared to default parameters
```

## äºŒå€¼åŒ–ç›®æ ‡å¹³å‡å€¼

ç¬¬äºŒç§æ–¹æ³•`BinarizedTargetMeanValue`éå¸¸ç±»ä¼¼äºç›®æ ‡ç¼–ç ï¼Œé™¤äº†æˆ‘ä»¬ä½¿ç”¨ beans å€¼çš„å’Œè€Œä¸æ˜¯ç²¾ç¡®ç›®æ ‡å€¼çš„å’Œã€‚å…¶å¯¹åº”äºä»¥ä¸‹å…¬å¼:

![](img/a7585efd7422e33288441761d7ddebf0.png)

å…¶ä¸­:

*   *countInClass* æ˜¯è¯¥åˆ†ç±»ç‰¹å¾çš„æ ‡ç­¾å€¼æ•´æ•°ä¹‹å’Œä¸æœ€å¤§æ ‡ç­¾å€¼æ•´æ•° *k* çš„æ¯”å€¼ã€‚
*   *totalCount* æ˜¯ç‰¹å¾å€¼ä¸å½“å‰å€¼åŒ¹é…çš„å¯¹è±¡æ€»æ•°ã€‚
*   *å…ˆéªŒ*æ˜¯ä¸€ä¸ªç”±èµ·å§‹å‚æ•°å®šä¹‰çš„æ•°(å¸¸æ•°)ã€‚

```
model_params = score_catboost_model(
{'combinations_ctr':'BinarizedTargetMeanValue', 'simple_ctr': 'BinarizedTargetMeanValue'})R2 score: 0.9312(0.0008) -0.2% compared to default parameters
RMSE score: 1685(20) +1.6% compared to default parameters{k:v **for** k, v **in** model_params.items() **if** k **in** ctr_parameters}{'combinations_ctr': ['BinarizedTargetMeanValue:CtrBorderCount=15:CtrBorderType=Uniform:TargetBorderCount=1:TargetBorderType=MinEntropy:Prior=0/1:Prior=0.5/1:Prior=1/1'],
 'simple_ctr': ['BinarizedTargetMeanValue:CtrBorderCount=15:CtrBorderType=Uniform:TargetBorderCount=1:TargetBorderType=MinEntropy:Prior=0/1:Prior=0.5/1:Prior=1/1']}
```

åœ¨ä½¿ç”¨`BinarizedTargetMeanValue`æ–¹æ³•çš„åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾®è°ƒ`Prior`å’Œ`CtrBorderCount`(ç”¨äºé‡åŒ–ç±»åˆ«ç‰¹å¾ç¼–ç çš„è¾¹ç•Œæ•°é‡)ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`CtrBorderCount` =15ï¼Œ0ã€0.5 å’Œ 1 `Prior`å€¼ç”¨äºæ„å»ºä¸‰ç§ä¸åŒçš„ç¼–ç ã€‚

# ç›®æ ‡é‡åŒ–ç¼–ç 

## æ¡¶å’Œè¾¹æ¡†

ç°åœ¨æˆ‘ä»¬ç»§ç»­è®¾ç½®éœ€è¦ç›®æ ‡é‡åŒ–çš„ç¼–ç æ–¹æ³•ã€‚é¦–é€‰æ˜¯`Borders`vs`Buckets`ã€‚è¿™ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«éå¸¸ç®€å•ã€‚ä¸¤è€…éƒ½ç”±ä»¥ä¸‹å…¬å¼æè¿°:

å¯¹äº`Borders`çš„ã€0ï¼Œ *k* -1ã€‘ä¸­çš„ *i* å’Œ`Buckets`çš„ã€0ï¼Œ *k* ä¸­çš„ *i* :

![](img/f2b7b02f9f4c834ca38689e43b38c291.png)

å…¶ä¸­ *k* æ˜¯ç”±å‚æ•°`TargetBorderCount`è°ƒèŠ‚çš„è¾¹ç•Œæ•°é‡ï¼Œ

*totalCount* æ˜¯åŒä¸€ç±»åˆ«çš„å¯¹è±¡æ•°é‡ã€‚*ä¹‹å‰çš„*ç”±å‚æ•°`prior`å®šä¹‰ã€‚å”¯ä¸€ä¸åŒçš„æ˜¯å¯¹äº`Borders` *countInClass* æ˜¯ç¦»æ•£åŒ–ç›®æ ‡å€¼**å¤§äº *i* çš„ç±»åˆ«çš„å¯¹è±¡æ•°ï¼Œè€Œå¯¹äº`Buckets` *countInClass* æ˜¯ç¦»æ•£åŒ–ç›®æ ‡å€¼**ç­‰äº**åˆ° *i* çš„ç±»åˆ«çš„å¯¹è±¡æ•°ã€‚**

![](img/8e966b1de80e3b93645d6eb8c9654678.png)

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå°ä¾‹å­:æˆ‘ä»¬æœ‰ä¸¤ç±»ç‰©ä½“æ˜¾ç¤ºä¸ºå¤ªé˜³å’Œæœˆäº®ã€‚æˆ‘ä»¬å°†è®¡ç®—è¾¹ç•Œå’Œæ¡¶çš„åˆ†ç±»ç‰¹å¾ç¼–ç ã€‚

è¾¹æ¡†:æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¾¹æ¡†(å¯¹åº”äº`TargetBorderCount=2`)ï¼Œæ‰€ä»¥éœ€è¦è®¡ç®— 2 ä¸ªç¼–ç ã€‚å‡è®¾æˆ‘ä»¬çš„å…ˆéªŒæ˜¯ 0.5

![](img/c057b0c38a179b7674b69ea8f16ffecd.png)

æ¡¶:ã€0ï¼Œã€‘k ä¸­çš„ *i* åˆ›å»º *k* +1 ä¸ªæ¡¶ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©`Buckets`ï¼Œç›¸åŒçš„å‚æ•°å€¼`TargetBorderCount=2`ä¼šä»æ¯ä¸ªåˆ†ç±»ç‰¹å¾ä¸­åˆ›å»ºæ›´å¤šçš„ç‰¹å¾ã€‚

![](img/ae31829a8b12405195dd7a97061df9df.png)

*é‡è¦æç¤ºï¼è¿™ä¸ªä¾‹å­åªæ˜¯ç”¨æ¥è¯´æ˜* `*Borders*` *å’Œ* `*Buckets*` *çš„åŒºåˆ«ï¼Œæ•´ä¸ªæ•°æ®é›†ç”¨æ¥è®¡ç®— countInClass å’Œ totalCountã€‚å®é™…ä¸Šï¼ŒCatBoost ä»…ä½¿ç”¨åœ¨ä½¿ç”¨å½“å‰å¯¹è±¡ä¹‹å‰æ”¾ç½®çš„å¯¹è±¡ã€‚*

è®©æˆ‘ä»¬çœ‹çœ‹å®ƒåœ¨å®è·µä¸­æ˜¯å¦æœ‰æ‰€ä¸åŒ:

```
model_params = score_catboost_model({'combinations_ctr': 'Borders',
                                     'simple_ctr': 'Borders'})R2 score: 0.9311(0.0017) -0.2% compared to default parameters
RMSE score: 1688(40) +1.7% compared to default parametersmodel_params = score_catboost_model({'combinations_ctr': 'Buckets',
                                     'simple_ctr': 'Buckets'})R2 score: 0.9314(0.0048) -0.2% compared to default parameters
RMSE score: 1682(49) +1.4% compared to default parameters
```

ç»†å¿ƒçš„è¯»è€…å¯èƒ½è®°å¾—ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒCatBoost ä½¿ç”¨`Borders`åˆ†å‰²åˆ›å»ºä¸€äº›ç‰¹å¾ï¼Œä¹Ÿä½¿ç”¨`Counter`æ–¹æ³•åˆ›å»ºä¸€äº›ç‰¹å¾ã€‚å½“æˆ‘ä»¬æ˜¾å¼ä¼ é€’`Borders`é€‰é¡¹æ—¶ï¼Œä¸ä½¿ç”¨`Counter`æ–¹æ³•ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨`Borders`è¿›è¡Œå›å½’ä»»åŠ¡ï¼Œä½¿ç”¨`Buckets`è¿›è¡Œå¤šåˆ†ç±»ä»»åŠ¡ã€‚

# ç¼ºå¤±å€¼å’Œæ–°ç±»åˆ«çš„å¤„ç†

*   å¦‚æœæµ‹è¯•é›†ä¸­æœ‰ä¸€ä¸ª**æ–°ç±»åˆ«**ä»æœªå‡ºç°åœ¨è®­ç»ƒé›†ä¸­ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯ï¼Œç”±äºğ‘ğ‘œğ‘¢ğ‘›ğ‘¡ğ¼ğ‘›ğ¶ğ‘™ğ‘ğ‘ ğ‘ ğ‘ğ‘œğ‘¢ğ‘›ğ‘¡ğ¼ğ‘›ğ¶ğ‘™ğ‘ğ‘ ğ‘ ç­‰äºé›¶ï¼Œå…ˆéªŒè¢«ç”¨äºè®¡ç®—ç¼–ç :

![](img/4f8f1eeef445a3a20b8c3416cb16c0e5.png)

*   åŒæ—¶ï¼Œåˆ†ç±»ç‰¹å¾ä¸­ç¼ºå¤±çš„å€¼è¢«æ›¿æ¢ä¸º`"None"`å­—ç¬¦ä¸²ã€‚é‚£ä¹ˆå…·æœ‰ä¸¢å¤±ç‰¹å¾å€¼çš„æ‰€æœ‰å¯¹è±¡è¢«è§†ä¸ºä¸€ä¸ªæ–°çš„ç±»åˆ«ã€‚

## è¾¹ç•Œæ•°é‡

è¾¹ç•Œæˆ–æ¡¶çš„æ•°é‡å¯é€šè¿‡`TargetBorderCount`å‚æ•°æ§åˆ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªè¾¹æ¡†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æœ‰æ›´å¤šçš„è¾¹æ¡†æ˜¯å¦æœ‰å¸®åŠ©:

```
model_params = score_catboost_model({'combinations_ctr': 'Borders:TargetBorderCount=4',
                                     'simple_ctr': 'Borders:TargetBorderCount=4'})R2 score: 0.9356(0.0019) +0.2% compared to default parameters
RMSE score: 1631(9) -1.7% compared to default parameters
```

# `simple_ctr`å’Œ`combinations_ctr`çš„é»˜è®¤å€¼

é»˜è®¤æƒ…å†µä¸‹ï¼ŒCatBoost ä½¿ç”¨å¤šç§ç¼–ç æŠ€æœ¯å¯¹æ¯ä¸ªåˆ†ç±»ç‰¹å¾è¿›è¡Œç¼–ç ã€‚

*   é¦–å…ˆï¼Œå®ƒä½¿ç”¨å¸¦æœ‰ä¸€ä¸ªç›®æ ‡è¾¹ç•Œ`TargetBorderCount` =1 çš„`Borders`æ–¹æ³•(åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå¯¹äºæ¯ä¸ªåˆ†ç±»ç‰¹å¾ï¼Œæˆ‘ä»¬åªæƒ³çœ‹çœ‹å®ƒæ˜¯å¦ä¼šä½¿æ±½è½¦æ›´è´µ)ã€‚è·å¾—çš„æµ®ç‚¹ç¼–ç è¢«è¿›ä¸€æ­¥ç¦»æ•£æˆ`CtrBorderCount` =15 ä¸ªä¸åŒçš„å€¼ã€‚`Prior`å‚æ•°çš„ä¸‰ä¸ªå€¼ç”¨äºåˆ›å»ºä¸‰ç§ä¸åŒçš„ç¼–ç :`Prior=0/1:Prior=0.5/1:Prior=1/1`
*   åŒæ ·ï¼Œå¯¹äºæ¯ä¸ªåˆ†ç±»ç‰¹å¾ï¼Œæˆ‘ä»¬ç”¨`Counter`æ–¹æ³•åˆ›å»ºä¸€ä¸ªç¼–ç ã€‚åˆ†ç±»ç¼–ç å€¼è¾¹ç•Œçš„æ•°é‡`CtrBorderCount`ä¹Ÿç­‰äº 15ï¼Œå¹¶ä¸”ä»…ä½¿ç”¨ä¸€ä¸ªå€¼`Prior=0/1`ã€‚

æˆ‘ä»¬æ€»æ˜¯å¯ä»¥ç”¨`get_all_params()`æ–¹æ³•æ£€æŸ¥æˆ‘ä»¬çš„æ¨¡å‹æ‰€ä½¿ç”¨çš„å‚æ•°ã€‚

```
last_model_params = score_catboost_model({}, True)
last_model_params['simple_ctr']['Borders:CtrBorderCount=15:CtrBorderType=Uniform:TargetBorderCount=1:TargetBorderType=MinEntropy:Prior=0/1:Prior=0.5/1:Prior=1/1',
 'Counter:CtrBorderCount=15:CtrBorderType=Uniform:Prior=0/1']last_model_params['combinations_ctr']['Borders:CtrBorderCount=15:CtrBorderType=Uniform:TargetBorderCount=1:TargetBorderType=MinEntropy:Prior=0/1:Prior=0.5/1:Prior=1/1',
 'Counter:CtrBorderCount=15:CtrBorderType=Uniform:Prior=0/1']
```

# é€šè¿‡`per_feature_ctr`å‚æ•°æ§åˆ¶ä¸ªåˆ«åŠŸèƒ½

æˆ‘æƒ³åœ¨æœ¬æ•™ç¨‹ä¸­è°ˆçš„ä¸‹ä¸€ä»¶äº‹æ˜¯ç”¨å‚æ•°`per_feature_ctr`å¯¹ä¸åŒçš„ç‰¹æ€§ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹æ³•ã€‚å½“æ‚¨çŸ¥é“æ‚¨çš„æŸä¸ªåŠŸèƒ½æ¯”å…¶ä»–åŠŸèƒ½æ›´é‡è¦æ—¶ï¼Œè¿™å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ æ¨¡å‹åç§°ç‰¹å¾çš„ç›®æ ‡è¾¹ç•Œæ•°é‡:

```
model_params = score_catboost_model({'per_feature_ctr': ['1:Borders:TargetBorderCount=10:Prior=0/1'] })R2 score: 0.9361(0.0005) +0.3% compared to default parameters
RMSE score: 1625(28) -2.1% compared to default parameters
```

# å…¶ä»–å‚æ•°

# è®¡æ•°å™¨è®¡ç®—æ–¹æ³•

è¯¥å‚æ•°å†³å®šæ˜¯å¦ä½¿ç”¨éªŒè¯æ•°æ®é›†(é€šè¿‡`fit`æ–¹æ³•çš„å‚æ•°`eval_set`æä¾›)æ¥ä¼°è®¡`Counter`çš„ç±»åˆ«é¢‘ç‡ã€‚é»˜è®¤ä¸º`Full`ï¼Œä½¿ç”¨éªŒè¯æ•°æ®é›†ä¸­çš„å¯¹è±¡ï¼›ä¼ é€’`SkipTest`å€¼ä»¥å¿½ç•¥æ¥è‡ªæˆ‘ä»¬`score_catboost_model`å‡½æ•°ä¸­éªŒè¯é›†çš„å¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒæœŸé—´æ ¹æœ¬ä¸ç»™ CatBoost éªŒè¯æ•°æ®é›†ï¼Œå› æ­¤ä¸ºäº†æ£€æŸ¥è¯¥æ–¹æ³•çš„æ•ˆæœï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è®­ç»ƒ/æµ‹è¯•åˆ†å‰²ã€‚

```
model = CatBoostRegressor(custom_metric= ['R2', 'RMSE'], learning_rate=0.1, n_estimators=4500, 
                          counter_calc_method='Full')
model.fit(train_pool, eval_set=test_pool, verbose=**False**)
r2_res = r2_score(df_test.price_usd.values, model.predict(test_pool))
rmse_res = mean_squared_error(df_test.price_usd.values, model.predict(test_pool))print('Counter Calculation Method Full: R2=**{:.4f}** RMSE=**{:.0f}**'.format(r2_res, rmse_res))Counter Calculation Method Full: R2=0.9334 RMSE=2817626model = CatBoostRegressor(custom_metric= ['R2', 'RMSE'], learning_rate=0.1, n_estimators=4500, 
                          counter_calc_method='SkipTest')
model.fit(train_pool, eval_set=test_pool, verbose=**False**)
r2_res = r2_score(df_test.price_usd.values, model.predict(test_pool))
rmse_res = mean_squared_error(df_test.price_usd.values, model.predict(test_pool))print('Counter Calculation Method SkipTest: R2=**{:.4f}** RMSE=**{:.0f}**'.format(r2_res, rmse_res))Counter Calculation Method SkipTest: R2=0.9344 RMSE=2777802
```

# ç›®æ ‡é‡åŒ–çš„è¾¹ç•Œæ•°é‡

*ç”¨äºåˆ†ç±»ç‰¹å¾ç›®æ ‡é‡åŒ–çš„æœ€å¤§è¾¹ç•Œæ•°ã€‚å›å½’ä»»åŠ¡çš„é»˜è®¤å€¼ä¸º 1ã€‚*

è®©æˆ‘ä»¬è¯•ä¸€è¯•ç›¸å½“å¤šçš„è¾¹ç•Œ:

```
model_params = score_catboost_model({'ctr_target_border_count': 10})R2 score: 0.9375(0.0046) +0.4% compared to default parameters
RMSE score: 1606(73) -3.2% compared to default parameters
```

# åˆ†ç±»å€¼é™åˆ¶

æ­¤å‚æ•°æ§åˆ¶æ¨¡å‹ä½¿ç”¨çš„æœ€å¸¸è§åˆ†ç±»ç‰¹å¾å€¼çš„æ•°é‡ã€‚å¦‚æœæˆ‘ä»¬æœ‰ *n* ä¸ªå”¯ä¸€ç±»åˆ«å’Œ`ctr_leaf_count_limit` = *m* ä¸ªå”¯ä¸€ç±»åˆ«ï¼Œæˆ‘ä»¬åªä¿ç•™æœ€é¢‘ç¹ç±»åˆ«ä¸­å¯¹è±¡çš„åˆ†ç±»ç‰¹å¾å€¼ã€‚å¯¹äºå‰©ä½™ç±»åˆ«ä¸­çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ç”¨`None`æ›¿æ¢åˆ†ç±»ç‰¹å¾å€¼ã€‚

è¯¥å‚æ•°çš„é»˜è®¤å€¼æ˜¯`None` -æ‰€æœ‰åˆ†ç±»ç‰¹å¾å€¼éƒ½è¢«ä¿ç•™ã€‚

```
model_params = score_catboost_model({'ctr_leaf_count_limit' : 5})R2 score: 0.8278(0.0236) -11.3% compared to default parameters
RMSE score: 2661(187) +60.4% compared to default parameters
```

å“å‘€ï¼åœ¨æˆ‘ä»¬çš„æ•°æ®é›†ä¸Šï¼Œå®ƒç ´åäº†æ¨¡å‹æ€§èƒ½ã€‚

# å­˜å‚¨ç®€å•çš„åˆ†ç±»ç‰¹å¾

å¦‚æœå¯¹ä¹‹å‰çš„å‚æ•°`ctr_leaf_count_limit`è¿›è¡Œæ­¤è®¾ç½®ï¼Œåˆ™åªä¼šå½±å“ CatBoost é€šè¿‡ç»„åˆåˆå§‹è¦ç´ åˆ›å»ºçš„åˆ†ç±»è¦ç´ ï¼Œè€Œæ•°æ®é›†ä¸­å­˜åœ¨çš„åˆå§‹åˆ†ç±»è¦ç´ ä¸ä¼šå—åˆ°å½±å“ã€‚å½“å‚æ•°`ctr_leaf_count_limit`ä¸º`None`æ—¶ï¼Œå‚æ•°`store_all_simple_ctr`æ— æ•ˆã€‚

```
model_params = score_catboost_model({'store_all_simple_ctr' : **True**, 'ctr_leaf_count_limit' : 5})R2 score: 0.8971(0.0070) -3.9% compared to default parameters
RMSE score: 2060(74) +24.2% compared to default parameters
```

# å†…éƒ¨ç‰¹å¾é‡è¦æ€§

å¯¹ä¸€ä¸ªåˆ†ç±»ç‰¹å¾ä½¿ç”¨å‡ ç§ç¼–ç æ˜¯å¾ˆå¸¸è§çš„ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒCatBoost ä¸ºæ¯ä¸ªåˆ†ç±»ç‰¹å¾åˆ›å»º 4 ç§ä¸åŒçš„ç¼–ç (å‚è§â€œsimple_ctr å’Œ combinations_ctr çš„é»˜è®¤å€¼â€ä¸€èŠ‚)ã€‚å½“æˆ‘ä»¬è°ƒç”¨`get_feature_importances`æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°åˆ†ç±»ç‰¹å¾çš„æ‰€æœ‰ç¼–ç é‡è¦æ€§çš„é›†åˆã€‚è¿™æ˜¯å› ä¸ºåœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬é€šå¸¸åªæƒ³æ¯”è¾ƒæ•°æ®é›†ä¸­ä¸åŒç‰¹å¾çš„æ€»ä½“æœ‰ç”¨æ€§ã€‚

ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“å“ªç§ç¼–ç æœ€é€‚åˆæˆ‘ä»¬å‘¢ï¼Ÿä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—**å†…éƒ¨ç‰¹æ€§é‡è¦æ€§ã€‚**ç›®å‰ï¼Œå®ƒä»…åœ¨å‘½ä»¤è¡Œç‰ˆæœ¬çš„ CatBoost åº“ä¸­å¯ç”¨ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å…³äºå®‰è£…[çš„ç»†èŠ‚ï¼Œåœ¨æœ¬æ•™ç¨‹](https://catboost.ai/docs/concepts/cli-installation.html)ä¸­[æ‰¾åˆ°ä¸€ä¸ªå¦‚ä½•ç”¨å‘½ä»¤è¡Œç‰ˆæœ¬è®­ç»ƒæ¨¡å‹çš„ä¾‹å­ã€‚](https://github.com/catboost/catboost/blob/master/catboost/tutorials/cmdline_tutorial/cmdline_tutorial.md)

è¦ä½¿ç”¨å‘½ä»¤è¡Œç‰ˆæœ¬è®­ç»ƒæ¨¡å‹ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªåˆ—æè¿°æ–‡ä»¶:

```
descr = ['Categ' if i in categorical_features_names else 'Auxiliary' for i in df.columns]
descr[14] = 'Target'
pd.Series(descr).to_csv('train.cd', sep='\t', header=None)
```

ç„¶åè®­ç»ƒä¸€ä¸ªæ¨¡å‹:

`catboost fit --learn-set cars.csv --loss-function RMSE --learning-rate 0.1 --iterations 4500 --delimiter=',' --has-header --column-description train.cd`

ç„¶ååˆ›å»ºä¸€ä¸ªå†…éƒ¨ç‰¹å¾é‡è¦æ€§æ–‡ä»¶:`catboost fstr -m model.bin --cd train.cd --fstr-type InternalFeatureImportance -o feature_strength.tsv`

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹:

```
9.318442186    transmission   7.675430604    {model_name} prior_num=1 prior_denom=1 targetborder=0 type=Borders  
3.04782682    {model_name} prior_num=0 prior_denom=1 targetborder=0 type=Borders  
2.951546528    {model_name} prior_num=0.5 prior_denom=1 targetborder=0 type=Borders   
2.939078189    {body_type} prior_num=0 prior_denom=1 targetborder=0 type=Borders   
2.666138982    {state, transmission} prior_num=0.5 prior_denom=1 targetborder=0 type=Borders   
2.431465565    {body_type} prior_num=1 prior_denom=1 targetborder=0 type=Borders   
2.059354431    {manufacturer_name} prior_num=0 prior_denom=1 targetborder=0 type=Counter   
1.946443049    {state} prior_num=1 prior_denom=1 targetborder=0 type=Borders   
1.932116622    {color} prior_num=1 prior_denom=1 targetborder=0 type=Borders   
1.633469855    {color} prior_num=0.5 prior_denom=1 targetborder=0 type=Borders   
1.561168441    {manufacturer_name} prior_num=0.5 prior_denom=1 targetborder=0 type=Borders   
1.419944596    {manufacturer_name} prior_num=0 prior_denom=1 targetborder=0 type=Borders   
1.3323198    {body_type} prior_num=0 prior_denom=1 targetborder=0 type=Counter   1.068973258    {color} prior_num=0 prior_denom=1 targetborder=0 type=Counter   
1.038663366    {manufacturer_name} prior_num=1 prior_denom=1 targetborder=0 type=Borders   
1.001434874    {manufacturer_name, body_type} prior_num=0 prior_denom=1 targetborder=0 type=Counter   
0.9012036663    {body_type} prior_num=0.5 prior_denom=1 targetborder=0 type=Borders   
0.8805961369    {manufacturer_name, body_type} prior_num=1 prior_denom=1 targetborder=0 type=Borders   
0.8796937131    {drivetrain} prior_num=0 prior_denom=1 targetborder=0 type=Borders   
...   
...   
1.476546485e-05    {engine_fuel, engine_type} prior_num=0 prior_denom=1 targetborder=0 type=Borders   
7.417408934e-06    {engine_type, body_type, state, location_region} prior_num=0.5 prior_denom=1 targetborder=0 type=Borders
```

*   æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæœ€é‡è¦çš„ç‰¹å¾æ˜¯ä¼ è¾“ï¼›
*   ç„¶åæˆ‘ä»¬æœ‰ 3 ä¸ª`Borders`ç±»å‹ç¼–ç ç”¨äºå…·æœ‰ä¸åŒå…ˆéªŒçš„`model_name`åˆ†ç±»ç‰¹å¾ï¼›
*   ç„¶åå¯¹`body_type`ç‰¹å¾è¿›è¡Œç¼–ç ï¼›
*   ç„¶åæˆ‘ä»¬æœ‰ä¸€ä¸ª CatBoost ä»`state`å’Œ`transmission`ç‰¹å¾çš„ç»„åˆä¸­åˆ›å»ºçš„åˆ†ç±»ç‰¹å¾

ä¸€ä¸ªæœ‰è¶£çš„è§‚å¯Ÿç»“æœæ˜¯ï¼Œå¯¹äºåƒ`model_name`è¿™æ ·çš„ä¸€äº›ç‰¹å¾ï¼Œæœ€æœ‰ç”¨çš„æ˜¯`Border`ç±»å‹çš„ç¼–ç ï¼Œè€Œå¯¹äºå…¶ä»–ç‰¹å¾ï¼Œä¾‹å¦‚`manufacturer_name`ï¼Œæœ€æœ‰ç”¨çš„ç¼–ç æ˜¯é€šè¿‡`Counter`æ–¹æ³•è·å¾—çš„ã€‚

# `logging_level=Info`

äº†è§£ä½ çš„æ¨¡å‹å¦‚ä½•å·¥ä½œçš„å¦ä¸€ç§æ–¹æ³•æ˜¯ç”¨`logging_level=Info`å‚æ•°è¿›è¡Œè®­ç»ƒã€‚æ­¤è®¾ç½®å…è®¸æˆ‘ä»¬æŸ¥çœ‹ä¸ºæ¯æ£µæ ‘é€‰æ‹©çš„ç‰¹å¾åˆ†å‰²:

```
model = CatBoostRegressor(custom_metric= ['R2', 'RMSE'], learning_rate=0.3, n_estimators=5)
model.fit(train_pool, eval_set=test_pool, logging_level='Info')year_produced, bin=47 score 669154.1979
{drivetrain} pr0 tb0 type1, border=10 score 754651.9724
year_produced, bin=56 score 809503.2502
year_produced, bin=51 score 856912.7803
engine_capacity, bin=24 score 888794.1978
{state} pr1 tb0 type0, border=12 score 901338.6173
0:	learn: 5040.7980368	test: 5141.1143627	best: 5141.1143627 (0)	total: 17.9ms	remaining: 71.7msyear_produced, bin=49 score 474289.2398
engine_capacity, bin=14 score 565290.1728
year_produced, bin=54 score 615593.891
year_produced, bin=43 score 638265.472
{state} pr1 tb0 type0, border=10 score 663225.8837
engine_capacity, bin=24 score 667635.803
1:	learn: 4071.9260223	test: 4162.4422665	best: 4162.4422665 (1)	total: 24.9ms	remaining: 37.3msyear_produced, bin=50 score 332853.7156
{body_type} pr2 tb0 type0, border=8 score 403465.931
{manufacturer_name} pr0 tb0 type0, border=7 score 428269.628
year_produced, bin=38 score 458860.027
feature_2, bin=0 score 474315.0996
year_produced, bin=54 score 485594.3961
2:	learn: 3475.0456278	test: 3544.0465297	best: 3544.0465297 (2)	total: 31.3ms	remaining: 20.9msyear_produced, bin=45 score 250517.4612
engine_capacity, bin=13 score 290570.2886
year_produced, bin=55 score 340482.1423
{manufacturer_name} pr1 tb0 type0, border=6 score 352029.1735
feature_1, bin=0 score 368528.2728
year_produced, bin=50 score 376011.7075
3:	learn: 3066.9757921	test: 3128.4648163	best: 3128.4648163 (3)	total: 37.4ms	remaining: 9.35msyear_produced, bin=46 score 184224.3588
feature_6, bin=0 score 214268.3547
{body_type} pr0 tb0 type1, border=5 score 238951.9169
{state} pr1 tb0 type0, border=9 score 260941.1746
transmission, value=1 score 275871.0414
{engine_fuel} pr1 tb0 type0, border=7 score 289133.3086
4:	learn: 2797.0109121	test: 2864.4763038	best: 2864.4763038 (4)	total: 42.8ms	remaining: 0usbestTest = 2864.476304
bestIteration = 4
```

*å¯¹äºæ•°å­—ç‰¹å¾ï¼Œæ ¼å¼å¦‚ä¸‹:*

ç‰¹å¾åç§°ã€æ‰€é€‰åˆ†å‰²çš„ç´¢å¼•ã€åˆ†å‰²åˆ†æ•°

ç¤ºä¾‹:`year_produced, bin=47 score 669154.1979`

*åˆ†ç±»ç‰¹å¾çš„æ ¼å¼ä¸º:*

ç‰¹å¾åç§°ã€å…ˆéªŒã€ç›®æ ‡è¾¹ç•Œã€ç¼–ç ç±»å‹ã€åˆ†ç±»ç‰¹å¾è¾¹ç•Œã€åˆ†å‰²åˆ†æ•°

ä¾‹å­:`{state} pr1 tb0 type0, border=12 score 901338.6173`

ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œåˆ†ç±»ç‰¹å¾åç§°å†™åœ¨æ‹¬å·{}ä¸­

# äºŒå…ƒåˆ†ç±»å’Œå¤šå…ƒåˆ†ç±»ä»»åŠ¡çš„å‚æ•°è°ƒæ•´ã€‚

åœ¨æˆ‘ä»¬çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨è¿›è¡Œå›å½’ä»»åŠ¡ï¼Œæ‰€ä»¥æˆ‘æƒ³å¯¹äºŒå…ƒåˆ†ç±»å’Œå¤šåˆ†ç±»ä»»åŠ¡çš„åˆ†ç±»å‚æ•°è°ƒæ•´åšä¸€äº›è¯´æ˜ã€‚

*   å¯¹äº**äºŒå…ƒåˆ†ç±»ï¼Œ**å‚æ•°è°ƒæ•´ä¸å›å½’ä»»åŠ¡éå¸¸ç›¸ä¼¼ï¼Œé™¤äº†å¢åŠ `TargetBorderCount`å‚æ•°å€¼é€šå¸¸æ˜¯æ— ç”¨çš„(é™¤éä½ ä¼ é€’æ¦‚ç‡ä½œä¸ºç›®æ ‡)ã€‚
*   åœ¨**å¤šåˆ†ç±»**ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥è®°ä½ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨ç±»ä¸Šæ²¡æœ‰ä»»ä½•è‡ªç„¶é¡ºåºï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨`FloatTargetMeanValue`æˆ–`BinarizedTargetMeanValue`ç¼–ç ã€‚å¦‚æœä½ çš„è®­ç»ƒæ—¶é—´å¤ªé•¿ï¼Œä½ å¯ä»¥è¯•ç€å°†`TargetBorderCount`è®¾ç½®ä¸ºä¸€ä¸ªæ¯”é»˜è®¤çš„ n_classes - 1 æ›´ä½çš„å€¼ï¼Œå¦‚æœæœ‰åŠæ³•å°†ä½ çš„ä¸€äº›ç±»åˆå¹¶çš„è¯ã€‚

# ç»“è®º

![](img/6dd09dea93424648366098c64cb0b706.png)

æ­å–œæ‰€æœ‰è¯»å®Œæœ¬æ•™ç¨‹çš„äºº:)æ­£å¦‚æˆ‘ä»¬çœ‹åˆ°çš„ï¼ŒCatBoost åŒ…ä¸­ä¸åˆ†ç±»ç‰¹å¾å¤„ç†ç›¸å…³çš„å¯è°ƒå‚æ•°çš„æ•°é‡ä»¤äººå°è±¡æ·±åˆ»ã€‚æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•æ§åˆ¶å®ƒä»¬ï¼Œæˆ‘éå¸¸å¸Œæœ›è¿™äº›çŸ¥è¯†èƒ½å¤Ÿå¸®åŠ©æ‚¨åœ¨æ¶‰åŠåˆ†ç±»æ•°æ®çš„ä»»åŠ¡ä¸­è·å¾—æœ€ä½³ç»“æœï¼