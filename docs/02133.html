<html>
<head>
<title>How To Train Your Chatbot With Simple Transformers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用简单的变形金刚训练你的聊天机器人</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-train-your-chatbot-with-simple-transformers-da25160859f4?source=collection_archive---------10-----------------------#2020-02-29">https://towardsdatascience.com/how-to-train-your-chatbot-with-simple-transformers-da25160859f4?source=collection_archive---------10-----------------------#2020-02-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="de23" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创造一个令人惊叹的对话式人工智能并不一定很难，当然也不需要花几个月的时间！迁移学习是方法。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b660e3697bdc17e27fe1d4110fa58ea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E5fkENpHnaOtEbY4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Bewakoof.com 官方在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@bewakoofofficial?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">的照片</a></p></figure><h1 id="1a8b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="6768" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">曾经主要出现在科幻小说中的聊天机器人和虚拟助手正变得越来越普遍。今天的谷歌助手和 Siri 还有很长的路要走，才能达到钢铁侠的 J.A.R.V.I.S .等，但旅程已经开始。虽然目前的对话式人工智能远非完美，但它们也远非像伊莱扎(ELIZA)这样的简单程序那样卑微。</p><p id="f6fe" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">远离典型的基于规则的聊天机器人，拥抱脸想出了一种基于转换器的方法来构建聊天机器人，让我们利用伯特和开放 GPT 等模型的最先进的语言建模能力。使用这种方法，我们可以快速构建强大而令人印象深刻的对话式人工智能，它可以超越大多数基于规则的聊天机器人。它还消除了构建良好的基于规则的聊天机器人所需的繁琐的规则构建和脚本编写。</p><p id="f922" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><a class="ae ky" href="https://github.com/ThilinaRajapakse/simpletransformers" rel="noopener ugc nofollow" target="_blank">简单变形金刚</a>提供了一种快速、高效、简单地构建这些对话式人工智能模型的方法。简单的变形金刚实现建立在拥抱脸实现的基础上，这里给出了<a class="ae ky" href="https://github.com/huggingface/transfer-learning-conv-ai" rel="noopener ugc nofollow" target="_blank">和</a>。</p><h1 id="96a3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">设置</h1><p id="9f2c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">设置环境相当简单。</p><ol class=""><li id="5d9f" class="mt mu it lt b lu mo lx mp ma mv me mw mi mx mm my mz na nb bi translated">从<a class="ae ky" href="https://www.anaconda.com/distribution/" rel="noopener ugc nofollow" target="_blank">这里</a>安装 Anaconda 或 Miniconda 包管理器</li><li id="6f15" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">创建新的虚拟环境并安装软件包。<br/> <code class="fe nh ni nj nk b">conda create -n transformers python</code> <br/> <code class="fe nh ni nj nk b">conda activate transformers</code> <br/>如果使用 Cuda: <br/> <code class="fe nh ni nj nk b">conda install pytorch cudatoolkit=10.1 -c pytorch</code> <br/>其他:<br/> <code class="fe nh ni nj nk b">conda install pytorch cpuonly -c pytorch</code></li><li id="b0db" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">如果您使用 fp16 培训，请安装 Apex。请遵循此处的说明<a class="ae ky" href="https://github.com/NVIDIA/apex" rel="noopener ugc nofollow" target="_blank">。(从 pip 安装 Apex 给一些人带来了问题。)</a></li><li id="f5d7" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">安装简单变压器。<br/> <code class="fe nh ni nj nk b">pip install simpletransformers</code></li></ol><h1 id="5ad3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">资料组</h1><p id="30ba" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们将使用<a class="ae ky" href="http://arxiv.org/abs/1801.07243" rel="noopener ugc nofollow" target="_blank">人物聊天</a>数据集。请注意，您不需要手动下载数据集，因为如果在训练模型时没有指定数据集，简单转换器将自动下载数据集的格式化 JSON 版本(由 Hugging Face 提供)。</p><h1 id="55ca" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">对话式人工智能模型</h1><p id="8199" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">是在简单变形金刚中使用的类，用来做所有与对话式人工智能模型相关的事情。这包括培训、评估和与模型的交互。</p><p id="b9c8" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">目前，你可以通过<code class="fe nh ni nj nk b">ConvAIModel</code>使用任何一款 OpenAI GPT 或 GPT-2 型号。然而，拥抱脸提供的<a class="ae ky" href="https://s3.amazonaws.com/models.huggingface.co/transfer-learning-chatbot/gpt_personachat_cache.tar.gz" rel="noopener ugc nofollow" target="_blank">预训练模型</a>开箱即用性能良好，在创建自己的聊天机器人时可能需要较少的微调。您可以从<a class="ae ky" href="https://s3.amazonaws.com/models.huggingface.co/transfer-learning-chatbot/gpt_personachat_cache.tar.gz" rel="noopener ugc nofollow" target="_blank">这里的</a>下载模型，并解压文档以跟随教程(假设您已经下载了模型并解压到<code class="fe nh ni nj nk b">gpt_personachat_cache</code>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="fd2c" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">上面的代码片段创建了一个<code class="fe nh ni nj nk b">ConvAIModel</code>，并用预先训练好的权重加载转换器。</p><p id="b6dc" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><code class="fe nh ni nj nk b">ConvAIModel</code>配有多种配置选项，可在文档<a class="ae ky" href="https://github.com/ThilinaRajapakse/simpletransformers#additional-attributes-for-conversational-ai" rel="noopener ugc nofollow" target="_blank">中找到，此处为</a>。您还可以在简单的 Transformers 库<a class="ae ky" href="https://github.com/ThilinaRajapakse/simpletransformers#default-settings" rel="noopener ugc nofollow" target="_blank">中找到全局可用的配置选项列表。</a></p><h1 id="33fa" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">培养</h1><p id="bc35" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可以通过简单地调用<code class="fe nh ni nj nk b">train_model()</code>方法来进一步微调角色聊天训练数据的模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6257" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">这将下载数据集(如果尚未下载)并开始训练。</p><p id="ba0e" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">要根据您自己的数据训练模型，您必须创建一个具有以下结构的 JSON 文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="390e" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">该结构遵循下面解释的角色聊天数据集中使用的结构。(文档<a class="ae ky" href="https://github.com/ThilinaRajapakse/simpletransformers#data-format-1" rel="noopener ugc nofollow" target="_blank">此处</a>)</p><p id="1df3" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">Persona-Chat 中的每个条目都是一个<strong class="lt iu">字典</strong>，有两个键<code class="fe nh ni nj nk b">personality</code>和<code class="fe nh ni nj nk b">utterances</code>，数据集是一个条目列表。</p><ul class=""><li id="5d4a" class="mt mu it lt b lu mo lx mp ma mv me mw mi mx mm nn mz na nb bi translated"><code class="fe nh ni nj nk b">personality</code> : <strong class="lt iu">包含代理人个性的字符串列表</strong></li><li id="d171" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm nn mz na nb bi translated"><code class="fe nh ni nj nk b">utterances</code> : <strong class="lt iu">字典列表</strong>，每个字典有两个键，分别是<strong class="lt iu">字符串列表</strong>。</li><li id="40cf" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm nn mz na nb bi translated"><code class="fe nh ni nj nk b">candidates</code>:【下一个 _ 话语 _ 候选人 _1...下一个候选是在会话数据中观察到的基本事实响应</li><li id="e1b4" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm nn mz na nb bi translated"><code class="fe nh ni nj nk b">history</code>:【dialog _ turn _ 0，...dialog_turn N]，其中 N 是奇数，因为其他用户开始每个对话。</li></ul><p id="32b0" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">预处理:</p><ul class=""><li id="68c2" class="mt mu it lt b lu mo lx mp ma mv me mw mi mx mm nn mz na nb bi translated">句末句号前的空格</li><li id="f539" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm nn mz na nb bi translated">全部小写</li></ul><p id="617e" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">假设您已经创建了一个具有给定结构的 JSON 文件，并将其保存在<code class="fe nh ni nj nk b">data/train.json</code>中，您可以通过执行下面的行来训练模型。</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="c232" class="ns la it nk b gy nt nu l nv nw">model.train_model("data/minimal_train.json")</span></pre><h1 id="5a4c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">估价</h1><p id="5814" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">通过调用<code class="fe nh ni nj nk b">eval_model()</code>方法，可以对角色聊天数据集进行评估，就像训练一样简单。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="be78" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">与培训一样，您可以提供不同的评估数据集，只要它遵循正确的结构。</p><h1 id="5443" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">互动</h1><p id="d001" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">虽然你可以通过计算评估数据集的指标来获得数字分数，但了解对话式人工智能有多好的最好方法是与它进行实际对话。</p><p id="f86c" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">要与您刚刚训练的模型对话，只需调用<code class="fe nh ni nj nk b">model.interact()</code>。这将从数据集中选择一个随机的个性，并让你从终端与之对话。</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="7bb7" class="ns la it nk b gy nt nu l nv nw">model.interact()</span></pre><p id="eec1" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">或者，您可以通过给<code class="fe nh ni nj nk b">interact()</code>方法一个字符串列表来创建一个动态的角色！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h1 id="ae5a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">包扎</h1><p id="b21b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">提示:要加载一个经过训练的模型，您需要在创建<code class="fe nh ni nj nk b">ConvAIModel</code>对象时提供包含模型文件的目录的路径。</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="7791" class="ns la it nk b gy nt nu l nv nw">model = ConvAIModel("gpt", "outputs")</span></pre><p id="b8d6" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">就是这样！我希望这篇教程能帮助你创建自己的聊天机器人！</p></div></div>    
</body>
</html>