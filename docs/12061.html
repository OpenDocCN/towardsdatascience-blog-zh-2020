<html>
<head>
<title>4 tricks you should know to parse date columns with Pandas read_csv()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您应该知道的用 Pandas read_csv()解析日期列的 4 个技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/4-tricks-you-should-know-to-parse-date-columns-with-pandas-read-csv-27355bb2ad0e?source=collection_archive---------0-----------------------#2020-08-20">https://towardsdatascience.com/4-tricks-you-should-know-to-parse-date-columns-with-pandas-read-csv-27355bb2ad0e?source=collection_archive---------0-----------------------#2020-08-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c633" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一些最有用的熊猫把戏</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5647415d7194a49ed57d62fa25a7c98d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3OJ85IkmwOiQstV0ZzzrQA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">布莱斯·巴克在<a class="ae ky" href="https://unsplash.com/s/photos/date-and-time?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3c8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导入数据是任何数据科学项目的第一步。通常，您会处理 CSV 文件中的数据，并在一开始就遇到问题。</p><p id="809c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这些问题中，解析日期列是最常见的。在本文中，我们将讨论以下最常见的解析日期列问题:</p><ol class=""><li id="dd20" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">从 CSV 文件中读取日期列</li><li id="da5e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">日首格式(日/月、日/月或日-月)</li><li id="99b1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将多个列组合成一个日期时间</li><li id="2acf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">自定义日期解析器</li></ol><p id="b681" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请查看我的<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/master/data-analysis/012-parse-date-with-read_csv/parse-date-column-with-read_csv.ipynb" rel="noopener ugc nofollow" target="_blank"> Github repo </a>获取源代码。</p><h1 id="d227" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">1.从 CSV 文件中读取日期列</h1><p id="332b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">默认情况下，从 CSV 文件加载数据时，日期列表示为<strong class="lb iu">对象</strong>。</p><p id="d42e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如<strong class="lb iu"> data_1.csv </strong></p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="e55f" class="nl mk it nh b gy nm nn l no np">date,product,price<br/>1/1/2019,A,10<br/>1/2/2020,B,20<br/>1/3/1998,C,30</span></pre><p id="13d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用默认的<code class="fe nr ns nt nh b">read_csv()</code>将<strong class="lb iu"> <em class="nq">日期</em> </strong>列读取为<strong class="lb iu">对象</strong>数据类型:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="d125" class="nl mk it nh b gy nm nn l no np">df = <strong class="nh iu">pd.read_csv('data/data_1.csv')</strong><br/>df.info()</span><span id="a77b" class="nl mk it nh b gy nu nn l no np">RangeIndex: 3 entries, 0 to 2<br/>Data columns (total 3 columns):<br/> #   Column   Non-Null Count  Dtype <br/>---  ------   --------------  ----- <br/> <strong class="nh iu">0   date     3 non-null      object</strong><br/> 1   product  3 non-null      object<br/> 2   price    3 non-null      int64 <br/>dtypes: int64(1), object(2)<br/>memory usage: 200.0+ bytes</span></pre><p id="1afd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了正确读取<strong class="lb iu"> <em class="nq">日期</em> </strong>列，我们可以使用参数<code class="fe nr ns nt nh b">parse_dates</code>来指定日期列的列表。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="08a8" class="nl mk it nh b gy nm nn l no np">df = pd.read_csv('data/data_3.csv', <strong class="nh iu">parse_dates=['date']</strong>)<br/>df.info()</span><span id="81f9" class="nl mk it nh b gy nu nn l no np">RangeIndex: 3 entries, 0 to 2<br/>Data columns (total 3 columns):<br/> #   Column   Non-Null Count  Dtype         <br/>---  ------   --------------  -----         <br/> <strong class="nh iu">0   date     3 non-null      datetime64[ns]</strong><br/> 1   product  3 non-null      object        <br/> 2   price    3 non-null      int64         <br/>dtypes: datetime64[ns](1), int64(1), object(1)<br/>memory usage: 200.0+ bytes</span></pre><p id="28f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，数据帧应该看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/b12c0ee24392eb20ed9410273843d23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*lhX02ZEPvPeuXBmfIT5Cdw.png"/></div></figure><h1 id="2ab2" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">2.日首格式(日/月、日/月或日-月)</h1><p id="647c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">默认情况下，<code class="fe nr ns nt nh b">parse_dates</code>参数会先读取月(<strong class="lb iu"> MM/DD </strong>、<strong class="lb iu"> MM DD、</strong>或<strong class="lb iu"> MM-DD </strong>)格式的日期数据，这种安排在美国是比较独特的。</p><p id="543e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在世界上大多数其他地方，首先写的是日期(<strong class="lb iu"> DD/MM </strong>、<strong class="lb iu"> DD MM </strong>或<strong class="lb iu"> DD-MM </strong>)。如果你想让熊猫先考虑日子而不是月份，你可以将参数<code class="fe nr ns nt nh b">dayfirst</code>设置为<code class="fe nr ns nt nh b">True</code>。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="b77f" class="nl mk it nh b gy nm nn l no np">pd.read_csv('data/data_1.csv', <br/>            parse_dates=['date'], <br/>            <strong class="nh iu">dayfirst=True</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/5fdc21587db18e004a671bb0bef31dde.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*YaDP8Zsg6Ir4KKArfOV2IA.png"/></div></figure><p id="01c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以定制一个日期解析器来处理第一天的格式。请查看"<strong class="lb iu"> 4 中的解决方案。定制日期解析器</strong>”。</p><h1 id="c3f5" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">3.将多个列组合成一个日期时间</h1><p id="cb21" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">有时日期被拆分成多列，例如，<strong class="lb iu"> <em class="nq">年</em> </strong>，<strong class="lb iu"> <em class="nq">月</em> </strong>，以及<strong class="lb iu"> <em class="nq">日</em> </strong></p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="e481" class="nl mk it nh b gy nm nn l no np">year,month,day,product,price<br/>2019,1,1,A,10<br/>2019,1,2,B,20<br/>2019,1,3,C,30<br/>2019,1,4,D,40</span></pre><p id="d772" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了将它们组合成一个日期时间，我们可以将一个嵌套列表传递给<code class="fe nr ns nt nh b">parse_dates</code>。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="ef54" class="nl mk it nh b gy nm nn l no np">df = pd.read_csv('data/data_4.csv',<br/>                 <strong class="nh iu">parse_dates=[['year', 'month', 'day']]</strong>)<br/>df.info()</span><span id="e2a4" class="nl mk it nh b gy nu nn l no np">RangeIndex: 4 entries, 0 to 3<br/>Data columns (total 3 columns):<br/> #   Column          Non-Null Count  Dtype         <br/>---  ------          --------------  -----         <br/><strong class="nh iu"> 0   year_month_day  4 non-null      datetime64[ns]</strong><br/> 1   product         4 non-null      object        <br/> 2   price           4 non-null      int64         <br/>dtypes: datetime64[ns](1), int64(1), object(1)<br/>memory usage: 224.0+ bytes</span></pre><p id="465c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，列名<strong class="lb iu"><em class="nq">year _ month _ day</em></strong>是自动生成的。为了指定一个定制的列名，我们可以传递一个字典来代替。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="e84c" class="nl mk it nh b gy nm nn l no np">df = pd.read_csv('data/data_4.csv',<br/>                 parse_dates=<strong class="nh iu">{ 'date': ['year', 'month', 'day'] }</strong>)<br/>df.info()</span><span id="dbfa" class="nl mk it nh b gy nu nn l no np">RangeIndex: 4 entries, 0 to 3<br/>Data columns (total 3 columns):<br/> #   Column   Non-Null Count  Dtype         <br/>---  ------   --------------  -----         <br/><strong class="nh iu"> 0   date     4 non-null      datetime64[ns]</strong><br/> 1   product  4 non-null      object        <br/> 2   price    4 non-null      int64         <br/>dtypes: datetime64[ns](1), int64(1), object(1)<br/>memory usage: 224.0+ bytes</span></pre><h1 id="e50b" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">4.自定义日期解析器</h1><p id="44a4" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">默认情况下，使用来自<code class="fe nr ns nt nh b">dateutil.parser.parse</code>的 Pandas 内置解析器解析日期列。有时，您可能需要编写自己的解析器来支持不同的日期格式，例如，<strong class="lb iu"> YYYY-DD-MM HH:MM:SS </strong>:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="59da" class="nl mk it nh b gy nm nn l no np">date,product,price<br/>2016-6-10 20:30:0,A,10<br/>2016-7-1 19:45:30,B,20<br/>2013-10-12 4:5:1,C,20</span></pre><p id="61d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最简单的方法是编写一个 lambda 函数，它可以读取这种格式的数据，并将 lambda 函数传递给参数<code class="fe nr ns nt nh b">date_parser</code>。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="a976" class="nl mk it nh b gy nm nn l no np">from datetime import datetime</span><span id="123a" class="nl mk it nh b gy nu nn l no np">custom_date_parser = lambda x: datetime.strptime(x, "<strong class="nh iu">%Y-%d-%m %H:%M:%S</strong>")</span><span id="a7ac" class="nl mk it nh b gy nu nn l no np">df = pd.read_csv('data/data_6.csv',<br/>                 parse_dates=['date'],<br/>                <strong class="nh iu">date_parser=custom_date_parser</strong>)<br/>df.info()</span><span id="1669" class="nl mk it nh b gy nu nn l no np">RangeIndex: 3 entries, 0 to 2<br/>Data columns (total 3 columns):<br/> #   Column   Non-Null Count  Dtype         <br/>---  ------   --------------  -----         <br/> <strong class="nh iu">0   date     3 non-null      datetime64[ns]</strong><br/> 1   product  3 non-null      object        <br/> 2   price    3 non-null      int64         <br/>dtypes: datetime64[ns](1), int64(1), object(1)<br/>memory usage: 200.0+ bytes</span></pre><p id="640a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，熊猫数据框中的日期栏已被正确读取。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/f0926bb66233a2bb32741d144f96ddd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bh8wIQI842ED3aoUafvrdg.png"/></div></div></figure><h1 id="233e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">好了</h1><p id="2d5a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">感谢阅读。</p><p id="6b0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">源代码请查看我的 Github 上的<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank">笔记本。</a></p><p id="436b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你对机器学习的实用方面感兴趣，请继续关注。</p><p id="7afe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一些相关文章</p><ul class=""><li id="8215" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nx mb mc md bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/6-pandas-tricks-you-should-know-to-speed-up-your-data-analysis-d3dec7c29e5">你应该知道的 6 个熊猫技巧，以加速你的数据分析</a></li><li id="10e4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nx mb mc md bi translated">数据科学项目开始时应该包括的 7 个设置。</li></ul></div></div>    
</body>
</html>