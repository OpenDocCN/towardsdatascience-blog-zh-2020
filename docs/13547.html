<html>
<head>
<title>Pandas has superpowers in reading Excel files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫有阅读 Excel 文件的超能力</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandas-has-superpowers-in-reading-excel-files-44344bfdaac?source=collection_archive---------14-----------------------#2020-09-17">https://towardsdatascience.com/pandas-has-superpowers-in-reading-excel-files-44344bfdaac?source=collection_archive---------14-----------------------#2020-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fe8d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Pandas 有不同的阅读器将数据读入数据框。其中一个是 Excel 阅读器。你知道即使你有一些<em class="ki">复杂的</em>财务管理报告，阅读器的功能有多强大吗？</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/9a12e57015cc59a295346d52e92ce7b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5zEmnw9sxwNEIiLF"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@goumbik?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卢卡斯·布拉塞克</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="90be" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi lw translated">大多数公司都有财务部门，他们制作带有关键数字和表格的 Excel 文件，并配有复杂的辅助计算和图表。似乎他们喜欢复杂的文件，里面有一堆表格和一个封面，上面显示了后面表格中数字的汇总。这些文件相对来说比较容易被人类理解。但如果你想作为一名数据分析师进入数字领域，你会面临一些障碍，因为乍一看没有逻辑结构。将工作表作为数据框读取会导致表格混乱。这些表通常在一页上有许多带有不同标题和布局的表格。你知道熊猫有一些打开和处理这种 Excel 文件的超能力吗？</p><p id="655e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Pandas Excel-Reader 功能强大，您不必使用复杂的 Python 脚本来整理整个数据框架。让我们用两个(半设计的)案例来看看一些特性。</p><p id="535a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae kz" href="https://github.com/casarock/pandas_excel_reader" rel="noopener ugc nofollow" target="_blank">在我的 GitHub 库</a>中，我添加了示例文件和一个<a class="ae kz" href="https://github.com/casarock/pandas_excel_reader/blob/master/excel_wrangling.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>以及一些注释。</p><h2 id="da1c" class="mf mg it bd mh mi mj dn mk ml mm dp mn lj mo mp mq ln mr ms mt lr mu mv mw mx bi translated">熊猫 Excel-读者准备</h2><p id="51fc" class="pw-post-body-paragraph la lb it lc b ld my ju lf lg mz jx li lj na ll lm ln nb lp lq lr nc lt lu lv im bi translated">在我们开始使用 pandas <code class="fe nd ne nf ng b">read_excel</code>功能之前，我们必须安装 python 包<code class="fe nd ne nf ng b">xlrd</code>。只需使用您最喜欢的软件包管理器并安装它。</p><pre class="kk kl km kn gt nh ng ni nj aw nk bi"><span id="ee72" class="mf mg it ng b gy nl nm l nn no">conda install xlrd</span><span id="7ba2" class="mf mg it ng b gy np nm l nn no"># or</span><span id="74e7" class="mf mg it ng b gy np nm l nn no">pip install xlrd</span></pre><p id="0ec7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">熊猫准备打开和阅读 Excel 文件。我已经<a class="ae kz" href="https://github.com/casarock/pandas_excel_reader" rel="noopener ugc nofollow" target="_blank">准备了两个文件</a>来解释一些很棒的特性。</p><h2 id="8746" class="mf mg it bd mh mi mj dn mk ml mm dp mn lj mo mp mq ln mr ms mt lr mu mv mw mx bi translated">一个简单的例子</h2><p id="c9fe" class="pw-post-body-paragraph la lb it lc b ld my ju lf lg mz jx li lj na ll lm ln nb lp lq lr nc lt lu lv im bi translated">让我们从第一个文件开始，一个有一张纸的简单文件。该表包含两个表格，一些解释，一个图表和辅助计算。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="ab gu cl nq"><img src="../Images/42461941e1158115ffe405cffb95bb8b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*NiDSaGHknCG4WjSpec0uuQ.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">财务报表使用的表格示例</p></figure><p id="331b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你用<code class="fe nd ne nf ng b">pd.read_excel('Filename.xlsx')</code>读文件，你会得到一些杂乱无章的数据框。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="ab gu cl nq"><img src="../Images/b09163f35abe112303fe7c4071aee2b5.png" data-original-src="https://miro.medium.com/v2/format:webp/1*i4dAO7r0NwG6Jebipl6FLA.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">试图读取文件时创建的数据帧</p></figure><p id="3d04" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">工作起来很费时间。但是不要害怕，熊猫会帮助你的！仔细看看这个表，我们会发现我们必须限制要读取的表的边界。熊猫 Excel 阅读器有一些很好的功能来传递列，哪一行是标题，应该读多少行。</p><p id="97fa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们在这个简单的例子中深入研究这些参数。</p><p id="7919" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">第一个表位于 A 到 m 列之间，标题在第 2 行，我们需要读取 7 行。注意:不要计算标题行，这是隐含的。现在看看需要的参数。</p><p id="2338" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了定义标题，我们使用<code class="fe nd ne nf ng b">header</code>。Header 要求工作表的行从 0 开始！Excel 从一开始计数！在我们的工作表中，我们需要第 2 行，这意味着我们将 1 作为标题参数传递。</p><p id="439c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们对 A-M 列感兴趣。Pandas Excel reader 支持选择列的 Excel 语法。在这种情况下，我们有<code class="fe nd ne nf ng b">"A:M"</code>，我们将它作为一个字符串传递给<code class="fe nd ne nf ng b">usecols</code>参数。我们需要的最后一个参数是熊猫应该读取的行数。相应的参数称为<code class="fe nd ne nf ng b">nrows,</code>，我们传递 7，因为我们需要从第二行开始的七行！</p><p id="3ad5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们读一读有熊猫的表格:</p><pre class="kk kl km kn gt nh ng ni nj aw nk bi"><span id="4c06" class="mf mg it ng b gy nl nm l nn no">df = pd.read_excel("demosheet1.xlsx", header=1, usecols="A:M", nrows=7)</span></pre><p id="bfa8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们的数据框现在包含了我们想要的表的清晰表示</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="ab gu cl nq"><img src="../Images/4088597e43a9fd2f513810095ba05292.png" data-original-src="https://miro.medium.com/v2/format:webp/1*J0Kf6Dm7Z2V3v8q1Ir81ww.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">去杂乱的数据帧，随时可用！</p></figure><p id="4b1b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">很好，不是吗？现在让我们读这张纸的第二张表。</p><pre class="kk kl km kn gt nh ng ni nj aw nk bi"><span id="8157" class="mf mg it ng b gy nl nm l nn no">df_employees = pd.read_excel("200910_Produktivitätsreport August 2020.xlsx", header=12, usecols="A:G", nrows=10)</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="ab gu cl nq"><img src="../Images/2cb49ed18b2bef0b0451f68be8bb12d5.png" data-original-src="https://miro.medium.com/v2/format:webp/1*U0J3MwKXQtPGxUirzbtgmA.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">工作表中第二个表格的数据框</p></figure><p id="2306" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">标题位于第 13 行(记住，pandas 从 0 开始，所以我们传递 12)，我们读取列 A-G，并且我们正在读取接下来的 10 行。第二桌就这样。</p><p id="0284" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这是一个只有一张纸的简单文件。正如开头所说，大多数文件都更复杂。它们可能包含几页纸和一个封面。让我们来看看熊猫 Excel reader 如何处理这种工作表。</p><h2 id="e2e8" class="mf mg it bd mh mi mj dn mk ml mm dp mn lj mo mp mq ln mr ms mt lr mu mv mw mx bi translated">分而治之—更复杂的工作表</h2><p id="a2e5" class="pw-post-body-paragraph la lb it lc b ld my ju lf lg mz jx li lj na ll lm ln nb lp lq lr nc lt lu lv im bi translated">想象一下<a class="ae kz" href="https://github.com/casarock/pandas_excel_reader/blob/master/complex_file.xlsx" rel="noopener ugc nofollow" target="_blank">下面的例子</a>。我们有一份带有封面的管理报告。在文件中，我们还有另外三张包含更多信息/数字的表格。它们都有相似的结构，除了有有趣数字的表格外，它们还包含描述和进一步的(对我们来说没用的)计算。我们对封面不感兴趣，因为我们希望使用以下表格中的数据。</p><p id="3cb7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果 Pandas 读取这种类型的文件，它将只解释文件中找到的第一个工作表。在我们的例子中:封面。</p><p id="8f31" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在让我们弄清楚如何用熊猫 Excel 阅读器阅读其他工作表。</p><p id="6e78" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">阅读器支持一个名为<code class="fe nd ne nf ng b">sheet_name</code>的参数，用于传递我们想要读取的工作表的编号或名称。让我们假设一个名为<code class="fe nd ne nf ng b">Sheet 1</code>的工作表位于封面后的第二个位置，我们想要读取这个工作表。我们有两种选择来阅读表单:</p><ol class=""><li id="19e8" class="nr ns it lc b ld le lg lh lj nt ln nu lr nv lv nw nx ny nz bi translated">通过位置从 0 开始计数，其中 0 是第一个，1 是第二个，依此类推。</li><li id="b8bb" class="nr ns it lc b ld oa lg ob lj oc ln od lr oe lv nw nx ny nz bi translated">将工作表的名称作为字符串传递。在这种情况下<code class="fe nd ne nf ng b">"Sheet 1"</code></li></ol><pre class="kk kl km kn gt nh ng ni nj aw nk bi"><span id="55bc" class="mf mg it ng b gy nl nm l nn no"># Pass the position<br/>df = pd.read_excel("complex_one.xlsx", sheet_name=1)<br/><br/># Pass the name as a string<br/>df = pd.read_excel("complex_one.xlsx", sheet_name='Sheet 1')</span></pre><p id="c0f3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">因为我们只对从第十行开始的数据感兴趣，所以我们只需传递上面示例中描述的参数来访问数据。</p><pre class="kk kl km kn gt nh ng ni nj aw nk bi"><span id="4c56" class="mf mg it ng b gy nl nm l nn no">df = pd.read_excel("complex_one.xlsx", <br/>	sheet_name='Sheet 1', <br/>	header=9, <br/>	usecols="A,B,D:H", <br/>	nrows=19, )</span></pre><p id="5e17" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您可以看到，我一直在使用一个更复杂的字符串来选择列。我使用 A，B 列和 D 到 h 列，我跳过了 C，因为它没什么意思。我的标题在第十行(记住熊猫是从 0 开始计数的)，我总共要读取 19 行。19，因为该工作表的作者决定有 19 个可能的数据行。即使使用较少。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="ab gu cl nq"><img src="../Images/2fbbdad6fa6080074d0c1ff717dc26ca.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Skg_W1rK10XSoe4hi3AKPA.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">包含大量 nan 的数据帧</p></figure><p id="83f6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要去掉带有<em class="of"> NaN </em>的行，只需使用</p><pre class="kk kl km kn gt nh ng ni nj aw nk bi"><span id="0297" class="mf mg it ng b gy nl nm l nn no">df_sheet1 = df_complex.dropna()</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="ab gu cl nq"><img src="../Images/52c1325a426029bdf63138dea9b40eba.png" data-original-src="https://miro.medium.com/v2/format:webp/1*5CqwJu5BfNd4ITjdXEQVpA.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">没有那些 nan 的数据帧。</p></figure><p id="d865" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">那很容易。但是在我们的 Excel 文件中还有两张工作表。该阅读器支持读取多张纸。<code class="fe nd ne nf ng b">sheet_name</code>也可以处理工作表名称或编号的列表。你可以把名字和数字混在一起。</p><p id="72ce" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果使用工作表列表，pandas 会返回一个包含数据框的字典。由于我们示例中的所有工作表都具有相同的结构，我们可以使用</p><pre class="kk kl km kn gt nh ng ni nj aw nk bi"><span id="2586" class="mf mg it ng b gy nl nm l nn no">df = pd.read_excel("complex_one.xlsx", <br/>	sheet_name=['Sheet 1', 2, 3], <br/>	header=9, <br/>	usecols="A,B,D:H", <br/>	nrows=19)</span></pre><p id="4427" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们得到了三个结构相同的数据帧。现在，您可以进一步处理原始数据:</p><pre class="kk kl km kn gt nh ng ni nj aw nk bi"><span id="51f3" class="mf mg it ng b gy nl nm l nn no">df_sheet1 = df_complex['Sheet 1'].dropna()<br/>df_sheet2 = df_complex[2].dropna()<br/>df_sheet3 = df_complex[3].dropna()</span></pre><p id="9dcd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Pandas Excel reader 中最后一个有用的参数是设置列的数据类型。名为<code class="fe nd ne nf ng b">#</code>的专栏被熊猫解释为<em class="of"> float </em>。但是它应该是一个<em class="of">对象</em>，因为它包含一个雇员号。Excel reader 有一个名为<code class="fe nd ne nf ng b">dtype</code>的参数，它需要一个带有。</p><p id="07a1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe nd ne nf ng b">Name_of_col: dtype</code></p><p id="b1f6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">例如:</p><pre class="kk kl km kn gt nh ng ni nj aw nk bi"><span id="662b" class="mf mg it ng b gy nl nm l nn no">types = {<br/>	'#': object<br/>}<br/><br/>df = pd.read_excel("complex_one.xlsx", <br/>	sheet_name=['Sheet 1', 2, 3], <br/>	header=9, <br/>	usecols="A,B,D:H", <br/>	nrows=19,<br/>	dtypes=types)</span></pre><p id="2511" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在<code class="fe nd ne nf ng b">#</code>被解释为一个对象。不错！</p><h2 id="5e7a" class="mf mg it bd mh mi mj dn mk ml mm dp mn lj mo mp mq ln mr ms mt lr mu mv mw mx bi translated">下一步是什么，为什么？</h2><p id="159a" class="pw-post-body-paragraph la lb it lc b ld my ju lf lg mz jx li lj na ll lm ln nb lp lq lr nc lt lu lv im bi translated">熊猫 Excel 阅读器有更多的功能。阅读文档以获得更多灵感，在 pandas 中使用 Excel 表格可以做什么。</p><p id="5c98" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在你可以从复杂的表格中读取原始数据，这些表格是为人类阅读而创建的。我们可以在阅读数据框的时候整理它们。下一步是用这些数据做出令人惊叹的东西。基于 Excel 创建由管理报告触发的仪表板、可视化和模型。或将数据添加到数据库等。由于 Excel 仍然是公司中几乎所有与数字打交道的人的首选工具，所以知道如何阅读和使用它们进行数据分析是很方便的。我希望你能学到一些新的东西，我很高兴看到笔记和评论。</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="6e65" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">[1]半设计，因为这些文件是基于我正在处理的真实世界场景。</p></div></div>    
</body>
</html>