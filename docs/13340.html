<html>
<head>
<title>20 Points to Master Pandas Time Series Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">20 分掌握熊猫时间序列分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/20-points-to-master-pandas-time-series-analysis-f90155ee0e8a?source=collection_archive---------30-----------------------#2020-09-13">https://towardsdatascience.com/20-points-to-master-pandas-time-series-analysis-f90155ee0e8a?source=collection_archive---------30-----------------------#2020-09-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c367" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何处理时间序列数据？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a90b35a03b42aedabb8244806c66b076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oy6-Ti0E-YfqVXlIn2IreQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·温克勒在<a class="ae ky" href="https://unsplash.com/s/photos/stock-price?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6ebd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列数据有许多定义，所有这些定义都以不同的方式表示相同的含义。一个直截了当的定义是，时间序列数据包括附加到连续时间戳的数据点。</p><p id="4481" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列数据的来源是周期性的测量或观察。我们观察很多行业的时间序列数据。仅举几个例子:</p><ul class=""><li id="ae37" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">一段时间内的股票价格</li><li id="ae7f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">每日、每周、每月销售额</li><li id="db62" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">过程中的定期测量</li><li id="02da" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">一段时间内的电力或天然气消耗率</li></ul><p id="1fad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将列出 20 点，帮助你全面理解如何处理熊猫的时间序列数据。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><ol class=""><li id="e198" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu mq mb mc md bi translated"><strong class="lb iu">不同形式的时间序列数据</strong></li></ol><p id="856c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列数据可以是特定日期、持续时间或固定定义间隔的形式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/362719af758b6b2e7bff9740ab3246a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*totDOhLRQ5KEyBok.png"/></div></div></figure><p id="152a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间戳可以是一天中的日期，也可以是给定日期中的纳秒，具体取决于精度。例如，“2020–01–01 14:59:30”是一个基于秒的时间戳。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="d5d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2。时间序列数据结构</strong></p><p id="2f1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas 提供灵活高效的数据结构来处理各种时间序列数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/a3c24a58a542482994d66c4c2c0f2af0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FcZ6-oCp_G79BfJ1.png"/></div></div></figure><p id="f7b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了这 3 种结构，Pandas 还支持日期偏移概念，这是一种考虑日历算法的相对持续时间。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="fd18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 3。创建时间戳</strong></p><p id="53a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最基本的时间序列数据结构是时间戳，可以使用<strong class="lb iu"> to_datetime </strong>或<strong class="lb iu"> Timestamp </strong>函数创建</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c9f5" class="my mz it mu b gy na nb l nc nd">import pandas as pd</span><span id="d4aa" class="my mz it mu b gy ne nb l nc nd">pd.to_datetime('2020-9-13')<br/>Timestamp('2020-09-13 00:00:00')</span><span id="56ff" class="my mz it mu b gy ne nb l nc nd">pd.Timestamp('2020-9-13')<br/>Timestamp('2020-09-13 00:00:00')</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="ed99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 4。访问时间戳保存的信息</strong></p><p id="2de2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以获得存储在时间戳中的关于日、月、年的信息。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="9cab" class="my mz it mu b gy na nb l nc nd">a = pd.Timestamp('2020-9-13')</span><span id="52be" class="my mz it mu b gy ne nb l nc nd">a.day_name()<br/>'Sunday'</span><span id="16aa" class="my mz it mu b gy ne nb l nc nd">a.month_name()<br/>'September'</span><span id="e03f" class="my mz it mu b gy ne nb l nc nd">a.day<br/>13</span><span id="7327" class="my mz it mu b gy ne nb l nc nd">a.month<br/>9</span><span id="4694" class="my mz it mu b gy ne nb l nc nd">a.year<br/>2020</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="2bb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 5。访问不太明显的信息</strong></p><p id="9f94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间戳对象还保存关于日期算法的信息。例如，我们可以问这一年是否是闰年。以下是我们可以获得的一些更具体的信息:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a932" class="my mz it mu b gy na nb l nc nd">b = pd.Timestamp('2020-9-30')</span><span id="a5ab" class="my mz it mu b gy ne nb l nc nd">b.is_month_end<br/>True</span><span id="9f44" class="my mz it mu b gy ne nb l nc nd">b.is_leap_year<br/>True</span><span id="ad9f" class="my mz it mu b gy ne nb l nc nd">b.is_quarter_start<br/>False</span><span id="92ce" class="my mz it mu b gy ne nb l nc nd">b.weekofyear<br/>40</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="5efa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 6。欧式日期</strong></p><p id="cd7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用 to_datetime 函数来处理欧式日期(即首先是一天)。dayfirst 参数设置为 True。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="472e" class="my mz it mu b gy na nb l nc nd">pd.to_datetime('10-9-2020', dayfirst=True)<br/>Timestamp('2020-09-10 00:00:00')</span><span id="4f96" class="my mz it mu b gy ne nb l nc nd">pd.to_datetime('10-9-2020')<br/>Timestamp('2020-10-09 00:00:00')</span></pre><p id="3b3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:如果第一项大于 12，熊猫知道它不能是一个月。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="232f" class="my mz it mu b gy na nb l nc nd">pd.to_datetime('13-9-2020')<br/>Timestamp('2020-09-13 00:00:00')</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="845a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">7。将数据框架转换为时间序列数据</p><p id="c61b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">to_datetime 函数可以将具有适当列的 dataframe 转换为时间序列。考虑以下数据帧:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/d7b82c5ccdbd1c1eb6ddbcf3ca890d55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*bBDaIhEzaJd_NRZFOUQ7MA.png"/></div></figure><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="08d1" class="my mz it mu b gy na nb l nc nd">pd.to_datetime(df)</span><span id="d9b8" class="my mz it mu b gy ne nb l nc nd">0   2020-04-13 <br/>1   2020-05-16 <br/>2   2019-04-11 <br/>dtype: datetime64[ns]</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="a7f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">8。超出时间戳</p><p id="388b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在现实生活中，我们几乎总是处理连续的时间序列数据，而不是单个日期。Pandas 也使得处理时序数据变得非常简单。</p><p id="7b61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以将日期列表传递给 to_datetime 函数。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="3fe2" class="my mz it mu b gy na nb l nc nd">pd.to_datetime(['2020-09-13', '2020-08-12', <br/>'2020-08-04', '2020-09-05'])</span><span id="7685" class="my mz it mu b gy ne nb l nc nd">DatetimeIndex(['2020-09-13', '2020-08-12', '2020-08-04', '2020-09-05'], dtype='datetime64[ns]', freq=None)</span></pre><p id="7d13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">返回的对象是 DatetimeIndex。</p><p id="2ab1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建日期序列有更实用的方法。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="a791" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 9。使用 to_datetime 和 to_timedelta 创建时间序列</strong></p><p id="b48e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以通过向时间戳添加 TimedeltaIndex 来创建 DatetimeIndex。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d731" class="my mz it mu b gy na nb l nc nd">pd.to_datetime('10-9-2020') + pd.to_timedelta(np.arange(5), 'D')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/dc68637a5b61deaa77a28b65b3ebbbac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*r6TTRRoXwy_wjC868LgiWw.png"/></div></figure><p id="5738" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“d”用于“day ”,但还有许多其他选项可用。点击可以查看<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_timedelta.html" rel="noopener ugc nofollow" target="_blank">的全部名单。</a></p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="43b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 10。日期 _ 范围功能</strong></p><p id="c971" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它提供了一种更灵活的方法来创建 DatetimeIndex。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d9b1" class="my mz it mu b gy na nb l nc nd">pd.date_range(start='2020-01-10', periods=10, freq='M')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/94d370e612a94b66ee34ef85b86df8df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*GJsSTWJ4bixpsv4q8UNM1g.png"/></div></figure><p id="1ac4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">periods 参数指定索引中的项数。freq 是频率，M 表示一个月的最后一天。</p><p id="f4e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就 freq 参数的参数而言，date_range 非常灵活。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5dd0" class="my mz it mu b gy na nb l nc nd">pd.date_range(start='2020-01-10', periods=10, freq='6D')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/8716738d05308c1a80d28e31dd5e72a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*8NnpJVHc-byg4nq6FBDE7g.png"/></div></figure><p id="1eb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经创建了一个频率为 6 天的索引。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="6606" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">11。周期 _ 范围函数</p><p id="8c01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它返回一个 PeriodIndex。语法类似于 date_range 函数。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d198" class="my mz it mu b gy na nb l nc nd">pd.period_range('2018', periods=10, freq='M')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/ed677f9642924865ba8861d2efa63194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*NxY3CBULqTpHEBdpU88fqA.png"/></div></figure><p id="a3c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 12。timedelta_range 函数</strong></p><p id="051a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它返回一个 TimedeltaIndex。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="61bc" class="my mz it mu b gy na nb l nc nd">pd.timedelta_range(start='0', periods=24, freq='H')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/b06c0b711e9247518213954b9fb15582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*S_iJElhPbktOK_rOYR-7FQ.png"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="df8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 13。时区</strong></p><p id="66c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，熊猫的时间序列对象没有指定的时区。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a3b7" class="my mz it mu b gy na nb l nc nd">dates = pd.date_range('2019-01-01','2019-01-10')</span><span id="c355" class="my mz it mu b gy ne nb l nc nd">dates.tz is None<br/>True</span></pre><p id="00ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<strong class="lb iu"> tz_localize </strong>方法给这些对象分配一个时区。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a338" class="my mz it mu b gy na nb l nc nd">dates_lcz = dates.tz_localize('Europe/Berlin')</span><span id="5657" class="my mz it mu b gy ne nb l nc nd">dates_lcz.tz<br/>&lt;DstTzInfo 'Europe/Berlin' LMT+0:53:00 STD&gt;</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="e739" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 14。创建一个带有指定时区的时间序列</strong></p><p id="6289" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用<strong class="lb iu"> tz </strong>关键字参数创建一个带有时区的时间序列对象。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c179" class="my mz it mu b gy na nb l nc nd">pd.date_range('2020-01-01', periods = 5, freq = 'D', tz='US/Eastern')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/da2591b91efe1b737bbbd496f164ac7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*swQk8aPR9To_MpfzwtC8zw.png"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="6694" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 15。偏移</strong></p><p id="13ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们有一个时间序列索引，并希望偏移特定时间的所有日期。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0668" class="my mz it mu b gy na nb l nc nd">A = pd.date_range('2020-01-01', periods=10, freq='D')<br/>A</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/ee03260c13fbd513e967c2e810218e73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*9kCSjto5RDgnEAzJARZ3YA.png"/></div></figure><p id="2bda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们给这个系列增加一个星期的偏移。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="7847" class="my mz it mu b gy na nb l nc nd">A + pd.offsets.Week()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/c5986af1b981441cf50e8572b4feb325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*mbPN5-tEOPAqcWwJwe4dMg.png"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="ba76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">16。移动时间序列数据</p><p id="a35a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列数据分析可能需要移动数据点来进行比较。<strong class="lb iu">移位</strong>功能及时移位数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/d5e8054c7cdfbcc98e60100fe48d3ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*4GoFYOxwSyRekvhjnpsH_w.png"/></div></figure><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="2f5b" class="my mz it mu b gy na nb l nc nd">A.shift(10, freq='M')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/e20c43d6a622937532b68073f2a06d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*83jyxpNrN64nvJwWPpf1HQ.png"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="f780" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">17。Shift vs tshift </p><ul class=""><li id="31ac" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">移位:移位数据</li><li id="36bf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">tshift:移动时间索引</li></ul><p id="41fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个带有时间序列索引的数据帧，并绘制它以查看 shift 和 tshift 之间的差异。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="b515" class="my mz it mu b gy na nb l nc nd">dates = pd.date_range('2020-03-01', periods=30, freq='D')<br/>values = np.random.randint(10, size=30)<br/>df = pd.DataFrame({'values':values}, index=dates)</span><span id="be73" class="my mz it mu b gy ne nb l nc nd">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/27df8087f0a89597ddc60f9a617d248e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*Wk_w2GLaibnzvhCRH9h-dg.png"/></div></figure><p id="0f98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们把原始的时间序列和移动的时间序列一起画出来。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="ad85" class="my mz it mu b gy na nb l nc nd">import matplotlib.pyplot as plt</span><span id="ec84" class="my mz it mu b gy ne nb l nc nd">fig, axs = plt.subplots(nrows=3, figsize=(10,6), sharey=True)<br/>plt.tight_layout(pad=4)<br/>df.plot(ax=axs[0], legend=None)<br/>df.shift(10).plot(ax=axs[1], legend=None)<br/>df.tshift(10).plot(ax=axs[2], legend=None)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/291d1e4d62eaee765a3665848b6f9fe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*xdJCu4zZpG5ViKbRtfKUdg.png"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="acec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">18。使用重采样功能进行重采样</p><p id="626d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列数据的另一个常见操作是重采样。根据任务的不同，我们可能需要以更高或更低的频率对数据进行重新采样。</p><p id="79c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重采样创建指定内部的组(或箱),并允许您对组进行聚合。</p><p id="cb81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个包含 30 个值和一个时间序列索引的熊猫序列。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="089c" class="my mz it mu b gy na nb l nc nd">A = pd.date_range('2020-01-01', periods=30, freq='D')<br/>values = np.random.randint(10, size=30)<br/>S = pd.Series(values, index=A)</span></pre><p id="f3be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面将返回 3 天期间的平均值。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="66ec" class="my mz it mu b gy na nb l nc nd">S.resample('3D').mean()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/8eafc5216070d3a38722e1571c72dd59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*Wi0-DpFb4W0BZkoaxNUa4Q.png"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="342b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">19。Asfreq 功能</p><p id="e680" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在某些情况下，我们可能对特定频率下的值感兴趣。Asfreq 函数返回指定间隔结束时的值。例如，我们可能只需要上一步中创建的序列中每 3 天的值(不是 3 天的平均值)。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="862d" class="my mz it mu b gy na nb l nc nd">S.asfreq('3D')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/f80049c1d3d22e74400b12b0727691f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*Vr7BEAGvnRbacwETjDN4Cw.png"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="4369" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">20。滚动</p><p id="0a6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">滚动是对时间序列数据非常有用的操作。滚动意味着创建一个指定大小的滚动窗口，并对该窗口中的数据执行计算，当然，该窗口会滚动数据。下图解释了滚动的概念。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7889604301cfa52f5b3f4f06f450d0eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/0*icBoqkN25ngenBrG.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="f624" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得注意的是，计算是在整个窗口都在数据中时开始的。换句话说，如果窗口的大小为三，则第一次聚合在第三行完成。</p><p id="b82e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们对我们的系列应用 3 天滚动窗口。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="86ef" class="my mz it mu b gy na nb l nc nd">S.rolling(3).mean()[:10]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/7283ee622aacc05b3802e28bcbfcbcc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*rKRVkFw9AcdTu3AqiVqJZQ.png"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="2c11" class="nv mz it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated"><strong class="ak">结论</strong></h1><p id="546c" class="pw-post-body-paragraph kz la it lb b lc om ju le lf on jx lh li oo lk ll lm op lo lp lq oq ls lt lu im bi translated">我们已经全面介绍了熊猫的时间序列分析。值得注意的是，Pandas 提供了更多的时间序列分析。</p><p id="503a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">官方<a class="ae ky" href="https://pandas.pydata.org/docs/user_guide/timeseries.html" rel="noopener ugc nofollow" target="_blank">文档</a>涵盖了时间序列的所有函数和方法。乍一看，这似乎是详尽无遗的，但你会通过练习变得舒适。</p><p id="9fae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>