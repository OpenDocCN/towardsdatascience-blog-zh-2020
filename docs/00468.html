<html>
<head>
<title>Automate Your Repetitive Reports!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动化您的重复性报告！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automate-your-repetitive-reports-5ee60a53bda2?source=collection_archive---------14-----------------------#2020-01-14">https://towardsdatascience.com/automate-your-repetitive-reports-5ee60a53bda2?source=collection_archive---------14-----------------------#2020-01-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c54a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">自动化R脚本</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8241628357eed18e8ed0be4755e44c91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*iHJ_3A-tEnfvX5LsUR4Z5A.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://thumbs.gfycat.com/ImpressiveInstructiveIberianemeraldlizard-small.gif" rel="noopener ugc nofollow" target="_blank">https://thumbs . gfy cat . com/impressive instructiveiberian emerald lizard-small . gif</a></p></figure><h1 id="1a11" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是R脚本自动化，为什么？</h1><p id="560e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在大多数用例中，R用于分析数据、运行统计测试和构建模型。在这样做的过程中，数据科学家通过编写代码不断地与R进行交互，并从这些交互中产生结果。最终，这些结果被存储、共享或以报告的形式呈现。但是，如果您必须每天或以其他类型的定期间隔复制报告，该怎么办呢？嗯，你总是可以调出R脚本，重新运行脚本。但是，如果它是自动完成的，而不需要您在中间启动R和运行脚本，不是更好吗？</p><p id="3023" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，我们将知道如何做到这一点！</p><h1 id="2d0f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">我们在这里要做的事情的大纲</h1><p id="6921" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">概括地说，本文有两个部分:</p><p id="aa92" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，在本文中，我们将创建一个使用实时数据的报告，即定期更新的数据源。</p><p id="2735" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">其次，一旦创建了报告，我们将自动执行每天重新创建报告的过程，以捕获更新的数据。</p><h1 id="2bb4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">第1部分:创建报告:</h1><p id="43fd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">因为这篇文章的目标是自动复制一个已经构建好的报告，所以我已经创建了一个报告并发布在这里:【http://rpubs.com/arafath/CRAN_Report<a class="ae ky" href="http://rpubs.com/arafath/CRAN_Report" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="02bc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请随意访问该报告，并在您的工作站中重新创建它。你可以给RMarkdown脚本起个和我一样的名字(<em class="ms"> 'CRAN_Download_Report。Rmd' </em>)并将其保存在您想要保存<em class="ms">的相同位置。存储bat </em>文件和其他输出。</p><p id="4276" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该报告中所做的如下所示:</p><ul class=""><li id="c0de" class="mt mu it lt b lu mn lx mo ma mv me mw mi mx mm my mz na nb bi translated">从综合存档网络(CRAN)调用API下载包的每日和每周下载计数，</li><li id="f102" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">加载R中的数据，</li><li id="ae3d" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">计算一些基本的统计数据，</li><li id="462f" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">可视化数据</li><li id="2fd7" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">生成包含基本统计数据和视觉效果的报告(html格式)。</li></ul><p id="b114" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">使用的数据:</strong></p><p id="60cf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">CRAN有一个API调用，我们可以使用它来获得特定时间内任何包被下载的总次数。我们将使用名为<em class="ms"> cranlogs </em>的包来调用api。</p><h1 id="986f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">第02部分:自动化报告复制</h1><p id="b6b7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一旦我们有了一个可以产生我们想要的结果的R脚本，复制工作流程看起来如下:</p><ul class=""><li id="a090" class="mt mu it lt b lu mn lx mo ma mv me mw mi mx mm my mz na nb bi translated">打开R控制台或一些IDE</li><li id="2388" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">加载所需的R脚本</li><li id="3229" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">运行脚本以产生结果</li></ul><p id="8e8b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这一步中，我们将知道如何告诉R自动完成上述所有步骤<strong class="lt iu"/>。这样，R也将完成第01部分中提到的所有步骤。</p><p id="9108" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">自动化是如何工作的:</strong></p><p id="3839" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了自动重新运行R脚本，我们将使用Windows任务调度程序(WTS)。使用任务计划程序，用户可以要求windows执行批处理文件(。蝙蝠)。批处理文件包含一系列可以由命令行解释程序执行的命令。</p><p id="e008" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将创建一个批处理文件，每天自动运行一个R脚本。在R脚本中，它被指示调用。创建报告的Rmd文件。</p><h2 id="f922" class="nh la it bd lb ni nj dn lf nk nl dp lj ma nm nn ll me no np ln mi nq nr lp ns bi translated">创建R脚本来运行。Rmd文件</h2><p id="6009" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可以在R脚本中复制并粘贴以下代码，并将其另存为<em class="ms"> run。R </em>(我的r脚本文件名):</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="e861" class="nh la it nu b gy ny nz l oa ob"># Loading libraries [install the libraries before if not already installed]<br/>library(knitr)<br/>library(rmarkdown)<br/>library(mailR)</span><span id="2d86" class="nh la it nu b gy oc nz l oa ob"># Knits rmd file (.Rmd is saved in the working directory)<br/>knit('CRAN_Download_Report.Rmd')</span><span id="4a0e" class="nh la it nu b gy oc nz l oa ob"># Creates the html output<br/>render("CRAN_Download_Report.md")</span><span id="058b" class="nh la it nu b gy oc nz l oa ob"># sending email notification<br/>send.mail(from = "youremail@gmail.com",<br/>      to = c("testemail@gmail.com"),<br/>      cc = 'youremail@gmail.com',<br/>      replyTo = c("Reply to someone else &lt;youremail@gmail.com&gt;"),<br/>      subject = "Report update status",<br/>      body = "Daily report on CRAN package download is updated!",<br/>      smtp = list(host.name = "smtp.gmail.com", port = 587, user.name = "youremail", passwd =    "password", tls = TRUE),<br/>      authenticate = TRUE,<br/>      send = TRUE)</span></pre><p id="43cf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这个R脚本所做的基本上是编织rmd文件并生成一个html报告，将它保存在工作目录中并发送一个电子邮件通知。</p><h2 id="976f" class="nh la it bd lb ni nj dn lf nk nl dp lj ma nm nn ll me no np ln mi nq nr lp ns bi translated">从窗口的命令外壳运行R</h2><p id="97d7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在创建批处理文件之前，我们可以从命令终端手动运行我们的R脚本，并检查它是否按预期运行。</p><p id="888a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">设置目录</strong></p><p id="67f9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">打开windows命令外壳。在窗口中搜索“cmd”或“命令提示符”并打开它。它将打开黑色的命令外壳。</p><p id="ece3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，使用“cd”命令将命令目录更改到您想要的位置，后跟您想要的文件位置(ref: image01)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/d5cf3a02b7a5e3243f6ee151a4a3c231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1FF8xGRrc_QNVS35M9nrQQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片01</p></figure><p id="b306" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">从命令行运行R</strong></p><p id="4db9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将使用的命令结构如下:<r.exe location=""> CMD BATCH <.r file="" location=""/></r.exe></p><p id="7e4b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里，</p><ul class=""><li id="e821" class="mt mu it lt b lu mn lx mo ma mv me mw mi mx mm my mz na nb bi translated"><em class="ms">R.exe位置</em>是你的R可执行文件所在的文件位置。执行这个文件应该会打开R控制台。</li><li id="2294" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated"><em class="ms">。r文件位置</em>是保存r脚本的文件位置，该脚本将调用。Rmd文件。</li><li id="5a91" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated"><em class="ms">文件保存位置</em>是您想要保存执行输出的位置。</li></ul><p id="06fd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了简单起见，我使用与R工作目录和位置相同的文件位置来保存任何输出。</p><p id="3211" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在我的案例中，这些是确切的位置:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="af0d" class="nh la it nu b gy ny nz l oa ob">R.exe location = "C:\Program Files\R\R-3.6.1\bin\x64\R.exe" <br/>.R file location = "C:\Users\ahossa1\Personal\Learning\Automating R Script\run.R" <br/>file saving location = "C:\Users\ahossa1\Personal\Learning\Automating R Script\test.Rout"</span></pre><p id="5b98" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是我电脑中的最后一行代码(ref: image02):</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="7bbd" class="nh la it nu b gy ny nz l oa ob">"C:\Program Files\R\R-3.6.1\bin\x64\R.exe" CMD BATCH "C:\Users\ahossa1\Personal\Learning\Projects\Automating R Script\run.R" "C:\Users\ahossa1\Personal\Learning\Projects\Automating R Script\CRAN.Rout"</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/801fd48f11ea8cc3a91ebae29c241202.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tvn5oyh57xVIDYddK5TGag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片02</p></figure><p id="eb87" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一旦您输入命令(image02)并执行它，它应该运行R脚本，该脚本将编织rmarkdown文档并保存报告。您应该还会收到一封带有通知的电子邮件！</p><h2 id="5819" class="nh la it bd lb ni nj dn lf nk nl dp lj ma nm nn ll me no np ln mi nq nr lp ns bi translated">使用命令行指令创建批处理文件</h2><p id="9134" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们可以将命令行指令(image02)保存为. bat文件并保存。然后，在我们需要重新创建报告的任何时候，我们都可以执行。bat文件，它会自动调用命令行界面并执行R脚本。</p><p id="bccc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为此，请打开一个文本文件(。txt)。将Windows shell命令粘贴到。txt文件，用扩展名<em class="ms">保存。球棒</em>。</p><p id="244e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在我的电脑里，我把它命名为“run.bat”。</p><blockquote class="of og oh"><p id="2955" class="lr ls ms lt b lu mn ju lw lx mo jx lz oi mp mc md oj mq mg mh ok mr mk ml mm im bi translated"><strong class="lt iu"> <em class="it">在不需要定期重新创建报表的情况下，可以使用这个。bat档。你所要做的就是双击(或单击)。bat文件和报告将使用更新的数据生成。</em> </strong></p></blockquote><h2 id="6ce8" class="nh la it bd lb ni nj dn lf nk nl dp lj ma nm nn ll me no np ln mi nq nr lp ns bi translated">使用Windows任务计划程序自动执行命令行活动</h2><p id="7e0b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在我们将要求我们的计算机自动调用。bat文件定期。</p><ol class=""><li id="0d44" class="mt mu it lt b lu mn lx mo ma mv me mw mi mx mm ol mz na nb bi translated">在Windows搜索栏中搜索“任务计划程序”并打开应用程序。下面是它在我的电脑上的样子</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/3be3ec360cde148a6de8621ccb4ddbd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7spcratq13OF7aT6T9W5Kw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片03</p></figure><p id="e282" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">2.选择<em class="ms">创建基本任务</em>(图03红色标记)</p><p id="499b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">3.为任务命名</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/778e1b52567fc8d751e8b386667e1e37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*8lXtFn-7p9OXsAHfnP4OOQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片04</p></figure><p id="ba15" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">4.下一步，选择一个触发器。我选择了<em class="ms">日报</em>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/312466b1565dc4340b81e51e11f47420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*o-irFI81pQQyycGh1ACyIQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片05</p></figure><p id="0f2e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">5.转到下一步并选择开始时间。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/d1088222c519c3cb1727143f75f889d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*8ddInWmm3J7Wzphfwsw56Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片06</p></figure><p id="519f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">6.转到下一步，选择<em class="ms">启动程序</em>作为操作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/5f2390f4e318b428573bb23bd8149b2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*y10rgRF2i0p2PGf5bvF8mA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片07</p></figure><p id="d746" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">7.下一步，加载程序/脚本(。bat文件)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/30e0f74dfbd9633ba063575008e9fa57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*lPahQ6veADPWs9pQ55CG0g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片08</p></figure><p id="d40f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">瞧！！我们完成了！</p><p id="9ca5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在每天下午3:30。下面的CRAN包下载报告将被创建，并将发送电子邮件通知！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/5907d72391bba53eba5eb5ffc537f2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aPlqrqHyhr_9W2yvzYsoMA.png"/></div></div></figure></div></div>    
</body>
</html>