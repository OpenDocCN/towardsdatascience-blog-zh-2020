# 在 AWS 上为企业数据交付构建无服务器数据集成中心(2020 年)

> 原文：<https://towardsdatascience.com/architecting-serverless-data-integration-hubs-on-aws-for-enterprise-data-delivery-2020-a27b42569518?source=collection_archive---------17----------------------->

![](img/8463b9e1f7ec7a188e7114c3c052959a.png)

## 更新后的 2022 版本现已发布于—[https://medium . com/@ gvaidyanatha/architecting-server less-data-integration-hubs-on-AWS-for-enterprise-data-delivery-2022-6 EBA 5 EDF 93 a 0](https://medium.com/@gvaidyanatha/architecting-serverless-data-integration-hubs-on-aws-for-enterprise-data-delivery-2022-6eba5edf93a0)！

# **简介**

新年快乐如果*数据是新的石油*，为什么我们的系统会经历如此多的反作用？在之前名为 ***无服务器数据集成*** 的两部分文章系列中，详细讨论了数据集成的重要性，尤其是在无服务器领域。我们得出的结论是，数据集成是一项关键的业务需求，每个 IT 组织都必须积极主动地集中解决这一问题。再次重申，数据集成真正专注于为企业提供价值，通过实现真正的分析、机器学习和人工智能计划，并提供干净和标准化的数据。如果没有高质量的数据，通过各种分析、机器学习和人工智能计划产生的商业见解充其量也是值得怀疑的。如果你错过了，这里有以前文章系列的链接:

1) [无服务器数据集成—第一部分(2019)](https://medium.com/@gvaidyanatha/serverless-data-integration-part-i-2019-b3b3b3bc332a)
2) [无服务器数据集成—第二部分(2019)](https://medium.com/@gvaidyanatha/serverless-data-integration-part-ii-2019-fb55d180feb)

在这篇文章中，我想澄清一些与我们讨论的主题相关的附加要点。我还想分享一个在 Amazon Web Services (AWS)上实现的数据集成中心(以下称为**中心**)的示例参考架构。

# 净化空气

**数据集成中心不是数据湖** 数据湖以接近原生格式存储数据。对于某些定制分析计划来说，这可能已经足够了，但是一个能够清理、标准化数据并使数据符合所有主流法规要求的集中式数据服务能够为企业带来更高的价值。集线器的价值主张很简单——一写多读(**蠕虫**)，确保数据质量、标准化和合规性。保持与时俱进，不要让数据过时！

为了实现这一点，Hub 采用了 **ELTn** (提取负载转换( **n** ))的概念，而不是经典的 **ETL** (提取转换负载)。 **ELTn** 意味着在加载数据之前，转换并不是一个单一事件。这是一个持续的过程，在支持特定业务功能的数据的生命周期中会发生多次。目标是最终达到高水平的数据卫生，这样所有数据都是干净的。Hub 支持不断维护最新“业务对象”的范例，与业务经历的转变相匹配。

一旦来自给定摄取过程的数据被标记为干净的，所有下游应用程序都可以使用来自中心的数据。这最大限度地减少了后端记录系统的数据提取负载，更不用说重复和浪费的数据清理工作了。此外，数据质量和合规性合规性可以在一个集中的位置一次性完成。这使得高质量和相关的企业数据交付成为可能。让我们把数据干净合规一次。这就是集线器的作用。

该中心解决了多年来糟糕的数据管理导致的猖獗的数据孤岛问题。与数据湖相比，集线器是一个活生生的、不断发展的企业集中式授权数据分发器。如前所述，数据湖将不同的数据源集合在一起，并以几乎完全相同的原始格式存储。通过为企业内的所有数据计划提供所需的质量、标准化和合规性，Hub 可以做得更多。

我们能在试着跑之前先走一走吗？
问当今任何一位 C 级高管，他最关心的是什么，答案几乎总是“*需要用人工智能(AI)做点什么*”。在一些回答中，你可以用“*机器学习(ML)* 来代替人工智能，但这已经足够接近了，因为 ML 是人工智能的先决条件。每个人都想做人工智能，但在我们开始这个旅程之前，我们需要建立一个坚如磐石的数据管道，来创建/提供/维护一个枢纽。问问任何一位数据科学家，仅仅为了他们的特定项目，他在清理和争论数据上花了多少时间。这个问题的答案将显示出一个集中的枢纽的明显价值。此外，该中心使数据科学团队能够获得更多产出，因为他们可以专注于自己的技能——数据科学，而不是数据清理或数据争论。记住 WORM 好，WORO 不好:)

因此，数据工程是所有数据驱动业务的基本要求。数据是业务积极变化的基本驱动力之一。许多 IT 组织已经改变了他们的思维模式，将数据工程作为一项核心能力来支持，由于这一新业务需求的重要性，这一点正在迅速显现。

Monica Rogati 于 2017 年 6 月发表的关于 Hackernoon ( [*AI 需求层次*](https://hackernoon.com/the-ai-hierarchy-of-needs-18f111fcc007) )的优秀文章，仍然与我们讨论的话题非常相关。从那篇文章中引用的下图是对核心思想的阐述，即在生活中，我们需要在触及深奥的方面之前首先完成基础。我对罗加蒂女士的图形做了两处定制，一是使用了 **ELTn** 而不是 **ETL** ，二是在金字塔中概述了中枢的功能。我们感谢亚伯拉罕·马斯洛先生在许多个月前用金字塔展示和说明他的工作。图一图胜千言。谢谢你，罗加蒂女士！

![](img/4b140ed7d0e7d898c29adb2f5e1696c0.png)

***图 1:我们能不能在试着跑之前先走一走？***

**数据从业者眼中的结构！正如情人眼里出西施一样，数据的内在结构也是如此——在数据从业者的眼中也是如此。人们希望在关系表中存储什么与 NoSQL 数据存储或 BLOB 存储之间的界限是一个需要参与的相关讨论。然而，将数据划分为结构化、半结构化和非结构化的价值有待讨论。请允许我在 ***图 2 & 3*** 中解释这一点，我们来看看一个样本网络日志和一条推文，它们通常都被归类为非结构化数据。**

![](img/ab8fa1ab48748e92e1c710fe77291e04.png)

***图 2:一个样本 Web 日志的数据结构***

图 2 展示了 NASA 公开的网络日志的内容。人们很快就会想知道为什么 web 日志被归类为非结构化的，因为上面的内容可以很容易地存储在关系表中。现在，由于各种其他原因(例如数据量和检索的轮流性能)，我们可能不想将它存储在关系表中，但这是一个完全不同的讨论。这仍然不能改变上面的 web 日志样本是结构良好的数据这一事实。

现在让我们来看看一条样本推文的结构:

![](img/50c7f15b9e0893b7d3801cebbaeb0a4f.png)

***图 3:一条推文的数据结构***

图 3 展示了 tweet 的结构。是的，它是 JSON 格式的，数据存储在 NoSQL 的数据库中，但是为什么这一定会使它成为非结构化的呢？在数据从业者看来，这是一个漂亮的灵活的结构化业务对象。

对于数据从业者来说，所有的数据都有结构。结构甚至存在于音频和视频文件中。现在，视频文件可能不具备将其存储在“表格”中的“所需结构”。但是话又说回来，我们似乎无意中(依我拙见是不正确的)将结构的存在等同于表格的存在。出于上述原因和本文的目的，数据应该分为关系型和非关系型。如果将它存储在表中有意义，那么它就是关系型的。如果没有，它就是非关系的。根据数据的特征，有许多非关系数据存储是适用的。让我们用能把工作做好的那个。

**安静时间的相关性&工作负载成本** 在之前文章系列的第二部分中，我介绍了安静时间的概念，作为我们在决定给定工作负载是否符合无服务器条件时使用的一个相关标准。值得注意的是，并非所有工作负载都真正适合无服务器计算。由于处理的性质，集线器是无服务器计算实现的典型代表。就某一天需要处理的数据量而言，集线器通常是不可预测的。此外，摄取和其他相关任务的时间安排需要动态扩展，以实现最佳性能。通常情况下，一个集线器在 24 小时内也有空闲时间。所有这些都使它成为无服务器的理想选择。

下面是一个简单的公式来计算一个工作负载的安静时间( ***qt*** )，这有助于确定无服务器计算的可行性:

***qt = round (((x/86400) * 100)，2)*** %
其中，**x***= '****工作负载空闲时间*** *'，在 24 小时内以秒为单位测量*

在上面的公式中，安静时间( ***qt*** )是以工作负载的空闲时间( ***x*** )占一天所用时间的百分比来计算的— 24 小时= 86400 秒。 ***qt*** 对于确定给定上下文中无服务器计算的相关性很重要。例如，如果给定的工作负载在任何给定的一天平均空闲 25300 秒，这意味着 ***x=25300*** ，允许我们推导:
***Qt = round((25300/86400)* 100)，2) = 28.28%*** 。

在上面的例子中，我们得出结论，应用程序在任何给定的一天中有 **28.28%** 的时间是安静的，因此它是无服务器计算的潜在候选对象。一旦我们完成成本计算工作，我们就会确切知道。重点是，如果您的应用程序没有空闲/安静时间，并且 24x7x365 不间断地处理，那么无服务器可能不是正确的选择。

我们现在计算相关的无服务器和基于服务器的服务的成本，以确定哪种服务更好。两个成本计算工作中较低的一个将引导我们选择首选方案:

a. ***scc*** —无服务器计算成本
这是使用无服务器计算服务的成本。无服务器计算成本通常包括函数执行请求的数量、 *AWS Step Functions/Lambda* 中请求的 CPU & RAM、 *API Gateway* 对此类函数执行请求的请求以及支持给定工作负载所需的任何其他服务(包括数据库成本，如 *Amazon DynamoDB 或 Amazon Aurora 无服务器*)。在无服务器计算中，没有与*空闲时间/安静时间*相关的计算成本。

b. ***tcc*** —传统计算成本(基于服务器)
这是使用基于服务器的计算服务的成本。这些计算成本通常包括应用程序和数据库服务器的计算引擎、编程语言软件许可、数据库软件许可、与所述基于服务器的服务的软件维护相关的人员成本(安装、修补、操作系统升级、编程语言软件和其他第三方软件)以及软件维护费用的实际成本(支付给供应商)。在此模型中，所有计算平台都有与*空闲时间/安静时间*相关的计算和其他成本。

如果 ***scc < tcc*** ，很明显，即使从成本角度来看，工作负载也符合无服务器的条件。如果 ***scc > tcc*** 的话，显然无服务器会比基于服务器的模式花费更多。但是，可能还有其他原因促使无服务器模式成为首选。这可能包括(除其他外)组织内缺乏深厚的技术人才来支持相关计算平台中工作负载的软件和数据库堆栈的升级和维护。

**注释:** 1。*有人可能会说，AWS 支持费用也应计入* ***scc*** *中，如果有一种方法可以确定按比例分配的 AWS 支持费用(仅针对无服务器服务计算),则可以做到这一点。这说起来容易做起来难，但是为了简单起见，这应该被认为是两种模型之间的共同成本，因此被排除在外。* 2。*S3、网络、数据传输(入口和出口)等服务的存储成本也可视为****SCC****和****TCC****的共同成本。因此，这些组成部分也可以从成本计算中去除。将这些成本添加到****SCC****中，前提是它们与 it 相关，而不是与****TCC****相关。*

# AWS 上无服务器数据集成中心的体系结构

**4 层** 轮毂中有 4 层/支柱，在 AWS 上显示如下:

![](img/393d68ecf7340f36cdee5d08063a4914.png)

***图 AWS 上的数据集成中心— 4 层/支柱***

数据流经集线器的 4 层。每一层都支持数据集成架构的独立功能。这 4 层/支柱是:

1.摄入
2。持久性
3。变换
4。分析/ML/AI

该架构是利用独立服务专门构建的。这使得能够独立扩展每一层，支持抽象以管理复杂性，解耦服务以避免序列化，自动供应资源(在可行的情况下)并促进异步执行模型。在许多方面，这些都是云计算的基本原则。

**深入到 4 层/支柱** 图 5 说明了每层/支柱中的相关服务和详细信息:

![](img/7eb27ca1555c1fe45eb9e72b29890c25.png)

AWS 上的无服务器数据集成中心—详细架构(所有层)

现在让我们更深入地研究一下每一层/每一个支柱。

**接收**是来自多个来源的数据进入中枢的第一层(层#1)。对于批量提取，数据的着陆区是一个无服务器的*亚马逊 S3* 桶，在这里，数据经过预处理，通过*亚马逊雅典娜*进行某些基本检查。在数据成功到达 S3 的*事件*时，微服务( *AWS 阶跃函数/λ*)处理数据。同等的亚马逊 Kinesis 实时数据流处理服务负责处理以零星突发形式到达中心的数据流。

**持久性**，架构的第二层(第 2 层)，在 Hub 中存储数据起着至关重要的作用。 *Amazon DynamoDB* 在这里发挥了巨大的作用，因为它是数据集成的核心。第 2 层存储、管理和维护业务对象。当数据在第 1 层被接收时，它被传输到第 2 层，并以一种*的近似原始格式*存储在 RAWDB(原始数据的一组表)中。更复杂的数据验证例程在转换层执行。如果某个业务功能的数据消费模型是基于表的数据，而不是基于 JSON 的业务对象，那么第 4 层中业务洞察的持久性是使用 *Amazon Aurora 无服务器*来完成的。

**转换**是第三层(第三层),它处理创建干净的业务对象的复杂性。转换层的复杂性和繁重工作与确保数据符合数据质量规则、业务规则和合规性规则/策略有关。层#2 的 RAWDB 中的数据到达是下一个事件的*，该事件触发主转换微服务及其相关的子微服务。这些基于事件的微服务在 *AWS 步骤功能/Lambda* 中实现。完全符合所有预定义转换规则的数据保存在 CLEANDB(另一个包含一组干净数据相关表的逻辑容器)中，错误/不符合规则的数据存储在 ERRORDB(错误数据的第三个逻辑容器)中。*

**分析/机器学习(ML)/人工智能(AI)** 是产生商业洞察(BI)的第四层。该层由层#2 内 CLEANDB 中的数据到达触发(**下一个事件*)。该层支持业务关键绩效指标(KPI)的计算和存储，以及分析/ML/AI 工作的管理。所有作业(BI)的结果都存储在 INSIGHTSDB 中(视情况而定，*亚马逊 DynamoDB* 和*亚马逊 Aurora 无服务器*中洞察的第四个逻辑容器)。这里使用了多个无服务器服务来生成业务洞察(*亚马逊 S3、亚马逊雅典娜、亚马逊法盖特、亚马逊 SageMaker)* )。请注意*亚马逊 SageMaker* 不是无服务器的，这里列出是为了机器学习项目的完整性。*列出 Amazon Fargate* 是为了促进无服务器容器的概念，这些容器运行分析和机器学习算法来生成 BI 并存储在 INSIGHTSDB 中。*

*当数据通过所有 4 层时，就完成了一个数据集成周期。当新的/修改过的数据从后端系统流入中心时，或者当数据被扩充、校正和重新处理以从 ERRORDB 移动到 CLEANDB 时，该循环被重复。*

***注意:** *从长远来看，历史数据的持久性和管理(RAWDB & CLEANDB)需要通过标准的信息生命周期管理(ILM)措施来解决，这些措施利用了各种基于层的数据持久性服务。AWS 通过亚马逊 S3 冰川和亚马逊 S3 冰川深度归档的多层存储供应模型来支持这一点。这确保了数据持久性成本保持在最佳水平，同时符合所有法规要求。**

***可视化**在企业内部的信息传递中也扮演着重要的角色。这就是 BI 仪表板发挥作用并为业务带来价值的地方。在维护无服务器范式的过程中， *Amazon QuickSight* 是未来的一个选择，届时将支持通过 *API 网关*中的 RESTful 端点直接访问数据*。**

***消费模式** 在生成 BI 时，需要支持应用实时消费 INSIGHTSDB & CLEANDB 中的数据。这种消耗是通过数据访问层(DAL)完成的，如图*图 5* 所示。利用 RESTful 端点( *API 网关*)，支持各种业务对象的 BI 和底层数据的消费。从关系数据存储(如*亚马逊极光无服务器*)中检索数据是通过利用亚马逊极光无服务器的*数据 API 实现的。需要注意的是 *API 网关*是数据消费的唯一入口。该服务几乎消除了所有不必要的外部数据违规和数据泄漏，因为它仅在数据请求附有所需凭据时才提供数据。这些必需的凭证(*安全凭证和数据权利*)是从企业的联合认证系统( *AD、LDAP* 等)接收的。)与 *AWS 身份和访问管理* ( *Amazon IAM* )和 *Amazon Cognito* 协同工作。**

*使用 *API 网关*创建的定义良好的 RESTful 端点，不仅消除了对到 Hub 的持久数据库连接管理的需求，还减轻了数据结构变化的影响。例如，从 RESTful 端点接收和处理 JSON 文档(业务对象)的应用程序可以继续这样做，而不管所有数据结构的变化(添加或删除数据元素)。这确保了在不断变化的业务环境中，应用程序和数据中心的运行时灵活性。*

***注:** *虽然没有明确说明，但应该假设所有标准的网络和隔离安全最佳实践。这符合 AWS 良好架构的框架。**

# *集线器真正提供了什么？*

*Hub 的目标是交付最新的业务对象，提供业务任何方面的 360 度视图。图 6 展示了一个集成的客户业务对象，它构建在一个“中心辐射模型”中。*

*![](img/20b56a610a76c833b4cccf71ea4c7197.png)*

****图 6:样本集成业务对象—客户****

# *结论*

*AWS 提供了一套丰富的服务来设计和构建无服务器数据集成中心。交付给企业的高质量和标准化数据的价值是一项关键功能，需要通过数据工程主动解决。显而易见，好的数据会产生有意义的商业见解。这才是真正的业务附加值。我祝愿您在 2020 年及以后的所有数据集成工作中一切顺利。好好照顾自己，保持联系！*

# *参考*

1.  *我们能在跑之前先走一走吗？—[https://hacker noon . com/the-ai-hierarchy-of-needs-18f 111 FCC 007](https://hackernoon.com/the-ai-hierarchy-of-needs-18f111fcc007)*
2.  *网络日志的数据结构—[http://opensource.indeedeng.io/imhotep/docs/sample-data/](http://opensource.indeedeng.io/imhotep/docs/sample-data/)*
3.  *Tweet 的数据结构—[https://developer . Twitter . com/en/docs/tweets/data-dictionary/overview/intro-to-Tweet-JSON](https://developer.twitter.com/en/docs/tweets/data-dictionary/overview/intro-to-tweet-json)*
4.  *AWS 架构图标—[https://aws.amazon.com/architecture/icons/](https://aws.amazon.com/architecture/icons/)*
5.  *无服务器数据集成—第一部分(2019)，Gaja Vaidyanatha—[https://medium . com/@ gvaidyanatha/server less-Data-Integration-Part-I-2019-B3 B3 B3 BC 332 a](https://medium.com/@gvaidyanatha/serverless-data-integration-part-i-2019-b3b3b3bc332a)*
6.  *无服务器数据集成—第二部分(2019)，Gaja Vaidyanatha—[https://medium . com/@ gvaidyanatha/server less-Data-Integration-Part-II-2019-fb55d 180 feb](https://medium.com/@gvaidyanatha/serverless-data-integration-part-ii-2019-fb55d180feb)*

*最初发布于 LinkedIn—[https://www . LinkedIn . com/pulse/architecting-server less-data-integration-hubs-AWS-2020-vaidyanatha](https://www.linkedin.com/pulse/architecting-serverless-data-integration-hubs-aws-2020-vaidyanatha)*