<html>
<head>
<title>Dynamic UI in Shiny (incl. demo app)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">闪亮的动态用户界面(包括演示应用)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dynamic-ui-in-shiny-incl-demo-app-a6fb791be4c6?source=collection_archive---------31-----------------------#2020-09-10">https://towardsdatascience.com/dynamic-ui-in-shiny-incl-demo-app-a6fb791be4c6?source=collection_archive---------31-----------------------#2020-09-10</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="a62f" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph">高级 R 闪亮吸头系列</h2><div class=""/><div class=""><h2 id="a599" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">为您的公司创建专业的 web 应用程序</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/d64f491f486640e5995b97ef3b695915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yM-04Tj6gSlL9UydJZ_Drw.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">用 R Shiny 构建企业级应用！—此处提供演示<a class="ae li" href="https://cho7tom.shinyapps.io/dynamic-ui/" rel="noopener ugc nofollow" target="_blank"/></p></figure><h2 id="6515" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">序文</h2><p id="a6db" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated"><a class="ae li" href="https://shiny.rstudio.com/" rel="noopener ugc nofollow" target="_blank">闪亮的</a>已经成为一个非常流行的解决方案，直接从<a class="ae li" href="https://www.r-project.org/" rel="noopener ugc nofollow" target="_blank"> R </a>构建交互式网络应用。如此受欢迎，以至于公司中的大多数数据分析团队都将该框架作为其工具包的一部分。</p><p id="99e6" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">然而，R Shiny 经常被认为是快速原型开发的好框架，但是对于工业化的、可扩展的解决方案来说不够健壮。</p><p id="8ee1" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">在本系列中，我将分享一些高级技巧，旨在克服这些异议，并帮助您<strong class="mg je">构建健壮/可持续/可扩展的应用程序，为生产中的业务使用做好准备</strong>！</p><p id="3cfe" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">生产定义如下:</p><blockquote class="nc nd ne"><p id="852c" class="me mf nf mg b mh mx ke mj mk my kh mm ng mz mo mp nh na mr ms ni nb mu mv mw in bi translated">真实用户使用和依赖的软件环境，如果出现问题，会产生真实的后果——首席技术官郑中</p></blockquote><p id="d215" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated"><strong class="mg je">注</strong>:为了从本教程中获得最大收益，感兴趣的读者应该已经熟悉基本的 Shiny 原则(例如反应性)、R 编程(例如函数定义、tidyverse、<strong class="mg je"> <em class="nf"> purrr::map() </em> </strong>)、web 开发(例如 html 标签和 css)以及<a class="ae li" href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects" rel="noopener ugc nofollow" target="_blank"> RStudio 项目</a>。</p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="e36c" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">目标和动机</h2><p id="ae05" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated">在本教程中，我将重点描述一种基于用户输入动态生成 UI 组件的<strong class="mg je">可再现方式</strong>。</p><p id="0eab" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">这个特性在很多情况下都非常有用，因为你的应用程序的用户很可能会在他们的仪表板上显示一个先验未知数量的信息。仅举几个例子:</p><ul class=""><li id="acce" class="nq nr iu mg b mh mx mk my ls ns lw nt ma nu mw nv nw nx ny bi translated"><strong class="mg je">在用户投资组合管理应用程序中添加/删除股票</strong></li><li id="a390" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi translated"><strong class="mg je">在时间序列预测应用中考虑/忽略特定事件</strong></li><li id="5ee7" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi translated"><strong class="mg je">在零售商业绩分析应用程序中包含/排除商店</strong></li><li id="6e63" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi">…</li></ul><p id="8824" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">此外，我还将描述<strong class="mg je">如何定义观察器来触发动态生成的按钮</strong>的动作，这不是一个简单的任务(因为它需要一点 JavaScript)。</p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="5079" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">闪亮的应用伴侣</h2><p id="391f" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated">本教程附带一个 R Shiny 演示应用程序，你可以在这里访问<a class="ae li" href="https://cho7tom.shinyapps.io/dynamic-ui/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="2352" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">在这个特殊的教育示例中，<strong class="mg je"> you </strong>(用户)<strong class="mg je">可以根据需要选择尽可能多的陌生事物角色，并通过我称之为<strong class="mg je"> <em class="nf">的信息卡</em> </strong>显示每个角色的基本信息</strong>。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj oe"><img src="../Images/6e998d9e0183809a6c7bb75f948b70d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVk4UQz_Gy9liVeR97haJw.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">这里用户显示了 3 个陌生事物角色的信息卡</p></figure><p id="82d6" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">每个角色的信息卡<em class="nf"> </em>提供了额外的功能:</p><ul class=""><li id="7c4a" class="nq nr iu mg b mh mx mk my ls ns lw nt ma nu mw nv nw nx ny bi translated"><strong class="mg je">访问</strong> <strong class="mg je">到演员的</strong>详细<strong class="mg je">维基百科页面</strong>(点击“更多”按钮)</li><li id="63bc" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi translated"><strong class="mg je">删除信息卡</strong> <em class="nf"> </em>的可能性(点击“删除”按钮)</li></ul><p id="1e20" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated"><strong class="mg je">我的建议</strong>:为了从本教程中获得最大收益，我建议尝试通过组合整篇文章中提供的各种代码来重建应用程序。主块以逻辑方式编号，这样你就不会在途中迷路。如果有必要的话，我的 bitbucket 账户<a class="ae li" href="https://bitbucket.org/cho7tom/dynamic-ui/src/master/" rel="noopener ugc nofollow" target="_blank">上的全部代码也可以在这里</a>找到。请看看在项目结构中哪里存储图像。</p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="c604" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">0 —分析顺序</h2><p id="dcf0" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated">我指导您完成代码的方法如下:</p><ol class=""><li id="9580" class="nq nr iu mg b mh mx mk my ls ns lw nt ma nu mw of nw nx ny bi translated"><strong class="mg je">设置场景</strong>:描述需要的 R 包、底层数据集、应用主干</li><li id="dc83" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw of nw nx ny bi translated"><strong class="mg je">定义用户输入</strong>:应用程序中用于捕获用户输入的 HTML 小部件的描述</li><li id="bc31" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw of nw nx ny bi translated"><strong class="mg je">定义 infocard 函数</strong>:生成 HTML 代码的函数，结合<strong class="mg je"> <em class="nf"> purrr::map() </em> </strong>函数，将非常有助于“即时”生成 infocard</li><li id="57dd" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw of nw nx ny bi translated"><strong class="mg je">服务器端定义</strong>:创建反应值和观察器，使应用程序“闪亮”</li></ol></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="9ea3" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">1 —设置场景</h2><p id="1a00" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated">要为本教程构建 R Shiny companion 应用程序:</p><p id="eec3" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">我使用了以下 4 个<strong class="mg je">包</strong> : <a class="ae li" href="https://shiny.rstudio.com/" rel="noopener ugc nofollow" target="_blank">闪亮</a>、<a class="ae li" href="https://rstudio.github.io/shinythemes/" rel="noopener ugc nofollow" target="_blank">闪亮主题</a>、<a class="ae li" href="https://dreamrs.github.io/shinyWidgets/index.html" rel="noopener ugc nofollow" target="_blank">闪亮主题</a>和<a class="ae li" href="https://www.tidyverse.org/" rel="noopener ugc nofollow" target="_blank">无光泽</a></p><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="5412" class="lj lk iu oh b gz ol om l on oo"><strong class="oh je"># PART 1 - SETTING THE SCENE</strong></span><span id="7c19" class="lj lk iu oh b gz op om l on oo"><strong class="oh je"># section 1.0 - load required packages</strong></span><span id="fdd1" class="lj lk iu oh b gz op om l on oo">library(shiny)          # web app framework for R<br/>library(shinythemes)    # themes for shiny<br/>library(shinyWidgets)   # custom input widgets for shiny<br/>library(tidyverse)      # collection of R packages for data science</span></pre><p id="a958" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">我建立了一个小型的<strong class="mg je">数据集</strong>，里面有关于主要陌生事物角色的基本信息(来源:<a class="ae li" href="https://fr.wikipedia.org/wiki/Stranger_Things#Acteurs_principaux" rel="noopener ugc nofollow" target="_blank">维基百科</a>):</p><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="9a62" class="lj lk iu oh b gz ol om l on oo"><strong class="oh je"># section 1.1 - build dataset</strong></span><span id="759d" class="lj lk iu oh b gz op om l on oo">crm_tbl &lt;- <strong class="oh je">tibble</strong>(<br/>    character = c("Joyce Byers", "Jim Hopper", <br/>                  "Mike Wheeler", "Jane Hopper",<br/>                  "Dustin Henderson", "Lucas Sinclair",<br/>                  "Nancy Wheeler", "Jonathan Byers",<br/>                  "Karen Wheeler", "Will Byers",<br/>                  "Max Mayfield", "Steve Harrington"),<br/>    actor = c("Winona Ryder", "David Harbour", <br/>              "Finn Wolfhard", "Millie Bobby Brown",<br/>              "Gaten Matarazzo", "Caleb McLaughlin",<br/>              "Natalia Dyer", "Charlie Heaton",<br/>              "Cara Buono", "Noah Schnapp",<br/>              "Sadie Sink", "Joe Keery"),<br/>    image = c("img/winona_ryder.jpg", "img/david_harbour.jpg", <br/>              "img/finn_wolfhard.jpg", "img/millie_bobby_brown.jpg",<br/>              "img/gaten_matarazzo.jpg", "img/caleb_mclaughlin.jpg",<br/>              "img/natalia_dyer.jpg", "img/charlie_heaton.jpg",<br/>              "img/cara_buono.jpg", "img/noah_schnapp.jpg",<br/>              "img/sadie_sink.jpg", "img/joe_keery.jpg"),<br/>    wiki = c("<a class="ae li" href="https://en.wikipedia.org/wiki/Winona_Ryder" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Winona_Ryder</a>",<br/>             "<a class="ae li" href="https://en.wikipedia.org/wiki/David_Harbour" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/David_Harbour</a>",<br/>             "<a class="ae li" href="https://en.wikipedia.org/wiki/Finn_Wolfhard" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Finn_Wolfhard</a>",<br/>             "<a class="ae li" href="https://en.wikipedia.org/wiki/Millie_Bobby_Brown" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Millie_Bobby_Brown</a>",<br/>             "<a class="ae li" href="https://en.wikipedia.org/wiki/Gaten_Matarazzo" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Gaten_Matarazzo</a>",<br/>             "<a class="ae li" href="https://en.wikipedia.org/wiki/Caleb_McLaughlin" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Caleb_McLaughlin</a>",<br/>             "<a class="ae li" href="https://en.wikipedia.org/wiki/Natalia_Dyer" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Natalia_Dyer</a>",<br/>             "<a class="ae li" href="https://en.wikipedia.org/wiki/Charlie_Heaton" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Charlie_Heaton</a>",<br/>             "<a class="ae li" href="https://en.wikipedia.org/wiki/Cara_Buono" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Cara_Buono</a>",<br/>             "<a class="ae li" href="https://en.wikipedia.org/wiki/Noah_Schnapp" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Noah_Schnapp</a>",<br/>             "<a class="ae li" href="https://en.wikipedia.org/wiki/Sadie_Sink" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Sadie_Sink</a>",<br/>             "<a class="ae li" href="https://en.wikipedia.org/wiki/Joe_Keery" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Joe_Keery</a>")<br/>)</span></pre><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj oq"><img src="../Images/c344bd21d863798dc4c68fefd0f3e890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G42wInPzlOnQc6UwLhZQwQ.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">应用中使用的输入存储为<a class="ae li" href="https://tibble.tidyverse.org/" rel="noopener ugc nofollow" target="_blank">tible</a></p></figure><p id="1eed" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">我选择用 2 个活跃的角色初始化应用程序，这意味着当应用程序启动时，将显示 2 个信息卡:</p><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="53a0" class="lj lk iu oh b gz ol om l on oo"><strong class="oh je"># section 1.2 - set initial selection </strong></span><span id="c7bb" class="lj lk iu oh b gz op om l on oo">current_user_selection &lt;- c("Jim Hopper", "Joyce Byers")</span></pre><p id="025c" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">最后，我为应用程序构建了一个基本的<strong class="mg je">主干</strong>，由以下部分组成:</p><ul class=""><li id="7602" class="nq nr iu mg b mh mx mk my ls ns lw nt ma nu mw nv nw nx ny bi translated">一个<a class="ae li" href="https://www.rdocumentation.org/packages/shiny/versions/1.5.0/topics/navbarPage" rel="noopener ugc nofollow" target="_blank">导航条页面</a>(空白<a class="ae li" href="https://getbootstrap.com/docs/3.3/" rel="noopener ugc nofollow" target="_blank">引导 3 </a>带有顶级导航条的页面)</li><li id="32e0" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi translated">一个左侧栏(我用了<a class="ae li" href="https://www.rdocumentation.org/packages/shiny/versions/1.5.0/topics/wellPanel" rel="noopener ugc nofollow" target="_blank"><strong class="mg je"><em class="nf">shiny::well panel()</em></strong></a>函数)</li><li id="7bf8" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi translated">信息卡区域</li></ul><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="b146" class="lj lk iu oh b gz ol om l on oo"><strong class="oh je"># PART 2 - UI PART</strong></span><span id="91fc" class="lj lk iu oh b gz op om l on oo"><strong class="oh je"># app backbone</strong></span><span id="14ec" class="lj lk iu oh b gz op om l on oo">ui &lt;- <strong class="oh je">navbarPage</strong>(<br/>    title = "R Shiny advanced tips series",<br/>    collapsible = TRUE,<br/>    windowTitle = "R Shiny tips",    <br/>    <br/>    <strong class="oh je">tabPanel</strong>(<br/>        title = "Demo",<br/>        <br/>        <strong class="oh je"># section 2.1 - header</strong> <br/>        <br/><strong class="oh je">        # section 2.2 - sidebar panel</strong><br/>        div(<br/>            class = "container",<br/>            column(<br/>                width = 3,<br/>                <strong class="oh je">wellPanel</strong>(<br/>                    <strong class="oh je">p("PLACEHOLDER - USER INPUTS")</strong><br/>                )<br/>            ),<br/>            column(<br/>                width = 9,<br/>                div(<br/>                    # render thumbnails dynamically (ui)<br/>                    <strong class="oh je">p("PLACEHOLDER - INFOCARDS")</strong><br/>                )<br/>            )<br/>        )<br/>    )<br/>)</span><span id="dcc2" class="lj lk iu oh b gz op om l on oo"><strong class="oh je"># PART 3 - SERVER PART</strong><br/>server &lt;- function(input, output, session) {<br/>    <br/>}</span><span id="3985" class="lj lk iu oh b gz op om l on oo"><strong class="oh je"># PART 4 - RUN APPLICATION</strong><br/>shinyApp(ui = ui, server = server)</span></pre><p id="b6f9" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">header (backbone 的 2.1 节)是一个简单的容器，我在其中显示了应用程序的基本信息。我利用现有的引导类使文本引人注目(见<em class="nf">页眉</em>和<em class="nf"> lead </em>类)</p><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="fb4b" class="lj lk iu oh b gz ol om l on oo"># &gt;&gt; insert in section 2.1</span><span id="38c9" class="lj lk iu oh b gz op om l on oo">div(<br/>    class = "<strong class="oh je">container</strong>", <br/>    h1(class = "<strong class="oh je">page-header</strong>", <br/>       "Generate dynamic UI components", <br/>       tags$small("- Thomas Filaire")),<br/>            <br/>     p(class = "<strong class="oh je">lead</strong>", <br/>       "Learn how to generate UI components dynamically based on user inputs"),<br/>            <br/>     p("Note: this application is the companion of my Medium post; read it to understand its underlying principles!")<br/>)</span></pre></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><p id="707c" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated"><strong class="mg je"> 2 —定义用户输入</strong></p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div class="gi gj or"><img src="../Images/967f5bc502ce3e2893eee600ee96bf2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*WciccuEyHDr9lV8URMVv_g.png"/></div><p class="le lf gk gi gj lg lh bd b be z dk translated">添加新信息卡的选择器+按钮</p></figure><p id="ceca" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">为了说明动态 UI 功能，我构建了一个非常简单的<strong class="mg je">选择器</strong>，供用户选择她/他最喜欢的陌生事物角色。选中后，只需点击“添加”<strong class="mg je">按钮</strong>即可显示相应的信息卡。</p><p id="9ca9" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">虽然 shiny 包中的基本的<a class="ae li" href="https://shiny.rstudio.com/gallery/widget-gallery.html" rel="noopener ugc nofollow" target="_blank"><strong class="mg je"><em class="nf">selectin put()</em></strong></a>很棒，而且我大部分时间都在使用它，但我还是选择了<a class="ae li" href="https://www.rdocumentation.org/packages/shinyWidgets/versions/0.5.3/topics/pickerInput" rel="noopener ugc nofollow" target="_blank"><strong class="mg je"><em class="nf">shinyWidget::pickerInput()</em></strong></a>替代，它提供了许多好处，特别是<strong class="mg je"> live search 功能</strong>。测试它，我相信你会采纳它！</p><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="bf77" class="lj lk iu oh b gz ol om l on oo"># &gt;&gt; insert inside wellPanel</span><span id="1c66" class="lj lk iu oh b gz op om l on oo">div(<br/>    shinyWidgets::<strong class="oh je">pickerInput</strong>(<br/>         inputId  = "pi_character_selector", <br/>         label    = "Select character(s)",<br/>         choices  = crm_tbl %&gt;% pull(character),<br/>         multiple = FALSE,<br/>         selected = "Mike Wheeler",<br/>         options = <strong class="oh je">pickerOptions</strong>(<br/>                         actionsBox = FALSE,<br/>                         <strong class="oh je">liveSearch = TRUE</strong>,<br/>                         size       = 10<br/>                         )<br/>     )<br/>),<br/>div(<br/>    <strong class="oh je">actionButton</strong>(<br/>          class = "btn-primary",<br/>          inputId = "ab_show_character", <br/>          label = "Add"<br/>          )<br/>    )<br/>)</span></pre></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="1cf9" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">3-定义信息卡功能</h2><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div class="gi gj os"><img src="../Images/5b381bce79b150ef6527daef8c7e36d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:412/format:webp/1*_DGgNPAQCdyOeAGDhi001w.png"/></div></figure><p id="8b05" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">我构建了一个<strong class="mg je">函数来生成 infocard </strong>(因此是一段 HTML 代码)，稍后我将在一个<strong class="mg je"> <em class="nf"> purrr::map() </em> </strong>函数中从服务器端调用它，以将其应用于一个陌生事物字符列表。</p><p id="1a83" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">作为一名优秀的程序员，你应该拥抱<a class="ae li" href="https://adv-r.hadley.nz/fp.html" rel="noopener ugc nofollow" target="_blank">函数式编程</a>，因为它迫使你创建易于独立分析的函数，并避免不必要的代码重复，提高可读性。</p><p id="cd58" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">该函数将一个角色的名字作为输入，并返回 infocard  (HTML 对象)。需要注意的 3 件重要事情:</p><ol class=""><li id="2c59" class="nq nr iu mg b mh mx mk my ls ns lw nt ma nu mw of nw nx ny bi translated">请注意<strong class="mg je">呈现 HTML 代码是如何像生成数字、列表、图表等一样简单。</strong>，我们平时用函数做的。</li><li id="401e" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw of nw nx ny bi translated">注意 bootstrap 3 的预先存在的类 (img-rounded，caption，btn-default)的<strong class="mg je">用法，加上分配给‘remove button’的 rm_btn 类，我将在本教程的第 4 部分进一步阐述。</strong></li><li id="73fb" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw of nw nx ny bi translated">注意非常有用的<em class="nf"> stringr::str_glue() </em>函数的用法，我用它给每个按钮分配唯一的 id。<strong class="mg je">这是一个关键部分，因为 id 必须是唯一的，并且需要在点击相应按钮时触发动作</strong>。</li></ol><p id="1ee9" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated"><a class="ae li" href="https://www.rdocumentation.org/packages/stringr/versions/1.4.0/topics/str_glue" rel="noopener ugc nofollow" target="_blank"><strong class="mg je"><em class="nf">【str _ glue()</em></strong></a>使得在字符串内插入变量值变得容易。为了使每个按钮的 id 都是唯一的，我采用了以下模式:</p><ul class=""><li id="f3b5" class="nq nr iu mg b mh mx mk my ls ns lw nt ma nu mw nv nw nx ny bi translated">对于“更多”按钮:<strong class="mg je">ab _ more _ character _ name</strong>(ab 代表 actionbutton)。</li><li id="b690" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi translated">对于“移除”按钮:<strong class="mg je">ab _ remove _ character _ name</strong>。</li></ul><p id="9d8c" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">如 ab_more_joyce_byers、ab_remove_joyce_byers 等。</p><p id="d7b1" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">我还使用了<a class="ae li" href="https://stringr.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"> stringr </a>包中的函数来小写/大写所选角色的名字，并添加/删除“_”，从而使 string 成为一个有效的 id。</p><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="e19a" class="lj lk iu oh b gz ol om l on oo"># &gt;&gt; insert infocard definition as section 1.3 in PART 1 - SETTING THE SCENE of your app.R file</span><span id="7dd4" class="lj lk iu oh b gz op om l on oo"><strong class="oh je"># section 1.3 - define custom infocard</strong></span><span id="a7b8" class="lj lk iu oh b gz op om l on oo">my_infocard &lt;- <strong class="oh je">function</strong>(selected_character) {<br/>    <br/>    # selected_character == value from user pickerInput<br/>    # e.g. "Mike Wheeler"<br/>    <br/>    selected_image &lt;- crm_tbl %&gt;% <br/>        filter(character == selected_character) %&gt;% <br/>        pull(image)  # get image url from dataset<br/>    <br/>    selected_actor &lt;- crm_tbl %&gt;% <br/>        filter(character == selected_character) %&gt;% <br/>        pull(actor)  # get actor's name from dataset<br/>    <br/>    selected_wiki &lt;- crm_tbl %&gt;% <br/>        filter(character == selected_character) %&gt;% <br/>        pull(wiki)   # get wikipedia's link from dataset<br/>    <br/>    # piece of UI to render dynamically<br/>    column(<br/>        width = 4,<br/>        div(<br/>            class = "<strong class="oh je">thumbnail text-center</strong>",<br/>            <br/>            # picture<br/>            img(<br/>                class = "<strong class="oh je">img-rounded</strong>",<br/>                style = "height: 300px;",<br/>                src = selected_image<br/>            ),<br/>            <br/>            # main information<br/>            div(<br/>                class = "<strong class="oh je">caption</strong>",<br/>                h4(selected_character),<br/>                p(selected_actor)<br/>            ),<br/>            <br/>            # link to wikipedia's page<br/>            <strong class="oh je">actionButton</strong>(<br/>                class = "<strong class="oh je">btn-default</strong>",<br/>                inputId = <strong class="oh je">str_glue("ab_more_{selected_character %&gt;%<br/>                          tolower() %&gt;% <br/>                          str_replace_all(' ', '_')}")</strong>,<br/>                label = "More",<br/>                onclick = <strong class="oh je">str_glue("window.open('{selected_wiki}', '_blank')")</strong><br/>            ),</span><span id="af6c" class="lj lk iu oh b gz op om l on oo">            # remove button<br/>            <strong class="oh je">actionButton</strong>(<br/>                class = "<strong class="oh je">btn-default</strong> rm_btn",<br/>                inputId = <strong class="oh je">str_glue("ab_remove_{selected_character %&gt;%<br/>                           tolower() %&gt;% <br/>                           str_replace_all(' ', '_')}")</strong>,<br/>                label = "Remove"<br/>            )<br/>        )<br/>    )<br/>}</span></pre></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="9805" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">4 —服务器端定义</h2><p id="0c53" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated">一旦我们定义了应用程序的主干，并构建了生成定制信息卡的函数，让我们跳到服务器端。</p><p id="13ba" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">首先，我使用了一个<strong class="mg je"><em class="nf">event reactive()</em></strong>函数来捕获用户通过 pickerInput 小部件选择的任何新字符。<strong class="mg je"><em class="nf">event reactive()</em></strong>仅当用户点击“添加”按钮(其 id 为 input$ab_show_character)确认其选择时，才允许更新电抗组件。</p><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="b482" class="lj lk iu oh b gz ol om l on oo"># &gt;&gt; insert in server part </span><span id="045d" class="lj lk iu oh b gz op om l on oo"># get user's selected character when 'Add' button is clicked<br/>current_character &lt;- eventReactive(<br/>        eventExpr = input$ab_show_character, {<br/>            input$pi_character_selector<br/>        })</span></pre><p id="4b35" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">每当用户选择一个新字符时，必须捕获信息并将其添加到先前选择的字符列表中。我使用了一个<strong class="mg je"><em class="nf">reactive values()</em></strong>来存储选择的字符，用第 1 部分定义的 current_user_selection 初始化。</p><p id="0f45" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">每当单击“添加”按钮时，observeEvent 都会更新 reactive_values。我在管道中插入了一个<strong class="mg je"> <em class="nf"> unique() </em> </strong>，以确保<em class="nf">信息卡</em>被多次创建，因此只显示一次。</p><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="5b5c" class="lj lk iu oh b gz ol om l on oo"># &gt;&gt; insert in server part</span><span id="d26c" class="lj lk iu oh b gz op om l on oo"># store user's selection<br/>reactive_values &lt;- reactiveValues()<br/>reactive_values$character_list &lt;- current_user_selection</span><span id="01de" class="lj lk iu oh b gz op om l on oo"># add character when relevant<br/>observeEvent(input$ab_show_character, {<br/>    reactive_values$character_list &lt;- <br/>        c(reactive_values$character_list, <br/>          current_character()) %&gt;% <br/>        <strong class="oh je">unique</strong>()<br/>})</span></pre><p id="191a" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">基于 reactive_values$character_list(用户选择的字符列表)，我在 renderUI 块中根据需要生成尽可能多的<em class="nf">信息卡</em>，然后通过相应的 uiOutput 在 UI 中“渲染”:</p><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="52d5" class="lj lk iu oh b gz ol om l on oo"># &gt;&gt; insert in the main area of ui section</span><span id="79f5" class="lj lk iu oh b gz op om l on oo"><strong class="oh je">uiOutput</strong>(outputId = "infocards")</span></pre><p id="29fb" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">为了构建 UI 部分，我在<strong class="mg je"> <em class="nf">函数中传递了字符列表，以便根据需要多次调用自定义的<strong class="mg je"> <em class="nf"> my_infocard() </em> </strong>函数。当<strong class="mg je"> <em class="nf"> purrr::map() </em> </strong>返回一个列表时，我用<strong class="mg je"> <em class="nf"> tagList() </em> </strong>函数将结果管道化，以将输出绑定在一起，并生成一个唯一的(可能很大的)HTML 部分。</em></strong></p><p id="a153" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">请看下面截图中关于<strong class="mg je"> <em class="nf"> tagList() </em> </strong>如何工作的直观解释:</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ot"><img src="../Images/56fd5aa8ecc2eac8fdc4af04d681a891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*agiRPM3-6kIlMv_3pSOf1g.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">tagList()将几段 HTML 代码组合成一个块，然后可以通过经典的“renderUI x uiOutput”组合来呈现</p></figure><p id="6e94" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">在开发的这个阶段，应用程序应该几乎按照预期工作。</p><blockquote class="nc nd ne"><p id="8581" class="me mf nf mg b mh mx ke mj mk my kh mm ng mz mo mp nh na mr ms ni nb mu mv mw in bi translated"><strong class="mg je">最后的触碰</strong></p></blockquote><p id="2083" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">最后添加的功能是通过点击“删除”按钮来删除信息卡。</p><p id="c2de" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">我在这里使用了一点 JavaScript。我不会详细讨论 JavaScript(我远不是这一领域的专家)，但请注意:</p><ul class=""><li id="9957" class="nq nr iu mg b mh mx mk my ls ns lw nt ma nu mw nv nw nx ny bi translated">JavaScript 通过<strong class="mg je">标签</strong> (head 和 Script)插入到 R Shiny 应用程序的 HTML 代码中</li><li id="f10c" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi translated">每当点击带有 rm_btn 类的按钮<strong class="mg je">时，代码只是存储按钮 id (rm_btn_id)</strong></li></ul><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="990a" class="lj lk iu oh b gz ol om l on oo"># &gt;&gt; insert in the tabPanel, below title</span><span id="bb4d" class="lj lk iu oh b gz op om l on oo"># JS function to identify button id when clicked<br/>tags$<strong class="oh je">head</strong>(<br/>    tags$<strong class="oh je">script</strong>(<br/>        HTML("$(document).on('click', '<strong class="oh je">.rm_btn</strong>', function () {<br/>                        Shiny.onInputChange('<strong class="oh je">rm_btn_id</strong>', this.id);<br/>                    });"<br/>        )<br/>    )<br/>),</span></pre><p id="0ba7" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">因为“移除”按钮有 rm_btn 类(见 1.3 节中的定义)，所以每当它们被点击时，Shiny 将访问它们各自的 id。最后，我利用这一点，通过一个<strong class="mg je"><em class="nf">observe event()</em></strong>，从字符列表中删除相应的字符。</p><pre class="kt ku kv kw gu og oh oi oj aw ok bi"><span id="6aff" class="lj lk iu oh b gz ol om l on oo"># &gt;&gt; insert in server part</span><span id="0868" class="lj lk iu oh b gz op om l on oo"># remove infocard<br/><strong class="oh je">observeEvent</strong>(input$<strong class="oh je">rm_btn_id</strong>, {<br/>    reactive_values$character_list &lt;- <br/>       reactive_values$character_list %&gt;% <br/>       .[reactive_values$character_list %&gt;% <br/>            toupper() <strong class="oh je">!=</strong> input$rm_btn_id %&gt;% <br/>            str_remove("ab_remove_") %&gt;% <br/>            toupper() %&gt;% <br/>            str_replace("_", " ")]<br/>})</span></pre><p id="2d2d" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">我们完事了。如果你能坚持到现在，恭喜你！。</p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="d2a0" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">关键要点</h2><ul class=""><li id="0522" class="nq nr iu mg b mh mi mk ml ls ou lw ov ma ow mw nv nw nx ny bi translated">shinythemes 是一个非常棒的软件包，可以非常容易地让你的应用程序看起来很专业</li><li id="2407" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi translated">顺序是:用户输入列表+ map("生成 HTML 代码的函数")+ tagList()非常强大，并且在我看来是可读的。</li><li id="4bdb" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi translated">创建函数来生成 HTML 片段，以避免代码重复，并轻松使用上述序列</li></ul></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="8124" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">结论</h2><p id="197b" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated">我希望这篇文章对您有用，并能帮助您构建更好的应用程序。<strong class="mg je">你可以在我的 bitbucket repo </strong> <a class="ae li" href="https://bitbucket.org/cho7tom/dynamic-ui/src/master/" rel="noopener ugc nofollow" target="_blank"> <strong class="mg je">这里</strong> </a>找到完整的代码。</p><p id="7707" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated">请不要犹豫发送任何反馈或问题！</p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><p id="df99" class="pw-post-body-paragraph me mf iu mg b mh mx ke mj mk my kh mm ls mz mo mp lw na mr ms ma nb mu mv mw in bi translated"><strong class="mg je">来源</strong></p><ul class=""><li id="f359" class="nq nr iu mg b mh mx mk my ls ns lw nt ma nu mw nv nw nx ny bi translated"><a class="ae li" href="https://shiny.rstudio.com/articles/cheatsheet.html" rel="noopener ugc nofollow" target="_blank"> R 闪亮的备忘单</a></li><li id="0f1c" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi translated"><a class="ae li" href="https://shiny.rstudio.com/articles/communicating-with-js.html" rel="noopener ugc nofollow" target="_blank">通过 JavaScript 与 Shiny 通信</a></li><li id="2495" class="nq nr iu mg b mh nz mk oa ls ob lw oc ma od mw nv nw nx ny bi translated"><a class="ae li" href="https://university.business-science.io/p/expert-shiny-developer-with-aws-course-ds4b-202a-r/" rel="noopener ugc nofollow" target="_blank">商业科学 202A —使用 R 构建可扩展的应用</a></li></ul></div></div>    
</body>
</html>