<html>
<head>
<title>Automatically Locking &amp; Unlocking Ubuntu with Computer Vision Using a Human Face!!!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用人脸通过计算机视觉自动锁定和解锁 Ubuntu！！！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automatically-locking-unlocking-ubuntu-with-computer-vision-using-a-human-face-db35cbe312f7?source=collection_archive---------38-----------------------#2020-08-02">https://towardsdatascience.com/automatically-locking-unlocking-ubuntu-with-computer-vision-using-a-human-face-db35cbe312f7?source=collection_archive---------38-----------------------#2020-08-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3cfa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我用 OpenCV 和人脸识别库实现了一个自动人脸解锁技术。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bc564c7a909e0bac565e5751a26a7c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q23zRXyd7H54kkRV-R-XSw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Ubuntu Face</p></figure><p id="3454" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在玩代码之前，让我们看看你的 Ubuntu 机器上需要安装的库。</p><blockquote class="lu lv lw"><p id="4868" class="ky kz lx la b lb lc ju ld le lf jx lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated"><strong class="la iu">要求</strong></p></blockquote><ol class=""><li id="c012" class="mb mc it la b lb lc le lf lh md ll me lp mf lt mg mh mi mj bi translated"><strong class="la iu"> python 3.7 </strong></li><li id="67bc" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><strong class="la iu"> OpenCV 4.1.0 </strong></li><li id="efb3" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><strong class="la iu"> NumPy </strong></li><li id="b241" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><strong class="la iu">人脸识别</strong></li><li id="a38d" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><strong class="la iu"> sudo apt-get 安装 gnome 屏保</strong></li><li id="09ce" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><strong class="la iu"> sudo apt-get 安装 xdotool </strong></li></ol><blockquote class="lu lv lw"><p id="3ab0" class="ky kz lx la b lb lc ju ld le lf jx lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated">下面是三个 python 文件，刚好可以实现这一点！！！</p></blockquote><blockquote class="mp"><p id="f83c" class="mq mr it bd ms mt mu mv mw mx my lt dk translated">1.face_generate.py</p><p id="b351" class="mq mr it bd ms mt mz na nb nc nd lt dk translated">2.face_train.py</p><p id="b1d1" class="mq mr it bd ms mt mz na nb nc nd lt dk translated">3.face_unlock.py</p></blockquote><figure class="ne nf ng nh ni kn"><div class="bz fp l di"><div class="nj nk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">演示视频</p></figure><h1 id="24b8" class="nl nm it bd nn no np nq nr ns nt nu nv jz nw ka nx kc ny kd nz kf oa kg ob oc bi translated">1.face_generate.py</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5867b55917578c7ba91949aff8736ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ndzZb4-bU7-2SeXbTJJ6zw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">生成面</p></figure><p id="e272" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为第一步，我们必须生成训练图像来训练模型。我已经创建了一个 python 文件来生成我们的面部图像。当你执行这个文件时，它会在命令行中询问你的名字，然后系统会用给定的名字创建一个文件夹。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="2441" class="oi nm it oe b gy oj ok l ol om">number=0;<br/>frame_count=0<br/>detector = dlib.get_frontal_face_detector()<br/>print("enter the person name")<br/>name = input()<br/>folder_name="dataset/"+name</span><span id="0738" class="oi nm it oe b gy on ok l ol om">if os.path.exists(folder_name):<br/>    print ("Folder exist")<br/>else:<br/> os.mkdir(folder_name)</span></pre><p id="1046" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">之后，我们需要使用 OpenCV 库通过网络摄像头读取我们的脸，并将其存储在相应的文件夹中，在保存到该文件夹之前，我们应该调整我们的图像大小。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="a1b4" class="oi nm it oe b gy oj ok l ol om">image = imutils.resize(image, width=500)<br/>  gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)<br/>   # detect faces in the grayscale image<br/>  rects = detector(gray, 1)<br/>  # loop over the face detections<br/>  for (i, rect) in enumerate(rects):<br/>   # determine the facial landmarks for the face region, then   <br/>   (x, y, w, h) = face_utils.rect_to_bb(rect)<br/>   #print rect.dtype<br/>   cro=image[y: y + h, x: x + w]</span><span id="e5f1" class="oi nm it oe b gy on ok l ol om">out_image = cv2.resize(cro,(108,108))<br/>   <br/>   fram= os.path.join(folder_name+"/",str(number)+ "." + "jpg")<br/>   number+=1  <br/>   cv2.imwrite(fram,out_image)  <br/>   cv2.rectangle(image, (x, y), (x + w, y + h), (0, 255, 0), 2)   <br/>  frame_count+=1</span></pre><p id="e43d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将需要 50 张人脸图像来训练模型，你可以根据自己的需要改变图像的数量。</p><h1 id="59b0" class="nl nm it bd nn no np nq nr ns nt nu nv jz nw ka nx kc ny kd nz kf oa kg ob oc bi translated">2.face_train.py</h1><p id="0d70" class="pw-post-body-paragraph ky kz it la b lb oo ju ld le op jx lg lh oq lj lk ll or ln lo lp os lr ls lt im bi translated">该文件将读取由 face_genrate.py 文件生成的每个人脸图像。完成后，我们需要将它们传递给 load_image_file 方法，以获取图像的面部位置。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="d8b2" class="oi nm it oe b gy oj ok l ol om">face = face_recognition.load_image_file("dataset/" + person + "/" + person_img)<br/># location is in css order - top, right, bottom, left<br/>height, width, _ = face.shape<br/>face_location = (0, width, height, 0)</span></pre><p id="5f5b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在训练我们的人脸模型之前，我们应该对我们的图像进行编码，所以我使用了 face_encoding 方法。此外，我们应该将我们的名字存储在一个数组中，以便用 k-最近邻算法进行训练。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="445c" class="oi nm it oe b gy oj ok l ol om">face_enc = face_recognition.face_encodings(face, known_face_locations=[face_location])</span><span id="fdc2" class="oi nm it oe b gy on ok l ol om">face_enc = np.array(face_enc)<br/>face_enc = face_enc.flatten()<br/>        <br/># Add face encoding for current image with corresponding label (name) to the training data<br/>encodings.append(face_enc)<br/>names.append(person)</span></pre><p id="01fc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Sci-kit 学习库是机器学习算法的流行库。我们使用了 sci-kit 学习库提供的 KNeighborsClassifier 算法。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="8273" class="oi nm it oe b gy oj ok l ol om">knn_clf = neighbors.KNeighborsClassifier(n_neighbors=n_neighbors,         algorithm=knn_algo, weights='distance')<br/>knn_clf.fit(encodings,names)</span></pre><p id="8299" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们应该使用<a class="ae ot" href="https://docs.python.org/3/library/pickle.html" rel="noopener ugc nofollow" target="_blank"> pickle 库</a>保存我们的模型文件。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="a8fa" class="oi nm it oe b gy oj ok l ol om"># Save the trained KNN classifier<br/>if model_save_path is not None:<br/>    with open(model_save_path, 'wb') as f:<br/>        pickle.dump(knn_clf, f)</span><span id="c8eb" class="oi nm it oe b gy on ok l ol om">return knn_clf</span></pre><h1 id="9720" class="nl nm it bd nn no np nq nr ns nt nu nv jz nw ka nx kc ny kd nz kf oa kg ob oc bi translated">3.face_unlock.py</h1><p id="3461" class="pw-post-body-paragraph ky kz it la b lb oo ju ld le op jx lg lh oq lj lk ll or ln lo lp os lr ls lt im bi translated">这个 python 文件将根据训练好的图像锁定和解锁 ubuntu 系统。让我们首先使用 OpenCV 库通过网络摄像头捕捉我们的脸。使用 read 方法后，我们可以将人脸图像作为帧来读取。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="f6ba" class="oi nm it oe b gy oj ok l ol om">camera = cv2.VideoCapture(0)<br/>(grabbed, image1) = camera.read()</span></pre><p id="e33e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们必须从图像中检测人脸的位置，因此我使用了 face_location 方法。得到人脸位置后，我们应该传递给 face_encodings 方法对人脸图像进行编码，以便进行下一步处理。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="bb17" class="oi nm it oe b gy oj ok l ol om">image = image1[:, :, ::-1]</span><span id="19ce" class="oi nm it oe b gy on ok l ol om">X_face_locations = face_recognition.face_locations(image)</span><span id="5e93" class="oi nm it oe b gy on ok l ol om"># If no faces are found in the image, return an empty result.<br/>if len(X_face_locations) != 0:<br/>  <br/># Find encodings for faces in the test iamge<br/>faces_encodings = face_recognition.face_encodings(image,   known_face_locations=X_face_locations)</span></pre><p id="9405" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在预测之前，应该使用 knn 模型来找到给定人脸的最佳匹配。下面是验证脸的预测方法。它将返回名称和顶部、左侧、右侧和底部变量。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="40a5" class="oi nm it oe b gy oj ok l ol om">closest_distances = knn_clf.kneighbors(faces_encodings,   n_neighbors=1)</span><span id="44de" class="oi nm it oe b gy on ok l ol om">are_matches = [closest_distances[0][i][0] &lt;= 0.4 for i in range(len(X_face_locations))]</span><span id="8cf8" class="oi nm it oe b gy on ok l ol om">predictions = [(pred, loc) if rec else ("unknown", loc) for pred, loc, rec in zip(knn_clf.predict(faces_encodings), X_face_locations, are_matches)]</span></pre><p id="b0c8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用<a class="ae ot" href="https://en.wikipedia.org/wiki/GNOME_Screensaver" rel="noopener ugc nofollow" target="_blank"> gnome shell </a>命令锁定和解锁 ubuntu 系统。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="12bc" class="oi nm it oe b gy oj ok l ol om">if name not in "unknown":<br/>    os.popen('gnome-screensaver-command -d &amp;&amp; xdotool key Return')<br/>else<br/>    os.popen('gnome-screensaver-command -a')</span></pre><p id="2c51" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果用户的面部未知或未被检测到，系统将保持锁定状态。</p><h2 id="256d" class="oi nm it bd nn ou ov dn nr ow ox dp nv lh oy oz nx ll pa pb nz lp pc pd ob pe bi translated">结论</h2><p id="c700" class="pw-post-body-paragraph ky kz it la b lb oo ju ld le op jx lg lh oq lj lk ll or ln lo lp os lr ls lt im bi translated">就这样，在上面列出的三个 python 文件的帮助下，我们已经使用人脸成功测试了 ubuntu 的自动锁定和解锁技术。你可以在这里得到完整的源代码</p><blockquote class="mp"><p id="6d1c" class="mq mr it bd ms mt mz na nb nc nd lt dk translated">如果您需要任何帮助或协助，请联系我<a class="ae ot" href="https://www.linkedin.com/in/bala-venkatesh-67964247/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae ot" href="https://twitter.com/balavenkatesh22" rel="noopener ugc nofollow" target="_blank"> Twitter </a>。</p></blockquote></div></div>    
</body>
</html>