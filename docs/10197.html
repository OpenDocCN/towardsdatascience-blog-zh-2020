<html>
<head>
<title>Building a Brain Tumor Classification App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建脑瘤分类应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-brain-tumor-classification-app-e9a0eb9f068?source=collection_archive---------25-----------------------#2020-07-18">https://towardsdatascience.com/building-a-brain-tumor-classification-app-e9a0eb9f068?source=collection_archive---------25-----------------------#2020-07-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="de35" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个真正的机器学习应用程序，从零开始，使用 Dash</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7c7f75e5c5c17aeb8d889ceeae1b4e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wOTKLCPTWUoOg81r"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:https://unsplash.com/photos/rmWtVQN5RzU</p></figure><p id="baac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的文章中，我将展示一个我从零开始创建的机器学习应用程序。</p><h2 id="e8f7" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">1.目标</h2><p id="de74" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我想建立的是一个应用程序，它可以将大脑核磁共振图像作为输入。从那里，应用程序将返回一个预测，说图像上是否有肿瘤。</p><p id="7adb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我发现这个想法很有趣，因为任何人都可以使用这个应用程序来确定是否存在脑瘤。不需要编码技能或关于大脑的知识。</p><p id="0d39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现这一目标，需要完成三个步骤，即创建预测图像类别的模型、创建应用程序以及最后部署应用程序本身。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="e54c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">2.构建卷积神经网络模型</h2><p id="ac6d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">CNN 是一类深度神经网络，通常用于分析视觉内容，这正是我在这里想要做的。</p><p id="2b77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用来建立 CNN 的数据来自这里的<a class="ae ky" href="https://www.kaggle.com/sartajbhuvaji/brain-tumor-classification-mri" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="3f86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它包含 3264 幅脑 MRI 图像(2880 幅训练图像和 384 幅测试图像)，分为 4 类:神经胶质瘤肿瘤、脑膜瘤肿瘤、垂体肿瘤和无肿瘤。</p><p id="98c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用 Keras 建立模型。对于那些不知道的人，Keras 是一个运行在 Tensorflow 之上的高级 Python 神经网络库。其简单的架构、可读性和整体易用性使其成为使用 Python 进行深度学习时最受欢迎的库之一。</p><p id="40ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在为 CNN 导入并准备好图像后，我最终构建了以下模型。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="82f5" class="lv lw it nb b gy nf ng l nh ni">model = Sequential()</span><span id="ae76" class="lv lw it nb b gy nj ng l nh ni">model.add(Conv2D(32, (3, 3), input_shape=(150,150,3), use_bias=False))<br/>model.add(Activation('relu'))<br/>model.add(BatchNormalization())<br/>model.add(MaxPooling2D(pool_size=(2, 2)))<br/>model.add(Conv2D(32, (3, 3))) <br/>model.add(Activation('relu'))<br/>model.add(BatchNormalization())<br/>model.add(MaxPooling2D(pool_size=(2, 2)))<br/>model.add(Dropout(0.25))<br/>model.add(Flatten())<br/>model.add(Dense(64))<br/>model.add(Activation('relu'))<br/>model.add(Dropout(0.25))<br/>model.add(Dense(4))<br/>model.add(Activation('softmax'))</span><span id="09a6" class="lv lw it nb b gy nj ng l nh ni">model.compile(loss = "categorical_crossentropy", optimizer=keras.optimizers.Adam(learning_rate=0.001), metrics=['accuracy'])</span></pre><p id="c7cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我把模型保持得非常简单。它只有两个卷积层，最末端的 softmax 层将返回 MRI 属于 4 类的概率。</p><p id="0ce4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我根据数据训练这个模型。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="b8e6" class="lv lw it nb b gy nf ng l nh ni">history = model.fit(trainData, trainLabel,batch_size = 128, epochs = 30 ,validation_data=(testData, testLabel))</span></pre><p id="93bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个只有 30 个历元的简单模型达到了大约 81%的准确率。那意思很明显，不要把这个 app 当做绝对真理，听医生的！</p><p id="0c59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，通过保存模型，这意味着它可以很容易地在 Dash 应用程序中用于预测新图像。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="ae0a" class="lv lw it nb b gy nf ng l nh ni">model.save('model_final.h5')</span></pre><p id="9540" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在这一部分已经完成，让我们继续使用 Dash 创建应用程序。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="c322" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">3.创建应用程序</h2><p id="0566" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我使用 Dash 来创建应用程序。该平台允许我们开发高质量的企业级分析应用，而不需要开发人员、JavaScript 或除了基本 Python 技能之外的任何东西。</p><p id="6933" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于如何构建 Dash 应用的完整教程，请点击<a class="ae ky" rel="noopener" target="_blank" href="/how-to-build-a-web-based-app-in-50-lines-of-code-using-plotly-and-dash-3953f039b217">这里</a>。</p><p id="9dbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我做的第一件事是导入运行 dash 应用程序和 keras 模型所需的所有包。之后，就可以构建应用程序了。这是它的完整代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="d8ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那是相当长的，所以让我们检查一些事情。首先，<code class="fe nm nn no nb b">names</code>函数的作用是根据模型的预测，给出一个特定的输出(即肿瘤的名称)。</p><p id="1f26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们来复习一下回调。它接受一个图像作为输入，即 html。来自<code class="fe nm nn no nb b">parse_contents</code>函数的 Img 标签。<code class="fe nm nn no nb b">list_of_contents[0]</code>意味着只有上传的第一张图片会被使用(所以上传多张图片是没有意义的)。</p><p id="54f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，以下代码获取 Dash 以 base64 字符串编码的图像，并使其可用于 CNN:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="8982" class="lv lw it nb b gy nf ng l nh ni">  img_data = list_of_contents[0]<br/>  img_data = re.sub('data:image/jpeg;base64,', '', img_data)<br/>  img_data = base64.b64decode(img_data)  <br/>  stream = io.BytesIO(img_data)<br/>  img_pil = Image.open(stream)</span></pre><p id="6708" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，用<code class="fe nm nn no nb b">load_model</code>函数加载之前创建的模型，将图像转换成具有正确形状的 numpy 数组，并用<code class="fe nm nn no nb b">answ = model.predict(x)</code>进行预测。这里的好处是，你可以创建任何你想要的 CNN 模型并加载它，应用程序仍然可以工作！</p><p id="68ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，根据该预测，给出关于图像上没有肿瘤的可能性和关于肿瘤的一些事实的第二个预测。</p><p id="ae17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，返回 4 个输出(图像、两个预测和事实)，从而结束长时间的回调。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="b5f0" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><strong class="ak"> 4。Heroku </strong>的部署</h2><p id="9cf7" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">随着应用程序的创建，是时候让每个人都可以使用它了。Dash 应用程序可以部署在 Heroku 上，这是一个云应用程序平台，允许您完全免费运行您的应用程序。</p><p id="ec63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要了解如何在 Heroku 上部署 Dash 应用程序，请点击右<a class="ae ky" rel="noopener" target="_blank" href="/how-to-deploy-your-dash-app-with-heroku-a4ecd25a6205">此处</a>。</p><p id="5341" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这款应用就在这里:<a class="ae ky" href="https://brain-mri-app.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://brain-mri-app.herokuapp.com/</a>。只是提醒一下，加载应用程序可能需要一段时间。这是因为它会在一段时间后进入睡眠状态(这是 Heroku 免费版的少数不便之处之一)。</p><p id="67e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个简短的 GIF 展示了该应用程序应该如何使用。正如您将看到的，这非常简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nl l"/></div></figure><p id="ced8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以用任何健康大脑的 MRI 图像，或者有神经胶质瘤、脑膜瘤或垂体瘤的大脑图像来尝试。例如，这是一张脑膜瘤的图像，你可以用它来预测。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/443bd4b8565a2a6a53fcad906eec2e0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*0TfMiQU_0ncqIFXKB7_4CQ.jpeg"/></div></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="2ed2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读，我希望你觉得这篇文章有趣！</p><p id="9d28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有的代码都可以在这个库中找到:<a class="ae ky" href="https://github.com/francoisstamant/brain-tumor-classifier-app" rel="noopener ugc nofollow" target="_blank">https://github . com/francoistamant/brain-tumor-classifier-app</a></p></div></div>    
</body>
</html>