<html>
<head>
<title>How to Create a Hub-and-Spoke Plot with Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Plotly 创建轴辐式绘图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-a-hub-and-spoke-plot-with-plotly-d11d65a4200?source=collection_archive---------31-----------------------#2020-01-08">https://towardsdatascience.com/how-to-create-a-hub-and-spoke-plot-with-plotly-d11d65a4200?source=collection_archive---------31-----------------------#2020-01-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0155" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用连接位置的线在地图上绘制纬度/经度数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e551f939ae6c60955c9ef17a5c3bbaa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWskYOWgxW47mr7dP_zKyw.png"/></div></div></figure><p id="0631" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不久前，我需要在地图上绘制连接某些位置的纬度(lat)和经度(long)坐标的线。我需要画的是众所周知的“<a class="ae ln" href="https://en.wikipedia.org/wiki/Spoke%E2%80%93hub_distribution_paradigm" rel="noopener ugc nofollow" target="_blank">轴辐式</a>图。知道<a class="ae ln" href="https://plot.ly/python/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>已经有了一些样品，比如这里的<a class="ae ln" href="https://plot.ly/python/lines-on-maps/" rel="noopener ugc nofollow" target="_blank"/>，我能够很容易地完成它。但是现实生活中的数据并不总是完美地适用于 Plotly 的例子，而且可能还有其他开箱即用的例子不能满足的要求。</p><p id="c541" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇博客中，我将向你展示如何自己构建这些图表。特别是，我们将假设:</p><ul class=""><li id="e99f" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">数据并不总是来自同一个地区(如美国)。我们的地理空间数据可以是北美、南美或欧洲的。</li><li id="44d9" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">该图需要保存为 HTML 文件。</li><li id="9e3f" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">图形应该是脱机的*。</li></ul><p id="4269" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">* <em class="mc">这实际上是在 Plotly 版本 4 之前需要更多努力的事情，特别是因为他们的文档强调在线模式，正如你在这里看到的</em><a class="ae ln" href="https://plot.ly/python/v3/lines-on-maps/" rel="noopener ugc nofollow" target="_blank"><em class="mc"/></a><em class="mc">。但是版本 4 只离线。你可以在这里</em>  <em class="mc">阅读更多关于在线特性</em> <a class="ae ln" href="https://plot.ly/python/v4-migration/" rel="noopener ugc nofollow" target="_blank"> <em class="mc">的迁移。</em></a></p><h1 id="3cc0" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">一些关于神秘人物的背景</h1><p id="f303" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la mx lc ld le my lg lh li mz lk ll lm ij bi translated">Plotly 中有多种表示图形的方法。两种最常见的方法是使用(a)字典或使用(b) <em class="mc">图形对象。</em>虽然各有利弊，Plotly 推荐后者的额外好处，你可以在这里查看<a class="ae ln" href="https://plot.ly/python/creating-and-updating-figures/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="f8f0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了创建一个图形，我们需要两个主要组件:数据<em class="mc">和布局</em>。来自<a class="ae ln" href="https://plot.ly/python/creating-and-updating-figures/" rel="noopener ugc nofollow" target="_blank">文档</a>:</p><blockquote class="na nb nc"><p id="f7a5" class="kr ks mc kt b ku kv jr kw kx ky ju kz nd lb lc ld ne lf lg lh nf lj lk ll lm ij bi translated">您可以通过将跟踪和布局规范传递给<code class="fe ng nh ni nj b">plotly.graph_objects.Figure</code>构造函数来构建一个完整的图形。这些跟踪和布局规范可以是字典或图形对象。</p></blockquote><p id="d109" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="mc">布局</em>字典指定图形布局的属性，而<em class="mc">数据</em>是一个跟踪字典列表，带有各个跟踪的配置选项(<em class="mc">跟踪</em>是 Plotly 用来描述图形的一个词)。</p><p id="6849" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">既然我们知道了图形是如何构成的，我们就可以准备数据并把它们标绘在地图上。虽然下面的代码是针对 Plotly 版本 4 的，但是你可以在<a class="ae ln" href="https://github.com/ekhoda/plotly_hub_and_spoke/blob/master/plotly_hub_and_spoke.ipynb" rel="noopener ugc nofollow" target="_blank">这个 Jupyter 笔记本</a>中找到版本 3 和版本 4 的实现。</p><h1 id="41bd" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">数据准备</h1><p id="ec57" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la mx lc ld le my lg lh li mz lk ll lm ij bi translated">数据(如您在此<a class="ae ln" href="https://github.com/ekhoda/plotly_hub_and_spoke/blob/master/sample_us.csv" rel="noopener ugc nofollow" target="_blank">示例中所见。csv 文件</a>)包含每个出发地和目的地的信息(即城市、州、国家、纬度和经度)。为了画出这个情节，我们只关心:</p><ul class=""><li id="9d5f" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">始发地和目的地的纬度/经度。</li><li id="54a8" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">地图上的位置属性，例如大小、颜色和形状。</li><li id="a1f1" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">以及任何其他关于某个位置的信息，或者我们希望在地图上显示的位置之间的路径。例如，当用户的鼠标悬停在每条路径上时，您可能想要显示每个位置的名称，或者每条路径的长度(以英里为单位)(这里我们只显示前者。)</li></ul><p id="bff4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，让我们加载数据:</p><pre class="kg kh ki kj gt nk nj nl nm aw nn bi"><span id="a20c" class="no me iq nj b gy np nq l nr ns"><strong class="nj ir">import </strong>pandas <strong class="nj ir">as </strong>pd<br/><strong class="nj ir">import </strong>plotly.graph_objects <strong class="nj ir">as </strong>go</span><span id="2251" class="no me iq nj b gy nt nq l nr ns">data = pd.read_csv(<strong class="nj ir">'sample_us.csv'</strong>)</span></pre><p id="56c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，使用所有需要的属性创建位置数据框架:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="6f86" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后，我们可以将每个位置及其属性添加到图形中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="bd49" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后，我们可以将每条路径添加到图形中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="05df" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，让我们指定地图的布局:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="ddf2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为我们希望将地图显示为 HTML 文件，所以我们还需要一行代码:</p><pre class="kg kh ki kj gt nk nj nl nm aw nn bi"><span id="d178" class="no me iq nj b gy np nq l nr ns">fig.write_html(file=<strong class="nj ir">f'{</strong>title<strong class="nj ir">}.html'</strong>, auto_open=<strong class="nj ir">True</strong>)</span></pre><p id="0bec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样！这正如预期的那样起作用，但是只有当纬度/经度数据局限于美国时。为了让它对不同种类的底层数据(比如欧洲的位置)有更好的响应，我们需要做一个小小的改变。</p><h1 id="d17d" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">一般数据</h1><p id="2def" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la mx lc ld le my lg lh li mz lk ll lm ij bi translated">如果你仔细观察上面的代码，你会发现在<code class="fe ng nh ni nj b">layout</code>字典中，我们指定了<code class="fe ng nh ni nj b">scope='usa'</code>。根据<a class="ae ln" href="https://plot.ly/python/reference/#layout-geo-scope" rel="noopener ugc nofollow" target="_blank"> Plotly 的文档</a> , <code class="fe ng nh ni nj b">scope</code>接受以下值之一:</p><pre class="kg kh ki kj gt nk nj nl nm aw nn bi"><span id="75ab" class="no me iq nj b gy np nq l nr ns"><em class="mc">"world" | "usa" | "europe" | "asia" | "africa" | "north america" | "south america".</em></span></pre><p id="3207" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了决定使用什么范围，我们应该查看数据中纬度和经度的范围。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="4759" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，我们可以将我们的范围与每个范围的大致范围进行比较，以决定使用哪一个(我通过在线搜索找到了它们——它们应该很好地服务于我们的目的。)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="1bd9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">剩下要做的就是改变<code class="fe ng nh ni nj b">layout</code>的<code class="fe ng nh ni nj b">scope=scope</code>，我们就完成了。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="a143" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">瞧啊。我们完了。让我们在两个不同的数据集上测试这个方法。</p><p id="8e17" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一张<a class="ae ln" href="https://github.com/ekhoda/plotly_hub_and_spoke/blob/master/sample_us.csv" rel="noopener ugc nofollow" target="_blank">用户数据</a>的地图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e551f939ae6c60955c9ef17a5c3bbaa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWskYOWgxW47mr7dP_zKyw.png"/></div></div></figure><p id="7c72" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一张来自<a class="ae ln" href="https://github.com/ekhoda/plotly_hub_and_spoke/blob/master/sample_eu.csv" rel="noopener ugc nofollow" target="_blank">欧洲</a>的照片:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/6edc1656e4c8300b8bf262b06e3a381f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*RFZfUWVJTlzZiu7o1er0wA.png"/></div></figure><p id="5482" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意，这个博客的样本数据和更详细的代码可以在<a class="ae ln" href="https://github.com/ekhoda/plotly_hub_and_spoke" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><p id="58f4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望这篇博客对你有用。可以通过<a class="ae ln" href="https://twitter.com/EhsanKhoda" rel="noopener ugc nofollow" target="_blank"><em class="mc">Twitter</em></a><em class="mc">和</em><a class="ae ln" href="https://www.linkedin.com/in/ehsankhodabandeh" rel="noopener ugc nofollow" target="_blank"><em class="mc">LinkedIn</em></a><em class="mc">联系到我，我欢迎任何反馈。</em></p></div></div>    
</body>
</html>