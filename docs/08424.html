<html>
<head>
<title>All You Need To Know on APIs With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您需要了解的关于 Python 的所有信息</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/all-you-need-to-know-on-apis-with-python-927fb572d723?source=collection_archive---------9-----------------------#2020-06-19">https://towardsdatascience.com/all-you-need-to-know-on-apis-with-python-927fb572d723?source=collection_archive---------9-----------------------#2020-06-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3d87" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">看看我们如何使用 Python 通过 API 与网络通信</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7383c4bb5b4600e9ecc938a564c35ac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L89Byis8Y9Mt-1w6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@ptrikutam?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pavan Trikutam </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="c5ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用 Python 在网上聊天，听起来很恐怖，对吧？幸运的是，互联网很长一段时间以来一直处于良好的状态。我们与互联网交流的方法已经很成熟，而且出奇的简单。</p><p id="318c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将跳过简短的介绍，直接进入正题。本文将涵盖我们通过网络进行有效沟通所需的所有内容，包括:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c7c9" class="ma mb it lw b gy mc md l me mf">- Application Program Interfaces (<strong class="lw iu">APIs</strong>)<br/>- JavaScript Object Notation (<strong class="lw iu">JSON</strong>)<br/>- <strong class="lw iu">Requests</strong> with Python<br/>- Real world <strong class="lw iu">use-cases</strong></span></pre></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="e6ad" class="mn mb it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">应用程序接口</h1><p id="72da" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">应用编程接口就像一个魔术盒。我们以指定的格式发送数据。然后，我们以指定的格式获取数据。</p><p id="94d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个神奇的盒子只是保存在服务器上的一个脚本。它就像一个看门人——我们告诉看门人我们想知道、更改或删除一些东西，看门人会(希望)执行我们要求的动作，并告诉我们进展如何。</p><p id="dc65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，API 通常都有很好的文档记录，并且遵循相同的使用模式。绝大多数的 Web APIs 使用代表性的状态转移(REST)结构——这听起来比实际情况复杂得多。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h2 id="4e14" class="ma mb it bd mo nj nk dn ms nl nm dp mw li nn no my lm np nq na lq nr ns nc nt bi translated">休息</h2><p id="b5b9" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">RESTful API 体系结构应用了<strong class="lb iu">六个关键约束</strong>:</p><ul class=""><li id="951b" class="nu nv it lb b lc ld lf lg li nw lm nx lq ny lu nz oa ob oc bi translated">所有请求都通过<a class="ae ky" href="https://restfulapi.net/rest-architectural-constraints/#uniform-interface" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">单个外向接口</strong> </a>处理。</li><li id="7302" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Client%E2%80%93server_model" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">客户机-服务器独立性</strong></a>——一方的开发和功能变化不应该影响另一方(客户机指我们，服务器指 API)。</li><li id="aff4" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Stateless_protocol" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">无国籍状态</strong></a><strong class="lb iu"/>——服务器不保留我们会话的任何信息；每个请求都被视为新的。</li><li id="8463" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><a class="ae ky" href="https://restfulapi.net/caching/#:~:text=Caching%20is%20the%20ability%20to,the%20service%20hosting%20the%20resource." rel="noopener ugc nofollow" target="_blank"/></li><li id="bfe4" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated">使用<a class="ae ky" href="https://www.mulesoft.com/resources/api/what-is-rest-api-design#:~:text=Layered%20System&amp;text=Each%20layer%20is%20separate%20but,more%20scalable%20and%20modular%20application." rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">分层系统</strong></a><strong class="lb iu"/>——意味着 API 由层组成，其中每一层都连接到另一层，从而创建模块化结构。</li><li id="5dac" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated">如果适用，API 应该能够根据请求 为用户提供可执行的<a class="ae ky" href="https://www.mulesoft.com/resources/api/what-is-rest-api-design#:~:text=Layered%20System&amp;text=Each%20layer%20is%20separate%20but,more%20scalable%20and%20modular%20application." rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">代码。</strong></a></li></ul><p id="90d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些对我们来说意味着，我们将与单个位置进行通信，并期待特定的行为——这将使用一组 HTTP 方法进一步标准化。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h2 id="12ff" class="ma mb it bd mo nj nk dn ms nl nm dp mw li nn no my lm np nq na lq nr ns nc nt bi translated">方法</h2><p id="dd44" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">当与 API 通信时，我们倾向于使用四种方法:</p><ul class=""><li id="c678" class="nu nv it lb b lc ld lf lg li nw lm nx lq ny lu nz oa ob oc bi translated"><strong class="lb iu"> GET </strong> —用于从 API 中检索信息。</li><li id="5a2f" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><strong class="lb iu"> POST </strong> —创建新资源(例如，GitHub repo)。</li><li id="7e47" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><strong class="lb iu">上传</strong> —更新现有资源。</li><li id="5843" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><strong class="lb iu">删除</strong> —删除现有资源。</li></ul><p id="7ba6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中最常用的是<strong class="lb iu"> GET </strong>协议。在大多数情况下，对于数据，我们更感兴趣的是下载它。</p><p id="fd50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们想使用 Google Maps API 获取一个地址的经度和纬度坐标，我们会发送一个 get 请求——因为我们实际上是从 API 获取 T21 数据。</p><p id="4c0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">修改信息</strong>时会用到<strong class="lb iu">发布、上传、删除</strong>。以 GitHub repo 为例，我们可以用<strong class="lb iu"> POST </strong>创建它，用<strong class="lb iu"> PUT </strong>更新它，用<strong class="lb iu"> DELETE </strong>删除它。</p><p id="b7ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能还会看到<strong class="lb iu">补丁</strong>——这用于部分更新，类似于 PUT。我以前没用过这个，看起来不太常见但值得了解。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h2 id="6ff6" class="ma mb it bd mo nj nk dn ms nl nm dp mw li nn no my lm np nq na lq nr ns nc nt bi translated">HTTP 代码</h2><p id="ca3f" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">当使用 GET、POST、PUT 和 DELETE 时，我们通常会收到以下代码之一:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2eb8" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu">2xx - Success Codes<br/>200 OK</strong> - success (most common with <strong class="lw iu">GET</strong>)<br/><strong class="lw iu">201 Created</strong> - request fulfilled and new resource created (<strong class="lw iu">POST</strong>/<strong class="lw iu">PUT</strong>)<br/><strong class="lw iu">204 No Content</strong> - success but no content is returned in response</span><span id="af91" class="ma mb it lw b gy ol md l me mf"><strong class="lw iu">4xx - Client Error Codes<br/>400 Bad Request</strong> - request could not be understood due to bad syntax<br/><strong class="lw iu">401 Unauthorized</strong> - most likely we missed the auth key<br/><strong class="lw iu">403 Forbidden</strong> - we're trying to go places we're not allowed<br/><strong class="lw iu">404 Not Found</strong> - what we're trying to access doesn't exist</span><span id="c3b2" class="ma mb it lw b gy ol md l me mf"><strong class="lw iu">Honorable Mentions</strong><br/><strong class="lw iu">418 I'm a teapot</strong> - stop asking a teapot to brew coffee<br/><strong class="lw iu">420 Enhance Your Calm</strong> - sending to many requests to Twitter</span></pre><p id="93c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记下最后两个——它们非常重要，<strong class="lb iu">永远不要忘记它们。</strong></p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="f93f" class="mn mb it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">JavaScript 对象符号</h1><p id="ad1b" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">当与 API 通信时，我们需要一个发送和接收数据的标准化模板，这样 API 和我们都可以正确地处理数据。这种格式是 JavaScript 对象符号(JSON)。</p><p id="383c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JSON 实现了与 Python 字典中相同的键值对层次结构。</p><p id="77cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://pokeapi.co/api/v2/pokemon/charizard" rel="noopener ugc nofollow" target="_blank">点击此处</a>将使用我们的浏览器向 Pokemon API(所有东西都有 API)发送请求，然后加载来自 API 的 JSON 响应:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/206a6405b655198cde5741a6ad892cb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3i7d3dPddeONEgja9sPWsA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自口袋妖怪 API 的 JSON 响应</p></figure><p id="9344" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 Python 中，我们使用字典和<code class="fe oi oj ok lw b">json</code>库来构建 JSON 字符串以包含在请求中，通常如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0781" class="ma mb it lw b gy mc md l me mf">request = {'name': 'John',<br/>           'age': 21}<br/>json_obj = <strong class="lw iu">json.dumps(</strong>request<strong class="lw iu">)</strong><br/>requests.post('https://api.com', data=json_obj)</span></pre></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="d209" class="mn mb it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">Python 中的请求</h1><p id="2167" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">好了，我们知道它是怎么工作的了。但是我们怎么做这些事情呢？</p><p id="cddf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用<code class="fe oi oj ok lw b">requests</code>——一个非常容易使用的库。例如，如果我们需要发送一个<strong class="lb iu"> GET 请求</strong>，我们只需编写:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9284" class="ma mb it lw b gy mc md l me mf">import requests<br/>data = <strong class="lw iu">requests.get(</strong>http<strong class="lw iu">)</strong></span></pre><p id="bd82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oi oj ok lw b">http</code>是 API 的网址，包括指定我们想要的信息的参数。</p><p id="6895" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们以<a class="ae ky" href="https://pokeapi.co/" rel="noopener ugc nofollow" target="_blank">神奇宝贝 API </a>为例——它使用起来非常简单。</p><p id="4774" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该 API 包括一种方法，用于查找每个新一代中添加的所有口袋妖怪——我特别记得有 151 个口袋妖怪，现在有<a class="ae ky" href="https://en.wikipedia.org/wiki/List_of_Pok%C3%A9mon#Lists_of_Pok%C3%A9mon" rel="noopener ugc nofollow" target="_blank">多于</a>896 个。所以让我们看看他们用第二代增加了多少。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h2 id="d1d7" class="ma mb it bd mo nj nk dn ms nl nm dp mw li nn no my lm np nq na lq nr ns nc nt bi translated">1.调用 API</h2><p id="6174" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">首先，我们简单地使用 GET 请求来请求数据，指定我们对<code class="fe oi oj ok lw b"><strong class="lb iu">generation</strong></code> <strong class="lb iu"> </strong>数据感兴趣，特别是<code class="fe oi oj ok lw b"><strong class="lb iu">generation-ii</strong></code>:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b789" class="ma mb it lw b gy mc md l me mf">API_CALL = "https://pokeapi.co/api/v2/<strong class="lw iu">generation/generation-ii</strong>"<br/>requests.<strong class="lw iu">get</strong>(API_CALL)</span></pre><p id="5dbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oi oj ok lw b"><strong class="lb iu">[Out]:</strong> &lt;Response [200]&gt;</code></p><p id="271e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的，<code class="fe oi oj ok lw b">&lt;Response [200]&gt;</code>是什么意思？嗯，这是 HTTP <code class="fe oi oj ok lw b">200 OK</code>状态码。意味着我们的请求成功了！但是我们想要的数据在哪里呢？</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h2 id="dc25" class="ma mb it bd mo nj nk dn ms nl nm dp mw li nn no my lm np nq na lq nr ns nc nt bi translated">2.提取数据</h2><p id="0e8c" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">我们返回的是一个<code class="fe oi oj ok lw b">requests.Response Object</code>——它包含许多有用的方法，我们想要检索实际 JSON 响应的方法是:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e0fe" class="ma mb it lw b gy mc md l me mf">RES = requests.<strong class="lw iu">get</strong>(API_CALL)<br/>RES<strong class="lw iu">.json()  # returns a dictionary</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/d8a86a384f9bc7cb049ece0f74994f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FpNIePXl9GUeajRYn5Kbxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自 Pokemon API 的 JSON 响应—显示所有第二代相关数据。</p></figure><p id="ad41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们有一个非常详细的响应，包含了第二代中添加的所有内容。为了统计新口袋妖怪的数量，我们访问了<code class="fe oi oj ok lw b">pokemon_species</code>列表:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a144" class="ma mb it lw b gy mc md l me mf">DATA = RES.json()<br/>DATA[<strong class="lw iu">'pokemon_species'</strong>]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/10faeeb0f65042d98ada10d8980c6717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zkFbMmAmmy0x0J-7kSR-xQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自口袋妖怪 API 的 JSON 响应—显示所有第二代口袋妖怪物种</p></figure><p id="ab45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以键入<code class="fe oi oj ok lw b">len(DATA['pokemon_species'])</code>来查找新口袋妖怪的数量(它是<strong class="lb iu"> 100 </strong>)。</p><p id="5003" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以找到我们需要知道的关于口袋妖怪的一切。这很好，但可能没那么有用。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="5c72" class="mn mb it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">真实世界的使用案例</h1><p id="ab7f" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">让我们使用真正的 API 和用例来编写一些更相关的代码。</p><h2 id="76c7" class="ma mb it bd mo nj nk dn ms nl nm dp mw li nn no my lm np nq na lq nr ns nc nt bi translated">使用 Google Maps API 可视化地址</h2><p id="9d00" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">我写的第一个代码很大程度上依赖于谷歌地图地理编码 API。现在看着它让我感到恶心——所以我们要重写它。</p><p id="9b03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的目标是在地图上绘制一个地址目录。为此，我们需要它们的相对 x-y 坐标(对于 Matplotlib 来说)，这就需要我们找到它们的经纬度坐标。</p><p id="7890" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我目前住在罗马——所以我整理了一份这里著名地标的小清单；我们将在示例中使用这些数据——所以请随意下载并跟随。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><blockquote class="op oq or"><p id="e09e" class="kz la os lb b lc ld ju le lf lg jx lh ot lj lk ll ou ln lo lp ov lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">授权</em> </strong></p></blockquote><p id="f5be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要一个授权密钥来使用 Google Maps 地理编码 API ( <a class="ae ky" href="https://developers.google.com/maps/documentation/geocoding/usage-and-billing" rel="noopener ugc nofollow" target="_blank"> ~每月 40，000 次请求是免费的</a>)。大多数 API 总是需要我们在调用中包含一个授权密钥；否则，我们的请求将被拒绝:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/324e17ed99a1a7ac990c869f8715a21a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yUtE0oNd1xOpIKd0kbJy_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们在没有授权密钥的情况下尝试访问 API 时的反应，<a class="ae ky" href="http://maps.googleapis.com/maps/api/geocode/json?address=piazza+del+colosseo,+1,+rome" rel="noopener ugc nofollow" target="_blank">单击此处尝试相同的</a>。</p></figure><p id="0666" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://developers.google.com/maps/documentation/geocoding/get-api-key" rel="noopener ugc nofollow" target="_blank">地理编码 API 文档</a>包含获取 API 密钥的说明。</p><blockquote class="op oq or"><p id="9103" class="kz la os lb b lc ld ju le lf lg jx lh ot lj lk ll ou ln lo lp ov lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it"> API 参数</em> </strong></p></blockquote><p id="167f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们想找到罗马斗兽场<a class="ae ky" href="https://www.google.com/search?safe=active&amp;sxsrf=ALeKk00HNFVN1lk12fdsEKaJqqy1T1p2sA%3A1592419794401&amp;ei=0mXqXr6IGKyX1fAPk_ingAY&amp;q=colosseum+address&amp;oq=colosseum+address&amp;gs_lcp=CgZwc3ktYWIQAzICCAAyAggAMgYIABAWEB4yBggAEBYQHjIGCAAQFhAeMgYIABAWEB4yBggAEBYQHjIGCAAQFhAeMgYIABAWEB4yBggAEBYQHjoECAAQQzoECCMQJzoFCAAQkQI6BwgAEBQQhwI6BAgAEApQ5LEmWM_nJmD87iZoAnAAeACAAXOIAaAOkgEEMTMuNpgBAKABAaoBB2d3cy13aXo&amp;sclient=psy-ab&amp;ved=0ahUKEwi-ubaBwonqAhWsSxUIHRP8CWAQ4dUDCAw&amp;uact=5" rel="noopener ugc nofollow" target="_blank">的坐标，我们从 HTTP 地址内部将街道地址传递给 API。</a></p><p id="7fac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">API 需要两个变量，<code class="fe oi oj ok lw b">address</code>和<code class="fe oi oj ok lw b">key</code>。我们在<code class="fe oi oj ok lw b"><a class="ae ky" href="http://maps.googleapis.com/maps/api/geocode." rel="noopener ugc nofollow" target="_blank">http://maps.googleapis.com/maps/api/geocode</a></code> <a class="ae ky" href="http://maps.googleapis.com/maps/api/geocode." rel="noopener ugc nofollow" target="_blank">访问地理定位 API。</a></p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5766" class="ma mb it lw b gy mc md l me mf">API = "http://maps.googleapis.com/maps/api/geocode"<br/>ADDR = "piazza+del+colosseo,+1,+rome"<br/>KEY = "API_KEY"  # replace this with the API key from Google</span><span id="14e5" class="ma mb it lw b gy ol md l me mf">requests.get(f"{API}/json?address={ADDR}&amp;key={KEY}")</span></pre><p id="e311" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此代码将发送一个 GET 请求到:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6a30" class="ma mb it lw b gy mc md l me mf"><a class="ae ky" href="http://maps.googleapis.com/maps/api/geocode/json?address=piazza+del+colosseo,+1,+rome&amp;key=AUTH_KEY" rel="noopener ugc nofollow" target="_blank">http://maps.googleapis.com/maps/api/geocode/json?address=piazza+del+colosseo,+1,+rome&amp;key=<strong class="lw iu">AUTH_KEY</strong></a></span></pre><p id="929d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您用<code class="fe oi oj ok lw b"><strong class="lb iu">AUTH_KEY</strong></code>在浏览器中输入这个，我们将看到来自 API 的 JSON 响应:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/cb027d1053231ebefe7060a1f51e3c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2YZ6bQRASj02c0x9giu2A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">当请求罗马斗兽场的位置数据时，来自 Google maps 的 JSON 响应。</p></figure><blockquote class="op oq or"><p id="0e06" class="kz la os lb b lc ld ju le lf lg jx lh ot lj lk ll ou ln lo lp ov lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">请求数据</em> </strong></p></blockquote><p id="bf50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过遍历列表并为每一项发送<strong class="lb iu"> GET </strong>请求来找到地址列表中每一项的坐标:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy oz l"/></div></figure><blockquote class="op oq or"><p id="d0ed" class="kz la os lb b lc ld ju le lf lg jx lh ot lj lk ll ou ln lo lp ov lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">结果</em> </strong></p></blockquote><p id="ca8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在收到我们的响应<code class="fe oi oj ok lw b">RES</code>后，我们使用<code class="fe oi oj ok lw b">json</code>方法将其转换成 Python 字典，允许我们访问纬度<code class="fe oi oj ok lw b">LAT</code>和经度<code class="fe oi oj ok lw b">LONG</code>的值。我们将坐标添加到<code class="fe oi oj ok lw b">COORDS</code>列表中——现在可以用来在地图上绘制位置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/9231a5d9dc8f6fecca516eb50cb6a678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3rVP4sGG6r9GZdX5Y4_cw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">该数据与我们新的<strong class="bd pb"> lat </strong>和<strong class="bd pb"> long coordinate </strong>列一致。</p></figure><p id="eede" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们不会涉及绘图代码，但如果这是你想做的事情，我会建议使用 Matplotlib 的<a class="ae ky" href="https://basemaptutorial.readthedocs.io/en/latest/first_map.html" rel="noopener ugc nofollow" target="_blank">底图扩展</a> —尽管现在可能有更好的工具可用(我很久以前就这样做了)。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h2 id="0d95" class="ma mb it bd mo nj nk dn ms nl nm dp mw li nn no my lm np nq na lq nr ns nc nt bi translated">与 GitHub 交互</h2><p id="0bfe" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">我们也可以使用 API 与 GitHub 交互。简单来说，我们将使用 POST 请求创建一个名为<code class="fe oi oj ok lw b">api_test</code>的新 repo。</p><blockquote class="op oq or"><p id="d6c7" class="kz la os lb b lc ld ju le lf lg jx lh ot lj lk ll ou ln lo lp ov lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">授权</em> </strong></p></blockquote><p id="b7cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，和往常一样，我们需要一个授权令牌。幸运的是，我们可以比使用 Google Maps API 更快地完成这个设置——你可以在这里找到一个分步指南。</p><p id="fc3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，在第七步中，选择哪些权限完全由您决定——但是我们需要的只是<code class="fe oi oj ok lw b">repo</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/c7a0f7fd27f627a79a701d387f694d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m0TAZJ5HAfta-LT0V4M79g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们只需要回购许可。我避免勾选<strong class="bd pb">delete _ repo</strong>——这似乎是个坏主意</p></figure><p id="85a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以通过在请求中添加<code class="fe oi oj ok lw b">headers={'Authorization': f'token {TOKEN}'}</code>来验证自己。</p><blockquote class="op oq or"><p id="0502" class="kz la os lb b lc ld ju le lf lg jx lh ot lj lk ll ou ln lo lp ov lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">创建一个回购</em> </strong></p></blockquote><p id="3e02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建 repo，我们只需向<code class="fe oi oj ok lw b"><a class="ae ky" href="https://api.github.com/" rel="noopener ugc nofollow" target="_blank">https://api.github.com/</a></code> <code class="fe oi oj ok lw b">user/repos</code>发送 POST 请求。这里唯一需要的字段是<code class="fe oi oj ok lw b">name</code>值，它指定了新的回购协议名称。我们还将<code class="fe oi oj ok lw b">public</code>设置为<code class="fe oi oj ok lw b">true</code>，这只是将回购隐私设置设置为 public——而不是 private(默认设置)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy oz l"/></div></figure><p id="1bd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们使用<code class="fe oi oj ok lw b">PAYLOAD</code>来包含我们对 API 的指令，我们将这些指令传递给<code class="fe oi oj ok lw b">requests.post</code>中的<code class="fe oi oj ok lw b">data</code>参数。我们还使用<code class="fe oi oj ok lw b">headers</code>参数包含了我们的授权密钥/令牌。</p><blockquote class="op oq or"><p id="8868" class="kz la os lb b lc ld ju le lf lg jx lh ot lj lk ll ou ln lo lp ov lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">结果</em> </strong></p></blockquote><p id="27d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们成功创建了 repo，我们将收到代码<code class="fe oi oj ok lw b"><strong class="lb iu">201 Created</strong></code>——表明请求已经成功，我们已经创建了一个新的资源。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/10e6b7e53877de6c8b9075b56ae5d1a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*epD99sqhwjePBcYZBwqGJg.png"/></div></div></figure><p id="e1fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以在 GitHub 上查看，果然<code class="fe oi oj ok lw b">api_test</code>回购就在那里:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/bb40323e705798dad21384e1c7bcbb2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y-uy0SwOncVBaxvhRrm2ZA.png"/></div></div></figure><p id="13a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GitHub API 非常酷，我们可以用它做很多事情，正因为如此，它非常适合学习——如果你想了解更多，我建议你看一下<a class="ae ky" href="https://developer.github.com/v3/" rel="noopener ugc nofollow" target="_blank">文档</a>(也可以随时问我问题！).</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="525e" class="mn mb it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">最终注释</h1><p id="115c" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">这就是开始使用 Python 中的 API 所需要知道的一切。当然，还有更多更相关的用例。</p><p id="b561" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对我自己来说，我现在几乎只在公司环境中使用 APIs 主要用于数据传输和操作，以及模型设置和培训。</p><p id="5717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从互联网上获取数据也是一项经常性的任务，因此，这是一项非常重要的技能。理解并实践 API 是非常有用的。</p><p id="cc18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望这篇文章有用。如果你有任何问题或建议，请告诉我，随时通过<a class="ae ky" href="https://twitter.com/jamescalam" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或在下面的评论中联系我。</p><p id="51ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="3ae6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有兴趣学习更多关于数据和 web 开发的知识吗？试试我最近写的这篇关于使用 Angular 部署 Python 构建的 TensorFlow 模型的文章:</p><div class="pf pg gp gr ph pi"><a rel="noopener follow" target="_blank" href="/how-to-use-angular-to-deploy-tensorflow-web-apps-5675b5a042cc"><div class="pj ab fo"><div class="pk ab pl cl cj pm"><h2 class="bd iu gy z fp pn fr fs po fu fw is bi translated">如何使用 Angular 部署 TensorFlow Web 应用程序</h2><div class="pp l"><h3 class="bd b gy z fp pn fr fs po fu fw dk translated">在角度构建的 web 应用程序中使用 Python 构建的模型</h3></div><div class="pq l"><p class="bd b dl z fp pn fr fs po fu fw dk translated">towardsdatascience.com</p></div></div><div class="pr l"><div class="ps l pt pu pv pr pw ks pi"/></div></div></a></div></div></div>    
</body>
</html>