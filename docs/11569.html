<html>
<head>
<title>Optimize your trading strategy with three lines of code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用三行代码优化你的交易策略</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/backtest-with-grid-search-using-only-3-lines-of-code-on-fastquant-551615fdaf69?source=collection_archive---------19-----------------------#2020-08-11">https://towardsdatascience.com/backtest-with-grid-search-using-only-3-lines-of-code-on-fastquant-551615fdaf69?source=collection_archive---------19-----------------------#2020-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cac4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 fastquant 自动轻松优化您的交易策略参数！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5d2fcbf1ef70d762217faa797db1fa78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9A7x1JgbBlK5JVERwtIpLw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">回溯测试的目标是了解空间中的哪些区域会产生更好的结果</p></figure><p id="f775" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想通过投资持续赚钱，回溯测试是评估交易策略有效性的最好方法之一——当然，前提是你要正确实施。这个想法是，你可以为你选择的策略试验不同的参数，看看哪个组合能给你的投资带来最好的回报。</p><blockquote class="lu"><p id="404e" class="lv lw it bd lx ly lz ma mb mc md lt dk translated">然而，这很容易变得乏味，因为您必须手动运行数百甚至数千个参数组合。</p></blockquote><p id="7791" class="pw-post-body-paragraph ky kz it la b lb me ju ld le mf jx lg lh mg lj lk ll mh ln lo lp mi lr ls lt im bi translated">为了解决这个问题，我们可以使用<a class="ae mj" href="https://github.com/enzoampil/fastquant" rel="noopener ugc nofollow" target="_blank"> fastquant </a>来实现一种称为“网格搜索”的技术，它基本上允许您对您想要为您的策略运行的每个参数组合运行回溯测试。</p><p id="9399" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文的其余部分，我将演示如何在回溯测试您的交易策略时应用自动网格搜索。</p><p id="4126" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mk">注意:如果你还不熟悉如何用 fastquant 做基本的回溯测试，你可能想看看我以前的</em> <a class="ae mj" rel="noopener" target="_blank" href="/backtest-your-trading-strategy-with-only-3-lines-of-python-3859b4a4ab44?source=friends_link&amp;sk=ec647b6bb43fe322013248fd1d473015"> <em class="mk">文章</em> </a> <em class="mk">中关于如何用 3 行代码做这件事。</em></p><p id="21f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">顺便说一句，如果你对执行这种类型的分析感兴趣，甚至不需要编码，请注册<a class="ae mj" href="https://hawksight.co/" rel="noopener ugc nofollow" target="_blank">我正在构建的这个新工具</a>以使高级投资分析更容易使用！</p><p id="1af5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好的，让我们从通过 pip 安装 fastquant 开始。</p><pre class="kj kk kl km gt ml mm mn mo aw mp bi"><span id="cdb5" class="mq mr it mm b gy ms mt l mu mv"># Run this on your terminal<br/>pip install fastquant<br/><br/># Alternatively, you can run this from jupyter this way<br/>!pip install fastquant</span></pre><p id="9fcd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，让我们使用 Jollibee Food corp .(JFC)2018 年 1 月 1 日至 2019 年 12 月 31 日的股票作为我们的样本数据。</p><p id="b746" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mk">注:</em> <code class="fe mw mx my mm b"><em class="mk">get_stock_data</em></code> <em class="mk">支持从</em> <a class="ae mj" href="https://finance.yahoo.com/" rel="noopener ugc nofollow" target="_blank"> <em class="mk">雅虎财经</em> </a> <em class="mk">和 PSE 访问的所有公司。</em></p><pre class="kj kk kl km gt ml mm mn mo aw mp bi"><span id="2340" class="mq mr it mm b gy ms mt l mu mv">from fastquant import get_stock_data<br/>df = get_stock_data("JFC", "2018-01-01", "2019-12-31")<br/>df.head()</span><span id="c718" class="mq mr it mm b gy mz mt l mu mv">#         dt  close<br/># 2018-01-03  255.4<br/># 2018-01-04  255.0<br/># 2018-01-05  255.0<br/># 2018-01-08  256.0<br/># 2018-01-09  255.8</span></pre><p id="1ec4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设你想在 JFC 股票上用 15 天的快速周期和 40 天的慢速周期来回溯测试一个简单的移动平均交叉(SMAC)策略。</p><pre class="kj kk kl km gt ml mm mn mo aw mp bi"><span id="7083" class="mq mr it mm b gy ms mt l mu mv">from fastquant import backtest<br/>backtest("smac", df, fast_period=15, slow_period=40)</span><span id="d8a4" class="mq mr it mm b gy mz mt l mu mv"># Starting Portfolio Value: 100000.00<br/># Final Portfolio Value: 68742.36</span></pre><p id="dc29" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你会注意到，你的最终投资组合价值下降了很多(~31%)，通过查看下面的图表，你会发现这是因为当股票处于整体下降趋势时，该策略仍在推荐交易(绿色和红色箭头)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/1ccff8c5cd1a28c754c2bdf3d6f81066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zcZqgpIB1y8BX_PM-azGYA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">即使股票整体下跌，你也会看到交易发生(绿色和红色箭头)</p></figure><p id="f8c4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以现在，我们想看看是否有一个“慢速期”和“快速期”的组合会导致 SMAC 策略知道不要在整体下降趋势中交易。</p><p id="ca34" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一种方法是尝试大量可能的快速周期和慢速周期组合。在这个例子中，我们将慢速周期设置为取 20 到 241 范围内的值(每隔 5 秒跳过一次)，而快速周期可以取 1 到 20 范围内的值。</p><p id="bc3b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这意味着快速周期可以取 20 个可能值，而慢速周期可以取 45 个可能值。总的来说，这意味着 900 (20 x 45)种可能的组合！想象一下这样一个一个做对。</p><p id="c184" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">幸运的是，我们可以通过使用迭代器(例如<code class="fe mw mx my mm b">list</code>、<code class="fe mw mx my mm b">range</code>)而不是单个数字作为输入，使用 fastquant 的内置网格搜索功能来轻松实现这一点。</p><pre class="kj kk kl km gt ml mm mn mo aw mp bi"><span id="7a59" class="mq mr it mm b gy ms mt l mu mv">results = backtest("smac", df, fast_period=range(1, 21), slow_period=range(20, 241, 5))<br/>results[["fast_period", "slow_period", "final_value"]].head()</span><span id="93da" class="mq mr it mm b gy mz mt l mu mv"># fast_period slow_period final_value<br/>#0          3         105   107042.02<br/>#1          8         205   103774.66<br/>#2         11         170   103774.66<br/>#3          8         200   103774.66<br/>#4          9          95   103388.12</span></pre><p id="941e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意“backtest”返回一个 pandas data frame(“results”)，其中包含每行上每次迭代的结果。数据帧的每一列对应于所使用的一个参数(如<code class="fe mw mx my mm b">fast_period</code>)或策略的一个性能指标(如<code class="fe mw mx my mm b">final_value</code>)。</p><p id="3e46" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">方便的是，这些行根据每次迭代的投资组合回报按降序排列，因此“最佳”参数组合是在数据框顶部的那些。</p><p id="6831" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，似乎最上面的参数组合是:fast_period=3，slow_period=105，投资组合收益为 7，042.02。这表明，当我们在 JFC 股票上使用 SMAC 策略时，我们可能要使用这个参数组合。</p><p id="1da5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mk">注意:很有可能该参数组合仍然过度适合所选的周期。参见之前</em> <a class="ae mj" rel="noopener" target="_blank" href="/backtest-your-trading-strategy-with-only-3-lines-of-python-3859b4a4ab44?source=friends_link&amp;sk=ec647b6bb43fe322013248fd1d473015"> <em class="mk">文章</em> </a> <em class="mk">中回测的注意事项和保障措施。</em></p><p id="d2ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们运行我们的最优策略！</p><pre class="kj kk kl km gt ml mm mn mo aw mp bi"><span id="4738" class="mq mr it mm b gy ms mt l mu mv">from fastquant import backtest<br/>backtest("smac", df, fast_period=3, slow_period=105)</span><span id="372f" class="mq mr it mm b gy mz mt l mu mv"># Starting Portfolio Value: 100000.00<br/># Final Portfolio Value: 107042.02</span></pre><p id="401d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如下图所示，上面的参数组合会建议我们在整体下跌趋势之前卖出我们的股票——看到下跌之前的红色向下箭头。这解释了它如何能够避免我们在本文开始时看到的在我们最初实施 SMAC 战略时的损失。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/23a2497219a8e973c982d070a38da16a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3sjEZTgQEkkCm6TNMqd0Zw.png"/></div></div></figure><p id="a0d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有了结果数据框架，您甚至可以用如下热图来直观显示每个参数组合的有效性！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5d2fcbf1ef70d762217faa797db1fa78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9A7x1JgbBlK5JVERwtIpLw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">查看本<a class="ae mj" href="https://enzoampil.github.io/fastquant-blog/grid%20search/backtest/2020/04/20/backtest_with_grid_search.html" rel="noopener ugc nofollow" target="_blank">技术教程</a>以了解如何绘制该热图</p></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><p id="dd21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">恭喜你！现在，您应该熟悉如何使用 fastquant 内置的网格搜索功能自动优化您的交易策略。下次您发现自己手动插入参数组合到<code class="fe mw mx my mm b">backtest</code>时，请考虑使用这种自动化方法！</p><p id="e63a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">同样重要的是要注意，这是一个改编自<a class="ae mj" href="https://github.com/mementum/backtrader" rel="noopener ugc nofollow" target="_blank"> backtrader </a>包的功能，fastquant 就是建立在这个包之上的。不同之处在于<a class="ae mj" href="https://github.com/enzoampil/fastquant" rel="noopener ugc nofollow" target="_blank"> fastquant </a>允许您用更少的代码行(少至 3 行)来完成这项工作，这样您就可以花更多的时间来测试您的假设，而不是设置代码。</p><p id="3823" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要查看以上示例的更详细版本和完整代码，包括没有“内置网格搜索”时的代码演示，请查看 Jerome de Leon 的技术教程。</p><p id="ae95" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你对这份材料有任何问题，请随时在下面发表评论，或者在<a class="ae mj" href="https://twitter.com/AND__SO" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae mj" href="https://www.linkedin.com/in/lorenzoampil/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上给我发消息。</p><p id="09ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，如果你想对这个软件包有所贡献，或者想了解更多关于其他人如何使用 fastquant 的信息，请加入我们的社区<a class="ae mj" href="https://join.slack.com/t/fastquant/shared_invite/zt-gaaoahkz-X~5qw0psNOLg1iFYKcpRlQ" rel="noopener ugc nofollow" target="_blank"> Slack workspace </a>，在这里我们每两周与其他 quant 成员会面一次！</p><h1 id="7953" class="ni mr it bd nj nk nl nm nn no np nq nr jz ns ka nt kc nu kd nv kf nw kg nx ny bi translated">想完全不用编码就做到这一点？</h1><p id="c41e" class="pw-post-body-paragraph ky kz it la b lb nz ju ld le oa jx lg lh ob lj lk ll oc ln lo lp od lr ls lt im bi translated">如果你想让这种分析变得更加简单，而根本不需要编码(或者想避免做所有必需的设置的痛苦)，你可以订阅这个<a class="ae mj" href="https://hawksight.co/" rel="noopener ugc nofollow" target="_blank">我正在构建的新的无代码工具</a>来使数据驱动的投资大众化。</p><p id="208e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">希望让更多的人能够接触到这些强大的分析！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="33d3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="mk">注来自《走向数据科学》的编辑:</em> </strong> <em class="mk">虽然我们允许独立作者根据我们的</em> <a class="ae mj" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="mk">规则和指导方针</em> </a> <em class="mk">发表文章，但我们不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae mj" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="mk">读者术语</em> </a> <em class="mk">。</em></p></div></div>    
</body>
</html>