<html>
<head>
<title>Building A Real-time Dashboard Using Python Plotly Library And Web Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python Plotly库和Web服务构建实时仪表板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-real-time-dashboard-using-python-plotly-library-and-web-service-145f50d204f0?source=collection_archive---------1-----------------------#2020-05-02">https://towardsdatascience.com/building-a-real-time-dashboard-using-python-plotly-library-and-web-service-145f50d204f0?source=collection_archive---------1-----------------------#2020-05-02</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="7a45" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/data-for-change" rel="noopener" target="_blank">变更数据</a></h2><div class=""/><figure class="gm go kb kc kd ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj ka"><img src="../Images/1d2cb8c53f8b21debf72e928cdad1843.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-iADds-1lCncd92GIIyhA.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">由<a class="ae kp" href="https://unsplash.com/@lukechesser?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卢克·切瑟</a>在<a class="ae kp" href="https://unsplash.com/s/photos/dashboard?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="14a7" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated"><strong class="ks je"> <em class="lo">编者按:</em> </strong> <em class="lo"> </em> <a class="ae kp" href="http://towardsdatascience.com/" rel="noopener" target="_blank"> <em class="lo">走向数据科学</em> </a> <em class="lo">是一份以数据科学和机器学习研究为主的中型刊物。我们不是健康专家或流行病学家，本文的观点不应被解释为专业建议。想了解更多关于疫情冠状病毒的信息，可以点击</em> <a class="ae kp" href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports" rel="noopener ugc nofollow" target="_blank"> <em class="lo">这里</em> </a> <em class="lo">。</em></p></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><p id="e419" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">仪表板是一个图形界面，提供与特定现象或业务相关的一些关键指标的综合视图。在这篇文章中，我将一步一步地展示我们如何使用<strong class="ks je"> Python Plotly支线剧情</strong>构建一个仪表板来实时执行新冠肺炎病例的每日报告。我们的目标是制作一个实时仪表板，如下所示:</p><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj lw"><img src="../Images/f60ff1e57dcef32b1cdb6d3f08a43f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cG9Z8QkXoTLKrVxU0brE1A.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">显示全球新冠肺炎数据的仪表板</p></figure><p id="a18a" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">仪表盘的实时版本可从以下网址获得</p><p id="6823" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated"><a class="ae kp" href="https://covid-19-data-visualizer.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ks je">https://covid-19-data-visualizer.herokuapp.com/</strong></a></p><p id="96b4" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated"><em class="lo">您在访问实时仪表盘时可能会遇到一些延迟，因为它是使用免费的Heroku帐户部署的，处理资源有限。</em></p></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h1 id="141e" class="mb mc iu bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">数据源和web服务</h1><p id="2209" class="pw-post-body-paragraph kq kr iu ks b kt mz kv kw kx na kz la lb nb ld le lf nc lh li lj nd ll lm ln in bi translated">因为我们将基于实时数据构建一个仪表板，所以数据源来自web服务，而不是静态的CSV或文本文件。简而言之，web服务是一个在线数据库，我们可以通过它联系并请求一些想要的信息，然后将它们获取到我们的应用程序中。</p><p id="9774" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">在本教程中，我们将使用从Esri   <strong class="ks je"> </strong>提供的 <a class="ae kp" href="https://coronavirus-resources.esri.com/datasets/bbb2e4f589ba40d692fab712ae37b9ac_1/geoservice?geometry=34.182%2C-38.069%2C-16.794%2C63.033&amp;orderBy=Country_Region&amp;selectedAttribute=Confirmed&amp;where=Last_Update%20%3E%3D%20TIMESTAMP%20%272020-02-23%2000%3A00%3A00%27%20AND%20Last_Update%20%3C%3D%20TIMESTAMP%20%272020-04-25%2023%3A59%3A59%27" rel="noopener ugc nofollow" target="_blank"> <strong class="ks je"> Web服务中获得的<strong class="ks je">新冠肺炎数据来构建我们的仪表板。来自该网络服务的新冠肺炎数据每天更新。</strong></strong></a></p></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h1 id="354f" class="mb mc iu bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">先决条件Python库</h1><ul class=""><li id="fbb6" class="ne nf iu ks b kt mz kx na lb ng lf nh lj ni ln nj nk nl nm bi translated">阴谋地—<a class="ae kp" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank">https://plotly.com/python/</a></li><li id="3e2e" class="ne nf iu ks b kt nn kx no lb np lf nq lj nr ln nj nk nl nm bi translated">熊猫—<a class="ae kp" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">https://pandas.pydata.org/</a></li><li id="c3ec" class="ne nf iu ks b kt nn kx no lb np lf nq lj nr ln nj nk nl nm bi translated">请求—<a class="ae kp" href="https://pypi.org/project/requests/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/requests/</a></li></ul></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h1 id="1eba" class="mb mc iu bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">从Github下载源代码</h1><p id="97fb" class="pw-post-body-paragraph kq kr iu ks b kt mz kv kw kx na kz la lb nb ld le lf nc lh li lj nd ll lm ln in bi translated">为了让你更轻松地学习本教程，你可以从我的<a class="ae kp" href="https://github.com/teobeeguan/COVID-19-Visualization-Project" rel="noopener ugc nofollow" target="_blank"> Github库</a>获得完整的源代码(<strong class="ks je">新冠肺炎_仪表板. ipynb </strong>)。</p><p id="a4a9" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">您可以使用我的源代码作为参考来理解构建仪表板的过程，我将在下面的部分中介绍这个过程。</p></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h1 id="e3c3" class="mb mc iu bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">构建新冠肺炎控制板的步骤</h1><h2 id="6628" class="ns mc iu bd md nt nu dn mh nv nw dp ml lb nx ny mp lf nz oa mt lj ob oc mx ja bi translated"><strong class="ak">第1部分:</strong>设置Python库</h2><p id="a3da" class="pw-post-body-paragraph kq kr iu ks b kt mz kv kw kx na kz la lb nb ld le lf nc lh li lj nd ll lm ln in bi translated">我们通过导入本教程所需的所有必要库来开始我们的Python脚本。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">用于导入库的Python代码</p></figure><h2 id="86b0" class="ns mc iu bd md nt nu dn mh nv nw dp ml lb nx ny mp lf nz oa mt lj ob oc mx ja bi translated">第2部分:从web服务请求数据</h2><p id="1b3a" class="pw-post-body-paragraph kq kr iu ks b kt mz kv kw kx na kz la lb nb ld le lf nc lh li lj nd ll lm ln in bi translated">接下来，我们访问<a class="ae kp" href="https://coronavirus-resources.esri.com/datasets/bbb2e4f589ba40d692fab712ae37b9ac_1/geoservice?geometry=34.182%2C-38.069%2C-16.794%2C63.033&amp;orderBy=Country_Region&amp;selectedAttribute=Confirmed&amp;where=Last_Update%20%3E%3D%20TIMESTAMP%20%272020-02-23%2000%3A00%3A00%27%20AND%20Last_Update%20%3C%3D%20TIMESTAMP%20%272020-04-25%2023%3A59%3A59%27" rel="noopener ugc nofollow" target="_blank"> <strong class="ks je"> esri网站</strong> </a>以获取一个查询URL，并将该URL复制并粘贴到我们脚本中的Python <em class="lo"> request </em>模块，以向web服务发送HTTP请求(第1行)。HTTP请求将以JSON格式从web服务向我们的应用程序返回最新的新冠肺炎数据(第2行)。我们从"<em class="lo"> features </em>"属性中选择数据，并使用它来构建一个<em class="lo"> Pandas </em> <em class="lo"> dataframe，df </em>(第3行)。</p><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj of"><img src="../Images/60b9e41b2a28b38efba9fb0e1e8752fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jw7tmkFH7ByBqannRN5OPw.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">esri Web服务网站</p></figure><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">请求web服务的Python代码</p></figure><p id="2e23" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">我们可以使用<em class="lo">熊猫头</em>方法预览返回的新冠肺炎数据的前五条记录。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">预览数据的Python代码</p></figure><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj og"><img src="../Images/3daae74d4e1b03e2d77ec962b7fa6de0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vr6tP46qoFoZ6urOoF084A.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">web服务数据预览</p></figure><p id="a456" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">要更详细地查看属性值，我们只需选择其中一项。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">查看属性的Python代码</p></figure><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div class="gi gj oh"><img src="../Images/1372eebaa39438d6c1b941750a676f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*5S0S88zrgNqTDfzVYeRL8g.jpeg"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">单个记录的属性</p></figure><p id="cada" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">从预览中，我们可以看到新冠肺炎记录由一个字典列表组成，其中包括地理属性(如<em class="lo">省_州、国家_地区、纬度、经度_ </em>)和数字属性(如<em class="lo">确诊、痊愈、死亡</em>)。此外，它还包括一个时间戳属性(<em class="lo"> Last_Update </em>)。</p></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h2 id="a93d" class="ns mc iu bd md nt nu dn mh nv nw dp ml lb nx ny mp lf nz oa mt lj ob oc mx ja bi translated">第3部分:转换数据</h2><p id="69bf" class="pw-post-body-paragraph kq kr iu ks b kt mz kv kw kx na kz la lb nb ld le lf nc lh li lj nd ll lm ln in bi translated">从上一部分中，我们了解到新冠肺炎记录的结构是一个字典列表，在这里我们试图将它们转换成一个新的<em class="lo"> Pandas数据帧，df_final </em>。为此，我们首先使用<em class="lo"> tolist </em>方法将字典转换成一个<em class="lo">列表，data_list </em>(第1行)。接下来使用<em class="lo"> data_list </em>构建一个新的数据帧<em class="lo"> df_final </em>(第2行)。接下来，我们使用<em class="lo"> set_index </em>方法将“OBJECTID”属性设置为每条记录的索引(第3行)。最后，重新排序<em class="lo"> df_final </em>数据框中的列(第4行)并预览转换后的记录(第5行)。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">转换数据的Python代码</p></figure><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj oi"><img src="../Images/af3f1d5c95702b0318b44158a601a47c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cfzKNUp_NV8__g3Byq3Lfg.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">转换数据帧</p></figure></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h2 id="ca00" class="ns mc iu bd md nt nu dn mh nv nw dp ml lb nx ny mp lf nz oa mt lj ob oc mx ja bi translated">第4部分:清理数据</h2><p id="4aaf" class="pw-post-body-paragraph kq kr iu ks b kt mz kv kw kx na kz la lb nb ld le lf nc lh li lj nd ll lm ln in bi translated">显然，转换后的数据看起来不错，但这里仍然存在两个问题:</p><ol class=""><li id="7e05" class="ne nf iu ks b kt ku kx ky lb oj lf ok lj ol ln om nk nl nm bi translated">在“<em class="lo">最后_更新</em>”和“<em class="lo">省_州</em>”列中有一些值<em class="lo"> na </em>丢失。</li><li id="d9e9" class="ne nf iu ks b kt nn kx no lb np lf nq lj nr ln om nk nl nm bi translated">“<em class="lo"> Last_Update </em>”列中的值是一个以毫秒为单位的时间戳，它对日期没有太多意义。</li></ol><p id="8892" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">要处理第一个问题，我们可以使用<em class="lo"> dropna </em>方法从列"<em class="lo"> Last_Update </em>"中删除缺失的值(第5行)，使用<em class="lo"> fillna </em>方法用一个空字符串替换列"<em class="lo"> Province_State </em>"中所有缺失的值(第6行)。</p><p id="8d6d" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">为了解决第二个问题，我们编写了一个函数<em class="lo"> convertTime </em>，使用<em class="lo"> fromtimestamp </em>方法(第1–3行)<em class="lo">，将时间戳转换为格式为"<em class="lo"> yyyy-mm-dd-hh-mm-ss" </em>的日期。</em>列“Last_Update”首先除以1000(第8行)，然后对整个列应用<em class="lo"> convertTime </em>函数(第9行)。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">清理数据的Python代码</p></figure><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj on"><img src="../Images/c91a5acc1bf69565fa0f50465f41c8fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C7RCdCGUnVzM7ZCDWVy2JQ.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">清理数据框</p></figure></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h2 id="a548" class="ns mc iu bd md nt nu dn mh nv nw dp ml lb nx ny mp lf nz oa mt lj ob oc mx ja bi translated">第5部分:聚合数据</h2><p id="624d" class="pw-post-body-paragraph kq kr iu ks b kt mz kv kw kx na kz la lb nb ld le lf nc lh li lj nd ll lm ln in bi translated">目前，记录中确诊、康复和死亡病例的累计总数是以省为基础的，而不是以国家为基础的。构建这个仪表板的目的之一是显示排名前10位的国家列表。因此，我们需要对“<em class="lo">确诊</em>”、“<em class="lo">死亡</em>”和“<em class="lo">恢复</em>”列进行求和，并将求和值按“<em class="lo">国家/地区</em>分组，从而执行数据聚合。聚集的数据被分配给新的数据帧<em class="lo"> df_total </em>。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">聚合数据的Python代码</p></figure><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div class="gi gj oo"><img src="../Images/760fd5753499168f8bdd29aedff6a90f.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*Zk1g0XM4YNTW7K2itAWlng.jpeg"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">汇总数据</p></figure></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h2 id="bdf3" class="ns mc iu bd md nt nu dn mh nv nw dp ml lb nx ny mp lf nz oa mt lj ob oc mx ja bi translated">第6部分:计算每日新冠肺炎病例总数</h2><p id="bf0a" class="pw-post-body-paragraph kq kr iu ks b kt mz kv kw kx na kz la lb nb ld le lf nc lh li lj nd ll lm ln in bi translated">在此阶段，我们准备使用前面部分的转换和汇总数据来计算两个级别的新冠肺炎病例总数:</p><ul class=""><li id="d130" class="ne nf iu ks b kt ku kx ky lb oj lf ok lj ol ln nj nk nl nm bi translated">全球一级</li><li id="688a" class="ne nf iu ks b kt nn kx no lb np lf nq lj nr ln nj nk nl nm bi translated">十大国家级别</li></ul><p id="0edd" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated"><strong class="ks je">第一步:全局级</strong></p><p id="de4e" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">全球每日新冠肺炎病例总数的计算非常简单。我们只是将<em class="lo">求和</em>的方法应用到<em class="lo"> df_final </em>的“<em class="lo">确诊</em>”、<em class="lo">痊愈</em>、<em class="lo">死亡</em>列。<em class="lo"> sum </em>方法将合计三列中每一列的所有值，并将最终总和分配给它们各自的变量<em class="lo"> total_confirmed </em>、<em class="lo"> total_recovered </em>和<em class="lo"> total_deaths </em>。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">用于计算全球范围内每日新冠肺炎病例总数的Python代码</p></figure><p id="683a" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated"><strong class="ks je">第二步:十大国家级别</strong></p><p id="d14e" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">Pandas提供了一种简便的方法，即<em class="lo"> nlargest </em>，它使我们能够在数据帧的特定列中选择前十个值。为了选择确诊病例最多的前10个国家，我们向<em class="lo"> nlargest </em>方法(第1行)传递一个n最大值和一个列名，并将返回的数据帧分配给一个新变量<em class="lo"> df_top10 </em>。接下来，我们生成国家名称列表(第2行)和确诊病例总数列表(第3行)，并将它们分别分配给两个新变量，<em class="lo"> top10_countries_1 </em>和<em class="lo"> top10_confirmed，</em>。</p><p id="d68f" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">接下来，重复上面类似的步骤，以获得已康复(第5-7行)和死亡病例(第9-11行)的前十个国家数据。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">Python代码获取前10个国家和确诊、恢复和死亡病例数</p></figure></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h2 id="3596" class="ns mc iu bd md nt nu dn mh nv nw dp ml lb nx ny mp lf nz oa mt lj ob oc mx ja bi translated">第7部分:使用Python Plotly子情节构建仪表板</h2><p id="0a13" class="pw-post-body-paragraph kq kr iu ks b kt mz kv kw kx na kz la lb nb ld le lf nc lh li lj nd ll lm ln in bi translated">仪表板应显示以下信息:</p><ol class=""><li id="c764" class="ne nf iu ks b kt ku kx ky lb oj lf ok lj ol ln om nk nl nm bi translated">世界各地每日确诊、恢复和死亡病例总数</li><li id="36ed" class="ne nf iu ks b kt nn kx no lb np lf nq lj nr ln om nk nl nm bi translated">全球每个国家的确诊、痊愈和死亡病例总数。</li><li id="5dc7" class="ne nf iu ks b kt nn kx no lb np lf nq lj nr ln om nk nl nm bi translated">确诊、康复和死亡病例数最高的前十个国家。</li></ol><p id="0531" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">我们将使用<em class="lo"> Python Plotly支线剧情</em>创建几个支线剧情(每个信息部分一个)并将它们加入到一个单一的仪表板中。</p><p id="e417" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated"><strong class="ks je">第一步:初始化支线剧情布局</strong></p><p id="21d9" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">Python Plotly库提供了一个<em class="lo"> make_subplots </em>函数，使我们能够初始化subplots的布局安排。我们可以设置行数和列数来定位仪表板中的每个子情节。</p><p id="23f7" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">在这种情况下，我们在支线剧情布局中定义了4行6列。我们出发了</p><p id="5b8c" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">第1行第1列:</p><ul class=""><li id="8ee5" class="ne nf iu ks b kt ku kx ky lb oj lf ok lj ol ln nj nk nl nm bi translated"><em class="lo">散点图</em>——在地图上显示每个国家的确诊、痊愈和死亡病例总数</li></ul><p id="6ff5" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">第1行第4–6列:</p><ul class=""><li id="c88e" class="ne nf iu ks b kt ku kx ky lb oj lf ok lj ol ln nj nk nl nm bi translated"><em class="lo">指示图</em>——显示全球每日确诊、痊愈和死亡病例总数</li></ul><p id="579b" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">第2行第4列:</p><ul class=""><li id="54cf" class="ne nf iu ks b kt ku kx ky lb oj lf ok lj ol ln nj nk nl nm bi translated"><em class="lo">条形图</em> —显示确诊病例最多的前10个国家</li></ul><p id="e0e8" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">第3行第4列:</p><ul class=""><li id="13ae" class="ne nf iu ks b kt ku kx ky lb oj lf ok lj ol ln nj nk nl nm bi translated"><em class="lo">条形图</em> —显示恢复案例数量最多的前10个国家</li></ul><p id="c18e" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">第4行第4列:</p><ul class=""><li id="f147" class="ne nf iu ks b kt ku kx ky lb oj lf ok lj ol ln nj nk nl nm bi translated"><em class="lo">条形图</em> —显示死亡病例最多的前10个国家</li></ul><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">初始化子情节布局的Python代码</p></figure><p id="0dde" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated"><strong class="ks je">步骤2:创建注释文本</strong></p><p id="6f6d" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">在为<em class="lo">散点图</em>生成子图之前(将在下一步中呈现)，我们需要定义一个注释文本。每当用户将鼠标悬停在地图上的某个国家上方时，就会显示注释文本。注释文本应显示国家名称、确诊病例、死亡病例和恢复病例以及最后更新日期。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">创建注释文本的Python代码</p></figure><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div class="gi gj op"><img src="../Images/519462914094645fa71349e255879a09.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*OcnhQqz4kC0zXUaeaNPcmQ.jpeg"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">地图上的注释文本</p></figure><p id="7423" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated"><strong class="ks je">第三步:创建子剧情——散点图</strong></p><p id="9eca" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">为了创建一个散点地图，我们可以使用Python Plotly <em class="lo"> go。散点图对象</em>。我们从先前生成的dataframe、<em class="lo"> df_final </em>到<em class="lo"> lon </em>和<em class="lo"> lat </em>属性(第4–5行)中设置“<em class="lo"> Long_ </em>和“<em class="lo"> Lat </em>”数据。接下来，我们将注释文本<em class="lo"> df_final["text"] </em>设置为<em class="lo"> hovertext </em>属性。每当用户将鼠标悬停在某个国家/地区上方时，这将使预定义的注释文本(来自步骤2)显示在地图上。</p><p id="8c3c" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">接下来，我们继续设置标记的参数值，如大小、不透明度、符号、颜色等(第8–23行)。我希望在这里强调的参数是“<em class="lo">颜色</em>”属性。我们将确诊病例的数据序列<em class="lo"> df_final['Confirmed'] </em>设置为“color”属性(第19行)。<em class="lo">出发。散点图对象</em>将根据每个国家的确诊病例水平为地图上显示的标记(方框)生成色标。</p><p id="33d1" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">最后，我们将散点图的这个子图放置在第1行第1列(第27行)。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">创建散点图的Python代码</p></figure><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div class="gi gj oq"><img src="../Images/9de02389a46864e68194e6ee1d25da90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*bWhHIJxFa5sFLwOPJB7yAg.jpeg"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">散点图</p></figure><p id="9f35" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated"><strong class="ks je">第四步:创建子剧情—指示器</strong></p><p id="feb2" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">我们使用<em class="lo"> Plotly go创建了三个指标，显示全球每日确诊、痊愈和死亡病例总数。指示器对象</em>。我们将<em class="lo"> total_confirmed、</em>设置为value property(第4行)，将标题设置为“<em class="lo"> Confirmed Caes </em>”(第5行)<em class="lo">。</em>这将生成一个标题为“<em class="lo">确诊病例</em>的指示器，确诊病例总数将显示在标题下方。最后，我们将指示器的这个子图放置在第1行第4列(第7行)。</p><p id="3d58" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">我们重复上述类似步骤，为恢复病例和死亡病例创建指标，并将它们放置到适当的行和列编号(第10–26行)。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">Python代码生成三个指标</p></figure><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div class="gi gj or"><img src="../Images/d60907518c8472a013b0bfe362904f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*ULwSvYmC3kEzrbdAgDGC5g.jpeg"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">显示确诊、康复和死亡病例的三个指标</p></figure><p id="af97" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated"><strong class="ks je">第五步:创建支线剧情——条形图</strong></p><p id="0a8a" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">在这一阶段，我们将着手创建三个条形图，以显示确诊、恢复和死亡病例数最高的前十个国家。我们使用<em class="lo"> Plotly go.bar对象</em>创建相关的条形图。</p><p id="f210" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">为了创建确诊病例的条形图，我们将前10个国家列表和前10个数字列表(来自第6部分步骤2)分别设置为x轴和y轴属性(第3–4行)。最后，我们将条形图定位到适当的行和列编号(第9行)。</p><p id="1f55" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">我们重复类似的步骤来制作条形图，根据康复和死亡病例的数量显示前10个国家，并将它们放置到适当的行号和列号(第10-26行)。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">Python代码创建条形图来显示排名前十的国家</p></figure><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj os"><img src="../Images/2921d6c96123dd703ac51819bdb7016e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*Cj3jW-hqGPbfcfoO4o94vw.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">确诊、康复和死亡病例最多的前十个国家</p></figure><p id="b2d7" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated"><strong class="ks je">步骤6:完成布局设置</strong></p><p id="f431" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">这是最后一步，我们将完成支线剧情的布局设置:</p><ul class=""><li id="9500" class="ne nf iu ks b kt ku kx ky lb oj lf ok lj ol ln nj nk nl nm bi translated">模板(第2行)-为仪表板设置深色主题。</li><li id="db6d" class="ne nf iu ks b kt nn kx no lb np lf nq lj nr ln nj nk nl nm bi translated">标题(第3行)-为仪表板设置标题，并将上次更新的内容附加到标题中。</li><li id="fe69" class="ne nf iu ks b kt nn kx no lb np lf nq lj nr ln nj nk nl nm bi translated">图例<strong class="ks je"> </strong>(第4–6行)<strong class="ks je"> </strong> —将图例设置为可见，并将其设置为水平方向。定义坐标x和y以显示图例。</li><li id="de49" class="ne nf iu ks b kt nn kx no lb np lf nq lj nr ln nj nk nl nm bi translated">geo(第7–14行)-将显示的地图设置为正交地球，并在地图上显示海岸线、陆地和海洋。</li><li id="c9f3" class="ne nf iu ks b kt nn kx no lb np lf nq lj nr ln nj nk nl nm bi translated">注释(第16–24行)-在操控板上设置附加注释文本，以在特定坐标x和y处显示数据源链接</li></ul><p id="f375" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">最后，我们准备呈现我们的仪表板(第27行)。</p><figure class="lx ly lz ma gu ke"><div class="bz fq l di"><div class="od oe l"/></div><p class="kl km gk gi gj kn ko bd b be z dk translated">最终确定仪表板布局的Python代码</p></figure><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj lw"><img src="../Images/f60ff1e57dcef32b1cdb6d3f08a43f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cG9Z8QkXoTLKrVxU0brE1A.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">新冠肺炎仪表板</p></figure></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h1 id="c5aa" class="mb mc iu bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">第8部分:仪表板导航</h1><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj ot"><img src="../Images/18c09c18888f278a93e6db0055e7fe60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UGc_0yi09doA3qfB4EtA3w.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">带标签的新冠肺炎仪表板</p></figure><p id="ca61" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">乍看之下，我们可以通过仪表板右上角的三个数字指示器轻松查看每日确诊、康复和死亡病例总数。</p><p id="66f5" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">在这三个数字指标下面，有三个条形图显示了确诊、恢复和死亡病例数最高的前十个国家。</p><p id="9d7b" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">要查看单个国家/地区的新冠肺炎数据，我们只需将鼠标放在地图上的一个标记(正方形)上，就会出现一个注释文本，显示该国家/地区报告的确诊、康复和死亡病例数。</p><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj ou"><img src="../Images/75637b032e9c02ef32769a24b892f9ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*brgCfkjMCTgKM3ks6aolGg.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">显示所选国家/地区的新冠肺炎详细信息的注释文本</p></figure><p id="787d" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">我们可以使用平移工具旋转正交地图。只需点击仪表盘右上角的平移工具，然后点击地图并向左或向右拖动即可。</p><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj ov"><img src="../Images/b2921a2aae12243ee20db9b8b100981f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XrCmtnvBETLUZmTWUqXNPg.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">点击平移工具</p></figure><figure class="lx ly lz ma gu ke gi gj paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gi gj ow"><img src="../Images/9f6d842b5a06b4302a2dccc483538fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O4H8fWNzqzd9ZotjDryk4A.jpeg"/></div></div><p class="kl km gk gi gj kn ko bd b be z dk translated">旋转地图</p></figure></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h1 id="bee0" class="mb mc iu bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">最后的想法</h1><p id="e30f" class="pw-post-body-paragraph kq kr iu ks b kt mz kv kw kx na kz la lb nb ld le lf nc lh li lj nd ll lm ln in bi translated">仪表板只是由几个支线剧情组成的可视图形，我们可以一部分一部分地构建它们。一旦我们熟悉了Python Plotly库来创建单独的图，我们就可以使用Plotly Subplots特性轻松地将它们集成到仪表板中。</p><p id="3716" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">让我们的仪表板变得实时的关键是不断地使用来自web服务的最新数据，并更新仪表板上的数据。这可以使用Python <em class="lo">请求</em>模块轻松完成。在我们的例子中，我们可以每天重新启动我们的仪表板，运行在后端的<em class="lo">请求</em>模块将从web服务请求最新的信息，并在仪表板上显示最新的新冠肺炎数据。</p><p id="62e9" class="pw-post-body-paragraph kq kr iu ks b kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln in bi translated">我希望您能从本教程中受益，并应用这里介绍的过程为您关心的数据创建其他仪表板。</p></div><div class="ab cl lp lq hy lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="in io ip iq ir"><h1 id="f00e" class="mb mc iu bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">参考</h1><ol class=""><li id="1de9" class="ne nf iu ks b kt mz kx na lb ng lf nh lj ni ln om nk nl nm bi translated"><a class="ae kp" href="https://en.wikipedia.org/wiki/Dashboard_(business)" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/Dashboard _(商务)</a></li><li id="fe53" class="ne nf iu ks b kt nn kx no lb np lf nq lj nr ln om nk nl nm bi translated"><a class="ae kp" href="https://plotly.com/python/subplots/" rel="noopener ugc nofollow" target="_blank">https://plotly.com/python/subplots/</a></li></ol></div></div>    
</body>
</html>