<html>
<head>
<title>Machine Learning on GCP — Choosing GPUs to Train Your Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP 上的机器学习—选择 GPU 来训练您的模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-best-gpu-option-on-google-cloud-platform-performance-price-discounts-81e0aa99ad46?source=collection_archive---------18-----------------------#2020-07-16">https://towardsdatascience.com/machine-learning-best-gpu-option-on-google-cloud-platform-performance-price-discounts-81e0aa99ad46?source=collection_archive---------18-----------------------#2020-07-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="72fa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">GCP GPU 概览——价格、性能、效率、折扣</h2></div><p id="072c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated"><span class="l lf lg lh bm li lj lk ll lm di"> G </span> oogle 云平台提供了广泛的 GPU 选项可供选择。GPU 可以提高你的 ML 处理能力，尤其是在矩阵计算方面。然而，我们机器上的 CPU 并没有为此进行优化。他们努力处理图像或视频，并且经常会延迟模型训练过程。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/cee93b0944d1445cb5569810f6212f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WSQ-MTFbTKmcYG0N"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">照片由<a class="ae md" href="https://unsplash.com/@virussinside?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Artiom Vallat </a>在<a class="ae md" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="5be1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 Tensorflow/Keras 中，NCHW(通道优先)输入的卷积网络需要 GPU 运行。</p><p id="369e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的大部分人工智能实验都围绕着人工智能游戏，使用简洁的深度 Q 强化学习或类似的技术。这涉及到对游戏框架的激烈的矩阵操作，这是 CPU 难以应付的。</p><p id="4a35" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在切换到 GCP GPU 后，在 CPU 上花费数周时间训练的游戏模型在 GPU 上几天内就完成了。因为它们运行在云上，所以只需使用外部 IP 暴露您的 Tensorboard，无需登录即可轻松监控您的模型。</p><p id="3a5f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是目前可用的 GPU 选项(<em class="me">2020 年 8 月 10 日</em>)以及它们的价格:—</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="7323" class="mk ml it mg b gy mm mn l mo mp"><strong class="mg iu">NVIDIA® Tesla® T4:</strong> $255.50/month <br/><strong class="mg iu">NVIDIA® Tesla® K80:</strong> $328.50/month<br/><strong class="mg iu">NVIDIA® Tesla® P4:</strong> $438.00/month<br/><strong class="mg iu">NVIDIA® Tesla® P100:</strong> $1,065.80/month<br/><strong class="mg iu">NVIDIA® Tesla® V100:</strong> $1,810.40/month</span></pre><blockquote class="mq mr ms"><p id="4e33" class="ki kj me kk b kl km ju kn ko kp jx kq mt ks kt ku mu kw kx ky mv la lb lc ld im bi translated">更多信息请点击这里:<a class="ae md" href="https://cloud.google.com/compute/docs/gpus" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/compute/docs/gpus</a></p></blockquote><p id="86d7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本评估仅涵盖特斯拉 T4、K80 和 P4。P100 和 V100 已经被排除在外，仅仅是因为它们对小项目和业余爱好者来说过于昂贵。</p><p id="ff64" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="me">注意</em> </strong>:并非所有 GPU 在所有 GCP 地区都可用。您可能希望根据您所使用的 GPU 来更改区域。</p><h2 id="c80c" class="mk ml it bd mw mx my dn mz na nb dp nc kr nd ne nf kv ng nh ni kz nj nk nl nm bi translated">NVIDIA Tesla T4—圣杯|首选</h2><p id="6c2d" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">特斯拉 T4 是圣杯——它既便宜又高效。它已经成为我为任何 ML 模型设置 GCP 环境的首选。</p><p id="9143" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是使用 Tensorflow 2.2.0-rc0(在<strong class="kk iu">特斯拉 T4 </strong>上)运行 DDQN 的 Tensorboard 输出:最高得分:406</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="ae57" class="mk ml it mg b gy mm mn l mo mp">Model: "sequential"_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================conv2d (Conv2D)              (None, 32, 20, 20)        8224      _________________________________________________________________conv2d_1 (Conv2D)            (None, 64, 9, 9)          32832     _________________________________________________________________conv2d_2 (Conv2D)            (None, 64, 7, 7)          36928     _________________________________________________________________flatten (Flatten)            (None, 3136)              0         _________________________________________________________________dense (Dense)                (None, 512)               1606144   _________________________________________________________________dense_1 (Dense)              (None, 4)                 2052      =================================================================</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ns"><img src="../Images/919b5af6c1dd2edc39197e3e003075ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwUryHCvYfAjmGwIpLPSLQ.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">作者图片</p></figure><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="8e50" class="mk ml it mg b gy mm mn l mo mp">Link to Tensorboard:<a class="ae md" href="https://tensorboard.dev/experiment/1yrW70A0QHertoJDVZk1ig/#scalars&amp;tagFilter=rew" rel="noopener ugc nofollow" target="_blank"><br/>https://tensorboard.dev/experiment/1yrW70A0QHertoJDVZk1ig/#scalars&amp;tagFilter=rew</a></span></pre><p id="fd08" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以观察到训练过程在短短 2 天内就在突围游戏中取得了接近 300 分的成绩。</p><p id="c410" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">特斯拉 T4 的另一个优点是，你可以让它们运行更长时间，以获得持续的折扣，因为它们很便宜(稍后讨论)。</p><h2 id="33c4" class="mk ml it bd mw mx my dn mz na nb dp nc kr nd ne nf kv ng nh ni kz nj nk nl nm bi translated">比较 T4 和 P4 的 K80</h2><p id="edf0" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">与 P4 的 K80 相比，特斯拉 T4 是一款相对较新的车型。</p><blockquote class="mq mr ms"><p id="644b" class="ki kj me kk b kl km ju kn ko kp jx kq mt ks kt ku mu kw kx ky mv la lb lc ld im bi translated">上市日期:<br/> <strong class="kk iu">特斯拉 T4—</strong>2018 年 9 月<br/> <strong class="kk iu">特斯拉 P4</strong>—2016 年 9 月<br/> <strong class="kk iu">特斯拉 K80s</strong>—2014 年 11 月</p></blockquote><p id="e1b8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 Tensorflow 分布式训练中，这些在多个 GPU 上的表现如何，此处尚未评估。</p><p id="6a49" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是就性能而言，Atari Breakout 模型的 DDQN 在所有 3 个 GPU 上花费了类似的时间来完成，性能没有重大差异。</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="d061" class="mk ml it mg b gy mm mn l mo mp">Github Link to my project: </span><span id="9728" class="mk ml it mg b gy nt mn l mo mp"><a class="ae md" href="https://github.com/komal-SkyNET/ai-neural-networks/tree/master/ai-atari" rel="noopener ugc nofollow" target="_blank">https://github.com/komal-SkyNET/ai-neural-networks/tree/master/ai-atari</a></span></pre><h2 id="bccc" class="mk ml it bd mw mx my dn mz na nb dp nc kr nd ne nf kv ng nh ni kz nj nk nl nm bi translated">持续折扣——一定要小心这些！</h2><p id="cff1" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated"><strong class="kk iu">持续折扣</strong>提供大幅折扣，让您的实例运行更长时间。这个是按月计算的。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/37d999d62854cce6557ad5d039a0dae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*2NYL3r33F806o0TiT2EnCw.png"/></div><p class="lz ma gj gh gi mb mc bd b be z dk translated"><em class="nv">作者图片:</em>使用特斯拉 T4 GPU 计算引擎实例的成本估算(来自 GCP 控制台)</p></figure><p id="210e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如图所示，请注意，仅使用特斯拉 T4 运行虚拟机，您就可以获得近 80 美元的持续折扣。</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="0fb2" class="mk ml it mg b gy mm mn l mo mp"><em class="me">More information here: </em><a class="ae md" href="https://cloud.google.com/compute/docs/sustained-use-discounts?_ga=2.15197878.-1086316627.1594861704" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/compute/docs/sustained-use-discounts</a></span></pre><h1 id="f335" class="nw ml it bd mw nx ny nz mz oa ob oc nc jz od ka nf kc oe kd ni kf of kg nl og bi translated">通过<em class="nv">持续折扣</em>，我节省了将近 100 澳元</h1><p id="9216" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">下面是一个月来运行 GPU 工作负载有/没有持续折扣的比较。注意图表。</p><h2 id="4f72" class="mk ml it bd mw mx my dn mz na nb dp nc kr nd ne nf kv ng nh ni kz nj nk nl nm bi translated">不打折→</h2><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi oh"><img src="../Images/1d59564acccc5ae6e379af5d10ca9ada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*20Yolt5cTqWr4iwGEGx_Mw.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">作者图片:Komal Venkatesh Ganesan</p></figure><h2 id="b7e2" class="mk ml it bd mw mx my dn mz na nb dp nc kr nd ne nf kv ng nh ni kz nj nk nl nm bi translated">持续折扣→</h2><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi oi"><img src="../Images/5f00eb07a606ac0f2b6f874a81461c88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HlKQHRft13lcCr1Sok-MtA.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">作者图片:Komal Venkatesh Ganesan</p></figure><h2 id="e2e6" class="mk ml it bd mw mx my dn mz na nb dp nc kr nd ne nf kv ng nh ni kz nj nk nl nm bi translated">区域与 GPU 选项</h2><p id="abcb" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">请注意，GPU 选项基于区域。如果您发现下拉列表中缺少某个特定的 GPU 选项，您可能需要尝试不同的地区/区域。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/522bac6ef83772e83b3305f7390b650c.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*wD49vtMuNThZCZVuwKfpeA.png"/></div><p class="lz ma gj gh gi mb mc bd b be z dk translated"><strong class="bd ok">区域 VS GPU 选项(</strong> <em class="nv">图片作者)</em></p></figure><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/68710532816d00a1fe03e2ad4a6fac5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*vuNdjnYnDFf_Y0dz2xzwgg.png"/></div><p class="lz ma gj gh gi mb mc bd b be z dk translated"><strong class="bd ok"> GPU 选项 us-central1-a(缺少 P100) ( </strong> <em class="nv">图片由作者提供)</em></p></figure><h2 id="72f3" class="mk ml it bd mw mx my dn mz na nb dp nc kr nd ne nf kv ng nh ni kz nj nk nl nm bi translated">结论</h2><ul class=""><li id="3126" class="om on it kk b kl nn ko no kr oo kv op kz oq ld or os ot ou bi translated">特斯拉 T4 既便宜又高效，很容易成为第一选择，其次是 K80 和 P4。但是，它们在分布式培训(使用多个 GPU)中的性能可能会有所不同，不在本评估范围内。</li><li id="5bdb" class="om on it kk b kl ov ko ow kr ox kv oy kz oz ld or os ot ou bi translated">持续折扣:只要多运行一会儿您的工作负载，您就可以获得巨大的折扣。调配虚拟机时，通常会显示预测估计值。</li></ul></div></div>    
</body>
</html>