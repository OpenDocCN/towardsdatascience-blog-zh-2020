<html>
<head>
<title>Safe City Biking Part 1: Creating and Animating Randomized Citibike Routes Using Historical Ride Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">安全的城市自行车运动第 1 部分:使用历史骑行数据创建随机的城市自行车路线并制作动画</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/safe-city-biking-part-1-creating-randomized-citibike-routes-using-historical-ride-data-136224bbd955?source=collection_archive---------76-----------------------#2020-07-06">https://towardsdatascience.com/safe-city-biking-part-1-creating-randomized-citibike-routes-using-historical-ride-data-136224bbd955?source=collection_archive---------76-----------------------#2020-07-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/d6f54ade9f0cdf30b0b50c4ea2c666c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_dfN9EJFn9uuPqoz5uoUxA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">马克斯·本德在<a class="ae jg" href="https://unsplash.com/s/photos/biking?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="51f2" class="jh ji jj bd b dl jk jl jm jn jo jp dk jq translated" aria-label="kicker paragraph">端到端项目</h2><div class=""/><div class=""><h2 id="b27f" class="pw-subtitle-paragraph kp js jj bd b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dk translated">在本文中，我将勾勒出我的项目路线图，从 Arduino 到数据科学/分析再到增强现实，并从第一步开始。</h2></div><p id="f7fa" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我一直是一个狂热的自行车爱好者:从每天骑自行车在数英里的山上往返于高中，到现在每天骑着 Citibike 在布鲁克林和时代广场之间跑 12 英里去上班。以下是我成为会员两年来的 Citibike 统计数据截图(在此之前，我会在城市里玩滑板):</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi md"><img src="../Images/3289ad033b9d3bf59053aef7eba586b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54g-SwjRGX0EmhfSP4uLUg.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">这是横穿美国大约一倍半的距离</p></figure><p id="c627" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果你熟悉在纽约骑自行车，你就会知道骑自行车并不总是安全或平稳的。这些年来我看到了进步，但也有相当多的事故，比如被打开的车门撞上，或者撞到一个很大的坑洞，我被从自行车上摔了下来。除了伤害/事故统计数据之外，很难找到这个城市实际骑自行车情况的数据，所以我决定收集自己的数据。</p><p id="aba4" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jt">以下是项目的主要步骤:</strong></p><ol class=""><li id="2f58" class="mi mj jj lj b lk ll ln lo lq mk lu ml ly mm mc mn mo mp mq bi translated">使用 2019 年夏季的 Citibike 历史骑行数据规划骑行路线。</li><li id="37c3" class="mi mj jj lj b lk mr ln ms lq mt lu mu ly mv mc mn mo mp mq bi translated">创建具有 GPS/LTE、陀螺仪和加速度计功能的 Arduino 传感器。</li><li id="ea0a" class="mi mj jj lj b lk mr ln ms lq mt lu mu ly mv mc mn mo mp mq bi translated">路线上超过 100 次骑行，从安装在自行车头盔上的传感器收集数据。使用 HTTP post 请求发送数据，并将这些数据存储在数据库中。</li><li id="b7da" class="mi mj jj lj b lk mr ln ms lq mt lu mu ly mv mc mn mo mp mq bi translated">在 Python 中分析这些数据后，构建一个模型，该模型可以预测从 A 点到 B 点的最稳定乘坐，同时还可以提供路线间平均速度和稳定性的热图。</li><li id="f71a" class="mi mj jj lj b lk mr ln ms lq mt lu mu ly mv mc mn mo mp mq bi translated">使用 Mapbox 将所有这些整合到 Unity 中，并创建 AR 世界范围的应用程序和 VR 可探索的数据体验。</li></ol><p id="ba3f" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">首先，我从 Citibike 的<a class="ae jg" href="https://s3.amazonaws.com/tripdata/index.html" rel="noopener ugc nofollow" target="_blank">月度骑行数据库</a>下载了 2019 年 6 月和 7 月。我想找出其他骑手最常走的路线，并围绕这些路线规划我的路线。为此，我创建了一个名为<code class="fe mw mx my mz b">pathfinder</code>的函数，它将创建一条从离我最近的自行车站开始的路线，并不断选择每英里最受欢迎的自行车站，直到它到达五英里。第一步是使用<a class="ae jg" href="https://kite.com/python/answers/how-to-find-the-distance-between-two-lat-long-coordinates-in-python" rel="noopener ugc nofollow" target="_blank">哈弗森公式</a>，过滤数据帧，只保留距离起点站 1 英里半径内的终点站。这个公式考虑了地球的曲率，这比只采用欧几里得距离更准确。</p><figure class="me mf mg mh gt iv"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="ba8f" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我使用斯科尔斯街&amp;曼哈顿大道和 S 4 街&amp;威斯大道，函数返回 1.14 英里，而谷歌地图给我 1.3 英里。我添加了一个 1.15 倍的乘数，以说明从鸟瞰图到实际路线长度的转换，从而得到 1.31 英里。</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/166f5122a1c1019d7ef9f7437951389d.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*HLjE_XEAHpanljdWiFiecw.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">我们将使用 OSMNX 在未来的计算中使用最短的路线</p></figure><p id="6381" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然后，我使用 rand 从该点选择三个最受欢迎的终端站之一。一旦我离开我的第一个出发站 5 英里，我将结束探路者循环，使用<code class="fe mw mx my mz b">osmnx</code>包走所有的路线。</p><figure class="me mf mg mh gt iv"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7374" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们的 Pathfinder 函数通过 while 循环输出以下路径:</p><pre class="me mf mg mh gt nd mz ne nf aw ng bi"><span id="0b5f" class="nh ni jj mz b gy nj nk l nl nm">station number 0: Scholes St &amp; Manhattan Ave<br/>station number 1: Bayard St &amp; Leonard St<br/>station number 2: 49 Ave &amp; 21 St<br/>station number 3: 1 Ave &amp; E 18 St<br/>station number 4: 1 Ave &amp; E 44 St</span></pre><p id="3fac" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们可以用它来绘图:</p><pre class="me mf mg mh gt nd mz ne nf aw ng bi"><span id="9a06" class="nh ni jj mz b gy nj nk l nl nm">fig, ax = ox.plot_graph_routes(G, route, route_color='b', node_size=0)</span></pre><figure class="me mf mg mh gt iv gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/f30e4b5e092de54bd59d5cb9c24c313f.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*MoQfJXMKVqKHhQMBpyvslQ.png"/></div></figure><p id="e54a" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">经过一些 Geopandas 数据帧处理后，我用 plotly.express <code class="fe mw mx my mz b">scatter_mapbox</code>制作了路线动画。</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi no"><img src="../Images/5975fffe6267b84f99775bb9b152d27d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Q6bLMd6BN6asLWe3GLZJrA.gif"/></div></div></figure><p id="73b5" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我将在每次外出时为自己生成一条随机路径，尽管随着时间的推移，我将不得不考虑覆盖范围以及与先前路线的重叠。</p><p id="4b61" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果我们有车站自行车数量/可用性数据，我们可以使用它来运行蒙特卡罗马尔可夫链(MCMC)模型(如果在每个时间点从车站租赁自行车，则根据会员/骑手总数有额外的车站激活概率),以计算每天结束时自行车在城市中的分布。我可能会在另一篇文章中做这个练习，因为在运行模型之前，它需要更多的数据收集和更多的预处理步骤。</p><p id="2fa8" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">下一次，我将介绍如何设置 Arduino 设备，并将其连接到数据库以使用 Python 进行查询。如果你对这个项目感兴趣，请随时联系我，就你希望我收集的任何数据或你可能有的想法提出建议。</p><p id="13ea" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">你可以在<a class="ae jg" href="https://github.com/andrewhong5297/Safebikingproject" rel="noopener ugc nofollow" target="_blank">这个 GitHub 库</a>里找到所有的代码。</p></div></div>    
</body>
</html>