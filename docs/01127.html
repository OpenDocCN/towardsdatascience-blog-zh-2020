<html>
<head>
<title>Transform Reality with Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用熊猫改变现实</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transform-reality-with-pandas-96f061628030?source=collection_archive---------12-----------------------#2020-02-01">https://towardsdatascience.com/transform-reality-with-pandas-96f061628030?source=collection_archive---------12-----------------------#2020-02-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2ae4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用转置、融合、合并等功能重塑数据。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/292dc8f358cf3255c5d2914275699888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xuVE0RrgiLz4lC3DWnXSyw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尼克·伍德在<a class="ae ky" href="https://unsplash.com/s/photos/pandas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="b699" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">熊猫让 python 变得简单</h1><p id="a981" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">纯 python 是一种非常清晰的语言。但是熊猫真的让它变笨了。简化 python 脚本语言使得更复杂的编程变得更加容易。DataFrame 操作使数学、科学、探索、艺术和魔法变得简单而直观。图书馆是研究者最好的朋友。</p><blockquote class="mn mo mp"><p id="0735" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated"><em class="it"/>熊猫<em class="it">让我们可以更专注于研究，而不是编程。我们发现</em>熊猫<em class="it">易学、易用、易维护。最重要的是，它提高了我们的生产力。”(</em> <a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> <em class="it"> Roni Israelov，博士</em> </a> <em class="it">，投资组合经理，</em> <a class="ae ky" href="https://www.aqr.com/" rel="noopener ugc nofollow" target="_blank"> AQR 资本管理</a>)</p></blockquote><h1 id="c221" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">改变现实</h1><p id="3cfe" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">数据科学项目的第一步是将数据集加载到 pandas 数据框架中，并使用<strong class="lt iu"> <em class="mq">检查前五行。</em></strong>(head())法，翻着白眼，不可置信地呻吟，并对数据集的作者缺乏远见感到绝望。他们不知道您需要列级聚合吗？在 Excel 中，这将是一场复制粘贴的噩梦。熊猫给你一条走出迷雾的路，非常聪明，可读性强。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/f2c4610d4c9f8a36e521d51183d5c055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6tnC4jYbgu_aLJW1bYWrsg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@photoripey?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Ibrahim Rifath </a>在<a class="ae ky" href="https://unsplash.com/s/photos/fog-road?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="36b5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">本文的目标</h1><p id="8654" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本文中，我将演示几个 pandas DataFrame 操作，用于转换数据和构建可重现的函数，您可以使用这些操作来自动化 ETL-Transform 的“T ”,并节省您的脑力和耐心来关注真正重要的问题。指导我的数据集设计的许多原则来自于<a class="ae ky" href="https://tidyverse.tidyverse.org/articles/manifesto.html" rel="noopener ugc nofollow" target="_blank"> R tidyverse。</a></p><p id="cf20" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><strong class="lt iu">跟着我的</strong> <a class="ae ky" href="https://github.com/rchardptrsn/Pandas-Data-Transformation/blob/master/Pandas%20Data%20Transformation.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> Jupyter 笔记本一起上 GitHub 吧！</strong> </a></p><h1 id="e9ff" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">1.下载数据</h1><p id="85da" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们将使用世界银行的数据，该数据给出了自 1960 年以来每个国家的年度 GDP。乍一看，很可怕。专栏的年份？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/9adcd42ab2e37978295f19317882a569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZCCpuawI5gqTXXmERlIBNA.png"/></div></div></figure><h1 id="b43d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">2.想象你的目标。</h1><p id="a192" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在我可以看到数据是如何排列的，我需要设想转换的最终目标，并考虑完成转换所需的步骤。</p><p id="e7a2" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">这是我希望的最终结果，一个显示年份、GDP 四分位数和平均 GDP 百分比变化的 3 列数据框架。这将用于创建一个线图，显示每个四分位数每年的增长百分比。这有助于可视化全球经济趋势，并衡量某些事件和趋势对全球 GDP 不同四分位数的影响。(滚动到底部查看最终图表)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/36f32be3ae74c989df9aaee66619a7d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XmJ3ARNuAvf2vA9b2b5qVw.png"/></div></div></figure><h1 id="649a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">3.移项</h1><p id="2943" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们需要得到每个国家 GDP 的百分比变化，这样我们就可以按四分位数计算总平均值。现在，数据框架指数是按国家的，所以我们需要将数据框架转换成按年份的指数，以国家为列。以年份为索引，以国家为列，这将非常适合于计算每一列(即各个国家)各行的百分比变化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/d44e968b77eb8bab1b19e9856e42ea2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_mfXAMRH46ujFmuiE2ku8A.png"/></div></div></figure><h1 id="d304" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">4.百分比变化</h1><p id="186b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">熊猫有一个很优秀的 DataFrame 操作叫做<strong class="lt iu"> <em class="mq"> DataFrame.pct_change()。</em> </strong>此操作向下计算列，并用该列与其上一行之间的百分比变化替换该值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/ffa726e34ef848a2cd6d6ee4e6dc18d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QpLhBZ2Miy4bxYnJQhiCA.png"/></div></div></figure><h1 id="0183" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">5.转置回原始形状</h1><p id="8b4c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">使用转换后的 GDP 百分比变化数据框架，将行和列转置回原始形状。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/ef4a4d7c09f7aacc999bb7ca07e5616a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IzXpPNBJvVE-usglReLqVA.png"/></div></div></figure><h1 id="d918" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">6.熔化数据帧</h1><p id="4515" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">别忘了我们还有原始的 GDP 数据框架。计算每个国家的四分位数需要原始数据框架和未转换的国内生产总值分数。我们现在必须做的是融合国内生产总值和国内生产总值百分比变化数据框架，以便在下一步将其合并。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/f46a929f0a79e4c28a007be6f12f5464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sj7wDTS3ffBBFIxj4YfbPg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">国内生产总值数据框架</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/bd643380f5ba64803c5c5b826d872b9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rRyUCyUf5nEi4kYKerJOcw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">国内生产总值百分比差异数据框架</p></figure><h1 id="ee39" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">7.合并数据帧</h1><p id="932e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们迄今所做的一切之后，与熊猫融合是如此容易，这是一种解脱。我们可以简单地对原始 GDP 数据执行 DataFrame.merge()，并告诉它将百分比差异数据作为参数进行合并。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/1cea76f65ff5a7f00e4827f0e8916eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*INYzJ29HrXEg8lPiv6TUUQ.png"/></div></div></figure><h2 id="15cb" class="nj la it bd lb nk nl dn lf nm nn dp lj ma no np ll me nq nr ln mi ns nt lp nu bi translated">日常管理—删除、重命名、转换为数字、删除 NAs</h2><p id="ca1f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您会注意到 _x 和 _y 后缀，Pandas 很好地分配了它们，这样我们就不会被合并后的数据集弄糊涂了。现在我们必须删除不必要的列，重命名这些列，并将 year 转换为 numeric(它被错误地作为对象读入)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/3ed630d87f9cacdc03217a7f0ae62574.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2_Ix1TaajKzLW7ZAI5BANg.png"/></div></div></figure><h1 id="82e1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">8.计算每年 GDP 的四分位数</h1><p id="2603" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们需要的是每个国家的 GDP 指标，以了解它在年度 GDP 分布中的位置。四分位数是根据数据在后 25%(按计数，而不是值)、26–50%、51–75%和 76–100%中的位置对数据进行分组的极好方法。我们将使用这个<a class="ae ky" href="https://stackoverflow.com/questions/19403133/pandas-groupby-and-qcut" rel="noopener ugc nofollow" target="_blank">优秀的 StackOverflow 答案，结合<em class="mq"> groupby()、transform()和 lambda()，为该年计算的 GDP 四分位数创建一个新列。</em>T3】</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/030d9fd389d23cb21aa2eda62a0c2cae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1powvO98KacREcruWM--0w.png"/></div></div></figure><h1 id="1db0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">9.平均 GDP 百分比变化——按四分位数</h1><p id="fbdd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在我们有了创建最终数据帧的所有部分。我们将再次使用<strong class="lt iu"><em class="mq">data frame . group by()</em></strong><strong class="lt iu"><em class="mq"/></strong>按年份和四分位数分组，并将平均值计算集中在 GDP_pct_change 上。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/fe4b5bb1eef0d50c0e5149e01a9d7277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LlaEQd_ZXbs7G_KxxwsSOA.png"/></div></div></figure><p id="058e" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">你现在可以呼吸了。我们已经走了这么远！</p><p id="872a" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">当我们第一次用<strong class="lt iu"> <em class="mq">检查时，数据集几乎无法辨认。</em>头()</strong>。我们现在可以看看过去 60 年的全球 GDP 变化，并检查不同的 GDP 四分位数对全球趋势的反应。</p><p id="7487" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">让我们用一个简单的 Seaborn line 情节来享受我们的劳动成果吧。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/422a77debb141e2eeb9f0a932e405ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WlOoADqadgOVIO1EuAZUJQ.png"/></div></div></figure><p id="c42d" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">谢谢你陪我坚持下来！数据清理和转换是分析过程中至关重要的一部分，我们刚刚经历了一次令人费解的旅程，数据采用了许多不同的形状和维度。</p></div></div>    
</body>
</html>