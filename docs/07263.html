<html>
<head>
<title>Aggregation, Transform, Filter — How and When to use them?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">聚合、转换、过滤——如何以及何时使用它们？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/aggregation-transform-filter-how-and-when-to-use-them-31ed7eb88d2e?source=collection_archive---------38-----------------------#2020-06-02">https://towardsdatascience.com/aggregation-transform-filter-how-and-when-to-use-them-31ed7eb88d2e?source=collection_archive---------38-----------------------#2020-06-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c73c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">熊猫:从熟练工到大师——来自受害者的声音。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3c0b8cb3ee7f501f6b36f0b79a43e583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J_z3Jkn7KL30Dj8VqrrrqQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">信用:<a class="ae kv" href="https://unsplash.com/@millerthachiller?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">帕斯卡·米勒</a>对<a class="ae kv" href="https://unsplash.com/@millerthachiller?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="107c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想知道，当我说“受害者”时，那是因为我太被熊猫的能力宠坏了，直到我遇到了<code class="fe ls lt lu lv b">Aggregation, Transform, Filter</code>、<br/>他们让我很难理解引擎盖下的机制。在花了一些时间钻研之后，我对它有了更好的理解。现在，让我们开门见山地说吧。</p><p id="baba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我始终相信简单数据集对于方法说明的作用。因此，本文将使用一个非常简单的数据集:<strong class="ky ir">不同国家/地区的人口和预期寿命。</strong></p><p id="ab9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可能已经熟悉带有基本计算的<code class="fe ls lt lu lv b">groupby</code>聚合，如<code class="fe ls lt lu lv b">mean(), sum(), median()</code>等。聚合、转换和过滤将 goupby 带到了另一个层次。</p><p id="2448" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们来看一下<code class="fe ls lt lu lv b">groupby</code>功能是如何工作的。2011 年，Hadley Wickham 在他的论文<a class="ae kv" href="https://www.jstatsoft.org/article/view/v040i01" rel="noopener ugc nofollow" target="_blank">“数据分析的拆分-应用-组合策略”</a>中引入了“拆分-应用-组合”的思想，使得<code class="fe ls lt lu lv b">groupby</code>函数具有了说明性。一般来说，<code class="fe ls lt lu lv b">groupby</code>功能由三个步骤组成:分割、应用和组合。<code class="fe ls lt lu lv b">split</code>步骤根据指定的关键字将数据帧分解成子集数据帧。然后，<code class="fe ls lt lu lv b">apply</code>步骤将函数应用于这些子集数据帧。最后，<code class="fe ls lt lu lv b">combine</code>步骤将这些结果连接成一个输出数组。</p><h1 id="ef14" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">聚合🐺</h1><p id="4bd4" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">记住上面的过程，我们就很容易理解<code class="fe ls lt lu lv b">aggregation</code>。基本上，<code class="fe ls lt lu lv b">aggregation</code>对一列和多列应用多个函数。首先，它基于“区域”将完整的数据帧分成子数据帧。然后对“预期寿命”应用均值函数，对“人口”应用和函数。最后，它将结果组合成可以通过“reset_index”转换成数据帧的序列。最后，您将得到一个不同的数据帧，其长度是 groupby 键的唯一值的数量(在我们的例子中是“Region”)。下面是<code class="fe ls lt lu lv b">aggregation</code>的视觉流程。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/24171683e5bd89c85eedff6b4c421b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QH6GA0rp9FMaWdrnh-JCjQ.png"/></div></div></figure><h1 id="a615" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">改变🐣</h1><p id="c569" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">与聚合相比，<code class="fe ls lt lu lv b">transform</code>多了一个叫做“广播”的步骤。它将结果从子数据帧广播到原始的完整数据帧。你可以把结果合并到原始的完整数据帧中。因此<code class="fe ls lt lu lv b">transform</code>将总是返回一个与原始完整数据帧长度相同的序列。下面是<code class="fe ls lt lu lv b">transform</code>的视觉流程。</p><p id="c5be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">transform</code>的一个典型用例是计算组总数的百分比(在我们的例子中，是其所在地区的国家人口比例，例如印度在南亚地区的人口比例。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="6164" class="my lx iq lv b gy mz na l nb nc">df[‘PopShare’]=df.groupby(‘Region’)[‘Population’].transform(lambda x: x/x.sum())</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/ea2c99872e12f2f48ce3cdc634ce509f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ccovpb3OL7R7ZyX0kZrhxA.png"/></div></div></figure><h1 id="b1e0" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">过滤器🐳</h1><p id="c46b" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">与 transform 相比，<code class="fe ls lt lu lv b">filter</code>多了一个步骤。从这些子数据帧中获得结果后，它对这些结果应用一个过滤器(在我们的例子中，它是“RegionAverageLife”&gt;75)。然后，这些过滤的结果将广播到原始数据帧中的匹配条件。因此，在这种情况下，您将获得完整数据帧的缩减版本。下面是<code class="fe ls lt lu lv b">filter</code>的视觉流程。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/ad9d74ffab5c659bf47c94b0d2ba8cba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EbQuHaOd_5n0uCPYETDveg.png"/></div></div></figure><p id="b8e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总之，下面是<code class="fe ls lt lu lv b">Aggregation, Transform, and Filter.</code>的最佳使用场景以及它们在 SQL 中的等效格式。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/b9d29864ee6b28bb172fedf7341ffe2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*veNDBHWIPOoepAVnZ3ot5Q.png"/></div></div></figure><h2 id="4ebc" class="my lx iq bd ly ng nh dn mc ni nj dp mg lf nk nl mi lj nm nn mk ln no np mm nq bi translated"><strong class="ak"> <em class="nr">最后</em> </strong></h2><p id="0eb1" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">保持乐观！感谢阅读！如果你想取得联系，可以在这里  <em class="ns">联系我</em> <a class="ae kv" href="https://www.linkedin.com/in/jinzhaolu/" rel="noopener ugc nofollow" target="_blank"> <em class="ns">。</em></a></p></div></div>    
</body>
</html>