<html>
<head>
<title>Effective Deep Learning Development Environment with PyCharm and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 PyCharm 和 Docker 的有效深度学习开发环境</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/effective-deep-learning-development-environment-with-pycharm-and-docker-34018f122d92?source=collection_archive---------33-----------------------#2020-06-28">https://towardsdatascience.com/effective-deep-learning-development-environment-with-pycharm-and-docker-34018f122d92?source=collection_archive---------33-----------------------#2020-06-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c78e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">借助全面承诺的 IDE 和虚拟化提高您的工作效率。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e5dfe293c4e79ddb0548625f6f5b1b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8XdvJmkBvPqF1yjC"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">塞缪尔·伯克在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="ee51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，当您在远程环境(内部工作站、AWS、GPUs)中使用 GPU 时，我将指导您为深度学习培训建立一个有效的开发环境。</p><p id="6e4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，您将在本地计算机上使用 PyCharm IDE 开发您的 ML/DL 代码，就好像它在您的本地环境中使用 Python 解释器一样。</p><h1 id="961e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak"> <em class="mk">动机</em> </strong></h1><h2 id="b584" class="ml lt iq bd lu mm mn dn ly mo mp dp mc lf mq mr me lj ms mt mg ln mu mv mi mw bi translated">1.为什么要用 PyCharm 这种成熟的 IDE？</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/eb23a45ffe3c70f767cf9e962d91e9d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9azbiDmyzTY3bkh_-vcm5g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://www.jetbrains.com/company/brand/logos/" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><blockquote class="my"><p id="ec5a" class="mz na iq bd nb nc nd ne nf ng nh lr dk translated">“因此，如果你想走得快，如果你想快速完成，如果你想让你的代码易于编写，就让它易于阅读。”<br/> ― <strong class="ak">罗伯特·c·马丁，</strong> <a class="ae kv" href="https://www.goodreads.com/work/quotes/3779106" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">干净的代码:敏捷软件工艺手册</strong> </a></p></blockquote><ol class=""><li id="2b1a" class="ni nj iq ky b kz nk lc nl lf nm lj nn ln no lr np nq nr ns bi translated">当你训练你的深度学习代码时，你会做很多实验。你改变你的超参数，添加/删除层来优化模型，调整你的数据集…所以，过一会儿，代码可能会很难管理。因此，您需要编写整洁且可维护的代码。像 PyCharm 这样的 IDE 可以给你提供这样的环境。</li><li id="b771" class="ni nj iq ky b kz nu lc nv lf nw lj nx ln ny lr np nq nr ns bi translated">在编码时，你必须实时观察你的变量和函数，看看它们是否如你所愿，否则你可能会在长时间的训练后遇到意想不到的结果。打印变量的值或函数的返回值是很常见的，大多数人都是通过在行间打字来完成的。这不是观察变量的正确方法；相反，你应该从外部观察它们<em class="nt">。使用 PyCharm 变量资源管理器和 IPython 控制台可以轻松查看代码的行为和变量值。</em></li><li id="80a1" class="ni nj iq ky b kz nu lc nv lf nw lj nx ln ny lr np nq nr ns bi translated">阅读库的文档来为我们的任务找到合适的函数或对象是很费时间的。<em class="nt">自动完成</em>在编写快速代码时非常方便。然而，在像 Python 这样的动态类型语言中很难做到这一点。尽管其他 ide 和 Jupyter Lab 也有自动完成功能，但它们并不总是能正常工作。皮查姆非常擅长那项工作。</li></ol><p id="6882" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我认为这三点是使用 PyCharm 的关键因素，但还有许多其他的巨大优势:<em class="nt">自动格式化、高级搜索、错误检查、轻松导航、智能重构、剖析、着色...</em></p><h2 id="c497" class="ml lt iq bd lu mm mn dn ly mo mp dp mc lf mq mr me lj ms mt mg ln mu mv mi mw bi translated">2.为什么应该使用 Docker？</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/219769bf878073db8121b785b3f1d86b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JUOITpaBdlrMP9D__-K5Fw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://www.docker.com/company/newsroom/media-resources" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="430b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你在 Ubuntu 机器上建立了深度学习环境，你就会知道匹配所有这些驱动程序、软件和库的版本有多难。如果你没有遇到任何困难，祝贺你！但是你可能还没有更新你的任何驱动，CUDA，或者深度学习(Tensorflow，PyTorch…)库，这意味着你随时都可能遇到这个困难。</p><p id="5897" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">深度学习框架(尤其是 TensorFlow)在版本更新上非常激进，这可能导致与 CUDA 版本或 NVIDIA 驱动程序不兼容。有时候，很难匹配这些软件的发布。此外，如果您不小心同时安装了不同版本的 NVIDIA 或 CUDA 驱动程序，处理起来可能会很复杂，您可能需要格式化您的系统。</p><p id="b9b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Docker 解决了这些问题。你只需要安装 NVIDIA 驱动，其余的由 Docker 容器管理。</p><p id="c5fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">比如你正在做 TensorFlow，但是你看到在 PyTorch 的新版本中，有针对你的任务的完美功能，你想尝试一下。在同一台机器上管理不同的框架(<em class="nt">和不同的版本</em>)是一项挑战。使用 Docker，您可以管理它。它抽象了硬件驱动之上的系统；因此，您可以同时运行不同版本的框架和 CUDA。它类似于虚拟机，但没有虚拟机那么重。使用 Docker 有很多好处，但在这篇文章中，我不打算告诉这些。网上已经有很多很棒的文章，你可以广泛地阅读和获取信息。这篇文章是关于连接这两个产品。我们开始吧。</p><h1 id="341a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">设置系统</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/b6b534285da9888ba00360301fc950b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8yDcGY3Xkw7cUDsuFnb5LQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">流程图</p></figure><p id="7914" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 1。</strong> <a class="ae kv" href="https://www.jetbrains.com/edu-products/download/#section=pycharm-edu" rel="noopener ugc nofollow" target="_blank">在本地电脑上安装 PyCharm </a>(使用远程解释器需要专业版，PyCharm Professional 对学生免费)。</p><p id="4085" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2。在你的远程机器上安装 Docker 。</strong></p><p id="acc8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2.1。</strong> <a class="ae kv" href="https://docs.docker.com/get-started/" rel="noopener ugc nofollow" target="_blank">熟悉</a>Docker 环境(可能需要一个工作日才能完全理解什么是映像、容器、如何从 Docker Hub 获取以及 Docker 系统的一般工作方式，但你会得到回报)。</p><p id="3a51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2.2。</strong>把你喜欢的深度学习框架的 Docker 镜像下载到远程机器上。</p><p id="3cf3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://hub.docker.com/r/tensorflow/tensorflow/" rel="noopener ugc nofollow" target="_blank">张量流</a></p><p id="57b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://hub.docker.com/r/pytorch/pytorch/" rel="noopener ugc nofollow" target="_blank"> PyTorch </a></p><p id="93b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">现在，是时候将 PyCharm Python 解释器连接到 Docker 容器中的 Python 环境了。</strong></p><p id="fa26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 1。</strong>启动 Docker 容器。转发端口 8022(可以这样改)到 22 ( <strong class="ky ir">对于 SSH 连接来说是必须的</strong>)。示例:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="517d" class="ml lt iq oc b gy og oh l oi oj">sudo docker run --gpus all -it --rm -p 8022:22 -v /home/workstation/Desktop:/home/gorkem/Desktop --name ssh_container pytorch/pytorch:1.4-cuda10.1-cudnn7-devel bash</span></pre><p id="a6ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2。</strong>使用主操作系统的终端，检查您是否确实将您的端口 8022 转发到了 22 号集装箱。</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="2654" class="ml lt iq oc b gy og oh l oi oj">sudo docker port &lt;your container name&gt; 22<br/>-&gt; 0.0.0.0:8022</span></pre><p id="23a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 3。</strong>在 Docker 容器中设置 SSH 服务器。</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="fd05" class="ml lt iq oc b gy og oh l oi oj">apt update &amp;&amp; apt install -y openssh-server</span><span id="ee31" class="ml lt iq oc b gy ok oh l oi oj">mkdir /var/run/sshd</span><span id="c74b" class="ml lt iq oc b gy ok oh l oi oj">echo 'root:&lt;USE_YOUR_OWN_STRONG_PASSWORD&gt;' | chpasswd<br/># Root password was changed with &lt;USE_YOUR_OWN_STRONG_PASSWORD&gt;</span><span id="67c4" class="ml lt iq oc b gy ok oh l oi oj">sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config</span><span id="68b3" class="ml lt iq oc b gy ok oh l oi oj">sed 's@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd</span><span id="36bb" class="ml lt iq oc b gy ok oh l oi oj">echo "export VISIBLE=now" &gt;&gt; /etc/profile</span><span id="c09b" class="ml lt iq oc b gy ok oh l oi oj">service ssh restart</span></pre><p id="b3a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 4。</strong>我无法通过 SSH 进入容器中的 root 用户，所以我创建了另一个 sudo 用户并建立了一个 SSH 连接。</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="69f7" class="ml lt iq oc b gy og oh l oi oj">adduser gorkem<br/>adduser gorkem sudo</span></pre><p id="3575" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 5。</strong>现在，你应该提交你的容器作为一个新的图像。否则，当您终止它时，您将丢失您对 contanier 所做的所有更新。我通常会在提交的图像末尾添加<code class="fe ol om on oc b">-ssh</code>标签。</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="22a1" class="ml lt iq oc b gy og oh l oi oj">docker commit &lt;container_name&gt; &lt;name&gt;/&lt;name&gt;:&lt;tag&gt;</span></pre><p id="7f44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">6。关闭容器。</p><p id="c60a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">7。从提交的映像启动一个新的 Docker 容器。</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="43e2" class="ml lt iq oc b gy og oh l oi oj">sudo docker run --gpus all -it --rm -p 8022:22 -v /home/workstation/Desktop:/home/gorkem/Desktop --name ssh_container pytorch/pytorch:1.4-cuda10.1-cudnn7-devel-ssh bash</span></pre><p id="d9ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">8。检查 SSH 状态，容器启动时会禁用(但可以设置为容器启动时自动启动)，启动 SSH 服务器。</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="ffa5" class="ml lt iq oc b gy og oh l oi oj">service ssh status<br/>-&gt;  * sshd is not running</span><span id="4351" class="ml lt iq oc b gy ok oh l oi oj">service ssh start<br/>-&gt;  * Starting OpenBSD Secure Shell server sshd</span><span id="5b2e" class="ml lt iq oc b gy ok oh l oi oj">service ssh status<br/>-&gt;  * sshd is running</span></pre><p id="416e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">9。SSH 服务器正在你的 Docker 容器中运行，现在你可以按照官方的 PyCharm 指南将你的 PyCharm 远程解释器连接到这个容器。在两个问题上你应该小心:</p><p id="1896" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 9.1 </strong>您的用户名是您在 Docker 中创建的用户名(在我的例子中，它是<code class="fe ol om on oc b">gorkem</code>)。</p><p id="5c62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 9.2 </strong>虽然 SSH 默认工作在端口<strong class="ky ir"> 22 </strong>上，但是你必须使用转发端口(在我的例子中是<strong class="ky ir"> 8022 </strong>)。PyCharm 首先连接到远程机器，然后 SSH 连接被转发(由 Docker)到我们的容器。</p><p id="03cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在从 PyCharm 直接连接到 Docker 容器之前，您可以使用类似于<a class="ae kv" href="https://www.putty.org/" rel="noopener ugc nofollow" target="_blank"> Putty </a>的程序来测试 SSH 连接(还是要注意端口号和用户名)，以确保容器端一切正常。</p><blockquote class="my"><p id="c078" class="mz na iq bd nb nc oo op oq or os lr dk translated">现在您可以在 PyCharm IDE 上开发您的算法，就好像您的培训是在您的本地 PC 上运行一样。</p></blockquote><figure class="ot ou ov ow ox kk"><div class="bz fp l di"><div class="oy oz l"/></div></figure><p id="fc17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您有任何问题或改进，请评论。</p></div><div class="ab cl pa pb hu pc" role="separator"><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf"/></div><div class="ij ik il im in"><p id="2c7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">觉得这篇文章有用？看看我下面的其他文章:</p><div class="ph pi gp gr pj pk"><a href="https://medium.com/swlh/deep-learning-architectures-that-you-can-use-with-a-very-few-data-8e5b4fa1d5da" rel="noopener follow" target="_blank"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd ir gy z fp pp fr fs pq fu fw ip bi translated">你可以用很少的数据使用深度学习架构</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">传统的 CNN(Alex net，VGG，GoogLeNet，ResNet，DenseNet …)在样本较多的情况下有很好的表现…</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">medium.com</p></div></div><div class="pt l"><div class="pu l pv pw px pt py kp pk"/></div></div></a></div><div class="ph pi gp gr pj pk"><a href="https://medium.com/@GorkemPolat/how-to-solve-data-loading-bottlenecks-in-your-deep-learning-training-1ddfcc24449b" rel="noopener follow" target="_blank"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd ir gy z fp pp fr fs pq fu fw ip bi translated">如何解决你深度学习训练中的数据加载瓶颈</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">即使你没有固态硬盘！</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">medium.com</p></div></div><div class="pt l"><div class="pz l pv pw px pt py kp pk"/></div></div></a></div></div></div>    
</body>
</html>