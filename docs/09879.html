<html>
<head>
<title>Create NetCDF Files with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 创建 NetCDF 文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-netcdf-files-with-python-1d86829127dd?source=collection_archive---------14-----------------------#2020-07-13">https://towardsdatascience.com/create-netcdf-files-with-python-1d86829127dd?source=collection_archive---------14-----------------------#2020-07-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2b24" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一旦你打破了学习曲线，一个强大的数据格式</h2></div><p id="525f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">网格化的空间数据通常存储在 NetCDF 文件中。对于气候数据来说尤其如此。NetCDF 文件通过支持多个变量和详细的元数据，提供了比一些传统栅格格式更大的灵活性和透明度。由于元数据和文件结构的原因，NetCDF 文件比传统的栅格格式更难访问。本文介绍了创建 NetCDF 文件和用 Python 编写数据值的基础知识。我之前写过关于用 Python 从 NetCDF 文件中访问元数据和变量的文章。</p><h1 id="6f76" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">创建 NetCDF 数据集</h1><p id="ca37" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">导入<code class="fe mc md me mf b">netCDF4</code>和<code class="fe mc md me mf b">numpy</code>模块。然后定义一个扩展名为<code class="fe mc md me mf b">.nc</code>或<code class="fe mc md me mf b">.nc4</code>的文件名。调用<code class="fe mc md me mf b">Dataset</code>，用<code class="fe mc md me mf b">'w'</code>指定写模式，创建 NetCDF 文件。NetCDF 文件未建立，可以写入。完成后，一定要在数据集上调用<code class="fe mc md me mf b">close()</code>。</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h1 id="e8b6" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">添加维度</h1><p id="70fe" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">NetCDF 文件通常包含三个维度:时间、宽度(x 或经度)和高度(y 或纬度)。宽度和高度尺寸总是固定的。时间维度是动态的(可以增长)，允许将时间步长添加到文件中。在 NetCDF 中，动态的或不断增长的维度被称为“无限的”。</p><p id="9a79" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以添加无限的尺寸，并由<code class="fe mc md me mf b">None</code>指定。我们将对时间变量使用无限的维度，这样它就可以增长。换句话说，我们可以继续向文件添加时间步长。此外，创建纬度和经度维度。<code class="fe mc md me mf b">lat</code>和<code class="fe mc md me mf b">lon</code>定义了我们文件的地理范围和维度。这里我们只是创建了一个大小为 10 的维度。这意味着生成的网格只有 10 行和 10 列。<code class="fe mc md me mf b">lat</code>和<code class="fe mc md me mf b">lon</code>的大小或地理距离被指定为变量。其实每个维度都会有对应的变量。</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h1 id="17e4" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">添加 NetCDF 变量</h1><p id="79ba" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">变量包含文件的实际数据。它们还定义了数据所引用的网格。这个文件将包含四个变量。纬度和经度定义了网格值和数据位置。<code class="fe mc md me mf b">times</code>定义数据文件中的图层。<code class="fe mc md me mf b">value</code>包含实际数据。要创建变量，指定变量名、<a class="ae le" href="https://unidata.github.io/netcdf4-python/netCDF4/index.html" rel="noopener ugc nofollow" target="_blank">数据类型</a>和形状。通过引用维度名称，形状被定义为元组。还指定了附加元数据。这里我们将<code class="fe mc md me mf b">value</code>的单位定义为<code class="fe mc md me mf b">Unknown</code>。</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h1 id="92fb" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">分配纬度和经度值</h1><p id="95e6" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">用网格单元创建一个简单的网格，用<code class="fe mc md me mf b">numpy.arange</code>测量 1 度乘 1 度。将 y 值分配给<code class="fe mc md me mf b">lats</code>，将 x 值分配给<code class="fe mc md me mf b">lons</code>。现在我们只需要分配与我们创建的网格尺寸相匹配的数据值。</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h1 id="98ed" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">分配 NetCDF 数据值</h1><p id="fb44" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">将两个时间步长的数据添加到我们创建的值变量中。每个时间步长由一个 2D 数数组表示。每个数组的大小必须与<code class="fe mc md me mf b">lat</code>和<code class="fe mc md me mf b">lon</code>尺寸相匹配。用<code class="fe mc md me mf b">numpy.random</code>创建一个从 0 到 100 的随机数数组。该数组包含第一个时间步长的数据。</p><p id="5862" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，创建一个数组，数组中的值从 0.5 线性增加到 5.0。要做到这一点，用<code class="fe mc md me mf b">numpy.linspace</code>创建两个 1D 数组，并在相反的轴上将它们加在一起。下面的代码展示了这是如何做到的。创建数组并将其分配给<code class="fe mc md me mf b">value</code>后，关闭<code class="fe mc md me mf b">ds</code>。您的 NetCDF 现在已保存并准备就绪。在 QGIS 中打开文件进行可视化，或在 Python 中绘制数组。结果的图像如下所示。</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/54c656212262414197efb7a7898adfd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s5fHynl3vL5sjmv2"/></div></div><p class="mu mv gj gh gi mw mx bd b be z dk translated">带有随机值的 NetCDF(由作者创建)</p></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/57d44674701b50187b0e155b90739769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a1SqRxQzOq0DULX_"/></div></div><p class="mu mv gj gh gi mw mx bd b be z dk translated">带有线性插值的 NetCDF(由作者创建)</p></figure><h1 id="16bd" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">结论</h1><p id="a6ea" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">一旦您理解了 NetCDF 文件的基本结构，它将是处理空间数据的一种非常有用的方式。在这个例子中，我们创建了一个只有一个数据变量的文件。但是可以将多个变量添加到一个文件中，这可能会减少管理数据所需的文件数量。NetCDF 文件最有用的方面之一是阐明它们包含的数据的文档和元数据。</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ml mm l"/></div></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><p id="f9fa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nf">原载于 2020 年 7 月 13 日</em><a class="ae le" href="https://opensourceoptions.com/blog/create-netcdf-files-with-python/" rel="noopener ugc nofollow" target="_blank"><em class="nf">https://opensourceoptions.com</em></a><em class="nf">。</em></p></div></div>    
</body>
</html>