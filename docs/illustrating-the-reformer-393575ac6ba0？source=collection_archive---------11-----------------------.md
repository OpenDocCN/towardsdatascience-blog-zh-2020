# ğŸ’¡ç¤ºå‡ºäº†é‡æ•´å™¨

> åŸæ–‡ï¼š<https://towardsdatascience.com/illustrating-the-reformer-393575ac6ba0?source=collection_archive---------11----------------------->

## ğŸšŠé«˜æ•ˆå˜å‹å™¨ï¸

![](img/d15877aeac0916eefd139cce1efd618a.png)

*å‚è§:ğŸ‡«ğŸ‡·* [*æ³•æ–‡*](https://lbourdois.github.io/blog/nlp/Reformer/) çš„ç¿»è¯‘

ğŸ¥å¦‚æœä½ ä¸€ç›´åœ¨å¼€å‘ç”¨äºå¤„ç†é¡ºåºæ•°æ®çš„æœºå™¨å­¦ä¹ ç®—æ³•â€”â€”å¦‚è¯­è¨€å¤„ç†ä¸­çš„æ–‡æœ¬ã€è¯­éŸ³ä¿¡å·æˆ–è§†é¢‘â€”â€”ä½ å¯èƒ½å¬è¯´è¿‡æˆ–ä½¿ç”¨è¿‡[**Transformer**](https://ai.googleblog.com/2017/08/transformer-novel-neural-network.html)**model**ï¼Œ**ï¼Œä½ å¯èƒ½çŸ¥é“å®ƒä¸ twitter è®¤ä¸ºçš„ä¸åŒ:**

**![](img/e5b82fb5672814fbf8f8746055b284b7.png)**

**å›¾ä¸€ã€‚ç ´å†°è€…ï¼Œæ‘˜è‡ªå…‹é‡Œæ–¯Â·æ›¼å®æ•™æˆçš„æ¨ç‰¹**

**ğŸ”ŠğŸ—æœ€è¿‘ï¼Œè°·æ­Œæ¨å‡ºäº† [**é‡æ•´å™¨**](https://ai.googleblog.com/2020/01/reformer-efficient-transformer.html) æ¶æ„ï¼Œè¿™æ˜¯ä¸€ä¸ª*è½¬æ¢å™¨*æ¨¡å‹ï¼Œæ—¨åœ¨é«˜æ•ˆå¤„ç†*è¶…é•¿åºåˆ—*çš„æ•°æ®(ä¾‹å¦‚ä¸€ç§è¯­è¨€å¤„ç†å¤šè¾¾ 100 ä¸‡ä¸ªå•è¯)ã€‚Reformer çš„æ‰§è¡Œéœ€è¦ä½å¾—å¤šçš„å†…å­˜æ¶ˆè€—ï¼Œå³ä½¿åªåœ¨ä¸€ä¸ª GPU ä¸Šè¿è¡Œä¹Ÿèƒ½è·å¾—ä»¤äººå°è±¡æ·±åˆ»çš„æ€§èƒ½ã€‚è®ºæ–‡[*æ”¹é©è€…:é«˜æ•ˆçš„å˜é©è€…*](https://arxiv.org/pdf/2001.04451.pdf) *r* å°†äº 2020 å¹´åœ¨ ICLR äº®ç›¸(å¹¶åœ¨è¯„è®ºä¸­è·å¾—è¿‘ä¹å®Œç¾çš„åˆ†æ•°)ã€‚*æ”¹é©å®¶*æ¨¡å‹æœ‰æœ›é€šè¿‡è¶…è¶Šè¯­è¨€åº”ç”¨(å¦‚éŸ³ä¹ã€è¯­éŸ³ã€å›¾åƒå’Œè§†é¢‘ç”Ÿæˆ)å¯¹è¯¥é¢†åŸŸäº§ç”Ÿé‡å¤§å½±å“ã€‚**

**ğŸ’¡åœ¨æœ¬å¸–ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•æ·±å…¥åˆ° ***é‡æ•´å™¨æ¨¡å‹*** ä¸­ï¼Œå¹¶å°è¯•ç”¨ä¸€äº›è§†è§‰å‘å¯¼æ¥ç†è§£å®ƒã€‚å‡†å¤‡å¥½äº†å—ï¼ŸğŸ’ª**

## **ä¸ºä»€ä¹ˆæ˜¯å˜å½¢é‡‘åˆšï¼Ÿ**

**ğŸ¬NLP ä¸­çš„ä¸€ç±»ä»»åŠ¡(å¦‚æœºå™¨ç¿»è¯‘ã€æ–‡æœ¬ç”Ÿæˆã€é—®é¢˜å›ç­”)å¯ä»¥å…¬å¼åŒ–ä¸º[åºåˆ—åˆ°åºåˆ—å­¦ä¹ é—®é¢˜](https://papers.nips.cc/paper/5346-sequence-to-sequence-learning-with-neural-networks.pdf)ã€‚é•¿çŸ­æœŸè®°å¿†(LSTM)ç¥ç»ç½‘ç»œï¼Œåæ¥é…å¤‡äº†ä¸€ä¸ª[æ³¨æ„åŠ›æœºåˆ¶](http://Neural machine translation by jointly learning to align and translate.)ï¼Œæ˜¯ä¸€ä¸ªç”¨äºå»ºç«‹æ­¤ç±»é—®é¢˜é¢„æµ‹æ¨¡å‹çš„çªå‡ºæ¶æ„â€”â€”ä¾‹å¦‚åœ¨[è°·æ­Œçš„ç¥ç»æœºå™¨ç¿»è¯‘ç³»ç»Ÿ](https://arxiv.org/pdf/1609.08144.pdf)ã€‚ç„¶è€Œï¼ŒLSTMs ä¸­é€’å½’å›ºæœ‰çš„é¡ºåºæ€§è´¨æ˜¯å¯¹æ•°æ®åºåˆ—è¿›è¡Œå¹¶è¡Œè®¡ç®—çš„æœ€å¤§éšœç¢(å°±é€Ÿåº¦å’Œæ¶ˆå¤±æ¢¯åº¦è€Œè¨€)ï¼Œå› æ­¤ï¼Œè¿™äº›æ¶æ„æ— æ³•åˆ©ç”¨é•¿åºåˆ—çš„ä¸Šä¸‹æ–‡ã€‚**

**ğŸš€æœ€è¿‘çš„[å˜å‹å™¨å‹å·](https://ai.googleblog.com/2017/08/transformer-novel-neural-network.html)â€”â€”åœ¨è®ºæ–‡[ä¸­ä»‹ç»çš„â€œæ³¨æ„åŠ›å°±æ˜¯ä½ æ‰€éœ€è¦çš„å…¨éƒ¨â€](https://arxiv.org/abs/1706.03762)â€”â€”é€šè¿‡æ¶ˆé™¤é€’å½’å¹¶å¼•å…¥å¤šå¤´è‡ªæˆ‘æ³¨æ„åŠ›æœºåˆ¶ï¼Œåœ¨è®¸å¤šä»»åŠ¡ä¸­å®ç°äº†æœ€å…ˆè¿›çš„æ€§èƒ½ã€‚transformer çš„ä¸»è¦æ–°é¢–ä¹‹å¤„åœ¨äºå®ƒçš„å¹¶è¡Œå¤„ç†èƒ½åŠ›ï¼Œè¿™ä½¿å¾—èƒ½å¤Ÿå¤„ç†é•¿åºåˆ—(å…·æœ‰æ•°åƒä¸ªå•è¯çš„ä¸Šä¸‹æ–‡çª—å£)ï¼Œä»è€Œä»¥æ›´å°‘çš„è®­ç»ƒæ—¶é—´äº§ç”Ÿå“è¶Šçš„æ¨¡å‹ï¼Œå¦‚è‘—åçš„ [Open AI çš„ GPT2 è¯­è¨€æ¨¡å‹](https://openai.com/blog/better-language-models/)ã€‚ğŸ¤—Huggingface çš„[å˜å½¢é‡‘åˆšåº“](https://github.com/huggingface/transformers)â€”â€”æ‹¥æœ‰ 100 å¤šç§è¯­è¨€çš„è¶…è¿‡ 32 ä¸ªé¢„è®­ç»ƒæ¨¡å‹ä»¥åŠ TensorFlow å’Œ PyTorch ä¹‹é—´çš„äº’æ“ä½œæ€§â€”â€”æ˜¯æ„å»ºæœ€å…ˆè¿›çš„ NLP ç³»ç»Ÿçš„ä¸€é¡¹å‡ºè‰²çš„å¼€æºå·¥ä½œã€‚ğŸ®[ç”¨å˜å½¢é‡‘åˆšå†™ä½œ](https://transformer.huggingface.co/)å’Œ[ä¸å˜å½¢é‡‘åˆšå¯¹è¯](https://talktotransformer.com/)æ˜¯ä¸€äº›æœ‰è¶£çš„æ¼”ç¤ºã€‚è¿™ä¸ªè½¬æ¢å™¨å·²ç»è¢«ç”¨äºæ–‡æœ¬ä¹‹å¤–çš„åº”ç”¨ï¼Œä¾‹å¦‚[ç”ŸæˆéŸ³ä¹](https://magenta.tensorflow.org/music-transformer)å’Œ[å›¾åƒ](https://ai.google/research/pubs/pub46840/)ã€‚**

## **å˜å½¢é‡‘åˆšå°‘äº†ä»€ä¹ˆï¼Ÿ**

**ğŸš¦åœ¨æ·±å…¥ç ”ç©¶é‡æ•´å™¨ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ transformer æ¨¡å‹çš„æŒ‘æˆ˜æ€§ã€‚è¿™éœ€è¦å¯¹ transformer ä½“ç³»ç»“æ„æœ¬èº«æœ‰æ‰€äº†è§£ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­æ— æ³•è¯¦è¿°ã€‚ç„¶è€Œï¼Œå¦‚æœä½ è¿˜ä¸çŸ¥é“ï¼ŒJay Alamar çš„[The Illustrated Transformer](http://jalammar.github.io/illustrated-transformer/)å¸–å­æ˜¯è¿„ä»Šä¸ºæ­¢æœ€ä¼Ÿå¤§çš„è§†è§‰è§£é‡Šï¼Œæˆ‘å¼ºçƒˆå»ºè®®åœ¨é˜…è¯»è¿™ç¯‡å¸–å­çš„å…¶ä½™éƒ¨åˆ†ä¹‹å‰é˜…è¯»ä»–çš„å¸–å­ã€‚**

**ğŸ¤”è™½ç„¶ transformer æ¨¡å‹åœ¨è¶Šæ¥è¶Šé•¿çš„åºåˆ—ä¸Šä½¿ç”¨æ—¶äº§ç”Ÿäº†å¾ˆå¥½çš„ç»“æœï¼Œä¾‹å¦‚(Liu ç­‰äººï¼Œ2018 å¹´)ä¸­çš„ 11K é•¿çš„æ–‡æœ¬ç¤ºä¾‹ï¼Œä½†è®¸å¤šè¿™æ ·çš„å¤§å‹æ¨¡å‹åªèƒ½åœ¨å¤§å‹å·¥ä¸šè®¡ç®—å¹³å°ä¸Šè®­ç»ƒï¼Œç”šè‡³ä¸èƒ½åœ¨å•ä¸ª GPU ä¸Šè¿›è¡Œå¾®è°ƒï¼Œå³ä½¿æ˜¯é’ˆå¯¹å•ä¸ªè®­ç»ƒæ­¥éª¤ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦å†…å­˜ã€‚ä¾‹å¦‚ï¼Œå®Œæ•´çš„ GPT-2 æ¨¡å‹åŒ…å«å¤§çº¦ 1.5 äº¿ä¸ªå‚æ•°ã€‚(Shazeer ç­‰äººï¼Œ2018 å¹´)ä¸­æŠ¥å‘Šçš„æœ€å¤§é…ç½®ä¸­çš„å‚æ•°æ•°é‡è¶…è¿‡æ¯å±‚ 0.5Bï¼Œè€Œå±‚çš„æ•°é‡é«˜è¾¾ 64(Al-Rfou ç­‰äººï¼Œ2018 å¹´)ã€‚**

**ğŸ’¡è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å˜å‹å™¨æ¨¡å‹çš„ç®€åŒ–æ¦‚è¿°:**

**![](img/cf0e26672a356d7f24d5a53c3b898d1f.png)**

**å›¾ 2:æ ‡å‡†å˜å‹å™¨æ¨¡å‹çš„ç®€åŒ–æ€»ç»“[å›¾ç‰‡çµæ„Ÿæ¥è‡ªâ€˜å›¾è§£å˜å‹å™¨â€™]**

**ğŸ˜•å¦‚æœè¿™ä¸ªæ¨¡å‹çœ‹èµ·æ¥ä¸ç†Ÿæ‚‰æˆ–ä¼¼ä¹éš¾ä»¥ç†è§£ï¼Œæˆ‘æ•¦ä¿ƒä½ åœ¨è¿™é‡Œåœä¸‹æ¥ï¼Œå¹¶å®¡æŸ¥â¡ï¸ [çš„æ’å›¾å˜å‹å™¨](http://jalammar.github.io/illustrated-transformer/)èŒä½ã€‚**

**ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æœ‰ä¸€äº›ğŸ‘“åœ¨å›¾è¡¨ä¸­ç”¨ä¸‰ç§ä¸åŒçš„é¢œè‰²ã€‚æ¯ä¸ªéƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ğŸ‘“s ä»£è¡¨äº† Transformer æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼ŒReformer ä½œè€…å°†å…¶è§†ä¸ºè®¡ç®—å’Œå†…å­˜é—®é¢˜çš„æ¥æº:**

## **ğŸ‘€é—®é¢˜ 1(çº¢è‰²ğŸ‘“):æ³¨æ„åŠ›è®¡ç®—**

**è®¡ç®—é•¿åº¦ä¸º *L* çš„åºåˆ—ä¸Šçš„æ³¨æ„åŠ›æ˜¯ *O(L* )(æ—¶é—´å’Œå†…å­˜éƒ½æœ‰)ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªé•¿åº¦ä¸º 64K çš„åºåˆ—ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚**

## **ğŸ‘€é—®é¢˜ 2(é»‘è‰²ğŸ‘“):å¤§é‡çš„å±‚**

**å…·æœ‰ *N* å±‚çš„æ¨¡å‹æ¶ˆè€—çš„å†…å­˜æ˜¯å•å±‚æ¨¡å‹çš„ *N* å€ï¼Œå› ä¸ºæ¯ä¸€å±‚ä¸­çš„æ¿€æ´»éƒ½éœ€è¦å­˜å‚¨ç”¨äºåå‘ä¼ æ’­ã€‚**

## **ğŸ‘€é—®é¢˜ 3(ç»¿è‰²ğŸ‘“):å‰é¦ˆå±‚çš„æ·±åº¦**

**ä¸­é—´å‰é¦ˆå±‚çš„æ·±åº¦é€šå¸¸æ¯”æ³¨æ„æ¿€æ´»çš„æ·±åº¦å¤§å¾—å¤šã€‚**

**é‡æ•´å™¨æ¨¡å‹è§£å†³äº†ä¸Šè¿°*è½¬æ¢å™¨ä¸­å†…å­˜æ¶ˆè€—çš„ä¸‰ä¸ª*ä¸»è¦æ¥æºï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œäº†æ”¹è¿›ï¼Œä½¿å¾—é‡æ•´å™¨æ¨¡å‹å¯ä»¥å¤„ç†é«˜è¾¾*100 ä¸‡å­—*çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œæ‰€æœ‰è¿™äº›éƒ½åœ¨*å•ä¸ªåŠ é€Ÿå™¨*ä¸Šï¼Œå¹¶ä¸”ä»…ä½¿ç”¨ *16GB å†…å­˜ã€‚***

> **ç®€è€Œè¨€ä¹‹ï¼Œé‡æ•´å™¨æ¨¡å‹ç»“åˆäº†ä¸¤ç§æŠ€æœ¯æ¥è§£å†³æ³¨æ„åŠ›å’Œå†…å­˜åˆ†é…çš„é—®é¢˜:[ä½ç½®æ•æ„Ÿå“ˆå¸Œ](https://en.wikipedia.org/wiki/Locality-sensitive_hashing) (LSH)æ¥é™ä½å¤„ç†é•¿åºåˆ—çš„å¤æ‚æ€§ï¼Œä»¥åŠ[å¯é€†å‰©ä½™å±‚](https://arxiv.org/abs/1707.04585)æ¥æ›´æœ‰æ•ˆåœ°ä½¿ç”¨å¯ç”¨å†…å­˜ã€‚**

**ä¸‹é¢æˆ‘ä»¬å°†è¿›ä¸€æ­¥æ¢è®¨ç»†èŠ‚ã€‚**

# **ğŸ’¥ 1.åŒºåˆ†ä½ç½®å“ˆå¸Œ(LSH)æ³¨æ„**

## **ğŸ’­æ³¨æ„å’Œæœ€è¿‘çš„é‚»å±…**

**æ·±åº¦å­¦ä¹ ä¸­çš„æ³¨æ„åŠ›æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒä½¿ç½‘ç»œèƒ½å¤Ÿæ ¹æ®ä¸Šä¸‹æ–‡çš„ä¸åŒéƒ¨åˆ†ä¸å½“å‰æ—¶é—´æ­¥é•¿çš„ç›¸å¯¹æ€§ï¼Œä¸“æ³¨äºä¸Šä¸‹æ–‡çš„ä¸åŒéƒ¨åˆ†ã€‚å˜å‹å™¨æ¨¡å‹ä¸­å­˜åœ¨ä»¥ä¸‹ä¸‰ç§ç±»å‹çš„æ³¨æ„æœºåˆ¶:**

**![](img/48ebfe45c78194359c2d1b987d201fa6.png)**

**å›¾ 3:å˜å½¢é‡‘åˆšæ¨¡å‹ä¸­çš„ä¸‰ç§æ³¨æ„åŠ›**

**å˜å‹å™¨ä¸­ä½¿ç”¨çš„æ ‡å‡†æ³¨æ„åŠ›æ˜¯ç¼©æ”¾çš„ç‚¹ç§¯ï¼Œå…¬å¼å¦‚ä¸‹:**

**![](img/f77a18ac50e2b4f1d532d335083c3608.png)**

**ä»ä¸Šå¼å’Œä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼Œä¹˜æ³• *QKáµ€* (å½¢çŠ¶ä¸º[ *Lï¼ŒL* )çš„è®¡ç®—å’Œå†…å­˜å¼€é”€éƒ½åœ¨ *O(L)ï¼Œ*è¿™æ˜¯ä¸»è¦çš„å†…å­˜ç“¶é¢ˆã€‚**

**![](img/6989125546b077c5e2602d2405a2d084.png)**

**å›¾ 4:(å·¦):ç‚¹ç§¯æ³¨æ„åŠ›çš„ä¸»è¦è®¡ç®—ï¼Œ(å³)ä¸€ä¸ªæ ‡è®°(â€˜å®ƒâ€™)æ³¨æ„åºåˆ—ä¸­å…¶ä»–æ ‡è®°çš„å­é›†(â€˜theâ€™ï¼Œâ€˜animalâ€™ï¼Œâ€˜streetâ€™ï¼Œâ€˜itâ€™ï¼Œâ€™.â€™)**

**â“But æ˜¯å¦æœ‰å¿…è¦è®¡ç®—å’Œå­˜å‚¨å…¨çŸ©é˜µ *QKáµ€* ï¼Ÿç­”æ¡ˆæ˜¯*ä¸ï¼Œ*å› ä¸ºæˆ‘ä»¬åªå¯¹ *softmax* ( *QKáµ€* )æ„Ÿå…´è¶£ï¼Œå®ƒç”±å…¸å‹ç¨€ç–çŸ©é˜µä¸­çš„æœ€å¤§å…ƒç´ æ”¯é…ã€‚å› æ­¤ï¼Œæ­£å¦‚ä½ åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­çœ‹åˆ°çš„ï¼Œå¯¹äºæ¯ä¸ªæŸ¥è¯¢ *q* ï¼Œæˆ‘ä»¬åªéœ€è¦æ³¨æ„æœ€æ¥è¿‘ *q* çš„é”® *k* ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ *K* çš„é•¿åº¦ä¸º 64Kï¼Œå¯¹äºæ¯ä¸ª *q* ï¼Œæˆ‘ä»¬åªèƒ½è€ƒè™‘ 32 æˆ– 64 ä¸ªæœ€æ¥è¿‘çš„é”®çš„ä¸€ä¸ªå°å­é›†ã€‚å› æ­¤ï¼Œæ³¨æ„åŠ›æœºåˆ¶æ‰¾åˆ°äº†æŸ¥è¯¢çš„æœ€è¿‘é‚»å…³é”®å­—ï¼Œä½†æ˜¯æ•ˆç‡å¾ˆä½ã€‚ğŸ’¡è¿™æ˜¯å¦è®©ä½ æƒ³èµ·äº†*æœ€è¿‘é‚»æœç´¢*ï¼Ÿ**

**é‡æ•´å™¨çš„ç¬¬ä¸€ä¸ªæ–°é¢–ä¹‹å¤„æ¥è‡ªäºç”¨*å±€éƒ¨æ•æ„Ÿæ•£åˆ—(LSH)* ä»£æ›¿ç‚¹ç§¯å…³æ³¨ï¼Œå°†å¤æ‚åº¦ä» *O* ( *L* )å˜ä¸º O( *L log L* )ã€‚**

## **æœ€è¿‘é‚»æœç´¢çš„ğŸ—’ LSH**

**LSH æ˜¯åœ¨*é«˜ç»´*æ•°æ®é›†ä¸­*æœ€è¿‘é‚»æœç´¢*çš„ä¸€ç§*é«˜æ•ˆ*å’Œ*è¿‘ä¼¼*æ–¹å¼çš„è‘—åç®—æ³•ã€‚LSH èƒŒåçš„ä¸»è¦æ€æƒ³æ˜¯é€‰æ‹©*æ•£åˆ—*å‡½æ•°ï¼Œä½¿å¾—å¯¹äºä¸¤ç‚¹' *p'* å’Œ' *q'* ï¼Œå¦‚æœ' *q'* æ¥è¿‘' *p'* ï¼Œé‚£ä¹ˆä»¥è¶³å¤Ÿå¥½çš„æ¦‚ç‡æˆ‘ä»¬å¾—åˆ°' *hash(q) == hash(p)'ã€‚***

**å®ç°è¿™ä¸€ç‚¹çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯é€šè¿‡éšæœºè¶…å¹³é¢ä¿æŒåˆ‡å‰²ç©ºé—´ï¼Œå¹¶é™„åŠ  *sign(páµ€H)* ä½œä¸ºæ¯ä¸ªç‚¹çš„æ•£åˆ—ç ã€‚è®©æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­:**

**![](img/7e6e3394252c16f9b8f20d89602157da.png)**

**å›¾ 5:ç”¨äºæœ€è¿‘é‚»å±…æœç´¢çš„ä½ç½®æ•æ„Ÿæ•£åˆ—çš„ç®€åŒ–åŠ¨ç”»**

**ä¸€æ—¦æˆ‘ä»¬æ‰¾åˆ°æ‰€éœ€é•¿åº¦çš„å“ˆå¸Œç ï¼Œæˆ‘ä»¬å°±æ ¹æ®å®ƒä»¬çš„å“ˆå¸Œç å°†è¿™äº›ç‚¹åˆ’åˆ†åˆ°æ¡¶ä¸­â€”â€”åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ*â€˜aâ€™*å’Œ*â€˜bâ€™*å±äºåŒä¸€ä¸ªæ¡¶ï¼Œå› ä¸º *hash(a) == hash(b)* ã€‚ç°åœ¨ï¼Œç”¨äºæŸ¥æ‰¾æ¯ä¸ªç‚¹çš„æœ€è¿‘é‚»å±…çš„æœç´¢ç©ºé—´ä»æ•´ä¸ªæ•°æ®é›†åˆ°å…¶æ‰€å±çš„æ¡¶ä¸­æ€¥å‰§å‡å°‘ã€‚**

****ğŸ—’è§’åº¦ LSH:** æ™®é€š LSH ç®—æ³•çš„ä¸€ç§å˜ä½“ï¼Œç§°ä¸º*è§’åº¦ LSHï¼Œ*å°†ç‚¹æŠ•å½±åˆ°å•ä½çƒä¸Šï¼Œè¯¥å•ä½çƒå·²è¢«åˆ†æˆé¢„å®šä¹‰çš„åŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå…·æœ‰ä¸åŒçš„ä»£ç ã€‚ç„¶åï¼Œç‚¹çš„ä¸€ç³»åˆ—éšæœºæ—‹è½¬å®šä¹‰äº†ç‚¹æ‰€å±çš„æ¡¶ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€åŒ–çš„ 2D ä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹ï¼Œè¿™ä¸ªä¾‹å­æ‘˜è‡ªã€Šæ”¹é©å®¶ã€‹ä¸€æ–‡:**

**![](img/c5e3f6cecf92bfe009039150deaf3cfc.png)**

**å›¾ 6:æœ€è¿‘é‚»æœç´¢çš„è§’åº¦ LSH çš„ç®€åŒ–åŠ¨ç”»:ä¸¤ä¸ªç‚¹æ˜¯åˆ†å¼€çš„[åŸºäºè®ºæ–‡ä¸­çš„ä¾‹å­åˆ›å»ºçš„åŠ¨ç”»]**

**è¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç‚¹è¢«æŠ•å½±åˆ°ä¸€ä¸ªå•ä½åœ†ä¸Šï¼Œå¹¶ä»¥ä¸åŒçš„è§’åº¦éšæœºæ—‹è½¬ 3 æ¬¡ã€‚æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°å®ƒä»¬ä¸å¤ªå¯èƒ½å…±äº«åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ã€‚ç„¶è€Œï¼Œåœ¨ä¸‹ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å½¼æ­¤éå¸¸æ¥è¿‘çš„ä¸¤ä¸ªç‚¹å°†åœ¨ 3 æ¬¡éšæœºæ—‹è½¬åå…±äº«ç›¸åŒçš„å“ˆå¸Œæ¡¶:**

**![](img/ca86ccd9e78acdd9c7e575f57482734e.png)**

**å›¾ 7:æœ€è¿‘é‚»å±…æœç´¢çš„è§’åº¦ LSH çš„ç®€åŒ–åŠ¨ç”»:ä¸¤ä¸ªç‚¹æ¥è¿‘[åŸºäºè®ºæ–‡ä¸­çš„ä¾‹å­åˆ›å»ºçš„åŠ¨ç”»]**

## **ğŸš€LSH æ³¨æ„äº†**

**ç°åœ¨ LSH å…³æ³¨*èƒŒåçš„åŸºæœ¬æƒ³æ³•*å¦‚ä¸‹ã€‚å›è¿‡å¤´æ¥çœ‹ä¸Šé¢çš„æ ‡å‡†æ³¨æ„åŠ›å…¬å¼ï¼Œä¸æ˜¯è®¡ç®— *Q* å’Œ *K* çŸ©é˜µä¸­æ‰€æœ‰å‘é‡çš„æ³¨æ„åŠ›ï¼Œè€Œæ˜¯è¿›è¡Œä»¥ä¸‹æ“ä½œ:**

*   **æ‰¾åˆ°çŸ©é˜µ *Q* å’Œ *K* çš„ LSH æ•£åˆ—ã€‚**
*   **ä»…ä¸ºç›¸åŒå“ˆå¸Œæ¡¶å†…çš„ *k* å’Œ *q* å‘é‡è®¡ç®—æ ‡å‡†æ³¨æ„åŠ›ã€‚**

****å¤šè½® LSH æ³¨æ„:**é‡å¤ä¸Šè¿°æ­¥éª¤å‡ æ¬¡ï¼Œä»¥å¢åŠ ç›¸ä¼¼ç‰©å“ä¸è½å…¥ä¸åŒæ¡¶ä¸­çš„æ¦‚ç‡ã€‚**

**ä¸‹é¢çš„åŠ¨ç”»æ ¹æ®è®ºæ–‡ä¸­çš„å›¾ç‰‡å±•ç¤ºäº†ç®€åŒ–ç‰ˆçš„ LSH æ³¨æ„åŠ›ã€‚**

**![](img/ec08fb5b5ca3b2c2e079d3c095b64fc1.png)**

**å›¾ 6:LSH æ³¨æ„åŠ›æœºåˆ¶çš„ç®€åŒ–ç¤ºæ„å›¾[æ ¹æ®è®ºæ–‡ä¸­çš„ä¾‹å­åˆ¶ä½œçš„åŠ¨ç”»]**

# **ğŸ’¥ 2.å¯é€†å˜å‹å™¨å’Œç»„å—**

**ç°åœ¨æˆ‘ä»¬å‡†å¤‡è§£å†³å˜å‹å™¨ä¸­çš„ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œå³å¤§é‡( *N* )ç¼–ç å™¨å’Œè§£ç å™¨å±‚ä»¥åŠå‰é¦ˆå±‚çš„æ·±åº¦ã€‚**

## **ğŸ—’å¯é€†æ®‹å·®ç½‘ç»œ**

**å¯†åˆ‡å…³æ³¨å›¾ 2 ä¸­çš„ç¼–ç å™¨å’Œè§£ç å™¨å—ï¼Œæˆ‘ä»¬æ„è¯†åˆ°æ¯ä¸ªå…³æ³¨å±‚å’Œå‰é¦ˆå±‚éƒ½è¢«åŒ…è£…åˆ°ä¸€ä¸ª*æ®‹å·®å—*(ç±»ä¼¼äºæˆ‘ä»¬åœ¨å›¾ 6(å·¦)ä¸­çœ‹åˆ°çš„)ã€‚*æ®‹å·®ç½‘ç»œ*(*ResNet*s)â€”â€”åœ¨è¿™ç¯‡[è®ºæ–‡](https://arxiv.org/pdf/1512.03385.pdf)ä¸­ä»‹ç»â€”â€”æ˜¯ NN æ¶æ„ä¸­ä½¿ç”¨çš„å¼ºå¤§ç»„ä»¶ï¼Œç”¨äºå¸®åŠ©è§£å†³æ·±åº¦ç½‘ç»œ(å…·æœ‰è®¸å¤šå±‚)ä¸­çš„[æ¶ˆå¤±æ¢¯åº¦é—®é¢˜](https://en.wikipedia.org/wiki/Vanishing_gradient_problem)ã€‚ç„¶è€Œï¼ŒResNets ä¸­çš„å†…å­˜æ¶ˆè€—æ˜¯ä¸€ä¸ªç“¶é¢ˆï¼Œå› ä¸ºéœ€è¦*å°†æ¯å±‚ä¸­çš„æ¿€æ´»å­˜å‚¨åœ¨å†…å­˜*ä¸­ï¼Œä»¥ä¾¿åœ¨åå‘ä¼ æ’­æœŸé—´è®¡ç®—æ¢¯åº¦ã€‚å­˜å‚¨æˆæœ¬ä¸ç½‘ç»œä¸­å•å…ƒçš„æ•°é‡æˆæ­£æ¯”ã€‚**

**ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”±ä¸€ç³»åˆ—*å¯é€†æ¨¡å—*ç»„æˆçš„[å¯é€†æ®‹å·®ç½‘ç»œ(RevNet](https://papers.nips.cc/paper/6816-the-reversible-residual-network-backpropagation-without-storing-activations.pdf) )ã€‚åœ¨ Revnet ä¸­ï¼Œæ¯ä¸€å±‚çš„æ¿€æ´»éƒ½å¯ä»¥ä»åç»­å±‚çš„æ¿€æ´»ä¸­ç²¾ç¡®é‡å»ºï¼Œè¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ‰§è¡Œåå‘ä¼ æ’­ï¼Œè€Œæ— éœ€å°†æ¿€æ´»å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚å›¾ 6ã€‚è¯´æ˜äº†æ®‹å·®å—å’Œå¯é€†æ®‹å·®å—ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¦‚ä½•ä»æ¨¡å—çš„è¾“å‡º( *Yâ‚ï¼ŒYâ‚‚* )è®¡ç®—æ¨¡å—çš„è¾“å…¥( *Xâ‚ï¼ŒXâ‚‚* )ã€‚**

**![](img/4e82ccc468dd03256f6bd81e8ace54c4.png)**

**å›¾ 6:*æ®‹å·®ç½‘ç»œ*å—(å·¦)å’Œå¯é€†æ®‹å·®å—(å³)ç¤ºæ„å›¾**

## **ğŸš€å¯é€†å˜å‹å™¨**

**å›åˆ°æˆ‘ä»¬çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯å¤„ç† *N* å±‚å˜å‹å™¨ç½‘ç»œçš„å†…å­˜éœ€æ±‚â€”â€”N å¯èƒ½ç›¸å½“å¤§ã€‚**

**Reformer é€šè¿‡å°† RevNet å—å†…çš„*æ³¨æ„*å’Œ*å‰é¦ˆ*å±‚ç»“åˆèµ·æ¥ï¼Œå°† RevNet æ€æƒ³åº”ç”¨äºå˜å‹å™¨ã€‚åœ¨å›¾ 6 ä¸­ï¼Œç°åœ¨ *F* æˆä¸ºå…³æ³¨å±‚ï¼Œ *G* æˆä¸ºå‰é¦ˆå±‚:**

***yâ‚=xâ‚+attention(xâ‚‚)
yâ‚‚= xâ‚‚+feedforward(yâ‚)***

**ğŸ‰ç°åœ¨ä½¿ç”¨å¯é€†æ®‹å·®å±‚ä»£æ›¿æ ‡å‡†æ®‹å·®ä½¿å¾—åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­åªå­˜å‚¨ä¸€æ¬¡æ¿€æ´»è€Œä¸æ˜¯ N æ¬¡*T42ã€‚***

## **ğŸš€ç»„å—**

**é‡æ•´å™¨ä¸­æ•ˆç‡æ”¹è¿›çš„æœ€åä¸€éƒ¨åˆ†å¤„ç†ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œå³å‰é¦ˆå±‚çš„é«˜ç»´ä¸­é—´å‘é‡ï¼Œå…¶å¯ä»¥è¾¾åˆ° 4K æˆ–æ›´é«˜ç»´ã€‚**

**ç”±äºå‰é¦ˆå±‚ä¸­çš„è®¡ç®—ç‹¬ç«‹äºåºåˆ—ä¸­çš„å„ä¸ªä½ç½®ï¼Œå› æ­¤å‰å‘å’Œåå‘ä¼ é€’çš„è®¡ç®—ä»¥åŠåå‘è®¡ç®—éƒ½å¯ä»¥åˆ†æˆå—ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå‘å‰ä¼ çƒï¼Œæˆ‘ä»¬å°†æœ‰:**

**![](img/9eb0c2b4e1f3bd85efe0d5a59334800d.png)**

**å‰å‘ä¼ é€’è®¡ç®—ä¸­çš„åˆ†å—[å›¾ç‰‡å–è‡ª Reformer è®ºæ–‡]**

# **ğŸš€å®éªŒç»“æœ**

**ä½œè€…å¯¹ä¸¤ä¸ªä»»åŠ¡è¿›è¡Œäº†å®éªŒ:å›¾åƒç”Ÿæˆä»»åŠ¡ *imagenet64* (åºåˆ—é•¿åº¦ä¸º 12K)å’Œæ–‡æœ¬ä»»åŠ¡ *enwik8* (åºåˆ—é•¿åº¦ä¸º 64K)ï¼Œå¹¶è¯„ä¼°äº†å¯é€†å˜æ¢å’Œ LSH å“ˆå¸Œå¯¹å†…å­˜ã€å‡†ç¡®æ€§å’Œé€Ÿåº¦çš„å½±å“ã€‚**

**ğŸ‰å¯é€†å˜å‹å™¨åŒ¹é…åŸºçº¿:ä»–ä»¬çš„å®éªŒç»“æœè¡¨æ˜ï¼Œå¯é€†å˜å‹å™¨èŠ‚çœå†…å­˜è€Œä¸ç‰ºç‰²å‡†ç¡®æ€§:**

**![](img/c4635f1976e00fb12976e76a5ec1c68a.png)**

**å¯é€†æ€§å¯¹ enwik8 å’Œ imagenet64 è®­ç»ƒè¡¨ç°çš„å½±å“[å›¾ç‰‡å’Œè¯´æ˜å–è‡ª Reformer è®ºæ–‡]ã€‚**

**ğŸ‰LSH å…³æ³¨åº¦ä¸åŸºçº¿ç›¸ç¬¦:ğŸ“”æ³¨æ„ï¼Œç”±äº LSH æ³¨æ„åŠ›æ˜¯å®Œå…¨æ³¨æ„åŠ›çš„è¿‘ä¼¼ï¼Œå…¶å‡†ç¡®æ€§éšç€å“ˆå¸Œå€¼çš„å¢åŠ è€Œæé«˜ã€‚å½“å“ˆå¸Œå€¼ä¸º 8 æ—¶ï¼ŒLSH æ³¨æ„åŠ›å‡ ä¹ç­‰åŒäºå®Œå…¨æ³¨æ„åŠ›:**

**![](img/4d9665d0c9895fa9fb6dd764844b4961.png)**

**LSH æ³¨æ„åŠ›åœ¨ imagenet64 ä¸Šä½œä¸ºæ•£åˆ—å›åˆçš„å‡½æ•°çš„æ•ˆæœ[å›¾åƒå’Œè¯´æ˜å–è‡ª Reformer è®ºæ–‡]ã€‚**

**ğŸ‰ä»–ä»¬è¿˜è¯æ˜ï¼Œéšç€åºåˆ—é•¿åº¦çš„å¢åŠ ï¼Œå¸¸è§„æ³¨æ„åŠ›ä¼šå˜æ…¢ï¼Œè€Œ LSH æ³¨æ„åŠ›é€Ÿåº¦ä¿æŒç¨³å®šï¼Œå®ƒåœ¨ 8GB GPUs ä¸Šä»¥é€šå¸¸çš„é€Ÿåº¦è¿è¡Œäºé•¿åº¦çº¦ä¸º 100K çš„åºåˆ—ä¸Š:**

**![](img/7786ba547c79d9599d2a7a9d54aaa94b.png)**

**æ³¨æ„åŠ›è¯„ä¼°çš„é€Ÿåº¦æ˜¯å®Œå…¨æ³¨æ„åŠ›å’Œ LSH æ³¨æ„åŠ›è¾“å…¥é•¿åº¦çš„å‡½æ•°ã€‚**

> **ä¸å˜å‹å™¨æ¨¡å‹ç›¸æ¯”ï¼Œæœ€ç»ˆçš„é‡æ•´å™¨æ¨¡å‹è¡¨ç°ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨é•¿åºåˆ—ä¸Šæ˜¾ç¤ºå‡ºæ›´é«˜çš„å­˜å‚¨æ•ˆç‡å’Œæ›´å¿«çš„é€Ÿåº¦ã€‚**

# **ğŸ’»Trax:ä»£ç å’Œç¤ºä¾‹**

**ğŸ¤–é‡æ•´å™¨çš„[ä»£ç ](https://github.com/google/trax/tree/master/trax/models/reformer)å·²ç»ä½œä¸ºæ–°çš„ [***Trax***](https://github.com/google/trax/tree/master/trax/) åº“çš„ä¸€éƒ¨åˆ†å‘å¸ƒã€‚Trax æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„æ·±åº¦å­¦ä¹ è®­ç»ƒå’Œæ¨ç†åº“ï¼Œæ—¨åœ¨è®©æ‚¨ä»å¤´å¼€å§‹ç†è§£æ·±åº¦å­¦ä¹ ã€‚é‡æ•´å™¨ä»£ç åŒ…æ‹¬å‡ ä¸ªä¾‹å­ï¼Œæ‚¨å¯ä»¥åœ¨[å›¾åƒç”Ÿæˆ](https://colab.research.google.com/github/google/trax/blob/master/trax/models/reformer/image_generation.ipynb)å’Œ[æ–‡æœ¬ç”Ÿæˆ](https://colab.research.google.com/github/google/trax/blob/master/trax/models/reformer/text_generation.ipynb)ä»»åŠ¡ä¸­è®­ç»ƒå’Œæ¨æ–­ã€‚**

# **ğŸ™æ‰¿è®¤**

**æˆ‘è¦æ„Ÿè°¢ç¥–å¡æ–¯Â·å‡¯æ³½ç”ŸåŠ¨åœ°ä»‹ç»äº†æ”¹é©è€…å¹¶æä¾›äº†è¡¥å……ææ–™ã€‚æˆ‘è¿˜è¦æ„Ÿè°¢ [Abraham Kang](https://medium.com/u/cbc32bf7cff7?source=post_page-----393575ac6ba0--------------------------------) çš„æ·±åˆ»å›é¡¾å’Œå»ºè®¾æ€§åé¦ˆã€‚**

# **ğŸ“šå‚è€ƒèµ„æ–™å’Œç›¸å…³é“¾æ¥:**

**[](https://ai.googleblog.com/2020/01/reformer-efficient-transformer.html) [## æ”¹é©å®¶:é«˜æ•ˆçš„å˜å‹å™¨

### ç†è§£è¿ç»­æ•°æ®â€”â€”å¦‚è¯­è¨€ã€éŸ³ä¹æˆ–è§†é¢‘â€”â€”æ˜¯ä¸€é¡¹å…·æœ‰æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ï¼Œå°¤å…¶æ˜¯å½“æœ‰â€¦

ai.googleblog.com](https://ai.googleblog.com/2020/01/reformer-efficient-transformer.html) [](https://ai.googleblog.com/2017/08/transformer-novel-neural-network.html) [## Transformer:ä¸€ç§ç”¨äºè¯­è¨€ç†è§£çš„æ–°å‹ç¥ç»ç½‘ç»œç»“æ„

### ç¥ç»ç½‘ç»œï¼Œç‰¹åˆ«æ˜¯é€’å½’ç¥ç»ç½‘ç»œ(RNNs)ï¼Œç°åœ¨å¤„äºé¢†å…ˆæ–¹æ³•çš„æ ¸å¿ƒâ€¦

ai.googleblog.com](https://ai.googleblog.com/2017/08/transformer-novel-neural-network.html) 

*   æ”¹é©å®¶:é«˜æ•ˆçš„æ”¹é©å®¶
*   [Google/Trax æ·±åº¦å­¦ä¹ åº“](https://github.com/google/trax/tree/master/trax/)
*   [å›¾ç¤ºå˜å‹å™¨](http://jalammar.github.io/illustrated-transformer/)
*   [æ‹¥æŠ±è„¸/å˜å½¢é‡‘åˆš NLP åº“](https://github.com/huggingface/transformers)
*   ä½ æ‰€éœ€è¦çš„åªæ˜¯æ³¨æ„åŠ›
*   [å¼€æ”¾ AI çš„ GPT2 è¯­è¨€æ¨¡å‹](https://openai.com/blog/better-language-models/)
*   [ç”¨å˜å‹å™¨å†™å­—](https://transformer.huggingface.co/)
*   [ä¸å˜å½¢é‡‘åˆšå¯¹è¯](https://talktotransformer.com/)
*   [è°·æ­Œçš„ç¥ç»æœºå™¨ç¿»è¯‘ç³»ç»Ÿ](https://arxiv.org/pdf/1609.08144.pdf)**