<html>
<head>
<title>Why `True is False is False` -&gt; False?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么`真的是假的是假的`-&gt;假的？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-true-is-false-is-false-false-dc41b11eb27a?source=collection_archive---------46-----------------------#2020-05-31">https://towardsdatascience.com/why-true-is-false-is-false-false-dc41b11eb27a?source=collection_archive---------46-----------------------#2020-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6526aebfbe4a657f6653f16b503ea940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9OYTtA-ZmFoZakEaoD3C9g.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://xkcd.com/221/" rel="noopener ugc nofollow" target="_blank">由 xkcd </a></p></figure><p id="1778" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Python 很酷:在使用了这么多年之后，有一些奇怪的小东西让我感到惊讶。我最近偶然发现了一行非常简单的代码，我所知道的大多数有经验的 python 程序员不通过谷歌搜索就无法解释它。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/29ca1c9d4b0d255a5f9426bb9561d6c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0yrsEfFafDpAG2naJEgGag.png"/></div></div></figure><h2 id="0ec8" class="lj lk it bd ll lm ln dn lo lp lq dp lr kr ls lt lu kv lv lw lx kz ly lz ma mb bi translated">WTF…</h2><p id="b11c" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">为什么令人惊讶？我想这是因为如果一个人被要求执行这个命令，他不会输出这个结果。我是这样推理的。</p><p id="f4a3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我需要执行第一条<code class="fe mh mi mj mk b">is</code>语句，这将给我<code class="fe mh mi mj mk b">False</code>，然后执行第二条<code class="fe mh mi mj mk b">is</code>，这将给我<code class="fe mh mi mj mk b">True.</code>:</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ml"><img src="../Images/faac81cfc560e9217c075dae13618221.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9k8kS4sqqcW0N4-NDj_bCA.png"/></div></div></figure><p id="3548" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了括号，它确实像预期的那样工作。同样，如果你从右到左以相反的顺序做，你会得到同样的结果。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mm"><img src="../Images/3b321f0b22dee62fdaddd69ce0396cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sf1SMfOQ9riJf-YvlfwUXw.png"/></div></div></figure><h2 id="d432" class="lj lk it bd ll lm ln dn lo lp lq dp lr kr ls lt lu kv lv lw lx kz ly lz ma mb bi translated">然后我想…</h2><p id="3fe2" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">也许是<code class="fe mh mi mj mk b">is</code>操作符在与另一个<code class="fe mh mi mj mk b">is</code>组合时执行方式不同。</p><p id="77c6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">python <code class="fe mh mi mj mk b">is</code>操作符所做的是比较对象的 id。当你做<code class="fe mh mi mj mk b">a is b</code>时，你实际上是在问<code class="fe mh mi mj mk b">id(a) == id(b)</code>，即这些是否是相同的对象(不像<code class="fe mh mi mj mk b">a==b</code>只比较值)。Python 的<code class="fe mh mi mj mk b">id</code>操作符实际上<a class="ae kf" href="https://stackoverflow.com/a/16408542/2069858" rel="noopener ugc nofollow" target="_blank">指向存储对象的真实内存地址</a>。</p><p id="b745" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我知道<code class="fe mh mi mj mk b">id</code>有一些意想不到的行为。例如，[-5，256]范围内的整数的 T12 总是相同的，而对于其他整数，它在内存中分配单独的位置。我的意思是:</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ml"><img src="../Images/ef2a8ad3186fe7e9351a71be705e7616.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-yFmUVJdkcveTj4BwpWheg.png"/></div></div></figure><p id="6fda" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是 Python 使用的一种启发式方法。下面是来自<a class="ae kf" href="https://docs.python.org/3/c-api/long.html#c.PyLong_FromLong" rel="noopener ugc nofollow" target="_blank">文档</a>的解释:</p><blockquote class="mn mo mp"><p id="8e54" class="kg kh mq ki b kj kk kl km kn ko kp kq mr ks kt ku ms kw kx ky mt la lb lc ld im bi translated">当前的实现为所有在<code class="fe mh mi mj mk b">-5</code>和<code class="fe mh mi mj mk b">256</code>之间的整数保留了一个 integer 对象数组，当你在这个范围内创建一个 int 时，你实际上只是得到了一个对现有对象的引用。所以应该可以改变<code class="fe mh mi mj mk b">1</code>的值。我怀疑 Python 在这种情况下的行为是不确定的。:)</p></blockquote><p id="638b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我所知道的，但是这里我们处理的是广播到<code class="fe mh mi mj mk b">0</code>和<code class="fe mh mi mj mk b">1</code>的布尔值的比较，它们依次落入[-5，256]范围。事实上，如果你检查一下，它们都指向同一个内存地址。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/4e9379d3ce8246e2cae88c1576e4a1e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BCx2hAzNn4d9sIuANpWyIw.png"/></div></div></figure><p id="527b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以，这肯定是某个用双<code class="fe mh mi mj mk b">is</code>语句把事情搞砸的东西。</p><h2 id="5efc" class="lj lk it bd ll lm ln dn lo lp lq dp lr kr ls lt lu kv lv lw lx kz ly lz ma mb bi translated">啊哈…</h2><p id="cea2" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">然后我问自己:<em class="mq">当你在一个语句中有多个比较操作符时，Python 中实际上发生了什么？</em>以下是<a class="ae kf" href="https://docs.python.org/3/reference/expressions.html#comparisons" rel="noopener ugc nofollow" target="_blank">文档中所说的</a>:</p><blockquote class="mn mo mp"><p id="96e5" class="kg kh mq ki b kj kk kl km kn ko kp kq mr ks kt ku ms kw kx ky mt la lb lc ld im bi translated">形式上，如果<em class="it"> a </em>、<em class="it"> b </em>、<em class="it"> c </em>、…、<em class="it"> y </em>、<em class="it"> z </em>是表达式，<em class="it"> op1 </em>、<em class="it"> op2 </em>、…、<em class="it"> opN </em>是比较运算符，那么<code class="fe mh mi mj mk b">a op1 b op2 c ... y opN z</code>相当于<code class="fe mh mi mj mk b">a op1 b and b op2 c and ... y opN z</code>，只是每个表达式最多求值一次。</p></blockquote><p id="bed0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以实际上发生的是语句<code class="fe mh mi mj mk b">True is False is False</code>被替换为语句<code class="fe mh mi mj mk b">True is False and False is False</code>。显然，第一个<code class="fe mh mi mj mk b">True is False</code>被评估为<code class="fe mh mi mj mk b">False</code>，它决定了最终结果。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/21eb91005b573532e71a22f4bd52e1b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EbyBuktpAE5xWZARfJOSkA.png"/></div></div></figure><p id="abee" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mq">附:如果你喜欢这个故事，可以考虑在 medium 上关注我或者订阅我的</em> <a class="ae kf" href="https://t.me/graphML" rel="noopener ugc nofollow" target="_blank"> <em class="mq">电报频道</em> </a> <em class="mq">或者</em> <a class="ae kf" href="https://twitter.com/SergeyI49013776" rel="noopener ugc nofollow" target="_blank"> <em class="mq">我的 twitter </em> </a> <em class="mq">。</em></p></div></div>    
</body>
</html>