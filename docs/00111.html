<html>
<head>
<title>Anomaly Detection in Python with Gaussian Mixture Models.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于高斯混合模型的Python异常检测。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/understanding-anomaly-detection-in-python-using-gaussian-mixture-model-e26e5d06094b?source=collection_archive---------3-----------------------#2020-01-04">https://towardsdatascience.com/understanding-anomaly-detection-in-python-using-gaussian-mixture-model-e26e5d06094b?source=collection_archive---------3-----------------------#2020-01-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fc2f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这里我们将通过一个例子来学习如何用高斯混合模型实现异常检测。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/11deae5e6aa2ba4362b5a05e5bb6329d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yyazQ3QnW-gj__noFczZMA.png"/></div></div></figure><p id="890e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们需要理解数据集中什么算异常。异常可以被视为数据集中罕见或不寻常的观察结果。例如，在信用卡交易数据集中，欺诈交易是异常的，因为与大型数据集中的正常交易相比，欺诈案例的数量非常少。</p><p id="8252" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在异常检测中，我们试图识别在统计上不同于其余观察的观察。</p><p id="6abe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">今天我们来看看高斯混合模型，这是一种无监督聚类方法。在这种方法中，与K-Means不同，我们对数据进行“K”高斯拟合。然后，我们找到高斯分布参数，如每个聚类的均值和方差以及聚类的权重。最后，对于每个数据点，我们计算属于每个聚类的概率。</p><p id="1d6f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在数学上，我们可以用如下两种方式编写高斯模型:</p><p id="ba5d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">1]单变量情况:一维模型</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/afb2c17a46287f638772b79d7c9ee363.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*pIVuhCDp-p9LPBeMO2IyKw.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">单变量高斯模型</p></figure><p id="ca15" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">和</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/de318921c40174f699f83c8b8718cc3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*sYQEigWG61utVDaOeoEUzQ.png"/></div></figure><p id="385d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">其中<em class="lt"> μk </em> =平均值&amp;T2σk=第k个分量的方差。<em class="lt"> ϕk </em> =聚类‘k’的权重。</p><p id="0ca7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">2]多元案例:多维模型</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/e6fbacfe06672f1d9993b6c92e77844e.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*-iuPfG1VIGqik6AeJ25_WA.png"/></div></figure><p id="85ed" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">其中<em class="lt">μ</em>T8】k= mean&amp;σ<em class="lt">k</em>=第k个分量的协方差矩阵。<em class="lt"> ϕk </em> =聚类‘k’的权重。</p><p id="875c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">总之，该方程描述了K高斯分布的加权平均值。</p><p id="8da0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该算法在这K个集群上训练。因此，给定一个新的数据点，算法找到它与每个分布的距离&amp;从而得到该点属于每个聚类的概率。因此，如果对于特定的聚类，如果概率非常低，则表明数据点是异常的。</p><p id="0e7e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以让我们从实际实现开始吧。</p><p id="dcfd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们将导入所有必要的模块并创建一个数据集。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lv lw l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">Import.py</p></figure><p id="6bc3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里我们使用来自scikit-learn的<strong class="kt ir"> make_blobs </strong>来生成用于聚类的高斯blob。可以在此处找到详细参数的完整文档:</p><div class="lx ly gp gr lz ma"><a href="http://scikit-learn.org/stable/modules/generated/sklearn.datasets.make_blobs.html" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd ir gy z fp mf fr fs mg fu fw ip bi translated">sk learn . datasets . make _ blobs-sci kit-learn 0.22文档</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">sci kit-learn:Python中的机器学习</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">scikit-learn.org</p></div></div><div class="mj l"><div class="mk l ml mm mn mj mo kp ma"/></div></div></a></div><p id="dae0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您得到的输出是一个数据集，其中有些点是主分布的异常值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/5c2a8ad6adad23beca82fb98db80d2ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z8gHhE7Mk5tWXUFdHE6sBA.png"/></div></div></figure><p id="c7e8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的数据集中，我们可以用眼睛发现异常值，但我们应该如何让机器做同样的事情呢？</p><p id="3724" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是高斯估计器的用处。由于我们的数据集只有一个中心，我们将使用单个高斯。如上所述，我们将使用第一个等式来计算数据集的均值和方差。为了做到这一点，我定义了函数，它返回输入分布的均值和方差。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lv lw l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">均值_方差. py</p></figure><p id="efc7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的函数中输入我们的数据集后，</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/5f6036e773227e0a2a7e04ff9e43d34e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*B_GhACRqYzE2wjP_Xq70Wg.png"/></div></figure><p id="44be" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们有了基本的参数，我们将计算每个点，由我们的分布产生的概率。因此，属于同一聚类的点将具有高概率&amp;离群点将具有低概率。</p><p id="b084" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为此，我们有一个函数。我用的代码是标准代码。这很容易理解。我们使用Numpy线性代数模块来实现上面提到的<strong class="kt ir"> N( <em class="lt"> x </em> ∣ <em class="lt"> μi </em>，<em class="lt"> σi </em> ) </strong>方程。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lv lw l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">高斯. py</p></figure><p id="13a6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了可视化这些概率，我们可以用它们的概率绘制相同的数据集，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lv lw l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">plot_prob.py</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/39b66da84fc3488872642dd082223366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v9IvR0KHME4JArae6r9zUQ.png"/></div></div></figure><p id="5995" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以看到，同一个集群中的点有很高的概率&amp;当我们向外走时，即离群值，概率趋于零。</p><p id="df98" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，我们可以选择概率的阈值，将它们标记为异常值。这里我选择它为0.02 &amp;再次绘制数据。该值将根据分布和随机状态而变化。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lv lw l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">mark_outliers.py</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/03ea04fc6cb1fa476183f2335961db2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uj8GadI8pTy13ITHQF30Mw.png"/></div></div></figure><p id="a095" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">太好了！我们的模型在单个集群上表现得相当好。但是，我们可以对多个集群使用相同的策略吗？只有一个方法可以知道:)</p><p id="6907" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里，我使用了与上面生成单个集群相同的代码。唯一的区别是，这里不是1个集群，而是生成5个。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lv lw l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">mixture_data.py</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/7e8aa8722c4fd57a294e6ffab0f5a54a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*VjIKQQAKQB4mRC0KyzVVlw.png"/></div></figure><p id="da1b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，让我们使用与之前相同的方法，看看它的性能如何。代码将是类似的。尝试不同的阈值并观察。这里我将使用一个固定值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lv lw l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">plot_mixture.py</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/8a59f7716d878a5cd56117b9d5163a07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ST-BloWxXvnuzgy51vLVQ.png"/></div></div></figure><p id="3533" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以看到，我们的模型在多个集群上表现糟糕。它没有认识到异常值。这就是为什么现在我们将转移到高斯混合。这里我们使用了<strong class="kt ir">sk learn . mixture . Gaussian mixture .</strong>你可以在这里看到文档。</p><div class="lx ly gp gr lz ma"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.mixture.GaussianMixture.html#sklearn.mixture.GaussianMixture" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd ir gy z fp mf fr fs mg fu fw ip bi translated">sk learn . mixture . Gaussian mixture-sci kit-learn 0 . 22 . 1文档</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">class sk learn . mixture . Gaussian mixture(n _ components = 1，协方差_type='full '，tol=0.001，reg_covar=1e-06…</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">scikit-learn.org</p></div></div><div class="mj l"><div class="mv l ml mm mn mj mo kp ma"/></div></div></a></div><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lv lw l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">高斯_混合物. py</p></figure><p id="05b2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您遵循文档，您将看到<strong class="kt ir"> predict_proba() </strong>方法。我们将使用相同的方法来找出每个点属于五个聚类中任何一个的概率。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lv lw l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">混合物_预测_概率</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/546b50aff86c6958887a77ebd3ed10b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k6P9DqJVMNyPXOyFGGj0Fg.png"/></div></div></figure><p id="59e2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以看到，该模型将点分类到K个聚类<em class="lt"> &amp; </em>之一，这有助于我们识别离群点。我们可以通过找到任何集群都不希望自己拥有的点来做到这一点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/8039227459230607bfea61f7f5493c8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*pJWAIh9fjLzNu657ZL351Q.png"/></div></figure><p id="d1ae" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此公式返回数据点由我们适合的任何一个高斯随机产生的概率。因此，我们想要从上面的公式中过滤掉任何具有低概率的数据点。</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="7400" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你觉得这篇文章有用，请为它鼓掌，它会有很大的帮助！！</p><p id="8157" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">关注我的<a class="ae nf" href="https://medium.com/@agastidukare" rel="noopener"> <strong class="kt ir">中的</strong> </a>获取更多此类教程&amp;文章。</p><p id="4cfa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您想联系，请在<a class="ae nf" href="https://www.linkedin.com/in/agastidukare/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">LinkedIn</strong>T3上添加我。</a></p><p id="d341" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您有任何疑问或发现代码/概念中的任何错误，请随时在评论中写下。这是我的第一个博客，试图与世界分享我在数据科学领域所知道的一切！</p></div></div>    
</body>
</html>