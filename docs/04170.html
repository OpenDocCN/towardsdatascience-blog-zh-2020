<html>
<head>
<title>Pandas Groupby — Explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫分组——解释</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandas-groupby-explained-453692519d0?source=collection_archive---------13-----------------------#2020-04-16">https://towardsdatascience.com/pandas-groupby-explained-453692519d0?source=collection_archive---------13-----------------------#2020-04-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d752" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何高效利用熊猫的分组功能</h2></div><p id="015e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Pandas 是一个非常强大的 Python 数据分析库，可以加速项目的预处理步骤。在这篇文章中，我将用许多例子来介绍熊猫的功能，帮助你全面理解这个功能。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/8969088a7e6a24623fbc42165d9043b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4OpwGSsGyr2b4gcjG4NMqA.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">由<a class="ae lu" href="https://unsplash.com/@markusspiske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae lu" href="https://unsplash.com/s/photos/different-colors?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a689" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Groupby 是一个多功能且易于使用的函数，有助于获得数据的概览。这使得探索数据集和揭示变量之间的潜在关系变得更加容易。</p><p id="10f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Groupby 最好通过例子来解释。我将使用 Kaggle 上可用的客户流失数据集。我只取了其中足以展示 groupby 函数每个细节的一部分。</p><p id="fffc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一如既往，我们从进口熊猫开始:</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="c168" class="ma mb it lw b gy mc md l me mf">import pandas as pd<br/>import numpy as np</span></pre><p id="1386" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们快速看一下数据集:</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="6934" class="ma mb it lw b gy mc md l me mf">df.shape<br/>(7043, 9)</span><span id="5d72" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mh"><img src="../Images/9aa15db7caef0203a3a53a03e4343cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*opXe2Ph-ZQlVhVTrkOln4Q.png"/></div></div></figure><p id="2976" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该数据集包括关于客户以及客户是否离职(即离开公司)的 8 个特征。</p><p id="5e2f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在对数据集应用 groupby 函数之前，让我们先看一个可视化的例子。可视化总是解释概念的好方法。假设我们有两个特征。一个是颜色，它是分类特征，另一个是数值特征，即值。我们希望<strong class="kk iu">按</strong>颜色对值<strong class="kk iu">分组，并计算不同颜色值的<strong class="kk iu">平均值</strong>(或任何其他集合)。然后最后<strong class="kk iu">基于平均值对颜色进行分类</strong>。下图显示了此过程的步骤。</strong></p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mi"><img src="../Images/9897debdea17b960b025cf9354b943e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bufYBdgnVTtd2ckDTooCRw.png"/></div></div></figure><p id="490a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们回到我们的数据集。为了查看性别是否在搅动中起作用，我们可以将<strong class="kk iu">性别</strong>和<strong class="kk iu">搅动</strong>列按<strong class="kk iu">性别</strong>分组。然后我们可以应用均值函数。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/e17b542b168396cd10dd57389edf2e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*7mWnPSjQXHa9GYxtl2USZA.png"/></div></figure><p id="58c8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">男性和女性的流失率非常接近。</p><p id="af31" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们不选择列并直接将 groupby 应用于数据框架，所有数值列都将根据聚合函数进行计算:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/0ce7b589698c85d4e293ec7d6ae79053.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*y-hhwQLkojKdl0LKlm1HKA.png"/></div></figure><p id="fc89" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">似乎所有的数字特征对男性和女性来说都大致相同。</p><p id="f99b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以通过添加<strong class="kk iu"> sort_values </strong>函数对结果进行排序:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ml"><img src="../Images/2a949afb40b3c8f950b576db79eef1e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-E19hBQ6A36fMVIOOAr1Jg.png"/></div></div></figure><p id="2f00" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">默认情况下，它按升序排序。我们可以通过设置<strong class="kk iu">上升</strong>参数为假来改变它。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mm"><img src="../Images/743b6f3f828a6dc7769a9eeabdefe5e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j4pUU9PAJhAcXFKObcFrSw.png"/></div></div></figure><p id="66b4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">拥有光纤互联网服务的客户比其他客户更容易流失。</p><p id="41e8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以通过在方括号中传递列名来根据多个列进行分组:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/803a3643f4a8d6e0bf19d70f0cc17478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*tvCRt3_ePUoM1T7jphcxig.png"/></div></figure><p id="95f0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">“合同”栏有 3 个类别，“老年人”栏有 2 个类别，所以我们总共有 6 个组。对于每个组，计算平均“流失”率。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="27fc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">多个聚合函数</strong></p><p id="57f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在某些情况下，应用 groupby 函数后，您可能希望查看不同组的计数和平均值。如果类分布不均衡，只查均值可能会造成错误的假设。您可以对 groupby 的结果应用多个聚合函数。它们不仅限于计数和均值，你可以将函数的名称作为参数传递给<strong class="kk iu"> agg() </strong>函数。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mv"><img src="../Images/db855a896d2f5201f139da693574c890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kgDt9qYO1DrEQxL9Uu4TUA.png"/></div></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="62d8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> as_index 参数</strong></p><p id="8c80" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">groupby 函数中的变量作为结果数据帧的索引返回。我们可以通过设置<strong class="kk iu"> as_index </strong>参数为 false 来改变它。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/1bd827dfe3480ab1b1c0bb53825f548c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*fLdVP8EyIwtSQ4mv5ymPxw.png"/></div></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mx"><img src="../Images/9ce9b7f7acf0893b63802e529f353b7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ybmTSoxWJkPykbL-2LKY_g.png"/></div></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="83ea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看每月费用是否取决于合同类型。我们需要从数据集中提取“contract”和“MonthlyCharges”列，按“contract”分组，并对结果应用均值函数。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi my"><img src="../Images/aa943627b78f55bbd341aacf9ff3589a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*VoRgKdA55vHJ1OWoCX9g6Q.png"/></div></figure><p id="d0f4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如预期的那样，长期合同的平均月费用较低。</p><p id="63b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以根据任务应用其他聚集函数。例如，我们可能希望看到不同 internet 服务类型的合同类型分布。由于两者都是分类变量，我们可以应用计数函数:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mz"><img src="../Images/26699cf530f11710e621cf978d730e49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gv3kd0GaLx08sRfbHWgRg.png"/></div></div></figure><p id="a97b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为我们应用了 count 函数，所以返回的 dataframe 包括所有其他列，因为它可以计算值，而不管 dataframe 是什么。所有列上的值的数量都是相同的，所以我们可以只选择一列来查看值。熊猫的一个好处是通常有不止一种方法来完成一项任务。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi na"><img src="../Images/2375410a036560a0971bfcac7375c39e.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*kl7GLo4whO8HwwRdQpsglQ.png"/></div></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/650f906db8b06858787011e7d40f1c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*8wtsNjuOjXNEBJKAZtPgaQ.png"/></div></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/1bbd4743af931c5443766f5bee4fe5e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*Sy37nwcDiEzER1sJh9NRSQ.png"/></div></figure><p id="d8bb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这三行返回以下输出:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nd"><img src="../Images/fc6a91d02b5dc4f3dee15efe58bf0df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*ZQ8pvMGnZRc3LxxtIOE-1Q.png"/></div></div></figure><p id="cafb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您也可以执行如下相同的任务，但返回的对象将是 dataframe:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/d23e31e463da11504ffeee778265ca18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*HhtMDcbdbapqa5Ema2-gRg.png"/></div></figure><p id="2bee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，一些聚合函数需要数值。例如，如果我们只有分类变量并试图应用均值函数，我们将得到一个错误:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/605768a61e64b3878567069e60267067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*EQXhHVOM9NmCSlnu1Od-hg.png"/></div></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/f8fee8724ba3877c451d0ca377317470.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*fF0UL9d7TGr8QupC1aEHNw.png"/></div></figure><p id="3cf3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以多样化的例子，但基本的逻辑是相同的。Groupby 函数可用作探索性数据分析过程的第一步，因为它让我们了解数据集中变量之间的关系。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="d246" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>