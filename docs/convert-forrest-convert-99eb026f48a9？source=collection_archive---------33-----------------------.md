# 皈依吧，福雷斯，皈依吧！

> 原文：<https://towardsdatascience.com/convert-forrest-convert-99eb026f48a9?source=collection_archive---------33----------------------->

## 在运行体验中预测订阅

[*凯文·哈特斯坦*](http://www.linkedin.com/in/kevinhartstein/) *是一位* [*洞察数据科学*](http://www.insightdatascience.com) *的研究员(2020 年冬)。他在达特茅斯学院获得了认知神经科学博士学位。他的研究生研究将机器学习技术应用于功能性神经成像数据，以了解大脑如何解释照片和绘画中的物体身份。*

![](img/0f1388bde1960151286dca12b4838287.png)

**“我们正在利用最先进的科学技术和周到的人类工艺，提供一个引人入胜的循证平台，为每个人带来健康生活，一次一个人。”-** *里克·亨里克森，Ongo Science 首席执行官(*[https://blog.ongo.life/](https://blog.ongo.life/))

为了我的洞察项目，我与 Ongo Science 合作，这是一家位于旧金山的初创公司。Ongo 是一个平台，为健康和保健领域的内容创作者构建应用程序，并促进与用户之间的信息流动。大多数在线健康专家会发布关于营养、冥想和运动训练等主题的信息，并计算“赞”或阅读评论来解读它们的影响。Ongo 支持更详细的视图，为内容创建者提供关于用户目标、进度和挑战的见解。这些信息有助于指导和定制新内容，并最大限度地提高参与度和影响力。数据在个性化健康和保健中的作用正在扩大。事实上，研究人员估计，普通人一生中会产生超过 100 万千兆字节的健康数据。

作为设备、应用和专家之间的纽带，Ongo 致力于简化数据摄取和分析流程，帮助人们过上更健康的生活。在我的咨询项目中，我分析了来自 [The Run Experience](https://apps.apple.com/us/app/the-run-experience/id1189131975) 的数据，这是一个 Ongo 应用程序，提供与训练、受伤预防和比赛相关的内容，以及个性化教练和跑步者的社区中心。我利用与该应用的互动以及智能手机和可穿戴设备的数据来预测哪些用户会转向高级订阅计划。我这个项目的名字来源于 1994 年电影《T2》《T3》《阿甘正传》《T4》《T5》《T6》《T7》中人们的热情，他们用“跑，阿甘，跑！”的喊声鼓励主角然而，在这种情况下，目标是鼓励跑步体验的用户**将**从免费版本转换为付费订阅。

# 逃跑…

用户保留是移动应用的一个大问题，大约 80%的用户在安装后 3 天内离开，90%在第一个月内离开。尽管付费用户通常只占大多数应用程序用户的一小部分，但他们不太可能离开，平均每月以 5-30%的速度波动。来自持续订阅者的续订是一个重要的收入来源——尤其是对于处于初创阶段的应用程序——《哈佛商业评论》的[分析估计，仅增加 5%的留存率就可以导致收入长期增长高达 95%。健康和健身应用](https://hbr.org/1990/09/zero-defections-quality-comes-to-services)[在留住忠诚用户方面特别有效，](https://www.emarketer.com/Article/Fitness-App-Usage-Grows-by-Leaps-Bounds/1016486)75%的用户每周至少使用这些应用两次，26%的用户每周使用超过 10 次。

考虑到这些统计数据，我的项目旨在确定用户最终是否会根据他们最初的应用程序使用情况转向高级订阅。这些信息有助于将激励和促销的目标对准可能不会订阅的活跃用户，从而增加忠实用户的基础和相关收入。

# 数据过滤和特征工程

我被允许访问亚马逊网络服务上托管的超过 20 亿行数据，包括来自 Run Experience 应用程序的活动，以及来自该应用程序跑步跟踪器的 GPS 数据和来自已链接其帐户的 iOS 用户的 Apple HealthKit 数据。一个数据表还包括关于用户设定目标的信息(与健康、伤害预防、比赛等相关)。)和订阅历史。我从下面描述的用户群中筛选出大约 2400 万行数据，并根据下载日期对其进行临时调整，以便汇总和检查应用使用初期的活动。

**过滤**

![](img/4848565e59c35ec94ab1850368ba400a.png)

许多订阅者在下载应用程序后立即加入，可能是因为他们之前有过 YouTube 频道的跑步体验。许多其他人最初开始 7 天免费试用高级功能，一旦试用结束就订阅。

在用 Ongo 推出一款应用之前，Run Experience 已经是 [#1 的 YouTube 跑步频道](https://www.youtube.com/channel/UCjGZ6D8hJFvLur5K_p9vKAA)。可能是因为以前有过这个渠道的经验，许多应用程序用户在下载应用程序后立即开始付费订阅。Run Experience 还提供 7 天免费试用，许多用户在第一天就开始试用。这些用户中的大多数在试用结束时会转变。在最初的爆发后，用户会在一段可变的时间内继续订阅，所以我假设那些需要更长时间才能做出决定的人更有可能是跑步体验的新手，他们的决定可能基于与应用程序本身的交互，而不是之前对内容的体验。

**定义问题**

我选择关注前两周没有订阅的活跃用户。这个决定允许我排除已经熟悉该产品的用户，并在足够长的时间内整合数据，以区分哪些用户会订阅，哪些不会订阅。这些用户在前两周的登录总数相似。

![](img/f37fbafbcefd47baced2c15a4a6a3454.png)

分析中包括的用户具有相似的总体活动，通过用于预测的 2 周期间的登录次数进行估计(虚线左侧)。

**特色工程**

应用程序中的数据涵盖了各种各样的活动类型，包括观看锻炼视频的元数据、应用程序中记录的 GPS 跑步轨迹以及帖子和赞等社交内容。下载应用程序后，每个用户还会被提示选择一个目标——整体健康、预防受伤、比赛或其他。如果 iOS 设备上的用户有记录这些信息的智能设备，那么链接了他们的 Apple HealthKit 数据的用户也有关于他们的步数以及心率和体重的信息。

![](img/4e3e58875e050ab8d9aa2b1931ac8906.png)

这些功能是根据跑步体验应用程序收集的训练、社交和 GPS 跑步数据设计的。链接他们的苹果健康工具包数据的用户也有关于每日步数以及心率和体重的信息(前提是他们有智能设备来记录这些测量数据)。

“会话”数据包括关于用户观看了什么视频、他们是否完成了视频以及对会话的反馈(赞成或反对)的信息。用户也可以加入一个“计划”，如 5 公里或半程马拉松训练计划，由旨在达到特定目标的会议视频组成。社交互动包括在论坛上发表问题和评论，以及喜欢其他用户的帖子。GPS 数据包括每次跑步的距离和时间以及其他指标。

从这些广泛的数据中，我设计了 19 个特征。这些包括应用内活动的测量，如开始的视频会话数量和完成的百分比，程序注册和社交互动，以及用户在 30 分钟内记录 500 步以上或在两周内记录心率升高(超过 120 次/分钟)的次数。我的特性涵盖了广泛的用户行为，但是这个项目的未来迭代可能包括从数据中更细粒度的细节设计的特性，比如评论的实际文本；GPS 跟踪跑步的距离、时间和高度；和每分钟平均心率。

**特征选择和模型比较**

我比较了逻辑回归和随机森林模型来预测订阅。逻辑回归使用独立变量的线性组合来估计二元分类标签的对数优势比(在这种情况下，订户与非订户)。该模型的优势在于，模型为这些特征学习的权重可以指导解释各个特征如何对预测做出贡献。不幸的是，相关特征会掩盖彼此的影响，导致预测特征的权重较低。随机森林分类是一种非线性集成模型，它使用 bagging 和随机特征采样来构建决策树森林，每个决策树都为最终预测贡献一张“选票”。在不相关的树上聚合信息增加了模型的鲁棒性，并在共线特征之间划分了重要性，但牺牲了解释的方便性，尽管仍然可以使用诸如[基尼系数重要性](https://medium.com/the-artificial-impostor/feature-importance-measures-for-tree-models-part-i-47f187c1a2c3)等指标从模型中提取特征重要性。

Python 的 *scikit-learn* 包为这两个模型提供了简单的实现，以及交叉验证和评估的功能。我首先将数据分成 60/20/20 的训练/验证/测试部分。我对训练数据使用了 5 重交叉验证的递归特征消除(使用 *scikit-learn 的 RFECV)* 来为每个模型选择特征，在每个折叠内的训练和测试数据中对订阅者和非订阅者的比例进行分层。因为订阅者比非订阅者少得多，所以在初始化每个模型时，我使用 *class_weight="balanced"* 参数对这些类进行加权，使其与它们的逆频率成比例。因为从商业角度来看，准确识别订户和非订户非常重要，所以我使用了 *w* 八分 *F1 分数*(精确度和召回率的组合，按频率加权，以及组合和跨类别加权)作为评估指标。该过程表明逻辑回归的最佳特征数为 6，随机森林的最佳特征数为 12。

![](img/62cdc42abb66d9e1be40a1c41f18bf14.png)

用于特征选择、模型比较和模型评估的训练/验证/测试分割。

我用选定数量的特征，使用递归特征消除，在所有训练数据中重新训练每个模型。在这一步，我还使用了 SMOTE 来处理数据中的类不平衡。SMOTE 通过使用 *k-Nearest-Neighbors* 算法在特征空间中找到与该类的实际样本接近的点，在训练数据中创建少数类的新样本，重复该过程，直到训练数据中的正类和负类(订户和非订户)的数量相等。我通过评估验证数据的性能来比较这两个模型。随机森林表现更好，加权 F1 分数*为. 74，相比之下，逻辑回归的加权 F1 分数为. 65。这是有意义的，因为大部分数据由各种活动类型的计数组成。随机森林建模特别适合这种类型的数据，因为它通过在组成森林的决策树的每个分支的每个要素的值范围内查找信息切割点来进行。与逻辑回归中隐含的线性假设相比，这种非线性方法可能导致更好的拟合。*

**最终模型评估**

对于最终的模型评估，我在跨训练和验证集汇集的数据上训练了随机森林模型，并再次使用 SMOTE 来解决类不平衡问题。我使用了在模型比较阶段确定的相同特性，并在保留的测试集上评估了模型。最终的模型表现相当好，加权 F1 分数为 0.79，准确度为 0.78。

![](img/4260ebc46df3b9e3cefa870126231a43.png)

最终模型在延期测试中的性能指标 se*t .****AUC*= . 74**|**加权 F1 = .78** | **精确度= .79**

该模型在识别非订阅者方面表现尤为出色( *Precision* =.87 *，Recall* =.86)，这表明该模型将有助于识别尽管整体活动水平相对较高但不太可能订阅的用户。Ongo 和 Run Experience 可以将这一模式投入使用，激励这一人群进行转换，可能通过提供进一步的激励措施，如折扣率或高级教练服务预览。

**功能重要性和可行见解**

查看从随机森林模型中提取的功能重要性分数可以发现，在预测谁会转换时，操作尤其重要。到目前为止，两周内的登录次数是最重要的功能，开始的会话次数和来自 Apple HealthKit 的关于步数和心率升高的信息也显示出很大的重要性。早期干预可以带来更高的订阅率和收入的显著增加。

![](img/d927eebcc13396c754b83c6b1a034f21.png)

从随机森林模型中提取的特征重要性分数(基尼重要性)。红色条代表来自跑步体验应用的功能，黑色条代表来自 Apple HealthKit 的数据

这些功能很好地跟踪了直觉——开始并完成锻炼或有证据表明运动量较大的用户往往会坚持使用该应用程序。然而，有些违背直觉的是，用户的最初目标并不能预测最终的订阅，并且在特性选择阶段就被排除了。这表明，目标的差异通常与订阅可能性的变化无关，至少在我的项目中检查的样本中是如此。社交互动也不是很有预测性，尽管这些互动相当罕见。将这种见解转化为行动的另一种方式是 Ongo 和 Run Experience 鼓励用户专注于立即开始锻炼和跑步，而不是花时间在社区平台上滚动。虽然不清楚这种关系是否是因果关系，但遵循这种模式的用户更有可能订阅。

我很有兴趣看看苹果 HealthKit 数据中观察到的模式是否适用于下载应用程序后立即订阅的用户。一旦用户链接了他们的 HealthKit，之前记录的步数、心率和体重数据就可用于跑步体验。这些数据可以区分下载应用程序是否与活动增加有关，或者用户在下载应用程序之前是否已经比非用户更活跃。

我的最终成果包括一个在 Jupyter 笔记本中实现的工作流程，该工作流程从 Ongo 在 AWS 上的 S3 桶中获取数据；清理、预处理，并在时间上与应用程序下载日期保持一致；和运行体验应用程序中的 Apple HealthKit 数据和活动的工程师功能。然后将数据输入到模型中，以预测该应用程序的活跃用户在最初使用一段时间后没有订阅的订阅可能性。