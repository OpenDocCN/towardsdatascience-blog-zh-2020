<html>
<head>
<title>Chaining Multiple MapReduce Jobs with Hadoop/ Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Hadoop/ Java链接多个MapReduce作业</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/chaining-multiple-mapreduce-jobs-with-hadoop-java-832a326cbfa7?source=collection_archive---------5-----------------------#2020-03-23">https://towardsdatascience.com/chaining-multiple-mapreduce-jobs-with-hadoop-java-832a326cbfa7?source=collection_archive---------5-----------------------#2020-03-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/93fa224859772425eaab9911faa2e165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-08gt_0YvsOBoytkovwZPg.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">来源:https://mapr.com/blog/how-to-launching-mapreduce-jobs/</p></figure><p id="635e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大约一年前，当我的工作需要一点Hadoop时，我简要地了解了MapReduce。那时我还没有接触过MapReduce，更不用说用Java了。因此，当一项任务要求我在一个脚本下实现多个MapReduce作业时，在Stack Overflow和Youtube上搜索简直是一团糟。</p><p id="3e47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么，为什么不写点什么呢？是的，我是。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="dad8" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">概要:MapReduce </strong></h1><p id="1f92" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">MapReduce是一个计算抽象，可以很好地与Hadoop分布式文件系统(HDFS)一起工作。它包括“映射”步骤和“减少”步骤。Map执行过滤并分类到另一组数据中，而Reduce执行汇总操作。在这两个步骤中，单个元素被分解成键和值对的元组。</p><p id="4e1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">MapReduce因能够在后台的多个计算节点上轻松扩展数据处理而广受欢迎。因此，它可以很好地与</p><p id="e3a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">非常大的数据集。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="250b" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">多个MapReduce作业</h1><p id="01b2" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">为了说明如何在一个脚本中链接多个MapReduce作业，我将使用大约760万行的<strong class="kf ir">NYC Taxi&amp;Limousine Commission</strong>数据集来计算位置度数差异的分布。的。我使用的tsv文件具有以下结构:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/6181f15c93e1dd6c2406c5c6df830e30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OS4iGLNvIt8uqeSnGHlJKQ.png"/></div></div></figure><p id="7b3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们想使用MapReduce获得以下两列的输出:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/65a26a6b969668033e4e4770a34cb4cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*g0nlgQ-GO3E4TuXP7J9qNQ.png"/></div></figure><p id="dc4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中“diff”是位置ID的出度减去其入度。位置的出度是该位置用于拾取的次数，入度是该位置用于放下的次数。那么，“计数”就是特定“差异”的频率。</p><p id="d0ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，实现这一点的一种方法是拥有两个MapReduce作业。一个是计算每个位置的“diff ”,另一个是将第一个作业的输出转换为“count ”,就像我们上面想要的那样。</p><p id="7de0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">映射-减少作业#1 </strong></p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/2b741f56bc56350c5726174c39f5535a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJFcqS4XNfC4XAH60lekGg.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">映射程序#1</p></figure><p id="db1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Job #1的Map过程简单地循环并中断。tsv为每行输入4个不同的值:PickUpLocation ID、DropOffLocation ID、PassengerCount和TotalFare。但是，这里只有PickUpLocation ID和DropOffLocation ID与我们的任务相关。然后，对于每个元素，该类还创建一个为1的inDegree变量和一个为-1的outDegree变量。</p><p id="db27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，它将每个(PickUpLocation，inDegree)和(DropOffLocation，outDegree)写入一个键值元组，该元组将由Reduce过程进一步处理，该过程采用如下形式，其中第一列是位置ID，第二列指示它是从每个位置ID拾取还是放下。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/1ffcb10bb8294587f6f706a634ce474b.png" data-original-src="https://miro.medium.com/v2/resize:fit:232/format:webp/1*kRyisDiGHjvqdB1dMsGktQ.png"/></div></figure><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/e63e99b0d402900dad8558e2f4d5c3fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1UIpUC8927sPN8vAtnj2_Q.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">简化程序#1</p></figure><p id="2aad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，Reduce过程所做的只是按位置ID进行分组，并通过对第二列求和来实现“diff”。然后，它将(Location ID，diff)作为键值元组写入。</p><p id="a5ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出采用以下形式:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/461e62be446cf89876729fb4007a8741.png" data-original-src="https://miro.medium.com/v2/resize:fit:228/format:webp/1*-j5JILMdFS3Zqr6wO6qiwg.png"/></div></figure><p id="b3ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> MAP-REDUCE作业#2 </strong></p><p id="6318" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，作业#1的输出作为作业#2的输入传入。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/40ea1f6a7aa102436056907b62923afb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vksqgbn_sZcsAB8kzfHJkw.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">映射程序#2</p></figure><p id="1a04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了按“diff”分组以获得最终输出，Job 2的Map过程需要将输入键值对(Location ID，diff)交换到(diff，Location ID)中，因为Reduce过程按键分组。</p><p id="a91e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实际上，这次Map过程的输出如下所示:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/d66421c12e7f6e4f453af16c92bfbac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:240/format:webp/1*gpdtOIELZ5zXsF_ptx3aNQ.png"/></div></figure><p id="8434" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，将它传递给第二个Reduce过程来完成任务:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/d69e25de59db66472ad21607416b57bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1jwv5mKwc8YJEvI_2MqQg.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">简化程序#2</p></figure><p id="5983" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里发生的事情是，Reduce过程简单地遍历输入，并且对于唯一的“diff”的每一次出现，它的计数增加1。在循环结束时，它将(diff，count)作为键值对写入最终输出文件:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/65a26a6b969668033e4e4770a34cb4cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*g0nlgQ-GO3E4TuXP7J9qNQ.png"/></div></figure><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/d147e984415f5633f820eae12d0be137.png" data-original-src="https://miro.medium.com/v2/resize:fit:210/format:webp/1*wvANdl37bLpViclp_xs15g.png"/></div></figure><p id="8f9d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">连锁作业#1 &amp;作业#2 </strong></p><p id="5e1f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我发现的具有挑战性的步骤是连接上述两个MapReduce作业，这样作业#2可以将作业#1的输出作为输入，而不需要作业#1实际写出一个文件。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/9b075f7687154d6fd2c71a0ff86971f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJi_8iRYUuY3US-DOC3iPg.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">链接步骤</p></figure><p id="51e6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我不得不在网上寻找和尝试多种建议，直到我找到最容易理解的组合。</p><p id="18ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">基本上，关键是为这两个作业创建两个不同的配置，即“conf”和“conf2 ”,它们也获得两个不同的实例。</p><pre class="mm mn mo mp gt na nb nc nd aw ne bi"><span id="d056" class="nf lj iq nb b gy ng nh l ni nj"><em class="nk">Configuration</em> conf = <strong class="nb ir">new</strong> Configuration();<br/><em class="nk">Job</em> job1 = Job.getInstance(conf, "degree");</span><span id="213a" class="nf lj iq nb b gy nl nh l ni nj"><em class="nk">Configuration</em> conf2 = <strong class="nb ir">new</strong> Configuration();<br/><em class="nk">Job</em> job2 = Job.getInstance(conf2, "frequency");</span></pre><p id="8673" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，作业#2只能在作业#1完成时执行</p><pre class="mm mn mo mp gt na nb nc nd aw ne bi"><span id="2790" class="nf lj iq nb b gy ng nh l ni nj">job1.waitForCompletion(true);</span></pre><p id="77ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是请注意，系统并没有在这里终止。然后，作业#1的输出与作业#2的输入相同:</p><pre class="mm mn mo mp gt na nb nc nd aw ne bi"><span id="bfc5" class="nf lj iq nb b gy ng nh l ni nj">FileOutputFormat.setOutputPath(job1, <strong class="nb ir">new</strong> Path(args[1]));</span><span id="9329" class="nf lj iq nb b gy nl nh l ni nj">FileInputFormat.addInputPath(job2, <strong class="nb ir">new</strong> Path(args[1]));</span></pre><p id="3504" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">仅此而已。使用这种技术，您不仅仅局限于两个MapReduce作业，还可以增加到三个、五个甚至十个来适应您的任务。</p><p id="b3cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望这篇简短的笔记可以帮助那些正在努力寻找一个关于链接MapReduce作业的全面且易于理解的指南的人。</p></div></div>    
</body>
</html>