<html>
<head>
<title>Looking Inside The Blackbox — How To Trick A Neural Network</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">观察黑盒内部——如何欺骗神经网络</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/peering-inside-the-blackbox-how-to-trick-a-neural-network-757c90a88a73?source=collection_archive---------23-----------------------#2020-09-13">https://towardsdatascience.com/peering-inside-the-blackbox-how-to-trick-a-neural-network-757c90a88a73?source=collection_archive---------23-----------------------#2020-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0d9d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在本教程中，我将向您展示如何使用梯度上升来找出如何错误分类的输入。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/03d550508f452ed7c17ceee8eb5bb7fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*sM9x0M1YOD0COSWlade5VQ.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用梯度上升来计算如何将输入分类为 5。(所有图片均为作者本人，版权所有)。</p></figure><p id="36a0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">神经网络因为是黑盒而声名狼藉。虽然理解他们的决策肯定需要创造力，但他们真的不像人们想让你相信的那样不透明。</p><p id="df5f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本教程中，我将向您展示如何使用反向传播来更改输入，以便根据您的喜好对其进行分类。</p><p id="eb0c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用这个<a class="ae lr" href="https://colab.research.google.com/drive/16HVAJHdCkyj7W43Q3ZChnxZ7DOwx6K5i?usp=sharing" rel="noopener ugc nofollow" target="_blank">按钮</a>跟随。</p><p id="b27c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(这部作品是与<a class="ae lr" href="https://twitter.com/alfcnz" rel="noopener ugc nofollow" target="_blank">阿尔弗雷多·坎齐阿尼</a>在一个即将到来的视频之前共同创作的)</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="d08b" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">人类是黑匣子</h1><p id="3751" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">让我们考虑一下人类的情况。如果我给你看下面的输入:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/d961f6bbc545b2be4d707395c967b8bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/1*D8LBqpJ_sUeTTFigh9Ymbw.png"/></div></figure><p id="e594" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">很有可能你不知道这是 5 还是 6。事实上，我相信我甚至可以说服你这个<em class="mx">可能也是一个 8。</em></p><p id="63dd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，如果你问一个人，他们必须做些什么才能让一些东西变得更像 5，你可能会这样做:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/7ca4051f196aaf1fa5f58fce0a6253da.png" data-original-src="https://miro.medium.com/v2/resize:fit:372/format:webp/1*sWJfKtj79udYyVR5IHlVug.png"/></div></figure><p id="90f3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我想让你把这个打成 8 分，你可以这样做:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/0aae2912e15f5d392f24a1676420de81.png" data-original-src="https://miro.medium.com/v2/resize:fit:380/format:webp/1*3YohOhuCn8srJGP9IUoOfQ.png"/></div></figure><p id="a8b7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，这个问题的答案不容易用几个 if 语句或者看几个系数来解释(是的，我在看你回归)。不幸的是，对于某些类型的输入(图像、声音、视频等)，可解释性肯定变得更加困难<strong class="kx ir">但并非不可能</strong>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5853" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">询问神经网络</h1><p id="c2c9" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">神经网络将如何回答我在上面提出的同样的问题？为了回答这个问题，我们可以用梯度上升来做。</p><p id="3a9a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是神经网络如何认为我们需要修改输入，使其更接近 5。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/e61fb5cda6faf78a823db21ecc5c52ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*F_Ygs_zdc4qSiYjsoZs7lg.png"/></div></div></figure><p id="7f19" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由此得出两个有趣的结果。首先，黑色区域是我们需要去除像素密度的地方。其次，黄色区域是它认为我们需要增加更多像素密度的地方。</p><p id="3c89" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以通过给原始图像添加渐变来在渐变方向上前进一步。我们当然可以一遍又一遍地重复这个过程，最终将输入转化为我们所希望的预测。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/8f8691241bbafe125368bc8cf068ded4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T13Yuv_h1AjZR7A_toCq_A.png"/></div></div></figure><p id="063d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以看到图像左下方的黑色斑块<strong class="kx ir">与人类可能认为要做的事情</strong>非常相似。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/0a58fa976fe436037f40825a6a10b471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*ki5vQr25V0Nhkg0_XjHn7A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">人类在左上角添加黑色。网络显示同样的情况</p></figure><p id="9f2a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让输入看起来更像 8 怎么样？这是网络认为你必须改变输入的方式。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/677c81c2befadcdbda8e37255a4edd00.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*Oet1NvRUkfscIabJ2h9kTA.png"/></div></figure><p id="37a4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">值得注意的是，在左下方有一团黑色，中间有一团明亮。如果我们将此与输入相加，我们会得到以下结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/8021b0b46e875d5d09c8a9c6bf8f7f50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*ghK7Hg-IZ7rPCLkLx6QMbA.png"/></div></figure><p id="a192" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这种情况下，我并不特别相信我们已经把这个 5 变成了 8。然而，我们少做了一个 5，并且使用右边的图像而不是左边的图像来说服你这是一个 8 的论点肯定会更容易获胜。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="466a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">渐变是你的向导</h1><p id="9b4a" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">在回归分析中，我们通过系数来了解我们学到了什么。在随机森林中，我们可以查看决策节点。</p><p id="3fa7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在神经网络中，这归结于我们在使用梯度方面有多有创造力。为了对这个数字进行分类，我们生成了一个可能预测的分布。</p><p id="2c19" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就是我们所说的<em class="mx">向前传球。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3b0edb94624f5861a90ffc8e6540032e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tBsGoiroGf3iOvPl595MOw.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在向前传递期间，我们计算输出的概率分布</p></figure><p id="0c3f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">代码看起来是这样的(<a class="ae lr" href="https://colab.research.google.com/drive/16HVAJHdCkyj7W43Q3ZChnxZ7DOwx6K5i?usp=sharing" rel="noopener ugc nofollow" target="_blank">使用 colab </a>跟随):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/69e405481b713786f1befa7246f7860d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2G1Fz_zlq3fbeOTNOShfNQ.png"/></div></div></figure><p id="d910" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，假设我们想要欺骗网络预测输入 x 为“5”，那么方法是给它一个图像(x)，计算图像的预测，然后<strong class="kx ir">最大化</strong>预测标签“5”的概率。</p><p id="c274" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，我们可以使用梯度上升来计算第 6 个索引(即:label = 5) ( <strong class="kx ir"> p </strong>)处的预测相对于输入<strong class="kx ir"> x </strong>的梯度。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/e5da5d3e00f7c9419c01faf8de43bb3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:188/format:webp/1*uZ7HiO7nggFm1lrxKE9nbA.png"/></div></figure><p id="3c0e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了在代码中做到这一点，我们将输入 x 作为参数馈送给神经网络，选择第 6 个预测(因为我们有标签:0，1，2，3，4，5，…)，第 6 个索引意味着标签“5”。</p><p id="72ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这看起来像是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/03d550508f452ed7c17ceee8eb5bb7fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*sM9x0M1YOD0COSWlade5VQ.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">“5”相对于输入的预测梯度。</p></figure><p id="de19" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在代码中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/54d0d56c07026ca8fb8207648b3e8d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qboy70qx45AVW8X1ReWWQw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">当我们打电话时。backward()发生的过程可以通过前面的动画形象化。</p></figure><p id="0cb9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">既然我们已经计算了梯度，我们可以将它们可视化并绘制出来:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/fa96ee41644905c9a253ba512373f043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4HNRLYwF7EhL5lUy44134w.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/92696e82852438656a31fcbb6e6f3c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:476/format:webp/1*I8LeZ8q9Ub5kHYZu35Wxbg.png"/></div></figure><p id="5151" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的梯度看起来像随机噪声，因为网络还没有被训练…但是，一旦我们训练了网络，梯度将提供更多信息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/8d834af20db197ae42159cce2bf35d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/1*jw30tM6JfPV24pphbK86Yw.png"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="c246" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">通过回调实现自动化</h1><p id="1810" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">这是一个非常有用的工具，有助于说明你的网络在训练时发生了什么。在这种情况下，我们希望自动化这一过程，以便在培训中自动进行。</p><p id="93fb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，我们将使用 PyTorch Lightning 来实现我们的神经网络:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="ec55" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">自动绘制我们在这里描述的内容的复杂代码可以抽象成 Lightning 中的回调。回调是一个小程序，在您可能关心的培训部分调用。</p><p id="3ba7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这种情况下，当处理一个训练批次时，我们希望生成这些图像，以防某些输入被混淆。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="4d1b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是…我们用 pytorch-lightning-bolts 让它变得更简单，你可以简单地安装它</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="ca7b" class="ns ma iq no b gy nt nu l nv nw">pip install pytorch-lightning-bolts</span></pre><p id="f1b2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">并将回调导入到训练代码中</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="14fb" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">把所有的放在一起</h1><p id="f7f8" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">最后，当逻辑“混乱”时，我们可以训练我们的模型并自动生成图像</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0f76" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">tensorboard 会自动生成这样的图像:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/513e28bba125eb729818154807a20da6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*waxeunPcryqJfY7-ZmQ4gQ.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/383c0b9a52d529263a679d75b3306b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*xHkFSrs1ZO9cg7W8ARBiiQ.png"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="229d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">摘要</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/a4880ed3cf4eb5dc8c7d8d8407343e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m_SjvsfRsAIRrXtSHNryDg.png"/></div></div></figure><p id="35b2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">总之:您学习了如何使用 PyTorch 查看黑盒内部，学习了直觉，在 PyTorch Lightning 中编写了一个回调函数，并自动获得 Tensorboard 实例来绘制可疑的预测</p><p id="8ce1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用<a class="ae lr" href="https://github.com/PyTorchLightning/pytorch-lightning" rel="noopener ugc nofollow" target="_blank"> PyTorch 闪电</a>和<a class="ae lr" href="https://github.com/PyTorchLightning/pytorch-lightning-bolts" rel="noopener ugc nofollow" target="_blank"> PyTorch 闪电</a>自己试试。</p><p id="8541" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(这篇文章是在一个即将到来的视频之前写的，在这个视频中，我(威廉)和<a class="ae lr" href="https://twitter.com/alfcnz" rel="noopener ugc nofollow" target="_blank">阿尔弗雷多·坎齐安</a>将向你展示如何从头开始编码)。</p></div></div>    
</body>
</html>