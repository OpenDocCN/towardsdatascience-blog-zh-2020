<html>
<head>
<title>7 Ways to Manipulate Pandas Dataframes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">操纵熊猫数据框的 7 种方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/7-ways-to-manipulate-pandas-dataframes-f5ec03fe944c?source=collection_archive---------17-----------------------#2020-09-11">https://towardsdatascience.com/7-ways-to-manipulate-pandas-dataframes-f5ec03fe944c?source=collection_archive---------17-----------------------#2020-09-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="65d3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">熊猫提供了很大的灵活性</h2></div><p id="5fcc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Pandas 是一个非常强大和通用的 Python 数据分析库，它加速了数据分析和探索过程。Pandas 的优势之一是它提供了多种数据操作的功能和方法。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/5330de37bb05ae4c08c935f8b190826b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ij8aNRjzmDRMhTPd.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">在<a class="ae lu" href="https://unsplash.com/s/photos/seven?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae lu" href="https://unsplash.com/@waldemarbrandt67w?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Waldemar Brandt </a>拍照</p></figure><p id="6514" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据帧是熊猫的核心数据结构。为了掌握熊猫，你应该能够轻松流畅地摆弄数据帧。在这篇文章中，我们将讨论不同的方法来操作或编辑它们。</p><p id="b4b8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们从导入 NumPy 和 Pandas 开始，并创建一个示例数据帧。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="e09e" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="effa" class="ma mb it lw b gy mg md l me mf">values = np.random.randint(10, size=(3,7))<br/>df = pd.DataFrame(values, columns=list('ABCDEFG'))<br/>df.insert(0, 'category', ['cat1','cat2','cat3'])</span><span id="edef" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/be43be7ad95179b8edd12f90d5ec5ed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*VXJ-rndYN5tQ12ak6TKHmw.png"/></div></figure><p id="2b52" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将提到的第一种操作方式是<strong class="kk iu">熔化</strong>功能，它将宽数据帧(大量列)转换成窄数据帧。一些数据帧的结构是连续的测量值或变量用列来表示。在某些情况下，将这些列表示为行可能更适合我们的任务。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="8438" class="ma mb it lw b gy mc md l me mf">#1 melt</span><span id="e4c6" class="ma mb it lw b gy mg md l me mf">df_melted = pd.melt(df, id_vars='category')<br/>df_melted.head()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/dc7d351da73092ad92ffccdec55abae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*zVv-TZHFg7bU0XEDxfCZlQ.png"/></div></figure><p id="a46b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用<strong class="kk iu"> id_vars </strong>参数指定的列保持不变，其他列显示在变量和值列下。</p><p id="ffa9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二种方法是增加索引级别的堆栈函数。</p><ul class=""><li id="90ac" class="mj mk it kk b kl km ko kp kr ml kv mm kz mn ld mo mp mq mr bi translated">如果 dataframe 有一个简单的列索引，stack 返回一个系列，其索引由原始 dataframe 的行列对组成。</li><li id="24cd" class="mj mk it kk b kl ms ko mt kr mu kv mv kz mw ld mo mp mq mr bi translated">如果数据帧有多级索引，stack 增加索引级别。</li></ul><p id="6f6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">考虑以下数据帧:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/e0eee1e5d4a691730a2c3cfdd31e884d.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*UV9otknZQhELDSS_bRqMrQ.png"/></div></figure><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="c4a1" class="ma mb it lw b gy mc md l me mf">#2 stack</span><span id="d146" class="ma mb it lw b gy mg md l me mf">df_stacked = df_measurements.stack().to_frame()<br/>df_stacked[:6]</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi my"><img src="../Images/0402b268350aad629c8b1c53d96c663b.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*bkARQXLQNfx32NaI5ylNNg.png"/></div></figure><p id="fec6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，stack 函数返回一个 Series 对象，但是我们使用<strong class="kk iu"> to_frame </strong>函数将其转换为 dataframe。</p><p id="e3df" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">顾名思义，拆分功能是堆栈功能的反向操作。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="ad9c" class="ma mb it lw b gy mc md l me mf">#3 unstack</span><span id="3774" class="ma mb it lw b gy mg md l me mf">df_stacked.unstack()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mz"><img src="../Images/09adcaa1fe99ea272c98d1c431548c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*0DfrqFsIv8nCpEpZsKruDA.png"/></div></div></figure><p id="7151" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">添加或删除列可能是我们做得最多的操作。让我们添加一个新列并删除一些现有的列。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="e1a2" class="ma mb it lw b gy mc md l me mf">#4 add or drop columns</span><span id="5790" class="ma mb it lw b gy mg md l me mf">df['city'] = ['Rome','Madrid','Houston']<br/>df.drop(['E','F','G'], axis=1, inplace=True)</span><span id="12e5" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi na"><img src="../Images/982df185decbaddf820d24a0c1db2b58.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*q_Tp53XS2aJsguhAM1hYRQ.png"/></div></figure><p id="caaf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们创建了一个包含列表的新列。Pandas 系列或 NumPy 数组也可用于创建列。</p><p id="4762" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要删除列，除了列名之外，轴参数应该设置为 1。为了保存更改，将<strong class="kk iu">原位</strong>参数设置为真。</p><p id="573a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">默认情况下，新列会添加到 dataframe 的末尾。如果希望新列放置在特定位置，应该使用 insert 函数。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="ef3b" class="ma mb it lw b gy mc md l me mf">#5 insert</span><span id="508a" class="ma mb it lw b gy mg md l me mf">df.insert(0, 'first_column', [4,2,5])</span><span id="2f47" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/755980467f7d626c980e22b19dbe3ca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*Jx9beTNhQqc8eiPnxgGe-Q.png"/></div></figure><p id="a6a2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可能还想添加或删除行。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/0365ae7d7cf3201572543ffb45bf3969.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*njrKWwvDAafhdyC12e_ArQ.png"/></div></figure><p id="1f94" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">append 函数可用于添加新行。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="6844" class="ma mb it lw b gy mc md l me mf">#6 add or drop rows</span><span id="c8b6" class="ma mb it lw b gy mg md l me mf">new_row = {'A':4, 'B':2, 'C':5, 'D':4, 'city':'Berlin'}<br/>df = df.append(new_row, ignore_index=True)</span><span id="f08f" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/8956946113e2252a117f0202e12b3553.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*rchBhkxN1LixhfqOBBAJew.png"/></div></figure><p id="0d31" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以像删除列一样删除 a。唯一的变化是轴参数值。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="31ca" class="ma mb it lw b gy mc md l me mf">df.drop([3], axis=0, inplace=True)</span><span id="9a49" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/cc5b081815d10b818621da4e91203bd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*2pKj53xZXt-WunNappRfJw.png"/></div></figure></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><p id="316c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对数据帧的另一个修改可以通过 pivot_table 函数实现。考虑以下具有 30 行的数据帧:</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="d878" class="ma mb it lw b gy mc md l me mf">import random</span><span id="ec4f" class="ma mb it lw b gy mg md l me mf">A = np.random.randint(10, size=30)<br/>B = np.random.randint(10, size=30)<br/>city = random.sample(['Rome', 'Houston', 'Berlin']*10, 30)<br/>cat = random.sample(['cat1', 'cat2', 'cat3']*10 ,30)</span><span id="0493" class="ma mb it lw b gy mg md l me mf">df = pd.DataFrame({'A':A, 'B':B, 'city':city, 'cat':cat})<br/>df.head()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/6de83fd2b1015e9f40172ce93039cb05.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*KIDtNHvDp9nYSijdq9xmGQ.png"/></div></figure><p id="330e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">pivot_table 函数也可以被视为从不同的角度查看数据框架的一种方式。它通过允许变量以不同的格式表示数据来探索变量之间的关系。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="dd66" class="ma mb it lw b gy mc md l me mf">#7 pivot_table</span><span id="65c6" class="ma mb it lw b gy mg md l me mf">df.pivot_table(index='cat', columns='city', aggfunc='mean')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/d2f0ab03fdd5addf154f2340e5ec0545.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*nRGSOyxh9qMsk4KcfX4YTw.png"/></div></figure><p id="baf0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">返回的数据帧包含每个 city-cat 对的平均值。</p></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><p id="f0e8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经介绍了 7 种编辑或操作数据帧的方法。其中一些非常常见，你可能几乎每天都在使用它们。也会有需要使用稀有的情况。</p><p id="7375" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我认为熊猫的成功和流行来自于多功能、强大和易于使用的操作和分析数据的功能。和熊猫一起完成一项任务几乎总是有多种方式。由于花在数据科学项目上的大部分时间都花在数据清理和预处理步骤上，所以非常鼓励学习 Pandas。</p><p id="7105" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>