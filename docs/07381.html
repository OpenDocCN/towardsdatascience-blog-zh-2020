<html>
<head>
<title>PyMC3 and Bayesian inference for Parameter Uncertainty Quantification Towards Non-Linear Models: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">非线性模型参数不确定性量化的PyMC3和贝叶斯推理(二)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pymc3-and-bayesian-inference-for-parameter-uncertainty-quantification-towards-non-linear-models-a03c3303e6fa?source=collection_archive---------19-----------------------#2020-06-04">https://towardsdatascience.com/pymc3-and-bayesian-inference-for-parameter-uncertainty-quantification-towards-non-linear-models-a03c3303e6fa?source=collection_archive---------19-----------------------#2020-06-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6e43" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">参数和模型不确定性量化</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cb7e02c6c2ca518f788a68d736aafe75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hG7fZraPiSirl1BSScMxwQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">导航的不确定性(作者图片)</p></figure></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><p id="028c" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">在本系列的第2部分中，我们将深入PyMC3，并学习如何将其应用于非线性模型的不确定性量化(UQ)。为了验证，我们还将看到贝叶斯方法如何与UQ参数的频率主义方法进行比较。我假设你已经为你的模型优化了参数。我将使用的模型来自本系列的第1部分。</p><p id="3235" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们将在本系列中使用的库如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将要使用的库</p></figure><p id="d501" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">对于那些从第1部分跳到这里的人，或者那些需要重温第1部分的人，非线性模型是集总电容对象(多么拗口)的一阶瞬态热响应的解决方案。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mb"><img src="../Images/90bdad935e4e058b1012d808c1e768b9.png" data-original-src="https://miro.medium.com/v2/format:webp/1*I-MNJSeyiZwbTqh5-HQtmw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">集总电容物体一阶瞬态热响应的解</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Python中的函数</p></figure><p id="11f8" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们假设T_0 = 100C，T_env = 30C。我们试图估计冷却参数τ和模型的不确定性。这个问题的日常例子是冷却保温良好的热饮！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mc"><img src="../Images/b33072077b839788ad70bbc73d16bed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2mt6gVUtGK4I1YXZQt1HA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">热饮…也许我们把它放在一个非常好的保温瓶里(图片由作者提供)</p></figure><h2 id="320d" class="md me iq bd mf mg mh dn mi mj mk dp ml ll mm mn mo lp mp mq mr lt ms mt mu mv bi translated">PyMC3下的贝叶斯推理</h2><p id="e030" class="pw-post-body-paragraph lc ld iq le b lf mw jr lh li mx ju lk ll my ln lo lp mz lr ls lt na lv lw lx ij bi translated">为了开始对模型参数的UQ进行贝叶斯推断，我们首先使用PyMC3创建一个模型，这里我在第1行将其称为“model_g”。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="ea04" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">引用Therese Donovan和Ruth M. Micket的话[1]，</p><blockquote class="nb nc nd"><p id="9fb5" class="lc ld ne le b lf lg jr lh li lj ju lk nf lm ln lo ng lq lr ls nh lu lv lw lx ij bi translated">“如果不使用先验分布，就无法进行贝叶斯分析”。</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/cafc73a18bb0ae4e2ae9e5c9936e0d4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A9TdE28LYLDupFsYvZpP7g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">贝叶斯框架。p代表概率。</p></figure><p id="ab79" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">这里我们的先验是P(τ，ϵ)，我们将把这个先验分解成两个先验，每个参数一个。而我们对τ的分布知之甚少或没有多少先验知识。然而，我们可以提供一个弱信息先验[2]。通过简单地画出τ的不同值，我们可以看出τ一定是有界的。我们将假设τ为均匀分布，下界为0，上界为100。我们可以看到，这很容易涵盖这个问题的可能值，然后一些。从第1部分中，我们发现τ的最佳参数是14.93，从图中可以看出这是有意义的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/d394d07a93fb064a5e4e4ff518ad722c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nDYtc1HXE41urAkOn8JfmA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">调查tau的前科</p></figure><p id="8beb" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们需要的下一个先验是误差的标准差，ϵ.我们知道这个参数不能小于0，因为标准差总是大于或等于0。半正态分布似乎适合于ϵ.的先验分布我们再次通过选择标度值为5的半正态分布来选择弱信息先验。我使用ϵ而不是第一部分中使用的σ，以避免与也用于衡量半正态分布的σ术语混淆</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/cfc1e3358d9a0d748689e25d894b2df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F5mGxIx6HZlZBeAIHwRFrA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">调查ϵ的前科</p></figure><p id="d56f" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">将所有内容结合在一起，第5行描述了预测温度“T_pred”来自使用我们的非线性牛顿冷却函数的平均值(μ)的正态分布。这个模型是我们的可能性，代表p(数据| τ，ϵ)。我们还让PyMC3知道我们模型的标准偏差是ϵ.的先验分布最后，我们传递的最后一个参数是观察到的“实验”温度数据。</p><p id="846b" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">使用第8行，我们让PyMC3通过抽取2000个后验样本，使用NUTS采样来完成繁重的工作。我非常非常推荐去看看Richard的McElreath关于采样算法的<a class="ae ly" href="https://elevanth.org/blog/2017/11/28/build-a-better-markov-chain/" rel="noopener ugc nofollow" target="_blank">网页</a>。我们通常无法显式求解上述贝叶斯框架方程中的分子，因此我们必须使用采样算法来帮助我们探索它。</p></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><p id="474b" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">一旦执行了采样，我们就可以检索摘要</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="4a8d" class="md me iq nm b gy nq nr l ns nt">az.summary(trace_g)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/4fbb6c0e08ad3bad2743556aadd19883.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*9nVo6RYcWwjYN51LD8ElXw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">跟踪摘要</p></figure><p id="9fa1" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">在第1部分中，我们发现τ_opt = 14.93，σ的估计值=1.42。查看上表，我们的采样方法的平均值也提供了非常相似的结果，这是有道理的。我们之前做的优化也允许我们检查我们的贝叶斯推理。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/5d6f88a2cb4aa3e3f1c2999f94105707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*DOSrkcuo7-y5jtrv62A1xQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们参数的联合图</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="4430" class="md me iq nm b gy nq nr l ns nt">joint_plt = az.plot_joint(data_spp, var_names=['τ', 'ϵ'], kind='kde', fill_last=False);</span></pre><p id="263e" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">使用上面的代码，我们可以通过对后验概率P(τ，ϵ |数据)进行抽样来生成一个联合图。</p><p id="58c9" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们还可以获得一个跟踪图，以验证我们的采样没有停滞，并且我们的采样充分探索了参数空间。我们想要像“毛毛虫”一样的痕迹。</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="3106" class="md me iq nm b gy nq nr l ns nt">trace_fig = az.plot_trace(trace_g,<br/> var_names=[ 'τ', 'ϵ'],<br/> figsize=(12, 8));</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/3881951e050201e2fee6af682a2ab007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RAUW64YTrBsuUFNIQcfu3Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">追踪图</p></figure><p id="c4c8" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们还可以通过使用以下方法获得参数的最高后验密度(HPD ),这里我们选择99%。</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="1a53" class="md me iq nm b gy nq nr l ns nt">posterior_params = pm.plot_posterior(data_spp,<br/>                                     point_estimate='mean',<br/>                                     credible_interval=0.99,<br/>                                     textsize=20,<br/>                                     round_to=4);</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/22ea8885a94542490dc452976d539e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a6id-CtsHZQ0CV4XYwsfVw.png"/></div></div></figure><p id="e976" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">如果没有噪声，我们的平均值将完全等于“未知”参数。由于存在噪声，就像真实数据一样，我们的参数值存在不确定性，我们需要量化其中的不确定性。</p><p id="5883" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">从第1部分可以看出，实际值τ=15，σ=1.5。不仅平均后验概率接近这些值，而且HPD很容易包含真实值，这正是我们想要的。</p></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><p id="3370" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">贝叶斯推理的好处之一是，除了计算参数的平均值，我们还可以得到参数的分布，如上所示。我们的非线性模型的UQ就像从我们的分布中取样一样简单，这是在上面的sample_posterior.py中完成的，为了清楚起见，下面使用方法</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="e5c4" class="md me iq nm b gy nq nr l ns nt">pm.sample_posterior_predictive()</span></pre><p id="f234" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">计算模型中的不确定性，不仅从参数中，而且从数据中，是通过从我们的后验样本完成的。使用NumPy中的百分位数方法，从我们的后验预测中生成分位数是非常容易的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="c932" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">将所有这些放在一起，让我们不仅绘制平均后验反应，而且绘制95%后验预测。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/f4914328c244a0e0ce47d750eba3bb5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98_niypqnYXtV0bxq57Akw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">参数和模型UQ的贝叶斯推断</p></figure><h2 id="6491" class="md me iq bd mf mg mh dn mi mj mk dp ml ll mm mn mo lp mp mq mr lt ms mt mu mv bi translated">频繁主义方法</h2><p id="db95" class="pw-post-body-paragraph lc ld iq le b lf mw jr lh li mx ju lk ll my ln lo lp mz lr ls lt na lv lw lx ij bi translated">如果我们想验证我们的贝叶斯推断，我们还应该将我们的结果与频率主义方法进行比较。由于模型是非线性的，这将需要更多的手工计算，但是对于我们将要使用的库来说，这应该不会太难。</p><p id="c0da" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">首先，我们需要为模型“grad_newton_values”构建一个灵敏度矩阵。由于模型中只有1个参数，这个矩阵只是一个列向量。我们将使用自动签名库来自动区分关于τ的模型。</p><p id="f2b3" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">模型误差δk可以从我们的灵敏度阵列中计算出来。利用δk、t-逆数值(1.99)和我们对第1部分中σ的估计(1.42)，我们可以计算参数τ [3]的置信区间。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="d645" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们发现，在95%的置信区间下，τ在14.571和15.292之间。非常接近贝叶斯方法！</p><p id="047a" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">接下来，我们想比较贝叶斯和频率主义方法之间的UQ传播在我们的模型。这包括模型参数和数据的不确定性。下面我为我们的非线性模型生成了置信区间和预测区间。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="aca0" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我用星形影线绘制了95%的贝叶斯后验预测，用纯紫色绘制了95%的频率预测区间。这两种方法几乎完全重叠，因为在紫色阴影区域下面可以看到星形影线。我们看到在边界上，最小的绿色。看起来我们的贝叶斯方法和频率主义方法是一致的。</p><p id="274f" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">根据这些预测，我们可以提供作为时间函数的饮料温度的不确定性。例如，在25分钟时，如果我们多次运行该实验，我们预计大多数热饮的温度在40℃到45℃之间，有95%的把握。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/b12cc23358173dc0a6ec7260e625cf7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0JgmmAQ6lzC2sZXg_xSjVQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">两种方法的预测区间几乎相同</p></figure><h2 id="979c" class="md me iq bd mf mg mh dn mi mj mk dp ml ll mm mn mo lp mp mq mr lt ms mt mu mv bi translated">结论</h2><p id="57d2" class="pw-post-body-paragraph lc ld iq le b lf mw jr lh li mx ju lk ll my ln lo lp mz lr ls lt na lv lw lx ij bi translated">我们对参数的估计以及模型本身进行了UQ。我们已经发现PyMC3库对于处理非线性模型是多么强大，以及它与Python的集成是多么好。贝叶斯方法为我们如何开发和设计模型提供了极大的自由度。如果需要，我们可以将我们的可能性或温度模型从正态分布改为另一个参数模型。PyMC3的过程不会有太大变化。</p><p id="5e5a" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><strong class="le ir">参考文献</strong></p><p id="fcc0" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">[1] T. Donovan和R. M. Mickey，<em class="ne">贝叶斯统计初学者:循序渐进的方法</em>。牛津大学出版社。</p><p id="5c46" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">[2] O. Martin，<em class="ne">用Python进行贝叶斯分析:使用PyMC3和ArviZ进行统计建模和概率编程介绍，第2版</em>。帕克特出版有限公司，2018年。</p><p id="2730" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">[3] R. C. Smith，<em class="ne">不确定性量化:理论、实施和应用</em>。暹罗，2013年。</p></div></div>    
</body>
</html>