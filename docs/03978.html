<html>
<head>
<title>Pivoting to Efficient Data Summaries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">转向高效的数据汇总</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pivoting-to-efficient-data-summaries-d2bfac31da4a?source=collection_archive---------39-----------------------#2020-04-12">https://towardsdatascience.com/pivoting-to-efficient-data-summaries-d2bfac31da4a?source=collection_archive---------39-----------------------#2020-04-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a29d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对数据实施数据透视表的快速指南</h2></div><p id="ab07" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有职业和行业中最强大的工具之一是数据透视表。在大多数传统分析中，Microsoft Excel是必备技能，数据透视表是数据探索的核心。它们是动态的、相对直接的，并在数据的表层和深层提供重要的摘要。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="lj lk l"/></div><p class="ll lm gj gh gi ln lo bd b be z dk translated">资料来源:giphy.com</p></figure><p id="7ff7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我本人来自基于excel的分析背景，当我在Python中处理数据时，从数据透视表的角度思考总是处于我思考过程的最前沿。在Pandas数据框架中使用数据透视表实际上相对简单，在汇总数据时可以节省大量时间和精力。让我们仔细看看如何在数据中直接实现数据透视表。</p><p id="ce68" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用一个显示多个大洲历史视频游戏销售的数据集。让我们首先导入必要的数据库，看看我们有哪些数据:</p><h2 id="fd9b" class="lp lq it bd lr ls lt dn lu lv lw dp lx kr ly lz ma kv mb mc md kz me mf mg mh bi translated"><strong class="ak">导入包&amp;数据</strong></h2><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/69a169fb8a25b8d7cb24e1a175a5cb8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5fYBOr3LxmQWy2C3w4cnA.png"/></div></div></figure><p id="5a43" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看一下数据帧的快照。我们有视频游戏名称的等级、平台、记录年份、游戏类型、游戏发行商，以及来自北美、欧洲、日本、全球和其他地区的累计销售额。所有“销售”的销售数字都以<strong class="kk iu">百万计。</strong>查看我们的初始数据框架，我们看到Wii Sports是排名最高的游戏，全球销量相当于8274万。</p><p id="e072" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个来自Kaggle的数据集已经被清理过了，已经满了，所以我们不用担心任何数据清理，可以直接跳到数据透视表本身。</p><h2 id="2618" class="lp lq it bd lr ls lt dn lu lv lw dp lx kr ly lz ma kv mb mc md kz me mf mg mh bi translated">使用索引的基本数据透视表</h2><p id="96e0" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">创建数据透视表的语法非常简单。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mu"><img src="../Images/7c4062868ba9e33a95ca04b37ea3b269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ysSk-3ijkGqdnXp3Fh9FUg.png"/></div></div></figure><p id="7a50" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们指定数据、索引和想要聚合的列。生成的表格如下所示:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/b8fdaf30e323fee4ecb852f8e0635861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*ZGoYE81ILn7Flcuwez8CXQ.png"/></div></figure><p id="a84e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">提醒:这些数值以<strong class="kk iu">百万</strong>为单位</p><p id="5207" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这只是前十年销售的快照，但是我们可以看到给定列的数据汇总是多么简单和快速。这个数据框架现在很容易理解，并且可以被视为一段时间内的销售趋势。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mw"><img src="../Images/ef59ccc06b9795be7f976f78b78e9cbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tbjDADwr5yZ5_PjdFJ6Apw.png"/></div></div></figure><p id="8d4f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们很容易看到，随着时间的推移，日本是世界上最重要的视频游戏购买者，直到1995年左右，所有其他行业开始在销售上趋同。20世纪80年代末，在视频游戏引入的第一波浪潮过去并成为一种社会规范之后，整体销售额显著下降。</p><p id="6916" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们在表格中做一个小小的调整，将索引从“Year”改为“Genre”。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/62b33b1627aee16b27fcd4e026a05eab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OHi2ScboRVgZ6fYuS9w7JQ.png"/></div></div></figure><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mx"><img src="../Images/691c29a464085be01306ef652642f705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CVYmkUpXgVDhZowSz1LdVg.png"/></div></div></figure><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi my"><img src="../Images/8ccc23d8f9984f0f7a0f33cdf91528b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gMK43iRn8Py3FQXLBnS3pg.png"/></div></div></figure><p id="063a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过在代码中做这个简单的调整，我们可以得到一个完全不同的描述性统计数据。现在，我们可以通过流派和地理位置看到各种视频游戏的成功。我们看到平台和射击游戏是全球销量最高的视频游戏类型。在日本，角色扮演游戏卖得最多。</p><h2 id="5f74" class="lp lq it bd lr ls lt dn lu lv lw dp lx kr ly lz ma kv mb mc md kz me mf mg mh bi translated">多索引数据透视表</h2><p id="b961" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">如果我们想要跨多个索引进行聚合，pivot函数只需要简单地增加' index '参数。我们唯一需要确定的是，我们以列表格式传递索引。现在让我们使用数据透视表来看看出版商的销售情况，然后是流派。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/896c862c855c4d65ed19a824ff529ab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vi8193DC2aBkO-ogVFIWag.png"/></div></div></figure><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/c6acae6f7d2f7675053d9e9a3ff12708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*cAmxlebMqGax6vRuquWxww.png"/></div></figure><p id="daac" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到这是多么容易做到的，因为我们首先看到一个出版商公司的索引，然后是流派，接着是欧洲、日本和北美的各自销售情况。请注意，index参数将['Publisher '，' Genre']作为其参数。我们指定“值”参数只包括欧洲、日本和北美的销售额。自然，最终的数量会低得多，因为有大量的出版商，所以销售会少得多。</p><h2 id="4893" class="lp lq it bd lr ls lt dn lu lv lw dp lx kr ly lz ma kv mb mc md kz me mf mg mh bi translated">具有不同聚合的数据透视表</h2><p id="84f1" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">默认情况下，数据透视表将使用sum函数聚合值。然而，我们并不总是希望这样。也许我们想检查平均值、中间值或标准差。这些都可以通过对数据透视表语法中的“aggfunc”参数进行简单修改来实现。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi na"><img src="../Images/56a9b6eb42c2149904ddc2a40f793805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QP1cJqqA2ODsc35q9RfHNA.png"/></div></div></figure><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nb"><img src="../Images/1475e08f31992a66e84162f0b10fbc18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lr_ZIXN_Shqs4vnzOXUYww.png"/></div></div></figure><p id="63b7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们以字典的形式输入' aggfunc '参数，将聚合列指定为键，将我们想要的聚合函数指定为值(使用numpy函数)。在我们的例子中，我们对欧洲销售额使用平均值，对全球销售额使用总和，对日本销售额使用中值。通常，我们不会混合使用这些集合函数，因为这会导致一个混乱的表格，但是对于这个实验来说，这样就足够了。</p><h2 id="6a95" class="lp lq it bd lr ls lt dn lu lv lw dp lx kr ly lz ma kv mb mc md kz me mf mg mh bi translated">数据透视表内的关系</h2><p id="e42a" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">最后，让我们看看在x轴和y轴上使用可变索引。我们想尝试看看每年每种类型的全球销售额。我们可以像前面的表格一样创建一个多层次的索引，但是因为有这么多的年份和这么多的流派，这将会形成一个非常长且无法消化的表格。相反，我们将列指定为特性索引，然后声明我们正在聚合的值。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nc"><img src="../Images/41a78b679f69f2e572d28b64ca89edef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IzXZZ0VDbJLld7lEiYvVaQ.png"/></div></div></figure><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nd"><img src="../Images/88829d1182924df37b778a63926018a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*62BPTWTiFxwnJoqdTzU2iA.png"/></div></div></figure><p id="e4fe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该表现在在y轴上显示年份(索引参数)，在x轴上显示流派(列)。聚合函数对全球销售额求和。我们现在可以很容易地看到，例如，2011年射击游戏在全球销售了9936万美元。</p><p id="aa34" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ne">注意:可以将“fill_value”参数调整为等于0、NaN或任何其他聚合函数，如列的中值或平均值。标准NaN填充流程适用。</em></p><p id="3601" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">希望这将帮助您以更有效和高效的方式总结和探索您的数据，甚至帮助您从Excel分析转向Python(参见我在那里所做的)!</p></div></div>    
</body>
</html>