<html>
<head>
<title>How to Convert SQL Query Results to a Pandas Dataframe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将SQL查询结果转换为熊猫数据框架</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-convert-sql-query-results-to-a-pandas-dataframe-a50f0d920384?source=collection_archive---------5-----------------------#2020-05-27">https://towardsdatascience.com/how-to-convert-sql-query-results-to-a-pandas-dataframe-a50f0d920384?source=collection_archive---------5-----------------------#2020-05-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9c4d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python读取Jupyter笔记本中的SQL查询来创建熊猫数据框架</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9ee10d34aec537faf5a52cc8a4455ca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NyT2xZPFl98ymTOZjLQE9A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Tobias Fischer 在<a class="ae ky" href="https://unsplash.com/s/photos/database?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>【1】上拍摄的照片。</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="e699" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">目录</h1><ol class=""><li id="81f5" class="ly lz it ma b mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">介绍</li><li id="96fd" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">工具</li><li id="77ac" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">例子</li><li id="d09a" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">摘要</li><li id="e7d0" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">参考</li></ol><h1 id="0fa2" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">介绍</h1><p id="725c" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">作为一名数据科学家，您可能经常需要从数据库表中提取数据。建模过程中收集数据集的第一步通常是从SQL代码的结果中获取。SQL通常不是成为数据科学家所需的主要语言；但是，在某些情况下，练习和利用来获取数据集是很重要的。不过，也有一些问题——来回使用Python代码、SQL，有时还有Jupyter Notebook，可能会加重问题。有一个非常简单的过程可以帮助解决这个问题。解决方案是在Jupyter笔记本中编写SQL查询，然后通过将其转换为pandas数据帧来保存输出。下面，我将提供代码和一个例子来展示这个简单而有益的过程。</p><h1 id="4040" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">工具</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/5c63acf00277c662fb96b2ff7fafea0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1X0-98EiQNkwBJj2vnTTqQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@cdr6934?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯里德</a>在<a class="ae ky" href="https://unsplash.com/s/photos/python?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>【2】拍摄。</p></figure><p id="45a5" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated">这个过程由几个关键工具组成。首先，您将使用您原来已经有的SQL查询，然后，使用Python，将引用pandas库来将输出转换成数据帧，所有这些都在您的Jupyter笔记本中。</p><p id="0b3e" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated"><strong class="ma iu"> SQL </strong> —结构化查询语言，大多数数据分析师和数据仓库/数据库工程师使用这种语言来拉取数据，用于报表和数据集开发。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="d7b5" class="ny lh it nu b gy nz oa l ob oc">--return all columns from table<br/>SELECT * FROM TABLE</span></pre><p id="4d80" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated"><strong class="ma iu"> Python </strong> —数据科学家使用的主要编程语言之一。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="5ed1" class="ny lh it nu b gy nz oa l ob oc"># display text<br/>print('Hello, world!')</span></pre><p id="3562" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated"><strong class="ma iu"> Pandas </strong> —数据科学家用来从各种来源读取数据的流行图书馆。静态数据可以作为CSV文件读入。还可以使用pandas连接一个活动的SQL连接，然后将其从输出转换为数据帧。在下面的例子中对此进行了解释。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="868b" class="ny lh it nu b gy nz oa l ob oc"># creating and renaming a new a pandas dataframe column<br/>df['new_column_name'] = df['original_column_name']</span></pre><p id="5466" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated"><strong class="ma iu"> Jupyter Notebook </strong> —为您的数据科学模型运行Python代码(以及SQL)的平台/环境。</p><h1 id="f392" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">例子</h1><p id="8e9e" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">在这个例子中，我将使用一个模拟数据库作为SQL查询将引用的存储环境。</p><p id="7281" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated">首先，导入pandas库，如果需要，创建一个别名'<em class="od"> pd' </em>,用于速记符号。接下来，创建一个凭据变量来存储:</p><ul class=""><li id="fa48" class="ly lz it ma b mb no md np mf oe mh of mj og ml oh mn mo mp bi translated">数据库/SQL环境— PostgreSQL</li><li id="cdc5" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml oh mn mo mp bi translated">用户名:密码</li><li id="4c30" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml oh mn mo mp bi translated">数据仓库:数据库URL (IP地址)</li><li id="0f7a" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml oh mn mo mp bi translated">通道数</li><li id="b953" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml oh mn mo mp bi translated">数据库名称</li></ul><p id="6fb7" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated">这个变量将是一个用引号括起来的长字符串。Jupyter笔记本中的下一个单元格将是SQL查询本身。Pandas将用于执行查询，同时将输出转换为数据帧。该查询的格式是包含带有三重引号的语句。在最后一个引号之后，逗号后面会跟一个连接参数，该参数将等于您的凭据变量。</p><blockquote class="oi"><p id="4341" class="oj ok it bd ol om on oo op oq or ml dk translated">以下是该示例的代码(您必须使用自己的凭据):</p></blockquote><pre class="os ot ou ov ow nt nu nv nw aw nx bi"><span id="126b" class="ny lh it nu b gy nz oa l ob oc"># import python library<br/>import pandas as pd</span><span id="d3d9" class="ny lh it nu b gy ox oa l ob oc"># assign a variable that contains a string of your credentials<br/>credentials = "postgresql://username:password@your_sql_connection_url:port_number/database_name"</span><span id="9d68" class="ny lh it nu b gy ox oa l ob oc"># read in your SQL query results using pandas<br/>dataframe = pd.read_sql("""<br/>            SELECT column_1, column_2<br/>            FROM Table<br/>            WHERE column_1 &gt; number<br/>            ORDER BY column_1<br/>            """, con = credentials)</span><span id="7ac9" class="ny lh it nu b gy ox oa l ob oc"># return your first five rows<br/>dataframe.head()</span></pre><p id="040c" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated">仔细看看Jupyter笔记本中的代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/fc80003a5e60b68c699f6cf455668de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4xEhhvcxa23AGJnIVDaI5Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Jupyter笔记本的例子(改为read_dql改为read_sql)。作者截图[3]。</p></figure><p id="aa90" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated">更多关于熊猫功能的文档，点击<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_sql.html" rel="noopener ugc nofollow" target="_blank">这里</a>【4】。您还可以在那里找到更多关于参数的有益信息。</p><h1 id="73e9" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">摘要</h1><p id="6e6a" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">当创建将用作数据集的数据框时，有大量选项可用于收集该数据。有时读入CSV，而数据帧可以通过定义列和值来生成。但是，在本例中，我们看到您可以使用SQL从数据库中查询，并将这些结果作为数据返回，最终作为新的数据帧读入。现在你有了数据框架，你就可以遵循数据科学的正常流程了。希望这篇文章对您有所帮助，感谢您的阅读！</p><h1 id="982a" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">参考</h1><p id="a8bd" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">[1]照片由<a class="ae ky" href="https://unsplash.com/@tofi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">托比亚斯·菲舍尔</a>在<a class="ae ky" href="https://unsplash.com/s/photos/database?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>(2017)拍摄</p><p id="1dd1" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated">[2]Chris Ried在<a class="ae ky" href="https://unsplash.com/s/photos/python?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片，(2018)</p><p id="8864" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated">[3] M.Przybyla，Jupyter笔记本截图，(2020)</p><p id="1090" class="pw-post-body-paragraph na nb it ma b mb no ju nc md np jx nd mf nq nf ng mh nr ni nj mj ns nl nm ml im bi translated">[4]熊猫，(2008年至2014年)</p></div></div>    
</body>
</html>