<html>
<head>
<title>How to perform scenario analysis of a financial portfolio in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Python 中执行金融投资组合的场景分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f?source=collection_archive---------11-----------------------#2020-04-15">https://towardsdatascience.com/how-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f?source=collection_archive---------11-----------------------#2020-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dce5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">蒙特卡罗模拟在金融投资组合情景分析中的应用</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ecd10a13fc03b24a4225a3608f81fc3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a6Hmvj5SUhoQ4TFB"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b50e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">金融投资者知道没有人能预测未来，但他们也知道他们必须至少对未来的可能性有一个概念。这就是为什么情景分析是投资者工具箱中非常强大的工具。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a3c8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">情况分析</h1><p id="98e3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">情景分析是一门学科，它试图给出与一种现象相关的未来可能发生的情景的概率观点。</p><p id="2455" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上一篇文章中，我已经向您展示了如何使用遗传算法在 R 中执行投资组合优化。虽然投资组合优化是一门科学，但情景分析几乎就像一门艺术。它通常从一些假设开始，然后使用蒙特卡罗技术模拟许多未来情景。模拟场景的数量越多，精确度越高。最后，对所有仿真结果进行了分析。例如，金融投资组合的典型情景分析可以与风险相关(例如，我们的投资组合在 30 天内损失 3%的概率是多少)。</p><p id="bc8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示如何将情景分析应用于金融投资组合。对于这个例子，我们将使用 2010 年 1 月 1 日至 2019 年 1 2 月 31 日的每日历史数据，模拟由微软(50%)、苹果(20%)和谷歌(30%)股票组成的投资组合。我们将以比过去更悲观的方式修正他们的平均回报率，并计算我们投资组合的累积预期回报率、置信区间和预期夏普比率。</p><p id="a6a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一切都将在 Python 中完成。你可以在这里获得 GitHub 上的完整笔记本:<a class="ae ky" href="https://github.com/gianlucamalato/machinelearning/blob/master/Portfolio_scenario_analysis.ipynb" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/gianlucamalato/machine learning/blob/master/Portfolio _ scenario _ analysis . ipynb</a></p><h1 id="8e55" class="mc md it bd me mf mz mh mi mj na ml mm jz nb ka mo kc nc kd mq kf nd kg ms mt bi translated">数据收集</h1><p id="1bed" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，我们需要安装<code class="fe ne nf ng nh b">yfinance</code>库。它允许我们直接从笔记本上下载股票价格。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="5f34" class="nm md it nh b gy nn no l np nq">!pip install yfinance</span></pre><p id="c511" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们可以导入一些有用的库:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="12a8" class="nm md it nh b gy nn no l np nq">import yfinance<br/>import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt</span></pre><p id="ba75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于每只股票，我们要计算从第<em class="nr"> t </em>天到第<em class="nr"> t+1 </em>天的收盘价<em class="nr"> P </em>的日收益，定义为</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/7703a3b43600fb7621578756dcd8f949.png" data-original-src="https://miro.medium.com/v2/resize:fit:326/0*ZYTSvPet5sq9GNjm"/></div></figure><p id="7b13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，Python 系列提供了有用的<em class="nr"> pct_change </em>方法，为我们计算这个公式。</p><p id="b508" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来定义投资组合的组成和用每只股票的日收益填充熊猫数据框的循环。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="0174" class="nm md it nh b gy nn no l np nq">portfolio_composition = [('MSFT',0.5),('AAPL',0.2),('GOOG',0.3)]<br/>returns = pd.DataFrame({})</span><span id="2e9a" class="nm md it nh b gy nt no l np nq">for t in portfolio_composition:<br/>  name = t[0]<br/>  ticker = yfinance.Ticker(name)<br/>  data = ticker.history(interval="1d",<br/>     start="2010-01-01",end="2019-12-31")<br/>  <br/>  data['return_%s' % (name)] = data['Close'].pct_change(1)</span><span id="cc3f" class="nm md it nh b gy nt no l np nq">  returns = returns.join(data[['return_%s' % (name)]],<br/>     how="outer").dropna()</span></pre><p id="df80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ne nf ng nh b">returns</code>数据帧如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/4203254a1201a26480ec61356f191cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*8Ey2gCktKkammpVAxRHwHg.png"/></div></div></figure><p id="1bbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们准备模拟我们的数据。</p><h1 id="0a42" class="mc md it bd me mf mz mh mi mj na ml mm jz nb ka mo kc nc kd mq kf nd kg ms mt bi translated">单一股票的蒙特卡罗模拟</h1><p id="e0b3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果我们想在未来模拟<em class="nr"> m </em>天，我们只需要:</p><ul class=""><li id="e787" class="nv nw it lb b lc ld lf lg li nx lm ny lq nz lu oa ob oc od bi translated">以一只股票的原始收益时间序列为例</li><li id="5410" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">选择替换的<em class="nr"> m </em>值，随机均匀取值</li></ul><p id="72b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。它与 bootstrap 非常相似，bootstrap 是一种重采样技术。这种方法假设未来收益是对过去收益的随机重采样。这是一个很强的近似值，但它可以是一个很好的起点。</p><p id="ca0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种模拟可以通过下面函数中的一行代码轻松完成:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="c22c" class="nm md it nh b gy nn no l np nq">def simulate_returns(historical_returns,forecast_days):<br/>  return historical_returns.sample(n = forecast_days, <br/>                replace = True).reset_index(drop = True)</span></pre><p id="4725" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们尝试模拟 1000 天，我们会得到:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="e09e" class="nm md it nh b gy nn no l np nq">simulate_returns(returns['return_AAPL'],1000)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/bf9e8cb27ad8927097c3c10896917a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*n3s-pAIKkvib9hdlG59f_w.png"/></div></figure><p id="36d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们为模拟投资组合创建必要的函数。</p><h1 id="3001" class="mc md it bd me mf mz mh mi mj na ml mm jz nb ka mo kc nc kd mq kf nd kg ms mt bi translated">投资组合的蒙特卡罗模拟</h1><p id="0742" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">投资组合是收益和权重的组合。给定第<em class="nr"> i- </em>只股票的收益<em class="nr"> R </em> ᵢ，给定投资组合中每只股票的权重<em class="nr"> w </em> ᵢ(所有权重总和必须为 1)，投资组合收益<em class="nr"> R </em>可以表示为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/5c0e44d59e5186292b720e759b796c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:274/0*Z47Mvfl6SuswGY5n"/></div></figure><p id="152d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是股票收益的加权和。</p><p id="bc10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是从我们之前创建的<code class="fe ne nf ng nh b">returns</code>数据帧开始执行所有计算的函数:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="3359" class="nm md it nh b gy nn no l np nq">def simulate_portfolio(historical_returns, <br/>   composition, <br/>   forecast_days):<br/>  result = 0<br/>  for t in composition:<br/>    name,weight = t[0],t[1]<br/>    s = simulate_returns(historical_returns['return_%s' % (name)], <br/>      forecast_days)<br/>    result = result + s * weight<br/>  <br/>  return(result)</span></pre><p id="f2e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如果我们模拟 10 天的投资组合会发生什么:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="0511" class="nm md it nh b gy nn no l np nq">simulate_portfolio(returns,portfolio_composition,10)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/ed46f79fa10db16c03c11046e769f5be.png" data-original-src="https://miro.medium.com/v2/resize:fit:244/format:webp/1*H0RGrNvMkLDQukZ29RNPFg.png"/></div></figure><p id="3826" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于投资组合模拟来说，这可能已经足够了，但是我们还需要更多，那就是假设分析。</p><h1 id="fa5b" class="mc md it bd me mf mz mh mi mj na ml mm jz nb ka mo kc nc kd mq kf nd kg ms mt bi translated">假设分析</h1><p id="1105" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果我们像之前那样进行投资组合模拟，我们只是说未来收益是过去收益的随机样本。我们已经知道这并不完全正确。此外，也许我们正在进行情景分析，因为我们想知道如果某些条件将会发生什么。比如，如果每只股票的日均收益低于其历史价值，会发生什么？</p><p id="1086" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">历史平均回报率为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/f0e35dfaeb56dd569cc1499a33b529c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*8mHzHxsWGQRTYfF6WTHcFA.png"/></div></figure><p id="2440" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们试着模拟一下，如果 MSFT 的平均回报率下降-0.0001，AAPL 下降-0.001，谷歌下降-0.0005，会发生什么。我们必须从每只股票中减去这些数量，然后用修改后的新数据模拟未来的投资组合。</p><p id="240a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将把这些修正直接添加到<code class="fe ne nf ng nh b">portfolio_composition</code>列表中(它们是每个元组的第三个组件):</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="8d36" class="nm md it nh b gy nn no l np nq">portfolio_composition = [<br/>   ('MSFT', 0.5,-0.0001), <br/>   ('AAPL', 0.2,-0.001), <br/>   ('GOOG', 0.3,-0.0005)<br/>]</span></pre><p id="f963" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们可以重新定义所有先前定义的函数。</p><p id="19f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是模拟修改股票的功能:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="c19e" class="nm md it nh b gy nn no l np nq">def simulate_modified_returns(<br/>      historical_returns,<br/>      forecast_days,<br/>      correct_mean_by):</span><span id="c5d2" class="nm md it nh b gy nt no l np nq">  h = historical_returns.copy()</span><span id="8f51" class="nm md it nh b gy nt no l np nq">  new_series = h + correct_mean_by</span><span id="2267" class="nm md it nh b gy nt no l np nq">  return new_series.sample(n=forecast_days,  <br/>     replace = True).reset_index(drop=True)</span></pre><p id="539a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是模拟修改后的投资组合的函数:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="3a2b" class="nm md it nh b gy nn no l np nq">def simulate_modified_portfolio(<br/>   historical_returns,<br/>   composition,<br/>   forecast_days):<br/>  <br/>  result = 0<br/>  <br/>  for t in composition:<br/>    name,weight,correction = t[0],t[1],t[2]<br/>    s = simulate_modified_returns(<br/>       historical_returns['return_%s' % (name)], <br/>       forecast_days,correction<br/>    )<br/>    <br/>    result = result + s * weight<br/>  <br/>  return(result)</span></pre><p id="93b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以定义一个多次执行投资组合模拟的函数，生成许多可能的场景:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="b6af" class="nm md it nh b gy nn no l np nq">def simulation(<br/>  historical_returns,<br/>  composition,<br/>  forecast_days,<br/>  n_iterations):<br/>  <br/>   simulated_portfolios = None</span><span id="c9bf" class="nm md it nh b gy nt no l np nq">   for i in range(n_iterations):<br/>       sim = simulate_modified_portfolio(<br/>         historical_returns,<br/>         composition,<br/>         forecast_days<br/>       )</span><span id="73a5" class="nm md it nh b gy nt no l np nq">   sim_port = pd.DataFrame({'returns_%d' % (i) : sim})</span><span id="4a5c" class="nm md it nh b gy nt no l np nq">   if simulated_portfolios is None:<br/>         simulated_portfolios = sim_port<br/>   else:<br/>         simulated_portfolios = simulated_portfolios.join(sim_port)<br/>    <br/>   return simulated_portfolios</span></pre><p id="5aad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们准备开始我们的模拟和分析结果。</p><h1 id="4612" class="mc md it bd me mf mz mh mi mj na ml mm jz nb ka mo kc nc kd mq kf nd kg ms mt bi translated">模拟和结果</h1><p id="d790" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们模拟未来 20 天，计算 200 个不同场景的统计数据。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="4c39" class="nm md it nh b gy nn no l np nq">forecast_days = 20<br/>n_iterations = 200</span></pre><p id="a1a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以运行模拟:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="4973" class="nm md it nh b gy nn no l np nq">simulated_portfolios = simulation(returns,<br/>    portfolio_composition,forecast_days,n_iterations)</span></pre><p id="321f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果迭代次数很多，此功能可能需要几秒钟甚至几分钟。</p><p id="535c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/9f2d649ce2911a6dd4a6785f1340b2c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CFGpOFU8lYmQU_4K3WWhyQ.png"/></div></div></figure><p id="496d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每一列是一个模拟投资组合的场景，每一行是未来的一天。</p><p id="d90f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以投资组合的每日收益为例，我们可以用复利公式计算出<em class="nr"> N </em>天后的收益:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/bc184937d1fc96f888b5d9ff35e7b148.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/0*QVrbx3BeGKzxmB_t"/></div></figure><p id="a8e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于回报是非常小的数字，我们可以将该表达式近似为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6109f53fe49189f39fff0d5df1826b2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/0*0krfKfQliPErPD4C"/></div></figure><p id="7b2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即<em class="nr"> N </em>天后的收益是<em class="nr"> N </em>天的收益之和。</p><p id="4352" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以从这个数据集计算一些可观测量。</p><h2 id="ce5b" class="nm md it bd me oq or dn mi os ot dp mm li ou ov mo lm ow ox mq lq oy oz ms pa bi translated">未来回报的置信区间</h2><p id="ddb9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">情景分析可以用作风险管理工具。为此，我们可能要计算未来累积回报的第 5 个和第 95 个百分位数。前者告诉你，我们的投资组合有 5%的机会跑输这个价值，后者告诉你，你的投资组合有 5%的机会跑赢这个价值。我们还想了解投资组合的平均表现。</p><p id="c56f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是计算这三条曲线的代码。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="2fa0" class="nm md it nh b gy nn no l np nq">percentile_5th = simulated_portfolios.cumsum().apply(lambda x : np.percentile(x,5),axis=1)</span><span id="4fbb" class="nm md it nh b gy nt no l np nq">percentile_95th = simulated_portfolios.cumsum().apply(lambda x : np.percentile(x,95),axis=1)</span><span id="fdf1" class="nm md it nh b gy nt no l np nq">average_port = simulated_portfolios.cumsum().apply(lambda x : np.mean(x),axis=1)</span></pre><p id="4670" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">情节是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/7ecae5ed854389913029886590a1f4d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*UCDfb24EkrjdnzHIYnCppA.png"/></div></figure><p id="36c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">波段是百分位数，实线是平均投资组合。如你所见，20 天后，我们的投资组合有 5%的可能性会损失 5.3%(低波段)，有 5%的可能性我们的投资组合回报会高于 8.3%(高波段)。平均而言，我们预计我们的投资组合有 1%的回报率(实线)。</p><h2 id="91bb" class="nm md it bd me oq or dn mi os ot dp mm li ou ov mo lm ow ox mq lq oy oz ms pa bi translated">达到目标回报的概率</h2><p id="5704" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们可以进行的另一种分析是，作为未来一天的函数，我们的投资组合跑赢目标回报的概率。</p><p id="79e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于概率是一个可观测的值，我们也想计算它的标准误差。</p><p id="24f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们有一个样本概率<em class="nr"> p </em>(即肯定事件的数量除以场景的数量<em class="nr"> N </em>)，其标准误差的估计值为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/3b72acd8187e1e0f6432f74eb4c91c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:222/0*TFEpG32f-C-fPrh2"/></div></figure><p id="1fdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用每天计算的这个值，在图表中显示误差线。</p><p id="df76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们有一个 2%的目标。达到这一目标的概率计算如下:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="ae84" class="nm md it nh b gy nn no l np nq">target_return = 0.02</span><span id="bd68" class="nm md it nh b gy nt no l np nq">target_prob_port = simulated_portfolios.cumsum().apply(<br/>      lambda x : np.mean(x &gt; target_return)<br/>   ,axis=1)</span></pre><p id="9a5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">误差线的大小用标准误差公式计算:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="03cd" class="nm md it nh b gy nn no l np nq">err_bars = np.sqrt(<br/>   target_prob_port * (1-target_prob_port) / n_iterations<br/>)</span></pre><p id="1811" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以绘制结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/c9d8d41647445c885ea5cfb02ca89e1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*d7FKdIdlT_TybWKilBbJKQ.png"/></div></figure><p id="7c3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，超额完成我们的目标回报的可能性随着时间的推移而增加(这显然是正确的，因为我们的投资组合有正的平均回报)。20 天后，我们的投资组合将以 38.0 +/- 3.4%的概率跑赢 2%的目标。</p><h2 id="af20" class="nm md it bd me oq or dn mi os ot dp mm li ou ov mo lm ow ox mq lq oy oz ms pa bi translated">夏普比率的期望值和直方图</h2><p id="9755" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后，我们可以计算一些与夏普比率相关的统计量。这是一个非常受欢迎的投资组合绩效指标，对于本例，我们可以计算投资组合的夏普比率回报率<em class="nr"> R </em>如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/25a8cb275fc7169f734878eba293dd31.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/0*-whhcmpeE_ZBQhnM"/></div></figure><p id="6937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<em class="nr"> E(x) </em>是期望值，<em class="nr"> Var(x) </em>是方差。</p><p id="98a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的 200 个投资组合场景中的每一个都有自己的夏普比率，所以我们可以计算出每一个的夏普比率。然后我们可以绘制直方图并计算平均值。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="14a1" class="nm md it nh b gy nn no l np nq">sharpe_indices = simulated_portfolios.apply(<br/>   lambda x : np.mean(x)/np.std(x)<br/>)</span></pre><p id="856d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直方图为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/5835ab80914564054e760ebb21f9fcec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*y5dh30AHYkK_t99nWGsbfQ.png"/></div></figure><p id="a540" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">平均值为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/f11a0adaeaa89d314cc4eb39d61eaf4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*LqoeGZ1YupCH-Loqmzxg2w.png"/></div></figure><h1 id="399d" class="mc md it bd me mf mz mh mi mj na ml mm jz nb ka mo kc nc kd mq kf nd kg ms mt bi translated"><strong class="ak">结论</strong></h1><p id="fffc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，我向您展示了如何用 Python 对金融投资组合进行简单的场景分析。这种方法可以适用于许多问题和情景(例如，波动性增加、黑天鹅、某些行业的危机)，以评估投资组合未来可能的风险及其成长能力。</p><p id="e5cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个工具可以很容易地与投资组合优化混合，以评估金融资产配置的完整分析。</p><h1 id="a3fa" class="mc md it bd me mf mz mh mi mj na ml mm jz nb ka mo kc nc kd mq kf nd kg ms mt bi translated">参考</h1><p id="37d9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">[1]吉安卢卡·马拉托。利用遗传算法进行 R 中的投资组合优化。交易科学家。<a class="ae ky" href="https://medium.com/the-trading-scientist/portfolio-optimization-in-r-using-a-genetic-algorithm-8726ec985b6f" rel="noopener">https://medium . com/the-trading-scientist/portfolio-optimization-in-r-using-a-genetic-algorithm-8726 EC 985 b 6 f</a></p><p id="6f36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2]吉安卢卡·马拉托。<em class="nr">自举。任何数据科学家的瑞士军刀</em>。数据科学记者。https://medium . com/data-science-reporter/the-bootstrap-the-Swiss-army-knife-of-any-data-scientist-acd6e 592 be 13</p><p id="f882" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3] <em class="nr">二项分布页。</em>维基百科<em class="nr">。</em><a class="ae ky" href="https://en.wikipedia.org/wiki/Binomial_distribution" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Binomial_distribution</a></p><p id="b6ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[4] <em class="nr">夏普比率页</em>。维基百科。<a class="ae ky" href="https://en.wikipedia.org/wiki/Sharpe_ratio" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Sharpe_ratio</a></p></div></div>    
</body>
</html>