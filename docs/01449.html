<html>
<head>
<title>How to Calculate &amp; Use the AUC Score</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何计算和使用 AUC 分数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-calculate-use-the-auc-score-1fc85c9a8430?source=collection_archive---------5-----------------------#2020-02-09">https://towardsdatascience.com/how-to-calculate-use-the-auc-score-1fc85c9a8430?source=collection_archive---------5-----------------------#2020-02-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="84d1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从理论到应用</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/39ca62c79f86770abb9310b705498ccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8ZColuEVYxSFyXcs"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">于尔根·舍夫在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="0691" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">受试者操作特征(ROC)曲线是一个图表，允许我们评估二元分类器的性能。对于不平衡数据集，曲线下面积(AUC)分数是根据 ROC 计算的，并且是不平衡数据集的一个非常有用的指标。</p><p id="8e73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将回顾这个理论，并用 Python 3.x 代码实现它。内容改编自维多利亚大学<a class="ae ky" href="https://web.uvic.ca/~maryam/" rel="noopener ugc nofollow" target="_blank"> Maryam Shoaran </a>教授的<a class="ae ky" href="https://web.uvic.ca/calendar2020-01/CDs/SENG/474.html" rel="noopener ugc nofollow" target="_blank">数据挖掘(SENG 474) </a>。</p><h1 id="6867" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据集和模型</h1><p id="fad4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">对于这个例子，我们将使用 sklearn 上的<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_breast_cancer.html" rel="noopener ugc nofollow" target="_blank">乳腺癌威斯康星州数据集</a>。在开始对模型评分并进入本帖的主题之前，我们将做以下工作:</p><ul class=""><li id="c9e4" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">在培训和测试之间拆分数据</li><li id="9de6" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">特征缩放</li><li id="02a4" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">拟合逻辑回归(LR)模型</li></ul><h1 id="48d2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">阈值和预测</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/c494dc023cbed3311edcbca066e2d9e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DBrl2w9GmZAgaO7W"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@unspsh?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">炫铭</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></p></figure><p id="26d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们想到朴素贝叶斯(NB)或 LR 等分类器时，它们会产生实例概率或得分。该评分分类器可以与阈值一起使用，以生成诸如是或否的决定</p><p id="9271" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，阈值分类是单调的，我们可以利用这一特性来创建 ROC 空间。关键思想表述如下:</p><blockquote class="nh ni nj"><p id="b3c8" class="kz la nk lb b lc ld ju le lf lg jx lh nl lj lk ll nm ln lo lp nn lr ls lt lu im bi translated">相对于给定阈值被分类为阳性的任何实例对于所有较低的<strong class="lb iu">阈值也将被分类为阳性。</strong></p></blockquote><p id="d368" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，对于 LR，如果分类器概率估计高于阈值，它将产生肯定的类别预测，否则它将产生否定的类别预测。</p><p id="9e16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，许多离散分类器，如决策树或规则集，可以通过查看它们内部及其保存的实例统计信息来转换为评分分类器。例如，类比例可以作为一个分数，类决策只是最普遍的类。</p><p id="8ab1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的示例中，我们在 LR 分类器上拟合数据，并在下表<code class="fe no np nq nr b">df_pred</code>中总结结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/15db54c120a2a1893944099af9e9ad99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*rjOgcp8eNyNTg1iOa40lgg.png"/></div></figure><h1 id="93fb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">建立 ROC 空间</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/a57ed8050143baef295603dc24309791.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4HAzAYgZ_pIyeUh0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@jens_johnsson?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">延斯·约翰森</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="180e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ROC 图是从线性扫描创建的。根据上表中的信息，我们实施以下步骤:</p><ul class=""><li id="69f4" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">按降序排列正类的概率</li><li id="3cc3" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">向下移动列表(降低阈值)，一次处理一个实例</li><li id="f49d" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">一边走一边计算真阳性率(TPR)和假阳性率(FPR)</li></ul><p id="fd26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回想一下，TPR 和 FPR 的定义如下:</p><ul class=""><li id="8063" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">TPR =真阳性/所有阳性</li><li id="b097" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">FPR =假阳性/全部阴性</li></ul><p id="0f8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们对上一节的数据帧进行了排序，并从中创建了一个名为<code class="fe no np nq nr b">df_roc </code>的新数据帧，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/3017c0cd005226d597bd231be5d73713.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*1PxBxJIFTdRDNi1frjTfHg.png"/></div></figure><p id="24b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">信息排序后，我们运行下面的代码块，返回两个数组:一个用于 TPR，一个用于 FPR。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="b2f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">绘制我们的结果，我们得到熟悉的 ROC 曲线:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/b10d054709855709d5fb3bdf175cb3ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rh5nrAgk1IEgz1N4llnteQ.png"/></div></div></figure><p id="db1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AUC 分数就是曲线下的面积，可以用<a class="ae ky" href="https://en.wikipedia.org/wiki/Simpson%27s_rule" rel="noopener ugc nofollow" target="_blank">辛普森法则</a>计算。AUC 分数越大，我们的分类器就越好。</p><h1 id="6201" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">凸包</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/2e7e5bacad6bdc679604eeb98642ded1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n7uaU8xwHN9VEU6j"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约翰·吉本斯在 Unsplash 的照片</p></figure><p id="a42d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">给定两个分类器 A &amp; B，我们期望两个不同的 ROC 曲线。考虑下面的情节:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/acc22de0a54a13999b66236a7b442406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BC6dFdjApp94CCp8xxAOCg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">资料来源:Maryam <a class="ae ky" href="https://web.uvic.ca/~maryam/" rel="noopener ugc nofollow" target="_blank"> Shoaran </a></p></figure><p id="1524" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阴影区域被称为<a class="ae ky" href="https://en.wikipedia.org/wiki/Convex_hull" rel="noopener ugc nofollow" target="_blank">凸包</a>，我们应该总是在位于凸包上边界的点上操作。</p><p id="1606" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我们想要在<code class="fe no np nq nr b">40%</code> TPR 下操作，我们选择对应于大约<code class="fe no np nq nr b">5%</code>的 FPR 的分类器 A。或者，如果我们想要覆盖 TPR 的<code class="fe no np nq nr b">80%</code>，我们选择比 a 给出更好的 FPR 的分类器 B</p><h1 id="369c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">组合分类器</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/895c3cd1df130fbd223f993c151c5421.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DluYmbbbKHVpgMev"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Pablo garcía saldaa 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="8fcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们是一家保险公司，希望向客户推销保险单。然而，由于预算限制，我们只能接触到<code class="fe no np nq nr b">4000</code>条线索中的<code class="fe no np nq nr b">800</code>个客户。预期回应率是<code class="fe no np nq nr b">6%</code>，它的意思是<code class="fe no np nq nr b">240</code>会说是，<code class="fe no np nq nr b">3760</code>会说不是</p><p id="2efd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们有两个分类器 A &amp; B，使得 A 的最佳点是(FPR=0.1，TPR=0.2)，B 的最佳点是(FPR=0.25，TPR=0.6)。</p><p id="fba9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们的决定基于分类器 A，我们将期望以下候选数目:<code class="fe no np nq nr b">0.1*3760 + 0.2*(240) = 424</code>。对于 B 来说就是:<code class="fe no np nq nr b">0.25*3760 + 0.6*(240) = 1084</code>。</p><p id="8378" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用分类器 A，我们接触的人太少，而使用分类器 B，我们超出了预算。这个问题的解决方案如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/f4eadbdf836bf1adca54472c22177ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*Qfm4s_VyMI5ldsVrF8ivkQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">资料来源:Maryam <a class="ae ky" href="https://web.uvic.ca/~maryam/" rel="noopener ugc nofollow" target="_blank"> Shoaran </a></p></figure><p id="2c18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">约束线上的点 C (0.18，0.42)位于 A 和 B 之间，它将给出我们期望的性能。我们将<code class="fe no np nq nr b">k</code>计算为 C 位于 A &amp; B 之间的<a class="ae ky" href="https://en.wikipedia.org/wiki/Proportionality_(mathematics)" rel="noopener ugc nofollow" target="_blank">比例距离</a>，我们将其计算为<code class="fe no np nq nr b">k=(0.18–0.1)/(0.25–0.1)=.53</code>。</p><p id="42d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在实践中，这意味着对于我们希望分类的每个点，遵循此过程以获得 C 的性能:</p><ul class=""><li id="9789" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">生成一个介于 0 和 1 之间的随机数</li><li id="1e62" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">如果该数字大于 k，则应用分类器 A</li><li id="f764" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">如果数量小于 k，则应用分类器 B</li><li id="0cbd" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">重复下一点</li></ul><h1 id="29ac" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="33a5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">与任何数据科学问题一样，一个指标不足以说明全部情况。除了 AUC 之外，准确性、辐射和 f1 分数等指标可以让我们更多地了解分类器的情况。</p><h1 id="01ee" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><div class="oc od gp gr oe of"><a href="https://web.uvic.ca/calendar2020-01/CDs/SENG/474.html" rel="noopener  ugc nofollow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">SENG 474</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">数据挖掘导论。数据准备、模型构建和数据挖掘技术，如聚类…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">网站 uvic.ca</p></div></div></div></a></div><div class="oc od gp gr oe of"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_breast_cancer.html" rel="noopener  ugc nofollow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">sk learn . datasets . load _ breast _ cancer-sci kit-learn 0 . 22 . 1 文档</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">sci kit-learn:Python 中的机器学习</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">scikit-learn.org</p></div></div><div class="oo l"><div class="op l oq or os oo ot ks of"/></div></div></a></div></div></div>    
</body>
</html>