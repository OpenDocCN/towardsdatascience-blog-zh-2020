# 张量流 CNN 模型中的预处理层 2

> 原文：<https://towardsdatascience.com/preprocessing-layer-in-cnn-models-for-tf2-d471e61ddc2e?source=collection_archive---------22----------------------->

## 一种使 CNN 模型更不容易出错、更易于开发人员使用的技术

![](img/234bb05bbc24130efe39df79d61ec5f5.png)

来源:pexels.com

机器学习新手最常犯的一个错误是忘记**标准化输入图像**。难怪！当你进行迁移学习时，每个模型需要不同的输入标准化。**比如 VGG**需要从 RGB 图像中减去这个矢量【123.68，116.779，103.939】。 **MobileNetV2** 需要区间< -1，1 >的输入。PyTorch 模型通常使用不同的归一化方法。这个技巧可以在将来为您节省大量时间和 bug。在将图像输入到模型之前，不需要进行标准化，您可以简单地将该层添加到您的模型中(计算图)。

*使用旧的 TensorFlow 1(安息吧),您可以简单地向图形添加预处理操作，并冻结该模型。然而，在 TensorFlow 2+中，您需要创建自己的预处理层。*

因此，首先定义我们的预处理方法(这是针对 MobileNetV2 的):

然后创建从 *tf.keras.layers.Layer* 继承的自定义层，并在输入上使用 call 方法中的函数:

创建模型时，在调用预训练模型的基础模型之前插入层(tf.keras 的功能 API):

**就这样！**

从现在开始，您的模型总是只接受 RGB [0，255]图像，并且输入的规范化在模型内部完成。如果您以 Keras .h5 格式保存了这样一个模型，那么不要忘记在模型加载期间指定定制对象。我总是建议将模型保存为 SavedModel 或 TFLITE 格式，因为模型中的一切都被冻结了，可以随时部署了！

**用预处理层你:**

*   节省了其他人调试你的模型的大量时间。
*   **在使用您的模型时，您不需要告诉您的客户以任何方式标准化图像。将不同版本/架构的模型部署到移动设备上的计算机视觉应用程序时，这通常很痛苦。**

下次见！

米哈尔