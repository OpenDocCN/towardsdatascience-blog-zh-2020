<html>
<head>
<title>ggplot: Grammar of Graphics in Python with Plotnine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ggplot:使用 Plotnine 的 Python 中的图形语法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/ggplot-grammar-of-graphics-in-python-with-plotnine-2e97edd4dacf?source=collection_archive---------12-----------------------#2020-08-02">https://towardsdatascience.com/ggplot-grammar-of-graphics-in-python-with-plotnine-2e97edd4dacf?source=collection_archive---------12-----------------------#2020-08-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="6814" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据可视化</h2><div class=""/><div class=""><h2 id="972d" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated"><strong class="ak">强大的图形库，提供出色的可视化效果</strong></h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/c5c82945ff65b3131fe85bbf0c985189.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ibVsOUyxoCqyqUjcqOqk4g.png"/></div></div></figure><p id="ba7a" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">你希望 Python 能模仿 R 语言中<em class="lz"> ggplot </em>给你的出色可视化效果吗？嗯，可以的。</p><p id="e36f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们将探索<em class="lz"> Plotnine </em>的功能，这是一个基于<em class="lz"> ggplot2 </em>的 Python 可视化库。</p><p id="411e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">能够可视化您的数据使您能够更好地理解它。它让您有机会深入了解数据元素之间的关系，并发现相关性和依赖性。R 中的 ggplot 和 Python 中的 Plotnine 为您提供了以逻辑方式实现这一点的能力。</p><p id="8580" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">要做到这一点，你不需要成为 Python 专家，尽管接触一些 Python 编程会很有用，对 Pandas 中的数据帧有基本的了解也会很有用。</p><p id="93b0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果你也熟悉 Jupyter 笔记本，那将会很有帮助。</p><h1 id="4b40" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">ggplot</h1><p id="6294" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">ggplot2 是一个强大的 R 图形库，在 Hadley Wickham ( <em class="lz">附属链接)</em>的书“<a class="ae mx" href="https://www.amazon.com/ggplot2-Elegant-Graphics-Data-Analysis/dp/0387981403?&amp;_encoding=UTF8&amp;tag=alanjones01-20&amp;linkCode=ur2&amp;linkId=255e09d67cde177ff56683aa49b0229b&amp;camp=1789&amp;creative=9325" rel="noopener ugc nofollow" target="_blank"> ggplot2:优雅的数据分析图形</a>”中有所描述。韦翰，反过来，他的工作基于“图形的语法”，由利兰威尔金森的一本书。Wilkinson 的书给出了图形语法的理论基础，Wickham 的书展示了如何实现这种语法(在 ggplot2 中)。</p><p id="8998" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">ggplot2 实现了一种构建图形的分层方法，并允许使用标准例程来构建流行的图形和图表，或者构建自定义图形来满足您自己的目的。</p><p id="66a3" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">Plotnine 基于 ggplot2，用 Python 实现。</p><p id="a41e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">根据您的 Python 安装，您可以使用<em class="lz"> pip </em>来安装它:</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="fac2" class="nd mb it mz b gy ne nf l ng nh">pip install plotnine</span></pre><p id="646c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">或者<em class="lz">康达</em>:</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="3035" class="nd mb it mz b gy ne nf l ng nh">conda install -c conda-forge plotnine</span></pre><p id="b5dc" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">本文将重点介绍如何构建和定制标准图形——线条、条形图等——使用图层来修改这些图，并希望对您如何制作自己的定制图有所启发。</p><p id="22e2" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">然后，在你的程序中，你的第一行应该是</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="85c5" class="nd mb it mz b gy ne nf l ng nh">from plotnine import *</span></pre><h1 id="8fe4" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">层</h1><p id="7d8e" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">ggplot 命令有三个基本要素:数据、美学和图层。数据的作用是明确的，我们应该以熊猫数据框架的形式提供它。<em class="lz">美观</em>是数据中的变量被映射到视觉属性上的地方，而<em class="lz">层</em>描述了如何呈现数据，例如，作为一个条形图。可以有几个层来定义不同的图表或图表的一部分，例如轴上的标签。</p><p id="72f0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">在 R 中，ggplot2 中的命令类似于:</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="7ce8" class="nd mb it mz b gy ne nf l ng nh">ggplot(data, aesthetics) <br/> + layer1()<br/> + layer2()</span></pre><p id="4188" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">Plotnine 使用了相同的模式，但这并不十分符合 Python 语法。你可以写:</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="f8b0" class="nd mb it mz b gy ne nf l ng nh">ggplot(data,aesthetics) + layer1() + layer2()</span></pre><p id="e175" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">但是你可能会排很长的队。不过，解决方法很简单。把整个事情用大括号括起来。所以我们最后得到了:</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="936e" class="nd mb it mz b gy ne nf l ng nh">(ggplot(data,aesthetics)<br/> + layer1()<br/> + layer2()<br/>)</span></pre><p id="c9d8" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">因此，这是我将在本文中使用的风格。</p><h1 id="0351" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">获取数据</h1><p id="3070" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">如果你已经了解了我对熊猫图和 T2 图的可视化介绍，你会对我使用的天气数据很熟悉。这是来自英国气象局的公开数据，并绘制了伦敦过去几十年的天气数据。</p><p id="ef64" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这些数据记录了每个月的最高和最低温度、日照时间和降雨量。有两个表，一个是 1957 年的完整数据，一个较短的表只记录了 2018 年的数据。</p><p id="b462" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们先拿 2018 年的数据。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="157f" class="nd mb it mz b gy ne nf l ng nh">import pandas as pd<br/>weather=pd.read_csv(‘<a class="ae mx" href="https://raw.githubusercontent.com/alanjones2/dataviz/master/london2018.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/alanjones2/dataviz/master/london2018.csv</a>')<br/>weather</span></pre><p id="7913" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这是它看起来的样子:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ni"><img src="../Images/35f00a5c0aa400025cf4f096b24ed91d.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/0*pDKDqZ5F2DdFB9kR"/></div></div></figure><p id="7b50" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">Year 列是相当多余的，但是与更大的数据文件是一致的。其他列不言自明。月份从 1 到 12，温度以摄氏度为单位，降雨量以毫米为单位，日照以小时为单位。</p><p id="2362" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">所以，从 ggplot 开始，我们要画一个每个月最高温度的线图。然后，我们将添加一些层来增强图表。</p><h1 id="37f7" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">线形图</h1><p id="6145" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">对 ggplot 调用的剖析如上所述。第一个参数是我们将要绘制的数据，<em class="lz">天气</em>，下一个参数是对<em class="lz"> aes </em>的调用。aes 将数据映射到不同的“美学”上——这里我们只有两个。默认情况下，前两个参数是 x 轴和 y 轴。所以这里的月在 x 轴上，Tmax 在 y 轴上。</p><p id="1d8f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这本身是对 ggplot 的合法调用，但它不会绘制任何东西。为此，我们需要添加一个层来告诉 ggplot 我们想要什么样的图形。图形类型称为<em class="lz"> geoms </em>，我们这里使用的是<em class="lz"> geom_line </em>，这当然是一个线图。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="6f54" class="nd mb it mz b gy ne nf l ng nh">(ggplot(weather,aes('Month', 'Tmax'))<br/>  + geom_line()<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/77d6ac656e6cc596e3d021d9d8c311bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/0*KEFXRVqDvMayDT1M"/></div></figure><p id="9029" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这是一个好的开始，但是我们可以做得更好。例如，您会注意到月份是数值而不是实际日期，所以折线图将它们解释为实数。这意味着我们最终的月份从 2.5 到 12.5 不等——这并不理想。</p><p id="05ba" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们可以通过在 graph 函数中添加另一层来轻松解决这个问题。ggplot 允许我们指定每个轴的刻度，所以我们将添加一个层来完成这项工作。我们希望刻度是数字 1 到 12，这正是月份列中的数字。因此，我们将使用该数据来告诉 ggplot 分笔成交点应该是什么。</p><p id="1fbc" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">为了方便起见，我将使用一个变量<em class="lz">月</em>。像这样:</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="1fa6" class="nd mb it mz b gy ne nf l ng nh">months = weather['Month']</span></pre><p id="265d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这是完整的代码</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="3f9f" class="nd mb it mz b gy ne nf l ng nh">months=weather['Month']</span><span id="309a" class="nd mb it mz b gy nk nf l ng nh">(ggplot(weather,aes('Month','Tmax')) <br/>  + geom_line()<br/>  + scale_x_continuous(breaks=months)<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/9aa2b5ce4ac07aa449c34d7a5b0a17a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/0*REofwTpbHAwwKgmf"/></div></figure><p id="664a" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这样更好，但是如果我们想用字符串标记月份，比如“一月”、“二月”等等，那该怎么办呢？当然，我们可以改变表格中的数据，但是这篇文章是关于 ggplot 的，所以我们将使用它。</p><p id="9f68" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">另外，我不喜欢默认的配色方案。ggplot 附带了许多我们可以使用的主题，所以我将添加另一个层来指定我要使用<em class="lz">光</em>主题，并向<em class="lz">几何线</em>添加一个参数来告诉它绘制一条红线而不是默认的黑线。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="2951" class="nd mb it mz b gy ne nf l ng nh">month_labels=("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")</span><span id="8016" class="nd mb it mz b gy nk nf l ng nh">(ggplot(weather,aes('Month','Tmax')) <br/>  + geom_line(color='red') <br/>  + scale_x_continuous(breaks=months,labels=month_labels) <br/>  + theme_light()<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/270589f62ee88f2630d79a956fd9c025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/0*3e3gRSXLswdyIPAC"/></div></figure><p id="71f1" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我认为这是一个进步。</p><p id="4b43" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们用柱形图做同样的图。</p><h1 id="2df3" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">柱状图</h1><p id="7a60" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">要画柱形图，我们只需交换几何图形。我们用<em class="lz"> geom_col </em>代替<em class="lz"> geom_line </em>。简单。唯一需要注意的是，如果我们想改变条形的颜色，我们需要指定一个“填充”。有一个参数“颜色”,但这只改变列的轮廓。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="2558" class="nd mb it mz b gy ne nf l ng nh">(ggplot(weather,aes('Month','Tmax'))<br/>  + geom_col(fill='red')<br/>  + scale_x_continuous(breaks=months, labels=month_labels)<br/>  + theme_light()<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/de5834369597556973280ea9499eb3c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/0*t0AeBLl-BA9rVIX6"/></div></figure><p id="19b0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这是同样的雨的情况——适当的雨的颜色变化。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="fa4a" class="nd mb it mz b gy ne nf l ng nh">(ggplot(weather,aes('Month','Rain'))<br/>  + geom_col(fill='green')<br/>  + scale_x_continuous(breaks=months, labels=month_labels)<br/>  + theme_light()<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/23369ede0ba6a94de24b78eeb1aba0a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/0*5XSS0LPA9dE0jfam"/></div></figure><h1 id="303a" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">多重图表</h1><p id="78cf" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">我想在同一个图上画出<em class="lz"> Tmax </em>和<em class="lz">Tmin</em>——我该怎么做？</p><p id="f7fe" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">最好的方法是转换数据，使两个温度在同一列中，并在单独的列中标记为<em class="lz"> Tmax </em>或<em class="lz"> Tmin </em>。这很容易用熊猫<em class="lz">融化</em>功能完成。在这里，我创建了一个新的 dataframe <em class="lz"> temps </em>和所需的列。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="dfd0" class="nd mb it mz b gy ne nf l ng nh">temps = pd.melt(weather, id_vars=['Month'], <br/>                value_vars=['Tmax','Tmin'], <br/>                var_name='Temp', value_name='DegC' )<br/>temps</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/8eded2cf7bee46ae1f01672063a862f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:314/0*SfO6pLDadApFpNFF"/></div></figure><p id="ad6e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在我用柱形图绘制它们。这里有几件事需要注意。首先，我已经将<em class="lz">填充</em>从 geom 中取出，并将其放入对<em class="lz"> aes </em>的调用中，并将其分配给<em class="lz"> Temps </em>(它将是<em class="lz"> Tmax </em>或<em class="lz"> Tmin </em>)。</p><p id="9754" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">在 geom 中指定一种颜色会固定该 geom 中的颜色，而通过将其放入 aes，我可以告诉 geom 为每个 Temp 值的列指定不同的颜色。因此，geom 列现在将为两个单独的条着色，一个表示 Tmax，另一个表示 Tmin。默认情况下，这些条是堆叠的，但这里我们希望它们是并排的。</p><p id="991c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">第二件事是，在 geom 列中，我将位置指定为“dodge ”,这为我们提供了并排配置。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="57a0" class="nd mb it mz b gy ne nf l ng nh">(ggplot(temps,aes('Month','DegC',fill='Temp'))<br/>  + geom_col(position='dodge')<br/>  + scale_x_continuous(breaks=months)<br/>  + theme_light()<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/df2f2fd109a36d54c1a1a8dc354cd5d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/0*rjWbnpP-TQTK2jZn"/></div></figure><p id="3e82" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这是同样的东西，但是有线条。注意，我为线条指定了<em class="lz">颜色</em>而不是<em class="lz">填充</em>，我不需要担心位置。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="bb96" class="nd mb it mz b gy ne nf l ng nh">(ggplot(temps,aes(‘Month’,’DegC’,color=’Temp’))<br/>  + geom_line()<br/>  + scale_x_continuous(breaks=months)<br/>  + theme_light()<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/b607487d2f18b36ec2ea3d46b8f855e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/0*EpaUQUhm5DPNUVfM"/></div></figure><h1 id="721b" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">更多图层-标签</h1><p id="7cde" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">正如你所看到的，为了给情节添加更多的东西，我们添加了更多的层。要修改图表上的标签，我们也可以这样做。在下一段代码中，我添加了图层来指定 x 轴和 y 轴上的标题，并给整个图表添加了一个标题。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="cf26" class="nd mb it mz b gy ne nf l ng nh">(ggplot(temps,aes('Month','DegC',color='Temp'))<br/>  + geom_line()<br/>  + scale_x_continuous(breaks=months)<br/>  + theme_light()<br/>  + xlab('2018')<br/>  + ylab('Temperature in degrees C')<br/>  + ggtitle('Monthly Maximum and Minimum Temperatures')<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/e71aaa00a6e5c8c8ff3823d169db6eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/0*f5xvPw6g00TKzp5P"/></div></figure><h1 id="39e6" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">更多层—刻面</h1><p id="27a3" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">让我们考虑画一张图来总结整个数据表。降雨量和日照两种温度的柱形图。</p><p id="365d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">首先，我们<em class="lz">再次熔化</em>数据帧，但这次我们将所有数据放在一列中。每个值将被标记为<em class="lz"> Tmax </em>、<em class="lz"> Tmin </em>、<em class="lz"> Rain </em>或<em class="lz"> Sun </em>。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="5b36" class="nd mb it mz b gy ne nf l ng nh">data = pd.melt(weather, id_vars=['Month'], <br/>               value_vars=['Tmax','Tmin','Rain','Sun'], <br/>               var_name='Measure', value_name='Value' )</span></pre><p id="c2c1" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">为了创建刻面图，我们添加了一个<em class="lz"> facet_wrap </em>层，并将测量值传递给它，这意味着我们将获得 Tmax、tmin、Rain 和 Sun 中每一个的刻面。默认情况下，这些面将使用相同的比例，这对于 Tmax 和 Tmin 来说是合适的。但是雨和太阳是不同的，温度也是不同的。所以我们需要告诉<em class="lz"> facet_wrap </em>刻度是‘自由’的，也就是说，每个刻面都有自己的刻度。</p><p id="5716" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">问题是这样做意味着 y 轴的标签会与图表重叠，所以我们需要用另一个图层来调整布局。最后一层是主题的修改(<em class="lz"> theme_light </em>)，在小平面之间增加额外的空间，并设置图形的整体大小。注意这必须在<em class="lz"> theme_light </em>图层之后，否则<em class="lz"> theme_light </em>会将布局重置为默认设置。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="31f8" class="nd mb it mz b gy ne nf l ng nh">(ggplot(data, aes('Month','Value', fill='Measure'))<br/>  + geom_col(show_legend=False)<br/>  + scale_x_continuous(breaks=months,labels=month_labels)<br/>  + facet_wrap('Measure', scales='free')<br/>  + xlab('')<br/>  + ylab('')<br/>  + ggtitle('Weather Data for London, 2018')<br/>  + theme_light()<br/>  + theme(panel_spacing=0.5, figure_size=(10,5))<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/5a6aeea97a60b8b6e591316f33b204f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gMvuzxXcPjNFY1VX"/></div></div></figure><h1 id="0eb2" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">结论</h1><p id="631f" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">这是 Plotnine 用 Python 实现的 ggplot 的一些方面和特性的随机演练。我希望你能看到这种方法的力量，并鼓励你去读读<a class="ae mx" href="https://ggplot2-book.org/" rel="noopener ugc nofollow" target="_blank"> Hadley Wickham 关于 ggplot2 </a>的书，看看<a class="ae mx" href="https://plotnine.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank"> Plotnine 文档</a>。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="18a3" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd">如果您想了解未来的文章，请免费订阅我的</strong> <a class="ae mx" href="https://technofile.substack.com" rel="noopener ugc nofollow" target="_blank"> <strong class="lf jd">简讯</strong> </a> <strong class="lf jd">。</strong></p></div></div>    
</body>
</html>