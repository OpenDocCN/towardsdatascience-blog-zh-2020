<html>
<head>
<title>Track your Azure Analysis Services Processing Times per Table</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跟踪每个表的 Azure Analysis Services 处理时间</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/track-your-azure-analysis-services-processing-times-per-table-f2d3238f81a6?source=collection_archive---------27-----------------------#2020-08-20">https://towardsdatascience.com/track-your-azure-analysis-services-processing-times-per-table-f2d3238f81a6?source=collection_archive---------27-----------------------#2020-08-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="43dd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 Kusto 查询和诊断日志</h2></div><p id="a9af" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最近我一直在与 Azure Analysis Services 合作。在我们的模型中，表的数量在快速增长，处理时间也在波动和增长。从 AAS 的角度来看，我有足够的理由进一步了解哪些表占用了最多的处理时间。</p><p id="e57f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我将解释我所采取的步骤，以获得关于 Azure Analysis Services <strong class="kh ir">全流程</strong>从<strong class="kh ir">日志分析工作区</strong>到<strong class="kh ir"> Power BI </strong>报告的处理步骤的详细信息。</p><ul class=""><li id="e64e" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">将诊断日志记录设置到日志分析工作区</li><li id="4325" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">使用 Kusto 查询语言浏览日志</li><li id="eebe" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">将数据导入 Power BI</li></ul></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="bfa7" class="lw lx iq bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated"><strong class="ak">诊断日志</strong></h2><p id="0243" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">一如既往，起点是微软文档<strong class="kh ir">。好吧，实际上是谷歌或者必应。但是很快我就进入了文档页面，其中包含了开始所需的所有步骤。下面列出了链接。</strong></p><p id="4e7d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种情况下，已经完成了诊断设置的配置，以便将日志发送到日志分析工作区。如果您仍然需要这样做，文档中包含了所需的操作。这很简单。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="75b3" class="lw lx iq bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">浏览日志</h2><p id="c334" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">下一步是在我们的日志分析工作区(LAW)中探索日志，通过编写查询来获取我们正在寻找的信息。<a class="ae mu" href="https://docs.microsoft.com/en-us/azure/analysis-services/analysis-services-logging#view-logs-in-log-analytics-workspace" rel="noopener ugc nofollow" target="_blank">文档中的第一个示例查询</a>是一个很好的起点。但这并不是我们想要的，因为我们想要的是模型的更新。而不是查询时间。</p><p id="ca07" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我编写了<strong class="kh ir">两个查询，并在 Power BI </strong>中将它们连接在一起。在第一个查询中，我专门寻找刷新流程的<strong class="kh ir">最高级别</strong> <strong class="kh ir">。</strong></p><p id="e743" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种情况下,“OperationName”字段和“TextData_s”字段中的值“CommandEnd”在“&lt; Refresh”上进行过滤。下面是查询，如果要用，别忘了在第二行加上自己的服务器和数据库名。</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="d83d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在第二个查询中，我们获得了刷新的详细信息，并希望过滤掉尽可能多的我们不使用的操作。这个查询产生了我们正在寻找的所有详细信息。</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9b8a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一个选择是，为了在最后一个查询中得到更少的结果，将它加入到“RootActivityId_g”上的第一个查询中。这样可以确保只获得与第一个查询相关的数据。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="60ae" class="lw lx iq bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">在 Power BI 中可视化</h2><p id="020c" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">Log Analytics 工作区提供了将书面查询导出到<strong class="kh ir"> M 语言</strong>的可能性，并包含一些关于如何在 Power BI 中使用脚本的帮助。</p><figure class="mv mw mx my gt mz gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/914d111029542578e23d380d4a0a724a.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*XoZdSS-jLDtDTptU8VibCg.png"/></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">将 Kursto 查询导出到 Power BI(图片由作者提供)</p></figure><p id="d9af" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在将两个 Kusto 查询添加到 Power BI 报告之后，在两个表之间的“RootActivityId_g”上创建了一个关系。从“ObjectReference_s”中，可以导出表名。最后，我添加了一个度量来计算以分钟为单位的持续时间。</p><p id="752b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">模型中的数据提供了对每次刷新操作持续时间的深入了解，可通过第一次查询中的“RootActivityId_g”进行识别。从第二个查询中可以看到每个表的详细信息。</p><figure class="mv mw mx my gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nj"><img src="../Images/fe4439d7a4a3a34661334faa6e1e71cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wjAusHUC9xSJ81iqRk4UTw.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">第一次查询；每次刷新的状态(图片由作者提供)</p></figure><p id="e9ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们考虑‘object name _ s’=‘Partition’和‘event subclass _ s’= 59，则每个表的步骤包括:</p><ul class=""><li id="cea1" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">查询来源</li><li id="e3ad" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">读取数据并处理分区</li><li id="7719" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">分析和编码</li><li id="2b39" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">每列每段的压缩率</li><li id="4594" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">每列处理层次结构</li></ul><p id="2dc7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个简单的演示模型的例子。第一行显示所选表的完整持续时间。查看开始和结束时间。</p><figure class="mv mw mx my gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi no"><img src="../Images/2134f346548d2e6af1823bde5d6a26fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eDAlSPIn5dtGMU3P2J2n1g.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">第二次查询；每个表的详细刷新信息(图片由作者提供)</p></figure></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="a22f" class="lw lx iq bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">结论</h2><p id="c9a1" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">能够分析刷新过程中的不同步骤，并精确定位耗时的步骤，对我来说非常有价值。</p><p id="42e6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在诊断日志中有大量关于您的 Analysis Services 实例的信息。例如关于“查询处理单元”(qpu_metric)和内存使用的信息。</p><p id="6070" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从我的角度来看，作为一名数据工程师，用 Power BI 中的诊断日志监控 Azure Analysis Services 是 Azure 门户的一个很好的替代方案。您控制着整个流程的设计，并且可以向您的 BI 产品的最终用户提供监控解决方案，而无需登录 Azure 门户。</p><p id="5eae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请让我知道你的想法或者你有什么建议给我！谢谢大家！</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="1b30" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">参考文献</strong>:</p><div class="np nq gp gr nr ns"><a href="https://docs.microsoft.com/en-us/azure/analysis-services/analysis-services-logging" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">Azure Analysis Services 的诊断日志记录</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">任何 Analysis Services 解决方案的一个重要部分是监视服务器的性能。Azure 分析…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">docs.microsoft.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og nd ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/platform-logs-overview" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">Azure 平台日志概述- Azure Monitor</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">平台日志为 Azure 资源和 Azure 平台提供了详细的诊断和审计信息</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">docs.microsoft.com</p></div></div><div class="ob l"><div class="oh l od oe of ob og nd ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/concepts/" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">Kusto 入门</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">Azure Data Explorer 是一项用于存储和运行大数据交互式分析的服务。它基于关系…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">docs.microsoft.com</p></div></div><div class="ob l"><div class="oi l od oe of ob og nd ns"/></div></div></a></div></div></div>    
</body>
</html>