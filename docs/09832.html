<html>
<head>
<title>Docker Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker 撰写</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/docker-compose-44a8112c850a?source=collection_archive---------31-----------------------#2020-07-12">https://towardsdatascience.com/docker-compose-44a8112c850a?source=collection_archive---------31-----------------------#2020-07-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9c3e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">完全指南</h2></div><p id="c6d8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本节中，我们将使用 Docker 开发的名为 Voting App 的示例应用程序来了解 Docker Compose、它的文件和命令。</p><ol class=""><li id="10e4" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated"><a class="ae ln" rel="noopener" target="_blank" href="/a-concise-guide-to-docker-f6b6d5fb56f4">简介</a></li><li id="00f4" class="le lf it kk b kl lo ko lp kr lq kv lr kz ls ld lj lk ll lm bi translated"><a class="ae ln" href="https://medium.com/@gyani91/docker-file-179b5e3d9171" rel="noopener"> Docker 文件</a></li><li id="d2d1" class="le lf it kk b kl lo ko lp kr lq kv lr kz ls ld lj lk ll lm bi translated"><a class="ae ln" href="https://medium.com/@gyani91/docker-commands-bbf02780b785" rel="noopener">基本对接命令</a></li><li id="0401" class="le lf it kk b kl lo ko lp kr lq kv lr kz ls ld lj lk ll lm bi translated"><a class="ae ln" href="https://medium.com/@gyani91/port-and-volume-mapping-c8bb09221f82" rel="noopener">端口和卷映射</a></li><li id="58e5" class="le lf it kk b kl lo ko lp kr lq kv lr kz ls ld lj lk ll lm bi translated"><a class="ae ln" href="https://medium.com/@gyani91/docker-networking-919461b7f498" rel="noopener"> Docker 联网</a></li><li id="e56d" class="le lf it kk b kl lo ko lp kr lq kv lr kz ls ld lj lk ll lm bi translated"><a class="ae ln" href="https://medium.com/@gyani91/docker-storage-598e385f4efe" rel="noopener">码头仓库</a></li><li id="fbb0" class="le lf it kk b kl lo ko lp kr lq kv lr kz ls ld lj lk ll lm bi translated">Docker Compose(你在这里！)</li><li id="8d86" class="le lf it kk b kl lo ko lp kr lq kv lr kz ls ld lj lk ll lm bi translated"><a class="ae ln" href="https://medium.com/@gyani91/deleting-docker-entities-2f90e4a0a765" rel="noopener">删除 Docker 实体</a></li></ol><p id="1233" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">投票应用是一个用 Python 写的 Flask 应用，用来在猫和狗之间投票。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lt"><img src="../Images/5fc06ce96d127d7075067a3a7fa02bdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NuVmxCrWDgn5b7L8Gc36VQ.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">Python 中的 Web 应用程序</p></figure><p id="3fe2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个投票然后被传输到 Redis，Redis 在这里充当内存中的 DB。工人应用程序，用。NET，然后处理这个投票并将其插入持久数据库——这里是 Postgres 容器。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mj"><img src="../Images/967db8ff36668c88c736466ecef8df58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jLReq3Ng6RhqzJo4kBPnpA.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">投票应用</p></figure><p id="2a42" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，投票结果通过用 NodeJS 编写的 web 应用程序显示出来。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mk"><img src="../Images/6daa111120b3976038b912e82f7d37e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sh90ja5zXDTSuuC6TptcAg.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">NodeJS 中的 Web 应用</p></figure><p id="bb95" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我强烈建议您克隆这个应用程序并试用它，即使您对 Docker Compose 一无所知。如果你能意识到这些服务运行在 5 个不同的容器上，你就有动力继续阅读。</p><pre class="lu lv lw lx gt ml mm mn mo aw mp bi"><span id="976a" class="mq mr it mm b gy ms mt l mu mv">git clone git@github.com:dockersamples/example-voting-app.git</span><span id="971f" class="mq mr it mm b gy mw mt l mu mv">cd example-voting-app/</span><span id="89ab" class="mq mr it mm b gy mw mt l mu mv">docker-compose up</span></pre><p id="685b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们看看 docker-compose 文件。这是一个简单的 YAML 文件，以服务名及其细节开始，包括创建它的映像、要映射的端口、要链接的其他服务等。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mx"><img src="../Images/8da41ff9239f47fa92fe1720f71508e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0osDLQnXeX5k1mL8ibf1JA.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">简单 Docker 合成文件</p></figure><p id="a631" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里我们假设每个图像都是预先构建的，并且可以在 Docker 注册中心(在我们的例子中是 Dockerhub)上获得。为了能够在我们的 Docker 主机上构建服务，这就是我们将为投票、结果和工作者图像所做的，我们必须在 docker-compose 文件中用<strong class="kk iu"> build </strong>属性替换<strong class="kk iu"> image </strong>属性。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi my"><img src="../Images/74fab2d38149100bfc62a7d28a67cd55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WeswhToTYh28Hjb4XP44XQ.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">简单 Docker 合成文件</p></figure><p id="2502" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于 docker-compose 文件多年来持续快速的发展，它有几个版本。从版本 1 到版本 2 的变化是将服务移入<strong class="kk iu">服务</strong>标签，并在第一行添加<strong class="kk iu">版本</strong>标签。此外，您不再需要<strong class="kk iu">链接</strong>，因为默认情况下，每个容器都使用桥接网络连接到其他容器。添加<strong class="kk iu"> depends_on </strong>是为了支持在依赖关系的情况下，先完成一些容器的构建。对于本教程的有限范围来说，版本 2 和版本 3 基本上是相同的。请记住 Docker Swarm 和其他容器编排软件(如 Kubernetes)的几个特性是在 docker-compose 的第 3 版中添加的。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mz"><img src="../Images/e0cdddc2b70741e746b26dff65afecb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jX8eVXOHysUIHlDDhoYLPw.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">Docker 合成文件的各种版本</p></figure><p id="517a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您希望将面向客户端的应用程序的流量与后端应用程序隔离开来，您可以通过添加两个网络(前端层和后端层)来修改 docker-compose 文件，并说明哪个服务位于哪个网络上。</p><p id="8db4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="na">注意，这不是一个完整的 docker-compose 文件，为了简洁起见，我省略了其他细节。</em></p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nb"><img src="../Images/6b3e6f5647a7d5af89418e62400f669a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wY1lNYJ3MHHa4tusYHuPeQ.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">Docker 用两个网络组成文件</p></figure><p id="a4e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行这个 docker-compose 文件将产生如下所示的应用程序堆栈。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nc"><img src="../Images/250c134c8db2d1a1cbb9d7bb4a806a4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*prcL8WqR-nyA36M8yNAzww.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">拥有两个网络的投票应用程序</p></figure><p id="3637" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您需要记住任何 docker-compose 命令，那就是<strong class="kk iu"> docker-compose up </strong>，正如我们在投票应用程序示例中看到的。我还提供了其他命令的列表作为参考。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nd"><img src="../Images/2a058d5cb1420f4a04982a6ed6e035b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0eezea-AcpBq-27AsVA_gw.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">Docker 编写命令</p></figure><p id="6d8a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">总之，使用 docker compose，您可以打包并交付一个多容器应用程序，您的客户端只需一个命令就可以启动它。</p><p id="edbb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在下一节的<a class="ae ln" href="https://medium.com/@gyani91/deleting-docker-entities-2f90e4a0a765" rel="noopener">中，我们将看到如何删除 Docker 的各种实体并回收一些空间。</a></p><p id="2017" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">参考:</p><p id="6cca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[1] Docker，<a class="ae ln" href="https://docs.docker.com/compose/reference/" rel="noopener ugc nofollow" target="_blank">编写命令行参考</a> (2020)，Docker 文档</p><p id="7c6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[2]穆姆沙德·曼南贝斯，<a class="ae ln" href="https://kodekloud.com/p/docker-for-the-absolute-beginner-hands-on" rel="noopener ugc nofollow" target="_blank"> Docker for the Absolute 初学者</a> (2020)，KodeKloud.com</p></div></div>    
</body>
</html>