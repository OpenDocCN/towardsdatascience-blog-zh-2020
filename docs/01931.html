<html>
<head>
<title>Make a Deep Learning iOS App in Five Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">五分钟做一个深度学习iOS App</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/make-a-deep-learning-ios-app-in-five-minutes-b05a5c6b03a4?source=collection_archive---------19-----------------------#2020-02-23">https://towardsdatascience.com/make-a-deep-learning-ios-app-in-five-minutes-b05a5c6b03a4?source=collection_archive---------19-----------------------#2020-02-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c5d3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">制作一个深度学习应用程序可能看起来令人生畏，但实际上并没有那么糟糕。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3c30baaffcc4caf48df37fd2571a1adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fTkaOcBtIGopD5jGfZYPMw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/@lastly?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> <strong class="bd kz">泰勒·拉斯托维奇</strong> </a>发自<a class="ae ky" href="https://www.pexels.com/photo/black-iphone-7-on-brown-table-699122/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> <strong class="bd kz">佩克斯</strong> </a></p></figure><h1 id="f571" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">介绍</h1><p id="9aed" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">深度学习现在真的很热，人们似乎喜欢iPhones。<br/>放在一起吧:)。不久前还没有很多关于如何做这件事的教程，现在有很多了。我想用<br/>增加一个最高效的最小工作示例。我们将建立一个深度学习iOS应用程序，它可以在五分钟内对CIFAR10进行分类。深度学习和iOS开发可能看起来很可怕，但一旦开始，它们并不那么糟糕。本教程结束时，您应该有一个工作的iPhone应用程序，您可以使用Keras训练的自定义模型在内置仿真器中运行。</p><p id="09ee" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果你想看本教程的现场代码演示，请查看下面的视频，我现场编码本教程，并证明它真的只需要五分钟。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">本教程的视频演示。</p></figure><h1 id="8cb7" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">设置</h1><p id="1d0c" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">按照本教程，你需要Python3和一台运行最新XCode的MacBook。你可以通过购买一台Mac来获得XCode，通过运行<br/>安装必要的Python3库:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="d9cf" class="na lb it mw b gy nb nc l nd ne">pip install keras coremltools</span></pre><h1 id="b89b" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">培训/准备模型</h1><p id="3c87" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">我们没有时间从头开始设计模型！我们只有5分钟了！让我们从Keras文档中偷<a class="ae ky" href="https://github.com/keras-team/keras/blob/master/examples/cifar10_cnn.py" rel="noopener ugc nofollow" target="_blank">一个。如果您熟悉Keras，您会看到它只是加载到CIFAR数据集中，然后在其上训练一个简单的CNN。为了快速完成本教程，我们需要做一些调整。首先，将第19行中的epochs数改为只有1。这将使我们的模型在Macbook Pro上大约3分钟内完成训练。</a></p><p id="229a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">接下来，将第20行的data_augmentation参数更改为False。这将使它根据提供的数据进行训练，并且不会翻转或调整任何训练图像。这只是加快了一点速度，但在现实中，如果你想训练一个好的模型，你绝对应该离开这些设置。</p><p id="aa41" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">最后，去掉第121行及以后的内容，我们不需要保存我们的模型，也不需要(想)知道有多好(坏？)是。我们只是需要一个模型快！</p><p id="cff4" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在我们开始培训之前，还有最后一件事，我们需要把这个经过培训的模型做成史蒂夫·乔布斯能够理解的形式。为此，我们向<a class="ae ky" href="https://developer.apple.com/documentation/coreml/converting_trained_models_to_core_ml" rel="noopener ugc nofollow" target="_blank">苹果寻求指导</a>。在页面的底部，你会看到一个“转换你的模型”部分窃取了这些代码行，并将它们粘贴在我们窃取的Python脚本的底部。我们需要做一些小的改动，使它们能够与Keras模型一起工作，因为这些模型是为Cafe编写的。如下更新它们。基本上，我们只需要将转换器调用改为Keras，而不是Caffe。然后我们需要填充一些关于我们模型的信息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将Keras模型转换为CoreML以用于iOS。</p></figure><p id="3283" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这个convert方法有几个值得解开的字段。第一个参数是我们想要转换的模型，它应该是一个Keras模型。</p><ul class=""><li id="49ad" class="ng nh it lu b lv mo ly mp mb ni mf nj mj nk mn nl nm nn no bi translated"><strong class="lu iu"> input_names </strong>是可选名称，将在核心ML模型的接口中使用，以引用Keras模型的输入。对于这个例子，我把它们都叫做“图像”。</li><li id="ab78" class="ng nh it lu b lv np ly nq mb nr mf ns mj nt mn nl nm nn no bi translated"><strong class="lu iu"> image_input_names </strong>是Keras模型的输入名称列表，这是上面input_names字段的子集。核心ML可以将这些名称视为图像</li><li id="025b" class="ng nh it lu b lv np ly nq mb nr mf ns mj nt mn nl nm nn no bi translated"><strong class="lu iu"> class_labels </strong>是模型将使用的类标签列表。对于CIFAR10，该列表是飞机、汽车、鸟、猫、鹿、狗、青蛙、马、船、卡车</li></ul><h1 id="66b2" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">构建一个iOS应用程序</h1><p id="09a6" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">当我们的模型正在酝酿时，让我们建立一个用于分类图像的iOS应用程序。我没有时间设计应用程序，所以我打算偷一个苹果认可的。此命令将下载一个使用图像分类模型的iOS Xcode项目。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="f649" class="na lb it mw b gy nb nc l nd ne">wget <a class="ae ky" href="https://docs-assets.developer.apple.com/published/cdf821b12b/ClassifyingImagesWithVisionAndCoreML.zip" rel="noopener ugc nofollow" target="_blank">https://docs-assets.developer.apple.com/published/a6ab4bc7df/ClassifyingImagesWithVisionAndCoreML.zip</a></span><span id="2626" class="na lb it mw b gy nu nc l nd ne">unzip ClassifyingImageswithVisionandCoreML.zip</span></pre><p id="4557" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">人们似乎喜欢苹果，所以它不会太差，对不对？现在只要打开这个<br/>花哨的新Xcode项目，我们就完成了我们的应用程序！</p><p id="cbff" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">(注意，有时苹果喜欢毫无理由地更改他们链接的名称，所以如果上面的wget命令不起作用，你也可以在这里下载这个Xcode项目<a class="ae ky" href="https://developer.apple.com/documentation/vision/classifying_images_with_vision_and_core_ml" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="8e93" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">修理坏掉的东西</h1><p id="1f7c" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">有几件事不太适合这个应用程序，我们需要注意。</p><p id="9a6a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">1.我们需要将新训练的模型添加到Xcode项目中，并更新代码以使用我们的模型。</p><p id="8059" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">2.CIFAR中使用的图片大小与您的iPhone拍摄的图片大小不同。我们需要缩放图像。</p><h2 id="821b" class="na lb it bd lc nv nw dn lg nx ny dp lk mb nz oa lm mf ob oc lo mj od oe lq of bi translated">添加模型</h2><p id="b72d" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">将我们刚刚用Keras训练的新模型复制到我们的应用程序项目中的文件夹，该文件夹位于<em class="og">Vision+ML Example/Model/cifar . ML Model</em>下，并通过单击下图中概述的链接使用Xcode的构建阶段来链接它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/2f3d142b34c856ff6c4d0f74d2cd6a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2E-VBm9roOO6f7zYhJwA5w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如何将训练好的Keras模型添加到Xcode项目中。</p></figure><p id="f65a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，我们已经将新训练的模型放在项目可以访问的地方，让我们更新imageclassificationviewcontroller . swift中的代码，以识别我们的新模型更改行30(可能会更改)为:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="8780" class="na lb it mw b gy nb nc l nd ne">let model = try VNCoreMLModel(for: CIFAR().model)</span></pre><p id="7518" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们只是将模型名称从MobileNet更改为我们在上一步中所称的模型，在本例中，我们将其命名为CIFAR。就这样，我们的模型现在在代码中链接起来了。最后一步是管理图像大小。</p><h2 id="76b6" class="na lb it bd lc nv nw dn lg nx ny dp lk mb nz oa lm mf ob oc lo mj od oe lq of bi translated">修复规模问题</h2><p id="f106" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">我们的Keras模型期望图像是64 x 64 x 3的图像。我们需要让代码反映这一点。默认值为224 x 224 x 3。您可以通过在Xcode中单击MobileNet.mlmodel模型文件来查看这一点。在预测下，您将看到预期的图像大小。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/cc62ee7975ee1f64c0d1856e7899a9d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aFGAu02OqaOoI2VXiS_k1Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如何在默认机型上查看图像输入尺寸？</p></figure><p id="6b93" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">幸运的是StackOverflow在这里支持我们，我刚刚谷歌了一下“在swift中调整图像大小”,这个方便的解决方案就出现了，它确实做了我们需要的事情。将Swift3代码复制到第20行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">调整图像大小的Swift代码。</p></figure><p id="7827" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在我们只需要在我们的应用程序中调用这个新功能。将updateClassifications的前几行改为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf mu l"/></div></figure><p id="2f34" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这将在通过我们的模型运行之前调整所有图像的大小。现在只需点击播放按钮，享受你的应用程序！</p><h1 id="076a" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">结束了</h1><p id="c8bb" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">我们完了！现在就建app:)。你可以把任何简单的Keras型号<br/>放到iOS应用程序中。试着把模型做的更好，或者把其他东西分类。希望这篇教程展示了在iPhone上部署深度学习模型是多么简单。</p></div></div>    
</body>
</html>