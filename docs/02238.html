<html>
<head>
<title>What is Gradient Clipping?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是渐变裁剪？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-is-gradient-clipping-b8e815cdfb48?source=collection_archive---------4-----------------------#2020-03-03">https://towardsdatascience.com/what-is-gradient-clipping-b8e815cdfb48?source=collection_archive---------4-----------------------#2020-03-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8961" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个简单而有效的方法来处理爆炸梯度</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9accd05b924c27760248745eba72c72a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IWMmXR-25GKxMnLg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@ahsan19?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿三 S. </a>的照片</p></figure><p id="9206" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">递归神经网络(RNN)通过利用存储关于过去输入的信息的隐藏状态来很好地处理序列数据:隐藏状态在时间<em class="lv"> t </em>的值取决于它们在时间<em class="lv"> t </em> -1 的值以及在时间<em class="lv"> t </em>的输入。这种架构虽然强大，但在训练中会导致两个问题:<em class="lv">爆炸渐变</em>和<em class="lv">消失渐变</em>。在本文中，我们将研究<em class="lv">渐变剪辑</em>，它处理爆炸渐变问题。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="c122" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">爆炸和消失渐变背后的直觉</h2><p id="3264" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">爆炸梯度是指梯度在训练中变得过大，使模型不稳定的问题。类似地，消失梯度指的是在训练中梯度变得太小。这可以防止网络权重改变其值。这两个问题都会导致模型无法从训练数据中学习。下面的非正式讨论并不严格，但足以给我们一个关于爆炸和消失梯度来源的直觉。</p><p id="34a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们通过时间反向传播来训练 RNN 时，这意味着我们首先通过为每个时间步长创建网络的副本来及时展开 RNN，将其视为多层前馈神经网络，其中层数等于时间步长数。然后，我们在展开的网络上进行反向传播，考虑权重共享:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/3c300803ce3b2386f0fb58533a37af57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*bMy_8geflaPwiiRGFdAZ_Q.png"/></div></figure><p id="66b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<strong class="lb iu"> W </strong>是递归权重矩阵。可以看出，损失函数的梯度由<strong class="lb iu"> W </strong> ᵀ的<em class="lv"> n </em>个副本的乘积组成，其中<em class="lv"> n </em>是及时返回的层数。矩阵的这个乘积是爆炸和消失渐变的来源。</p><p id="8454" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于一个定标器<em class="lv">一个</em>一个<strong class="lb iu">≦</strong>一个<em class="lv"> aⁿ </em>呈指数级收缩或增长。比如考虑<em class="lv"> n </em> = 30。然后比如 1.1 <em class="lv"> ⁿ </em> ≈ 17.45 和 0.9 <em class="lv"> ⁿ </em> ≈ 0.042。我们选择 30 是因为自然语言处理任务中的一个句子有 30 个单词是很常见的，时间序列分析处理 30 天的数据也是很典型的。矩阵的乘积(<strong class="lb iu"> W </strong> ᵀ) <em class="lv"> ⁿ </em>的情况非常相似。看到这一点的最简单的方法是假设<strong class="lb iu">w</strong>ᵀ<em class="lv">t19】可对角化。然后<strong class="lb iu"> W </strong> ᵀ = <strong class="lb iu"> QDQ </strong> ⁻求点对角矩阵<strong class="lb iu">d</strong>=<em class="lv">diag</em>(<em class="lv">λ</em>₁<em class="lv">，…，λ </em> ₓ)，以及(<strong class="lb iu">w</strong>ᵀ)<em class="lv">ⁿ</em>=<strong class="lb iu">qd</strong><em class="lv">ⁿ</em><strong class="lb iu">q</strong>⁻用【T44</em></p><p id="3e7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们参考[2]对爆炸和消失梯度问题的严格处理。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="63e0" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">渐变剪辑</h2><p id="906f" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">渐变裁剪是一种处理爆炸式渐变的技术。渐变裁剪的想法非常简单:如果渐变变得太大，我们重新调整它以保持它很小。更准确地说，如果‖<strong class="lb iu">g</strong>≥<em class="lv">c</em>，则</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="02c4" class="md me it nd b gy nh ni l nj nk"><strong class="nd iu">g</strong> ↤ <em class="lv">c </em>· <strong class="nd iu">g</strong>/‖<strong class="nd iu">g</strong>‖</span></pre><p id="16e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<em class="lv"> c </em>为超参数，<strong class="lb iu"> g </strong>为梯度，‖ <strong class="lb iu"> g </strong>为<strong class="lb iu"> g </strong>的范数。由于<strong class="lb iu">g</strong>/<strong class="lb iu">g</strong>‖是一个单位向量，重新缩放后，新的<strong class="lb iu"> g </strong>将具有范数<em class="lv"> c </em>。注意，如果‖ <strong class="lb iu"> g </strong> ‖ &lt; <em class="lv"> c </em>，那么我们什么都不需要做。</p><p id="746f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">渐变裁剪确保渐变向量<strong class="lb iu"> g </strong>最多有范数<em class="lv"> c </em>。这有助于梯度下降有一个合理的行为，即使模型的损失景观不规则。下图显示了 loss 地貌中一个极其陡峭的悬崖的示例。如果没有削波，参数会大幅下降，并离开“好”区域。使用削波，下降步长受到限制，参数保持在“良好”区域。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/40bd2e17fb93f2c8e96947ca47ec0ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vLFINWklJ0BtYtgzwK223g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">[1]图 10.17</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="89ad" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">履行</h2><ul class=""><li id="677a" class="nm nn it lb b lc mw lf mx li no lm np lq nq lu nr ns nt nu bi translated">tensor flow:<a class="ae ky" href="https://www.tensorflow.org/api_docs/python/tf/clip_by_global_norm" rel="noopener ugc nofollow" target="_blank">TF . clip _ by _ global _ norm</a>。</li><li id="6939" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">py torch:<a class="ae ky" href="https://pytorch.org/docs/stable/nn.html#torch.nn.utils.clip_grad_norm_" rel="noopener ugc nofollow" target="_blank">torch . nn . utils . clip _ grad _ norm _</a>。</li></ul></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="ce62" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">常见问题</h2><p id="67a5" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">问:我们如何选择超参数<em class="lv"> c </em>？</p><p id="52a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答:我们可以为一些时期训练我们的神经网络，并查看梯度范数的统计数据。梯度范数的平均值是一个很好的初步尝试。</p><p id="79b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问:除了 RNN，我们能在训练神经结构中使用梯度裁剪吗？</p><p id="047c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答:是的。每当我们有爆炸梯度时，我们可以对任何神经架构使用梯度裁剪。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="35c8" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">进一步阅读</h2><ol class=""><li id="ab5f" class="nm nn it lb b lc mw lf mx li no lm np lq nq lu oa ns nt nu bi translated">[1]的第 10.11 章很好地概述了渐变裁剪的工作原理。</li><li id="1045" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu oa ns nt nu bi translated">[3]引入了新的光滑条件，为梯度裁剪的有效性提供了理论解释。</li></ol></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="c67d" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">参考</h2><ol class=""><li id="9a73" class="nm nn it lb b lc mw lf mx li no lm np lq nq lu oa ns nt nu bi translated">古德菲勒、本吉奥和库维尔。<a class="ae ky" href="http://www.deeplearningbook.org/" rel="noopener ugc nofollow" target="_blank">深度学习</a> (2016)，麻省理工学院出版社。</li><li id="ebc4" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu oa ns nt nu bi translated">R.帕斯卡努、t .米科洛夫和 y .本吉奥。<a class="ae ky" href="http://proceedings.mlr.press/v28/pascanu13.pdf" rel="noopener ugc nofollow" target="_blank">论训练递归神经网络的难度</a> (2013)，ICML 2013。</li><li id="0b9b" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu oa ns nt nu bi translated">J.张，何铁男，施瑞华，贾德巴贝。<a class="ae ky" href="https://openreview.net/pdf?id=BJgnXpVYwS" rel="noopener ugc nofollow" target="_blank">为什么梯度裁剪加速了训练:适应性的理论证明</a> (2020)，ICLR 2020。</li></ol></div></div>    
</body>
</html>