<html>
<head>
<title>A Quick Way to Reformat Columns in a Pandas DataFrame</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一种快速重新格式化熊猫数据框中的列的方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-quick-way-to-reformat-columns-in-a-pandas-dataframe-80d0b70de026?source=collection_archive---------39-----------------------#2020-07-13">https://towardsdatascience.com/a-quick-way-to-reformat-columns-in-a-pandas-dataframe-80d0b70de026?source=collection_archive---------39-----------------------#2020-07-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="221d" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">大蟒</h2><div class=""/><div class=""><h2 id="a5d4" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用 df.melt 将多个列压缩成一列。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/6a7f4764fc7590eefdad12f8af7012c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUqxKtpvLbLquNxhIQ7KTw.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">姐姐塑造的形象</p></figure><p id="9269" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">直接进入分析可能很诱人，但在此之前的一个重要步骤是预处理。</p><p id="6bae" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Pandas 提供了许多内置功能，允许您按照自己需要的方式重新格式化数据帧。在执行计算或创建可视化之前，大多数数据集都需要某种形式的整形。</p><p id="4783" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd">在这篇文章中，我们将会看到如何使用一个</strong> <code class="fe md me mf mg b"><strong class="lj jd">df.melt</strong></code> <strong class="lj jd">函数将多个列的值合并成一个。</strong></p><p id="6469" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这意味着您正在将数据帧从“宽”格式更改为“长”格式。当许多列在技术上具有相同类型的值时，这很有帮助。</p><p id="4d30" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">例如，假设你拥有一家咖啡店，开始经营两种饮料。为了跟踪每种饮料的成分，您制作了一个如下所示的表格:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mh"><img src="../Images/96b41e245647b07e4c7d702d6d23767b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cKIdsZy8QDTE1FFqksVnQQ.png"/></div></div></figure><p id="5698" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">目前这可能行得通，但是如果你想包含一种有三种成分的饮料呢？您必须创建另一个类似“配料 3”的列，但是如果您想要一种含有 4、5 甚至 10 种配料的饮料呢？每次需要输入更多数据时都生成新列并不是最优雅的解决方案。</p><p id="d276" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">相反，如果你有一张这样的桌子就太好了:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/5797673384405a414dae4e80f68c6c32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N4rGRzgEI-VD52f3TCbp9A.png"/></div></div></figure><p id="c9a7" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在，你的桌子灵活多了。您的饮料可以根据您的需要添加或多或少的配料，并且您不需要为不同类型的数据条目改变表格结构。</p><p id="8e17" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">让我们在一个更复杂的例子上看看如何用<code class="fe md me mf mg b">df.melt</code>来做这件事。我们将使用<a class="ae mj" href="https://www.kaggle.com/gregorut/videogamesales" rel="noopener ugc nofollow" target="_blank">这个</a>视频游戏销售数据的修改版本，所以如果你想继续的话，请下载 csv 文件。我已经为这个练习加载并预处理了它，所以您可以使用下面的代码开始。</p><pre class="ks kt ku kv gt mk mg ml mm aw mn bi"><span id="05b7" class="mo mp it mg b gy mq mr l ms mt"># pre-processing data<br/>df = pd.read_csv('vgsales.csv').dropna()<br/>df['Year'] = df['Year'].astype(int)<br/>df = df.loc[df['Publisher']=='Nintendo']<br/>df = df.loc[(df['Platform']=='Wii') | (df['Platform']=='WiiU')]<br/>df = df[['Platform','NA_Sales','EU_Sales','JP_Sales','Other_Sales','Global_Sales']]<br/>df = df.groupby('Platform').sum().reset_index()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mu"><img src="../Images/cec27239c5e6fa3c083feee8d47caa8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kTG7UMtBKDiOjvFf40etrQ.png"/></div></div></figure><p id="f9ee" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><em class="mv">边注:如果你不熟悉</em> <code class="fe md me mf mg b"><em class="mv">df.loc[]</em></code> <em class="mv">功能，你可以看看我写的这篇文章和下面的其他矢量化熊猫解决方案。</em></p><div class="mw mx gp gr my mz"><a rel="noopener follow" target="_blank" href="/you-dont-always-have-to-loop-through-rows-in-pandas-22a970b347ac"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd jd gy z fp ne fr fs nf fu fw jc bi translated">你不需要总是在熊猫的行列中循环！</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">用向量化解决方案看一下“for 循环”的替代方案。</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">towardsdatascience.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn lb mz"/></div></div></a></div><h1 id="651f" class="no mp it bd np nq nr ns nt nu nv nw nx ki ny kj nz kl oa km ob ko oc kp od oe bi translated">如何融化数据帧</h1><p id="5d28" class="pw-post-body-paragraph lh li it lj b lk of kd lm ln og kg lp lq oh ls lt lu oi lw lx ly oj ma mb mc im bi translated">您可以在上表中看到，我们有几个不同地区的总销售额。虽然这很容易阅读，但它不是最好的表结构。</p><p id="524e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们的目标是将所有的销售额放在一列中，将所有的销售区域放在另一列中。</p><p id="5395" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在此之前，我们先简单介绍一下<code class="fe md me mf mg b">df.melt</code>函数。该函数有四个关键参数:</p><ul class=""><li id="8e87" class="ok ol it lj b lk ll ln lo lq om lu on ly oo mc op oq or os bi translated"><strong class="lj jd"> id_vars </strong> - &gt;用来标识每一行的列(类似于索引列)—传递一个<em class="mv">列表</em>；</li><li id="7f89" class="ok ol it lj b lk ot ln ou lq ov lu ow ly ox mc op oq or os bi translated"><strong class="lj jd"> value_vars </strong> - &gt;表格中要压缩(或取消透视)的列。如果您想压缩除 id_vars 之外的所有列，您可以将其留空—传递一个<em class="mv">列表</em>；</li><li id="a8a1" class="ok ol it lj b lk ot ln ou lq ov lu ow ly ox mc op oq or os bi translated"><strong class="lj jd"> var_name </strong> - &gt;新“类别”列的名称，其中的值是您传递给“value_vars”的列名—传递一个<em class="mv">标量值</em>；</li><li id="7608" class="ok ol it lj b lk ot ln ou lq ov lu ow ly ox mc op oq or os bi translated"><strong class="lj jd"> value_name </strong> - &gt;新“值”列的名称-传递一个<em class="mv">标量值</em>。</li></ul><p id="fee5" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">对于我们的表，我们需要用“Platform”列标识每一行，所以我们将把它传递给<code class="fe md me mf mg b">id_vars</code>。我们的值列将是除“全球销售”之外的所有销售列，因为从技术上讲，这不是一个区域类别。我们将把一个列名列表传递给<code class="fe md me mf mg b">value_vars</code>来实现这一点。</p><p id="eb8b" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">为了提高可读性，我们还将两个新列命名为“销售区域”和“销售额(百万)”，分别包含在<code class="fe md me mf mg b">var_name</code>和<code class="fe md me mf mg b">value_name</code>参数中。</p><p id="af1d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最终的代码如下所示:</p><pre class="ks kt ku kv gt mk mg ml mm aw mn bi"><span id="ff7a" class="mo mp it mg b gy mq mr l ms mt">df = df.melt(id_vars=['Platform'], <br/>value_vars=['NA_Sales','EU_Sales','JP_Sales','Other_Sales'], var_name='Sales Region', <br/>value_name='Sales (millions)')</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oy"><img src="../Images/190267778cf4003b43c2d172c90dfe2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KAr_n_TmC2WPrm6MFKxp9w.png"/></div></div></figure><p id="c6f1" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">就在那里！我们已经将所有旧的列名移到一个新的 category 列中，并将它们的值合并到一个 values 列中。</p><p id="9e26" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">为了更好地表示，我们还可以用一行额外的代码对表进行排序:</p><pre class="ks kt ku kv gt mk mg ml mm aw mn bi"><span id="519e" class="mo mp it mg b gy mq mr l ms mt">df1 = df1.sort_values(['Platform','Sales (millions)'], ascending=False)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oz"><img src="../Images/0b5edabc1efbc1c3e53278a8c7cf8561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zdw_HuRq_QXGn4iCUv6bfQ.png"/></div></div></figure></div><div class="ab cl pa pb hx pc" role="separator"><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf"/></div><div class="im in io ip iq"><p id="5a3a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我希望你发现这个<code class="fe md me mf mg b">df.melt</code>的快速浏览对你的熊猫工作有用！不涉及太多细节，您也可以实现这种技术来创建满足 1NF 的表，并更好地组织关系数据库的输入。</p><p id="c342" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Pandas 还提供了比我上面使用的方法更多的排序方法，所以如果你想了解更多，你可以看看这篇文章:</p><div class="mw mx gp gr my mz"><a rel="noopener follow" target="_blank" href="/4-different-ways-to-efficiently-sort-a-pandas-dataframe-9aba423f12db"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd jd gy z fp ne fr fs nf fu fw jc bi translated">4 种不同的方法来有效地排序熊猫数据帧</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">正确探索、理解和组织您的数据。</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">towardsdatascience.com</p></div></div><div class="ni l"><div class="ph l nk nl nm ni nn lb mz"/></div></div></a></div><p id="0c38" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">祝你和熊猫的冒险之旅好运！</p></div></div>    
</body>
</html>