<html>
<head>
<title>Web Scrapping, Downloading Twitter Data and Performing Sentimental Analysis using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Web 报废、下载 Twitter 数据和使用 Python 进行情感分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/web-scrapping-downloading-twitter-data-and-performing-sentimental-analysis-using-python-fce3ea45c825?source=collection_archive---------23-----------------------#2020-07-24">https://towardsdatascience.com/web-scrapping-downloading-twitter-data-and-performing-sentimental-analysis-using-python-fce3ea45c825?source=collection_archive---------23-----------------------#2020-07-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f5ff" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用数据细分非洲影响者，以推动营销决策。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ea1b509658269ef023fa66df209b4c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5JjjdPo3qosoqa-o"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">斯蒂芬·道森在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="47ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">社交媒体影响者在当前人类互联日益增加的社会中发挥着重要作用；商业组织正在意识到对影响者营销活动的需求(Newberry，2019)。成功的影响者营销活动需要与合适的社交媒体影响者合作。那么，我们如何确定正确的影响者呢？</p><p id="936a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于数据科学界来说，只有数据才有答案。让我们进行一个案例研究，以确定在数字营销活动中可以与之合作的合适的非洲影响者。我们将探索从相关网站上删除数据，从 twitter 上为特定用户提取数据，并进行情感分析，以确定合适的影响者进行合作。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="a609" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">Web 报废</h1><p id="ed1c" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated"><a class="ae kv" href="https://africafreak.com/100-most-influential-twitter-users-in-africa" rel="noopener ugc nofollow" target="_blank">该</a>网站有一份预先确定的非洲 100 名有影响力人士的名单，而<a class="ae kv" href="https://www.atlanticcouncil.org/blogs/africasource/african-leaders-respond-to-coronavirus-on-twitter/#east-africa" rel="noopener ugc nofollow" target="_blank">该</a>网站有一份非洲关键政府官员的名单。要废弃这两个网站，我们首先导入必要的库:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="4f3f" class="nb ma iq mx b gy nc nd l ne nf">from requests import get<br/>from requests.exceptions import RequestException<br/>from contextlib import closing<br/>from bs4 import BeautifulSoup<br/>import pandas as pd<br/>import re<br/>import os, sys</span><span id="00ef" class="nb ma iq mx b gy ng nd l ne nf">import fire</span></pre><p id="136f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们通过制作一个<code class="fe nh ni nj mx b">HTTP GET request</code>来定义一个获取网站内容的函数:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="efa0" class="nb ma iq mx b gy nc nd l ne nf">def simple_get(url):<br/>    try:<br/>        with closing(get(url, stream=True)) as resp:<br/>            if is_good_response(resp):<br/>                return resp.content<br/>            else:<br/>                return None<br/>    except RequestException as e:<br/>        log_error('Error during requests to {0} : {1}'.format(url, str(e)))<br/>        return None</span></pre><p id="42c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还将定义另一个函数来下载由 URL 指定的页面，并返回一个字符串列表，每个标签元素一个字符串:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="40ba" class="nb ma iq mx b gy nc nd l ne nf">def get_elements(url, tag='',search={}, fname=None):<br/>    if isinstance(url,str):<br/>        response = simple_get(url)<br/>    else:<br/>        #if already it is a loaded html page<br/>        response = url</span><span id="f671" class="nb ma iq mx b gy ng nd l ne nf">if response is not None:<br/>        html = BeautifulSoup(response, 'html.parser')<br/>        <br/>        res = []<br/>        if tag:    <br/>            for li in html.select(tag):<br/>                for name in li.text.split('\n'):<br/>                    if len(name) &gt; 0:<br/>                        res.append(name.strip())<br/>                       <br/>                <br/>        if search:<br/>            soup = html            <br/>            <br/>            <br/>            r = ''<br/>            if 'find' in search.keys():<br/>                print('finding',search['find'])<br/>                soup = soup.find(**search['find'])<br/>                r = soup</span><span id="65ad" class="nb ma iq mx b gy ng nd l ne nf">            if 'find_all' in search.keys():<br/>                print('finding all of',search['find_all'])<br/>                r = soup.find_all(**search['find_all'])<br/>   <br/>            if r:<br/>                for x in list(r):<br/>                    if len(x) &gt; 0:<br/>                        res.extend(x)<br/>            <br/>        return res</span></pre><p id="7a65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的函数使用 BeautifulSoup 库进行原始 HTML 选择和内容提取。选择是基于标签元素或与<code class="fe nh ni nj mx b">find</code>或<code class="fe nh ni nj mx b">find_all</code>一起使用搜索完成的。</p><p id="868b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以调用我们定义的函数并传入我们两个网站的 URL。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="271b" class="nb ma iq mx b gy nc nd l ne nf">res = get_elements('<a class="ae kv" href="https://africafreak.com/100-most-influential-twitter-users-in-africa'" rel="noopener ugc nofollow" target="_blank">https://africafreak.com/100-most-influential-twitter-users-in-africa'</a>, tag = 'h2')<br/></span><span id="babd" class="nb ma iq mx b gy ng nd l ne nf">url= '<a class="ae kv" href="https://www.atlanticcouncil.org/blogs/africasource/african-leaders-respond-to-coronavirus-on-twitter/#east-africa'" rel="noopener ugc nofollow" target="_blank">https://www.atlanticcouncil.org/blogs/africasource/african-leaders-respond-to-coronavirus-on-twitter/#east-africa'</a><br/>response = simple_get(url)<br/>res_gov = get_elements(response, search={'find_all':{'class_':'twitter-tweet'}})</span></pre><p id="65cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些函数返回网站上符合我们搜索标准的所有内容，因此，我们需要清理数据，只获取 twitter 用户名:</p><h2 id="ff66" class="nb ma iq bd mb nk nl dn mf nm nn dp mj lf no np ml lj nq nr mn ln ns nt mp nu bi translated">数据清理</h2><p id="d593" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在数据清理过程中使用了<code class="fe nh ni nj mx b">.split()</code>和<code class="fe nh ni nj mx b">.strip()</code>方法来去除任何空白或特殊字符。例如，清除<code class="fe nh ni nj mx b">res</code>数据将会:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="7fab" class="nb ma iq mx b gy nc nd l ne nf">res_cleaned = []<br/>for element in res:<br/>    if re.findall("@", element):<br/>        res_cleaned.append(element)<br/>        <br/>        <br/>df = pd.DataFrame(res_cleaned)<br/>df1 = df[0].str.split('@', expand = True)</span><span id="20f9" class="nb ma iq mx b gy ng nd l ne nf">influencers = df1[1].tolist()</span><span id="4e1f" class="nb ma iq mx b gy ng nd l ne nf">final = []<br/>for influencer in influencers:<br/>    influencer = influencer.strip(')')<br/>    final.append(influencer)</span></pre><p id="f857" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们将废弃和清理的数据保存到一个 CSV 文件中:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="bc21" class="nb ma iq mx b gy nc nd l ne nf">pd.DataFrame(final, columns = ['Twitter handles']).to_csv('influencers_scraped.csv', index = False, encoding = 'utf-8')</span></pre><h1 id="3bfe" class="lz ma iq bd mb mc nv me mf mg nw mi mj jw nx jx ml jz ny ka mn kc nz kd mp mq bi translated">下载 Twitter 数据</h1><p id="bcf5" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">就像任何 python 程序都需要的一样，我们从导入所需的库开始。对于这个提取，我们将使用 Tweepy 库来提取 Twitter 数据:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="e451" class="nb ma iq mx b gy nc nd l ne nf">import tweepy<br/>from tweepy.streaming import StreamListener<br/>from tweepy import OAuthHandler<br/>from tweepy import Stream<br/>from tweepy import Cursor<br/>from tweepy import API</span></pre><p id="061a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们初始化变量来存储访问 Twitter API 的用户凭证，验证凭证，并创建到 Twitter 流 API 的连接:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="4804" class="nb ma iq mx b gy nc nd l ne nf">consumer_key = 'YOUR TWITTER API KEY'<br/>consumer_secret = 'YOUR TWITTER API SECRET KEY'<br/>access_token = 'YOUR TWITTER ACCESS TOKEN'<br/>access_token_secret = 'YOUR TWITTER ACCESS TOKEN SECRET'</span><span id="5ad2" class="nb ma iq mx b gy ng nd l ne nf">#authentication and connection<br/>auth = OAuthHandler(consumer_key, consumer_secret)<br/>auth.set_access_token(access_token, access_token_secret)<br/>            <br/>auth_api = API(auth)</span></pre><p id="56fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在成功创建到 twitter 的连接之后，我们继续为用户提取数据，并将数据存储在 CSV 文件中，以便在分析过程中更容易访问。</p><p id="4de6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下函数接收用户列表和 CSV 文件名作为参数，遍历列表获取每个用户的数据，并将数据保存到 CSV 文件中。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="d446" class="nb ma iq mx b gy nc nd l ne nf">def get_user_info(list, csvfile):<br/>    users_info = []<br/>    for user in list:<br/>        print ('GETTING DATA FOR ' + user)<br/>        try:<br/>            item = auth_api.get_user(user)<br/>        <br/>            users_info.append([item.name, item.description, item.screen_name, item.created_at, item.statuses_count, item.friends_count, item.followers_count])<br/>            <br/>        except Exception:<br/>            pass<br/>        <br/>    print('Done!!')<br/>    <br/>    user_df = (pd.DataFrame(users_info, columns = ["User", "Description", "Handle", "Creation Date", "Tweets", "Following", "Followers"])).to_csv(csvfile, index = False, encoding = 'utf-8')</span></pre><p id="3b2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用户推文中的标签和提及次数也有助于确定个人的影响力水平。因此，我们在 Cursor 对象的帮助下获得用户每条 tweet 中的标签和提及，并再次使用以下函数将数据保存在 CSV 文件中:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="2d06" class="nb ma iq mx b gy nc nd l ne nf">def get_tweets(list,csvfile1, csvfile2, csvfile3):<br/>    hashtags = []<br/>    mentions = []</span><span id="ba89" class="nb ma iq mx b gy ng nd l ne nf">for user in list:<br/>        print ("GETTING DATA FOR "+ user)<br/>        try:<br/>            for status in Cursor(auth_api.user_timeline, id = user).items():<br/>                if hasattr(status, "entities"):<br/>                    entities = status.entities<br/>                    if "hashtags" in entities:<br/>                        for ent in entities["hashtags"]:<br/>                            if ent is not None:<br/>                                if "text" in ent:<br/>                                    hashtag = ent["text"]<br/>                                    if hashtag is not None:<br/>                                        hashtags.append(hashtag)<br/>                    if "user_mentions" in entities:<br/>                        for ent in entities["user_mentions"]:<br/>                            if ent is not None:<br/>                                if "screen_name" in ent:<br/>                                    name = ent["screen_name"]<br/>                                    if name is not None:<br/>                                        mentions.append([user, name])<br/>        except Exception:<br/>            pass<br/><br/>    print("Done!")<br/>    <br/>    hashtags_df = (pd.DataFrame(hashtags, columns = ["hashtags"])).to_csv(csvfile1, index = False, encoding = "utf-8")<br/>    mentions_df = (pd.DataFrame(mentions, columns = ["mentions"])).to_csv(csvfile2, index = False, encoding = "utf-8")</span></pre><h1 id="5c4c" class="lz ma iq bd mb mc nv me mf mg nw mi mj jw nx jx ml jz ny ka mn kc nz kd mp mq bi translated">情感分析</h1><p id="46fa" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">既然我们已经挖掘了所有必要的数据，我们可以继续进行分析，以确定影响者的排名和最常用的标签。用于排名的公式基于<a class="ae kv" href="http://twitter.mpi-sws.org/icwsm2010_fallacy.pdf" rel="noopener ugc nofollow" target="_blank">“衡量 Twitter 中的用户影响力:百万追随者谬误”</a>的论文。</p><p id="a1d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据 Gummadi、Benevenuto、Haddadi 和 Cha (2010)的研究，一个人的影响力可以通过以下方面来衡量:</p><ul class=""><li id="1bc8" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated"><em class="oj">深度影响力</em>——个人的受众，</li><li id="dc79" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj">转发影响力</em>——个人产生有价值内容的能力，以及</li><li id="a6b0" class="oa ob iq ky b kz ok lc ol lf om lj on ln oo lr of og oh oi bi translated"><em class="oj">提及影响力</em> —个人进行引人入胜的谈话的能力。</li></ul><p id="cb62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这三个度量可以分别计算为到达分数、流行度分数和相关性分数。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="f152" class="nb ma iq mx b gy nc nd l ne nf">reach_score = item.followers_count - item.friends_count<br/>popularity_score = retweet_count + favorites_count<br/>relevance_score = mentions_count</span></pre><p id="2f12" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，最常用的 hashtags 是使用 Counter 模块计算的:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="8b30" class="nb ma iq mx b gy nc nd l ne nf">unique_hashtags = []<br/>for item, count in Counter(hashtags).most_common(5):<br/>        unique_hashtags.append([item, count])</span></pre><p id="5aef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最常见的标签数据可用于理解标签的分布以及不同影响者如何使用标签。下面的代码输出一个包含这些信息的条形图。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="2846" class="nb ma iq mx b gy nc nd l ne nf">df = pd.DataFrame(pd.read_csv('hashtags_data.csv'))</span><span id="95ba" class="nb ma iq mx b gy ng nd l ne nf">unique_hashtags = ['...',...,'...'] <br/>  <br/># selecting rows based on condition <br/>hashtags_grouping_data = df[df['hashtags'].isin(unique_hashtags)]</span><span id="5508" class="nb ma iq mx b gy ng nd l ne nf">grouped = hashtags_grouping_data.groupby(['hashtags', 'user_type']).agg({'user_type': ['count']})</span><span id="b66c" class="nb ma iq mx b gy ng nd l ne nf">grouped.columns = ['count']<br/>grouped = grouped.reset_index()</span><span id="8662" class="nb ma iq mx b gy ng nd l ne nf">bp = sns.barplot(x = 'hashtags', y = 'count', hue = 'user_type', data = grouped)</span><span id="77be" class="nb ma iq mx b gy ng nd l ne nf">#Position the legend out the graph<br/>bp.legend(bbox_to_anchor=(1.02, 1),<br/>          loc=2, <br/>          borderaxespad=0.0);<br/>bp.set(title='Bar plot for Influencers and Top Government Officials by hashtag', xlabel='Hashtags', ylabel='Count')</span></pre><p id="28fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由上述代码构建的示例条形图如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/b43fe4c2504f81ba3cf1ee3ff355ca2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*p72uZO9DPmv0TaF33agrgw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1a73" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="3527" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">影响者营销已经成为新的营销利基，商业组织正在寻找合适的社交媒体影响者，以便与他们合作开展有效的营销活动。利用数据科学，我们可以帮助推动基于事实数据的营销决策。它就像从相关网站上删除数据，从 Twitter 等社交媒体平台下载用户数据，并对数据进行情感分析，以得出商业组织可以更好理解的视觉效果一样系统。帖子概述了该过程中使用的主要代码，完整代码可在此处找到<a class="ae kv" href="https://github.com/Kiiru-Anastasia/QuickStart2020/blob/contribs/week1/Kiiru-Anastasia/scrapping_starter.ipynb" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="e4f6" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">参考</h1><p id="cc85" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">[1]: C .米扬，h .哈默德，b .法布里西奥，g .克里希纳，<em class="oj">测量推特中的用户影响力:百万追随者谬误</em> (2010)，【http://twitter.mpi-sws.org/icwsm2010_fallacy.pdf】T4</p><p id="047e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[2]: N. Christina，<em class="oj">影响者营销指南:如何与社交媒体影响者合作</em> (2019)，<a class="ae kv" href="https://blog.hootsuite.com/influencer-marketing/" rel="noopener ugc nofollow" target="_blank">https://blog.hootsuite.com/influencer-marketing/</a></p></div></div>    
</body>
</html>