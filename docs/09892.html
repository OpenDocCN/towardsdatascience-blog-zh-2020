<html>
<head>
<title>Machine Learning on AWS SageMaker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS SageMaker 上的机器学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-on-aws-sagemaker-b23e32503106?source=collection_archive---------27-----------------------#2020-07-13">https://towardsdatascience.com/machine-learning-on-aws-sagemaker-b23e32503106?source=collection_archive---------27-----------------------#2020-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="933f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何用线性回归预测员工工资</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0d1d364f6610d07958582c06a40a0894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pCvAG8BFYn775Kug1-HdUg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Photo by @ <a class="ae kv" href="https://unsplash.com/@helloimnik" rel="noopener ugc nofollow" target="_blank">你好我是 Nik </a>上<strong class="bd kw"> </strong> <a class="ae kv" href="https://unsplash.com/photos/r22qS5ejODs" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="cb7e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在本教程中，我们将使用亚马逊 SageMaker Studio 在<a class="ae kv" href="https://aws.amazon.com/sagemaker/" rel="noopener ugc nofollow" target="_blank"> AWS SageMaker </a>上创建一个 ML 模型，根据多年的经验来预测员工的工资。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="b7c0" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated"><strong class="ak">问题陈述</strong></h1><p id="2239" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">想象一下，一个潜在的员工已经通过了面试，现在 HR 想要给他们一份工作。薪水会是多少？</p><p id="7132" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">假设:对薪水有影响的唯一因素是多年的经验。</p><h1 id="bb08" class="ma mb iq bd mc md mx mf mg mh my mj mk jw mz jx mm jz na ka mo kc nb kd mq mr bi translated"><strong class="ak">成果概述</strong></h1><p id="2336" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">在本教程中，我将提出一个简单的线性回归模型。你在这个模型中输入多年的经验，它会做出相应的工资预测。</p><p id="d523" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><em class="nc">注:你可以在这里找到我之前的帖子 TK 中关于线性回归的完整解释。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/dfab935d1c9f6a81a3ca43595901d506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n_c3ziIg18QXZO86K6wFFQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">案例研究—结果概述</p></figure><p id="d822" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">使用的数据</strong> : <a class="ae kv" href="https://www.kaggle.com/karthickveerakumar/salary-data-simple-linear-regression" rel="noopener ugc nofollow" target="_blank">卡格尔-工资-数据</a></p><p id="8437" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了让这更令人兴奋，我们将在 Amazon SageMaker 上构建、训练和部署 ML 模型——耶！</p><h2 id="1d05" class="ne mb iq bd mc nf ng dn mg nh ni dp mk lg nj nk mm lk nl nm mo lo nn no mq np bi translated"><strong class="ak">亚马逊 SageMaker 工作室</strong></h2><p id="1de8" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">Sagemaker Studio 是一个用于机器学习的完全集成的开发环境(IDE)，它允许我们编写代码、跟踪实验、可视化数据和执行调试。</p><p id="e54b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">跟随:</p><ul class=""><li id="f719" class="nq nr iq kz b la lb ld le lg ns lk nt lo nu ls nv nw nx ny bi translated">从 AWS 管理控制台搜索栏中找到 SageMaker 服务。</li><li id="ad89" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated">点击亚马逊 SageMaker 工作室。</li><li id="4ede" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated">点击左上角的+图标，启动你的 Jupyter 笔记本。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/2de19029bdb9531072ef96b33a73cb8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zz5-JFdab8c-y-uTmZDmuA.png"/></div></div></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="00c5" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">第一步:这项研究的目的是什么？</h1><ul class=""><li id="b88c" class="nq nr iq kz b la ms ld mt lg of lk og lo oh ls nv nw nx ny bi translated">根据经验年限预测员工工资。</li><li id="7cd4" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated">我们使用简单的线性回归模型:根据多年的经验(变量 X，独立变量)预测工资(变量 Y，独立变量)。</li></ul></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="ff01" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated"><strong class="ak">步骤 2:导入库和数据集</strong></h1><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="9e2a" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#import required libraries</strong><br/>import pandas as pd<br/>import numpy as np<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt</span><span id="6f94" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#if you need to install some packages, use this command:</strong><br/>!pip install tensorflow</span><span id="6b8f" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#read the Dataset</strong><br/>salary_df = pd.read_csv('salary.csv')<br/>salary_df.head(10)<br/>salary_df.tail(10)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi os"><img src="../Images/a98fe484107e0693adc7d14a837e9332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*SlwHwKaghfxLC1hXQ6cxvQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据集的头部和尾部</p></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="dfcf" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated"><strong class="ak">第三步:探索性数据分析和可视化</strong></h1><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="03aa" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#get some information about our DataSet<br/></strong>salary_df.info()<br/>salary_df.describe()</span><span id="abdb" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#check if there are any Null values</strong><br/>salary_df.isnull().sum()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/f422d0df908a40fe0d72cb7b8146aded.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5e48IqcvVACt8YslY_E_Mg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">信息-描述-并检查是否有空值</p></figure><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="698f" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#visualizing data</strong><br/>sns.pairplot(salary_df)<br/>sns.heatmap(salary_df.corr(), annot=True)</span><span id="27fd" class="ne mb iq oj b gy or oo l op oq">sns.regplot(salary_df['YearsExperience'], salary_df['Salary'], data = salary_df )</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/6d62c55700baf8fb84a9e16623a8d8dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6rWJUDm3omSx9NXupmmZWg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">配对图-热图-正则图</p></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="ac9e" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated"><strong class="ak">第四步:将数据集分成训练集和测试集</strong></h1><p id="57ad" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">我们使用<code class="fe ov ow ox oj b">Train</code>集合让算法学习数据的行为，然后我们在<code class="fe ov ow ox oj b">Test</code>集合上检查我们的模型的准确性。</p><ul class=""><li id="3924" class="nq nr iq kz b la lb ld le lg ns lk nt lo nu ls nv nw nx ny bi translated"><code class="fe ov ow ox oj b">Features(X)</code>:插入到我们模型中的列将用于进行预测。</li><li id="4c0f" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated"><code class="fe ov ow ox oj b">Prediction(y)</code>:将由特征预测的目标变量</li></ul><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="2a7e" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#define X variables and our target(y)</strong><br/>X = salary_df[['YearsExperience']]<br/>y = salary_df[['Salary']]</span><span id="4829" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#splitting Train and Test</strong> <br/>from sklearn.model_selection import train_test_split</span><span id="37c7" class="ne mb iq oj b gy or oo l op oq">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=0)</span><span id="4465" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#need to have y_train &amp; y_test as an vector(for SageMaker linear learner) <br/></strong>y_train = y_train[:,0]<br/>y_test = y_test[:,0]</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="a345" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated"><strong class="ak">第五步:使用 SageMaker 训练线性学习模型</strong></h1><p id="dd32" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">在我们开始之前，让我们解释一下我们需要准备什么——我保证，我会很快的！</p><h2 id="48a9" class="ne mb iq bd mc nf ng dn mg nh ni dp mk lg nj nk mm lk nl nm mo lo nn no mq np bi translated"><strong class="ak">设置准备</strong></h2><p id="eae1" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated"><strong class="kz ir"> <em class="nc">亚马逊 S3 </em> </strong></p><ul class=""><li id="e3c1" class="nq nr iq kz b la lb ld le lg ns lk nt lo nu ls nv nw nx ny bi translated">亚马逊 S3 是一种存储服务，允许我们在目录(桶)中存储和保护我们的数据。我们将需要这项服务继续前进</li><li id="d46a" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated"><strong class="kz ir">bucket:</strong>是存储在亚马逊 S3 的对象的容器，每个 bucket 都有全局唯一的名称。</li></ul><p id="6d0f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> <em class="nc">创建桶</em> </strong></p><ul class=""><li id="a484" class="nq nr iq kz b la lb ld le lg ns lk nt lo nu ls nv nw nx ny bi translated">首次搜索 S3 服务。</li><li id="ffda" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated">选择创建一个存储桶，并给它一个名称和区域。</li><li id="c0e9" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated">点击下一步，直到您得到配置选项，您将阻止所有公共访问，并创建您的桶。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/4f2fe81187fa8e3f1452f369b4259058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YwuD2Y-Ku8fv15pfhzARBA.png"/></div></div></figure><p id="6ec1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> <em class="nc">【创建前缀(桶内子文件夹)</em> </strong></p><p id="d5f6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在创建的桶中，点击“创建文件夹”并给它一个名字。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/2ebabf6323cb4e0a4e54d99271207c2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e9XLPC5y2sPBynMUyPtukg.png"/></div></div></figure><p id="fee1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">所以，我们有:</p><ul class=""><li id="68ae" class="nq nr iq kz b la lb ld le lg ns lk nt lo nu ls nv nw nx ny bi translated"><strong class="kz ir">斗:</strong>斗:<code class="fe ov ow ox oj b">sagemaker-practical-m</code></li><li id="27eb" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated"><strong class="kz ir">前缀:</strong>T2】</li></ul><p id="fe63" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> <em class="nc"> IAM(身份和访问管理)</em> </strong></p><p id="3b6b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们需要给我们的 Sagemaker 一个 IAM 角色，这样它就可以代表我们执行任务(例如，读取训练结果，从 S3 存储桶中调用模型工件，以及将训练结果写入 S3)</p><p id="09e7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们回到我们的代码:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="2213" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#import required kits<br/></strong>import sagemaker<br/>import boto3     </span><span id="e1c4" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#create a Sagemaker session</strong><br/>sagemaker_session = sagemaker.Session()</span><span id="0246" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#define the S3 bucket and prefix(subfolder within the bucket)<br/></strong>bucket = 'sagemaker-practical-m'<br/>prefix = 'linear-learner' </span><span id="9c48" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#define IAM role</strong><br/>role = sagemaker.get_execution_role()<br/>print(role)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/7f82880e1fe2b67567d172147d70a3bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJIDgqN2sirU3aFj_EhrMw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">运行上述代码后的结果。</p></figure><p id="90dc" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> <em class="nc"> Boto3 </em> </strong> <em class="nc">一个 AWS Python SDK，允许开发者编写使用亚马逊 S3 或 EC2 等服务的应用程序。</em></p><p id="3886" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们将训练数据转换成 Sagemaker 兼容的输入格式(RecordIO)。更多关于这个<a class="ae kv" href="https://docs.aws.amazon.com/sagemaker/latest/dg/linear-learner.html#input_output" rel="noopener ugc nofollow" target="_blank">的信息请点击</a>。</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="0e66" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#import module in terms of dealing with various types of I/O<br/></strong>import io</span><span id="4dcf" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#import sagemaker common library<br/></strong>import sagemaker.amazon.common as smac </span><span id="b9b7" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#converts the data in numpy array format to RecordIO format<br/></strong>buf = io.BytesIO()<br/>smac.write_numpy_to_dense_tensor(buf, X_train, y_train)<br/><br/><strong class="oj ir">#reset in-memory byte arrays to zero<br/></strong>buf.seek(0)</span></pre><p id="4ead" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后一个命令用于清除内存缓冲区。</p><p id="69c4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在我们的数据被转换成记录格式并包含在缓冲区中之后。我们现在可以将数据上传到 S3:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="3611" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#import module</strong><br/>import os<br/> <br/><strong class="oj ir">#Key refers to the name of the file    <br/></strong>key = 'linear-train-data'</span><span id="6955" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#uploads the data in record-io format to S3 bucket<br/></strong>boto3.resource('s3').Bucket(bucket).Object(os.path.join(prefix, 'train', key)).upload_fileobj(buf)</span><span id="a259" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#training data location in s3</strong><br/>s3_train_data = 's3://{}/{}/train/{}'.format(bucket, prefix, key)</span><span id="364a" class="ne mb iq oj b gy or oo l op oq">print('uploaded training data location: {}'.format(s3_train_data))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/3bac73add0427abfc0de19fac829b53b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9CdASxA-rLq7JX_c-GqRqg.png"/></div></div></figure><p id="a598" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们刚刚创建了“train”文件夹，其中包含我们上传的数据(linear-train-data)。</p><p id="a631" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们回到 S3 仓库，检查文件是否在那里:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/9adf568a412011813a09dd24d63914dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0OkyyytDRusr1I0ZLOtIsA.png"/></div></div></figure><p id="4003" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们需要指定 S3 位置来存储我们的线性学习器输出:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="05b4" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#create an output location in S3 bucket to store the linear learner output<br/></strong>output_location = 's3://{}/{}/output'.format(<strong class="oj ir">bucket</strong>, <strong class="oj ir">prefix</strong>)</span><span id="3229" class="ne mb iq oj b gy or oo l op oq">print('Training artifacts will be uploaded to: {}'.format(output_location))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/99c6a1625e3e732634e8ba5767f35e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nd4hyKaE68bMnpkE42QL_Q.png"/></div></div></figure><p id="609b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在，要获得对线性学习器容器的引用，只需指定算法名:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="a9ad" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#specify the name of the algorithm, that we want to use<br/></strong>from sagemaker.amazon.amazon_estimator import get_image_uri</span><span id="e196" class="ne mb iq oj b gy or oo l op oq">container = get_image_uri(boto3.Session().region_name, 'linear-learner')</span></pre><p id="0cbf" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">然后，我们传递希望用于训练的容器和实例类型。已经定义了输出路径和 SageMaker 会话变量。</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="599f" class="ne mb iq oj b gy on oo l op oq">linear = sagemaker.estimator.Estimator(container,<br/>          role, <br/>          train_instance_count = 1, <br/>          train_instance_type = 'ml.c4.xlarge',<br/>          output_path = output_location,<br/>          sagemaker_session = sagemaker_session)</span></pre><p id="16a6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这些参数可以调整:</p><ul class=""><li id="f7e3" class="nq nr iq kz b la lb ld le lg ns lk nt lo nu ls nv nw nx ny bi translated">传入的要素数。</li><li id="5caf" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated">预测器的类型(<code class="fe ov ow ox oj b">regressor</code>或<code class="fe ov ow ox oj b">classifier</code>)。</li><li id="3678" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated">小批量(每个小批量的观察次数)。</li></ul><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="d5c9" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#Train 32 different versions of the model and will get the best out of them<br/></strong>linear.set_hyperparameters(feature_dim = 1,<br/>                           predictor_type = 'regressor',<br/>                           mini_batch_size = 5,<br/>                           epochs = 5,<br/>                           num_models = 32,<br/>                           loss = 'absolute_loss')</span><span id="c31c" class="ne mb iq oj b gy or oo l op oq"><strong class="oj ir">#pass in the training data from S3 to train the linear learner model<br/></strong>linear.fit({'train': s3_train_data})</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="0222" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated"><strong class="ak">步骤 6:部署训练好的线性学习模式</strong></h1><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="a36a" class="ne mb iq oj b gy on oo l op oq">linear_regressor = linear.deploy(initial_instance_count = 1,<br/>                                 instance_type = 'ml.m4.xlarge')</span></pre><p id="2f81" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了在我们的模型中进行推理，我们需要将数据转换成文本/CSV 格式。在这里阅读更多<a class="ae kv" href="https://sagemaker.readthedocs.io/en/stable/api/inference/predictors.html" rel="noopener ugc nofollow" target="_blank"/>。</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="ce1c" class="ne mb iq oj b gy on oo l op oq">from sagemaker.predictor import csv_serializer, json_deserializer</span><span id="7336" class="ne mb iq oj b gy or oo l op oq">linear_regressor.content_type = 'text/csv'<br/>linear_regressor.serializer = csv_serializer<br/>linear_regressor.deserializer = json_deserializer</span></pre><p id="3cbd" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">对测试集的预测:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="7773" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir"># making prediction on the test data<br/></strong>result = linear_regressor.predict(X_test)<br/>result</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/a567b5efc8f4d9f48c5730049ef16ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*3ytT8Qexs-nR0HAWDl-luA.png"/></div></figure><p id="ad9d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们取出结果编号并保存在<code class="fe ov ow ox oj b">Prediction</code>板变量中:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="d571" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#access the scores by iterating through the scores in predictions<br/></strong>predictions = np.array([r['score'] for r in result['predictions']])<br/>predictions</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/21e83bf4ae151e40b88020c96c31a4c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kJ26XT6nDT83Yccr4L7AmA.png"/></div></div></figure><p id="a4b9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们检查结果作为一个<code class="fe ov ow ox oj b">DataFrame</code>:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="5fbe" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#compare actual output values with predicted values<br/></strong>df = pd.DataFrame({'Actual': y_test.flatten(), 'Predicted': predictions.flatten()})<br/>df</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/40faae68a209b772ff971473910fbdb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*VkVeEu3ZPxNB58t8H9Cg8A.png"/></div></figure><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="7fd9" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir"># visualize comparison result as a bar graph<br/></strong>df1 = df.head(20)<br/>df1.plot(kind='bar',figsize=(12,8))<br/>plt.grid(which='major', linestyle='-', linewidth='0.5', color='green')<br/>plt.grid(which='minor', linestyle=':', linewidth='0.5', color='black')<br/>plt.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ph"><img src="../Images/6fe7088f769fedd9a7010ce8e43f1f77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Phk4XsResz2UO8-gC5ExA.png"/></div></div></figure><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="17d4" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir">#prediction vs test set</strong><br/>plt.scatter(X_test, y_test,  color='blue')<br/>plt.plot(X_test, predictions, color='red', linewidth=2)<br/>plt.xlabel('Years of Experience (Testing Dataset)')<br/>plt.ylabel('salary')<br/>plt.title('Salary vs. Years of Experience')<br/>plt.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/229e16d5b43e67c832b8efaf4af7dce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*39IYQz1n3HE0LNcxy5h8XA.png"/></div></figure><p id="a21b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">差不多就是这样！</p><p id="a756" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">重要:</strong>如果不想被亚马逊收费，永远记得删除端点！</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="6f30" class="ne mb iq oj b gy on oo l op oq"><strong class="oj ir"># Delete the end-point<br/></strong>linear_regressor.delete_endpoint()</span></pre><p id="93cc" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我希望这篇文章能帮助你更好地理解这个话题。欢迎任何反馈，因为它让我获得新的见解！</p></div></div>    
</body>
</html>