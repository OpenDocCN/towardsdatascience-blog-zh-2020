<html>
<head>
<title>Curse of Batch Normalization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">批量规范化的诅咒</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/curse-of-batch-normalization-8e6dd20bc304?source=collection_archive---------8-----------------------#2020-05-15">https://towardsdatascience.com/curse-of-batch-normalization-8e6dd20bc304?source=collection_archive---------8-----------------------#2020-05-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c75c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用批处理规范化有哪些缺点？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/369b60d4beb18afc7281ab7b8f367744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Tyx6pbUPML9mtVBC"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">弗雷迪·科林斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="e7d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">批量规范化确实是深度学习领域的重大突破之一，也是过去几年研究人员讨论的热门话题之一。批量标准化是一种广泛采用的技术，能够实现更快和更稳定的训练，并已成为最有影响力的方法之一。然而，尽管它的多功能性，仍然有一些点阻碍了这种方法，正如我们将在本文中讨论的，这表明规范化方法仍然有改进的空间。</p><h1 id="8e80" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">我们为什么要使用批处理规范化？</h1><p id="638b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在讨论任何事情之前，首先，我们应该知道什么是批处理规范化，它是如何工作的，并讨论它的用例。</p><h2 id="86ac" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">什么是批处理规范化</h2><p id="a68c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在训练期间，当我们更新先前的权重时，每个中间激活层的输出分布在每次迭代时移动。这种现象被称为内部协变移位(ICS)。因此，如果我想防止这种情况发生，很自然的事情就是修复所有的发行版。简而言之，如果我有一些问题，我的分布在四处移动，我会夹紧它们，不让它们四处移动，以帮助梯度优化和防止梯度消失，这将有助于我的神经网络训练更快。因此，减少这种内部协变变化是推动批量标准化发展的关键原则。</p><h2 id="cb37" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">它是如何工作的</h2><p id="c83d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">批次归一化通过减去批次的经验平均值除以经验标准差来归一化前一个输出图层的输出。这将有助于数据看起来像<strong class="lb iu"> <em class="ne">高斯分布</em> </strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/da0ef54c2e52bd1ffdb4c0ecf68fada4.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*Nn5Ttu7Mcqgg9618PdEtqg.png"/></div></figure><p id="f5e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<em class="ne"> mu </em>和<em class="ne"> sigma_square </em>分别为批均值和批方差。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/a4c78089a028a4a181e1dd31c973f561.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*aW8Ijr7llD9jvoL0RUGoWQ.png"/></div></figure><p id="ff2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并且，我们根据两个可学习的参数<em class="ne"> γ </em>和<em class="ne"> β学习新的均值和协方差。</em>所以简而言之，你可以认为批量标准化是帮助你控制批量分布的一阶和二阶矩的东西。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/9eccf1c8738790fc565989e23866a318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1NZt_7GXryBmDukvnRTE_A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从 VGG-16 网络的中间卷积层输出的特征分布。1.(之前)没有任何规范化，2。(之后)应用批处理规范化。</p></figure><h2 id="734c" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">利益</h2><p id="cd05" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我将列举使用批处理规范化的一些好处，但我不会说得太详细，因为已经有成吨的文章在讨论这个问题了。</p><ul class=""><li id="89f5" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">更快的收敛。</li><li id="ea53" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">降低初始权重的重要性。</li><li id="96bd" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">对超参数稳健。</li><li id="eb2a" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">需要较少的数据进行归纳。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/11309020072aba725bca2a9db0fc28be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pqkULKQ46U2HOmrzjNOrkA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">1.更快的收敛，2。对超参数稳健</p></figure></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="a130" class="lv lw it bd lx ly oe ma mb mc of me mf jz og ka mh kc oh kd mj kf oi kg ml mm bi translated">被诅咒的批处理规范化</h1><p id="1eeb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">所以，回到文章的动机，在很多情况下，批处理规范化开始损害性能或者根本不起作用。</p><h2 id="07c9" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">使用小批量时不稳定</h2><p id="9595" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如上所述，批量标准化层必须计算平均值和方差，以标准化整个批量的先前输出。如果批量相当大，并且随着批量的减小而不断减小，这种统计估计将相当准确。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/cc8ce4a36fd42d2f676eade03018c5ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RaKmU7GdXzKDV4nXHEcfSQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用 32、16、8、4 和 2 个图像/GPU 训练的 ResNet-50 的批量常模的验证误差</p></figure><p id="1a70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上是 ResNet-50 的验证误差图。可以推断，如果批次大小保持为 32，其最终验证误差约为 23，并且误差随着批次大小的减小而不断减小(批次大小不能为 1，因为它将是其自身的平均值)。而且损失有很大的差别(10%左右)。</p><p id="58bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果小批量是一个问题，为什么我们不用一个更大的批量呢？嗯，我们不能在任何情况下都使用更大的批量。考虑微调，我们不能使用高批量来不伤害我们的高梯度模型。考虑分布式训练，您的大批量最终将作为一组小批量分布在实例中。</p><h2 id="3a0c" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">导致培训时间增加</h2><p id="41e1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">作为 NVIDIA 和卡内基梅隆大学进行的实验的结果，他们声称“即使批量规范化不是计算密集型的，收敛所需的总迭代次数也减少了。每次迭代的时间可能会显著增加。，并且它可以随着批量的增加而进一步增加。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/39f4fb5df976158a37e1721336523091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*N5Q385lYLm5nWiuF4LcnGA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 Titan X Pascal 在 ImageNet 上的 ResNet-50 训练时间分布</p></figure><p id="c111" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，批量标准化消耗了总训练时间的 1/4。原因是因为 batch norm 需要通过输入数据进行两次迭代，一次用于计算批处理统计数据，另一次用于归一化输出。</p><h2 id="ec38" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">训练和推理的不同结果</h2><p id="c027" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">例如，考虑现实世界的应用程序“对象检测”。在训练对象检测器时，我们通常使用大批量(YOLOv4 和 Faster-RCNN 都是在批量默认为 64 的情况下训练的)。但是这些车型投入生产后，这些车型<strong class="lb iu">工作</strong> <strong class="lb iu">不如训练</strong>时的 <strong class="lb iu">好。这是因为它们是用大批量训练的，而在实时中，它们得到的批量等于 1，因为它必须随后处理每一帧。考虑到这种限制，一些实现倾向于使用基于训练集激活的预先计算的均值和方差。另一种可能性是基于您的测试集激活分布来计算平均值和变化值，但仍然不是分批的。</strong></p><h2 id="89b0" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">不利于在线学习</h2><p id="c0c8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">与批量学习相反，在线学习是一种学习技术，其中系统通过顺序输入数据实例进行增量训练，这些数据实例可以单独输入，也可以通过称为<em class="ne">小批量的小组输入。</em>每一步学习都是快速而廉价的，因此系统可以在新数据到达时即时学习。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/14601e434b9a2d1297ad3684b6d56559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yjwWAVkkXsPq-JmBKKpHTQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">典型的在线学习渠道</p></figure><p id="5141" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于它依赖于外部数据源，数据可能单独或成批到达。由于每次迭代中批量大小的变化，它不能很好地概括输入数据的规模和变化，这最终会影响性能。</p><h2 id="db6b" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">对递归神经网络不好</h2><p id="52d1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">尽管批量归一化显著地加快了卷积神经网络的训练和泛化速度，但它们被证明难以应用于递归结构。可以在 RNN 的堆栈之间应用批量归一化，其中归一化是“垂直”应用的，即每个 RNN 的输出。但是它不能“水平地”应用，即在时间步长之间应用，因为它会由于重复重新缩放导致的爆炸梯度而损害训练。</p><p id="0096" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">【注意】:一些研究实验声称批处理规范化使神经网络容易出现<strong class="lb iu">对抗性漏洞</strong>。但由于缺乏研究和证明，我们没有包括这一点。</p><h1 id="0836" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">可供选择的事物</h1><p id="8d21" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">所以这是使用批处理规范化的一些缺点。在批处理规范化不能保持的情况下，有几种替代方法。</p><ul class=""><li id="23d9" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">图层规范化。</li><li id="8246" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">实例规范化。</li><li id="4b63" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">分组标准化(+权重标准化)。</li><li id="add0" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">同步批量标准化。</li></ul><h1 id="52cd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="b804" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">所以训练深度神经网络很简单，但我认为还不太容易。从这个意义上说，我可以选择的架构很少，每个人都使用固定的学习速度，固定的优化器和固定的技巧。这些技巧是通过自然选择选择出来的，几乎就像有人想出了一些技巧，如果它有效，他们就引入它，如果它无效，人们最终会忘记它，没有人会再使用它。除此之外，批处理规范化是深度学习发展中的一项里程碑技术。然而，正如所讨论的，沿着批处理维度进行规范化会引入一些问题，这表明规范化技术仍有改进的空间。</p></div></div>    
</body>
</html>