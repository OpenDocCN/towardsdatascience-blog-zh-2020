<html>
<head>
<title>Implement Object Detection with PyTorch in Java in 5 minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 PyTorch 在 5 分钟内用 Java 实现物体检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/implement-object-detection-with-pytorch-in-java-in-5-minutes-c3ba5769e7aa?source=collection_archive---------15-----------------------#2020-04-22">https://towardsdatascience.com/implement-object-detection-with-pytorch-in-java-in-5-minutes-c3ba5769e7aa?source=collection_archive---------15-----------------------#2020-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="43e7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">DJL，一个引擎无关的深度学习库</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d9f10b764c8af47c4def2aa567015596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8BzX44MGNBXu_UWIQUGHDw.png"/></div></div></figure><p id="9fce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">PyTorch 是最流行的机器学习框架之一。其易于使用的 Pythonic 界面和生产力增强特性，如数据并行性和动态计算图，简化了计算机视觉(CV)和自然语言处理(NLP)中应用的 ML 模型的开发。<br/> <br/>虽然有<a class="ae ln" href="https://pytorch.org/blog/model-serving-in-pyorch/" rel="noopener ugc nofollow" target="_blank">多种选项</a>来为生产中的 PyTorch 模型提供服务，但是在 Java 中本地部署 PyTorch 模型的选项却很少。以前，用户可以围绕 PyTorch C++ API 编写一个 Java 包装器，或者使用<a class="ae ln" href="https://pytorch.org/blog/pytorch-1-dot-4-released-and-domain-libraries-updated/" rel="noopener ugc nofollow" target="_blank">实验性的 PyTorch Java 绑定</a>。亚马逊的<a class="ae ln" href="https://djl.ai/" rel="noopener ugc nofollow" target="_blank">深度 Java 库</a> (DJL)现在通过其易于使用的高级 API 为 PyTorch 和 Java 社区提供了一个更简单的选择。通过抽象 ML 中涉及的复杂性和捆绑乏味的数据处理例程，DJL 用 PyTorch 模型将运行预测简化到几行代码。在我们的两部分博客系列中，我们展示了用户如何使用 PyTorch 进行推理。首先是预训练的 PyTorch 模型，然后是用户生成的 PyTorch 模型。在这两篇博客的第一篇中，我们展示了如何在不到 5 分钟的时间内使用预先训练好的 PyTorch 模型实现物体检测。那么，我们开始吧。</p><h1 id="843c" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">设置</h1><p id="afca" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">要开始使用 DJL，请使用命令行或您选择的 IDE 创建一个项目。将以下代码添加到您的<code class="fe ml mm mn mo b">build.gradle</code>配置文件中。在这个例子中，我们使用 PyTorch 1.4.0 C++发行版。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated"><a class="ae ln" href="https://gist.github.com/lanking520/7787c2d2b5fb304cbe60360139e8760f#file-build-gradle" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/lank 520/7787 C2 D2 b5 FB 304 CBE 60360139 e 8760 f # file-build-gradle</a></p></figure><h1 id="2558" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">使用预训练 PyTorch 模型的对象检测</h1><p id="5b1f" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">在本节中，我们使用 NVIDIA 的<a class="ae ln" href="https://pytorch.org/hub/nvidia_deeplearningexamples_ssd/" rel="noopener ugc nofollow" target="_blank">预训练 PyTorch 跟踪模型来实现对象检测。该任务识别</a>下方的<a class="ae ln" href="https://github.com/awslabs/djl/raw/master/examples/src/test/resources/dog_bike_car.jpg" rel="noopener ugc nofollow" target="_blank">图像中嵌入的物体(狗、自行车、卡车):</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/f408f26f484ea424edc3b33efec36f1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dv4rj6BgnPZ9M62e2BEuZg.jpeg"/></div></div></figure><p id="9645" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用 DJL，您可以用下面的代码块在几行代码中运行推理:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated"><a class="ae ln" href="https://gist.github.com/lanking520/74ec6b35ca6076fa3cbe2848869f7a1f#file-od-java" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/lank 520/74 EC 6b 35 ca 6076 fa 3c be 2848869 F7 a1f # file-od-Java</a></p></figure><p id="7ec6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行 PyTorch 代码会产生以下输出。输出列出了检测到的对象及其相对概率。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="be91" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后你可以使用我们的<a class="ae ln" href="https://javadoc.djl.ai/api/0.4.0/ai/djl/modality/cv/ImageVisualization.html#drawBoundingBoxes-java.awt.image.BufferedImage-ai.djl.modality.cv.DetectedObjects-" rel="noopener ugc nofollow" target="_blank">图像可视化功能</a>来定义这个图像的边界框。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/89ef26fbb2e19a033c96c66d4a653a87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BFpT2sMTPYCSiRqxudXhCQ.png"/></div></div></figure><p id="d5b2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有关如何加载 PyTorch 模型的更多信息，请查找最新解决方案的<a class="ae ln" href="http://docs.djl.ai/jupyter/load_pytorch_model.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h1 id="f84e" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">什么是 DJL？</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/4b38a743d1a619d58607e4a67a06c036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ia5YOC_MKSUNGtq-bwax3A.png"/></div></div></figure><p id="724c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完成本教程后，你可能想知道 DJL 是什么。深度 Java 库(DJL)是一个开源库，用于在 Java 中构建和部署深度学习。该项目于 2019 年 12 月启动，在亚马逊的团队中广泛使用。这一努力受到了其他 DL 框架的启发，但是是从底层开始开发的，以更好地适应 Java 开发实践。DJL 与框架无关，支持 Apache MXNet、PyTorch、TensorFlow 2.x 和 ONNXRuntime。</p><h1 id="db31" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">PyTorch 支持范围</h1><p id="1cff" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">[更新]:现在我们在最新的 0.10.0 版本中支持 PyTorch 1.7.1</p><p id="dd9b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们用 PyTorch (1.4.0) C++ API 构建了 DJL PyTorch 引擎，它允许我们运行操作符和推理代码。所有采用<a class="ae ln" href="https://pytorch.org/tutorials/beginner/Intro_to_TorchScript_tutorial.html" rel="noopener ugc nofollow" target="_blank"> TorchScript </a>格式的模型都可以导入并在 DJL 上运行。为了实现这一点，我们编写了一个定制的 JNI 层，在 C++和 Java 之间进行交互。目前，DJL 覆盖了 60 多家 PyTorch 运营商。DJL 本身具有以下固有特性:</p><ul class=""><li id="dd19" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nc nd ne nf bi translated">NDManager:高效的垃圾收集系统</li><li id="44d6" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">多线程支持</li><li id="9e0e" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">模型动物园:PyTorch 模型动物园支持图像分类和对象检测模型</li><li id="cb5a" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">还有更多…</li></ul><p id="b411" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">支持的平台:</p><ul class=""><li id="9e79" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nc nd ne nf bi translated">Mac: CPU</li><li id="1772" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">Linux: CPU 和 GPU (CUDA 9.2 和 CUDA 10.1)</li><li id="9529" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">Windows: CPU 和 GPU (CUDA 9.2 和 CUDA 10.1)</li></ul><p id="f333" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要了解更多信息，请查看我们的<a class="ae ln" href="https://djl.ai/" rel="noopener ugc nofollow" target="_blank">网站</a>、<a class="ae ln" href="https://github.com/deepjavalibrary/djl" rel="noopener ugc nofollow" target="_blank"> Github 资源库</a>和<a class="ae ln" href="https://join.slack.com/t/deepjavalibrary/shared_invite/zt-ar91gjkz-qbXhr1l~LFGEIEeGBibT7w" rel="noopener ugc nofollow" target="_blank"> Slack channel。</a>请继续关注我们的下一篇博文，我们将展示如何在 Java 中使用自己的 PyTorch 模型运行推理。</p></div></div>    
</body>
</html>