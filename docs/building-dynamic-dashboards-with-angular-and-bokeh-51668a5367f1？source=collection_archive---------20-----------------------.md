# 用 Python 构建带有角度和散景图的动态仪表盘

> 原文：<https://towardsdatascience.com/building-dynamic-dashboards-with-angular-and-bokeh-51668a5367f1?source=collection_archive---------20----------------------->

## 一个灵活的动态仪表板示例，使用散景图、Angular 和 Python 作为后端。

![](img/472c4179d21299e3263712d7f6ca15d1.png)

如果我们考虑工业 4.0 应用，一般来说，对其有必然的要求。

它们应该是:

*   模块化，
*   可扩展，
*   易于集成到现有网络中，并且
*   可互操作-可以轻松连接到任何其他服务。

# **动态图表示例**

例如，这种应用程序的主要目标之一是独立于工作平台及时查看数据。数据的来源应该与技术无关，可能来自其他物联网设备，如传感器或服务器或其他连接的资源。

**我们已经向您展示了…**

是这可以使用[我们之前在 Medium 上介绍的 web-app 架构](/angular-and-bokeh-e8acd86e7ab1)来实现。

## **动态仪表板展示区**

为此，我们利用最近提出的架构构建了一个动态仪表板。它由作为框架的 [Angular](https://angular.io/) 组成，在过去几年中已经发展成为非常成熟的前端解决方案。它在 [Angular Material](https://material.angular.io/) 中提供了 web 应用程序的标准组件，可以很容易地扩展到任何更复杂的视图或组件。

对于后端，我们一如既往地坚持使用 Python，因为它以非常低的开发开销提供了各种连接，还因为它是一门优秀的语言。此外，它还提供了广泛的数据处理工具，如人工智能/深度学习工具、数学工具以及最后但并非最不重要的绘图工具，如我们将在本次演示中使用的[散景](https://docs.bokeh.org/en/latest/)。

我们也非常乐意用异步编程范式来扩展我们通常使用的 web 服务器技术，这意味着我们使用 [aiohttp](https://aiohttp.readthedocs.io/en/stable/) 作为我们的标准 python web 服务器。

为了连接这两个部分，我们决定广泛使用 [websockets](https://websockets.readthedocs.io/en/stable/) ，它通过标准的 tcp/ip 协议保证双向的响应数据流。

**需要解决的问题**

在此过程中出现的一些典型问题有

*   图表或数字表示中的动态数据供应，
*   在 Angular 应用程序中使用独立的散景图表，每个图表都应该是一个组件，图表的内容完全由后端驱动，
*   例如，在板上排列图表的灵活性。

## **动态数据供应入门**

仪表板必须显示可以随时更新的数据。在某些情况下，我们将需要实时数据显示，或者至少在 tcp/ip 协议处理时间和浏览器显示时间之内。我们从一个稍微不太严格的要求开始。

为图表提供动态数据的最简单方法是使用 ajax 调用散景图表。幸运的是，这已经作为散景图的标准方式实现了。Ajax 数据结构的行为与普通数据结构相同，可以作为一种无缝的方式定期更新数据。

这里我们展示了如何更新标签中的数字。为此，我们必须使用 *LabelSet* ，因为这是与图表上显示的文本相结合的唯一动态更新的数据结构。我们将下面的代码放在 Python 后端的一个单独的类 *ChartProvider* 中，这个类有一个类似于下面的函数:

这段代码片段展示了如何每 300 毫秒更新一次*源*，以及如何在*适配器*中进一步处理数据，适配器是一小段 JavaScript 代码。在 Python 端, *AjaxDataSource* 的行为很大程度上类似于以下格式的每个静态数据源

为了以 ajax 方式提供连续的数据，我们必须使用我们的 web 服务器支持的 URL。如前所述，我们使用了 *aiohttp* ，因此我们可以将此路由作为 POST 路由，如下所示:

最后，我们可以包含来自于 ChartProvider 的 chart_item ，就像我们之前在文章中详细描述的一样。chart_item 是一个自包含的 *json* 格式的图表。这也意味着图表已经包含了数据获取机制 *ajax* 。在下图中，我们看到了典型的角形材料卡片中包含的图表:

Bokeh 提供了一种简单的 ajax 更新方式。但遗憾的是 Bokeh 还没有一个简单的功能，它只能在 JavaScript 端重绘图表。提醒一下，我们使用全局包含的散景模块的调用，它通过以下方式导入到我们的角度组件中:

角度方面的主要任务是为 embed_item 函数调用提供数据。因为我们使用 websocket 连接，所以我们将 chart_item 从 python 发送到 angular。它也可以由 REST-api 提供。顺便说一下，如果我们需要来自服务器的及时数据，我们的 websocket 连接更可行。另一方面，ajax 调用是通过轮询完成的，这有几个缺点。其中之一是，web 服务器在每次客户端请求数据时都工作，即使数据没有改变。

长话短说。我们可以通过 websocket 提供第一个图表数据或其他事件驱动的数据，但目前图表的更新数据仅限于 ajax 调用。我们希望将来避开 ajax 调用，从后端切换到事件驱动的调用。如果你想想解决办法，为什么不是每次都通过 websocket 发送完整的图表，调用 embed_item 方法，那也不是办法。散景嵌入图表的方式非常昂贵，因此我们永远不会达到我们想要的更新速度。

## **总结**

我们展示了如何在 Angular 应用程序中实现定期更新的散景图，这是我们最终目标的一部分，即创建一个动态仪表板。

对于数据更新，我们使用了 ajax 方法，因为它已经是 Bokeh 中的内置方法，我们不必调整我们的 websocket 连接。

在 python 方面，数据供应或多或少是一项简单的任务，但重要的是我们要确保使用非阻塞调用，这意味着一致地使用异步方法。

我们会尽快让你知道如何解决其他问题。