<html>
<head>
<title>Using the Fitbit Web API with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过 Python 使用 Fitbit Web API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-the-fitbit-web-api-with-python-f29f119621ea?source=collection_archive---------9-----------------------#2020-02-10">https://towardsdatascience.com/using-the-fitbit-web-api-with-python-f29f119621ea?source=collection_archive---------9-----------------------#2020-02-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/9a1d784ce9bc0893d89f4380b3f66849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F5jICgWS-PATcMw2xvFs_Q.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">上图是由 Fitbit 数据制作的，只是没有通过 API。我只是想分享我同事的工作。<a class="ae kf" href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0227709" rel="noopener ugc nofollow" target="_blank">https://journals.plos.org/plosone/article?id = 10.1371/journal . pone . 0227709</a></p></figure><p id="75b1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Fitbit 提供了一个 Web API，用于从 Fitbit 活动跟踪器、Aria &amp; Aria 2 秤和手动输入的日志中访问数据。所以如果你一直在使用 Fitbit，你可以使用【https://dev.fitbit.com/build/reference/web-api/basics/】的<a class="ae kf" href="https://dev.fitbit.com/build/reference/web-api/basics/" rel="noopener ugc nofollow" target="_blank"> Fitbit API </a> ( <a class="ae kf" href="https://dev.fitbit.com/build/reference/web-api/basics/" rel="noopener ugc nofollow" target="_blank">的</a>)来获取自己的数据。除了使用 API 获取数据的便利之外，您还可以在在线应用程序上获取数据，您可以使用 API 获取在线应用程序上不可用的当天(每分钟)数据。虽然本教程最初与 Stephen Hsu 的惊人的<a class="ae kf" rel="noopener" target="_blank" href="/collect-your-own-fitbit-data-with-python-ff145fa10873">教程</a>相似，但我想我应该稍微更新一下这个过程，解决几个你可能会遇到的错误，并展示一点你如何绘制数据。和往常一样，本教程中使用的代码可以在我的<a class="ae kf" href="https://github.com/mGalarnyk/Python_Tutorials/blob/master/Apis/Fitbit/Fitbit_API.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。就这样，让我们开始吧！</p><h1 id="59bf" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">1.)创建一个 Fitbit 帐户</h1><p id="2f9b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">您可以点击<a class="ae kf" href="https://www.fitbit.com/signup" rel="noopener ugc nofollow" target="_blank">这里</a>创建一个 Fitbit 账户。它会带你到一个类似下面的页面。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mh"><img src="../Images/05797d9d969241e931dfc1d0a2bf449e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OyoDO8K28U47M6g8NSKzgQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">你不需要像我一样勾选“随时更新”框。此外，fakeuser@gmail 不是我的帐户使用的电子邮件。</p></figure><h1 id="2e8e" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">2.)设置您的帐户并创建应用程序</h1><p id="8e4a" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">前往<a class="ae kf" href="https://dev.fitbit.com/getting-started/" rel="noopener ugc nofollow" target="_blank">dev.fitbit.com</a>。将鼠标悬停在“管理”上，然后点击“注册应用程序”。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mm"><img src="../Images/a6faf02519a0d5245233eb1add78339f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5IrHvZuJXYpINijJ_OU9TA.png"/></div></div></figure><p id="9ac8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">应该会出现一个类似于下图的页面。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mn"><img src="../Images/49b1cfd2b761247a666b437025e245c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EeCzBUOG8FztBIURCPvsNw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">(<strong class="bd mo">答</strong>)你需要指定个人，以便能够更方便地要求下载日内数据(如果你没有或得到一个错误，你可以随时要求它<a class="ae kf" href="https://dev.fitbit.com/build/reference/web-api/intraday-requests/" rel="noopener ugc nofollow" target="_blank">这里</a>)。(<strong class="bd mo"> B </strong>)回调 URL 是 http://127.0.0.1:8080，因为我们将使用的 Python API 将它作为默认重定向 URL。</p></figure><p id="c011" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于图像中的每个字段，这里有一些关于您可以在注册页面中放置什么的建议。</p><p id="1167" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">应用名称:</strong>可以是任何东西。</p><p id="e45c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">描述:</strong>可以是任何东西。</p><p id="b0dc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">申请网址:</strong>可以是任何东西。</p><p id="dfc3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">组织:</strong>可以是任何东西。</p><p id="e102" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">组织网站:</strong>由于我是个人使用(查看个人 fitbit 数据)，这可能不适用。</p><p id="e081" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">服务条款网址:</strong>我放了 Fitbit 服务条款:<a class="ae kf" href="https://dev.fitbit.com/legal/platform-terms-of-service/" rel="noopener ugc nofollow" target="_blank">https://dev.fitbit.com/legal/platform-terms-of-service/</a></p><p id="9e32" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">隐私政策网址:</strong>我放了 Fitbit 隐私政策:<a class="ae kf" href="https://www.fitbit.com/legal/privacy-policy" rel="noopener ugc nofollow" target="_blank">https://www.fitbit.com/legal/privacy-policy</a></p><p id="3dd3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> OAuth 2.0 申请类型:</strong>如果您想下载您的日内数据，OAuth 2.0 申请类型应为“个人”。顺便说一下，如果你不知道 OAuth 是什么，<a class="ae kf" href="https://www.varonis.com/blog/what-is-oauth/" rel="noopener ugc nofollow" target="_blank">这里有一个解释</a>。</p><p id="4946" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">回调 Url: </strong>确保回调 Url 是 http://127.0.0.1:8080/这是因为我们将使用的库需要这样做，如下所示。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/0a8224c1e7a1725ad80cfc4995d1083e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x--wKdb-fxlkbA81FB_d4g.png"/></div></div></figure><p id="7ee9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，单击协议框，然后单击注册。应该会出现一个类似于下图的页面。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/8595a89ed8e2ad5bd746ee8366ddfb61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4rjE4qlgF5Re_I1N5gAihQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">记下您的 OAuth 2.0 客户端 ID 和客户端机密。</p></figure><p id="9d83" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将从这个页面中需要的部分是 OAuth 2.0 客户端 ID 和客户端密码。稍后您将需要客户端 ID 和客户端密码，因此请记下它们。</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="c74e" class="mw lf it ms b gy mx my l mz na"># OAuth 2.0 Client ID <br/># You will have to use your own as the one below is fake<br/>12A1BC</span><span id="6adf" class="mw lf it ms b gy nb my l mz na"># Client Secret<br/># You will have to use your own as the one below is fake<br/>12345678901234567890123456789012</span></pre><h1 id="be4b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">3.)安装 Python 库</h1><p id="a4dd" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">下一步是使用一个<a class="ae kf" href="https://github.com/orcasgit/python-fitbit" rel="noopener ugc nofollow" target="_blank"> Fitbit 非官方 API </a>。点击链接后，点击绿色按钮。接下来，单击 Download Zip 并继续解压缩文件。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/f7496adc625ff66c9dd540e2b78dd7ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gzSoqe4CsgPcbbOG9df_hA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">下载 zip 文件。</p></figure><p id="2db0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">之后，打开终端/命令行，将目录切换到解压后的文件夹，并运行下面的命令。</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="e571" class="mw lf it ms b gy mx my l mz na">#reasoning for it here: <br/>#<a class="ae kf" href="https://stackoverflow.com/questions/1471994/what-is-setup-py" rel="noopener ugc nofollow" target="_blank">https://stackoverflow.com/questions/1471994/what-is-setup-py</a><br/># If you want to install it a different way, feel free to do so. </span><span id="65b5" class="mw lf it ms b gy nb my l mz na">python setup.py install</span></pre><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/c22fad77e739f6deb8b3baf6fbd8c9ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-nC2shmqhlUZHcO5tO1Nkw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">进入文件夹目录，在终端/命令行中输入<strong class="bd mo"> python setup.py install </strong>。</p></figure><h1 id="9774" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">4.)API 授权</h1><p id="cc2d" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在开始本节之前，我应该注意两件事。首先，本教程中使用的代码可以在我的<a class="ae kf" href="https://github.com/mGalarnyk/Python_Tutorials/blob/master/Apis/Fitbit/Fitbit_API.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。第二，如果你有错误，我在博文的后面有一个潜在错误部分。</p><p id="26ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的代码导入各种库，并将步骤 2 中的 CLIENT_ID 和 CLIENT_SECRET 赋给变量。</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="022a" class="mw lf it ms b gy mx my l mz na"># This is a python file you need to have in the same directory as your code so you can import it<br/>import gather_keys_oauth2 as Oauth2</span><span id="a557" class="mw lf it ms b gy nb my l mz na">import fitbit<br/>import pandas as pd <br/>import datetime</span><span id="030a" class="mw lf it ms b gy nb my l mz na"># You will need to put in your own CLIENT_ID and CLIENT_SECRET as the ones below are fake<br/>CLIENT_ID='12A1BC'<br/>CLIENT_SECRET='12345678901234567890123456789012'</span></pre><p id="676c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的代码使授权过程能够发生</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="b92e" class="mw lf it ms b gy mx my l mz na">server=Oauth2.OAuth2Server(CLIENT_ID, CLIENT_SECRET)<br/>server.browser_authorize()<br/>ACCESS_TOKEN=str(server.fitbit.client.session.token['access_token'])<br/>REFRESH_TOKEN=str(server.fitbit.client.session.token['refresh_token'])<br/>auth2_client=fitbit.Fitbit(CLIENT_ID,CLIENT_SECRET,oauth2=True,access_token=ACCESS_TOKEN,refresh_token=REFRESH_TOKEN)</span></pre><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/6047da517f36b85f0d51ae5989091623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ehKG4mfJ47hJqLk_kvdiKw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">当您运行上面的代码(如 A 所示)时，单元格显示仍在运行，直到您登录您的 fitbit 帐户(B)并单击允许访问您的 Fitbit 帐户中的各种数据。</p></figure><p id="6f67" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">授权和登录后页面的外观。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/59d95f6a9dc6ff1bf459ad004fec6d98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f402AF5WOXT6CMCXz3_9lw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">这个窗口应该是你得到的。</p></figure><h1 id="355f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">5a。)获取一天的数据</h1><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/cf4e657f1d7a806f9c77ddac8eee4362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IoBmJ15WeoTf7yBYzvW8QQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">您将使用 intraday_time_series 方法来获取数据。</p></figure><p id="4558" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将首先从获得一天的数据开始，这样下一节将更容易理解。</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="d1b6" class="mw lf it ms b gy mx my l mz na"># This is the date of data that I want. <br/># You will need to modify for the date you want<br/>oneDate = pd.datetime(year = 2019, month = 10, day = 21)</span><span id="591c" class="mw lf it ms b gy nb my l mz na">oneDayData = auth2_client.intraday_time_series('activities/heart', oneDate, detail_level='1sec')</span></pre><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/888dc8307e1a68a1c4152f3caff92ae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FP0GfNFTD_yhHjRjrmUqQw.png"/></div></div></figure><p id="4ff0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你愿意，你可以把这些数据放入熊猫数据框。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/eb6c040775805bce0ac1f358183acb52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CihU4E7vCnruXH65XxLeeg.png"/></div></div></figure><p id="5036" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，您总是可以将数据导出到 csv 或 excel 文件中。</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="81d6" class="mw lf it ms b gy mx my l mz na"># The first part gets a date in a string format of YYYY-MM-DD<br/>filename = oneDayData['activities-heart'][0]['dateTime'] +'_intradata'</span><span id="a7d1" class="mw lf it ms b gy nb my l mz na"># Export file to csv<br/>df.to_csv(filename + '.csv', index = False)<br/>df.to_excel(filename + '.xlsx', index = False)</span></pre><h1 id="c801" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">5b。)获取多天的数据</h1><p id="b021" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">下面的代码从<code class="fe nj nk nl ms b">startTime</code>变量(在下面的代码中称为<code class="fe nj nk nl ms b">oneDate</code>)开始获取所有日期的数据。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/123261ae001c6373a18e0cc0d66aac55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VYj9drKnpiUDsfNujjTslw.png"/></div></div></figure><p id="1a35" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你当然可以导出<code class="fe nj nk nl ms b">final_df</code>到一个 csv 文件(我建议不要试图导出到 excel，因为可能有太多的行很容易导出到 excel)。</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="96b4" class="mw lf it ms b gy mx my l mz na">filename = 'all_intradata'<br/>final_df.to_csv(filename + '.csv', index = False)</span></pre><h1 id="3b68" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">6.)试着用图表显示当天的数据</h1><p id="7cf7" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这是一个部分，我强烈建议你用你自己的数据看看<a class="ae kf" href="https://github.com/mGalarnyk/Python_Tutorials/blob/master/Apis/Fitbit/Fitbit_API.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>代码。</p><p id="dd95" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这一部分的最终目标是获得特定日期的特定时间的适当图表(日期也包括当天的时间)。我应该注意到，部分由于我的懒惰，我没有使我的代码高效。如果你不明白是怎么回事，不要着急。您可以向下滚动并查看最终结果。</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="1b76" class="mw lf it ms b gy mx my l mz na"># I want to get the hour of the day and time. The end goal of this section is to get a particular time on a particular day. <br/>hoursDelta = pd.to_datetime(final_df.loc[:, 'time']).dt.hour.apply(lambda x: datetime.timedelta(hours = x))</span><span id="6768" class="mw lf it ms b gy nb my l mz na">minutesDelta = pd.to_datetime(final_df.loc[:, 'time']).dt.minutes.apply(lambda x: datetime.timedelta(minutes = x))</span><span id="2cf8" class="mw lf it ms b gy nb my l mz na">secondsDelta = pd.to_datetime(final_df.loc[:, 'time']).dt.seconds.apply(lambda x: datetime.timedelta(seconds = x))</span><span id="a03d" class="mw lf it ms b gy nb my l mz na"># Getting the date to also have the time of the day<br/>final_df['date'] = final_df['date'] + hoursDelta + minutesDelta + secondsDelta</span></pre><p id="35d7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的下一步将是查看 3 天的数据，而不是几天。</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="18d1" class="mw lf it ms b gy mx my l mz na">startDate = pd.datetime(year = 2019, month = 12, day = 24)<br/>lastDate = pd.datetime(year = 2019, month = 12, day = 27)</span><span id="627e" class="mw lf it ms b gy nb my l mz na">coupledays_df = final_df.loc[final_df.loc[:, 'date'].between(startDate, lastDate), :]</span></pre><p id="ab33" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请记住，您也可以尝试通过按日期和小时(如果您愿意，甚至可以按秒)分组并取心率的平均值来绘制图表。代码还试图使图形看起来更好一些。</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="d851" class="mw lf it ms b gy mx my l mz na">fig, ax = plt.subplots(figsize=(10, 7))</span><span id="88e9" class="mw lf it ms b gy nb my l mz na"># Taken from: <a class="ae kf" href="https://stackoverflow.com/questions/16266019/python-pandas-group-datetime-column-into-hour-and-minute-aggregations" rel="noopener ugc nofollow" target="_blank">https://stackoverflow.com/questions/16266019/python-pandas-group-datetime-column-into-hour-and-minute-aggregations</a><br/>times = pd.to_datetime(coupledays_df['date'])<br/>coupledays_df.groupby([times.dt.date,times.dt.hour]).value.mean().plot(ax = ax)</span><span id="651d" class="mw lf it ms b gy nb my l mz na">ax.grid(True,<br/>    axis = 'both',<br/>    zorder = 0,<br/>    linestyle = ':',<br/>    color = 'k')<br/>ax.tick_params(axis = 'both', rotation = 45, labelsize = 20)<br/>ax.set_xlabel('Date, Hour', fontsize = 24)<br/>fig.tight_layout()<br/>fig.savefig('coupledaysavergedByMin.png', format = 'png', dpi = 300)</span></pre><p id="a965" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了这些工作，也许这不是我下去的好方法，因为目前的数据没有给出足够的背景来知道它是在休息或四处走动时。</p><h1 id="522e" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">7.)静息心率</h1><p id="ba9d" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">有研究称<a class="ae kf" href="https://www.health.harvard.edu/blog/resting-heart-rate-can-reflect-current-future-health-201606179806" rel="noopener ugc nofollow" target="_blank">静息心率</a>可以反映你现在和未来的健康状况。实际上有一篇<a class="ae kf" href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0227709" rel="noopener ugc nofollow" target="_blank">研究论文显示了持续佩戴 Fitbit 的 92，447 名成年人的日常静息心率的个体间和个体内可变性及其与年龄、性别、睡眠、身体质量指数和一年中的时间的关联。下面是论文中的一张图片(为清晰起见，添加了文字)。</a></p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/9a1d784ce9bc0893d89f4380b3f66849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F5jICgWS-PATcMw2xvFs_Q.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">【https://journals.plos.org/plosone/article? T4】id = 10.1371/journal . pone . 0227709</p></figure><p id="0b12" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们一直使用的 api 调用也返回静息心率，因此下面的代码与前面的步骤没有太大的不同。</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="96b0" class="mw lf it ms b gy mx my l mz na"># startTime is first date of data that I want. <br/># You will need to modify for the date you want your data to start<br/>startTime = pd.datetime(year = 2019, month = 11, day = 21)<br/>endTime = pd.datetime.today().date() - datetime.timedelta(days=1)</span><span id="c7e1" class="mw lf it ms b gy nb my l mz na">date_list = []<br/>resting_list = []</span><span id="56b3" class="mw lf it ms b gy nb my l mz na">allDates = pd.date_range(start=startTime, end = endTime)</span><span id="dca9" class="mw lf it ms b gy nb my l mz na">for oneDate in allDates:<br/>    <br/>    oneDate = oneDate.date().strftime("%Y-%m-%d")<br/>    <br/>    oneDayData = auth2_client.intraday_time_series('activities/heart', base_date=oneDate, detail_level='1sec')<br/>    <br/>    date_list.append(oneDate)<br/>    <br/>    resting_list.append(oneDayData['activities-heart'][0]['value']['restingHeartRate'])</span><span id="2553" class="mw lf it ms b gy nb my l mz na"># there is more matplotlib code on GitHub<br/>fig, ax = plt.subplots(figsize=(10, 7))</span><span id="4310" class="mw lf it ms b gy nb my l mz na">ax.plot(date_list, resting_list)</span></pre><p id="42c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">试着用图表显示你的数据。</p><h1 id="4124" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">8.)获取睡眠数据</h1><p id="fb07" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在不涉及太多细节的情况下，下面的代码获得了每分钟的睡眠数据(<code class="fe nj nk nl ms b">final_df</code>)和睡眠摘要信息<code class="fe nj nk nl ms b">final_stages_df</code>，即 Fitbit 用户在深度睡眠、浅度睡眠、快速眼动睡眠和觉醒阶段总共花费了多少分钟。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/bc9b9fe151ff5bbb560af3261d06ba07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vs_h1EsEUg_O5sj0ZSm5ag.png"/></div></div></figure><p id="5e8d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nj nk nl ms b">final_stages_df</code>是一个熊猫数据框架，显示了 Fitbit 用户在给定日期的给定夜晚每个阶段的睡眠时间(清醒、深度、浅睡、快速眼动)以及在床上的总时间。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/ad514e1549cf9b1733f96b9471b5ef11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Inn78kpVqX1uMUFQ3mQmhg.png"/></div></div></figure><p id="a179" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nj nk nl ms b">final_df</code>是一个熊猫数据帧，给出日期时间、日期和值。值栏中的 1 是“睡着了”，<strong class="ki iu"> 2 </strong>是醒着的，<strong class="ki iu"> 3 </strong>是真的醒着。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/9dafe10e97588a7135d589ed8f060261.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*p1ofvyMEa0yvOjiBgK7v_A.png"/></div></div></figure><h1 id="a948" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">潜在错误</h1><h2 id="2269" class="mw lf it bd lg nq nr dn lk ns nt dp lo kr nu nv ls kv nw nx lw kz ny nz ma oa bi translated">没有名为 gather_keys_oauth2 的模块</h2><p id="0f61" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这是针对你得到一个类似下面的错误的情况。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/8e7c59db361bfa5f9fbd60255c9ce01f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8bZ_gAvBCWw6mxkQ28H95g.png"/></div></div></figure><p id="cd18" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要解决这个问题，可以将 gather_keys_oauth2.py 文件放在 python 文件或 jupyter notebook 所在的同一个目录下。你可以在下面看到我的项目目录是如何排列的。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oc"><img src="../Images/ecb984db48e0ed9d32d083da4d8eeca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4eulmQ2iMpy7fhg8tdEicQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">请注意，gather_keys_oauth2.py 与我的 jupyter 笔记本在同一个目录中。这是我们在步骤 3 中下载的 python-fitbit-master 中包含的一个文件。</p></figure><h2 id="dfe1" class="mw lf it bd lg nq nr dn lk ns nt dp lo kr nu nv ls kv nw nx lw kz ny nz ma oa bi translated">无法识别 cherrypy，没有名为 CherryPy 的模块</h2><p id="39af" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果你得到一个类似下面的错误，首先关闭你的 jupyter 笔记本或者 python 文件。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/7eb0847efe7a51fcddb407d67245881d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nItv_0JO1wt5CuF2J49bkg.png"/></div></div></figure><p id="a544" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以使用下面的命令解决这个问题。</p><pre class="mi mj mk ml gt mr ms mt mu aw mv bi"><span id="7282" class="mw lf it ms b gy mx my l mz na">pip install CherryPy</span></pre><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/067c183d397514aa6e3c3100935afc38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQl5KjAcA-xq8AA7HC4Q0Q.png"/></div></div></figure><h2 id="76af" class="mw lf it bd lg nq nr dn lk ns nt dp lo kr nu nv ls kv nw nx lw kz ny nz ma oa bi translated">Https vs Http 错误</h2><p id="f3eb" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">以下错误来自第 2 步，当时我曾试图将回调 url 设置为 https 而不是 http。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi of"><img src="../Images/4ae1dde02cb7773436498f0815ec57ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*npM6UghtWpvXnPougCXvEA.png"/></div></div></figure><h2 id="a2f2" class="mw lf it bd lg nq nr dn lk ns nt dp lo kr nu nv ls kv nw nx lw kz ny nz ma oa bi translated">HTTPTooManyRequests:请求太多</h2><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi og"><img src="../Images/55b9745a47f61dcfde0c50470eaa437a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HJ0LpNYT0rSqkYmkplEqqw.png"/></div></div></figure><p id="6c45" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://community.fitbit.com/t5/Web-API-Development/Too-many-request/td-p/1644362" rel="noopener ugc nofollow" target="_blank"> fitbit 社区论坛</a>有这个问题的答案。使用该 API，您可以每小时为每个用户/fitbit 处理多达 150 个请求。这意味着，如果您有超过 150 天的数据，并且您使用了本教程中步骤 5b 的代码，那么您可能需要等待一段时间才能获得其余的数据。</p><h2 id="0d0f" class="mw lf it bd lg nq nr dn lk ns nt dp lo kr nu nv ls kv nw nx lw kz ny nz ma oa bi translated">结束语</h2><p id="73a1" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这篇文章讲述了如何从单个 Fitbit 获取数据。虽然我已经讲了很多，但是还有一些事情我没有讲，比如说<a class="ae kf" href="https://python-fitbit.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> Fitbit api 如何获得你的步数</a>。Fitbit API 是我仍在学习的东西，所以如果你有贡献，请让我知道。如果你对教程有任何问题或想法，欢迎在下面的评论中或通过<a class="ae kf" href="https://twitter.com/GalarnykMichael" rel="noopener ugc nofollow" target="_blank">推特</a>联系。</p></div></div>    
</body>
</html>