<html>
<head>
<title>What is time series decomposition and how does it work?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是时间序列分解，它是如何工作的？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-is-time-series-decomposition-and-how-does-it-work-9b67e007ae90?source=collection_archive---------8-----------------------#2020-06-20">https://towardsdatascience.com/what-is-time-series-decomposition-and-how-does-it-work-9b67e007ae90?source=collection_archive---------8-----------------------#2020-06-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/ad3d2e8eeb3b78f12d82ecb0635c01f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UcZfz04xfqjbKaTIXVf8RA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://pixabay.com/users/nutraveller-5661007/" rel="noopener ugc nofollow" target="_blank"> nutraveller </a>通过<a class="ae jg" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a> ( <a class="ae jg" href="https://pixabay.com/service/license/" rel="noopener ugc nofollow" target="_blank"> Pixabay许可</a>)</p></figure><div class=""/><div class=""><h2 id="b853" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">此外，我们还将深入了解使用Python的强大时间序列分解算法</h2></div><p id="a7ff" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">时间序列可被视为由4个部分组成:</p><p id="c65a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">季节性成分<br/>趋势成分<br/>周期性成分<br/>噪声成分。</p><h2 id="4d0c" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">季节性成分</h2><p id="41bb" class="pw-post-body-paragraph ky kz jj la b lb mn kk ld le mo kn lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">季节性因素解释了人们在许多数据集中看到的周期性起伏，如下图所示。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ms"><img src="../Images/4ff1676d9f2d825114f28e4dd579f01d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AVrlBMnUGZnDsbf1bCOAqg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">零售二手车销售。数据来源:<a class="ae jg" href="https://fred.stlouisfed.org/series/MRTSSM44112USN" rel="noopener ugc nofollow" target="_blank">美国弗雷德</a>(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>)</p></figure><p id="6271" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的例子中，季节周期大约为12个月，在3月达到高峰，在11月或12月触底，然后在3月再次达到高峰。</p><p id="53c5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">时间序列可以包含多个叠加的季节周期。一个经典的例子是气象站每小时温度的时间序列。由于地球绕地轴旋转，气象站的每小时温度图将显示24小时的季节周期。地球也以倾斜的方式围绕太阳旋转，导致了季节性的温度变化。如果你连续365天跟踪气象站上午11点的温度，你会看到第二种模式出现，其周期为12个月。24小时长的日形态叠加在12个月长的年形态上。</p><p id="4be2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在每小时天气数据的情况下，人们知道是什么潜在的物理现象导致了这两种季节模式。但在大多数情况下，不可能知道将季节性引入数据的所有因素是什么。因此，很难发现隐藏在时间序列中的所有季节周期。</p><p id="a8a8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">也就是说，常见的季节周期是一天、一周、一月、一季(或一季)和一年。</p><p id="d785" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">季节性也可以在更长的时间尺度上观察到，例如太阳周期，它遵循大约11年的周期。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mx"><img src="../Images/c1e380240033beb0bfb72d9453513e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yicZQjXQ3TCEFkXOkHrRGw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">每日太阳黑子计数。数据来源:<a class="ae jg" href="http://www.sidc.be/silso/datafiles" rel="noopener ugc nofollow" target="_blank"> SILSO </a>(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><h2 id="8b8d" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">趋势组件</h2><p id="13a5" class="pw-post-body-paragraph ky kz jj la b lb mn kk ld le mo kn lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">趋势部分指的是跨季节期间的数据模式。</p><p id="c158" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下图所示的零售电子商务销售时间序列展示了一个可能的二次趋势(<em class="my"> y = x </em>)，该趋势跨越了长达12个月的季节周期:</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mz"><img src="../Images/b07652b9f2c7ef10094f836bd816ce09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R5-5y5ZGrhs2Ovu9ueq5Aw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">零售电子商务销售。数据来源:<a class="ae jg" href="https://fred.stlouisfed.org/series/ECOMNSA" rel="noopener ugc nofollow" target="_blank">美国弗雷德</a>(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><h2 id="97a7" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">周期性成分</h2><p id="da29" class="pw-post-body-paragraph ky kz jj la b lb mn kk ld le mo kn lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">周期性成分代表跨季节发生的现象。周期性模式不像季节性模式那样有固定的周期。周期性模式的一个例子是股票市场经历的对世界事件的繁荣和萧条的循环。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi na"><img src="../Images/27a0a74cf589f55f3aa21551baf6bad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P7Afs9SiGTV6HLJ2QFI0Lg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">道琼斯收盘价比上一年(1880年至2020年)的百分比变化。数据来源:【MeasuringWorth.com】T4via<a class="ae jg" href="https://en.wikipedia.org/wiki/Dow_Jones_Industrial_Average" rel="noopener ugc nofollow" target="_blank">维基百科</a>)(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>)</p></figure><p id="5ddc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">周期性成分很难被分离出来，它常常被与趋势成分结合在一起而被“搁置”。</p><h2 id="97f4" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">噪声成分</h2><p id="6670" class="pw-post-body-paragraph ky kz jj la b lb mn kk ld le mo kn lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">当你从时间序列中分离出季节性和趋势时，噪声或随机成分会留下来。噪音是你不知道或无法测量的因素的影响。这是已知的未知的影响，或未知的未知。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="efbf" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">加法和乘法效应</h2><p id="95e1" class="pw-post-body-paragraph ky kz jj la b lb mn kk ld le mo kn lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">趋势、季节性和噪声成分可以以<strong class="la jk">加法</strong>或<strong class="la jk">乘法</strong>的方式组合。</p><p id="1854" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">相加组合</strong> <br/>如果季节和噪声分量改变趋势的量与趋势值无关，则趋势、季节和噪声分量被认为以<strong class="la jk">相加</strong>的方式表现。这种情况可以表示如下:</p><p id="7a5c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="my"> y_i = t_i + s_i + n_i </em></p><p id="e5f7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">其中<em class="my"> y_i </em> =时间序列在第<em class="my">个</em>时间步的值。<br/> <em class="my"> t_i </em> =第<em class="my">与</em>时间步的趋势分量。<br/> <em class="my"> s_i </em> =第<em class="my">与</em>时间步的季节分量。<br/> <em class="my"> n_i </em> =第<em class="my">个</em>时间步的噪声分量。</p><p id="ddbd" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">乘法组合<br/> </strong>如果季节和噪声分量改变趋势的量取决于趋势的值，则这三个分量以乘法方式表现如下:</p><p id="6f3a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="my"> y_i = t_i * s_i * n_i </em></p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="ebed" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">使用Python将时间序列分解为趋势、季节和噪声分量的分步过程</h2><p id="ebb9" class="pw-post-body-paragraph ky kz jj la b lb mn kk ld le mo kn lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">有许多可用的分解方法，从简单的基于移动平均的方法到强大的方法，如STL。</p><p id="4972" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Python中，<em class="my"> statsmodels </em>库有一个<em class="my"> seasonal_decompose() </em>方法，可以让你在一行代码中将时间序列分解成趋势、季节性和噪声。</p><p id="ece0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的文章中，我们喜欢进入杂草中。所以在我们使用<em class="my"> seasonal_decompose() </em>之前，让我们深入了解一个简单而强大的时间序列分解技术。</p><p id="f598" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们了解分解在幕后是如何工作的。</p><p id="90d8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将手动将时间序列分解为趋势、季节和噪声成分，使用基于移动平均值的简单程序，步骤如下:</p><p id="7b65" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">步骤1:确定季节周期的长度<br/>步骤2:隔离趋势<br/>步骤3:隔离季节性+噪声<br/>步骤4:隔离季节性<br/>步骤5:隔离噪声</p><p id="8c95" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将以美国用户汽车经销商的零售销售时间序列为例:</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ni"><img src="../Images/8b790d1a45d368d353b4aa9443695213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wr54iN52SxpjOuF9G7o0pQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">零售二手车销售。数据来源:<a class="ae jg" href="https://fred.stlouisfed.org/series/MRTSSM44112USN" rel="noopener ugc nofollow" target="_blank">美国弗雷德</a>(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>)</p></figure><p id="ab12" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们将数据加载到熊猫数据框架中，并绘制时间序列:</p><pre class="mt mu mv mw gt nj nk nl nm aw nn bi"><span id="5eef" class="lu lv jj nk b gy no np l nq nr"><strong class="nk jk">import </strong>pandas <strong class="nk jk">as </strong>pd<br/>import numpy as np<br/>import math<br/>from matplotlib import pyplot as plt</span><span id="3e81" class="lu lv jj nk b gy ns np l nq nr">mydateparser = <strong class="nk jk">lambda </strong>x: pd.<strong class="nk jk">datetime</strong>.<strong class="nk jk">strptime</strong>(x, '%d-%m-%y')</span><span id="1b3a" class="lu lv jj nk b gy ns np l nq nr">df = pd.<strong class="nk jk">read_csv</strong>('retail_sales_used_car_dealers_us_1992_2020.csv', <strong class="nk jk">header</strong>=0, <strong class="nk jk">index_col</strong>=0, <strong class="nk jk">parse_dates</strong>=['DATE'], <strong class="nk jk">date_parser</strong>=mydateparser)</span><span id="9000" class="lu lv jj nk b gy ns np l nq nr">fig = plt.figure()</span><span id="ca04" class="lu lv jj nk b gy ns np l nq nr">fig.suptitle(<strong class="nk jk">'Retail sales of used car dealers in the US in millions of dollars'</strong>)</span><span id="a512" class="lu lv jj nk b gy ns np l nq nr">df[<strong class="nk jk">'Retail_Sales'</strong>].plot()</span><span id="5264" class="lu lv jj nk b gy ns np l nq nr">plt.show()</span></pre><p id="3f61" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">现在让我们开始逐步分解这个时间序列。</strong></p><p id="811f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">第一步:</strong>尝试猜测数据中季节性成分的持续时间。在上面的例子中，我们猜测是12个月。</p><p id="1792" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">第二步:</strong>现在运行一个以12个月<a class="ae jg" href="https://www.itl.nist.gov/div898/handbook/pmc/section4/pmc422.htm" rel="noopener ugc nofollow" target="_blank"><strong class="la jk"/></a><strong class="la jk"/>移动平均线为中心的数据。这一移动平均值分布在总共13个月的时间里。即在中心月份的左侧和右侧各有6个月。以12个月为中心的移动平均线是两个移动平均线的平均值，两个移动平均线相差1个月，实际上是一个加权移动平均线。</p><p id="751d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面举例说明了如何在Microsoft Excel中计算这种居中的MA:</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nt"><img src="../Images/9c91d37168a372f70b0e913190f2043d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MAHqLxAe0jaFtRCo1IVJWA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">2 x 12居中移动平均线的图示(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="ba72" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种MA将消除季节性和噪音，并显示趋势。</p><p id="4ef9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">继续我们的Python示例，下面是我们如何在Python中计算居中移动平均值:</p><pre class="mt mu mv mw gt nj nk nl nm aw nn bi"><span id="ce5e" class="lu lv jj nk b gy no np l nq nr"><strong class="nk jk">#Add an empty column to store the 2x12 centered MA values</strong><br/>df[<strong class="nk jk">'2 x 12 CMA (TREND)'</strong>] = np.nan</span><span id="e8f6" class="lu lv jj nk b gy ns np l nq nr"><strong class="nk jk">#Fill it up with the 2x12 centered MA values<br/>for </strong>i <strong class="nk jk">in </strong>range(6,df[<strong class="nk jk">'Retail_Sales'</strong>].size-6):<br/>    df[<strong class="nk jk">'2 x 12 CMA (TREND)'</strong>][i] = np.round(<br/>        df[<strong class="nk jk">'Retail_Sales'</strong>][i - 6] * 1.0 / 24 + <br/>        (<br/>            df[<strong class="nk jk">'Retail_Sales'</strong>][i - 5] + <br/>            df[<strong class="nk jk">'Retail_Sales'</strong>][i - 4] + <br/>            df[<strong class="nk jk">'Retail_Sales'</strong>][i - 3] + <br/>            df[<strong class="nk jk">'Retail_Sales'</strong>][i - 2] + <br/>            df[<strong class="nk jk">'Retail_Sales'</strong>][i - 1] + <br/>            df[<strong class="nk jk">'Retail_Sales'</strong>][i] + <br/>            df[<strong class="nk jk">'Retail_Sales'</strong>][i + 1] + <br/>            df[<strong class="nk jk">'Retail_Sales'</strong>]i + 2] + <br/>            df[<strong class="nk jk">'Retail_Sales'</strong>][i + 3] + <br/>            df[<strong class="nk jk">'Retail_Sales'</strong>][i + 4] + <br/>            df[<strong class="nk jk">'Retail_Sales'</strong>][i + 5]<br/>        ) * 1.0 / 12 + <br/>        df[<strong class="nk jk">'Retail_Sales'</strong>][i + 6] * 1.0 / 24</span></pre><p id="bae0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，索引<em class="my">【I-6】</em>和<em class="my">【I+6】</em>处的值是如何通过<em class="my"> 1.0/24 </em>进行加权的，而其余值是如何通过<em class="my"> 1.0/12进行加权的。</em></p><p id="64c3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们绘制包含在列<strong class="la jk">‘2 x 12 CMA(趋势)’:</strong>中的结果时间序列</p><pre class="mt mu mv mw gt nj nk nl nm aw nn bi"><span id="a37c" class="lu lv jj nk b gy no np l nq nr"><strong class="nk jk"><em class="my">#plot the trend component</em></strong><em class="my"><br/></em>fig = plt.figure()</span><span id="4bff" class="lu lv jj nk b gy ns np l nq nr">fig.suptitle(<strong class="nk jk">'TREND component of Retail sales of used car dealers in the US in millions of dollars'</strong>)</span><span id="3fc4" class="lu lv jj nk b gy ns np l nq nr">df[<strong class="nk jk">'2 x 12 CMA (TREND)'</strong>].plot()</span><span id="f6cd" class="lu lv jj nk b gy ns np l nq nr">plt.show()</span></pre><p id="c64e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，我们的移动平均转换突出了零售时间序列的趋势部分:</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nu"><img src="../Images/cf2f77080a4ac86e855186b5da497276.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gWXwrpTrOdvMX0WMtxwYow.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="0bc0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">第三步:</strong>现在我们要做一个决定。根据组成是<strong class="la jk">乘法还是加法</strong>，我们将需要<strong class="la jk">从原始时间序列中除以或减去</strong>趋势分量，以检索季节和噪声分量。如果我们检查原始的汽车销售时间序列，我们可以看到<strong class="la jk">季节性波动与时间序列</strong>的当前值成比例增加。因此，我们将假设季节性是倍增的。我们还将大胆假设噪声是乘法噪声。</p><p id="08dc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，假定零售二手车销售时间序列具有以下乘法分解模型:</p><p id="b754" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="my">时间序列值=趋势分量*季节分量*噪声分量</em></p><p id="640a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此:</p><p id="0051" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="my">季节性成分*噪声成分=时间序列值/趋势成分</em></p><p id="ba6f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将在数据框中添加一个新列，并使用上面的公式填充季节和噪声分量的乘积。</p><pre class="mt mu mv mw gt nj nk nl nm aw nn bi"><span id="7a44" class="lu lv jj nk b gy no np l nq nr">df['SEASONALITY AND NOISE'] = df['Retail_Sales']/df['2 x 12 CMA (TREND)']</span></pre><p id="9d48" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们绘制新的列。这一次，我们将看到季节性和噪音通过:</p><pre class="mt mu mv mw gt nj nk nl nm aw nn bi"><span id="57af" class="lu lv jj nk b gy no np l nq nr">fig = plt.figure()</span><span id="90fa" class="lu lv jj nk b gy ns np l nq nr">fig.suptitle(<strong class="nk jk">'SEASONALITY and NOISE components'</strong>)</span><span id="f462" class="lu lv jj nk b gy ns np l nq nr">plt.ylim(0, 1.3)</span><span id="8e1a" class="lu lv jj nk b gy ns np l nq nr">df[<strong class="nk jk">'SEASONALITY AND NOISE'</strong>].plot()</span><span id="302a" class="lu lv jj nk b gy ns np l nq nr">plt.show()</span></pre><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nv"><img src="../Images/58deeaf03873130e0017b6af9287de29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HnrBy6adI7YxHL9DIc4ckA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="8309" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">步骤4: </strong>接下来，我们将通过计算所有一月、二月、三月等月份的季节性成分的平均值，从季节性和噪声的混合中获得“纯”季节性成分。</p><pre class="mt mu mv mw gt nj nk nl nm aw nn bi"><span id="4221" class="lu lv jj nk b gy no np l nq nr"><strong class="nk jk"><em class="my">#first add a month column</em></strong><em class="my"><br/></em>df[<strong class="nk jk">'MONTH'</strong>] = df.index.strftime(<strong class="nk jk">'%m'</strong>).astype(np.int)</span><span id="00a0" class="lu lv jj nk b gy ns np l nq nr"><strong class="nk jk"><em class="my">#initialize the month based dictionaries to store the running total of the month wise  seasonal sums and counts<br/></em></strong>average_seasonal_values = {1:0, 2:0, 3:0, 4:0, 5:0, 6:0, 7:0, 8:0, 9:0, 10:0, 11:0, 12:0}</span><span id="dfa1" class="lu lv jj nk b gy ns np l nq nr">average_seasonal_value_counts = {1:0, 2:0, 3:0, 4:0, 5:0, 6:0, 7:0, 8:0, 9:0, 10:0, 11:0, 12:0}</span><span id="5562" class="lu lv jj nk b gy ns np l nq nr"><strong class="nk jk"><em class="my">#calculate the sums and counts<br/></em>for </strong>i <strong class="nk jk">in </strong>range(0, df[<strong class="nk jk">'SEASONALITY AND NOISE'</strong>].size):<br/>    <strong class="nk jk">if </strong>math.isnan(df[<strong class="nk jk">'SEASONALITY AND NOISE'</strong>][i]) <strong class="nk jk">is False</strong>:<br/>        average_seasonal_values[df[<strong class="nk jk">'MONTH'</strong>][i]] =  <br/>            average_seasonal_values[df[<strong class="nk jk">'MONTH'</strong>][i]] +<br/>            df[<strong class="nk jk">'SEASONALITY AND NOISE'</strong>][i]</span><span id="1954" class="lu lv jj nk b gy ns np l nq nr">        average_seasonal_value_counts[df[<strong class="nk jk">'MONTH'</strong>][i]] =<br/>            average_seasonal_value_counts[df[<strong class="nk jk">'MONTH'</strong>][i]] + 1</span><span id="0f25" class="lu lv jj nk b gy ns np l nq nr"><strong class="nk jk"><em class="my">#calculate the average seasonal component for each month<br/></em>for </strong>i <strong class="nk jk">in </strong>range(1, 13):<br/>    average_seasonal_values[i] = average_seasonal_values[i] / average_seasonal_value_counts[i]</span><span id="cabc" class="lu lv jj nk b gy ns np l nq nr"><strong class="nk jk"><em class="my">#create a new column in the data frame and fill it with the value of the average seasonal component for the corresponding month</em></strong></span><span id="e4d4" class="lu lv jj nk b gy ns np l nq nr">df[<strong class="nk jk">'SEASONALITY'</strong>] = np.nan</span><span id="acd9" class="lu lv jj nk b gy ns np l nq nr"><strong class="nk jk">for </strong>i <strong class="nk jk">in </strong>range(0, df[<strong class="nk jk">'SEASONALITY AND NOISE'</strong>].size):<br/>    <strong class="nk jk">if </strong>math.isnan(df[<strong class="nk jk">'SEASONALITY AND NOISE'</strong>][i]) <strong class="nk jk">is False</strong>:<br/>        df[<strong class="nk jk">'SEASONALITY'</strong>][i] = <br/>            average_seasonal_values[df[<strong class="nk jk">'MONTH'</strong>][i]]</span></pre><p id="5d70" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们画出这个纯季节成分:</p><pre class="mt mu mv mw gt nj nk nl nm aw nn bi"><span id="c7c2" class="lu lv jj nk b gy no np l nq nr"><strong class="nk jk"><em class="my">#plot the seasonal component<br/></em></strong>fig = plt.figure()</span><span id="df30" class="lu lv jj nk b gy ns np l nq nr">fig.suptitle(<strong class="nk jk">'The \'pure\' SEASONAL component'</strong>)</span><span id="b214" class="lu lv jj nk b gy ns np l nq nr">plt.ylim(0, 1.3)</span><span id="9e1e" class="lu lv jj nk b gy ns np l nq nr">df[<strong class="nk jk">'SEASONALITY'</strong>].plot()</span><span id="2984" class="lu lv jj nk b gy ns np l nq nr">plt.show()</span></pre><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nw"><img src="../Images/bd64702815a8d5ff73e3f4c163119076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LYZ3kLrgWDP3ax1I6R-HTg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="5ce9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">第五步:</strong>最后，我们将之前分离出的噪声季节值除以平均季节值，得出每个月的噪声分量。</p><p id="eb0b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">噪声分量=噪声季节性分量/平均季节性分量</p><pre class="mt mu mv mw gt nj nk nl nm aw nn bi"><span id="d8b5" class="lu lv jj nk b gy no np l nq nr">df[<strong class="nk jk">'NOISE'</strong>] = df[<strong class="nk jk">'SEASONALITY AND NOISE'</strong>]/df[<strong class="nk jk">'SEASONALITY'</strong>]</span><span id="edba" class="lu lv jj nk b gy ns np l nq nr"><em class="my">#plot the seasonal component</em></span><span id="237e" class="lu lv jj nk b gy ns np l nq nr">fig = plt.figure()</span><span id="b075" class="lu lv jj nk b gy ns np l nq nr">fig.suptitle(<strong class="nk jk">'The NOISE component'</strong>)</span><span id="1227" class="lu lv jj nk b gy ns np l nq nr">plt.ylim(0, 1.3)</span><span id="2b78" class="lu lv jj nk b gy ns np l nq nr">df[<strong class="nk jk">'NOISE'</strong>].plot()</span><span id="ccb4" class="lu lv jj nk b gy ns np l nq nr">plt.show()</span></pre><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nv"><img src="../Images/0318cde4b2ea0cf16fcc3bd8e45449ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KV8jFeI-RAU2r6UmXiCcWg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="e01b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以你有它！我们只是手工制作了将时间序列分解成趋势、季节和噪声成分的程序。</p><p id="1be5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是时间序列及其组成部分的拼贴画:</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nu"><img src="../Images/28f2594e6d1ec449273f466a9f6901b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wvm64JATZVfDdOoocjACQA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="918c" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">使用statsmodels的时间序列分解</h2><p id="f103" class="pw-post-body-paragraph ky kz jj la b lb mn kk ld le mo kn lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">现在我们知道了分解是如何从内部工作的，我们可以稍微欺骗一下，在statsmodels中使用seasonal_decompose()在一行代码中完成上述所有工作:</p><pre class="mt mu mv mw gt nj nk nl nm aw nn bi"><span id="660c" class="lu lv jj nk b gy no np l nq nr"><strong class="nk jk">from</strong> statsmodels.tsa.seasonal <strong class="nk jk">import</strong> seasonal_decompose</span><span id="f146" class="lu lv jj nk b gy ns np l nq nr">components = <strong class="nk jk">seasonal_decompose</strong>(df['Retail_Sales'], <strong class="nk jk">model</strong>='multiplicative')</span><span id="c16c" class="lu lv jj nk b gy ns np l nq nr">components.<strong class="nk jk">plot</strong>()</span></pre><p id="8149" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我们得到的图:</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/d76dc81516841041d83d877b0c7e7e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZkKVu_ih6QEMb_mz83oAw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">零售二手车销售数据集上的季节性分解()的输出(图片由<a class="ae jg" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="cd9d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是完整的Python源代码:</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="c5f4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里的<a class="ae jg" href="https://gist.github.com/sachinsdate/40b07da727f8d3d2476dbef4a2f06b6a" rel="noopener ugc nofollow" target="_blank">是到Python例子中使用的数据集的链接</a>。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="e777" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">引用和版权</h2><p id="4a61" class="pw-post-body-paragraph ky kz jj la b lb mn kk ld le mo kn lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">美国人口普查局，零售销售:二手车经销商[MRTSSM44112USN]，检索自圣路易斯美联储银行弗雷德；<a class="ae jg" href="https://fred.stlouisfed.org/series/MRTSSM44112USN" rel="noopener ugc nofollow" target="_blank">https://fred.stlouisfed.org/series/MRTSSM44112USN</a>，2020年6月17日，根据<a class="ae jg" href="https://fred.stlouisfed.org/legal/" rel="noopener ugc nofollow" target="_blank">弗雷德版权条款</a>。</p><p id="69c8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">美国人口普查局，电子商务零售销售[ECOMNSA]，从圣路易斯美联储银行检索；<a class="ae jg" href="https://fred.stlouisfed.org/series/ECOMN" rel="noopener ugc nofollow" target="_blank">https://fred.stlouisfed.org/series/ECOMN</a>，根据<a class="ae jg" href="https://fred.stlouisfed.org/legal/" rel="noopener ugc nofollow" target="_blank">弗雷德版权条款</a>。</p><p id="7609" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">SILSO，世界数据中心—太阳黑子数和长期太阳观测，比利时皇家天文台，在线太阳黑子数目录:<a class="ae jg" href="http://www.sidc.be/SILSO/," rel="noopener ugc nofollow" target="_blank">http://www.sidc.be/SILSO/,</a>1818–2020(<a class="ae jg" href="https://creativecommons.org/licenses/by-nc/4.0/" rel="noopener ugc nofollow" target="_blank">CC-BY-NA</a></p><p id="39cb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">塞缪尔·h·威廉姆森，“美国DJA每日收盘价，1885年至今”，MeasuringWorth，2020年<br/>网址:<a class="ae jg" href="http://www.measuringworth.com/DJA/" rel="noopener ugc nofollow" target="_blank">http://www.measuringworth.com/DJA/</a></p><p id="f2e3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文中的所有图片版权归<a class="ae jg" href="https://www.linkedin.com/in/sachindate/" rel="noopener ugc nofollow" target="_blank"> Sachin Date </a>所有，版权归<a class="ae jg" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener ugc nofollow" target="_blank"> CC-BY-NC-SA </a>所有，除非图片下面提到了不同的来源和版权。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><p id="cb43" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="my">感谢阅读！如果你喜欢这篇文章，请</em> <a class="ae jg" href="https://timeseriesreasoning.medium.com" rel="noopener"> <strong class="la jk"> <em class="my">关注我</em> </strong> </a> <em class="my">获取关于时间序列分析的技巧、操作方法和编程建议。</em></p></div></div>    
</body>
</html>