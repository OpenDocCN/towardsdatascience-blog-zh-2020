<html>
<head>
<title>Using Bayesian Statistics to compare Wines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用贝叶斯统计比较葡萄酒</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-bayesian-statistics-to-compare-wines-ef2477047cb5?source=collection_archive---------47-----------------------#2020-06-06">https://towardsdatascience.com/using-bayesian-statistics-to-compare-wines-ef2477047cb5?source=collection_archive---------47-----------------------#2020-06-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c656" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">分级建模和 Gibbs 抽样概述，用于比较多组数据。</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/89c7d3a297763e927adc94fed6d59e48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oHpTUNnjh_5HFUb7"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> chuttersnap </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="8d84" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi lw translated">当被问及更喜欢哪种葡萄酒时，大多数人都会回答红葡萄酒或白葡萄酒(有时还会说玫瑰葡萄酒)。即使我们最终确定了葡萄酒的颜色，仍有成千上万种葡萄酒可供选择(它们尝起来都非常不同)。一个狂热的葡萄酒爱好者可以很容易地区分这些葡萄酒，并且在挑选葡萄酒时对葡萄酒的国家和品种非常挑剔。在这篇博客中，我们将使用统计数据来帮助我们选择哪种葡萄酒更好。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="e0e9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们将考虑本博客的<a class="ae kz" href="https://www.kaggle.com/zynicide/wine-reviews" rel="noopener ugc nofollow" target="_blank"> <em class="mm"> Kaggle wines 评论</em> </a>数据集。这个数据集包含了一些品酒师对世界各地生产的不同葡萄酒的评论。葡萄酒的等级由分数栏给出，从 1 到 100。让我们假设，我的一个朋友喜欢南非的长相思，另一个喜欢智利的霞多丽。他们都认为 15 美元是买一瓶酒的合适金额。现在让我们在不品尝任何一种的情况下完成这个。</p><p id="772a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们从看一下数据集开始这个旅程:</p><p id="0c92" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">该数据集有 14 列 129971 个数据点。有三个数字列，X，点数，价格；其中 X 是索引。其余 11 列是字符类型。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mn"><img src="../Images/a0efd618d60f4ae1e45363a47e0c1568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M4FfrUntT_tacreV5kA-hA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">数据集的结构</p></figure><p id="aed3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，我们需要在南非长相思和智利霞多丽之间做出选择，所以让我们从数据集中过滤这些数据点。</p><pre class="kk kl km kn gt mo mp mq mr aw ms bi"><span id="8aa0" class="mt mu it mp b gy mv mw l mx my">wine_groups &lt;- wine%&gt;%<br/>  filter( ((variety=="Sauvignon Blanc" &amp; country=="South Africa") | <br/>            (variety=="Chardonnay" &amp; country=="Chile")) &amp; <br/>            price == 15)</span></pre><p id="f6ae" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">注意:</strong>两国都生产这两种葡萄酒。所以我们需要使用这种组合过滤条件来选择数据，而不是在不同的过滤器中过滤品种和国家。</p><p id="a091" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">按照我们的特定条件选择数据，我们只得到 51 行。让我们先看一下所选的数据集，并形成我们的假设。首先，绘制这两种葡萄酒的箱线图，以估计点数的中值和范围。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/40f95b134de315d6eee3c19b8f4f929a.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*R_mBYJy9jiPwt7FYkX9OXQ.png"/></div></figure><p id="39a5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">从中可以看出“<em class="mm">霞多丽</em>”的值在 81 到 88 之间，中间值约为 85。长相思的数值范围从 85 到 90，中间值约为 87。从各组的中位数也可以明显看出，长相思比霞多丽有更好的分数，这可以用来形成我们的假设。查看这些值的平均值、中间值和标准偏差:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="051a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">很明显，长相思被认为比霞多丽更好，但是我们不能确定这一点，因为数据很少。让我们进行一个双样本 t 检验来形成一个假设。</p><pre class="kk kl km kn gt mo mp mq mr aw ms bi"><span id="8826" class="mt mu it mp b gy mv mw l mx my">## <br/>##  Two Sample t-test<br/>## <br/>## data:  points by variety<br/>## t = -3.2599, df = 49, p-value = 0.00203<br/>## alternative hypothesis: true difference in means is not equal to 0<br/>## 95 percent confidence interval:<br/>##  -3.4482245 -0.8181847<br/>## sample estimates:<br/>##      mean in group Chardonnay mean in group Sauvignon Blanc <br/>##                      85.08108                      87.21429</span></pre><p id="a55b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">解释这些结果并形成我们的无效假设。无效假设表明两组之间的差异为零。p 值为 0.00203，小于 0.05，表明我们有 95%的把握认为长相思更好，或者我们也可以说有 0.2%的几率差异为零。重要的是，两个平均值之间的差值不为 0。基于这个 t 检验，我们形成了我们的假设，长相思比霞多丽更好评级。我们将尝试使用贝叶斯推理方法来找出这种差异。</p><h1 id="7d19" class="nc mu it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">统计建模</h1><p id="052a" class="pw-post-body-paragraph la lb it lc b ld nt ju lf lg nu jx li lj nv ll lm ln nw lp lq lr nx lt lu lv im bi translated">我们现在将使用 Gibbs 采样器来明确地模拟两组葡萄酒之间的差异。这用于对平均值和标准偏差(或精度)值执行完全条件更新。Gibbs Sampler 简化了我们使用 MCMC 方法更新多个参数的任务，它使用一种潜在的方便的全条件概率，将过程分成一次更新一个参数。为了对一个特定参数进行更新，我们将所有其他参数的当前值代入。有三个参数，我们试图用吉布斯采样器来估计，</p><ul class=""><li id="00b1" class="ny nz it lc b ld le lg lh lj oa ln ob lr oc lv od oe of og bi translated">μ，两个定义组的平均值；</li><li id="3261" class="ny nz it lc b ld oh lg oi lj oj ln ok lr ol lv od oe of og bi translated">del，两组的积分差异；</li><li id="0cad" class="ny nz it lc b ld oh lg oi lj oj ln ok lr ol lv od oe of og bi translated">τ，精度(定义为 1/Sd)；</li></ul><p id="ff43" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们假设数据的范围覆盖在μ+2d 中，一般精度为τ。因此，这两组可以重新参数化为 mu+del 和 mu-del。其层次模型如下所示:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi om"><img src="../Images/c48465369bdfa5dd893ff0576b343f52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SO9t2eoxVICTDRsnWVSPaA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">分层模型图</p></figure><h2 id="4995" class="mt mu it bd nd on oo dn nh op oq dp nl lj or os nn ln ot ou np lr ov ow nr ox bi translated"><strong class="ak">吉布斯采样:</strong></h2><p id="8800" class="pw-post-body-paragraph la lb it lc b ld nt ju lf lg nu jx li lj nv ll lm ln nw lp lq lr nx lt lu lv im bi translated">对于吉布斯采样器的先验值，我们的最佳猜测如下:点数从 80 到 95 不等，中间值约为 85-87，因此 mu 的最佳估计值为 85。我们假设标准差约为 10，因此τ的先验估计值为 1/100。我们将 del 的初始值设为 0，因为根据零假设，组间差异为 0。在采样器的预烧期之后，这种先前的猜测将收敛于它们来自数据的原始值。我们运行采样器 5000 次迭代。对于正态似然性，平均值遵循具有参数μ0 和𝜎2 的正态分布，标准偏差𝜎2 遵循逆伽马分布(因此τ遵循伽马分布)，而δ1 也遵循正态分布。这些分布用于更新我们的吉布斯采样器中的参数。</p><p id="8577" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在从 Gibbs 方法生成样本之后，我们使用 MCMC 拟合方法创建图来分析估计参数(μ、del 和 tau)的收敛性。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oy"><img src="../Images/956eac90b4ab41db29e684a0f67eb964.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3GO8qhC8o0Vuovcl9XcHVw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">迹线和密度图。</p></figure><p id="04fe" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">从该图中可以观察到，对于所有三个参数，模拟的马尔可夫链已经收敛到其后验分布，并且μ、δ1 和τ的后验参数估计值遵循正态分布。因为μ、δ1 和τ的后验估计也遵循正态分布，所以我们在 Gibbs 方法之前的猜测被认为是正态似然函数的共轭先验。对参数的这种完全有条件的更新为我们提供了如下后验值:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="edf9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们以 mu+del 计算第 1 组(在我们的例子中是“智利霞多丽”)的平均值，我们得到 85.084，以 mu-del 计算第 2 组(“南非长相思”)的平均值，我们得到 87.204，标准偏差为 2.778。基于这些值，我们可以拒绝零假设，并接受两种葡萄酒之间的点数差异不为零。</p><p id="7b98" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">因此，在我们的案例中，我们有一个赢家，<em class="mm">南非长相思比智利霞多丽得到了</em> <strong class="lc iu"> <em class="mm"> 2.1198 </em> </strong> <em class="mm">的分数。</em></p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="2ee9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">啊，但是我的朋友似乎很坚决，所以我们决定以每瓶 15 美元的价格买下这两款酒。现在来看看南非长相思更好的概率有多大。</p><h2 id="3bc5" class="mt mu it bd nd on oo dn nh op oq dp nl lj or os nn ln ot ou np lr ov ow nr ox bi translated">预测模拟</h2><p id="13d6" class="pw-post-body-paragraph la lb it lc b ld nt ju lf lg nu jx li lj nv ll lm ln nw lp lq lr nx lt lu lv im bi translated">我们可以再次使用相同的吉布斯采样器对未观察到的数据进行预测。根据上一部分中使用的 Gibbs 抽样拟合模型，我们再创建两个各为 5000 的模拟，第一个用(mu + del)的最后一部分中的平均估计值表示“Chardonnay ”,第二个组用(model)的平均估计值表示“Sauvignon Blanc ”,具有公共标准偏差。在最后部分中接收的相同的吉布斯采样器输出拟合被用作该部分的仿真参数。</p><p id="1039" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们绘制了从该模拟接收的后验分布，并且它遵循正态分布曲线，</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oz"><img src="../Images/0bbc7d61feed18e532fd824959b084af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*97x0F2rsb1Go45W-BbsTow.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">后验分布</p></figure><p id="eb22" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这些样品帮助我们检查一种葡萄酒的平均水平是否比其他的好。一种酒的每一个样品都要与其他酒的每一个样品进行核对。这就产生了一个概率，告诉我们哪种酒更好，好多少。</p><h1 id="3b79" class="nc mu it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">结论</h1><ul class=""><li id="9cff" class="ny nz it lc b ld nt lg nu lj pa ln pb lr pc lv od oe of og bi translated">从我们的分析来看，很明显，南非长相思的评分<strong class="lc iu"> <em class="mm"> 2.1198 分</em> </strong>优于智利霞多丽</li><li id="cc2d" class="ny nz it lc b ld oh lg oi lj oj ln ok lr ol lv od oe of og bi translated">此外，比较两个模拟组的平均值，我们观察到，对于<strong class="lc iu"> <em class="mm">，70.5% </em> </strong>的时间，南非长相思的评分优于智利霞多丽。</li></ul></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="cc3d" class="nc mu it bd nd ne pd ng nh ni pe nk nl jz pf ka nn kc pg kd np kf ph kg nr ns bi translated">后续步骤</h1><blockquote class="pi pj pk"><p id="7de6" class="la lb mm lc b ld le ju lf lg lh jx li pl lk ll lm pm lo lp lq pn ls lt lu lv im bi translated">这种建模和比较也可以扩展到多个组，估计组内均值、跨组均值、精度等。</p><p id="526d" class="la lb mm lc b ld le ju lf lg lh jx li pl lk ll lm pm lo lp lq pn ls lt lu lv im bi translated">这里使用的数据集非常有趣，可以用于点估计、文本分析和 NLP 的回归建模(因为有很多文本列)以及更多…</p></blockquote><p id="9ff3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu"> <em class="mm">欢呼..！！</em>T19】</strong></p><p id="e3a3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在<a class="ae kz" href="https://github.com/divyanshumarwah/wine-reviews-statistical-modeling-analysis/blob/master/wine-comparison.Rmd" rel="noopener ugc nofollow" target="_blank">https://github . com/divyanshumarwah/wine-reviews-statistical-modeling-analysis/blob/master/wine-comparison 上找到代码。Rmd </a></p><p id="a0f9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在<a class="ae kz" href="https://www.linkedin.com/in/divyanshumarwah/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上与我联系并讨论这些想法。</p><p id="0f5f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在<a class="ae kz" href="https://github.com/divyanshumarwah" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到其他令人兴奋的项目。</p></div></div>    
</body>
</html>