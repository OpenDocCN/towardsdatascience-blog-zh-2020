<html>
<head>
<title>Building a movie content based recommender using tf-idf</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 tf-idf 构建基于电影内容的推荐系统</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/content-based-recommender-systems-28a1dbd858f5?source=collection_archive---------9-----------------------#2020-08-28">https://towardsdatascience.com/content-based-recommender-systems-28a1dbd858f5?source=collection_archive---------9-----------------------#2020-08-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="db5d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><span class="l ki kj kk bm kl km kn ko kp di"/>基于内容的电影推荐方法</h2></div><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/5e9a18a18cc68d63570ee18038ec34be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLuGshGR5imXGYOjjKtw9w.jpeg"/></div></div><p class="lc ld gj gh gi le lf bd b be z dk translated"><a class="ae lg" href="https://unsplash.com/@lysanderyuen?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">吕山德元</a>在<a class="ae lg" href="https://unsplash.com/s/photos/books-prague?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h1 id="2aae" class="lh li it bd lj lk ll lm ln lo lp lq lr jz ls ka lt kc lu kd lv kf lw kg lx ly bi translated">介绍</h1><p id="d840" class="pw-post-body-paragraph lz ma it mb b mc md ju me mf mg jx mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">随着时间的推移，我们越来越依赖在线平台和应用程序，如网飞、亚马逊、Spotify 等。我们发现自己不得不不断地从广泛的选项中进行选择。</p><p id="2e24" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">有人可能会认为，与选择很少相比，选择多是件好事，但选择过多会导致所谓的“决策瘫痪”。正如巴里·施瓦茨在《选择的悖论》中写道:</p><blockquote class="na nb nc"><p id="ba2f" class="lz ma nd mb b mc mv ju me mf mw jx mh ne mx mk ml nf my mo mp ng mz ms mt mu im bi translated">“大量的选择可能会使消费者泄气，因为这迫使他们在做决定时付出更多的努力。所以消费者决定不决定，不买产品。或者，如果他们这样做了，做决定所需要的努力会降低从结果中获得的快乐。”</p></blockquote><p id="dde7" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">这也导致了另一个更微妙的负面影响:</p><blockquote class="na nb nc"><p id="1801" class="lz ma nd mb b mc mv ju me mf mw jx mh ne mx mk ml nf my mo mp ng mz ms mt mu im bi translated">“大量的选项可能会降低人们实际选择的吸引力，原因是考虑一些未选择的选项的吸引力会降低从选择的选项中获得的快乐。”</p></blockquote><p id="dc10" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">一个显而易见的结果是，除非对我们来说变得更容易，否则我们最终不会在多种选择中做任何努力；换句话说，除非这些是根据我们的喜好过滤掉的。</p><p id="0700" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">这就是为什么推荐系统已经成为上述平台中的关键组件，在这些平台中，用户有无数的选择。他们的成功将在很大程度上取决于他们缩小选择范围的能力，让我们更容易做出选择。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><p id="7846" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">该领域的一个主要推动力是网飞，它通过研究不断推进最先进的技术，并在 2006 年至 2009 年间赞助了 Netflix 奖，极大地推动了该领域的研究。</p><p id="66eb" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">此外，网飞的推荐者在平台中有巨大的存在。当我们搜索一部电影时，我们会立即得到一系列我们可能也会喜欢的相似电影:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi no"><img src="../Images/f51ff5c3277d43964561f58fcafe0db1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*weSxzpFQjOZ2gNqcCAQsdw.png"/></div></div><p class="lc ld gj gh gi le lf bd b be z dk translated">网飞-个人账户</p></figure><h2 id="fb1c" class="np li it bd lj nq nr dn ln ns nt dp lr mi nu nv lt mm nw nx lv mq ny nz lx oa bi translated">概述</h2><p id="cdef" class="pw-post-body-paragraph lz ma it mb b mc md ju me mf mg jx mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">这篇文章从揭示推荐系统中的不同范例开始，并通过一个基于内容的推荐系统的实践方法。我将使用众所周知的<a class="ae lg" href="https://grouplens.org/datasets/movielens/" rel="noopener ugc nofollow" target="_blank"> MovieLens 数据集</a>，并展示我们如何根据它们的特点推荐新电影。</p><p id="9d98" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">这是关于推荐系统的两篇系列文章(可能更多)中的第一篇，下一篇将是关于<strong class="mb iu">协同过滤</strong>。</p><p id="bac4" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated"><strong class="mb iu">在这里</strong>  <strong class="mb iu">找到这篇帖子的 jupyter 笔记本版，里面有所有代码</strong> <a class="ae lg" href="https://github.com/AlexanderNixon/Machine-learning-reads/blob/master/Movie-content-based-recommender-using-tf-idf.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="mb iu">。</strong></a></p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="9e33" class="lh li it bd lj lk ob lm ln lo oc lq lr jz od ka lt kc oe kd lv kf of kg lx ly bi translated">推荐系统的类型</h1><p id="46c9" class="pw-post-body-paragraph lz ma it mb b mc md ju me mf mg jx mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">大多数推荐系统利用协同过滤和基于内容的过滤中的一种或两种。尽管当前的推荐系统通常将几种方法组合成一个混合系统。以下是这些方法的概述:</p><ul class=""><li id="9181" class="og oh it mb b mc mv mf mw mi oi mm oj mq ok mu ol om on oo bi translated"><strong class="mb iu">协同过滤</strong>:这些方法背后的主要思想是利用其他用户的偏好和<em class="nd">品味</em>向用户推荐新的项目。通常的程序是找到相似的用户(或项目)来推荐那些用户喜欢的新项目，并且被推荐的用户可能也会喜欢。</li><li id="5be0" class="og oh it mb b mc op mf oq mi or mm os mq ot mu ol om on oo bi translated"><strong class="mb iu">基于内容:</strong>基于内容的推荐器将使用关于项目的专有数据。为此，我们需要对用户的偏好有一个最低限度的了解，这样我们就可以推荐与用户指定(或推断)的标签/关键词相似的新项目。</li><li id="5bee" class="og oh it mb b mc op mf oq mi or mm os mq ot mu ol om on oo bi translated"><strong class="mb iu">混合方法:</strong>，顾名思义，包括结合协同过滤、基于内容和其他可能方法的技术。现在大多数推荐系统是混合的，如因式分解机的情况。</li></ul><h1 id="e4a0" class="lh li it bd lj lk ll lm ln lo lp lq lr jz ls ka lt kc lu kd lv kf lw kg lx ly bi translated">电影镜头数据集</h1><p id="ff9c" class="pw-post-body-paragraph lz ma it mb b mc md ju me mf mg jx mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">测试推荐系统最常用的数据集之一是<a class="ae lg" href="https://grouplens.org/datasets/movielens/" rel="noopener ugc nofollow" target="_blank">movie lens 数据集</a>，它包含来自<a class="ae lg" href="http://movielens.org" rel="noopener ugc nofollow" target="_blank"> MovieLens 网站</a>的评级数据集。对于这篇博客，我将使用一个数据集，其中包含 6000 名 MovieLens 用户制作的大约 4000 部电影的 100 万匿名评级，这些电影于 2003 年 2 月上映。</p><p id="e7ec" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">让我们看一下这个数据集中包含的数据。我们有三个。csv 文件:<strong class="mb iu">收视率</strong>、<strong class="mb iu">用户</strong>、<strong class="mb iu">电影</strong>。这些文件将作为熊猫数据帧加载。我们有一个评级文件，看起来像:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="4956" class="np li it ov b gy oz pa l pb pc">ratings.sample(5)<br/>        user_id  movie_id  rating<br/>376907     2201      2115       5<br/>254402     1546      2329       5<br/>520079     3208      3300       3<br/>534583     3300      2248       5<br/>325635     1926      1207       4</span></pre><p id="50e1" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated"><code class="fe pd pe pf ov b">movies</code>数据集如下:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="4e0a" class="np li it ov b gy oz pa l pb pc">movies.sample(5)<br/>      movie_id                           title          genres<br/>948        960     Angel on My Shoulder (1946)     Crime|Drama<br/>645        651           Superweib, Das (1996)          Comedy<br/>3638      3707           Nine 1/2 Weeks (1986)           Drama<br/>511        515  Remains of the Day, The (1993)           Drama<br/>2144      2213      Waltzes from Vienna (1933)  Comedy|Musical</span></pre><p id="c925" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">既有一个<code class="fe pd pe pf ov b">movie_id</code>、<code class="fe pd pe pf ov b">title</code>又有一个字符串，所有的<code class="fe pd pe pf ov b">genres</code>都由字符<code class="fe pd pe pf ov b">|</code>分隔。</p><p id="4bb8" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">和用户数据集，包含用户的基本信息:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="1113" class="np li it ov b gy oz pa l pb pc">users.head()<br/>   user_id gender zipcode  age_desc              occ_desc<br/>0        1      F   48067  Under 18          K-12 student<br/>1        2      M   70072       56+         self-employed<br/>2        3      M   55117     25-34             scientist<br/>3        4      M   02460     45-49  executive/managerial<br/>4        5      M   55455     25-34                writer</span></pre><h2 id="5364" class="np li it bd lj nq nr dn ln ns nt dp lr mi nu nv lt mm nw nx lv mq ny nz lx oa bi translated">电影类型</h2><p id="bb41" class="pw-post-body-paragraph lz ma it mb b mc md ju me mf mg jx mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">正如我们将在下一节中探讨的，类型本身可以用来提供一个相当好的基于内容的推荐。但在此之前，我们需要分析一些重要的方面。</p><ul class=""><li id="4b9c" class="og oh it mb b mc mv mf mw mi oi mm oj mq ok mu ol om on oo bi translated"><em class="nd">最受欢迎的流派有哪些？</em></li></ul><p id="7ab7" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">这将是在构建基于内容的推荐器时要考虑的相关方面。我们想了解在定义用户的<em class="nd">品味时，哪些类型是真正相关的。</em>一个合理的假设是，恰恰是那些不受欢迎的类型更符合用户的口味。</p><p id="587d" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">最相关的类型有:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="e1bc" class="np li it ov b gy oz pa l pb pc">genre_popularity = (movies.genres.str.split('|')<br/>                      .explode()<br/>                      .value_counts()<br/>                      .sort_values(ascending=False))<br/>genre_popularity.head(10)</span><span id="7910" class="np li it ov b gy pg pa l pb pc">Drama         1603<br/>Comedy        1200<br/>Action         503<br/>Thriller       492<br/>Romance        471<br/>Horror         343<br/>Adventure      283<br/>Sci-Fi         276<br/>Children's     251<br/>Crime          211<br/>Name: genres, dtype: int64</span></pre><p id="52ef" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">或者，为了更直观地展示，我们可以绘制一个带有流派的词云:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="eddb" class="np li it ov b gy oz pa l pb pc">genre_wc = WordCloud(width=1000,height=400,background_color='white')<br/>genre_wc.generate_from_frequencies(genre_popularity.to_dict())</span><span id="226a" class="np li it ov b gy pg pa l pb pc">plt.figure(figsize=(16, 8))<br/>plt.imshow(genre_wc, interpolation="bilinear")<br/>plt.axis('off')</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ph"><img src="../Images/7f503a4bcd6c84b855602d7f04d00f16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BR0T-11ok3ubgbLUL2qlNQ.png"/></div></div><p class="lc ld gj gh gi le lf bd b be z dk translated">生成体裁词云</p></figure><p id="9df1" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">如你所见，最常见的类型是戏剧、喜剧和动作片。然后，我们有一些不太常见的其他类型，如西部片、奇幻片或科幻片。正如我之前指出的，后者是我们在推荐时想要给予最大重视的。但是，这是为什么呢？</p><p id="70f6" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">作为一个例子，让我们考虑一个用户想要找到一部类似于“<strong class="mb iu"> <em class="nd">【善、恶、丑</em> </strong>”的电影，它是西部片、动作片和冒险片的混合体。你认为哪种类型更适合向用户推荐电影？大概是西方的，因为将会有许多非西方的动作或冒险电影，这可能会导致推荐许多非西方电影。</p><h1 id="af89" class="lh li it bd lj lk ll lm ln lo lp lq lr jz ls ka lt kc lu kd lv kf lw kg lx ly bi translated">构建基于内容的推荐器</h1><p id="7b0b" class="pw-post-body-paragraph lz ma it mb b mc md ju me mf mg jx mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">在这篇文章中，我们将基于<strong class="mb iu">电影类型建立一个非常简单的推荐器。</strong>解决这个问题的一个相当常见的方法是使用一个<a class="ae lg" href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf" rel="noopener ugc nofollow" target="_blank"> <strong class="mb iu"> tf-idf </strong> </a>矢量器。</p><p id="188d" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">虽然这种方法更常用于文本语料库，但是它拥有一些有趣的属性，这些属性对于获得数据的<a class="ae lg" href="https://en.wikipedia.org/wiki/Vector_space" rel="noopener ugc nofollow" target="_blank"> <strong class="mb iu">向量表示</strong> </a>是有用的。该表达式定义如下:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/b49b8968fe9152399b2d70f33c83c238.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*-m-26ZOPBQmOQvuffnnoeg.png"/></div></figure><p id="fc97" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">这里我们有术语频率的乘积，即给定术语(类型)在文档(电影的类型)中出现的次数乘以右侧术语，这基本上根据给定术语在所有文档(电影)中出现的次数来衡量术语频率。</p><p id="ce84" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">包含给定流派(<em class="nd"> df_i) </em>的电影越少，得到的权重越高。对数基本上是为了平滑除法的结果，即避免由于右手项而导致的巨大差异。</p><p id="a864" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">那么，为什么这对我们有用呢？</p><p id="0dac" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">正如已经提到的，tf-idf 将通过给予不太频繁的类型更高的权重来帮助捕捉每部电影的重要类型，这是我们用<code class="fe pd pe pf ov b">CountVectorizer</code>无法获得的。</p><h2 id="596b" class="np li it bd lj nq nr dn ln ns nt dp lr mi nu nv lt mm nw nx lv mq ny nz lx oa bi translated">tf-idf</h2><p id="b6e3" class="pw-post-body-paragraph lz ma it mb b mc md ju me mf mg jx mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">为了获得 tf-idf 向量，我将使用 sklearn 的<code class="fe pd pe pf ov b">TfidfVectorizer</code>。然而，我们必须考虑这个问题的一些特殊方面。在处理文本数据时，通常的设置是设置一个<code class="fe pd pe pf ov b">word</code>分析器和一个<code class="fe pd pe pf ov b">ngram_range</code>，它也将包括指定范围内的 n 元语法。一个例子是:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="084a" class="np li it ov b gy oz pa l pb pc">from sklearn.feature_extraction.text import TfidfVectorizer</span><span id="53f0" class="np li it ov b gy pg pa l pb pc">s = "Animation Children's Comedy"<br/>tf_wrong = TfidfVectorizer(analyzer='word', ngram_range=(1,2))<br/>tf_wrong.fit([s])<br/>tf_wrong.get_feature_names()<br/># ['animation', 'animation children', 'children', 'children comedy', 'comedy']</span></pre><p id="c964" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">然而，在这种情况下，这实际上没有意义，因为类型的顺序是不相关的，我们想要考虑给定电影的类型的<strong class="mb iu">组合</strong>，而不考虑顺序。对于上面的例子，我们想要:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="8c11" class="np li it ov b gy oz pa l pb pc">from itertools import combinations<br/>[c for i in range(1,4) for c in combinations(s.split(), r=i)]<br/><br/>[('Animation',),  ("Children's",),  ('Comedy',),  ('Animation', "Children's"),  ('Animation', 'Comedy'),  ("Children's", 'Comedy'),  ('Animation', "Children's", 'Comedy')]</span></pre><p id="37dc" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">在这里，我们找到了直到<code class="fe pd pe pf ov b">k</code>(这里是 4)的流派组合集，或者用数学术语来说，就是<a class="ae lg" href="https://en.wikipedia.org/wiki/Subset" rel="noopener ugc nofollow" target="_blank">超集</a>。包括类型的<code class="fe pd pe pf ov b">n&gt;1</code>组合，将意味着 tf-idf 矢量器也将考虑这些组合在所有电影中出现的频率，给出现最少的那些分配较高的分数。</p><p id="cebc" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">我们可以使用<code class="fe pd pe pf ov b">analyser</code>参数应用上面的逻辑，我们可以使用这个参数从原始输入中获得特征序列，使用一个可调用的:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="2ddd" class="np li it ov b gy oz pa l pb pc">tf = TfidfVectorizer(analyzer=lambda s: (c for i in range(1,4)<br/>                     for c in combinations(s.split('|'), r=i)))<br/>tfidf_matrix = tf.fit_transform(movies['genres'])<br/>tfidf_matrix.shape<br/># (3883, 353)</span></pre><p id="3120" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">这将产生以下 tf-idf 向量(注意，只对列和行的子集进行采样):</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="c6d6" class="np li it ov b gy oz pa l pb pc">pd.DataFrame(tfidf_matrix.todense(), columns=tf.get_feature_names(),   index=movies.title).sample(5, axis=1).sample(10, axis=0)</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pj"><img src="../Images/518b69ec59a84cc89c63a60aa4045c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UMOi5BWXE9dDZQB_aciqzg.png"/></div></div></figure><h2 id="6be2" class="np li it bd lj nq nr dn ln ns nt dp lr mi nu nv lt mm nw nx lv mq ny nz lx oa bi translated">向量间的相似性</h2><p id="1a1c" class="pw-post-body-paragraph lz ma it mb b mc md ju me mf mg jx mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">下一步将寻找类似的 tf-idf 向量(电影)。回想一下，我们已经<em class="nd">将</em>每部电影的类型编码到一个 tf-idf 表示中，现在我们想要定义一个<em class="nd">接近度度量。</em>一个常用的度量是<a class="ae lg" href="https://en.wikipedia.org/wiki/Cosine_similarity" rel="noopener ugc nofollow" target="_blank">余弦相似度</a>。</p><p id="fea3" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">这种相似性度量因其等于被比较的两个向量之间角度的余弦值而得名。两个向量之间的角度越小，余弦值就越高，从而产生更高的相似性因子。它表示如下:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/11807a61e585fd4f84a3594aec740d0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*HpvXsETzWO8eaIwk9-MXtQ.png"/></div><p class="lc ld gj gh gi le lf bd b be z dk translated">图片<a class="ae lg" href="https://en.wikipedia.org/wiki/Cosine_similarity" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="4b6d" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">其中，由于内积可以表示为幅度乘以两个向量之间角度的余弦的乘积，因此很明显，上述内容可以表示为余弦:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/a1e79c738af3c1e86dbe3f87dc915920.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*jJws4PLl5JsiQKILONDncw.png"/></div><p class="lc ld gj gh gi le lf bd b be z dk translated">图像<a class="ae lg" href="https://en.wikipedia.org/wiki/Cosine_similarity" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="c5ca" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">因此，通过取两个向量之间的内积，并根据它们各自的幅度进行归一化，得到两个向量之间的<em class="nd">余弦</em> <strong class="mb iu"> </strong>。</p><p id="08cb" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">为了计算所有 tf-idf 向量之间的余弦相似性，我们可以再次使用 scikit-learn。<code class="fe pd pe pf ov b"><a class="ae lg" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise_distances.html" rel="noopener ugc nofollow" target="_blank">sklearn.metrics.pairwise</a></code>包含许多成对的距离度量，其中有<code class="fe pd pe pf ov b"><a class="ae lg" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise.cosine_similarity.html" rel="noopener ugc nofollow" target="_blank">cosine_similarity</a></code> <a class="ae lg" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise.cosine_similarity.html" rel="noopener ugc nofollow" target="_blank"> </a>，它将计算所有输入行之间的余弦相似性，在本例中为 tf-idf 向量:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="a1b4" class="np li it ov b gy oz pa l pb pc">from sklearn.metrics.pairwise import cosine_similarity<br/>cosine_sim = cosine_similarity(tfidf_matrix)</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pm"><img src="../Images/23f3d15bc2098c84af96b992be7fc149.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6tZxgm4X5Myv25Dl6sggjg.png"/></div></div></figure><p id="9064" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">现在我们必须定义一些逻辑来找到给定电影的最高权重或 tf-idf 分数。为此，我定义了以下函数，该函数将一部给定的电影<code class="fe pd pe pf ov b">i</code>、相似度矩阵<code class="fe pd pe pf ov b">M</code>、项目数据帧作为输入，并返回多达<code class="fe pd pe pf ov b">k</code>的推荐:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="pn po l"/></div></figure><p id="1de3" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">通过使用<code class="fe pd pe pf ov b">argpartition</code>，我们在给定的索引(电影)<code class="fe pd pe pf ov b">i</code>上取<code class="fe pd pe pf ov b">M</code>(相似矩阵)中的<code class="fe pd pe pf ov b">k</code>最高值。然后，我们对<code class="fe pd pe pf ov b">M</code>中的列进行索引，并进一步从最高权重到最低权重进行切片(排除最高权重，这将是同一项，因为矩阵是对称的，因此第二行中有<code class="fe pd pe pf ov b">2s</code>)。</p><h2 id="8f80" class="np li it bd lj nq nr dn ln ns nt dp lr mi nu nv lt mm nw nx lv mq ny nz lx oa bi translated">测试推荐器</h2><p id="3382" class="pw-post-body-paragraph lz ma it mb b mc md ju me mf mg jx mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">我们用几个例子来测试一下推荐器。由于<code class="fe pd pe pf ov b">movies</code>数据集包含了 2000 年以前的电影，我们将不得不使用一些经典电影。</p><p id="eda3" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated"><code class="fe pd pe pf ov b">'2001: A Space Odyssey'</code>怎么样？</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="1f28" class="np li it ov b gy oz pa l pb pc">movies[movies.title.eq('2001: A Space Odyssey (1968)')]<br/>    movie_id                              title              genres<br/>912      924       2001: A Space Odyssey (1968)  Drama|Mystery|Sci-Fi|Thriller</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pp"><img src="../Images/999e2cad3ed2bd3fef5f2b0d36f24373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*XvkwvGs1JB9nMvQpgSlQqg.jpeg"/></div></div><p class="lc ld gj gh gi le lf bd b be z dk translated">2001:太空漫游</p></figure><p id="ab4d" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">我们可以看到它的流派是<code class="fe pd pe pf ov b">Drama|Mystery|Sci-Fi|Thriller</code>。看看有什么推荐吧！:)</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="f020" class="np li it ov b gy oz pa l pb pc">genre_recommendations('2001: A Space Odyssey (1968)', cosine_sim_df, movies[['title', 'genres']])</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/5476359939cfd8e7116a0f5bdd1fc8ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*GyymrN8pe9kCvqDzX--IEA.png"/></div></figure><p id="de43" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">正如所料，最相似的电影是那些分享最多类型的电影。有趣的是，我们看到大部分都是<code class="fe pd pe pf ov b">Sci-Fi</code>电影。请注意，这很可能受到以下事实的影响:在上面出现的流派中，<code class="fe pd pe pf ov b">Sci-Fi</code>通常具有较高的分数，因为它出现的频率最低，因此具有较高的权重。</p><p id="7719" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">让我们看看我最喜欢的科幻电影《T2 》:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="c3fb" class="np li it ov b gy oz pa l pb pc">movies[movies.title.eq(‘Contact (1997)’)]<br/>      movie_id           title        genres<br/>1543      1584  Contact (1997)  Drama|Sci-Fi</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pr"><img src="../Images/ada7ae2f02333d2727b6aeb6f0176f09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kvg-PK5VMoKj0Vh6tUWmYg.jpeg"/></div></div><p class="lc ld gj gh gi le lf bd b be z dk translated">接触</p></figure><p id="ad90" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">在这种情况下，我们会得到:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="30c8" class="np li it ov b gy oz pa l pb pc">genre_recommendations('Contact (1997)', cosine_sim_df, movies[['title', 'genres']])</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/503faf7db3dd03faa61f310d0d78f7d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*L281zVAd9gfCwFoBGfo4tQ.png"/></div></figure><p id="2dca" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">似乎有许多电影分享相同的类型，因此我们得到了所有<code class="fe pd pe pf ov b">Drama|Sci-fi</code>电影的推荐。</p><p id="4541" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">现在让我们来看一部像《T4》这样的动画电影:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="ecfd" class="np li it ov b gy oz pa l pb pc">movies[movies.title.eq('Jungle Book, The (1967)')]<br/>      movie_id                    title                             <br/>2009      2078  Jungle Book, The (1967) <br/>                             genres<br/>Animation|Children's|Comedy|Musical</span></pre><p id="7de2" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">我们得到以下建议:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="c862" class="np li it ov b gy oz pa l pb pc">genre_recommendations('Jungle Book, The (1967)', cosine_sim_df, movies[['title', 'genres']])</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/9e3282789b59b5eb8984a458b1919f70.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*UlbRykXCB_bBzD9AQeSZXw.png"/></div></figure><p id="317b" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">似乎有两部电影分享了完全相同的类型组合，其余的也类似，但没有<code class="fe pd pe pf ov b">Comedy</code>类型。</p><p id="8290" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">或者让我们试试最后一个，<code class="fe pd pe pf ov b">'Saving private Ryan'</code>:</p><pre class="kr ks kt ku gt ou ov ow ox aw oy bi"><span id="8785" class="np li it ov b gy oz pa l pb pc">print(movies[movies.title.eq('Saving Private Ryan (1998)')])<br/>      movie_id                       title            genres<br/>1959      2028  Saving Private Ryan (1998)  Action|Drama|War</span><span id="0975" class="np li it ov b gy pg pa l pb pc">genre_recommendations('Saving Private Ryan (1998)', cosine_sim_df, movies)</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/2892fd65c9f94c58ca2f41674c723ff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*sTW3kcOb6Gl5V5F7IN6C0Q.png"/></div></figure></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="e485" class="lh li it bd lj lk ob lm ln lo oc lq lr jz od ka lt kc oe kd lv kf of kg lx ly bi translated">结束的</h1><p id="21c1" class="pw-post-body-paragraph lz ma it mb b mc md ju me mf mg jx mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">总的来说，我们已经看到，一个相当幼稚的基于内容的推荐器可以提供相当好的结果。</p><p id="5476" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">基于内容的推荐器的一个明显优势是，它们不会遭受<a class="ae lg" href="https://en.wikipedia.org/wiki/Cold_start_(recommender_systems)" rel="noopener ugc nofollow" target="_blank"> <strong class="mb iu">冷启动</strong> </a>问题，因为我们只需要关于用户的基本信息(在这种情况下是单部电影)来基于项目提供类似的推荐。另一个有趣的优势是，我们能够向具有<strong class="mb iu">独特品味的用户推荐</strong>，这对于协同过滤方法来说可能更具挑战性。</p><p id="916c" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">然而<strong class="mb iu">的一个重要缺点</strong>是它倾向于向用户推荐相同类型的项目。为了能够推荐不同类型的项目，用户必须已经对新类型的项目进行了评级或者已经表现出了兴趣。这是协同过滤方法没有的问题，因为这里的匹配是在具有相似品味但不同项目评级的相邻用户之间进行的。</p><p id="7e4d" class="pw-post-body-paragraph lz ma it mb b mc mv ju me mf mw jx mh mi mx mk ml mm my mo mp mq mz ms mt mu im bi translated">非常感谢你花时间阅读这篇文章，希望你喜欢:)</p></div></div>    
</body>
</html>