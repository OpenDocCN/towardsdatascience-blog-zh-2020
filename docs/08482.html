<html>
<head>
<title>Spatial Data Science with PostgreSQL/PostGIS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 PostgreSQL/PostGIS 的空间数据科学</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/spatial-data-science-with-postgresql-postgis-2f941c8c367a?source=collection_archive---------13-----------------------#2020-06-20">https://towardsdatascience.com/spatial-data-science-with-postgresql-postgis-2f941c8c367a?source=collection_archive---------13-----------------------#2020-06-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="b08a" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">波斯特吉斯</h2><div class=""/><div class=""><h2 id="67df" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">PostgreSQL 和 Python 空间数据入门实用指南。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/483e3effaf0836e1f1ced030452d62fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Wq0YCrVI3UgdtPqT"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">丹尼斯·库默在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9e07" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">空间性不特别！如果您曾经尝试过在普通 SQL 中使用空间数据，那么处理几何可能并不简单。然而，使用空间 SQL，感觉就像处理表中的另一列。</p><p id="a9d7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本指南中，我们将介绍如何设置和开始使用空间 SQL。我们将安装 g PostgreSQL，激活 PostGIS 扩展并执行一些简单的空间 SQL 操作。在本文的后面，我们将了解如何将空间 SQL 整合到 Python 工作流中。</p><h2 id="3c4d" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">空间 SQL (PostGIS)</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mw"><img src="../Images/a0601f2757d73aac4867c43a7605ce7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C6Hwn1doK9LPtuRsENbNsA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">空间数据科学被邮政地理信息系统托起</p></figure><p id="8a92" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">空间 SQL 处理、利用和执行空间数据的空间操作。空间数据库针对存储、操作和查询具有已定义几何图形的地理数据进行了优化。</p><p id="daa5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">虽然有许多空间数据库提供商，但我通常更喜欢 PostgreSQL/PostGIS。PostGIS 在地理空间数据库领域也得到广泛应用——例如，Big Querry 就采用了它。</p><p id="ee99" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您是数据库领域的新手，您可能会问 PostgreSQL 和 PostGIS 之间的区别。我们可以这样想:PostgreSQL 是数据库 Database，而 PostGIS 是在 Postgresql 之上提供空间功能的扩展。</p><h2 id="ccf6" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">安装 PostgreSQL + PostGIS</h2><p id="53be" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">安装 PostgreSQL 很简单。您需要为您的发行版选择二进制包:Windows、macOS 或 Linux。</p><div class="nc nd gp gr ne nf"><a href="https://www.postgresql.org/download/" rel="noopener  ugc nofollow" target="_blank"><div class="ng ab fo"><div class="nh ab ni cl cj nj"><h2 class="bd jd gy z fp nk fr fs nl fu fw jc bi translated">下载</h2><div class="nm l"><h3 class="bd b gy z fp nk fr fs nl fu fw dk translated">PostgreSQL 对象关系数据库管理系统的核心有几个源代码和二进制…</h3></div><div class="nn l"><p class="bd b dl z fp nk fr fs nl fu fw dk translated">www.postgresql.org</p></div></div><div class="no l"><div class="np l nq nr ns no nt lb nf"/></div></div></a></div><p id="8c9e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦你下载了 EDB 的交互式安装程序，运行。或者按照发行版中给出的说明进行操作。我已经在这里包括(GIF 指令)如何添加 PostGIS 扩展到你的 PostgreSQL。我们还安装了 PgAdmin4 作为 PostgreSQL 的 GUI 界面。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nu"><img src="../Images/67ef52124ef3eb8f6888b73e91d4b70d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*uU1LZCdZaDufSgeRYRIhnw.gif"/></div></div></figure><p id="826d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">确保在遵循交互式安装指南的同时检查 PgAdmin4 和 Stackbuilder。此步骤将允许我们稍后使用 PG Admin 4 用户界面。请务必检查 PostGIS 扩展，它使我们能够执行空间操作。</p><p id="8335" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您想要操作系统的逐步指南，有一个交互式安装程序指南。</p><div class="nc nd gp gr ne nf"><a href="https://www.enterprisedb.com/edb-docs/d/postgresql/installation-getting-started/installation-guide-installers/12/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="ng ab fo"><div class="nh ab ni cl cj nj"><h2 class="bd jd gy z fp nk fr fs nl fu fw jc bi translated">简介— PostgreSQL 安装指南 12.0 文档</h2><div class="nm l"><h3 class="bd b gy z fp nk fr fs nl fu fw dk translated">EnterpriseDB 创建的 PostgreSQL 安装程序旨在使在…上安装 PostgreSQL 变得快速而简单</h3></div><div class="nn l"><p class="bd b dl z fp nk fr fs nl fu fw dk translated">www.enterprisedb.com</p></div></div></div></a></div><h2 id="fe50" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">PgAdmin 4 GUI 界面</h2><p id="932e" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">让我们熟悉一下我们将在本教程中使用的 PgAdmin GUI 界面。下面的 GIF 展示了界面。我们还创建了一个 PostGIS 扩展，它提供了我们稍后将使用的空间功能。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nu"><img src="../Images/66c6a6ad1a98908c1184c07c37fa7076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wNpK75lhgnKNXUNMrHUZqA.gif"/></div></div></figure><p id="0194" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以简单地创建一个 PostGIS 扩展，在 PgAdmin 查询工具中实现以下命令。</p><pre class="ks kt ku kv gt nv nw nx ny aw nz bi"><span id="65c8" class="me mf it nw b gy oa ob l oc od">CREATE EXTENSION postgis;</span></pre><p id="bfbb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">运行该命令后，我们有大量新的空间函数可供使用。</p><p id="bd61" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们也使用 PgAdmin4 创建一个数据库。下面的 GIF 说明向您展示了如何创建一个新的数据库。</p><h2 id="1cb1" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">加载数据</h2><p id="0117" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">加载地理空间数据不同于将 CSV 文件加载到 PostgreSQL 中。我们需要保留几何列。但是，有一种使用 Shapefile Loader 上传空间数据的简单方法。</p><p id="6e41" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下 GIF 指令显示了如何将 shapefiles 加载到 PostgreSQL 数据库中。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nu"><img src="../Images/3bc883a1584f87045c3eabbc2740b183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fsPGypO1lWUmtG5ZCtZvSw.gif"/></div></div></figure><p id="0ae5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上传数据之前，您需要了解数据的坐标参考系统(CRS)是什么。在这种情况下，我已经在 QGIS 的帮助下查看了数据，并且我知道投影代码。但是如果你不确定，你可以输入 4326，这是常用的 WGS 84 码。</p><p id="3b17" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">加载数据后，我们就可以使用 PostGIS 执行空间数据分析了。我也上传一些其他的文件到数据库:街道，边界和伦敦地铁站。我们将把它们作为</p><h2 id="5d45" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">基本空间操作</h2><p id="d578" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">空间 SQL 可以简化地理空间数据的处理和分析，还可以加快特定过程的速度。有数百种空间功能随时可供您使用。</p><p id="141b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们从一些简单的例子开始。在以后的文章中，我将更深入地研究空间 SQL 函数和过程。我已经上传了。</p><p id="ab0b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">例 1:计算建筑物面积</strong></p><pre class="ks kt ku kv gt nv nw nx ny aw nz bi"><span id="e962" class="me mf it nw b gy oa ob l oc od">SELECT objectid, <br/>       shapestare, <br/>       ROUND(ST_Area(geom)::numeric,2) AS AREA<br/>FROM public.buildings</span></pre><p id="e32e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个简单的 SQL 代码返回所有带有新面积列的建筑物，精度为两位小数。总的查询运行时间:659 毫秒。有 176023 行受到影响。</p><p id="d956" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里使用的是<code class="fe oe of og nw b">ST_Area()</code> PostGIS 函数。</p><p id="c549" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">例 2:计算每种街道类型的长度</strong></p><pre class="ks kt ku kv gt nv nw nx ny aw nz bi"><span id="58d5" class="me mf it nw b gy oa ob l oc od">SELECT streettype, Sum(ST_Length(geom)) AS length<br/>FROM public.streets<br/>GROUP BY 1<br/>ORDER BY 2 DESC;</span></pre><p id="2a7a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上述 SQL 代码对每种街道类型进行分组，并计算每种类型的长度。我们在这里使用的是<code class="fe oe of og nw b">ST_Length()</code> PostGIS 函数。</p><h2 id="b1f0" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">用 Python 访问 PostGIS</h2><p id="d19f" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">好的一面是，您可以用 Python 轻松连接您的 PostGIS 数据库。Geopandas 是最常用的地理空间 python 库，可以从 PostGIS 中获取和读取 SQL 语句。以下是如何用 Python 连接数据库和运行空间 SQL 语句的方法。</p><pre class="ks kt ku kv gt nv nw nx ny aw nz bi"><span id="7ae1" class="me mf it nw b gy oa ob l oc od">import geopandas as gpd<br/>import sqlalchemy as db</span><span id="020f" class="me mf it nw b gy oh ob l oc od"># Create a database connection<br/>engine = db.create_engine(‘postgresql+psycopg2://postgres:postgres@localhost:5432/postgis_database’)<br/>con = engine.connect()</span><span id="8b84" class="me mf it nw b gy oh ob l oc od"># Read PostGIS database with Geopandas.<br/>sql = “SELECT * FROM public.streets;”<br/>data = gpd.read_postgis(sql=sql, con=con)</span></pre><p id="cc03" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">将您的 PostGIS 数据库引入 Python，为探索数据和可视化数据提供了其他可能性。让我们使用 Geopandas 和上下文底图来可视化我们所读取的街道数据集。</p><pre class="ks kt ku kv gt nv nw nx ny aw nz bi"><span id="5c19" class="me mf it nw b gy oa ob l oc od">import geopandas as gpd<br/>import matplotlib.pyplot as plt<br/>import contextily as ctx</span><span id="d6f2" class="me mf it nw b gy oh ob l oc od">fig, ax = plt.subplots(figsize=(18, 16))<br/>data.to_crs(epsg=3857).plot(ax = ax,<br/> figsize=(20,18),<br/> color=”gray”,<br/> alpha=0.5,<br/> );<br/>ctx.add_basemap(ax, url=ctx.providers.OpenStreetMap.Mapnik);</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oi"><img src="../Images/fb1c1393ea916a7cc42b9a13df06c05d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bwrez7NXWjxD9T_ibyd_6g.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">街道地图</p></figure><h2 id="a2fe" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">结论</h2><p id="377b" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">在本指南中，我们已经安装了 PostgreSQL 并激活了 PostGIS 扩展。我们已经了解了如何使用 PgAdmin 创建数据库，以及如何将空间数据上传到数据库 database 中。我们还看到了一些简单的空间 SQL 示例，最后，我们将空间数据库数据库集成到 Python 中。</p><p id="f7d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我计划下一篇用空间 SQL 写空间数据处理的文章。敬请关注。</p></div></div>    
</body>
</html>