<html>
<head>
<title>Searching for invalid objects in the SQL Server database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 SQL Server 数据库中搜索无效对象</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/searching-for-invalid-objects-in-the-sql-server-database-a90fab49a66a?source=collection_archive---------43-----------------------#2020-08-11">https://towardsdatascience.com/searching-for-invalid-objects-in-the-sql-server-database-a90fab49a66a?source=collection_archive---------43-----------------------#2020-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="56da" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">本文旨在解决在 SQL Server 数据库中查找和修复无效对象的问题。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/b6db22f8d3a2ee4c4a6ae36ff521ef00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B907zYW2VEkJ9odDPU5o0A.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图片来自<a class="ae kz" href="https://www.piqsels.com/en/public-domain-photo-zkkgn" rel="noopener ugc nofollow" target="_blank"> Piqsels </a> (CC0)</p></figure><p id="f81e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">本文讨论数据库开发人员和管理员工作中的一个瓶颈，即无效对象的出现以及在 SQL Server 数据库中找到它们的方法。</p><p id="7d27" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在之前的文章中，我们涵盖了从创意到实现招聘服务数据库的所有过程:</p><ul class=""><li id="bfab" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/sql-database-design-basics-with-example-8dcce4b0c687">审查了数据库基本设计规则</a></li><li id="d2da" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/populating-the-employee-database-with-test-data-aa76419eebb6">发现如何用测试数据填充数据库，以提供增长和性能预测</a></li><li id="f119" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/exporting-and-importing-json-data-fc1753808349">已检查数据的导出和导入</a></li><li id="1942" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/searching-for-database-objects-and-table-data-in-sql-server-f42f7e3e76a1">查看创建的数据库导航，包括在数据库中搜索对象和数据</a></li></ul><h1 id="4d0e" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">如何使用 SQL Complete 查找无效对象</h1><p id="7c0c" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">让我们在<a class="ae kz" href="https://www.devart.com/dbforge/sql/sqlcomplete/" rel="noopener ugc nofollow" target="_blank"> SQL Complete </a>工具的帮助下查看无效对象的搜索。假设我们用雇员的地址定义了一个新表，并将其命名为 Address:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="905e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">员工可能有不同的地址。同时，几个雇员可以有相同的地址。因此，这些实体之间的关系是多对多的:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nj"><img src="../Images/ef9c128a1224009ff466ad50467a4cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DR7aogbUt9b2FqEJdZV4Gw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">Img.1 .雇员和地址之间的关系</p></figure><p id="c45f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们不考虑每个雇员只有一个指定地址的居住登记情况。我们对所有地址都感兴趣，包括那些指定员工倾向于在哪里度过时间(他居住和睡觉的地方)的地址。这样的地方可能有几个。</p><p id="5417" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，让我们创建一个 vEmployeeAddress 视图，以如下方式显示雇员的数据和地址:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="d0ac" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">问题是我们忘记了更改 vAddressEmployee 视图，它现在引用了不存在的表。</p><p id="cd32" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">不久之后，一个用户或者如果我们幸运的话，一个测试人员发现了一个问题，每当调用 vAddressEmployee 视图时，系统的一部分功能就会崩溃。</p><p id="a360" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了避免这种情况，每次将更改引入数据库时，我们都需要检查是否存在无效对象。</p><p id="0b35" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为此，选择您需要的数据库，在<a class="ae kz" href="https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"> SSMS </a>的菜单栏中，选择 SQL Complete\Find Invalid Objects 命令:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nk"><img src="../Images/c8ee19b87c749f519c37588adcb11633.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*zBCAzOg0wGvA3kqDxY9_sA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">Img.2 .在 SQL Complete 中选择“查找无效对象”命令</p></figure><p id="2fe7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在出现的窗口中，单击窗口左上角或中间的“分析”按钮:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nl"><img src="../Images/2269841e0bcd9aa59b1ed08cf7655510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sidYRfrhP6wbQd-L0cbtDQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">Img.3 .运行无效对象的搜索</p></figure><p id="098b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">请注意，您可以在“数据库”面板上一次选择多个数据库:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/2a8896f18e1538bf32bf5df9ba1faa05.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*bxqv5mobTKc_u3O5aMptLA.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">Img.4 .选择多个数据库</p></figure><p id="e8c0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">对无效对象的搜索完成后，我们可以看到显示 vAddressEmployee 视图的结果，该视图引用了不存在的表 AddressEmployee 和 Address:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nn"><img src="../Images/35116b74440b3d3d610e56ba89462920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*taACK79oLYUpikMYkRma-Q.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">Img.5 .搜索无效对象的结果</p></figure><p id="68a8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">考虑到地址在雇员表中，重写 vAddressEmpoyee 视图就足够了，如下所示:</p><pre class="kk kl km kn gt no np nq nr aw ns bi"><span id="0ed3" class="nt ml it np b gy nu nv l nw nx">ALTER VIEW [dbo].[vAddressEmpoyee] AS<br/>SELECT emp.[EmployeeID]<br/>      ,emp.[FirstName]<br/>      ,emp.[LastName]<br/>	  ,emp.[EmployeeID] AS [AddressID]<br/>	  ,emp.[Address]<br/>  FROM [JobEmpl].[dbo].[Employee]		 AS emp<br/>GO</span></pre><p id="2c76" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">完成后，当您第二次搜索无效对象时，将找不到它们:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ny"><img src="../Images/ce5d486c13317aef7db3d9afe7214c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JENUQxS-q9v_Mi575B8x7Q.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">Img.6 .未找到任何无效对象</p></figure><p id="a153" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">请注意，AddressID 列根本不应该显示在 vAddressEmployee 视图中。但是，如果系统使用它，我们需要以两种方式确定变化的过程:</p><ol class=""><li id="9a71" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv nz mc md me bi translated">如果该字段仅用于提供信息，而不用于搜索相同的地址，是否可以用 EmployeeID 中的值替换 AddressID。</li><li id="be7b" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv nz mc md me bi translated">是否可以完全不显示 AddressID。</li></ol><p id="0c0e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果执行第一点失败，我们将不得不在应用程序的逻辑中引入变化，同时执行第二点。</p><p id="3989" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然而，如果第一点是可行的，这将是一个快速解决问题的方法，您可以稍后通过一个修补程序或下一个更新来执行第二点。</p><p id="4cb6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">简而言之，我们已经考虑了找到无效对象并修复它们的重要性。</p><h1 id="0637" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">结论</h1><p id="d47e" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">总之，我们研究了为招聘服务创建数据库的整个过程，从想法开始，到在生产中实现，并对模式进行进一步的修改。</p><p id="eae0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">给定的数据库允许我们执行快速搜索，并根据以下指标汇总数据:</p><ol class=""><li id="3905" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv nz mc md me bi translated">用人公司。</li><li id="199b" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv nz mc md me bi translated">位置。</li><li id="2606" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv nz mc md me bi translated">项目。</li><li id="b49f" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv nz mc md me bi translated">技能。</li></ol><p id="2e23" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">值得一提的是，这个模式为 IWU 团队的创业提供了基础。</p></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><p id="74fa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="oh">原载于 2020 年 8 月 11 日</em><a class="ae kz" href="https://blog.devart.com/searching-for-invalid-objects-with-sql-complete.html" rel="noopener ugc nofollow" target="_blank"><em class="oh">【https://blog.devart.com】</em></a><em class="oh">。</em></p></div></div>    
</body>
</html>