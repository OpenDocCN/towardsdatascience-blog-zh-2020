<html>
<head>
<title>When to use Pandas transform() function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">何时使用 Pandas transform()函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/when-to-use-pandas-transform-function-df8861aa0dcf?source=collection_archive---------6-----------------------#2020-09-14">https://towardsdatascience.com/when-to-use-pandas-transform-function-df8861aa0dcf?source=collection_archive---------6-----------------------#2020-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="240e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一些最有用的熊猫把戏</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/43f3e03c40c16ff305b0575c0d281fa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2MedX7C_HLrfM6C6Mu4dag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@billow926?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">巨浪 926 </a>在<a class="ae ky" href="https://unsplash.com/s/photos/programming-pandas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="a80c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas 是一个令人惊叹的库，它包含大量用于操作数据的内置函数。其中，<code class="fe lv lw lx ly b">transform()</code>在你想要操作行或列的时候非常有用。</p><p id="622e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将介绍以下最常用的熊猫<code class="fe lv lw lx ly b">transform()</code>功能:</p><ol class=""><li id="2dac" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated">转变价值观</li><li id="7ea2" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">结合<code class="fe lv lw lx ly b">groupby()</code>的成果</li><li id="5073" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">过滤数据</li><li id="0146" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">在集团层面处理缺失值</li></ol><p id="64af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请查看我的<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/master/data-analysis/013-pandas-transform/pandas-transform.ipynb" rel="noopener ugc nofollow" target="_blank"> Github repo </a>获取源代码</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="7677" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">1.转变价值观</h1><p id="fdd8" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我们来看看<code class="fe lv lw lx ly b">pd.transform(<strong class="lb iu">func</strong>, <strong class="lb iu">axis=0</strong>)</code></p><ul class=""><li id="a37a" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu nr mf mg mh bi translated">第一个参数<code class="fe lv lw lx ly b"><em class="ns">func</em></code>是指定用于操作数据的函数。它可以是函数、字符串函数名、函数列表或轴标签字典- &gt;函数</li><li id="c998" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu nr mf mg mh bi translated">第二个参数<strong class="lb iu"> <em class="ns">轴</em> </strong>是指定<code class="fe lv lw lx ly b"><em class="ns">func</em></code>应用于哪个轴。<code class="fe lv lw lx ly b">0</code>用于将<code class="fe lv lw lx ly b"><em class="ns">func</em></code>应用于每一列，而<code class="fe lv lw lx ly b">1</code>用于将<code class="fe lv lw lx ly b"><em class="ns">func</em></code>应用于每一行。</li></ul><p id="9bb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们借助一些例子来看看<code class="fe lv lw lx ly b">transform()</code>是如何工作的。</p><h2 id="c622" class="nt mv it bd mw nu nv dn na nw nx dp ne li ny nz ng lm oa ob ni lq oc od nk oe bi translated">一项功能</h2><p id="f724" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我们可以传递一个函数给<code class="fe lv lw lx ly b">func</code>。例如</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="36a7" class="nt mv it ly b gy oj ok l ol om">df = pd.DataFrame({'A': [1,2,3], 'B': [10,20,30] })</span><span id="ed2c" class="nt mv it ly b gy on ok l ol om"><strong class="ly iu">def plus_10(x):<br/>    return x+10</strong></span><span id="97e6" class="nt mv it ly b gy on ok l ol om">df.transform(<strong class="ly iu">plus_10</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/ffe40de3fa53da54c24bb4481c5168a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:360/format:webp/1*TeP8-qM7MGbhnN0jrBbR_A.png"/></div></figure><p id="f0e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以使用 lambda 表达式。下面是<code class="fe lv lw lx ly b">plus_10()</code> <strong class="lb iu"> : </strong>的λ当量</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="6656" class="nt mv it ly b gy oj ok l ol om">df.transform(<strong class="ly iu">lambda x: x+10</strong>)</span></pre><h2 id="a28f" class="nt mv it bd mw nu nv dn na nw nx dp ne li ny nz ng lm oa ob ni lq oc od nk oe bi translated">字符串函数</h2><p id="087d" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我们可以将任何有效的熊猫字符串函数传递给<code class="fe lv lw lx ly b">func</code>，例如<code class="fe lv lw lx ly b">'sqrt'</code>:</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="41f6" class="nt mv it ly b gy oj ok l ol om">df.transform(<strong class="ly iu">'sqrt'</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6705e0e427bf9f6632a82f6756068f36.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*EM23cR-Z17Gmige0rb5aZw.png"/></div></figure><h2 id="8094" class="nt mv it bd mw nu nv dn na nw nx dp ne li ny nz ng lm oa ob ni lq oc od nk oe bi translated">函数列表</h2><p id="5984" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated"><code class="fe lv lw lx ly b"><em class="ns">func</em></code>可以是功能列表。例如<strong class="lb iu">编号</strong>中的<code class="fe lv lw lx ly b">sqrt</code>和<code class="fe lv lw lx ly b">exp</code>:</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="4942" class="nt mv it ly b gy oj ok l ol om">df.transform(<strong class="ly iu">[np.sqrt, np.exp]</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/6d46470b37f1008ed5dc6df9af8d583e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*l-wGXzlmxM0Ym8F4JCyenA.png"/></div></figure><h2 id="32ea" class="nt mv it bd mw nu nv dn na nw nx dp ne li ny nz ng lm oa ob ni lq oc od nk oe bi translated">轴标签的字典-&gt;函数</h2><p id="82ef" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated"><code class="fe lv lw lx ly b"><em class="ns">func</em></code>可以是轴标签的字典- &gt;功能。例如</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="f8aa" class="nt mv it ly b gy oj ok l ol om">df.transform(<strong class="ly iu">{<br/>    'A': np.sqrt,<br/>    'B': np.exp,<br/>}</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/850ef49bcc362f6277032b39257b33b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*23G2jvvqlIDCVtz_Onr04A.png"/></div></figure><h1 id="9b17" class="mu mv it bd mw mx os mz na nb ot nd ne jz ou ka ng kc ov kd ni kf ow kg nk nl bi translated">2.组合<code class="fe lv lw lx ly b">groupby()</code>结果</h1><p id="ae79" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">熊猫<code class="fe lv lw lx ly b">transform()</code>最引人注目的用途之一是结合<code class="fe lv lw lx ly b">grouby()</code>的结果。</p><p id="3613" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们借助一个例子来看看这是如何工作的。假设我们有一个关于连锁餐厅的数据集</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="5a2d" class="nt mv it ly b gy oj ok l ol om">df = pd.DataFrame({<br/>  'restaurant_id': [101,102,103,104,105,106,107],<br/>  'address': ['A','B','C','D', 'E', 'F', 'G'],<br/>  'city': ['London','London','London','Oxford','Oxford', 'Durham', 'Durham'],<br/>  'sales': [10,500,48,12,21,22,14]<br/>})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/d5565bc0f9eef57fc82179c3aa13655a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*nyQ2XSnNWXh6J4M6PoEPYQ.png"/></div></figure><p id="ee11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到每个城市都有多家餐厅有销售。我们想知道“每家餐厅在该城市的销售额占多大比例”。预期的输出是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/8c82a601dee0567ad2f766c656394fca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9CKTn6flSQQQxIGSF6ZCFg.png"/></div></div></figure><p id="5585" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个计算中棘手的部分是，我们需要得到一个<strong class="lb iu"><em class="ns">city _ total _ sales</em></strong>并将其组合回数据中，以便得到百分比。</p><p id="4e77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有两种解决方案:</p><ol class=""><li id="1fd7" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated"><code class="fe lv lw lx ly b">groupby()</code>、<code class="fe lv lw lx ly b">apply()</code>和<code class="fe lv lw lx ly b">merge()</code></li><li id="78ba" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated"><code class="fe lv lw lx ly b">groupby()</code>和<code class="fe lv lw lx ly b">transform()</code></li></ol><h2 id="0344" class="nt mv it bd mw nu nv dn na nw nx dp ne li ny nz ng lm oa ob ni lq oc od nk oe bi translated">解决方案 1: <code class="fe lv lw lx ly b">groupby()</code>、<code class="fe lv lw lx ly b">apply()</code>和<code class="fe lv lw lx ly b">merge()</code></h2><p id="30b4" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">第一个解决方案是用<code class="fe lv lw lx ly b">groupby()</code>分割数据，用<code class="fe lv lw lx ly b">apply()</code>聚集每个组，然后用<code class="fe lv lw lx ly b">merge()</code>将结果合并回原始数据帧</p><p id="06a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第一步:用</strong> <code class="fe lv lw lx ly b"><strong class="lb iu">groupby()</strong></code> <strong class="lb iu">和</strong> <code class="fe lv lw lx ly b"><strong class="lb iu">apply()</strong></code> <strong class="lb iu">计算出<em class="ns">城市 _ 总 _ 销售额</em> </strong></p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="765d" class="nt mv it ly b gy oj ok l ol om">city_sales = df.<strong class="ly iu">groupby('city')</strong>['sales']<br/>             .<strong class="ly iu">apply(sum)</strong>.rename('city_total_sales').reset_index()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/c60b2d036a5d66139d7d16c529355149.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*Rvxm1bZsJ-P4kB8bet6o-w.png"/></div></figure><p id="a2f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">groupby('city')</code>通过对城市列进行分组来拆分数据。对于每个组，函数<code class="fe lv lw lx ly b">sum</code>应用于<strong class="lb iu"> <em class="ns">销售</em> </strong>列，以计算每个组的总和。最后，新列被重命名为<strong class="lb iu"><em class="ns">city _ total _ sales</em></strong>，索引被重置(注意:<code class="fe lv lw lx ly b">reset_inde()</code>需要清除<code class="fe lv lw lx ly b">groupby('city')</code>生成的索引)。</p><p id="0a34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，熊猫还有一个内置的<code class="fe lv lw lx ly b"><a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.sum.html#pandas.Series.sum" rel="noopener ugc nofollow" target="_blank">sum()</a></code>功能，下面是熊猫的<code class="fe lv lw lx ly b">sum()</code>等价物:</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="689e" class="nt mv it ly b gy oj ok l ol om">city_sales = df.groupby('city')['sales']<br/>             <strong class="ly iu">.sum()</strong>.rename('city_total_sales').reset_index()</span></pre><p id="8733" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第二步:使用</strong> <code class="fe lv lw lx ly b"><strong class="lb iu">merge()</strong></code> <strong class="lb iu">函数合并结果</strong></p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="0283" class="nt mv it ly b gy oj ok l ol om">df_new = pd.<strong class="ly iu">merge</strong>(df, <strong class="ly iu">city_sales</strong>, how='left')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/ff21125e8b3d60b4a459b1be8d290cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ECc9R1mvnG8IW3GevCrhAw.png"/></div></div></figure><p id="7341" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于左外连接，使用<code class="fe lv lw lx ly b">merge()</code>和<code class="fe lv lw lx ly b">how='left'</code>将分组结果合并回原始数据帧。</p><p id="ff27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第三步:计算百分比</strong></p><p id="8b5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，可以计算百分比并进行格式化。</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="4da6" class="nt mv it ly b gy oj ok l ol om">df_new['pct'] = <strong class="ly iu">df_new['sales'] / df_new['city_total_sales']</strong><br/>df_new['pct'] = df_new['pct'].apply(<strong class="ly iu">lambda x: format(x, '.2%')</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/9610a2fdd338e4d74fcf4b7658f529e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZRrSPi85wfwmEZvMa8nomQ.png"/></div></div></figure><p id="77dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这当然有助于我们的工作。但是这是一个多步骤的过程，需要额外的代码来获得我们需要的形式的数据。</p><p id="3f81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<code class="fe lv lw lx ly b">transform()</code>函数有效地解决这个问题</p><h2 id="fb5b" class="nt mv it bd mw nu nv dn na nw nx dp ne li ny nz ng lm oa ob ni lq oc od nk oe bi translated">解决方案二:<code class="fe lv lw lx ly b">groupby()</code>和<code class="fe lv lw lx ly b">transform()</code></h2><p id="5d7c" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">这个解决方案改变了游戏规则。一行代码就可以解决应用和合并问题。</p><p id="9707" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第一步:使用</strong> <code class="fe lv lw lx ly b"><strong class="lb iu">groupby()</strong></code> <strong class="lb iu">和</strong> <code class="fe lv lw lx ly b"><strong class="lb iu">transform()</strong></code> <strong class="lb iu">计算<em class="ns">城市 _ 总 _ 销售额</em> </strong></p><p id="08cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行转换后，转换函数会保留与原始数据集相同数量的项目。因此，使用<code class="fe lv lw lx ly b">groupby</code>后跟<code class="fe lv lw lx ly b">transform(sum)</code>的一行步骤返回相同的输出。</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="ddfb" class="nt mv it ly b gy oj ok l ol om">df['city_total_sales'] = df.groupby('city')['sales']<br/>                           .<strong class="ly iu">transform('sum')</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/00472a785fbe33c4952981e0267a9797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*29y-WIQVRPH1dKVZYZ-mOw.png"/></div></div></figure><p id="621c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第二步:计算百分比</strong></p><p id="e70c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，这与求解百分比的方法相同。</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="abdc" class="nt mv it ly b gy oj ok l ol om">df['pct'] = <strong class="ly iu">df['sales'] / df['city_total_sales']</strong><br/>df['pct'] = df['pct'].apply(<strong class="ly iu">lambda x: format(x, '.2%')</strong>)</span></pre><h1 id="6018" class="mu mv it bd mw mx os mz na nb ot nd ne jz ou ka ng kc ov kd ni kf ow kg nk nl bi translated">3.过滤数据</h1><p id="5dc7" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated"><code class="fe lv lw lx ly b">transform()</code>也可以用来过滤数据。这里我们试图获得城市总销售额大于 40 的记录</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="139c" class="nt mv it ly b gy oj ok l ol om">df[df.groupby('city')['sales'].transform('sum') &gt; 40]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/418d0846e55881e7461d8bb33820dace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*hlpqWqT5hW5Rub5TiCKWig.png"/></div></figure><h1 id="7dc9" class="mu mv it bd mw mx os mz na nb ot nd ne jz ou ka ng kc ov kd ni kf ow kg nk nl bi translated">4.在组级别处理缺失值</h1><p id="292f" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">Pandas <code class="fe lv lw lx ly b">transform()</code>的另一个用途是在组级别处理缺失值。让我们通过一个例子来看看这是如何工作的。</p><p id="f918" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个用于演示的数据框架</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="b8ed" class="nt mv it ly b gy oj ok l ol om">df = pd.DataFrame({<br/>    'name': ['A', 'A', 'B', 'B', 'B', 'C', 'C', 'C'],<br/>    'value': [1, np.nan, np.nan, 2, 8, 2, np.nan, 3]<br/>})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/903fba6b4058459c78b6186602b0f0a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*hzmoNhrI_j6vMtQdf3JioA.png"/></div></figure><p id="70e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，数据可以按名称分成三组，每组都有缺失值。<a class="ae ky" rel="noopener" target="_blank" href="/working-with-missing-values-in-pandas-5da45d16e74">替换缺失值的常见解决方案是用均值</a>替换 NaN。</p><p id="82b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来看看各组的平均值。</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="c24b" class="nt mv it ly b gy oj ok l ol om">df.groupby('name')['value'].mean()</span><span id="d4ce" class="nt mv it ly b gy on ok l ol om">name<br/><strong class="ly iu">A    1.0<br/>B    5.0<br/>C    2.5</strong><br/>Name: value, dtype: float64</span></pre><p id="4557" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们可以使用<code class="fe lv lw lx ly b">transform()</code>用组平均值替换缺失值。</p><pre class="kj kk kl km gt of ly og oh aw oi bi"><span id="ff6e" class="nt mv it ly b gy oj ok l ol om">df['value'] = df.groupby('name')<br/>                .<strong class="ly iu">transform(lambda x: x.fillna(x.mean()))</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/78907d2ae474458adc1351b481b2d342.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*ka0wnGHWL8efePjfygpwVg.png"/></div></figure><h1 id="9d60" class="mu mv it bd mw mx os mz na nb ot nd ne jz ou ka ng kc ov kd ni kf ow kg nk nl bi translated">好了</h1><p id="6c04" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">感谢阅读。</p><p id="7131" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请在我的 Github 上查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/master/data-analysis/013-pandas-transform/pandas-transform.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本的源代码。</a></p><p id="3fba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你对机器学习的实用方面感兴趣，请继续关注。</p><h2 id="59f9" class="nt mv it bd mw nu nv dn na nw nx dp ne li ny nz ng lm oa ob ni lq oc od nk oe bi translated">你可能会对我的其他一些熊猫文章感兴趣:</h2><ul class=""><li id="f93b" class="lz ma it lb b lc nm lf nn li pf lm pg lq ph lu nr mf mg mh bi translated"><a class="ae ky" href="https://medium.com/@bindiatwork/difference-between-apply-and-transform-in-pandas-242e5cf32705" rel="noopener">熊猫的应用()和变换()的区别</a></li><li id="9181" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu nr mf mg mh bi translated"><a class="ae ky" href="https://medium.com/@bindiatwork/using-pandas-method-chaining-to-improve-code-readability-d8517c5626ac" rel="noopener">使用熊猫方法链接提高代码可读性</a></li><li id="2d76" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu nr mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/working-with-datetime-in-pandas-dataframe-663f7af6c587">在熊猫数据帧中处理日期时间</a></li><li id="ebe8" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu nr mf mg mh bi translated"><a class="ae ky" href="https://medium.com/@bindiatwork/all-the-pandas-read-csv-you-should-know-to-speed-up-your-data-analysis-1e16fe1039f3" rel="noopener">熊猫阅读 _csv()你应该知道的招数</a></li><li id="6728" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu nr mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/4-tricks-you-should-know-to-parse-date-columns-with-pandas-read-csv-27355bb2ad0e">用 Pandas read_csv() </a>解析日期列应该知道的 4 个技巧</li></ul><p id="3e1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多可以从我的<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github </a>中找到</p></div></div>    
</body>
</html>