<html>
<head>
<title>Data Science as Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为代码的数据科学</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-science-as-code-build-an-ai-project-like-an-it-project-7377fb55df13?source=collection_archive---------55-----------------------#2020-06-08">https://towardsdatascience.com/data-science-as-code-build-an-ai-project-like-an-it-project-7377fb55df13?source=collection_archive---------55-----------------------#2020-06-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/7fc4850fc3a1525fdc22447da60bccef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zUZArTrw0KMFnUrVsAt-0g.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">Scrum板，照片由<a class="ae jd" href="https://unsplash.com/@irfansimsar" rel="noopener ugc nofollow" target="_blank">i̇rfan·西姆萨尔</a>在<a class="ae jd" href="https://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><div class=""/><div class=""><h2 id="bb8a" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">像构建IT项目一样构建人工智能项目</h2></div><p id="ed34" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi lr translated"><span class="l ls lt lu bm lv lw lx ly lz di"/>很多文章都是关于人工智能或数据科学的主题，以及IT产业化的问题。也有很多工具来处理这个问题，从几乎没有代码的方法(<a class="ae jd" href="https://www.dataiku.com" rel="noopener ugc nofollow" target="_blank">datataiku</a>、<a class="ae jd" href="https://rapidminer.com" rel="noopener ugc nofollow" target="_blank"> Rapid Miner </a>、<a class="ae jd" href="https://www.knime.com" rel="noopener ugc nofollow" target="_blank"> Knime </a>、<a class="ae jd" href="https://www.salesforce.com/fr/products/einstein-analytics/overview/" rel="noopener ugc nofollow" target="_blank">sales force Einstein Analytics</a>、<a class="ae jd" href="https://www.sap.com/france/products/cloud-analytics.html" rel="noopener ugc nofollow" target="_blank"> SAP Analytics </a>等等。)或多或少的成功，以及一些接近代码的工具(<a class="ae jd" href="https://kedro.readthedocs.io" rel="noopener ugc nofollow" target="_blank">凯德罗</a>、<a class="ae jd" href="https://dvc.org" rel="noopener ugc nofollow" target="_blank"> DVC </a>、<a class="ae jd" href="https://docs.dagster.io" rel="noopener ugc nofollow" target="_blank">达格斯特</a>、<a class="ae jd" href="https://mlflow.org" rel="noopener ugc nofollow" target="_blank"> MLflow </a>等。).</p><p id="5f89" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果所有这些工具都有它们的优势，我真的不太喜欢它们，因为我认为一个人工智能项目首先是一个IT项目，意味着<em class="ma">代码</em>。</p><blockquote class="mb"><p id="7131" class="mc md jg bd me mf mg mh mi mj mk lq dk translated">作为代码的数据科学</p></blockquote><p id="280d" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated"><em class="ma">免责声明:在这篇文章中，我不包括云中可用的人工智能托管服务，如GCP人工智能平台的工具，如果你对所选的提供商有足够的技能，这些工具可以很容易地投入生产(但有一定的限制)。</em></p><p id="bc9d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果一个企业把一个AI项目当成一个IT项目，就会跨越一个心理障碍，应该去神秘化这类项目。事实上，组织可能会将人工智能项目视为一个IT项目:当构建一个web应用程序时，就建立了一个团队，例如后端开发人员、前端开发人员、产品负责人等。，其中需要提到的技术配置文件来处理这种应用程序的技术部分。对于一个人工智能项目，例如，用数据工程师取代后端开发人员，用数据科学家取代前端开发人员，保留你的产品所有者，你就在这里:除了团队的技能和商业目标，项目的过程遵循<strong class="kx jh">相同的模式</strong>。例如，如果你使用Scrum作为你的敏捷框架进行日常开发和交付，你应该能够在你的AI项目中使用它。当然，在人工智能项目中有一些特殊性，可能比<em class="ma">【经典】</em> IT项目更不常见。但是即使是<em class="ma">【经典】</em> IT项目也有其特殊性:一个基于PHP和JS技术的在线零售网络应用并不像用C++编写的物联网嵌入式应用那样涉及相同的团队概况。人工智能项目也是如此。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="e8c7" class="mx my jg bd mz na nb nc nd ne nf ng nh km ni kn nj kp nk kq nl ks nm kt nn no bi translated">简单的数据科学架构</h1><p id="8e44" class="pw-post-body-paragraph kv kw jg kx b ky np kh la lb nq kk ld le nr lg lh li ns lk ll lm nt lo lp lq ij bi translated">在这篇文章中，我将展示一个小型架构和一些代码，给出一个最终的人工智能解决方案投入生产，比方说对于<em class="ma">“中间数据”</em>(不是大数据，意思是少于几TB)和对于<em class="ma">批处理</em>。</p><figure class="nv nw nx ny gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nu"><img src="../Images/53ce743ce5e718e6808a8995806ca055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sVE4JGue0JvPwEW9SbsBJw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图一。简单的数据科学架构</p></figure><p id="8e52" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">具有内部架构(图1。)，我们拥有人工智能解决方案所需的一切:</p><ul class=""><li id="060b" class="nz oa jg kx b ky kz lb lc le ob li oc lm od lq oe of og oh bi translated">气流分布式架构:专用服务器(使用Celery executor的主服务和工作服务)+队列任务服务服务器(Redis)</li><li id="08dc" class="nz oa jg kx b ky oi lb oj le ok li ol lm om lq oe of og oh bi translated">PostgreSQL数据库存储气流元数据、超集元数据和一些数据项目</li><li id="9f36" class="nz oa jg kx b ky oi lb oj le ok li ol lm om lq oe of og oh bi translated">用于处理数据集文件(csv、拼花等)的MinIO本地对象存储。)和模型持久性</li><li id="7b88" class="nz oa jg kx b ky oi lb oj le ok li ol lm om lq oe of og oh bi translated">提供一些数据可视化的超集服务器</li></ul><p id="6153" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要运行下面的工作流代码示例，所有这些服务都在同一服务器上的沙盒环境就足够了，这里提供的代码不需要MinIO和Celery，它们分别由本地文件系统和本地执行器代替(如果应用了一些数据治理，例如备份系统或IT DRP，这对于小型AI项目和中级SLA来说完全没问题)。</p><h1 id="b250" class="mx my jg bd mz na on nc nd ne oo ng nh km op kn nj kp oq kq nl ks or kt nn no bi translated">数据科学用例</h1><figure class="nv nw nx ny gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi os"><img src="../Images/4af16fbb8952f2ce9f1d13bca805a8e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V1JwsJUOuA-33t3H"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://unsplash.com/@florianolv?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Florian Olivo </a>在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2c2f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用来说明我的文章的用例是基于法国<a class="ae jd" href="http://egc2017.imag.fr/defi/" rel="noopener ugc nofollow" target="_blank"> EGC 2017年学术挑战</a>:它由一个预测任务组成，根据法国格勒诺布尔市(左图)的绿地相关数据来确定一棵树是否有缺陷。</p><p id="8bcd" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">数据包含种植年份、树种、地理位置、树木直径或发育阶段等特征。</p><p id="fb27" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里不讨论数据科学部分，因为获得好的性能很简单(仅供参考，挑战使用的分数是准确性和F分数)。将使用两个数据集:一个用于训练，一个用于评估性能。</p><h1 id="a69d" class="mx my jg bd mz na on nc nd ne oo ng nh km op kn nj kp oq kq nl ks or kt nn no bi translated">代码部分</h1><p id="00b6" class="pw-post-body-paragraph kv kw jg kx b ky np kh la lb nq kk ld le nr lg lh li ns lk ll lm nt lo lp lq ij bi translated">为了方便人工智能项目中的代码开发，我将我的东西打包成一个Python库，<strong class="kx jh"> DSBox </strong>，你可以免费使用。</p><div class="ip iq gp gr ir ot"><a href="https://github.com/vlevorato/dsbox" rel="noopener  ugc nofollow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd jh gy z fp oy fr fs oz fu fw jf bi translated">vlevorato/dsbox</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">V. Levorato制作的包装。该软件包提供:Apache Airflow的特定操作员，以便管理数据…</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">github.com</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph ix ot"/></div></div></a></div><p id="d8b9" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我在这里只集中讨论一揽子计划中的运营部分。这一部分分为两个主要部分:</p><ul class=""><li id="fdb0" class="nz oa jg kx b ky kz lb lc le ob li oc lm od lq oe of og oh bi translated">气流<strong class="kx jh">数据运算符</strong></li><li id="4933" class="nz oa jg kx b ky oi lb oj le ok li ol lm om lq oe of og oh bi translated"><strong class="kx jh">数据单元</strong></li></ul><p id="a582" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">基本上，气流操作员是没有国籍的。一旦任务完成，日志分开，没有状态被保留，你不能直接在任务之间传递信息，即使在某些情况下可以使用一些本地机制(<em class="ma"> XCom变量</em>或<em class="ma">入口/出口</em>)。<strong class="kx jh">数据操作符</strong>简单地覆盖气流基本操作符，包含一个或两个<strong class="kx jh">数据单元</strong>管理输入和/或输出数据流(图2。).</p><figure class="nv nw nx ny gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pi"><img src="../Images/417151da07acf4355ff32cf34eba8f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P8uia-pQLPOXVMuAL59Cfg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图二。数据运算符结构</p></figure><p id="0feb" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在谈论IT生产之前，作为一名数据科学家，当我第一次处理一个问题时，我主要是在Jupyter笔记本上操作熊猫数据帧。如果我尽全力编写一个分解的、结构化的和解耦的代码，如果我想让它投入生产，我显然不想重写我的所有工作。这就是数据操作符的用途:编写一个函数，将数据帧作为输入参数，并返回一个数据帧。它可以处理其他类型的数据帧(Dask、Vaex)，但是为了简单起见，我更喜欢在本文中关注Pandas数据帧。</p><figure class="nv nw nx ny gt is"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="0c7f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如前所述，数据操作符使用的函数接受一个输入数据帧，进行一些处理(这里是一个非常简单的<code class="fe pl pm pn po b">fillna</code>操作)，并将结果作为数据帧返回。为了完成整个工作，我需要首先定义组成输入和输出数据流的数据单元。假设我需要读取一个带有字符“；”的CSV文件作为分隔符，并希望将结果写入一个拼花文件:</p><figure class="nv nw nx ny gt is"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="bf65" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我现在可以编写一个标准的气流DAG程序，它有一个由我的数据操作符定义的任务。</p><figure class="nv nw nx ny gt is"><div class="bz fp l di"><div class="pj pk l"/></div></figure><h1 id="49ff" class="mx my jg bd mz na on nc nd ne oo ng nh km op kn nj kp oq kq nl ks or kt nn no bi translated">完整的人工智能解决方案</h1><p id="298b" class="pw-post-body-paragraph kv kw jg kx b ky np kh la lb nq kk ld le nr lg lh li ns lk ll lm nt lo lp lq ij bi translated">让我们回到我们的树病预测用例。最终导出到Postgres数据库的完整工作流代码<a class="ae jd" href="https://github.com/vlevorato/dsbox/blob/master/dsbox/examples/tree_disease_usecase/tree_disease_dag_with_pg.py" rel="noopener ugc nofollow" target="_blank">可以在这里找到</a>。我们的DAG如预期的那样被气流调度程序很好地解释(图3。).</p><figure class="nv nw nx ny gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pp"><img src="../Images/a9f0aab2629524a974ac4cb2bc104620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lRCUuSU9BLdo-7ke18OceA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图三。Airflow UI中的树病用例工作流</p></figure><p id="edfc" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我不会输入最终DAG的每个ML任务的细节(图4。)，因为你可以在<a class="ae jd" href="https://github.com/vlevorato/dsbox" rel="noopener ugc nofollow" target="_blank">我的GitHub repo </a>上探索完整的代码，因为它遵循经典的数据科学模式<em class="ma">(加入、清理、特征工程、训练、预测、测量性能、展示结果)</em>。最重要的是，主要思想是<strong class="kx jh">通过数据单元</strong>显式声明所有数据集读写操作。是的，我以前做过很多爪哇☕️。所有操作符都不读取和写入数据，其中一些只是读取，例如适合模型的<em class="ma">“Model _ learning”</em>任务，并且不写入任何数据，只写入将由<em class="ma">“Model _ prediction”</em>任务使用的模型本身的序列化。为了避免将数据路径耦合到工作流程序，应该使用元数据管理文件或工具来避免硬编码路径。<br/> <strong class="kx jh">注:</strong><code class="fe pl pm pn po b">SubDagOperator</code>此处仅用于教学目的，不建议在生产中使用。</p><figure class="nv nw nx ny gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pq"><img src="../Images/ceaa8ab97f88ab33a1b158dc45be3ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kCsa4OLYilytiYekEz4TqA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图4。树木病害用例DAG</p></figure><h1 id="cdee" class="mx my jg bd mz na on nc nd ne oo ng nh km op kn nj kp oq kq nl ks or kt nn no bi translated">数据展示</h1><p id="898f" class="pw-post-body-paragraph kv kw jg kx b ky np kh la lb nq kk ld le nr lg lh li ns lk ll lm nt lo lp lq ij bi translated">为了最终确定用例，需要向业务公开数据，而所提出的体系结构恰恰提出了Apache超集来实现这一点。我创建了一个非常简单的仪表板(图5。)的地图，其中测试数据集的每棵树都带有预测的疾病标签(0或1 ),地图框布局自动生成一些聚类，这取决于放大的方式。(差的)旭日图给出了预测病树的比例。</p><figure class="nv nw nx ny gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pq"><img src="../Images/35e81e8f85d9ee34414b6139629775d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2RDWL2Y5VRk_G4IIrWYh8w.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图五。通过Apache超集实现数据可视化</p></figure><blockquote class="mb"><p id="39c9" class="mc md jg bd me mf pr ps pt pu pv lq dk translated">如果从IT的角度来看，让一个人工智能解决方案促进<em class="pw">“走向生产”</em>并不那么困难。</p></blockquote><h1 id="3279" class="mx my jg bd mz na on nc nd ne oo ng nh km px kn nj kp py kq nl ks pz kt nn no bi translated">最后的想法</h1><p id="669c" class="pw-post-body-paragraph kv kw jg kx b ky np kh la lb nq kk ld le nr lg lh li ns lk ll lm nt lo lp lq ij bi translated">正如你所看到的，如果从IT的角度来处理这个项目，那么拥有一个人工智能解决方案来促进<em class="ma">【走向生产】</em>并不困难，即使在这篇文章中，几个元素被故意搁置(测试、CI/CD、元数据管理等)。).最后，它更多地是关于了解您的组织是否已经能够平稳地交付it应用程序。在所有衡量交付效率的指标中，时间(或频率)是其中之一:使用<em class="ma">“数据科学即代码”</em>模式，我能够每周交付一个新版本的产品，而且我在现实生活中也是这样做的。因此，首先，考虑频繁交付(如果需要的话)，每月交付一次是一个好的开始。如果你已经这样做了，或者更快，那么恭喜你:你已经知道如何将一个人工智能项目投入生产。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><blockquote class="qa qb qc"><p id="f24e" class="kv kw ma kx b ky kz kh la lb lc kk ld qd lf lg lh qe lj lk ll qf ln lo lp lq ij bi translated">更高级的AI架构概念将在以后的文章中讨论，因为这个解决方案不容易扩展，并且有一些限制。</p></blockquote></div></div>    
</body>
</html>