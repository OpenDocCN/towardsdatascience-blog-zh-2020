<html>
<head>
<title>What is new in Geopandas 0.70?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Geopandas 0.70有什么新特性？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-is-new-in-geopandas-0-70-dda0ddc90978?source=collection_archive---------26-----------------------#2020-02-18">https://towardsdatascience.com/what-is-new-in-geopandas-0-70-dda0ddc90978?source=collection_archive---------26-----------------------#2020-02-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="74e9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">主要变化和新的改进，带有示例和代码说明。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f8b512ec991ab21bbf85437fc068d7f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R0aEYugIa3pIJ8yFrZY4xQ.png"/></div></div></figure><p id="4bdc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Geopandas是用Python进行地理空间数据科学的主力，它扩展了pandas的数据类型来执行空间数据操作。Geopandas 0.70于昨天2月17日刚刚发布，它带来了一些重大的变化和改进。</p><p id="47d3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我在这里重点介绍了Geopandas 0.70的一些最佳新特性。</p><h2 id="35ea" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">原生剪辑功能</h2><p id="cbd5" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">通过将地理数据框裁剪到其他形状的空间范围的固有功能，裁剪变得非常容易。裁剪是最常用的地理空间数据处理功能之一；然而，在以前的版本中，Geopandas没有执行它的直接函数。如果您想要地理数据的特定区域，您必须执行裁剪以获得感兴趣的区域。</p><p id="f57c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在有了新的<code class="fe mo mp mq mr b">geopandas.clip</code>功能，您可以轻松地按照提供的空间范围裁剪数据。让我们看一个例子。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="8766" class="lq lr it mr b gy mw mx l my mz">import geopandas as gpd<br/>import matplotlib.pyplot as plt<br/>from shapely.geometry import Polygon, LineString<br/>gpd.__version__</span><span id="cf22" class="lq lr it mr b gy na mx l my mz">'0.7.0'</span></pre><p id="c981" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们使用Geopandas作为可用的数据集，首都城市，世界边界。此外，我们将非洲划分为子集，并创建一个多边形来标记我们感兴趣的空间范围。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="88a4" class="lq lr it mr b gy mw mx l my mz">capital_cities = gpd.read_file(gpd.datasets.get_path(“naturalearth_cities”))</span><span id="278e" class="lq lr it mr b gy na mx l my mz">world = gpd.read_file(gpd.datasets.get_path(“naturalearth_lowres”))</span><span id="782e" class="lq lr it mr b gy na mx l my mz">africa = world[world[“continent”] == “Africa”]</span><span id="9890" class="lq lr it mr b gy na mx l my mz">poly = Polygon([(-35, 0), (-35, 60), (60, 60), (60, 0), (0, 0)])</span><span id="c07e" class="lq lr it mr b gy na mx l my mz">polygon = geopandas.GeoDataFrame([1], geometry=[poly], crs=world.crs)</span></pre><p id="3705" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们在一个图像中看到所有的数据。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="3767" class="lq lr it mr b gy mw mx l my mz">fig, ax = plt.subplots(figsize=(12,10))</span><span id="be92" class="lq lr it mr b gy na mx l my mz">world.plot(ax=ax)</span><span id="08d4" class="lq lr it mr b gy na mx l my mz">africa.plot(ax=ax, edgecolor=”black”, color = “brown”, alpha=0.5)</span><span id="9a24" class="lq lr it mr b gy na mx l my mz">capital_cities.plot(ax=ax, color=”Red”)</span><span id="4d3d" class="lq lr it mr b gy na mx l my mz">polygon.boundary.plot(ax=ax, color=”Red”)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/57492dea13f7cea353378257fe494fa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WxkLuXzZQyet8JFy_YQAiQ.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">所有数据的映射</p></figure><p id="6b76" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首都标为红点，非洲标为绿色。红色矩形显示了我们感兴趣的范围。</p><p id="2188" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，如果我们只想从世界边界中裁剪红色矩形的一部分，您可以调用<code class="fe mo mp mq mr b">geopandas.clip</code>并提供两个地理数据框。首先，<code class="fe mo mp mq mr b">world </code>世界边界和<code class="fe mo mp mq mr b">polygon</code>范围。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="05cc" class="lq lr it mr b gy mw mx l my mz">clipped = gpd.clip(world, polygon)</span><span id="0926" class="lq lr it mr b gy na mx l my mz">fig, ax = plt.subplots(figsize=(12,10))</span><span id="47db" class="lq lr it mr b gy na mx l my mz">clipped.plot(ax=ax, color=”gray”);</span></pre><p id="4681" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如下图所示，你可以看到被剪切的区域，非洲、欧洲和亚洲的部分地区。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/80ee9b9d61b3c9d9fe92203a6d0abfa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RJ_BhyGRzVqAbWF3xsRTtw.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">剪裁的边界</p></figure><p id="421f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您不仅可以使用此函数多边形和多边形，还可以使用其他数据类型，如线和点。</p><h2 id="0b22" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">读取文件时过滤行</h2><p id="eb9a" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">对于当前的大数据集，在读取数据的同时过滤行的能力是必不可少的。想象一下，有一个包含数百万行的数据集，由于内存问题而无法读取。有了这个新功能，您可以在读取数据之前提供行或切片来过滤数据。</p><p id="96a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看一个例子。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="8900" class="lq lr it mr b gy mw mx l my mz">cities_filtered = gpd.read_file(gpd.datasets.get_path(“naturalearth_cities”),<strong class="mr iu">rows=30</strong>)</span></pre><p id="a084" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将只读取数据的前30行。如果想从中间切片，可以加切片。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="4117" class="lq lr it mr b gy mw mx l my mz">cities_filtered_slice = gpd.read_file(gpd.datasets.get_path(“naturalearth_cities”),<strong class="mr iu">rows=slice(10,30)</strong>)</span></pre><p id="7e15" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">只有10到30之间的行才返回上面的代码。</p><h2 id="a904" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">地块几何图形集合</h2><p id="5860" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">无法绘制几何图形集合数据，例如不同数据类型(点、线或多边形)的数据。使用当前版本，您可以打印各种几何对象集合。让我们看一个例子。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="2661" class="lq lr it mr b gy mw mx l my mz">a = LineString([(0, 0), (1, 1), (1,2), (2,2)])</span><span id="05ad" class="lq lr it mr b gy na mx l my mz">b = LineString([(0, 0), (1, 1), (2,1), (2,2)])</span><span id="9b31" class="lq lr it mr b gy na mx l my mz">x = a.intersection(b)</span><span id="f910" class="lq lr it mr b gy na mx l my mz">gc = gpd.GeoSeries(x)</span><span id="6e07" class="lq lr it mr b gy na mx l my mz">type(x)</span><span id="d672" class="lq lr it mr b gy na mx l my mz">shapely.geometry.collection.GeometryCollection</span></pre><p id="5d4a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">a</code>和<code class="fe mo mp mq mr b">b</code>只是普通的LineString，但是它们的交集返回一个几何图形的集合(线和点)。如果您从x中的几何图形集合中创建了一个<code class="fe mo mp mq mr b">Geoseries</code>，现在您可以用Geopandas绘制它。请参见下面的示例。您在同一个地理数据框中绘制了点和线。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/1ecd7a8582208a4e4ba5d6a7e85acaae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*2BUZzE4ko7-NfpXHajLVFw.png"/></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">用Geopandas绘制的几何图形集合</p></figure><h2 id="6bd5" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">PROJ 6号取代PROJ 4号</h2><p id="e586" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">Geopandas 0.70版本开始使用新的投影接口。PROJ 6取代了PROJ4，带来了更好的界面和更多的信息。</p><p id="1cbf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以前<code class="fe mo mp mq mr b">gpd.crs</code>只返回这样一个字符串。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="ca8f" class="lq lr it mr b gy mw mx l my mz">{'init': 'epsg:4326'}</span></pre><p id="2615" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是，当前版本带来了大量关于数据地理投影的元数据。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="d5b2" class="lq lr it mr b gy mw mx l my mz">world.crs</span></pre><p id="e823" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">返回以下有用信息</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="5f56" class="lq lr it mr b gy mw mx l my mz">&lt;Geographic 2D CRS: EPSG:4326&gt; Name: WGS 84 Axis Info [ellipsoidal]: — Lat[north]: Geodetic latitude (degree) — Lon[east]: Geodetic longitude (degree) Area of Use: — name: World — bounds: (-180.0, -90.0, 180.0, 90.0) Datum: World Geodetic System 1984 — Ellipsoid: WGS 84 — Prime Meridian: Greenwich</span></pre><p id="8789" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，如果要访问投影的数据，可以调用。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="e31f" class="lq lr it mr b gy mw mx l my mz">world.crs.datum</span></pre><p id="bdd0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">结果只显示了这一部分</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="3c4b" class="lq lr it mr b gy mw mx l my mz">DATUM[“World Geodetic System 1984”, ELLIPSOID[“WGS 84”,6378137,298.257223563, LENGTHUNIT[“metre”,1]], ID[“EPSG”,6326]]</span></pre><p id="ffba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">还有一些其他的改进或错误修复没有在本文中提及，但是值得一提。Geopandas中的空间连接现在可以正确处理Multindex并保留左侧地理数据框的索引名称。将文件写入磁盘时，如果需要，现在可以保留索引。此版本现在可以绘制缺少数据的choropleth地图。</p><h2 id="2d66" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">结论</h2><p id="52b5" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">感谢当前版本的所有贡献者。Geopandas 0.70在地理空间数据科学过程中带来了许多改进。得益于此版本，现在可以在读取和绘制多几何图形数据时进行裁剪、过滤数据。Proj 6还带来了一个更好的用户界面，其中包含地理空间世界中最不为人所知的主题之一，地理投影。</p><p id="80dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这篇文章的代码可以在这个Google Colab链接中找到。</p><div class="ni nj gp gr nk nl"><a href="https://colab.research.google.com/drive/1wPJlGuT4BTISiCo8rYd01BJEG6TC-nBQ" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">谷歌联合实验室</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">编辑描述</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">colab.research.google.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz ks nl"/></div></div></a></div></div></div>    
</body>
</html>