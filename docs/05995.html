<html>
<head>
<title>Become a Lyrical Genius</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">成为抒情天才</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/become-a-lyrical-genius-4362e7710e43?source=collection_archive---------17-----------------------#2020-05-16">https://towardsdatascience.com/become-a-lyrical-genius-4362e7710e43?source=collection_archive---------17-----------------------#2020-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bdcc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Spotify和Genius APIs抓取您的Spotify播放列表歌词。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fc54920ec3f9a23e781caefd8dd310ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TLgok3XDsYDq34aMZHkxHw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片来源:马尔特·温根(<a class="ae kv" href="https://unsplash.com/photos/PDX_a_82obo" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/PDX_a_82obo</a></p></figure><p id="9901" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不幸的是，我不会说唱或写歌，因此我不能教你如何成为那种抒情天才。我擅长的是向你展示如何使用Spotify和Genius APIs从你最喜欢的Spotify播放列表中获取歌词，并从一些网络抓取中获得一点帮助。除了我在这里概述的方法之外，还有很多其他的方法，但是这是我发现的为数不多的免费且可靠的方法之一。代码的一些部分受到了Will Soares在DEV Community上写的一篇文章的启发，所以如果你觉得这很有用，请点击这里的<a class="ae kv" href="https://dev.to/willamesoares/how-to-integrate-spotify-and-genius-api-to-easily-crawl-song-lyrics-with-python-4o62" rel="noopener ugc nofollow" target="_blank">并表示赞赏。</a></p><p id="0cae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是我创建的Python类，<code class="fe ls lt lu lv b">GetLyrics</code>，已经准备好了，可以让你自己试用。只需插入Spotify和Genius APIs的个人凭据，以及Spotify用户和播放列表id(本文下一节将介绍如何获取所有这些信息)，就可以开始了。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="df8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从上面的代码片段中可以看到，我们可以在一个列表中得到整个播放列表的歌词，<code class="fe ls lt lu lv b">song_lyrics</code>，只需要两行代码。很好。</p><h1 id="64fb" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">获取我们的类参数</h1><p id="d38a" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">我们需要做的第一件事是收集我们所有的输入(<code class="fe ls lt lu lv b">GetLyrics</code>类参数)。为了初始化这个类，我们需要5样东西:</p><ol class=""><li id="58db" class="mv mw iq ky b kz la lc ld lf mx lj my ln mz lr na nb nc nd bi translated">Spotify客户端ID</li><li id="b04d" class="mv mw iq ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">Spotify客户端机密</li><li id="a271" class="mv mw iq ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">Spotify用户ID</li><li id="fe2a" class="mv mw iq ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">Spotify播放列表ID</li><li id="2f65" class="mv mw iq ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">Genius授权密钥</li></ol><h2 id="ca72" class="nj lz iq bd ma nk nl dn me nm nn dp mi lf no np mk lj nq nr mm ln ns nt mo nu bi translated">Spotify客户端凭据</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/10daaabf51d886fc1b32119322e2dfb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lxTq1t9BmLQI7eXlMrmTZw.png"/></div></div></figure><p id="fc1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你还没有注册，那么你需要在Spotify上注册一个开发者账户。假设你有一个个人Spotify账户，你所需要做的就是导航到<a class="ae kv" href="https://developer.spotify.com/dashboard/login" rel="noopener ugc nofollow" target="_blank"> Spotify开发者仪表盘</a>并使用你的Spotify账户详细信息登录。</p><p id="8f28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">登录仪表板后，您需要创建一个应用程序。即使你没有真正地<em class="nw">创建一个应用程序，为了获得你的API证书，这也是必需的。给应用程序一个令人兴奋的名字和描述，并勾选所有适用于“你在构建什么？”问题。</em></p><p id="b107" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应用程序现在应该在您的仪表板上，所以让我们导航到它的页面，并注意客户端ID和客户端密码。这些是我们发出请求时需要的API凭证。</p><h2 id="b078" class="nj lz iq bd ma nk nl dn me nm nn dp mi lf no np mk lj nq nr mm ln ns nt mo nu bi translated">Spotify用户和播放列表id</h2><p id="6acf" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">我们还需要一些与Spotify相关的东西。为了告诉Spotify API我们对哪个播放列表感兴趣，我们需要为创建播放列表的用户获取一个Spotify URI，为播放列表本身获取一个。这是通过导航到用户主页<em class="nw">和</em>到播放列表，点击三个点，然后点击“分享”——从那里你可以将Spotify URI复制到你的剪贴板。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/90b61878b2491a4bacf7833f2ee6ae77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ad0qSMRnvY-i0ffMCZGwtQ.png"/></div></div></figure><h2 id="6584" class="nj lz iq bd ma nk nl dn me nm nn dp mi lf no np mk lj nq nr mm ln ns nt mo nu bi translated">Genius授权密钥</h2><p id="637f" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">我们还需要在<a class="ae kv" href="https://docs.genius.com/" rel="noopener ugc nofollow" target="_blank"> Genius API文档</a>页面点击“授权Genius ”,创建一个Genius帐户。登录后，页面右侧应该会有一个授权代码。</p><h1 id="d30f" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">分解类</h1><p id="40cd" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">现在我们已经得到了所有的输入，希望您已经能够自己尝试使用<code class="fe ls lt lu lv b">GetLyrics</code>类，我将提供该类中每个方法的分解，这样您就可以放心地使用这段代码，并修改/改进它以适合您的特定用例。</p><h2 id="db2e" class="nj lz iq bd ma nk nl dn me nm nn dp mi lf no np mk lj nq nr mm ln ns nt mo nu bi translated">初始化类属性</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="9c51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">和Python中的大多数类一样，我们从一个构造函数方法开始初始化我们的类属性，这样它们就可以在下面的方法中使用。</p><h2 id="5f40" class="nj lz iq bd ma nk nl dn me nm nn dp mi lf no np mk lj nq nr mm ln ns nt mo nu bi translated">获取播放列表信息</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="a62a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的方法使用<a class="ae kv" href="https://spotipy.readthedocs.io/en/2.12.0/" rel="noopener ugc nofollow" target="_blank"> Spotipy </a>库连接到Spotify API，并返回一个JSON对象，该对象包含我们感兴趣的Spotify播放列表的大量信息。</p><h2 id="6339" class="nj lz iq bd ma nk nl dn me nm nn dp mi lf no np mk lj nq nr mm ln ns nt mo nu bi translated">获取曲目名称和艺术家</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="3c4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这两个方法中，我们遍历JSON对象来查找播放列表中每首歌曲的名称和艺术家。然后将它们存储并返回到两个列表中，供后面的方法使用。</p><h2 id="9d9e" class="nj lz iq bd ma nk nl dn me nm nn dp mi lf no np mk lj nq nr mm ln ns nt mo nu bi translated">连接到Genius API</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="a8cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个方法使用<code class="fe ls lt lu lv b">Requests</code>库通过我们的授权密钥连接Genius API。然后，它检查API中是否有与给定曲目名称和艺术家相匹配的内容。它返回一个包含与这些匹配相关的所有信息的响应对象。</p><h2 id="56ca" class="nj lz iq bd ma nk nl dn me nm nn dp mi lf no np mk lj nq nr mm ln ns nt mo nu bi translated">筛选匹配项并获得歌曲的网址</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="3b89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我们对前面方法中返回的JSON对象进行解码，然后检查哪个“hit”与艺术家姓名完全匹配。如果找到匹配，则意味着该歌曲存在于Genius API中，并且该曲目的信息现在存储在<code class="fe ls lt lu lv b">remote_song_info</code>对象中。Genius API不包含每首歌曲的歌词，但是它包含一个URL，该URL会路由到包含歌词的网页。在下面的代码片段中，我们解析<code class="fe ls lt lu lv b">remote_song_info</code>对象来查找每首歌曲的URL。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><h2 id="9e50" class="nj lz iq bd ma nk nl dn me nm nn dp mi lf no np mk lj nq nr mm ln ns nt mo nu bi translated">网络抓取歌词</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="018b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们现在可以得到一些歌词了！这个方法再次使用<code class="fe ls lt lu lv b">Requests</code>库来请求在前面的方法中获得的歌曲URL。然后我们使用<code class="fe ls lt lu lv b">BeautifulSoup</code>来解析HTML。我们两次调用<code class="fe ls lt lu lv b">.find()</code>函数的原因是因为我发现Genius网页的结构有时会有不同的格式。大多数情况下，歌词包含在带有<code class="fe ls lt lu lv b">class="lyrics”</code>的<code class="fe ls lt lu lv b">div</code>元素中，但有时会变成<code class="fe ls lt lu lv b">class="Lyrics__Container..."</code>。我加入了一个最终的<code class="fe ls lt lu lv b">elif</code>条件，如果两个歌词对象都是<code class="fe ls lt lu lv b">NoneTypes</code>，那么<code class="fe ls lt lu lv b">lyrics</code>对象将被设置为<code class="fe ls lt lu lv b">None</code>。这种情况很少发生，但这是由于在请求一首歌曲的URL时出现404错误，可能是因为该URL不再存在，但尚未从API中删除。</p><h2 id="df1e" class="nj lz iq bd ma nk nl dn me nm nn dp mi lf no np mk lj nq nr mm ln ns nt mo nu bi translated">将所有东西包装在一起</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="0ed8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，这个方法通过依次执行每个方法将所有内容联系在一起，这意味着我们只需两行代码就可以得到我们的歌词。它还有一系列的打印语句来使方法变得冗长，这样您就可以在它执行时跟踪它的进度。</p><blockquote class="ny nz oa"><p id="cb41" class="kw kx nw ky b kz la jr lb lc ld ju le ob lg lh li oc lk ll lm od lo lp lq lr ij bi translated">我希望这篇文章对你有用。请在您自己的工作中随意使用这些代码，如果您有任何改进的建议，我很乐意在下面听到它们。感谢您的阅读！</p></blockquote></div></div>    
</body>
</html>