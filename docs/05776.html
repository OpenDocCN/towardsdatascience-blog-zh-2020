<html>
<head>
<title>Best Practices For Securing AWS EC2 Instances</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保护AWS EC2实例的最佳实践</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/best-practices-for-securing-aws-ec2-instances-4bd656e22462?source=collection_archive---------23-----------------------#2020-05-13">https://towardsdatascience.com/best-practices-for-securing-aws-ec2-instances-4bd656e22462?source=collection_archive---------23-----------------------#2020-05-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2de6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">确保你在AWS共享责任模型中尽了自己的一份力</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1307a133c9b8e64413ca2688cd1be73c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KitbVmB8YgwY2bhxGEiwCg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/@wdnet?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> PhotoMIX有限公司</a>从<a class="ae ky" href="https://www.pexels.com/photo/building-metal-house-architecture-101808/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>拍摄</p></figure><p id="b072" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">云中的安全性有不同的维度，作为用户，您应该非常谨慎地在易用性、性能和安全性之间取得最佳平衡。虽然AWS在确保云的安全<em class="lv">方面做得非常出色，但用户仍然需要在云</em>中尽自己的一份力量<em class="lv">。从虚拟化、多租户或对数据中心的物理访问的角度来看，AWS保护了一切，但仍有许多需要用户注意的地方。</em></p><p id="5783" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想了解更多？然后继续读。这篇文章将探讨我在过去多年的经验中发现的相关的不同主题。</p><h1 id="017a" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">最终用户应该关心什么？</h1><p id="8d9e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">EC2环境中的用户职责始于操作系统的配置和管理，并向上延伸，包括用户在虚拟机上安装的所有实用程序和软件。这些层可以大致分为:</p><h2 id="7342" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">操作系统(包括更新和安全补丁)</h2><p id="09d3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">AWS定期升级现有的ami，这些ami进一步指向实例启动时使用的快照、权限和引导卷。如果您使用定制的AMI，限制对您自己帐户的访问总是一个好的做法。第二，如果有强烈的动机，只在实例终止后保留您的卷。它可能包含应用程序状态数据，将来可以通过将这些卷附加到其他实例来使用这些数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/90f86dbe55c96e35eaf520f508faf7b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zLVAUpXeR02FHRtkiFJRgA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AWS上典型应用程序堆栈的层次</p></figure><h2 id="3b18" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">实例上的应用程序和实用程序</h2><p id="4c97" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">作为最终用户，您对安装在EC2主机上的一切负责。避免使用像<em class="lv"> telnet、</em>这样的工具。选择一个瘦基础AMI并只安装应用程序运行时绝对需要的东西是构建您的设置的最佳方式。通过安装这样的实用程序，您可能会在不知不觉中从您的主机暴露端口。</p><h2 id="b15d" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">安全组防火墙配置</h2><p id="2f9b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">理解AWS中的安全组不仅可以帮助您控制流量，还可以作为一种<strong class="lb iu">识别机制，这一点很重要。</strong>避免使用<em class="lv">默认安全组</em>，默认情况下，它允许具有相同安全组的两个实例在所有端口上相互对话。因此，您最终可能会向网络中的另一台机器开放所有流量，而这台机器可能会因为完全不同的原因而受到危害。此外，以后与这些安全组相关联的任何其他机器自动成为俱乐部的一部分，从而形成网状拓扑。</p><h1 id="e8e0" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">用于访问50多种AWS服务的AWS PrivateLink</h1><p id="edc1" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">目前通过AWS PrivateLink 可以获得50多种AWS服务，这基本上意味着你对这些资源的请求从来没有真正通过互联网途径，而是使用AWS自己的内部主干网络。</p><p id="b0f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果您对EC2实例的访问需求只是集中在常见的AWS服务(如S3、DynamoDB、API Gateway等)上。)，完全阻止传出internet路由规则并只使用私有端点是有意义的。通过这些修改，您的路由表简化为如下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/dc19102087dfee8089fe32419ed4c73a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQV7HZeIGnrqSWipiNiy2g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安全组规则</p></figure><p id="9969" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nh ni nj nk b">pl-1a2b3c4d</code>在这种情况下，指向VPC中特定的AWS服务专用链接端点。我遇到过多个堆栈，其中像S3、DynamoDB和EC2这样的服务总结了所有的堆栈需求。</p><h1 id="914d" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">你需要宋承宪吗？</h1><p id="fed3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">第一个也是最常见的问题是向世界开放SSH，主要是因为你没有一个专用的静态IP/CIDR来识别流量的良好来源。然而，您可以首先从一开始就需要SSH开始。AWS生态系统在过去几年中发展很快，要求SSH可能是您最不想做的事情(考虑运行数十台或数千台服务器的堆栈)。在日志、监控和运营管理方面，AWS已经有了<a class="ae ky" href="https://aws.amazon.com/cloudwatch/" rel="noopener ugc nofollow" target="_blank"> Cloudwatch Monitoring </a>、<a class="ae ky" href="https://aws.amazon.com/systems-manager/" rel="noopener ugc nofollow" target="_blank"> AWS Systems Manager </a>等的广泛支持。从头开始规划您的架构/堆栈，以便所有可操作的见解都可以从外部获得，这样您就真的不需要访问机器了。将你的资源视为<a class="ae ky" href="http://cloudscaling.com/blog/cloud-computing/the-history-of-pets-vs-cattle/" rel="noopener ugc nofollow" target="_blank"> <em class="lv">牛</em>而不是<em class="lv">宠物</em> </a> <em class="lv"> </em>的著名比喻在这里非常贴切。设计您的系统，以便您可以在任何时候轻松地处理它们，而不需要日志、文件等任何本地状态。</p><h2 id="5226" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">如果你仍然认为你有——用SSM</h2><p id="2ced" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Systems Manager是AWS的优秀产品，它允许您在不关联SSH密钥对的情况下访问EC2机器。此外，您也不需要允许在端口22上进入。通过安装SSM代理和<a class="ae ky" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-setting-up.html" rel="noopener ugc nofollow" target="_blank">设置配置</a>，您可以从您的终端登录到您的实例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/db9c399dc95072d02dbc0cabbba20238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yrVUYzQSP64ohI98dsDihQ.png"/></div></div></figure><p id="1466" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在幕后，SSM通过返回一个URL和令牌来工作，使用它您可以启动一个WebSocket连接来发送命令和接收来自实例的输出。</p><h2 id="fa02" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">SSM还可以帮助您完成日常操作任务</h2><p id="d969" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">使用SSM的“运行”命令，您可以<a class="ae ky" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/execute-remote-commands.html" rel="noopener ugc nofollow" target="_blank">在一组实例上运行批量命令</a>。这进一步为您提供了运行命令的能力，而无需真正登录到服务器。</p><h1 id="a02c" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">停止使用AWS管理的策略</h1><p id="39f8" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">通常情况下，您不需要AWS管理的策略中的“所有”相关权限。第二，你不能控制将来这些政策的更新。总是倾向于最少的授权策略，其中受限制的主体只拥有您需要的访问权限。</p><h1 id="eea5" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">充分了解您的应用程序堆栈</h1><p id="9d7f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">几年前，我曾经在一台可以通过互联网访问的EC2机器上运行过Jenkins。无论我怎么努力，都无法终止或停止实例上运行的比特币挖掘进程。无论如何，这里的要点是了解运行在公开机器上的栈的所有方面。像Jenkins这样的工具工作在许多插件之上，这些插件可能会创建进入你的服务器的后门。此外，这种插件的漏洞很容易暴露，因为整个源代码大多可以在线获得。</p><h1 id="d281" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">避免在公共子网中设置实例</h1><p id="b73a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">公共子网包括具有公共IP地址的实例，这些实例通过Internet网关路由传出流量(0.0.0.0/0)。这使得他们在互联网上可以接近，从而打破了安全连接的界限。解决这类问题的一个经验法则是，尽量减少你从账户内部向外部世界证明自己身份的方式。相反，即使实例服务于面向公众的应用程序，也总是希望实例位于私有子网中。对于这种需求，您可以始终在公共子网中提供负载平衡器，并为私有子网实例定义路由。与<a class="ae ky" href="https://aws.amazon.com/waf/" rel="noopener ugc nofollow" target="_blank"> Web应用防火墙</a>的集成还可以帮助您断然拒绝恶意流量到达您的机器。</p><h1 id="0a47" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">使用实例角色——避免在EC2实例或ami中插入/放置访问键</h1><p id="da0a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">没有什么比短有效期的按需提供的临时访问凭证更好的了。在EC2实例、所有官方SDK、CLI等中。内置了在向AWS发起任何请求之前获取与相关策略一致的临时凭证的支持。</p><p id="078a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些动态凭证是使用实例元数据获取的，实例元数据是一个只能从实例内部解析的REST端点。根据策略定义中的授权，为请求分配适当范围的访问密钥对，通常在一小时后自动过期。</p><p id="608a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">本帖到此为止。下次见，楚斯！</em></p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="b9db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">来自《走向数据科学》编辑的提示:</em> </strong> <em class="lv">虽然我们允许独立作者根据我们的</em> <a class="ae ky" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="lv">规则和指导方针</em> </a> <em class="lv">发表文章，但我们并不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae ky" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="lv">读者术语</em> </a> <em class="lv">。</em></p></div></div>    
</body>
</html>