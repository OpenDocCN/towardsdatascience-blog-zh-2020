<html>
<head>
<title>How to Create a Representative Test Set</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建代表性的测试集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-a-representative-test-set-f0aa56adaf35?source=collection_archive---------19-----------------------#2020-05-07">https://towardsdatascience.com/how-to-create-a-representative-test-set-f0aa56adaf35?source=collection_archive---------19-----------------------#2020-05-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8a80" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用有代表性的测试数据集<strong class="ak">，满怀信心地评估您的模型的性能。</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/332e28f4418755ba0c5983f1b7ba28ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7BSFa6wNFdUO12cEqu8vlQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2638326" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/andrasgs-6162446/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2638326" rel="noopener ugc nofollow" target="_blank"> andrasgs </a></p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="bc71" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">将数据集分割成<em class="mc">训练</em>和<em class="mc">测试</em>集通常是机器学习流水线中的第一个处理步骤之一。在这一点上，只有一个不可侵犯的规则:搁置测试数据分割，只有当您的模型准备好进行最终评估时才再次引用它。但是，有没有一种方法可以让我们确信我们所做的拆分是正确的呢？我们如何确定测试集代表我们的总体？</p><blockquote class="md"><p id="860b" class="me mf it bd mg mh mi mj mk ml mm mb dk translated">我们必须确保测试集非常接近我们人口的复杂性。我们的验证集也是如此。</p></blockquote><p id="b884" class="pw-post-body-paragraph lg lh it li b lj mn ju ll lm mo jx lo lp mp lr ls lt mq lv lw lx mr lz ma mb im bi translated">在这个故事中，我们讨论两种分裂方法:随机抽样和分层抽样。我们考虑它们的优点，并讨论在特定情况下使用哪一种。这个故事实际上是我发表的关于优秀的<a class="ae ky" href="https://www.amazon.com/Hands-Machine-Learning-Scikit-Learn-TensorFlow/dp/1492032646" rel="noopener ugc nofollow" target="_blank">实践机器学习的笔记，作者是 Aurélien Géron，作者是 Scikit-Learn、Keras 和 TensorFlow:构建智能系统的概念、工具和技术</a>。</p><blockquote class="ms mt mu"><p id="a258" class="lg lh mc li b lj lk ju ll lm ln jx lo mv lq lr ls mw lu lv lw mx ly lz ma mb im bi translated"><a class="ae ky" href="https://www.dimpo.me/newsletter" rel="noopener ugc nofollow" target="_blank">学习率</a>是我每周给那些对 AI 和 MLOps 世界好奇的人发的简讯。你会在每周五收到我关于最新人工智能新闻、研究、回购和书籍的更新和想法。在这里订阅<a class="ae ky" href="https://www.dimpo.me/newsletter" rel="noopener ugc nofollow" target="_blank"/>！</p></blockquote><h1 id="f725" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">数据集</h1><p id="2ee9" class="pw-post-body-paragraph lg lh it li b lj nq ju ll lm nr jx lo lp ns lr ls lt nt lv lw lx nu lz ma mb im bi translated">对于这个例子，我们使用<a class="ae ky" href="https://www.kaggle.com/camnugent/california-housing-prices" rel="noopener ugc nofollow" target="_blank"> <em class="mc">加州房价</em> </a> <em class="mc"> </em>数据集。这个数据集对于入门教程来说是极好的，因为它熟悉的性质、很少丢失的值、适度的大小和明确的目标。</p><p id="cbe8" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">该数据集基于 1990 年加州人口普查的数据。任务是在给定一组特征(如房龄、总房间数等)的情况下，预测特定地区房屋的<em class="mc">中值</em>。).目标变量或因变量(即中值房价)是一个数值。因此，我们有一个回归任务要处理。</p><p id="930d" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">数据集的特性是不言自明的，但是让我们使用<code class="fe nv nw nx ny b">pandas</code>加载 CSV 文件并查看前五行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/615a902b8e7791a35eb4ec3cf27ea5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dhL3pm8TD9GKNnUNmI0utA.png"/></div></div></figure><p id="33b6" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们可以执行更多的方法来获得对数据的感觉，如<code class="fe nv nw nx ny b">df.info()</code>或<code class="fe nv nw nx ny b">df.describe()</code>，而每个数值实例的简单直方图——使用<code class="fe nv nw nx ny b">df.hist()</code>方法——会给我们手中的信息提供更好的图片<strong class="li iu"> </strong>。但是，由于这不是本文的范围，让我们进入下一步，即将数据集分成训练集和测试集。</p><h1 id="ec2c" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">随意采样</h1><p id="fffc" class="pw-post-body-paragraph lg lh it li b lj nq ju ll lm nr jx lo lp ns lr ls lt nt lv lw lx nu lz ma mb im bi translated">理论上，创建一个测试集确实很容易；只需随机选择几行——通常是整个数据集的 10%或 20%——并将它们保存在一个新的单独的数据帧中。此外，为了可再现性，我们可以设置一个<code class="fe nv nw nx ny b">random_state</code>数，这样每次我们运行一个实验，都会得到相同的测试集。这也有助于直接比较不同的方法，因为我们选择的每个算法都是在同一个测试集上评估的。</p><p id="cf5f" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">接下来，我们使用由<a class="ae ky" href="https://scikit-learn.org/" rel="noopener ugc nofollow" target="_blank"> Scikit 提供的一个方便的方法——Learn</a>命名为<code class="fe nv nw nx ny b">train_test_split()</code>。该方法接受列表、numpy 数组、scipy 稀疏矩阵或 pandas 数据帧。我们还应该提供默认的分割百分比<code class="fe nv nw nx ny b">None</code>和一个<code class="fe nv nw nx ny b">random_state</code>数字。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="8d08" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们可以看到该方法返回了一个<code class="fe nv nw nx ny b">tuple</code>，我们可以将它直接解包成一个训练和一个测试集。因为我们将一个数据帧传递给该方法，所以得到的训练集和测试集也是数据帧。请记住，默认情况下，该方法首先打乱数据集，然后将其拆分。为了避免这种行为，我们可以将<code class="fe nv nw nx ny b">shuffle</code>属性设置为<code class="fe nv nw nx ny b">False</code>。</p><blockquote class="md"><p id="72bd" class="me mf it bd mg mh mi mj mk ml mm mb dk translated">通常，如果数据集足够大(特别是相对于属性的数量)，随机分割就足够了。但如果不是这样，随机分裂可能会引入显著的采样偏差。</p></blockquote><pre class="oc od oe of og oh ny oi oj aw ok bi"><span id="82f8" class="ol mz it ny b gy om on l oo op">train_set, test_set = train_test_split(df, test_size=.2, random_state=42, shuffle=False)</span></pre><p id="8a25" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们现在有一个随机生成的测试集来评估我们的模型。但是这有什么好处吗？<strong class="li iu">是否代表总体？</strong> <strong class="li iu">嗯，看情况。通常，如果数据集足够大(特别是相对于属性的数量)，随机分割就足够了。但如果不是这样，随机分裂可能会引入显著的采样偏差。因此，让我们来看看如何解决这个问题。</strong></p><h1 id="3548" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">分层抽样</h1><p id="6725" class="pw-post-body-paragraph lg lh it li b lj nq ju ll lm nr jx lo lp ns lr ls lt nt lv lw lx nu lz ma mb im bi translated">假设我们正在美国进行一项调查，记录一个特定州的教育水平和收入中位数。如果我们只询问生活在昂贵地区的人，我们肯定会在样本中引入明显的偏见。因此，我们需要一种方法来选择任何经济地位的人，粗略地接近相应的人口分布。</p><p id="b150" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在我们的例子中，让我们首先检查是否有一个变量与我们的目标变量高度相关。使用<code class="fe nv nw nx ny b">pandas.corr()</code>方法很容易做到这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="8c60" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们将因变量的结果按降序排列，我们得到<code class="fe nv nw nx ny b">median_income</code>与<code class="fe nv nw nx ny b">median_house_value</code>有很强的正相关性。这肯定是意料之中的事情。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/eb61db7046d0e3e17e4ce6b5cdaf8412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*PLnb_HMibOG-sPBEtMfksg.png"/></div></figure><p id="cd1e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">似乎以分层的方式分割数据集，使用<code class="fe nv nw nx ny b">median_income</code>作为类别标签是一个好主意。首先，让我们创建一个新的变量，为这个属性创建类标签。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="f643" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe nv nw nx ny b">pd.cut</code>将根据我们指定的分类创建五个类别，并将它们保存在一个新变量中，我们将其命名为<code class="fe nv nw nx ny b">income_cat</code>用于收入类别。我们现在准备以分层的方式分割我们的数据集。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="182b" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">唯一的变化是我们现在用一个类似数组的对象设置了<code class="fe nv nw nx ny b">train_test_split()</code>方法的<code class="fe nv nw nx ny b">stratify</code>参数，该对象设置了标签类。还有另一种更复杂的方法，在下面的代码示例中指定，用于遗留目的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="63ab" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">无论如何，让我们看看我们做得怎么样。我们将在完整的数据集以及测试样本中检查每个收入类别的比率。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="a03e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">让我们并排比较两个结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/97e8cd0a0929541d6e6e59f7a3e47955.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*jm45e4eBOAxfNQ2qaCoHXQ.png"/></div></div></figure><p id="026d" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">可以看出我们很亲近。微小的差异真的微不足道。我们现在有了一个测试集，它遵循人口中收入类别的分布！</p><h1 id="a7f3" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">结论</h1><p id="2826" class="pw-post-body-paragraph lg lh it li b lj nq ju ll lm nr jx lo lp ns lr ls lt nt lv lw lx nu lz ma mb im bi translated">创建测试集并不总是那么简单。我们必须确保测试集非常接近我们人口的复杂性。我们的验证集也是如此。例如，检查 Scikit-Learn 提供的<code class="fe nv nw nx ny b"><a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.StratifiedKFold.html#sklearn.model_selection.StratifiedKFold" rel="noopener ugc nofollow" target="_blank">StratifiedKFold()</a></code>方法。</p><p id="aa64" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在这个故事中，我们看到了如何以分层的方式将数据集随机分为训练集和测试集。我们使用 Scikit-Learn 库在 Python 中实现了相应的解决方案。最后，我们提供了每种方法的细节和优点，以及何时使用每种方法的简单实用规则。</p><blockquote class="ms mt mu"><p id="c076" class="lg lh mc li b lj lk ju ll lm ln jx lo mv lq lr ls mw lu lv lw mx ly lz ma mb im bi translated"><a class="ae ky" href="https://www.dimpo.me/newsletter" rel="noopener ugc nofollow" target="_blank">学习率</a>是我每周给那些对 AI 和 MLOps 世界好奇的人发的简讯。你会在每周五收到我关于最新人工智能新闻、研究、回购和书籍的更新和想法。订阅<a class="ae ky" href="https://www.dimpo.me/newsletter" rel="noopener ugc nofollow" target="_blank">这里</a>！</p></blockquote><p id="b5e5" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li iu"> <em class="mc">我叫 Dimitris Poulopoulos，是希腊比雷埃夫斯大学的机器学习研究员</em></strong><a class="ae ky" href="https://bigdatastack.eu/" rel="noopener ugc nofollow" target="_blank"><strong class="li iu"><em class="mc">BigDataStack</em></strong></a><strong class="li iu"><em class="mc">和博士(c)。我曾为欧洲委员会、欧盟统计局、国际货币基金组织、欧洲中央银行、经合组织和宜家等主要客户设计和实施人工智能和软件解决方案。如果你有兴趣阅读更多关于机器学习、深度学习和数据科学的帖子，请在 twitter 上关注我的</em> </strong> <a class="ae ky" href="https://medium.com/@dpoulopoulos" rel="noopener"> <strong class="li iu"> <em class="mc">中</em> </strong> </a> <strong class="li iu"> <em class="mc">，</em></strong><a class="ae ky" href="https://www.linkedin.com/in/dpoulopoulos/" rel="noopener ugc nofollow" target="_blank"><strong class="li iu"><em class="mc">LinkedIn</em></strong></a><strong class="li iu"><em class="mc">或</em></strong><a class="ae ky" href="https://twitter.com/james2pl" rel="noopener ugc nofollow" target="_blank"><strong class="li iu"><em class="mc">@ james2pl</em></strong></a><strong class="li iu"><em class="mc"/>T47】</strong></p></div></div>    
</body>
</html>