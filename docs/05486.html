<html>
<head>
<title>Automated Machine Learning (AutoML) Gentle Introduction — TPOT module case</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动机器学习(AutoML)简介— TPOT模块案例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automated-machine-learning-automl-gentle-introduction-tpot-module-case-f5d5a73b2b29?source=collection_archive---------35-----------------------#2020-05-08">https://towardsdatascience.com/automated-machine-learning-automl-gentle-introduction-tpot-module-case-f5d5a73b2b29?source=collection_archive---------35-----------------------#2020-05-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="46e6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">自动机器学习模块简介</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d7dd9987eed117c8c3537a52d80d6065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OiY5yQIL5rR_w9mC"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">斯坦纳·恩格兰在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="40b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据<a class="ae ky" href="https://en.wikipedia.org/wiki/Automated_machine_learning" rel="noopener ugc nofollow" target="_blank">维基百科</a>的说法，自动机器学习或<strong class="lb iu"> AutoML </strong>是将机器学习应用于现实世界问题的过程自动化的过程。AutoML旨在从原始数据到可部署的机器学习模型建立一个完整的管道。用一个更简单的术语来说，<strong class="lb iu"> AutoML能够自动创建一个机器学习模型，而不需要先前</strong>的模型的先验知识。AutoML本身仍然是人工智能领域最受欢迎的产品之一。</p><p id="d5f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.gartner.com/smarterwithgartner/top-trends-on-the-gartner-hype-cycle-for-artificial-intelligence-2019/" rel="noopener ugc nofollow" target="_blank">直到2019年或者最近</a>，AutoML正处于人们对人工智能期望的巅峰。不管是什么原因让人们大肆宣传AutoML，不可否认的是，这个AutoML将极大地改变人们在数据科学领域的工作方式。作为一名数据科学家，我也在日常工作中应用AutoML。</p><p id="f60c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AutoML是未来，但它并不像没有任何不利的一面。关于AutoML，我注意到的几件事是:</p><ul class=""><li id="b803" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">它不会取代数据科学家的工作。我们毕竟是人，是决定哪种结果可以产生和部署的人。</li><li id="5f07" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">数据还是最重要的。</strong>您可以将任何原始数据放入模型，但是不需要任何预处理或关于数据的进一步知识；不会有好的结果。</li><li id="09df" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">预测指标是唯一的目标</strong>。在数据科学工作中，预测模型不一定是我们唯一想要的东西。大多数时候，我们想要的是模型对数据的解释。如果你的目标是知道什么特性是最重要的，那么AutoML是不合适的。</li></ul><p id="9a1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然有一些缺点，但AutoML仍然是数据科学领域的一个突破，作为一名数据科学家，了解它是理所当然的。在这篇文章中，我想介绍如何实现AutoML和一个AutoML模块；TPOT。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="9255" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">TPOT</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/5b53ff9d25360c69aafb2718d9899321.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*HqvCtfEGy3J2SRow5wEr3w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TPOT 的好意</p></figure><p id="0350" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://epistasislab.github.io/tpot/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"/></a><strong class="lb iu"/>是一个优化机器学习流水线的Python AutoML模块。它将智能地探索成千上万个可能的管道，以找到最适合您的数据的管道，一旦它完成搜索(或者您厌倦了等待)，它会为您提供找到的最佳管道的Python代码，以便您可以从那里修补管道。在TPOT探索的大部分python代码都是基于Python模块<a class="ae ky" href="https://scikit-learn.org/stable/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Scikit-learn </strong> </a>(不限于，但大部分都是)的，这是大多数使用Python从事ML工作的人所熟悉的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/53ea268098a02cee3cbd2d3f36fd0eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*499zcOssmP66QTs2oM4gYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">机器学习管道的例子。由<a class="ae ky" href="https://epistasislab.github.io/tpot/" rel="noopener ugc nofollow" target="_blank"> TPOT </a>提供</p></figure><p id="bcde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">探索过程基于<strong class="lb iu">遗传编程</strong>。根据<a class="ae ky" href="https://en.wikipedia.org/wiki/Genetic_programming" rel="noopener ugc nofollow" target="_blank">维基百科</a>的说法，这是一种进化程序的技术，我们从不适合的(通常是随机的)程序群体开始，通过对程序群体应用类似于自然遗传过程的操作来适应特定的任务。更简单地说，<strong class="lb iu">它从随机ML模型开始，通过选择模型(和参数)的随机过程，它将走向最佳模型的方向。</strong>TPOT使用的参数中有许多生物技术术语，但我会在后面解释一些重要的参数。</p><p id="00f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">TPOT既用于分类问题，也用于回归问题，基本上是一个监督学习问题，我们需要预测目标数据。让我们试着用TPOT做一个例子。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="758c" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">TPOT的例子</h1><p id="efc4" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">出于学习目的，我将使用从<a class="ae ky" href="https://www.kaggle.com/ronitf/heart-disease-uci" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>获得的心脏病数据集。数据的快照如下所示。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="80a6" class="nu mr it nq b gy nv nw l nx ny">import pandas as pd<br/>heart = pd.read_csv('heart.csv')<br/>heart.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/fe5a50189e88eae49d0c1d502883d553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i0Qwm3HMDnnYbx_WQ6jBZQ.png"/></div></div></figure><p id="eda3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以阅读源中每一列的解释，但是这个数据集正在处理一个分类问题；不管某人是否有心脏病。我不会做任何数据预处理，因为我的意图只是给出一个TPOT如何工作的例子。</p><p id="63c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要<a class="ae ky" href="https://epistasislab.github.io/tpot/installing/" rel="noopener ugc nofollow" target="_blank">安装</a>模块。使用TPOT的建议是使用Python的<a class="ae ky" href="https://www.continuum.io/downloads" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">【Anaconda】</strong></a><strong class="lb iu"/>发行版，因为许多必要的模块已经存在。然后，我们通过pip或conda安装模块。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="6f7e" class="nu mr it nq b gy nv nw l nx ny">#Using pip<br/>pip install tpot</span><span id="d3b0" class="nu mr it nq b gy oa nw l nx ny">#or if you prefer conda<br/>conda install -c conda-forge tpot</span></pre><p id="f45e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们准备使用TPOT模块来尝试我们的AutoML。让我们导入所有模块，并准备我们将使用的数据。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="15da" class="nu mr it nq b gy nv nw l nx ny">#Import the TPOT specific for classification problem<br/>from tpot import TPOTClassifier</span><span id="f21b" class="nu mr it nq b gy oa nw l nx ny">#We use the train_test_split to divide the data into the training data and the testing data<br/>from sklearn.model_selection import train_test_split</span><span id="a23c" class="nu mr it nq b gy oa nw l nx ny">#Dividing the data. I take 20% of the data as test data and set the random_state for repeatability</span><span id="30e3" class="nu mr it nq b gy oa nw l nx ny">X_train, X_test, y_train, y_test = train_test_split(heart.drop('target', axis = 1), heart['target'], test_size = 0.2, random_state = 101)</span></pre><p id="c413" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有的准备工作都已就绪，现在让我们尝试使用TPOT的AutoML来解决分类问题。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="d43c" class="nu mr it nq b gy nv nw l nx ny">tpot = TPOTClassifier(generations=100, population_size=100,<br/>                          offspring_size=None,<br/>                          scoring='accuracy',<br/>                          max_time_mins=None, <br/>                          max_eval_time_mins=5,<br/>                          random_state=101,<br/>                          warm_start=True,<br/>                          early_stop=20,<br/>                          verbosity=2)</span></pre><p id="6ad8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个分类器似乎有很多参数，是的。您可以在这里检查TPOTClassifier <a class="ae ky" href="https://epistasislab.github.io/tpot/api/" rel="noopener ugc nofollow" target="_blank">中存在的所有参数，但是我将在下面解释一些重要的参数:</a></p><ul class=""><li id="0035" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">世代</strong>控制运行流水线优化过程的迭代次数。</li><li id="bc79" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> population_size </strong>控制每一代遗传编程群体中保留的个体数量。</li><li id="7d78" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">后代尺寸</strong>控制每一代遗传程序中产生的后代数量。默认情况下，它等于第<strong class="lb iu">代</strong>的大小。</li></ul><p id="d9d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，TPOT将评估<strong class="lb iu"> <em class="ob">人口_规模</em> </strong> + <strong class="lb iu"> <em class="ob">世代</em> </strong> × <strong class="lb iu"> <em class="ob">后代_规模</em> </strong>管道。因此，上面我们将有100 + 100 × 100个管道需要评估。</p><p id="7d2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他重要参数包括:</p><ul class=""><li id="b63c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">评分</strong>控制功能用于评估给定管道对于分类问题的质量。参见评分功能<a class="ae ky" href="https://epistasislab.github.io/tpot/using/#scoring-functions" rel="noopener ugc nofollow" target="_blank">这里的</a>了解可以使用的评分功能。</li><li id="7f17" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> max_time_mins </strong>控制TPOT优化管道的时间。如果是没有，那么TPOT将不会有任何时间限制做优化。</li><li id="5c42" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> max_eval_time_mins </strong>控制TPOT评估单个管道的时间。更长的时间意味着TPOT可以评估更复杂的管道，但需要更长的时间。</li><li id="540b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> warm_start </strong>是指示TPOT实例是否将重用来自先前调用的群体的标志。设置<em class="ob"> warm_start </em> =True可用于在数据集上短时间运行TPOT，检查结果，然后从停止的地方继续TPOT运行。</li><li id="b361" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> early_stop </strong>控制多少代TPOT检查优化过程中是否没有改进。如果在给定的数量之后没有更多的改进，那么TPOT将停止优化过程。</li></ul><p id="1978" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据上面的参数，让我们尝试用我们的训练数据来拟合TPOTClassifier。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="1dad" class="nu mr it nq b gy nv nw l nx ny">tpot.fit(X_train, y_train)</span></pre><p id="88b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">优化过程如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/dcfd3316619b2b76dcb1ca17ce71d278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*pHAk9wsR9XSCMSeWLtRaGg.gif"/></div></div></figure><p id="8be0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果<strong class="lb iu">每个管道都已经被评估，达到时间限制，达到提前停止限制，或者简单地终止</strong>，优化过程将停止。下面是我们之前尝试的AutoML过程的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/37dfdd119e950ef6c2f84038938a9ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gYPa-VcQUBfmYG99CwUMfg.png"/></div></div></figure><p id="cd56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">管道似乎已达到最大提前停止次数，并到达最佳管道。当然，由于这是一个随机过程，如果我再运行一次，我可能会得到一个完全不同的模型。</p><p id="8217" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们对照测试数据进行测试，让我们检查模型性能。我们可以使用优化的TPOT模型作为预测模型。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="66b6" class="nu mr it nq b gy nv nw l nx ny">from sklearn.metrics import classification_report<br/>print(classification_report(y_test, tpot.predict(X_test)))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/fe9a4cc811d6937fc7d81219157b9154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*_vgzkNxKzBcxnc4DuCX2CA.png"/></div></figure><p id="28ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管没有做任何预处理，这个模型看起来很好，虽然我敢打赌，如果我们分析数据，我们可以得到一个更好的模型，但让我们把它留在那里。</p><p id="46f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果您想拥有一套完整的管道<strong class="lb iu">自动导出</strong>，您可以使用下面的代码。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="56be" class="nu mr it nq b gy nv nw l nx ny">#Give any name you want but still contain the .py extension<br/>tpot.export('tpot_heart_classifier.py')</span></pre><p id="aaac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的管道将显示在您的文件夹中，就在您的笔记本所在的文件夹中。如果您打开该文件，它将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/4c0f0a353040fecd9113729f3dfa416f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMkduJd2Xik7tsb0TfTr3A.png"/></div></div></figure><p id="cf8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，我们不仅得到了最好的管道，还得到了完整的流程纲要。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ebf4" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="9f92" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">我只是向你展示如何使用TPOT汽车。这个过程很简单，从评估的角度来看，结果还不错。虽然，<strong class="lb iu"> AutoML不是实现最终结果模型</strong>的工具；事实上，AutoML只是作为模型优化的开始，因为它可以为我们指明前进的方向。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="aa3d" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">如果您喜欢我的内容，并希望获得更多关于数据或数据科学家日常生活的深入知识，请考虑在此订阅我的<a class="ae ky" href="https://cornellius.substack.com/welcome" rel="noopener ugc nofollow" target="_blank">简讯。</a></h1><blockquote class="og"><p id="91a0" class="oh oi it bd oj ok ol om on oo op lu dk translated">如果您没有订阅为中等会员，请考虑通过<a class="ae ky" href="https://cornelliusyudhawijaya.medium.com/membership" rel="noopener">我的推荐</a>订阅。</p></blockquote></div></div>    
</body>
</html>