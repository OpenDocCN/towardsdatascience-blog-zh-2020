<html>
<head>
<title>Build a Twitter Bot for Coronavirus update</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为冠状病毒更新构建一个Twitter机器人</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-a-twitter-bot-for-coronavirus-update-8cfec4314b0d?source=collection_archive---------29-----------------------#2020-04-04">https://towardsdatascience.com/build-a-twitter-bot-for-coronavirus-update-8cfec4314b0d?source=collection_archive---------29-----------------------#2020-04-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7fc5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在本文中，我们将学习如何使用Python和Tweepy构建一个twitter机器人来发布冠状病毒的统计数据。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ba4ca399632288a46b9cf7109859960b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oMzXgRchqigvlkFJ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@yucelmoran?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">于切尔·莫兰</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="9e0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">编者按:</em> </strong> <em class="ls"> </em> <a class="ae kv" href="http://towardsdatascience.com/" rel="noopener" target="_blank"> <em class="ls">走向数据科学</em> </a> <em class="ls">是一份以数据科学和机器学习研究为主的中型刊物。我们不是健康专家或流行病学家，本文的观点不应被解释为专业建议。想了解更多关于疫情冠状病毒的信息，可以点击</em> <a class="ae kv" href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports" rel="noopener ugc nofollow" target="_blank"> <em class="ls">这里</em> </a> <em class="ls">。</em></p><p id="3851" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Twitter提供了一个API ，用户可以通过它与平台进行交互。Tweepy是一个python库，它提供了一种方便访问twitter API的方法。它是底层API的高级包装器。</p><p id="a057" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果想直接上码，<a class="ae kv" href="https://github.com/sagunsh/corona_twitter_bot" rel="noopener ugc nofollow" target="_blank">点这里</a>。</p><h1 id="57a7" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">装置</h1><p id="2878" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们将在这个项目中使用Python 3。我们首先需要的是tweepy。让我们使用pip安装它。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="ae22" class="mv lu iq mr b gy mw mx l my mz">pip install tweepy</span></pre><blockquote class="na nb nc"><p id="d3d2" class="kw kx ls ky b kz la jr lb lc ld ju le nd lg lh li ne lk ll lm nf lo lp lq lr ij bi translated">Linux和Mac用户可能必须使用pip3，而不是Python 2使用的pip</p></blockquote><h1 id="8a1e" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">Twitter API</h1><p id="5af5" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">为了访问twitter API，我们需要有一个twitter帐户。如果还没有，就创建一个吧。为了使用API，请确保您已经验证了您的电子邮件和电话号码。</p><p id="ed09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后转到<a class="ae kv" href="https://developer.twitter.com/en" rel="noopener ugc nofollow" target="_blank">开发者页面</a>并点击左上角的<strong class="ky ir">应用</strong>或直接转到<a class="ae kv" href="https://developer.twitter.com/en/apply-for-access" rel="noopener ugc nofollow" target="_blank">应用页面</a>。然后点击“申请开发者账号”。根据您的需要选择适当的选项，然后单击“下一步”回答问题。Twitter会询问一些基本信息，比如你将如何使用API，你来自哪个国家，等等。一旦一切都完成了，你可能要等一两天才能得到验证。</p><p id="5574" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">验证完成后，转到<a class="ae kv" href="https://developer.twitter.com/en/apps" rel="noopener ugc nofollow" target="_blank">应用页面</a>并创建一个应用。为您的应用程序命名(确保它是唯一的)，添加描述和网站url。在底部，你必须详细描述你将如何使用该应用程序。然后按创建。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/19ad9f980022f28d0ca704bbe543bfc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DajQzZI8cozQ9pBWLMsCtQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Twitter应用程序</p></figure><p id="728b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦你进入如图所示的应用程序页面。转到“密钥和令牌”。生成访问令牌和访问令牌密码。显示密钥时，将密钥复制到某个文本文件中。</p><p id="a9d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在创建一个文件config.py并添加所有4个键，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">配置. py</p></figure><p id="b4a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在config.py所在的同一个文件夹中创建另一个文件twitter_bot.py，并添加以下代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">twitter_bot.py</p></figure><p id="2805" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在使用命令运行该文件</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="a563" class="mv lu iq mr b gy mw mx l my mz">python twitter_bot.py</span></pre><p id="a91b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码非常简单。我们正在导入tweepy库和所有需要的键。然后我们通过传递我们的键来创建一个api对象。如果成功，将打印“认证成功”，否则将打印“认证API时出错”。我希望你得到正确的认证。去看看你的推特账户，你会看到一条推文。</p><h1 id="0583" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">收集冠状病毒统计数据</h1><p id="c6f5" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我发现了https://www.worldometers.info/coronavirus/<a class="ae kv" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank">的这个网站，上面显示了受影响、死亡和康复的总人数。我们将从该页面抓取数据，创建一条推文，并从我们的帐户发布。</a></p><p id="f51c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们安装请求和lxml库。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="7a40" class="mv lu iq mr b gy mw mx l my mz">pip install requests lxml</span></pre><p id="c069" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">requests用于向web页面发送HTTP请求，lxml用于使用Xpath解析返回的HTML内容。如果您不熟悉Xpath，我将链接下面的一些资源来了解更多。顺便说一下，你也可以使用BeautifulSoup来解析HTML而不是lxml。</p><p id="483d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所有这些依赖项都在github repo的requirements.txt文件中。您可以使用以下命令一次性安装所有程序</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="f087" class="mv lu iq mr b gy mw mx l my mz">pip install -r requirements.txt</span></pre><p id="5b54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开https://www.worldometers.info/coronavirus/的<a class="ae kv" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank"/>，右键点击“冠状病毒病例”正下方的数字，点击<strong class="ky ir">检查</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/bf1a03376dbb7070423367b069944647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5X_JZ6eDgZApPwvxscH4Zg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">检查HTML</p></figure><p id="c9d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据位于span标记中，该标记位于具有maincounter-number类的div中。如果你检查死亡和恢复部分，你会看到结构是相同的。让我们打开python外壳，看看是否能得到数据。在您的cmd/终端中，键入python。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="63c7" class="mv lu iq mr b gy mw mx l my mz">&gt;&gt;&gt; import requests<br/>&gt;&gt;&gt; from lxml import html<br/>&gt;&gt;&gt; response = requests.get('<a class="ae kv" href="https://www.worldometers.info/coronavirus/'" rel="noopener ugc nofollow" target="_blank">https://www.worldometers.info/coronavirus/'</a>)<br/>&gt;&gt;&gt; doc = html.fromstring(response.content)<br/>&gt;&gt;&gt; doc.xpath('//div[<a class="ae kv" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>="maincounter-number"]/span/text()')<br/>['805,377 ', '39,469', '172,436']</span></pre><p id="f16b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，我们向目标页面<a class="ae kv" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank">发送请求，并解析返回的HTML。如果你看最后一行，xpath是不言自明的。它说，找到所有带有类maincounter-number的div，并提取该div中span元素的文本。这里我们有3个匹配的元素，因此打印了3个值。</a></p><p id="ae9c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以在脚本中实现相同的逻辑。打开twitter_bot.py，创建一个名为<strong class="ky ir"> create_tweet() </strong>的函数，并在import语句的正下方添加抓取代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="1606" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们正在使用<a class="ae kv" href="https://realpython.com/python-f-strings/#f-strings-a-new-and-improved-way-to-format-strings-in-python" rel="noopener ugc nofollow" target="_blank"> Python的f字符串</a>创建一条推文。我添加了一些相关的标签，但是你可以根据自己的需要随意设置推特的格式。不要忘了给世界计程仪积分。</p><p id="bda6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加完所有内容后，我们的最终代码应该是这样的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="e0ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在从终端/cmd运行您的代码。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="9888" class="mv lu iq mr b gy mw mx l my mz">python twitter_bot.py</span></pre><p id="2e92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后检查你的推特账户，你会看到一条这样的推文</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk ni l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">通过visualizenoworg发布推文</p></figure><p id="8b7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想在脚本中添加更多的功能，比如每隔X分钟从一个无限循环中发出tweet。或者安排这个脚本每隔Y分钟从cron运行一次。你可以创建一个完全不同的机器人，从你的账户发布最新消息。可能性是无限的。还要确保检查<a class="ae kv" href="https://developer.twitter.com/en/docs/ads/general/guides/rate-limiting" rel="noopener ugc nofollow" target="_blank">速率限制</a>。</p><p id="424f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Twitter API允许你与应用程序交互，收集数据，分析推文等等。要了解更多信息，你可以查看twitter的官方文档。</p><h1 id="1b1c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">资源</h1><ol class=""><li id="34ad" class="nl nm iq ky b kz ml lc mm lf nn lj no ln np lr nq nr ns nt bi translated">官方文件:<a class="ae kv" href="https://developer.twitter.com/en/docs" rel="noopener ugc nofollow" target="_blank">https://developer.twitter.com/en/docs</a></li><li id="e050" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">十二份文件:<a class="ae kv" href="http://docs.tweepy.org/en/latest/" rel="noopener ugc nofollow" target="_blank">http://docs.tweepy.org/en/latest/</a></li><li id="5ffc" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">Xpath教程:<a class="ae kv" href="https://docs.scrapy.org/en/xpath-tutorial/topics/xpath-tutorial.html" rel="noopener ugc nofollow" target="_blank">https://docs . scrapy . org/en/XPath-tutorial/topics/XPath-tutorial . html</a></li><li id="147d" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">另一个推特机器人:<a class="ae kv" href="https://realpython.com/twitter-bot-python-tweepy/" rel="noopener ugc nofollow" target="_blank">https://realpython.com/twitter-bot-python-tweepy/</a></li><li id="ac50" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">代码:<a class="ae kv" href="https://github.com/sagunsh/corona_twitter_bot" rel="noopener ugc nofollow" target="_blank">https://github.com/sagunsh/corona_twitter_bot</a></li></ol></div></div>    
</body>
</html>