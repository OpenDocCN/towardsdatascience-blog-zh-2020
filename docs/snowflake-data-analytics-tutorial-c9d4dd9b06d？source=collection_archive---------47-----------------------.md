# 雪花数据分析教程

> 原文：<https://towardsdatascience.com/snowflake-data-analytics-tutorial-c9d4dd9b06d?source=collection_archive---------47----------------------->

![](img/f527aed91537055649f24a666ab707f0.png)

托马斯·耶茨在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

# 目录

*   [简介](#ead8)
*   [创建雪花数据源](#303e)
*   [查询您的数据源](#afdd)
*   [分析您的数据并添加可视化效果](#edd1)
*   [在可视化效果上使用钻取](#d4cc)
*   [使用基于搜索的分析来查询您的数据](#abde)
*   [总结](#d58b)

# 介绍

[雪花](https://www.snowflake.com/)是一个专门构建的 SQL 云数据平台，自 2014 年推出以来，以近乎前所未有的速度增长；okta Inc .[的 2020 年 business @ Work](https://www.okta.com/businesses-at-work/2020/)报告发现，雪花是世界上增长最快的应用程序。鉴于其无与伦比的灵活性、顶级的安全性、存储的自动扩展以及与各种 BI 工具的无缝集成，雪花的增长很容易协调。

在提供雪花集成的 BI 工具中，只有一个完全是雪花自带的，支持嵌套对象和数组: [Knowi](https://www.knowi.com/) 。这使用户能够在分析数据的同时获得雪花的可扩展性和安全性的好处。如果你想学习更多关于使用 Knowi 分析雪花数据的知识，这篇教程是为你准备的。

# 创建雪花数据源

一旦您设置了免费的 [Knowi 试用帐户](https://www.knowi.com/free-trial)并登录，请遵循以下步骤:

1.找到并点击屏幕左侧面板上的“数据源”。

2.向下滚动到“数据仓库”并点击雪花。

3.现在，默认的模式名设置为 TPC-DS，其中包含产品、订单和客户的数据。我们将把模式改为 TPC-H，它包含决策支持系统的数据。为此，将模式名从 TPCDS_SF100TCL 更改为 TPCH_SF1，并单击“测试连接”

4.过一会儿，我会告诉你，你的连接成功了；完成后点击“保存”。

祝贺您设置了您的第一个雪花数据源！

# 查询您的数据源

现在您已经创建了一个数据源，您可以通过以下步骤对您的数据运行查询:

1.一旦保存了数据源，您应该会收到“Datasource Added”。配置查询。在你的页面顶部提醒。点击单词查询。(您也可以返回到屏幕左侧的面板，转到“数据源”下方，单击“查询”，然后从右上角选择“新查询+”。)

2.在屏幕左上方的“报告名称*”栏中命名您的报告。我们在这里使用的查询将严格模仿 TPC-H 模式中提供的默认函数查询，所以我们将它命名为“函数查询”

3.此默认查询模式列出了扩展价格、折扣扩展价格和折扣扩展价格加税的总额和平均值，以及总费用和行项目数，并按退货标志和行状态对这些数据进行分组。为了输入该查询，在查询构建器中转至“雪花查询”并输入以下语法:

```
select
       l_returnflag,
       l_linestatus,
       sum(l_quantity) as sum_qty,
       sum(l_extendedprice) as sum_base_price,
       sum(l_extendedprice * (1-l_discount)) as sum_disc_price,
       sum(l_extendedprice * (1-l_discount) * (1+l_tax)) as sum_charge,
       avg(l_quantity) as avg_qty,
       avg(l_extendedprice) as avg_price,
       avg(l_discount) as avg_disc,
       count(*) as count_order
 from
       lineitem
 where
       l_shipdate <= dateadd(day, -90, to_date('1998-12-01'))
 group by
       l_returnflag,
       l_linestatus
 order by
       l_returnflag,
       l_linestatus;
```

4.在运行该查询之前，我们希望再添加一列，将返回标志和行状态连接起来。这将使我们的数据更容易可视化。为了使用 cloud 9ql——Knowi 强大的 SQL 风格语言——进行这种后处理，请在“Cloud9QL Query”中输入以下语法

```
select concat(l_returnflag, " - ",  l_linestatus) as Flag - Status, *
```

5.前往屏幕底部，点击蓝色的“预览”按钮。这将返回 4 行 11 列的数据。一旦你确认了，点击屏幕右下角绿色的“保存并立即运行”按钮。

当您运行查询时，Knowi 自动将您的结果保存为虚拟数据集，并将这些结果作为数据集存储在其[弹性数据仓库](https://www.knowi.com/docs/data-warehouse.html)中。每次成功运行查询时，Knowi 都会这样做。

# 分析数据并添加可视化效果

正如您在数据预览中所看到的，退货标志和行状态有 4 种不同的组合:A-F、N-F、N-O 和 R-F。假设我们希望可视化各种指标，如订单数量的总和，按这些单独的标志-状态组合分组。Knowi 让我们只需几个步骤就能有效地实现这一点:

1.返回到屏幕左侧面板的顶部，单击“仪表板”单击橙色加号图标，并将您的仪表板命名为“TPC-H 可视化”

2.在你面板上的“仪表板”下方点击“部件”将您的“功能查询”小部件拖到您的新仪表板上。

3.现在，您的小部件只是一个包含我们查询结果的数据网格。我们希望保留这个数据网格，但要添加一个更引人注目的可视化，以便更快地传达信息。前往你的部件的右上角，点击 3 点图标，然后点击“分析”

4.将“Flag-Status”和“Sum_QTY”条从屏幕左侧拖到“Fields/Metrics:”框中。这显示了每个组合的总数量。现在，到你屏幕的顶部，点击“可视化”滚动到屏幕左上角的“可视化类型”，并将其从“数据网格”更改为“甜甜圈”

5.这个圆环图已经相当清楚地表明，大约四分之一的总量属于 R-F 和 A-F，大约属于 N-F，大约一半属于 N-O，但它仍然有助于向图表添加价值标签和百分比。为此，向下滚动到“选项”并点击它，然后选中“显示为百分比”和“标签值”下面的复选框

6.现在，回到屏幕的右上角，点击看起来像两张小纸片的“克隆”图标。当你这样做的时候，你会被要求命名你克隆的部件；将其命名为“按标记列出的总数量—状态”

7.单击“克隆”,然后单击“添加到仪表板”,将新的小部件添加到您的仪表板。

从这个图像中可以得出一个清晰的结论:大约四分之一的总量属于 R-F 和 A-F，大约一半属于 N-O，大约 1%属于 N-F。

# 在可视化中使用钻取

向下钻取为您的可视化添加了一个交互式组件，使您只需点击一下鼠标，即可深入到数据的过滤部分。按照以下流程添加明细:

1.单击您刚刚创建的“按标志列出的总量—状态”小部件右上角的 3 点图标，然后向下滚动并单击“明细”

2.将“Widget”设置为您的钻取类型，将其设置为在单击“SUM_QTY”时钻取“函数查询”。然后添加一个可选的明细过滤器，将“SUM_QTY”设置为“SUM_QTY”，并单击“保存”和“关闭”

3.通过单击 N-O(占总量最大份额的标志-状态组合)来测试您的明细。这显示了该组合的所有原始数据。要返回到最初的可视化效果，请转到小部件的右上角，然后单击中间的左箭头图标。

# 使用基于搜索的分析来查询您的数据

既然您已经建立了一个仪表板，并且熟悉了在 Knowi 中创建可视化，下一步就是开始使用[基于搜索的分析](https://www.knowi.com/search-based-analytics/)来查询您的数据。此功能使所有讲英语的人都可以访问您的仪表板，甚至是那些不了解数据或不熟悉 Knowi 的人。以下是如何使用基于搜索的分析来查询您的数据:

1.转到原来的“功能查询”小部件的右上角，单击 3 点图标。向下滚动并点击“分析”

2.假设您不关心这些信息的返回标志；您只想按线路状态对您的数据进行分组，并查看线路状态为 F 和 o 的数据已收取的总金额。只需前往屏幕顶部的搜索栏，该栏当前显示“对您的数据提出一个问题”，然后键入“按线路状态收取的总金额”

3.现在，为了直观显示这些数据，我们将遵循与之前完全相同的流程。返回“可视化”，并将可视化类型设置为“圆环”像以前一样，向下滚动并单击“选项”，然后选中“显示为百分比”和“标签-值”下面的复选框

4.返回右上角，再次单击“克隆”图标。将这个小部件命名为“按状态收费”，并将其添加到您的仪表板中。

这一可视化清晰地传达了状态为 F 的订单和状态为 O 的订单都共享大约 50%的总费用。

# 摘要

回顾一下，我们首先连接到一个样本雪花数据源，并在其上运行一个函数查询。这个查询的结果作为数据集存储在 Knowi 的弹性数据仓库中。之后，我们问了一个关于我们的数据的问题，创建了一个清晰地回答它的可视化，并向我们的可视化添加了钻取信息，使用户能够更深入地研究可视化背后的数据。最后，我们使用基于搜索的分析，用简单的英语问我们的数据另一个问题，并创建了另一个传达我们答案的可视化。