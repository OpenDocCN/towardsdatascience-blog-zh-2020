<html>
<head>
<title>Google Sheets API using Python — Python Programming</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 的 Google Sheets API——Python 编程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/google-sheets-api-using-python-python-programming-2a55543fbfcb?source=collection_archive---------41-----------------------#2020-08-15">https://towardsdatascience.com/google-sheets-api-using-python-python-programming-2a55543fbfcb?source=collection_archive---------41-----------------------#2020-08-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bce4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在这篇文章中，我们将讨论如何使用 Python 访问和编辑 Google Sheets</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/822dc6ec65b71ba29876503f97db464f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*2y6yeGEelya6sylbCAdlOQ.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="6b1d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">目录</strong></p><ul class=""><li id="c3aa" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">介绍</li><li id="9739" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">创建一个示例 Google Sheets 文档</li><li id="e22f" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">创建 Google API 凭据</li><li id="3968" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">使用 Python 打开 Google 工作表</li><li id="b3b9" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">使用 Python 选择/创建/删除工作表</li><li id="054d" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">使用 Python 编辑 Google 工作表中的数据</li><li id="f500" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">结论</li></ul></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="76b8" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">介绍</h1><p id="3864" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">使用 Python 从多个来源访问数据成为数据科学和分析领域几乎所有职位的标准要求。使用 Excel 电子表格和内部 CSV 文件随处可见。</p><p id="db73" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是如果你的数据现在以 Google Sheet 的形式存储在 Google Drive 上呢？当然你可以下载你选择的任何格式。然而，它不是一个可扩展的解决方案，因为它需要不断的人工输入。</p><p id="6f49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看看如何以编程的方式解决这个问题，甚至在使用 Python 处理 Google Sheets 时自动完成一些任务。</p><p id="938b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了继续学习本教程，我们需要两个 Python 库:gspread 和 oauth2client。</p><p id="a150" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您没有安装它们，请打开“命令提示符”(在 Windows 上)并使用以下代码安装它们:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="0862" class="nn mm it nj b gy no np l nq nr">pip install gspread<br/>pip install oauth2client</span></pre></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="8015" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">创建一个示例 Google Sheets 文档</h1><p id="aa9e" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">如果你正在阅读这篇文章，你可能已经有一个 Google Sheets 文档了。你想处理你的文件。出于本教程的目的，我将创建一个简单的 Google Sheets 文件，在其中复制学生的成绩数据集。本质上，我们将有三列:名、姓和年级。</p><p id="d33e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要创建您的第一个 Google Sheets 文件，请访问<a class="ae ns" href="https://www.google.com/drive/" rel="noopener ugc nofollow" target="_blank"> Google Drive </a>页面，使用您的 Google 帐户登录。一旦你进入，在左上角，点击新建，然后谷歌工作表。这将创建一个如下所示的空白文档:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/3ff8a4d0ac11b1892e9b0d47f61e1d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VcpBNUCcIXUKbTgH"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="a77c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个新文档是空的，没有任何数据或自己的文件名。</p><p id="e202" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在左上角，你会看到“无标题电子表格”，为了方便起见，让我们将其重命名为“我的谷歌表”。</p><p id="56cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们添加一些示例数据。我添加了一些简单的字段:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/a329af252aa27701850a2980375a3c3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_77k641_FmC9GUq4"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="aff1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">太好了。现在我们有一个文件，我们将继续工作。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="cf58" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">创建 Google API 凭据</h1><p id="c075" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">使用 Python 开始使用 Google Sheets 的第一步是为 Google Drive 和 Google Sheets 创建 API 凭证，这将允许我们连接到我们的文件。</p><p id="32e6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我们将前往<a class="ae ns" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">面向开发者的谷歌云控制台</a>，不用谷歌账户登录。</p><p id="c7a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦我们进入，在最顶端，您将看到以下按钮来创建一个项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/79bbe3112760bd7933fd2c43517be06b.png" data-original-src="https://miro.medium.com/v2/resize:fit:286/0*EboTaPQ6wi5qUtxI"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="3d34" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">点击它，它会带你到一个新的页面，在那里它会要求你为你的项目创建一个名称。我把我的命名为“gsheets-pyshark ”,然后点击“创建”。</p><p id="c103" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，在右上角，单击“bell”图标，您将看到一个通知，表明项目已经创建。在通知列表中，单击查看进入项目页面。</p><p id="9b5b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将把您带到项目的 API 仪表板。它应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/dbbfae29ceb7099a7b65242f0c8c7739.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8DW0Pguqd0B0oO_a"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="c8d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完美。到目前为止，我们使用 Python 创建了自己独特的项目来处理 Google Sheets。下一步是设置 API。</p><p id="f554" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">转到导航菜单(单击右上角的三条水平线)，选择 APIs &amp; Services，然后选择 Dashboard。您应该会看到以下页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/c5beaf15f42202e92ca4f0e8718f8d7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CDTRDBhb8P9fresl"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="c886" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如你所见，我们还没有任何可用的 API。我们需要添加它们。跟随屏幕中间的蓝色链接 API library 进入所有可用的 Google APIs 列表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/8723b709eacd67a51999cbb134bc5dee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gpftuUzlTiOMpbL4"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="43a7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里我们需要添加“Google Drive”API。通过在搜索框中键入名称找到它，单击它，然后单击启用。加载可能需要几秒钟。一旦启用，我们就会到达这里:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/efb35b0de93f0379e6cc9e930efd6606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kUrSHcBwxO0CoSrh"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="6f55" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">太棒了。Google Drive API 现已启用。要使用它，我们需要为它生成凭证。单击右上角的“创建凭据”,并像这样填写表单:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/ef3f09b8990762b72e4be9be6f0ff4f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nnMNneefYYv8RTAS"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="4dad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">填写完上面的表格后，继续点击蓝色按钮。我需要什么凭证？</p><p id="0a76" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在下一个表单中，您应该选择您的帐户名称(我将其设置为 misha-pyshark)和帐户在项目中的角色(我选择了 Owner)。“密钥类型”应该设置为 json，因为我们希望将凭证下载为. JSON 文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/258f60a675757335957968bbf6c562b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WCLhq0SbyGjNWV_H"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="1c92" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，单击 Continue，您的凭证将自动下载，您将看到一个弹出窗口，提示您的 API 凭证已创建。</p><p id="a638" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">重要提示</strong>:请将下载的 JSON 文件重命名为“mycredentials ”,这样在后面的代码中引用它会容易得多。此外，您应该将它放在 Python 代码所在的目录/文件夹中(这样我们可以节省指定文件位置的时间)。</p><p id="b300" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">到目前为止，我们已经启用了 Google Drive API，并为其下载了凭证。最后一步是启用 Google Sheets API。让我们回到<a class="ae ns" href="https://console.developers.google.com/apis/library" rel="noopener ugc nofollow" target="_blank">谷歌 API 库</a>，找到“谷歌工作表 API”。点击进入它，然后点击启用让它运行。</p><p id="08dd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们已经准备好使用 Python 访问 Google Sheets 了。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="4a24" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">使用 Python 打开 Google 工作表</h1><p id="538e" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">在 Python 中有多种方法来执行授权步骤。我在本教程中使用的方法在大多数关于这个主题的文章中被广泛使用，所以我决定用同样的方法。</p><p id="53f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为第一步，我们需要导入所需的库:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="c324" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在是时候用我们的凭证配置客户机了。这将创建 gspread 客户端:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="951c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一切都是为了检索我们之前创建的 Google Sheet 并从中获取所有记录。</p><p id="8488" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用 Python 有 3 种方法打开 Google 工作表:</p><h2 id="0c5d" class="nn mm it bd mn ob oc dn mr od oe dp mv ld of og mx lh oh oi mz ll oj ok nb ol bi translated">1.按名称打开谷歌工作表</h2><p id="a405" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">这里，我们只需要输入我们创建的 Google 工作表的实际名称:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="4fc0" class="nn mm it bd mn ob oc dn mr od oe dp mv ld of og mx lh oh oi mz ll oj ok nb ol bi translated">2.通过 URL 打开 Google 工作表</h2><p id="d7bb" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">要使用 URL 打开 Google 表单，您需要在浏览器中打开您的 Google 表单并复制它的地址。我的文件是:<a class="ae ns" href="https://docs.google.com/spreadsheets/d/1L7cYfMVPIiYPkTYe1bDwKPGfhAJXp8HCeg34Bh7VYl0/" rel="noopener ugc nofollow" target="_blank">https://docs . Google . com/spreadsheets/d/1 l7 cyfmvpiiypktye 1 bdwkpgfhajxp 8 hceg 34 BH 7 vyl 0/</a></p><p id="6f58" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们用<strong class="kw iu">。open_by_url() </strong>方法，并将我们的 url 作为参数传递:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="42b2" class="nn mm it bd mn ob oc dn mr od oe dp mv ld of og mx lh oh oi mz ll oj ok nb ol bi translated">3.按键打开谷歌工作表</h2><p id="61ec" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">按键打开 Google Sheet 与前面的选项非常相似。我们文件的关键是什么？很容易找到。密钥是 URL 的最后一个组成部分，位于最后两个斜杠(“/”)之间。在我的例子中是:1l 7 cyfmvpiiypktye 1 bdwkpgfhajxp8 hceg 34 BH 7 vyl 0</p><p id="d672" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们用<strong class="kw iu">。open_by_key() </strong>方法，并将我们的 URL 作为参数传递:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="c4b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">无论您决定继续哪种方式，它都会在我们的内存中创建一个对象，并将其存储为<strong class="kw iu"> gsheet </strong>。它到底包含了什么？简单地说，它的内容正是我们在创建这个 Google 表单时输入的内容。现在让我们从其中检索信息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="e3da" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的代码块中，我们打开并检索了“Sheet 1”中的所有数据，然后打印出来。它应该是这样的:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="1269" class="nn mm it nj b gy no np l nq nr">[{'first name': 'James', 'grade': 77, 'last name': 'Smith'},<br/>{'first name': 'Maria', 'grade': 68, 'last name': 'Johnson'},<br/>{'first name': 'Sam', 'grade': 59, 'last name': 'Erickson'},<br/>{'first name': 'David', 'grade': 89, 'last name': 'Williams'}]</span></pre><p id="bba1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们最终得到了一个每行都有值的列表。还要注意 Google Sheets 默认情况下是如何将第一行设置为列名的。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="aede" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">奖励</strong>:使用下面的代码，Google Sheet 可以很容易地转换成 Pandas dataframe:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="955f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们得到了一个更熟悉的输出:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="8d99" class="nn mm it nj b gy no np l nq nr">first name last name grade<br/>0 James Smith 77<br/>1 Maria Johnson 68<br/>2 Sam Erickson 59<br/>3 David Williams 89</span></pre></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="4754" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">使用 Python 选择/创建/删除工作表</h1><p id="74a9" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">在我们能够访问 Google 表单之后，让我们看看我们可以从什么开始。第一个检查点是我们在使用 Google Sheet 的不同工作表时的灵活性。</p><p id="3bb2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我的示例 Google Sheet 只包含一个名为“Sheet 1”的工作表。然而，拥有一个多工作表文件是很常见的。当然，当我们检索数据时，我们需要指定数据应该来自哪个工作表。这就把我们带到了第一个交互选项。</p><h2 id="92cd" class="nn mm it bd mn ob oc dn mr od oe dp mv ld of og mx lh oh oi mz ll oj ok nb ol bi translated">使用 Python 选择工作表</h2><p id="d397" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">回想一下，我们的 Google Sheet 在本地内存中保存为<strong class="kw iu"> gsheet </strong>。现在我们想从文件中按名称访问特定的工作表。我们要做的是创建一个只包含“Sheet1”数据的 Google 主工作表的子集，并打印其内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="7d5c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">结果应该与上一节相同，因为我们的文件中只有一个工作表:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="0864" class="nn mm it nj b gy no np l nq nr">first name last name grade<br/>0 James Smith 77<br/>1 Maria Johnson 68<br/>2 Sam Erickson 59<br/>3 David Williams 89</span></pre><h2 id="8446" class="nn mm it bd mn ob oc dn mr od oe dp mv ld of og mx lh oh oi mz ll oj ok nb ol bi translated">使用 Python 创建工作表</h2><p id="d2ce" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">现在，如果您想要另一个空工作表呢？当然，你可以通过浏览器登录你的 Google Drive 并手动创建。但是如果您的脚本作为自动化过程的一部分运行(这就是您可能正在阅读本文的原因)，我们希望从我们的 Python 代码中让一切工作起来。</p><p id="86e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">gspread 库的功能也允许我们创建新的工作表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="5d97" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码将使用给定的参数在我们的 Google Sheet 中创建新的工作表。请记住，您必须为要添加的工作表指定一个新名称以及行数和列数。</p><p id="dd8a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要检查它是否工作，请登录到您的 Google Drive 并查看 Google Sheet 文件，您将看到第二个工作表“新工作表”已添加到您的文件中。</p><h2 id="785d" class="nn mm it bd mn ob oc dn mr od oe dp mv ld of og mx lh oh oi mz ll oj ok nb ol bi translated">使用 Python 删除工作表</h2><p id="8c09" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">或者，您可能希望删除刚刚创建的工作表。现在，这里有一个小问题:您只能删除使用 Python 创建的工作表。在我的示例中，它是<strong class="kw iu"> newsheet </strong>，原因是存储在本地内存中的用于访问该特定工作表的格式:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="9587" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你再次检查你的谷歌工作表，你会看到“新工作表”已经被删除。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="14ef" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">使用 Python 编辑 Google 工作表中的数据</h1><p id="09b2" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">本节将讨论大多数最有用的功能。这就是我们使用 Python 编辑主文件中数据的地方。首先，我们需要定义将要使用的工作表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="36ee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">回想一下，我们正在处理的数据如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/c979f3ac97af0da01334d9ef002b71e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/0*Xv1a7W4v6LmIZACd"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><h2 id="42cc" class="nn mm it bd mn ob oc dn mr od oe dp mv ld of og mx lh oh oi mz ll oj ok nb ol bi translated">获取单元格值</h2><p id="ea11" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">假设我们想要从工作表的特定单元格中检索数据，并让该单元格为“A2”(我们要获取的数据是“James”)。我们将使用以下代码来实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="f575" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们得到了我们所期望的:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="4883" class="nn mm it nj b gy no np l nq nr">James</span></pre><h2 id="cf0c" class="nn mm it bd mn ob oc dn mr od oe dp mv ld of og mx lh oh oi mz ll oj ok nb ol bi translated">更新单元格值</h2><p id="0684" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">还有一种情况是，您希望更新单元格中的值。假设我们输入错误，需要将 A2 单元格中的名称从“James”改为“John”。可以使用以下代码简单地更改它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="d232" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">并重用前一部分的小代码块来获得更新后的值:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="134e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们得到:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="430d" class="nn mm it nj b gy no np l nq nr">John</span></pre><h2 id="b5dc" class="nn mm it bd mn ob oc dn mr od oe dp mv ld of og mx lh oh oi mz ll oj ok nb ol bi translated">从一行中获取所有值</h2><p id="7912" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">或者，您可能对检索整行数据(而不是单个单元格)感兴趣。在我们的例子中，假设我们有兴趣获取工作表中第一个学生的数据。</p><p id="c80b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">唯一需要注意的是，我们需要知道要从中检索数据的行的索引。假设第一行是列标题，感兴趣的行的索引为 2。现在我们可以得到它的值:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="c24f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们得到一列值:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="9db2" class="nn mm it nj b gy no np l nq nr">['John', 'Smith', '77']</span></pre><h2 id="9bdd" class="nn mm it bd mn ob oc dn mr od oe dp mv ld of og mx lh oh oi mz ll oj ok nb ol bi translated">从列中获取所有值</h2><p id="25e5" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">在另一种情况下，您可能希望从列(而不是行)中获取数据。假设在我们的场景中，我们希望从“grade”列中获取所有数据。</p><p id="93a6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将再次需要找到它的索引(index = 3)并运行类似于上一节的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="42db" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在列中得到一个值列表:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="8a0d" class="nn mm it nj b gy no np l nq nr">['grade', '77', '68', '59', '89']</span></pre><h2 id="5375" class="nn mm it bd mn ob oc dn mr od oe dp mv ld of og mx lh oh oi mz ll oj ok nb ol bi translated">插入新行</h2><p id="11de" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">我们通常用电子表格做的最受欢迎的任务之一可能是添加新数据。</p><p id="edff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们的例子中，假设有一个新生刚刚写了他/她的试卷，并得到了一个分数。我们想用 Python 更新我们的谷歌表，增加一个新条目。</p><p id="5502" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为此，我们需要两条信息:学生数据(名、姓和年级)和我们要插入的行的索引:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="80b7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">新索引是 6 的原因是因为我们知道已经有 5 行数据，并希望添加到列表的末尾。请记住，您可以选择任何索引值，它只是将剩余的行向下推。</p><p id="a2f9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们将这一行添加到我们的 Google 工作表中，并检查它是否已被添加:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="0ff1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在刚刚添加的行中得到一个值列表:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="34de" class="nn mm it nj b gy no np l nq nr">['Emily', 'Watson', '89']</span></pre><p id="df7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意</strong>:整个软件包的功能非常广泛，而且很多功能都是针对具体情况的。关于 gspread 软件包的完整方法示例，请点击<a class="ae ns" href="https://gspread.readthedocs.io/en/latest/user-guide.html#opening-a-spreadsheet" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="e135" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">结论</h1><p id="431b" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">在本文中，我们讨论了如何使用 Python 访问/编辑 Google Sheets，并介绍了 gspread 库的特性。</p><p id="b850" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你有任何问题或对编辑有任何建议，请随时在下面留下评论，并查看我的更多<a class="ae ns" href="https://pyshark.com/category/python-programming/" rel="noopener ugc nofollow" target="_blank"> Python 编程</a>文章。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="a1c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="on">原载于 2020 年 8 月 15 日 https://pyshark.com</em><em class="on"/><a class="ae ns" href="https://pyshark.com/google-sheets-api-using-python/" rel="noopener ugc nofollow" target="_blank"><em class="on">。</em></a></p></div></div>    
</body>
</html>