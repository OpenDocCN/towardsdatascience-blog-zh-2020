<html>
<head>
<title>How to Supercharge Excel With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 为 Excel 增压</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-supercharge-excel-with-python-726b0f8e22c2?source=collection_archive---------0-----------------------#2020-01-20">https://towardsdatascience.com/how-to-supercharge-excel-with-python-726b0f8e22c2?source=collection_archive---------0-----------------------#2020-01-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dacf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何用 xlwings 集成 Python 和 Excel</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/662c3b088812937d6715da0b84fac9c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gPgcd6YEo0dYltSo"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@emilep?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">émile Perron</a>拍摄的照片</p></figure><p id="f2a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Excel 既是一种祝福，也是一种诅咒。当谈到足够小的数据和足够简单的操作时<em class="lv"> Excel 是王者</em>。然而，一旦你发现自己在那些区域之外努力，它就变成了一种痛苦。当然，你可以使用 Excel VBA 来解决这些问题，但是在 2020 年，你可以感谢你的幸运星，因为你不需要这么做！</p><p id="f65b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果有一种方法能把 Excel 和 Python 集成在一起，给 Excel 插上翅膀就好了！现在有了。一个名为<strong class="lb iu"> <em class="lv"> xlwings 的 python 库允许你通过 VBA </em> </strong> <em class="lv">调用 Python 脚本，并在两者</em>之间传递数据。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6317" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">为什么要集成 Python 和 Excel VBA？</h1><p id="2740" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">事实是，在 VBA 你几乎可以做任何事情。那么，如果是这样的话，为什么要使用 Python 呢？嗯，有很多原因。</p><ol class=""><li id="a822" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">您可以在 Excel 中创建自定义函数，而无需学习 VBA(如果您还不知道的话)</li><li id="e35d" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">您的用户可以轻松使用 Excel</li><li id="70b3" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">使用 Python 可以显著加快数据操作的速度</li><li id="35e0" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">Python 中几乎有任何东西的库(机器学习、数据科学等)</li><li id="1f42" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">因为你可以！！！</li></ol></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/ede087ec9ad704f8ae4035e8256317fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vmVbOqnHvrR6zjlK"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@ffstop?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">摄影师</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="53a6" class="md me it bd mf mg np mi mj mk nq mm mn jz nr ka mp kc ns kd mr kf nt kg mt mu bi translated">设置使用 xlwings</h1><p id="473e" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">与我们想要使用的任何新库一样，我们需要做的第一件事是安装它。做起来超级简单；有了这两条命令，我们马上就可以设置好了。所以，继续输入您的终端:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="59d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦下载并安装了库，我们需要安装 Excel 集成部分。确保您已经关闭了所有 Excel 实例和任何终端类型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="0b5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您没有遇到错误，您应该能够继续。然而，在 Win10 和 Excel 2016 上，人们经常会看到以下错误:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="58e9" class="ob me it nx b gy oc od l oe of">xlwings 0.17.0<br/>[Errno 2] No such file or directory: 'C:\\Users\\costa\\AppData\\Roaming\\Microsoft\\Excel\\XLSTART\\xlwings.xlam'</span></pre><p id="b513" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你是遇到上述错误的幸运儿之一，你需要做的就是创建丢失的目录。使用 mkdir 命令可以很容易地做到这一点。就我而言，我做到了:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="2eea" class="ob me it nx b gy oc od l oe of">mkdir C:\\Users\\costa\\AppData\\Roaming\\Microsoft\\Excel\\XLSTART</span></pre><p id="8918" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设成功安装了 excel 与 python 库的集成，您会立即注意到 Excel 中的主要差异:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/b5b35fd011e4c8f6e6867f3fe49bdf42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qJWVuXBTJY5JBhqjnWW1og.png"/></div></div></figure><h2 id="ddaa" class="ob me it bd mf oh oi dn mj oj ok dp mn li ol om mp lm on oo mr lq op oq mt or bi translated">为 xlwings 启用用户定义的功能</h2><p id="8d8d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">首先，我们需要加载 Excel 插件。你可以点击 Alt，L，H，然后导航到上面的目录来加载插件。完成后，您应该能够看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/10805c5e0a4d2c00ed4063995d849385.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*LePl5mteF9srh75qE1NLXA.png"/></div></figure><p id="ac05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您需要启用对 VBA 项目对象模型的信任访问。为此，您可以导航至文件&gt;选项&gt;信任中心&gt;信任中心设置&gt;宏设置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/a8daa3ab770699e6db51f08c920969bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KY3-fJnfSkVikHjMyyFQ7w.png"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/1f104a50b57394914750067b602467f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7U71N98zVBBl-Z6b"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@pakata?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pakata Goh </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="0cd7" class="md me it bd mf mg np mi mj mk nq mm mn jz nr ka mp kc ns kd mr kf nt kg mt mu bi translated">xlwings 入门</h1><p id="e8d9" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">从 Excel 到 Python(以及从 Python 到 Excel)有两种主要方式。第一种是直接从 VBA 调用 Python 脚本，而另一种是通过用户定义的函数。让我们快速浏览一下这两者。</p><p id="0ad9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了避免任何混淆和每次都有正确的设置，xlwings 提供创建您的 Excel 电子表格，随时可用。然后让我们使用这个功能。使用终端，我们导航到我们喜欢的目录并键入:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="aaa2" class="ob me it nx b gy oc od l oe of">xlwings quickstart ProjectName</span></pre><p id="62fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我称之为 MyFirstPythonXL。上述命令将在您预先导航的目录中创建一个新文件夹，其中包含一个 Excel 工作表和一个 python 文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/225e90212e246679720f92917b604b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*pPSFo48XD6B_jBoCcvRJfA.png"/></div></figure><p id="4555" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正在打开。xlsm 文件，您会立即注意到一个名为<a class="ae ky" href="http://_xlwings.conf/" rel="noopener ugc nofollow" target="_blank"> _xlwings.conf </a>的新 Excel 表格。如果您希望覆盖 xlwings 的默认设置，您所要做的就是重命名该工作表并删除起始下划线。至此，我们已经准备好开始使用 xlwings 了。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="7d95" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">VBA 到 Python</h1><p id="e43d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在我们开始编码之前，让我们首先确保我们都在同一页上。要打开我们的 Excel VBA 编辑器，点击<em class="lv"> Alt + F11 </em>。这将返回以下屏幕:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/e9bf3fbbfee8638ea0a34563e1349bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a1LkR5MhPQe9-9s4qUA-LQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">xlwings 的 VBA 编辑器</p></figure><p id="362e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里需要注意的关键点是，该代码将执行以下操作:</p><ol class=""><li id="6948" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">在电子表格所在的位置查找 Python 脚本</li><li id="300e" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">查找与电子表格同名的 Python 脚本(但扩展名为. py)</li><li id="5074" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">在 Python 脚本中，调用函数“main()”</li></ol><p id="5f57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事不宜迟，让我们看几个如何使用它的例子。</p><h2 id="42b1" class="ob me it bd mf oh oi dn mj oj ok dp mn li ol om mp lm on oo mr lq op oq mt or bi translated">示例 1:在 Excel 之外操作，并返回输出</h2><p id="2718" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在这个例子中，我们将看到如何在 Excel 之外执行操作，然后在电子表格中返回结果。这可以有无限多的用例。</p><p id="9023" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将从 CSV 文件中获取数据，对所述数据进行修改，然后将输出传递到 Excel。让我们回顾一下它有多简单:</p><p id="98b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，<strong class="lb iu">VBA 密码</strong>:</p><p id="cd94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我完全没有改变默认设置。</p><p id="353d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，<strong class="lb iu">Python 代码</strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="2fe0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这会导致以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/487026148b6b686e0c3617ea1f9a29be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*w2laxX6ujcxfwo2VFI3fmw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">xlwings 在行动</p></figure><h2 id="1709" class="ob me it bd mf oh oi dn mj oj ok dp mn li ol om mp lm on oo mr lq op oq mt or bi translated">示例 2:使用 Excel 输入来驱动操作</h2><p id="1847" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在本例中，我们将从 Excel 中读取输入，用 Python 对其进行处理，然后将结果传回 Excel。</p><p id="3a84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更具体地说，我们将读出一个问候语、一个名字和一个我们可以找到笑话的文件位置。我们的 Python 脚本将从文件中随机抽取一行，并返回一个笑话给我们。</p><p id="c5bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，<strong class="lb iu">VBA 电码</strong>:</p><p id="0bf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我完全没有改变默认设置。</p><p id="5472" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，<strong class="lb iu">的 Python 代码</strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="a121" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这给了我们:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/cbdda3aaee983dab48a6b90048d61f1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NBk4oLPsSKa4Nf5p6ZETJg.gif"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="90b9" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用 xlwings 的用户定义函数</h1><p id="d93e" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">和以前一样，我们将改变 python 文件中的代码。为了将一些东西转换成 Excel 用户定义的函数，我们需要做的就是在函数所在的行之前包含“@xw.func ”:</p><p id="dd6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python 代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="220e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/5b0cbf26fe937969f6880fa0fb4577e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*i88IpbhgmWlsw-upKGuB8A.gif"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4e63" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="8237" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我想你会同意这是一个漂亮的小图书馆。如果你像我一样，你更喜欢用 Python 而不是 VBA 工作，但需要在电子表格中工作，那么这可能是一个非常好的工具。</p><p id="f85f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想了解我博客的最新动态吗？别忘了<a class="ae ky" href="https://medium.com/@costasandreou" rel="noopener">跟着我</a>！</p><p id="3ee8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是其他一些你可能会感兴趣的文章:</p><div class="oz pa gp gr pb pc"><a href="https://medium.com/financeexplained/from-excel-to-databases-with-python-c6f70bdc509b" rel="noopener follow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd iu gy z fp ph fr fs pi fu fw is bi translated">用 Python 从 Excel 到数据库</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">了解如何使用 Python 进行快速数据分析</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">medium.com</p></div></div><div class="pl l"><div class="pm l pn po pp pl pq ks pc"/></div></div></a></div><div class="oz pa gp gr pb pc"><a rel="noopener follow" target="_blank" href="/from-xml-to-excel-for-data-analysis-ac0c0c765b7d"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd iu gy z fp ph fr fs pi fu fw is bi translated">从 XML 到 Excel 进行数据分析</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">Python 中处理 XML 的介绍</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">towardsdatascience.com</p></div></div><div class="pl l"><div class="pr l pn po pp pl pq ks pc"/></div></div></a></div></div></div>    
</body>
</html>