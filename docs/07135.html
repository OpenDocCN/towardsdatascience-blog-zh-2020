<html>
<head>
<title>The secret recipe for modern Oracles</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代神谕的秘方</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-secret-recipe-for-modern-oracles-2ab69b09465c?source=collection_archive---------66-----------------------#2020-05-31">https://towardsdatascience.com/the-secret-recipe-for-modern-oracles-2ab69b09465c?source=collection_archive---------66-----------------------#2020-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/580d5a6921bad0bbd0774317163202a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/0*TqyQ9uj5VJ5YLYcP.jpg"/></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">来源:<a class="ae kb" href="https://commons.wikimedia.org/wiki/File:John_Collier_-_Priestess_of_Delphi.jpg" rel="noopener ugc nofollow" target="_blank">约翰·科利尔/公共领域</a></p></figure><p id="3d76" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">在古希腊，人们相信任何重要的决定都是由神来指导的，因此，人们认为神是通过神谕来说话的——来自拉丁语动词‘orare’(说话)。先知被咨询关于农作物的产量，健康问题，财政财富，等等。现代的甲骨文离开了希腊，改变了服装，并缩小了一个人的重点，以预测公司的收入，客户流失，和公司的销售。有许多预测技术和方法，现代的甲骨文可以用来做到这一点，从德尔菲技术到脚本编写，时间序列预测，但在这篇文章中，我想谈谈时间序列预测与先知。</p><p id="8934" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">Prophet是脸书发布的开源R和Python库，基于可分解的(趋势+季节性+假期)模型——在这里阅读更多<a class="ae kb" href="http://facebook.github.io/prophet" rel="noopener ugc nofollow" target="_blank"/><a class="ae kb" href="http://facebook.github.io/prophet/." rel="noopener ugc nofollow" target="_blank">。</a>我在库中最喜欢的是，您可以对周期性事件(如季节性事件)和不规则事件(如节假日)进行建模。想知道如何以互动的形式自动获得你的预测吗？力量BI来拯救你。</p><h1 id="adf1" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么？</h1><p id="3663" class="pw-post-body-paragraph kc kd it ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz im bi translated">Python库、Power BI Desktop &amp; Power BI Pro(云)、csv/a数据库连接和个人网关。</p><h1 id="1103" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">怎么会？</h1><p id="316a" class="pw-post-body-paragraph kc kd it ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz im bi translated"><em class="md">第一步。</em>起初，我以为我会带着我的Python库离开，但是经过几个小时与'<code class="fe me mf mg mh b">unable-to-import-required-dependencies:numpy</code>'、'<code class="fe me mf mg mh b">unable-to-import-required-dependencies:matplotlib</code>'、'<code class="fe me mf mg mh b">please-install-mkl-service-package</code>'等的斗争之后。我认输了，安装了康达(此处阅读安装指南<a class="ae kb" href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html" rel="noopener ugc nofollow" target="_blank">)。我第二次举起白旗是在安装Anaconda之后，我既没有在“默认路径”上安装Anaconda，也没有将Anaconda的python设置为默认的python命令…嗯，起泡沫，冲洗，重复。</a></p><p id="8488" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><em class="md">第二步。</em>如果你选择了“只有我”——我就是这么做的，默认情况下，Anaconda会被安装在<code class="fe me mf mg mh b">C:\Users\{YourUserName}\Anaconda3</code>文件夹中。如果你不确定，在任务栏的搜索框中输入cmd然后点击“Enter”打开常规的命令提示符(适用于Windows用户)，然后输入<code class="fe me mf mg mh b">where python</code>获得Python路径。就我而言，我得到了<code class="fe me mf mg mh b">C:\Users\Eka\Anaconda3\python.exe</code>。太好了。</p><p id="5971" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><em class="md">第三步。</em>打开你的Power BI桌面&gt; &gt; <em class="md">文件&gt; &gt;选项和设置</em> &gt; &gt; <em class="md">选项</em>，添加你的Anaconda路径和Python可执行文件的路径。如果你已经创建了一个虚拟环境，请看这里的文章<a class="ae kb" rel="noopener" target="_blank" href="/using-python-in-power-bi-ee95a6b71443"/>。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/3bc91ea549c52076340bfc4fe264f85c.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*fLJjpyXaR9xkEVAbuK-YcA.jpeg"/></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">更改目录</p></figure><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/c61a5a45cde425a3ffa2430a32311479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*4guHWsI3SuyuCJbwy14QLw.jpeg"/></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">更改目录_2</p></figure><p id="00c4" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><em class="md">第四步</em>。<em class="md">通过添加您的数据源获取数据</em>。在我的。<a class="ae kb" href="https://github.com/eponkratova/articles/blob/master/powerbi_prophet/prophet.pbix" rel="noopener ugc nofollow" target="_blank"> pbix </a>，我已经连接到了一个csv文件——当前的解决方案也在数据库连接上进行了测试——它具有“日期”、“值”和“类型”列(参见此处的文件<a class="ae kb" href="https://github.com/eponkratova/articles/blob/master/powerbi_prophet/data.csv" rel="noopener ugc nofollow" target="_blank"/>)。</p><p id="e5e8" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><em class="md">第五步</em>。转到<em class="md">主页&gt; &gt;编辑查询</em>进入超级查询编辑器。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mo"><img src="../Images/d1452fa43a4680674b2fe393b01f643e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7DaRMFq1uHXpA5Y7UQf9SA.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">运行Python脚本</p></figure><p id="0114" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><em class="md">第六步</em>。将日期列改为“文本”是很重要的，否则，您将得到“microsoft.ole.db.date”错误—是的，在我的例子中，这是一个很大的改动。</p><p id="97f7" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">在查询编辑器中，点击<em class="md">转换&gt;T52】运行Python脚本</em>。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mt"><img src="../Images/a4599455d9457d4132a8175344e699d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V4JZoIdX78UZjMXESsqOLA.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">运行Python脚本_2</p></figure><p id="ab56" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><em class="md">步骤7。</em>在脚本编辑器窗口中添加你的代码。我最初的错误是我没有改变‘value’列的类型，所以当我得到新的float实际记录时，脚本失败了。下面的脚本很基本，只是为了演示这一点，对于更高级的选项，请参考库文档<a class="ae kb" href="https://facebook.github.io/prophet/docs/quick_start.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><pre class="mj mk ml mm gt mu mh mv mw aw mx bi"><span id="f286" class="my lb it mh b gy mz na l nb nc"># 'dataset' holds the input data for this script<br/>#import libraries<br/>import pandas as pd<br/>from fbprophet import Prophet</span><span id="9874" class="my lb it mh b gy nd na l nb nc">#convert to pandas dataframe<br/>df = pd.DataFrame(dataset)<br/>df["date"] = pd.to_datetime(df["date"]) #change format of the date column to date<br/>df["value"] = df.value.astype('float') #change format of the column you want to create predictions for to float<br/>df = df.rename(columns={'date': 'ds',<br/>                        'value': 'y'}) #change the names of the columns otherwise prophet will complain<br/>daily = df.copy()<br/>my_model = Prophet(interval_width=0.95) #create an instance of the prophet class<br/>my_model.fit(daily) #fit the model<br/>future_dates = my_model.make_future_dataframe(periods=12, freq='d') #create empty future dataframe <br/>forecast = my_model.predict(future_dates) #create predictions<br/>forecast_set = forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']] #select only certain fields<br/>df_merged = pd.merge(forecast_set, df, how='left') #merge original dataframe with the predictions<br/>df_merged.columns = ['date','forecast','yhat_lower','yhat_upper','actual', 'type'] #re-name the columns</span></pre><p id="3a1a" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><em class="md">第8步</em>。如果你成功地完成了“起泡、冲洗、重复”的循环，你应该能看到几个表格被创建。点击<strong class="ke iu">表格</strong>中与“df_merged”相对的超链接，加载与您的实际数据框合并的预测数据框。然后，<em class="md">关闭&amp;应用</em>加载到您的Power BI桌面。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi ne"><img src="../Images/dae09e486cca7528477c1287124fde22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ywr8ZuprOtx6eIzSWPUaGg.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">加载结果</p></figure><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nf"><img src="../Images/e1c9161c60ce78870517ce20393f334d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TtoLGh3JexcOytkBxJEGlw.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">加载结果_2</p></figure><p id="8d35" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><em class="md">步骤九。</em>根据您的要求创建视觉效果，<em class="md">将工作簿发布到</em>Power BI cloud。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi ng"><img src="../Images/fc14667079c07c678833998d72e7ba8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yC0wnfuOI7heYuKiNvY8mw.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">创造视觉效果</p></figure><p id="5625" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><em class="md">第十步</em>。例如，从<a class="ae kb" href="https://www.microsoft.com/en-us/download/details.aspx?id=55768" rel="noopener ugc nofollow" target="_blank">这里</a>下载并安装个人网关。请记住，您需要个人网关，因为互联网上评论说，您只能通过个人网关运行Python脚本。登录到您的Power BI cloud，确保网关启动并运行。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nh"><img src="../Images/d5bbae1c4f1e4c52ebe979a1db8f38b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGt8uNIqsOxNN-5dLxTdXQ.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">验证网关</p></figure><p id="6653" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><em class="md">第十一步。</em>为该网关添加数据源，并安排仪表板刷新。说完，我结束了我的循环。</p><p id="1843" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">作为一个预言未来的先知，感觉如何？</p><p id="f9e4" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">附言:我没有测试过的:声明“运行超过30分钟的Python脚本会自动超时。”；如何将每日数据汇总到每周/每月。</p><p id="4359" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">非常感谢为这篇文章提供灵感的Sanjo。</p></div></div>    
</body>
</html>