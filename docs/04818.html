<html>
<head>
<title>Building a Conda environment for Horovod</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Horovod营造康达环境</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-conda-environment-for-horovod-773bd036bf64?source=collection_archive---------35-----------------------#2020-04-27">https://towardsdatascience.com/building-a-conda-environment-for-horovod-773bd036bf64?source=collection_archive---------35-----------------------#2020-04-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d126" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用Horovod开始DNNs的分布式训练？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ec3423497089210df0292764e08b83d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vdzW3k9rEm0CABtyap4SZA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://eng.uber.com/nvidia-horovod-deep-learning/" rel="noopener ugc nofollow" target="_blank">https://eng.uber.com/nvidia-horovod-deep-learning/</a></p></figure><h1 id="1f43" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是Horovod？</h1><p id="1bfa" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://github.com/davidrpugh/stochastic-expatriate-descent/blob/master/_posts" rel="noopener ugc nofollow" target="_blank"> Horovod </a>是针对<a class="ae ky" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a>、<a class="ae ky" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras </a>、<a class="ae ky" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>、<a class="ae ky" href="https://mxnet.incubator.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache MXNet </a>的开源分布式培训框架。Horovod最初由优步开发，供内部使用，几年前开源，现在是官方的Linux基金会人工智能项目。</p><p id="c562" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">在这篇文章中，我描述了我如何为我的深度学习项目构建Conda环境，当时我正在使用Horovod来实现跨多个GPU的分布式训练(在同一节点上或分布在多个节点上)。如果你喜欢我的方法，那么你可以利用<a class="ae ky" href="https://github.com/kaust-vislab/horovod-gpu-data-science-project" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上的模板库来开始你的下一个Horovod数据科学项目！</p><h1 id="3051" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">安装NVIDIA CUDA工具包</h1><p id="8403" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你需要做的第一件事是在你的工作站上安装NVIDIA CUDA Toolkit的<a class="ae ky" href="https://developer.nvidia.com/cuda-toolkit-archive" rel="noopener ugc nofollow" target="_blank">合适版本</a>。我使用的是<a class="ae ky" href="https://developer.nvidia.com/cuda-10.1-download-archive-update2" rel="noopener ugc nofollow" target="_blank">NVIDIA CUDA Toolkit 10.1</a><a class="ae ky" href="https://docs.nvidia.com/cuda/archive/10.1/" rel="noopener ugc nofollow" target="_blank">(文档)</a>，它可以与Horovod目前支持的所有三个深度学习框架一起工作。</p><h2 id="de4d" class="mu la it bd lb mv mw dn lf mx my dp lj ma mz na ll me nb nc ln mi nd ne lp nf bi translated">为什么不用<code class="fe ng nh ni nj b">cudatoolkit</code>包呢？</h2><p id="6ae8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">通常，当使用Conda安装PyTorch、TensorFlow或支持GPU的Apache MXNet时，您只需将适当版本的<code class="fe ng nh ni nj b"><a class="ae ky" href="https://anaconda.org/anaconda/cudatoolkit" rel="noopener ugc nofollow" target="_blank">cudatoolkit</a></code>包添加到您的<code class="fe ng nh ni nj b">environment.yml</code>文件中。</p><p id="0d0b" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">不幸的是，至少在目前，<code class="fe ng nh ni nj b"><a class="ae ky" href="https://conda-forge.org/" rel="noopener ugc nofollow" target="_blank">conda-forge</a></code>提供的<code class="fe ng nh ni nj b">cudatoolkit</code>包不包括<a class="ae ky" href="https://docs.nvidia.com/cuda/archive/10.1/cuda-compiler-driver-nvcc/index.html" rel="noopener ugc nofollow" target="_blank"> NVCC </a>，如果你需要编译扩展，它是将Horovod与PyTorch、TensorFlow或MXNet一起使用所必需的。</p><h2 id="65a3" class="mu la it bd lb mv mw dn lf mx my dp lj ma mz na ll me nb nc ln mi nd ne lp nf bi translated"><code class="fe ng nh ni nj b">cudatoolkit-dev</code>套餐怎么样？</h2><p id="6339" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">虽然有来自<code class="fe ng nh ni nj b">conda-forge</code>的包含NVCC的<code class="fe ng nh ni nj b"><a class="ae ky" href="https://anaconda.org/conda-forge/cudatoolkit-dev" rel="noopener ugc nofollow" target="_blank">cudatoolkit-dev</a></code>软件包，但我很难让这些软件包持续正确地安装。一些可用的构建需要手动干预来接受许可协议，这使得这些构建不适合安装在远程系统上(这是关键的功能)。其他版本似乎可以在Ubuntu上运行，但不能在其他版本的Linux上运行。</p><p id="cad5" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">我鼓励你尝试将<code class="fe ng nh ni nj b">cudatoolkit-dev</code>添加到你的<code class="fe ng nh ni nj b">environment.yml</code>文件中，看看会发生什么！这个包<a class="ae ky" href="https://github.com/conda-forge/cudatoolkit-dev-feedstock" rel="noopener ugc nofollow" target="_blank">维护得很好</a>，所以也许将来它会变得更加稳定。</p><h2 id="0763" class="mu la it bd lb mv mw dn lf mx my dp lj ma mz na ll me nb nc ln mi nd ne lp nf bi translated">使用<code class="fe ng nh ni nj b">nvcc_linux-64</code>元包！</h2><p id="34bd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">获得NVCC并仍然使用Conda管理所有其他依赖项的最可靠方法是在您的系统上安装NVIDIA CUDA Toolkit，然后安装来自<code class="fe ng nh ni nj b">conda-forge</code>的元包<code class="fe ng nh ni nj b"><a class="ae ky" href="https://anaconda.org/nvidia/nvcc_linux-64" rel="noopener ugc nofollow" target="_blank">nvcc_linux-64</a></code>，该元包配置您的Conda环境，以使用安装在系统上的NVCC以及安装在Conda环境中的其他CUDA Toolkit组件。关于这个包的更多细节，我建议通读GitHub 上的问题主题。</p><h1 id="e8fb" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><code class="fe ng nh ni nj b">environment.yml</code>文件</h1><p id="721e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我更喜欢在Conda <code class="fe ng nh ni nj b">environment.yml</code>文件中指定尽可能多的依赖项，并且只在<code class="fe ng nh ni nj b">requirements.txt</code>中指定通过Conda通道不可用的依赖项。查看<a class="ae ky" href="https://horovod.readthedocs.io/en/latest/install_include.html" rel="noopener ugc nofollow" target="_blank">官方Horovod安装指南</a>了解所需依赖项的详细信息。</p><h2 id="3363" class="mu la it bd lb mv mw dn lf mx my dp lj ma mz na ll me nb nc ln mi nd ne lp nf bi translated">通道优先级</h2><p id="dd3b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我使用推荐的通道优先级。注意<code class="fe ng nh ni nj b">conda-forge</code>比<code class="fe ng nh ni nj b">defaults</code>有优先权。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="5dcb" class="mu la it nj b gy no np l nq nr">name: null</span><span id="97bc" class="mu la it nj b gy ns np l nq nr">channels:<br/>  - pytorch<br/>  - conda-forge<br/>  - defaults</span></pre><h2 id="6547" class="mu la it bd lb mv mw dn lf mx my dp lj ma mz na ll me nb nc ln mi nd ne lp nf bi translated">属国</h2><p id="0e0c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">关于依赖关系，有一些事情值得注意。</p><ol class=""><li id="bb63" class="nt nu it lt b lu mp lx mq ma nv me nw mi nx mm ny nz oa ob bi translated">尽管我已经手动安装了NVIDIA CUDA工具包，但我仍然使用Conda来管理其他所需的CUDA组件，如<code class="fe ng nh ni nj b">cudnn</code>和<code class="fe ng nh ni nj b">nccl</code>(以及可选的<code class="fe ng nh ni nj b">cupti</code>)。</li><li id="3ca1" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">我使用了两个元包<code class="fe ng nh ni nj b">cxx-compiler</code>和<code class="fe ng nh ni nj b">nvcc_linux-64</code>，以确保安装了合适的C和C++编译器，并且最终的Conda环境能够识别手动安装的CUDA工具包。</li><li id="ca8b" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">Horovod需要一些控制器库来协调各种Horovod进程之间的工作。通常这将是一些MPI实现，如<a class="ae ky" href="https://www.open-mpi.org/" rel="noopener ugc nofollow" target="_blank"> OpenMPI </a>。然而，我没有直接指定<code class="fe ng nh ni nj b">openmpi</code>包，而是选择了<code class="fe ng nh ni nj b"><a class="ae ky" href="https://mpi4py.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">mpi4py</a></code> Conda包，它提供了一个支持cuda的OpenMPI构建(假设您的硬件支持它)。</li><li id="45e1" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">Horovod还支持Gloo集体通信库，可以用来代替MPI。我加入<code class="fe ng nh ni nj b">cmake</code>是为了确保Gloo的Horovod扩展已经完成。</li></ol><p id="cf59" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">以下是核心必需依赖项。完整的<code class="fe ng nh ni nj b">environment.yml</code>文件可以在<a class="ae ky" href="https://github.com/kaust-vislab/horovod-gpu-data-science-project/blob/master/environment.yml" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="ffc9" class="mu la it nj b gy no np l nq nr">dependencies:<br/>  - bokeh=1.4<br/>  - cmake=3.16 # insures that Gloo library extensions will be built<br/>  - cudnn=7.6<br/>  - cupti=10.1<br/>  - cxx-compiler=1.0 # insures C and C++ compilers are available<br/>  - jupyterlab=1.2<br/>  - mpi4py=3.0 # installs cuda-aware openmpi<br/>  - nccl=2.5<br/>  - nodejs=13<br/>  - nvcc_linux-64=10.1 # configures environment to be "cuda-aware"<br/>  - pip=20.0<br/>  - pip:<br/>    - mxnet-cu101mkl==1.6.* # MXNET is installed prior to horovod<br/>    - -r file:requirements.txt<br/>  - python=3.7<br/>  - pytorch=1.4<br/>  - tensorboard=2.1<br/>  - tensorflow-gpu=2.1<br/>  - torchvision=0.5</span></pre><h2 id="fcf9" class="mu la it bd lb mv mw dn lf mx my dp lj ma mz na ll me nb nc ln mi nd ne lp nf bi translated"><code class="fe ng nh ni nj b">requirements.txt</code>文件</h2><p id="a5e5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在<code class="fe ng nh ni nj b">requirements.txt</code>文件中列出了所有的<code class="fe ng nh ni nj b">pip</code>依赖项，包括Horovod本身，以便安装。除了Horovod，我通常还会使用<code class="fe ng nh ni nj b">pip</code>来安装JupyterLab扩展，以通过<code class="fe ng nh ni nj b"><a class="ae ky" href="https://github.com/rapidsai/jupyterlab-nvdashboard" rel="noopener ugc nofollow" target="_blank">jupyterlab-nvdashboard</a></code>实现GPU和CPU资源监控，并通过<code class="fe ng nh ni nj b"><a class="ae ky" href="https://github.com/lspvic/jupyter_tensorboard" rel="noopener ugc nofollow" target="_blank">jupyter-tensorboard</a></code>实现Tensorboard支持。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="05bf" class="mu la it nj b gy no np l nq nr">horovod==0.19.*<br/>jupyterlab-nvdashboard==0.2.*<br/>jupyter-tensorboard==0.2.*</span><span id="f2cf" class="mu la it nj b gy ns np l nq nr"># make sure horovod is re-compiled if environment is re-built<br/>--no-binary=horovod</span></pre><p id="4cf3" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">注意文件末尾的<code class="fe ng nh ni nj b">--no-binary</code>选项的使用。包含此选项可确保每当重建Conda环境时，Horovod都会重建。</p><p id="4d18" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">完整的<code class="fe ng nh ni nj b">requirements.txt</code>文件可在<a class="ae ky" href="https://github.com/kaust-vislab/horovod-gpu-data-science-project/blob/master/requirements.txt" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><h1 id="94b1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">建筑康达环境</h1><p id="adce" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在添加了应该通过<code class="fe ng nh ni nj b">conda</code>下载到<code class="fe ng nh ni nj b">environment.yml</code>文件的任何必要的依赖项和应该通过<code class="fe ng nh ni nj b">pip</code>下载到<code class="fe ng nh ni nj b">requirements.txt</code>文件的任何依赖项之后，您可以通过运行以下命令在项目目录的子目录<code class="fe ng nh ni nj b">env</code>中创建Conda环境。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="e5cf" class="mu la it nj b gy no np l nq nr">export ENV_PREFIX=$PWD/env<br/>export HOROVOD_CUDA_HOME=$CUDA_HOME<br/>export HOROVOD_NCCL_HOME=$ENV_PREFIX<br/>export HOROVOD_GPU_OPERATIONS=NCCL<br/>conda env create --prefix $ENV_PREFIX --file environment.yml --force</span></pre><p id="8302" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">默认情况下，Horovod会尝试为所有检测到的框架构建扩展。有关在构建Horovod之前可以设置的其他环境变量的详细信息，请参见Horovod文档中关于<a class="ae ky" href="https://horovod.readthedocs.io/en/latest/install_include.html#environment-variables" rel="noopener ugc nofollow" target="_blank">环境变量</a>的内容。</p><p id="97ad" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">创建新环境后，您可以使用以下命令激活该环境。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="f2bb" class="mu la it nj b gy no np l nq nr">conda activate $ENV_PREFIX</span></pre><h1 id="35c7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><code class="fe ng nh ni nj b">postBuild</code>文件</h1><p id="5dd9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您希望使用包含在<code class="fe ng nh ni nj b">environment.yml</code>和<code class="fe ng nh ni nj b">requirements.txt</code>文件中的任何JupyterLab扩展，那么您可能需要重新构建JupyterLab应用程序。</p><p id="f88b" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">为了简单起见，我通常在一个<code class="fe ng nh ni nj b">postBuild</code>脚本中包含重新构建JupyterLab的指令。下面是这个脚本在我的Horovod环境中的样子。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="fff2" class="mu la it nj b gy no np l nq nr">jupyter labextension install --no-build @pyviz/jupyterlab_pyviz<br/>jupyter labextension install --no-build jupyterlab-nvdashboard <br/>jupyter labextension install --no-build jupyterlab_tensorboard<br/>jupyter serverextension enable jupyterlab_sql --py --sys-prefix<br/>jupyter lab build</span></pre><p id="1f11" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">使用以下命令生成<code class="fe ng nh ni nj b">postBuild</code>脚本。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="4251" class="mu la it nj b gy no np l nq nr">conda activate $ENV_PREFIX # optional if environment already active<br/>. postBuild</span></pre><h1 id="e4f3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">用Bash脚本将这一切包装起来</h1><p id="82ac" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我通常将这些命令打包成一个shell脚本<code class="fe ng nh ni nj b">create-conda-env.sh</code>。运行shell脚本将设置Horovod构建变量，创建Conda环境，激活Conda环境，并构建带有任何附加扩展的JupyterLab。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="846f" class="mu la it nj b gy no np l nq nr">#!/bin/bash --login</span><span id="6e25" class="mu la it nj b gy ns np l nq nr">set -e</span><span id="9bde" class="mu la it nj b gy ns np l nq nr">export ENV_PREFIX=$PWD/env<br/>export HOROVOD_CUDA_HOME=$CUDA_HOME<br/>export HOROVOD_NCCL_HOME=$ENV_PREFIX<br/>export HOROVOD_GPU_OPERATIONS=NCCL</span><span id="819f" class="mu la it nj b gy ns np l nq nr">conda env create --prefix $ENV_PREFIX --file environment.yml --force<br/>conda activate $ENV_PREFIX<br/>. postBuild</span></pre><p id="a206" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">我通常将脚本放在我的项目根目录下的一个<code class="fe ng nh ni nj b">bin</code>目录中。该脚本应该从项目根目录运行，如下所示。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="e277" class="mu la it nj b gy no np l nq nr">./bin/create-conda-env.sh # assumes that $CUDA_HOME is set properly</span></pre><h1 id="330f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">验证Conda环境</h1><p id="5c05" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">构建Conda环境后，您可以使用以下命令检查Horovod是否已构建为支持深度学习框架TensorFlow、PyTorch、Apache MXNet以及控制器MPI和Gloo。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="5862" class="mu la it nj b gy no np l nq nr">conda activate $ENV_PREFIX # optional if environment already active<br/>horovodrun --check-build</span></pre><p id="2f99" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">您应该会看到类似下面的输出。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="65ef" class="mu la it nj b gy no np l nq nr">Horovod v0.19.4:</span><span id="eb23" class="mu la it nj b gy ns np l nq nr">Available Frameworks:<br/>    [X] TensorFlow<br/>    [X] PyTorch<br/>    [X] MXNet</span><span id="6ace" class="mu la it nj b gy ns np l nq nr">Available Controllers:<br/>    [X] MPI<br/>    [X] Gloo</span><span id="4488" class="mu la it nj b gy ns np l nq nr">Available Tensor Operations:<br/>    [X] NCCL<br/>    [ ] DDL<br/>    [ ] CCL<br/>    [X] MPI<br/>    [X] Gloo</span></pre><h1 id="2bc8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">列出Conda环境的内容</h1><p id="2b54" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要查看安装到环境中的软件包的完整列表，请运行以下命令。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="b63c" class="mu la it nj b gy no np l nq nr">conda activate $ENV_PREFIX # optional if environment already active<br/>conda list</span></pre><h1 id="760f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">更新Conda环境</h1><p id="0ae3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您在创建环境之后向<code class="fe ng nh ni nj b">environment.yml</code>文件或<code class="fe ng nh ni nj b">requirements.txt</code>文件添加(从其中移除)依赖项，那么您可以使用以下命令重新创建环境。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="ae5c" class="mu la it nj b gy no np l nq nr">conda env create --prefix $ENV_PREFIX --file environment.yml --force</span></pre><p id="c7e5" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">然而，每当我添加新的依赖项时，我更喜欢重新运行Bash脚本，这将重新构建Conda环境和JupyterLab。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="d70c" class="mu la it nj b gy no np l nq nr">./bin/create-conda-env.sh</span></pre><h1 id="f8ec" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">摘要</h1><p id="3e72" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为我的深度学习项目找到一个可重复的构建Horovod扩展的过程是很棘手的。我的解决方案的关键是使用来自<code class="fe ng nh ni nj b">conda-forge</code>的元包，以确保安装了适当的编译器，并且最终的Conda环境知道系统安装了NVIDIA CUDA Toolkit。第二个关键是使用<code class="fe ng nh ni nj b">requirements.txt</code>文件中的<code class="fe ng nh ni nj b">--no-binary</code>标志来确保每当Conda环境被重新构建时Horovod也被重新构建。</p><p id="7414" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">如果你喜欢我的方法，那么你可以利用<a class="ae ky" href="https://github.com/kaust-vislab/horovod-gpu-data-science-project" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上的模板库来开始你的下一个Horovod数据科学项目！</p></div></div>    
</body>
</html>