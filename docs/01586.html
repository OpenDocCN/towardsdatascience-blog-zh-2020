<html>
<head>
<title>Entity Level Evaluation for NER Task</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NER任务的实体级评估</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/entity-level-evaluation-for-ner-task-c21fb3a8edf?source=collection_archive---------7-----------------------#2020-02-13">https://towardsdatascience.com/entity-level-evaluation-for-ner-task-c21fb3a8edf?source=collection_archive---------7-----------------------#2020-02-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="281e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何计算NER任务的混淆矩阵(TP，TN，FP，FN)</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/09b0d8c69cbc28b6a0e23df23ea9ba2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOzz-CeH3nhx0p4xF44ZOg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">亚历山大·安德鲁斯在<a class="ae ky" href="https://unsplash.com/s/photos/measurement?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3d26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们评估NER(命名实体识别)任务时，有两种方法，令牌级方法和实体级方法。比如我们下面预测的这句话:“外交部发言人沈国放告诉路透社”。如果用令牌级评价，令牌“申”是对的，令牌“国芳”是错的。但是如果我们使用实体级评估，“沈国放”是一个完整的命名实体，因此对“沈”和“国放”的预测必须是“PER”和“PER”。否则，这是错误的预测实体，甚至令牌“申”被预测为“每”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/45b0b9515863acbe5b639a773408b4c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*nbqIQBzPywyuGi2jtv1XGA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">NER预测的例子</p></figure><h1 id="1c20" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">实体级与令牌级</h1><p id="4c4f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">那么我们应该用哪种方法呢？</p><p id="4f6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答案是<strong class="lb iu">实体级评测</strong>。正如任务名“命名实体”所表明的，我们真正关心的是我们的模型如何预测整个实体，而不是单独的标记。</p><p id="cc49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我一般用<a class="ae ky" href="https://sklearn-crfsuite.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">sk learn-CRF suite</strong></a><strong class="lb iu"/>来实现CRF模型，这个库很棒。但是它的一个缺点是使用的评估方法是<a class="ae ky" href="https://sklearn-crfsuite.readthedocs.io/en/latest/tutorial.html#evaluation" rel="noopener ugc nofollow" target="_blank">令牌级评估</a>。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c5d3" class="my lx it mu b gy mz na l nb nc">precision    recall  f1-score   support<br/><br/>      B-LOC      0.775     0.757     0.766      1084<br/>      I-LOC      0.601     0.631     0.616       325<br/>     B-MISC      0.698     0.499     0.582       339<br/>     I-MISC      0.644     0.567     0.603       557<br/>      B-ORG      0.795     0.801     0.798      1400<br/>      I-ORG      0.831     0.773     0.801      1104<br/>      B-PER      0.812     0.876     0.843       735<br/>      I-PER      0.873     0.931     0.901       634<br/><br/>avg / total      0.779     0.764     0.770      6178</span></pre><p id="4ab9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们希望对这些进行更改，以产生如下所示的实体级评估:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a023" class="my lx it mu b gy mz na l nb nc">precision    recall  f1-score   support<br/><br/>      LOC      0.775     0.757     0.766      1084<br/>     MISC      0.698     0.499     0.582       339<br/>      ORG      0.795     0.801     0.798      1400<br/>      PER      0.812     0.876     0.843       735<br/><br/>avg/total      0.779     0.764     0.770      6178</span></pre><p id="4c0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不使用官方的评测方法，我推荐使用这个工具，<a class="ae ky" href="https://github.com/chakki-works/seqeval" rel="noopener ugc nofollow" target="_blank"> seqeval </a>。该库可以在实体级别运行评估。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0caa" class="my lx it mu b gy mz na l nb nc">&gt;&gt;&gt; from seqeval.metrics import accuracy_score<br/>&gt;&gt;&gt; from seqeval.metrics import classification_report<br/>&gt;&gt;&gt; from seqeval.metrics import f1_score<br/>&gt;&gt;&gt; <br/>&gt;&gt;&gt; y_true = [['O', 'O', 'O', 'B-MISC', 'I-MISC', 'I-MISC', 'O'], ['B-PER', 'I-PER', 'O']]<br/>&gt;&gt;&gt; y_pred = [['O', 'O', 'B-MISC', 'I-MISC', 'I-MISC', 'I-MISC', 'O'], ['B-PER', 'I-PER', 'O']]<br/>&gt;&gt;&gt;<br/>&gt;&gt;&gt; f1_score(y_true, y_pred)<br/>0.50<br/>&gt;&gt;&gt; accuracy_score(y_true, y_pred)<br/>0.80<br/>&gt;&gt;&gt; classification_report(y_true, y_pred)<br/>             precision    recall  f1-score   support<br/><br/>       MISC       0.00      0.00      0.00         1<br/>        PER       1.00      1.00      1.00         1<br/><br/>  micro avg       0.50      0.50      0.50         2<br/>  macro avg       0.50      0.50      0.50         2</span></pre><h1 id="d985" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">混淆矩阵计算</h1><p id="2a07" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">好了，我们已经有了一个很棒的解决度量计算的工具，为什么还要关心幕后的计算呢？</p><blockquote class="nd ne nf"><p id="cc46" class="kz la ng lb b lc ld ju le lf lg jx lh nh lj lk ll ni ln lo lp nj lr ls lt lu im bi translated">给一个人一条鱼，你可以喂他一天；教一个人钓鱼，你就喂了他一辈子。</p></blockquote><p id="80f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">混淆矩阵是机器学习领域的一个重要话题，但对于NER任务，关于如何计算混淆矩阵的帖子很少，所以我希望这篇帖子可以清除不确定性。</p><p id="7f4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们写出混淆矩阵表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/a5da2c4f5b2a5e9d7a3af348423cf65a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*F1c4hV2NQhVp2JX4O0KsVg.png"/></div></figure><p id="1696" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后计算精度、召回率和F1:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/c24f3ea18256c9744e6fc016d7677b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*jDAIKH0UDiy7C0p01N_yKQ.png"/></div></figure><p id="da97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们用上面的例子来填充混淆矩阵表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/6b928222847c4f62367b37d0e05c8c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KupCODdDsGL4SKI7SS0KAg.png"/></div></div></figure><p id="fdf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“外交部”算FN，“路透社”算TP。这两个很好区分。棘手的问题是预测何时会产生边界误差。如果模型产生了边界误差，我们算作两个误差。比如我们把实体“沈国放”算作两个错误，一个是FN，一个是FP。</p><p id="07ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们忽略实体类型，并像这样填充混淆矩阵表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/97724e742f6277bfe0a7cd96161cf357.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*VfRRH__-jS6Sz6mA_0gjow.png"/></div></figure><p id="2e94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后计算矩阵:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/abd195c37c979db49966b2a0e2bb2982.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*fiZHkKTxDyLuNbzCHZp5Uw.png"/></div></figure><h1 id="0d45" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">代码实现</h1><p id="d574" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们忽略实体类型，只计算上面例子中一个句子的混淆矩阵。为了更好的推广，代码实现必须<strong class="lb iu">考虑实体类型</strong>并计算<strong class="lb iu">所有句子</strong>的混淆矩阵。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><blockquote class="nd ne nf"><p id="bc7c" class="kz la ng lb b lc ld ju le lf lg jx lh nh lj lk ll ni ln lo lp nj lr ls lt lu im bi translated"><strong class="lb iu">查看我在</strong> <a class="ae ky" href="https://medium.com/@bramblexu" rel="noopener"> <strong class="lb iu">上的其他帖子</strong> </a> <strong class="lb iu">与</strong> <a class="ae ky" href="https://bramblexu.com/posts/eb7bd472/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">一个分类查看</strong> </a> <strong class="lb iu">！<br/> GitHub: </strong> <a class="ae ky" href="https://github.com/BrambleXu" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">荆棘徐</strong> </a> <strong class="lb iu"> <br/>领英:</strong> <a class="ae ky" href="https://www.linkedin.com/in/xu-liang-99356891/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">徐亮</strong> </a> <strong class="lb iu"> <br/>博客:</strong><a class="ae ky" href="https://bramblexu.com" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"/></a></p></blockquote><h1 id="ec45" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">参考</h1><ul class=""><li id="9d5e" class="nr ns it lb b lc mo lf mp li nt lm nu lq nv lu nw nx ny nz bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=0uI_5FYd5k0" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=0uI_5FYd5k0</a></li></ul></div></div>    
</body>
</html>