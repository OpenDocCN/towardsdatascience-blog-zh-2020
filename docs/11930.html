<html>
<head>
<title>Working with HDF5 files and creating CSV files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 HDF5 文件和创建 CSV 文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/working-with-hdf5-files-and-creating-csv-files-1a7d212d970f?source=collection_archive---------6-----------------------#2020-08-18">https://towardsdatascience.com/working-with-hdf5-files-and-creating-csv-files-1a7d212d970f?source=collection_archive---------6-----------------------#2020-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="938c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">HDF5 至 CSV 转换</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ea7ca549c760e69a46edca03be144809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m3aFawJouDrv0o7C"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@iammrcup?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杯先生/杨奇煜·巴拉尔</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2ec6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的上一篇文章中，我讨论了从 GES 光盘下载 NASA 数据的步骤。下载的数据文件为 HDF5 格式。HDF5 是一种文件格式和技术，支持管理非常大的数据集合。因此，它在存储信息方面非常受欢迎。要获得 NASA 的数据，请先查看下面的文章:</p><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/getting-nasa-data-for-your-next-geo-project-9d621243b8f3"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">为你的下一个地理项目获取 NASA 数据</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">访问 GES 光盘数据文件</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="f30b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每当我处理数据集时，我最喜欢 CSV 文件。因此，当我得到 HDF5 文件后，我决定想办法将它们转换成 CSV 文件。我在 Python 中找到了包<code class="fe mn mo mp mq b">h5py</code>，它支持 HDF5 文件的读入。因此，本文阐述了使用<code class="fe mn mo mp mq b">h5py</code>并将 HDF5 转换为 CSV 的步骤。您可以通过参考下面链接中的完整笔记本来跟进。</p><div class="lv lw gp gr lx ly"><a href="https://github.com/kb22/NASA-data-exploration/blob/master/Coverting%20HDF5%20to%20CSV.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">kb22/美国航天局数据探索</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">permalink dissolve GitHub 是超过 5000 万开发人员的家园，他们一起工作来托管和审查代码，管理…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">github.com</p></div></div><div class="mh l"><div class="mr l mj mk ml mh mm ks ly"/></div></div></a></div><h1 id="8333" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">导入库</h1><p id="b0ce" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">对于这项工作，我们需要两个库。第一个库是<code class="fe mn mo mp mq b">h5py</code>，它可以选择读取和处理 HDF5 文件(<a class="ae ky" href="http://docs.h5py.org/en/stable/" rel="noopener ugc nofollow" target="_blank">文档</a>)。我们需要的第二个包是用于数组的<code class="fe mn mo mp mq b">numpy</code>。最后，我们将导入<code class="fe mn mo mp mq b">pandas</code>,这样我们就可以创建一个数据帧，然后保存为 CSV 文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><h1 id="ec60" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">加载数据集</h1><p id="6936" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">下一步是载入 HDF5 文件。请注意，对于这个示例，我正在处理从 GES 光盘收集的 2020 年 1 月全球的 GPM 数据。它位于 GitHub repo 中的<strong class="lb iu"> data </strong>文件夹内(从<a class="ae ky" href="https://disc.gsfc.nasa.gov/" rel="noopener ugc nofollow" target="_blank"> GES 光盘网站</a>下载)。</p><p id="75dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将使用<code class="fe mn mo mp mq b">h5py</code>库中的<code class="fe mn mo mp mq b">File</code>方法来读取 HDF5 文件，并将其保存到名为<code class="fe mn mo mp mq b">dataset</code>的变量中。我指定文件名和完整路径作为第一个参数，并将第二个参数设置为<code class="fe mn mo mp mq b">r</code>,表示我正在以只读模式处理这个文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><h1 id="63e9" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">浏览数据集</h1><p id="380c" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">既然文件已经加载完毕，我们就可以开始研究数据集了。这个文件的元素类似于 Python 字典。因此，它由键值对组成。所以，我从查看这个文件中的各种键开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="db39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在上面的结果中看到的，只有一个名为<code class="fe mn mo mp mq b">Grid</code>的键。因为我们看不到任何数据，数据可能在这个键的值里面；这就是我所做的，我用<code class="fe mn mo mp mq b">dataset[’Grid’]</code>将它的值读入<code class="fe mn mo mp mq b">grid</code>，并查看它的键。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="a3e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后我们看数据。我们有几个可以使用的特性。所有这些都代表键，它们会有相应的值，这就是我们要找的。对于这项工作，我只对纬度、经度和该经纬度组合下的降雨量感兴趣。</p><p id="a2ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们逐一看看这些特性。</p><h2 id="cd3f" class="nr mt it bd mu ns nt dn my nu nv dp nc li nw nx ne lm ny nz ng lq oa ob ni oc bi translated">经度</h2><p id="56e6" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">我打印经度键及其属性。我们发现经度有 3600 个值。在属性中，<code class="fe mn mo mp mq b">units</code>和<code class="fe mn mo mp mq b">standard_name</code>是我想使用的两个东西。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><h2 id="20b3" class="nr mt it bd mu ns nt dn my nu nv dp nc li nw nx ne lm ny nz ng lq oa ob ni oc bi translated">纬度</h2><p id="fcaf" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">类似于经度，我检查键及其属性。有 1800 个纬度值和<code class="fe mn mo mp mq b">units</code>和<code class="fe mn mo mp mq b">standard_name</code>对我有用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><h2 id="87e6" class="nr mt it bd mu ns nt dn my nu nv dp nc li nw nx ne lm ny nz ng lq oa ob ni oc bi translated">沉淀</h2><p id="3a08" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">我打印沉淀的键和属性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="dfc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">降水数据是一个三维数组，降水值存储为二维矩阵。它的形状为(3600，1800 ),这意味着它具有所有经度和纬度组合的降水量值。此外，降水的单位在属性<code class="fe mn mo mp mq b">units</code>中被发现为<code class="fe mn mo mp mq b">mm/hr</code>。</p><h1 id="9f4b" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">创建数据框架</h1><p id="ccec" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">现在我们知道了我们想要在最终的 CSV 文件中捕获的所有内容，我们将直接开始捕获它。</p><p id="c477" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的数据集将有 6，480，000 行(3600x1800)。这些行中的每一行都有经度和纬度的唯一组合。因此，对于每个经度，我们有一个纬度和相应的降雨量。</p><p id="3434" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了创建所有降水值的经度值列表，我们需要将经度列表中的每个值重复 1800 次。使用<code class="fe mn mo mp mq b">np.repeat()</code>将其保存为总长度为 6，480，000 个值的<code class="fe mn mo mp mq b">longitude_values</code>(3600 个经度值，每个值表示 1800 次)。</p><p id="6042" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于每个经度值，我们需要所有的纬度值。因此，为了创建最终的<code class="fe mn mo mp mq b">latitude_values</code>列表，我们将完整的列表乘以 3600，创建一个 6，480，000 长的列表，其中纬度列表重复 3600 次。</p><p id="7318" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，为了转换降水值的矩阵，我使用了<code class="fe mn mo mp mq b">flatten()</code>函数将其转换为一个长列表。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="61e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我将这些列表保存为标签为<code class="fe mn mo mp mq b">lon</code>、<code class="fe mn mo mp mq b">lat</code>和<code class="fe mn mo mp mq b">precipitation</code>的<code class="fe mn mo mp mq b">dataset</code>数据帧的列。我用上面提取的标签和单位来重命名这些列。注意，由于字节编码，字符串用<code class="fe mn mo mp mq b">b</code>保存，所以我将这些属性附加上<code class="fe mn mo mp mq b">decode()</code>以获得字符串值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/2c17e5e48886e93bdd4a9c3850cbdf70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fP0zPo8AX4QVSOlgEmlFNQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">dataset.head()</p></figure><p id="f9a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一些降水值没有被捕获或丢失，在数据集中用<code class="fe mn mo mp mq b">-9999.900391</code>表示，所以我用值<code class="fe mn mo mp mq b">0</code>屏蔽它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="01e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一步，我将数据帧作为 CSV 文件<code class="fe mn mo mp mq b">precipitation_jan_2020.csv</code>保存在<strong class="lb iu">数据</strong>文件夹中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="95b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！我们有 CSV 文件。</p><h1 id="4cb2" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">结论</h1><p id="55fc" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">在本文中，我描述了用 Python 加载 HDF5 文件、读取其元素并最终创建可以保存为 CSV 文件的数据帧的步骤。对于任何其他 HDF5 文件，也可以复制相同的步骤。</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="71cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望你喜欢这篇文章。如果你有任何问题、建议或想法，请在评论中提出。</p></div></div>    
</body>
</html>