<html>
<head>
<title>Keep Jupyter Notebook Running Even After Browser is Closed</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保持 Jupyter 笔记本运行，即使浏览器关闭</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/keep-jupyter-notebook-running-even-after-browser-is-closed-9a1937b7c615?source=collection_archive---------5-----------------------#2020-01-31">https://towardsdatascience.com/keep-jupyter-notebook-running-even-after-browser-is-closed-9a1937b7c615?source=collection_archive---------5-----------------------#2020-01-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c2e5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">保持 Jupyter 笔记本运行的方法及其缺点</h2></div><p id="d4c5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">连续几天打开浏览器标签来运行 Jupyter 笔记本文件并不是最令人兴奋的工作。可能会很麻烦。以下是我找到的一些解决问题的方法。每种解决方案都有其优点和缺点，所以不再多说，让我们开始探索每一种解决方案吧！</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/9db1aa35bf8300716ea6008a8cc02615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gUx4wB6CvHOh5V8i"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated"><a class="ae lu" href="https://unsplash.com/@andrewtneel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">安德鲁·尼尔</a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h1 id="874f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">使用 Google Colab </strong></h1><p id="6dee" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">协作实验室，或简称为“Colab”，允许我们在没有配置和计算资源(如 GPU / TPU)的情况下运行 Python 代码。使用它，我们甚至可以通过在 CLI 命令前添加前缀<code class="fe ms mt mu mv b">%</code>来运行一些 bash 命令。这种方法的好处是它是免费的，允许从 Drive 或 Github 导入文件/数据集。它与 Google Drive 很好地集成在一起，我们可以编写代码来自动从 Drive 加载一些数据集，并将网络/结果保存到 Drive。</p><p id="02df" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，它有几个缺点。首先，它有<a class="ae lu" href="https://research.google.com/colaboratory/faq.html#resource-limits" rel="noopener ugc nofollow" target="_blank">有限的计算使用量</a>。一旦达到限制，它将停止运行代码，不久之后，文件/变量值将丢失。然而，极限并不是限制性的。我发现这对于在一些数据集上训练神经网络来说已经足够好了，比如<a class="ae lu" href="https://www.kaggle.com/c/leaf-classification" rel="noopener ugc nofollow" target="_blank">叶子分类</a>数据集。此外，如果您需要更大的计算使用/资源，可以连接到一个本地运行时<a class="ae lu" href="https://research.google.com/colaboratory/local-runtimes.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="f2b8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一个缺点是你不能关闭浏览器标签太长时间，也就是超过 90 分钟。根据我的经验，这可以通过连接到一个本地运行时<a class="ae lu" href="https://research.google.com/colaboratory/local-runtimes.html" rel="noopener ugc nofollow" target="_blank">来延长。</a></p><p id="42a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，当选项卡关闭时，它可能会丢失写入的日志。当您需要将所有日志都写入 Jupyter 笔记本文件时，这可能是一个问题。处理这种情况的一些方法是将输出记录到另一个文件中，或者使用特定的记录器。</p><h1 id="94af" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">将其作为 python 脚本运行</strong></h1><p id="099d" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">有多种方法可以将 Jupyter 笔记本文件作为 python 脚本运行。</p><p id="0644" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> 1。将其转换成 python 文件</strong></p><p id="3dd5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mw">最简单的</em>方式是在浏览器中打开 Jupyter 笔记本文件，点击文件&gt;下载为&gt; Python(。py)。之后，我们可以像运行典型的 python 文件一样运行输出文件:</p><pre class="lf lg lh li gt mx mv my mz aw na bi"><span id="674e" class="nb lw it mv b gy nc nd l ne nf">python file_name.py</span></pre><p id="249c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，记录在 Jupyter 笔记本上的文件会丢失。</p><p id="9b87" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> 2。直接使用命令提示符运行</strong></p><p id="3f57" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一种方法是直接使用 CLI 运行 jupyter 笔记本。它将允许我们在整个执行过程中将所有日志记录打印在 jupyter 笔记本文件中。为此，有两种程序可供选择，<strong class="kk iu"> runipy </strong>或<strong class="kk iu"> nbconvert </strong>。要安装 runipy 或 nbconvert，我们可以使用<strong class="kk iu"> pip/conda </strong>。</p><pre class="lf lg lh li gt mx mv my mz aw na bi"><span id="4bea" class="nb lw it mv b gy nc nd l ne nf"># Using pip<br/>pip install ipython<br/># Using conda<br/>conda install ipython</span></pre><p id="9087" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们使用 runipy 并安装了它，要运行 jupyter 笔记本，我们可以键入:</p><pre class="lf lg lh li gt mx mv my mz aw na bi"><span id="e382" class="nb lw it mv b gy nc nd l ne nf">runipy MyNotebookFileName.ipynb</span></pre><p id="d190" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要将每个单元格的输出保存回笔记本文件，请运行:</p><pre class="lf lg lh li gt mx mv my mz aw na bi"><span id="81fe" class="nb lw it mv b gy nc nd l ne nf">runipy MyNotebookFileName.ipynb</span></pre><p id="86fd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们使用并安装了 nbconvert，要运行 jupyter 笔记本，我们可以键入:</p><pre class="lf lg lh li gt mx mv my mz aw na bi"><span id="89d7" class="nb lw it mv b gy nc nd l ne nf">jupyter nbconvert --to notebook --execute mynotebook.ipynb</span></pre><p id="95e8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于<a class="ae lu" href="https://pypi.org/project/runipy/" rel="noopener ugc nofollow" target="_blank"> runipy </a>和<a class="ae lu" href="https://nbconvert.readthedocs.io/en/latest/execute_api.html" rel="noopener ugc nofollow" target="_blank"> nbconvert </a>，在这两个站点中还可以找到其他几个配置选项，如超时、报告生成和输出文件生成。</p><p id="aa0d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了保持这个命令在远程服务器上运行，即使我们与远程服务器断开连接，我们可以配置<strong class="kk iu"> screen </strong>或<strong class="kk iu"> tmux </strong>，并在其中任何一个中运行 Jupyter 的命令。</p><p id="93bc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，我发现这种方法的一个缺点是缺少向用户显示的日志记录。因此，即使脚本会错误地停止执行，也很难跟踪代码的进度。当我使用这种方法时，我利用<strong class="kk iu"> nvidia-smi </strong>和<strong class="kk iu"> htop </strong> bash 命令来尝试猜测程序的当前状态。</p><h1 id="e367" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">使用远程桌面</strong>到服务器</h1><p id="b361" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">这是迄今为止我最喜欢的方法。TLDR，它处理了以前方法的所有缺点。它允许我看到代码的进度以及每个单元的输出。即使当我断开连接时，脚本也保持运行。</p><p id="21b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> 1。在服务器上配置远程桌面</strong></p><p id="6554" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果服务器已经配置了远程桌面，您可以跳过此步骤。这一步可能是所有步骤中最棘手的一步，尤其是当服务器的操作系统版本过时时。</p><p id="d529" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">a.通过 SSH 连接到服务器</p><p id="6d1b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">b.安装一些软件包</p><pre class="lf lg lh li gt mx mv my mz aw na bi"><span id="64fb" class="nb lw it mv b gy nc nd l ne nf">sudo apt update<br/>sudo apt install -y ubuntu-desktop xrdp</span></pre><p id="5205" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">PS:如果你在服务器上没有 sudo 权限，或者，你可以使用<code class="fe ms mt mu mv b">wget</code>从 Github 安装这个包，然后<a class="ae lu" href="https://github.com/neutrinolabs/xrdp/wiki#building-from-sources" rel="noopener ugc nofollow" target="_blank">从源代码</a>编译它。如果下载的<code class="fe ms mt mu mv b">xrdp</code>版本有一些错误或者与操作系统不兼容，你可能也需要这样做来降级<code class="fe ms mt mu mv b">xrdp</code>的版本。</p><p id="9a92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">c.在服务器上编辑 RDP 配置文件<code class="fe ms mt mu mv b">/etc/xrdp/xrdp.ini</code>。最低配置可能如下所示:</p><pre class="lf lg lh li gt mx mv my mz aw na bi"><span id="ec8a" class="nb lw it mv b gy nc nd l ne nf">[globals]<br/>bitmap_cache=yes<br/>bitmap_compression=yes<br/>port=3389<br/>crypt_level=low<br/>channel_code=1<br/>max_bpp=24<br/><br/>[xrdp1]<br/>name=sesman-Xvnc<br/>lib=libvnc.so<br/>username=ask<br/>password=ask<br/>ip=127.0.0.1<br/>port=ask-1</span></pre><p id="d7d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意所写的端口，这对于建立连接非常重要。此外，如果您的服务器是 EC2 实例，我们需要适当地编辑安全组，以允许端口<code class="fe ms mt mu mv b">3389</code>中的入站 TCP 连接。</p><p id="cf9e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">d.重新启动 xrdp</p><pre class="lf lg lh li gt mx mv my mz aw na bi"><span id="b30f" class="nb lw it mv b gy nc nd l ne nf">sudo service xrdp restart</span></pre><p id="cb72" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">e.为 RDP 连接安装窗口管理器。这包括更改用户的<code class="fe ms mt mu mv b">.xsession</code>文件的内容。</p><pre class="lf lg lh li gt mx mv my mz aw na bi"><span id="1abd" class="nb lw it mv b gy nc nd l ne nf">sudo apt install -y xfce4 xfce4-goodies<br/>echo xfce4-session &gt;~/.xsession</span></pre><p id="7275" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">您已经准备好连接了！</strong>💃🏽💃🏽</p><p id="452d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> 2。在您的计算机中设置远程桌面客户端</strong></p><p id="9c32" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这一步将允许您的计算机连接到服务器。根据您电脑的操作系统，操作方法会有所不同。</p><p id="0cc2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于 Linux，安装<strong class="kk iu"> vinagre </strong>并打开。输入服务器的 IP 地址、用户名和 RDP 端口。然后，单击连接。</p><p id="01b6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于 Windows 或其他系统，可以使用<strong class="kk iu">远程桌面查看器</strong>完成上述步骤。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ng"><img src="../Images/4e02d3418772d1dd7ae38bae7183669c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwdMrnVxsDepVyxUzsEIVw.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">我的 Kali Linux 计算机上的远程桌面查看器</p></figure><p id="aaa7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于 Mac，我使用的是<strong class="kk iu">微软远程桌面</strong>。正确填写表格，然后单击添加。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nh"><img src="../Images/3b3f3fb79d87163a3417be3eb2789c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iKNO8b1SIYw_Pvs79K91Vw.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">Mac 版微软远程桌面。</p></figure><p id="9a98" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">之后，系统会提示您输入凭据。让港口保持原样。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ni"><img src="../Images/eb18cc2f8efeb48b196213316cb0c486.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-KXfkSVJoc_Tbhzob3nEsg.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">xrdp 登录表单</p></figure><p id="bd35" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦你通过认证，你应该会看到你的桌面。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nj"><img src="../Images/4fd5ee523fa2cbb51e51ff8babfd344f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2Ay8kqVVo3Yxik9_cJD_Q.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">远程桌面！</p></figure><p id="bf57" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> 3。在服务器的浏览器中运行 jupyter 笔记本</strong></p><p id="916b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这可以通过在终端中键入<code class="fe ms mt mu mv b">jupyter notebook</code>来完成，这将打开一个浏览器。然后，在浏览器中导航到相应的 jupyter 笔记本文件并将其打开。</p><p id="40f1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">单击工具栏上的单元格&gt;全部运行。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nk"><img src="../Images/a70193e4386c55ed7e4b99a155de5bd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tb_YZYjGfy04qk1iGFsvqQ.png"/></div></div></figure><p id="0236" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后关闭远程桌面客户端应用程序。切记不要关闭浏览器！😉😉</p><p id="d7bc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">全部完成！现在，您可以让浏览器在远程桌面上运行，并随时断开连接。您也可以通过重新连接来检查程序的进度。</p></div></div>    
</body>
</html>