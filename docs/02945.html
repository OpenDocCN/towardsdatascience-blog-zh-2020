<html>
<head>
<title>Detecting COVID-19 induced Pneumonia from Chest X-rays with Transfer Learning: An implementation in Tensorflow and Keras.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用迁移学习从胸部 X 射线检测新冠肺炎诱发的肺炎:在 Tensorflow 和 Keras 中的实现。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/detecting-covid-19-induced-pneumonia-from-chest-x-rays-with-transfer-learning-an-implementation-311484e6afc1?source=collection_archive---------3-----------------------#2020-03-21">https://towardsdatascience.com/detecting-covid-19-induced-pneumonia-from-chest-x-rays-with-transfer-learning-an-implementation-311484e6afc1?source=collection_archive---------3-----------------------#2020-03-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="eed7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">深度学习正在向新型冠状病毒进军。</h2></div><h1 id="3f42" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">介绍</h1><p id="945e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">新型冠状病毒(SARS-COV-2)已经成为人类面临的最紧迫的问题。新冠肺炎病像野火一样席卷全球，仅在三个月内就改变了全球面貌。高繁殖率和更高的并发症几率导致了边境关闭、空无一人的街道、猖獗的囤积、大规模的自我隔离政策、经济衰退和文化转向不信任。世界进入了一场新的世界大战，由一个看不见的敌人发动了闪电战。</p><p id="6361" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">随着发达国家的病例数量不断增加，各国政府正在慢慢意识到这个问题的严重性，人们希望看到全世界团结起来应对这一威胁。然而，无论是在 T2、国家还是个人层面，我们仍然可以观察到分歧和不信任。关于<a class="ae mb" href="https://edition.cnn.com/2020/02/20/us/coronavirus-racist-attacks-against-asian-americans/index.html" rel="noopener ugc nofollow" target="_blank">种族主义袭击</a>、<a class="ae mb" href="https://www.bbc.co.uk/news/uk-england-northamptonshire-51771584" rel="noopener ugc nofollow" target="_blank">盗窃</a>、<a class="ae mb" href="https://www.theguardian.com/world/2020/mar/19/uruguay-coronavirus-party-guest-argentina" rel="noopener ugc nofollow" target="_blank">不负责任行为</a>的报道十分猖獗。医生呼吁公众认真对待这种情况，并在避免所有非必要旅行的同时就地躲避。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/56a1af28d59302b75c97f532539d9e36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f83BKSwX2_F2maGO8ZKTAw.jpeg"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">选定国家的 COVID 病例数 19。(图片来源:路透社)</p></figure><p id="c16a" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">三月前抗击病毒的策略主要围绕<a class="ae mb" href="https://www.independent.co.uk/news/health/coronavirus-test-world-health-organisation-uk-contact-tracing-chris-whitty-phe-a9405476.html" rel="noopener ugc nofollow" target="_blank">遏制和追踪</a>——在疾病发展之前发现和隔离可能的病例。然而，随着病例的指数增长，世界各地的<a class="ae mb" href="https://www.msn.com/en-us/news/world/how-coronavirus-overwhelmed-italy-with-more-than-4000-deaths-in-one-month/ar-BB11tFLj" rel="noopener ugc nofollow" target="_blank">医院</a>已经<a class="ae mb" href="https://www.independent.co.uk/news/health/coronavirus-uk-cases-intensive-care-nhs-northwick-park-a9414311.html" rel="noopener ugc nofollow" target="_blank">迅速变得不堪重负</a>，政府政策已经转向<a class="ae mb" href="https://www.scmp.com/week-asia/explained/article/3075754/what-herd-immunity-and-can-it-stop-coronavirus" rel="noopener ugc nofollow" target="_blank">缓解甚至接受</a>。受影响国家缺乏检测能力进一步加剧了这一令人沮丧的过程，导致确诊病例数落后于真实值。这导致中国卫生当局暂时转而根据症状和胸部 x 光/CT 进行诊断。然而，这种解决方案仍然存在与其他肺炎原因重叠的风险，它们导致了许多混乱，国家又回到了基于 PCR(聚合酶链式反应)的测试。</p><p id="0a3c" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated"><strong class="lc iu">基于人工智能的解决方案最近已被广泛探索用于</strong> <a class="ae mb" href="https://www.sciencedaily.com/releases/2019/09/190930104505.htm" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iu">研究</strong> </a>中的肺炎检测，此类方法也已在本次疫情期间<a class="ae mb" href="https://www.radiologybusiness.com/topics/artificial-intelligence/ai-radiologists-coronavirus-pneumonia-chest-ct-x-ray" rel="noopener ugc nofollow" target="_blank">提出。据报道，定制模型的灵敏度和特异性接近 90%。然而，它们在确定肺炎病因方面的特异性，特别是对其他病毒性疾病(如流感)的特异性，仍在激烈辩论中。它们固有的实验性质要求同时使用确认方法，作为多学科诊断方法的一部分。</a></p><p id="e3a6" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在本文中，我们将探讨使用相对简单的迁移学习过程和受约束的数据集，构建一个能够在胸部 X 射线中检测各种肺炎原因的系统的可行性和困难。当然，这里描述的方法和内容仅用于教育目的。这不是一项科学严谨的研究，不应用于医学目的。</p><h1 id="feca" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">履行</h1><p id="8dcb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">我们已经在以前的文章中详细介绍了</strong> <a class="ae mb" href="https://medium.com/gradientcrescent/improving-classification-accuracy-using-data-augmentation-segmentation-a-hybrid-implementation-8ec29fa97043" rel="noopener"> <strong class="lc iu">迁移学习</strong> </a> <strong class="lc iu">和</strong> <a class="ae mb" href="https://medium.com/gradientcrescent/building-a-malaria-classifier-with-keras-background-implementation-d55c32773afa" rel="noopener"> <strong class="lc iu">卷积神经网络</strong> </a> <strong class="lc iu">，强烈推荐我们的读者参考它们以获得更全面的考虑。</strong></p><p id="1590" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">为了解决手头的问题，我们收集了自己的数据集，将蒙特利尔大学的约瑟夫·保罗·寇恩博士收集的<a class="ae mb" href="https://www.kaggle.com/paultimothymooney/chest-xray-pneumonia" rel="noopener ugc nofollow" target="_blank"> Kaggle 胸部 x 光数据集</a>与<a class="ae mb" href="https://github.com/ieee8023/covid-chestxray-dataset" rel="noopener ugc nofollow" target="_blank"> COVID19 胸部 x 光数据集</a>结合起来。这两个数据集都由肺炎患者的后前胸图像组成。随着更多案例的发布，COVID19 数据集每天都在更新，因此我们访问了 2020 年 3 月 18 日可用的实例。我们的数据集分为 4 个不同的类别，每类 9 张图像用作测试集。</p><ul class=""><li id="28f8" class="ms mt it lc b ld lw lg lx lj mu ln mv lr mw lv mx my mz na bi translated">健康:79 张图片</li><li id="6356" class="ms mt it lc b ld nb lg nc lj nd ln ne lr nf lv mx my mz na bi translated">肺炎(病毒性):79 张图片</li><li id="071e" class="ms mt it lc b ld nb lg nc lj nd ln ne lr nf lv mx my mz na bi translated">肺炎(细菌性):79 张图片</li><li id="f156" class="ms mt it lc b ld nb lg nc lj nd ln ne lr nf lv mx my mz na bi translated">肺炎(新冠肺炎):69 张图片</li></ul><p id="61c5" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">让我们看一些例子来强调不同原因之间的细微差别。特别是，<strong class="lc iu">如果没有广泛的放射培训</strong>  <strong class="lc iu">，病毒性病例和新冠肺炎病例之间的差异是无法区分的</strong> <a class="ae mb" href="https://www.google.com/search?q=covid19+resource+site+for+radiology+and+imaging&amp;rlz=1C1EJFA_enSG791SG791&amp;oq=covid19+resource+site+for+radiology+and+imaging&amp;aqs=chrome..69i57.5111j0j7&amp;sourceid=chrome&amp;ie=UTF-8" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iu">，这加剧了一线医护人员面临的困难</strong></a></p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ng"><img src="../Images/ed8612a5568e48f3ff8d23aa8d905c8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a-WIZmtG7Q0PdQO0WNmjIQ.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">入院病人的胸透。从左至右:健康、细菌、病毒、COVID19。</p></figure><p id="e1b4" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我们的代码是用 Keras 和 Tensorflow 编写的，并在一个支持 GPU 的 Google 协同实验室笔记本实例中运行。所有代码都可以在 GradientCrescent <a class="ae mb" href="https://github.com/EXJUSTICE/GradientCrescent" rel="noopener ugc nofollow" target="_blank">库上获得。</a></p><h1 id="704a" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated"><strong class="ak">二进制案件</strong></h1><p id="4867" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们从二元案例开始——比较健康的肺和那些表现出由 SARS-COV-2 病毒引起的肺炎的肺。这在<em class="nh">covid 19 _ GradientCrescent _ Binary</em>笔记本中有所涉及。</p><p id="af2f" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">首先，让我们从 GradientCrescent Google Drive 导入数据集。</p><pre class="md me mf mg gt ni nj nk nl aw nm bi"><span id="c1c2" class="nn kj it nj b gy no np l nq nr">!gdown <a class="ae mb" href="https://drive.google.com/uc?id=1coM7x3378f-Ou2l6Pg2wldaOI7Dntu1a" rel="noopener ugc nofollow" target="_blank">https://drive.google.com/uc?id=1coM7x3378f-Ou2l6Pg2wldaOI7Dntu1a</a></span><span id="5090" class="nn kj it nj b gy ns np l nq nr">!unzip Covid_Data_GradientCrescent.zip</span></pre><p id="4266" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">接下来，我们将导入一些必要的库，并定义数据集路径和网络的一些参数。因为我们是迁移学习，我们将保持我们的学习率在 5e-4 的低值。</p><pre class="md me mf mg gt ni nj nk nl aw nm bi"><span id="71ae" class="nn kj it nj b gy no np l nq nr">import numpy as np</span><span id="b3c3" class="nn kj it nj b gy ns np l nq nr">import tensorflow as tf</span><span id="189c" class="nn kj it nj b gy ns np l nq nr">DATASET_PATH = ‘/content/two/train’</span><span id="e1b5" class="nn kj it nj b gy ns np l nq nr">test_dir = ‘/content/two/test’</span><span id="d078" class="nn kj it nj b gy ns np l nq nr">IMAGE_SIZE = (150, 150)</span><span id="892b" class="nn kj it nj b gy ns np l nq nr">NUM_CLASSES = len(data_list)</span><span id="db8b" class="nn kj it nj b gy ns np l nq nr">BATCH_SIZE = 10 # try reducing batch size or freeze more layers if your GPU runs out of memory</span><span id="4836" class="nn kj it nj b gy ns np l nq nr">NUM_EPOCHS = 20</span><span id="b47d" class="nn kj it nj b gy ns np l nq nr">LEARNING_RATE =0.0005 </span></pre><p id="182c" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">接下来，让我们使用 ImageDataGenerator 类来设置相应的训练和验证预处理以及批处理图像准备函数，对于这种情况，将我们的<em class="nh"> class_mode </em>参数指定为“binary”。</p><pre class="md me mf mg gt ni nj nk nl aw nm bi"><span id="42ce" class="nn kj it nj b gy no np l nq nr">#Train datagen here is a preprocessor<br/>train_datagen = ImageDataGenerator(rescale=1./255,<br/> rotation_range=50,<br/> featurewise_center = True,<br/> featurewise_std_normalization = True,<br/> width_shift_range=0.2,<br/> height_shift_range=0.2,<br/> shear_range=0.25,<br/> zoom_range=0.1,<br/> zca_whitening = True,<br/> channel_shift_range = 20,<br/> horizontal_flip = True ,<br/> vertical_flip = True ,<br/> validation_split = 0.2,<br/> fill_mode=’constant’)</span><span id="87a1" class="nn kj it nj b gy ns np l nq nr">train_batches = train_datagen.flow_from_directory(DATASET_PATH,<br/> target_size=IMAGE_SIZE,<br/> shuffle=True,<br/> batch_size=BATCH_SIZE,<br/> subset = “training”,<br/> seed=42,<br/> class_mode=”binary”,<br/> <br/> )</span><span id="f254" class="nn kj it nj b gy ns np l nq nr">valid_batches = train_datagen.flow_from_directory(DATASET_PATH,<br/> target_size=IMAGE_SIZE,<br/> shuffle=True,<br/> batch_size=BATCH_SIZE,<br/> subset = “validation”,<br/> seed=42,<br/> class_mode=”binary”,<br/> <br/> <br/> )</span></pre><p id="d9cf" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">完成所有这些后，让我们来定义我们的网络，它在我们的两台笔记本电脑之间共享。我们采用预训练的<a class="ae mb" href="https://arxiv.org/pdf/1409.1556.pdf" rel="noopener ugc nofollow" target="_blank"> VGG16 网络</a>，并将其与我们自己的一系列密集连接的层相适应，我们的输出层具有针对二进制分类情况的 sigmoid 激活函数。我们将编译我们的网络，并将 ADAM 优化器附加到它上面。</p><pre class="md me mf mg gt ni nj nk nl aw nm bi"><span id="26ea" class="nn kj it nj b gy no np l nq nr">from keras import models<br/>from keras import layers<br/>from keras.applications import VGG16<br/>from keras import optimizers<br/>from keras.layers.core import Flatten, Dense, Dropout, Lambda</span><span id="3a85" class="nn kj it nj b gy ns np l nq nr">conv_base = VGG16(weights=’imagenet’,<br/> include_top=False,<br/> input_shape=(150, 150, 3))</span><span id="39bc" class="nn kj it nj b gy ns np l nq nr">conv_base.trainable = False</span><span id="5e76" class="nn kj it nj b gy ns np l nq nr">model = models.Sequential()<br/>model.add(conv_base)<br/>model.add(layers.Flatten())<br/>model.add(layers.Dense(256, activation=’relu’))<br/>model.add(layers.Dense(1, activation=’sigmoid’))</span><span id="d8d5" class="nn kj it nj b gy ns np l nq nr">model.compile(loss=’binary_crossentropy’,<br/> <br/> optimizer=optimizers.Adam(lr=LEARNING_RATE),<br/> metrics=[‘acc’])</span></pre><p id="90c6" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">定义好我们的网络后，让我们开始 20 个纪元的训练。</p><pre class="md me mf mg gt ni nj nk nl aw nm bi"><span id="c998" class="nn kj it nj b gy no np l nq nr">STEP_SIZE_TRAIN=train_batches.n//train_batches.batch_size<br/>STEP_SIZE_VALID=valid_batches.n//valid_batches.batch_size</span><span id="b9b7" class="nn kj it nj b gy ns np l nq nr">result=model.fit_generator(train_batches,<br/> steps_per_epoch =STEP_SIZE_TRAIN,<br/> validation_data = valid_batches,<br/> validation_steps = STEP_SIZE_VALID,<br/> epochs= NUM_EPOCHS,<br/> )</span></pre><p id="c065" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">您应该会发现，我们的验证准确性收敛速度相对较快，超过了 80%。有了更大的数据集，我们将能够提供更多的验证示例来减少不同时期之间的差异，但结果对于演示目的来说是令人满意的。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nt"><img src="../Images/b201bbfede753315ec0aad1d9b0eea11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P6dMRkkNV_LafOJWqbj4VQ.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">二进制情况的最后 3 个时期的精度和损失。</p></figure><p id="32d7" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">最后，我们将使用<em class="nh"> matplotlib </em>库来绘制我们的精度和损失参数，作为我们训练时期的一个因素。</p><pre class="md me mf mg gt ni nj nk nl aw nm bi"><span id="caf8" class="nn kj it nj b gy no np l nq nr">import matplotlib.pyplot as plt</span><span id="2e51" class="nn kj it nj b gy ns np l nq nr">def plot_acc_loss(result, epochs):<br/> acc = result.history[‘acc’]<br/> loss = result.history[‘loss’]<br/> val_acc = result.history[‘val_acc’]<br/> val_loss = result.history[‘val_loss’]<br/> plt.figure(figsize=(15, 5))<br/> plt.subplot(121)<br/> plt.plot(range(1,epochs), acc[1:], label=’Train_acc’)<br/> plt.plot(range(1,epochs), val_acc[1:], label=’Test_acc’)<br/> plt.title(‘Accuracy over ‘ + str(epochs) + ‘ Epochs’, size=15)<br/> plt.legend()<br/> plt.grid(True)<br/> plt.subplot(122)<br/> plt.plot(range(1,epochs), loss[1:], label=’Train_loss’)<br/> plt.plot(range(1,epochs), val_loss[1:], label=’Test_loss’)<br/> plt.title(‘Loss over ‘ + str(epochs) + ‘ Epochs’, size=15)<br/> plt.legend()<br/> plt.grid(True)<br/> plt.show()<br/> <br/>plot_acc_loss(result, 20)</span></pre><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/ca894a4a0f68d4cc64db9b8b7c45d0ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*ZLNDgbeq3m9jqCAUi-OmMA.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">对于二进制情况，取 20 个时期的精度和损耗参数。</p></figure><p id="6e7f" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">为了确认我们的结果，我们将在测试数据集上测试我们的模型，每个类包含 9 个图像。<strong class="lc iu">请注意，您需要将<em class="nh">随机播放</em>参数设置为<em class="nh">真</em>以获得准确的结果。</strong></p><pre class="md me mf mg gt ni nj nk nl aw nm bi"><span id="b767" class="nn kj it nj b gy no np l nq nr">test_datagen = ImageDataGenerator(rescale=1. / 255)</span><span id="eaa6" class="nn kj it nj b gy ns np l nq nr">eval_generator = test_datagen.flow_from_directory(<br/> test_dir,target_size=IMAGE_SIZE,<br/> batch_size=1,<br/> shuffle=False,<br/> seed=42,<br/> <br/> <br/> class_mode=”binary”)<br/>eval_generator.reset()</span><span id="25e8" class="nn kj it nj b gy ns np l nq nr">x = model.evaluate_generator(eval_generator,<br/> steps = np.ceil(len(eval_generator) / BATCH_SIZE),<br/> use_multiprocessing = False,<br/> verbose = 1,<br/> workers=1<br/> )</span><span id="bc43" class="nn kj it nj b gy ns np l nq nr">print(‘Test loss:’ , x[0])<br/>print(‘Test accuracy:’,x[1])</span></pre><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/5f7f8ed16e086fbb87c404572b949604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*DTcnqzoMd8A1OpLQToiXEg.png"/></div></figure><p id="2ce6" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">虽然看起来我们的模型在这个任务中表现得很完美，但是考虑到一个大得多的测试数据集，我们希望这个值与我们的验证精度相匹配。最后，让我们使用<em class="nh"> cv2 </em>图像处理类和 Keras 的<em class="nh"> predict_generator() </em>方法绘制一些测试图像以及它们各自的预测。注意，要复制这一点，您需要将 evaluation_generator 的<em class="nh"> shuffle </em>参数设置为<em class="nh"> False </em>，以避免类索引混乱。</p><pre class="md me mf mg gt ni nj nk nl aw nm bi"><span id="b6a4" class="nn kj it nj b gy no np l nq nr">eval_generator.reset() <br/>pred = model.predict_generator(eval_generator,1000,verbose=1)<br/>print(“Predictions finished”)</span><span id="d217" class="nn kj it nj b gy ns np l nq nr">import cv2</span><span id="98bd" class="nn kj it nj b gy ns np l nq nr">import matplotlib.image as mpimg<br/>for index, probability in enumerate(pred):<br/> image_path = test_dir + “/” +eval_generator.filenames[index]<br/> image = mpimg.imread(image_path)<br/> #BGR TO RGB conversion using CV2<br/> image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)</span><span id="091c" class="nn kj it nj b gy ns np l nq nr">pixels = np.array(image)<br/> plt.imshow(pixels)<br/> <br/> print(eval_generator.filenames[index])<br/> if probability &gt; 0.5:<br/> plt.title(“%.2f” % (probability[0]*100) + “% Normal”)<br/> else:<br/> plt.title(“%.2f” % ((1-probability[0])*100) + “% COVID19 Pneumonia”)<br/> plt.show()</span></pre><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nw"><img src="../Images/43723b61693d0093702bf71ca24029d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ZE3hRsNhf7VFE74pWLs7Q.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">COVID19(左)和健康(右)测试集图像的预测概率。</p></figure><p id="88bb" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我们的网络成功地发现了两个案例之间的差异。但这是肤浅的，让我们把赌注提高一个档次，试着区分不同类型的肺炎。我们将切换到第二本 Jupyter 笔记本，<em class="nh">covid 19 _ GradientCrescent _ multi . ipynb .</em></p><h1 id="1c7f" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated"><strong class="ak">多级案件</strong></h1><p id="5323" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这种情况下，我们不仅试图将健康的肺与感染肺炎的肺分开，还试图区分肺炎的不同原因，无论它们是由细菌、新型冠状病毒病毒还是其他病毒引起的。</p><p id="ec7a" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我们的大部分代码与二进制代码是相同的。为了避免重复，我们来强调一下主要区别:</p><ul class=""><li id="df33" class="ms mt it lc b ld lw lg lx lj mu ln mv lr mw lv mx my mz na bi translated">我们的 ImageDataGenerator 类中的<em class="nh"> class_mode </em>参数被设置为“分类”。</li><li id="98a7" class="ms mt it lc b ld nb lg nc lj nd ln ne lr nf lv mx my mz na bi translated">现在，我们最终密集连接层中的神经元数量对应于所考虑的类的数量，并附带了一个<em class="nh"> softmax </em>激活函数。这将允许我们给出每个类别的概率输出，并取最大值作为我们的最终预测输出。</li><li id="3890" class="ms mt it lc b ld nb lg nc lj nd ln ne lr nf lv mx my mz na bi translated">该模型现在用<em class="nh">分类 _ 交叉熵</em>损失函数编译。</li><li id="15d4" class="ms mt it lc b ld nb lg nc lj nd ln ne lr nf lv mx my mz na bi translated">训练时期的数量增加，以适应增加的情况复杂性。同样的，学习率也降到了 1E-4。</li></ul><p id="0428" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">让我们在考虑三个类别(健康、新冠肺炎、细菌)时，在以 5E-4 的学习速率训练 100 个时代之后，查看训练结果。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/71e8c098efefc9e8a0e89e2f4309fb4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*ukMJuPvMpgkrVzgyDqgn4A.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">三级情况下，100 个时期内的精度和损耗参数。</p></figure><p id="e876" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">虽然我们的模型的性能到目前为止是令人满意的，达到 80%以上，但让我们来看看合并了其他病毒性肺炎原因的四级情况。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/1615d0a54bafb2c64b9ba7bdbbd18c30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*BjLlN7soQ4dxxRbAEkrVag.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">四级情况下，100 个时期内的精度和损耗参数。</p></figure><p id="d726" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">正如可以观察到的，三级病毒性肺炎类别的引入使准确性显著下降到 60%以上。这是可以理解的，因为新冠肺炎本身是由 SARS-COV-2 病毒引起的，因此我们可以预期这两个类别之间的特征域有很大的重叠。随着更细观的模型、更高的数据可用性和更长的微调过程，我们预计精确度会提高。</p><p id="7ead" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我们的结果增加了单独使用 CT/X 射线诊断 COVD-19 的难度，并有助于部分解释为什么中国卫生当局放弃了这种方法，转而使用基于 PCR 的测试:由于所有其他冬季病菌都在传播，确定个别病例中肺炎的原因变得非常困难。甚至可能有几种<a class="ae mb" href="https://www.ncbi.nlm.nih.gov/pubmed/17603232" rel="noopener ugc nofollow" target="_blank">并行的肺炎原因，</a>进一步使临床诊断复杂化。</p><p id="80af" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我们希望你喜欢这篇文章，并希望你查看 GradientCrescent 上的许多其他文章，涵盖人工智能的应用和理论方面。要了解关于<a class="ae mb" href="https://medium.com/@adrianitsaxu" rel="noopener"> GradientCrescent </a>的最新更新，请考虑关注该出版物并关注我们的 Github 资源库。</p><p id="41d2" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">记得保持安全，洗手，并互相照顾。正如古代诗人长谷所言——“虽然我们生活在不同的地方，但我们共享一片天空”。</p></div></div>    
</body>
</html>