<html>
<head>
<title>Create COVID-19 Map Animation with Python in 5 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python在5分钟内创建新冠肺炎地图动画</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/covid-19-map-animation-with-python-in-5-minutes-2d6246c32e54?source=collection_archive---------26-----------------------#2020-05-29">https://towardsdatascience.com/covid-19-map-animation-with-python-in-5-minutes-2d6246c32e54?source=collection_archive---------26-----------------------#2020-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="697b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据可视化</h2><div class=""/><div class=""><h2 id="cc22" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">用Python和Plotly制作新冠肺炎地图动画</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/5501e6dd42b5e1e1e3e5cd19ba7a8196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bnXFctWPp50508cj"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">马特·拉默斯在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="27c8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di">在抗击新冠肺炎的战斗中，GIS技术在很多方面都发挥了重要作用，包括数据整合、疫情信息的地理空间可视化、确诊病例的空间追踪、区域传播预测等等。这些为政府部门抗击新冠肺炎疫情提供了支持信息。[1]为了解决这个问题，JHU提供了一个用ESRI ArcGIS operation dashboard创建的漂亮的<a class="ae lh" href="https://www.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6" rel="noopener ugc nofollow" target="_blank">仪表盘</a>:</span></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mn"><img src="../Images/5b1a6d24ec1e006b6a95bfb79a88b7c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b_tSPjWNfArnI3LPmVuSAQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd mo">CSSE在JHU的</strong> <a class="ae lh" href="https://www.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6" rel="noopener ugc nofollow" target="_blank"> <strong class="bd mo">新冠肺炎仪表盘</strong></a><strong class="bd mo"/>(2020年5月29日截图)</p></figure><p id="d03b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">仪表板提供了累计确诊病例总数、活跃病例、发病率、病死率、检测率和住院率的非常好的概览。但是，在地图上可视化数据随时间变化的功能丢失了！</p><p id="9c85" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本文将向您介绍一种使用JHU·新冠肺炎数据集创建可视化新冠肺炎随时间扩展的动态地图的简单方法。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="b92c" class="mw mx it bd my mz na dn nb nc nd dp ne lr nf ng nh lv ni nj nk lz nl nm nn iz bi translated">我们开始吧！</h2><h1 id="1f5d" class="no mx it bd my np nq nr nb ns nt nu ne ki nv kj nh kl nw km nk ko nx kp nn ny bi translated">步骤1:准备Python库</h1><p id="b680" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">我们将在本文中使用的Python库主要是Pandas、PyCountry和Plotly Express。你们中的大多数人可能已经知道Plotly库，但是如果不知道，你可以在这篇文章中查看它的所有特性。</p><pre class="ks kt ku kv gt oe of og oh aw oi bi"><span id="f9bb" class="mw mx it of b gy oj ok l ol om"><strong class="of jd">$ pip install pandas<br/>$ pip install pycountry<br/>$ pip install plotly</strong></span></pre></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="9381" class="no mx it bd my np on nr nb ns oo nu ne ki op kj nh kl oq km nk ko or kp nn ny bi translated">步骤2:加载数据集</h1><p id="daf6" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">我们将在这里使用的数据集是JHU·CSSE·新冠肺炎数据集。你可以从CSSE Github <a class="ae lh" href="https://github.com/CSSEGISandData/COVID-19/blob/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv" rel="noopener ugc nofollow" target="_blank"> repo </a>下载或获取它的最新更新版本。您可以查看这篇<a class="ae lh" rel="noopener" target="_blank" href="/automatically-update-data-sources-in-python-e424dbea68d0">文章</a>，了解如何使用<em class="os"> PythonGit </em>在您的Python项目中随时间自动更新数据源。在本文中，我们将只关注<code class="fe ot ou ov of b"><strong class="lk jd">time_series_covid19_confirmed_global.csv</strong></code> <strong class="lk jd"> </strong>数据集。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ow"><img src="../Images/88613e8d892974a29462434dfef1d965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lWzuZFM4EcKyXuv3KR-Fcw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd mo">来自JHU CSSE的时间序列_ covid 19 _ confirmed _ global . CSV</strong></p></figure><p id="623b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，您可以使用以下命令轻松地将数据加载到dataframe</p><pre class="ks kt ku kv gt oe of og oh aw oi bi"><span id="ca85" class="mw mx it of b gy oj ok l ol om"><strong class="of jd">import pandas as pd<br/>df_confirm = </strong><strong class="of jd">pd.read_csv('path_to_file')</strong></span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ox"><img src="../Images/0922e9ad4f7b5e94aa6e40599bfae4e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YsD96jqjdnoOchDOOUL2wQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd mo">时间序列_ covid19 _已确认_全局</strong>数据集</p></figure></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="d5ea" class="no mx it bd my np on nr nb ns oo nu ne ki op kj nh kl oq km nk ko or kp nn ny bi translated">步骤3:清理数据集</h1><p id="07c4" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">为了使用Plotly Express动态可视化时间序列数据集，您需要满足以下数据框架要求。</p><ul class=""><li id="0771" class="oy oz it lk b ll lm lo lp lr pa lv pb lz pc md pd pe pf pg bi translated"><strong class="lk jd">将数据集</strong>聚合到国家级别。</li><li id="c192" class="oy oz it lk b ll ph lo pi lr pj lv pk lz pl md pd pe pf pg bi translated"><strong class="lk jd">获取每个国家在<a class="ae lh" href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3" rel="noopener ugc nofollow" target="_blank">ISO 3166–1</a>中定义的三个字母的国家代码</strong>；例如，<code class="fe ot ou ov of b">AFG</code>代表阿富汗。你可以使用<a class="ae lh" href="https://pypi.org/project/pycountry/" rel="noopener ugc nofollow" target="_blank"> PyCountry </a>来做到这一点。</li><li id="46ea" class="oy oz it lk b ll ph lo pi lr pj lv pk lz pl md pd pe pf pg bi translated"><strong class="lk jd">将数据集转换为长格式</strong>，其中日期值在单个列中表示。您可以轻松完成此操作，首先将数据集加载到Pandas数据帧中，然后在Pandas中使用<a class="ae lh" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> melt </strong> </a>。</li></ul><p id="2d28" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以使用此Python脚本执行以下步骤:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="5b68" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">总体而言，最终的干净数据帧如下图所示:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi po"><img src="../Images/a0c23c93ee0fe5bbff48602ac8b95530.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nAnff3CH5wsg3SCwwQ9akw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd mo">已清理的时间序列_ covid19 _已确认_全局</strong>数据集</p></figure></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="c718" class="no mx it bd my np on nr nb ns oo nu ne ki op kj nh kl oq km nk ko or kp nn ny bi translated">步骤4:使用Plotly Express创建地图动画</h1><p id="2427" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">数据集准备就绪后，您可以使用Plotly Express轻松创建地图动画。例如，您可以使用下面的脚本从步骤3的数据帧创建一个动画choropleth图，您也可以根据自己的喜好调整每个参数。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="ak">使用Plotly Express从time _ series _ covid 19 _ confirmed _ global数据集创建动画choropleth的Python脚本</strong></p></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pp"><img src="../Images/d82d57711d79db5ae0273c57e9e8f3b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JsDG7AyfQk2SHdLYKfIqag.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd mo">使用Plotly Express从时间序列_ covid19 _已确认_全局数据集制作的动画choropleth】</strong></p></figure><h2 id="250a" class="mw mx it bd my mz na dn nb nc nd dp ne lr nf ng nh lv ni nj nk lz nl nm nn iz bi translated">差不多就是这样！简单对吗？</h2></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="859c" class="mw mx it bd my mz na dn nb nc nd dp ne lr nf ng nh lv ni nj nk lz nl nm nn iz bi translated">下一步是什么？</h2><p id="a40f" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">此示例可视化了已确认的新冠肺炎病例数据集，但您也可以尝试将此方法应用于可视化新冠肺炎死亡病例和康复病例数据集。</p><p id="0b63" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">关于用plotly绘制动画choropleth地图的更多信息，查看完整文档<a class="ae lh" href="https://plotly.com/python/choropleth-maps/" rel="noopener ugc nofollow" target="_blank">这里</a>。如果你想改变色阶，你可以简单地从<a class="ae lh" href="https://plotly.com/python/builtin-colorscales/" rel="noopener ugc nofollow" target="_blank">这里</a>选择内置色阶。应用更好的颜色符号规则。尝试创建其他类型的地图，如散点图或热图，通过查看Plotly地图库<a class="ae lh" href="https://plotly.com/python/maps/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="7df0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">或者，您可以通过本文<a class="ae lh" rel="noopener" target="_blank" href="/4d-data-visualization-with-kepler-gl-b6bd6dd90451">查看如何在Kepler.gl中可视化新冠肺炎数据，这是一个用于动态数据可视化的地理空间分析工具。</a></p><h1 id="eff8" class="no mx it bd my np nq nr nb ns nt nu ne ki nv kj nh kl nw km nk ko nx kp nn ny bi translated">结论</h1><p id="f11d" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">本文将向您介绍如何使用Plotly Express以简单的方式准备数据集和创建地图动画。我希望你喜欢这篇文章，并发现它对你的日常工作或项目有用。如果您有任何问题或意见，请随时给我留言。</p><p id="fe8a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">关于我&amp;查看我所有的博客内容:<a class="ae lh" href="https://joets.medium.com/about-me-table-of-content-bc775e4f9dde" rel="noopener">链接</a></p><p id="ebe3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">安全<strong class="lk jd">健康</strong>和<strong class="lk jd">健康</strong>！💪</p><p id="2645" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">感谢您的阅读。📚</strong></p><h1 id="3fa4" class="no mx it bd my np nq nr nb ns nt nu ne ki nv kj nh kl nw km nk ko nx kp nn ny bi translated">参考</h1><p id="56be" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">[1]周，陈，苏，李，李，马，蒋，李，阎，李，易，胡，杨，肖，(2020)。新冠肺炎:大数据对GIS的挑战。地理和可持续性，1(1)，77–87。<a class="ae lh" href="https://doi.org/10.1016/j.geosus.2020.03.005" rel="noopener ugc nofollow" target="_blank">https://doi.org/10.1016/j.geosus.2020.03.005</a></p></div></div>    
</body>
</html>