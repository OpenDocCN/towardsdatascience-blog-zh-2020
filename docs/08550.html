<html>
<head>
<title>Labelling Time Series Data in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python标记时间序列数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/labelling-time-series-data-in-python-af62325e8f60?source=collection_archive---------28-----------------------#2020-06-21">https://towardsdatascience.com/labelling-time-series-data-in-python-af62325e8f60?source=collection_archive---------28-----------------------#2020-06-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="56db" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">用于监督机器学习</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi kj"><img src="../Images/0c8c6cfd14f5fae88e928e5565f8441b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/0*DwWFaR_1DuMNUcAt"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:Freepik</p></figure><p id="30b5" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">最近，我在进行一个<a class="ae lr" href="https://github.com/LucyRothwell/Classifying-Stutters-Neuroscience/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">研究项目</a>，我必须标记112，000行时间序列数据，这样我就可以在监督机器学习中使用它。我需要数据中的行在事件发生时显示“1 ”,在事件没有发生时显示“0”。但是标签的信息被嵌入了3个小时的录音。</p><p id="e40f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">本质上我必须去…</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ls"><img src="../Images/4d540f1cb5142a4e405bba3a1da544bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H68HY2jsInL0QevDC5_qgw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者创建的图像</p></figure><p id="dca5" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">本文解释了我为此创建的过程和代码。</p><p id="a945" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">简而言之，步骤如下:</p><ol class=""><li id="2f40" class="lx ly it kx b ky kz lb lc le lz li ma lm mb lq mc md me mf bi translated"><strong class="kx iu">将您的数据加载到脚本</strong> ( <em class="mg">时间序列数据</em> &amp; <em class="mg">事件标记</em>)</li><li id="dd5b" class="lx ly it kx b ky mh lb mi le mj li mk lm ml lq mc md me mf bi translated"><strong class="kx iu">将事件的起止时间分解为一列秒/十分之一秒</strong></li><li id="3993" class="lx ly it kx b ky mh lb mi le mj li mk lm ml lq mc md me mf bi translated"><strong class="kx iu">将列表转换成一列1和0</strong></li><li id="65c5" class="lx ly it kx b ky mh lb mi le mj li mk lm ml lq mc md me mf bi translated"><strong class="kx iu">将1和0列写入数据文件</strong>的“标签”列</li></ol><p id="fe92" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您需要的所有代码都在本文中。您在脚本开始时输入了三个变量。之后，你只需点击运行，带标签的数据文件就会神奇地出现在你的目录中，随时可以用于SVM、逻辑回归或你正在使用的任何机器学习算法。</p><p id="31f8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><em class="mg">注意:假设您已经以适合您的数据类型的方式预处理了您的时间序列数据，并且它与事件标记数据时间同步。</em></p><h1 id="87bf" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated"><strong class="ak">步骤0:数据准备</strong></h1><p id="dfbe" class="pw-post-body-paragraph kv kw it kx b ky ne ju la lb nf jx ld le ng lg lh li nh lk ll lm ni lo lp lq im bi translated">开始之前，检查您的数据是否为脚本正确格式化。该脚本使用2个文件；您的<em class="mg">时间序列数据</em>和您的<em class="mg">事件标记</em>。每一个都有一个假设:</p><ol class=""><li id="c78a" class="lx ly it kx b ky kz lb lc le lz li ma lm mb lq mc md me mf bi translated"><strong class="kx iu">时间序列数据:</strong> <em class="mg">时间序列数据</em>是事件发生时你所做的测量(例如，在20分钟的说话时间内所做的神经读数测量)。<strong class="kx iu">假设</strong>:您的时间列是csv文件的第一列(col[0])。</li><li id="101c" class="lx ly it kx b ky mh lb mi le mj li mk lm ml lq mc md me mf bi translated"><strong class="kx iu">事件标记数据:</strong>事件标记是显示事件发生和未发生的持续时间。(例如，如果您正在使用神经数据来测量一个人说话时大脑活动的变化，则事件将在这个人说话时发生)。<strong class="kx iu">假设</strong>:你的<em class="mg">事件标记</em>是这样的开始和结束时间形式:</li></ol><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/5a682a4ffc9b122dfcdcf432bca3aea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*waScez3WO-9Mjd4Dysbd_A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">例如，这可以是显示该人每次开始说话和何时停止说话的几个事件。(<em class="ki">图片由作者</em>创作)。</p></figure><p id="6744" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><em class="mg">注意:如果您的事件数据已经在您的首选采样率的一列中，您只需执行步骤1、3和4。</em></p><p id="ee46" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">提示</strong>:如果你用音频记录了你的活动，并把它们保存在. mp3或。wav文件，我建议使用<a class="ae lr" href="https://www.audacityteam.org/download/" rel="noopener ugc nofollow" target="_blank"> Audacity软件</a>。它可爱又免费，允许你在音频记录上标记事件，并且导出事件标记，就像上面显示的那样。</p><h1 id="d177" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated"><strong class="ak"> 1。将您的数据载入脚本</strong></h1><p id="892e" class="pw-post-body-paragraph kv kw it kx b ky ne ju la lb nf jx ld le ng lg lh li nh lk ll lm ni lo lp lq im bi translated">现在，您可以加载(1)您的<em class="mg">时间序列数据</em> , (2)您的<em class="mg">事件标记数据</em>,( 3)您的时间序列数据的采样率(即您是否以十秒、秒等为单位进行记录)。下面的代码块是唯一需要编辑的代码部分。</p><pre class="kk kl km kn gt nk nl nm nn aw no bi"><span id="6af4" class="np mn it nl b gy nq nr l ns nt">import pandas as pd<br/>import numpy as np</span><span id="dc4c" class="np mn it nl b gy nu nr l ns nt"><em class="mg"># YOUR DATA FILE &amp; NAME<br/></em>data_file_name = 'data_time_series.csv' <em class="mg"><br/></em>data = pd.read_csv(data_file_name, encoding='utf-8', skiprows=0)<br/><br/><em class="mg"># YOUR EVENT MARKINGS FILE<br/></em>events = pd.read_csv("event_durations.csv", encoding='utf-8', skiprows=1)<br/><br/><em class="mg"># YOUR SAMPLE RATE (ie seconds, deciseconds)<br/></em>sample_rate = 0.1  <em class="mg">#Deci-seconds</em></span></pre><p id="9369" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">从这一点开始，剩下的代码就可以运行了——不需要进一步的编辑。完成后，带标签的文件将出现在您的工作目录中。</p><h1 id="8cc4" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated"><strong class="ak"> 2。将开始-结束时间分成一列秒/十分之一秒</strong></h1><p id="6911" class="pw-post-body-paragraph kv kw it kx b ky ne ju la lb nf jx ld le ng lg lh li nh lk ll lm ni lo lp lq im bi translated">该函数仅从您的<em class="mg">事件标记</em>数据帧中提取持续时间，并将其转换为一列秒/十分之一秒(取决于您在步骤1中输入的采样率)。</p><pre class="kk kl km kn gt nk nl nm nn aw no bi"><span id="e6b0" class="np mn it nl b gy nq nr l ns nt"><strong class="nl iu">def addRange (events):</strong><br/>    global events_split <em class="mg"><br/>    </em>events_split = pd.DataFrame()<br/>    events = np.array(events)<br/>    row = 0<br/>    for _row in events:<br/>        x = round(events[row,0],1) <em class="mg"># Start time<br/>        </em>y = round(events[row,1],1) <em class="mg"># End time<br/>        </em>events_split = events_split.append(pd.DataFrame([x]))<br/>        while x &lt; y:<br/>            x = round((x + sample_rate),1)<br/>            events_split = events_split.append(pd.DataFrame([x]))<br/>        row = row + 1<br/>    return events_split</span><span id="c414" class="np mn it nl b gy nu nr l ns nt">addRange(events)</span></pre><p id="195f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">接下来，我们将使用该函数的输出来创建一列标签。</p><h1 id="c0bd" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated"><strong class="ak"> 3。将该列表转换为一列1和0</strong></h1><p id="4d3c" class="pw-post-body-paragraph kv kw it kx b ky ne ju la lb nf jx ld le ng lg lh li nh lk ll lm ni lo lp lq im bi translated">对于这个函数，我们需要首先创建一个包含您的<em class="mg">时间序列数据</em>的“time”列的iterable变量:</p><pre class="kk kl km kn gt nk nl nm nn aw no bi"><span id="a9c4" class="np mn it nl b gy nq nr l ns nt">data_time_col = pd.DataFrame([data.iloc[:,0]])<br/>data_time_col = data_time_col.T</span></pre><p id="db1d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然后，下面的函数使用这个变量，以及新分解的<em class="mg">事件标记数据</em>，创建一列1和0，与您的<em class="mg">时间序列数据</em>上的行完全匹配。</p><pre class="kk kl km kn gt nk nl nm nn aw no bi"><span id="51ee" class="np mn it nl b gy nq nr l ns nt"><strong class="nl iu">def createLabels(data_time_col):</strong><br/>    global labels_01_df<br/>    labels_01_df = pd.DataFrame() <em class="mg"><br/>    </em>for i in data_time_col.values:<br/>        if i in events_split.values:<br/>            labels_01_df = labels_01_df.append([1], ignore_index=True)<br/>        else:<br/>            labels_01_df = labels_01_df.append([0], ignore_index=True)<br/>    return labels_01_df<br/><br/>createLabels(data_time_col)</span></pre><h1 id="e690" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated"><strong class="ak"> 4。将1和0列写入数据文件</strong>的“标签”列</h1><p id="718d" class="pw-post-body-paragraph kv kw it kx b ky ne ju la lb nf jx ld le ng lg lh li nh lk ll lm ni lo lp lq im bi translated">最后，我们需要将您的0和1列表插入到您的<em class="mg">时间序列</em>数据帧中，并将其导出到csv。(新列将插入到索引[0]中，并推动其他列)。带有标签的新文件将出现在您的目录中，与原始文件同名，但末尾带有“标签”。</p><pre class="kk kl km kn gt nk nl nm nn aw no bi"><span id="286a" class="np mn it nl b gy nq nr l ns nt">data.insert(loc=0, column="labels", value=labels_01_df)<br/>data.to_csv(data_file_name + " - LABELLED.csv", index=False)</span></pre><p id="c74e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">瞧，你的文件已经准备好了，可以用于scikit-learn或你选择的ML库:)</p><p id="3a7c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">完整的脚本可以在我的GitHub页面上找到。</p><p id="2c0c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">希望那有用！如果你有任何问题，请直接在LinkedIn上给我发消息。也可以<strong class="kx iu">邮箱</strong> <strong class="kx iu">订阅我的帖子</strong> <a class="ae lr" href="https://medium.com/subscribe/@LuRoth_" rel="noopener">这里</a>。</p><p id="21f0" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">最后，如果你想进一步支持Medium上的作者，你可以在这里注册成为会员。</p></div></div>    
</body>
</html>