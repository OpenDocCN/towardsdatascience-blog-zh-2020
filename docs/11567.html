<html>
<head>
<title>Outliers detection in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R 中的异常值检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/outliers-detection-in-r-6c835f14e554?source=collection_archive---------17-----------------------#2020-08-11">https://towardsdatascience.com/outliers-detection-in-r-6c835f14e554?source=collection_archive---------17-----------------------#2020-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4d93" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何通过描述性统计、Hampel 过滤器、Grubbs、Dixon 和 Rosner 异常值测试来检测 R 中的异常值</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/36b0e1385524f81a866324e891985e0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1jbaNe4fQJjBM8Yz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">威尔·迈尔斯的照片</p></figure><h1 id="5422" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="be79" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi mn translated"><span class="l mo mp mq bm mr ms mt mu mv di">一个</span> <strong class="lt iu">离群值</strong>是一个值或一个<strong class="lt iu">观察值，它远离其他观察值</strong>，也就是说，一个与其他数据点显著不同的数据点。Enderlein (1987)走得更远，因为作者认为异常值是偏离其他观察值如此之多的值，人们可能会假设不同的基本采样机制。</p><p id="e90e" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">在称之为异常值之前，必须将一个观察值与对同一现象的其他观察值进行比较。事实上，与普通人群相比，身高 200 厘米(美国身高 6 英尺 7 英寸)的人最有可能被视为异常值，但如果我们测量篮球运动员的身高，这个人可能不会被视为异常值。</p><p id="dfd7" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">异常值可能是由于观察到的现象中固有的可变性造成的。例如，在收集工资数据时，经常会出现异常值，因为有些人比其他人赚得更多。离群值也可能是由于实验、测量或编码误差引起的。例如，当对受试者的体重进行编码时，人的体重 786 kg (1733 磅)显然是错误的。她或他的体重很可能是 78.6 公斤(173 磅)或 7.86 公斤(17 磅)，这取决于测量的是成人还是婴儿的体重。</p><p id="43ae" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">因此，有时正式区分两类异常值是有意义的:(一)极端值和(二)错误。极值在统计学和哲学上更有趣，因为它们是可能的，但不太可能的答案。(感谢 Felix Kluxen 的宝贵建议。)</p><p id="25f9" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">在本文中，我介绍了几种检测 R 中异常值的方法，从简单的技术如<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/" rel="noopener ugc nofollow" target="_blank">描述性统计</a>(包括最小值、最大值、直方图、箱线图和百分位数)到更正式的技术如 Hampel 过滤器、Grubbs、Dixon 和 Rosner 异常值测试。</p><p id="9ee5" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">虽然在进行统计分析之前，对于是否应该从数据集中移除异常值没有严格或唯一的规则，但至少移除或估算由于实验或测量误差(如人的体重为 786 kg (1733 磅))引起的异常值是很常见的。一些统计测试要求没有异常值，以便得出合理的结论，但是并不建议在所有情况下都删除异常值，必须谨慎操作。</p><p id="4764" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">本文不会告诉您是否应该删除异常值(也不会告诉您是否应该用中值、平均值、众数或任何其他值对它们进行估算)，但它会帮助您检测它们，以便作为第一步验证它们。在他们被验证之后，你可以选择在你的分析中排除或包括他们(这通常需要研究者方面深思熟虑的思考)。移除或保留异常值主要取决于三个因素:</p><ol class=""><li id="868d" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm ng nh ni nj bi translated">你的分析和研究问题的领域/背景。在某些领域中，移除异常值是很常见的，因为它们通常是由于过程故障而出现的。在其他领域，离群值被保留是因为它们包含有价值的信息。还会发生两次分析，一次有异常值，一次没有异常值，以评估它们对结论的影响。如果结果由于一些有影响的值而发生剧烈变化，这应该提醒研究者做出过于雄心勃勃的声明。</li><li id="d315" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">您将要应用的测试对于异常值的存在是否稳健。例如，一个简单线性回归的斜率可能随一个异常值而显著变化，而非参数检验，如<a class="ae ky" href="https://www.statsandr.com/blog/wilcoxon-test-in-r-how-to-compare-2-groups-under-the-non-normality-assumption/" rel="noopener ugc nofollow" target="_blank"> Wilcoxon 检验</a>通常对异常值稳健。</li><li id="704f" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">异常值离其他观测值有多远？一些被认为是异常值的观测值(根据下面介绍的技术)与所有其他观测值相比实际上并不极端，而其他潜在的异常值可能与其余观测值相距甚远。</li></ol><p id="cc6f" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">来自<code class="fe np nq nr ns b">{ggplot2}</code>包的数据集<code class="fe np nq nr ns b">mpg</code>将用于说明 R 中异常值检测的不同方法，特别是我们将关注变量<code class="fe np nq nr ns b">hwy</code>(每加仑公路英里数)。</p><h1 id="c887" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">描述统计学</h1><h1 id="0993" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">最小值和最大值</h1><p id="3b09" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">检测 R 中异常值的第一步是从一些<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/" rel="noopener ugc nofollow" target="_blank">描述性统计</a>开始，特别是从<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/#minimum-and-maximum" rel="noopener ugc nofollow" target="_blank">最小值和最大值</a>开始。</p><p id="09a6" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">在 R 中，这可以通过<code class="fe np nq nr ns b">summary()</code>函数轻松完成:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="6f63" class="nx la it ns b gy ny nz l oa ob">dat &lt;- ggplot2::mpg<br/>summary(dat$hwy)</span><span id="4b20" class="nx la it ns b gy oc nz l oa ob">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. <br/>##   12.00   18.00   24.00   23.44   27.00   44.00</span></pre><p id="986a" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">其中最小值和最大值分别是上面输出中的第一个和最后一个值。或者，它们也可以用<code class="fe np nq nr ns b">min()</code>和<code class="fe np nq nr ns b">max()</code>函数计算:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="1c28" class="nx la it ns b gy ny nz l oa ob">min(dat$hwy)</span><span id="54b9" class="nx la it ns b gy oc nz l oa ob">## [1] 12</span><span id="7f73" class="nx la it ns b gy oc nz l oa ob">max(dat$hwy)</span><span id="7f8b" class="nx la it ns b gy oc nz l oa ob">## [1] 44</span></pre><p id="c5d6" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">一些明显的编码错误，比如一个人 786 公斤(1733 磅)的体重，已经可以通过这种非常简单的技术很容易地检测出来。</p><h1 id="def3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">柱状图</h1><p id="c575" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">检测异常值的另一个基本方法是绘制数据的<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/#histogram" rel="noopener ugc nofollow" target="_blank">直方图</a>。</p><p id="bd8a" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">使用 R 基(箱的数量对应于观察数量的平方根，以便比默认选项有更多的箱):</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="cd24" class="nx la it ns b gy ny nz l oa ob">hist(dat$hwy,<br/>  xlab = "hwy",<br/>  main = "Histogram of hwy",<br/>  breaks = sqrt(nrow(dat))<br/>) # set number of bins</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/d39e2629a8672bb79448ae48513a3324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*r118lk1SJImo1eXM.png"/></div></div></figure><p id="c941" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">或者使用<code class="fe np nq nr ns b">ggplot2</code>(通过<code class="fe np nq nr ns b"><a class="ae ky" href="https://www.statsandr.com/blog/rstudio-addins-or-how-to-make-your-coding-life-easier/#esquisse" rel="noopener ugc nofollow" target="_blank">esquisse</a></code> <a class="ae ky" href="https://www.statsandr.com/blog/rstudio-addins-or-how-to-make-your-coding-life-easier/#esquisse" rel="noopener ugc nofollow" target="_blank">插件</a>或通过本<a class="ae ky" href="https://www.statsandr.com/blog/graphics-in-r-with-ggplot2/" rel="noopener ugc nofollow" target="_blank">教程</a>学习如何用这个包创建绘图):</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="964a" class="nx la it ns b gy ny nz l oa ob">library(ggplot2)</span><span id="dace" class="nx la it ns b gy oc nz l oa ob">ggplot(dat) +<br/>  aes(x = hwy) +<br/>  geom_histogram(bins = 30L, fill = "#0c4c8a") +<br/>  theme_minimal()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/32f52ab0587fd48ab4e033c24f52fcd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PJ2a20wfQ811lMQj.png"/></div></div></figure><p id="97e6" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">从直方图来看，似乎有几个观察值高于所有其他观察值(见图右侧的条形)。</p><h1 id="2574" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">箱线图</h1><p id="0062" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">除了直方图，<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/#boxplot" rel="noopener ugc nofollow" target="_blank">箱线图</a>也有助于检测潜在的异常值。</p><p id="ab56" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">使用 R 碱基:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="5f81" class="nx la it ns b gy ny nz l oa ob">boxplot(dat$hwy,<br/>  ylab = "hwy"<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/f3a6591ffdd82be3c26257a63dcadcbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KCRBZ7ueYUeVWinN.png"/></div></div></figure><p id="76b7" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">或者使用<code class="fe np nq nr ns b">ggplot2</code>:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="697a" class="nx la it ns b gy ny nz l oa ob">ggplot(dat) +<br/>  aes(x = "", y = hwy) +<br/>  geom_boxplot(fill = "#0c4c8a") +<br/>  theme_minimal()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/61b88ff1637a1117b4d59d840d612893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*g0ElM66P8wJYgYl8.png"/></div></div></figure><p id="3547" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">箱线图通过显示五个常见位置汇总(最小值、中值、第一和第三四分位数以及最大值)以及使用<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/#interquartile-range" rel="noopener ugc nofollow" target="_blank">四分位数间距(IQR) </a>标准分类为可疑异常值的任何观察值，帮助可视化定量变量。IQR 标准意味着所有高于 q0.75 + 1.5 ⋅ IQR 或低于 q0.25-1.5⋅IQR 的观测值(其中 q 0.25 和 q0.75 分别对应于第一和第三四分位数，iqr 是第三和第一四分位数之间的差值)都被 r 视为潜在异常值。换句话说，以下区间之外的所有观测值都将被视为潜在异常值:</p><p id="2aa5" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">I =[q 0.25-1.5⋅iqr；q0.75 + 1.5 ⋅ IQR]</p><p id="e364" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">被 IQR 标准视为潜在异常值的观察值在箱线图中显示为点。基于这一标准，有 2 个潜在的异常值(参见箱线图顶部垂直线上方的 2 个点)。</p><p id="5697" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">请记住，并不是因为某个观察值被 IQR 标准认为是潜在的异常值，您就应该删除它。移除或保留异常值取决于(I)您的分析环境，(ii)您将对数据集执行的测试是否对异常值具有鲁棒性，以及(iii)异常值与其他观测值的距离。</p><p id="d4f2" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">借助<code class="fe np nq nr ns b">boxplot.stats()$out</code>函数，还可以根据 IQR 标准提取潜在异常值:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="0961" class="nx la it ns b gy ny nz l oa ob">boxplot.stats(dat$hwy)$out</span><span id="3fa8" class="nx la it ns b gy oc nz l oa ob">## [1] 44 44 41</span></pre><p id="57cb" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">如您所见，实际上有 3 个点被认为是潜在的异常值:2 个值为 44 的观察值和 1 个值为 41 的观察值。</p><p id="d7a3" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">得益于<code class="fe np nq nr ns b">which()</code>功能，可以提取与这些异常值相对应的行号:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="f4ef" class="nx la it ns b gy ny nz l oa ob">out &lt;- boxplot.stats(dat$hwy)$out<br/>out_ind &lt;- which(dat$hwy %in% c(out))<br/>out_ind</span><span id="0f89" class="nx la it ns b gy oc nz l oa ob">## [1] 213 222 223</span></pre><p id="4c99" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">有了这些信息，您现在可以轻松地返回到数据集中的特定行来验证它们，或者打印这些异常值的所有变量:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="247e" class="nx la it ns b gy ny nz l oa ob">dat[out_ind, ]</span><span id="6e22" class="nx la it ns b gy oc nz l oa ob">## # A tibble: 3 x 11<br/>##   manufacturer model   displ  year   cyl trans   drv     cty   hwy fl    class  <br/>##   &lt;chr&gt;        &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  <br/>## 1 volkswagen   jetta     1.9  1999     4 manual… f        33    44 d     compact<br/>## 2 volkswagen   new be…   1.9  1999     4 manual… f        35    44 d     subcom…<br/>## 3 volkswagen   new be…   1.9  1999     4 auto(l… f        29    41 d     subcom…</span></pre><p id="d731" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">也可以使用<code class="fe np nq nr ns b">mtext()</code>功能将异常值直接打印在箱线图上:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="d3f2" class="nx la it ns b gy ny nz l oa ob">boxplot(dat$hwy,<br/>  ylab = "hwy",<br/>  main = "Boxplot of highway miles per gallon"<br/>)<br/>mtext(paste("Outliers: ", paste(out, collapse = ", ")))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/77a74aad2d319fcf72a0a489a317e783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3lfpLS83rom3OhSd.png"/></div></div></figure><h1 id="dce8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">百分位数</h1><p id="b3ad" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这种异常值检测方法基于<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-by-hand/#a-note-on-deciles-and-percentiles" rel="noopener ugc nofollow" target="_blank">百分位数</a>。使用百分位数方法，位于由 2.5 和 97.5 百分位数形成的区间之外的所有观察值将被视为潜在的异常值。也可以考虑其他百分位数，如 1 和 99，或 5 和 95 百分位数来构建区间。</p><p id="372f" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">可以使用<code class="fe np nq nr ns b">quantile()</code>函数计算下限和上限百分点值(以及区间的下限和上限):</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="97e1" class="nx la it ns b gy ny nz l oa ob">lower_bound &lt;- quantile(dat$hwy, 0.025)<br/>lower_bound</span><span id="c4d1" class="nx la it ns b gy oc nz l oa ob">## 2.5% <br/>##   14</span><span id="1bf1" class="nx la it ns b gy oc nz l oa ob">upper_bound &lt;- quantile(dat$hwy, 0.975)<br/>upper_bound</span><span id="a9c2" class="nx la it ns b gy oc nz l oa ob">##  97.5% <br/>## 35.175</span></pre><p id="d745" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">根据这种方法，所有低于 14 和高于 35.175 的观察值都将被视为潜在的异常值。然后可以用<code class="fe np nq nr ns b">which()</code>函数提取间隔之外的观察值的行号:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="04bd" class="nx la it ns b gy ny nz l oa ob">outlier_ind &lt;- which(dat$hwy &lt; lower_bound | dat$hwy &gt; upper_bound)<br/>outlier_ind</span><span id="a295" class="nx la it ns b gy oc nz l oa ob">##  [1]  55  60  66  70 106 107 127 197 213 222 223</span></pre><p id="1e76" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">然后可以打印出他们每加仑的公路里程值:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="36d2" class="nx la it ns b gy ny nz l oa ob">dat[outlier_ind, "hwy"]</span><span id="3ce0" class="nx la it ns b gy oc nz l oa ob">## # A tibble: 11 x 1<br/>##      hwy<br/>##    &lt;int&gt;<br/>##  1    12<br/>##  2    12<br/>##  3    12<br/>##  4    12<br/>##  5    36<br/>##  6    36<br/>##  7    12<br/>##  8    37<br/>##  9    44<br/>## 10    44<br/>## 11    41</span></pre><p id="efd9" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">或者，可以打印这些异常值的所有变量:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="39ae" class="nx la it ns b gy ny nz l oa ob">dat[outlier_ind, ]</span><span id="1f86" class="nx la it ns b gy oc nz l oa ob">## # A tibble: 11 x 11<br/>##    manufacturer model    displ  year   cyl trans  drv     cty   hwy fl    class <br/>##    &lt;chr&gt;        &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; <br/>##  1 dodge        dakota …   4.7  2008     8 auto(… 4         9    12 e     pickup<br/>##  2 dodge        durango…   4.7  2008     8 auto(… 4         9    12 e     suv   <br/>##  3 dodge        ram 150…   4.7  2008     8 auto(… 4         9    12 e     pickup<br/>##  4 dodge        ram 150…   4.7  2008     8 manua… 4         9    12 e     pickup<br/>##  5 honda        civic      1.8  2008     4 auto(… f        25    36 r     subco…<br/>##  6 honda        civic      1.8  2008     4 auto(… f        24    36 c     subco…<br/>##  7 jeep         grand c…   4.7  2008     8 auto(… 4         9    12 e     suv   <br/>##  8 toyota       corolla    1.8  2008     4 manua… f        28    37 r     compa…<br/>##  9 volkswagen   jetta      1.9  1999     4 manua… f        33    44 d     compa…<br/>## 10 volkswagen   new bee…   1.9  1999     4 manua… f        35    44 d     subco…<br/>## 11 volkswagen   new bee…   1.9  1999     4 auto(… f        29    41 d     subco…</span></pre><p id="9aaa" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">根据百分位数法，有 11 个潜在的异常值。要减少这个数字，您可以将百分比设置为 1 和 99:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="cdd1" class="nx la it ns b gy ny nz l oa ob">lower_bound &lt;- quantile(dat$hwy, 0.01)<br/>upper_bound &lt;- quantile(dat$hwy, 0.99)</span><span id="628d" class="nx la it ns b gy oc nz l oa ob">outlier_ind &lt;- which(dat$hwy &lt; lower_bound | dat$hwy &gt; upper_bound)</span><span id="abcf" class="nx la it ns b gy oc nz l oa ob">dat[outlier_ind, ]</span><span id="c6a1" class="nx la it ns b gy oc nz l oa ob">## # A tibble: 3 x 11<br/>##   manufacturer model   displ  year   cyl trans   drv     cty   hwy fl    class  <br/>##   &lt;chr&gt;        &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  <br/>## 1 volkswagen   jetta     1.9  1999     4 manual… f        33    44 d     compact<br/>## 2 volkswagen   new be…   1.9  1999     4 manual… f        35    44 d     subcom…<br/>## 3 volkswagen   new be…   1.9  1999     4 auto(l… f        29    41 d     subcom…</span></pre><p id="2714" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">将百分位数设置为 1 和 99 会产生与 IQR 标准相同的潜在异常值。</p><h1 id="1038" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">汉佩尔过滤器</h1><p id="00d0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">另一种方法称为 Hampel 滤波器，包括将由中值加上或减去 3 个中值绝对偏差(MAD)形成的区间(I)之外的值视为异常值</p><p id="153a" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">I =[中值 3 ⋅疯了；中位数+ 3 ⋅疯狂]</p><p id="47e4" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">其中 MAD 是绝对偏差的中值，定义为绝对偏差相对于数据中值的中值~X=median(X):</p><p id="e1c5" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">MAD =中位数(| Xi ~ X |)</p><p id="c2dc" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">对于该方法，我们首先通过<code class="fe np nq nr ns b">median()</code>和<code class="fe np nq nr ns b">mad()</code>功能设置区间限制:<a class="ae ky" href="https://statsandr.com/blog/outliers-detection-in-r/#fn2" rel="noopener ugc nofollow" target="_blank"> 2 </a></p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="f80b" class="nx la it ns b gy ny nz l oa ob">lower_bound &lt;- median(dat$hwy) - 3 * mad(dat$hwy, constant = 1)<br/>lower_bound</span><span id="71f8" class="nx la it ns b gy oc nz l oa ob">## [1] 9</span><span id="fc69" class="nx la it ns b gy oc nz l oa ob">upper_bound &lt;- median(dat$hwy) + 3 * mad(dat$hwy, constant = 1)<br/>upper_bound</span><span id="5c58" class="nx la it ns b gy oc nz l oa ob">## [1] 39</span></pre><p id="e725" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">根据这种方法，所有低于 9 和高于 39 的观察值都将被视为潜在的异常值。然后可以用<code class="fe np nq nr ns b">which()</code>函数提取间隔之外的观察值的行号:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="f10f" class="nx la it ns b gy ny nz l oa ob">outlier_ind &lt;- which(dat$hwy &lt; lower_bound | dat$hwy &gt; upper_bound)<br/>outlier_ind</span><span id="e328" class="nx la it ns b gy oc nz l oa ob">## [1] 213 222 223</span></pre><p id="d7c4" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">根据 Hampel 过滤器，<code class="fe np nq nr ns b">hwy</code>变量有 3 个异常值。</p><h1 id="049f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">统计测试</h1><p id="6862" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本节中，我们将介绍 3 种更正式的技术来检测异常值:</p><ol class=""><li id="4ee5" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm ng nh ni nj bi translated">格拉布斯试验</li><li id="c69c" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">狄克逊试验</li><li id="ba12" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">罗斯纳试验</li></ol><p id="c68e" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">这 3 个统计测试是异常值检测的更正式技术的一部分，因为它们都涉及与表列临界值(基于样本大小和期望的置信水平)相比较的测试统计的计算。</p><p id="c190" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">请注意，只有当数据(没有任何异常值)为<strong class="lt iu">近似正态分布</strong>时，3 个测试才是合适的。因此，在对异常值进行这些测试之前，必须验证正态假设(参见如何在 R 中<a class="ae ky" href="https://www.statsandr.com/blog/do-my-data-follow-a-normal-distribution-a-note-on-the-most-widely-used-distribution-and-how-to-test-for-normality-in-r/" rel="noopener ugc nofollow" target="_blank">测试正态假设)。</a></p><h1 id="d7f4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">格拉布斯试验</h1><p id="50e5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Grubbs 检验允许检测数据集中的最高值或最低值是否为异常值。</p><p id="ce42" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">格拉布斯检验一次检测一个异常值(最高值或最低值)，因此无效假设和替代假设如下:</p><ul class=""><li id="ea99" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm oe nh ni nj bi translated">H0:<em class="of">最高</em>值是<strong class="lt iu">而不是</strong>异常值</li><li id="e207" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm oe nh ni nj bi translated">H1:最高的<em class="of">值是一个异常值</em></li></ul><p id="60ef" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">如果我们想测试最高值，或者:</p><ul class=""><li id="356d" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm oe nh ni nj bi translated">H0:最低的<em class="of">值</em>是<strong class="lt iu">而不是</strong>异常值</li><li id="429c" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm oe nh ni nj bi translated">H1:最低的<em class="of">值是一个异常值</em></li></ul><p id="a3c9" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">如果我们想测试最低值。</p><p id="9b9d" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">对于任何统计检验，如果<a class="ae ky" href="https://www.statsandr.com/blog/student-s-t-test-in-r-and-by-hand-how-to-compare-two-groups-under-different-scenarios/#a-note-on-p-value-and-significance-level-alpha" rel="noopener ugc nofollow" target="_blank"><strong class="lt iu"><em class="of">p</em>-值</strong> </a> <strong class="lt iu">小于所选的<strong class="lt iu">显著性阈值</strong>(通常α = 0.05)，则零假设被拒绝，我们将得出结论<strong class="lt iu">最低/最高值是异常值</strong>。相反，如果<strong class="lt iu"><em class="of">-p</em>-值大于或等于</strong>显著性水平，则不拒绝零假设，并且我们将得出结论，基于数据，我们不拒绝<strong class="lt iu">最低/最高值不是异常值</strong>的假设。</strong></p><p id="85d1" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">请注意，格拉布斯检验不适用于样本量为 6 或更少(n≤6)的情况。</p><p id="f5df" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">为了在 R 中执行 Grubbs 测试，我们使用了<code class="fe np nq nr ns b">{outliers}</code>包中的<code class="fe np nq nr ns b">grubbs.test()</code>函数:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="30c8" class="nx la it ns b gy ny nz l oa ob"># install.packages("outliers")<br/>library(outliers)<br/>test &lt;- grubbs.test(dat$hwy)<br/>test</span><span id="f037" class="nx la it ns b gy oc nz l oa ob">## <br/>##  Grubbs test for one outlier<br/>## <br/>## data:  dat$hwy<br/>## G = 3.45274, U = 0.94862, p-value = 0.05555<br/>## alternative hypothesis: highest value 44 is an outlier</span></pre><p id="def9" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated"><em class="of">p</em>-值为 0.056。在 5%的显著性水平，我们不拒绝假设最高<em class="of">值 44 是<strong class="lt iu">而不是</strong>异常值。</em></p><p id="ed57" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">默认情况下，测试在最高值上执行(如 R 输出所示:<code class="fe np nq nr ns b">alternative hypothesis: highest value 44 is an outlier</code>)。如果您想测试最小值，只需在<code class="fe np nq nr ns b">grubbs.test()</code>函数中添加参数<code class="fe np nq nr ns b">opposite = TRUE</code>:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="58ef" class="nx la it ns b gy ny nz l oa ob">test &lt;- grubbs.test(dat$hwy, opposite = TRUE)<br/>test</span><span id="692c" class="nx la it ns b gy oc nz l oa ob">## <br/>##  Grubbs test for one outlier<br/>## <br/>## data:  dat$hwy<br/>## G = 1.92122, U = 0.98409, p-value = 1<br/>## alternative hypothesis: lowest value 12 is an outlier</span></pre><p id="4356" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">R 输出表示测试正在最低值上进行(参见<code class="fe np nq nr ns b">alternative hypothesis: lowest value 12 is an outlier</code>)。</p><p id="20cd" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated"><em class="of">p</em>-值为 1。在 5%的显著性水平上，我们不拒绝假设最低的<em class="of">值 12 是<strong class="lt iu">而不是</strong>异常值。</em></p><p id="961f" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">为了便于说明，我们现在将用一个更极端的值替换一个观察值，并对这个新数据集执行 Grubbs 测试。让我们用值 212 替换第 34 行:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="e8b6" class="nx la it ns b gy ny nz l oa ob">dat[34, "hwy"] &lt;- 212</span></pre><p id="c5f2" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">我们现在应用格拉布斯检验来检验最高值是否是异常值:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="9538" class="nx la it ns b gy ny nz l oa ob">test &lt;- grubbs.test(dat$hwy)<br/>test</span><span id="a083" class="nx la it ns b gy oc nz l oa ob">## <br/>##  Grubbs test for one outlier<br/>## <br/>## data:  dat$hwy<br/>## G = 13.72240, U = 0.18836, p-value &lt; 2.2e-16<br/>## alternative hypothesis: highest value 212 is an outlier</span></pre><p id="6805" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated"><em class="of">p</em>-值为&lt; 0.001。在 5%的显著性水平，我们断定最高<em class="of">值 212 是异常值。</em></p><h1 id="7e3a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">狄克逊试验</h1><p id="9d39" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">与 Grubbs 检验类似，Dixon 检验用于检验单个低值或高值是否为异常值。因此，如果怀疑有一个以上的异常值，必须对这些可疑异常值分别进行测试。</p><p id="3f1d" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">注意，Dixon 检验对小样本(通常 n ≤ 25)最有用。</p><p id="5768" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">为了在 R 中执行 Dixon 测试，我们使用了<code class="fe np nq nr ns b">{outliers}</code>包中的<code class="fe np nq nr ns b">dixon.test()</code>函数。然而，我们<a class="ae ky" href="https://statsandr.com/blog/data-manipulation-in-r/#subset-a-data-frame" rel="noopener ugc nofollow" target="_blank">将我们的数据集</a>限制为 20 个第一次观察值，因为 Dixon 测试只能在小样本量上进行(R 将抛出一个错误，只接受 3 到 30 个观察值的数据集):</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="6d21" class="nx la it ns b gy ny nz l oa ob">subdat &lt;- dat[1:20, ]<br/>test &lt;- dixon.test(subdat$hwy)<br/>test</span><span id="fe98" class="nx la it ns b gy oc nz l oa ob">## <br/>##  Dixon test for outliers<br/>## <br/>## data:  subdat$hwy<br/>## Q = 0.57143, p-value = 0.006508<br/>## alternative hypothesis: lowest value 15 is an outlier</span></pre><p id="147b" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">结果显示最低值 15 是一个异常值(<em class="of"> p </em> -value = 0.007)。</p><p id="1069" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">要测试最大值，只需将<code class="fe np nq nr ns b">opposite = TRUE</code>参数添加到<code class="fe np nq nr ns b">dixon.test()</code>函数中:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="d574" class="nx la it ns b gy ny nz l oa ob">test &lt;- dixon.test(subdat$hwy,<br/>  opposite = TRUE<br/>)<br/>test</span><span id="af14" class="nx la it ns b gy oc nz l oa ob">## <br/>##  Dixon test for outliers<br/>## <br/>## data:  subdat$hwy<br/>## Q = 0.25, p-value = 0.8582<br/>## alternative hypothesis: highest value 31 is an outlier</span></pre><p id="3de0" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">结果显示最高值 31 是<strong class="lt iu">而不是</strong>一个异常值(<em class="of"> p </em> -value = 0.858)。</p><p id="1284" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">一个好的做法是始终对照箱线图检查异常值的统计测试结果，以确保我们测试了所有的<strong class="lt iu">潜在异常值:</strong></p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="0595" class="nx la it ns b gy ny nz l oa ob">out &lt;- boxplot.stats(subdat$hwy)$out<br/>boxplot(subdat$hwy,<br/>  ylab = "hwy"<br/>)<br/>mtext(paste("Outliers: ", paste(out, collapse = ", ")))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/eea73b2b3368a6748036654386fda210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Z75stoZWY_Y-WPTH.png"/></div></div></figure><p id="e632" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">从箱线图中，我们可以看到，除了之前对值 15 进行的测试之外，我们还可以对值 20 进行 Dixon 测试。这可以通过找到最小值的行号来完成，从数据集中排除该行号，然后最后对这个新数据集应用 Dixon 测试:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="461e" class="nx la it ns b gy ny nz l oa ob"># find and exclude lowest value<br/>remove_ind &lt;- which.min(subdat$hwy)<br/>subsubdat &lt;- subdat[-remove_ind, ]</span><span id="6ab4" class="nx la it ns b gy oc nz l oa ob"># Dixon test on dataset without the minimum<br/>test &lt;- dixon.test(subsubdat$hwy)<br/>test</span><span id="0a6f" class="nx la it ns b gy oc nz l oa ob">## <br/>##  Dixon test for outliers<br/>## <br/>## data:  subsubdat$hwy<br/>## Q = 0.44444, p-value = 0.1297<br/>## alternative hypothesis: lowest value 20 is an outlier</span></pre><p id="9eae" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">结果显示第二个最低值 20 是<strong class="lt iu">而不是</strong>异常值(<em class="of">p</em>-值= 0.13)。</p><h1 id="864f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">罗斯纳试验</h1><p id="82cc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">罗斯纳的异常值检验具有以下优点:</p><ol class=""><li id="0829" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm ng nh ni nj bi translated">它用于<strong class="lt iu">一次检测几个异常值</strong>(与 Grubbs 和 Dixon 测试不同，后者必须反复执行以筛选多个异常值)，以及</li><li id="2019" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">它旨在避免屏蔽问题，即一个离群值与另一个离群值接近的离群值可能无法被检测到。</li></ol><p id="19f0" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">与 Dixon 检验不同，注意 Rosner 检验在样本量较大(n ≥ 20)时最为合适。因此，我们再次使用初始数据集<code class="fe np nq nr ns b">dat</code>，它包括 234 个观察值。</p><p id="fabc" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">为了执行罗斯纳测试，我们使用了<code class="fe np nq nr ns b">{EnvStats}</code>包中的<code class="fe np nq nr ns b">rosnerTest()</code>函数。这个函数至少需要两个参数:数据和可疑异常值的数量<code class="fe np nq nr ns b">k</code>(默认的可疑异常值数量为<code class="fe np nq nr ns b">k = 3</code>)。</p><p id="4a8c" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">对于本例，我们将可疑异常值的数量设置为 3，正如本文开头的方框图中列出的潜在异常值的数量所示。<a class="ae ky" href="https://www.statsandr.com/blog/outliers-detection-in-r/#fn2" rel="noopener ugc nofollow" target="_blank"> 2 </a></p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="4205" class="nx la it ns b gy ny nz l oa ob">library(EnvStats)<br/>test &lt;- rosnerTest(dat$hwy,<br/>  k = 3<br/>)<br/>test</span><span id="a876" class="nx la it ns b gy oc nz l oa ob">## $distribution<br/>## [1] "Normal"<br/>## <br/>## $statistic<br/>##       R.1       R.2       R.3 <br/>## 13.722399  3.459098  3.559936 <br/>## <br/>## $sample.size<br/>## [1] 234<br/>## <br/>## $parameters<br/>## k <br/>## 3 <br/>## <br/>## $alpha<br/>## [1] 0.05<br/>## <br/>## $crit.value<br/>## lambda.1 lambda.2 lambda.3 <br/>## 3.652091 3.650836 3.649575 <br/>## <br/>## $n.outliers<br/>## [1] 1<br/>## <br/>## $alternative<br/>## [1] "Up to 3 observations are not\n                                 from the same Distribution."<br/>## <br/>## $method<br/>## [1] "Rosner's Test for Outliers"<br/>## <br/>## $data<br/>##   [1]  29  29  31  30  26  26  27  26  25  28  27  25  25  25  25  24  25  23<br/>##  [19]  20  15  20  17  17  26  23  26  25  24  19  14  15  17  27 212  26  29<br/>##  [37]  26  24  24  22  22  24  24  17  22  21  23  23  19  18  17  17  19  19<br/>##  [55]  12  17  15  17  17  12  17  16  18  15  16  12  17  17  16  12  15  16<br/>##  [73]  17  15  17  17  18  17  19  17  19  19  17  17  17  16  16  17  15  17<br/>##  [91]  26  25  26  24  21  22  23  22  20  33  32  32  29  32  34  36  36  29<br/>## [109]  26  27  30  31  26  26  28  26  29  28  27  24  24  24  22  19  20  17<br/>## [127]  12  19  18  14  15  18  18  15  17  16  18  17  19  19  17  29  27  31<br/>## [145]  32  27  26  26  25  25  17  17  20  18  26  26  27  28  25  25  24  27<br/>## [163]  25  26  23  26  26  26  26  25  27  25  27  20  20  19  17  20  17  29<br/>## [181]  27  31  31  26  26  28  27  29  31  31  26  26  27  30  33  35  37  35<br/>## [199]  15  18  20  20  22  17  19  18  20  29  26  29  29  24  44  29  26  29<br/>## [217]  29  29  29  23  24  44  41  29  26  28  29  29  29  28  29  26  26  26<br/>## <br/>## $data.name<br/>## [1] "dat$hwy"<br/>## <br/>## $bad.obs<br/>## [1] 0<br/>## <br/>## $all.stats<br/>##   i   Mean.i      SD.i Value Obs.Num     R.i+1 lambda.i+1 Outlier<br/>## 1 0 24.21795 13.684345   212      34 13.722399   3.652091    TRUE<br/>## 2 1 23.41202  5.951835    44     213  3.459098   3.650836   FALSE<br/>## 3 2 23.32328  5.808172    44     222  3.559936   3.649575   FALSE<br/>## <br/>## attr(,"class")<br/>## [1] "gofOutlier"</span></pre><p id="9e15" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">有趣的结果在<code class="fe np nq nr ns b">$all.stats</code>表中提供:</p><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="2787" class="nx la it ns b gy ny nz l oa ob">test$all.stats</span><span id="58da" class="nx la it ns b gy oc nz l oa ob">##   i   Mean.i      SD.i Value Obs.Num     R.i+1 lambda.i+1 Outlier<br/>## 1 0 24.21795 13.684345   212      34 13.722399   3.652091    TRUE<br/>## 2 1 23.41202  5.951835    44     213  3.459098   3.650836   FALSE<br/>## 3 2 23.32328  5.808172    44     222  3.559936   3.649575   FALSE</span></pre><p id="fc70" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">基于罗斯纳测试，我们看到只有一个异常值(见<code class="fe np nq nr ns b">Outlier</code>列)，它是值为 212(见<code class="fe np nq nr ns b">Value</code>的观测值 34(见<code class="fe np nq nr ns b">Obs.Num</code>)。</p><h1 id="1c3e" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">附加备注</h1><p id="3284" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您会发现许多其他检测异常值的方法:</p><ol class=""><li id="5003" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm ng nh ni nj bi translated">在<code class="fe np nq nr ns b">{outliers}</code>包中，</li><li id="0cfa" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">通过<code class="fe np nq nr ns b">{DMwR}</code>包中的<code class="fe np nq nr ns b">lofactor()</code>函数:局部异常值因子(LOF)是一种算法，用于通过比较一个点与其邻居的局部密度来识别异常值。</li><li id="ae2c" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated"><code class="fe np nq nr ns b">{car}</code>包中的<code class="fe np nq nr ns b">outlierTest()</code>给出了基于给定模型的最极端观察值，并允许测试其是否为异常值，以及</li><li id="ff24" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">在<code class="fe np nq nr ns b">{OutlierDetection}</code>包装中，以及</li><li id="1412" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">使用<code class="fe np nq nr ns b">{mvoutlier}</code>包中的<code class="fe np nq nr ns b">aq.plot()</code>功能(感谢 KTR 的建议。):</li></ol><pre class="kj kk kl km gt nt ns nu nv aw nw bi"><span id="a88b" class="nx la it ns b gy ny nz l oa ob">library(mvoutlier)</span><span id="03f6" class="nx la it ns b gy oc nz l oa ob">Y &lt;- as.matrix(ggplot2::mpg[, c("cyl", "hwy")])<br/>res &lt;- aq.plot(Y)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/0a3a636c9bf5d5b63d140237d114a6d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vQyZeH-dE30W2QjI.png"/></div></div></figure><p id="a48c" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">还要注意，一些转换可能会“自然地”消除异常值。值的自然对数或平方根减少了由极值引起的变化，因此在某些情况下，应用这些变换将消除异常值。</p><p id="ed26" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">感谢阅读。我希望这篇文章能帮助你通过几个<a class="ae ky" href="https://www.statsandr.com/blog/descriptive-statistics-in-r/" rel="noopener ugc nofollow" target="_blank">描述性统计</a>(包括最小值、最大值、直方图、箱线图和百分位数)或者借助于更正式的离群点检测技术(包括 Hampel 过滤器、Grubbs、Dixon 和 Rosner 检验)来检测 R 中的离群点。现在轮到您验证它们了，如果它们是正确的，在进行分析之前，决定如何处理它们(即保留、删除或删除它们)。</p><p id="a781" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated">和往常一样，如果您有与本文主题相关的问题或建议，请将其添加为评论，以便其他读者可以从讨论中受益。</p><h1 id="3aaa" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">参考</h1><p id="fa14" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">恩德莱因，G. 1987。霍金斯，Dm:离群值的识别。查普曼和霍尔，伦敦-纽约 1980 年，188 年代，14，50 年<em class="of">生物统计学杂志</em>29(2):198–98。</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><ol class=""><li id="1594" class="nb nc it lt b lu mw lx mx ma nd me ne mi nf mm ng nh ni nj bi translated">默认值为 3(根据皮尔逊法则)，但也可能是另一个值。<a class="ae ky" href="https://www.statsandr.com/blog/outliers-detection-in-r/#fnref1" rel="noopener ugc nofollow" target="_blank"> ↩︎ </a></li><li id="4fca" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">默认情况下，<code class="fe np nq nr ns b">mad()</code>函数中的常数是 1.4826，因此必须将其设置为 1，以找到中位数绝对偏差。更多详情见<code class="fe np nq nr ns b">help(mad)</code>。感谢艾丽塞给我指出了这一点。<a class="ae ky" href="https://statsandr.com/blog/outliers-detection-in-r/#fnref2" rel="noopener ugc nofollow" target="_blank"> ↩︎ </a></li><li id="81c9" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">为了避免得出有缺陷的结论，在进行罗斯纳测试之前，预先筛选数据(例如用箱线图)以尽可能准确地选择潜在异常值的数量是很重要的。<a class="ae ky" href="https://www.statsandr.com/blog/outliers-detection-in-r/#fnref2" rel="noopener ugc nofollow" target="_blank"> ↩︎ </a></li></ol><h1 id="4708" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">相关文章</h1><ul class=""><li id="62a2" class="nb nc it lt b lu lv lx ly ma on me oo mi op mm oe nh ni nj bi translated"><a class="ae ky" href="https://www.statsandr.com/blog/wilcoxon-test-in-r-how-to-compare-2-groups-under-the-non-normality-assumption/" rel="noopener ugc nofollow" target="_blank">R 中的 Wilcoxon 检验:如何在非正态假设下比较两组</a></li><li id="7d2d" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm oe nh ni nj bi translated"><a class="ae ky" href="https://www.statsandr.com/blog/correlation-coefficient-and-correlation-test-in-r/" rel="noopener ugc nofollow" target="_blank">R 中的相关系数和相关检验</a></li><li id="1eb0" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm oe nh ni nj bi translated"><a class="ae ky" href="https://www.statsandr.com/blog/one-proportion-and-goodness-of-fit-test-in-r-and-by-hand/" rel="noopener ugc nofollow" target="_blank">单比例和拟合优度测试(R 和手动)</a></li><li id="1bee" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm oe nh ni nj bi translated"><a class="ae ky" href="https://www.statsandr.com/blog/how-to-do-a-t-test-or-anova-for-many-variables-at-once-in-r-and-communicate-the-results-in-a-better-way/" rel="noopener ugc nofollow" target="_blank">如何在 R 中一次对多个变量进行 t 检验或方差分析，并以更好的方式交流结果</a></li><li id="4cdf" class="nb nc it lt b lu nk lx nl ma nm me nn mi no mm oe nh ni nj bi translated"><a class="ae ky" href="https://www.statsandr.com/blog/how-to-perform-a-one-sample-t-test-by-hand-and-in-r-test-on-one-mean/" rel="noopener ugc nofollow" target="_blank">如何手工进行单样本 t 检验，并对一个均值进行 R:检验</a></li></ul></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="bbb9" class="pw-post-body-paragraph lr ls it lt b lu mw ju lw lx mx jx lz ma my mc md me mz mg mh mi na mk ml mm im bi translated"><em class="of">原载于 2020 年 8 月 11 日 https://statsandr.com</em><a class="ae ky" href="https://statsandr.com/blog/outliers-detection-in-r/" rel="noopener ugc nofollow" target="_blank"><em class="of"/></a><em class="of">。</em></p></div></div>    
</body>
</html>