<html>
<head>
<title>What you always wanted to know about outlier’s detection but never dared to ask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于异常值检测，你一直想知道但又不敢问的是什么</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-you-always-wanted-to-know-about-outliers-detection-but-never-dared-to-ask-f040d9ca64d9?source=collection_archive---------53-----------------------#2020-09-11">https://towardsdatascience.com/what-you-always-wanted-to-know-about-outliers-detection-but-never-dared-to-ask-f040d9ca64d9?source=collection_archive---------53-----------------------#2020-09-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="141c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">保证结果的 pythonic 离群点检测独家指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8938730c2fa164b458e8e5e7ca4acd47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JlF7PyHGyMDA-OaqBB74UQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">山下孝文在<a class="ae ky" href="https://unsplash.com/s/photos/confectionery-rainbow-neon?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f5fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">离群点检测是探索性数据分析中的一个自然的初步步骤，目的是在大多数数据科学项目中获得最具影响力的结果。该过程包括消除异常超限值，以获得最佳预测。易于使用的离群点检测方法一般包括:最小最大分析、Z 得分极值分析、四分位数间距、扩展隔离森林、局部离群点方法。要成为独角兽数据科学家，掌握最有效的异常值检测方法是一项必备技能。在本文中，我们将回顾 Kaggle winners 的异常值检测方法，这些方法可以用简短的 python 代码实现。</p><p id="3193" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将分析我们的甜巧克力棒评分数据集，您可以在这里找到<a class="ae ky" href="https://www.kaggle.com/soroushghaderi/chocolate-bar-2020" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/650db9eb66cafc7351d43285ff8e6c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7D_n9RZhWmLe_r8jHMDTaw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@massimo_adami?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Massimo Adami </a>在<a class="ae ky" href="https://unsplash.com/s/photos/chocolate-box?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0c7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个具有挑战性的数据集，在分类编码后包含超过 2800 个特征。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><ol class=""><li id="db4a" class="md me it lb b lc ld lf lg li mf lm mg lq mh lu mi mj mk ml bi translated"><strong class="lb iu">最小-最大值分析</strong></li></ol><p id="533d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">面临的挑战是找到最有效地提取异常值的最佳方法，最终创建一个适合数据点的模型，减少模型预测的总体误差。这是一个对巧克力评分数据集(一个复杂的多维数据集)进行最小-最大分析的示例。</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="71bc" class="mr ms it mn b gy mt mu l mv mw">import pandas as pd</span><span id="571a" class="mr ms it mn b gy mx mu l mv mw">import matplotlib.pyplot as plt</span><span id="2855" class="mr ms it mn b gy mx mu l mv mw">import seaborn as sns</span><span id="b032" class="mr ms it mn b gy mx mu l mv mw">from scipy .stats import norm<br/></span><span id="e46b" class="mr ms it mn b gy mx mu l mv mw">df = pd.read_csv('../input/preprocess-choc/dfn.csv')</span><span id="50f3" class="mr ms it mn b gy mx mu l mv mw">#so my upper limit will be my mean value plus 3 sigma</span><span id="f186" class="mr ms it mn b gy mx mu l mv mw">upper_limit=df.rating.mean()+3*df.rating.std()</span><span id="fe9b" class="mr ms it mn b gy mx mu l mv mw">#my lowar limit will be my mean - 3 sigma</span><span id="6a8d" class="mr ms it mn b gy mx mu l mv mw">lowar_limit=df.rating.mean()-3*df.rating.std()</span></pre><p id="11bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们检查我们的异常值:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="0fcd" class="mr ms it mn b gy mt mu l mv mw">df[(df.rating&gt;upper_limit)|(df.rating&lt;lowar_limit)]</span><span id="08c9" class="mr ms it mn b gy mx mu l mv mw">#now we will visualise the data without outliers</span><span id="e44a" class="mr ms it mn b gy mx mu l mv mw">new_data=df[(df.rating&lt;upper_limit)&amp; (df.rating&gt;lowar_limit)]</span><span id="519c" class="mr ms it mn b gy mx mu l mv mw">#shape of our outlier’s</span><span id="83b1" class="mr ms it mn b gy mx mu l mv mw">df.shape[0]-new_data.shape[0]</span></pre><p id="fbd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">输出</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/5cb31025dfa1cad382801fa1ee4aa23a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GSxGkvZMa7xYFHYJ8VQ6uA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用最小-最大方法检测异常值<strong class="bd mz">(作者提供</strong>图片)</p></figure><p id="706c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该方法实现了 6 个异常值的检测。让我们画出来:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/57acbdf81bfb4ea5574561a7a0d55d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CyNYx4xDQpwiT8bNdswJaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据异常值处理前后的数据分布<strong class="bd mz"> ( </strong>图片由作者提供)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/a2d06e92323a8ef348a50dc2b4ee5eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fl_HXtP3oUy8G4iZaYFh2w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/s/photos/confectionery-charly-neon?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@shakalmag?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Maciej Gerszewski </a>拍摄的照片</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="39ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.<strong class="lb iu">使用 Z 分数的极值分析</strong></p><p id="1ef9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Z 得分表示一个数据点距离标准偏差有多少，在我们的例子中，平均值为 3.198，标准偏差为 0.434，因此数据点 4.5 的 Z 得分为:</p><p id="51eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">4.5–3.198(平均值)/0.434(标准值)= 1.847 </strong></p><p id="f862" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将计算数据点的 z 分数，并显示它们:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="8054" class="mr ms it mn b gy mt mu l mv mw">df['zscore']=(df.rating-df.rating.mean())/df.rating.std()</span><span id="9fce" class="mr ms it mn b gy mx mu l mv mw">df</span><span id="013a" class="mr ms it mn b gy mx mu l mv mw">#displaying the outlier’s with respect to the zscores</span><span id="2e38" class="mr ms it mn b gy mx mu l mv mw">df[(df.zscore&lt;-3)|(df.zscore&gt;3)]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/53c5278e2bd1a618527d13290fc3bbb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mQDPomUJvUj_9vVlzWWunA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd mz"> ( </strong>图片作者)</p></figure><p id="f824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该方法实现了 7 个异常值的检测。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/dc17c2c6cee054676e7ac89034cb6f84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kT-HiY1ghzlg8bMm5dFpXg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@yulcha_ro?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">尤利娅·希诺娃</a>在<a class="ae ky" href="https://unsplash.com/s/photos/japanese-sweet?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="086c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.<strong class="lb iu">四分位数间距(IQR) </strong></p><p id="abaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">四分位数间距</strong> IQR(或 50%中点)是一种衡量上四分位数(Q1:第 25 位)和下四分位数(Q3:第 75 位)之间差异的方法 IQR =<em class="ne">Q</em>3<em class="ne">Q</em>1。使用超出范围的数据点(最小-最大)可以定义边界，并且可以确定异常值。</p><p id="2350" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来编码一下:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="fb63" class="mr ms it mn b gy mt mu l mv mw">Q1=df.rating.quantile(0.25)</span><span id="071c" class="mr ms it mn b gy mx mu l mv mw">Q3=df.rating.quantile(0.75)</span><span id="9ce3" class="mr ms it mn b gy mx mu l mv mw">Q1,Q3</span></pre><p id="fb61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">输出</strong></p><p id="f059" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">3.0 , 3.5</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="ff6d" class="mr ms it mn b gy mt mu l mv mw">#Now we will calculate the IQR :</span><span id="e60b" class="mr ms it mn b gy mx mu l mv mw">IQR=Q3-Q1</span><span id="e9f5" class="mr ms it mn b gy mx mu l mv mw">IQR</span></pre><p id="bc7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">输出</strong></p><p id="27c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">0.5</p><p id="959c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Q1 对应于巧克力等级分布的 25%低于 3.0，而 Q3 对应于巧克力等级分布的 75%低于 3.5。</p><p id="302e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将定义巧克力评分分布的上限和下限:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="4ad5" class="mr ms it mn b gy mt mu l mv mw">LOWAR_LIMIT=Q1-1.5*IQR</span><span id="f2b3" class="mr ms it mn b gy mx mu l mv mw">UPPER_LIMIT=Q3+1.5*IQR</span><span id="0946" class="mr ms it mn b gy mx mu l mv mw">LOWAR_LIMIT,UPPER_LIMIT</span></pre><p id="7b4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">输出</strong></p><p id="d9fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">2.25, 4.25</p><p id="b483" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将在数据框中显示异常值评级:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="fbe4" class="mr ms it mn b gy mt mu l mv mw">df[(df.rating&lt;LOWAR_LIMIT)|(df.rating&gt;UPPER_LIMIT)]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/c3c81f3e9a9fe5ad5f4921d844b309cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TVb3_VvnxtTpzSlKDagpXQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd mz"> ( </strong>图片作者)</p></figure><p id="2b6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该算法发现了 36 个异常值。让我们画出结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/40d9340a39085458453b75f287028869.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PC9mm0_UPqovRJA24D0vag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据异常值处理前后的数据分布<strong class="bd mz"> ( </strong>图片由作者提供)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/fc9dd9fd48b59166e2375baf9c4dd77c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_hxQE-nLyrivXltK01EEDw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@helenayankovska?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">海伦娜·扬科夫斯卡</a>在<a class="ae ky" href="https://unsplash.com/s/photos/chocolate-quality?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="75ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.<strong class="lb iu">扩展隔离林方法</strong></p><p id="fec7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">扩展隔离森林这是一种垂直或水平决策边界线性回归算法，从训练数据中选择随机斜率和偏差。唯一的方法缺点是不能正确检测分支切割数据点。</p><p id="13fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来编码一下:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="d05e" class="mr ms it mn b gy mt mu l mv mw"><strong class="mn iu"># Import the libraries </strong></span><span id="6c3c" class="mr ms it mn b gy mx mu l mv mw">from scipy import stats</span><span id="8248" class="mr ms it mn b gy mx mu l mv mw">from sklearn.ensemble import IsolationForest</span><span id="35b4" class="mr ms it mn b gy mx mu l mv mw">from sklearn.neighbors import LocalOutlierFactor</span><span id="5805" class="mr ms it mn b gy mx mu l mv mw">import matplotlib.dates as md</span><span id="9a5f" class="mr ms it mn b gy mx mu l mv mw">from scipy.stats import norm</span><span id="fda8" class="mr ms it mn b gy mx mu l mv mw">%matplotlib inline</span><span id="27cb" class="mr ms it mn b gy mx mu l mv mw">import seaborn as sns</span><span id="c284" class="mr ms it mn b gy mx mu l mv mw">from sklearn.model_selection import train_test_split</span><span id="3f55" class="mr ms it mn b gy mx mu l mv mw">sns.set_style("whitegrid") #possible choices: white, dark, whitegrid, darkgrid, ticks</span><span id="5e99" class="mr ms it mn b gy mx mu l mv mw">import eif as iso</span><span id="680d" class="mr ms it mn b gy mx mu l mv mw">import matplotlib.pyplot as plt</span><span id="8d08" class="mr ms it mn b gy mx mu l mv mw">import plotly.express as px</span><span id="3e2f" class="mr ms it mn b gy mx mu l mv mw">import plotly.graph_objs as go</span><span id="12ba" class="mr ms it mn b gy mx mu l mv mw">import plotly.figure_factory as ff</span><span id="8e3d" class="mr ms it mn b gy mx mu l mv mw">from plotly import tools</span><span id="310b" class="mr ms it mn b gy mx mu l mv mw">from plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot</span><span id="07b4" class="mr ms it mn b gy mx mu l mv mw">pd.set_option('float_format', '{:f}'.format)</span><span id="9155" class="mr ms it mn b gy mx mu l mv mw">pd.set_option('max_columns',250)</span><span id="d7f5" class="mr ms it mn b gy mx mu l mv mw">pd.set_option('max_rows',150)</span><span id="67d9" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu">#Define X_train, y_train</strong></span><span id="228c" class="mr ms it mn b gy mx mu l mv mw">a = df_enc.loc[:,~df_enc.columns.duplicated()]</span><span id="9fae" class="mr ms it mn b gy mx mu l mv mw">b = a.drop('rating', axis = 1)</span><span id="840e" class="mr ms it mn b gy mx mu l mv mw">X = b.iloc[:,0:11]</span><span id="4e5a" class="mr ms it mn b gy mx mu l mv mw">y = a.iloc[:,2]</span><span id="4582" class="mr ms it mn b gy mx mu l mv mw">X_train,y_train, X_test,y_test = train_test_split(X, y, test_size=0.3)</span><span id="223f" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu">#Define Extend isolation forest </strong></span><span id="058f" class="mr ms it mn b gy mx mu l mv mw">clf = IsolationForest(max_samples='auto', random_state = 1, contamination= 0.02)</span><span id="76bd" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu"># Transform data </strong></span><span id="52e0" class="mr ms it mn b gy mx mu l mv mw">preds = clf.fit_predict(X)</span><span id="5b5a" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu"># Define outliers bondaries structure </strong></span><span id="48eb" class="mr ms it mn b gy mx mu l mv mw">df['isoletionForest_outlier’s'] = preds</span><span id="b085" class="mr ms it mn b gy mx mu l mv mw">df['isoletionForest_outlier’s'] = df['isoletionForest_outlier’s'].astype(str)</span><span id="111b" class="mr ms it mn b gy mx mu l mv mw">df['isoletionForest_scores'] = clf.decision_function(X)</span><span id="ab57" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu"># Counts the chocolate rating outliers :</strong></span><span id="b7b2" class="mr ms it mn b gy mx mu l mv mw">print(df['isoletionForest_outlier’s'].value_counts())</span></pre><p id="aaf4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">输出</strong></p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="ff4b" class="mr ms it mn b gy mt mu l mv mw"><strong class="mn iu">1     2179</strong></span><span id="c481" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu">-1      45</strong></span><span id="71b7" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu">Name: isoletionForest_outlier’s, dtype: int64</strong></span></pre><p id="f2b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该算法发现了 45 个异常值。让我们画出结果:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="aae1" class="mr ms it mn b gy mt mu l mv mw">fig, ax = plt.subplots(figsize=(30, 7))</span><span id="e057" class="mr ms it mn b gy mx mu l mv mw">ax.set_title('Extended Outlier Factor Scores Outlier Detection', fontsize = 15, loc='center')</span><span id="b384" class="mr ms it mn b gy mx mu l mv mw">plt.scatter(X.iloc[:, 0], X.iloc[:, 1], color='g', s=3., label='Data points')</span><span id="2c34" class="mr ms it mn b gy mx mu l mv mw">radius = (df['isoletionForest_scores'].max() - df['isoletionForest_scores']) / (df['isoletionForest_scores'].max() - df['isoletionForest_scores'].min())</span><span id="d762" class="mr ms it mn b gy mx mu l mv mw">plt.scatter(X.iloc[:, 0], X.iloc[:, 1], s=2000 * radius, edgecolors='r', facecolors='none', label='Outlier scores')</span><span id="4b7d" class="mr ms it mn b gy mx mu l mv mw">plt.axis('tight')</span><span id="12ad" class="mr ms it mn b gy mx mu l mv mw">legend = plt.legend(loc='upper left')</span><span id="1cb0" class="mr ms it mn b gy mx mu l mv mw">legend.legendHandles[0]._sizes = [10]</span><span id="8544" class="mr ms it mn b gy mx mu l mv mw">legend.legendHandles[1]._sizes = [20]</span><span id="68f1" class="mr ms it mn b gy mx mu l mv mw">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/88fffcbc6e14c4d044afe9006f1d600a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c-720gIc3NpAu4CG_W8xfg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用扩展离群因子分数的参数圆离群点检测<strong class="bd mz"/></p></figure><p id="fef1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该图通过使用圆的大小来描述异常值，较大的圆被检测为异常值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/dab66d182884ee011dfbcfda72c15eec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MBPYGWpfhaaV4BcJl2gwQA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@kristianapinne?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯蒂安娜·皮恩</a>在<a class="ae ky" href="https://unsplash.com/s/photos/chocolate?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="6705" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.<strong class="lb iu">局部异常值方法</strong></p><p id="0e69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">局部异常值因子是比较数据点密度的唯一方法。如果密度点小于其他邻近密度点，异常值因子将为负(- 1)，因此，该点可视为异常值。</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="c669" class="mr ms it mn b gy mt mu l mv mw"><strong class="mn iu"># Import the libraries</strong></span><span id="b08b" class="mr ms it mn b gy mx mu l mv mw">from scipy import stats</span><span id="9742" class="mr ms it mn b gy mx mu l mv mw">from sklearn.neighbors import LocalOutlierFactor</span><span id="d749" class="mr ms it mn b gy mx mu l mv mw">import matplotlib.dates as md</span><span id="55ea" class="mr ms it mn b gy mx mu l mv mw">from scipy.stats import norm</span><span id="fd3f" class="mr ms it mn b gy mx mu l mv mw">%matplotlib inline</span><span id="c30a" class="mr ms it mn b gy mx mu l mv mw">import seaborn as sns</span><span id="1613" class="mr ms it mn b gy mx mu l mv mw">from sklearn.model_selection import train_test_split</span><span id="e03b" class="mr ms it mn b gy mx mu l mv mw">sns.set_style("whitegrid") #possible choices: white, dark, whitegrid, darkgrid, ticks</span><span id="54bc" class="mr ms it mn b gy mx mu l mv mw">import eif as iso</span><span id="9c22" class="mr ms it mn b gy mx mu l mv mw">import matplotlib.pyplot as plt</span><span id="62a7" class="mr ms it mn b gy mx mu l mv mw">import plotly.express as px</span><span id="9a1c" class="mr ms it mn b gy mx mu l mv mw">import plotly.graph_objs as go</span><span id="477f" class="mr ms it mn b gy mx mu l mv mw">import plotly.figure_factory as ff</span><span id="078d" class="mr ms it mn b gy mx mu l mv mw">from plotly import tools</span><span id="fc3e" class="mr ms it mn b gy mx mu l mv mw">from plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot</span><span id="c811" class="mr ms it mn b gy mx mu l mv mw">pd.set_option('float_format', '{:f}'.format)</span><span id="f8eb" class="mr ms it mn b gy mx mu l mv mw">pd.set_option('max_columns',250)</span><span id="eeca" class="mr ms it mn b gy mx mu l mv mw">pd.set_option('max_rows',150)<br/></span><span id="d23d" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu">#Define X_train, y_train</strong></span><span id="b364" class="mr ms it mn b gy mx mu l mv mw">a = df_enc.loc[:,~df_enc.columns.duplicated()]</span><span id="6223" class="mr ms it mn b gy mx mu l mv mw">b = a.drop('rating', axis = 1)</span><span id="2770" class="mr ms it mn b gy mx mu l mv mw">X = b.iloc[:,0:11]</span><span id="347f" class="mr ms it mn b gy mx mu l mv mw">y = a.iloc[:,2]</span><span id="4c79" class="mr ms it mn b gy mx mu l mv mw">X_train,y_train, X_test,y_test = train_test_split(X, y, test_size=0.3)</span><span id="7ddb" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu">#Define Extend isolation forest </strong></span><span id="efdb" class="mr ms it mn b gy mx mu l mv mw">clf = LocalOutlierFactor(n_neighbors=11)</span><span id="4d8a" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu"># Transform data :</strong></span><span id="47a2" class="mr ms it mn b gy mx mu l mv mw">y_pred = clf.fit_predict(X)</span><span id="a411" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu"># Define outliers bondaries structure </strong></span><span id="3985" class="mr ms it mn b gy mx mu l mv mw">df['localOutlierFactor_outlier’s'] = y_pred.astype(str)<br/>df['localOutlierFactor_scores'] = clf.negative_outlier_factor_</span><span id="6dfd" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu"># Counts the chocolate rating outliers </strong></span><span id="191d" class="mr ms it mn b gy mx mu l mv mw">print(df['localOutlierFactor_outlier’s'].value_counts())</span></pre><p id="15d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">输出</strong></p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="4ad8" class="mr ms it mn b gy mt mu l mv mw"><strong class="mn iu">1     2161</strong></span><span id="544e" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu">-1      63</strong></span><span id="b676" class="mr ms it mn b gy mx mu l mv mw"><strong class="mn iu">Name: localOutlierFactor_outlier’s, dtype: int64</strong></span></pre><p id="f337" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该算法发现了 63 个异常值。让我们画出结果:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="b33c" class="mr ms it mn b gy mt mu l mv mw">fig, ax = plt.subplots(figsize=(30, 7))</span><span id="1cdc" class="mr ms it mn b gy mx mu l mv mw">ax.set_title('Local Outlier Factor Scores Outlier Detection', fontsize = 15, loc='center')</span><span id="79ce" class="mr ms it mn b gy mx mu l mv mw">plt.scatter(X.iloc[:, 0], X.iloc[:, 1], color='g', s=3., label='Data points')</span><span id="0da5" class="mr ms it mn b gy mx mu l mv mw">radius = (df['localOutlierFactor_scores'].max() - df['localOutlierFactor_scores']) / (df['localOutlierFactor_scores'].max() - df['localOutlierFactor_scores'].min())</span><span id="6e35" class="mr ms it mn b gy mx mu l mv mw">plt.scatter(X.iloc[:, 0], X.iloc[:, 1], s=2000 * radius, edgecolors='r', facecolors='none', label='Outlier scores')</span><span id="56f1" class="mr ms it mn b gy mx mu l mv mw">plt.axis('tight')</span><span id="a1d9" class="mr ms it mn b gy mx mu l mv mw">legend = plt.legend(loc='upper left')</span><span id="f924" class="mr ms it mn b gy mx mu l mv mw">legend.legendHandles[0]._sizes = [10]</span><span id="8838" class="mr ms it mn b gy mx mu l mv mw">legend.legendHandles[1]._sizes = [20]</span><span id="655d" class="mr ms it mn b gy mx mu l mv mw">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/d1deb0286a1e182431e6f21c637eeb93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hbgyosC3rR3IF4kUHYBDvg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用局部离群因子分数的参数圆离群点检测<strong class="bd mz">(作者的</strong>图片)</p></figure><p id="cc1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该图通过使用圆的大小来描述异常值，较大的圆被检测为异常值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/cb9f3e8b009058459fa973cf2a243abf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2xxkXH4wD39zXGv4dJvdBw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安东尼奥·卡斯特利亚诺在<a class="ae ky" href="https://unsplash.com/s/photos/confectionery?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="0cf6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有空闲时间，我建议你看看这个:</p><p id="d10c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/5-ways-to-detect-outliers-that-every-data-scientist-should-know-python-code-70a54335a623">https://towards data science . com/5-ways-to-detect-outliers-the-every-data scientist-should-know-python-code-70a 54335 a623</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="b9da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">总结一下</strong></p><p id="c05b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请参考此链接:</p><p id="5254" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://jovian.ml/yeonathan/5-best-outliers-detection-methods-2020" rel="noopener ugc nofollow" target="_blank">https://jovian . ml/yeonathan/5-best-outliers-detection-methods-2020</a></p><p id="fc6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这些方法完成巧克力棒数据集的离群点检测。</p><p id="e30a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用几种异常值检测方法在数据科学中是至关重要的，这一简要概述提醒了使用多重异常值消除方法的重要性。因此，提取最佳数据值，以及共享有用的文档。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="098a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望你喜欢，继续探索！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/7c8d6f92357d1d63a5e444b3f74952ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XW_99ockWQDFDKaoVXaIsQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿瑟尼·波苏邦科在<a class="ae ky" href="https://unsplash.com/s/photos/exploration-neon?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div></div>    
</body>
</html>