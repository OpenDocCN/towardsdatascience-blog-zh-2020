<html>
<head>
<title>Intro to Markov Chain Monte Carlo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">马尔可夫链蒙特卡罗简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/intro-to-markov-chain-monte-carlo-c6f217e00345?source=collection_archive---------19-----------------------#2020-05-12">https://towardsdatascience.com/intro-to-markov-chain-monte-carlo-c6f217e00345?source=collection_archive---------19-----------------------#2020-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/c75589f550d74007c3671bac8259ba95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O8tYEbis-b8dwLV7FC6Mxg.png"/></div></div></figure><div class=""/><div class=""><h2 id="2f22" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">MCMC解释并应用于逻辑回归</h2></div><p id="bae0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在之前的一篇<a class="ae lp" rel="noopener" target="_blank" href="/bayesian-stats-101-for-data-scientists-a8c145a84259">文章</a>中，我对贝叶斯统计做了一个简短的介绍，并告诉你贝叶斯分析如何结合你先前的信念和数据来找到感兴趣的参数的后验分布。我在文章中使用的问题是因为它很容易通过分析找到后验分布。通常情况并非如此，这个问题需要一个数值解。马尔可夫链蒙特卡罗(MCMC)算法就是这样一种模拟某些参数后验分布的方法。</p><p id="f5c9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在进一步阅读之前，你对贝叶斯统计有基本的了解吗？如果是，请继续阅读。如果没有，请在继续之前查看<a class="ae lp" rel="noopener" target="_blank" href="/bayesian-stats-101-for-data-scientists-a8c145a84259">这篇文章</a>。它涵盖了学习马尔可夫链蒙特卡罗(MCMC)之前需要知道的一切。</p><h2 id="e030" class="lq lr je bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">大都会-黑斯廷斯算法</h2><p id="5d2e" class="pw-post-body-paragraph kt ku je kv b kw mj kf ky kz mk ki lb lc ml le lf lg mm li lj lk mn lm ln lo im bi translated">Metropolis-Hastings算法是对MCMC采样的一个很好的介绍。有5个步骤。在深入研究之前，让我们先定义一些参数和函数。</p><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mo"><img src="../Images/1d4c5e3784b4425d66b798eecb219aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vc92x_puIxNQaK4z0gn5Fw.png"/></div></div></figure><p id="3d38" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在我们已经定义了参数、变量和函数，我们可以继续进行Metropolis-Hastings算法的5个步骤。</p><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/5dbf319e1574a3fea3d2d37b1ed455bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*wL9nTspJ23rmYfT8h4PfDg.png"/></div></figure><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/5ff2d90d00abf9d2fe0af9e0e53eaa25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*nFXJvNSmV-tziuo_D6Q3lQ.png"/></div></figure><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/b32896a02f5c91135a1f31ca99b70862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*XxY0CSXriNZH16b-r0qGrw.png"/></div></figure><p id="4c6a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一旦你知道它是如何工作的，就没那么可怕了，对吗？</p><p id="0399" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">通常使用正态分布作为跳跃分布，因为以0为中心的正态分布可以产生小于或大于前一个建议的建议。跳跃分布的标准偏差是一个重要的调整参数。如果你的先验远离数字线上后验的密集部分，并且你的跳跃分布的标准偏差很小，那么在你开始从数字线的正确部分生成建议之前，将需要很长时间。如果您的跳跃分布的标准差相对于参数的真实分布太大，您的模拟后验概率将会有很多缺口，因为在这些位置没有生成建议。幸运的是，MCMC的最佳软件包对它们的跳跃分布有自适应的标准偏差，所以在实践中你不必太担心这个参数。</p><p id="c72c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一旦你生成了模拟的后验，标准的做法是“烧掉”一部分。这是因为该算法可能需要多次迭代来搜索参数空间中可能的值。要使用10%老化，只需丢弃前10%的模拟值。在去除“老化”之后，我们有了可以用于贝叶斯推断的模拟后验概率，例如构建可信区间。</p><h2 id="c432" class="lq lr je bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">应用改进的Metropolis-Hastings法进行逻辑回归</h2><p id="31cc" class="pw-post-body-paragraph kt ku je kv b kw mj kf ky kz mk ki lb lc ml le lf lg mm li lj lk mn lm ln lo im bi translated">现在我们了解了Metropolis-Hastings，我们可以对其进行修改，以适应逻辑回归模型中的系数。被估计的参数是<strong class="kv jf"> 𝛽𝑗 </strong>对<strong class="kv jf"> 𝑗=1,2,…𝑘 </strong>的，其中<strong class="kv jf"> 𝑘 </strong>是模型中系数的数量。主要区别在于将有多个参数需要估计，而不是一个。我通过为每一轮的每一个<strong class="kv jf"> 𝛽𝑗 </strong>生成提议来处理这个问题，但是每一轮都将<strong class="kv jf">𝛽𝑗</strong><em class="mw"/>的顺序随机化。</p><p id="aff5" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为了构建适合逻辑回归模型的MCMC算法，我需要定义4个函数。这将允许我们在MCMC算法的每一步计算我们的后验概率与建议的<strong class="kv jf"> 𝛽𝑗 </strong>的比率。</p><p id="3c41" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><strong class="kv jf">功能1 </strong></p><p id="14b1" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">第一个是<strong class="kv jf"> <em class="mw"> inv_logit </em> </strong>，撤销一个logit转换。logit变换将概率转换为对数概率。</p><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/a0e50f90dd6f6f96a376e84fce027b56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*21TzX7YaLUqtrpAYj-65cA.png"/></div><p class="my mz gj gh gi na nb bd b be z dk translated">对数优势公式</p></figure><p id="77af" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">逻辑回归的输出是对数优势格式。给定我们的数据，在计算我们的<strong class="kv jf"> 𝛽 </strong>向量的对数似然时，我们需要这个函数来将预测的对数几率转换成概率。</p><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/41d017a3a0763a0bdf0882b5ce7c5aaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:244/format:webp/1*Tm_9CiMWZca4vnJucwMOlQ.png"/></div><p class="my mz gj gh gi na nb bd b be z dk translated">逻辑回归的逆Logit方程</p></figure><p id="4e48" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><strong class="kv jf">功能2 </strong></p><p id="5215" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">第二个是<strong class="kv jf"> normal_log_prior </strong>，它计算我们的<strong class="kv jf"> 𝛽 </strong>向量的先验对数，给出我们关于个体<strong class="kv jf"> 𝛽𝑗 </strong>的均值和标准差的先验信念。它是多元正态分布密度的自然对数，其中每个元素是<strong class="kv jf"> 𝑁∼( <em class="mw">先验均值j </em>、<em class="mw">先验标准差。戴夫。j </em> ) </strong>在<strong class="kv jf"> 𝛽 </strong>处。我们使用自然对数来防止下溢。</p><p id="d2e3" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><strong class="kv jf">功能3 </strong></p><p id="587d" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">第三个是<strong class="kv jf"> log_likelihood </strong>，它在给定数据的情况下计算我们的<strong class="kv jf"> 𝛽 </strong>向量的似然对数。当我们用我们的逻辑回归对一个2类问题建模时，单个观察值具有伯努利概率质量函数(<em class="mw"> PMF </em>)。</p><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/5b0e20069e2bba7ad850d9af083c6ebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*wVc6IegcrL4U-t6P4_TDcw.png"/></div><p class="my mz gj gh gi na nb bd b be z dk translated">伯努利·PMF</p></figure><p id="f098" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">给定数据，我们的<strong class="kv jf"> 𝛽 </strong>向量的可能性是单个PMF的乘积。</p><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/79d0cd85dc1608f1f7eeabd56360ff5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*Rj0U5SH7jfXldrTG7eL0cA.png"/></div><p class="my mz gj gh gi na nb bd b be z dk translated">给定数据，我们的<strong class="bd nf"> 𝛽 </strong>向量的可能性</p></figure><p id="9d47" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">对数似然率为:</p><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ng"><img src="../Images/b502690c19e987fba047fc9cce80b6b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jg5NFPrF8dQcN-AhKNnu0A.png"/></div></div></figure><p id="6790" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们使用自然对数来防止下溢。</p><p id="1c6a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><strong class="kv jf">功能4 </strong></p><p id="7468" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">最后，<strong class="kv jf"> log_posterior </strong>根据给定的数据和我们的先验信念计算出<strong class="kv jf"> 𝛽 </strong>向量的后验概率。<strong class="kv jf"> 𝑝𝑜𝑠𝑡𝑒𝑟𝑖𝑜𝑟 ∝ 𝑝𝑟𝑖𝑜𝑟∗𝑙𝑖𝑘𝑒𝑙𝑖ℎ𝑜𝑜𝑑，所以𝑙𝑛(𝑝𝑜𝑠𝑡𝑒𝑟𝑖𝑜𝑟)∝𝑙𝑛(𝑝𝑟𝑖𝑜𝑟)+𝑙𝑛(𝑙𝑖𝑘𝑒𝑙𝑖ℎ𝑜𝑜𝑑)</strong>。</p><p id="6506" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">有了这些定义，我就能够实现一个修改过的Metropolis-Hastings。我还添加了一些功能来消除“老化”，计算可信区间，并进行预测。为了进行预测，用户需要指定他们是否想要使用每个<strong class="kv jf"> 𝛽𝑗 </strong>的模拟后验概率的中值、平均值或模式作为<strong class="kv jf"> 𝛽 </strong>的估计中的系数。</p><figure class="mp mq mr ms gt iv"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="89eb" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">定义好类后，我们可以在真实数据上测试它。</p><h2 id="4f47" class="lq lr je bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">MCMC逻辑回归在实际数据中的应用</h2><p id="cd49" class="pw-post-body-paragraph kt ku je kv b kw mj kf ky kz mk ki lb lc ml le lf lg mm li lj lk mn lm ln lo im bi translated">为了测试MCMC逻辑回归模型，我使用了这个包含86种糖果数据的<a class="ae lp" href="https://www.kaggle.com/fivethirtyeight/the-ultimate-halloween-candy-power-ranking/" rel="noopener ugc nofollow" target="_blank">数据集</a>。我选择了一个简单的模型，包含截距和“pricepercent”(相对于集合中其他部分的单位价格百分比)。)来预测糖果是巧克力的概率。</p><p id="5328" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">模型是:</p><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nj"><img src="../Images/89e5714187063a78bdb30266689d881d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qyHIMnGyNVkvXfc4oIYWgQ.png"/></div></div></figure><figure class="mp mq mr ms gt iv"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="mp mq mr ms gt iv"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nk"><img src="../Images/eacadca49ebf55cc4f3f5bde68cb2942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*epiQccqX8f_gGNeW7VAcOQ.png"/></div></div></figure><p id="b0df" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">如你所见，<strong class="kv jf"> 𝛽0 </strong>和<strong class="kv jf"> 𝛽1 </strong>的模拟联合分布正在形成一个椭圆区域(就像广义线性模型中的联合分布一样)。在包含预烧回合的联合分布图中，系数从原点“行走”，在一个圆中走了一段，然后到达椭圆区域。这是从先验到我们可以认为是“真实的”模拟联合分布的区域的系数。</p><p id="9cf7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">𝛽0 的95%可信区间为[-3.67，-1.32]，𝛽1<strong class="kv jf">的95%可信区间为[2.50，6.72]。𝛽0 </strong>的模拟中值为-2.44，𝛽1<strong class="kv jf">的模拟中值为4.48。价格越贵，糖果成为巧克力的可能性就越大。</strong></p><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nl"><img src="../Images/95be3ac08b8fea2d035812468841bda9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z_e9ui4FKbomcgHY2XwIMQ.png"/></div></div></figure><p id="1a8e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">查看价格百分位数与巧克力概率的关系图，我们可以看到我们的模型有一个很好的S曲线形状，如逻辑回归教科书中所示。它似乎在将糖果归类为巧克力方面做得不太好(与真阳性相比有很多假阴性)，所以可能需要一个更复杂的模型。*</p><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nm"><img src="../Images/12abd42720467c9683680e1d4746164a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3kbLOEQFDlNbZ1LMMLrKw.png"/></div></div></figure><p id="980b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">*当然，在构建真正的预测模型时，您应该使用验证和测试数据集来评估模型的性能。训练、验证、测试过程不是本文的主题；应用MCMC是。</p><h2 id="28f0" class="lq lr je bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">与用MLE估计的逻辑回归相比</h2><p id="ad0c" class="pw-post-body-paragraph kt ku je kv b kw mj kf ky kz mk ki lb lc ml le lf lg mm li lj lk mn lm ln lo im bi translated">现在，我们已经用修改的Metropolis-Hastings算法拟合了逻辑回归，让我们将结果与标准的最大似然估计进行比较。结果很像！</p><figure class="mp mq mr ms gt iv"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="mp mq mr ms gt iv gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/b073e9365fae62469e8b5f9b40ba57ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*rUhpadO0BBJtqX-lJ2OUlw.png"/></div><p class="my mz gj gh gi na nb bd b be z dk translated">极大似然逻辑回归模型综述</p></figure><p id="a234" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">如果我做对了，你知道理解MCMC背后的想法，特别是Metropolis-Hastings，并且理解它们如何应用于实际问题，例如拟合逻辑回归模型。</p><p id="4125" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">感谢阅读！如果你对MCMC和贝叶斯统计建模和机器学习感兴趣，请查看<a class="ae lp" href="https://docs.pymc.io/" rel="noopener ugc nofollow" target="_blank"> pymc3 </a>。</p><p id="efa7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在这里找到我的项目库<a class="ae lp" href="https://github.com/jkclem/MCMC-Log-Reg" rel="noopener ugc nofollow" target="_blank"/>。</p></div></div>    
</body>
</html>