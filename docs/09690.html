<html>
<head>
<title>The final countdown: Deploying my Deep Learning Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">最后的倒计时:部署我的深度学习项目</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-final-countdown-deploying-my-deep-learning-project-29bf970e320b?source=collection_archive---------50-----------------------#2020-07-09">https://towardsdatascience.com/the-final-countdown-deploying-my-deep-learning-project-29bf970e320b?source=collection_archive---------50-----------------------#2020-07-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bad4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在过去的两周里，我将我的深度学习项目转移到生产中，使用 Google can 平台和 Django 建立了一个网站，你现在可以自己看到</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3e1101dde1e5405096a9bf30c1bbdbea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ceHJjq8wNgI5zUk1u9nTw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">布鲁斯·马斯在<a class="ae kv" href="https://unsplash.com/s/photos/success?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="9812" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">你怎么称呼一个从未与世界分享的令人敬畏的项目？—你不知道。除非这个项目是你的，否则你永远不会知道它的存在。研究不仅仅是有想法和写科学文章。研究是关于分享这些想法，是关于解决日常问题，并致力于建设一个更美好的世界和一个鼓舞人心的未来。</strong></p><p id="fd2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在过去的两周里，我接受了将深度学习项目投入生产并与世界分享的使命。<strong class="ky ir">该项目是一个利用卫星图像绘制每日受野火影响地区地图的模型。</strong>投产能有多难？嗯，有一些注意事项要记住。</p><h2 id="5f0b" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">目录</h2><ul class=""><li id="30c2" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr ms mt mu mv bi translated">项目的一些背景</li><li id="96c6" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">下载数据</li><li id="0ab3" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">预处理数据并生成模型输出</li><li id="9a5c" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">用 Django 创建和部署网站</li></ul></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="d240" class="ni lt iq bd lu nj nk nl lx nm nn no ma jw np jx md jz nq ka mg kc nr kd mj ns bi translated">项目的一些背景</h1><p id="fca7" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nt lh li lj nu ll lm ln nv lp lq lr ij bi translated">正如我上面提到的，这个项目包括一个使用卫星图像作为输入来生成被野火烧毁的区域的每日地图的模型。<strong class="ky ir">这项研究导致了一篇</strong> <a class="ae kv" href="https://www.sciencedirect.com/science/article/pii/S0924271619303089?casa_token=c5FZE9u_BJkAAAAA:34uSI3GWUEUAuV5fUGt1qCIzn9MdrOg6ifZz6ZEA_lqPK5bJw_80vnuuy6kNac3ivFmT819HBw" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">科学论文的发表</strong> </a> <strong class="ky ir">我在下面的两个故事中描述了这篇论文，如果你有兴趣找到关于这个主题的更多细节。</strong></p><div class="nw nx gp gr ny nz"><a href="https://medium.com/@mnpinto/mapping-burned-areas-from-space-with-artificial-intelligence-3657bdb97a9d" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">用人工智能从太空测绘燃烧区域</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">森林火灾是一种自然灾害，通常会对生态系统和人类产生巨大影响。绘制火灾图…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">medium.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on kp nz"/></div></div></a></div><div class="nw nx gp gr ny nz"><a rel="noopener follow" target="_blank" href="/mapping-2019-20-australian-bushfires-4e6d9a0eed63"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">绘制 2019-20 澳大利亚森林火灾</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">一个案例研究显示了如何使用深度学习从卫星图像中监控火灾的日常进展…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="oo l ok ol om oi on kp nz"/></div></div></a></div></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="0b7b" class="ni lt iq bd lu nj nk nl lx nm nn no ma jw np jx md jz nq ka mg kc nr kd mj ns bi translated"><strong class="ak">下载数据</strong></h1><p id="60a5" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nt lh li lj nu ll lm ln nv lp lq lr ij bi translated">任何模型都需要一些输入数据来生成输出。在我的例子中，输入数据——每日卫星图像——需要从网络服务器下载。这包括使用 API 发出请求，等待请求被处理，最后下载图像。当一切顺利时，这很容易，但经常会有意想不到的问题。</p><ul class=""><li id="3664" class="ml mm iq ky b kz la lc ld lf op lj oq ln or lr ms mt mu mv bi translated">对服务器的请求可能需要一些时间来处理，并且每个请求有一个文件限制；</li><li id="c265" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">连接可能会失败，结果导致下载中断，从而导致文件损坏；</li><li id="baeb" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">由于某些不可预知的原因，数据可能会延迟或丢失。</li></ul><p id="f74e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">为了让请求/下载过程健壮地工作，我必须编写一个</strong> <a class="ae kv" href="https://github.com/mnpinto/geoget" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> Python 包</strong> </a> <strong class="ky ir">来管理下载过程，其特性包括:</strong></p><ul class=""><li id="6ac7" class="ml mm iq ky b kz la lc ld lf op lj oq ln or lr ms mt mu mv bi translated">在文件数量对于单个请求来说太大的情况下，将请求拆分到 API</li><li id="7753" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">记下哪些文件已经被下载；</li><li id="e873" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">检查下载文件的哈希以确保它们没有损坏；</li><li id="1a59" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">能够在连接丢失的情况下重新启动进程，而不必发出新的请求。</li></ul><p id="6f53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测试和调试所有这些代码非常耗时，但在进入生产阶段时却是必要的。<strong class="ky ir">流程需要尽可能可靠，并且需要最少的人工干预。</strong></p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="5bff" class="ni lt iq bd lu nj nk nl lx nm nn no ma jw np jx md jz nq ka mg kc nr kd mj ns bi translated">预处理数据并生成模型输出</h1><p id="cac9" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nt lh li lj nu ll lm ln nv lp lq lr ij bi translated">幸运的是，这一步更简单，因为可以使用研究过程中使用的预处理函数来准备数据。<strong class="ky ir">但是，经常需要一些修改:</strong></p><ul class=""><li id="a404" class="ml mm iq ky b kz la lc ld lf op lj oq ln or lr ms mt mu mv bi translated">代码应该是快速的和内存高效的，以减少计算成本和处理时间；</li><li id="5fea" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">代码应该对诸如丢失数据之类的问题具有鲁棒性；</li><li id="5b55" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">代码应该能够在 CPU 或 GPU 上运行，这取决于机器的规格——幸运的是，<a class="ae kv" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> Pytorch </a>使这变得非常容易。</li></ul><p id="0854" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对数据进行预处理后，就该加载模型、生成预测并保存结果了。<strong class="ky ir">然而，结果需要以对网站友好的格式保存</strong>。在我的案例中，这导致了一些额外的步骤:</p><ul class=""><li id="dfdd" class="ml mm iq ky b kz la lc ld lf op lj oq ln or lr ms mt mu mv bi translated">将图像数据转换成矢量格式并分离各个烧伤区域。</li><li id="a17a" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">还保存与每个单独事件相对应的 GeoTiff 图像。</li></ul><p id="0015" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后可以将数据添加到数据库中。我选择使用能够处理地理数据类型的<a class="ae kv" href="https://postgis.net/" rel="noopener ugc nofollow" target="_blank"> PostGIS </a>，比如多边形和栅格。</p><p id="b52c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实际上，我在 Google 云平台虚拟机上运行下载和预处理步骤。为了降低成本，该实例每天只打开一次来计算输出，并将它们发送到网站所在的服务器。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="67a0" class="ni lt iq bd lu nj nk nl lx nm nn no ma jw np jx md jz nq ka mg kc nr kd mj ns bi translated">用 Django 创建和部署网站</h1><p id="21fb" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nt lh li lj nu ll lm ln nv lp lq lr ij bi translated">Django 是一个使用 Python 快速开发的 web 框架。<strong class="ky ir">问题是，两周前我还不知道怎么用它。我以前读过，但我从未找到合适的机会使用它。我觉得这可能是一个有益的挑战。<strong class="ky ir">毕竟，学习是有趣的！或者至少在你最终明白事情是如何运作的之后，这是很有趣的。</strong>学习过程是这样的:</strong></p><ul class=""><li id="c738" class="ml mm iq ky b kz la lc ld lf op lj oq ln or lr ms mt mu mv bi translated">前两天是从看 YouTube 上的一些教程开始的；</li><li id="7381" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">当我学会了基础知识，我开始创建我的网站项目；</li><li id="e482" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">接下来的几天，随着我开始理解这个框架是如何工作的，我逐渐添加了更多的特性。</li></ul><p id="b6bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个过程的特点是大量的谷歌搜索，浏览器中不合理数量的打开标签，以及大量的耐心。</p><p id="846d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好的一面是，我学得越多，就越意识到姜戈带来的潜力。随着时间的推移，进度开始加快— <strong class="ky ir">攀登学习曲线！</strong></p><p id="a53b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了一个工作示例后，我决定是时候部署它了。我发现这个过程比预期的更具挑战性。通常，YouTube 上的教程只涉及开发部分，缺乏对部署过程的解释。我花了大约三天时间才完成这一步。我必须弄清楚什么是<a class="ae kv" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-django-with-postgres-nginx-and-gunicorn-on-ubuntu-16-04" rel="noopener ugc nofollow" target="_blank"> Nginx 和 Gunicorn，以及如何让一切工作起来</a>。但是，就像任何事情一样，当任务更具挑战性时，我们学到的东西也最多。</p><p id="9f11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">说够了！我给你看一下网页(</strong><a class="ae kv" href="https://meteo-ai.com/burnedareas/" rel="noopener ugc nofollow" target="_blank">【meteo-ai.com】T21</a><strong class="ky ir">)并描述一下主要功能。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/240a6f98c912be9ef09c07272abdee29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Pb-drUJvDRncac1e"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图一。显示 2017 年影响葡萄牙的极端火灾的<a class="ae kv" href="https://meteo-ai.com/burnedareas/" rel="noopener ugc nofollow" target="_blank">网站</a>的打印屏幕。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/14b61d57c4f60f279646cd49a90c1965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ylOSVYLOSQSgDjMy9-vMMg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图二。显示过去一年概况的<a class="ae kv" href="https://meteo-ai.com/burnedareas/" rel="noopener ugc nofollow" target="_blank">网站</a>的打印屏幕。</p></figure><p id="2d52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">该网站的特色:</strong></p><ul class=""><li id="6251" class="ml mm iq ky b kz la lc ld lf op lj oq ln or lr ms mt mu mv bi translated">燃烧区域数据和活跃火灾数据存储在一个与<a class="ae kv" href="https://docs.djangoproject.com/en/3.0/ref/contrib/gis/" rel="noopener ugc nofollow" target="_blank"> GeoDjango </a>配合良好的<a class="ae kv" href="https://postgis.net/" rel="noopener ugc nofollow" target="_blank"> PostGIS </a>数据库中；</li><li id="80bc" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">用户可以选择将导致数据库查询的可视化的时间范围；</li><li id="4842" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">网站上的结果显示在<a class="ae kv" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank">传单</a>地图上，利用了 nice <a class="ae kv" href="https://github.com/Leaflet/Leaflet.markercluster" rel="noopener ugc nofollow" target="_blank">标记集群扩展</a>，允许以一种干净有效的方式聚集相近的标记(参见图 2 中的地图)。</li><li id="77e2" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">通过将每个像素渲染为多边形，使用燃烧日期或模型的置信水平对区域进行着色，来显示燃烧区域地图。<strong class="ky ir">这允许我有一个跨越用户选择范围的颜色图</strong>(参见图 1 中的图)；</li><li id="cd47" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">所选时间段或火灾事件的统计数据显示为使用<a class="ae kv" href="https://plotly.com/javascript/" rel="noopener ugc nofollow" target="_blank"> Plotly.js </a>制作的动态图(参见图 1 和图 2 中的柱状图)。</li></ul><p id="2bd6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">能够以可视和动态的形式聚集所有这些信息对于监控和研究火灾非常有用。</p><p id="2fd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有网页显示类似类型的信息，然而，这种深度学习模型产生的烧伤区域是这种类型产品的最先进水平。通过使用 3D 卷积和 LSTM 层分析输入图像序列中的时空相关性，<strong class="ky ir">经过训练的模型非常擅长识别燃烧区域并确定像素燃烧的日期</strong> —特别强调后者。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="56f5" class="ni lt iq bd lu nj nk nl lx nm nn no ma jw np jx md jz nq ka mg kc nr kd mj ns bi translated">结局？</h1><p id="c2bc" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nt lh li lj nu ll lm ln nv lp lq lr ij bi translated">一点也不。网站目前的状态有很多方面需要改进。此外,<strong class="ky ir">在燃烧区领域还有更多研究路径需要进一步探索。一个热门话题是使用公开的卫星图像绘制更高分辨率(3000 万像素或更小)的火烧区地图。<strong class="ky ir">高空间分辨率与频率较低的图像相权衡。这是我正在解决的问题。处理如此大量的数据本身就是一个挑战！我会确保在将来写下结果。</strong></strong></p><p id="34a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也许这只是一个开始。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h2 id="444d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">关于我</h2><div class="nw nx gp gr ny nz"><a rel="noopener follow" target="_blank" href="/my-3-year-journey-from-zero-python-to-deep-learning-competition-master-6605c188eec7"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">我的 3 年历程:从零 Python 到深度学习竞赛高手</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">自从 2017 年开始学习 Python 以来，我一直遵循的道路是成为一名独自参加 Kaggle 比赛的大师…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="ou l ok ol om oi on kp nz"/></div></div></a></div><p id="2429" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ov">感谢阅读！祝您愉快！</em></p></div></div>    
</body>
</html>