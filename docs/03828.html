<html>
<head>
<title>Dockerize Jupyter with the Visual Debugger</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用可视化调试器Dockerize Jupyter</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dockerize-jupyter-with-official-visual-debugger-enabled-cbce1840b7f?source=collection_archive---------49-----------------------#2020-04-09">https://towardsdatascience.com/dockerize-jupyter-with-official-visual-debugger-enabled-cbce1840b7f?source=collection_archive---------49-----------------------#2020-04-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ef7c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在docker容器中启用和使用Jupyter可视化调试的分步指南。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f8c981e6e406db80c32e25e896aa8ddb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wBKVVfgNgsxPB1mo"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尼兰塔·伊兰加穆瓦在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="420b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Jupyter最近宣布了期待已久的可视化调试器的首次公开发布。虽然这是第一个版本，但它支持调试和检查变量等所需的所有基本调试要求。</p><p id="970f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据科学界非常依赖Jupyter笔记本电脑，因为它能够以互动的方式轻松交流和分享成果。</p><p id="7fc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，唯一担心的是缺少可视化调试能力，因此人们通常不得不转向其他可用的经典ide，它们提供了更好的调试和代码重构能力。这个特性是数据科学界期待已久的，现在终于发布了。</p><p id="4be5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关可视化调试器如何运行的简要概述，请参考下面的截屏:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/1c88f94fcc759a19ec0878b88874c9d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NP0bYBdrhwgpJpKDhPLWrQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://github.com/jtpio" rel="noopener ugc nofollow" target="_blank">杰瑞米</a>在<a class="ae ky" href="https://github.com/jupyterlab/debugger/blob/master/screencast.gif" rel="noopener ugc nofollow" target="_blank"> Github </a>上截屏</p></figure><p id="2232" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将介绍在现有的JupyterLab环境中设置可视化调试器所需的步骤，还将介绍默认情况下启用了可视化调试器的JupyterLab环境。</p><h1 id="c5d8" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">先决条件:</h1><p id="2797" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">JupyterLab 2.0+ <br/>基本了解任何编程语言的调试<br/>基本了解Docker。</p><h1 id="1e84" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">安装:</h1><p id="1d26" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">假设您已经在使用JupterLab，那么您只需要安装JupyterLab调试器扩展来进行前端调试，并在后端安装任何支持Jupyter调试协议的内核。</p><h2 id="55ba" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">安装JupyterLab扩展以启用前端调试:</h2><p id="8257" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">JupyterLab使用nodejs来安装扩展，所以为了安装前端调试器扩展，我们也需要安装nodejs。</p><p id="0da2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在未来的版本中，Jupyter可能会默认包含这个扩展。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="c477" class="mt lx it ng b gy nk nl l nm nn">conda install -c conda-forge nodejs<br/>jupyter labextension install @jupyterlab/debugger</span></pre><h2 id="34c9" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">安装内核xeus-python:</h2><p id="faf2" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在后端截至目前，只有xeus-python支持Jupyter调试协议。将来，可能会有许多其他内核支持这个协议。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="834d" class="mt lx it ng b gy nk nl l nm nn">conda install xeus-python -c conda-forge</span></pre><p id="33a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果您运行Jupyter实验室，您应该能够看到另外两个图标，分别位于xeus-python内核的控制台和笔记本部分。</p><h2 id="2d5b" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">为什么要集装箱化？</h2><p id="0cc3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">容器使得跨多个环境的开发更加顺畅。这就是为什么它们是应用交付的云原生方法的技术基础。</p><p id="8cb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Docker的创建者Solomon Hykes说，当支持的软件环境不一致时，问题就出现了。“您将使用Python 2.7进行测试，然后它将在生产中运行于Python 3上，奇怪的事情将会发生。或者，您将依赖于某个SSL库版本的行为，然后会安装另一个。你将在Debian上运行你的测试，在Red Hat上生产，各种奇怪的事情都会发生。”</p><p id="84fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Container通过将运行应用程序所需的环境、依赖项、二进制文件、所有必要的配置和应用程序本身打包到一个包中来解决这个问题。这样，我们不再需要担心操作系统和其他特定于环境的依赖性，因为一切都打包在一个独立的实体中，可以在任何地方运行。</p><h2 id="9f97" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">启用可视调试器的Dockerize Jupyter</h2><p id="18b2" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我假设您熟悉基本的Docker命令和术语。解释docker如何工作超出了本文的范围。但是，如果您觉得需要重新查看，请参考Docker <a class="ae ky" href="https://docs.docker.com/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="bdb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将创建所需环境的Docker映像所需的Docker文件。您可以将图像看作是一个文件，其中包含了在容器中运行我们的应用程序所需的所有内容。</p><p id="0ca3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用Miniconda，它是Anaconda的一个最小的轻量级安装程序。它是Anaconda的一个小型引导版本，只包含conda、Python、它们所依赖的包以及少量其他有用的包。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="8461" class="mt lx it ng b gy nk nl l nm nn">FROM continuumio/miniconda3</span></pre><p id="953f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">定义Docker文件和工作目录的元数据:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="629c" class="mt lx it ng b gy nk nl l nm nn">LABEL maintainer=”Manish Tiwari &lt;m***<a class="ae ky" href="mailto:mtiwari5@gmail.com" rel="noopener ugc nofollow" target="_blank">@gmail.com</a>&gt;”<br/>LABEL version=”0.1"<br/>LABEL description=”Debugging Jupyter Notebook”</span><span id="e2a2" class="mt lx it ng b gy no nl l nm nn">WORKDIR /jup</span></pre><p id="fd21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装JupyterLab</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="6420" class="mt lx it ng b gy nk nl l nm nn">RUN conda install -c conda-forge jupyterlab</span></pre><p id="a627" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为前端调试安装nodejs和labextension</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="9115" class="mt lx it ng b gy nk nl l nm nn">RUN conda install -c conda-forge nodejs<br/>RUN jupyter labextension install <a class="ae ky" href="http://twitter.com/jupyterlab/debugger" rel="noopener ugc nofollow" target="_blank">@jupyterlab/debugger</a></span></pre><p id="71f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装支持Jupyter调试协议的内核</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="4456" class="mt lx it ng b gy nk nl l nm nn">RUN conda install xeus-python -c conda-forge</span></pre><p id="ff5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>这里我们使用了conda软件包管理器，您也可以使用pip，但是，不建议同时使用两者，因为这可能会破坏环境。</p><p id="b72f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，公开端口并定义入口点</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="6255" class="mt lx it ng b gy nk nl l nm nn">EXPOSE 8888<br/>ENTRYPOINT [“jupyter”, “lab”,” — ip=0.0.0.0",” — allow-root”]</span></pre><p id="22ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的最终文档应该如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">启用可视化调试器的Dockerize JupyterLab</p></figure><h2 id="e389" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">从以上Docker文件构建Docker映像。</h2><p id="94d5" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">导航到包含上述docker文件的文件夹，并运行以下命令。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="298d" class="mt lx it ng b gy nk nl l nm nn">docker build -t visualdebugger .</span></pre><p id="794e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您也可以从任何提供Dockerfile文件绝对路径的地方运行该命令。</p><p id="415c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功构建映像后，通过以下命令列出docker映像进行验证</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="f79c" class="mt lx it ng b gy nk nl l nm nn">docker image ls</span></pre><p id="e104" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/6179a30f5e9195b7c5395c73ba300736.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hiJBa2h4Ut7d14VMYFiaFg.png"/></div></div></figure><p id="b989" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在一个新的容器中运行docker映像，如下所示:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="72da" class="mt lx it ng b gy nk nl l nm nn">docker container run -p 8888:8888 visualdebugger-jupyter</span></pre><p id="c95e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们将主机端口(冒号前的第一个端口)8888映射到容器8888中的公开端口。这是主机与容器的端口通信所必需的，Jupiter在容器中监听该端口。</p><p id="c337" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行上述命令后，您应该会看到如下输出(假设端口没有被其他进程使用):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/c60a7749851eaffc37ba0927c00cacd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bA2J__eyzvXXA2jPrnUs7g.png"/></div></div></figure><p id="46f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着我们的docker容器已经启动并正在运行。现在，您可以打开上面输出中指定的URL，使用Jupyter和可视化调试器，甚至不会意识到它没有在主机上运行。</p><p id="218b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以通过以下命令查看可用容器的列表:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="972d" class="mt lx it ng b gy nk nl l nm nn">docker container ls</span></pre><p id="7e9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的命令应该列出容器以及容器的元数据，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/c35ccb42d2801c2ef649a15737e768e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jp5khOjrRih-tSoS8l2Ytw.png"/></div></div></figure><p id="4ef1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦打开上面输出中指定的URL，您应该看到JupyterLab在主机的localhost和端口8888上运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/4f85f4e6d62d8bc542d7566a733cbbe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXTp61nmnFzHe8OvqR4Xhg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">容器中运行可视化调试器的JupyterLab</p></figure><p id="55a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在来玩一下可视化调试器，用启动器中显示的<strong class="lb iu"> xpython </strong>而不是python打开笔记本或控制台。</p><p id="2c41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经发布了上面我们刚刚在<a class="ae ky" href="https://hub.docker.com/repository/docker/beingmanish/visualdebugger-jupyter" rel="noopener ugc nofollow" target="_blank"> docker hub </a>上构建的docker映像，以防你想要一个启用了可视化调试的随时可用的Jupiter环境。</p><p id="1369" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过下面的命令来拖动docker图像，并使用它。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="2f4b" class="mt lx it ng b gy nk nl l nm nn">docker pull beingmanish/visualdebugger-jupyter</span></pre><p id="adb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想更深入地了解Jupyter的可视化调试架构，你可以参考这里的<a class="ae ky" href="https://blog.jupyter.org/a-visual-debugger-for-jupyter-914e61716559" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="c285" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建议或问题？请写在评论里。</p><p id="9440" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">参考资料:<br/> </strong> <a class="ae ky" href="https://blog.jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter博客</a><br/><a class="ae ky" href="https://github.com/jupyter" rel="noopener ugc nofollow" target="_blank">Jupyter @ Github</a></p></div></div>    
</body>
</html>