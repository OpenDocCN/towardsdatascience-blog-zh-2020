<html>
<head>
<title>Crime Rate Prediction using Facebook Prophet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用脸书先知预测犯罪率</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/crime-rate-prediction-using-facebook-prophet-5348e21273d?source=collection_archive---------39-----------------------#2020-08-11">https://towardsdatascience.com/crime-rate-prediction-using-facebook-prophet-5348e21273d?source=collection_archive---------39-----------------------#2020-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="54c8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">充分利用 FB Prophet 进行时间序列预测的指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b82bfeb81b477c21ad487f8264057a16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SjK2EwtkhLWp511T"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/photos/4dKy7d3lkKM" rel="noopener ugc nofollow" target="_blank"> I </a> mg 通过<a class="ae ky" href="https://unsplash.com/photos/Q2-EQDwxFtw" rel="noopener ugc nofollow" target="_blank">链接从 unsplash】</a></p></figure><blockquote class="kz la lb"><p id="df22" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">时间序列预测是任何数据科学家都必须知道的技术之一。像预测天气、产品销售、购物中心的客户访问或要维护的库存数量等问题都与时间序列预测有关，这使它成为数据科学家技能组合的重要补充。</p></blockquote><p id="dfd3" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在这篇文章中，我将介绍<strong class="lf iu">如何使用脸书预言家预测芝加哥的犯罪率。</strong>分成 5 部分:</p><p id="ece9" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">1.先知游戏攻略</p><p id="2cc7" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">2.电子设计自动化(Electronic Design Automation)</p><p id="51fa" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">3.数据处理</p><p id="506a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">4.模型预测法</p><p id="a10a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">5.外卖食品</p><p id="9651" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">让我们开始旅程吧🏃‍♀️🏃‍♂️.</p><p id="1118" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu"> 1。先知介绍</strong></p><p id="4432" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">2017 年，脸书核心数据科学团队开源 Prophet🎉🎉。正如其<a class="ae ky" href="https://github.com/facebook/prophet" rel="noopener ugc nofollow" target="_blank"> Github </a>页面所述，Prophet 是:</p><ul class=""><li id="c3a8" class="mc md it lf b lg lh lj lk lz me ma mf mb mg ly mh mi mj mk bi translated">预测时间序列数据的程序；</li><li id="625d" class="mc md it lf b lg ml lj mm lz mn ma mo mb mp ly mh mi mj mk bi translated">基于附加模型；</li><li id="f84b" class="mc md it lf b lg ml lj mm lz mn ma mo mb mp ly mh mi mj mk bi translated">用每年、每周和每天的季节性以及假日效应来拟合非线性趋势。</li></ul><p id="492f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">Prophet 使用一个可分解模型，该模型有三个主要部分，包括趋势、季节性和假期，组合如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/fadded44149904c07cf0969de44a5638.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*q6pOXljSGBzoFLChHSaCIw.png"/></div></figure><p id="3957" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">其中:</p><ul class=""><li id="67fa" class="mc md it lf b lg lh lj lk lz me ma mf mb mg ly mh mi mj mk bi translated"><em class="le"> g(t) </em>是对非周期性变化建模的趋势函数；</li><li id="86eb" class="mc md it lf b lg ml lj mm lz mn ma mo mb mp ly mh mi mj mk bi translated"><em class="le"> s(t) </em>表示周期性变化(例如，每周和每年的季节性)；</li><li id="6923" class="mc md it lf b lg ml lj mm lz mn ma mo mb mp ly mh mi mj mk bi translated"><em class="le"> h(t) </em>表示节假日对潜在不规则时间表的影响；</li><li id="21e3" class="mc md it lf b lg ml lj mm lz mn ma mo mb mp ly mh mi mj mk bi translated">误差项表示模型不适应的任何特殊变化。</li></ul><blockquote class="kz la lb"><p id="0cc3" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">因此，使用时间作为回归变量，Prophet 试图将时间的线性和非线性函数拟合为组件。实际上，Prophet 将预测问题框定为曲线拟合练习，而不是查看每个观察的基于时间的依赖性，这带来了灵活性、快速拟合和可解释的参数。</p></blockquote><blockquote class="mr"><p id="208b" class="ms mt it bd mu mv mw mx my mz na ly dk translated">Prophet 最适用于具有强烈季节效应的时间序列和几个季节的历史数据。</p></blockquote><p id="c15c" class="pw-post-body-paragraph lc ld it lf b lg nb ju li lj nc jx ll lz nd lo lp ma ne ls lt mb nf lw lx ly im bi translated"><strong class="lf iu"> 2。EDA </strong></p><p id="2e82" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">这里使用的数据是来自<a class="ae ky" href="https://www.kaggle.com/currie32/crimes-in-chicago" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>的芝加哥犯罪数据集。它包含了 2001 年至 2017 年发生在芝加哥市的已报告犯罪的汇总。</p><p id="3cd6" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">快速查看下面的数据，您会注意到数据集有 23 列和 7，941，282 条记录，包括 ID、案例号、块、主要类型、描述等。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">芝加哥原始犯罪数据集一览</p></figure><p id="42f1" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">首先，让我们删除未使用的列。具体来说，</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="b80f" class="nn no it nj b gy np nq l nr ns">df.drop([‘Unnamed: 0’, ‘ID’, ‘Case Number’, ‘IUCR’, ‘X Coordinate’,  ‘Y Coordinate’,’Updated On’,’Year’, ‘FBI Code’, ‘Beat’,’Ward’,’Community Area’,‘Location’, ‘District’, ‘Latitude’, ‘Longitude’],<br/>axis = 1, inplace=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7cf5cceb55cff37814c93ba8fe2122bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*JEPMH8V4LPeCrZJ3FTbcaA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 1 删除列后的数据视图</p></figure><p id="6ec3" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">如图 1 所示，<em class="le">【日期】</em>栏为日期格式。让我们将它转换成熊猫可以理解的日期格式，并将其设置为索引。具体来说，</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="a084" class="nn no it nj b gy np nq l nr ns">df.Date = pd.to_datetime(df.Date, format = ‘%m/%d/%Y %I:%M:%S %p’)<br/>df.index = pd.DatetimeIndex(df.Date)<br/>df.drop(‘Date’, inplace = True, axis = 1)</span></pre><p id="24d5" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">现在，数据可以进行可视化了。<strong class="lf iu">首先，让我们看看每年的犯罪分布。</strong>具体来说，</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="1802" class="nn no it nj b gy np nq l nr ns">plt.plot(df.resample(‘Y’).size())<br/>plt.xlabel(‘Year’)<br/>plt.ylabel(‘Num of crimes’)</span></pre><p id="ecf3" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">注意上面的<em class="le"> df.resample('Y ')。size() </em>产生年度犯罪计数。</p><p id="3940" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">如图 2 所示，从 2002 年到 2005 年，犯罪率开始下降。但是从 2006 年开始，犯罪率开始上升，在 2009 年达到顶峰，然后一直下降到 2018 年。这条曲线可能反映了经济对社会犯罪的影响。金融危机前后，犯罪率逐年下降，但金融危机导致的经济不景气导致犯罪率上升。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/0308c1899e172e1e9eef9e4f9d1ff781.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*_QDmoMVDkNxM9a1PwuYDOA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 2 犯罪率的年度分布</p></figure><p id="c24c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu">其次，我们来看一下季度犯罪率分布。如图 3 所示，犯罪率呈周期性起伏的下降趋势。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/86bbd579546c6051c6dd4c8c81fc40f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*sT6ojTvN8Hioz4Se4awFjg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 3 犯罪率的月度分布</p></figure><p id="46be" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">同样，如图 4 所示，月度犯罪率显示出与季度分析相同的模式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/639db28166d95a6be6cfa086c977f63f.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*U4dWKS0paCJWRLWEaakCvg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 4 犯罪率的季度分布</p></figure><p id="a160" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu"> 3。数据处理</strong></p><p id="3218" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><em class="le">Prophet 的输入始终是包含两列的数据帧:“ds”和“y”。“ds”(datestamp)列应该是 Pandas 所期望的格式，最好是 YYYY-MM-DD 表示日期，或者 YYYY-MM-DD HH:MM:SS 表示时间戳。“y”列必须是数字，代表我们希望预测的测量值。</em></p><p id="a9ac" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">具体来说，</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="f1c1" class="nn no it nj b gy np nq l nr ns">df_m = df.resample(‘M’).size().reset_index()<br/>df_m.columns = [‘Date’, ‘Monthly Crime Count’]<br/>df_m_final = df_m.rename(columns = {‘Date’: ‘ds’, ‘Monthly Crime Count’: ‘y’})</span></pre><p id="e468" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu"> 4。模型预测</strong></p><p id="41fd" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><em class="le">从 EDA 分析中，我们发现有</em><strong class="lf iu"><em class="le"/></strong><em class="le">的月度和季度季节性，而没有</em> <strong class="lf iu"> <em class="le">的年度季节性。</em> </strong> <em class="le">默认情况下，如果时间序列超过两个周期，Prophet 适合每周和每年的季节性。用户可以使用“添加季节性”方法添加季节性，如每小时、每月和每季度。</em></p><p id="82f0" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">要进行预测，请实例化一个新的 Prophet 对象，并调用 fit 方法对数据进行训练。具体来说，</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="36c4" class="nn no it nj b gy np nq l nr ns">m = Prophet(interval_width=0.95, yearly_seasonality=False)<br/>m.add_seasonality(name=’monthly’, period=30.5, fourier_order=10)<br/>m.add_seasonality(name=’quarterly’, period=91.5, fourier_order=10)<br/>m.fit(df_m_final)</span></pre><p id="7701" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">注意<em class="le"> 'interval_width=0.95' </em>，产生一个围绕预测的置信区间。Prophet 使用部分傅立叶和来近似周期信号。傅立叶级数决定了季节性变化的速度。</p><p id="f7e2" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">预测是在一个数据帧上进行的，该数据帧有一列<em class="le">‘ds’</em>包含要进行预测的日期。例如，要预测接下来的 24 个月，请尝试以下方法:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="3d24" class="nn no it nj b gy np nq l nr ns">future = m.make_future_dataframe(periods = 24, freq = ‘M’)<br/>pred = m.predict(future)</span></pre><p id="400b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">如图 5 所示，预测值'<em class="le"> yhat' </em>被分配给具有下限和上限的每个日期。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/b7b753f619fd8614a1633bcc5f6d3df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*9v3EdD21uUOAKg28ckBPTA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 5 预测结果</p></figure><p id="b035" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">如图 6 所示，黑点是历史数据，深蓝线是模型预测。浅蓝色阴影是预测值周围 95%的置信区间。<strong class="lf iu">蓝线显示与图 3 中的模式匹配良好，表明对历史数据的预测良好。😇😇</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/5068a2a65ede49259ee0f72f7502abc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*JEeSjCdwWIEuRIVTJYccGw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 6 预测图</p></figure><p id="a701" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">最后，图 7 显示了✨✨.犯罪率模式的非周期性趋势以及月度和季度季节性成分</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/b848d2df61ad6e01d3acca5752a3a419.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*lkAHXd0nuIdWIs1_0PLHbw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 7 预测模式组件图</p></figure><p id="86ce" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu"> 5。外卖</strong></p><p id="8f3c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我们介绍了如何充分利用脸书先知。具体来说，</p><ul class=""><li id="fddd" class="mc md it lf b lg lh lj lk lz me ma mf mb mg ly mh mi mj mk bi translated">使用 EDA 来探索历史数据模式，帮助创建最合适的模型</li><li id="c0e4" class="mc md it lf b lg ml lj mm lz mn ma mo mb mp ly mh mi mj mk bi translated">使用数据处理为建模准备数据</li><li id="b501" class="mc md it lf b lg ml lj mm lz mn ma mo mb mp ly mh mi mj mk bi translated">利用 Prophet 拟合历史数据，预测未来犯罪率</li></ul><p id="2dfc" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu">如果你觉得这篇文章有帮助，请随意点击👏s！如果想看用 Python 实现的代码，看我的仓库</strong> <a class="ae ky" href="https://github.com/luke4u/Time_Series_Forecasting/tree/main/Forecasting-FB-Prophet" rel="noopener ugc nofollow" target="_blank"> <strong class="lf iu">这里</strong> </a> <strong class="lf iu">。🤞🤞🤞</strong></p><p id="bf15" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu">参考:</strong></p><p id="5127" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">1.<a class="ae ky" href="https://facebook.github.io/prophet/docs/quick_start.html" rel="noopener ugc nofollow" target="_blank">脸书先知官方文件</a></p><p id="5798" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">2.先知论文:Sean J. Taylor，Benjamin Letham (2018)大规模预测。美国统计学家 72(1):37–45(<a class="ae ky" href="https://peerj.com/preprints/3190.pdf" rel="noopener ugc nofollow" target="_blank">https://peerj.com/preprints/3190.pdf</a>)。</p></div></div>    
</body>
</html>