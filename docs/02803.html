<html>
<head>
<title>How to Build an Accounting System using SQLite</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用SQLite构建会计系统</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-an-accounting-system-using-sqlite-2ce31f8b8652?source=collection_archive---------3-----------------------#2020-03-18">https://towardsdatascience.com/how-to-build-an-accounting-system-using-sqlite-2ce31f8b8652?source=collection_archive---------3-----------------------#2020-03-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4502" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">逆向工程Xero教SQL</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/96f7af9ba081102cedb941f0a43f6eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fJ54Hjr906ClzBLu"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kv" href="https://unsplash.com/@scienceinhd?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">科学高清</a>拍摄的照片</p></figure><p id="8f2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">搔自己的痒处。</em> </strong></p><p id="3548" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是每当有人问我如何学习编程时，我总是给出的建议。实际上，这意味着你必须解决与你相关的事情或选择与你相关的项目——无论是在你的工作还是个人生活中。</p><p id="5de8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">盲目地去Youtube上的教程，阅读编程书籍，从Reddit帖子上复制代码等等。如果你开始学习编程，将一事无成。</p><h1 id="6984" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">学习SQL的最好方法</h1><p id="a1dc" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在这篇文章中，我将向您展示如何使用SQLite构建一个简单的会计数据库。</p><blockquote class="mq mr ms"><p id="dcd2" class="kw kx ls ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">那么，为什么要创建一个会计数据库呢？为什么不直接复制公共数据，把它们推到SQLite中，然后从那里开始练习呢？</p></blockquote><p id="8e63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原因是创建一个会计数据库已经足够先进，可以涵盖数据库和SQL的所有方面——从查询到连接到视图和cte。</p><p id="6ccb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为一名会计出身的人，我认为这是学习SQL的最佳项目。毕竟编程是解决问题的工具。因此，不妨“解决”一个难点来全面学习SQL。</p><p id="32fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过观察Xero的工作方式，我获得了使用SQL创建会计系统的灵感。对于不熟悉的人来说，Xero是一款起源于新西兰的云记账软件。它现在已经扩展到澳大利亚、美国、加拿大和英国。</p><p id="d66f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Xero的好处是它有一个漂亮干净的界面和许多可供选择的应用程序来扩展它的功能。</p><p id="9794" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">免责声明:我不是Xero的工程师或开发人员，这些观察可能不完全符合系统的工作方式，因为它总是在更新。当然，这里给出的SQL并不是Xero使用的SQL设计，因为他们的系统需要扩展。但这是一个非常有趣的项目，所以让我们做吧！</em></p><h1 id="347b" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">会计101</h1><p id="3f98" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在你兴奋过度之前，我们先来上一堂会计速成课。</p><p id="8d72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基本的会计等式是</p><p id="0733" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">资产=负债+权益</em> </strong></p><p id="a7cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个等式基本上有三个部分</p><ul class=""><li id="5a7c" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">资产是实体的所有资源。</li><li id="a8cc" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">负债是公司所欠的。</li><li id="984b" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">而股权，是所有所有者的投资、图纸、盈利或亏损的积累。</li></ul><p id="f2c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">右边描述了资产的融资方式——通过负债或权益。</p><p id="5ebe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以扩展上面的等式来分解股权</p><p id="17df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">资产=负债+期初权益+收入—费用</em> </strong></p><p id="6572" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这5个账户——资产、负债、权益、收入和费用——是会计系统中常见的账户类型。</p><p id="da04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后是借贷的概念。我可以继续深入讨论这两个问题，但在这篇文章中，你需要知道的是，在每笔交易中:</p><p id="0492" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">借方=贷方</em> </strong></p><p id="47dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这两个等式通常支配着整个会计周期中发生的事情。这两个等式也将作为创建我们自己的会计数据库的指南。</p><blockquote class="nk"><p id="4941" class="nl nm iq bd nn no np nq nr ns nt lr dk translated">作为一名会计出身的人，我认为这是学习SQL的最佳项目。毕竟编程是解决问题的工具。因此，不妨“解决”一个难点来全面学习SQL。</p></blockquote><h1 id="152c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw nu jx mf jz nv ka mh kc nw kd mj mk bi translated">Xero的会计实现</h1><p id="6887" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">需要记住的重要一点是，Xero的设计是为了让它在企业的日常运营中对企业主(而不是会计)有用。</p><p id="3e59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">因此，它围绕交易周期和内部控制进行设计。</em></p><h2 id="603f" class="nx lu iq bd lv ny nz dn lz oa ob dp md lf oc od mf lj oe of mh ln og oh mj oi bi translated">交易周期</h2><p id="7d76" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">基本交易周期如下</p><ul class=""><li id="2ee4" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">销售周期</li><li id="627f" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">采购周期</li><li id="e8cd" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">资金周转周期</li></ul><p id="9312" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Xero按如下方式实现这些循环</p><p id="2714" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">销售周期<br/> </strong>销售使用发票输入Xero。想象一下企业为销售(现金销售或赊账)开具实际的纸质发票。这正是Xero想要复制的东西。</p><p id="40e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">发票可以直接从软件中打印出来，并按升序自动编号。</p><p id="b755" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">在引擎盖下，发票增加销售账户和应收账款(AR)账户。</em></p><p id="8785" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">采购周期<br/> </strong>票据进入Xero使用票据。再一次，想象企业为购买(现金购买或赊账)出具实际的账单。这是公用事业和库存的通常情况。这也是Xero想要复制的东西。</p><p id="7f4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些账单可以直接从软件中打印出来，并可用于补充企业完成的任何审批程序。</p><p id="8dbb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">在这个引擎盖下，账单增加了采购账户和应付账款(AP)账户。</em></p><p id="725b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">现金周期<br/> </strong>这涉及所有与现金有关的交易。有4种类型</p><ul class=""><li id="5e5e" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated"><strong class="ky ir">发票付款</strong> —未付发票的付款</li><li id="d75e" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir">账单支付</strong> —未支付账单的支付</li><li id="c18d" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir">收到的款项</strong> —不是发票付款的现金收据。这可能涉及现金销售，但如果你要开发票，请使用发票功能。</li><li id="6d16" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir">支出款项</strong> —不属于票据支付的现金支出。这可能涉及现金购买，但如果你要开账单，使用账单功能。</li></ul><p id="4d91" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是关于交易周期的部分。</p><h2 id="9641" class="nx lu iq bd lv ny nz dn lz oa ob dp md lf oc od mf lj oe of mh ln og oh mj oi bi translated">内部控制</h2><p id="1817" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">对于内部控制，你需要了解<strong class="ky ir">系统账</strong>的概念。</p><p id="fbf6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Xero有一篇理解系统账户的综合文章<a class="ae kv" href="https://central.xero.com/s/article/Locked-and-system-accounts-in-your-chart-of-accounts" rel="noopener ugc nofollow" target="_blank">在这里</a>。但出于我们的目的，我们将只讨论以下系统帐户</p><ul class=""><li id="5a6c" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">应收帐款</li><li id="0508" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">应付账款</li><li id="90a6" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">银行账户(链接到银行馈送)</li></ul><p id="eefd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些科目不能用在手动日记帐中。这意味着Xero希望您使用发票、账单和现金交易(发票支付、账单支付、收到的钱和花费的钱)来支持这些账户的余额。如果你愿意，这是Xero内部控制的实施。</p><p id="709e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，您可以通过在会计科目表(COA)中创建AR、AP和银行帐户来使用它们的非系统版本。但是，您不能对它们使用AR、AP和银行帐户类型。</p><blockquote class="nk"><p id="433a" class="nl nm iq bd nn no np nq nr ns nt lr dk translated">需要记住的重要一点是，Xero的设计是为了让它在企业的日常运营中对企业主(而不是会计)有用。</p></blockquote><h1 id="14a7" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw nu jx mf jz nv ka mh kc nw kd mj mk bi translated">警告:我们不会掉进兔子洞</h1><p id="9339" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">设计一个账户是非常复杂的。光是这个话题就需要多篇博文。因此，为了简单起见，我们将创建以下假设(不完全是Xero如何实现这些)</p><ul class=""><li id="9640" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated"><strong class="ky ir">发票和账单支付<br/> </strong>发票支付可以一次性支付两张或多张发票<em class="ls"/>。也就是说，我们不允许部分付款。账单支付也是如此。</li><li id="195b" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir">库存<br/> </strong>我们不打算在这里使用库存项目。对于销售或采购，我们将直接使用库存帐户，而不是创建映射到库存帐户的库存项目。</li></ul><p id="4aea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的假设就是这样。设计完我们的数据库后，读者可以解除这些假设，尽可能多地模仿Xero。</p><h1 id="925d" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">SQL基础知识</h1><p id="3efa" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">现在，在重建我们版本的Xero数据库结构之前，让我们先来上一堂数据库速成课。</p><p id="32ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">数据库是表的集合。</strong>每个表都由称为<strong class="ky ir">记录</strong>的数据行组成。这些列被称为<strong class="ky ir">字段</strong>。</p><p id="bbdc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">处理数据库的程序被称为数据库管理系统或DBMS。打个简单的比方，DBMS之于Excel程序，数据库之于Excel工作簿，表格之于Excel工作表。</p><p id="35ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据库和Excel工作簿有两个主要区别。</p><h2 id="b426" class="nx lu iq bd lv ny nz dn lz oa ob dp md lf oc od mf lj oe of mh ln og oh mj oi bi translated">数据表示与数据存储是分开的。</h2><p id="5773" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">也就是说，您不能通过直接查看数据并对其进行编辑来编辑数据库中的数据。(其他DBMS程序有GUI，允许您直接访问数据库中的数据，并像编辑电子表格一样编辑它。但是在幕后，该操作发出一个SQL命令)。</p><h2 id="d410" class="nx lu iq bd lv ny nz dn lz oa ob dp md lf oc od mf lj oe of mh ln og oh mj oi bi translated">表通常相互链接以形成关系。</h2><p id="f7ff" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">关系可以是一对一、一对多或多对多。</p><p id="7fdc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">一对一</strong>关系意味着“一个表中的一行只与另一个表中的一行相关，反之亦然”。一个例子是雇员姓名到纳税标识号。</p><p id="c73c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种类型通常包含在单个表Employees中，因为将数据分成两个表并没有什么好处。</p><p id="e692" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">一对多</strong>表示“一个表格中的一行只与另一个表格中的一行或多行相关，而不是相反”。一个例子是发票到发票行。一张发票可以有多个行，但一个发票行只属于一张特定的发票。</p><p id="38bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可能已经猜到了，<strong class="ky ir">多对多</strong>意味着“一个表行只与另一个表中的一行或多行相关，反之亦然”。实现部分支付的系统就是一个例子。</p><p id="2221" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一张发票可以通过不同的付款交易来部分支付，并且一次付款可以部分支付不同的发票。</p><p id="f5fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">数据库如何知道这些关系？<br/> </strong>很简单。它是通过使用主键和外键实现的。</p><p id="c5fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">主键</strong>是区分不同行所必需的。它们唯一地标识表中的每一行数据。</p><p id="457f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">另一方面，外键</strong>是另一个表的主键。因此，通过关联主键和外键，数据库关系得以保持。</p><p id="7ead" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">对于一对多,“一”方包含主键,“多”方包含该主键作为其外键。</em>在上面的例子中，为了获得属于一张发票的所有行，我们查询InvoiceLines表，其中外键等于特定的发票号。</p><p id="a37a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">对于多对多，通过使用称为“联接”表的第三个表，关系被分解为两个一对多关系。</em>例如，我们的部分付款系统将发票表、付款表和InvoicePayments表作为连接表。InvoicePayments表的主键将是一个组合键，由Invoices和Payments表的主键组成，如下所示</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/7c1963b7fa68f88131987a65f8229fc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*LOwAdJWded4RVAmAaqkhag.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于实施部分发票付款的表</p></figure><p id="0d2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，连接表不包含任何其他数据，因为除了连接发票和付款表之外，它没有任何其他用途。</p><p id="8ad9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了获得某个支付交易支付的发票，比如说<code class="fe ok ol om on b">PAY 1</code>，我们通过连接表连接发票和支付表，并查询<code class="fe ok ol om on b">payment_id = “PAY 1”</code>。</p><p id="a614" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是数据库的基础知识。我们现在准备设计我们的数据库。</p><blockquote class="nk"><p id="01a2" class="nl nm iq bd nn no np nq nr ns nt lr dk translated">打个简单的比方，DBMS之于Excel程序，数据库之于Excel工作簿，表格之于Excel工作表。</p></blockquote><h1 id="dcc1" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw nu jx mf jz nv ka mh kc nw kd mj mk bi translated">设计我们的Xero实现</h1><p id="8b86" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">现在我们对Xero有了基本的了解，可以开始创建它的数据库结构的草图了。请注意，我将使用<code class="fe ok ol om on b">Table_Name</code>格式。这是由下划线分隔的首字母大写单词。我还将对表名使用复数名称。</p><p id="f34a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于销售周期，我们将有以下表格</p><ul class=""><li id="4398" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated"><strong class="ky ir">发票</strong></li><li id="2a05" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir">客户</strong> —一个客户可以有多张发票，但一张发票不能属于多个客户</li><li id="22eb" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir"> Invoice_Payments </strong> —记住我们现在的假设，Invoice_Payments和Invoices分别是一对多的关系(没有部分付款)</li><li id="59f5" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir"> Invoice_Lines </strong> —这是发票和COA之间的连接表。一个账户可以出现在多张发票中，一张发票可以有多个账户。</li><li id="000a" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir">会计科目表(COA) </strong></li></ul><p id="28d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于购买周期，我们将有以下表格</p><ul class=""><li id="c9d3" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated"><strong class="ky ir">票据</strong></li><li id="8839" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir">供应商</strong> —一个供应商可以有多个票据，但是一个票据不能属于多个供应商</li><li id="c28b" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir"> Bill_Payments </strong> —记住我们现在的假设，Bill_Payments和Bill之间分别是一对多的关系</li><li id="a14f" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir"> Bill_Lines </strong> —这是票据和COA的连接表。一个账户可以出现在多张票据中，一张票据可以有多个账户。</li><li id="f3bf" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir"> COA </strong> —与销售周期中的上述内容相同。这里只是为了完整性。</li></ul><p id="8d66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于现金周期，我们将有下面的表(我们已经在上面创建的付款表)</p><ul class=""><li id="ac52" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated"><strong class="ky ir">Received _ money</strong>——可能有一个可选客户</li><li id="c290" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir"> Received_Money_Lines </strong> —这是Received_Money和COA之间的连接表</li><li id="4fcb" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir">spend _ money</strong>—可能有一个可选的供应商</li><li id="8e53" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir">支出款项行</strong> —这是支出款项和COA之间的连接表</li></ul><p id="25da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从概念上讲，我们的数据库结构如下</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/45a09948406408a2aed677edd0ce171c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*_WEnZES83vnu2cJ8bS8wng.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">会计数据库模型</p></figure><p id="4679" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个图用数据库的说法叫做<strong class="ky ir">实体关系图</strong>或者<strong class="ky ir"> ERD </strong>。一对多关系由<em class="ls">1-M</em>指定，多对多关系由<em class="ls">M-M</em>指定。</p><p id="c9f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上图中没有显示连接表，因为它们隐含在具有多对多关系的表中。</p><h1 id="66c2" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">用SQL实现我们的版本</h1><p id="7eb5" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">现在是时候用SQL实现我们的模型了。我们先从定义一些约定开始。</p><p id="a941" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">主键的字段/列名为<code class="fe ok ol om on b">id</code>，外键的格式为<code class="fe ok ol om on b">table_id</code>，其中<code class="fe ok ol om on b">table</code>是单数形式的“多”方的表名。例如，在发票表中，外键将是<code class="fe ok ol om on b">customer_id</code>。</p><p id="ebc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SQL代码的时间到了。在这里。</p><pre class="kg kh ki kj gt op on oq or aw os bi"><span id="6393" class="nx lu iq on b gy ot ou l ov ow">DROP TABLE IF EXISTS `COA`;</span><span id="c3f8" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `COA` (<br/>    id INTEGER PRIMARY KEY,<br/>    name TEXT<br/>);</span><span id="f017" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Customers`;</span><span id="985a" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Customers` (<br/>    id INTEGER PRIMARY KEY,<br/>    name TEXT NOT NULL,<br/>    contact_person TEXT,<br/>    email TEXT,<br/>    phone TEXT,<br/>    fax TEXT,<br/>    address TEXT<br/>);</span><span id="9ae6" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Invoice_Payments`;</span><span id="ab56" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Invoice_Payments` (<br/>    id INTEGER PRIMARY KEY,<br/>    tran_date DATE NOT NULL,<br/>    description TEXT,<br/>    reference TEXT,<br/>    total DECIMAL(20,2) NOT NULL,<br/>    coa_id INTEGER NOT NULL, -- automatically Bank<br/>    FOREIGN KEY(`coa_id`) REFERENCES `COA`(`id`)<br/>);</span><span id="2cb8" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Invoices`;</span><span id="f118" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Invoices` (<br/>    id INTEGER PRIMARY KEY,<br/>    tran_date DATE NOT NULL,<br/>    due_date DATE,<br/>    description TEXT,<br/>    reference TEXT,<br/>    total DECIMAL(10,2) NOT NULL,<br/>    status BOOLEAN,<br/>    customer_id INTEGER,<br/>    invoice_payment_id INTEGER,<br/>    coa_id INTEGER NOT NULL, -- automatically AR<br/>    FOREIGN KEY(`customer_id`) REFERENCES `Customers`(`id`),<br/>    FOREIGN KEY(`invoice_payment_id`) REFERENCES `Invoice_Payments`(`id`),<br/>    FOREIGN KEY(`coa_id`) REFERENCES `COA`(`id`)<br/>);</span><span id="1072" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Received_Moneys`;</span><span id="cd6a" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Received_Moneys` (<br/>    id INTEGER PRIMARY KEY,<br/>    tran_date DATE NOT NULL,<br/>    description TEXT,<br/>    reference TEXT,<br/>    total DECIMAL(20,2) NOT NULL,<br/>    customer_id INTEGER,<br/>    coa_id INTEGER NOT NULL, -- automatically Bank<br/>    FOREIGN KEY(`customer_id`) REFERENCES `Customers`(`id`),<br/>    FOREIGN KEY(`coa_id`) REFERENCES `COA`(`id`)<br/>);</span><span id="39bb" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Invoice_Lines`;</span><span id="b214" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Invoice_Lines` (<br/>    id INTEGER PRIMARY KEY,<br/>    line_amount DECIMAL(20,2) NOT NULL,<br/>    invoice_id INTEGER,<br/>    line_coa_id INTEGER NOT NULL,<br/>    FOREIGN KEY(`invoice_id`) REFERENCES `Invoices`(`id`),<br/>    FOREIGN KEY(`line_coa_id`) REFERENCES `COA`(`id`)<br/>);</span><span id="3581" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Received_Money_Lines`;</span><span id="ff5f" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Received_Money_Lines` (<br/>    id INTEGER PRIMARY KEY,<br/>    line_amount DECIMAL(20,2) NOT NULL,<br/>    received_money_id INTEGER,<br/>    line_coa_id INTEGER NOT NULL,<br/>    FOREIGN KEY(`received_money_id`) REFERENCES `Received_Moneys`(`id`),<br/>    FOREIGN KEY(`line_coa_id`) REFERENCES `COA`(`id`)<br/>);</span><span id="7610" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Suppliers`;</span><span id="2d5c" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Suppliers` (<br/>    id INTEGER PRIMARY KEY,<br/>    name TEXT NOT NULL,<br/>    contact_person TEXT,<br/>    email TEXT,<br/>    phone TEXT,<br/>    fax TEXT,<br/>    address TEXT<br/>);</span><span id="e149" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Bill_Payments`;</span><span id="0c8c" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Bill_Payments` (<br/>    id INTEGER PRIMARY KEY,<br/>    tran_date DATE NOT NULL,<br/>    description TEXT,<br/>    reference TEXT,<br/>    total DECIMAL(20,2) NOT NULL,<br/>    coa_id INTEGER NOT NULL, -- automatically Bank<br/>    FOREIGN KEY(`coa_id`) REFERENCES `COA`(`id`)<br/>);</span><span id="7ae7" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Bills`;</span><span id="e27a" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Bills` (<br/>    id INTEGER PRIMARY KEY,<br/>    tran_date DATE NOT NULL,<br/>    due_date DATE,<br/>    description TEXT,<br/>    reference TEXT,<br/>    total DECIMAL(10,2) NOT NULL,<br/>    status BOOLEAN,<br/>    supplier_id INTEGER,<br/>    bill_payment_id INTEGER,<br/>    coa_id INTEGER NOT NULL, -- automatically AP<br/>    FOREIGN KEY(`supplier_id`) REFERENCES `Suppliers`(`id`),<br/>    FOREIGN KEY(`bill_payment_id`) REFERENCES `Bill_Payments`(`id`),<br/>    FOREIGN KEY(`coa_id`) REFERENCES `COA`(`id`)<br/>);</span><span id="9220" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Spent_Moneys`;</span><span id="76ce" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Spent_Moneys` (<br/>    id INTEGER PRIMARY KEY,<br/>    tran_date DATE NOT NULL,<br/>    description TEXT,<br/>    reference TEXT,<br/>    total DECIMAL(20,2) NOT NULL,<br/>    supplier_id INTEGER,<br/>    coa_id INTEGER NOT NULL, -- automatically Bank<br/>    FOREIGN KEY(`supplier_id`) REFERENCES `Suppliers`(`id`),<br/>    FOREIGN KEY(`coa_id`) REFERENCES `COA`(`id`)<br/>);</span><span id="fba4" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Bill_Lines`;</span><span id="0f1f" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Bill_Lines` (<br/>    id INTEGER PRIMARY KEY,<br/>    line_amount DECIMAL(20,2) NOT NULL,<br/>    bill_id INTEGER,<br/>    line_coa_id INTEGER NOT NULL,<br/>    FOREIGN KEY(`bill_id`) REFERENCES `Bills`(`id`),<br/>    FOREIGN KEY(`line_coa_id`) REFERENCES `COA`(`id`)<br/>);</span><span id="dfbc" class="nx lu iq on b gy ox ou l ov ow">DROP TABLE IF EXISTS `Spent_Money_Lines`;</span><span id="356c" class="nx lu iq on b gy ox ou l ov ow">CREATE TABLE IF NOT EXISTS `Spent_Money_Lines` (<br/>    id INTEGER PRIMARY KEY,<br/>    line_amount DECIMAL(20,2) NOT NULL,<br/>    spent_money_id INTEGER,<br/>    line_coa_id INTEGER NOT NULL,<br/>    FOREIGN KEY(`spent_money_id`) REFERENCES `Spent_Moneys`(`id`),<br/>    FOREIGN KEY(`line_coa_id`) REFERENCES `COA`(`id`)<br/>);</span></pre><p id="d8b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里有几件事:</p><ul class=""><li id="2e03" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">SQL命令不区分大小写，<code class="fe ok ol om on b">CREATE TABLE</code>与<code class="fe ok ol om on b">create table</code>相同</li><li id="5562" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><code class="fe ok ol om on b">IF EXISTS</code>和<code class="fe ok ol om on b">IF NOT EXISTS</code>是可选的。我只是用它们来防止我的SQL命令中的错误。例如，如果我删除一个不存在的表，SQLite会给出一个错误。此外，我将<code class="fe ok ol om on b">IF NOT EXISTS</code>放在create table命令上，这样我们就不会意外地覆盖任何现有的表。</li><li id="9503" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">小心使用<code class="fe ok ol om on b">DROP TABLE</code>命令！它将删除一个现有的表，而不发出警告，即使它有内容。</li><li id="61b2" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">表名也可以全部大写或不大写。如果表名有空格，应该用反斜杠(`)括起来。它们不区分大小写。<code class="fe ok ol om on b">SELECT * FROM Customers</code>与<code class="fe ok ol om on b">select * from customers.</code>相同</li></ul><p id="c3b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管SQL在语法方面有些宽松，但是您应该努力保持SQL代码一致性。</p><p id="0c59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还要注意上面ERD中显示的关系。还要记住，外键位于多侧。</p><p id="4b03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">顺序很重要，因为由于外键的存在，一些表会成为另一个表的依赖项。例如，您必须先在发票表之前创建first Invoice_Payments，因为前者是后者的依赖项。这里的技巧是从ERD的边缘开始，因为这些边缘具有最少的外键。</p><p id="2688" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您还可以下载一个SQLite中的示例数据库，这个<a class="ae kv" href="https://github.com/kennethjhim/medium_acctg_database_design/blob/master/db_blank.db" rel="noopener ugc nofollow" target="_blank">链接</a>中没有任何内容。</p><p id="588b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要查看它，您可以使用免费的开源SQLite浏览器。在这里下载<a class="ae kv" href="https://sqlitebrowser.org/" rel="noopener ugc nofollow" target="_blank"/>！</p><h1 id="a7c0" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">向我们的数据库添加内容</h1><p id="5c3f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">现在我们有了示例数据库，让我们向它输入数据。样本数据可以从<a class="ae kv" href="https://github.com/kennethjhim/medium_acctg_database_design/blob/master/new_data-services.xlsx" rel="noopener ugc nofollow" target="_blank">这里</a>下载——只需根据需要将其分解为CSV。</p><p id="6dbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，学分显示为正数，学分显示为负数。</p><p id="59e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这篇文章，我只是使用了DB Browser的导入功能从上面的Excel文件中导入CSV。例如，导入<em class="ls"> Customers.csv </em></p><ul class=""><li id="cd03" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">选择“客户”表</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/85eb036e1d61675334837288d916ebee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*NRQK6rIsrLfpgiqC5tF6lQ.png"/></div></figure><ul class=""><li id="2928" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">转到文件&gt;导入&gt; CSV文件中的表格，并选择<em class="ls">客户. csv </em></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/e6e4a79a62a6cb5de188ffbbd94dc6c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*adHf3YOKuJDGvtD85_SnDg.png"/></div></div></figure><ul class=""><li id="6dab" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">对于所有后续提示，单击“确定/是”以导入数据。</li></ul><p id="4d5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您发出下面的SQL命令，它应该显示我们数据库中的所有客户</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/fa66d391e67bed97e0796e80ea6d646c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qZSmj4k1pmk-wFbFFGfKlA.png"/></div></div></figure><h1 id="a132" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">从我们的数据库创建财务报告</h1><p id="2e47" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">为了证明我们的数据库作为一个粗略的会计系统工作，让我们创建试算平衡表。</p><p id="406b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一步是为我们的发票、账单、Received _ Moneys和Spent _ Moneys事务创建事务视图。代码将如下所示</p><pre class="kg kh ki kj gt op on oq or aw os bi"><span id="c388" class="nx lu iq on b gy ot ou l ov ow">DROP VIEW IF EXISTS Invoice_Trans;</span><span id="229c" class="nx lu iq on b gy ox ou l ov ow">CREATE VIEW IF NOT EXISTS Invoice_Trans AS</span><span id="11fb" class="nx lu iq on b gy ox ou l ov ow">with recursive</span><span id="b4cf" class="nx lu iq on b gy ox ou l ov ow">itrans as (SELECT<br/>    'INV'||i.id as `tran_id`,<br/>    i.tran_date,<br/>    i.coa_id as ar_account,<br/>    -- ABS(total) as `total`,<br/>    'Accounts Receivable' as `coa_name`,<br/>    i.total,<br/>    il.id  as `line_id`,<br/>    il.line_coa_id,<br/>    il.line_amount,<br/>    ip.id,<br/>    ip.coa_id as bank_account,<br/>    'Business Bank Account' as `bank_name`,<br/>    i.status<br/>from Invoices as i<br/>left join Invoice_Lines as il on i.id = il.invoice_id<br/>left join COA as c on i.coa_id = c.id<br/>left join Invoice_Payments as ip on i.invoice_payment_id = ip.id<br/>)</span><span id="24b0" class="nx lu iq on b gy ox ou l ov ow">select<br/>itrans.*,<br/>c.name as `line_coa_name`<br/>from itrans<br/>left join COA as c on itrans.line_coa_id = c.id;</span><span id="56ff" class="nx lu iq on b gy ox ou l ov ow">SELECT * from Invoice_Trans;</span><span id="e433" class="nx lu iq on b gy ox ou l ov ow">********************************************************************</span><span id="0ef6" class="nx lu iq on b gy ox ou l ov ow">DROP VIEW IF EXISTS Bill_Trans;</span><span id="91be" class="nx lu iq on b gy ox ou l ov ow">CREATE VIEW IF NOT EXISTS Bill_Trans AS</span><span id="300a" class="nx lu iq on b gy ox ou l ov ow">with recursive</span><span id="d361" class="nx lu iq on b gy ox ou l ov ow">btrans as (SELECT<br/>    'BILL'||b.id as `tran_id`,<br/>    b.tran_date,<br/>    b.coa_id as ap_account,<br/>    -- ABS(total) as `total`,<br/>    'Accounts Payable' as `coa_name`,<br/>    b.total,<br/>    bl.id  as `line_id`,<br/>    bl.line_coa_id,<br/>    bl.line_amount,<br/>    bp.id,<br/>    bp.coa_id as bank_account,<br/>    'Business Bank Account' as `bank_name`,<br/>    b.status<br/>from Bills as b<br/>left join Bill_Lines as bl on b.id = bl.bill_id<br/>left join COA as c on b.coa_id = c.id<br/>left join Bill_Payments as bp on b.bill_payment_id = bp.id<br/>)</span><span id="77d8" class="nx lu iq on b gy ox ou l ov ow">select<br/>btrans.*,<br/>c.name as `line_coa_name`<br/>from btrans<br/>left join COA as c on btrans.line_coa_id = c.id;</span><span id="d23d" class="nx lu iq on b gy ox ou l ov ow">SELECT * from Bill_Trans;</span><span id="ae63" class="nx lu iq on b gy ox ou l ov ow">********************************************************************</span><span id="dc36" class="nx lu iq on b gy ox ou l ov ow">DROP VIEW IF EXISTS Received_Money_Trans;</span><span id="b5be" class="nx lu iq on b gy ox ou l ov ow">CREATE VIEW IF NOT EXISTS Received_Money_Trans AS<br/>SELECT<br/>    'RM'||rm.id as `tran_id`,<br/>    tran_date,<br/>    coa_id,<br/>    'Business Bank Account' as `coa_name`,<br/>    total,<br/>    rml.id  as `line_id`,<br/>    rml.line_coa_id,<br/>    c.name as `line_coa_name`,<br/>    rml.line_amount<br/>from Received_Moneys as rm<br/>left join Received_Money_Lines as rml on rm.id = rml.received_money_id<br/>left join COA  as c on c.id = rml.line_coa_id;</span><span id="52fe" class="nx lu iq on b gy ox ou l ov ow">SELECT * from Received_Money_Trans;</span><span id="9606" class="nx lu iq on b gy ox ou l ov ow">********************************************************************</span><span id="62c4" class="nx lu iq on b gy ox ou l ov ow">DROP VIEW IF EXISTS Spent_Money_Trans;</span><span id="b229" class="nx lu iq on b gy ox ou l ov ow">CREATE VIEW IF NOT EXISTS Spent_Money_Trans AS<br/>SELECT<br/>    'SM'||sm.id as `tran_id`,<br/>    tran_date,<br/>    coa_id,<br/>    'Business Bank Account' as `coa_name`,<br/>    total,<br/>    sml.id  as `line_id`,<br/>    sml.line_coa_id,<br/>    c.name as `line_coa_name`,<br/>    sml.line_amount<br/>from Spent_Moneys as sm<br/>left join Spent_Money_Lines as sml on sm.id = sml.spent_money_id<br/>left join COA  as c on c.id = sml.line_coa_id;</span><span id="6ac9" class="nx lu iq on b gy ox ou l ov ow">SELECT * from Spent_Money_Trans;</span></pre><p id="0c96" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在前两条语句中，我使用了CTE(带有关键字<code class="fe ok ol om on b">recursive</code>)。cte很有用，因为我将4个表组合在一起，以获得发票交易和相应付款的单一视图。你可以在SQLite <a class="ae kv" href="https://sqlite.org/lang_with.html" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多关于CTEs的内容。</p><p id="2953" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">执行上述命令后，您的数据库应该有以下4个视图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/6392d502d8edfe4925afc1333e306731.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*4pQSmZ12gjlXPgsfB3340Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">交易视图</p></figure><p id="843d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们创建试算平衡表(简称TB)的代码。请注意，TB只是我们的交易余额的集合，记录了我们在设计数据库时制定的规则。</p><p id="d68d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码如下所示</p><pre class="kg kh ki kj gt op on oq or aw os bi"><span id="8d20" class="nx lu iq on b gy ot ou l ov ow">DROP VIEW IF EXISTS Trial_Balance;<br/>CREATE VIEW IF NOT EXISTS Trial_Balance as<br/>-- CREATE TB<br/>-- select all sales<br/>select<br/>    line_coa_id as acct_code,<br/>    line_coa_name as acct_name,<br/>    (case when sum(line_amount) &gt; 0 then sum(line_amount) else 0 end) as debit_bal,<br/>    (case when sum(line_amount) &lt; 0 then sum(line_amount) else 0 end) as credit_bal<br/>from Invoice_Trans<br/>group by line_coa_id</span><span id="118d" class="nx lu iq on b gy ox ou l ov ow">-- select all purchases<br/>union all</span><span id="b8ac" class="nx lu iq on b gy ox ou l ov ow">select<br/>    line_coa_id as acct_code,<br/>    line_coa_name as acct_name,<br/>    (case when sum(line_amount) &gt; 0 then sum(line_amount) else 0 end) as debit_bal,<br/>    (case when sum(line_amount) &lt; 0 then sum(line_amount) else 0 end) as credit_bal<br/>from Bill_Trans<br/>group by line_coa_id</span><span id="0e4c" class="nx lu iq on b gy ox ou l ov ow">-- select all received money<br/>union all</span><span id="b098" class="nx lu iq on b gy ox ou l ov ow">select<br/>    line_coa_id as acct_code,<br/>    line_coa_name as acct_name,<br/>    (case when sum(line_amount) &gt; 0 then sum(line_amount) else 0 end) as debit_bal,<br/>    (case when sum(line_amount) &lt; 0 then sum(line_amount) else 0 end) as credit_bal<br/>from Received_Money_Trans<br/>group by line_coa_id</span><span id="520f" class="nx lu iq on b gy ox ou l ov ow">-- select all spent money<br/>union all</span><span id="cbcf" class="nx lu iq on b gy ox ou l ov ow">select<br/>    line_coa_id as acct_code,<br/>    line_coa_name as acct_name,<br/>    (case when sum(line_amount) &gt; 0 then sum(line_amount) else 0 end) as debit_bal,<br/>    (case when sum(line_amount) &lt; 0 then sum(line_amount) else 0 end) as credit_bal<br/>from Spent_Money_Trans<br/>group by line_coa_id</span><span id="440e" class="nx lu iq on b gy ox ou l ov ow">-- select all AP<br/>union all</span><span id="811c" class="nx lu iq on b gy ox ou l ov ow">select<br/>    ap_account as acct_code,<br/>    coa_name as acct_name,<br/>    -(case when sum(line_amount) &lt; 0 then sum(line_amount) else 0 end) as debit_bal,<br/>    -(case when sum(line_amount) &gt; 0 then sum(line_amount) else 0 end) as credit_bal<br/>from Bill_Trans<br/>where status = "0"</span><span id="c3cd" class="nx lu iq on b gy ox ou l ov ow">-- select all AR<br/>union all</span><span id="6606" class="nx lu iq on b gy ox ou l ov ow">select<br/>    ar_account as acct_code,<br/>    coa_name as acct_name,<br/>    -(case when sum(line_amount) &lt; 0 then sum(line_amount) else 0 end) as debit_bal,<br/>    -(case when sum(line_amount) &gt; 0 then sum(line_amount) else 0 end) as credit_bal<br/>from Invoice_Trans<br/>where status = "0"</span><span id="1235" class="nx lu iq on b gy ox ou l ov ow">-- select all bill_payments<br/>union all</span><span id="3267" class="nx lu iq on b gy ox ou l ov ow">select<br/>    bank_account as acct_code,<br/>    bank_name as acct_name,<br/>    -(case when sum(line_amount) &lt; 0 then sum(line_amount) else 0 end) as debit_bal,<br/>    -(case when sum(line_amount) &gt; 0 then sum(line_amount) else 0 end) as credit_bal<br/>from Bill_Trans<br/>where status = "1"</span><span id="c447" class="nx lu iq on b gy ox ou l ov ow">-- select all invoice_payments<br/>union all</span><span id="10de" class="nx lu iq on b gy ox ou l ov ow">select<br/>    bank_account as acct_code,<br/>    bank_name as acct_name,<br/>    -(case when sum(line_amount) &lt; 0 then sum(line_amount) else 0 end) as debit_bal,<br/>    -(case when sum(line_amount) &gt; 0 then sum(line_amount) else 0 end) as credit_bal<br/>from Invoice_Trans<br/>where status = "1"</span><span id="23d5" class="nx lu iq on b gy ox ou l ov ow">-- select all received_money<br/>union all</span><span id="1c99" class="nx lu iq on b gy ox ou l ov ow">select<br/>    coa_id as acct_code,<br/>    coa_name as acct_name,<br/>    -(case when sum(line_amount) &lt; 0 then sum(line_amount) else 0 end) as debit_bal,<br/>    -(case when sum(line_amount) &gt; 0 then sum(line_amount) else 0 end) as credit_bal<br/>from Received_Money_Trans</span><span id="c861" class="nx lu iq on b gy ox ou l ov ow">-- select all spent_money<br/>union all</span><span id="8055" class="nx lu iq on b gy ox ou l ov ow">select<br/>    coa_id as acct_code,<br/>    coa_name as acct_name,<br/>    -(case when sum(line_amount) &lt; 0 then sum(line_amount) else 0 end) as debit_bal,<br/>    -(case when sum(line_amount) &gt; 0 then sum(line_amount) else 0 end) as credit_bal<br/>from Spent_Money_Trans</span><span id="cb2e" class="nx lu iq on b gy ox ou l ov ow">order by acct_code</span></pre><p id="7f6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码包含由命令<code class="fe ok ol om on b">union all</code>连接的多个SQL查询。我已经对每个查询进行了注释，以显示每个查询试图实现的目标。</p><p id="9616" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，第一个查询试图获取发票交易的所有信用(主要是销售额)。第二个用于账单交易(主要是购买)的借项等等。</p><p id="600a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">执行它应该会产生下面的TB。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/fe6cb65107f5ddbd09cb50eb84d903d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*9P9g8lMI766cV8QE-S5-Dw.png"/></div></figure><p id="a999" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以把它放入Excel来检查借贷是否相等(我就是这么做的)。借项和贷项合计分别为14115和-14115。</p><h1 id="bd72" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">万岁！你成功了</h1><p id="7a50" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">创建一个会计系统是非常复杂的。我们基本上探索了数据库设计的整个领域——从概念到ERD到创建再到查询。为自己走到这一步感到自豪。</p><p id="ec66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，我们故意限制了我们的数据库，以便更多地关注概念。你可以解除这些，并尝试建立另一个没有限制。</p><p id="afe8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！你现在是SQL忍者了！恭喜你！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/0734997ba694f800d17d820c0bbba00f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i02CPy3xaWt3hHqq"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Ian Stauffer 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="be89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">查看我的第二本书</em> </strong> <a class="ae kv" href="https://leanpub.com/accountingdatabasedesign" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ls">会计数据库设计</em> </strong> </a> <strong class="ky ir"> <em class="ls">即将在Leanpub上出版！</em> </strong></p><p id="6e07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">还我第一本书</em> </strong> <a class="ae kv" href="https://leanpub.com/powerqueryguidetopandas" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ls"> PowerQuery熊猫指南</em> </strong> </a> <strong class="ky ir"> <em class="ls">上</em></strong><a class="ae kv" href="https://leanpub.com/powerqueryguidetopandas" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">Leanpub</em></strong></a><strong class="ky ir"><em class="ls">。</em> </strong></p><p id="3f29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">跟我上</em></strong><a class="ae kv" href="https://twitter.com/iamkennethcpa" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">Twitter</em></strong></a><strong class="ky ir"><em class="ls">和</em></strong><a class="ae kv" href="https://www.linkedin.com/in/kennethinfante/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">Linkedin</em></strong></a><strong class="ky ir"><em class="ls">。</em>T47】</strong></p></div></div>    
</body>
</html>