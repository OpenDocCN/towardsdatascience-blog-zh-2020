<html>
<head>
<title>Parse TradingView Stock Recommendations in Seconds!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">几秒钟内解析 TradingView 股票推荐！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/parse-tradingview-stock-recommendations-in-seconds-1f4501303b21?source=collection_archive---------20-----------------------#2020-08-31">https://towardsdatascience.com/parse-tradingview-stock-recommendations-in-seconds-1f4501303b21?source=collection_archive---------20-----------------------#2020-08-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cfe9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用 Python 解析任意时间间隔的实时建议！</h2></div><p id="14f3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我之前的一篇文章中，我们讨论了如何解析来自雅虎财经的顶级分析师对任何股票的建议。虽然他们提供了股票未来走势的验证，但他们每月只更新一次，并且没有提供任何关于评级背后的理由的信息。</p><p id="e931" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">幸运的是，从那以后，我偶然发现了一个很棒的网站<a class="ae le" href="http://tradingview.com/" rel="noopener ugc nofollow" target="_blank"> TradingView </a>。如果你不熟悉这个网站，他们提供的一个功能是短至 1 分钟或长达 1 个月的实时推荐。这些建议纯粹基于技术指标，包括移动平均线、振荡指标和枢轴，你可以直接在页面上看到计算结果！</p><p id="61d4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我没有每次需要推荐时都访问网站，而是用不到 50 行代码创建了这个简单的解析器。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/a0fadbd7a916bad79a6bf9eb61be1fdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7s0V3E8weget4WrTBZPqmA.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@nick604?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">尼克冲</a>在<a class="ae le" href="https://unsplash.com/s/photos/stock-market?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="a5e9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">TradingView 简介</h1><p id="35ea" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">在我进入编码方面之前，我想快速介绍一下 TradingView 上的这些推荐内容和位置。如果你转到这个<a class="ae le" href="https://www.tradingview.com/symbols/NASDAQ-AAPL/technicals/" rel="noopener ugc nofollow" target="_blank">页面</a>，你会看到一些类似于我下面的图片。该页面包括关键统计数据，如市盈率、每股收益、市值、股息信息等。你甚至可以点击概览来获得一个全面的比率表，以及一个交互式图表和最近的新闻。然而，这不是建议的位置。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ms"><img src="../Images/c413b92affe1ba609eacb77e64e3d70f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AAcGqj2t61OQX4OzAfp7Rw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">苹果交易视图页面顶部</p></figure><p id="625e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你继续向下滚动技术面页面，会有多个图表，如下图所示，列出了信号背后的建议和统计数据。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mt"><img src="../Images/a31f8ad3eeda9aa357d15be760b49ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HXTQXfmMSi4of1GIhA5ODw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">TradingView 推荐图表(我们将收集的内容)</p></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mu"><img src="../Images/d438eb7a12b618c8856f49542b91d732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DT8866jimJBLwdfmp1nWhQ.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">交易视图技术指标统计</p></figure><p id="4e7b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">建议范围从强买到强卖，正如你在第二张图中看到的，它们完全依赖于技术指标信号。我们将建立的算法将很快分析买入信号、中性信号、卖出信号的数量，以及总体建议。下面的 GitHub gist 包含了所有的代码！</p><h1 id="cfb0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用 Python 抓取 TradingView</h1><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mv mw l"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">解析算法的所有代码。</p></figure><h2 id="d888" class="mx lw it bd lx my mz dn mb na nb dp mf kr nc nd mh kv ne nf mj kz ng nh ml ni bi translated">设置</h2><p id="1936" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">如果您没有安装<a class="ae le" href="https://pypi.org/project/selenium/" rel="noopener ugc nofollow" target="_blank"> Selenium </a>或<a class="ae le" href="https://pypi.org/project/pandas/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>，您可以访问它们各自的链接，并使用终端中的 pip 下载它们！我们还需要一个 chromedriver(模拟的 chrome 浏览器 Selenium 控件),要使用 Python 下载它，你可以使用 PyPi 中的<a class="ae le" href="https://pypi.org/project/webdriver-manager/" rel="noopener ugc nofollow" target="_blank"> webdriver-manager </a>包。</p><p id="09f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，只要安装了必要的依赖项，就可以使用任何支持 Python 的 IDE 或文本编辑器。我个人会推荐通过<a class="ae le" href="https://www.anaconda.com/" rel="noopener ugc nofollow" target="_blank"> Anaconda </a>下载 Visual Studio 代码或者 Spyder。</p><h2 id="f939" class="mx lw it bd lx my mz dn mb na nb dp mf kr nc nd mh kv ne nf mj kz ng nh ml ni bi translated">让我们进入代码</h2><p id="b710" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">现在所有的东西都应该已经安装在你的机器上了，你也知道我们要抓取什么了，让我们开始写代码吧！</p><p id="046d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们必须导入程序其余部分所需的依赖项。在这种情况下，我们将需要内置的时间模块、Pandas 和 Selenium。</p><p id="2e62" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">时间模块将允许我们让程序休眠几秒钟，以便模拟的浏览器可以完全加载。熊猫将允许我们用我们收集的数据创建一个数据框架。最后，我们将需要 selenium，这样我们就可以创建/控制浏览器窗口并抓取 JavaScript 呈现的信息。</p><p id="a514" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们可以创建两个变量，一个用于 ticker，另一个用于我们特别抓取的区间。间隔可以是我在下面代码栏中包含的任何一个。</p><pre class="lg lh li lj gt nj nk nl nm aw nn bi"><span id="d1ff" class="mx lw it nk b gy no np l nq nr">#===================================================================<br/># Intervals: <br/># 1m for 1 minute<br/># 15m for 15 minutes<br/># 1h for 1 hour<br/># 4h for 4 hours<br/># 1D for 1 day<br/># 1W for 1 week<br/># 1M for 1 month<br/># ==================================================================</span></pre><p id="3979" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们包含了导入和参数之后，我们可以设置 chromedriver 了。Options 类将允许我们添加 headless 这样的参数来定制模拟的浏览器。添加 headless 告诉浏览器在每次运行程序时不要弹出。我们可以将可执行路径设置为您之前下载 chromedriver 的路径。在这种情况下，我将它直接下载到我的目录中，但您不必这样做。</p><p id="4f0f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以在一个 try/except 块中添加我们的抓取脚本来捕捉程序中断时的错误。首先，我们必须使用 webdriver.get(URL)打开浏览器，刷新以正确加载页面的各个方面，然后添加 time.sleep(1)使程序慢一秒钟，直到浏览器完全渲染完毕。</p><p id="53de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用。通过 selenium.webdriver 中的 find_by_class_name 方法，我们可以精确定位我们想要清除的部分。例如，只有建议具有以下类“speedometerSignal-pyzN-tL”我们可以通过 Chrome DevTools 中的 inspect 元素来检索这些类名。打开 DevTools，你可以右击你想解析的部分，然后按“inspect ”,得到类似下图的结果！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ns"><img src="../Images/93d229cc7e1049a03034a8427a684110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J31yLacaXwi91TRboEgNUQ.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">Chrome 开发工具</p></figure><p id="5140" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用方法检索“Buy”。get_attribute('innerHTML ')，它将存储 HTML 标记内的文本。</p><p id="f11a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，我们可以检索买入、中性和卖出信号的数量，方法是找到所有这些信号之间相似的类名，然后使用方法。按类名查找元素。因为这次我们调用的是元素，而不是元素，所以这个方法将返回一个包含我们指定的类名的 HTML 标签列表。</p><p id="1c08" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们可以将所有信号附加到一个列表中，并使用。from_records 方法，我们可以将数据元组和列列表转换成 DataFrame。最后，我们可以通过为 ticker 添加一列，将该列设置为索引，并为我们的最终产品转置(旋转)数据帧来清理它。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/93d473aff882f2adf48933aa416c94bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*zGxttNQAHNwFYxOclBKVcQ.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">程序输出</p></figure><p id="0977" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，在几秒钟内，您应该会得到与上图类似的输出。我希望这个算法将来对你有用。非常感谢您的阅读！</p><p id="f24c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nu">免责声明:本文材料纯属教育性质，不应作为专业投资建议。自行决定投资。</em></p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="7c11" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你喜欢这篇文章，可以看看下面我写的其他一些 Python for Finance 文章！</p><div class="oc od gp gr oe of"><a rel="noopener follow" target="_blank" href="/parse-thousands-of-stock-recommendations-in-minutes-with-python-6e3e562f156d"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">使用 Python 在几分钟内解析数千份股票推荐！</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">了解如何在不到 3 分钟的时间内解析顶级分析师的数千条建议！</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="op l oq or os oo ot lp of"/></div></div></a></div><div class="oc od gp gr oe of"><a rel="noopener follow" target="_blank" href="/making-a-stock-screener-with-python-4f591b198261"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">用 Python 制作股票筛选程序！</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">学习如何用 Python 制作一个基于 Mark Minervini 的趋势模板的强大的股票筛选工具。</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="ou l oq or os oo ot lp of"/></div></div></a></div><div class="oc od gp gr oe of"><a rel="noopener follow" target="_blank" href="/creating-a-finance-web-app-in-3-minutes-8273d56a39f8"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">在 3 分钟内创建一个财务 Web 应用程序！</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">了解如何使用 Python 中的 Streamlit 创建技术分析应用程序！</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="ov l oq or os oo ot lp of"/></div></div></a></div></div></div>    
</body>
</html>