<html>
<head>
<title>Explained: ML Transformation &amp; Scaling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解释:ML变换和缩放</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transformation-scaling-of-numeric-features-intuition-7f4436e8e074?source=collection_archive---------11-----------------------#2020-03-22">https://towardsdatascience.com/transformation-scaling-of-numeric-features-intuition-7f4436e8e074?source=collection_archive---------11-----------------------#2020-03-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="543f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">何时使用变换或缩放？哪个定标器？哪些算法？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f313b4919678989522580e678ac213f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xvP6JTJiR1wcuKvC"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在建模之前，所有不同的实体应该在相同的比例上；保罗·卡萨尔斯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5e94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">缩放、标准化和变换是数字特征工程的重要步骤，它们正被用于处理倾斜的特征并为建模而重新缩放它们。机器学习和深度学习算法高度依赖于输入数据质量。如果数据质量不好，再高性能的算法也是白搭。就像<em class="ls">垃圾进:垃圾出一样简单。</em></p><p id="467c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在建模之前，数据科学家有如此多的预处理步骤需要测试和验证。这进一步增加了围绕变换和缩放的效果和使用的混乱。在这里，我们将尝试使用公共数据集来回答一些问题</p><blockquote class="lt lu lv"><p id="7aea" class="kw kx ls ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">何时使用变换或缩放？使用哪个定标器？哪些算法受益？</p></blockquote><p id="2e00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本练习使用的数据是来自<em class="ls">家庭信用违约风险的<em class="ls">主数据文件</em>。数据被整理以预测客户的还款能力。数据是针对所有贷款申请的，在我们的数据示例中，一行代表一个贷款申请。</em></p><p id="0012" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据集可以从<a class="ae kv" href="https://www.kaggle.com/c/home-credit-default-risk/data" rel="noopener ugc nofollow" target="_blank">数据</a>下载。而Jupyter笔记本可以从— <a class="ae kv" href="https://github.com/manu007sharma/Medium_Notebooks/tree/master/Scale_Transform" rel="noopener ugc nofollow" target="_blank">笔记本</a>下载。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><p id="8f29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">公布数据集是为了说明每个申请人的还贷能力？下面是目标特征和一些独立特征的分布。目标特征存在数据不平衡问题，正类只占全部数据的8%。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/4f1c13481e16852c743284cfed760ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpcSpdbu6kafaaDbHduRaA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">目标特征:贷款违约</p></figure><p id="27e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是一些重要的数字独立特征及其直方图。选择它们只是为了解释练习。他们都在寻找不同的范围和规模，例如<em class="ls">AMT _ annuity</em>在<em class="ls"> mn </em>范围内，但<em class="ls"> OWN_CAR_AGE </em>最大可以开到90。</p><p id="1181" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">AMT _年金；金额_贷方；金额_商品_价格；金额_收入_总额；天数_出生；OWN _ CAR _ AGE</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mh"><img src="../Images/44d82f558683b58a4f6b11ef8e1fe195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_xc9DEhMBieNA4yYx3sYAg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数字特征直方图:原始数据</p></figure><p id="b2bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是原始数据的合并箱线图，由于一个空间中不同的比例和倾斜特征，它看起来高度倾斜。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/fbafbc292e2226996a1a5cc3b07d7e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yLpFeMDYcJu4gl-wnNuZRg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">组合箱线图:原始数据</p></figure><h1 id="fb78" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">转换</h1><p id="1faa" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">正态分布特征是统计算法中的一种假设。深度学习和回归型算法也受益于正态分布的数据。</p><p id="e4fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要进行变换来处理倾斜的要素并使其呈正态分布。使用<em class="ls">平方根/立方根/ </em> <strong class="ky ir"> <em class="ls">对数变换可以将右斜特征变换为正态特征。</em> </strong></p><p id="c260" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据上述直方图<em class="ls">金额_年金、金额_信用、金额_商品_价格、金额_收入_总额、&amp;自有_汽车_年龄</em>为偏态数字特征，<em class="ls">天数_出生</em>为正态分布。</p><p id="e1a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">偏斜可能是由于以下两个原因之一</strong></p><ul class=""><li id="e5cc" class="ng nh iq ky b kz la lc ld lf ni lj nj ln nk lr nl nm nn no bi translated"><em class="ls">存在极端异常的异常值，对我们来说可能不重要。</em></li><li id="115c" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><em class="ls">或者说特征的自然分布是偏斜的，而尾部对我们很重要。这是大多数现实生活中的情况</em></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/93815a843d09886e90e80c56a4024011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*iBUxUz_nSRToPAeVRcFtcg.png"/></div></figure><p id="9e35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">对数变换简介:</strong>如左图所示，正值的对数函数输出增长非常缓慢。因此，与较低的观测值相比，较高的值被边缘化得更多。</p><p id="c0e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">变换的效果:</strong>对数变换后，倾斜的数字特征可能呈正态分布。例如，在下图<em class="ls">中，金额信用</em>经过对数变换后呈正态分布。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/483786b0ec1d260d41bcd3cdc22d3428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhkEebKjui3J_BlQf3P45A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">日志转换前后:金额_信用</p></figure><ul class=""><li id="69ee" class="ng nh iq ky b kz la lc ld lf ni lj nj ln nk lr nl nm nn no bi translated"><strong class="ky ir">对数变换对倾斜目标特征的影响(回归的情况):</strong> <em class="ls">对数变换可以将倾斜特征视为常态。并且，如果我们的目标特征是正态分布的，该算法将给予所有样本同等的重要性。它也被称为同质性。这相当于处理分类目标特征中的不平衡数据问题，就像我们在给定的数据集中一样。所以有一个正态分布的目标特性是很好的。</em></li><li id="c3f5" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir">对数变换对偏斜的独立特征的影响:</strong> <em class="ls">对数变换可以使独立特征像上面一样正态化，其中AMT_CREDIT在对数之后接近正态分布。但是它可能不会改善目标和独立特征之间的关系。因此，处理独立的倾斜特征可能有益于也可能无益于建模精度，这完全取决于两者之间的原始因果关系。</em></li></ul><h1 id="c0c5" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">缩放比例</h1><p id="41be" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">缩放是重新缩放数据所必需的，当我们希望在我们的算法中使用相同的缩放比例来比较要素时，会用到缩放。而且，当所有特征都处于相同的比例时，它也有助于算法更好地理解相对关系。</p><blockquote class="nw"><p id="b7ff" class="nx ny iq bd nz oa ob oc od oe of lr dk translated">如果从属特征转换为正态，则应在转换后应用缩放。</p></blockquote><p id="76de" class="pw-post-body-paragraph kw kx iq ky b kz og jr lb lc oh ju le lf oi lh li lj oj ll lm ln ok lp lq lr ij bi translated"><strong class="ky ir">缩放后哪些算法可能受益</strong>？缩放有助于基于距离的算法，也有助于加快收敛</p><p id="d214" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">线性&amp;逻辑回归、KMeans/ KNN、</em>神经网络、<em class="ls"> PCA </em>将受益于规模化</p><p id="d8d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">缩放后哪些算法可能不会受益？</strong>有些算法与缩放无关。基于熵&amp;信息增益的技术对单调变换不敏感。</p><p id="e21f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">基于树的算法、决策树、随机森林、增强树(GBM、light GBM、xgboost) </em>可能无法从扩展中受益。</p><p id="ee11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi ol translated"><span class="l om on oo bm op oq or os ot di"> D </span>在缩放/标准化/规范化过程中，我们将遵循sklearn词汇表，因此使用通用单词S <em class="ls">缩放</em>而不是<em class="ls">标准化</em>或<em class="ls">规范化</em>是一个不错的选择</p><blockquote class="nw"><p id="c7bd" class="nx ny iq bd nz oa ob oc od oe of lr dk translated">训练数据上拟合的定标器模型将用于转换测试集。切勿在测试数据上再次安装定标器</p></blockquote><p id="c74d" class="pw-post-body-paragraph kw kx iq ky b kz og jr lb lc oh ju le lf oi lh li lj oj ll lm ln ok lp lq lr ij bi translated">Sklearn主要有以下四种定标器</p><p id="34bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.最小最大缩放器<br/> 2。鲁棒定标器<br/> 3。标准缩放器<br/> 4。标准化者。</p><p id="5243" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> Minmax定标器</strong>应该是定标的首选。对于每个特征，每个值减去相应特征的最小值，然后除以同一特征的原始最大值和最小值的范围。它的默认范围在[0，1]之间。</p><p id="0fc5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是最小最大缩放后所有6个特征的直方图。在缩放之前，我们没有对任何功能进行对数转换。MinMaxScaler没有改变特性的内部分布，也把每个人放在了同一个尺度上。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/f30f16a37e848af44867fab8867b46e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDMWAKBUG9TXx3oMG44y1Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最小最大缩放后的直方图</p></figure><p id="a884" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是缩放后所有6个特征的组合箱线图。并且，都在[0，1 ]的范围内。每个要素值之间的内部空间得到了保持，并且与原始数据相比，它们的相对分布看起来也更好</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/23e9f8e0462f8b7110d210bf81ca8b93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lf6FCiM9WCWo5N-2u90mdg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最小最大缩放器后的箱线图</p></figure><p id="560f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">当数据含有大量异常值，并且我们希望消除它们的影响时，可以使用鲁棒定标器</strong>。但是不重要的离群值应该首先被移除。RobustScaler减去列的中值，然后除以四分位数范围。</p><p id="5188" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下图是鲁棒缩放器后的特征直方图。尽管直方图看起来与原始数据分布相似，但它们各自的内部距离空间并不像原始数据那样保持不变。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/93a79e935c031cb86e6bc726331602b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1E0ZPPo3CkrdzINqKTZTQg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">鲁棒缩放器后的直方图</p></figure><p id="0e25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，如下面的方框图所示，现在范围不在[0，1]内。并且每个特征的值之间的相对空间被扭曲并且现在不相同。在这种情况下，使用robustscaler会向建模过程传递关于底层数据的错误信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/32f45124b88810719b3b95de2d411ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*69rDwfcikoHvoLiHdYioGw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">鲁棒定标器后的箱线图</p></figure><p id="7d03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> StandardScaler </strong>重新调整每一列，使其具有0个平均值和1个标准差。它通过减去平均值并除以标准差来标准化特征。如果原始分布不是正态分布，可能会扭曲要素之间的相对空间。</p><p id="d203" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是应用标准缩放器后的要素直方图，分布看起来类似于原始数据分布，但它们并不相同，它们各自的内部观测距离在标准缩放过程中发生了变化。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/5eb11673df668e5e0bdd9806af16b17f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ltIGnVrKaIWqyfbyTAU1Iw.png"/></div></div></figure><p id="ad0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是标准缩放后要素的组合箱线图，正如预期的那样，它扭曲了要素值之间的相对距离，而在最小-最大值后它们看起来更好</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/ee58ec09bf48391a5fe2fcf620f42a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ULM1CJeKoJpV_mQBYbtBg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">标准定标器后的方框图</p></figure><p id="2815" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">规格化器</strong>应用于行，而不是列，所以sklearn用户不应该混淆，也不应该使用规格化器。Normalizer的一些应用案例是在同一时间序列中比较多个实体，即在给定时期内多个股票的股票移动</p><h1 id="e4eb" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">结论</h1><ul class=""><li id="f063" class="ng nh iq ky b kz nb lc nc lf oz lj pa ln pb lr nl nm nn no bi translated">在建模之前，应该对偏斜的目标特征进行正态性处理，尤其是当异常值也很重要时</li><li id="6cf1" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated">在分析过程中，应了解如何处理倾斜的从属特征及其影响</li><li id="e99b" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated">MinMaxScaler应该是缩放的首选</li><li id="0533" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated">实验和观察可以帮助我们进一步决定正确的方法</li></ul></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><p id="1ce0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。如果你喜欢过这篇文章，你可能也会喜欢<a class="ae kv" rel="noopener" target="_blank" href="/pandas-index-explained-b131beaf6f7b"> <em class="ls">熊猫指数——隐形</em> </a> <em class="ls">灵魂、</em> <a class="ae kv" href="https://medium.com/analytics-vidhya/pandas-stack-unstack-pivot-table-crosstab-5cb9a16fe020" rel="noopener"> <em class="ls">熊猫支点&amp;堆叠</em> </a></p><ul class=""><li id="2f19" class="ng nh iq ky b kz la lc ld lf ni lj nj ln nk lr nl nm nn no bi translated"><em class="ls">更多请关注我上</em> <a class="ae kv" href="https://medium.com/@manusharma_66718" rel="noopener"> <em class="ls">中</em> </a></li><li id="a691" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><em class="ls">让我们连线上</em><a class="ae kv" href="http://www.linkedin.com/in/data2datasciences/" rel="noopener ugc nofollow" target="_blank"><em class="ls">Linkedin</em></a></li></ul></div></div>    
</body>
</html>