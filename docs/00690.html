<html>
<head>
<title>Building a weather app using Openweathermap and Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Openweathermap 和 Flask 构建天气应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-weather-app-using-openweathermap-and-flask-ed7402239d83?source=collection_archive---------10-----------------------#2020-01-20">https://towardsdatascience.com/building-a-weather-app-using-openweathermap-and-flask-ed7402239d83?source=collection_archive---------10-----------------------#2020-01-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5e37" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用 API，并使用 Python 和 Flask 构建一个简单的应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c3c0ddc56b76f1bf3d49a5be9b6916d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CBfiMZkYtbuMzenT"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">jaros aw kwoczaa 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2957" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将学习使用 web API 的基础知识。我们将使用 Python 和 Flask 创建一个简单的后端，调用<a class="ae kv" href="https://openweathermap.org/api" rel="noopener ugc nofollow" target="_blank"> Openweathermap API </a>，并在网页中呈现结果。</p><p id="a183" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想跳过这篇文章并访问代码，请前往<a class="ae kv" href="https://github.com/sagunsh/weather-app" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。</p><h1 id="61e1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">获取 API 密钥</h1><p id="c97a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">去 https://home.openweathermap.org/users/sign_up 注册一个免费计划，如果你还没有的话。然后访问 API 密钥部分<a class="ae kv" href="https://home.openweathermap.org/api_keys" rel="noopener ugc nofollow" target="_blank">https://home.openweathermap.org/api_keys</a>获取您的密钥。您可以使用默认密钥，也可以根据需要生成一个新密钥。您可能需要等待一段时间来验证您的密钥。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/9dcc5341b7179c1848da28df8674bda7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0WL1DveYSYSht5bkLpvJYA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Openweather 仪表板</p></figure><h1 id="d2fb" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">安装要求</h1><p id="23e3" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我在这个项目中使用 Python 3.6，所以要确保你已经安装了 3.6 或更高版本。除此之外，我们将只需要用于 web 的<strong class="ky ir"> Flask </strong>和用于进行 API 调用的<strong class="ky ir"> requests </strong>。创建一个名为<strong class="ky ir"> requirements.txt </strong>的新文件，并添加依赖项。您的文件应该如下所示:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="c5bf" class="mv lt iq mr b gy mw mx l my mz">Flask==1.1.1<br/>requests==2.22.0</span></pre><p id="d4bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在使用下面的命令来安装需求:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="ffb8" class="mv lt iq mr b gy mw mx l my mz">pip install -r requirements.txt</span></pre><p id="761e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者如果你只是想安装 Flask 和请求</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="79d3" class="mv lt iq mr b gy mw mx l my mz">pip install Flask requests</span></pre><p id="f641" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果 pip 被 Python 2.7 占用，linux 和 mac 可能需要使用 pip3 而不是 pip 和 sudo。</p><h1 id="182a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">进行 API 调用</h1><p id="dee8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">浏览<a class="ae kv" href="https://openweathermap.org/current" rel="noopener ugc nofollow" target="_blank">文档</a>，最简单的请求方式是使用城市名。发出请求的 url 将如下所示</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="d0f1" class="mv lt iq mr b gy mw mx l my mz"><a class="ae kv" href="http://api.openweathermap.org/data/2.5/weather?q={city}&amp;APPID={API_KEY" rel="noopener ugc nofollow" target="_blank">http://api.openweathermap.org/data/2.5/weather?q=city_name&amp;APPID=</a>your_api_key</span></pre><p id="8f26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以复制粘贴 url 并用适当的值替换<strong class="ky ir"> city_name </strong>和<strong class="ky ir"> your_api_key </strong>来查看结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/ad157328d318566d539e57062c3531dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Q99a7fgiQHlUhZyesFMHQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自 Openweather API 的示例响应</p></figure><p id="5963" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想看到一个格式化的 JSON 响应，你可以使用一个叫做<a class="ae kv" href="https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc" rel="noopener ugc nofollow" target="_blank"> JSONView </a>的 chrome 扩展。在浏览器中，您的响应将如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/6935894d0b04be23d511d0c37e757bb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-4N0XNZ744iRJtwA5rDpFw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用 JSONView 格式化 JSON 响应</p></figure><p id="0c19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所有显示的数据都非常直观。温度显示在<strong class="ky ir">主</strong>键内。<strong class="ky ir">名称</strong>和<strong class="ky ir"> id </strong>都可以用来查询 API。</p><h1 id="4884" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建烧瓶应用程序</h1><p id="8352" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Flask 是一个简单、轻量级的 web 框架。它可以用来创建最小的 web 应用程序和 API。创建一个名为<strong class="ky ir"> weather_app.py </strong>的文件并初始化我们的 Flask 应用程序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="4dd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的代码片段中，我们导入了 Flask 并创建了它的一个实例。<strong class="ky ir"> @app.route() </strong>用于创建路线。这里我们为主页创建一个，主要是在浏览器的<strong class="ky ir"> h1 </strong>标签中呈现“欢迎使用天气应用程序”。我们稍后将添加更多路线。在 if 块中，我们使用<strong class="ky ir"> debug=True </strong>运行应用程序，这告诉 Flask 应用程序正在调试模式下运行。在调试模式下运行的好处是，如果我们在应用程序中进行更改，Flask 会自动检测这些更改，并为我们重新加载服务器。进入生产时，确保将此设置为<strong class="ky ir">假</strong>。</p><p id="4fd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过在终端/cmd 中键入以下命令来运行服务器</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="f80d" class="mv lt iq mr b gy mw mx l my mz">python weather_app.py</span></pre><p id="131c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你同时安装了 python 2 和 3(通常在 linux 和 mac 上)，你将不得不使用 python3 而不是 python</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="0b4e" class="mv lt iq mr b gy mw mx l my mz">python3 weather_app.py</span></pre><p id="1890" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你会看到类似这样的东西</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="e06d" class="mv lt iq mr b gy mw mx l my mz">* Debug mode: on<br/>* Running on <a class="ae kv" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/</a> (Press CTRL+C to quit)<br/>* Restarting with stat<br/>* Debugger is active!<br/>* Debugger PIN: 123-456-789</span></pre><p id="b856" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">访问<a class="ae kv" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000/ </a>你会在 h1 看到“欢迎使用天气 app”。要退出服务器，按下<strong class="ky ir"> CTRL + C </strong>。</p><h1 id="6a2c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">添加搜索路线</h1><p id="5586" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在，我们需要一种方法来输入一个城市名称并获取该城市的当前天气。为此，我们将不得不创建另一条路由，让我们称之为<strong class="ky ir"> /city </strong>，它将城市的名称作为参数，并返回温度。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="7461" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在要测试 API，请访问 url</p><p id="5802" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="http://127.0.0.1:5000/city?q=kathmandu" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:5000/城市？q =加德满都</a></p><p id="d3a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将在浏览器中看到类似这样的响应:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="3226" class="mv lt iq mr b gy mw mx l my mz">Current temperature of Kathmandu is 15.0 ℃</span></pre><p id="c049" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在 url 中作为查询传递的任何内容都将作为字典存储在 request.args 中。这里，<strong class="ky ir"> q=kathmandu </strong>是查询字符串，因此<strong class="ky ir"> request.args </strong>将保存<strong class="ky ir"> {"q": "kathmandu"} </strong>。然后我们使用<strong class="ky ir"> get </strong>方法通过键访问字典。你可以在<a class="ae kv" href="https://realpython.com/python-dicts/#dgetltkeygt-ltdefaultgt" rel="noopener ugc nofollow" target="_blank">这篇教程</a>中了解更多关于字典的知识。获取当前温度时也是如此。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="5b70" class="mv lt iq mr b gy mw mx l my mz">current_temperature = response.get('main', {}).get('temp')</span></pre><p id="e438" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以把<strong class="ky ir">加德满都</strong>换成你想要的城市。城市列表和 id 可以从<a class="ae kv" href="http://bulk.openweathermap.org/sample/city.list.json.gz" rel="noopener ugc nofollow" target="_blank">这个链接</a>下载。</p><p id="ee33" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最终的 weather_app.py 文件应该如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="f713" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">至此，我们已经创建了一个简单的应用程序，它可以获取某个城市的当前温度。这篇文章应该让你了解 Flask 是如何工作的，以及如何在 Python 中使用 API。你可以从我的<a class="ae kv" href="https://github.com/sagunsh/weather-app" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>获取代码。</p><h1 id="1d75" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">接下来呢？</h1><p id="11ba" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">从这里开始，您可以扩展功能并向应用程序添加更多功能，例如</p><ol class=""><li id="46b7" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">添加搜索按钮</li><li id="f05c" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">使用模板和一个好看的界面</li><li id="b4aa" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">显示城市列表和各自的 id</li><li id="a555" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">按 id 和名称查询</li><li id="b152" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">显示其他数据，如最高、最低温度、湿度、风力等</li></ol><p id="617f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您在学习本教程时有任何问题，或者需要帮助添加更多功能，请告诉我。</p></div></div>    
</body>
</html>