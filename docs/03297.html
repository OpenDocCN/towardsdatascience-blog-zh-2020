<html>
<head>
<title>3 Time Series Models Anyone Can Build</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">任何人都可以建立的 3 个时间序列模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-time-series-models-anyone-can-build-e6943b017c41?source=collection_archive---------26-----------------------#2020-03-29">https://towardsdatascience.com/3-time-series-models-anyone-can-build-e6943b017c41?source=collection_archive---------26-----------------------#2020-03-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/3dddb781f26ad4841fb21e8b48f3305e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WG3RQase4YPTzEWK"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">艾萨克·史密斯在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3d3e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最近接受了预测时间序列数据的挑战，我自学习机器学习以来第一次深入研究时间序列预测的细节。</p><p id="5dbc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我发现的。</p><p id="650c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">—时间序列预测与通常的机器学习模型完全不同。</p><p id="6788" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您的数据是不同的格式，您的数据清理过程是不同的，并且所使用的模型没有在其他任何地方使用过。似乎时间序列本身就是一种不同的技术。斯坎达的<a class="ae kf" rel="noopener" target="_blank" href="/3-facts-about-time-series-forecasting-that-surprise-experienced-machine-learning-practitioners-69c18ee89387">帖子</a>完美地描述了这一现象。</p><p id="a478" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，在花了几个小时钻研时间序列之后，我决定写这个简单的指南来帮助你建立你的第一个时间序列模型。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="0d1b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇短文中，我将使用<a class="ae kf" href="https://www.kaggle.com/c/m5-forecasting-accuracy" rel="noopener ugc nofollow" target="_blank">卡格尔·M5 预测</a>比赛数据。</p><p id="d4a7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于数据由沃尔玛中各种商品的销售数据组成，我将只关注单个商品的销售数据。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="bb04" class="lu lv it lq b gy lw lx l ly lz"># Reading various csv into dataframe<br/>sales_train = pd.read_csv("sales_train_validation.csv")<br/>date = pd.read_csv("calendar.csv")</span><span id="dde7" class="lu lv it lq b gy ma lx l ly lz"># filter to get single item<br/>single = sales_train[sales_train["id"]=="FOODS_3_090_CA_3_validation"].iloc[:,6:].T.reset_index().copy()</span><span id="b5a7" class="lu lv it lq b gy ma lx l ly lz">datetime = date[["date","d"]].copy()</span><span id="9c01" class="lu lv it lq b gy ma lx l ly lz">single = pd.merge(left=single,right=datetime,left_on="index",right_on="d",how="left")</span><span id="0d0e" class="lu lv it lq b gy ma lx l ly lz">#  Data processing to prepare for modeling<br/>single.drop(["d","index"],axis=1,inplace=True)<br/>single["date"] = pd.to_datetime(single["date"])<br/>single = single.rename({"date":"ds",single.columns[0]:"y"},axis=1)[["ds","y"]]<br/>ts= single.iloc[-98:,:].copy()</span></pre><p id="b508" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于培训和测试分割，我决定使用过去 3 个月(84 天)的数据来预测未来 2 周(14 天)的销售数量。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="e494" class="lu lv it lq b gy lw lx l ly lz"># use past 3 months (84 days) data to forecast the next 2 weeks<br/>duration = 14<br/>train = ts.iloc[:-duration,:].copy()<br/>test = ts.iloc[-duration:,:].copy()</span></pre><p id="bd26" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">绘制数据，</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="6421" class="lu lv it lq b gy lw lx l ly lz"># Visualization<br/>plt.figure(figsize=(12,12))<br/>plt.plot(train["ds"],train["y"],label="Train")<br/>plt.plot(test["ds"],test["y"],label="Test")<br/>plt.title("Time Series Forecasting")<br/>plt.legend()</span></pre><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mb"><img src="../Images/642b1e07f8d2142d6b2ce2554fe4ded6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NF7Je5W530JvsqJXuYQXQA.png"/></div></div></figure><p id="54ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在来建造我们的第一个模型。我要介绍的第一个算法是持久性算法。通过预测下一个时间步长与前一个时间步长的值相同，这种方法是获得时间序列数据基线预测的简便方法。</p><p id="0803" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着 t+1 的值就是 t 的真实值。</p><p id="cc48" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用代码实现它，</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="937b" class="lu lv it lq b gy lw lx l ly lz">## Persistence algorithm<br/>pred= []<br/>for i in range(duration):<br/>    pred.append(train.iloc[-1,1])</span><span id="1760" class="lu lv it lq b gy ma lx l ly lz">    # add test data to train<br/>    train = train.append(test.iloc[i])</span></pre><p id="927a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是结果。</p><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/074ebb235686b79b54701f8847b37dfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ShtursaPD1PJQcHLjWQxPw.png"/></div></div></figure><p id="4ac1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看起来很准确吧。但是外表是会骗人的。让我们来计算均方根误差(RMSE)，这是时间序列预测中使用的一个常用指标。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="5632" class="lu lv it lq b gy lw lx l ly lz">from sklearn.metrics import mean_squared_error<br/>rmse =  np.sqrt(mean_squared_error(pred,test["y"]))<br/>print("RMSE:",rmse)</span></pre><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/48cb9a3cdc09fb8159b1709b4a05f341.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*HY7wBwgKsCbObq6kTuYisg.png"/></div></div></figure><p id="c1f7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">41.2 的 RMSE，现在记住这一点，因为这是我们基线模型的误差。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="7569" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们转到时间序列预测的统计方法。ARIMA 是该领域许多从业者使用的一种常见和流行的预测方法。算法的细节不是这里的重点，但是你可以在这个详细的<a class="ae kf" href="https://www.machinelearningplus.com/time-series/arima-model-time-series-forecasting-python/" rel="noopener ugc nofollow" target="_blank">指南</a>中找到更多关于 ARIMA 的信息。</p><p id="3e35" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，如果你还没有下载 pmdarima 包，请确保下载到你的机器中。这是 auto-arima 包，我们将使用它来获得模型的最佳参数。</p><p id="5d5c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">需要注意的另一点是，该包只需要值的一维输入。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="4c06" class="lu lv it lq b gy lw lx l ly lz"># Split into train and test set<br/>duration = 14<br/>train = ts.iloc[:-duration,:].copy().set_index("ds")<br/>test = ts.iloc[-duration:,:].copy().set_index("ds")</span></pre><p id="be42" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用自动 arima 建立模型并进行预测。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="9b0b" class="lu lv it lq b gy lw lx l ly lz">import pmdarima as pm</span><span id="0146" class="lu lv it lq b gy ma lx l ly lz">model = pm.auto_arima(train,start_p=0,start_q=0,test="adf",max_p=3,max_q=3,error_action="ignore",suppress_warnings=True,seasonal=False)</span><span id="43a0" class="lu lv it lq b gy ma lx l ly lz"># prediction<br/>pred = model.predict(duration)</span></pre><p id="9cde" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看剧情…</p><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/f7f99bd3f5dac194b995fbb604a4b1b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EjkEOsMLFTQ_PcSZWjHX8A.png"/></div></div></figure><p id="abb8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">预测值几乎形成一条直线。然而，如果你计算 RMSE，你会发现你的模型提高了 36.7 的 RMSE。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="33cf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们要看的最后一个模型是由脸书的数据科学家团队开发的一个包，名为<a class="ae kf" href="https://facebook.github.io/prophet/" rel="noopener ugc nofollow" target="_blank"> Prophet </a>。对于那些对使用的算法感兴趣的人，你可以在这里找到论文<a class="ae kf" href="https://peerj.com/preprints/3190/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="2859" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">prophet 模型所需的数据格式非常具体。它需要一个名为‘ds’的日期列和一个名为‘y’的值列，这解释了为什么需要在前面的预处理阶段重命名我们的列。</p><p id="9b04" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦数据格式正确，您就可以开始训练模型了。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="0d66" class="lu lv it lq b gy lw lx l ly lz">from fbprophet import Prophet<br/>model = Prophet()<br/>model.fit(train)</span></pre><p id="e46d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">预测是通过一个特殊的函数来完成的，这个函数为未来的日期创建数据帧。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="9830" class="lu lv it lq b gy lw lx l ly lz"># Making prediction<br/>future = model.make_future_dataframe(duration,include_history=False)<br/>pred = model.predict(future)<br/>pred = pred[["yhat","yhat_lower","yhat_upper"]]</span></pre><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mf"><img src="../Images/be6bb842626f4e9967774a9b8b23b3b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96Jqi-d2lSzyQvUJdSKjiQ.png"/></div></div></figure><p id="b78d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">几行代码所能实现的东西非常惊人。这款车型的 RMSE 只有 22.5，比之前的任何一款车型都要好。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="9521" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是你要的，3 个时间序列模型，你可以快速的建立来探索你的数据。</p><p id="3ee3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">快乐学习！</p></div></div>    
</body>
</html>