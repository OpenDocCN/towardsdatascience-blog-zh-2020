<html>
<head>
<title>Speed up your Pandas Processing with Swifter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Swifter 加速你的熊猫处理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/speed-up-your-pandas-processing-with-swifter-6aa314600a13?source=collection_archive---------11-----------------------#2020-07-04">https://towardsdatascience.com/speed-up-your-pandas-processing-with-swifter-6aa314600a13?source=collection_archive---------11-----------------------#2020-07-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="abcb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不要让你的数据处理花费你太长时间</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5c07ab2add050c78b2f2ecd37882df11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SfloAIxMuVn4Zjrn"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Marc-Olivier Jodoin 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="64a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名 Pythonist 数据科学家，您的日常工作将涉及大量使用 Pandas 包的数据处理和特性工程。从分析数据到创建新功能再到获得洞察力，迫使您重复执行许多不同的代码。问题是你的数据越大，完成每一行代码的时间就越长。</p><p id="050d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我想向你展示一个简单的包来加快你的熊猫处理速度，这个包叫做<a class="ae ky" href="https://github.com/jmcarpenter2/swifter" rel="noopener ugc nofollow" target="_blank"> Swifter </a>。让我们开始吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a789" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">下前支索</h1><p id="f283" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Swifter 是一个软件包，它试图以最快的可用方法有效地将任何函数应用于 Pandas 数据框或系列对象。它与 Pandas 对象集成在一起，因此我们只能将此包用于 Pandas 对象，如数据框或系列。</p><p id="ace9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们试着看看更快的行动。为了做好准备，我们需要安装 Swifter 包。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="fd97" class="ne md it na b gy nf ng l nh ni">#Installing Swifter via Pip<br/>pip install swifter</span><span id="0eb6" class="ne md it na b gy nj ng l nh ni">#or via conda<br/>conda install -c conda-forge swifter</span></pre><p id="0d58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你没有最新的熊猫包，建议你把包升级到最新版本。这是因为在 Swifter 模块中使用的 pandas 扩展 api 是 Pandas 的新增功能。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9d4d" class="ne md it na b gy nf ng l nh ni">#Update the Pandas package via pip<br/>pip install -U pandas</span><span id="e2f1" class="ne md it na b gy nj ng l nh ni">#or via conda<br/>conda update pandas</span></pre><p id="f506" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当所有需要的包准备就绪，我们可以继续尝试更快。在本文中，我将使用来自<a class="ae ky" href="https://www.kaggle.com/unanimad/dataisbeautiful" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>的 Reddit 评论数据集。从这里，我们将所有的包导入到我们的笔记本中，并像往常一样从 CSV 中读取数据集。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="23d9" class="ne md it na b gy nf ng l nh ni">#Import the package<br/>import pandas as pd<br/>import swifter</span><span id="28d2" class="ne md it na b gy nj ng l nh ni">#read the dataset<br/>df = pd.read_csv('r_dataisbeautiful_posts.csv')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/b45cce7a0a5392baa3f0ae3f2ff17bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*g9lI-eDmxwcu8l00E3vqzw.png"/></div></figure><p id="997e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们的数据集。现在，假设我想将分数乘以 2，减去 1(这只是我在这里使用的一个随机方程)。然后我会把它放在另一栏。在这种情况下，我可以使用熊猫对象属性中的 apply 函数。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="944c" class="ne md it na b gy nf ng l nh ni">%time df['score_2_subs'] = df['score'].apply(lambda x: x/2 -1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/a8f8670a58b98d36f7d2874fd9d99d1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:380/format:webp/1*0sjp3JajDlMZxfy5-RlLtg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫申请执行时间</p></figure><p id="48c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于 Pandas 的 apply 属性，对每个数据执行函数的时间大约需要 42.9 ms。这一次，我们将使用 Swifter，看看执行这个函数需要多少时间。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="fcc8" class="ne md it na b gy nf ng l nh ni">#When we importing the Swifter package, it would integrated with Pandas package and we could use functional attribute from Pandas such as apply</span><span id="4196" class="ne md it na b gy nj ng l nh ni">%time df['score_2_swift'] = df['score'].swifter.apply(lambda x: x/2 - 1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/0d21292399e2481573e076aa7585807a.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*uZo2mqBkipfbrzhU0b-WXw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更快的应用执行时间</p></figure><p id="6b36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在上面看到的，Swifter 处理数据的速度比普通的 Pandas apply 函数要快。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="51aa" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">更快的矢量化功能</h1><p id="4d8a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">从文档中可以看出，Swifter 应用函数的速度比 Pandas 函数快 100 倍。然而，这只适用于我们使用矢量化形式的函数的情况。</p><p id="06b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我创建了一个函数来计算 num_comments 和 score 变量。当评论数为零时，我会加倍评分。虽然不是，但分数会保持不变。然后我会在此基础上创建一个新的专栏。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="33a6" class="ne md it na b gy nf ng l nh ni">def scoring_comment(x):<br/>    if x['num_comments'] == 0:<br/>        return x['score'] *2<br/>    else:<br/>        return x['score']</span><span id="089b" class="ne md it na b gy nj ng l nh ni">#Trying applying the function using Pandas apply<br/>%time df['score_comment'] = df[['score','num_comments']].apply(scoring_comment, axis =1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/4c20554b9415b0fcfddfcc2e125c7112.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/format:webp/1*oMi5sjF8MiA58_wxSC8ifw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫应用非矢量化函数执行时间</p></figure><p id="2af4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行该功能大约需要 3.96 秒。让我们看看性能，如果我们使用更快。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b987" class="ne md it na b gy nf ng l nh ni">%time df['score_comment_swift'] = df[['score', 'num_comments']].swifter.apply(scoring_comment, axis =1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/873c96ffa8b4f10210480b8eca698bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:356/format:webp/1*CQK6wfmJsxe16_KoV9TexQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更快地应用非矢量化函数执行时间</p></figure><p id="ab97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在上面看到的，使用 Swifter 比普通的 Pandas 应用功能需要更长的时间。这是因为具有非向量化功能的 Swifter 将实现 dask 并行处理，而不依赖于 Swifter 处理本身。那么，如果把函数改成向量化函数，性能如何呢？让我们试一试。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1bab" class="ne md it na b gy nf ng l nh ni">Import numpy as np</span><span id="a931" class="ne md it na b gy nj ng l nh ni">#Using np.where to implement vectorized function<br/>def scoring_comment_vectorized(x):<br/>    return np.where(x['num_comments'] ==0, x['score']*2, x['score'])</span><span id="1448" class="ne md it na b gy nj ng l nh ni">#Trying using the normal Pandas apply<br/>%time df['score_comment_vectorized'] = df[['score', 'num_comments']].apply(scoring_comment_vectorized, axis =1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/651fd5ade22b7fef43a654bf03e9a07b.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/1*wh7CLYqQajErKudg07wxJw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫申请矢量化函数执行时间</p></figure><p id="ed86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用普通的 apply 函数执行我们的矢量化函数大约需要 6.25 秒。让我们看看使用 Swifter 的性能。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="f8b6" class="ne md it na b gy nf ng l nh ni">%time df['score_comment_vectorized_swift'] = df[['score', 'num_comments']].swifter.apply(scoring_comment_vectorized, axis =1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/417b6ef09000d776af70792b42933d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:362/format:webp/1*kKwzWeEe205FRBj-DfB6LQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更快的应用和矢量化的函数执行时间</p></figure><p id="d824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">矢量化函数的执行时间现在只需 11 毫秒，与普通的 apply 函数相比节省了很多时间。这就是为什么当我们用 Swifter 处理数据时，建议使用矢量化函数。</p><p id="a8c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想跟踪刚刚发生的执行时间，我会在下面的表格中给你一个总的总结。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/2071bf03e67588a0cf3b379ecf548948.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3gczBOeI1udHv1SAmlFT5w.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="156d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="75d7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我只是向你展示 Swifter 如何加速你的熊猫数据处理。当我们使用矢量化函数而不是非矢量化函数时，Swifter 的效果最好。如果你想了解更多关于 Swifter 和可用 API 的信息，你可以查看<a class="ae ky" href="https://github.com/jmcarpenter2/swifter/blob/master/docs/documentation.md" rel="noopener ugc nofollow" target="_blank">文档。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b0db" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如果你喜欢我的内容，并想获得更多关于数据或作为数据科学家的日常生活的深入知识，请考虑在这里订阅我的<a class="ae ky" href="https://cornellius.substack.com/welcome" rel="noopener ugc nofollow" target="_blank">时事通讯。</a></h1><blockquote class="ns"><p id="9f50" class="nt nu it bd nv nw nx ny nz oa ob lu dk translated">如果您没有订阅为中等会员，请考虑通过<a class="ae ky" href="https://cornelliusyudhawijaya.medium.com/membership" rel="noopener">我的推荐</a>订阅。</p></blockquote></div></div>    
</body>
</html>