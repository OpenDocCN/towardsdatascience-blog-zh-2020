# æ•™ç¨‹:ç”¨ 23 è¡Œ Python åœ¨å‡ ç§’é’Ÿå†…åˆ®å‡º 100 ä¸ªæ ‡é¢˜

> åŸæ–‡ï¼š<https://towardsdatascience.com/tutorial-scrape-100-headlines-in-seconds-with-23-lines-of-python-14047deb1a98?source=collection_archive---------32----------------------->

## Scrapy åº“çš„ç½‘é¡µæŠ“å–å¿«é€Ÿï¼Œç®€å•ï¼Œè€Œä¸”éå¸¸å¼ºå¤§ã€‚

![](img/5fb83e5f0fff82e32eef49da810c6635.png)

ç…§ç‰‡ç”±[æœ¬æ–¯Â·å·´æ‹‰-è‚–ç‰¹çº³](https://unsplash.com/@benballaschottner?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/s/photos/spider-web?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) æ‹æ‘„

å¦‚æœä½ éœ€è¦åšä»»ä½•ç±»å‹çš„ç½‘é¡µæŠ“å–ï¼ŒScrapy å‡ ä¹æ˜¯ä¸å¯èƒ½é”™è¿‡çš„ã€‚å€ŸåŠ©å¹¶è¡Œè¯·æ±‚ã€ç”¨æˆ·ä»£ç†æ¬ºéª—ã€robots.txt ç­–ç•¥ç­‰å†…ç½®ç‰¹æ€§ï¼Œæ‚¨åªéœ€å‡ è¡Œä»£ç å°±å¯ä»¥æ„å»ºä¸€ä¸ªå¼ºå¤§çš„ web scraperã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ Scrapy èœ˜è››ï¼Œæ”¶é›†æ–°é—»æ–‡ç« çš„æ ‡é¢˜ã€‚åœ¨å¤§å¤šæ•°ç½‘ç«™ä¸Šï¼Œä½ å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œè€Œä¸ç”¨æ‹…å¿ƒä»˜è´¹å¢™ã€åƒµå°¸æ£€æµ‹æˆ–å¥‡æ€ªçš„è§£ææŠ€å·§ï¼Œæ‰€ä»¥æˆ‘å°†æŠŠè¿™äº›æ‹…å¿ƒç•™ç»™å¦ä¸€ä¸ªæ•™ç¨‹ã€‚

## æ•°æ®

[è¿™é‡Œçš„](https://gist.github.com/jackbandy/208028b404d8c6a6f822397e306a5a34)æ˜¯ä¸€ä¸ªæœ‰ 100 ä¸ªéšæœº URL çš„æ–‡ä»¶ï¼Œæ¥è‡ªæˆ‘ä» [NewsAPI](https://newsapi.org) æ”¶é›†çš„æ•°æ®é›†ã€‚å‰å‡ è¡Œå¦‚ä¸‹æ‰€ç¤º:

## Python åº“

æˆ‘ä»¬å°†ä½¿ç”¨ä¸‰ä¸ªå¼€æºåº“(åŠå…¶ä¾èµ–é¡¹): [Pandas](https://github.com/pandas-dev/pandas) ã€ [Scrapy](https://github.com/scrapy/scrapy) å’Œ [Readability](https://github.com/buriy/python-readability) ã€‚å‡è®¾æ‚¨å·²ç»å®‰è£…äº†[pip](https://pip.pypa.io/en/stable/installing/)ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¡®ä¿æ‚¨çš„è®¡ç®—æœºå·²ç»å®‰è£…äº†è¿™äº›:

```
pip install scrapy pandas readability-lxml
```

ç„¶åï¼Œåˆ›å»ºè¦ç»„ç»‡é¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼Œå¹¶å¯¼èˆªåˆ°è¯¥æ–‡ä»¶å¤¹:

```
mkdir headline_scraper
cd headline_scraper
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºèœ˜è››ã€‚Scrapy æœ‰ä¸€ä¸ª`startproject`å‘½ä»¤å¯ä»¥è®¾ç½®æ•´ä¸ªé¡¹ç›®ï¼Œä½†æ˜¯æˆ‘å‘ç°å®ƒå¯èƒ½ä¼šå¾ˆè‡ƒè‚¿ã€‚æˆ‘ä»¬å°†é€šè¿‡åˆ¶ä½œæˆ‘ä»¬è‡ªå·±çš„èœ˜è››æ¥ä¿æŒç®€å•ï¼Œæ­£å¦‚æ‰€æ‰¿è¯ºçš„ï¼Œå®ƒåªæœ‰ 23 è¡Œ(åŒ…æ‹¬æ³¨é‡Šå’Œç©ºç™½)ğŸ™‚).ä»¥ä¸‹æ˜¯ä¸€ä¸ªåä¸º`headline_scraper.py`çš„æ–‡ä»¶çš„å†…å®¹:

ä¸æ™®é€šçš„ python è„šæœ¬ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ scrapy çš„`runspider`å‘½ä»¤æ¥è¿è¡Œæ–‡ä»¶ã€‚ä½¿ç”¨`-o`æ ‡å¿—é€‰æ‹©ä¿å­˜è¾“å‡ºçš„ä½ç½®:

```
scrapy runspider headline_scraper.py -o scraped_headlines.csv
```

å°±è¿™äº›äº†ï¼ä¸‹é¢æ˜¯å¯¹ä»£ç ä¸­å‘ç”Ÿçš„äº‹æƒ…çš„è§£é‡Šã€‚

# éå†ä»£ç 

## åˆå§‹åŒ–

é™¤äº†å¯¼å…¥åº“å’Œå£°æ˜`PATH_TO_DATA`(æŒ‡å‘å­˜å‚¨ 100 ä¸ª URL çš„[è¦ç‚¹](https://gist.github.com/jackbandy/208028b404d8c6a6f822397e306a5a34)çš„é“¾æ¥)ä¹‹å¤–ï¼Œä¸‹é¢æ˜¯æœ€åˆå‡ è¡Œè¦åšçš„äº‹æƒ…:

*   `class HeadlineSpider(scrapy.Spider)`åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»â€œHeadlineSpiderâ€ï¼Œå®ƒç»§æ‰¿äº† scrapy [èœ˜è››](https://docs.scrapy.org/en/latest/topics/spiders.html)çš„åŸºæœ¬åŠŸèƒ½
*   `name="headline_spider"`å°†æ–°èœ˜è››å‘½åä¸ºâ€œå¤´æ¡ _ èœ˜è››â€ï¼Œä¾› Scrapy å‚è€ƒ
*   `start_urls=read_csv(PATH_TO_DATA).url.tolist()`ä½¿ç”¨ pandas çš„ csv é˜…è¯»å™¨ä¸‹è½½åŒ…å« 100 ä¸ª url çš„æ–‡ä»¶ï¼Œç„¶åè·å–â€œURLâ€åˆ—å¹¶å°†å…¶è½¬æ¢ä¸º python åˆ—è¡¨ã€‚`start_urls`æ˜¯ä»»ä½•èœ˜è››éƒ½éœ€è¦çš„ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬æ˜¯å”¯ä¸€ä¼šè¢«è®¿é—®çš„ç½‘å€ã€‚

(å¦‚æœæ‚¨æƒ³ä½¿ç”¨å…·æœ‰è‡ªå·±çš„ URL çš„ä¸åŒæ–‡ä»¶ï¼Œåªéœ€ç”¨æ‚¨æ–‡ä»¶çš„ä½ç½®æ›¿æ¢`PATH_TO_DATA`ã€‚ç„¶åï¼Œç¡®ä¿ url åˆ—è¢«æ ‡è®°ä¸ºâ€œURLâ€ï¼Œæˆ–è€…å°†`.url`æ›¿æ¢ä¸º`.name_of_your_column`ï¼Œå®ƒå¯ä»¥åœ¨æ‚¨çš„æœºå™¨ä¸Šï¼Œå³`PATH_TO_DATA=/Users/Jack/Desktop/file.csv`

ç°åœ¨æˆ‘ä»¬å·²ç»åˆå§‹åŒ–äº†èœ˜è››ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰å®ƒå½“å®ƒåˆ°è¾¾ä¸€ä¸ªç½‘é¡µæ—¶å®é™…è¦åšä»€ä¹ˆã€‚

## ä»è¯­æ³•ä¸Šåˆ†æ

è¦çœŸæ­£æå–æ ‡é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»å®ç°`parse`æ–¹æ³•ã€‚æ¯å½“ Scrapy ä»åˆ—è¡¨`start_urls`ä¸­æ£€ç´¢åˆ°ä¸€ä¸ª url æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å‘è¿™ä¸ªæ–¹æ³•å‘é€ http å“åº”ï¼Œç„¶åå®Œå…¨ç”±æ‚¨å†³å®šå¦‚ä½•å¤„ç†å®ƒã€‚è¿™ä¸ªç‰ˆæœ¬çš„åŠŸèƒ½å¦‚ä¸‹:

*   `doc=Document(response.text)`è¿™ä¸€è¡Œä½¿ç”¨[å¯è¯»æ€§çš„](https://github.com/buriy/python-readability)åŠŸèƒ½æ¥è§£æ htmlã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„åº“ï¼Œæ¯”å¦‚ [BeautifulSoup](https://www.crummy.com/software/BeautifulSoup/) æˆ–è€…[æŠ¥çº¸](https://github.com/codelucas/newspaper/)æ¥è·å–è¿™ä¸ªéƒ¨åˆ†ã€‚
*   `yield`æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåˆ›å»ºè¾“å‡ºçš„ return æ–¹æ³•ï¼Œæ‚¨å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆç”Ÿæˆçš„ç”µå­è¡¨æ ¼ä¸­çš„ä¸€è¡Œã€‚
*   `'short_title':doc.short_title()`è€Œå®ƒä¸‹é¢çš„å‡ è¡Œåªæ˜¯ç®€å•çš„è®¾ç½®äº†è¿”å›å¯¹è±¡çš„ä¸åŒå±æ€§ã€‚æ‚¨å¯ä»¥å°†`'short_title'`è§†ä¸ºç»“æœç”µå­è¡¨æ ¼ä¸­çš„ä¸€åˆ—ï¼Œå†…å®¹å°†æ˜¯`doc.short_title()`çš„è¾“å‡º(ä¾‹å¦‚ï¼Œâ€œå† çŠ¶ç—…æ¯’çˆ†å‘å¦‚ä½•å½±å“å…¨çƒç»æµâ€)

åŒæ ·ï¼Œè¿™éƒ¨åˆ†æ˜¯éå¸¸å¯å®šåˆ¶çš„ã€‚å¦‚æœæ‚¨æƒ³å°è¯•è·å¾—æ–‡ç« çš„å…¨æ–‡ï¼Œåªéœ€æ›´æ”¹ yield è¡Œä»¥åŒ…å«å¦‚ä¸‹çš„`doc.summary()`ã€‚

```
yield {
    'full_text': doc.summary(),
    'short_title': doc.short_title(),
    'full_title': doc.title(),
    'url': response.url
}
```

è¿™å°†åœ¨ç»“æœä¸­å¢åŠ ä¸€ä¸ªåä¸º`full_text`çš„åˆ—ã€‚csv æ–‡ä»¶ï¼Œå¯è¯»æ€§æœ€å¥½çš„æå–æ–‡ç« æ–‡æœ¬çš„å°è¯•ã€‚

# ç»“æœ

ä¸‹é¢æ˜¯è¿è¡Œ`scrapy runspider headline_scraper.py -o scraped_headlines.csv:`çš„è¾“å‡ºæ–‡ä»¶

å˜£ï¼è‡³å°‘å¤§éƒ¨åˆ†æƒ…å†µä¸‹ã€‚Scrapy æ˜¯éå¸¸å®¹é”™çš„ï¼Œæ‰€ä»¥åªæœ‰ 95/100 çš„ URL è¿”å›ã€‚æ²¡æœ‰å›æ¥çš„ 5 é‡åˆ°äº†æŸç§ http é”™è¯¯ï¼Œå°±åƒä½ æœ‰æ—¶åœ¨æµè§ˆç½‘é¡µæ—¶çœ‹åˆ°çš„ 404 é”™è¯¯ã€‚æ­¤å¤–ï¼Œä¸€äº›è¡Œ(æˆ‘æ•°äº† 7 è¡Œ)å†™ç€â€œè­¦å‘Šâ€å’Œâ€œä½ æ˜¯æœºå™¨äººå—ï¼Ÿâ€è€Œä¸æ˜¯æä¾›çœŸå®çš„æ ‡é¢˜ã€‚(å½­åšä¼¼ä¹æœ‰éå¸¸æœ‰æ•ˆçš„æœºå™¨äººæ£€æµ‹ã€‚)

æœ‰è®¸å¤šç­–ç•¥æ¥å¤„ç† bot æ£€æµ‹ï¼Œå…¶ä¸­ä¸€äº›å·²ç»åœ¨ Scrapy ä¸­å®ç°ã€‚å¦‚æœæ‚¨æ„Ÿå…´è¶£ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥åœ¨ä»¥åçš„æ•™ç¨‹ä¸­ä»‹ç»è¿™äº›ç­–ç•¥ã€‚

![](img/5f311e9cd8ca64c586bde09a320da3f3.png)

ç…§ç‰‡ç”± [Divyadarshi Acharya](https://unsplash.com/@lincon_street?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) åœ¨ [Unsplash](https://unsplash.com/s/photos/web-scrape?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„

*å¦‚æœæ‚¨å¯¹ä»£ç æœ‰ä»»ä½•ç–‘é—®ã€æ„è§æˆ–é—®é¢˜ï¼Œæ¬¢è¿å›å¤æœ¬æ–‡æˆ–åœ¨*[*Twitter*](https://twitter.com/jackbandy)*ä¸Šç»™æˆ‘å‘æ¶ˆæ¯ã€‚è°¢è°¢ï¼*