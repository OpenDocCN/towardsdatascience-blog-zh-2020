<html>
<head>
<title>Websocket — Retrieve Live Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Websocket —检索实时数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/websocket-retrieve-live-data-f539b1d9db1e?source=collection_archive---------9-----------------------#2020-03-18">https://towardsdatascience.com/websocket-retrieve-live-data-f539b1d9db1e?source=collection_archive---------9-----------------------#2020-03-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b6a7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何有效检索实时加密货币价格</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/507787c3decfb844377f7cc67ee32f20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UtePojcgIC-BB6ol387_LQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">诺亚·西利曼在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="kz la l"/></div></figure><blockquote class="lb"><p id="c8bc" class="lc ld it bd le lf lg lh li lj lk ll dk translated">为什么我们需要学习如何从 WebSocket 中提取数据？</p><p id="570d" class="lc ld it bd le lf lm ln lo lp lq ll dk translated">不是已经可以抓取几乎所有类型的网站了吗？</p></blockquote><p id="4c68" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml ll im bi translated">首先我简单介绍一下 WebSocket，你就知道为什么我们需要学习如何刮了。</p><p id="c860" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">Websocket 协议用于提供持久的实时连接。这意味着大多数网站使用 WebSocket 从其服务器向网络发送实时数据，以便您能够查看不断变化的实时数据。</p><p id="048c" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">你可能会问，一般什么样的网站会用 WebSocket？</p><p id="d0a2" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">我知道有一些特定类型的网站使用 WebSocket。例如，现场赌博、加密货币和股票市场网站。</p><p id="10cf" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">现在，让我们全面了解 WebSocket 是如何工作的。为了让它更实用，我将使用 Python 来抓取<strong class="lt iu"> Cryptocompare </strong>(一家全球加密货币市场数据提供商)作为示例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/27a937510c649e876baa37696a268972.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*2U3SWbyIhtdJHyT8GEm7fA.jpeg"/></div></figure><p id="7fb3" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">首先，您需要找到 WebSocket URI。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/fabb9ce922877750c207ab005c76cb20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r9Aa_2jKNRehgoga04eysA.png"/></div></div></figure><p id="7f5f" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">在这里，我使用 Chrome 开发工具来检查。打开 Chrome DevTools 后，点击 WS (Web Socket)标签，然后你就可以找到上面紫色方框所包围的请求 URL。</p><p id="e8d5" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">request _ URL:WSS://streamer . crypto compare . com/v2</p><p id="99c1" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">此外，需要注意的一点是成功状态代码不同于普通的请求。通常，当你请求一个网站时，成功状态码是 200，但是 WebSocket 的成功状态码是 101，在上面的截图中被红框包围。</p><p id="3e51" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">在开始握手部分之前，让我们讨论一些通过 WebSocket 连接时简单而重要的概念。让我们看看下面的图表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/facb4e73314d4518cded75d8f235f855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Znx6uWT6dxTRA48b-0FbjQ.png"/></div></div></figure><p id="0e0c" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">单击“消息”选项卡，您将看到与我相同的视图。你会注意到有绿色和红色的箭头。<strong class="lt iu">绿色箭头表示您正在向网站发送</strong>此消息。另一方面，<strong class="lt iu">红色箭头是通过 WebSocket 连接时您将收到的</strong>消息。</p><p id="08da" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">让我们进入下一部分——握手。还记得上图有个绿色箭头吗？这实际上是一个握手的过程。</p><p id="74df" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">这是什么意思？</p><p id="1d5f" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">你可以把这个过程想象成一个验证过程。在您设法将此消息发送到网站后，您将能够检索实时数据。整个过程到此结束，让我们进入代码部分。</p><p id="d435" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">您可以使用几个包，但是在这种情况下，我将使用<a class="ae ky" href="https://github.com/websocket-client/websocket-client" rel="noopener ugc nofollow" target="_blank"> websocket-client Python 包</a>。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="4693" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">编码部分</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt la l"/></div></figure><p id="834e" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">首先，您需要将 web 浏览器的标题复制到这里，并使用<code class="fe nu nv nw nx b">json.dumps</code>将其转换为字符串格式。</p><p id="85d2" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">之后，使用<code class="fe nu nv nw nx b">create_connection</code>创建到服务器的连接。然后，通过发送消息来执行握手，您将能够看到您这边的数据。</p><p id="4d4f" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">下面是您应该看到的类似输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/a69eb13883adf9681e41177347e8ba0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fZZZREqVFU18C2eunMmuCQ.png"/></div></div></figure><p id="150e" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">你可能会想，这条信息似乎毫无意义而且混乱，你确定价格在这里的信息里吗？</p><p id="736b" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">答案是肯定的。你可以看看上面截图中紫色方框所围的文字，那其实是 BTC 对美元的现价。</p><p id="02f8" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">抓取这个网站后，你会发现通过 WebSocket 检索信息是多么容易。如果你有兴趣知道为什么你应该勉强通过 WebSocket，请随意访问这个<a class="ae ky" rel="noopener" target="_blank" href="/scraping-in-another-dimension-7c6890a156da">链接</a>。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="f80b" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">最终想法</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/d94fe008773ae61a79e678fd77e94f22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lQCUy_0ZozDgq95Fym0yxg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">胡安·门德斯摄于<a class="ae ky" href="https://www.pexels.com/photo/smiling-woman-looking-upright-standing-against-yellow-wall-1536619/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a></p></figure><p id="e5e2" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">写这篇文章是为了回答我在文章评论区收到的一个问题。如果你有任何想让我澄清的问题，欢迎在下面评论。</p><p id="a6ab" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">谢谢你一直读到最后。下期帖子再见！</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="dd30" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">关于作者</h1><p id="c098" class="pw-post-body-paragraph lr ls it lt b lu oa ju lw lx ob jx lz ma oc mc md me od mg mh mi oe mk ml ll im bi translated"><a class="ae ky" href="https://www.linkedin.com/in/lowweihong/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">低伟鸿</a>是 Shopee 的数据科学家。他的经验更多地涉及抓取网站，创建数据管道，以及实施机器学习模型来解决业务问题。</p><p id="3dff" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">他提供爬行服务，可以为你提供你需要的准确和干净的数据。你可以访问<a class="ae ky" href="https://www.thedataknight.com/" rel="noopener ugc nofollow" target="_blank">这个网站</a>查看他的作品集，也可以联系他获取<strong class="lt iu">抓取服务</strong>。</p><p id="e465" class="pw-post-body-paragraph lr ls it lt b lu mm ju lw lx mn jx lz ma mo mc md me mp mg mh mi mq mk ml ll im bi translated">你可以在<a class="ae ky" href="https://www.linkedin.com/in/lowweihong/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae ky" href="https://medium.com/@lowweihong?source=post_page---------------------------" rel="noopener"> Medium </a>上和他联系。</p><div class="of og gp gr oh oi"><a href="https://medium.com/@lowweihong" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">●伟鸿-中等</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">在媒体上阅读低纬鸿的作品。数据科学家|网络抓取服务:https://www.thedataknight.com/.每…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">medium.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ks oi"/></div></div></a></div></div></div>    
</body>
</html>