<html>
<head>
<title>Python Rest API Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python Rest API示例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-rest-api-example-10c802e8ff24?source=collection_archive---------33-----------------------#2020-01-29">https://towardsdatascience.com/python-rest-api-example-10c802e8ff24?source=collection_archive---------33-----------------------#2020-01-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="76df" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Flask分享你的想法，Flask是<strong class="ak">数据科学家</strong>最流行的框架</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/ba9b03e4d0edfe90a9253edb3c97ced1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*ldDhJ2tbo3fpHK-Mf1rluw.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">由<a class="ae ku" href="https://unsplash.com/@zarakvg?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">扎拉克汗</a>在<a class="ae ku" href="https://unsplash.com/s/photos/flask?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="bd50" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们假设我们非常擅长创建机器学习模型，我们可以创建许多不同的有趣的项目。下一步是什么？我们如何与他人分享我们的知识？答案是做一个API。</p><p id="0079" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">根据<a class="ae ku" href="https://en.wikipedia.org/wiki/Application_programming_interface" rel="noopener ugc nofollow" target="_blank">维基百科</a>,<strong class="kx iu">应用编程接口</strong> ( <strong class="kx iu"> API </strong>)是<a class="ae ku" href="https://en.wikipedia.org/wiki/Client%E2%80%93server_model" rel="noopener ugc nofollow" target="_blank">客户端和</a>服务器之间的<a class="ae ku" href="https://en.wikipedia.org/wiki/Interface_(computing)" rel="noopener ugc nofollow" target="_blank">接口</a>或<a class="ae ku" href="https://en.wikipedia.org/wiki/Communication_protocol" rel="noopener ugc nofollow" target="_blank">通信协议</a>，旨在简化客户端软件的构建。听起来很复杂，但事实并非如此。</p><p id="c4db" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在本教程中，我们将把这个算法转换成一个API。</p><p id="2e90" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们看看代码。</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="cdf6" class="lw lx it ls b gy ly lz l ma mb">import PIL<br/>from PIL import Image<br/>import requests<br/>from io import BytesIO<br/>import webcolors<br/>import pandas as pd<br/><br/><br/>import webcolors<br/>  <br/>def closest_colour(requested_colour):<br/>    min_colours = {}<br/>    for key, name in webcolors. CSS3_HEX_TO_NAMES.items():<br/>        r_c, g_c, b_c = webcolors.hex_to_rgb(key)<br/>        rd = (r_c - requested_colour[0]) ** 2<br/>        gd = (g_c - requested_colour[1]) ** 2<br/>        bd = (b_c - requested_colour[2]) ** 2<br/>        min_colours[(rd + gd + bd)] = name<br/>    return min_colours[min(min_colours.keys())]<br/><br/><br/>def top_colors(url, n=10):<br/>    # read images from URL<br/>    response = requests.get(url)<br/>    img = Image.open(BytesIO(response.content))<br/><br/>    # convert the image to rgb<br/>    image = img.convert('RGB')<br/>     <br/>    # resize the image to 100 x 100<br/>    image = image.resize((100,100))<br/>     <br/>    detected_colors =[]<br/>    for x in range(image.width):<br/>        for y in range(image.height):<br/>            detected_colors.append(closest_colour(image.getpixel((x,y))))<br/>    Series_Colors = pd.Series(detected_colors)<br/>    output=Series_Colors.value_counts()/len(Series_Colors)<br/>    return(output.head(n).to_dict())</span></pre><p id="5eef" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">所以“<strong class="kx iu"> top color </strong>”函数所做的是给定一个图像的URL，它可以返回前10种主色。点击<a class="ae ku" href="https://predictivehacks.com/most-dominant-color-of-an-image/" rel="noopener ugc nofollow" target="_blank">此处</a>了解更多信息。</p><p id="054b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们必须在工作目录中用上面的代码创建一个<strong class="kx iu"> colors.py </strong>文件，这样我们就可以将函数导入到我们的flask代码中。</p><p id="2110" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们的API，<strong class="kx iu">的输出不能是熊猫数据帧。所以我们会把它转换成JSON。一个简单的方法是将数据帧作为字典返回，然后在我们的flask代码中，使用flask的Jsonify函数，我们可以将其转换为JSON。这就是我们使用。<strong class="kx iu"> top_colors </strong>函数中的to_dict()方法。</strong></p><h1 id="dd6d" class="mc lx it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">Python Rest API Flask脚本</h1><p id="4865" class="pw-post-body-paragraph kv kw it kx b ky mt ju la lb mu jx ld le mv lg lh li mw lk ll lm mx lo lp lq im bi translated">现在我们有了我们的函数，下一步是创建我们的Flask代码。在我们的工作目录中，我们必须用以下代码创建一个<strong class="kx iu"> main.py </strong>文件:</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="da91" class="lw lx it ls b gy ly lz l ma mb">from flask import Flask, jsonify, request<br/><br/>app=Flask(__name__)<br/><br/>#we are importing our function from the colors.py file<br/>from colors import top_colors<br/><br/><br/><a class="ae ku" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route("/",methods=['GET','POST'])<br/>def index():<br/>    if request.method=='GET':<br/>#getting the url argument       <br/>        url = request.args.get('url')<br/>        result=top_colors(str(url))<br/>#the jsonify function is converting the dictionary to JSON<br/>        return jsonify(result)<br/>    else:<br/>        return jsonify({'Error':"This is a GET API method"})<br/><br/><br/>if __name__ == '__main__':<br/>    app.run(debug=True,host='0.0.0.0', port=9007)</span></pre><p id="d40d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您不必理解整个脚本，只需将它作为您的API项目的基础。</p><p id="c5ce" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">首先我们必须从<strong class="kx iu"> colors.py </strong>文件中导入我们的函数<strong class="kx iu"> top_colors </strong>。使用<strong class="kx iu">url = request . args . get(' URL ')</strong>我们得到参数<strong class="kx iu"> "url" </strong>的值，在我们的例子中是一个图像的URL。</p><p id="4711" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然后，我们将这个值传递给我们的函数，并使用<strong class="kx iu"> jsonify库</strong>将它转换成一个JSON返回结果，正如我们上面所说的。</p><p id="423d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu"> if </strong>语句是为那些调用API作为POST方法的人准备的，这样它就可以返回一个警告。最后，端口由您决定，我们使用的是<strong class="kx iu"> 9007 </strong>。</p><p id="a5b6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">最后，我们可以运行<strong class="kx iu"> main.py </strong>文件在本地进行测试。只需在您的终端中运行以下命令:</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="c1cc" class="lw lx it ls b gy ly lz l ma mb"><br/>python main.py</span></pre><p id="746b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">输出将是这样的:</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="be57" class="lw lx it ls b gy ly lz l ma mb">* Serving Flask app "main" (lazy loading)<br/> * Environment: production<br/>   WARNING: Do not use the development server in a production environment.<br/>   Use a production WSGI server instead.<br/> * Debug mode: on<br/> * Restarting with stat<br/> * Debugger is active!<br/> * Debugger PIN: 220-714-143<br/> * Running on http://0.0.0.0:9007/ (Press CTRL+C to quit)</span></pre><p id="e9a8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这意味着我们的API运行在使用9007端口的本地主机上。</p><p id="18a3" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在我们可以用浏览器来测试它。要在API的URL中添加我们的变量(图片URL)，我们必须把它添加在末尾，如下所示<strong class="kx iu">？变量=。</strong>在我们的示例中，我们的API的URL如下:</p><p id="fd77" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe my mz na ls b">http://localhost:9007/</code> <strong class="kx iu">？URL =[[图片的URL]]</strong>。</p><p id="03c6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">例如，我们想从Unsplash中获取以下图像的主色:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/c9a2b94b3dddff56a2bad40499f61015.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*FEnGVLdhF4SAfcMyuwN7LQ.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">由<a class="ae ku" href="https://unsplash.com/@asast?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Á·萨·斯泰纳斯多蒂尔</a>在<a class="ae ku" href="/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="83a4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><a class="ae ku" href="https://images.unsplash.com/photo-1615479865224-b07bb46a5f56?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80" rel="noopener ugc nofollow" target="_blank">https://images . unsplash . com/photo-1615479865224-b 07 bb 46 a 5 f 56？ixid = mxwxmja 3 fdb 8 mhxwag 90 by 1 wywdlfhx 8 fgvufdb 8 fhw % 3D&amp;ixlib = r b-1 . 2 . 1&amp;auto = format&amp;fit = crop&amp;w = 1000&amp;q = 80</a></p><p id="833f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们在浏览器中点击了以下URL</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="80b7" class="lw lx it ls b gy ly lz l ma mb"><a class="ae ku" href="http://localhost:9007/?url=https://image.shutterstock.com/z/stock-photo-at-o-clock-at-the-top-of-the-mountains-sunrise-1602307492.jpg:" rel="noopener ugc nofollow" target="_blank">http://localhost:9007/?url=</a><a class="ae ku" href="https://images.unsplash.com/photo-1615479865224-b07bb46a5f56?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80" rel="noopener ugc nofollow" target="_blank">https://images.unsplash.com/photo-1615479865224-b07bb46a5f56?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80</a></span></pre><p id="509e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然后，我们将得到以下输出:</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="48f3" class="lw lx it ls b gy ly lz l ma mb">{'black': 0.2843,<br/> 'gainsboro': 0.2812,<br/> 'darkslategray': 0.1889,<br/> 'lavender': 0.0668,<br/> 'lightsteelblue': 0.0448,<br/> 'lightgray': 0.0405,<br/> 'darkgray': 0.0189,<br/> 'darkolivegreen': 0.0172,<br/> 'dimgray': 0.0144,<br/> 'lightslategray': 0.0129}</span></pre><p id="9a03" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">成功了，我们得到了那个图像的主色！下一步是在服务器上部署它。</p><h2 id="2423" class="lw lx it bd md nb nc dn mh nd ne dp ml le nf ng mn li nh ni mp lm nj nk mr nl bi translated">结论</h2><p id="4de1" class="pw-post-body-paragraph kv kw it kx b ky mt ju la lb mu jx ld le mv lg lh li mw lk ll lm mx lo lp lq im bi translated">构建API是数据科学家必须掌握的知识。迟早你会被要求为你的模型创建一个API来与开发者或项目的其他人分享，所以开始尝试吧！</p><p id="2a7c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">以后我会写更多初学者友好的帖子。<a class="ae ku" href="https://medium.com/@billybonaros" rel="noopener">在媒体上关注我</a>或<a class="ae ku" href="https://predictivehacks.com/" rel="noopener ugc nofollow" target="_blank">访问我的博客</a>了解他们。</p><p id="b40b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我欢迎提问、反馈和建设性的批评，你可以通过推特(Twitter)或社交网站(Instagram)联系我。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="c24a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><em class="nt">原载于2020年1月29日https://predictivehacks.com</em><em class="nt"/><a class="ae ku" href="https://predictivehacks.com/python-rest-api-example/" rel="noopener ugc nofollow" target="_blank"><em class="nt">。</em></a></p></div></div>    
</body>
</html>