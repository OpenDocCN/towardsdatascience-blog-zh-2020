<html>
<head>
<title>Build CICD pipeline on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 AWS 上构建 CICD 管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/ci-cd-logical-and-practical-approach-to-build-four-step-pipeline-on-aws-3f54183068ec?source=collection_archive---------18-----------------------#2020-05-29">https://towardsdatascience.com/ci-cd-logical-and-practical-approach-to-build-four-step-pipeline-on-aws-3f54183068ec?source=collection_archive---------18-----------------------#2020-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c4c0" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">DevOps — AWS CI/CD</h2><div class=""/><div class=""><h2 id="482d" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">在 20 分钟内建立一个无服务器的全自动 CICD 管道。</h2></div><p id="e212" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在本文中，我们将使用 AWS 原生工具构建一个 4 步 CI/CD 管道。为了从概念上理解 CI/CD 渠道，强烈建议重温以前的文章<a class="ae lo" href="https://medium.com/@rashimparmar/continuous-integration-continuous-delivery-myths-pitfall-and-practical-approach-aaec22edacc5" rel="noopener"><em class="ln">&amp;持续集成【持续交付——神话、陷阱和，实用方法</em> </a> <em class="ln">。</em></p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/c261b49ecdd9b5d258d83135cc1ab12a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*gu4YU674fgqj1cgsQoXb3w.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">AWS 上的四步 CI/CD 管道</p></figure><p id="5c97" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi mb translated"><span class="l mc md me bm mf mg mh mi mj di">在</span>这篇文章中，我们将集体讨论选择构建 CI/CD 渠道的工具背后的思维过程和推理。在 AWS 平台上，我们将构建一个托管在 EC2 服务器上的简单 web 应用程序，并使用所有 AWS 本地服务。简要介绍为 CI/CD 实施选择正确工具的重要性:</p><p id="d808" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">安全性</strong> —任何实施的第一步都应该是安全性。总的来说，应用程序架构、硬件、网络和数据应该有助于构建安全的环境。</p><blockquote class="mk ml mm"><p id="d3b8" class="kr ks ln kt b ku kv kd kw kx ky kg kz mn lb lc ld mo lf lg lh mp lj lk ll lm im bi translated">还记得臭名昭著的优步事件吗？黑客获得了嵌入 GitHub 软件库中的 AWS 证书，窃取了 5700 万用户和 60 万名司机的个人信息。</p></blockquote><p id="5048" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">需要注意的一点是，每一层的安全性都很重要。</p><p id="79c3" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">架构</strong> —架构应该允许多个并发的实现。同时，它应该允许对应用程序进行严格的测试，以确保一次成功(FTR)。微服务架构最适合实现这些目标；然而，不同的应用程序可能有不同的适用架构，如面向服务的架构(SOA)和 Lambda 架构。最终，重点应该是实现目标。</p><p id="9129" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我们将使用以下服务建立 CI/CD 管道-</p><p id="ec1e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">源代码管理存储库:</strong> AWS 代码提交</p><p id="b28c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">构建:</strong> AWS 代码构建</p><p id="dafb" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">部署:</strong> AWS 代码部署</p><p id="622c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">通知:</strong> AWS SNS</p><p id="e1b3" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">托管网络服务器:</strong> EC2 AMI</p><p id="dda0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> CI/CD 管道:</strong> AWS 代码管道</p><h1 id="fc27" class="mq mr it bd ms mt mu mv mw mx my mz na ki nb kj nc kl nd km ne ko nf kp ng nh bi translated"><strong class="ak">阶段 1:源代码控制库——AWS 代码提交</strong></h1><p id="8057" class="pw-post-body-paragraph kr ks it kt b ku ni kd kw kx nj kg kz la nk lc ld le nl lg lh li nm lk ll lm im bi translated">AWS 代码提交是无服务器的。默认情况下，静态数据是加密的，并且为传输中的数据启用了 SSH 或 HTTPS 端点。它提供数据持久性、数据可用性、自动扩展，并且更重要的数据存储在远离计算资源的地方。同时也相当便宜。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/d46dae25a3cba07cfe79ba25b67e0912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*AHwVaw2wmbvVJmNcK2RTng.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">AWS 代码提交流程</p></figure><p id="d9e2" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我们将在 AWS 上设置代码库，将代码从本地机器推送到代码提交库。在整篇文章中，我们将使用 AWS 地区作为所有服务的 us-east-1 (N. Virginia)。</p><ol class=""><li id="2fa6" class="no np it kt b ku kv kx ky la nq le nr li ns lm nt nu nv nw bi translated"><strong class="kt jd">创建存储库- </strong>登录 AWS 管理控制台，搜索代码提交。在主页上，单击“创建存储库”。填写以下详细信息，然后单击“创建”</li></ol><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/4c067140c0a886b7f3eb238e0ccd06cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*hLj-sDPHHQBl4crggCAUhg.png"/></div></figure><p id="b02f" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我们可以使用 CodeCommit 控制台、AWS CLI 或 GIT 客户端将代码推送到 CodeCommit。在本文中，我们将使用 GIT bash。如果还没有安装 GIT 客户端，请按照官方<a class="ae lo" href="https://git-scm.com/" rel="noopener ugc nofollow" target="_blank">网站</a>给出的说明进行安装。</p><p id="8bd3" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 2。克隆存储库</strong>——在 AWS 控制台中，选择页面右上角的克隆 URL，然后选择克隆 HTTPS。克隆 GIT 存储库的地址被复制到剪贴板。打开 GIT bash，键入命令 GIT clone，后面跟着前面复制的 URL。这是第一次，它将提示输入通过 GIT 连接到 AWS 的凭证。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/bf01f2e73c573d36b78882e862fc626b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*9NcaIo49a5AzPx_bOYCRTQ.png"/></div></figure><p id="1bf6" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 3。将代码推送到库— </strong>点击<a class="ae lo" href="https://github.com/rashimparmar/awscicd" rel="noopener ugc nofollow" target="_blank">此处</a>或按照截图从我的 Github 库中下载示例代码。将代码放在文件夹 DemoCICD 中。作为最佳实践，我们应该创建一个分支并将代码合并到分支，但是为了使本文简单，我们现在将代码合并到主节点。切换到当前目录，使用下面的命令添加新文件。切换到当前目录，使用下面的命令添加新文件。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi lp"><img src="../Images/0dc94aa6a5a31e07ac5d7a97dd9ab951.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*B_mWHoWYIacThIT2CsrIDg.png"/></div></div></figure><p id="8ecb" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">添加新文件后，使用下面的命令提交更改</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/d4995f00188d2713a0e6725e75f55ba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*25VSzp7cE3Xwys2lKmaqyw.png"/></div></figure><p id="5b3b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在使用下面的命令将文件推送到 AWS CodeCommit 存储库</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/9d9ccf07dbe41cd372efbc9b137c4934.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*EOC5TBa6w0PC5f7l0mt3kw.png"/></div></figure><p id="9f87" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">检查 AWS 中的存储库，应复制所有文件。Appspec.yml 包含 CodeDeploy 的设置。Buildspec.yml 包含代码构建的设置</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/ce2c8210a654937406a78df3dbdf6eaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*3OuhTJxwt4K_CPf8MNpOlg.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">AWS 代码提交存储库</p></figure><h1 id="23e3" class="mq mr it bd ms mt mu mv mw mx my mz na ki nb kj nc kl nd km ne ko nf kp ng nh bi translated"><strong class="ak">构建的先决条件:</strong></h1><p id="7698" class="pw-post-body-paragraph kr ks it kt b ku ni kd kw kx nj kg kz la nk lc ld le nl lg lh li nm lk ll lm im bi translated"><strong class="kt jd"> EC2 实例托管应用程序并部署代码部署代理- </strong>我们将启动 EC2 Linux 实例来托管 web 应用程序。然后我们将部署 codedeploy 代理，以便将构建工件部署到机器上。在启动实例之前，让我们创建一个 IAM 角色来分配正确的访问权限。</p><p id="b9b1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">实例角色</strong></p><p id="7071" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">1.点击此处的<a class="ae lo" href="https://console.aws.amazon.com/iam/" rel="noopener ugc nofollow" target="_blank">打开 IAM 控制台</a></p><p id="77a3" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">2.从控制台仪表板中，选择角色，然后选择创建角色。</p><p id="da69" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">3.在“选择受信任实体的类型”下，选择 AWS 服务。在选择用例下，选择 EC2，然后选择下一步-权限。</p><p id="8029" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">4.搜索并选择名为 AmazonEC2RoleforAWSCodeDeploy 的策略，然后选择 Next- Tags。</p><p id="eece" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">5.选择下一步:复习。输入角色的名称(例如，DemoCICDEC2InstanceRole)，然后选择“创建角色”。</p><p id="99fe" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">启动 EC2 实例:</strong></p><p id="5baf" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">1.点击<a class="ae lo" href="https://console.aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank">这里</a>打开亚马逊 EC2 控制台</p><p id="9605" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">2.从控制台仪表板中，选择启动实例</p><p id="a74e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">3.在步骤 1:选择一个 Amazon 机器映像(AMI)，找到 Amazon Linux 2 AMI (HVM)，SSD 卷类型，然后选择 Select。</p><p id="121e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">4.在“步骤 2:选择实例类型”页面上，选择 t2.micro 类型(符合自由层条件)，然后选择下一步-配置实例详细信息。</p><p id="99b0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">5.在“步骤 3:配置实例详细信息”页面上，执行以下操作:</p><p id="6823" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在自动分配公共 IP 中，选择启用。</p><p id="eca2" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在 IAM 角色中，选择您在前面的过程中创建的 IAM 角色(例如，DemoCICDEC2InstanceRole)。</p><p id="88eb" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">6.展开高级详细信息，并在用户数据字段中输入将在启动安装时执行的以下脚本。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi ob"><img src="../Images/3824597f0904b78e64c48019dc838256.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJzLQt5WrupGakpHNx0_SA.png"/></div></div></figure><p id="548c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">7.点击添加存储-&gt;点击添加标签-&gt;创建一个标签，其关键字为“目的”，值为 DemoCICD”。我们将使用这些标记来标识 EC2 实例以进行部署。-&gt;配置安全组</p><p id="a49f" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">8.在“配置安全组”下，选择分配安全组:“创建新的安全组”。安全组名称为“SG-EC2-CICD”。添加 SSH(通过 putty 访问实例)和 HTTP(访问 web 应用程序)类型的端口，并在 source 中选择“My IP”。点击“查看并启动”。下载密钥文件，然后按“启动”。</p><h1 id="6bac" class="mq mr it bd ms mt mu mv mw mx my mz na ki nb kj nc kl nd km ne ko nf kp ng nh bi translated"><strong class="ak">构建包— AWS 代码构建</strong></h1><p id="07f6" class="pw-post-body-paragraph kr ks it kt b ku ni kd kw kx nj kg kz la nk lc ld le nl lg lh li nm lk ll lm im bi translated">AWS service CodeBuild 是一个完全托管的服务，它编译代码、运行测试并创建一个可以随时部署的软件包。选择这项服务的原因是</p><p id="6bb3" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">无服务器</strong> —您不需要管理构建服务器。</p><p id="a777" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">可伸缩性</strong> —它自动伸缩，可以同时处理多个构建。</p><p id="6027" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">经济高效的</strong> — CodeBuild 基于“按需付费”模式，这意味着构建一个包需要按分钟付费。</p><p id="d53d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">安全— </strong>构建工件使用由 AWS KMS 管理的客户专用密钥进行加密。此外，可以使用 AWS IAM 提供细粒度的访问。记住提供最低特权访问。</p><p id="f2b6" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">下一步是从 CodeCommit 中的代码构建一个包。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/c7cde923d9b6ebf353df2b43ab0250e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*4s96lIH0zSxcH0DFJVYvAQ.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">AWS 代码构建流程</p></figure><h2 id="ac87" class="oc mr it bd ms od oe dn mw of og dp na la oh oi nc le oj ok ne li ol om ng iz bi translated"><strong class="ak">构建项目:</strong></h2><p id="2537" class="pw-post-body-paragraph kr ks it kt b ku ni kd kw kx nj kg kz la nk lc ld le nl lg lh li nm lk ll lm im bi translated">在这一步中，我们将创建一个构建项目，AWS CodeBuild 将使用它来运行构建。登录 AWS 管理控制台并搜索 CodeBuild 或点击<a class="ae lo" href="https://console.aws.amazon.com/codesuite/codebuild/home" rel="noopener ugc nofollow" target="_blank">此处</a>。选择同一个 AWS 地区(N. Virginia)。单击“创建构建”并填写以下详细信息:</p><p id="6316" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">项目名称:</strong> BuildCICD。根据最佳实践填写描述并创建标签。</p><p id="3d3e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">源下:</strong>源提供者— AWS 代码提交，存储库— DemoCICD，引用类型—分支，分支主</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/daa97f24583033f9a5f53f35cf397525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*BaEvLCevWXDJ1YfzIAIURQ.png"/></div></figure><p id="2759" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在环境下—选择托管映像，操作系统为 Amazon Linux 2，运行时—标准，映像—Amazon Linux 2–86 _ 64—标准:1.0(或适合您的使用情形)，服务角色—新服务角色</p><p id="bf77" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在 Buildspec 下——选择一个 buildspec 文件(我们将很快对此进行讨论)</p><p id="6b43" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">保持其他一切不变，然后单击 create build project</p><p id="17c5" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">build spec—build spec 是 codeBuild 服务用来运行构建的命令和相关设置的集合。您可以将 buildspec.yml 文件作为源代码的一部分，或者在构建项目时输入构建命令。我们已经在代码库中上传了 buildspec.yml 文件。</p><p id="e2ed" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">它可以有不同的阶段，如安装、预构建、构建和后构建。</p><h1 id="389d" class="mq mr it bd ms mt mu mv mw mx my mz na ki nb kj nc kl nd km ne ko nf kp ng nh bi translated"><strong class="ak">使用 AWS 代码部署的部署</strong></h1><p id="e85b" class="pw-post-body-paragraph kr ks it kt b ku ni kd kw kx nj kg kz la nk lc ld le nl lg lh li nm lk ll lm im bi translated">CodeDeploy 是一个完全托管的服务，用于完全自动化软件部署。它可用于将代码部署到 AWS EC2 或本地服务器、AWS Fargate 和 AWS Lambda。优点是</p><p id="52bf" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">完全托管服务:</strong> CodeDeploy 可随您的基础设施自动扩展，这意味着除了您正在部署的基础设施(如 EC2)之外，无需管理任何其他基础设施。CodeDeploy 可以与自动扩展组集成，以自动扩展 EC2 容量。</p><p id="0d4a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">蓝/绿展开:</strong>该选项对应蓝/绿展开。应用程序的新版本与旧版本一起启动。一旦新版本经过测试并宣布就绪，CodeDeploy 就可以根据您的规范将流量从您以前的版本转移到您的新版本。</p><p id="611a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">集中控制— </strong> CodeDeploy 允许您轻松启动和跟踪部署状态。它提供了详细的部署报告，您可以为更新配置推送通知。</p><p id="b42d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">定价— </strong>通过 CodeDeploy 部署到 EC2 或 AWS Lambda 是免费的。对于其余的部署，它非常便宜。</p><p id="26b0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在代码部署中，我们将创建一个包含要部署的软件应用程序的应用程序。我们将创建 CodeDeploy 包并将其安装到 EC2 实例中。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/f0fd43641628ccc9e02ceb9ff0778ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*wvXq5wbeybcI22Zf64wSOw.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">AWS 代码部署流程</p></figure><p id="739f" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">CodeDeploy 角色:在 IAM 控制台中，通过单击“选择受信任实体的类型”下的<strong class="kt jd">创建角色- &gt; </strong>来创建角色，在“选择用例”下选择 AWS 服务- &gt;，选择“CodeDeploy - &gt;选择“下一步:权限”AWSCodeDeployRole 托管策略已附加到角色- &gt;选择“下一步:标记- &gt;下一步:审阅- &gt;输入角色的名称(CodeDeploy) - &gt;创建角色。</p><h2 id="ee55" class="oc mr it bd ms od oe dn mw of og dp na la oh oi nc le oj ok ne li ol om ng iz bi translated">在代码部署中创建应用程序</h2><p id="bf6d" class="pw-post-body-paragraph kr ks it kt b ku ni kd kw kx nj kg kz la nk lc ld le nl lg lh li nm lk ll lm im bi translated">1.单击此处的<a class="ae lo" href="https://console.aws.amazon.com/codedeploy" rel="noopener ugc nofollow" target="_blank">打开 CodeDeploy 控制台</a></p><p id="4ded" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">2.如果“应用程序”页面没有出现，请在“AWS 代码部署”菜单上选择“应用程序”。</p><p id="3d78" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">3.选择创建应用程序。在应用程序名称中，输入 CICDDemoApplication。</p><p id="673d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">4.在计算平台中，选择 EC2/内部部署。</p><p id="cd08" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">5.选择创建应用程序。</p><p id="df35" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">部署组— </strong>在部署组中，我们将定义与部署相关的设置。在显示应用程序的页面上，选择“创建部署组”。</p><ol class=""><li id="3b33" class="no np it kt b ku kv kx ky la nq le nr li ns lm nt nu nv nw bi translated">在部署组名称中，输入 DemoCICDDeploy。</li><li id="d31d" class="no np it kt b ku on kx oo la op le oq li or lm nt nu nv nw bi translated">在“服务角色”中，选择您之前创建的服务角色(例如，CodeDeploy)。</li><li id="cdc6" class="no np it kt b ku on kx oo la op le oq li or lm nt nu nv nw bi translated">在“部署类型”下，选择“就地”。</li><li id="605a" class="no np it kt b ku on kx oo la op le oq li or lm nt nu nv nw bi translated">在环境配置下，选择 Amazon EC2 实例。在“关键字”字段中，输入用于标记实例的名称(例如，MyCodePipelineDemo)。</li><li id="dec9" class="no np it kt b ku on kx oo la op le oq li or lm nt nu nv nw bi translated">在部署配置下，选择 CodeDeployDefault.OneAtaTime。</li><li id="5bb6" class="no np it kt b ku on kx oo la op le oq li or lm nt nu nv nw bi translated">在“负载平衡器”下，清除“启用负载平衡”。对于本文，您不需要设置负载平衡器或选择目标组。</li><li id="4ff8" class="no np it kt b ku on kx oo la op le oq li or lm nt nu nv nw bi translated">选择创建部署组。</li></ol><p id="e519" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">至此，我们已经完成了构建管道所需的所有服务的配置。现在，我们将使用上面创建的服务构建一个即插即用的 CI/CD 管道。</p><h1 id="06dd" class="mq mr it bd ms mt mu mv mw mx my mz na ki nb kj nc kl nd km ne ko nf kp ng nh bi translated"><strong class="ak"> CI/CD 管道</strong></h1><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/c261b49ecdd9b5d258d83135cc1ab12a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*gu4YU674fgqj1cgsQoXb3w.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">四步 AWS CI/CD 管道</p></figure><p id="f693" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">AWS 代码管道是一个完全托管的无服务器服务，有助于自动化整个软件交付版本。这是一个管道，我们可以在其中以任何顺序和任何次数调用所有其他服务，如代码构建、代码提交、手动批准、测试和部署等。它之所以适合，是因为它完全不需要服务器，采用随用随付的方式，成本模型完全安全且可配置的工作流，并且支持一个位置监控和快速软件交付。</p><p id="fc08" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">1.登录 AWS 管理控制台，点击<a class="ae lo" href="http://console.aws.amazon.com/codesuite/codepipeline/home" rel="noopener ugc nofollow" target="_blank">这里</a>打开代码管道控制台</p><p id="06c7" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">2.选择创建管道。将管道名称命名为“DemoCICD”。按如下所述填写详细信息:</p><h2 id="00ae" class="oc mr it bd ms od oe dn mw of og dp na la oh oi nc le oj ok ne li ol om ng iz bi translated">源阶段</h2><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/5dac66c75e0ac4f1c9afb65be44dbd3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*msG6Byft36gRC-vNB3RUiA.png"/></div></figure><h2 id="46d3" class="oc mr it bd ms od oe dn mw of og dp na la oh oi nc le oj ok ne li ol om ng iz bi translated"><strong class="ak">构建阶段- </strong></h2><p id="e21f" class="pw-post-body-paragraph kr ks it kt b ku ni kd kw kx nj kg kz la nk lc ld le nl lg lh li nm lk ll lm im bi translated">提供作为 AWS 代码构建的构建提供程序，并按如下所述填写详细信息，然后单击下一步。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/91bcbebee1941af73c2830a4e489f840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*URpglyiGkWE-NgYNbc-dtQ.png"/></div></figure><h2 id="dc32" class="oc mr it bd ms od oe dn mw of og dp na la oh oi nc le oj ok ne li ol om ng iz bi translated"><strong class="ak">部署阶段</strong></h2><p id="ed05" class="pw-post-body-paragraph kr ks it kt b ku ni kd kw kx nj kg kz la nk lc ld le nl lg lh li nm lk ll lm im bi translated">选择 deploy provider as CodeDeploy，并像下面这样填写其余的详细信息。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi lp"><img src="../Images/d8b6523dd0455cc4f570a736164a4de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*kOX56nMTPv8XvZGzh4qIAQ.png"/></div></div></figure><p id="797e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">单击下一步并查看更改。如果一切正常，那么点击创建管道。这将首次启动管道。如果一切都设置正确，它应该会成功。现在，这是持续部署。如果您提交任何更改，管道将自动触发。因为我们已经创建了一个 web 服务器，所以您可以尝试使用 EC2 实例公共 IP 访问网站。</p><h2 id="12ee" class="oc mr it bd ms od oe dn mw of og dp na la oh oi nc le oj ok ne li ol om ng iz bi translated">产品升级和技术支持服务-手动批准:</h2><p id="f293" class="pw-post-body-paragraph kr ks it kt b ku ni kd kw kx nj kg kz la nk lc ld le nl lg lh li nm lk ll lm im bi translated">让我们创建一个新步骤来添加手动批准。为此，请单击管道页面上的编辑。我们将在构建阶段后添加批准。为此，在构建阶段后单击+添加阶段。命名为“生产-签署”。在“生产-签署”下，单击“添加行动组”。我已经创建了一个 SNS 主题来发送电子邮件给我审批。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/9f17f50564fcfa9b7579066cef7aa7c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*cz_nClqrbqfj2hEqY0H7OA.png"/></div></figure><p id="e728" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">单击完成。这样，我们成功地添加了一个手动批准阶段。为了自动触发完整的管道，我们只需在本地修改 index.html，然后进行代码提交。我已经添加了一个重定向到我在 index.html 的媒体简介。这将自动启动管道。你的收件箱里一定有一封批准它的邮件。一旦完成应用程序将被部署，你可以使用 EC2 实例公共地址访问网站。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/1bd31ef9aa1fb06fa19cf6d45dd843a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*kXeusMgoru1LFlubCTl2Ew.png"/></div></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/07ca36e615abd14a4ffe1ce6faa87472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*bawFu1c699vTFxxlfjFgDA.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">部署前的电子邮件批准</p></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi os"><img src="../Images/a4f30c19e0d5c076835025780ea8a54e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*_5QUTzTCUEwQeLRnaWfd8w.gif"/></div></figure><h1 id="4097" class="mq mr it bd ms mt mu mv mw mx my mz na ki nb kj nc kl nd km ne ko nf kp ng nh bi translated">结论:</h1><p id="f4bc" class="pw-post-body-paragraph kr ks it kt b ku ni kd kw kx nj kg kz la nk lc ld le nl lg lh li nm lk ll lm im bi translated">我们已经成功建立了一个 4 步 CI/CD 管道。记住舞台布置应该仔细考虑。如果你喜欢这篇文章，请告诉我，并关注我的下一篇文章。</p><p id="8b3b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><em class="ln">免责声明——本文中的观点仅代表作者个人，并不代表作者所属任何组织的观点。</em></p></div></div>    
</body>
</html>