<html>
<head>
<title>Classification with Random Forests in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中的随机森林分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/classification-with-random-forests-in-python-29b8381680ed?source=collection_archive---------24-----------------------#2020-06-11">https://towardsdatascience.com/classification-with-random-forests-in-python-29b8381680ed?source=collection_archive---------24-----------------------#2020-06-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bd4f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">随机森林分类模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/078dc1f56fdb0785b03f6cfad7c91936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U9HwlLqOtRs18313Cl-r9Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pexels.com/photo/nature-forest-trees-fog-4827/" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="7df4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随机森林算法是一种机器学习方法，可用于监督学习任务，如分类和回归。该算法通过构建一组在随机特征子集上训练的决策树来工作。在分类的情况下，随机森林模型的输出是决策树中预测类的模式。在本帖中，我们将讨论如何在 python 中为分类任务构建随机森林模型。</p><p id="845a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><h2 id="7b24" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">随机森林分类</h2><p id="81c9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">对于我们的分类任务，我们将使用<em class="mt">蘑菇分类</em>数据集，可以在<a class="ae ky" href="https://www.kaggle.com/uciml/mushroom-classification" rel="noopener ugc nofollow" target="_blank">这里</a>找到。我们将对一个二元目标进行预测，该目标指定蘑菇是有毒的还是可食用的。</p><p id="6f0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们导入 pandas 库并将我们的数据读入数据框:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="e84e" class="lv lw it mv b gy mz na l nb nc">import pandas as pd <br/>df = pd.read_csv("mushrooms.csv")</span></pre><p id="61f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们打印数据框的形状:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="ab77" class="lv lw it mv b gy mz na l nb nc">print("Shape: ", df.shape)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/c8ce286f609b933d353480b0bfc328e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*lyLqe3qpBfsJvrv4LCyPwQ.png"/></div></figure><p id="51d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们打印数据框中的列:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="8a8f" class="lv lw it mv b gy mz na l nb nc">print(df.columns)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/509f720cd3a28c4ee4bc0ae2ea04859a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BSKTSRXBMEunQXPC55tJAg.png"/></div></div></figure><p id="519a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们也来看看前五行的数据。head()'方法:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="c7cc" class="lv lw it mv b gy mz na l nb nc">print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/0b2d02230c3a378a2a2086eb3082cf54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2JKz6XCb8Co3QuXXBo0MQg.png"/></div></div></figure><p id="b281" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">属性信息如下</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/9b2d7bbd04621fa422134810ffd27e93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kKi_oa_S_KOqEcCjX0mkZQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.kaggle.com/uciml/mushroom-classification" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="0c35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将预测蘑菇的类别，其中可能的类别值为“e”表示可食用,“p”表示有毒。接下来我们将把每一列转换成机器可读的分类变量:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="cd70" class="lv lw it mv b gy mz na l nb nc">df_cat = pd.DataFrame()<br/>for i in list(df.columns):<br/>    df_cat['{}_cat'.format(i)] = df[i].astype('category').copy()<br/>    df_cat['{}_cat'.format(i)] = df_cat['{}_cat'.format(i)].cat.codes</span></pre><p id="bff7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们打印结果数据框的前五行:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="cf83" class="lv lw it mv b gy mz na l nb nc">print(df_cat.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/d008e061054412bbbabbe6812ecdcf7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2RHLPJicMxZRdg2DilV9sA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/e76d1d3de493636684280f854b3d5fa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oymS929OwE9C9aOMsoSwxg.png"/></div></div></figure><p id="1448" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们定义我们的功能和目标:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="06e9" class="lv lw it mv b gy mz na l nb nc">X = df_cat.drop('class_cat', axis = 1)<br/>y = df_cat['class_cat']</span></pre><p id="f3d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们从“sklearn”导入随机森林分类器:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="4f3c" class="lv lw it mv b gy mz na l nb nc">from sklearn.ensemble import RandomForestClassifier</span></pre><p id="e943" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们从‘sk learn’中的型号选择模块导入‘KFold’。我们将“折叠”以验证我们的模型。此外，我们将使用 f1 分数作为我们的准确度指标，它是准确度和召回率的调和平均值。让我们也用两次分割初始化“KFold”对象。最后，我们将初始化一个列表，我们将使用它来附加我们的 f1 分数:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="c6a7" class="lv lw it mv b gy mz na l nb nc">from sklearn.model_selection import KFold<br/>kf = KFold(n_splits=2, random_state = 42)<br/>results = []</span></pre><p id="89b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们迭代数据中的索引，并拆分数据用于训练和测试:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="d050" class="lv lw it mv b gy mz na l nb nc">for train_index, test_index in kf.split(X):<br/>     X_train, X_test = X[train_index], X[test_index]<br/>     y_train, y_test = y[train_index], y[test_index]</span></pre><p id="819f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 for-loop 中，我们将定义随机森林模型对象，适合不同的训练数据折叠，预测相应的测试数据折叠，评估每次测试运行的 f1 分数，并将 f1 分数附加到我们的“结果”列表中。我们的模型将使用 100 个估计器，对应于 100 个决策树:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="4d26" class="lv lw it mv b gy mz na l nb nc">for train_index, test_index in kf.split(X):<br/>     ...<br/>     model = RandomForestClassifier(n_estimators = 100, random_state = 24)<br/>     model.fit(X_train, y_train)<br/>     y_pred = model.predict(X_test)<br/>     results.append(f1_score(y_test, y_pred))</span></pre><p id="140c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们打印模型的平均性能:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="4efe" class="lv lw it mv b gy mz na l nb nc">print("Accuracy: ", np.mean(results))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/0f1f4352263d3bcaec2389e1fc60d93e.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*7B1QGd_sylYIG2p0dUuS5Q.png"/></div></figure><p id="6d4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们将拆分数量增加到 5，则我们有:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="1ba1" class="lv lw it mv b gy mz na l nb nc">kf = KFold(n_splits=3)<br/>...<br/>print("Accuracy: ", np.mean(results))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/3356fe7866f2bd1f4fdb49360378407b.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*C1Wje6OQ8H_vae2X0TOwzQ.png"/></div></figure><p id="760d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我就讲到这里，但是我鼓励你自己动手处理数据和编写代码。</p><h2 id="e801" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结论</h2><p id="da1e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">总之，在这篇文章中，我们讨论了如何用 python 训练一个随机森林分类模型。我们展示了如何将分类特征值转换成机器可读的分类值。此外，我们还展示了如何分割用于训练和测试的数据，初始化我们的随机森林模型对象，使其适合我们的训练数据，以及测量我们的模型的性能。我希望你觉得这篇文章有用/有趣。这篇文章中的代码可以在<a class="ae ky" href="https://github.com/spierre91/medium_code/blob/master/machine_learning/rf_classification.py" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。感谢您的阅读！</p></div></div>    
</body>
</html>