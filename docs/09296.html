<html>
<head>
<title>Slideio: a new python library for reading medical images.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Slideio:一个用于阅读医学图像的新 python 库。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/slideio-a-new-python-library-for-reading-medical-images-11858a522059?source=collection_archive---------16-----------------------#2020-07-03">https://towardsdatascience.com/slideio-a-new-python-library-for-reading-medical-images-11858a522059?source=collection_archive---------16-----------------------#2020-07-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/98da35240df8a68761c7af4e845cfab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ojeshM6TRAVDphBUmw0dhA.png"/></div></div></figure><p id="c296" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个新的 python 库的介绍，用于医学图像的阅读。更多详细信息可在项目网站上找到:<a class="ae kw" href="http://www.slideio.com" rel="noopener ugc nofollow" target="_blank">www.slideio.com</a>。源代码可以在 GitLab 的知识库中找到:【https://gitlab.com/bioslide/slideio<a class="ae kw" href="https://gitlab.com/bioslide/slideio" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="f4d9" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h1><p id="4040" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">医学图像—由生物扫描仪、显微镜等产生的图像。与普通图像不同。其中一个重要的区别是它们的大小。这种图像可能非常大。目前，大小为几十亿字节的幻灯片并不罕见。另一个区别是维度的数量。许多生物图像格式支持 3 维和 4 维(体积和时间序列)。除了传统的尺寸之外，一些格式引入了扫描仪特定的尺寸，如焦距、旋转(对于从各种角度记录的数据)、相位指数等。</p><p id="42aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不可能用传统的压缩方法来编码数千兆像素的图像。jpeg 或 png 等图像编解码器需要将整个图像保存到计算机内存中，以便在屏幕上显示，甚至读取图像的一小部分。生物格式使用平铺方法和缩放金字塔来解决这些问题。它允许以最小的内存和计算资源读取任意比例的图像的任意区域。缩放金字塔是一组不同比例的图像副本。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/00e479e7738d3971a53bf7197ca9df2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AZQiYta0nZTsbzcfOxwWyQ.png"/></div></div></figure><p id="0fc0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Slideio library 旨在使用医学图像的内部结构来读取医学图像，以尽可能提高过程的性能。Slideio 并不是第一个提供这种功能的库。在我的图像分析实践中，我使用了许多不同的库。但到目前为止，我没有找到任何库可以满足我对图像分析的所有要求。所以我决定创建我自己的，它应该聚合我在这方面的经验。</p><p id="de28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该库有一个驱动程序架构。每个驱动程序支持一种或多种图像格式。slideio 的第一个版本提供了 4 个驱动程序:</p><ul class=""><li id="40ac" class="mf mg iq ka b kb kc kf kg kj mh kn mi kr mj kv mk ml mm mn bi translated">CZI——读取<a class="ae kw" href="https://www.zeiss.com/microscopy/int/products/microscope-software/zen/czi.html" rel="noopener ugc nofollow" target="_blank">蔡司 CZI </a>图像的司机。</li><li id="e448" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">SVS——读取<a class="ae kw" href="https://tmalab.jhmi.edu/imagescope.html" rel="noopener ugc nofollow" target="_blank"> Aperio SVS </a>图像的驱动程序。</li><li id="74fe" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">AFI——读取离子荧光图像的驱动程序。</li><li id="424f" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">GDAL——读取 jpeg、png、tiff 等通用格式的驱动程序。它使用了流行的 c++图像库<a class="ae kw" href="https://gdal.org/" rel="noopener ugc nofollow" target="_blank"> GDAL </a>。</li></ul><p id="3a1c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Slideio 库有一个简单的对象结构:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/22553284456833700a08cccb10a41cd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:392/format:webp/1*SKF0gUhASmrU_ZK7k6a-kA.png"/></div></figure><p id="db3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">图像驱动程序创建幻灯片对象。Slide 对象代表单个图像文件(或文件夹，取决于图像格式)。幻灯片对象包含至少一个连续光栅区域的场景对象(2D 图像、体积、时间序列等)。一些图像格式支持单个场景，如单个组织扫描。一些格式允许在一个文件中存储多个组织区域。2D 场景的所有图层都具有相同的像素大小和分辨率。如果场景是 3D 体积，则该体积的所有切片具有相同的大小和分辨率。时间序列也是如此。</p><p id="05d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下代码片段显示了如何使用“SVS”图像驱动程序打开幻灯片:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h1 id="dda5" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">图像元数据</h1><p id="fdf5" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Slideio 库提供不同级别的图像信息。幻灯片对象具有属性“raw_metadata ”,该属性公开了从图像中提取的未修改的文本信息。文本内容特定于文件格式。在 Aperio SVS 幻灯片的情况下，它是从“图像信息”tiff 标签中提取的字符串。对于蔡司 CZI 文件，它是一个带有完整文件元数据的 XML 文档。以下是从 Aperio SVS 文件中检索元数据的代码片段:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="0e00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是代码示例产生的输出:</p><pre class="mb mc md me gt mw mx my mz aw na bi"><span id="ff27" class="nb ky iq mx b gy nc nd l ne nf">['Aperio Image Library vFS90 01\r\n20320x19545 [0,100 19919x19445] (240x240) JPEG/RGB Q=70',<br/> 'AppMag = 20',<br/> 'StripeWidth = 2032',<br/> 'ScanScope ID = SS1598',<br/> 'Filename = 24496',<br/> 'Date = 11/09/11',<br/> 'Time = 18:51:40',<br/> 'Time Zone = GMT+09:00',<br/> 'User = e8ddb309-efc1-4a6b-b9b0-7c555f9fa0ef',<br/> 'MPP = 0.4962',<br/> 'Left = 23.939867',<br/> 'Top = 19.531540',<br/> 'LineCameraSkew = 0.000320',<br/> 'LineAreaXOffset = 0.060417',<br/> 'LineAreaYOffset = 0.011084',<br/> 'Focus Offset = -0.000500',<br/> 'DSR ID = ap6101-dsr',<br/> 'ImageID = 24496',<br/> 'Exposure Time = 109',<br/> 'Exposure Scale = 0.000001',<br/> 'DisplayColor = 0',<br/> 'OriginalWidth = 20320',<br/> 'OriginalHeight = 19545',<br/> 'ICC Profile = ScanScope v1']</span></pre><h1 id="ef1c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">光栅存取</h1><p id="53f9" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">场景是访问栅格数据的主要对象。它公开了以下信息:</p><ul class=""><li id="04b9" class="mf mg iq ka b kb kc kf kg kj mh kn mi kr mj kv mk ml mm mn bi translated"><em class="ng">压缩</em>:数据压缩的类型；</li><li id="d0b2" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><em class="ng">放大</em>:扫描仪放大；</li><li id="76d4" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><em class="ng">名称</em>:场景名称；</li><li id="3258" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><em class="ng"> num_t_frames </em>:时间序列中的时间帧数；</li><li id="00e8" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><em class="ng"> num_z_slices </em>:卷中的切片数；</li><li id="e254" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><em class="ng"> rect </em>:场景矩形的坐标和尺寸；</li><li id="629e" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><em class="ng">分辨率</em>:场景平面内的分辨率(一个元组)；</li><li id="e80f" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><em class="ng"> t_resolution </em>，<em class="ng"> z_resolution </em>:场景在时间和 z 方向的分辨率；</li><li id="cde4" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><em class="ng">通道数</em>:场景中的通道数；</li><li id="935f" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><em class="ng">通道数据类型:</em>图像通道的数据类型(字节、16 位等。);</li><li id="ddfc" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><em class="ng">通道名称</em>:图像通道的名称。</li></ul><p id="1d8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下代码片段检索场景名称、矩形和分辨率。</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="c3e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它产生以下输出:</p><pre class="mb mc md me gt mw mx my mz aw na bi"><span id="0f93" class="nb ky iq mx b gy nc nd l ne nf">('Image', (0, 0, 19919, 19445), 3, (4.961999999999999e-07, 4.961999999999999e-07))</span></pre><p id="9b2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该图像的宽度为 19919 像素，高度为 19445 像素。每个像素在 x 和 y 方向上都是 0.4962 mkm。该图像有 3 个通道。生物图像中通道的含义取决于图像格式。对于亮场图像，它只是红色、绿色和蓝色。这种图像有 3 个 8 位通道。通道属性可通过方法<em class="ng"> get_chanel_data_type </em>和<em class="ng"> get_channel_name 访问。</em></p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><pre class="mb mc md me gt mw mx my mz aw na bi"><span id="2cb0" class="nb ky iq mx b gy nc nd l ne nf">uint8<br/>uint8<br/>uint8</span></pre><p id="cc9c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">方法<em class="ng"> read_block </em>检索连续区域的像素值。在没有参数的情况下执行该方法会以原始大小检索整个场景。通常情况下，由于尺寸较大，不可能以原始比例读取整个图像。在这种情况下，程序可以检索图像的一个区域，将其缩小到可接受的大小，或者检索一个缩小的区域。下面是一段代码。检索整个图像并将其缩放为 500 像素宽的图片。请注意，用零代替图片高度表示必须自动计算图片高度，以保持 x 和 y 方向的比例不变。</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/1ffa55c602e278937982551e62c2b52a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*rlBvPhkNg6RpE0HdU2kOHQ.png"/></div></figure><p id="c63d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面的代码片段从图像中读取一个矩形区域，并将其缩小为 500 像素宽的图片。</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/6dcfd2a1fd3ceac9adf727d4753f1110.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*x06LzyMs2pj6Jo95Nuog7A.png"/></div></figure><p id="10c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以读取单个通道或通道子集:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/9fc8fe4b17ba143ab325862335c83f00.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*p14plLjqEgbP_vQBm5OOGQ.png"/></div></figure><p id="004d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">附加的元组参数<em class="ng">切片</em>和<em class="ng">帧</em>允许读取体积和时间序列；</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><pre class="mb mc md me gt mw mx my mz aw na bi"><span id="e9a0" class="nb ky iq mx b gy nc nd l ne nf">(1000, 1000, 27)</span></pre><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h1 id="c586" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">装置</h1><p id="c98f" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">slideio 库可以与 pip 一起安装:</p><pre class="mb mc md me gt mw mx my mz aw na bi"><span id="7731" class="nb ky iq mx b gy nc nd l ne nf">pip install slideio</span></pre><p id="3c57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前，仅支持 Linux 和 Windows 版本。</p><h1 id="6b6f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="9e68" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Slideio 是一个用于阅读医学图像的 python 模块。它允许阅读整张幻灯片以及幻灯片的任何区域。大幻灯片可以有效地缩小尺寸。该模块使用图像的内部缩放金字塔来使缩放过程尽可能快。Slideio 支持 2D 幻灯片以及 3D 数据集和时间序列。</p><p id="8970" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该库以 numpy 数组的形式提供栅格，并与许多流行的图像分析库兼容，如<a class="ae kw" href="http://www.opencv.org" rel="noopener ugc nofollow" target="_blank"> opencv </a>。</p><p id="9b50" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前，它支持阅读 Aperio SVS 和 AFI 文件，蔡司 CZI 文件和通用格式。以下格式的即将推出的驱动程序:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/ecce888d04253ac81645b5e39ddb7326.png" data-original-src="https://miro.medium.com/v2/resize:fit:378/format:webp/1*SGk6uuaSWqrYho3F6C45nA.png"/></div></figure><ul class=""><li id="5a93" class="mf mg iq ka b kb kc kf kg kj mh kn mi kr mj kv mk ml mm mn bi translated">珀金埃尔默图像</li><li id="c551" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">徕卡 SCN 图像</li><li id="02e4" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">DICOM 数据集</li><li id="c6cd" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">徕卡 lif 图像</li><li id="1f7a" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">还有更多…</li></ul><p id="9169" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢您的阅读。如有任何意见或建议，我们将不胜感激。</p></div></div>    
</body>
</html>