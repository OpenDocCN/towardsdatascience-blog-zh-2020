<html>
<head>
<title>A Flask App for Image Recommendations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个推荐图片的 Flask 应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-flask-app-for-image-recommendations-a865e1496a0d?source=collection_archive---------13-----------------------#2020-08-06">https://towardsdatascience.com/a-flask-app-for-image-recommendations-a865e1496a0d?source=collection_archive---------13-----------------------#2020-08-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3e84" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">PyTorch 中基于卷积神经网络的相似图像推荐网站的实现</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/edc2cf2c30f5c577de17a306db695e6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yTgR6Hzd9QpRJUjR1ARrYg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片库和对所选图片的推荐(来源:M. D. Korzec)</p></figure><p id="deef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在创建了一个基于 Python 的机器学习应用程序后，你可能想让它在网站上运行。</p><p id="189a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这篇文章中，解释了如何通过基于图像的推荐系统的微框架 Flask 来实现这一点。</p><p id="4a9b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们在一个网站上实现了一个图像库，可以选择图像，并显示相似的图像。这种解决方案可以用于例如在线商店。</p><p id="1e51" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如前一篇文章所述，相似性是通过比较由预训练的 Resnet18 网络<a class="ae lr" rel="noopener" target="_blank" href="/recommending-similar-images-using-pytorch-da019282770c">导出的特征向量获得的。这项工作的结果是熊猫数据帧(本质上是表格),其中包含最相似图像的名称，以及每幅图像的相似值在 0(不相似)和 1(最相似)之间。这些在这里储存和使用。</a></p><p id="6740" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在下一张图中,( a)概述了理论和实施的步骤。本文主要讨论(b)部分，其中的数据框架已经离线计算，可以在网站上使用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/26913ecef2ebca5922e45703762862a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h72jdWWVpWPKZ24ASU4xLw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae lr" rel="noopener" target="_blank" href="/recommending-similar-images-using-pytorch-da019282770c?source=your_stories_page---------------------------">相似度矩阵计算(a </a>)和排序后的推荐前 k 列表(b)。在本文中，Flask 用于为一个网站使用结果(来源:M. D. Korzec，<a class="ae lr" href="http://flask.pocoo.org/static/logo/flask.svg" rel="noopener ugc nofollow" target="_blank"> Flask 标识，作者阿明·罗纳彻</a>，版权所有<a class="ae lr" href="https://commons.wikimedia.org/w/index.php?curid=19501815" rel="noopener ugc nofollow" target="_blank">免费使用</a></p></figure><p id="4d29" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将了解如何</p><ul class=""><li id="905d" class="lt lu iq kx b ky kz lb lc le lv li lw lm lx lq ly lz ma mb bi translated">安装 Flask 并在调试服务器上本地运行应用程序</li><li id="8e2b" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">定义所需的路径-用于图库和建议的 URL</li><li id="837b" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">将所需的信息从用户输入传输到后端，并将建议返回给用户</li><li id="73f7" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">实现一个建议相似图像的 html/JavaScript 库</li><li id="ce42" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">基于我的前两篇文章创建 pickle 文件(<a class="ae lr" rel="noopener" target="_blank" href="/effortlessly-recommending-similar-images-b65aff6aabfb">理论</a>、<a class="ae lr" rel="noopener" target="_blank" href="/recommending-similar-images-using-pytorch-da019282770c?source=your_stories_page---------------------------">实现</a>与<a class="ae lr" href="https://github.com/MathMagicx/JupyterNotebooks/tree/master/ImageRecommenderResnet18" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>)。将它们用于定义推荐图像的 top-k 列表。</li></ul><p id="c7a5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">更新:在我的后续文章中，您可以找到所介绍方法的扩展。它解释了使用 PostgreSQL 数据库的所有相关代码、合适的打包，并包含了部署到 Heroku 的分步描述。代码链接在帖子里，演示者可以在这里联系到<a class="ae lr" href="http://image-recommender-demo.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="0449" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">1.瓶</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/0b40560cac3d4093a7e657d9a86b7218.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*4ePJLlIwOQvrIvtV7AvyUw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">标志由<a class="ae lr" href="http://flask.pocoo.org/static/logo/flask.svg" rel="noopener ugc nofollow" target="_blank">阿明·罗纳彻</a>制作，版权所有<a class="ae lr" href="https://commons.wikimedia.org/w/index.php?curid=19501815" rel="noopener ugc nofollow" target="_blank">免费使用</a></p></figure><p id="8bb9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Flask 是一个非常流行的用 Python 编写的微框架。它被称为“微型”，因为它没有完整的功能集、数据库的抽象层、用户管理或类似的功能，但它可以通过覆盖所有需求的可用库进行扩展。</p><p id="d2cc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">与像<a class="ae lr" href="https://docs.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>这样功能丰富的框架相比，这听起来可能是一个缺点，但是，它也降低了复杂性，给用户留下了更多的选择，并允许对应用程序进行更好的概述。</p><p id="4acd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你<em class="nh">可以</em>轻松完成的事情:在后端使用你的 python 代码，将结果传递给前端，你可以用 html、JavaScript 和 css 编写结果——你也可以使用 Vue.js 这样的前端框架。</p><p id="85ac" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Flask 提供了基于 Jinja2 语法的模板使用，简化了网页的可重用性和动态创建。</p><p id="c872" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你打算第一次玩 Flask，我推荐你看一些科里·斯查费的教程，他创作了一个简洁的 Flask 系列，可以让你很快上手。</p><p id="6952" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第一步如何运行 Flask(在 Windows 上)？创建合适的虚拟环境后，安装它，例如使用 pip</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="1f28" class="nn mp iq nj b gy no np l nq nr"><strong class="nj ir">pip install Flask</strong></span></pre><p id="04a3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">并导入它以使所有代码可用于构建 Flask web 应用程序</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="f2eb" class="nn mp iq nj b gy no np l nq nr"><strong class="nj ir">from</strong> <strong class="nj ir">flask</strong> <strong class="nj ir">import</strong> Flask</span></pre><p id="04c8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要运行本地调试 web 服务器，可以使用包含主 Python 文件的批处理文件</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="a25d" class="nn mp iq nj b gy no np l nq nr"><strong class="nj ir">set FLASK_DEBUG=1<br/>set FLASK_APP=recommenderFlask.py<br/>flask run</strong></span></pre><p id="40ba" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">FLASK_APP 只是设置应用文件。然后你可以通过</p><p id="03fa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000/ </a></p><p id="a01d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">设置 FLASK_DEBUG 会导致调试信息直接显示在浏览器中。</p><p id="c78b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">印出“你好，世界！python 文件应该是这样的</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="862f" class="nn mp iq nj b gy no np l nq nr">from flask import Flask</span><span id="8361" class="nn mp iq nj b gy ns np l nq nr">app = Flask(__name__)<br/>@app.route(‘/’)<br/>def hello_world():<br/>  return ‘Hello, World!’</span></pre><p id="fd0d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于本文，我使用 Flask 版本 1.1.1 和 Python 版本 3.5.4。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="0372" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated"><strong class="ak"> 2。路线</strong></h1><p id="8525" class="pw-post-body-paragraph kv kw iq kx b ky nt jr la lb nu ju ld le nv lg lh li nw lk ll lm nx lo lp lq ij bi translated">让我们设置应用程序的主文件，recommendFlask.py</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="7a4c" class="nn mp iq nj b gy no np l nq nr"><strong class="nj ir">from flask import Flask<br/>app = Flask(__name__)</strong></span><span id="e70b" class="nn mp iq nj b gy ns np l nq nr"><strong class="nj ir">@app.route(“/”)<br/>@app.route(“/home”)<br/># Need to write a function that is called when opening the site</strong></span><span id="5cd8" class="nn mp iq nj b gy ns np l nq nr"><strong class="nj ir">@app.route(“/recommend”)<br/># Need to write a function that is called when opening recommendations</strong></span><span id="9d11" class="nn mp iq nj b gy ns np l nq nr"><strong class="nj ir">if __name__ == ‘__main__’:<br/>  app.run(debug=True)</strong></span></pre><ul class=""><li id="dba8" class="lt lu iq kx b ky kz lb lc le lv li lw lm lx lq ly lz ma mb bi translated">我们导入 Flask 类来创建 Flask web 应用程序。</li><li id="57aa" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">创建 Flask 实例应用程序，如果直接调用脚本，它将在最后一行运行，因为 Python 设置了<strong class="kx ir"> __name__ == '__main__ '。</strong>如果<em class="nh">推荐的 flash . py</em>是从另一个脚本导入的，情况就不一样了。将 debug 设置为 true 的好处是，您可以在网站本身的开发过程中看到错误。</li><li id="eae1" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">在这两者之间是还没有做任何事情的家庭和推荐路线。它们将触发在下一节中编写和解释的相应功能。我们将通过<strong class="kx ir"> localhost:5000/home/或 localhost:5000/，</strong>到达包含图库的主页，而推荐将显示在<strong class="kx ir">localhost:5000/recommend/</strong>上</li></ul><p id="efe9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们创建一个图像库。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="4481" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated"><strong class="ak"> 3。画廊</strong></h1><p id="c9df" class="pw-post-body-paragraph kv kw iq kx b ky nt jr la lb nu ju ld le nv lg lh li nw lk ll lm nx lo lp lq ij bi translated">我们将把位于一个文件夹中的感兴趣的图像名称放入位于 recommenderFlask.py 文件顶部的虚拟数组中。</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="6817" class="nn mp iq nj b gy no np l nq nr">images = [<br/>  {<br/>    ‘name’:’buildings0.jpg’,<br/>    ‘caption’: ‘Lisboa’<br/>  },<br/>  {<br/>    ‘name’: ‘buildings1.png’,<br/>     …</span></pre><p id="2e48" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们使用这些数据来创建画廊。对于一个生产系统，这一部分需要移动到数据库中——这将是后续文章的一部分。</p><p id="f356" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用一个函数调用 home route，该函数根据与图像相关的可变内容呈现 html 页面。</p><p id="6739" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，添加用于 html 呈现的库</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="9d38" class="nn mp iq nj b gy no np l nq nr">from flask import render_template</span></pre><p id="a602" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">并用图像数组调用画廊创建</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="b595" class="nn mp iq nj b gy no np l nq nr">@app.route(“/home”)<br/>def home():<br/>  return render_template(‘home.html’, images = images)</span></pre><p id="7f2c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">home.htm</strong>l 是一个放入 Flask template 文件夹中的模板，该文件夹允许在 div 块中迭代图像。</p><p id="efa2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Flask 允许使用传递的变量，例如使用 for 循环和花括号中的变量，如下所示</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="aa80" class="nn mp iq nj b gy no np l nq nr">{% for image in images %}<br/>  &lt;div class=”item”&gt;<br/>    &lt;a href=”{{ url_for(‘recommend’, selectedImage=’’) }}{{image.name }}”&gt;<br/>    &lt;img src=”{{ url_for(‘static’, filename=’site_imgs/images/’) }}{{image.name}}” alt=”{{image.name}}” id=”showSimilarInPopup”&gt;<br/>    &lt;div class=”caption”&gt;<br/>      {{image.caption}}<br/>    &lt;/div&gt;<br/>    &lt;/a&gt;<br/>  &lt;/div&gt;<br/>{% endfor %}</span></pre><p id="6955" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在模板中，您可以添加 css 和脚本来使图库工作。对于图库中的分页，我添加了一个位于静态文件夹中的脚本(由 Flask 默认配置)。</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="0fa2" class="nn mp iq nj b gy no np l nq nr">&lt;script src=”{{ url_for(‘static’, filename=’js/pagination.js’) }}”&gt;&lt;/script&gt;</span></pre><p id="d31e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">总的来说，您可以创建自己喜欢的方法和风格来显示和迭代图像。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3654bfa7b2a7361c9e0748f1103a7316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kySVL6KkiMq7_W5z5XkGjQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片库(来源:M. D. Korzec)</p></figure><p id="cad6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于测试和上述网站，我使用 GitHub 存储库中提供的图像进行 top-k 列表计算。由于 21 幅图像中的几个不同类别，它有助于测试所提供的建议。</p><p id="f41b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当点击其中一个图像时</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="868f" class="nn mp iq nj b gy no np l nq nr">&lt;a href=”{{ url_for(‘recommend’, selectedImage=’’) }}{{image.name }}”&gt;</span></pre><p id="847f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">到推荐路线进场。我们希望生成一个新的 html 页面，显示与所选内容最相似的图像。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="b502" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated"><strong class="ak"> 4。推荐人</strong></h1><p id="5c50" class="pw-post-body-paragraph kv kw iq kx b ky nt jr la lb nu ju ld le nv lg lh li nw lk ll lm nx lo lp lq ij bi translated">我们刚刚看到，触发图像会将变量 selectedImage 设置为图像数组中图像的名称，并调用推荐路线。点击图像时，您可以在 URL 中看到它(例如，点击集合中的 camper2.jpg)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/4b5ed6499f578e64fc2aa2ae6d3904cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*w1BScHIo_vOQiiE6gLB1Fg.png"/></div></figure><p id="cc69" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们在应用程序文件中使用这个变量。</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="ee37" class="nn mp iq nj b gy no np l nq nr">from flask import request</span><span id="7b3d" class="nn mp iq nj b gy ns np l nq nr">@app.route(“/recommend”)<br/>def recommend():<br/>  selectedImage = request.args.get(‘selectedImage’)<br/>  inputImage, images, values = getImages(selectedImage)<br/>  return render_template(‘recommend.html’, title=’Recommendations’, customstyle=’recommend.css’, inputImage=inputImage, similarImages=images, similarityValues = values)</span></pre><p id="9a8f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请求变量后会发生什么:</p><ul class=""><li id="b60c" class="lt lu iq kx b ky kz lb lc le lv li lw lm lx lq ly lz ma mb bi translated"><strong class="kx ir"> getImages </strong>函数向输入返回相似图像的数组</li><li id="ea20" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">从模板【recommend.html 的 T2】，基于输入和与输入相关的相似图像，生成一个 html 站点。自定义样式用于 html 页面。</li></ul><p id="7ed4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在模板中，根据相应的变量<strong class="kx ir">输入图像</strong>显示原始图像</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="bb17" class="nn mp iq nj b gy no np l nq nr">&lt;div class=”originalImage”&gt;<br/>  &lt;h3&gt; Input image&lt;/h3&gt;<br/>  &lt;img src=”{{ url_for(‘static’, filename=’site_imgs/images/’) }}{{inputImage}}” alt=”{{inputImage}}” id=”showSimilarInPopup”&gt;<br/>&lt;/div&gt;</span></pre><p id="fea9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">并且基于<strong class="kx ir">相似图像</strong>数组列出相似图像</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="a502" class="nn mp iq nj b gy no np l nq nr">&lt;div class=”galleryContent”&gt;<br/>  &lt;h3&gt; Similar images&lt;/h3&gt;<br/>  {% for image in similarImages %}<br/>    &lt;div class=”item”&gt;<br/>      &lt;img id=”popupImage{{loop.index}}” onclick=”imageClicked(this.id)” src=”{{ url_for(‘static’, filename=’site_imgs/images/’) }}{{image}}” alt=”{{image}}” id=”showSimilarInPopup”&gt;<br/>    &lt;/div&gt;<br/>  {% endfor %}<br/>&lt;/div&gt;</span></pre><p id="0d05" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就是核心烧瓶元素。所做的一切都是为了让网站更好，让画廊更实用。</p><p id="bfcb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后要讨论的是上面的<strong class="kx ir"> getImages </strong>函数。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="5d67" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated"><strong class="ak"> 5。使用前 k 列表</strong></h1><p id="3209" class="pw-post-body-paragraph kv kw iq kx b ky nt jr la lb nu ju ld le nv lg lh li nw lk ll lm nx lo lp lq ij bi translated">当比较从不同图像的卷积神经网络的评估导出的特征向量时，创建 top-k 列表(对于每个图像，记录来自图像集的 k 个最相似的图像)。</p><p id="2dc2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">参考<a class="ae lr" rel="noopener" target="_blank" href="/recommending-similar-images-using-pytorch-da019282770c?source=your_stories_page---------------------------">上一篇文章</a>中介绍的实现(Jupyter 笔记本可以在<a class="ae lr" href="https://github.com/MathMagicx/JupyterNotebooks/blob/master/ImageRecommenderResnet18/Recommending%20Similar%20Images.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到，包括示例图片)，我们将已经从该笔记本中导出的熊猫数据帧<strong class="kx ir"> similarNames </strong>和<strong class="kx ir"> similarValues </strong>存储为 Pickle 文件，包含相似的名称和相应的相似值</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="eb5c" class="nn mp iq nj b gy no np l nq nr"><strong class="nj ir">import pickle<br/>similarNames.to_pickle("similarNames.pkl")<br/>similarValues.to_pickle("similarValues.pkl")</strong></span></pre><p id="3a35" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在网站上，这些可以被视为静态内容，加载并用于提供最相似的图像，但对于画廊，数据库应该在生产中完成这项工作。</p><p id="a526" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面的代码片段用于返回指定数量(<strong class="kx ir"> recLength </strong>)的最相似图像和相似性值。</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="3836" class="nn mp iq nj b gy no np l nq nr">import pickle<br/>import os<br/>import sys<br/>from numpy.testing import assert_almost_equal</span><span id="df54" class="nn mp iq nj b gy ns np l nq nr">global recLength<br/>recLength = 3</span><span id="cc1c" class="nn mp iq nj b gy ns np l nq nr">def getNames(inputName, similarNames, similarValues):<br/>  images = list(similarNames.loc[inputName, :])<br/>  values = list(similarValues.loc[inputName, :])<br/>  if inputName in images:<br/>    assert_almost_equal(max(values), 1, decimal = 5)<br/>    images.remove(inputName)<br/>    values.remove(max(values))<br/>    return inputName, images[0:recLength], values[0:recLength]</span><span id="2ff2" class="nn mp iq nj b gy ns np l nq nr">def getImages(inputImage):<br/>  similarNames = pickle.load(open(os.path.join(“static/pickles/similarNames.pkl”), ‘rb’))<br/>  similarValues = pickle.load(open(os.path.join(“static/pickles/similarValues.pkl”), ‘rb’))</span><span id="7ceb" class="nn mp iq nj b gy ns np l nq nr">  if inputImage in set(similarNames.index):<br/>    return getNames(inputImage, similarNames, similarValues)<br/>  else:<br/>    print(“‘{}’ was not found.”.format(inputImage))<br/>    sys.exit(2)</span></pre><p id="d78d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> getImages </strong>加载 pickle 文件。getNames 从它们中创建简单的列表，并从这些列表中删除相同的图像。<strong class="kx ir"> recLength </strong>是您想要处理的相似图像的数量，应该将其移动到配置文件中。</p><p id="bd36" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们已经为这个 Python 函数提供了用户输入，该函数返回所选的相似图像。然后，如前所述，将它们用于 html 呈现。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="a9e7" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated"><strong class="ak">展望:生产前景</strong></h1><p id="2b2a" class="pw-post-body-paragraph kv kw iq kx b ky nt jr la lb nu ju ld le nv lg lh li nw lk ll lm nx lo lp lq ij bi translated">在之前的文章<a class="ae lr" rel="noopener" target="_blank" href="/recommending-similar-images-using-pytorch-da019282770c?source=your_stories_page---------------------------">中展示了如何用 PyTorch 实现推荐系统</a>。本文描述了如何在本地使用基于 Flask 的网站上的结果。如果你想用原型工作，这是很棒的。它也适用于很少扩展的小型项目。</p><p id="6926" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于具有一些可伸缩性需求的不断发展的应用程序的生产，您可以使用 Flask，但是您可能需要关注更多的主题，这些主题的优先级可能会因范围而异:</p><ul class=""><li id="e3e6" class="lt lu iq kx b ky kz lb lc le lv li lw lm lx lq ly lz ma mb bi translated">项目结构</li><li id="e1e0" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">使用数据库</li><li id="1eab" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">部署到生产系统/云环境→总的来说，一个可靠的持续集成链覆盖了一个合适的测试策略</li><li id="d93a" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">配置处理</li><li id="6173" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">上传新数据(新图像)并自动更新 top-k 列表</li><li id="f63e" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">错误处理、记录和监控</li><li id="b0f6" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">根据您的项目规模，这些可能成为最大的主题:可伸缩性、可靠性和可维护性[1]</li><li id="883b" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">根据特定的用例，在建议和一般调整中产生更多的多样性</li><li id="5ffd" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">安全性、负载平衡……</li></ul><p id="2b27" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您的生产应用程序还有一些工作要做！</p><p id="59e3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" rel="noopener" target="_blank" href="/image-recommendations-with-pytorch-flask-postgresql-heroku-deployment-206682d06c6b">在下一篇文章</a>中，我将解释如何为这个用例使用 PostgreSQL 数据库，如何构建项目以及如何将它部署到 Heroku。</p><p id="5752" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">尽管如此，通过所介绍的步骤，您已经拥有了一切，可以在浏览器前开始连接 Python 代码和用户的旅程了！</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><p id="b0e2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">[1] <a class="ae lr" href="https://www.amazon.de/Martin-Kleppmann/e/B00Q43XKD6/ref=dp_byline_cont_book_1" rel="noopener ugc nofollow" target="_blank"> Martin Kleppmann </a>，<em class="nh">数据密集型应用:可靠、可扩展和可维护系统背后的伟大理念</em>，奥莱利英国有限公司，2017 年</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="d322" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">感谢阅读！喜欢这个话题吗？</h1><p id="36ff" class="pw-post-body-paragraph kv kw iq kx b ky nt jr la lb nu ju ld le nv lg lh li nw lk ll lm nx lo lp lq ij bi translated">如果你觉得这本书有趣，你可能想看看我的相关文章:</p><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/effortlessly-recommending-similar-images-b65aff6aabfb"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">轻松推荐相似图片</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">使用来自训练的卷积神经网络的特征来产生可比性</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq kp oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/recommending-similar-images-using-pytorch-da019282770c"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">使用 PyTorch 推荐相似图片</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">使用 Resnet18 实现完全迁移学习</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="or l on oo op ol oq kp oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/image-recommendations-with-pytorch-flask-postgresql-heroku-deployment-206682d06c6b"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">py torch+Flask+PostgreSQL+Heroku 部署的映像建议</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">用 Flask 封装一个基于 PostgreSQL/ PyTorch 的图像推荐系统，导入数据并在 Heroku 上运行</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="os l on oo op ol oq kp oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a href="https://medium.com/swlh/the-core-value-of-recommender-systems-for-successful-internet-enterprises-7164a7bacdc6" rel="noopener follow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">成功互联网企业推荐系统的核心价值</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">推荐系统的重要性评估</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">medium.com</p></div></div><div class="ol l"><div class="ot l on oo op ol oq kp oc"/></div></div></a></div></div></div>    
</body>
</html>