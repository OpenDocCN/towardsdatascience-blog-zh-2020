# 7 个简单的 Python 函数来清理您的数据

> 原文：<https://towardsdatascience.com/automate-boring-tasks-with-your-own-functions-a32785437179?source=collection_archive---------10----------------------->

## 用 Python 自动化任务很容易。一旦你有了一个可以工作的脚本，把它变成一个可以帮助你更有效编码的函数！

![](img/8e95b162f9f25825550d647b9a6ab03b.png)

因为重复通常很无聊！(照片摄于[新加坡](https://fnevesphotography.pixieset.com/?utm_medium=tdshclean))

无论您是 Python 初学者还是专业人士，无论您是在工作中还是在家里使用 Python，您都有可能每天/每周/每月都要执行一些特定的任务。你有没有发现自己回到旧项目中，试图找到你为另一个项目开发的**那段令人敬畏的代码？“在哪里？我可以发誓，我在另一个项目中也做过同样的事情！”—这是一个熟悉的想法吗？**

> 如果您像我一样，在工作中进行大量的数据提取、转换和加载(ETL ),那么这个“问题”可能会特别重要。

我能想到几个例子，我相信你能找到数百篇其他的有很酷的技巧和功能的文章，有些更好，有些更差。我也见过他们。但是他们中的大多数会把同样的片段再给你看一遍。

这就是为什么我试图**从典型的例子**中走出来，分享一些我实际创作并经常使用的东西！这并不是说它们是有史以来最令人惊叹、编写得最好、令人兴奋的函数，但至少我很确定你在其他地方没有见过它们，也许你甚至可以调整一两个来帮助你解决未来的问题。在我的下一篇文章中，我将展示如何用 Python 创建自己的**类**。

# 你说的是什么样的任务？

您是否有一个文件夹，每天上传 csv 文件，然后需要不时地将它们合并成一个大数据集？或者，您可能希望为特定文件夹中的每个文件添加一列，并用不同的名称保存它们？也许您从数据库中提取的数据带有奇怪的列名，或者其中一列需要分成两部分。

*你明白了，对吗？！*

我将分享一些代码片段来解决这些问题，还有更多！但是玩笑开够了。下面是我们将在本文中编码的任务类型列表。我希望其中一些对你有用，就像它们几乎每天对我一样！

*   合并特定文件夹中的所有文件
*   编辑同一文件夹中的每个文件，然后重新保存
*   清理数据集的标题
*   将 dataframe 列拆分为两列或更多列
*   根据列名筛选特定的数据框架列
*   计算两个日期之间的天数
*   计算两个日期之间的周/月/年数

# 处理 csv 文件

我记得当我让这两个功能工作时，我非常自豪。几分钟(甚至几小时)**神奇地变成了几秒钟**。“是生活中的小事”，我猜！

每天都要处理大量的 csv 文件，我每天都要提取每天的数据，这些数据大约每周都要进行编译。如果你有类似的任务，你可能会喜欢这些！

## 合并同一文件夹中的所有文件

这一个开始是一个简单的功能，但是后来它发展了一点。起点只是指向一个包含我想要合并的 csv 文件的文件夹，并将合并的数据集保存到一个新文件中。请注意，我使用的文件与**的结构**完全相同，但是您可以轻松地修改这段代码来满足您的需求。

*但是 csv 文件只能放这么多行* …所以过了一会儿，我加了一个选项**只合并内存中的文件**。我添加了一个输入变量，这样我就可以调用这个函数，它会向我询问路径，而不是我在编写命令本身时复制路径。

你只需要为这个导入 *glob* 和 *pandas* 。strftime 是一种很好的跟踪文件创建时间的方法，它将日期添加到文件名中。

默认情况下，可以这样运行:*folder _ CSV _ merge(' my _ pref fix ')*。然后，它会提示您粘贴文件路径。新文件应该出现在与原始文件相同的文件夹中。这可能不是最佳做法，因此请确保编辑最后一行，以匹配您希望保存最终文件的位置。

如果您只想将 csv 文件中的所有数据放入内存中的一个数据帧中，而不是一个新文件中，只需添加参数 ***memory='yes'*** ，但是您需要将该函数调用到一个变量中。像这样:*merged _ file = folder _ CSV _ merge(' my _ pref fix '，memory = 'yes ')。*现在你将拥有一个包含所有文件的变量。

## 一次编辑几个文件

在最近的一个场合，我意识到我花了几个小时等待提取数百个文件，但是在提取的时候忘记给每个文件添加一个重要的列。再等一天重新拥有一切不是一个选择…

没问题！**那就是*对于*循环的意义……对于**？！

第一部分非常相似，因为我希望控制台提示我输入文件路径。在指定了文件路径之后，它将遍历每个文件，并对每个文件做一些事情。

在上面的例子中，我在每个文件中都有一列显示客户在我们公司工作了多少天。问题是我忘了在提取和转换时给这个值加 1(因为“资历= 0”对我来说很奇怪！).这是我需要做的唯一改变，但是如果你愿意，你可以添加更多的东西。重命名列、删除列、创建新列等。

这一次节省了我很多时间，如果你一定要知道的话，我确实在工作完成后表扬了自己。它实际上是在我试图计算[客户保持率](/how-to-calculate-customer-retention-rate-a-practical-approach-1c97709d495f)时使用的，如果你对此感兴趣，请查看我关于它的文章！

# 转换数据帧以满足您的需求

接下来的函数都是关于清理那些你从销售部门的人那里得到的数据集，或者任何其他懒得关心**数据一致性和可读性**的同事！甚至一些很久以前构建的数据库也会有怪异的列名，看起来像是句子，充满了奇怪的字符。

## 清洗数据帧标题

这个很简单，也很有用。几乎不言自明！这也很重要，因为您希望在项目中保持列名的一致性。

## 根据内容拆分列

接下来，一个简单的函数帮助您根据特定的字符或字符串拆分列。

假设您在数据帧中有一个列“tag ”,它实际上由一个类别和一个子类别组成，用下划线分隔。您希望将这两个列分开，这意味着我们需要一个名为“category”的列和另一个名为“subcategory”的列。简单:

*split_columns(dataframe，'标签'，'类别'，'子类别'，' _')*

再次检查您的数据框架，现在您有了两个新列！

## 根据名称筛选特定的列

这不是我每天使用的东西，但有一个特定的文件使我创建了它。该文件有几列不同年份的名称相同。但是我通常只需要处理一年的数据，所以我必须过滤相关的列。

为了让它更清楚，我在这个代码片段的末尾添加了一个小例子。运行它，自己看看它是如何工作的。

# 操作日期列

当我开始学习 Python 时，我记得我当时发现的最酷的特性之一是内置的日期/时间功能。我们在某个时候都是菜鸟！接下来的这些函数假设您已经将日期列转换成了 datetime 对象(例如这里的[和](https://stackoverflow.com/questions/17134716/convert-dataframe-column-type-from-string-to-datetime-dd-mm-yyyy-format))。

## 计算日期之间的天数

我将是第一个承认下一个函数不是有史以来最大的突破… *除非*你想使用的列总是相同的，只有数据帧名称改变了。如果是这种情况，您可以在函数中对列名进行硬编码，并通过一个参数(即数据帧的名称)轻松使用它。

此函数使用两个日期之间的差异创建一个新列。更多关于“协同索引”是什么，在下一个。

## 计算日期之间的周数/月数/年数

总结一下，我将以 1 英镑的价格分享这 2 英镑！我需要这些来写我之前提到的客户维系文章。有必要计算分组。

可以用上面的函数获得每日分组，但是它不适用于每月分组或每年分组。如果你想知道为什么，你可以查看文章来了解我为什么需要它。

第一个函数 *get_date_int* 是必需的，这样我们就可以**从每个日期**中分离出年、月和周。该函数将为每个变量返回一个整数，我们将把它合并到*calc _ coorts*函数中。

转到第二个函数，我们需要一个带有**两个日期列**的 dataframe(在本例中，它是注册日期和最后登录日期，但是您可以更改名称以适合您的项目)。

一旦你运行它，你会在你的数据帧中得到两个新的列，叫做 ***cohort_w*** 和 ***cohort_y*** 。您的群组已准备好用于计算保留率！

# 敬请关注更多内容！

目前就是这样，但是正如我在开始提到的，我正在写下一篇关于如何用 Python 创建你自己的类的文章。一个类将让你直接使用这些函数，就像你使用一个“普通”的包，比如 Pandas 或 Numpy。不需要每次都定义函数。只需导入您自己的包并直接使用它们。

与此同时，我要感谢你阅读/评论和关注我，如果是这样的话。能够分享这段旅程并与这么多人联系真的很有收获！

> 别忘了看看我的其他文章:

[](/increase-your-instagram-followers-with-a-simple-python-bot-fde048dce20d) [## 用一个简单的 Python 机器人增加你的 Instagram 粉丝

### 我在 4 天内有了 500 个真正的追随者！

towardsdatascience.com](/increase-your-instagram-followers-with-a-simple-python-bot-fde048dce20d) [](/looking-for-a-house-build-a-web-scraper-to-help-you-5ab25badc83e) [## 我在找房子，所以我用 Python 做了一个 web scraper！

### 几个月后，我将不得不离开我租的公寓，去找一个新的。尽管这种经历很痛苦…

towardsdatascience.com](/looking-for-a-house-build-a-web-scraper-to-help-you-5ab25badc83e) [](/turn-your-previous-python-projects-into-awesome-tools-with-tkinter-2e61f2241e29) [## 使用 Tkinter，将您以前的 Python 项目变成令人敬畏的工具

### 用 Tkinter、Python 和 Selenium 创建一个简单的应用程序和一个 web 抓取脚本！

towardsdatascience.com](/turn-your-previous-python-projects-into-awesome-tools-with-tkinter-2e61f2241e29) 

*感谢您的阅读！一如既往，我欢迎反馈和建设性的批评。如果你想取得联系，可以联系我* [***这里***](https://www.linkedin.com/in/fabioneves/)**或者直接回复下面的文章。**