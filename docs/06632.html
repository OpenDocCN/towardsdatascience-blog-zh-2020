<html>
<head>
<title>[TUTORIAL]: Deploy ML model as REST API on Azure and protect it with SSL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">【教程】:在 Azure 上部署 ML 模型作为 REST API，用 SSL 保护</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80?source=collection_archive---------31-----------------------#2020-05-25">https://towardsdatascience.com/tutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80?source=collection_archive---------31-----------------------#2020-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4631" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将机器学习模型投入生产的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fe9e90a4d13080d9b0408fa4ba49f229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E_ZZ7vIM7HKHELiV"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@dtopkin1?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">戴恩·托普金</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h1 id="9008" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">你会学到什么:</h1><h2 id="a740" class="lr la it bd lb ls lt dn lf lu lv dp lj lw lx ly ll lz ma mb ln mc md me lp mf bi translated"><strong class="ak">TL；博士:</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/54b8797af84e1102e8cdd72417f6e941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y_81921Snza39TCctyPEVQ.gif"/></div></div></figure><p id="37f6" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">数据科学家经常忘记，如果他们的新模型不能在生产中使用，它们就没有多大用处。在本教程中，我将向您展示如何将 Tensorflow 模型部署到 Azure 容器实例，并使用 SSL 保护它。</p><p id="c172" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">将有 3 种部署类型:</strong></p><ul class=""><li id="09e2" class="na nb it mj b mk ml mn mo lw nc lz nd mc ne mz nf ng nh ni bi translated"><strong class="mj iu">部署#1:本地部署:<br/> </strong>模型将被放在 docker 容器中，并作为 API 在 localhost 上公开。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/5fa1f21312c10873e56d9cf8e9fe8d3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8VR1S4BD6vkPQQiayc0Vfg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd nk">部署#1:本地部署</strong></p></figure><ul class=""><li id="cf43" class="na nb it mj b mk ml mn mo lw nc lz nd mc ne mz nf ng nh ni bi translated"><strong class="mj iu">部署#2:不加密的全局部署:<br/> </strong>包含模型的 Docker 将上传到 Azure Container Registry。存储的容器将通过您可以调用的 API 公开。这样做的缺点是，如果每个人都有 IP 地址并且没有加密，他们就可以访问它。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/f743f6e48c9aa7969733efd807f85c09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fC5IFcYaWnBf0Y6cFBO3nQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd nk">部署#2:不加密的全局部署</strong></p></figure><ul class=""><li id="3281" class="na nb it mj b mk ml mn mo lw nc lz nd mc ne mz nf ng nh ni bi translated"><strong class="mj iu">部署#3:用 SSL 加密的全局部署:<br/> </strong>包含模型的 Docker 将被上传到 Azure Container Registry。我们将为 API 的使用创建证书颁发机构(CA)和自签名证书。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/54b8797af84e1102e8cdd72417f6e941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y_81921Snza39TCctyPEVQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd nk">部署#3:使用 SSL 加密的全局部署</strong></p></figure></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="417c" class="kz la it bd lb lc ns le lf lg nt li lj jz nu ka ll kc nv kd ln kf nw kg lp lq bi translated">先决条件:</h1><ul class=""><li id="976d" class="na nb it mj b mk nx mn ny lw nz lz oa mc ob mz nf ng nh ni bi translated">带有 sudo 选项的 Linux 机器</li><li id="f529" class="na nb it mj b mk oc mn od lw oe lz of mc og mz nf ng nh ni bi translated">安装在 Linux 上的 Docker</li><li id="ebe1" class="na nb it mj b mk oc mn od lw oe lz of mc og mz nf ng nh ni bi translated">安装在 Linux 上的 Azure CLI</li><li id="a51f" class="na nb it mj b mk oc mn od lw oe lz of mc og mz nf ng nh ni bi translated">安装在 Linux 上的 openssl</li><li id="d65f" class="na nb it mj b mk oc mn od lw oe lz of mc og mz nf ng nh ni bi translated">Azure 的有效订阅</li></ul><p id="2dc9" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">注意:</strong> <br/>如果你没有有效的订阅，你可以为 Azure 创建一个免费帐户，并获得 2 周的试用期。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="d2e0" class="kz la it bd lb lc ns le lf lg nt li lj jz nu ka ll kc nv kd ln kf nw kg lp lq bi translated">第一步:我们需要一个模型</h1><p id="ab64" class="pw-post-body-paragraph mh mi it mj b mk nx ju mm mn ny jx mp lw oh mr ms lz oi mu mv mc oj mx my mz im bi translated">训练 Tensorflow 模型并用<br/> <code class="fe ok ol om on b">tf.saved_model.save(model, "path / to / model")</code>保存</p><p id="e8e3" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">或者:</p><p id="6d9b" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">这里有一个演示模型，表示 f(x)= 2*x -1。它被保存到”。/demo_model/"</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="ce0b" class="lr la it on b gy os ot l ou ov">import os <br/>import numpy as np <br/>import tensorflow as tf  </span><span id="73db" class="lr la it on b gy ow ot l ou ov">xs = np.array([-1.0,  0.0, 1.0, 2.0, 3.0, 4.0], dtype=float) <br/>ys = np.array([-3.0, -1.0, 1.0, 3.0, 5.0, 7.0], dtype=float)  </span><span id="7f83" class="lr la it on b gy ow ot l ou ov">model = tf.keras.Sequential([tf.keras.layers.Dense(units=1, input_shape=[1])]) <br/>model.compile(optimizer='sgd', loss='mean_squared_error') <br/>history = model.fit(xs, ys, epochs=500, verbose=0) <br/>print("Finished training the model")  </span><span id="3e40" class="lr la it on b gy ow ot l ou ov">MODEL_DIR = "./demo_model" version = 1 <br/>export_path = os.path.join(MODEL_DIR, str(version)) model.save(export_path, save_format="tf") <br/>print('\nexport_path = {}'.format(export_path))</span></pre><p id="7b75" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">Tensorflow 发球的细节我就不赘述了，因为有很棒的<a class="ae ky" href="https://www.coursera.org/learn/advanced-deployment-scenarios-tensorflow/" rel="noopener ugc nofollow" target="_blank"> Coursera 课程</a>。上面使用的代码是本课程中使用的代码，但仅针对本演示进行了压缩。你可以从<a class="ae ky" href="https://www.tensorflow.org/tfx/tutorials/serving/rest_simple" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多 TFServing。</p><h1 id="64de" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤 2:将模型放入 TFServing 容器中</h1><p id="4e40" class="pw-post-body-paragraph mh mi it mj b mk nx ju mm mn ny jx mp lw oh mr ms lz oi mu mv mc oj mx my mz im bi translated">打开“终端”,导航到保存模型的目录。</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="f009" class="lr la it on b gy os ot l ou ov">$ MODEL_NAME=<strong class="on iu">demo_model</strong> #<strong class="on iu">REPLACE with your model</strong><br/>$ MODEL_PATH="./$MODEL_NAME"<br/>$ CONTAINER_NAME="$MODEL_NAME"</span><span id="6ad8" class="lr la it on b gy ow ot l ou ov">$ sudo docker run -d --name serving_base tensorflow/serving<br/>$ sudo docker cp "$MODEL_PATH" serving_base:"/models/$MODEL_NAME"<br/>$ sudo docker commit --change "ENV MODEL_NAME $MODEL_NAME" serving_base "$CONTAINER_NAME"</span><span id="4ae1" class="lr la it on b gy ow ot l ou ov">$ sudo docker run -d -p 8501:8501 "$MODEL_NAME"</span></pre><p id="8bef" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">现在，您已经通过本地主机上的 API 公开了您的模型，您可以从终端调用它:</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="4182" class="lr la it on b gy os ot l ou ov">$ curl -d '{"signature_name": "serving_default", "instances": [[10.0],[9.0]]}' -X POST "<a class="ae ky" href="http://localhost:8501/v1/models/$MODEL_NAME:predict" rel="noopener ugc nofollow" target="_blank">http://localhost:8501/v1/models/$MODEL_NAME:predict</a>"</span></pre><p id="3f60" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">或者来自 python:</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="51d7" class="lr la it on b gy os ot l ou ov">import requests <br/>import json </span><span id="fdc6" class="lr la it on b gy ow ot l ou ov">api_url = "<a class="ae ky" href="http://51.138.56.160/v1/models/use:predict" rel="noopener ugc nofollow" target="_blank">http://localhost:8501/v1/models/demo_model:predict</a>" </span><span id="5a25" class="lr la it on b gy ow ot l ou ov">data = json.dumps({"signature_name": "serving_default", "instances": [[10.0],[9.0]]}) </span><span id="71a9" class="lr la it on b gy ow ot l ou ov">headers = {"content-type": "application/json"} </span><span id="4ed3" class="lr la it on b gy ow ot l ou ov">json_response = requests.post(api_url, data=data, headers=headers) </span><span id="4545" class="lr la it on b gy ow ot l ou ov">print(json_response.text)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/da4923899b69409b750409b0504b20d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QSR0c27O3JWVTVMPhQF24g.png"/></div></div></figure><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="11eb" class="lr la it on b gy os ot l ou ov">#STOP docker image<br/>sudo docker container stop IMAGE_ID  <br/>#DELETE docker image <br/>sudo docker container rm IMAGE_ID</span></pre><p id="5d45" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">部署#1:已完成！</p><p id="24b9" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">您现在可以在 localhost 中使用您的模型了。</p><p id="1bc3" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">额外提示:</strong>另一个选择是端口转发。您使用 SSH 连接到机器。</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="3060" class="lr la it on b gy os ot l ou ov">ssh -N -f -L localhost:8501:localhost:8501 user@IP.ADDRESS</span></pre><p id="4cc5" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">缺点:</strong></p><ul class=""><li id="864b" class="na nb it mj b mk ml mn mo lw nc lz nd mc ne mz nf ng nh ni bi translated">你只能在本地使用它</li><li id="e18a" class="na nb it mj b mk oc mn od lw oe lz of mc og mz nf ng nh ni bi translated">您需要 VPN 访问才能使用端口转发</li><li id="a6a1" class="na nb it mj b mk oc mn od lw oe lz of mc og mz nf ng nh ni bi translated">不可扩展</li></ul></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="13b6" class="kz la it bd lb lc ns le lf lg nt li lj jz nu ka ll kc nv kd ln kf nw kg lp lq bi translated">步骤 3:创建容器注册表</h1><p id="55ba" class="pw-post-body-paragraph mh mi it mj b mk nx ju mm mn ny jx mp lw oh mr ms lz oi mu mv mc oj mx my mz im bi translated">用于存储带有模型的容器。<br/>转到 Azure portal 并找到容器注册表。点击<strong class="mj iu">添加新注册表</strong>按钮创建新注册表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/2d29f386461e07009582c153cb195deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dg9LyQN0bJq0lXkPyysEgA.png"/></div></div></figure><p id="ddda" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">重要提示:</strong></p><ul class=""><li id="b2df" class="na nb it mj b mk ml mn mo lw nc lz nd mc ne mz nf ng nh ni bi translated">选择有效的订阅和资源组。</li><li id="2062" class="na nb it mj b mk oc mn od lw oe lz of mc og mz nf ng nh ni bi translated">注册表名称必须是唯一的，我们以后还会用到它，所以请注意。(提示:仅使用小写字母)</li><li id="98c8" class="na nb it mj b mk oc mn od lw oe lz of mc og mz nf ng nh ni bi translated">位置是必须的，你应该选择离你最近的一个</li><li id="04fe" class="na nb it mj b mk oc mn od lw oe lz of mc og mz nf ng nh ni bi translated">大多数情况下，基本 SKU 应该足够了。</li></ul><p id="0dff" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">你现在可以点击<strong class="mj iu">查看和创建</strong>这个注册表按钮。</p><p id="b6b2" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">重要提示:</strong>导航到您的资源并启用管理员用户。记下用户名和密码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/09cb7965c95918c589abf94334e9a9d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Tca8KA_yKEnW3WuFJd65w.png"/></div></div></figure><h1 id="44d1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤 4:将 Docker 容器推送到容器注册中心</h1><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="c6ac" class="lr la it on b gy os ot l ou ov">$ CONTAINER_REGISTRY_NAME=<strong class="on iu">blogdemo</strong> #<strong class="on iu">REPLACE (lower letters only)</strong></span><span id="b8d8" class="lr la it on b gy ow ot l ou ov">$ sudo az login #login to Azure</span><span id="d658" class="lr la it on b gy ow ot l ou ov">$ sudo az acr login --name "$CONTAINER_REGISTRY_NAME" </span><span id="f8e8" class="lr la it on b gy ow ot l ou ov">$ sudo docker images</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/540f853943c087160d60b1c8e2c3ebaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BgSoB59BPTKrYknqwdkXPA.png"/></div></div></figure><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="d150" class="lr la it on b gy os ot l ou ov">$ VERSION_NAME="$CONTAINER_REGISTRY_NAME.azurecr.io/version1"</span><span id="9754" class="lr la it on b gy ow ot l ou ov">$ sudo docker tag <strong class="on iu">2b458f67dac3</strong> "$VERSION_NAME" #<strong class="on iu">REPLACE</strong></span><span id="050b" class="lr la it on b gy ow ot l ou ov">$ sudo docker push "$VERSION_NAME"</span></pre><p id="87c3" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">恭喜:<br/>您已经成功地存储了带有模型的容器</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/fba554ec1ab023163146b24d51d3ffe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*L9J_1fetU60gK8v83Ilr0g.png"/></div></figure><h1 id="de52" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤 5:用容器实例公开模型</h1><p id="af7d" class="pw-post-body-paragraph mh mi it mj b mk nx ju mm mn ny jx mp lw oh mr ms lz oi mu mv mc oj mx my mz im bi translated">在存储容器之后，暴露模型是相当容易的。</p><p id="3dd1" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">最简单的方法是登录 Azure portal，导航到容器实例并点击<strong class="mj iu">添加</strong>按钮。命名容器后，选择一个想要的区域，并选择您上传模型的注册表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/27ce99d7c91e01f655a9a433b7c91e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dw8ILErWHyxnZmAXXomzlA.png"/></div></div></figure><p id="2b46" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">注意:</strong> <br/>尺寸真的取决于你的模型尺寸。这个例子中使用的尺寸对于这个模型来说已经足够了。我已经部署了大约 150M 参数(600MB)的模型，它需要 2 个 vcpu 和 4 GB 内存。</p><p id="3413" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">现在点击<strong class="mj iu">下一步:联网</strong>按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/47c8d398a43120aee86faaa8b579658d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oyLCspI7MdRntXzyJi4eMg.png"/></div></div></figure><p id="9bce" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">注意:</strong> DNS 名称是可选的，它需要是唯一的。</p><p id="651b" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">点击<strong class="mj iu">审查并创建</strong>，您的模型就可以使用了。(要删除实例，只需导航至资源并点击<strong class="mj iu">删除</strong>按钮)</p><p id="f762" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">用法:</strong></p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="f01b" class="lr la it on b gy os ot l ou ov">$ curl -d '{"signature_name": "serving_default", "instances": [[10.0],[9.0]]}' -X POST "<a class="ae ky" href="http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict" rel="noopener ugc nofollow" target="_blank">http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict</a>" <br/>#<strong class="on iu">REPLACE </strong><a class="ae ky" href="http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict" rel="noopener ugc nofollow" target="_blank">blogdemo.westeurope.azurecontainer.io</a><strong class="on iu"> WITH DNS</strong></span><span id="bf26" class="lr la it on b gy ow ot l ou ov">#OR:</span><span id="a94a" class="lr la it on b gy ow ot l ou ov">$ curl -d '{"signature_name": "serving_default", "instances": [[10.0],[9.0]]}' -X POST "<a class="ae ky" href="http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict" rel="noopener ugc nofollow" target="_blank">http://IP.ADDRESS:8501/v1/models/$MODEL_NAME:predict</a>" <br/>#<strong class="on iu">REPLACE </strong><a class="ae ky" href="http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict" rel="noopener ugc nofollow" target="_blank">IP.ADDRESS</a><strong class="on iu"> WITH IP</strong></span></pre><p id="a5f7" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">使用模型与使用本地公开的模型是一样的，唯一的区别是 URL。您可以使用 DNS URL 或 IP URL。</p><p id="909b" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">部署#2:已完成！</strong></p><p id="f621" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">您已经部署了一个可以在互联网上使用的模型。您可以监视模型的使用情况，并在需要时升级容器的大小，这使得它具有可伸缩性。</p><p id="5f15" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">缺点:</strong></p><ul class=""><li id="3be6" class="na nb it mj b mk ml mn mo lw nc lz nd mc ne mz nf ng nh ni bi translated">每个知道 IP 地址的人都可以访问这个模型</li><li id="d890" class="na nb it mj b mk oc mn od lw oe lz of mc og mz nf ng nh ni bi translated">未加密</li></ul></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="c051" class="kz la it bd lb lc ns le lf lg nt li lj jz nu ka ll kc nv kd ln kf nw kg lp lq bi translated">步骤 6:创建证书颁发机构和用户</h1><p id="3221" class="pw-post-body-paragraph mh mi it mj b mk nx ju mm mn ny jx mp lw oh mr ms lz oi mu mv mc oj mx my mz im bi translated">为了保护 API，我们需要加密。如果您使用商业证书颁发机构，可以跳过这一步。我们将创建自己的自签名证书。</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="5ad1" class="lr la it on b gy os ot l ou ov">$ mkdir certs <br/><br/>$ cd certs </span><span id="bd50" class="lr la it on b gy ow ot l ou ov">$ openssl ecparam -genkey -name secp256r1 | openssl ec -out ca.key </span><span id="4ffd" class="lr la it on b gy ow ot l ou ov">$ openssl req -new -x509 -days 3650 -key ca.key -out ca.pem</span></pre><p id="d924" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">系统会提示您填写表格。请填写您的信息。</p><p id="26d9" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">注:<br/> </strong>为简单起见，这是椭圆加密的一个例子。我建议使用 RSA 密钥。这是一个很棒的<a class="ae ky" href="https://gist.github.com/mtigas/952344" rel="noopener ugc nofollow" target="_blank">要点</a>，解释了如何去做。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/89a5631674e06b930045a34b3aa6d4be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*GjTRNDbgmSahS-HTwUr4hQ.png"/></div></figure><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="212a" class="lr la it on b gy os ot l ou ov">$ CLIENT_ID=”client”<br/>$ CLIENT_SERIAL=01 <br/>#when creating new user make sure that <strong class="on iu">serial is unique</strong></span><span id="273b" class="lr la it on b gy ow ot l ou ov">$ openssl ecparam -genkey -name secp256r1 | openssl ec -out “${CLIENT_ID}.key”</span><span id="ffaf" class="lr la it on b gy ow ot l ou ov">$ openssl req -new -key “${CLIENT_ID}.key” -out “${CLIENT_ID}.csr” <br/>#password should be empty</span><span id="7ec9" class="lr la it on b gy ow ot l ou ov">$ openssl x509 -req -days 3650 -in “${CLIENT_ID}.csr” -CA ca.pem -CAkey ca.key -set_serial “${CLIENT_SERIAL}” -out “${CLIENT_ID}.pem”</span><span id="a72c" class="lr la it on b gy ow ot l ou ov">$ cat “${CLIENT_ID}.key” “${CLIENT_ID}.pem” ca.pem &gt; “${CLIENT_ID}.full.pem”</span><span id="63fd" class="lr la it on b gy ow ot l ou ov">#<strong class="on iu">OPTIONAL</strong>:<br/>$ openssl pkcs12 -export -out “${CLIENT_ID}.full.pfx” -inkey “${CLIENT_ID}.key” -in “${CLIENT_ID}.pem” -certfile ca.pem</span><span id="65b3" class="lr la it on b gy ow ot l ou ov">#remember passoword and you will pass it with pfx file</span></pre><h1 id="f2ab" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤 7:配置 NGINX</h1><p id="e2d5" class="pw-post-body-paragraph mh mi it mj b mk nx ju mm mn ny jx mp lw oh mr ms lz oi mu mv mc oj mx my mz im bi translated">我们为什么需要 NGINX？</p><p id="0e7c" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">拒绝所有没有有效证书的请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/40e09a76ad15b3f322ab636e7673a564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LxPO5W7mSIdB9AOZxq8C-w.png"/></div></div></figure><p id="3f21" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">创建 nginx.config 文件，如下所示:</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="84a5" class="lr la it on b gy os ot l ou ov">$ cd ..</span><span id="af7c" class="lr la it on b gy ow ot l ou ov">$ cat &gt; nginx.conf</span></pre><p id="ac6f" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">复制所有内容并粘贴到一个文件中。粘贴后，使用 CTRL+D 关闭编辑器。</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="60ad" class="lr la it on b gy os ot l ou ov">user nginx;</span><span id="f32d" class="lr la it on b gy ow ot l ou ov">worker_processes auto;</span><span id="d240" class="lr la it on b gy ow ot l ou ov">events {<br/>  worker_connections 1024;<br/>}</span><span id="d9f5" class="lr la it on b gy ow ot l ou ov">pid        /var/run/nginx.pid;</span><span id="0a53" class="lr la it on b gy ow ot l ou ov">http {</span><span id="eeb1" class="lr la it on b gy ow ot l ou ov">server {<br/>        listen [::]:443 ssl;<br/>        listen 443 ssl;</span><span id="7989" class="lr la it on b gy ow ot l ou ov">server_name localhost;</span><span id="4881" class="lr la it on b gy ow ot l ou ov">ssl_protocols              TLSv1 TLSv1.1 TLSv1.2;</span><span id="686b" class="lr la it on b gy ow ot l ou ov">ssl_ciphers                ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:ECDHE-RSA-RC4-SHA:ECDHE-ECDSA-RC4-SHA:AES128:AES256:RC4-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!3DES:!MD5:!PSK;<br/>        ssl_prefer_server_ciphers  on;</span><span id="83ad" class="lr la it on b gy ow ot l ou ov">ssl_session_cache    shared:SSL:10m; # a 1mb cache can hold about 4000 sessions, so we can hold 40000 sessions<br/>        ssl_session_timeout  24h;</span><span id="f1f9" class="lr la it on b gy ow ot l ou ov">keepalive_timeout 300; # up from 75 secs default</span><span id="15b1" class="lr la it on b gy ow ot l ou ov">add_header Strict-Transport-Security 'max-age=31536000; includeSubDomains';</span><span id="986c" class="lr la it on b gy ow ot l ou ov">ssl_certificate      /etc/nginx/server.pem; <br/>  ssl_certificate_key /etc/nginx/server.key; <br/>  ssl_client_certificate /etc/nginx/ca.pem; <br/>        <br/>  ssl_verify_client on;<br/>        <br/>        location / {<br/>            proxy_pass http://localhost:8501; # TODO: replace with correct port<br/>            <br/>            proxy_set_header Connection "";<br/>            proxy_set_header Host $host;<br/>            proxy_set_header X-Real-IP $remote_addr;<br/>            proxy_set_header X-Forwarded-For $remote_addr;<br/>        }<br/>    }<br/>}</span></pre><p id="d36e" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">NGINX 的细节我就不赘述了，下面是详细的<a class="ae ky" href="https://medium.com/@jovanshernandez/what-is-nginx-f0a9c3a49a41" rel="noopener">链接</a>。这个配置是这个<a class="ae ky" href="https://medium.com/@samkreter/adding-ssl-tls-to-azure-container-instances-1e608a8f321c" rel="noopener">博客</a>和这个<a class="ae ky" href="https://fardog.io/blog/2017/12/30/client-side-certificate-authentication-with-nginx/" rel="noopener ugc nofollow" target="_blank">文章</a>的混合体。简而言之，它只监听 https(端口 443)并验证它收到的证书。如果证书有效，它会将解密的请求重定向到具有模型的容器，并对发送回客户端的响应进行加密。</p><h1 id="f4e5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤 8:为 Azure 准备设置文件</h1><p id="67f4" class="pw-post-body-paragraph mh mi it mj b mk nx ju mm mn ny jx mp lw oh mr ms lz oi mu mv mc oj mx my mz im bi translated">为 Azure 创建 test-deploy.yaml 文件:</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="39b3" class="lr la it on b gy os ot l ou ov">$ cat &gt; test-deploy.yaml</span></pre><p id="aa98" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">复制所有内容并粘贴到一个文件中。粘贴后，使用 CTRL+D 关闭编辑器。</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="6f07" class="lr la it on b gy os ot l ou ov">location: LOCATION<br/>name: NAME<br/>properties:<br/>  containers:<br/>  - name: model<br/>    properties:<br/>      image: IMAGE.azurecr.io/version1:latest<br/>      ports:<br/>      - port: 8501<br/>        protocol: TCP<br/>      resources:<br/>        requests:<br/>          cpu: 1.0<br/>          memoryInGB: 1.5<br/>  - name: nginx-with-ssl<br/>    properties:<br/>      image: nginx<br/>      ports:<br/>      - port: 443<br/>        protocol: TCP<br/>      resources:<br/>        requests:<br/>          cpu: 1.0<br/>          memoryInGB: 1.5<br/>      volumeMounts:<br/>      - name: nginx-config<br/>        mountPath: /etc/nginx<br/>  imageRegistryCredentials:<br/>  - server: SERVER.azurecr.io<br/>    username: USERNAME<br/>    password: PASSWORD<br/>  volumes:<br/>  - secret:<br/>      server.pem: PEM<br/>      server.key: KEY<br/>      ca.pem: CA<br/>      nginx.conf: CONF<br/>    name: nginx-config<br/>  ipAddress:<br/>    ports:<br/>    - port: 443<br/>      protocol: TCP<br/>    type: Public<br/>    dnsNameLabel: DNS<br/>  osType: Linux<br/>tags: null<br/>type: Microsoft.ContainerInstance/containerGroups</span></pre><p id="4966" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">我们将使用<strong class="mj iu"> sed </strong>命令替换该模板的部分内容。这些是无需编辑即可运行的命令。</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="5f64" class="lr la it on b gy os ot l ou ov">$ sed -i -e "s/name: NAME/name: $MODEL_NAME/" azure.yaml</span><span id="e699" class="lr la it on b gy ow ot l ou ov">$ sed -i -e "s/image: IMAGE/image: $CONTAINER_REGISTRY_NAME/" azure.yaml</span><span id="628e" class="lr la it on b gy ow ot l ou ov">$ sed -i -e "s/server: SERVER/server: $CONTAINER_REGISTRY_NAME/" azure.yaml</span><span id="6df7" class="lr la it on b gy ow ot l ou ov">$ sed -i -e "s/username: USERNAME/username: $CONTAINER_REGISTRY_NAME/" azure.yaml</span><span id="0ad5" class="lr la it on b gy ow ot l ou ov">$ sed -i -e "s/server.pem: PEM/server.pem: $(cat ./certs/ca.pem | base64 -w 0)/" azure.yaml</span><span id="a42b" class="lr la it on b gy ow ot l ou ov">$ sed -i -e "s/server.key: KEY/server.key: $(cat ./certs/ca.key| base64 -w 0)/" azure.yaml</span><span id="6a16" class="lr la it on b gy ow ot l ou ov">$ sed -i -e "s/ca.pem: CA/ca.pem: $(cat ./certs/ca.pem | base64 -w 0)/" azure.yaml</span><span id="f7a9" class="lr la it on b gy ow ot l ou ov">$ sed -i -e "s/nginx.conf: CONF/nginx.conf: $(cat ./nginx.conf | base64 -w 0)/" azure.yaml</span></pre><p id="d41d" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">这些命令必须进行编辑。用注册表中的位置和密码替换粗体部分，并用您的 DNS 替换 DNS_NAME。</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="f251" class="lr la it on b gy os ot l ou ov">$ sed -i -e "s/location: LOCATION/location: <strong class="on iu">westeurope</strong>/" azure.yaml</span><span id="7e19" class="lr la it on b gy ow ot l ou ov">$ sed -i -e "s/password: PASSWORD/password: <strong class="on iu">REGISTRY_PASS</strong>/" azure.yaml<br/>#TIP: If your generated password has some special characters<br/>#like / you will have to manually put <strong class="on iu">\</strong>/ infront</span><span id="5bf8" class="lr la it on b gy ow ot l ou ov">$ sed -i -e "s/dnsNameLabel: DNS/dnsNameLabel: <strong class="on iu">DNS_NAME</strong>/" azure.yaml</span></pre><h1 id="9685" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤 9:部署模型</h1><p id="b785" class="pw-post-body-paragraph mh mi it mj b mk nx ju mm mn ny jx mp lw oh mr ms lz oi mu mv mc oj mx my mz im bi translated">用您的有效资源组替换<strong class="mj iu"> &lt; AZURE 资源组&gt; </strong>，您就可以开始了。</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="c76a" class="lr la it on b gy os ot l ou ov">$ az container create --resource-group <strong class="on iu">&lt;AZURE RESOURCE GROUP&gt;</strong> --name "$MODEL_NAME" -f azure.yaml</span></pre><h1 id="07a6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">第十步:用法</h1><p id="e66a" class="pw-post-body-paragraph mh mi it mj b mk nx ju mm mn ny jx mp lw oh mr ms lz oi mu mv mc oj mx my mz im bi translated">确保您拥有 client.key 和 client.pem 的正确路径，并且您可以继续调用 API，如下所示:</p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="3ae3" class="lr la it on b gy os ot l ou ov">$ curl -d '{"signature_name": "serving_default", "instances": [[10.0],[9.0]]}' -v --key "./certs/client.key" --cert "./certs/client.full.pem" -X POST -k <a class="ae ky" href="https://blogdemo.westeurope.azurecontainer.io/v1/models/demo_model:predict" rel="noopener ugc nofollow" target="_blank">https://blogdemo.westeurope.azurecontainer.io/v1/models/demo_model:predict</a></span><span id="c9a3" class="lr la it on b gy ow ot l ou ov">#<strong class="on iu">REPLACE </strong><a class="ae ky" href="http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict" rel="noopener ugc nofollow" target="_blank">blogdemo.westeurope.azurecontainer.io</a><strong class="on iu"> WITH DNS</strong></span><span id="ebfb" class="lr la it on b gy ow ot l ou ov">#OR:</span><span id="557f" class="lr la it on b gy ow ot l ou ov">$ curl -d '{"signature_name": "serving_default", "instances": [[10.0],[9.0]]}' -v --key "./certs/client.key" --cert "./certs/client.full.pem" -X POST -k <a class="ae ky" href="https://blogdemo.westeurope.azurecontainer.io/v1/models/demo_model:predict" rel="noopener ugc nofollow" target="_blank">https://IP.ADDRESS/v1/models/demo_model:predict</a><br/>#<strong class="on iu">REPLACE </strong><a class="ae ky" href="http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict" rel="noopener ugc nofollow" target="_blank">IP.ADDRESS</a><strong class="on iu"> WITH IP</strong></span></pre><p id="fc25" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">如果一切正常，您将会得到这样的响应:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/bddfa572ccca681bcba017bfb53c6f3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0jDrk8LIu40Dp7eaomW-UQ.png"/></div></div></figure><p id="0c9a" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">重要提示:</strong>由于这是自签名证书，所以必须在 cURL 中添加<strong class="mj iu"> -k </strong>标志。</p><p id="3177" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu"> Python 版本:</strong></p><pre class="kj kk kl km gt oo on op oq aw or bi"><span id="921b" class="lr la it on b gy os ot l ou ov">import requests <br/>import json</span><span id="2d71" class="lr la it on b gy ow ot l ou ov">api_url = "<a class="ae ky" href="https://blogdemo.westeurope.azurecontainer.io/v1/models/demo_model:predict" rel="noopener ugc nofollow" target="_blank">https://blogdemo.westeurope.azurecontainer.io/v1/models/demo_model:predict</a>"</span><span id="d527" class="lr la it on b gy ow ot l ou ov">data = json.dumps({"signature_name": "serving_default", "instances": [[10.0],[9.0]]})</span><span id="4e44" class="lr la it on b gy ow ot l ou ov">headers = {"content-type": "application/json"}</span><span id="c758" class="lr la it on b gy ow ot l ou ov">json_response = requests.post(api_url, data=data, headers=headers,verify=False,cert=("./certs/client.pem","./certs/client.key"),)</span><span id="da92" class="lr la it on b gy ow ot l ou ov">print(json_response.text)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/eccdda51d4f6e7e5db68cbed1019314f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dvxGGGRiv0w6sc2uCKrfEg.png"/></div></div></figure><p id="5f9a" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">重要提示:</strong>由于这是一个自签名证书，您必须设置<strong class="mj iu"> verify=False </strong></p><p id="7bbc" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><strong class="mj iu">无有效证书调用时:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/a9109250329c03e30891871586387f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*adJnZdOpViVEjMsyqHBL4w.png"/></div></figure><p id="dc80" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">部署#3:已完成！</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="d561" class="kz la it bd lb lc ns le lf lg nt li lj jz nu ka ll kc nv kd ln kf nw kg lp lq bi translated">第十一步:监控</h1><p id="399e" class="pw-post-body-paragraph mh mi it mj b mk nx ju mm mn ny jx mp lw oh mr ms lz oi mu mv mc oj mx my mz im bi translated">您可以在容器实例中监控模型的使用，并且可以在 nginx 日志中看到请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/2542db63906abff43c930f62eb76bafc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fteb_dXwhh0ormPPonlhnQ.png"/></div></div></figure></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="abc3" class="kz la it bd lb lc ns le lf lg nt li lj jz nu ka ll kc nv kd ln kf nw kg lp lq bi translated">常见问题:</h1><p id="83f9" class="pw-post-body-paragraph mh mi it mj b mk nx ju mm mn ny jx mp lw oh mr ms lz oi mu mv mc oj mx my mz im bi translated">问:我可以部署一个定制模型(没有 TF 服务)吗？是的。你必须<a class="ae ky" href="https://mlinproduction.com/docker-for-ml-part-4/" rel="noopener ugc nofollow" target="_blank">对接型号</a>，如果你使用正确的端口，其他一切都应该按预期工作。</p><p id="7c44" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">问:我能把它部署到 AWS 吗？<br/>答:是的，通过使用 nginx.config 和这篇博客里看到的 CA 配置。</p><p id="b17f" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated">问:我可以在 Docker Hub 上存储容器吗？答:是的。只需用 Docker Hub 中的用户名/repo:version 替换图像，并从 YAML 文件中删除 imageRegistryCredentials。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="be49" class="kz la it bd lb lc ns le lf lg nt li lj jz nu ka ll kc nv kd ln kf nw kg lp lq bi translated">资源:</h1><div class="pk pl gp gr pm pn"><a href="https://www.coursera.org/learn/advanced-deployment-scenarios-tensorflow/" rel="noopener  ugc nofollow" target="_blank"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd iu gy z fp ps fr fs pt fu fw is bi translated">TensorFlow | Coursera 的高级部署场景</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">将机器学习模型带入现实世界涉及的不仅仅是建模。这种专业化将…</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">www.coursera.org</p></div></div><div class="pw l"><div class="px l py pz qa pw qb ks pn"/></div></div></a></div><div class="pk pl gp gr pm pn"><a href="https://www.tensorflow.org/tfx/tutorials/serving/rest_simple" rel="noopener  ugc nofollow" target="_blank"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd iu gy z fp ps fr fs pt fu fw is bi translated">用 TensorFlow 服务训练和服务 TensorFlow 模型| TFX</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">警告:这款笔记本被设计为只能在 Google Colab * *上运行。它在系统上安装软件包，并需要…</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">www.tensorflow.org</p></div></div><div class="pw l"><div class="qc l py pz qa pw qb ks pn"/></div></div></a></div><div class="pk pl gp gr pm pn"><a href="https://medium.com/@samkreter/adding-ssl-tls-to-azure-container-instances-1e608a8f321c" rel="noopener follow" target="_blank"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd iu gy z fp ps fr fs pt fu fw is bi translated">向 Azure 容器实例添加 SSL/TLS</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">如今，SSL/TLS 是任何在互联网上运行的网站或应用程序的基本要求。不幸的是…</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">medium.com</p></div></div><div class="pw l"><div class="qd l py pz qa pw qb ks pn"/></div></div></a></div><div class="pk pl gp gr pm pn"><a href="https://www.ssltrust.com.au/help/setup-guides/client-certificate-authentication" rel="noopener  ugc nofollow" target="_blank"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd iu gy z fp ps fr fs pt fu fw is bi translated">在 Ubuntu 上通过 NGINX 使用基于客户端证书的认证</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">经过身份验证的 SSL/TLS 反向代理是保护您的应用程序免受攻击的强大方法。用户和坏…</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">www.ssltrust.com.au</p></div></div><div class="pw l"><div class="qe l py pz qa pw qb ks pn"/></div></div></a></div><div class="pk pl gp gr pm pn"><a href="https://fardog.io/blog/2017/12/30/client-side-certificate-authentication-with-nginx/" rel="noopener  ugc nofollow" target="_blank"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd iu gy z fp ps fr fs pt fu fw is bi translated">使用 nginx 进行客户端证书认证</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">应用程序中的身份验证非常困难。如果你决定推出自己的，安全问题几乎是肯定的。大多数…</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">fardog.io</p></div></div><div class="pw l"><div class="qf l py pz qa pw qb ks pn"/></div></div></a></div><div class="pk pl gp gr pm pn"><a href="https://mlinproduction.com/docker-for-ml-part-4/" rel="noopener  ugc nofollow" target="_blank"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd iu gy z fp ps fr fs pt fu fw is bi translated">使用 Docker 实时生成机器学习预测-生产中的 ML</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">如果我们想要实时生成预测，我们需要公开我们训练过的模型。展示我们模型的一种方式是…</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">mlinproduction.com</p></div></div><div class="pw l"><div class="qg l py pz qa pw qb ks pn"/></div></div></a></div><p id="28d9" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><a class="ae ky" href="https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/Reverse_proxy_h2g2bob.svg/1200px-Reverse_proxy_h2g2bob.svg.png" rel="noopener ugc nofollow" target="_blank">https://upload . wikimedia . org/Wikipedia/commons/thumb/6/67/Reverse _ proxy _ H2 G2 bob . SVG/1200 px-Reverse _ proxy _ H2 G2 bob . SVG . png</a></p><p id="477c" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><a class="ae ky" href="https://miro.medium.com/max/800/1*dIKRcFllFP3_-yqCysDitw.png" rel="noopener">https://miro . medium . com/max/800/1 * dikrcflfp 3 _-yqcysditw . png</a></p><p id="eb35" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><a class="ae ky" href="https://miro.medium.com/max/600/0*7eCQeU5D86SQeFHa.png" rel="noopener">https://miro.medium.com/max/600/0*7eCQeU5D86SQeFHa.png</a></p><p id="c2fc" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><a class="ae ky" href="https://cdn0.iconfinder.com/data/icons/home-security-2/45/security-06-512.png" rel="noopener ugc nofollow" target="_blank">https://cdn 0 . icon finder . com/data/icons/home-security-2/45/security-06-512 . png</a></p><p id="2892" class="pw-post-body-paragraph mh mi it mj b mk ml ju mm mn mo jx mp lw mq mr ms lz mt mu mv mc mw mx my mz im bi translated"><a class="ae ky" href="https://skillvalue.com/jobs/wp-content/uploads/sites/7/2019/10/data-scientist-freelance-remote-new-york.jpg" rel="noopener ugc nofollow" target="_blank">https://skill value . com/jobs/WP-content/uploads/sites/7/2019/10/data-scientist-freelance-remote-new-York . jpg</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qh"><img src="../Images/dc93252538e4d3f9bdbe610895793c1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RF3M_qZ-h1yDCKN1giDHLA.png"/></div></div></figure></div></div>    
</body>
</html>