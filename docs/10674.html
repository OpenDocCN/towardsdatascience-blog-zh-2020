<html>
<head>
<title>How to rewrite your SQL queries in Python with Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用熊猫用 Python 重写 SQL 查询</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-rewrite-your-sql-queries-in-python-with-pandas-8d5b01ab8e31?source=collection_archive---------9-----------------------#2020-07-26">https://towardsdatascience.com/how-to-rewrite-your-sql-queries-in-python-with-pandas-8d5b01ab8e31?source=collection_archive---------9-----------------------#2020-07-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f829" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 Python 中再现相同的 SQL 查询结果</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d0a2167bad247a7baab2a54f4fc2b563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uogTxM0a-lVa__VkjFBjew.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@hiteshchoudhary?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Hitesh Choudhary </a>在<a class="ae ky" href="https://unsplash.com/s/photos/python-programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="b1c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们中的一些人熟悉 SQL 中的数据操作，但不熟悉 Python，我们倾向于在项目中频繁地在 SQL 和 Python 之间切换，导致我们的效率和生产力降低。事实上，我们可以使用 Pandas 在 Python 中实现类似的 SQL 结果。</p><h1 id="d0aa" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">入门指南</h1><p id="882a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">像往常一样，我们需要安装熊猫包，如果我们没有它。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="efac" class="mx lw it mt b gy my mz l na nb">conda install pandas</span></pre><p id="4440" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本次会议中，我们将使用 Kaggle 著名的<a class="ae ky" href="https://www.kaggle.com/c/titanic/data?select=test.csv" rel="noopener ugc nofollow" target="_blank">泰坦尼克号数据集。</a></p><p id="3593" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在安装包和下载数据之后，我们需要将它们导入到 Python 环境中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="e99b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用 pandas 数据帧来存储数据，并使用各种 pandas 函数来操作数据帧。</p><h1 id="0870" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">选择、不同、计数、限制</h1><p id="f66e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们从我们经常使用的简单 SQL 查询开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="5bad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ne nf ng mt b">titanic_df[“age”].unique()</code>将在这里返回唯一值的数组，所以我们需要使用<code class="fe ne nf ng mt b">len()</code>来获得唯一值的计数。</p><h1 id="330a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">选择，WHERE，OR，AND，IN(带条件选择)</h1><p id="241f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">学完第一部分后，你应该知道如何用简单的方法探索数据框架。现在让我们尝试一些条件(也就是 SQL 中的<code class="fe ne nf ng mt b">WHERE</code>子句)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="6cc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们只想从数据框中选择特定的列，我们可以使用另一对方括号进行选择。</p><blockquote class="nh ni nj"><p id="1089" class="kz la nk lb b lc ld ju le lf lg jx lh nl lj lk ll nm ln lo lp nn lr ls lt lu im bi translated">注意:如果您选择多列，您需要将数组<code class="fe ne nf ng mt b">["name","age"]</code>放在方括号内。</p></blockquote><p id="fdb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ne nf ng mt b">isin()</code>的工作方式与 SQL 中的<code class="fe ne nf ng mt b">IN</code>完全相同。要使用<code class="fe ne nf ng mt b">NOT IN</code>，我们需要使用 Python 中的否定<code class="fe ne nf ng mt b">(~)</code>来达到相同的结果。</p><h1 id="23b1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">分组依据、排序依据、计数</h1><p id="ed10" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><code class="fe ne nf ng mt b">GROUP BY</code>和<code class="fe ne nf ng mt b">ORDER BY</code>也是我们用来探索数据的流行 SQL。现在让我们用 Python 来试试这个。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="d15f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们只想对计数进行排序，我们可以将布尔值传递给<code class="fe ne nf ng mt b">sort_values</code>函数。如果我们要对多列进行排序，那么我们必须将一个布尔值数组传递给<code class="fe ne nf ng mt b">sort_values</code>函数。</p><p id="e070" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ne nf ng mt b">sum()</code>函数将为我们提供数据帧中的所有聚合数字总和列，如果我们只需要一个特定的列，我们需要使用方括号指定列名。</p><h1 id="0ffb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">最小值、最大值、平均值、中间值</h1><p id="ab06" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">最后，让我们尝试一些在数据探索中很重要的常用统计函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="fef6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于 SQL 没有中位数函数，所以我将使用 BigQuery <code class="fe ne nf ng mt b">APPROX_QUANTILES</code>来获得年龄的中位数。</p><p id="92e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">熊猫聚合功能<code class="fe ne nf ng mt b">.agg()</code>还支持<code class="fe ne nf ng mt b">sum</code>等其他功能。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="e7f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你已经学会了如何<strong class="lb iu">用熊猫用 Python 重写你的 SQL 查询。</strong>希望这篇文章对你有用。如果我犯了任何错误或错别字，请给我留言。</p><p id="9da5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以在我的<a class="ae ky" href="https://github.com/chingjunetao/medium-article/tree/master/rewrite-sql-with-python" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Github </strong> </a>中查看完整的脚本。干杯！</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="900d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">如果你喜欢读这篇文章，你可能也会喜欢这些:</strong></p><div class="nv nw gp gr nx ny"><a rel="noopener follow" target="_blank" href="/manage-your-python-virtual-environment-with-conda-a0d2934d5195"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">使用 Conda 管理您的 Python 虚拟环境</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">轻松在 Python 2 和 Python 3 环境之间切换</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">towardsdatascience.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a rel="noopener follow" target="_blank" href="/how-to-send-email-with-attachments-by-using-python-41a9d1a3860b"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">如何使用 Python 发送带附件的电子邮件</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">作为一名数据分析师，我经常会收到这样的请求:“你能每周给我发一份报告吗？”或者…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">towardsdatascience.com</p></div></div><div class="oh l"><div class="on l oj ok ol oh om ks ny"/></div></div></a></div><p id="2002" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">你可以在 Medium 上找到我其他作品的链接，关注我</strong> <a class="ae ky" href="https://medium.com/@chingjunetao" rel="noopener"> <strong class="lb iu">这里</strong> </a> <strong class="lb iu">。感谢阅读！</strong></p></div></div>    
</body>
</html>