# 构建我的第一个机器学习模型| NBA 预测算法

> 原文：<https://towardsdatascience.com/building-my-first-machine-learning-model-nba-prediction-algorithm-dee5c5bc4cc1?source=collection_archive---------5----------------------->

## 融合体育分析和机器学习的世界

![](img/0a70df8101154f658c27987e8a4dbe36.png)

马库斯·斯皮斯克在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

**编辑:**自从写了这篇文章，我们已经在[https://infinity sports . ai](https://infinitysports.ai)推出了订阅服务，可以访问我们新的 NBA 预测模型的 API 和输出。我们现在能够预测赢家、差价和总点数。我非常喜欢在这个项目上工作，请随时与任何问题联系！

当我几年前开始编程的时候，我从来没有想过要用我新学到的技能做什么。我玩着制作视频游戏，制作基本的网站，iOS 应用程序，但在某种程度上，我没有专攻某一门手艺，分散了自己的精力。大约在这个时候，多伦多猛龙队进入了历史性的季后赛，我刚刚开始玩 bet365，碰巧在整个季后赛期间专门押注于他们，获得了丰厚的利润。

鉴于我在商业和计算机科学方面的背景，我想更多地了解定量分析师和数据科学家的角色。鉴于我的 python 背景，我开始探索数据科学的世界，并从学习 Scikit-learn 包的基础开始。本文的其余部分将概述我是如何从对数据科学和机器学习几乎一无所知，到构建我的第一个 NBA 预测模型，准确率约为 72%(稍后将详细介绍，但结果并不像看起来那么好)。

# 目录

1.  **游戏计划**
2.  **数据采集**
3.  **数据探索&处理**
4.  **选择合适的型号**
5.  **测试和结果**

# 游戏计划

在过去的 10-20 年里，NBA 以及其他许多体育项目已经见证了统计学的应用呈指数级增长。我通过阅读 [*开始搜索最相关的 NBA 统计数据，NBA 统计数据实际上转化为胜利*](https://watchstadium.com/which-nba-statistics-actually-translate-to-wins-07-13-2019/) 作者 *Chinmay Vayda* 。他的研究发现，NBA 获胜的最佳预测因素是球队的进攻得分、防守得分、篮板差、3.5%以及其他数据，你可以通过上面的链接了解更多信息。

![](img/b1a5f2d1dc09766e4d0156b9537e2e31.png)

在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上 [NeONBRAND](https://unsplash.com/@neonbrand?utm_source=medium&utm_medium=referral) 拍摄的照片

我计划使用更近的数据，通过利用 NBA 的**月度**统计数据，并使用这些数据作为在那个**月**进行的比赛的预测。因为这是我第一次尝试建立一个模型，所以我想保持数据简单，并保持数学复杂性最小。

下一步是弄清楚如何获取这些数据。我需要一个过去 10 年比赛结果的数据源，以及一个球队在任何给定月份的统计数据。

# 数据采集

对于这个项目的数据获取部分，我使用了 [Selenium](https://selenium-python.readthedocs.io/) ，这是一个方便 web 抓取的 python 包，用于从各种网站获取我需要的数据。我还决定将我的搜索限制在从 2008-2009 赛季至今的数据上。

## 过去的结果

我过去比赛结果的数据来源是 Basketball-Reference.com 的比赛结果，可以追溯到 1946 年。

![](img/a8ee503d0c6a7fbfa4f28bfd55c0c06a.png)

[Basketball-Reference.com](https://basketball-reference.com)上的数据源截图

用 Selenium，我把这些表格一张张刮下来，转换成 CSV 文件，以备后用。

## 过去的月度统计

我还需要知道每个月每个球队的统计数据，我的数据来源是 NBA 官方统计页面。在调整了一些过滤器之后，我最终得到了下表。

![](img/112f5fdbcb576461bb117e90f80bb853.png)

[NBA 高级统计数据](https://stats.nba.com/)上的数据源截图

我又一次使用 Selenium，把这些月度统计表刮下来，保存为 CSV 文件。我的下一步是将这些文件合并成一个数据集。

# 数据处理和探索

## 数据处理

我们现在必须以一种可以进行比较和分析的格式处理我们的 2 组 CSV 文件。我在下面嵌入了每个 CSV 文件的前 5 行的例子，正如它们被废弃一样。

原始形式的结果和统计数据的前 5 行。

我们注意到的第一件事是，两个表都没有标题，这需要通过引用原始表来手动添加。其次，我们的数据集中有多个空列，需要删除它们。最后，在我们的结果数据集中，我们需要删除*时间列*、*框分数文本*和*出席人数*，因为它们对我们没有用。

按照这些步骤，我们的数据集现在看起来像这样:

结果和统计后处理的前 5 行。

下面的代码概述了我如何着手合并这两个 CSV 文件，以及添加一个新列来表示团队 1 是赢还是输，这将成为我们的**预测变量**。我贴上代码是因为合并的细节不容易解释，但是如果你感兴趣，你可以看看下面。

执行上述代码后，我们的数据集现在看起来像这样:

我们现在有了我们的数据集，它比较了每个队的统计数据以及哪个队赢得了这场遭遇战。在这个过程的最后，我们的数据集包含超过 **13，000 场独特的比赛**！这个数据集现在非常接近于为机器学习分析做好准备。

由于我只需要团队名称和分数来合并数据集，并找出哪个团队赢了，所以我也将删除这些列，留下一个数据集，现在可以对其进行探索和建模以进行机器学习。

## 数据探索

我们当前的数据集如下所示:

我现在有兴趣知道我们数据集中的各种统计数据是如何相互关联的。我的一个朋友向我介绍了一个名为 [Speedml](https://speedml.com/) 的伟大的 python 包，它简化了探索性分析的过程，并生成了非常好看的图表来共享您的数据。

当您有数字要素时，查看数据集中的每个要素如何与其他要素相关总是很有趣的。下图说明了我们的**特征相关性**，它有一些我们可以得出的有趣见解。

![](img/f4d1e0d9b5131a02e591f8b8d3248746.png)

**Speedml** 生成特征关联图

首先，我们可以看出，因为左上和右下象限具有最相关的特征，所以团队的统计数据与其自身有很强的相关性。如果一个团队的节奏很快，它可能也会有很高的效率。

我们还看到,“Team1Win”功能与任何特定功能都没有很强的相关性，尽管有一些功能可能比其他功能具有更强的相关性。这让我创建了一个**特性重要性**图，这是 Speedml 中包含的另一个易于使用的实现。

![](img/65c58b296d028a4a025d0915df193460.png)

团队统计特征重要性

虽然我们确实看到了一些更重要的特性，但我们没有明确的理由在这一点上消除任何特性，但它允许进行一些有趣的观察。

![](img/764f31ea010150fd137913154b919b10.png)

Team2NETRTG vs Team1Win 的带状图

从上面的带状图中可以看出 Team2NETRTG 如此重要的原因；当团队 2 的净评分*较高*时，团队 1 赢得*的机会往往会少于*，反之，当团队 2 的净评分较低时，团队 1 获胜的机会往往会更高。

![](img/a5aeb32ca4fad031e6059495ba39c264.png)

客队胜率

最后，我觉得有趣的最后一个情节是*队 1 胜*的分布。我们获取数据的方式是，团队 1 总是客队。这种分布显示，客场球队输掉了大约 59%的时间，这说明了我们所知道的主场优势。

# 选择正确的模型

我选择使用 Scikit-learn，因为它易于实现各种算法，并且我有使用 python 的经验。使用 Scikit-learn 提供的流程图，我确定了几个我想尝试的模型，并查看哪一个在我的数据集上表现得最准确。我的尝试开始如下:

在所有尝试的模型中，准确率最高的是**支持向量机 SVC 分类器**，对历史数据的准确率为 72.52%！现在是时候在现实世界中测试这个模型了，在新冠肺炎事件导致 NBA 停摆之前，我尝试预测了 67 场比赛的结果。

# 测试和结果

在我的前 28 场比赛预测中，我只是简单地说出谁会赢，没有考虑我得到的差距。在我预测的剩余时间里，我实现了一种计分方法，根据哪支球队更有可能获胜，给出了我的算法创建的一个分布。我的算法准确性结果如下:

我的算法的一个主要弱点是预测混乱的能力。在运行我的模型的第一天，7 场比赛中有 5 场是失败者赢了比赛。我的算法通常与在线体育博彩网站发布的内容一致，这是一个好迹象。在网上阅读，我们可以看到 NBA 通常有[32.1%](https://www.oddsshark.com/sports-betting/which-sport-do-betting-underdogs-win-most-often)的爆冷率，而我的样本量有 40.2%的爆冷率。

我还想尝试一种财务策略，并开始简单地在预测的赢家身上下注。但是在更新了我的模型之后，我实现了一个货币线，并与 bet365 提供的货币线进行了比较。我比较了我和 bet365 的赔率，选择了两者中更有利的一个。下面我们可以看到盲目和选择性策略的结果。

我们可以立即看出选择性是一个更好的策略，它包括选择更有利的机会。

我一直等到文章的结尾来解决这个问题，但是这个模型中的一个主要缺陷，我花了几个月才意识到，就是它使用的数据是有偏见的。简而言之，一个球队的月度统计数据直接受到他们当月比赛表现的影响，所以考虑到我是用一个月的统计数据来预测球队的表现，统计数据**已经包括了**他们在那些比赛中的表现。这种认识让我开始建立我的新 NBA 预测模型。

# 未来的步骤

我选择现在撰写和发布这篇文章的原因是，我在 2020 年 1 月/2 月建立了这个模型，我一直在致力于一个更新的、更全面的模型，该模型将使用人工神经网络来预测不是赢或输，而是每次遭遇的实际分数。这种新模式将基于一个团队中的球员，而不是整个团队。我将在接下来的几周写下这段旅程，并希望分享一些好消息！

如果你喜欢这篇文章或者想讨论提到的任何信息，你可以通过 [Linkedin](https://www.linkedin.com/in/alexanderfayad/) 、 [Twitter](https://twitter.com/alexanderfayad) 或者通过[电子邮件](mailto:alexander.fayad@queensu.ca)联系我。