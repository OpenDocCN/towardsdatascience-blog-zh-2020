<html>
<head>
<title>Spatial Data Science with PostgreSQL: Geometries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 PostgreSQL 的空间数据科学:几何</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/spatial-data-science-with-postgresql-geometries-c00387755700?source=collection_archive---------20-----------------------#2020-06-23">https://towardsdatascience.com/spatial-data-science-with-postgresql-geometries-c00387755700?source=collection_archive---------20-----------------------#2020-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c8a4" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">波斯特吉斯</h2><div class=""/><div class=""><h2 id="7eba" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">PostGIS 几何类型和函数的初学者演练。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/f2db1813a2b186a031623c64f5c76525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NIF9k1TS8SrVuYO2"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">罗纳德·杨在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9062" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated">T4:几何是将地理空间数据结合在一起的粘合剂。它们是任何空间数据处理不可或缺的一部分。在本教程中，我将介绍 Postgis 中一些不同类型的几何。我们还将通过真实世界的数据示例触及一些最常用的函数。</p><p id="bd12" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我的上一篇文章中，我解释了如何安装 PostgreSQL 和激活 Postgis 扩展。我们还讲述了如何在 PgAdmin 中快速入门、创建空间数据库和加载空间数据。因此，如果您还没有设置 PostgreSQL 和 PostGIS，您可以以此为起点。</p><div class="mn mo gp gr mp mq"><a rel="noopener follow" target="_blank" href="/spatial-data-science-with-postgresql-postgis-2f941c8c367a"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd jd gy z fp mv fr fs mw fu fw jc bi translated">使用 PostgreSQL/PostGIS 的空间数据科学</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">PostgreSQL 和 Python 空间数据入门实用指南。</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">towardsdatascience.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne lb mq"/></div></div></a></div><h1 id="a05d" class="nf ng it bd nh ni nj nk nl nm nn no np ki nq kj nr kl ns km nt ko nu kp nv nw bi translated">几何</h1><p id="d7cb" class="pw-post-body-paragraph li lj it lk b ll nx kd ln lo ny kg lq lr nz lt lu lv oa lx ly lz ob mb mc md im bi translated">在 PostGIS 中，开放地理空间联盟(OGC)和“SQL 的简单特征”规范中指定的所有对象和函数都可用。Postgis 中支持的几何数据类型包括:</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="bbd9" class="oh ng it od b gy oi oj l ok ol">POINT()</span><span id="7a33" class="oh ng it od b gy om oj l ok ol">LINESTRING()</span><span id="6a3e" class="oh ng it od b gy om oj l ok ol">POLYGON((),())</span><span id="444b" class="oh ng it od b gy om oj l ok ol">MULTIPOINT((),())</span><span id="17f0" class="oh ng it od b gy om oj l ok ol">MULTILINESTRING((),())</span><span id="a537" class="oh ng it od b gy om oj l ok ol">MULTIPOLYGON(((),()), (()))</span><span id="1afc" class="oh ng it od b gy om oj l ok ol">GEOMETRYCOLLECTION(POINT(),LINESTRING())</span></pre><p id="57f3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">PostGIS 还扩展了栅格数据类型以及 3d(高度表示为 Z)和 4d(时间通常表示为 M)几何类型。</p><p id="77ca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">将空间数据转换为 PostGIS 几何可让您充分利用 PostGIS 中的空间功能。一个新的最受欢迎的特性是 PgAdmin 中内置的几何可视化，我们将在下一节中看到。在本教程中，我们只涉及基本的几何，点，多边形和直线。其他几何图形是这些基本几何图形类型的扩展版本。</p><h2 id="8888" class="oh ng it bd nh on oo dn nl op oq dp np lr or os nr lv ot ou nt lz ov ow nv iz bi translated">点</h2><p id="bfc0" class="pw-post-body-paragraph li lj it lk b ll nx kd ln lo ny kg lq lr nz lt lu lv oa lx ly lz ob mb mc md im bi translated">我们从点几何开始，它通常指的是空间中没有大小和宽度的点。让我们看看现实世界数据中的点几何，并在 PostGIS 中探索它的一些方法。</p><p id="238e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">传统的 SQL 查询包含 SELECT 和 From。在下一段 SQL 中，我们返回前面上传的 tfl_stations 数据集的前十行。</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="cf49" class="oh ng it od b gy oi oj l ok ol">SELECT id, name, zone, geom <br/>FROM public.tfl_stations<br/>LIMIT 10;</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/601a453c3179b397cbf5d8022935dfcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*hU7_KP9UVDNmAQRJ-z8X3A.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">电台表</p></figure><p id="218b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个结果，但是，有几何列，如果你点击眼睛，你会看到你的几何渲染如下图。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oy"><img src="../Images/4b8228fc234cbf76a22840c9994e3654.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*azfuXJWEeYvmfQosabzLIg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">几何可视化</p></figure><p id="9a28" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要获得数据的几何类型，可以使用<strong class="lk jd"> ST_GeometryType(geom) </strong>来找出。例如，以下 SQL 代码会返回车站数据集的几何数据类型。</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="9916" class="oh ng it od b gy oi oj l ok ol">SELECT ST_GeometryType(geom)<br/>FROM tfl_stations<br/>FETCH FIRST ROW ONLY</span></pre><p id="7d2d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如我们所料，这个查询返回 ST_Point。</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="75d3" class="oh ng it od b gy oi oj l ok ol">“ST_Point”</span></pre><p id="03af" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您喜欢将几何图形作为带坐标的文本，也可以使用<strong class="lk jd"> ST_AsText(geom)。</strong>下面的查询返回每个点的坐标。</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="40f6" class="oh ng it od b gy oi oj l ok ol">SELECT name, zone, ST_AsText(geom)<br/>FROM tfl_stations<br/>LIMIT 10;</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/7ab594069589a5c22615b3ede3314c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*4niWoQjRvpE3zhK1WVp8GQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">ST_AsText</p></figure><p id="20bd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要分别访问坐标，我们可以使用 ST_X 和 ST_Y，如下例所示。</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="006c" class="oh ng it od b gy oi oj l ok ol">SELECT name, zone, ST_X(GEOM) AS Longitude, ST_Y(GEOM) AS Latitude<br/>FROM tfl_stations<br/>FETCH FIRST 10 ROW ONLY</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/e38c3b1626db301d4819b5c37f0e2073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*g5aZ_7NAB_MB7iC8HidqnQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">圣 X(GEOM)和圣 Y(GEOM)</p></figure><p id="c302" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是 PostGIS 中点函数的一些亮点:</p><ul class=""><li id="7c1b" class="pb pc it lk b ll lm lo lp lr pd lv pe lz pf md pg ph pi pj bi translated"><a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_MakePoint.html" rel="noopener ugc nofollow" target="_blank"> ST_MakePoint </a>，<a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_MakePointM.html" rel="noopener ugc nofollow" target="_blank"> ST_MakePointM </a>，<a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_PointFromText.html" rel="noopener ugc nofollow" target="_blank"> ST_PointFromText </a>，<a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_PointFromWKB.html" rel="noopener ugc nofollow" target="_blank">ST _ PointFromWKB</a>→创建点，这些函数是从不同的数据源构造点的不同类型。</li><li id="78a7" class="pb pc it lk b ll pk lo pl lr pm lv pn lz po md pg ph pi pj bi translated"><a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_ClosestPoint.html" rel="noopener ugc nofollow" target="_blank"> ST_ClosestPoint </a> →返回 g1 上最接近 g2 的二维点。这是最短直线的第一点。</li><li id="c498" class="pb pc it lk b ll pk lo pl lr pm lv pn lz po md pg ph pi pj bi translated"><a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_Buffer.html" rel="noopener ugc nofollow" target="_blank"> ST_Buffer </a> →返回一个几何图形，该几何图形表示与该几何图形的距离小于或等于该距离的所有点。</li></ul><h2 id="5c9e" class="oh ng it bd nh on oo dn nl op oq dp np lr or os nr lv ot ou nt lz ov ow nv iz bi translated">线串</h2><p id="3be7" class="pw-post-body-paragraph li lj it lk b ll nx kd ln lo ny kg lq lr nz lt lu lv oa lx ly lz ob mb mc md im bi translated">线串是两点或多点之间连接的直线。在 PostGIS 中，您可以通过连接点构建线。</p><p id="2fdc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们已经上传了街道数据集，所以让我们查询数据。</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="be7a" class="oh ng it od b gy oi oj l ok ol">SELECT streetname, streetclas, streettype, ST_Length(geom) AS STREET_LENGTH<br/>FROM public.streets<br/>LIMIT 10;</span></pre><p id="f7c4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用 PostGIS 中的 ST_length，我们只需在数据集中创建一个附加列，使用 PostGIS 中的 ST_Length 计算每条街道的长度。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/2be35b781ecb7d5e903b3c15d9ec9145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*YIHOSHuB_y9R6rfgU7vYdQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">ST _ 长度</p></figure><p id="c7cb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是什么测量单位？您需要查看数据集的空间参考系统。要查找数据集使用的 SRID，您可以使用 Find_SRID 或圣 SRID 进行查找。我们这里用的是后一种</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="889b" class="oh ng it od b gy oi oj l ok ol">SELECT ST_SRID(geom)<br/>FROM public.streets<br/>LIMIT 1;</span></pre><p id="7752" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们发现我们有 EPSG:26917，它使用米作为度量单位。让我们把街道长度改为公里，因为我们现在知道米是计量单位。</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="ca21" class="oh ng it od b gy oi oj l ok ol">SELECT streetname, streetclas, streettype, ST_Length(geom)/1000 AS STREET_LENGTH_KM<br/>FROM public.streets<br/>LIMIT 10;</span></pre><p id="378b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是 PostGIS 中线串函数的一些亮点:</p><ul class=""><li id="4b42" class="pb pc it lk b ll lm lo lp lr pd lv pe lz pf md pg ph pi pj bi translated"><a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_LinestringFromWKB.html" rel="noopener ugc nofollow" target="_blank"> ST_LinestringFromWKB </a>，<a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_MakeLine.html" rel="noopener ugc nofollow" target="_blank"> ST_MakeLine </a> →构建线串几何图形。</li><li id="4ba9" class="pb pc it lk b ll pk lo pl lr pm lv pn lz po md pg ph pi pj bi translated"><a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_ShortestLine.html" rel="noopener ugc nofollow" target="_blank">ST _ shortest line</a>-返回两个几何图形之间的二维最短直线。</li><li id="c80f" class="pb pc it lk b ll pk lo pl lr pm lv pn lz po md pg ph pi pj bi translated"><a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_LongestLine.html" rel="noopener ugc nofollow" target="_blank"> ST_LongestLine </a> —返回两个几何图形的二维最长线点。如果不止一行，函数将只返回找到的第一个最长的行。返回的行总是以 g1 开始，以 g2 结束。该函数返回的直线长度将始终与 st_maxdistance 为 g1 和 g2 返回的长度相同。</li></ul><h2 id="def5" class="oh ng it bd nh on oo dn nl op oq dp np lr or os nr lv ot ou nt lz ov ow nv iz bi translated">多边形</h2><p id="14ee" class="pw-post-body-paragraph li lj it lk b ll nx kd ln lo ny kg lq lr nz lt lu lv oa lx ly lz ob mb mc md im bi translated">多边形由闭合的线串构成。多边形包含所有封闭的区域及其边界，而边界中封闭的线串称为外环</p><p id="ce01" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在下一个示例中，我们将使用 PostGIS 中的 ST_Area(geom)函数计算每个建筑物的面积。</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="2ea1" class="oh ng it od b gy oi oj l ok ol">SELECT theme, ST_Area(geom)<br/>FROM public.buildings<br/>LIMIT 10;</span></pre><p id="0bbf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是 PostGIS 中多边形函数的一些亮点:</p><ul class=""><li id="9c46" class="pb pc it lk b ll lm lo lp lr pd lv pe lz pf md pg ph pi pj bi translated"><a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_MakePolygon.html" rel="noopener ugc nofollow" target="_blank"> ST_MakePolygon </a>，<a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_Polygon.html" rel="noopener ugc nofollow" target="_blank"> ST_Polygon </a>，<a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_PolygonFromText.html" rel="noopener ugc nofollow" target="_blank"> ST_PolygonFromText </a> →创建一个多边形几何体。</li><li id="3240" class="pb pc it lk b ll pk lo pl lr pm lv pn lz po md pg ph pi pj bi translated"><a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_ExteriorRing.html" rel="noopener ugc nofollow" target="_blank"> ST_ExteriorRing </a> →返回一个代表<code class="fe pq pr ps od b">POLYGON</code>几何体外环的字符串。如果几何图形不是多边形，则返回 NULL。不适用于多重多边形</li><li id="99c4" class="pb pc it lk b ll pk lo pl lr pm lv pn lz po md pg ph pi pj bi translated"><a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_NRings.html" rel="noopener ugc nofollow" target="_blank"> ST_NRings </a> —如果几何图形是多边形或多多边形，则返回环的数量。</li><li id="e79d" class="pb pc it lk b ll pk lo pl lr pm lv pn lz po md pg ph pi pj bi translated"><a class="ae lh" href="https://postgis.net/docs/manual-2.0/ST_Within.html" rel="noopener ugc nofollow" target="_blank">ST _ Within</a>-如果几何图形 A 完全在几何图形 b 内，则返回 true</li></ul><h2 id="4f50" class="oh ng it bd nh on oo dn nl op oq dp np lr or os nr lv ot ou nt lz ov ow nv iz bi translated">结论</h2><p id="9adc" class="pw-post-body-paragraph li lj it lk b ll nx kd ln lo ny kg lq lr nz lt lu lv oa lx ly lz ob mb mc md im bi translated">几何构成了空间数据分析的基本块。在本教程中，我们看到了 PostGIS 中不同类型的几何。通过一些例子，我们还介绍了每种几何类型的基本功能，包括点、多边形和线串。</p></div></div>    
</body>
</html>