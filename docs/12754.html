<html>
<head>
<title>11 Examples to Master Pandas Groupby Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">掌握熊猫分组功能的 11 个例子</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/11-examples-to-master-pandas-groupby-function-86e0de574f38?source=collection_archive---------7-----------------------#2020-09-02">https://towardsdatascience.com/11-examples-to-master-pandas-groupby-function-86e0de574f38?source=collection_archive---------7-----------------------#2020-09-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3957" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 EDA 过程中使用的最佳函数。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e742e60e536406dfa9b20f31dad6b2cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4bNQ1jYP-IwhNu8x.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·斯皮斯克在<a class="ae ky" href="https://unsplash.com/s/photos/different-colors?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="7b57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas <strong class="lb iu"> Groupby </strong>函数是一个多功能且易于使用的函数，有助于获得数据的概览。这使得探索数据集和揭示变量之间的潜在关系变得更加容易。</p><p id="f71d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本帖中，我们将通过 11 个不同的例子来全面理解<strong class="lb iu"> groupby </strong>函数，并看看它在探索数据时如何有用。</p><p id="fbb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将使用<a class="ae ky" href="https://www.kaggle.com/sonalidasgupta95/churn-prediction-of-bank-customers" rel="noopener ugc nofollow" target="_blank">客户流失数据集</a>作为示例。第一步是将数据集读入熊猫数据帧。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="54e6" class="ma mb it lw b gy mc md l me mf">import pandas as pd<br/>import numpy as np</span><span id="1625" class="ma mb it lw b gy mg md l me mf">df = pd.read_csv("/content/Churn_Modelling.csv")</span><span id="660f" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/ba63db89f1253a4e70bf0733861c0008.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ge2t3MsvInORbvjPeAGURA.png"/></div></div></figure><p id="7390" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有一些关于银行客户及其产品的特征。这里的目标是预测客户是否会使用提供的功能流失(即退出= 1)。</p><p id="530e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从机器赚的角度来说，这是一个分类问题。Groupby 函数可用于探索特性如何相关或如何对目标变量产生影响(“Exited”)。</p><p id="4a0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图是 groupby 函数的逻辑和工作原理。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/a0c06f28e0e242886ee11286f0d0d137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Nu8unmGXa3n1cAGY.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Groupby 函数(图片由作者提供)</p></figure><p id="63f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从例子开始。</p><p id="b057" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个是检查性别对客户流失是否有影响。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="55a6" class="ma mb it lw b gy mc md l me mf">#example 1<br/>df[['Gender','Exited']].groupby('Gender').mean()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/5764a4950f4ecc7f60151a58f67a2617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*tvvJ1gAKyQjncAXJ0WDEQg.png"/></div></figure><p id="980c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们获取了数据帧的一个子集，它由性别和退出列组成。然后，我们根据性别列中的值(男性和女性)对行进行分组。最后，应用一个集合函数。结果是女性和男性的平均流失率。</p><p id="4b1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了平均值之外，您可能还想了解数据集中有多少男性和女性。如果存在极端的不平衡，检查平均值可能会导致错误的假设。</p><p id="d28e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决方案是将 mean 和 count 都用作聚合函数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="fd49" class="ma mb it lw b gy mc md l me mf">#example 2<br/>df[['Gender','Exited']].groupby('Gender').agg(['mean','count'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/d7eb686d05a1863abe91977c9564ee16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*QbyjhHAaFfo4D9DdydW6pQ.png"/></div></figure><p id="37fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">女性和男性的数量接近，所以不存在很大的不平衡。平均而言，女性的流失率高于男性。</p><p id="961e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能会觉得只根据性别来做比较太笼统了。在这种情况下，我们可以通过向 group by 函数传递一个列列表来按多个列进行分组。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="feaa" class="ma mb it lw b gy mc md l me mf">#example 3<br/>df[['Gender','Geography','Exited']].groupby(['Gender','Geography']).mean()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/d41274ee88c5ec2352773ab6cd5ee774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*BAwK8uQsGMNR4T_qzf6ITw.png"/></div></figure><p id="1769" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的数据集中，这三个国家的女性流失率较高。</p><p id="b6e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以对结果进行排序。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="809a" class="ma mb it lw b gy mc md l me mf">#example 4<br/>df[['Gender','Geography','Exited']].groupby(['Gender','Geography']).mean().sort_values(by='Exited')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/e4e2b92063747e6a245ce0ef2e67166b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*jLRFCcCL_JJvIQfPe0BMCw.png"/></div></figure><p id="0679" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果按升序排列，但我们可以使用<strong class="lb iu">升序</strong>参数进行更改。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="eb4d" class="ma mb it lw b gy mc md l me mf">#example 5<br/>df[['Gender','Geography','Exited']].groupby(['Gender','Geography']).mean().sort_values(by='Exited', ascending=False)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/dd4faa7a9bbdce132b5a01a7a2e79a6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*0gSWtLy2z9kSZsTQvNqn7g.png"/></div></figure><p id="d5a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以基于另一个特征中的组来检查多个特征。让我们来看看不同国家的年龄和任期是如何变化的。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="45ad" class="ma mb it lw b gy mc md l me mf">#example 6<br/>df[['Geography','Age','Tenure']].groupby(['Geography']).agg(['mean','max'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/3bd77212f915386791fb6a4152b7e20f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*_JGg2TqpjtWPeTlmjuNGXg.png"/></div></div></figure><p id="e73e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这三个国家中，年龄和任期列的平均值和最大值非常接近。</p><p id="0082" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们也将“Exited”列添加到示例 6 中。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3d70" class="ma mb it lw b gy mc md l me mf">#example 7<br/>df[['Exited','Geography','Age','Tenure']].groupby(['Exited','Geography']).agg(['mean','count'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/942c108edb4ec72c04c577ef3aedc138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*94za1yRmfGxNQd5ahO-SaQ.png"/></div></figure><p id="e9de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以根据任何列对结果进行排序。但是，由于它是一个多索引，我们需要向 sort_values 函数传递一个元组。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3914" class="ma mb it lw b gy mc md l me mf">#example 8<br/>df[['Exited','Geography','Age','Tenure']].groupby(['Exited','Geography']).agg(['mean','count']).sort_values(by=[('Age','mean')])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/9a1ff9e3f6f50d132523673186428249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*D9qNCwn9g1pJgkuWnZViag.png"/></div></figure><p id="9a81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果按(“年龄”、“平均值”)列排序。</p><p id="b715" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">groupby 函数中的变量作为结果数据帧的索引返回。我们可以通过将<strong class="lb iu"> as_index </strong>参数设置为 false 来改变它。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6aa2" class="ma mb it lw b gy mc md l me mf">#example 9<br/>df[['Exited','IsActiveMember','NumOfProducts','Balance']].groupby(['Exited','IsActiveMember'], as_index=False).mean()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/a2ad2af7ebeb80f4bccdc4a3ee938b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*qd6ldbOHYvacwP3K9T_Rzw.png"/></div></figure><p id="d2e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">groupby 函数中的每一列都用一个列表示。每个类别组合都有一行。</p><p id="a626" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，groupby 函数会删除缺少的值。我们的数据集没有任何缺失值。让我们添加一些缺失的值，看看如何使用<strong class="lb iu"> dropna </strong>参数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ab54" class="ma mb it lw b gy mc md l me mf">#example 10<br/>df['Geography'][30:50] = np.nan</span><span id="325e" class="ma mb it lw b gy mg md l me mf">df[['Geography','Exited']].groupby('Geography').mean()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/b89bf96380d306e8b06368927a089522.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*aNFDhkZDXnrT_1V_K-1IgQ.png"/></div></figure><p id="c4c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管我们在 geography 列中缺少值，但它们被忽略了。我们可以通过将 dropna 参数设置为 false 来更改它。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3603" class="ma mb it lw b gy mc md l me mf">#example 11<br/>df[['Geography','Exited']].groupby('Geography', dropna=False).agg(['mean','count'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/0b038a551285134c7330eab289b4f3b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*J17MEYA41sMptXQs9RTqeQ.png"/></div></div></figure><p id="dfc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，还有另一类缺失值。</p><blockquote class="ms mt mu"><p id="6aef" class="kz la mv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:为了使用 groupby 函数的 dropna 参数，你需要有 pandas 版本 1.1.0 或更高版本。</p></blockquote></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><p id="783c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以多样化的例子，但基本的逻辑是相同的。Groupby 函数可用作探索性数据分析过程的第一步，因为它让我们了解数据集中变量之间的关系。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><p id="e825" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>