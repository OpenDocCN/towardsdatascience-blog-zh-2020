# “使用神经网络预测股票价格”——不要被愚弄了

> 原文：<https://towardsdatascience.com/using-neural-networks-to-predict-stock-prices-dont-be-fooled-c43a4e26ae4e?source=collection_archive---------15----------------------->

## 许多人声称他们可以使用机器学习来预测股票和加密货币的价格；但没人能证明靠实时数据盈利。有什么条件？

![](img/70eedbabfb150f3c712af3a92c9cbba8.png)

公共使用信贷:pixabay.com

***注来自《走向数据科学》的编辑:*** *虽然我们允许独立作者根据我们的* [*规则和指导方针*](/questions-96667b06af5) *发表文章，但我们不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的* [*读者术语*](/readers-terms-b5d780a700a4) *。*

如果你正在阅读这篇文章，你可能已经在网上看到过使用股票/加密货币数据和机器学习算法来“预测”未来价格的博客帖子/文章。在这里，我展示了一个类似的项目，其中我使用一些指标，如 Tweet 量、Google Trends 量、市值和交易量来“预测”明天的开盘价。在这个例子中，我们将关注比特币价格，因为这是一个热门话题，但只要数据可用，这可以外推至任何资产。有人可能会天真地认为，当有一天人们在推特上谈论比特币，在谷歌上搜索比特币，并比平时更多地交易比特币时，我们可能会看到比特币的价格明天会比今天更高。此外，也许我们可以根据这些数据以足够高的精度预测明天的开盘价，最终产生一个有利可图的交易算法。为了检验这一假设，我从经济学、谷歌趋势和其他免费在线资源中收集了一些数据，得出了以下数据框架。

![](img/9c4ddea3f9ce1262de3f9ff08e6dd9ad.png)

从机器学习的角度来看，我们可以将这四个列视为我们的功能集，将“价格”列视为我们的目标。更具体地说，明天的价格是今天特性的目标。通过一点功能工程，我们还可以包括过去一天、过去两天、过去三天等指标的变化，其中大于 1 的值表示增加，小于 1 的值表示减少。

![](img/71107dcc9d4e4dcecbf028f2acef1cb9.png)

在单个实例中对最近的变化进行编码的工程特性

## **线性回归**

现在我们有了数据集，让我们使用一些机器学习技术来看看我们是否可以准确预测明天的开盘价。

上面的代码使用 Scikit-Learn 执行简单的线性回归，并产生以下输出:

![](img/f345d79003087a70c5d35196ca170f47.png)

预测价格与实际价格。R = 0.99008。RMSE=358.12

如果我们沿着时间轴绘制我们的预测价格和实际价格，我们观察到:

![](img/102e659953a99b3f6097dcd17f34e73b.png)

一段时间内的预测价格和实际价格

哇！这太不可思议了！真的这么简单吗？你所要做的就是从网上获得一些搜索和交易量数据，并使用简单的线性回归，你就可以准确预测比特币的价格？不幸的是，事实并非如此。更不幸的是，网上有很多人展示这样的结果，并声称拥有神奇的快速致富交易算法。我每天在各种提要上看到的无数文章都使用这样的技巧，以及一些流行词汇，如“机器学习”、“人工智能”和“神经网络”，来抓住你的注意力，让你认为他们在做什么。你抓到窍门了吗？

这里的技巧是，昨天的价格被输入到具有特征集的模型中(或者通常类似于 avg last 5 days)。该模型很快了解到，将预测值固定在昨天的价格上，然后根据其他特征将其略微调高或调低，以尝试朝着正确的方向进行预测，这是最好的方法。一般来说，这个*可能是*一个不错的策略。例如，如果其他特征完美地指示了价格变动，这将非常有用。本质上，你的模型会使用昨天的价格作为基线，然后预测上涨或下跌。如果它能像许多人声称的那样准确预测涨跌，你就能快速致富！这里主要的、欺骗性的问题是在实际价格和预测价格之间使用像 R 或 RMSE 这样的指标来向人们展示“看我的模型预测得多好！”。任何有统计学背景的人都会将 0.99 的 R 值视为一个值得崇拜的模型。尽管在这种情况下，在训练数据中包含以前的价格保证了由残差评估的这种性能。我也见过文章/博客文章的标题照片是一个类似于上面显示的 plotly 输出的情节；此外，没有代码向读者显示以前的价格实际上包括在回归算法中。如果我运行同样的算法，但是用随机生成的值填充量要素，并且只包括今天的价格数据作为信息要素，那么从远处看输出将是相同的，R 也将非常高。实现这种把戏的一种更偷偷摸摸的方法是建立一个递归神经网络或 LSTM 模型，用 *n* 个以前的价格为网络的每个实例排序，然后不打乱训练数据。你告诉网络最小化损失，网络很快学会:“嘿，看，如果我用昨天的价格来预测，损失函数最小化！”。

## **回溯测试**

为了进一步证明这种交易策略的盈利能力，我做了一些回溯测试，看看如果你真的用这些预测进行日常比特币交易会发生什么。下面是一个相似的岭回归模型的结果，该模型的 R 值也大于 0.99。如果您想查看回溯测试的完整细节和代码，我在本文末尾附上了完整笔记本的链接。

![](img/9dbb8a747dce36fb03e03e2c201b2751.png)

正如你所看到的(令我失望)，使用 Tweet 量、Google Trends、市值和交易量来预测明天的价格实际上比简单地在回溯测试间隔开始时买入和结束时卖出表现得更差，尽管模型评估指标非常出色。请记住，这还忽略了所有的交易费用，这显然会大大降低策略的性能。

话虽如此，我刚刚读了一篇由一所大学发表的学术博士撰写的文章[，没有提及我概述的问题，但最终得出的结论是:“通过利用一个以推文和谷歌趋势数据为输入的线性模型，我们能够准确预测价格变化的方向。”[1]在论文的后面，他们提到“研究发现，逻辑回归在对这些推文进行分类方面表现最佳，它们能够正确预测 43.9%的价格上涨。”[1]嗯？我没看错吧？因此，作者在这里归类为“准确预测”的是，在不考虑费用的情况下，56.1%的时间亏损。哎哟。此外，在图 9 中，作者包括了一个类似于我上面展示的图(我在大约 20 分钟内生成的)，其中预测价格精确地随着实际价格波动，以至于它们几乎不是不同的线。当然，没有提到昨天的价格在特性集中。](https://scholar.smu.edu/cgi/viewcontent.cgi?article=1039&context=datasciencereview)

我想说明的是，将预测锁定在以前的价格，然后使用其他功能将预测向上或向下发送实际上可能是一种有用的交易策略(尽管在我看来，直接预测进场和出场比试图预测价格本身更好)。我写这篇文章的主要原因是，我认为许多人被这样的文章所欺骗，这些文章没有概述他们的训练数据的确切组成，而是试图通过在点击标题和封面照片的保护伞下只包括漂亮的情节和令人印象深刻的评估指标来打动读者。

## **结论**

关于这个话题，我的想法是，即使这些在线文章看起来很吸引人，简单的机器学习算法并不是开发交易模型的最佳方法。我觉得这里有深度学习的地方；也许在强化学习风格的交易环境中，大型 LSTM、康文网络或其他具有技术分析类型特征的创新神经网络架构会产生多产的、有利可图的结果。最后，在研究算法交易之类的东西时，要记住几件事:

1.  如果这看起来好得不像是真的，那很可能就是真的。再深入一点。寻找一个回溯测试，或者自己进行回溯测试。利润/损失是一个比 R 或 RMSE 更好的评估指标(参见我开发的简单回溯测试平台[这里](/dynamic-cryptocurrency-trading-backtesting-platform-python-219dfcd7421e))。
2.  当人们发现有利可图的算法时，他们一般不会发布到网上让全世界免费看到。每当你做交易时，总有人在交易的另一边。如果你赢了，他们就输了。如果你输了，他们赢了。那些成功者往往不会教育他们所资助的失败者。当然，除非你付钱让他们这么做。

这个项目的所有代码可以在[这里](https://github.com/leeschmalz/Predicting-Prices-Dont-Be-Fooled)找到复制。

引用:

[1]:使用推文量和情绪分析进行加密货币价格预测【https://scholar.smu.edu/cgi/viewcontent.cgi?article=1039 &context = datascience review