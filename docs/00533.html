<html>
<head>
<title>My Random Forest Model after Seven Weeks of Learning Data Science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">经过七周的数据科学学习，我的随机森林模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/this-is-what-seven-weeks-of-learning-data-science-looks-like-94c0c6666383?source=collection_archive---------38-----------------------#2020-01-15">https://towardsdatascience.com/this-is-what-seven-weeks-of-learning-data-science-looks-like-94c0c6666383?source=collection_archive---------38-----------------------#2020-01-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="06de" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一步一步的演练我的改进二手车价格预测</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8943b123ed32bd914bce3b099977e57c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FZUzv6kah45_xbqxbiFbw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@thematthoward?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马特·霍华德</a>在<a class="ae ky" href="https://unsplash.com/s/photos/journey?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><blockquote class="kz"><p id="91ee" class="la lb it bd lc ld le lf lg lh li lj dk translated">"千里之行始于足下。"</p></blockquote><p id="77e8" class="pw-post-body-paragraph lk ll it lm b ln lo ju lp lq lr jx ls lt lu lv lw lx ly lz ma mb mc md me lj im bi translated">在我记忆中的很长一段时间里，我想成为一名数据科学家，但从未付诸行动。七周前，<strong class="lm iu">我迈出了第一步</strong>，承诺在52周内每周学习和写关于数据科学的博客。在我的第一周，我建立了一个随机森林模型来预测二手车的价格(见<a class="ae ky" href="https://www.kaggle.com/terenceshin/used-car-price-prediction-attempt-1" rel="noopener ugc nofollow" target="_blank">这里</a>)。这或多或少是我的准则…</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="1d35" class="mk ml it mg b gy mm mn l mo mp">import pandas as pd<br/>from sklearn.ensemble import RandomForestRegressor<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.metrics import mean_absolute_error<br/>from sklearn import preprocessing<br/>df1 = pd.read_csv("../input/craigslist-carstrucks-data/craigslistVehicles.csv")</span><span id="6e76" class="mk ml it mg b gy mq mn l mo mp"><em class="mr">### Clean/Prep Data ### </em><br/>df1 = df1[df1['price'] &lt; 99999.00]<br/>df1 = df1[df1['price'] &gt; 999.99]<br/><br/><em class="mr"># 2. Removing any rows where year is blank or &lt;1900</em><br/>df1 = df1[df1['year'] &gt; 1900]<br/>df1 = df1.dropna(axis=0, subset=['year'])<br/><br/><em class="mr"># 3. Removing any rows where manufacturer is blank</em><br/>df1 = df1.dropna(axis=0, subset=['manufacturer'])<br/><br/><em class="mr"># 4. Removing any rows where odometer is blank or &lt; 999,999</em><br/>df1 = df1.dropna(axis=0, subset=['odometer'])<br/>df1 = df1[df1['odometer'] &lt; 899999.00]<br/><br/><em class="mr"># 5. Removing any rows with blanks</em><br/>df1 = df1.dropna(axis=0)</span><span id="5266" class="mk ml it mg b gy mq mn l mo mp"><em class="mr">### Data Modelling ###</em><br/>y = df1.price<br/>used_car_features = ['year', 'odometer', 'manufacturer', 'make', 'transmission','lat','long','fuel']<br/>X = df1[used_car_features]<br/><br/>le = preprocessing.LabelEncoder()<br/>X = X.apply(le.fit_transform)<br/><br/>train_X, val_X, train_y, val_y = train_test_split(X, y, random_state=0)<br/><br/>used_car_model = RandomForestRegressor(random_state=1)<br/>used_car_model.fit(train_X, train_y)</span></pre><p id="4ddd" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">我的代码效率很低，我错过了很多步骤，而且它不是最好的模型——但它是一个开始！从那以后，我学习并撰写了各种数据科学主题，包括:</p><ul class=""><li id="08ee" class="mx my it lm b ln ms lq mt lt mz lx na mb nb lj nc nd ne nf bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/basic-statistics-you-need-to-know-for-data-science-1fdd290f59b5">数据科学基础统计学</a></li><li id="ef18" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/an-extensive-guide-to-exploratory-data-analysis-ddd99a03199e">探索性数据科学的逐步方法</a></li><li id="9b94" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated"><a class="ae ky" href="https://medium.com/swlh/predicting-life-expectancy-w-regression-b794ca457cd4" rel="noopener">利用线性回归预测预期寿命</a></li><li id="f08f" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/all-machine-learning-models-explained-in-6-minutes-9fe30ff6776a">所有基本机器学习模型背后的理论</a></li><li id="d5c6" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/microsoft-data-science-interview-questions-and-answers-69ccac16bd9b">微软数据科学面试问答</a></li></ul><p id="4602" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">这个星期，我想重温<a class="ae ky" href="https://www.kaggle.com/austinreese/craigslist-carstrucks-data" rel="noopener ugc nofollow" target="_blank"> Kaggle的二手车数据集</a>来应用我的新知识，建立一个更好的随机森林模型！</p><p id="4d29" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">我把我的项目分成三部分:</p><ol class=""><li id="87de" class="mx my it lm b ln ms lq mt lt mz lx na mb nb lj nl nd ne nf bi translated">探索性数据分析</li><li id="8393" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nl nd ne nf bi translated">数据建模</li><li id="9531" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nl nd ne nf bi translated">特征重要性</li></ol></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="2eac" class="nt ml it bd nu nv nw nx ny nz oa ob oc jz od ka oe kc of kd og kf oh kg oi oj bi translated">探索性数据分析</h1><h2 id="5866" class="mk ml it bd nu ok ol dn ny om on dp oc lt oo op oe lx oq or og mb os ot oi ou bi translated">了解我的数据</h2><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="4a73" class="mk ml it mg b gy mm mn l mo mp"><em class="mr"># Importing Libraries and Data</em><br/>import numpy as np<br/>import pandas as pd <em class="mr"># data processing, CSV file I/O (e.g. pd.read_csv)</em><br/>import os<br/>for dirname, _, filenames <strong class="mg iu">in</strong> os.walk('/kaggle/input'):<br/>    for filename <strong class="mg iu">in</strong> filenames:<br/>        print(os.path.join(dirname, filename))<br/><br/>df = pd.read_csv("../input/craigslist-carstrucks-data/vehicles.csv")</span><span id="f14b" class="mk ml it mg b gy mq mn l mo mp"><em class="mr"># Get a quick glimpse of what I'm working with</em><br/>print(df.shape)<br/>print(df.columns)<br/>df.head()</span></pre><p id="4f68" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">在处理数据科学问题时，我总是做的第一件事是了解我正在处理的数据集。使用<strong class="lm iu"> df.shape </strong>、<strong class="lm iu"> df.columns </strong>和<strong class="lm iu"> df.head() </strong>，我能够看到我正在处理的特性以及每个特性需要什么。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/6d015f5bc2615784a5ca4759a693a8b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qdJj-pg2d_pQucdUjkWtNA.png"/></div></div></figure><h2 id="6a18" class="mk ml it bd nu ok ol dn ny om on dp oc lt oo op oe lx oq or og mb os ot oi ou bi translated">探索分类数据</h2><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="510a" class="mk ml it mg b gy mm mn l mo mp">df.nunique(axis=0)</span></pre><p id="4b8c" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">我喜欢用<strong class="lm iu"> df.nunique(axis=0) </strong>，看看每个变量有多少个唯一值。利用这个，我可以看到是否有什么不寻常的事情，并找出任何潜在的问题。例如，如果它显示有60个州，这将引发一个红旗，因为只有50个州。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/dff96064beedc200a8f2ba2b4bb18f32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4OglTKS7ThWoj73s7t4jDg.png"/></div></div></figure><h2 id="9ebb" class="mk ml it bd nu ok ol dn ny om on dp oc lt oo op oe lx oq or og mb os ot oi ou bi translated">探索数字数据</h2><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="64e9" class="mk ml it mg b gy mm mn l mo mp">df.describe().apply(lambda s: s.apply(lambda x: format(x, 'f')))</span></pre><p id="e5c8" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">对于数字数据，我使用<strong class="lm iu"> df.describe() </strong>来快速浏览我的数据。例如，我可以立即看出<em class="mr">价格、</em>的问题，因为最低价格是0美元，最高价格是3，600，028，900美元。</p><p id="4252" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">稍后，您将看到我是如何处理这些不切实际的异常值的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/f7aff748ac9a04bd2ca62a9117ccaf81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BWk5zSEnP3dT2sVDzrn_pA.png"/></div></div></figure><h2 id="1eb3" class="mk ml it bd nu ok ol dn ny om on dp oc lt oo op oe lx oq or og mb os ot oi ou bi translated">包含太多空值的列</h2><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="2e20" class="mk ml it mg b gy mm mn l mo mp">NA_val = df.isna().sum()<br/><br/>def na_filter(na, threshold = .4): <em class="mr">#only select variables that passees the threshold</em><br/>    col_pass = []<br/>    for i <strong class="mg iu">in</strong> na.keys():<br/>        if na[i]/df.shape[0]&lt;threshold:<br/>            col_pass.append(i)<br/>    return col_pass<br/><br/>df_cleaned = df[na_filter(NA_val)]<br/>df_cleaned.columns</span></pre><p id="d88c" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">在继续我的EDA的其余部分之前，我使用上面的代码删除了超过40%的值为null的所有列。这使我剩下下面的专栏。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/cdb8e35fe56f2d5043f5aa4cd65080f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BIT0Eqx5wyLHa-LvHKHwkw.png"/></div></div></figure><h2 id="91a5" class="mk ml it bd nu ok ol dn ny om on dp oc lt oo op oe lx oq or og mb os ot oi ou bi translated">移除异常值</h2><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="8d0d" class="mk ml it mg b gy mm mn l mo mp">df_cleaned = df_cleaned[df_cleaned['price'].between(999.99, 250000)] </span><span id="6ebb" class="mk ml it mg b gy mq mn l mo mp"><em class="mr"># Computing IQR</em><br/>Q1 = df_cleaned['price'].quantile(0.25)<br/>Q3 = df_cleaned['price'].quantile(0.75)<br/>IQR = Q3 - Q1<br/><br/><em class="mr"># Filtering Values between Q1-1.5IQR and Q3+1.5IQR</em><br/>df_filtered = df_cleaned.query('(@Q1 - 1.5 * @IQR) &lt;= price &lt;= (@Q3 + 1.5 * @IQR)')<br/>df_filtered.boxplot('price')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/54fac83d1c1ef13d6606b40784ab5d08.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*yjiK-LsR5_ukHWx1hKJbIQ.png"/></div></figure><p id="09d8" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">在使用四分位(IQR)方法移除价格的异常值之前，我决定将<em class="mr">价格</em>的范围设置为更现实的数字，这样标准差将被计算为比9，575，025更现实的数字。</p><p id="89c2" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">IQR也称为中间值，是一种统计离差的度量，可用于识别和移除异常值。IQR范围规则的理论如下:</p><ol class=""><li id="f2ac" class="mx my it lm b ln ms lq mt lt mz lx na mb nb lj nl nd ne nf bi translated">计算IQR (=第三个四分位数-第一个四分位数)</li><li id="d36d" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nl nd ne nf bi translated">找出范围的最小值(=第一个四分位数- 1.5 * IQR)</li><li id="9629" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nl nd ne nf bi translated">找出范围的最大值(=第三个四分位数+ 1.5 * IQR)</li><li id="63c9" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nl nd ne nf bi translated">删除任何超出此范围的值。</li></ol><p id="6318" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">你可以在上面的方框图中看到，我使用这种方法显著缩小了<em class="mr">价格</em>的范围。</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="ab9a" class="mk ml it mg b gy mm mn l mo mp">df_filtered.describe().apply(lambda s: s.apply(lambda x: format(x, 'f')))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/3481232a05ebd34f55881a0dfd5c474d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TU8lEGRgtqp_2NCoApzdQg.png"/></div></div></figure><p id="a4c0" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">使用<strong class="lm iu">。describe() </strong>同样，我们可以看到价格范围似乎比最初更现实，但年份和里程表似乎有点偏离(例如，2021年的最大值)。</p><p id="8be2" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">我使用下面的代码将年份范围设置为1900–2020，将里程表设置为0–271，341.5。</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="174e" class="mk ml it mg b gy mm mn l mo mp"><em class="mr"># cant be newer than 2020</em><br/>df_filtered = df_filtered[df_filtered['year'].between(1900, 2020)]</span><span id="a44b" class="mk ml it mg b gy mq mn l mo mp"><em class="mr"># = 140000 + 1.5 * (140000-52379)</em><br/>df_filtered = df_filtered[df_filtered['odometer'].between(0, 271431.5)]</span></pre><h2 id="6b0c" class="mk ml it bd nu ok ol dn ny om on dp oc lt oo op oe lx oq or og mb os ot oi ou bi translated">删除剩余的列</h2><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="92ea" class="mk ml it mg b gy mm mn l mo mp">df_final = df_filtered.copy().drop(['id','url','region_url','image_url','region','description','model','state','paint_color'], axis=1) <em class="mr">#removing region since lat/long mean same thing</em><br/>df_final.shape</span></pre><p id="974c" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">通过部分使用我的直觉，部分猜测和检查，我删除了以下几列:</p><ul class=""><li id="2f58" class="mx my it lm b ln ms lq mt lt mz lx na mb nb lj nc nd ne nf bi translated"><em class="mr"> url </em>，<em class="mr"> id </em>，<em class="mr"> region_url </em>，<em class="mr"> image_url: </em>它们与正在进行的分析完全无关</li><li id="0122" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated"><em class="mr">描述</em>:描述可能能够使用自然语言处理，但超出了这个项目的范围，被忽略</li><li id="a6b0" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated"><em class="mr">地区，州:</em>我去掉了这些，因为它们本质上传达的是和经纬度一样的信息。</li><li id="c419" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated"><em class="mr"> model </em>:我去掉了这个，因为有太多不同的值，无法将其转换为虚拟变量。此外，我不能使用标签编码，因为值是无序的。</li><li id="16be" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated"><em class="mr"> paint_color </em>:最后我在进行了特征重要性(稍后你会看到)后去掉了这个。由于特征重要性表明<em class="mr"> paint_color </em>在确定<em class="mr">价格</em>中的重要性很小，所以我移除了它，模型的准确性提高了。</li></ul><h2 id="3ec4" class="mk ml it bd nu ok ol dn ny om on dp oc lt oo op oe lx oq or og mb os ot oi ou bi translated">可视化变量和关系</h2><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="a1d7" class="mk ml it mg b gy mm mn l mo mp">import matplotlib.pylab as plt<br/>import seaborn as sns<br/><br/><em class="mr"># calculate correlation matrix</em><br/>corr = df_final.corr()</span><span id="b2a8" class="mk ml it mg b gy mq mn l mo mp"><em class="mr"># plot the heatmap</em><br/>sns.heatmap(corr, xticklabels=corr.columns, yticklabels=corr.columns, annot=True, cmap=sns.diverging_palette(220, 20, as_cmap=True))</span></pre><p id="9c69" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">清理完数据后，我想可视化我的数据，并更好地理解不同变量之间的关系。利用<strong class="lm iu"> sns.heatmap() </strong>，我们可以看到<em class="mr">年</em>与<em class="mr">价格</em>正相关，<em class="mr">里程表</em>与<em class="mr">价格</em>负相关——这个有道理！看来我们走对了路。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/3d9891a8f040550c0436dedc87a12c41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xa7Wd_wJoNSfA4091CJTvA.png"/></div></div></figure><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="f3ba" class="mk ml it mg b gy mm mn l mo mp">df_final['manufacturer'].value_counts().plot(kind='bar')</span><span id="3751" class="mk ml it mg b gy mq mn l mo mp">df_cleaned['type'].value_counts().plot(kind='bar')</span></pre><p id="f823" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">出于我自己的兴趣，我使用条形图绘制了一些分类属性(见下文)。为了更好地了解数据集，您还可以做更多的可视化工作，如散点图和箱线图，但我们将进入下一部分，数据建模！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/0186fee9be35ec0139a4186e936a38db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQlrZMazNKMn8Xes72NWBQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/3277fa5d593fdd68c440ac1860402ce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mycatvnj2eDUN6N9pUanzw.png"/></div></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="e907" class="nt ml it bd nu nv nw nx ny nz oa ob oc jz od ka oe kc of kd og kf oh kg oi oj bi translated">数据建模</h1><h2 id="cbb8" class="mk ml it bd nu ok ol dn ny om on dp oc lt oo op oe lx oq or og mb os ot oi ou bi translated">虚拟变量</h2><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="e7d1" class="mk ml it mg b gy mm mn l mo mp">df_final = pd.get_dummies(df_final, drop_first=True)<br/>print(df_final.columns)</span></pre><p id="692d" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">为了能够在我的随机森林模型中使用分类数据，我使用了<strong class="lm iu"> pd.get_dummies()。</strong>这实质上是将变量的每个唯一值转换成它自己的二进制变量。例如，如果制造商之一是本田，那么将创建一个名为“manufacturer_honda”的新虚拟变量，如果是本田，它将等于1，否则等于0。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/e2f81d5ef91ac6ce82edb04c1fcbc45a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QOEsHC-Z9_dLHEd44JRkPA.png"/></div></div></figure><h2 id="b820" class="mk ml it bd nu ok ol dn ny om on dp oc lt oo op oe lx oq or og mb os ot oi ou bi translated">缩放数据</h2><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="8bd5" class="mk ml it mg b gy mm mn l mo mp">from sklearn.preprocessing import StandardScaler<br/>X_head = df_final.iloc[:, df_final.columns != 'price']<br/><br/>X = df_final.loc[:, df_final.columns != 'price']<br/>y = df_final['price']<br/>X = StandardScaler().fit_transform(X)</span></pre><p id="80ec" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">接下来，我使用<strong class="lm iu">标准缩放器</strong>缩放数据。Prasoon提供了一个很好的答案<a class="ae ky" href="https://www.quora.com/Why-do-we-normalize-the-data" rel="noopener ugc nofollow" target="_blank">在这里</a>为什么我们要缩放(或标准化)我们的数据，但本质上，这样做是为了我们的自变量的缩放不会影响我们模型的组成。例如，<em class="mr">年</em>的最大数字是2020，<em class="mr">里程表</em>的最大数字超过20万。如果不把数据按比例放大，里程表<em class="mr">的一个小变化</em>会比<em class="mr">年</em>的同样变化产生更大的影响。</p><h2 id="013a" class="mk ml it bd nu ok ol dn ny om on dp oc lt oo op oe lx oq or og mb os ot oi ou bi translated">创建模型</h2><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="c839" class="mk ml it mg b gy mm mn l mo mp">from sklearn.ensemble import RandomForestRegressor<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.metrics import mean_absolute_error as mae<br/><br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=.25, random_state=0)<br/>model = RandomForestRegressor(random_state=1)<br/>model.fit(X_train, y_train)<br/>pred = model.predict(X_test)</span></pre><p id="8bc2" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">我决定使用随机森林算法有几个原因:</p><ol class=""><li id="4d50" class="mx my it lm b ln ms lq mt lt mz lx na mb nb lj nl nd ne nf bi translated">它<strong class="lm iu">很好地处理了高维度</strong>，因为它采用了数据子集。</li><li id="87e7" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nl nd ne nf bi translated">它非常通用，只需要很少的预处理</li><li id="e3fe" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nl nd ne nf bi translated">在<strong class="lm iu">避免过度拟合</strong>是很棒的，因为每个决策树都有低偏差</li><li id="a523" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nl nd ne nf bi translated">它允许您检查<strong class="lm iu">特性的重要性</strong>，您将在下一节看到！</li></ol><h2 id="ef11" class="mk ml it bd nu ok ol dn ny om on dp oc lt oo op oe lx oq or og mb os ot oi ou bi translated">检查模型的准确性</h2><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="fe10" class="mk ml it mg b gy mm mn l mo mp">print(mae(y_test, pred))<br/>print(df_final['price'].mean())</span><span id="de5f" class="mk ml it mg b gy mq mn l mo mp">model.score(X_test,y_test)</span></pre><p id="bb45" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">总的来说，我的模型在平均价格为12600美元左右的情况下实现了1590美元的MAE，准确率为90.5%！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/893be87fd94c14520322f95b5518c937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lXdxNAeijGKNolqAQJuXbQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MAE和平均价格</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/672170b2effcac6415bf298565b075a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BJVmUipL2L8ErJINcJVs9A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型的准确性</p></figure><h1 id="edec" class="nt ml it bd nu nv ph nx ny nz pi ob oc jz pj ka oe kc pk kd og kf pl kg oi oj bi translated">特征重要性</h1><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="32bd" class="mk ml it mg b gy mm mn l mo mp">feat_importances = pd.Series(model.feature_importances_, index=X_head.columns)<br/>feat_importances.nlargest(25).plot(kind='barh',figsize=(10,10))</span></pre><p id="2c49" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">我花了很多时间寻找特性重要性的最佳定义，Christoph Molnar提供了最佳定义(见<a class="ae ky" href="https://christophm.github.io/interpretable-ml-book/feature-importance.html" rel="noopener ugc nofollow" target="_blank">此处</a>)。他说:</p><blockquote class="pm pn po"><p id="5bc0" class="lk ll mr lm b ln ms ju lp lq mt jx ls pp mu lv lw pq mv lz ma pr mw md me lj im bi translated">我们通过计算置换特征后模型预测误差的增加来衡量特征的重要性。如果打乱某个特征的值会增加模型误差，则该特征是“重要的”，因为在这种情况下，模型依赖于该特征进行预测。“如果改变某个特征的值而不改变模型误差，则该特征是“不重要的”，因为在这种情况下，模型在预测中忽略了该特征。”</p></blockquote><p id="c6b3" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">鉴于此，我们可以看到决定<em class="mr">价格</em>的三个最重要的特征是<em class="mr">年份、驱动(如果是前轮驱动的话)、</em>和<em class="mr">里程表。特性重要性是向非技术人员合理化和解释你的模型的好方法。如果您需要降低维度，它对于特征选择也非常有用。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/0831f69995363fd6978bebb00d0b9441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*knx90YdNgv8m1tsr_gp-Zw.png"/></div></div></figure><p id="a42c" class="pw-post-body-paragraph lk ll it lm b ln ms ju lp lq mt jx ls lt mu lv lw lx mv lz ma mb mw md me lj im bi translated">我的项目到此为止！我希望这能激励那些想进入数据科学的人真正开始。我还有很长的路要走，但我觉得到目前为止我已经取得了很大的进步。更多即将推出。</p><h1 id="d3ff" class="nt ml it bd nu nv ph nx ny nz pi ob oc jz pj ka oe kc pk kd og kf pl kg oi oj bi translated">感谢阅读！</h1><p id="e3b1" class="pw-post-body-paragraph lk ll it lm b ln pt ju lp lq pu jx ls lt pv lv lw lx pw lz ma mb px md me lj im bi translated">如果你喜欢我的工作，想支持我…</p><ul class=""><li id="3216" class="mx my it lm b ln ms lq mt lt mz lx na mb nb lj nc nd ne nf bi translated">成为第一批订阅<a class="ae ky" href="https://www.youtube.com/channel/UCmy1ox7bo7zsLlDo8pOEEhA?view_as=subscriber" rel="noopener ugc nofollow" target="_blank">我的新<strong class="lm iu"> YouTube频道</strong>这里</a>！虽然还没有任何视频，但我会以视频的形式分享很多像这样的精彩内容。</li><li id="15a5" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated">也是第一批关注我的<a class="ae ky" href="https://twitter.com/terence_shin" rel="noopener ugc nofollow" target="_blank"> <strong class="lm iu"> Twitter </strong> </a>的人之一。</li><li id="be3d" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated">点击在<strong class="lm iu"> LinkedIn </strong> <a class="ae ky" href="https://www.linkedin.com/in/terenceshin/" rel="noopener ugc nofollow" target="_blank">上关注我。</a></li><li id="a526" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated">在我的<strong class="lm iu">邮箱列表</strong> <a class="ae ky" href="https://forms.gle/UGdTom9G6aFGHzPD9" rel="noopener ugc nofollow" target="_blank">这里</a>报名。</li><li id="6c52" class="mx my it lm b ln ng lq nh lt ni lx nj mb nk lj nc nd ne nf bi translated">看看我的网站，<a class="ae ky" href="https://terenceshin.com/" rel="noopener ugc nofollow" target="_blank"><strong class="lm iu">terenceshin.com</strong></a>。</li></ul></div></div>    
</body>
</html>