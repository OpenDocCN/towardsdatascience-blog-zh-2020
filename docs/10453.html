<html>
<head>
<title>TIQ Part 3 — Ultimate Guide to Date dimension creation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TIQ 第 3 部分—日期维度创建的最终指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tiq-part-3-ultimate-guide-to-date-dimension-creation-98b951ffa68c?source=collection_archive---------30-----------------------#2020-07-22">https://towardsdatascience.com/tiq-part-3-ultimate-guide-to-date-dimension-creation-98b951ffa68c?source=collection_archive---------30-----------------------#2020-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4226" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 TIQ 系列的第三部分中，学习在 Power BI 中创建适当的日期维度的所有可用方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cc724757112f89e29b8c1b942ed71ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jAS9NnIF7M6PdNCCmiEBcQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Pixabay 在 Pexels 上拍摄的照片</p></figure><p id="c151" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="lu"> TIQ 代表时间智商。由于“常规”智能通常被作为智商来衡量，而时间智能是数据建模中最重要的主题之一，我决定开始一个博客系列，将介绍一些基本概念、特定解决方案的利弊和要避免的潜在陷阱，一切都是为了增加你的整体 TIQ，并使你的模型在时间分析方面更加健壮、可伸缩和灵活</em> </strong></p><p id="0b17" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本系列的第一部分解释了为什么在 Power BI 中使用<a class="ae lv" rel="noopener" target="_blank" href="/tiq-part-1-how-to-destroy-your-power-bi-model-with-auto-date-time-8fec32b22aff">自动日期/时间特性是合法的，但不是处理数据模型中日期的理想解决方案，并在第二部分强调了</a><a class="ae lv" rel="noopener" target="_blank" href="/tiq-part-2-your-majesty-date-dimension-b4d54db84be9">星型模式中日期维度</a>的重要性之后，在本部分中，您将找到在数据模型中创建适当日期维度的各种解决方案。</p><h2 id="d742" class="lw lx it bd ly lz ma dn mb mc md dp me lh mf mg mh ll mi mj mk lp ml mm mn mo bi translated">解决方案 1: SQL</h2><p id="65a2" class="pw-post-body-paragraph ky kz it la b lb mp ju ld le mq jx lg lh mr lj lk ll ms ln lo lp mt lr ls lt im bi translated">在大多数情况下，如果您连接到关系数据源，如 SQL Server、Oracle 或 MySQL，那么驻留在数据仓库中的数据模型很可能已经包含了日期维度。</p><p id="d491" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这个场景中，您只需将现有的日期维度导入到 Power BI 数据模型中，就万事俱备了。这种方法带来的好处是，在组织级别上确保关于时间处理的单一真实来源。</p><p id="1b21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设我正在连接到一个 Contoso SQL Server 数据库，该数据库保存着一家名为 Contoso 的虚构公司的销售数据。一旦我选择了在 Power BI 中获取数据并连接到 Contoso 数据库，我唯一需要做的事情就是选择 DimDate 表(以及我需要的其他表),并且我在 Power BI 数据模型中有了一个适当的日期维度！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/daaa0d67bb3e182b6e39a378e704756f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wygb9Px1uMh7AA68MGfQ_w.png"/></div></div></figure><p id="771f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是 Power BI 数据模型中处理时间最简单、最常用的方式。</p><p id="a675" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果出于任何原因，您的数据仓库没有日期维度(老实说，您被卡车撞上的机会比找到没有日期维度的数据仓库的机会更多)，您可以自己创建一个。网络上有多种现成的解决方案，例如 Aaron Bertrand 的<a class="ae lv" href="https://www.mssqltips.com/sqlservertip/4054/creating-a-date-dimension-or-calendar-table-in-sql-server/" rel="noopener ugc nofollow" target="_blank">这个</a>，因此，如果您出于任何原因需要它，使用 SQL 的日历表可以在几分钟内创建。</p><h2 id="d1ea" class="lw lx it bd ly lz ma dn mb mc md dp me lh mf mg mh ll mi mj mk lp ml mm mn mo bi translated">解决方案#2: M(超级查询)</h2><p id="4694" class="pw-post-body-paragraph ky kz it la b lb mp ju ld le mq jx lg lh mr lj lk ll ms ln lo lp mt lr ls lt im bi translated">如果您没有现有的日期维度可以导入到您的数据模型中，您可以使用 Power Query 及其 M 语言快速轻松地创建一个全新的日期维度。</p><p id="d9de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我在之前的一篇文章中已经提到的，关于<a class="ae lv" href="https://data-mozart.com/powerbi/power-query-tips-for-every-power-bi-developer/" rel="noopener ugc nofollow" target="_blank">各种权力查询技巧</a>，网上有许多现成的解决方案。我从礼萨·拉德那里选了<a class="ae lv" href="https://radacad.com/create-a-date-dimension-in-power-bi-in-4-steps-step-1-calendar-columns" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><p id="3f78" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是如何使用 M 语言创建日期维度的分步说明。打开新的 Power BI 文件，并在获取数据下选择空白查询:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/a4f952790476ca6ea84872b0b060fe38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xuOrSpOQHQRvucMU8rXmbA.png"/></div></div></figure><p id="ec1a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果要创建高度灵活和自定义的日期维度，应该利用参数。因此，在“管理参数”下，选择“新参数”并将其设置如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/36022e0ba75fc4b65b88cdaa858d16e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9I8VhizoU7ck-VwTKPmXSw.png"/></div></div></figure><p id="db5e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">定义日期维的开始年份后，对结束年份应用相同的步骤:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/52ca7ed7845e78608987d8e64e164a7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k284AO7RYwl_fWykeIEL9g.png"/></div></div></figure><p id="7bec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成后，打开高级编辑器并粘贴以下脚本:</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="4179" class="lw lx it mx b gy nb nc l nd ne">let<br/>    StartDate = #date(StartYear,1,1),<br/>    EndDate = #date(EndYear,12,31),<br/>    NumberOfDays = Duration.Days( EndDate - StartDate ),<br/>    Dates = List.Dates(StartDate, NumberOfDays+1, #duration(1,0,0,0)),<br/>    #"Converted to Table" = Table.FromList(Dates, Splitter.SplitByNothing(), null, null, ExtraValues.Error),<br/>    #"Renamed Columns" = Table.RenameColumns(#"Converted to Table",{{"Column1", "FullDateAlternateKey"}}),<br/>    #"Changed Type" = Table.TransformColumnTypes(#"Renamed Columns",{{"FullDateAlternateKey", type date}}),<br/>    #"Inserted Year" = Table.AddColumn(#"Changed Type", "Year", each Date.Year([FullDateAlternateKey]), type number),<br/>    #"Inserted Month" = Table.AddColumn(#"Inserted Year", "Month", each Date.Month([FullDateAlternateKey]), type number),<br/>    #"Inserted Month Name" = Table.AddColumn(#"Inserted Month", "Month Name", each Date.MonthName([FullDateAlternateKey]), type text),<br/>    #"Inserted Quarter" = Table.AddColumn(#"Inserted Month Name", "Quarter", each Date.QuarterOfYear([FullDateAlternateKey]), type number),<br/>    #"Inserted Week of Year" = Table.AddColumn(#"Inserted Quarter", "Week of Year", each Date.WeekOfYear([FullDateAlternateKey]), type number),<br/>    #"Inserted Week of Month" = Table.AddColumn(#"Inserted Week of Year", "Week of Month", each Date.WeekOfMonth([FullDateAlternateKey]), type number),<br/>    #"Inserted Day" = Table.AddColumn(#"Inserted Week of Month", "Day", each Date.Day([FullDateAlternateKey]), type number),<br/>    #"Inserted Day of Week" = Table.AddColumn(#"Inserted Day", "Day of Week", each Date.DayOfWeek([FullDateAlternateKey]), type number),<br/>    #"Inserted Day of Year" = Table.AddColumn(#"Inserted Day of Week", "Day of Year", each Date.DayOfYear([FullDateAlternateKey]), type number),<br/>    #"Inserted Day Name" = Table.AddColumn(#"Inserted Day of Year", "Day Name", each Date.DayOfWeekName([FullDateAlternateKey]), type text)<br/>in<br/>    #"Inserted Day Name"</span></pre><p id="71d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成后，点击 Close&amp;Apply，您的数据模型中就有了功能齐全的日期维度！此外，如果您将文件另存为。pbit (Power BI 模板文件)，您可以轻松地更改要生成日期的时间段。</p><p id="05de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如您可能已经注意到的，您只是定义了您想要的日期维度的开始和结束年份，而 M 负责处理所有其他事情——这多酷啊！</p><h2 id="a487" class="lw lx it bd ly lz ma dn mb mc md dp me lh mf mg mh ll mi mj mk lp ml mm mn mo bi translated">解决方案 3: DAX</h2><p id="8f3d" class="pw-post-body-paragraph ky kz it la b lb mp ju ld le mq jx lg lh mr lj lk ll ms ln lo lp mt lr ls lt im bi translated">最后，如果您喜欢使用 DAX 进行 Power BI 计算，也可以使用它来创建适当的日期维度。DAX 内置了函数<em class="lu"> CALENDAR() </em>和<em class="lu"> CALENDARAUTO() </em>，这些函数会为其他必要的属性做铺垫，比如周、工作日等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/87cad5ce2c20cbacf05ed8a1cbfcf588.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/format:webp/1*ISjuPhp3jW6SOGbw4WENjw.png"/></div></figure><p id="15f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我指导您在哪里找到创建日期维度的最佳 DAX 脚本之前，我只想建议在大多数情况下避免使用<em class="lu"> CALENDARAUTO() </em>函数，因为它从整个数据模型中获取最早的日期值，并扩展到整个数据模型中的最新日期！</p><p id="4376" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这在某些有限的情况下可以很好地工作，但是在许多现实生活的场景中，比如当您导入关于客户的数据时，有些记录我们不知道客户的正确出生日期。然后，有人插入默认值 1900 年 1 月 1 日，如果您选择使用<em class="lu"> CALENDARAUTO() </em>函数，Power BI 模型中的日期维度会突然从 1900 开始！</p><p id="4072" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里的关键是——您需要利用特定场景的处理，不要让 Power BI 搞乱您的数据模型。请记住，你是你的数据模型的老板！</p><p id="8421" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我在上面承诺的，如果你决定使用 DAX 创建日期维度，不要再犹豫，使用 DAX 大师 Marco Russo 和 Alberto Ferrari 的解决方案。</p><h2 id="9fc8" class="lw lx it bd ly lz ma dn mb mc md dp me lh mf mg mh ll mi mj mk lp ml mm mn mo bi translated">关键要素—将日期维度标记为日期表</h2><p id="59d3" class="pw-post-body-paragraph ky kz it la b lb mp ju ld le mq jx lg lh mr lj lk ll ms ln lo lp mt lr ls lt im bi translated">无论您选择哪种创建日期维度的解决方案(SQL、M 或 DAX ),都不要忘记最重要的一点——将这个表标记为一个日期表！这将使您能够充分利用日期维度，执行所有强大的 DAX 时间智能功能，而不必担心结果和性能。</p><p id="06af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了被标记为日期表，一个表，或者更好地说，一个将被标记的列，必须满足几个条件:</p><ul class=""><li id="3854" class="ng nh it la b lb lc le lf lh ni ll nj lp nk lt nl nm nn no bi translated">每一行都包含唯一的值</li><li id="6e72" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated">不允许空值</li><li id="a478" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated">包含连续的日期(不允许有间隔)</li><li id="f849" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated">必须是日期数据类型</li></ul><p id="ae45" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们看看如何通过几次点击将该表标记为日期表。右键单击日期维，将鼠标悬停在标记为日期表选项上，然后单击标记为日期表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/75562e26a3759d1f83609d2bf661d67e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NIWSLuh37wqn7LZ9kJ4FGA.png"/></div></div></figure><p id="2b03" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">应会打开一个对话框，Power BI 将让您选择要在哪个列上应用标记:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/dae789cba9afbf9e79c9d91bea5eb17e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_SGVmVBgfxnYGD0Lzwexvw.png"/></div></div></figure><p id="0985" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Power BI 将自动识别正确数据类型的列，一旦您选择了该列，Power BI 将执行验证并通知您所选列是否验证成功。</p><p id="d4eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果一切正常，您应该会在日期列名称旁边看到一个小图标:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/6d54136eca909122d2765e907f95bd17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61XBazd9L3iZorEfNWYqpA.png"/></div></div></figure><p id="e158" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">恭喜你！您已经完成了在数据模型中创建正确的、功能齐全的日期维度的所有必要步骤。</p><p id="f9a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们已经为使用不同时间段操作数据奠定了基础，在本系列的下一部分中，我将介绍 DAX 中最重要的时间智能函数，以及如何使用它们来利用不同的现实场景。</p></div></div>    
</body>
</html>