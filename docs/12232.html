<html>
<head>
<title>Less known Pandas groupby applications in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">鲜为人知的熊猫在 Python 中的应用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/less-known-pandas-groupby-applications-in-python-72fb304a1973?source=collection_archive---------34-----------------------#2020-08-23">https://towardsdatascience.com/less-known-pandas-groupby-applications-in-python-72fb304a1973?source=collection_archive---------34-----------------------#2020-08-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="04f8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">但是它们对你还是有用的</h2></div><p id="173a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">几个月前，我发表了一篇关于如何在熊猫中掌握 groupby 功能的文章。然后前几天我的一个朋友问了一个问题也可以用 groupby 函数解决。所以今天我列出一些 groupby 函数可以实现的不太为人知的应用。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/b9a9025a65c02423b2cf267216486881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o2IAZhSqKywFLmhH"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@altumcode?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">替代代码</a>在<a class="ae lu" href="https://unsplash.com/s/photos/python-programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="083e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(如果你没有看过我之前关于 groupby 函数的文章，那就继续吧。它会帮助你更快地理解这篇文章。)</p><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/learn-how-to-master-groupby-function-in-python-now-4620dd463224"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">现在学习如何掌握 Python 中的 groupby 函数</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">Pandas 中的 GroupBy 比 SQL 中的 groupby 更加复杂和强大。</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm lo ly"/></div></div></a></div></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="6765" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated"><strong class="ak"> 1。各组的百分比</strong></h1><p id="90f1" class="pw-post-body-paragraph ki kj it kk b kl nm ju kn ko nn jx kq kr no kt ku kv np kx ky kz nq lb lc ld im bi translated">在 Excel 数据透视表中，您可以选择显示父合计的百分比。这表示数据透视表显示了每一项占其总父小计的百分比。在 lambda 的帮助下，这可以很容易地在 Pandas groupby 函数中完成。</p><pre class="lf lg lh li gt nr ns nt nu aw nv bi"><span id="e09f" class="nw mv it ns b gy nx ny l nz oa">&gt;&gt;&gt; import pandas as pd<br/>&gt;&gt;&gt; df = pd.DataFrame({'A':['a','b','c']*2,<br/>...                    'B':['d','e']*3,<br/>...                    'C':[1,3,6,10,12,16]<br/>...                    })<br/>&gt;&gt;&gt; df<br/>   A  B   C<br/>0  a  d   1<br/>1  b  e   3<br/>2  c  d   6<br/>3  a  e  10<br/>4  b  d  12<br/>5  c  e  16</span><span id="4ca4" class="nw mv it ns b gy ob ny l nz oa"># First Groupby <br/>&gt;&gt;&gt; df['Perc_gpby_A'] = df.groupby('A')['C'].apply(lambda x: x/x.sum())</span><span id="2d71" class="nw mv it ns b gy ob ny l nz oa"># Second Groupby<br/>&gt;&gt;&gt; df['Perc_gpby_B'] = df.groupby('B')['C'].apply(lambda x: x/x.sum())<br/>&gt;&gt;&gt; df<br/>   A  B   C  Perc_gpby_A  Perc_gpby_B<br/>0  a  d   1     0.090909     0.052632<br/>1  b  e   3     0.200000     0.103448<br/>2  c  d   6     0.272727     0.315789<br/>3  a  e  10     0.909091     0.344828<br/>4  b  d  12     0.800000     0.631579<br/>5  c  e  16     0.727273     0.551724</span></pre><p id="985e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上例的主要要点是在 groupby 函数中选择适当的分组级别。在第一个 groupby 语句中，分组级别是列 a。总共有三个组 a、b 和 C。然后，将对列 C 应用 lambda 函数。λ函数是<code class="fe oc od oe ns b">x/x.sum()</code>。因此，C 列中的每个值将除以其各自组的总和。例如，a 组的总和是 11。因此，在行 0 和 3 中，c 的值将除以 11。因此结果是 0.0909 和 0.9091。这同样适用于 A 列中的其余两个组和第二个 groupby 语句。</p><p id="4cd8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了使用 lambda 函数，使用<code class="fe oc od oe ns b">transform</code>也可以执行类似的计算。</p><pre class="lf lg lh li gt nr ns nt nu aw nv bi"><span id="ada4" class="nw mv it ns b gy nx ny l nz oa">&gt;&gt;&gt; df['Perc_gpby_A'] = df['C']/df.groupby('A')['C'].transform('sum')<br/>&gt;&gt;&gt; df['Perc_gpby_B'] = df['C']/df.groupby('B')['C'].transform('sum')<br/>&gt;&gt;&gt; df<br/>   A  B   C  Perc_gpby_A  Perc_gpby_B<br/>0  a  d   1     0.090909     0.052632<br/>1  b  e   3     0.200000     0.103448<br/>2  c  d   6     0.272727     0.315789<br/>3  a  e  10     0.909091     0.344828<br/>4  b  d  12     0.800000     0.631579<br/>5  c  e  16     0.727273     0.551724</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="4132" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">2.转换为列表/字典</h1><p id="c3ad" class="pw-post-body-paragraph ki kj it kk b kl nm ju kn ko nn jx kq kr no kt ku kv np kx ky kz nq lb lc ld im bi translated">这是我朋友前几天问的。如果您想将同一组中的所有值作为一个列表或字典进行分组，本节将为您提供答案。</p><pre class="lf lg lh li gt nr ns nt nu aw nv bi"><span id="a4e5" class="nw mv it ns b gy nx ny l nz oa">&gt;&gt;&gt; df = pd.DataFrame({'A':['a','b','c']*2,<br/>...                    'B':['d','e']*3,<br/>...                    'C':[1,3,6,10,12,16]<br/>...                    })<br/>&gt;&gt;&gt; df.groupby('A')['C'].apply(list)<br/>A<br/>a    [1, 10]<br/>b    [3, 12]<br/>c    [6, 16]<br/>Name: C, dtype: object<br/>&gt;&gt;&gt; type(df.groupby('A')['C'].apply(list))<br/>&lt;class 'pandas.core.series.Series'&gt;</span></pre><p id="c6b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的例子中，在<code class="fe oc od oe ns b">groupby('A')</code>之后，<code class="fe oc od oe ns b">apply(list)</code>将同一组中的所有值组合成一个列表形式。最终结果是序列形式。在这个层次上，你可以进一步转化为一个列表或字典。</p><pre class="lf lg lh li gt nr ns nt nu aw nv bi"><span id="cd08" class="nw mv it ns b gy nx ny l nz oa">&gt;&gt;&gt; df.groupby('A')['C'].apply(list).to_list()<br/>[[1, 10], [3, 12], [6, 16]]<br/>&gt;&gt;&gt; df.groupby('A')['C'].apply(list).to_dict()<br/>{'a': [1, 10], 'b': [3, 12], 'c': [6, 16]}</span></pre><p id="6dc3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，您也可以在<code class="fe oc od oe ns b">apply</code>功能中选择<code class="fe oc od oe ns b">set</code>。</p><pre class="lf lg lh li gt nr ns nt nu aw nv bi"><span id="f06b" class="nw mv it ns b gy nx ny l nz oa">&gt;&gt;&gt; df.groupby('B')['C'].apply(set).to_dict()<br/>{'d': {1, 12, 6}, 'e': {16, 10, 3}}</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="1117" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">3.按组列出的最常见值</h1><pre class="lf lg lh li gt nr ns nt nu aw nv bi"><span id="59a6" class="nw mv it ns b gy nx ny l nz oa">&gt;&gt;&gt; df = pd.DataFrame({'A':list('ab'*4),<br/>...                    'B':list('c'*2+'d'+'e'*5)})<br/>&gt;&gt;&gt; df<br/>   A  B<br/>0  a  c<br/>1  b  c<br/>2  a  d<br/>3  b  e<br/>4  a  e<br/>5  b  e<br/>6  a  e<br/>7  b  e<br/>&gt;&gt;&gt; df.groupby('A')['B'].agg(pd.Series.mode)<br/>A<br/>a    e<br/>b    e<br/>Name: B, dtype: object</span></pre><p id="96b6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我想我不需要在这里做太多的解释。用<code class="fe oc od oe ns b">agg(pd.Series.mode)</code>可以得到每组最频繁的值。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="d02d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这三个应用程序的代码相当简单，但是它们仍然可以帮助您更好地处理分组数据。我希望下次您可以使用 groupby 函数，而不仅仅是简单的聚合。本文到此为止。感谢您的阅读，下次再见。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="f52c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的其他 Python 文章</p><p id="0f8e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你问这个问题，你是在告诉别人你是一个 Python 初学者。</p><p id="a8a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae lu" rel="noopener" target="_blank" href="/bookmark-this-if-you-are-new-to-python-especially-if-you-self-learn-python-54c6e7b5dad8">如果你是 Python 新手(尤其是自学 Python 的话)，请将此加入书签</a></p><p id="2b58" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae lu" rel="noopener" target="_blank" href="/web-scrape-twitter-by-python-selenium-part-1-b3e2db29051d">由 Python Selenium 开发的 Web Scrape Twitter(第一部分)</a></p><p id="43a9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae lu" rel="noopener" target="_blank" href="/web-scrape-twitter-by-python-selenium-part-2-c22ae3e78e03">Web Scrape Twitter by Python Selenium(第二部分)</a></p></div></div>    
</body>
</html>