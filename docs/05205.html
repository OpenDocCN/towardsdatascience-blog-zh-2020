<html>
<head>
<title>How to Deploy a Telegram Bot using Heroku for FREE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何免费使用Heroku部署电报机器人</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-deploy-a-telegram-bot-using-heroku-for-free-9436f89575d2?source=collection_archive---------1-----------------------#2020-05-04">https://towardsdatascience.com/how-to-deploy-a-telegram-bot-using-heroku-for-free-9436f89575d2?source=collection_archive---------1-----------------------#2020-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="38a6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用python-telegram-bot库的完整指南</h2></div><p id="93f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated">在本地运行你的电报机器人足以满足简单的应用。但是，如果您想要扩展您的bot并使其他人能够使用您的bot，即使您没有在本地运行bot，您将需要更进一步来部署bot。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/7e725ca7aa755f4b7ffb8d8547ca976d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5q3C8bP9QzM7SKAW"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">由<a class="ae md" href="https://unsplash.com/@ianjbattaglia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">伊恩·巴塔格利亚</a>在<a class="ae md" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="bac4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本教程中，我将介绍如何使用Heroku的<a class="ae md" href="https://github.com/python-telegram-bot/python-telegram-bot" rel="noopener ugc nofollow" target="_blank"> python-telegram-bot库</a>部署您创建的电报机器人。更棒的是，我们可以完全免费地做到这一点！忘掉你从其他主机选项中产生的所有费用，Heroku将很可能满足你的需求，你不用支付一分钱，也不用输入你的信用卡信息。</p><p id="9b6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我将使用一个取自python-telegram-bot Github存储库中示例的简单启动脚本，在该存储库中，bot只是简单地回应用户发送的任何内容。您可能有不同的脚本，但是我将向您展示要修改哪些部分，以便使用Heroku部署bot。</p><p id="3215" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想直接找到需要的文件，就去这个<a class="ae md" href="https://github.com/liuhh02/python-telegram-bot-heroku" rel="noopener ugc nofollow" target="_blank"> Github库</a>下载吧！</p><p id="8e69" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我们的起点:</p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="me mf l"/></div></figure><h1 id="c0bb" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">修改python-telegram-bot脚本</h1><h2 id="1ce4" class="my mh it bd mi mz na dn mm nb nc dp mq kr nd ne ms kv nf ng mu kz nh ni mw nj bi translated">从轮询更改为Webhooks</h2><p id="262b" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">首先，我们将修改机器人获取新数据的方式。python-telegram-bot脚本使用轮询而不是webhooks来获取新数据。对于简单的测试来说，轮询就足够了，因为它很容易实现。然而，轮询的缺点是效率低，而且它获取的数据总是旧的，从来不是实时的。这是因为轮询以预定的频率发送请求以检测数据中的任何变化，这意味着它不断检查数据是否被修改，而不是在数据发生变化时得到“通知”。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi np"><img src="../Images/ea961d54943eaadd4992a97b14459a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Gx7091HeetpUpIzA.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">图片摘自<a class="ae md" href="https://community.stuart.engineering/t/webhooks-vs-polling/257" rel="noopener ugc nofollow" target="_blank">https://community . Stuart . engineering/t/web hooks-vs-polling/257</a></p></figure><p id="3112" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一方面，webhooks的作用类似于推送通知。当数据被修改时，webhooks被触发，而不是获取信息。这允许实时信息，也使它更有效，因为不需要不断地发送请求来检查数据。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nq"><img src="../Images/a897d4225abbe782e4990c6f048efc22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2vcExmnxKcJxiuQ3.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">图片取自<a class="ae md" href="https://community.stuart.engineering/t/webhooks-vs-polling/257" rel="noopener ugc nofollow" target="_blank">https://community . Stuart . engineering/t/web hooks-vs-polling/257</a></p></figure><p id="c36d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们首先导入os，然后设置端口号来监听webhook。</p><pre class="lo lp lq lr gt nr ns nt nu aw nv bi"><span id="8570" class="my mh it ns b gy nw nx l ny nz">import os<br/>PORT = int(os.environ.get('PORT', 5000))</span></pre><p id="64fc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们修改下面的代码行</p><pre class="lo lp lq lr gt nr ns nt nu aw nv bi"><span id="1b21" class="my mh it ns b gy nw nx l ny nz">updater.start_polling()</span></pre><p id="c7d1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">到</p><pre class="lo lp lq lr gt nr ns nt nu aw nv bi"><span id="aa5b" class="my mh it ns b gy nw nx l ny nz">updater.start_webhook(listen="0.0.0.0",<br/>                          port=int(PORT),<br/>                          url_path=TOKEN)<br/>updater.bot.setWebhook('<a class="ae md" href="https://yourherokuappname.herokuapp.com/'" rel="noopener ugc nofollow" target="_blank">https://yourherokuappname.herokuapp.com/'</a> + TOKEN)</span></pre><p id="1784" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样做的目的是将轮询方法更改为webhook，使用上面用port变量指定的端口监听0.0.0.0。令牌指的是你的电报机器人的API令牌，应该在代码的顶部定义。下一行是设置带有heroku应用程序链接的Webhook，我们将在下一步讨论。</p><p id="9ab2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在对python文件进行了所有更改之后，它应该类似于下面这样(使用您自己的Telegram bot令牌):</p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="me mf l"/></div></figure><h2 id="a64d" class="my mh it bd mi mz na dn mm nb nc dp mq kr nd ne ms kv nf ng mu kz nh ni mw nj bi translated">创建Heroku Webapp —设置目录</h2><p id="3a32" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">我们已经完成了python-telegram-bot脚本的编辑，除了更改heroku应用程序的名称之外，我们将很快进行更改。为了让heroku将以下内容识别为python应用程序，您需要将以下文件放在同一个目录中:</p><pre class="lo lp lq lr gt nr ns nt nu aw nv bi"><span id="3e45" class="my mh it ns b gy nw nx l ny nz">bot.py<br/>Procfile<br/>requirements.txt</span></pre><p id="1fa4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">python代码应该在bot.py文件中，我将完成创建Procfile和requirements.txt的过程。</p><p id="fb7f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，将终端/命令提示符的目录更改为包含python脚本的目录。然后，创建包含以下行的requirements.txt文件:</p><pre class="lo lp lq lr gt nr ns nt nu aw nv bi"><span id="cd10" class="my mh it ns b gy nw nx l ny nz">python-telegram-bot==12.7</span></pre><p id="0966" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这需要告诉heroku需要安装哪些库来执行代码。假设你用的是上面的样例代码，你唯一需要的库是python-telegram-bot，我们用的版本是12.7。如果要导入其他库来运行python代码，请确保在requirements.txt文件中也包含其他库。</p><p id="53da" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，您需要一个Procfile。procfile以<process type=""> : <command>的格式声明进程类型，后跟命令。这里，我们使用web进程类型，它从Heroku的路由器接收外部HTTP流量。命令是python3 bot.py，它告诉Heroku执行python文件，就像您通常在本地处理python文件一样。因此，您的Procfile应该包含这样一行:</command></process></p><pre class="lo lp lq lr gt nr ns nt nu aw nv bi"><span id="c7a8" class="my mh it ns b gy nw nx l ny nz">web: python3 bot.py</span></pre><p id="b95f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">确保Procfile没有任何文件扩展名，如。txt在后面，因为行不通。</p><h2 id="aa13" class="my mh it bd mi mz na dn mm nb nc dp mq kr nd ne ms kv nf ng mu kz nh ni mw nj bi translated">创建您的Heroku Webapp</h2><p id="b7c4" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">将这三个文件放在同一个目录中，我们现在将创建Heroku Webapp。</p><ol class=""><li id="c74e" class="oa ob it kk b kl km ko kp kr oc kv od kz oe ld of og oh oi bi translated">登录/ <a class="ae md" href="https://signup.heroku.com/dc" rel="noopener ugc nofollow" target="_blank">创建</a>一个Heroku账号。</li><li id="240e" class="oa ob it kk b kl oj ko ok kr ol kv om kz on ld of og oh oi bi translated">安装<a class="ae md" href="https://devcenter.heroku.com/articles/getting-started-with-python#set-up" rel="noopener ugc nofollow" target="_blank"> Heroku CLI </a>。如果您没有安装Git，请先<a class="ae md" href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" rel="noopener ugc nofollow" target="_blank">安装Git </a>，然后再继续使用Heroku CLI。</li><li id="3a52" class="oa ob it kk b kl oj ko ok kr ol kv om kz on ld of og oh oi bi translated">安装后，您可以在终端/命令提示符下使用<em class="oo"> heroku </em>命令。转到python文件所在的目录，然后输入:</li></ol><pre class="lo lp lq lr gt nr ns nt nu aw nv bi"><span id="3404" class="my mh it ns b gy nw nx l ny nz">heroku login</span></pre><p id="6596" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个新的窗口将在你的浏览器中打开，提示你登录，所以只需点击按钮。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi op"><img src="../Images/b4490b2d626682ba63520cc46e1196ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XlClS5Mu9y5qEDPIB8z8Ng.png"/></div></div></figure><p id="fbd1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.登录后，返回命令行。输入</p><pre class="lo lp lq lr gt nr ns nt nu aw nv bi"><span id="6d7f" class="my mh it ns b gy nw nx l ny nz">heroku create</span></pre><p id="b467" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建您的新webapp。在这里，heroku将为您的webapp分配一个名称以及指向您的webapp的链接，其格式应该是【https://yourherokuappname.herokuapp.com/.T2】将URL粘贴到bot.py代码中</p><pre class="lo lp lq lr gt nr ns nt nu aw nv bi"><span id="4834" class="my mh it ns b gy nw nx l ny nz">updater.bot.setWebhook('<a class="ae md" href="https://yourherokuappname.herokuapp.com/'" rel="noopener ugc nofollow" target="_blank">https://yourherokuappname.herokuapp.com/'</a> + TOKEN)</span></pre><p id="cf43" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对您的bot.py文件进行所有更改后，它看起来应该类似于以下内容(当然，使用您自己的Telegram bot令牌和heroku应用程序名称):</p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="a0db" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">5.接下来，在命令行中输入</p><pre class="lo lp lq lr gt nr ns nt nu aw nv bi"><span id="2f4b" class="my mh it ns b gy nw nx l ny nz">git init<br/>git add .<br/>git commit -m "first commit"<br/>heroku git:remote -a YourAppName<em class="oo"><br/></em>git push heroku master</span></pre><p id="fc42" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一行创建了一个新的Git存储库。第二行告诉Git，您希望在下一次提交中包含对特定文件的更新。然后第三行提交更改。在第四行中，将“YourAppName”更改为heroku应用程序的名称。最后，第五行将所有内容推送到服务器。</p><p id="2402" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，您应该会看到以下消息:</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/75482b805c96c263fb3505c5793f026d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*y3JH7a7mY4oYFaAjDCA1Ow.png"/></div></figure><p id="3daa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">特别是，它会说检测到一个Python应用程序，并使用pip在requirements.txt文件中安装所需的库。然后，它将读取指定要执行bot.py文件的Procfile。</p><p id="56c7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">原来如此！一旦它完成执行，你可以简单地去电报和信息/开始你的机器人。它现在应该按照您期望的那样运行。</p><p id="cb1c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于你在heroku上使用免费计划，机器人将在30分钟不活动后休眠。所以，如果你在使用它超过30分钟后才开始使用它，那么你要期待机器人会花几秒钟来响应你的/start。除此之外，机器人几乎会瞬间做出反应~</p><h1 id="5105" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">如果你的机器人停止响应该怎么办</h1><p id="8160" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">我注意到，在大约24小时不活动后，机器人停止响应(因为我们使用的是Heroku的免费版本)，所以如果您想“唤醒”机器人，一种方法是对其中一个文件进行更改(例如，将procfile中的python3更改为python，反之亦然)，然后用下面的代码行提交更改:</p><pre class="lo lp lq lr gt nr ns nt nu aw nv bi"><span id="b6ac" class="my mh it ns b gy nw nx l ny nz">git add .<br/>git commit -m "changing python3 to python in Procfile"<br/>git push heroku master</span></pre><p id="bb8f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您应该再次看到关于Python应用程序被检测到的消息，并且一旦它完成执行，您的bot现在应该恢复了！</p></div></div>    
</body>
</html>