# ä½¿ç”¨ datasette ä½¿å¼€æ”¾æ•°æ®æ›´æ˜“è®¿é—®

> åŸæ–‡ï¼š<https://towardsdatascience.com/making-open-data-more-accessible-with-datasette-480a1de5e919?source=collection_archive---------55----------------------->

![](img/6b6688be3b02dbb5e4ddbda5f66fbb7e.png)

ç…§ç‰‡ç”± [NASA](https://unsplash.com/@nasa?utm_source=medium&utm_medium=referral) åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) æ‹æ‘„

åŠ åˆ©ç¦å°¼äºšå·æœ€è¿‘å‘å¸ƒäº†ä¸è¯¥å·å…«å¤§æœºæ„å®˜å‘˜åœ¨ 2018 å¹´ 7 æœˆè‡³ 12 æœˆæœŸé—´è¿›è¡Œçš„æ‹¦æˆªæœ‰å…³çš„æ•°æ®ã€‚è¿™æ˜¯å°†åœ¨æœªæ¥å‡ å¹´ç”Ÿæ•ˆçš„ç¬¬ä¸€æ³¢æ•°æ®å‘å¸ƒã€‚æ•°æ®è¦†ç›–äº†å…¨å· 180 å¤šä¸‡ä¸ªç«™ç‚¹ã€‚è™½ç„¶è¿™æ˜¯æœç€æ­£ç¡®æ–¹å‘è¿ˆå‡ºçš„ä¸€æ­¥ï¼Œä½†ä¸€ä¸ªå¤§çº¦ 640 å…†å­—èŠ‚ã€180 å¤šä¸‡è¡Œå’Œ 140 å¤šåˆ—çš„æ–‡ä»¶å¯èƒ½ä¼šè®©ä¸€äº›ä»æ¢ç´¢è¿™äº›æ•°æ®ä¸­å—ç›Šçš„äººæ„Ÿåˆ°å®³æ€•:åœ°æ–¹é¢†å¯¼äººã€è®°è€…ã€æ´»åŠ¨å®¶å’Œç»„ç»‡è€…ï¼Œç­‰ç­‰ã€‚

[å¼€æ”¾æ•°æ®å®ªç« ](https://opendatacharter.net/principles/)çš„ç¬¬ä¸‰ä¸ªåŸåˆ™æ˜¯æ•°æ®åº”è¯¥*å¯è®¿é—®å’Œå¯ç”¨ã€‚*æä¾›æ•°æ®æ˜¯ç¬¬ä¸€æ­¥ï¼Œä½†ä¸ºäº†è®©å¤§å¤šæ•°äººèƒ½å¤Ÿä½¿ç”¨å’Œè®¿é—®æ•°æ®ï¼Œæˆ‘ä»¬ä¸èƒ½ç®€å•åœ°å‘å¸ƒæ•°æ®ï¼›æˆ‘ä»¬å¿…é¡»è€ƒè™‘åˆ°ç”¨æˆ·ä½“éªŒï¼Œå¹¶å¼€å‘å‡ºä¾¿äºæ¢ç´¢å’Œä½¿ç”¨è¿™äº›æ•°æ®çš„æ–¹æ³•ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘åˆ†äº«ä¸€ç§æ–¹æ³•:ä½¿ç”¨**dataset**ï¼Œä¸€ç§ç”¨äºæ¢ç´¢å’Œå‘å¸ƒæ•°æ®çš„ python *å·¥å…·ã€‚å®ƒå¸®åŠ©äººä»¬è·å–ä»»ä½•å½¢çŠ¶æˆ–å¤§å°çš„æ•°æ®ï¼Œå¹¶å°†å…¶å‘å¸ƒä¸ºä¸€ä¸ªäº¤äº’å¼ã€å¯æ¢ç´¢çš„ç½‘ç«™å’Œé™„å¸¦çš„ APIã€‚â€*

æˆ‘ä»¬é‡‡ç”¨åŠ å·æœ€è¿‘å‘å¸ƒçš„è­¦å¯Ÿåœè½¦æ•°æ®ï¼Œæ¸…ç†å’Œè½¬æ¢æ•°æ®ï¼Œå¹¶å‘ Heroku éƒ¨ç½²ä¸€ä¸ª datasette å®ä¾‹ã€‚

## **ç›®å½•**

â€” [åºå¹•](#fe64)
â€” [å…³äºæ•°æ®](#6e08)
â€” [å…³äºæ•°æ®é›†](#44d1)
â€” [åˆ†æ­¥](#f6a2)
â€”[è·å–æ•°æ®](#0e36)
â€”[å‡†å¤‡æ•°æ®](#ba93)
â€”[æœåŠ¡æ•°æ®](#594a)
â€” [éƒ¨ç½²åˆ° heroku](#aa2a)
â€” [è‡ªåŠ¨åŒ–ä¸€åˆ‡](#6dd2)

# åºè¨€

æ¢ç´¢è¿™ä¸ªæ•°æ®é›†çš„æƒ³æ³•æ¥è‡ªäºå¬ 2020 å¹´ 3 æœˆ 3 æ—¥çš„ä¸€é›† **Pod æ‹¯æ•‘äººç±»**

[](https://overcast.fm/+I9KRmEwJc/04:12) [## å³ä½¿æ˜¯æœ€å¥½çš„çƒå‘˜ä¹Ÿæœ‰æ•™ç»ƒ(ä¹”æ²»Â·åŠ æ–¯ä¸œ)

### æœ¬å‘¨ï¼ŒDeRayã€Clint å’Œ Sam è®¨è®ºäº†æ—§é‡‘å±±çš„é‡åˆ‘åŠ é‡ã€å¼—å‰å°¼äºšå·çš„å„¿ç«¥å‡é‡Šå’Œé€‰æ°‘â€¦

é˜´. fm](https://overcast.fm/+I9KRmEwJc/04:12) 

ä»–ä»¬åœ¨ä¸Šè¯‰ä¸­æåˆ°äº†è¿™ç¯‡æ–‡ç« :

> å¸ƒä¸¹ä»Šå¤©å°†å®£å¸ƒç¬¬äºŒé¡¹æŒ‡ä»¤ï¼Œä¹Ÿç”±ä¸Šè¯‰æœºæ„å®¡æŸ¥ï¼Œå…³äºæ‰€è°“çš„æ–‡æœ¬å‰æ‹¦æˆªï¼Œå…¶ä¸­ä¸€åå®˜å‘˜å› è½»å¾®è¿æ³•æˆ–è¿è§„(å¦‚äº¤é€šè¿è§„)è€Œæ‹¦æˆªæŸäººï¼Œä»¥è¿›è¡Œæ— å…³çš„æœæŸ¥ï¼Œå¦‚æªæ”¯æˆ–æ¯’å“ã€‚æ ¹æ®æ–°æ”¿ç­–ï¼Œå½“è¿ç¦å“æ˜¯ç”±äºä¸è¿è§„ç›¸å…³çš„åœè½¦è€Œè¢«æ”¶é›†æ—¶ï¼Œâ€œåœ¨æ²¡æœ‰å…¶ä»–æ˜æ˜¾çš„çŠ¯ç½ªæ´»åŠ¨å«Œç–‘çš„æƒ…å†µä¸‹â€ï¼Œåœ°æ–¹æ£€å¯Ÿå®˜åŠå…¬å®¤å°†ä¸ä¼šèµ·è¯‰æŒæœ‰è¿ç¦å“çš„æ¡ˆä»¶ã€‚ä»»ä½•ä¸æ”¿ç­–çš„èƒŒç¦»éƒ½åº”ä»¥ä¹¦é¢å½¢å¼åšå‡ºï¼Œå¹¶éœ€è¦ DA æˆ–åˆ‘äº‹éƒ¨é—¨è´Ÿè´£äººçš„æ‰¹å‡†ã€‚æ­¤å¤–ï¼Œæ ¹æ®è¯¥æŒ‡ä»¤ï¼Œè¯¥ç¦ä»¤åŒ…æ‹¬ä¸ªäººåŒæ„æœæŸ¥çš„æƒ…å†µï¼Œâ€œå› ä¸ºæ‰§æ³•éƒ¨é—¨è¦æ±‚åŒæ„æœæŸ¥çš„é•¿æœŸå’Œæœ‰è®°å½•çš„ç§æ—å’Œæ°‘æ—å·®å¼‚â€ã€‚
> --[https://the appeal . org/San-Francisco-da-to-announce-sweeping-changes-on-pending-policy-and-police-stops/](https://theappeal.org/san-francisco-da-to-announce-sweeping-changes-on-sentencing-policy-and-police-stops/)

åœ¨è¿™ä¸€é›†é‡Œï¼Œè¨å§†æåˆ°é»‘äººå’Œæ£•è‰²äººç§è¢«æ‹¦æˆªå’ŒæœæŸ¥çš„æ¯”ä¾‹æ›´é«˜*ï¼Œè€Œä¸”å¾ˆå¤šè¿™æ ·çš„æœæŸ¥æ˜¯ä»–ä»¬æ‰€è°“çš„â€œåŒæ„æœæŸ¥â€ï¼Œè¿™æ„å‘³ç€è­¦å¯Ÿå®é™…ä¸Šæ ¹æœ¬æ²¡æœ‰ç†ç”±æœæŸ¥è¿™ä¸ªäººï¼Œé™¤äº†é—®é‚£ä¸ªäººä»–ä»¬æ˜¯å¦å¯ä»¥æœæŸ¥ä»–ä»¬å’Œé‚£ä¸ªæ®ç§°åŒæ„çš„äººã€‚*

è¿™ç§ä¸¥é‡çš„ç§æ—å·®å¼‚ä»¤äººå¿ƒç¢ï¼Œä½†å¹¶ä¸ä»¤äººæƒŠè®¶ã€‚

å½“æˆ‘ç¬¬ä¸€æ¬¡å¼€å§‹æ¢ç´¢æ•°æ®é›†æ—¶ï¼Œæˆ‘å‘ç°ä½¿ç”¨å®ƒ*å¾ˆéº»çƒ¦*ã€‚æ•°æ®é›†çš„å¤§å°ä½¿å¾—é‚£äº›æ²¡æœ‰ä½¿ç”¨ä»˜è´¹èµ„æº(å¦‚ stata å’Œ sas)æˆ–å¼€æºèµ„æº(å¦‚ python å’Œ r)ä»¥ç¼–ç¨‹æ–¹å¼åˆ†ææ•°æ®çš„äººå¾ˆéš¾åšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™äº›ä¿¡æ¯ä¸æ˜¯ä¸ºäº†æ–¹ä¾¿ç ”ç©¶è€Œè®¾è®¡çš„ï¼Œä½†æœ‰ä¸€äº›å·¥å…·å¯ä»¥å¸®åŠ©ä»–ä»¬ã€‚

> *ğŸ’¡*è¯¥æ³•æ¡ˆè¦æ±‚æ”¶é›†æ•°æ®å¹¶å‘å¸æ³•éƒ¨é•¿æŠ¥å‘Šã€‚è¿™ä¸ªæ•°æ®é›†å°±æ˜¯ä¸ºè¿™ä¸ªç›®çš„æœåŠ¡çš„ã€‚

# å…³äºæ•°æ®

![](img/486f0d2c8cf40cbc1bcf7bc1ee3cdeaf.png)

**æ¥æº:**[https://openjustice.doj.ca.gov/data](https://openjustice.doj.ca.gov/data)

æ•°æ®é›†ç”±ä¸€ä¸ª 641.4 MB çš„`.csv`æ–‡ä»¶ç»„æˆï¼Œè¯¥æ–‡ä»¶åŒ…å« 180 ä¸‡è¡Œå’Œ 143 åˆ—ã€‚æ¯ä¸ªåœæ­¢å®ä¾‹éƒ½æœ‰ä¸€ä¸ªæƒŸä¸€çš„`DOJ_RECORD_ID`ï¼Œæ¯ä¸ªè¢«åœæ­¢çš„äººéƒ½æœ‰ä¸€ä¸ª`PERSON_NUMBER`ã€‚è¯¥æ•°æ®é›†ä¸­æ€»å…±æœ‰ 1ï¼Œ708ï¼Œ377 ä¸ªåœé ç‚¹ï¼Œæ¶‰åŠ 1ï¼Œ800ï¼Œ054 äººã€‚

è¯¥æ•°æ®é›†åŒ…æ‹¬å…³äºæ¯ä¸ªåœç•™çš„åŸºæœ¬ä¿¡æ¯(å¦‚æŒç»­æ—¶é—´ã€ä¸€å¤©ä¸­çš„æ—¶é—´ã€æœ€è¿‘çš„åŸå¸‚ã€æœºæ„åç§°)ã€**æ„ŸçŸ¥çš„**äººå£ç»Ÿè®¡ä¿¡æ¯(ç§æ—/æ°‘æ—ã€æ€§åˆ«ã€å¹´é¾„ã€æ®‹ç–¾)ï¼Œä»¥åŠå…³äºåœç•™åŸå› ã€æœæŸ¥ã€æ‰£æŠ¼ã€åœç•™æœŸé—´é‡‡å–çš„è¡ŒåŠ¨ã€å‘ç°çš„è¿ç¦å“æˆ–è¯æ®ç­‰çš„ä¿¡æ¯ã€‚æœ‰å…³æ•°æ®é›†çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥é˜…è¯»å¸æ³•éƒ¨æ•´ç†çš„è‡ªè¿°æ–‡ä»¶å’Œ 2020 å¹´å¹´åº¦æŠ¥å‘Šã€‚

è¿™æ˜¯æœªæ¥å‡ å¹´å°†å‘å¸ƒçš„ä¸€ç³»åˆ— RIPA æ•°æ®ä¸­çš„ç¬¬ä¸€æ³¢ã€‚è¿™ä¸€æ³¢å‘å¸ƒçš„æ•°æ®ä¸åŠ å· 8 ä¸ªæœ€å¤§çš„æ‰§æ³•æœºæ„(æ‰§æ³•æœºæ„)æœ‰å…³(è¿™äº›æ‰§æ³•æœºæ„é›‡ä½£äº† 1000 å¤šåå®˜å‘˜)ã€‚è¿™äº› lea(åŠå…¶åœ¨æ€»è§‚æµ‹å€¼ä¸­æ‰€å çš„ä»½é¢)æ˜¯:

[è‡ªè¿°](https://data-openjustice.doj.ca.gov/sites/default/files/dataset/2020-01/RIPA%20Dataset%20Read%20Me%2020200106.pdf) | [2020 å¹´å¹´æŠ¥](https://oag.ca.gov/sites/all/files/agweb/pdfs/ripa/ripa-board-report-2020.pdf)

# å…³äº datasette

> **dataset**æ˜¯ä¸€ä¸ªæ¢ç´¢å’Œå‘å¸ƒæ•°æ®çš„å·¥å…·ã€‚å®ƒå¸®åŠ©äººä»¬è·å–ä»»ä½•å½¢çŠ¶æˆ–å¤§å°çš„æ•°æ®ï¼Œå¹¶å°†å…¶å‘å¸ƒä¸ºä¸€ä¸ªäº¤äº’å¼çš„ã€å¯æ¢ç´¢çš„ç½‘ç«™å’Œé™„å¸¦çš„ APIã€‚**dataset**é¢å‘æ•°æ®è®°è€…ã€åšç‰©é¦†é¦†é•¿ã€æ¡£æ¡ˆç®¡ç†å‘˜ã€åœ°æ–¹æ”¿åºœå’Œå…¶ä»–ä»»ä½•å¸Œæœ›ä¸ä¸–ç•Œåˆ†äº«æ•°æ®çš„äººã€‚å®ƒæ˜¯ä¸€ä¸ªæ›´å¤§çš„å·¥å…·å’Œæ’ä»¶ç”Ÿæ€ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œè‡´åŠ›äºå°½å¯èƒ½æé«˜ç»“æ„åŒ–æ•°æ®çš„å·¥ä½œæ•ˆç‡ã€‚ *-*[*datasette . readthedocs . io*](https://datasette.readthedocs.io/)

**æ•°æ®é›†**æ˜¯è¿™ä¸ªé¡¹ç›®çš„å¼•æ“ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæŠ“å–ä¸€ä¸ª sqlite æ•°æ®åº“ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª*äº¤äº’å¼çš„ã€å¯æ¢ç´¢çš„ç½‘ç«™å’Œé™„å¸¦çš„ API* ã€‚ä¸ºäº†å‡†å¤‡æ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`csvs-to-sqlite`ï¼Œè¿™æ˜¯æ¥è‡ª**dataset**ç”Ÿæ€ç³»ç»Ÿçš„å¦ä¸€ä¸ªå·¥å…·ï¼Œå®ƒæŠ“å– CSV æ–‡ä»¶å¹¶ä»å®ƒä»¬åˆ›å»º sqlite æ•°æ®åº“ã€‚

ä½ å¯ä»¥åœ¨ [GitHub repo çš„ç»´åŸº](https://github.com/simonw/datasette/wiki/Datasettes)ä¸Šæ‰¾åˆ°ä¸€äº›å…¬å¼€**æ•°æ®é›†**çš„ä¾‹å­ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæœåŠ¡äº FiveThirtyEight å‘å¸ƒçš„æ•°æ®é›†(åœ¨ä»–ä»¬çš„ [GitHub repo](https://github.com/fivethirtyeight/data) ä¸­æ‰¾åˆ°):[https://fivethirtyeight.datasettes.com/](https://fivethirtyeight.datasettes.com/)

ä¸»é¡µæ˜¾ç¤ºäº†æ•°æ®çš„è®¸å¯ã€æ¥æºï¼Œå¹¶æä¾›äº†å¯¹ä¸€äº›è¡¨æ ¼çš„å¿«é€Ÿè®¿é—®ã€‚

![](img/f4bf97b1c8800f129c21146bcd23fdca.png)

å¦‚æœä½ ç‚¹å‡»ä½ çš„æ•°æ®åº“åç§°ï¼Œå®ƒä¼šæä¾›ä¸€ä¸ªæ‰€æœ‰è¡¨çš„è§†å›¾ï¼Œå¹¶ä¸ºä½ æä¾›ä¸€ä¸ªæ–‡æœ¬æ¡†æ¥è¿è¡Œå®šåˆ¶çš„ SQL æŸ¥è¯¢ã€‚è¿™æ˜¯ä½¿**æ•°æ®é›†**æˆä¸ºå¦‚æ­¤å¼ºå¤§çš„å·¥å…·çš„ç‰¹æ€§ä¹‹ä¸€ã€‚

![](img/3b9386eb84a7e8fabc05f2d3bd755416.png)

å¦‚æœæ‚¨æ·±å…¥ç ”ç©¶å…¶ä¸­ä¸€ä¸ªè¡¨ï¼Œæ‚¨ä¼šçœ‹åˆ°å»ºè®®çš„æ–¹é¢ã€ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„è¿‡æ»¤å™¨æŒ‰é’®ã€ä¸€ä¸ª JSON å’Œ CSV é“¾æ¥ï¼Œå®ƒå°†æä¾›è¿™äº›æ ¼å¼ä¸­çš„ä¸€ç§æ ¼å¼çš„è¡¨(è¿™æ„å‘³ç€æ‚¨å¯ä»¥å°†å®ƒç”¨ä½œ API)ï¼Œä»¥åŠå¯¹è¡¨çš„æè¿°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæè¿°åŒ…å«ä¸€ä¸ªå¸¦æœ‰æ ‡é¢˜å’Œå®šä¹‰çš„ HTML è¡¨ã€‚

![](img/d6c62c3f10c8553b791652def82ae8e9.png)

å¦‚æœæ‚¨å•å‡»â€œæŸ¥çœ‹å’Œç¼–è¾‘ SQLâ€æŒ‰é’®ï¼Œæ‚¨å°†å†æ¬¡è®¿é—®ä¸€ä¸ªæ–‡æœ¬æ¡†ï¼Œä»¥ä¾¿åœ¨ä¸Šé¢ç¼–å†™æ‚¨è‡ªå·±çš„æŸ¥è¯¢ã€‚

![](img/e6c532c92680b6b5fa3e7856d9287b9f.png)

datasette æ˜¯ä¸°å¯Œçš„å·¥å…·å’Œæ’ä»¶ç”Ÿæ€ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥æ·»åŠ  **datasette-vega** æ’ä»¶( [repo](https://github.com/simonw/datasette-vega) )æ¥æ·»åŠ å½“å‰è¡¨æ ¼çš„äº¤äº’å¼å¯è§†åŒ–(ä½¿ç”¨ [altair](https://altair-viz.github.io/) åˆ¶ä½œ)

![](img/85d177946245bc1c171551cb92f86b9f.png)

è¿™å°±æ˜¯ä¸€ä¸ªåŸºæœ¬çš„æ•°æ®é›†ç½‘ç«™çš„æ ·å­ï¼Œä½†æ˜¯ T2 çš„æ•°æ®é›†æ˜¯é«˜åº¦å¯å®šåˆ¶çš„ã€‚ä»¥ã€Šå·´å°”çš„æ‘©å¤ªé˜³æŠ¥ã€‹çš„**æ•°æ®é›†**ä¸ºä¾‹ï¼Œäººä»¬å¯ä»¥æ¢ç´¢æ¯å¹´æ›´æ–°çš„å…¬å…±å·¥èµ„è®°å½•ã€‚

![](img/70a320f6f42279b9e475d12e3d4a4851.png)

è¿™æ˜¯åœ¨åå°è¿è¡Œçš„æ•°æ®é›†ï¼Œä½†æ˜¯ä»–ä»¬æ·»åŠ äº†è‡ªå·±çš„æ¨¡æ¿/å¸ƒå±€ï¼Œcss å’Œ javascript æ–‡ä»¶ã€‚å…³äºå¦‚ä½•å®šåˆ¶**dataset**çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ç‚¹å‡»è¿™é‡Œ:[https://dataset . readthe docs . io/en/stable/custom _ templates . html](https://datasette.readthedocs.io/en/stable/custom_templates.html)

# æŒ‰éƒ¨å°±ç­çš„

è¿™ä¸€éƒ¨åˆ†æ˜¯å¯¹è¯¥é¡¹ç›®çš„æŠ€æœ¯æ€§æ›´å¼ºçš„æè¿°ã€‚**æ•°æ®é›†**çš„æ•°æ®å‡†å¤‡å’Œéƒ¨ç½²éå¸¸ç®€å•ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ:

â€”è·å–æ•°æ®
â€”å‡†å¤‡æ•°æ®
â€”æœåŠ¡æ•°æ®

# è·å–æ•°æ®

è¿™äº›æ•°æ®æ˜¯ä»åŠ å·å¸æ³•éƒ¨çš„å…¬å¼€å¸æ³•ç½‘ç«™ä¸Šè·å¾—çš„:[https://openjustice.doj.ca.gov/data](https://openjustice.doj.ca.gov/data)ã€‚ç½‘ç«™æä¾›äº†ä¸‹è½½æ•°æ®çš„é“¾æ¥(æˆªæ­¢åˆ° 2020 å¹´ 5 æœˆ 5 æ—¥ï¼Œæˆ‘ä¸ºè¿™ä¸ªé¡¹ç›®ä¸‹è½½çš„)ã€‚è¦äº†è§£æ›´å¤šå…³äºæ•°æ®æœ¬èº«çš„ä¿¡æ¯ï¼Œä½ å¯ä»¥é˜…è¯»é¡¹ç›® GitHub repo ä¸Šå…³äºæ•°æ® çš„ [*éƒ¨åˆ†ã€‚*](https://github.com/chekos/RIPA-2018-datasette#about-the-data)

# å‡†å¤‡æ•°æ®

åŸå§‹ CSV æ–‡ä»¶çš„å¤§å°è¶…è¿‡ 650 MBï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æ˜¯å°†*åˆ†å‰²æˆ 15 ä¸ª CSV æ–‡ä»¶ï¼Œè¿™æ ·æ¯ä¸ªæ–‡ä»¶éƒ½å¯ä»¥ä¸Šä¼ åˆ°è¿™ä¸ªå­˜å‚¨åº“ä¸­çš„ GitHubã€‚*

[https://github . com/chekos/RIPA-2018-dataset/blob/FEA 53 ce 60 AE 43 f 0d 7 b 0dd 130109 a 01496 f 08 e20 a/src/data/split _ data . py # L1-L16](https://github.com/chekos/RIPA-2018-datasette/blob/fea53ce60ae43f0d7b0dd130109a01496f08e20a/src/data/split_data.py#L1-L16)

> *ğŸ’¡* **ä¸ºä»€ä¹ˆæ˜¯**ï¼Ÿä»¥é˜²å®ƒç¥ç§˜åœ°ä»åŸå§‹æ•°æ®æºä¸­æ¶ˆå¤±â€¦

ç„¶è€Œï¼Œå› ä¸ºæ•°æ®é›†å¤ªå¤§è€Œä¸èƒ½ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„è¡¨(180 ä¸‡è¡Œä¹˜ 143 åˆ—)ï¼Œæ‰€ä»¥å®ƒä¹Ÿè¢«*åˆ†è§£ä¸º*æ›´å°çš„è¡¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å°†ç›¸å…³å˜é‡(åŸºäºå®ƒä»¬çš„åç¼€)æå–åˆ°å®ƒä»¬è‡ªå·±çš„è¡¨ä¸­ã€‚ä¾‹å¦‚ï¼Œä»â€œä¸»â€è¡¨ä¸­æå–ä¸æ€§åˆ«ç›¸å…³çš„å˜é‡ï¼Œå¦‚`G_FULL`ã€`G_MALE`ã€`G_FEMALE`ã€`G_TRANSGENDER_MAN`ã€`G_TRANSGENDER_WOMAN`ã€`G_GENDER_NONCOMFORMING`å’Œ`G_MULTIGENDER`ï¼Œå¹¶æ·»åŠ åˆ°æ•°æ®åº“ä¸­çš„**æ€§åˆ«**è¡¨ä¸­ã€‚å¯ä»¥ä½¿ç”¨åˆ†é…ç»™å®ƒä»¬çš„ **UNIQUE_ID** å°†å®ƒä»¬è¿æ¥å›ä¸»è¡¨ã€‚

[](https://github.com/chekos/RIPA-2018-datasette/blob/master/src/data/break_down_database.py) [## chekos/RIPA-2018-æ•°æ®é›†

### CA RIPA 2018 æ•°æ®å‘å¸ƒæ•°æ®é›†ã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ªâ€¦â€¦ä¸º chekos/RIPA 2018-dataset çš„å‘å±•åšå‡ºè´¡çŒ®

github.com](https://github.com/chekos/RIPA-2018-datasette/blob/master/src/data/break_down_database.py) 

è¯¥æ•°æ®é›†çš„æ¯ä¸ªè§‚å¯Ÿæˆ–è¡Œè¢«åˆ†é…ä¸€ä¸ª`DOJ_RECORD_ID`å’Œä¸€ä¸ª`PERSON_NUMBER`ã€‚è¿™äº›åˆ†åˆ«æ˜¯åœé ç‚¹å’Œè¢«åœé çš„äººå‘˜æ‰€ç‰¹æœ‰çš„ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬ç»„åˆèµ·æ¥ï¼Œä¸ºæ¯ä¸€è¡Œåˆ›å»ºä¸€ä¸ª`UNIQUE_ID`ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒå°†è¡¨è¿æ¥åœ¨ä¸€èµ·ã€‚ç„¶è€Œï¼Œè¿™æœ€ç»ˆæ˜¯ä¸€ä¸ª 22 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œè¿™æ˜¯ä¸å¿…è¦çš„å¤§ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæ¯ä¸€è¡Œéƒ½åˆ†é…äº†ä¸€ä¸ªä» 1ï¼Œ000ï¼Œ000 å¼€å§‹çš„æ•°å­— idã€‚ä»ä¸€ç™¾ä¸‡å¼€å§‹æ˜¯å®Œå…¨éšæ„çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä»é›¶å¼€å§‹ï¼Œä½†æ˜¯å› ä¸ºæœ‰ 180 ä¸‡è¡Œï¼Œæˆ‘ä»¬å†³å®šè®©æ¯ä¸ªæ•°å­— id éƒ½æ˜¯ä¸ƒä½æ•°ã€‚è¿™ä¸ªæ•°å­—`UNIQUE_ID`è®©æˆ‘ä»¬å°†è¡¨è¿æ¥åœ¨ä¸€èµ·**å’Œ**åœ¨å†…å­˜æ–¹é¢å¯¹æ•°æ®åº“æ¥è¯´å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å¢åŠ ã€‚

ä¸€æ—¦åˆ›å»ºäº†è¿™ä¸ª`UNIQUE_ID`,æˆ‘ä»¬å°±å¯ä»¥ä»â€œä¸»â€è¡¨ä¸­æå–åˆ—åˆ°å®ƒä»¬è‡ªå·±çš„è¡¨ä¸­ï¼Œå¹¶å°†å®ƒä»¬ä¿å­˜ä¸ºå•ç‹¬çš„ CSV æ–‡ä»¶ï¼Œç¡®ä¿æ¯ä¸ªè§‚å¯Ÿéƒ½å¯ä»¥åœ¨è¿™äº›æ–°è¡¨ä¸­åŒ¹é…ã€‚

ç„¶åæˆ‘ä»¬ä½¿ç”¨`csvs-to-sqlite`åˆ›å»ºä¸€ä¸ª sqlite æ•°æ®åº“ï¼Œå…¶ä¸­æ¯ä¸ª CSV éƒ½æ˜¯ä¸€ä¸ªè¡¨ã€‚åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬è¿˜åŒ…æ‹¬ä» DOJ ç½‘ç«™è·å¾—çš„**é™„å½• B è¡¨ 3.csv** æ–‡ä»¶ï¼Œä»¥åŠæˆ‘ä»¬å¯èƒ½å·²ç»åˆ›å»ºçš„ä¼´éšæ•°æ®é›†çš„ä»»ä½•å…¶ä»–è¡¥å……è¡¨ã€‚

```
csvs-to-sqlite data/processed/*.csv "data/external/Appendix B Table 3.csv" datasette/ripa-2018-db.db
```

# æä¾›æ•°æ®

åœ¨å‡†å¤‡æ•°æ®å’Œåˆ›å»º sqlite æ•°æ®åº“ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨**dataset**ä½œä¸ºä¸€ä¸ªäº¤äº’å¼ç½‘ç«™å’Œ APIã€‚è¿™å’Œè·‘æ­¥ä¸€æ ·ç®€å•

```
datasette ripa-2018.db
```

ç„¶è€Œï¼Œå¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬ç¨å¾®å®šåˆ¶äº†ä¸€ä¸‹æˆ‘ä»¬çš„**dataset**å®ä¾‹ã€‚

æˆ‘ä»¬åŒ…æ‹¬æ ‡é¢˜ã€æè¿°ã€æ•°æ®æº URL å’Œä¸€äº›é¢å¤–çš„ CSS å’Œ JS èµ„äº§ã€‚ä½ å¯ä»¥æ¢ç´¢[dataset/metadata . JSON](https://github.com/chekos/RIPA-2018-datasette/blob/master/datasette/metadata.json)æ¥æ‰¾åˆ°ç»†èŠ‚ã€‚

[https://github . com/chekos/RIPA-2018-dataset/blob/FEA 53 ce 60 AE 43 f 0d 7 b 0dd 130109 a 01496 f 08 e20 a/dataset/metadata . JSON](https://github.com/chekos/RIPA-2018-datasette/blob/fea53ce60ae43f0d7b0dd130109a01496f08e20a/datasette/metadata.json)

æˆ‘ä»¬è¿˜åŒ…æ‹¬*é¢„è®¾æŸ¥è¯¢ï¼›*æŸ¥è¯¢é»˜è®¤åŒ…å«åœ¨æˆ‘ä»¬çš„å®ä¾‹ä¸­ï¼Œæ˜¾ç¤ºåœ¨ä¸»é¡µä¸­ï¼Œå¹¶å¸¦æœ‰è‡ªå·±çš„ URL ä»¥æ–¹ä¾¿è®¿é—®ã€‚åŒ…å«è¿™äº›æŸ¥è¯¢æ˜¯å› ä¸ºå®ƒä»¬æ˜¯åœ¨æ•°æ®ä¸­å‘ç°çš„æœ‰ç”¨å’Œ/æˆ–æœ‰è¶£çš„äº‹å®ã€‚å…¶ä¸­ä¸€äº›æ˜¯è®¡ç®— 2020 å¹´å¹´åº¦æŠ¥å‘Šä¸­å‘å¸ƒçš„ç‰¹å®šäº‹å®çš„æŸ¥è¯¢ã€‚

æˆ‘ä»¬è¿˜ä»**æ•°æ®é›†**ä¸­ä¿®æ”¹äº†ä¸€äº›æ¨¡æ¿ï¼Œå…·ä½“æ˜¯`base.html`å’Œ`query.html`ã€‚ç¬¬ä¸€ä¸ªè¢«ä¿®æ”¹ä¸ºåœ¨`<head>`(ç½‘ç«™é¢„è§ˆæè¿°ç­‰)ä¸­åŒ…å«ä¸€äº›å…ƒæ•°æ®ã€‚ç¬¬äºŒä¸ªè¿›è¡Œäº†ä¿®æ”¹ï¼Œåœ¨ SQL æ–‡æœ¬æ¡†ä¸‹é¢æ·»åŠ äº†ä¸€ä¸ªæŒ‰é’®ï¼Œç”¨äºæäº¤ç”¨æˆ·åˆšåˆšåœ¨ GitHub ä¸Šä½œä¸ºå»ºè®®è¿è¡Œçš„æŸ¥è¯¢ï¼Œä»¥ä¾¿äºå…±äº«ã€‚

æˆ‘ä»¬è¿˜æ›´æ”¹äº†**æ•°æ®é›†**çš„ä¸€äº›é»˜è®¤é€‰é¡¹:

1.  `default_page_size:50` -æ¯é¡µä»…æ˜¾ç¤º 50 ä¸ªç»“æœ
2.  `sql_time_limit_ms:30000` - 30 ç§’é™æ—¶è®¡ç®—æŸ¥è¯¢(é™æ—¶åœ¨ Heroku ä¸Š)
3.  `facet_time_limit_ms:10000`-dataset åº”è¯¥èŠ±è´¹åœ¨è®¡ç®—è¡¨çš„ä¸€ä¸ªæ–¹é¢çš„æ—¶é—´é™åˆ¶(é»˜è®¤ä¸º 200 æ¯«ç§’ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬çš„æ•°æ®é›†éå¸¸å¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å…¶æ‰©å±•åˆ° 10 ç§’)

è¿è¡Œçš„ç»“æœä»£ç æ˜¯:

```
datasette ripa-2018-db.db \\
  -m metadata.json \\
  --extra-options="--config default_page_size:50 --config sql_time_limit_ms:30000 --config facet_time_limit_ms:10000"
```

# éƒ¨ç½²åˆ° heroku

ä»¥ä¸‹æ˜¯è¯¥æµç¨‹çš„é«˜çº§æ¦‚è¿°

![](img/a3cbc1c52f8ad51c0527b39252dccfdd.png)

[https://github.com/chekos/RIPA-2018-datasette](https://github.com/chekos/RIPA-2018-datasette)

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€äº› python ä»£ç æ¥å¤„ç†æˆ‘ä»¬çš„æ•°æ®(åˆ›å»ºä¸€ä¸ª`UNIQUE_ID`å¹¶å°†åŒ…å« 143 åˆ—çš„åŸå§‹æ•°æ®é›†åˆ†è§£æˆå„ç§æ›´å°çš„`.csv`æ–‡ä»¶)ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨`csvs-to-sqlite`ä»è¿™äº›`.csv`æ–‡ä»¶ä¸­æ„å»ºäº†æˆ‘ä»¬çš„`ripa-2018-db.db`æ•°æ®åº“ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´é€šè¿‡è¿è¡Œè¿è¡Œæœ¬åœ°æœåŠ¡å™¨çš„å‘½ä»¤`datasette ripa-2018-db.db`ä¸æˆ‘ä»¬çš„**æ•°æ®é›†**è¿›è¡Œäº¤äº’ã€‚ä¸ºäº†è®©æˆ‘ä»¬çš„**æ•°æ®é›†**å¯¹å…¨ä¸–ç•Œå¯ç”¨ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨çº¿éƒ¨ç½²å®ƒï¼Œå¹¸è¿çš„æ˜¯è¿™éå¸¸éå¸¸å®¹æ˜“åšåˆ°ï¼Œå› ä¸º**æ•°æ®é›†**å·²ç»åŒ…å«äº†ä¸€ä¸ª`publish`å‘½ä»¤ã€‚

ä½¿ç”¨**datasetï¼Œ**å¯ä»¥ç›´æ¥å‘å¸ƒåˆ° [Heroku](https://datasette.readthedocs.io/en/stable/publish.html#publishing-to-heroku) ã€ [Google Cloud Run](https://datasette.readthedocs.io/en/stable/publish.html#publishing-to-google-cloud-run) æˆ– [Fly](https://datasette.readthedocs.io/en/stable/publish.html#publishing-to-fly) (ä» 0.42 ç‰ˆæœ¬å¼€å§‹)ã€‚å› ä¸ºæˆ‘ä»¥å‰æœ‰éƒ¨ç½² heroku çš„ç»éªŒï¼Œæˆ‘å‘ç°è¿™æ˜¯ä¸‰ä¸ªä¸­æœ€ç®€å•çš„ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æ˜¯å¾ˆå¥½çš„é€‰æ‹©ï¼Œæ–‡æ¡£ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ã€‚

éƒ¨ç½²åˆ° Heroku å°±åƒè¿è¡Œå‡ ä¹ç›¸åŒçš„å‘½ä»¤ä¸€æ ·ç®€å•ï¼Œè¯¥å‘½ä»¤ç”¨äºæœ¬åœ°æœåŠ¡æˆ‘ä»¬çš„æ•°æ®é›†ã€‚

```
datasette publish heroku ripa-2018-db.db \\
  --name ripa-2018-db \\
  -m metadata.json \\
  --extra-options="--config default_page_size:50 --config sql_time_limit_ms:30000 --config facet_time_limit_ms:10000"
```

> *ğŸ’¡* **æ³¨æ„**`--name`æ ‡å¿—ï¼Œå®ƒæŒ‡å®šäº†æˆ‘ä»¬ heroku åº”ç”¨ç¨‹åºçš„åç§°ã€‚è¿™æ„å‘³ç€å®ƒä¼šå‘å¸ƒåˆ°[ripa-2018-db.herokuapp.com](http://ripa-2018-db.herokuapp.com)å¹¶ä¸”ä¼šè¦†ç›–ä¹‹å‰çš„åº”ç”¨(å¦‚æœæœ‰çš„è¯)ã€‚

è¦è¿è¡Œè¿™ä¸ªï¼Œä½ éœ€è¦ä¸€ä¸ª [heroku è´¦å·](https://signup.heroku.com/)å¹¶å®‰è£… [heroku cli å·¥å…·](https://devcenter.heroku.com/articles/heroku-cli)ã€‚**dataset**(ä½¿ç”¨ heroku cli)å°†è¦æ±‚æ‚¨ç™»å½•å¹¶æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨çª—å£ã€‚ä½ ç™»å½•åï¼Œå®ƒä¼šå¤„ç†å‰©ä¸‹çš„äº‹æƒ…ã€‚

åˆ©æ–¯æ‰˜ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸåœ°å°†æˆ‘ä»¬çš„**æ•°æ®é›†**å‘å¸ƒåˆ° herokuï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®[ripa-2018-db.herokuapp.com](http://ripa-2018-db.herokuapp.com)æˆ–[ripa-2018.datasettes.cimarron.io/](http://ripa-2018.datasettes.cimarron.io/)

![](img/1fef7048428003d4c77ad652a3bf0b12.png)

[http://ripa-2018.datasettes.cimarron.io/](http://ripa-2018.datasettes.cimarron.io/)

å¯¹è®¸å¤šäººæ¥è¯´ï¼Œè¿™å°†æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„ç»“æŸã€‚æˆ‘ä»¬å·²ç»æˆåŠŸåœ°è·å–å’Œè½¬æ¢äº†ä¸€äº›æ•°æ®ï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ°äº‘ä¸­ï¼Œä¾›å…¶ä»–äººæ¢ç´¢å’Œäº¤äº’ã€‚æˆ‘ä»¬è¿˜åŒ…æ‹¬ä¸€ä¸ª HTML æè¿°ï¼Œä¸ºç”¨æˆ·æè¿°æˆ‘ä»¬çš„**æ•°æ®é›†**ï¼Œç”šè‡³è¿˜æœ‰ä¸€äº›*é¢„è®¾æŸ¥è¯¢*ï¼Œä¾›äººä»¬é‡ç° 2020 å¹´å¹´åº¦æŠ¥å‘Šä¸­å…¬å¸ƒçš„ä¸€äº›äº‹å®ã€‚

# è‡ªåŠ¨åŒ–ä¸€åˆ‡

è™½ç„¶æ‚¨æä¾›çš„åº•å±‚æ•°æ®å¯èƒ½ä¸ä¼šç»å¸¸æ”¹å˜ï¼Œä½†æ˜¯æ‚¨å¯èƒ½ä¼šå‘ç°è‡ªå·±å‡ºäºè®¸å¤šåŸå› æƒ³è¦è‡ªåŠ¨åŒ–éƒ¨ç½²æ‚¨çš„**dataset**å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘å¼€å§‹è¿™ä¸ªé¡¹ç›®**æ—¶ï¼Œdatasetteã€‘çš„ç‰ˆæœ¬æ˜¯ 0.40ï¼Œè€Œå½“æˆ‘å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œå®ƒçš„ç‰ˆæœ¬æ˜¯ 0.42ã€‚å¤§å¤šæ•°ç‰ˆæœ¬ä½ éƒ½ä¸æƒ³æ›´æ–°ä½ çš„ datasette å®ä¾‹ï¼Œä½†æ˜¯ 0.41 ç‰ˆæœ¬åŒ…å«äº†åˆ›å»ºè‡ªå®šä¹‰é¡µé¢çš„èƒ½åŠ›( [changelog](https://datasette.readthedocs.io/en/stable/changelog.html#v0-41) )ã€‚**

> ä¾‹å¦‚ï¼Œæ·»åŠ ä¸€ä¸ªåä¸º`templates/pages/about.html`çš„æ¨¡æ¿æ–‡ä»¶å°†å¯¼è‡´åœ¨å®ä¾‹çš„`/about`å¤„æä¾›ä¸€ä¸ªæ–°é¡µé¢ã€‚

è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨å®ä¾‹ä¸­ä¸ºç”¨æˆ·æ·»åŠ æ›´å¤šçš„ä¸Šä¸‹æ–‡ã€‚ä¹Ÿè®¸åŒ…æ‹¬ä¸€ä¸ªå¸®åŠ©äººä»¬ä¸ºé¡¹ç›®åšè´¡çŒ®çš„é€æ­¥æŒ‡å—ï¼Œå…¶ä»–æœ‰ç”¨çš„é“¾æ¥ï¼Œæˆ–è€…ä¸€ä¸ªç®€å•çš„ä»‹ç»ä½ è‡ªå·±çš„é¡µé¢ï¼Œè¿™æ ·ä½¿ç”¨è¿™äº›æ•°æ®çš„äººå¯ä»¥æ›´å¤šåœ°äº†è§£ä½ ã€‚

ä½ å¯èƒ½è¿˜æƒ³åŒ…å«æ›´å¤šçš„*å›ºå®šæŸ¥è¯¢*æˆ–è€…ä¿®æ”¹ä½ æè¿°ä¸­çš„ä¸€ä¸ªé”™åˆ«å­—ã€‚ä¸ç®¡æ˜¯ä»€ä¹ˆåŸå› ï¼Œè‡ªåŠ¨åŒ–éƒ¨ç½²å¾ˆå®¹æ˜“å®ç°ã€‚æœ€ç»ˆä½ éœ€è¦åšçš„å°±æ˜¯è¿è¡Œ`datasette heroku publish`,è¿™æ˜¯ GitHub åŠ¨ä½œçš„ä¸€ä¸ªå®Œç¾ç”¨ä¾‹

> *ğŸš¨* ***è­¦å‘Š/æ³¨æ„:*** *è¿™ä¸‹ä¸€éƒ¨åˆ†å˜å¾—æŠ€æœ¯æ€§çœŸå¿«å¤šäº†ã€‚GitHub Actions æ˜¯ä¸€ä¸ªæ›´é«˜çº§çš„ä¸»é¢˜ã€‚å¦‚æœæ‚¨ä¸éœ€è¦/ä¸æƒ³å®šæœŸæ›´æ–°æ–°éƒ¨ç½²çš„****dataset****å®ä¾‹ï¼Œæˆ‘ä¸å»ºè®®æ‚¨ç°åœ¨å°±è€ƒè™‘ GitHub åŠ¨ä½œã€‚*

# GitHub æ“ä½œ

> GitHub åŠ¨ä½œå¸®åŠ©æ‚¨åœ¨å­˜å‚¨ä»£ç å’Œåä½œå¤„ç†æ‹‰å–è¯·æ±‚å’Œé—®é¢˜çš„åŒä¸€ä½ç½®è‡ªåŠ¨åŒ–æ‚¨çš„è½¯ä»¶å¼€å‘å·¥ä½œæµç¨‹ã€‚æ‚¨å¯ä»¥ç¼–å†™ç§°ä¸ºæ“ä½œçš„å•ä¸ªä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬ç»„åˆèµ·æ¥åˆ›å»ºè‡ªå®šä¹‰å·¥ä½œæµã€‚å·¥ä½œæµæ˜¯å®šåˆ¶çš„è‡ªåŠ¨åŒ–è¿‡ç¨‹ï¼Œæ‚¨å¯ä»¥åœ¨å­˜å‚¨åº“ä¸­è®¾ç½®å®ƒï¼Œä»¥ä¾¿åœ¨ GitHub ä¸Šæ„å»ºã€æµ‹è¯•ã€æ‰“åŒ…ã€å‘å¸ƒæˆ–éƒ¨ç½²ä»»ä½•ä»£ç é¡¹ç›®ã€‚
> 
> [-https://help . github . com/en/actions/getting-started-with-github-actions/about-github-actions](https://help.github.com/en/actions/getting-started-with-github-actions/about-github-actions)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šæ·±å…¥è®¨è®º GitHub çš„è¡Œä¸ºã€‚ä½ éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œé€šè¿‡ GitHub æ“ä½œï¼Œä½ å¯ä»¥å¹¶è¡Œæˆ–æŒ‰é¡ºåºè¿è¡Œä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡ç”± GitHub äº‹ä»¶è§¦å‘ï¼Œå¦‚æ¨é€åˆ°ä¸€ä¸ªåˆ†æ”¯ï¼Œæ‰“å¼€ä¸€ä¸ªæ‹‰è¯·æ±‚ï¼Œè¯„è®ºä¸€ä¸ªé—®é¢˜æˆ–å¤šä¸ªé—®é¢˜çš„ç»„åˆã€‚

è¿™äº›é€šå¸¸ä»¥ yaml æ–‡ä»¶çš„å½¢å¼å­˜åœ¨äºä½ çš„ GitHub repos çš„`.github/workflows/`ä¸‹ã€‚åŸºæœ¬ç»“æ„å¦‚ä¸‹

```
name: Example of simple GitHub Actionon:
  push: 
    branches: [master]jobs:
  say-hi:
    runs-on: ubuntu-latest
    steps:
    - name: Echo Hello World
      run: |
        echo "Hello World!"
```

æ¯å½“ä¸»åˆ†æ”¯ä¸Šæœ‰ä¸€ä¸ªæ¨é€æ—¶ï¼Œè¿™ä¸ªåŠ¨ä½œå°±ä¼šè¢«è§¦å‘ï¼Œå®ƒå°†è¿è¡Œä½œä¸š`say-hi`ï¼Œè¯¥ä½œä¸šè¿è¡Œåœ¨æœ€æ–°çš„å¯ç”¨ ubuntu è™šæ‹Ÿæœº(VM)ä¸Šã€‚åœ¨é‚£ä¸ªè™šæ‹Ÿæœºä¸­ï¼Œå®ƒå°†è¿è¡Œä»£ç `echo "Hello World!"`

æ‚¨å¯ä»¥åœ¨ repo çš„**æ“ä½œ**é€‰é¡¹å¡ä¸ŠæŸ¥çœ‹æ‚¨çš„æ“ä½œçš„è¾“å‡º/æ—¥å¿—ã€‚

![](img/6afccd5bd90347c56abf6c699fe81464.png)

ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°æ”¹å˜`echo "Hello World!"`

```
datasette publish heroku ripa-2018-db.db \\
  --name ripa-2018-db \\
  -m metadata.json \\
  --extra-options="--config default_page_size:50 --config sql_time_limit_ms:30000 --config facet_time_limit_ms:10000"
```

æˆ–è€…æ›´å¥½çš„åŠæ³•æ˜¯å°†ä»£ç ä¿å­˜åœ¨ bash è„šæœ¬`heroku_deploy.sh`ä¸­ï¼Œç„¶ååƒè¿è¡Œ`echo "Hello World!"`ä¸€æ ·è¿è¡Œ`sh heroku_deploy.sh`

å¹¸è¿çš„æ˜¯ï¼ŒHeroku å·²ç»å®‰è£…åœ¨æˆ‘ä»¬çš„ GitHub Action runner([Ubuntu-latest](https://github.com/actions/virtual-environments/blob/master/images/linux/Ubuntu1804-README.md))ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ç™»å½•ï¼Œå®‰è£…`heroku-builds`æ’ä»¶å¹¶è¿è¡Œæˆ‘ä»¬çš„è„šæœ¬`heroku_deploy.sh`ã€‚

> *ğŸ’¡åœ¨å‡ æ¬¡ GitHub æ“ä½œå¤±è´¥åï¼Œæˆ‘äº†è§£åˆ°éœ€è¦å®‰è£…`heroku-builds`ã€‚æˆ‘ä¸ç¡®å®šå®ƒæ˜¯å¦è®°å½•åœ¨ datasetteã€‘æˆ– GitHub Actions æ–‡æ¡£ä¸­ã€‚*

æ‰€ä»¥ç°åœ¨æˆ‘ä»¬çš„ GitHub åŠ¨ä½œåº”è¯¥æ˜¯è¿™æ ·çš„

```
name: Example of simple GitHub Actionon:
  push: 
    branches: [master]jobs:
  publish-to-heroku:
    runs-on: ubuntu-latest
    steps:
    - name: Publish to Heroku
      run: |
        heroku container:login && heroku plugins:install heroku-builds && sh heroku_deploy.sh
```

ç„¶è€Œï¼Œè¿™è¿˜æ²¡æœ‰å‡†å¤‡å¥½ã€‚ä¸ºäº†è‡ªåŠ¨ç™»å½•ï¼Œæ‚¨éœ€è¦åŒ…å«ç¯å¢ƒå˜é‡`HEROKU_API_KEY`ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ [GitHub ç§˜å¯†](https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets)æ¥å®ç°ã€‚

è¦åˆ›å»º API å¯†é’¥ï¼Œæ‚¨éœ€è¦åœ¨æœ¬åœ°å®‰è£… heroku cliã€‚è¿è¡Œå‘½ä»¤`heroku authorizations:create`å¹¶å°†å…¶æ·»åŠ åˆ°æ‚¨çš„ repo çš„**è®¾ç½®>æœºå¯†**é€‰é¡¹å¡ä¸Šã€‚å‘½åä¸º`HEROKU_API_KEY`ã€‚

ä¸ºäº†è®©æ‚¨çš„ GitHub æ“ä½œèƒ½å¤Ÿè®¿é—®å®ƒï¼Œæ‚¨å¿…é¡»å°†ä¸‹é¢ä¸€è¡Œæ·»åŠ åˆ°å®ƒçš„ yaml æ–‡ä»¶ä¸­

```
name: Example of simple GitHub Actionon:
  push: 
    branches: [master]jobs:
  publish-to-heroku:
    runs-on: ubuntu-latest
    steps:
    - name: Publish to Heroku
      env:
        HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
      run: |
        heroku container:login && heroku plugins:install heroku-builds && sh heroku_deploy.sh
```

åˆ©æ–¯æ‰˜ã€‚ç°åœ¨ï¼Œæ¯æ¬¡ä½ æ¨ masterï¼Œä½ éƒ½ä¼šéƒ¨ç½²ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„ datasetteã€‘ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥æ›´æ–°ä½ çš„`metadata.json`ï¼Œä¾‹å¦‚ï¼Œç”¨ä¸€ä¸ªæ–°çš„*é¢„è®¾æŸ¥è¯¢*æˆ–è€…ç»™ä½ çš„`templates/pages`æ·»åŠ ä¸€ä¸ªæ–°é¡µé¢ã€‚

å¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘æœ‰ä¸€äº›é¢å¤–çš„æ­¥éª¤(ä¹Ÿå°±æ˜¯ GitHub æ“ä½œæ­¥éª¤),è¿™äº›æ­¥éª¤å¤„ç†æ•°æ®ï¼Œæ„å»º sqlite3 æ•°æ®åº“ï¼Œå¹¶åœ¨æ¯æ¬¡éœ€è¦ master æ—¶å°†å…¶éƒ¨ç½²åˆ° herokuã€‚æˆ‘è¿˜åŒ…å«äº†å‡ ä¸ª python è„šæœ¬ï¼Œå®ƒä»¬è¯»å–ä¸€ä¸ªå•ç‹¬çš„ yaml æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘è·Ÿè¸ªæ‰€æœ‰çš„*å›ºå®šæŸ¥è¯¢*ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°ä¸€ä¸ª`updated_metadata.json`ã€‚è¿™æ˜¯ä¸ºäº†è®©äº‹æƒ…æ›´æ•´æ´ï¼Œæ¯ä¸ªå›ºå®šçš„æŸ¥è¯¢éƒ½æœ‰ä¸€ä¸ªæ ‡é¢˜ã€html_description å’Œä¸€ä¸ªé•¿çš„ SQL æŸ¥è¯¢ï¼›åœ¨æˆ‘çœ‹æ¥ï¼Œä½œä¸ºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æ›´å®¹æ˜“ç»´æŠ¤ã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æˆ‘çš„ GitHub Action yaml æ–‡ä»¶:

[https://github.com/chekos/RIPA-2018-datasette/blob/master/.github/workflows/main.yml](https://github.com/chekos/RIPA-2018-datasette/blob/master/.github/workflows/main.yml)

# é¢å¤–æ”¶è·:ä½¿ç”¨ github é—®é¢˜æ¥å»ºè®®æŸ¥è¯¢

å¦‚æœä½ è®¿é—®[ripa-2018 . datasets . cimarron . io](http://ripa-2018.datasettes.cimarron.io)å¹¶è¿è¡ŒæŸ¥è¯¢ï¼Œä½ ä¼šæ³¨æ„åˆ°**åœ¨ GitHub ä¸Šæäº¤**æŒ‰é’®

![](img/181dd5fb53cfd646d6866a0441fa984f.png)

è¿™æ˜¯é€šè¿‡è°ƒæ•´`query.html`æ¨¡æ¿æ¥å®Œæˆçš„ã€‚**dataset**åœ¨å¹•åä½¿ç”¨`jinja2`,å®ƒå®é™…ä¸Šå°† SQL æŸ¥è¯¢ä½œä¸º url æŸ¥è¯¢å‚æ•°ä¼ é€’ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨`request.query_string.split('sql=')[-1]`æ¥è®¿é—®å®ƒ

[https://github . com/chekos/RIPA-2018-dataset/blob/FEA 53 ce 60 AE 43 f 0d 7 b 0 DD 130109 a 01496 f 08 e20 a/dataset/templates/query . html # L53-L60](https://github.com/chekos/RIPA-2018-datasette/blob/fea53ce60ae43f0d7b0dd130109a01496f08e20a/datasette/templates/query.html#L53-L60)

ä¸€æ—¦æ‚¨å¯ä»¥è®¿é—®å®ƒï¼Œæ‚¨å°±å¯ä»¥åœ¨æ‚¨çš„å›è´­ä¸Šåˆ›å»ºä¸€ä¸ªæ–°å‘è¡Œçš„ç®€å•é“¾æ¥:

```
{% set link_to_new_issue = "<https://GitHub.com/><YOUR_USERNAME>/<YOUR_REPO>/issues/new?title=Query+suggestion&labels=suggestion&body=" + <QUERY_FOR_ISSUE> %}
```

# èŠ±äº†å¤šé•¿æ—¶é—´

æ•´ä¸ªè¿‡ç¨‹æ€»å…±èŠ±è´¹äº†å¤§çº¦ 20 ä¸ªå°æ—¶ï¼Œåˆ†æ•£åœ¨ 3-4 å‘¨å†…ã€‚å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯ä½¿ç”¨ GitHub Actions æ¥è§„åˆ’å’Œåè°ƒæ•´ä¸ªè‡ªåŠ¨åŒ–è¿‡ç¨‹ã€‚æˆ‘å¸Œæœ›è¿™ç¯‡æ•™ç¨‹èƒ½å¸®åŠ©ä½ èŠ‚çœè¿™äº›é¢å¤–çš„æ—¶é—´ã€‚å°±åƒä»»ä½•å…¶ä»–æ•°æ®é¡¹ç›®ä¸€æ ·ï¼Œæœ€å¥½èŠ±ä¸€äº›æ—¶é—´æå‰æ€è€ƒå¹¶å‹¾ç”»å‡ºè¿‡ç¨‹çš„æ¯ä¸€æ­¥ã€‚

# è¡ŒåŠ¨å‘¼å

ä¸–ç•Œå˜äº†ã€‚è¿™ä¸ªé¡¹ç›®çš„æƒ³æ³•æ˜¯åœ¨å››æœˆä¸­æ—¬çš„æŸä¸ªæ—¶å€™äº§ç”Ÿçš„ï¼Œç›´åˆ°æœˆåº•æˆ‘æ‰åˆ›å»ºäº† GitHub repoã€‚æˆ‘æ˜¯äº”æœˆä¸‹åŠæœˆæ‰å¼€å§‹å†™è¿™ä¸ªæ•™ç¨‹çš„ã€‚ä»é‚£ä»¥åä¸€åˆ‡éƒ½å˜äº†ã€‚

æ¯å¤©åœ¨ç¤¾äº¤åª’ä½“ä¸Šï¼Œæˆ‘ä»¬éƒ½ä¼šçœ‹åˆ°æœ‰å…³å½“å±€æ»¥ç”¨æƒåŠ›ã€å¯¹æ— è¾œæ°‘ä¼—å®æ–½æš´åŠ›çš„è§†é¢‘å’ŒæŠ¥é“ã€‚ä¸æ˜¯å…¨éƒ¨ï¼Œä½†ä¹Ÿä¸åº”è¯¥æ˜¯å…¨éƒ¨ã€‚

æˆ‘ç›¸ä¿¡æ•°æ®æ˜¯å˜é©ã€é—®è´£å’Œé€æ˜çš„å·¥å…·ã€‚æŠ€æœ¯å’Œæ•°æ®æ°¸è¿œæ”¹å˜äº†ä¸–ç•Œã€‚è¯»è€…ä»¬ï¼Œä½œä¸ºä¸€åæŠ€æœ¯ä¸“å®¶ã€æ•°æ®ä¹¦å‘†å­ã€æ”¿ç­–ä¸“å®¶ï¼Œæˆ–è€…ä»»ä½•ä½ ä»¬é€‰æ‹©çš„è‡ªæˆ‘æ ‡æ¦œçš„æ ‡ç­¾ï¼Œæˆ‘ä»¬å¯¹æˆ‘ä»¬çš„åŒè¡Œæœ‰è´£ä»»ä½¿ç”¨æˆ‘ä»¬çš„æŠ€èƒ½ã€æˆ‘ä»¬å¼ºå¤§çš„å·¥å…·ã€æˆ‘ä»¬çš„çŸ¥è¯†è®©ä¸–ç•Œå˜å¾—æ›´ç¾å¥½ï¼Œå› ä¸º**æˆ‘ä»¬å¯ä»¥**ã€‚

æˆ‘è¯·ä½ æƒ³ä¸€æƒ³ä½ æ‰€æ‰®æ¼”çš„è§’è‰²ã€‚ä½ èƒ½ç”¨ä½ æ­£åœ¨å»ºé€ çš„å·¥å…·è®©ä¸–ç•Œå˜å¾—æ›´ç¾å¥½å—ï¼Ÿ

æˆ‘å°†ä»[æ•°æ® 4BlackLives](http://d4bl.org/) ä¸­æ‘˜å½•å¦‚ä¸‹:

> **é»‘äººç”Ÿæ´»æ•°æ®**æ˜¯ä¸€é¡¹ç”±æ´»åŠ¨å®¶ã€ç»„ç»‡è€…å’Œæ•°å­¦å®¶å‘èµ·çš„è¿åŠ¨ï¼Œè‡´åŠ›äºåˆ©ç”¨æ•°æ®ç§‘å­¦ä¸ºé»‘äººçš„ç”Ÿæ´»å¸¦æ¥å…·ä½“è€Œå¯è¡¡é‡çš„å˜åŒ–ã€‚è‡ªä»è®¡ç®—å‡ºç°ä»¥æ¥ï¼Œå¤§æ•°æ®å’Œç®—æ³•å·²ç»æ¸—é€åˆ°æˆ‘ä»¬ç¤¾ä¼šå’Œç»æµç”Ÿæ´»çš„æ–¹æ–¹é¢é¢ã€‚è¿™äº›æ–°çš„æ•°æ®ç³»ç»Ÿæœ‰ç€å·¨å¤§çš„æ½œåŠ›æ¥å¢å¼ºæœ‰è‰²äººç§ç¤¾åŒºçš„åŠ›é‡ã€‚ç»Ÿè®¡å»ºæ¨¡ã€æ•°æ®å¯è§†åŒ–å’Œä¼—åŒ…ç­‰å·¥å…·ï¼Œåœ¨åˆé€‚çš„äººæ‰‹ä¸­ï¼Œæ˜¯å¯¹æŠ—åè§ã€å»ºè®¾è¿›æ­¥è¿åŠ¨å’Œä¿ƒè¿›å…¬æ°‘å‚ä¸çš„æœ‰åŠ›å·¥å…·ã€‚ä½†å†å²è®²è¿°äº†ä¸€ä¸ªä¸åŒçš„æ•…äº‹ï¼Œåœ¨è¿™ä¸ªæ•…äº‹ä¸­ï¼Œæ•°æ®ç»å¸¸è¢«ç”¨ä½œå‹è¿«çš„å·¥å…·ï¼ŒåŠ å‰§ä¸å¹³ç­‰å’Œå»¶ç»­ä¸å…¬æ­£ã€‚çº¢çº¿æ˜¯ä¸€ä¸ªæ•°æ®é©±åŠ¨çš„ä¼ä¸šï¼Œå¯¼è‡´é»‘äººç¤¾åŒºè¢«ç³»ç»Ÿæ€§åœ°æ’é™¤åœ¨ä¸»è¦é‡‘èæœåŠ¡ä¹‹å¤–ã€‚æœ€è¿‘çš„è¶‹åŠ¿ï¼Œå¦‚é¢„æµ‹æ€§è­¦åŠ¡ã€åŸºäºé£é™©çš„åˆ¤å†³å’Œæ å¤ºæ€§è´·æ¬¾ï¼Œæ˜¯åŒä¸€ä¸»é¢˜çš„ä»¤äººä¸å®‰çš„å˜åŒ–ã€‚ä»Šå¤©ï¼Œæ­§è§†æ˜¯ä¸€ä¸ªé«˜ç§‘æŠ€ä¼ä¸šã€‚
> 
> *â€”â€”*[*d4bl.org*](http://d4bl.org/)