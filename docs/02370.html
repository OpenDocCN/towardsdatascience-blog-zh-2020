<html>
<head>
<title>Power BI Connects to Azure Databricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Power BI连接到Azure数据块</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/power-bi-connects-to-azure-databricks-44bea6731be7?source=collection_archive---------11-----------------------#2020-03-06">https://towardsdatascience.com/power-bi-connects-to-azure-databricks-44bea6731be7?source=collection_archive---------11-----------------------#2020-03-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/845d93106b33a7dddf7cc60f3d0b45be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5c3pTws7RHxHShU3"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae jg" href="https://unsplash.com/@kmuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Carlos Muza </a>拍摄的照片</p></figure><div class=""/><div class=""><h2 id="9129" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">派生Spark URL并创建一个用户令牌，PowerBI使用该令牌在Azure Databricks中进行身份验证</h2></div><p id="1795" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为一种数据分析工具，微软的PowerBI最近变得越来越受欢迎。此外，对于一个公司来说，拥有一整桶包含Azure的微软产品是普遍存在的。</p><p id="2e0b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Azure Databricks是Azure平台中最受欢迎的服务之一。它利用Apache Spark在分布式环境中处理数据，这可以显著提高性能。Azure Databricks还支持Delta Lake，这是一个分布式环境中的开源存储层。它的使用与大多数传统数据库管理系统非常相似，因为它支持ACID事务。</p><p id="1dcb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae jg" href="https://delta.io" rel="noopener ugc nofollow" target="_blank"> https://delta.io </a></p><p id="dc63" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文将展示如何使用内置连接器从PowerBI连接到Azure Databricks表(Delta Lake)。棘手的部分是“Spark URL ”,这将在后面强调。</p><h1 id="0b25" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">样本数据表准备</h1><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mm"><img src="../Images/b93079d61ce1e805e21e387800a1c658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_PWojbK1UDkeUndE"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@mbaumi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米卡·鲍梅斯特</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="a1c0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于本教程的目的只是介绍将PowerBI连接到Azure Databricks的步骤，因此将创建一个示例数据表用于测试目的。首先，让我们创建一个包含几列的表。一个日期列可以用作“过滤器”，另一个列用整数作为每个日期的值。</p><p id="d15e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们先在Azure Databricks中创建一个笔记本，我愿意称之为“PowerBI_Test”。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/60db4f3b68e7cfd995095a98b78f05ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*9256Fs7WAVIWQDM16V4O_Q.png"/></div></figure><p id="7326" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为测试目的创建一个数据库。</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="5d89" class="mx lv jj mt b gy my mz l na nb">%sql<br/>CREATE DATABASE TEST_DB;</span></pre><p id="3f19" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，导入必要的库，创建一个Python函数来生成包含上述列的Pandas数据帧。</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="ec10" class="mx lv jj mt b gy my mz l na nb">from datetime import datetime, timedelta<br/>import numpy as np<br/>import pandas as pd</span><span id="a326" class="mx lv jj mt b gy nc mz l na nb"># Create date df in pandas<br/>def create_date_table(start='2020-01-01', end='2020-03-01'):<br/>  df = pd.DataFrame({"date": pd.date_range(start, end)})<br/>  df['day'] = df['date'].dt.weekday_name<br/>  df['date'] = df['date'].dt.date<br/>  df['value'] = np.random.randint(100, size=df.shape[0])<br/>  return df</span></pre><p id="efa9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们可以从熊猫数据帧中生成Spark数据帧，并将其保存到Delta Lake中。</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="0e52" class="mx lv jj mt b gy my mz l na nb">date_pdf = create_date_table()<br/>sample_table = spark.createDataFrame(date_pdf)<br/>sample_table.write.format('delta').mode("overwrite").saveAsTable('TEST_DB.sample_table')</span></pre><p id="d40a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是表格的预览:</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nd"><img src="../Images/c5f4178ce80ba50d4fc579f86a13adb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0to6Iy_r5RppMVGQVN0gQw.png"/></div></div></figure><h1 id="1420" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">Azure数据块URL和用户令牌</h1><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ne"><img src="../Images/d15253ad24362a78adeefc5bda857301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Hrg6kLdtUMeKc-ta"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">苏珊·霍尔特·辛普森在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="aba5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要从PowerBI连接到Azure Databricks，我们需要两个重要的“密钥”，即URL和用户令牌。</p><h2 id="c0ba" class="mx lv jj bd lw nf ng dn ma nh ni dp me lh nj nk mg ll nl nm mi lp nn no mk np bi translated">如何获取spark网址？</h2><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/0aa4a4e91c54fbc8e28a24b6954fea74.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*yWR-RyVFo-z84eX9z2dSYQ.png"/></div></figure><ol class=""><li id="6249" class="nr ns jj la b lb lc le lf lh nt ll nu lp nv lt nw nx ny nz bi translated">从左侧导航中，转到“Cluster”选项卡。</li><li id="e7b2" class="nr ns jj la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated">从群集列表中，单击选择要使用的群集。这将把页面导航到集群编辑页面。</li><li id="7432" class="nr ns jj la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated">在群集编辑页面中，单击“高级选项”以展开该部分。</li><li id="bf95" class="nr ns jj la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated">选择“JDBC/ODBC”选项卡。这里会有很多信息，但我们只需要关注“JDBC网址”。</li></ol><p id="1c58" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.将整个URL复制到某个文本编辑器中。这个URL <strong class="la jk">不能</strong>直接使用，我们需要从中“派生”出正确的URL。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div class="gh gi of"><img src="../Images/6df3304cb37f366224d86e3902719adb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*7EhuFoSjsENaAwp7lx_keQ.png"/></div></figure><p id="b02c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是我从“JDBC网址”文本字段中复制的网址:</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="a6d2" class="mx lv jj mt b gy my mz l na nb">jdbc:spark://australiasoutheast.azuredatabricks.net:443/default;transportMode=http;ssl=1;httpPath=sql/protocolv1/o/***************/****-******-*******;AuthMech=3;UID=token;PWD=&lt;personal-access-token&gt;</span></pre><p id="b988" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">方括号中显示了我们从该URL中需要的组件:</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="325b" class="mx lv jj mt b gy my mz l na nb">jdbc:spark</span><span id="3ecf" class="mx lv jj mt b gy nc mz l na nb">[://australiasoutheast.azuredatabricks.net:443/]</span><span id="6758" class="mx lv jj mt b gy nc mz l na nb">default;transportMode=http;ssl=1;httpPath=</span><span id="1a73" class="mx lv jj mt b gy nc mz l na nb">[sql/protocolv1/o/***************/****-******-*******]</span><span id="522f" class="mx lv jj mt b gy nc mz l na nb">;AuthMech=3;UID=token;PWD=&lt;personal-access-token&gt;</span></pre><p id="89eb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们还需要在前面加一个协议，就是<code class="fe og oh oi mt b">HTTPS</code>。因此，最终的URL将如下所示:</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="d17d" class="mx lv jj mt b gy my mz l na nb"><a class="ae jg" href="https://australiasoutheast.azuredatabricks.net:443/sql/protocolv1/o/***************/****-******-*******" rel="noopener ugc nofollow" target="_blank">https://australiasoutheast.azuredatabricks.net:443/sql/protocolv1/o/***************/****-******-*******</a></span></pre><h2 id="f4dc" class="mx lv jj bd lw nf ng dn ma nh ni dp me lh nj nk mg ll nl nm mi lp nn no mk np bi translated">如何获取用户令牌？</h2><p id="8240" class="pw-post-body-paragraph ky kz jj la b lb oj kk ld le ok kn lg lh ol lj lk ll om ln lo lp on lr ls lt im bi translated">我们需要创建一个用户令牌来进行身份验证。</p><p id="2714" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，在右上角找到用户图标。单击图标，然后在下拉菜单中选择“用户设置”。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/e055a2fb968eb0aa431028be0085e902.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*kggs-vZrHEfyjyoin9_DfQ.png"/></div></figure><p id="41f6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在“用户设置”页面中，单击“生成新令牌”按钮。在弹出窗口中，输入注释字段，该字段将用于提醒您该令牌的用途。</p><p id="1f62" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">“生命周期”将决定多少天后令牌将被自动吊销。请注意，如果未指定令牌寿命，令牌将无限期存在。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi op"><img src="../Images/6c3c0004fe7279cbbef7a5ee52d1c1e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zOCFD5RigD9J-eKrrTIphA.png"/></div></div></figure><p id="e5e6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点击“生成”按钮后，将生成一个令牌。</p><p id="9d7c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">* *重要提示</strong> **一旦点击“完成”按钮，您将无法取回令牌。因此，请确保您现在复制令牌并将其保存到一个安全的地方。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/8b5b0435831d52bfaf2f5139ec7de269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*TkMBrtvHOeBBZvw-6Z521w.png"/></div></figure><h1 id="1df2" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">PowerBI连接到Azure数据块</h1><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi or"><img src="../Images/35cda701784f73cb8390628077db0dc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3_3a52yzGwsvHv0_"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@isaacmsmith?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">艾萨克·史密斯</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="907e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们可以从PowerBI中的Databricks获取数据。</p><p id="55fa" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在PowerBI中，点击“获取数据”&gt;搜索“Spark”&gt;在列表中选择“Spark”&gt;点击“连接”按钮。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi gj"><img src="../Images/d9bf2d9d75ee5456c1bbf03b271df64e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s2f8e-DuS_XpjzwRW--L7Q.png"/></div></div></figure><p id="0291" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在弹出窗口中，将URL <code class="fe og oh oi mt b"><a class="ae jg" href="https://australiasoutheast.azuredatabricks.net:443/sql/protocolv1/o/***************/****-******-*******" rel="noopener ugc nofollow" target="_blank">https://australiasoutheast.azuredatabricks.net:443/sql/protocolv1/o/***************/****-******-*******</a></code>填入“服务器”文本字段。</p><p id="25c0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，选择“HTTP”作为协议。对于“数据连接模式”，我们选择“DirectQuery”。这是因为当我们在实践中需要Azure Databricks时，我们很可能会处理大型数据集，所以在这种情况下，将所有数据导入PowerBI并不是一个好主意。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi os"><img src="../Images/2dbca3276baf7207a2fc413c71833c1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nbWAOy6QjAp8VznfKF-hcQ.png"/></div></div></figure><p id="f798" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点击“OK”按钮后，我们将能够看到当前Azure Databricks集群中的所有表。如果集群中有很多表，我们可以在导航器中搜索这些表。然后，单击“Load”按钮将该表添加为数据源。当然，在实践中可以一次导入多个表。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ot"><img src="../Images/6aadf1a65f06fed6a7f85b4f511e1b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jSfmHoPkcHE0xssOYUh1EA.png"/></div></div></figure><p id="e54c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们可以从三角洲湖创建可视化。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ou"><img src="../Images/4321470f41daac785d32145da4ff4610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q-1qGIAmbwyLSy-Q7rTmIA.png"/></div></div></figure><h1 id="a180" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">摘要</h1><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ov"><img src="../Images/5cc515a3621d513ce4ac1bf9b242e5f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nUlNv7OFHkZQhNyQ"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@aaronburden?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Aaron Burden </a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="ec03" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文展示了如何从Microsoft PowerBI连接到Azure Databricks。最关键的步骤是从Azure Databricks获取<strong class="la jk"> Spark URL </strong>和<strong class="la jk">用户令牌</strong>。</p><p id="1fb5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">希望这篇文章可以帮助数据科学家/工程师直接从Azure Databricks创建可视化。</p><div class="is it gp gr iu ow"><a href="https://medium.com/@qiuyujx/membership" rel="noopener follow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd jk gy z fp pb fr fs pc fu fw ji bi translated">通过我的推荐链接加入Medium克里斯托弗·陶</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">medium.com</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk ja ow"/></div></div></a></div><p id="7d6b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你觉得我的文章有帮助，请考虑加入Medium会员来支持我和成千上万的其他作者！(点击上面的链接)</p></div></div>    
</body>
</html>