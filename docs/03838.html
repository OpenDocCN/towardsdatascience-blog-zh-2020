<html>
<head>
<title>How to Download an Image Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Python 下载图像</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-download-an-image-using-python-38a75cfa21c?source=collection_archive---------1-----------------------#2020-04-10">https://towardsdatascience.com/how-to-download-an-image-using-python-38a75cfa21c?source=collection_archive---------1-----------------------#2020-04-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d45d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用 Python 模块(如 request、urllib 和 wget)下载图像文件。</h2></div><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="kn ko l"/></div><p class="kp kq gj gh gi kr ks bd b be z dk translated">来源:<a class="ae kt" href="https://giphy.com/gifs/food-pizza-9Wh7TNThCgWti" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><p id="861f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最近，我在用一个<a class="ae kt" href="https://docs.oracle.com/cd/E23824_01/html/821-1454/wwrsov-3.html" rel="noopener ugc nofollow" target="_blank">远程系统</a>工作，需要下载一些我的代码最终会处理的图像。</p><p id="0995" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我可以在我的终端上使用<a class="ae kt" href="https://ubuntuforums.org/showthread.php?t=1942128" rel="noopener ugc nofollow" target="_blank"> curl 或者 wget </a>来下载文件。但是，我希望最终用户的整个过程是自动化的。</p><p id="3c99" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这让我想到了一个问题:</p><blockquote class="lq"><p id="3c24" class="lr ls it bd lt lu lv lw lx ly lz lp dk translated">如何使用 Python 下载图像？</p></blockquote><p id="eada" class="pw-post-body-paragraph ku kv it kw b kx ma ju kz la mb jx lc ld mc lf lg lh md lj lk ll me ln lo lp im bi translated">在本教程中，我将介绍几个可用于下载 Python 文件(特别是图像)的模块。涵盖的模块有:<a class="ae kt" href="https://2.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">请求</strong> </a>、<a class="ae kt" href="https://pypi.org/project/wget/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> wget </strong> </a>、<a class="ae kt" href="https://docs.python.org/3/library/urllib.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> urllib </strong> </a>。</p><blockquote class="lq"><p id="7e50" class="lr ls it bd lt lu lv lw lx ly lz lp dk translated">免责声明:不要下载或使用任何违反其版权条款的图像。</p></blockquote></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="0413" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">设置</h1><p id="abd4" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">本教程中使用的代码是在安装了<a class="ae kt" href="https://www.python.org/downloads/release/python-369/" rel="noopener ugc nofollow" target="_blank"> Python 3.6.9 </a>的 Ubuntu 系统上测试的。</p><p id="031f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我强烈推荐建立一个<a class="ae kt" href="https://realpython.com/python-virtual-environments-a-primer/" rel="noopener ugc nofollow" target="_blank">虚拟环境</a>，其中包含所有测试所需的库。这是你可以做到的。</p><pre class="ki kj kk kl gt nj nk nl nm aw nn bi"><span id="1249" class="no mn it nk b gy np nq l nr ns">$ virtualenv image_download<br/>$ source ./image_download/bin/activate<br/>$ pip3 install requests wget</span></pre><p id="b8ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将在教程中使用的图像位于<a class="ae kt" href="https://pixabay.com/photos/summer-vacation-dog-journey-4823612/" rel="noopener ugc nofollow" target="_blank">这里</a>。<strong class="kw iu">是</strong> <a class="ae kt" href="https://pixabay.com/service/license/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">免费用于商业用途，不需要任何归属</strong> </a> <strong class="kw iu">。</strong></p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/deea9e68dab16f15f67f0480136c93cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G0pnrpiSVN01EZCGXiHkYQ.jpeg"/></div></div><p class="kp kq gj gh gi kr ks bd b be z dk translated">图片来自<a class="ae kt" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4823612" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae kt" href="https://pixabay.com/users/seanwareing-8721416/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4823612" rel="noopener ugc nofollow" target="_blank">肖恩·韦林</a></p></figure><p id="cfc2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将用于下载的<strong class="kw iu">图像 URL </strong>将是:</p><pre class="ki kj kk kl gt nj nk nl nm aw nn bi"><span id="fdd0" class="no mn it nk b gy np nq l nr ns"><a class="ae kt" href="https://cdn.pixabay.com/photo/2020/02/06/09/39/summer-4823612_960_720.jpg" rel="noopener ugc nofollow" target="_blank">https://cdn.pixabay.com/photo/2020/02/06/09/39/summer-4823612_960_720.jpg</a></span></pre><blockquote class="lq"><p id="09d6" class="lr ls it bd lt lu oa ob oc od oe lp dk translated">我们将创建一个简短的脚本来从给定的 URL 下载图像。</p></blockquote><p id="a4e4" class="pw-post-body-paragraph ku kv it kw b kx ma ju kz la mb jx lc ld mc lf lg lh md lj lk ll me ln lo lp im bi translated">脚本将下载与脚本文件相邻的图像，并且<em class="of">可选地，保留原始文件名</em>。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="bd29" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">请求模块</h1><p id="587b" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated"><a class="ae kt" href="https://2.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">请求</strong> </a>是 Python 中一个整洁且用户友好的<strong class="kw iu"> HTTP 库</strong>。它使得发送 HTTP/1.1 请求变得非常简单。</p><p id="83b7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">这似乎是使用 Python 下载任何类型文件的最稳定和推荐的方法。</strong></p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="og ko l"/></div><p class="kp kq gj gh gi kr ks bd b be z dk translated">来源:<a class="ae kt" href="https://giphy.com/gifs/reactionseditor-yes-awesome-3ohzdIuqJoo8QdKlnW" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><p id="622f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是完整的代码。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div><p class="kp kq gj gh gi kr ks bd b be z dk translated">来源:作者</p></figure><p id="d0b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不要担心。让我们一行一行地分解它。</p><p id="f7a5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将从导入必要的模块开始，还将设置图像 URL。</p><pre class="ki kj kk kl gt nj nk nl nm aw nn bi"><span id="227e" class="no mn it nk b gy np nq l nr ns">import requests # to get image from the web<br/>import shutil # to save it locally</span><span id="8983" class="no mn it nk b gy oi nq l nr ns">image_url = "<a class="ae kt" href="https://cdn.pixabay.com/photo/2020/02/06/09/39/summer-4823612_960_720.jpg" rel="noopener ugc nofollow" target="_blank">https://cdn.pixabay.com/photo/2020/02/06/09/39/summer-4823612_960_720.jpg</a>"</span></pre><p id="6742" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们使用切片符号<strong class="kw iu">将文件名从图像链接</strong>中分离出来。我们使用正斜杠(<code class="fe oj ok ol nk b">/</code>)分割图像 URL，然后使用<code class="fe oj ok ol nk b">[-1]</code>分割最后一段。</p><pre class="ki kj kk kl gt nj nk nl nm aw nn bi"><span id="15f4" class="no mn it nk b gy np nq l nr ns">filename = image_url.split("/")[-1]</span></pre><p id="7aa7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">来自请求模块的<code class="fe oj ok ol nk b">get()</code>方法将用于检索图像。</p><pre class="ki kj kk kl gt nj nk nl nm aw nn bi"><span id="a125" class="no mn it nk b gy np nq l nr ns">r = requests.get(image_url, stream = True)</span></pre><blockquote class="om on oo"><p id="2c09" class="ku kv of kw b kx ky ju kz la lb jx lc op le lf lg oq li lj lk or lm ln lo lp im bi translated">使用<code class="fe oj ok ol nk b">stream = True</code>来保证没有中断。</p></blockquote><p id="06d5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们将以二进制写入模式在本地创建文件，并使用<code class="fe oj ok ol nk b">copyfileobj()</code>方法将我们的映像写入文件。</p><pre class="ki kj kk kl gt nj nk nl nm aw nn bi"><span id="3a1a" class="no mn it nk b gy np nq l nr ns"># Set decode_content value to True, otherwise the downloaded image file's size will be zero.<br/>r.raw.decode_content = True</span><span id="2613" class="no mn it nk b gy oi nq l nr ns"># Open a local file with wb ( write binary ) permission.<br/>with open(filename,'wb') as f:<br/>        shutil.copyfileobj(r.raw, f)</span></pre><p id="2207" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还可以使用<a class="ae kt" href="https://www.tutorialspoint.com/python_network_programming/python_request_status_codes.htm" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">请求的状态代码</strong> </a>添加某些条件来检查图像是否被成功检索。</p><p id="9596" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还可以在下载大文件或者大量文件时通过<a class="ae kt" rel="noopener" target="_blank" href="/a-complete-guide-to-using-progress-bars-in-python-aa7f4130cda8"> <strong class="kw iu">增加进度条</strong> </a>来进一步改进。<a class="ae kt" href="https://stackoverflow.com/questions/37573483/progress-bar-while-download-file-over-http-with-requests/37573701" rel="noopener ugc nofollow" target="_blank">这里的</a>就是一个很好的例子。</p><blockquote class="lq"><p id="9bd0" class="lr ls it bd lt lu lv lw lx ly lz lp dk translated"><strong class="ak"> Requests 是使用 Python 下载任何类型文件的最稳定和推荐的方法。</strong></p></blockquote></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="4393" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">Wget 模块</h1><p id="5aed" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">除了 python 请求模块，我们还可以使用<a class="ae kt" href="https://pypi.org/project/wget/#description" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> python wget 模块</strong> </a>进行下载。</p><p id="9257" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是 python 中相当于<a class="ae kt" href="https://www.gnu.org/software/wget/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> GNU wget </strong> </a>的。</p><p id="2501" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用起来相当简单。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div><p class="kp kq gj gh gi kr ks bd b be z dk translated">来源:作者</p></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="41b0" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">Urllib 模块</h1><p id="e249" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">通过你的程序访问网站的<strong class="kw iu">标准 Python 库</strong>是<a class="ae kt" href="https://docs.python.org/2/library/urllib.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> urllib </strong> </a>。请求模块也使用它。</p><p id="1596" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过 urllib，我们可以做多种事情:<strong class="kw iu">访问网站</strong>，<strong class="kw iu">下载数据</strong>，<strong class="kw iu">解析数据</strong>，<strong class="kw iu">发送 GET 和，POST 请求</strong>。</p><p id="a3e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以使用几行代码下载我们的图像:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><p id="b0c8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们使用了<a class="ae kt" href="https://docs.python.org/2/library/urllib.html#urllib.urlretrieve" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> urlretrieve </strong> </a>方法将所需的 web 资源复制到本地文件中。</p><p id="71c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">需要注意的是，在一些系统和很多网站上，上面的代码会导致一个错误:<a class="ae kt" href="https://www.howtogeek.com/357785/what-is-a-403-forbidden-error-and-how-can-i-fix-it/" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">HTTP Error:HTTP Error 403:Forbidden</strong></a>。</p><p id="dcb8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是因为很多网站不喜欢随机程序访问他们的数据。一些程序可以通过发送大量请求来攻击服务器。这将阻止服务器运行。</p><p id="4256" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是为什么这些网站可以:</p><ol class=""><li id="f6fa" class="os ot it kw b kx ky la lb ld ou lh ov ll ow lp ox oy oz pa bi translated">屏蔽你你会收到<a class="ae kt" href="https://www.howtogeek.com/357785/what-is-a-403-forbidden-error-and-how-can-i-fix-it/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> HTTP 错误 403 </strong> </a> <strong class="kw iu">。</strong></li><li id="ea5a" class="os ot it kw b kx pb la pc ld pd lh pe ll pf lp ox oy oz pa bi translated">向您发送不同的数据或空数据。</li></ol><p id="e01c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以通过修改<strong class="kw iu">用户代理</strong>来克服这个问题，这是一个随我们的请求一起发送的变量。默认情况下，这个变量告诉网站访问者是一个 python 程序。</p><p id="3921" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过修改这个变量，我们可以像普通用户在标准的 web 浏览器上访问网站一样。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><p id="469d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在这里阅读更多关于它的<a class="ae kt" href="https://pythonprogramming.net/urllib-tutorial-python-3/" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="3e6c" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">结论</h1><p id="b812" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated"><a class="ae kt" href="https://2.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">请求</strong> </a> <strong class="kw iu"> </strong>已经成为 Python 中事实上的下载东西的方式。</p><p id="2ce1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">甚至<a class="ae kt" href="https://docs.python.org/3/library/urllib.request.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> urllib 文档页面</strong> </a> <strong class="kw iu">都推荐请求</strong>更高级别的 HTTP 客户端接口。</p><p id="f766" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你想在你的程序中有更少的依赖项，你应该选择 urllib。它是标准库的一部分。所以，没必要下载。</p><p id="4aa4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">希望你觉得这个教程有用。</p><h1 id="2e78" class="mm mn it bd mo mp pg mr ms mt ph mv mw jz pi ka my kc pj kd na kf pk kg nc nd bi translated">重要链接</h1><ol class=""><li id="a6d4" class="os ot it kw b kx ne la nf ld pl lh pm ll pn lp ox oy oz pa bi translated"><a class="ae kt" href="https://stackoverflow.com/questions/3042757/downloading-a-picture-via-urllib-and-python" rel="noopener ugc nofollow" target="_blank"> StackOverflow —通过 Urllib 下载图像并请求</a></li><li id="b009" class="os ot it kw b kx pb la pc ld pd lh pe ll pf lp ox oy oz pa bi translated"><a class="ae kt" href="https://2.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank">请求库</a></li><li id="3848" class="os ot it kw b kx pb la pc ld pd lh pe ll pf lp ox oy oz pa bi translated"><a class="ae kt" href="https://pypi.org/project/wget/" rel="noopener ugc nofollow" target="_blank"> wget 库</a></li><li id="ba2f" class="os ot it kw b kx pb la pc ld pd lh pe ll pf lp ox oy oz pa bi translated"><a class="ae kt" href="https://docs.python.org/3/library/urllib.html" rel="noopener ugc nofollow" target="_blank"> urllib 库</a></li></ol></div></div>    
</body>
</html>