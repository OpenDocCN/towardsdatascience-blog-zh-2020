<html>
<head>
<title>JSON explained for Python users: Data Science Edition</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JSON为Python用户解释:数据科学版</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/json-explained-for-python-users-data-science-edition-18e9859944da?source=collection_archive---------18-----------------------#2020-06-23">https://towardsdatascience.com/json-explained-for-python-users-data-science-edition-18e9859944da?source=collection_archive---------18-----------------------#2020-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ae45" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用JSON数据是不可避免的——让我们正确地学习它。</h2></div><p id="822b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">JSON数据无处不在。它仍然不是数据科学家最广泛使用的数据格式，因为数据集存储在CSV或数据库中。今天，您将学习如何处理JSON，以及如何在您的数据科学项目中使用它。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/bfd8e73a69fb24ccd6992d6c1831a457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-uSvEBYCKvzVRbg_"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">安德斯·吉尔登在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="248e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="lv">但是JSON是什么？</em></p><p id="c64b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好问题。JSON代表“JavaScript对象表示法”，是一种简单且众所周知的数据格式。一旦你习惯了括号，人类很容易读写。此外，每一种主要的编程语言本身都支持它。</p><p id="a4c6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">JSON类型建立在两种数据结构之上:</p><ol class=""><li id="5796" class="lw lx it kk b kl km ko kp kr ly kv lz kz ma ld mb mc md me bi translated">对象—键/值对的集合</li><li id="5956" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mb mc md me bi translated">数组-值列表</li></ol><p id="46ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并且使用起来非常简单。</p><p id="4085" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一篇没有废话的文章，目标是尽快让你的手脏起来。我们一会儿将连接到一个实际的API，然后讨论基础知识。稍后您将看到我最喜欢的JSON功能，从数据科学的角度来看。</p><p id="71ea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们开始吧。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="3182" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">API连接</h1><p id="79d2" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">如果您还没有启动笔记本电脑环境，请启动它。我们现在将只使用<strong class="kk iu">请求</strong>库:</p><pre class="lf lg lh li gt no np nq nr aw ns bi"><span id="7eae" class="nt ms it np b gy nu nv l nw nx">import requests</span></pre><p id="c414" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们先来探索一下API。它可以在<a class="ae lu" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">此链接</a>上找到，包含一些用户的虚拟数据。完美满足我们的需求。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ny"><img src="../Images/1716e2449a605dd0b93af62061411447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BJSLGvFoIU3Dh_jmKqFe2g.png"/></div></div></figure><p id="aa94" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们把它装进去，好吗？这个过程很简单，就像Python中的大多数东西一样:</p><pre class="lf lg lh li gt no np nq nr aw ns bi"><span id="95e0" class="nt ms it np b gy nu nv l nw nx">req = requests.get(‘<a class="ae lu" href="https://jsonplaceholder.typicode.com/users'" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users'</a>)<br/>req</span><span id="8166" class="nt ms it np b gy nz nv l nw nx"><strong class="np iu">&gt;&gt;&gt; &lt;Response [200]&gt;</strong></span></pre><p id="c234" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个200状态代码意味着请求已经成功，我们已经准备好处理数据了。让我们将JSON数据存储到一个单独的变量中:</p><pre class="lf lg lh li gt no np nq nr aw ns bi"><span id="aca0" class="nt ms it np b gy nu nv l nw nx">users = req.json()<br/>users[0]</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oa"><img src="../Images/3a44d7ad40dbd06f76009e515a6ce2fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*JUMMswSrAM861EGyXXXRew.png"/></div></div></figure><p id="4644" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你看到这有多简单了吗？</p><p id="24e4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们来看看<strong class="kk iu">用户</strong>变量。我已经指出JSON是建立在两种结构上的——对象和数组——让我们看看这种说法是否成立:</p><pre class="lf lg lh li gt no np nq nr aw ns bi"><span id="52a1" class="nt ms it np b gy nu nv l nw nx">type(users)</span><span id="fba9" class="nt ms it np b gy nz nv l nw nx"><strong class="np iu">&gt;&gt;&gt; list</strong></span><span id="133b" class="nt ms it np b gy nz nv l nw nx">type(users[0])</span><span id="ec08" class="nt ms it np b gy nz nv l nw nx"><strong class="np iu">&gt;&gt;&gt; dict</strong></span></pre><p id="a07e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它成立——因为列表和数组是同义词(ish ),而字典可以被解释为对象。接下来将讨论保存和加载JSON数据。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="2c32" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">保存和加载数据</h1><p id="3915" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">我们可以使用纯Python功能来保存和读取JSON数据。以下是如何实现节约的方法:</p><pre class="lf lg lh li gt no np nq nr aw ns bi"><span id="e1af" class="nt ms it np b gy nu nv l nw nx">import json</span><span id="1816" class="nt ms it np b gy nz nv l nw nx">with open(‘json_write_test.json’, ‘w’) as f:<br/>    json.dump(users, f, indent=4)</span></pre><p id="429d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> indent </strong>参数是可选的，它表示单个选项卡应该有多大。非常类似于Python的4空格缩进语法。我们可以验证文件是否确实被保存了:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/fd5ac608e2594f60816313b665401a99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*2g57i4PyLEUMWmT6cUGuDw.png"/></div></figure><p id="fe46" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">读取过程非常相似——我们只需要从写模式切换到读模式，并使用<strong class="kk iu"> load() </strong>函数，而不是<strong class="kk iu"> dump() </strong>:</p><pre class="lf lg lh li gt no np nq nr aw ns bi"><span id="14cd" class="nt ms it np b gy nu nv l nw nx">with open(‘json_write_test.json’) as f:<br/>    data = json.load(f)</span></pre><p id="db26" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以再次验证该过程是成功的:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oc"><img src="../Images/88f67f496b1120b75d9e1025c1a350d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x0vmfRoTYhsR2b5Lgf9pag.png"/></div></div></figure><p id="80a2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这几乎涵盖了阅读和写作。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="3b73" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">使用JSON</h1><p id="1da7" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">这将是一个简短的部分。<em class="lv">为什么？</em>因为使用JSON就像使用Python字典一样。我来详细说明一下。</p><p id="13e2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">默认情况下，JSON数据不是Python字典的数组。但是当加载到Python中时，就变成了一次。因此，我们可以将JSON数据视为字典列表。</p><p id="b19d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">这里有一个例子:</strong>我们想打印每个用户的姓名和完整地址，不包括邮政编码。这很简单:</p><pre class="lf lg lh li gt no np nq nr aw ns bi"><span id="2da3" class="nt ms it np b gy nu nv l nw nx">for row in users:<br/>    print(f”Address of {row[‘name’]} is {row[‘address’][‘street’]} {row[‘address’][‘suite’]}, {row[‘address’][‘city’]}”)</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi od"><img src="../Images/4b1f6c8040926ece5b477aa27690791c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GwN6PFAMOIklsFA6kGqF6Q.png"/></div></div></figure><p id="8ff3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章看起来有点乱，但是只要把代码复制到你的笔记本上就可以了。你马上就会明白它的要点。这是你应该知道的。下一节将介绍我最喜欢的处理JSON的方式——数据科学方式。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="b20c" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">JSON扁平化</h1><p id="36f2" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">用像<em class="lv">熊猫</em>这样的库读取JSON数据有时会有问题。如果没有嵌套(对象中的对象)，那么一切都会好的。大多数真实世界的数据是嵌套的，我们需要以某种方式解决这个问题。</p><p id="2804" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是将我们的JSON数据加载到一个<em class="lv"> Pandas数据帧</em>时会发生的情况:</p><pre class="lf lg lh li gt no np nq nr aw ns bi"><span id="6f56" class="nt ms it np b gy nu nv l nw nx">pd_data = pd.DataFrame(data)<br/>pd_data.head()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/df1c5f22f641e61b808a57583af54b41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DxtDu9Gz17XAC9NH4dzyVA.png"/></div></div></figure><p id="477b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<strong class="kk iu">地址</strong>列之前看起来还不错，在那里地址本身被分成街道、套房、城市和邮政编码。同样适用于<strong class="kk iu">公司</strong>栏。</p><p id="9a3f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是我们如何解决这个问题呢？</p><p id="154f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">前段时间我使用定制库进行JSON扁平化，但是有几次它们并没有像宣传的那样工作。这就是我想出这个函数的原因，得到了堆栈溢出的一点帮助:</p><pre class="lf lg lh li gt no np nq nr aw ns bi"><span id="854e" class="nt ms it np b gy nu nv l nw nx">def flatten_json(json):<br/>    output = {}<br/> <br/>    def flatten(inpt, name=’’):<br/>        if type(inpt) is dict:<br/>            for elem in inpt:<br/>                flatten(inpt[elem], name + elem + ‘_’)<br/>        elif type(inpt) is list:<br/>            i = 0<br/>            for elem in inpt:<br/>                flatten(elem, name + str(i) + ‘_’)<br/>                i += 1<br/>        else:<br/>            output[name[:-1]] = inpt<br/> <br/>    flatten(json)<br/>    return output</span></pre><p id="8ff6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该函数几乎是不言自明的，必须应用于数据的每一行。如果您有一个100个JSON对象的数组，您不能只将函数应用于数组本身，而是要应用于数组的每个元素。方法如下:</p><pre class="lf lg lh li gt no np nq nr aw ns bi"><span id="b0ff" class="nt ms it np b gy nu nv l nw nx">flattened = [flatten_json(row) for row in data]</span></pre><p id="3fec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是现在数据的不同之处:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi of"><img src="../Images/a946a7260bce78e1f2d7ed9d9b27bc62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eGT5R_fgkRx9yN0FvgKpJg.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">原始和展平数据的第一条记录</p></figure><p id="42f1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意展平的数据中没有缩进，以及所有以前嵌套的元素现在都有前缀。</p><p id="2976" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">转换到Pandas数据帧的过程现在按预期工作:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi og"><img src="../Images/4c639276baea8722f2d1d4d8160e5f0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*im5NW9F-hNWLJRvmRwUX3g.png"/></div></div></figure><p id="7bf5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">今天到此为止。让我们在下一部分总结一下。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="750a" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">在你离开之前</h1><p id="1f1a" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">我使用过的大多数API都以JSON或XML的形式返回数据——这由您来选择。JSON要简单得多，至少在Python中是这样。</p><p id="632b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您还可以将JSON存储在数据库中:</p><ul class=""><li id="1648" class="lw lx it kk b kl km ko kp kr ly kv lz kz ma ld oh mc md me bi translated">SQL数据库的LOB格式</li><li id="c6dc" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld oh mc md me bi translated">NoSQL数据库的“原始”格式</li></ul><p id="5953" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但那是以后的事了。感谢您的阅读，希望对您有用。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="8acd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="lv">喜欢这篇文章吗？成为</em> <a class="ae lu" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="lv">中等会员</em> </a> <em class="lv">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="oi oj gp gr ok ol"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">medium.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz lo ol"/></div></div></a></div></div></div>    
</body>
</html>