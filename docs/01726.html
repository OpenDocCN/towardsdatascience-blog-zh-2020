<html>
<head>
<title>Combining DataFrames using Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pandas合并数据帧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/combining-dataframes-using-pandas-b9e2e83b9869?source=collection_archive---------13-----------------------#2020-02-17">https://towardsdatascience.com/combining-dataframes-using-pandas-b9e2e83b9869?source=collection_archive---------13-----------------------#2020-02-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="569d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于concat和merge函数的完整教程</h2></div><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/de0d1b35a5dd842930bab8fc37cd9b48.png" data-original-src="https://miro.medium.com/v2/format:webp/1*36Ov7LpuY-OgNILY-K6HXg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">照片由<a class="ae ku" href="https://unsplash.com/@pinewatt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">派恩瓦特</a>在<a class="ae ku" href="https://unsplash.com/s/photos/merge?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="4819" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">Pandas是一个高效且广泛使用的数据分析工具。Pandas的核心数据结构是<strong class="kx iu">D</strong><a class="ae ku" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank"><strong class="kx iu">ATA frame</strong></a>，它以表格的形式表示数据，带有标记的行和列。DataFrame有许多强大而灵活的功能和方法，可以简化和加快数据清理和分析过程。</p><p id="3195" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">注意:</strong>键入“DataFrame”可能不是正确的英语，但它在Pandas语法中作为DataFrame存在。因此，在这篇文章中，我将把它写成DataFrame，这样你就会习惯了。如果您将其键入为“dataframe”或“Dataframe ”,将会出现错误。</p><p id="8201" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">数据科学项目通常需要我们从不同的来源收集数据。因此，作为数据准备的一部分，我们可能需要组合数据框架。在这篇文章中，我将解释组合数据帧的不同方法。</p><p id="0031" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们首先创建两个数据帧:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/47585113044ba133e3083370c8d10308.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ic4gB2XeG1jm4ItrH1KqjQ.png"/></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/eb3aa1c193ca962c96f64dcceaae5bb1.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Z8dEcKlp5nda3fcgdZiF1w.png"/></div></figure><h1 id="9157" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">串联</h1><p id="3144" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">组合或连接数据帧的一种方法是<strong class="kx iu"> concat() </strong>函数。通过改变<strong class="kx iu">轴</strong>参数，它可用于沿行或列连接数据帧。axis参数的默认值为0，表示沿行组合。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/b288147e53f62c69adae8f7de1e9534c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*o9_JvL3dN--SBUbvBtPYig.png"/></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/d19ec23e0432aee233885860472ed35a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*qJG1HUXJLRaeFuq_RhUQew.png"/></div></figure><p id="4414" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">正如您在上面的第一张图中所看到的，保留了各个数据帧的索引。为了改变它并重新索引组合数据帧，<strong class="kx iu"> ignore_index </strong>参数设置为真。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/b80e6bb2d4bcafd3e27598608a82c2dc.png" data-original-src="https://miro.medium.com/v2/format:webp/1*2HTqMTkVIEo3cmoUtWRzAw.png"/></div></figure><p id="9d7a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">concat()函数的join </strong>参数决定如何组合数据帧。默认值为“outer ”,返回两个数据帧中的所有索引。如果选择了' inner '选项，则只返回具有共享索引的行。我将改变df2的索引，以便您可以看到“内部”和“外部”的区别。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/47ae4e420a34be09e84e9d57c558d3a3.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Ug3YsoxcV75G8osIbUkOJA.png"/></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/d9c054e8bc7483cf6312886aeef0887c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*1tE-W7qHjhGTVBM8-LM-mg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">join =“内部”vs join =“外部”</p></figure><p id="0757" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">Pandas还提供了标记数据帧的方法，以便我们知道哪个部分来自哪个数据帧。我们只是使用<strong class="kx iu">键</strong>参数按顺序传递组合数据帧列表。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/043e5e8ca493a0ea270e6f023a938c1c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*spZt1TH-7BBAuGMlBwpWUA.png"/></div></figure><p id="0920" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">它还使得方便地访问数据帧的不同部分变得更加容易:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/cfbfa406564c17715cab0b381f3a6784.png" data-original-src="https://miro.medium.com/v2/format:webp/1*y5AaFcFUS3NbYPqsk0qxIw.png"/></div></figure><p id="79ff" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">关于concat()函数的一个重要注意事项是，它制作了数据的副本。为了防止进行不必要的复印，需要将<strong class="kx iu">复印</strong>参数设置为假。默认值为True。</p><p id="7ab5" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu"> append() </strong>函数也用于组合数据帧。它可以被看作是concat()函数的一个特例(axis=0，join='outer ')，所以我不会详细讨论它，而只是给出一个例子来展示语法。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/c08b5058d982664f068183e7e6597b28.png" data-original-src="https://miro.medium.com/v2/format:webp/1*zVkPyGNjdZLO4llxFNkqhA.png"/></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/ea73f5f959683395247f0eb7a2a06b18.png" data-original-src="https://miro.medium.com/v2/format:webp/1*aUE5RFn4AD-2AyK5EQuXuw.png"/></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="52db" class="lr ls it bd lt lu mv lw lx ly mw ma mb jz mx ka md kc my kd mf kf mz kg mh mi bi translated">合并</h1><p id="70a6" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">组合数据帧的另一个广泛使用的函数是<strong class="kx iu"> merge() </strong>。Concat()函数只是将数据帧一个接一个地相加或并排相加。它更像是附加数据帧。Merge()根据共享列中的值组合数据帧。与concat()函数相比，Merge()函数提供了更多的灵活性。看到例子就更清楚了。</p><p id="ed2e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们先来看看初始数据帧:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/c7a4d902175e1514f232f1005f67378c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*jbeMBRlvJLCefZBmr9wo5w.png"/></div></figure><p id="4954" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">上的<strong class="kx iu">参数选择用于合并的列或索引级别。</strong></p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/5ff473403763edf167b39e721308ae49.png" data-original-src="https://miro.medium.com/v2/format:webp/1*hGjgHzNoBEjyPwvcCN3utg.png"/></div></figure><p id="1e3e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">列名不必相同。我们关注的是列中的值。假设两个数据帧在一个列中有共同的值，您希望使用该列来合并这些数据帧，但是列名不同。在这种情况下，可以使用<strong class="kx iu"> left_on </strong>和<strong class="kx iu"> right_on </strong>参数，而不是<strong class="kx iu"> on </strong>参数。为了显示差异，我将在df2中更改列名，然后使用merge:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/0030f814d66d3a0f891dcf3deebacd7c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*CBy95y_j3g9niNMuNCEung.png"/></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/466532c9a8ddac213794b5fe656c20f0.png" data-original-src="https://miro.medium.com/v2/format:webp/1*it89aA8TSXrgCKy-q4LMEA.png"/></div></figure><p id="4350" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">尽管column_a和new_column_a中的返回值是相同的，但由于具有不同的名称，合并的数据帧包括这两个列。</p><p id="c825" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您也可以将多个值传递给参数上的<strong class="kx iu">。返回的数据帧只包括在所有传递给</strong>参数上的<strong class="kx iu">的列中具有相同值的行。</strong></p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/c55e5b0b3591a0472000046bc4c4bbb8.png" data-original-src="https://miro.medium.com/v2/format:webp/1*eU5UDX1taxaAw0O3DhmYEg.png"/></div></figure><p id="83f7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">df1和df2是根据column_a中的公共值合并的，是时候介绍一下<strong class="kx iu">how</strong>merge()的参数了。顾名思义，表示你想怎么组合。how的可能值为“内部”、“外部”、“左侧”、“右侧”。</p><ul class=""><li id="3a3a" class="na nb it kx b ky kz lb lc le nc li nd lm ne lq nf ng nh ni bi translated">内部:只有在参数上的<strong class="kx iu">指定的列中具有相同值的行(<strong class="kx iu">如何</strong>参数的默认值)</strong></li><li id="77d0" class="na nb it kx b ky nj lb nk le nl li nm lm nn lq nf ng nh ni bi translated">外部:所有行</li><li id="8bb2" class="na nb it kx b ky nj lb nk le nl li nm lm nn lq nf ng nh ni bi translated">左侧:左侧数据帧中的所有行</li><li id="5f45" class="na nb it kx b ky nj lb nk le nl li nm lm nn lq nf ng nh ni bi translated">右侧:右侧数据帧中的所有行</li></ul><p id="4933" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">“如何”的概念在下图中更加清晰。如果您熟悉SQL，其逻辑与SQL连接相同。</p><p id="46f6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">下面的数字更清楚地代表了参数的概念。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/82955d808cdc182ed33f133d10632163.png" data-original-src="https://miro.medium.com/v2/format:webp/1*-VhlMvfz0xsRb-bwWUBW_Q.png"/></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/10388ac816edd7885599f85ea136a619.png" data-original-src="https://miro.medium.com/v2/format:webp/1*5WJGpUj9G7JdPM3us2vGiA.png"/></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/23fd91269e817b49809ce20477a5a700.png" data-original-src="https://miro.medium.com/v2/format:webp/1*NG5XDoYZVZWkzRrAQsL_gg.png"/></div></figure><p id="36dc" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">outer '，' left '和' right '选项包括不在其中一个数据帧中的数据。缺少的零件自动用<strong class="kx iu"> NaN </strong>值填充。NaN是熊猫缺失价值观的典型代表。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/eb3aa1c193ca962c96f64dcceaae5bb1.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Z8dEcKlp5nda3fcgdZiF1w.png"/></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/036dfe7ccd9b21ff86d621ca5aa9a059.png" data-original-src="https://miro.medium.com/v2/format:webp/1*HXyUcT0BHSl5g5SmRSmlLw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">如何= '内在'</p></figure><p id="853a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">how的默认值是“inner ”,因此您不必在函数中显式编写。“Inner”只返回column_a中具有公共值的行。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/4cb03dd966d5a67ad265383a8cb588a1.png" data-original-src="https://miro.medium.com/v2/format:webp/1*WlYgWWW5oATuKUJKVIhPeQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">如何= '外部'</p></figure><p id="1994" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当how参数选择' outer '时，合并的数据帧包括两个数据帧中column_a的所有值。但是，公共值(column_a = 1和column_a = 2)不会重复。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/4ea1919a6010cbb8b455c39815487ad3.png" data-original-src="https://miro.medium.com/v2/format:webp/1*1PqfLK7SvEYQKPQfajlskw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">怎么= '左'</p></figure><p id="eeb4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当how参数选择' left '时，合并数据帧包括左侧数据帧中所有行。如果column_a(传递给on参数的列)中的值不在右数据帧中，则右数据帧中的列将填充NaN值。很少使用“right”选项，因为您只能在merge函数中更改数据帧的顺序(而不是(df1，df2)使用(df2，df1))。</p><p id="2e5b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您可能已经注意到，两个数据帧中相同的列名会添加一个后缀。区分哪一列来自哪一个数据帧是很有用的。您可以使用<strong class="kx iu">后缀</strong>参数指定要添加的后缀。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/039794155f4c6f7daaec9b5cd03efbff.png" data-original-src="https://miro.medium.com/v2/format:webp/1*RmOfm_4e9oKpaCV5Or_aZw.png"/></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="c2fb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p><h1 id="5cc3" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">我的其他帖子</h1><ul class=""><li id="39e2" class="na nb it kx b ky mj lb mk le no li np lm nq lq nf ng nh ni bi translated"><a class="ae ku" rel="noopener" target="_blank" href="/naive-bayes-classifier-explained-50f9723571ed">朴素贝叶斯分类器——解释</a></li><li id="4972" class="na nb it kx b ky nj lb nk le nl li nm lm nn lq nf ng nh ni bi translated"><a class="ae ku" rel="noopener" target="_blank" href="/support-vector-machine-explained-8d75fe8738fd">支持向量机—解释</a></li><li id="67f5" class="na nb it kx b ky nj lb nk le nl li nm lm nn lq nf ng nh ni bi translated"><a class="ae ku" rel="noopener" target="_blank" href="/decision-tree-and-random-forest-explained-8d20ddabc9dd">决策树和随机森林——解释</a></li><li id="7de3" class="na nb it kx b ky nj lb nk le nl li nm lm nn lq nf ng nh ni bi translated"><a class="ae ku" rel="noopener" target="_blank" href="/gradient-boosted-decision-trees-explained-9259bd8205af">梯度增强决策树—解释</a></li><li id="670d" class="na nb it kx b ky nj lb nk le nl li nm lm nn lq nf ng nh ni bi translated"><a class="ae ku" rel="noopener" target="_blank" href="/handling-missing-values-with-pandas-b876bf6f008f">用熊猫处理缺失值</a></li><li id="666e" class="na nb it kx b ky nj lb nk le nl li nm lm nn lq nf ng nh ni bi translated"><a class="ae ku" rel="noopener" target="_blank" href="/predicting-used-car-prices-with-machine-learning-fea53811b1ab">用机器学习预测二手车价格</a></li><li id="8286" class="na nb it kx b ky nj lb nk le nl li nm lm nn lq nf ng nh ni bi translated"><a class="ae ku" rel="noopener" target="_blank" href="/data-cleaning-and-analysis-with-a-bonus-story-36b3ae39564c">数据清理和分析，附带奖励故事</a></li></ul></div></div>    
</body>
</html>