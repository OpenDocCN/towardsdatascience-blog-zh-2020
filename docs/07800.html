<html>
<head>
<title>Preparing Open Images Dataset for TensorFlow Object Detection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为 TensorFlow 对象检测准备开放图像数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/preparing-open-images-dataset-for-tensorflow-object-detection-c3da6e688eb5?source=collection_archive---------23-----------------------#2020-06-10">https://towardsdatascience.com/preparing-open-images-dataset-for-tensorflow-object-detection-c3da6e688eb5?source=collection_archive---------23-----------------------#2020-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6a7a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用开放图像创建张量流对象检测数据集的指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/76eefadb720ee3fda0876c6e7aa2e128.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TZCWfdsfcBIxMGtFphzzVg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://unsplash.com/@andrewtneel" rel="noopener ugc nofollow" target="_blank">安德鲁·尼尔</a>在<a class="ae kv" href="https://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><blockquote class="kw kx ky"><p id="10e4" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">数据是建立深度学习模型时要考虑的最强支柱之一。数据越精确，模型越有经验。为了训练深度学习模型，你需要大量的数据，你可能想要创建自己的数据，或者你可以使用互联网上的公共数据集，如<a class="ae kv" href="http://cocodataset.org" rel="noopener ugc nofollow" target="_blank">可可女士</a>、<a class="ae kv" href="http://www.image-net.org" rel="noopener ugc nofollow" target="_blank"> ImageNet </a>、<a class="ae kv" href="https://storage.googleapis.com/openimages/web/index.html" rel="noopener ugc nofollow" target="_blank">开放图像</a>等。</p></blockquote><p id="9c92" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">有时，这些数据集遵循不同的格式，而您想要定型的模型遵循另一种格式。当数据非常大时，使数据可供模型使用变得很麻烦。这是我在创建自己的物体探测器时偶然打开的。</p><p id="bee2" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">目标检测是计算机视觉的一个分支，它可以定位图像中的特定目标。我使用了<a class="ae kv" href="https://github.com/tensorflow/models/tree/master/research/object_detection" rel="noopener ugc nofollow" target="_blank"> Tensorflow 对象检测 API </a>来创建我的自定义对象检测器。为了创建我的探测器，我从<a class="ae kv" href="https://storage.googleapis.com/openimages/web/download_v4.html" rel="noopener ugc nofollow" target="_blank">开放图像 V4 数据集创建了我的数据。</a>数据集包含 600 个类和总共约 170 万幅图像，分为训练集、验证集和测试集。它已经更新到 V6，但我决定用 V4，因为有两个工具我们很快就会看到。</p><blockquote class="kw kx ky"><p id="7334" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">为了训练一个 Tensorflow 物体检测模型，你需要创建</strong><a class="ae kv" href="https://www.tensorflow.org/api_guides/python/python_io#tfrecords_format_details" rel="noopener ugc nofollow" target="_blank"><strong class="lc ir">TF records</strong></a><strong class="lc ir">，它使用了以下:</strong></p><p id="ea84" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir"> 1。图像</strong></p><p id="4e3a" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir"> 2。图像注释</strong></p></blockquote><p id="7295" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">“打开图像”既有图像，也有它们的注释。但是，所有的注释都放在一个文件中，当您需要特定类的数据时，这个文件会变得很笨拙。为了处理这个问题，我决定将数据转换成 PASCAL VOC 格式。现在，你可能会问什么是 PASCAL VOC？简而言之，PASCAL VOC 格式为每个图像创建一个 XML 文件，该文件包含图像中每个对象的边界框的坐标。很有条理，对吧？<a class="ae kv" rel="noopener" target="_blank" href="/coco-data-format-for-object-detection-a4c5eaf518c5#:~:text=Pascal%20VOC%20is%20an%20XML,for%20training%2C%20testing%20and%20validation.">如果你想了解更多关于 PASCAL VOC 的知识，这里的</a>是一个很棒的参考。</p><p id="2be0" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">现在说得够多了，让我们看看实际情况吧！</p><p id="0aa3" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">但是但是但是！在我们开始之前，你可能想和我一起走，所以这是我的 github 回购的<a class="ae kv" href="https://github.com/horizons-ml/OIDv4_annotation_tool/blob/master/OIDv4_Dataset_Download_Processing.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>。我们开始吧！</p><blockquote class="kw kx ky"><p id="355f" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我建议使用 google colab，因为这些工具可能需要的一些文件很大，可能对未来的用例没有用处。</p></blockquote><ol class=""><li id="d769" class="lz ma iq lc b ld le lg lh lw mb lx mc ly md lv me mf mg mh bi translated">这个<a class="ae kv" href="https://github.com/EscVM/OIDv4_ToolKi" rel="noopener ugc nofollow" target="_blank">工具</a>让我们可以下载特定类别和特定数量的图像。通过克隆 repo 下载该工具。</li><li id="3057" class="lz ma iq lc b ld mi lg mj lw mk lx ml ly mm lv me mf mg mh bi translated">下载完成后，您会发现一个<em class="lb"> classes.txt </em>文件。这里您需要提到您想要收集其数据的类名。你可以在这里找到课程列表<a class="ae kv" href="https://storage.googleapis.com/openimages/2018_04/bbox_labels_600_hierarchy_visualizer/circle.html" rel="noopener ugc nofollow" target="_blank">。例如，我将采取类'手机'和 98 个图像相同。</a></li><li id="26f8" class="lz ma iq lc b ld mi lg mj lw mk lx ml ly mm lv me mf mg mh bi translated">粘贴以下代码:</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mn mo l"/></div></figure><blockquote class="kw kx ky"><p id="909a" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">当您第一次运行脚本时，该工具可能会要求您下载一些文件，允许它。下面是提示符的样子</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/514000339d0f6c8bb1c0c44ed5a362c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g9Y32PqEv3gPcc1255901Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">开放图像数据集工具包的屏幕截图</p></figure><p id="652d" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">该工具为每个分割创建目录，并为这些目录中的每个类创建子目录。</p><p id="7c89" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">4.现在，让我们使用以下脚本来看看每个类的文件数量:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/2594887107a4fa92fd73d3e291362b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*r8p2vXt9AH3D-bne1JWM_g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输出以查看手机目录中的文件</p></figure><p id="a2c4" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">嗯（表示踌躇等）..但是我提到了 98 张图片，对吧？它会创建一个名为“Label”的文件夹，其中包含每个图像的注释。</p><p id="1c87" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">让我们看看文件夹“标签”包含什么:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/953c34d8e70afde57d73fd9c2f3f6b26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*yyZFD9prr40Dnqlwk5NG3A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">标签目录中的内容</p></figure><p id="9f17" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">我们为每个图像获取一个注释文件。但是，我们说完了吗？没有。注释不符合 PASCAL VOC 格式。因此，我们需要另一种工具，可以将这些注释转换成所需的格式。</p><p id="5bb4" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">这个工具为我们做最后的工作。克隆它。我稍微修改了这个工具，让名字中有一个以上单词的类可以在我的报告中找到<a class="ae kv" href="https://github.com/horizons-ml/OIDv4_annotation_tool/blob/master/OIDv4_to_VOC.py" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="ecdd" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">完成后，运行以下命令来转换注释文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="889f" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">这里，<em class="lb"> sourcepath </em>是每个类的“标签”文件夹的位置，<em class="lb"> dest_path </em>是存储 XML 注释的位置。</p><p id="c425" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">一旦创建了 XML 注释，我们就不再需要 txt 注释了。让我们删除它们:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="a29e" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">这将删除所有类别目录中名为“Label”的所有文件夹。</p><p id="1bce" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">现在您已经有了过滤后的数据集！😀</p><blockquote class="kw kx ky"><p id="3da1" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">提示</strong>:一旦数据集准备好，使用<a class="ae kv" href="https://github.com/tzutalin/labelImg" rel="noopener ugc nofollow" target="_blank"> labelImg </a>验证注释。对象有时可能被错误地注释。</p></blockquote><p id="ca4e" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">就是这样，伙计们！感谢您的阅读😊</p></div></div>    
</body>
</html>