<html>
<head>
<title>HTTP Requests in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中的 HTTP 请求</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/http-requests-in-python-f19c08250079?source=collection_archive---------40-----------------------#2020-04-13">https://towardsdatascience.com/http-requests-in-python-f19c08250079?source=collection_archive---------40-----------------------#2020-04-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2800" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">请求库简介</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/14cb9812e8e58b68bb75208d75d1eac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SGWofvj3QwPkWw3QBgupLg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pexels.com/photo/grayscale-photo-of-computer-laptop-near-white-notebook-and-ceramic-mug-on-table-169573/" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="26df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">python 请求库简化了 HTTP 请求任务，例如从网站获取信息、发布信息、下载图像、跟踪重定向等等。在本帖中，我们将讨论 python 请求库的基础知识。</p><p id="96e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><p id="1aae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们确保安装了请求库。在命令行中键入:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a9bb" class="ma mb it lw b gy mc md l me mf">pip install requests</span></pre><p id="d910" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在 python 脚本中导入请求库:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f702" class="ma mb it lw b gy mc md l me mf">import requests</span></pre><p id="1859" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将从图片分享和托管网站 imgur.com<a class="ae ky" href="https://imgur.com/" rel="noopener ugc nofollow" target="_blank">获取内容:</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/79ab3aa42872deb9159b30e600dd8142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_LKk_-y9zMBNkMfkSNcFA.png"/></div></div></figure><p id="0a65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了指定我们的请求，我们将包含 url 的字符串传递给“get()”方法:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9363" class="ma mb it lw b gy mc md l me mf">r = requests.get('https://imgur.com/')</span></pre><p id="b16b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了检查请求的响应状态，我们可以打印响应对象:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f37a" class="ma mb it lw b gy mc md l me mf">print(r)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/25c9c90e5183af1a3ce3f562d40cc968.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*C98hb2ovUYDYjXbJCYmQCw.png"/></div></figure><p id="a03b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">响应代码 200 对应于成功的请求。我们可以使用“dir()”看到 python 中对象可用的所有方法和属性。让我们将“dir()”应用于我们的响应对象:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7902" class="ma mb it lw b gy mc md l me mf">print(dir(r))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/eaf98f181c89e007a2b91732bf619dd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nf6X5IXxhV4-qyr7__gjpw.png"/></div></div></figure><p id="ada7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到我们有标题、json、链接、ok 状态、状态代码等等。要更详细地解释对象的属性和方法，我们可以将“help()”方法应用于我们的对象:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4567" class="ma mb it lw b gy mc md l me mf">print(help(r))</span></pre><p id="f670" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看“文本”属性的详细信息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/d940fb889fd37dc7a03d4d1af69ae579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gNsL5nicsrZq2ZcvRnebkg.png"/></div></div></figure><p id="432e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用“text”属性打印响应对象的文本:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5632" class="ma mb it lw b gy mc md l me mf">print(r.text)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/9a0227e037432c211b7a7a8e9069eb26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H25QfvSehJYldk1BWJo_9g.png"/></div></div></figure><p id="9042" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们会在浏览器中看到之前查看的页面的 html 内容。我们可以用“BeautifulSoup”这样的工具进一步解析这个 html 文本。关于 BeautifulSoup 的介绍，请查看<a class="ae ky" rel="noopener" target="_blank" href="/introduction-to-web-scraping-with-beautifulsoup-e87a06c2b857"><em class="ml">beautiful soup</em></a><em class="ml">的网页抓取介绍。</em></p><p id="5866" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们从“imgur”网站提取一张图片。让我们导航到该网站:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/79ab3aa42872deb9159b30e600dd8142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_LKk_-y9zMBNkMfkSNcFA.png"/></div></div></figure><p id="b109" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们单击左下角有电源插座的树的图像:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/fce6c697ae53c6edb2a8f94e6a4e97e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNX9oJ91--55yQg3OdYIdw.png"/></div></div></figure><p id="6615" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">右键单击图像，然后单击“检查”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/51fc1ceec6e9be03cbb92d018e8dbbcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Z5juV0u8U6rnVRqhOL-lw.png"/></div></div></figure><p id="654c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，导航到突出显示的链接“<a class="ae ky" href="https://i.imgur.com/1A7VXBR.jpg" rel="noopener ugc nofollow" target="_blank">https://i.imgur.com/1A7VXBR.jpg</a>”。您应该会看到该链接将您导向一个只有图像的页面。我们可以使用请求和“contents”属性从“imgur”中提取该图像。让我们用一个到图像的链接重新定义我们的请求对象，并打印内容:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f247" class="ma mb it lw b gy mc md l me mf">r = requests.get('<a class="ae ky" href="https://i.imgur.com/1A7VXBR.jpg" rel="noopener ugc nofollow" target="_blank">https://i.imgur.com/1A7VXBR.jpg</a>')<br/>print(r.content)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/23811e7a2dd93776e4cb66b3dfe60fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yh_-qiztMQiP537Ykh5a6g.png"/></div></div></figure><p id="087a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们回顾一下响应对象的帮助输出，我们会看到 contents 属性是以字节为单位的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/1376764ba80f87e8f7afebc1ad3c0fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*Xbnwhg1SohSYwFdxbn89zw.png"/></div></div></figure><p id="054f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以从图像中提取字节并保存到我们的机器上。我们将在“写入字节(wb)”模式下打开一个名为“tree.png”的文件，并将内容写入该文件:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1fea" class="ma mb it lw b gy mc md l me mf">with open('tree.png', 'wb') as f:<br/>    f.write(r.content)</span></pre><p id="344e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们打开包含 python 脚本的文件夹，我们应该会看到一个名为“tree.png”的文件，其中包含我们选择的图像。我就讲到这里，但是我鼓励你自己去研究代码。请随意使用本文中的代码尝试从其他站点获取文本和图像。</p><h1 id="cde4" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">结论</h1><p id="7bc6" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">总之，在这篇文章中，我们讨论了 python 请求库的基础。我们看一下响应对象可用的属性和方法。我们使用 text 属性来提取“imgur”主页的 html 文本。我们还展示了如何从“imgur”网站上提取一幅图像，并将其保存到我们机器上的一个文件中。我希望你觉得这篇文章有用/有趣。这篇文章中的代码可以在<a class="ae ky" href="https://github.com/spierre91/medium_code/blob/master/requessts_library/request_library_basics.py" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。感谢您的阅读！</p></div></div>    
</body>
</html>