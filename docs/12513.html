<html>
<head>
<title>Stock Market Lamp Real-Time Tracker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">股市灯实时跟踪器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stock-market-lamp-real-time-tracker-b2d0562a71c3?source=collection_archive---------37-----------------------#2020-08-28">https://towardsdatascience.com/stock-market-lamp-real-time-tracker-b2d0562a71c3?source=collection_archive---------37-----------------------#2020-08-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e709f64ba0f721038ded11eb0d014b32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OxMO3YrRe2LcVzltO1tm1g.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="684f" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">如何使用 Python 实时跟踪自己的投资组合</h2></div><p id="3b09" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">不用说，在这个疫情，股票市场一直不稳定。由于我们大多数人都被困在家里，我决定建造一个很酷的彩灯来实时反映我的股票市场投资组合。这样，当股票市场开盘时，我的灯会打开，它的颜色会反映我的开仓头寸，并在一天内更新。这是一个很酷的小工具，我还没有看到购买，所以为什么不建立自己的。我不喜欢日内交易，因为很多原因，我坚信大多数人不应该日内交易。因此，灯与其说是焦虑的制造者，不如说是一个有趣的配件。</p><h2 id="7a89" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">材料清单</h2><p id="2b7c" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">这里是你需要建立你的股市灯实时追踪器。如果你已经拥有一个彩色灯泡，你可以检查是否有一个库或 API 来通过 http 发送命令。在这种情况下，我们使用一个 Yeelight，它有一个 Python 库。</p><p id="e9bf" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">黄色灯泡</p><ul class=""><li id="e84d" class="mn mo je kv b kw kx kz la lc mp lg mq lk mr lo ms mt mu mv bi translated"><a class="ae mw" href="https://www.amazon.com/gp/product/B077GCYCT7/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1" rel="noopener ugc nofollow" target="_blank">https://www . Amazon . com/gp/product/b 077 gcyct 7/ref = ppx _ yo _ dt _ b _ search _ asin _ title？ie=UTF8 &amp; psc=1 </a></li></ul><p id="2351" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">灯泡球</p><ul class=""><li id="df38" class="mn mo je kv b kw kx kz la lc mp lg mq lk mr lo ms mt mu mv bi translated"><a class="ae mw" href="https://www.homedepot.com/p/Westinghouse-6-in-Handblown-Opal-Globe-with-3-1-4-in-Fitter-8150100/203066058" rel="noopener ugc nofollow" target="_blank">https://www . home depot . com/p/Westinghouse-6-in-handlown-Opal-Globe-with-3-1-4-in-Fitter-8150100/203066058</a></li><li id="014e" class="mn mo je kv b kw mx kz my lc mz lg na lk nb lo ms mt mu mv bi translated"><a class="ae mw" href="https://www.homedepot.com/p/Leviton-Plastic-Keyless-Lamp-Holder-R50-08829-CW4/100356849" rel="noopener ugc nofollow" target="_blank">https://www . home depot . com/p/Leviton-Plastic-Keyless-Lamp-Holder-R50-08829-CW4/100356849</a></li></ul><p id="c8e2" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">基本上，你会有一个 Wi-fi 智能灯和它的颜色变化从你的 Python 代码。地球仪是一个外壳，使它看起来很漂亮。</p><h2 id="6dd4" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">Python 代码灯泡控件</h2><p id="418c" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">创建新的 python 项目。安装我们将使用的两个主要库:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="e427" class="lp lq je nh b gy nl nm l nn no">pip install yeelight investpy</span></pre><p id="96cb" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">安装 yeelight 手机 app，配置灯泡。在应用程序中，打开局域网控制。在灯泡-&gt;设置(右上角图标)-&gt;设备信息中获取灯泡的 IP 地址。检查灯泡是否工作。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="4676" class="lp lq je nh b gy nl nm l nn no">from yeelight import Bulb, BulbException<br/>BULB_IP = <strong class="nh jf">'192.168.X.XXX'<br/></strong>bulb = Bulb(BULB_IP)<br/>bulb.get_properties(requested_properties=[<strong class="nh jf">'power'</strong>, ])</span></pre><h2 id="8326" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">Python 代码股票市场</h2><p id="d349" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">接下来，您可以创建一个函数来确定股票的 PnL</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="0804" class="lp lq je nh b gy nl nm l nn no">def daily_pnl(stock):<br/>    stock_data = investpy.get_stock_historical_data(stock, <strong class="nh jf">'united states'</strong>, from_date=(date.today() +<br/>        timedelta(days=-1)).strftime(<strong class="nh jf">"%d/%m/%Y"</strong>), to_date=date.today().strftime(<strong class="nh jf">"%d/%m/%Y"</strong>))<br/>    stock_data.index = stock_data.index + timedelta(days=1)<br/>    ytd = stock_data.iloc[0].Close<br/>    tdy = stock_data.iloc[1].Close<br/>    return ((tdy-ytd)/ytd)*100</span></pre><p id="cd58" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">简单地通过一只股票，如“AAPL”应该返回前一天的利润或损失。</p><p id="345a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">最后，你所要做的就是将 PnL 范围转换成 RGB 颜色。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="0c4f" class="lp lq je nh b gy nl nm l nn no">def refresh_bulb_color(bulb):<br/>    pnl_to_color = {-1.0: <strong class="nh jf">'#ff1100'</strong>,  <em class="np"># &lt;1%+ loss<br/>                    </em>-0.5: <strong class="nh jf">'#ff6a00'</strong>,<br/>                    0.0: <strong class="nh jf">'#ffffff'</strong>,  <em class="np"># neutral<br/>                    </em>0.5: <strong class="nh jf">'#8fb2ff'</strong>,<br/>                    1.0: <strong class="nh jf">'#0004ff'</strong>,}  <em class="np"># &gt;+0.5% gain<br/><br/>    </em>pnl = daily_pnl(<strong class="nh jf">'AAPL'</strong>)<br/>    print(<strong class="nh jf">"{:.2f}%"</strong>.format(pnl))<br/>    pnl_idx = np.searchsorted(list(pnl_to_color.keys()), pnl, <strong class="nh jf">'left'</strong>).clip(0,4)<br/>    color = list(pnl_to_color.values())[pnl_idx]<br/>    rgb = tuple(int(color.lstrip(<strong class="nh jf">'#'</strong>)[i:i+2], 16) for i in (0, 2, 4))<br/><br/>    try:<br/>        bulb.set_rgb(rgb[0], rgb[1], rgb[2])<br/>    except BulbException:<br/>        logging.error(<strong class="nh jf">'bulb disconnected'</strong>)<br/>        return False<br/><br/>    return True</span></pre><p id="ba8a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">创建无限循环并设置刷新间隔。你可以调整 PnL 函数来反映你自己的投资组合，而不是单一的股票。</p><p id="e702" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">就是这样！你有自己的实时彩灯跟踪器。</p></div></div>    
</body>
</html>