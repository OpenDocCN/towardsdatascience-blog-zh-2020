<html>
<head>
<title>The best of both worlds: Calling Auto ML from BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">两全其美:从BigQuery调用Auto ML</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-best-of-both-worlds-calling-auto-ml-from-bigquery-9dfd433a45d6?source=collection_archive---------55-----------------------#2020-06-18">https://towardsdatascience.com/the-best-of-both-worlds-calling-auto-ml-from-bigquery-9dfd433a45d6?source=collection_archive---------55-----------------------#2020-06-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="67d7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在SQL中进行预处理，然后使用自动ML表构建复杂的模型</h2></div><p id="f4d3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在在BigQuery ML中有了一个新的model_type。除了线性模型、DNN和提升树，我们现在可以直接从BigQuery SQL中使用big kahuna ( <a class="ae lb" href="https://cloud.google.com/automl-tables" rel="noopener ugc nofollow" target="_blank"> Auto ML Tables </a>)。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/878304197a18cfc0b307f2af75f124a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WO99tT9NUlS9JJF0RWqATA.jpeg"/></div></div></figure><h2 id="4179" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">培养</h2><p id="f176" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">这里的模型训练堆栈溢出标题和标签的模型，并预测帖子是否会有可接受的答案:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="9483" class="lo lp iq mn b gy mr ms l mt mu">CREATE OR REPLACE MODEL advdata.so_answered_automl<br/>OPTIONS(<strong class="mn ir">MODEL_TYPE = 'automl_classifier'</strong>, budget_hours=2.0, INPUT_LABEL_COLS=['answered'])<br/>AS</span><span id="a3b0" class="lo lp iq mn b gy mv ms l mt mu">SELECT<br/>  title, <br/>  REPLACE(tags, '|', ' ') AS tags,<br/>  IF(accepted_answer_id IS NULL, False, True) AS answered<br/>FROM `bigquery-public-data`.stackoverflow.posts_questions<br/>WHERE REGEXP_CONTAINS(tags, 'google')</span></pre><p id="f9e9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为Auto ML根据空格标记文本，所以我们在SQL中做了一些预处理，将|字符转换成空格，然后将数据传递给Auto ML。</p><h2 id="c75f" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">预言</h2><p id="7e36" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">两个小时后(注意预算时间:预算越高，模型越好，通常，尽管如果模型没有改进，Auto ML将缩短训练)，我们有了一个训练好的模型。</p><p id="8e70" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用该模型进行批量预测，就像它是一个原生的BigQuery ML模型一样:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="cd5d" class="lo lp iq mn b gy mr ms l mt mu">SELECT * FROM ML.PREDICT(MODEL advdata.so_answered_automl,(<br/>  SELECT 'How to reverse string in BigQuery' AS title, 'google-cloud-bigquery' AS tags<br/>  UNION ALL<br/>  SELECT 'Check long string contains term' AS title, 'google-cloud-storage' AS tags<br/>))</span></pre><p id="6fd1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果是:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mw"><img src="../Images/71aedb9ca7c99d31acc8fefb2307b2e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QWLl_LnWgjDtWh6W2Gs3Ww.png"/></div></div></figure><p id="7ce0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这似乎有道理。贴有正确产品标签的清晰问题比贴有错误产品标签的模糊句子更有可能得到回答。</p><h2 id="e293" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">为什么这这么棒</h2><p id="4cd7" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">这对Google Cloud上的通用ML工具包的补充是，我们现在可以利用SQL的能力来进行数据准备，然后将其交给Auto ML来进行神经架构搜索，以建立一个复杂的模型，甚至是一个包括自然语言处理的模型。</p><p id="d52f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们现在有了BigQuery提供的数据准备的便利性和Auto ML表提供的最佳模型准确性。当然，我们也获得了BigQuery提供的数据工程能力，比如调度查询和大规模批量预测。不喜欢什么？</p><p id="fdbd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尽情享受吧！</p></div></div>    
</body>
</html>