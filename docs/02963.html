<html>
<head>
<title>Choosing the right performance metrics can save lives against Covid-19</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">选择正确的性能指标可以挽救新冠肺炎的生命</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/choosing-the-right-performance-metrics-can-save-lives-against-coronavirus-2f27492f6638?source=collection_archive---------21-----------------------#2020-03-21">https://towardsdatascience.com/choosing-the-right-performance-metrics-can-save-lives-against-coronavirus-2f27492f6638?source=collection_archive---------21-----------------------#2020-03-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a167" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">评估深度学习模型的性能，以使用相关指标检测新冠肺炎</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/179953c4a963ccefc52a9abb9df2785b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/0*PUaEom6pKrlcRMyp.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">冠状病毒病例的地理分布显示，它几乎影响了所有国家</p></figure><p id="9500" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">最近宣布的疫情新冠肺炎震撼了世界上所有的医疗保健系统。它已经显示出<a class="ae ku" href="https://www.youtube.com/watch?v=Kas0tIxDvrg" rel="noopener ugc nofollow" target="_blank">的指数增长率</a>，并且已经传播到<a class="ae ku" href="https://www.worldometers.info/coronavirus/#countries" rel="noopener ugc nofollow" target="_blank"> 164 个国家</a>。每个国家都处于指数曲线的不同点，都在采取预防措施和实施降低增长率的政策。</p><p id="4c0a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">各国正在通过使用技术并在其基础设施中纳入大数据分析和实时监控来跟踪潜在的感染者和与他们有过互动的人，从而抗击疫情。这标志着这种技术首次被用于防止疫情病毒的传播。</p><p id="3686" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">虽然采取了这些预防措施，但病例数量仍在迅速增加。原因之一是测试套件不可用(或者使用了<a class="ae ku" href="https://www.washingtonpost.com/business/2020/03/16/cdc-who-coronavirus-tests/" rel="noopener ugc nofollow" target="_blank">有故障的测试套件</a>)。另一个原因是像意大利这样的国家缺少医疗专家，那里的病人流入量远远超过了他们的处理能力。为了克服这种情况，学者和研究人员正在研究使用深度学习来帮助专家诊断这种疾病。来自中国的一项研究显示了深度学习在 CT 扫描上的使用，“以便在病原测试之前提供临床诊断，从而为疾病控制节省关键时间”。与此同时，蒙特利尔大学的一名学者已经编译并开源了一个数据集，这样研究就可以实施并测试不同的算法(比如在这里的<a class="ae ku" rel="noopener" target="_blank" href="/using-deep-learning-to-detect-ncov-19-from-x-ray-images-1a89701d1acd">上完成的</a>)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lr"><img src="../Images/b8380be2b3255667574a559651fc09b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CjM6oSjlG3TtRHg4.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated"><a class="ae ku" href="https://radiopaedia.org/cases/covid-19-pneumonia-14" rel="noopener ugc nofollow" target="_blank">左</a>:新冠肺炎阳性 x 光片。<a class="ae ku" href="https://radiopaedia.org/cases/streptococcus-pneumon%20iae-pneumonia-temporal-evolution-1" rel="noopener ugc nofollow" target="_blank">右图</a>:链球菌感染。(两者都被授权为 CC-NC-SA)</p></figure><p id="aad2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">随着更多的数据变得可用，来自不同研究人员和机构的更健壮和准确的实现将变得可用。部署这样的系统可以减轻医生和医院面临的负担，特别是在亚洲和非洲的发展中国家。</p><p id="7410" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">根据所用数据的类型以及模型的<a class="ae ku" rel="noopener" target="_blank" href="/neural-networks-parameters-hyperparameters-and-optimization-strategies-3f0842fac0a5">参数和超参数</a>，这些系统将具有不同的精确度。大多数数据科学家和人工智能专家使用准确性作为标准衡量标准，来决定他们的模型有多有效，以及它与其他模型相比如何排名。他们力争<strong class="kx iu">最准确的型号</strong>，但在现实生活中，我们会想要<strong class="kx iu">最有用的型号</strong>。</p><p id="95ed" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">通过使用在特定阶段有用的指标，有多种方法来衡量模型的性能。为了解释它们，我将使用疾病在地理位置上的两个阶段(在这种情况下是新冠肺炎):当在一个地区发现感染并开始传播时，我们称之为<strong class="kx iu">感染出现</strong>和当病原体感染的人数超过该地区的治疗能力时，即<strong class="kx iu">感染饱和</strong>。但是在进入这些阶段之前，我想解释一下什么是混淆矩阵。混淆矩阵显示了实际标签与预测标签的组合计数。它有四个街区。让我们以狗和非狗的图像分类器为例。</p><ol class=""><li id="c490" class="lw lx it kx b ky kz lb lc le ly li lz lm ma lq mb mc md me bi translated">真阳性:有多少张狗的图片被模型标记为“狗”</li><li id="1bc7" class="lw lx it kx b ky mf lb mg le mh li mi lm mj lq mb mc md me bi translated">假阳性:有多少非狗的图像(如猫、树等)被模型标记为“狗”</li><li id="4454" class="lw lx it kx b ky mf lb mg le mh li mi lm mj lq mb mc md me bi translated">假阴性:有多少张狗的图片被模型标记为“非狗”</li><li id="0f4a" class="lw lx it kx b ky mf lb mg le mh li mi lm mj lq mb mc md me bi translated">真阴性:有多少张非狗图片被模特贴上了“非狗”的标签</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/41ac7f2383162dc1f0e580a556897104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/0*QPjxlrlK6qHLvxkp.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">混淆矩阵<a class="ae ku" href="https://medium.com/@awabmohammedomer/confusion-matrix-b504b8f8e1d1" rel="noopener">显示了数据集中实际标签的数量与你预测的数量的对比。</a></p></figure><p id="707f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们开始吧。</p><h1 id="0e4e" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">1.感染出现</h1><p id="ae30" class="pw-post-body-paragraph kv kw it kx b ky nd ju la lb ne jx ld le nf lg lh li ng lk ll lm nh lo lp lq im bi translated">让我们假设我们是深度学习专家，在一个出现了前 20 个案例的国家。我们有一个训练集，包括从全球收集的 400 个健康人的 CT 扫描和 100 个感染者的 CT 扫描。我们已经训练了两个模型，模型 A 和模型 B，它们都具有不同的架构。我们有一个 100 个 CT 扫描的测试集(70 个健康，30 个受感染),并对它们的预测制作一个混淆矩阵，以观察实际标签与预测的计数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi ni"><img src="../Images/7c5d2c94509119fe23660d1943328e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bm_A_rQTbhK2aZcH.jpeg"/></div></div></figure><p id="08fe" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">为了评估两个模型的性能，最常用的指标是<strong class="kx iu">准确性</strong>，它决定了模型正确预测的案例百分比，即它正确分配了多少标签。它的公式是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/65df491f33de62dc8db558b6bb9d1af1.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/0*0xZWwomvjt8R-97S.png"/></div></figure><p id="6081" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">模型 A 的准确度为<strong class="kx iu"> 80% </strong>，而模型 B 的准确度为<strong class="kx iu"> 76% </strong>。使用模型 A 进行诊断似乎是非常明显的。但模型 A 的问题是，在假阴性的情况下(即诊断受感染的患者为健康)，它宣布 18 名患者为健康并让他们出院，<strong class="kx iu">让感染传播得更快</strong>。模型 B 做得更好，它宣布 10 个被感染的病人是健康的，从而多诊断了 8 个病人。在这种情况下应该使用的指标是<strong class="kx iu">召回。</strong>据<a class="ae ku" href="https://en.wikipedia.org/wiki/Precision_and_recall" rel="noopener ugc nofollow" target="_blank">维基百科</a>:</p><blockquote class="nk"><p id="10ab" class="nl nm it bd nn no np nq nr ns nt lq dk translated"><em class="nu"> Recall(也称为 sensitivity)是实际检索到的相关实例总数的一部分。</em></p></blockquote><p id="9868" class="pw-post-body-paragraph kv kw it kx b ky nv ju la lb nw jx ld le nx lg lh li ny lk ll lm nz lo lp lq im bi translated">它的基本意思是，它衡量模型捕捉尽可能多的正面案例的能力。为了计算召回率，我们使用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/2773f68b63bed421d453f0b0bded2a25.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/0*Y4ySZ-DeAHbwPfTt.jpeg"/></div></figure><p id="6337" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">A 型召回 40%，B 型召回<strong class="kx iu"> 67%！</strong>这意味着我们应该使用模型 B，因为它可以正确诊断更多受感染的患者。</p><p id="076e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">关于模型及其召回，有一些事情需要注意:</p><ol class=""><li id="1a8f" class="lw lx it kx b ky kz lb lc le ly li lz lm ma lq mb mc md me bi translated">模型 B 预测 14 名健康患者被感染，模型 A 预测 2 名。这意味着你将会隔离 12 名健康的人。如果最终目标是减缓传播速度并且隔离资源可用，这可能是一个有效的选择。</li><li id="168c" class="lw lx it kx b ky mf lb mg le mh li mi lm mj lq mb mc md me bi translated">通过降低根据模型的预测概率决定标签的阈值，可以提高召回率。这也可能导致更多健康的人被隔离。同样，如果目标如前所述，那么这是一个有效的选择。</li></ol><h1 id="767c" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">2.感染饱和度:</h1><p id="1806" class="pw-post-body-paragraph kv kw it kx b ky nd ju la lb ne jx ld le nf lg lh li ng lk ll lm nh lo lp lq im bi translated">现在，让我们假设我们在一个传染病已经蔓延全国的国家。医院和隔离区已经接近满负荷。在这种情况下，你是否正确地诊断某人被感染并不重要，因为流入的病人太多了，难以处理。如何选择谁接受治疗是一个单独的话题。但是有一件事是有害的:将健康人诊断为感染者。当感染者没有机会接受治疗时，没有人会想把资源用在健康人身上。</p><p id="b900" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们使用模型 A 和模型 b 的混淆矩阵。为了强调影响，我将数字乘以 50:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi ob"><img src="../Images/e6171c6c016e633293fb2d3e4d557eac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cngmgNGl6EYmmEsd.jpeg"/></div></div></figure><p id="127a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">假设所有的医院都满负荷运转，只有一家医院能容纳 500 人。这些是模型 A 对模型 B 的预测，可以通过沿着预测轴将各个类别相加得到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/b91b69bb05c061fa9c4089f550255652.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/0*4mNhUuTlzhbmvuZj.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">模型 A 和模型 B 的每类预测数</p></figure><p id="e884" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">虽然模型 B 似乎更优越，但如果我们计算有多少预测实际上是正确的概率，我们会发现其他东西。我们来计算一下有多少结果实际上是正确的概率。对于模型 A，700 个病例中有 600 个实际被感染，也就是说，如果我们从这 700 个病例中随机选择 1 个人，他或她被感染的几率为 85.7%。相反，对于模型 B，如果我们随机选择一个人，他/她有<strong class="kx iu"> 58.8% </strong>的几率被感染。为了比较这种影响，我们将得到 420 名真正的 A 型患者和 290 名真正的 b 型患者。使用 A 型，<strong class="kx iu">将增加 130 名患者</strong>得到所需的治疗。这一指标被称为<strong class="kx iu">精度</strong>，它是实际案例占预测案例总数的百分比。根据<a class="ae ku" href="https://en.wikipedia.org/wiki/Precision_and_recall" rel="noopener ugc nofollow" target="_blank">维基百科</a>:</p><blockquote class="nk"><p id="2398" class="nl nm it bd nn no np nq nr ns nt lq dk translated"><em class="nu">精度(也称为正预测值)是检索实例中相关实例的分数。</em></p></blockquote><p id="7f50" class="pw-post-body-paragraph kv kw it kx b ky nv ju la lb nw jx ld le nx lg lh li ny lk ll lm nz lo lp lq im bi translated">使用以下公式计算:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/72ff215614904ad05d0ac59c449ab99d.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/0*TWPKRrus7U42aTL8.jpeg"/></div></figure><h1 id="08a1" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">真实世界场景</h1><p id="4808" class="pw-post-body-paragraph kv kw it kx b ky nd ju la lb ne jx ld le nf lg lh li ng lk ll lm nh lo lp lq im bi translated">疫情的饱和总会有一个起点(即浮现)。这是一条连续的指数曲线。因此，为了防止最终的危机，你会想要一种模型，它不仅能捕获尽可能多的病人，而且不会因为允许健康的人占据隔离区和医院病床而成为资源的负担。为了量化这样一个场景，需要一个能够结合精确度和召回率属性的度量。一个简单的平均值似乎是合适的，但是如果任何一个单独的指标较低，则没有惩罚。如果模型 1 的精度为 0，召回率为 100%，而模型 2 的精度和召回率都为 50%，则两个模型的平均值都为 50，这意味着它们的性能相似。有一个称为<strong class="kx iu"> F1 得分</strong>的指标，它将两者结合起来，如果其中一个指标较低，也会导致较低的值。它通过采用精度和召回的<em class="oe">调和平均值</em>来实现:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/d11dab184e1b2f404f41b58dfb15fe4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/0*8q1McI_QP4ufsP2Z.jpeg"/></div></figure><p id="14a0" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">因此，模型 1 的 F1 值为 0，而模型 2 的 F1 值为 25%</p><p id="9789" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们以模型 A 和模型 B 的混淆矩阵为例</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi ni"><img src="../Images/7ee312d87002fea7abad43003bf9380a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Cb-4ZyeMEzIvQn52.jpeg"/></div></div></figure><p id="ba62" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">两个模型的 F1-分数对于模型 A 是 27.3%，对于模型 B 是 31%。这可以通过模型 B 在识别受感染患者方面相对较好并且将健康人标记为受感染的比率也不太差的事实来观察。对于这两个任务，它比模型 A 更平衡。</p><p id="c6ac" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">还有一种 F1 分数的加权形式，称为 F-Beta</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/d27a9aca482db3020abdc26ebbbc3388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*GZPNzspkY84S01G0gEJPRQ.jpeg"/></div></figure><p id="f67b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果 0 &lt; beta &lt; 1, then more weightage is given to precision and if beta &gt; 1，则给予回忆更多的权重。</p><p id="f18c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">注意:上面讨论的度量标准有缺陷，因为它们都依赖于测试集的数量和分布。而且有<a class="ae ku" href="https://stats.stackexchange.com/questions/64862/how-to-get-confusion-matrix-with-100-precision-or-100-recall-in-weka" rel="noopener ugc nofollow" target="_blank">黑</a>才能 100%召回。但是，如果模型经过适当的训练，并且测试集中有大量的示例与真实世界的分布相匹配，那么这些度量是可以依赖的。</p><h1 id="6d2c" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">结论</h1><p id="de28" class="pw-post-body-paragraph kv kw it kx b ky nd ju la lb ne jx ld le nf lg lh li ng lk ll lm nh lo lp lq im bi translated">根据为不同情景计算的模型 A 和模型 B 的指标，最合理的方法是在紧急情况下使用模型 B，并随着越来越多的情况出现而倾向于模型 A。但是如果你因为某种原因只能使用一种模式，你可以把钱押在模式 b 上。</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><p id="a8b4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">[1]:王等。艾儿，<em class="oe"/><a class="ae ku" href="https://www.medrxiv.org/content/10.1101/2020.02.14.20023028v3" rel="noopener ugc nofollow" target="_blank"><em class="oe">一种深度学习算法利用 CT 图像来筛查冠状病毒疾病(新冠肺炎)</em></a><em class="oe"/></p><p id="d7b0" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">[2]: <a class="ae ku" href="https://github.com/ieee8023/covid-chestxray-dataset" rel="noopener ugc nofollow" target="_blank">新冠肺炎 CT 扫描数据集</a>由约瑟夫·保罗·寇恩收集。蒙特利尔大学 Mila 博士后研究员。</p><p id="e104" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu"> <em class="oe">编者注:</em> </strong> <em class="oe"> </em> <a class="ae ku" href="http://towardsdatascience.com/" rel="noopener" target="_blank"> <em class="oe">走向数据科学</em> </a> <em class="oe">是一份以数据科学和机器学习研究为主的中型刊物。我们不是健康专家或流行病学家，本文的观点不应被解释为专业建议。想了解更多关于疫情冠状病毒的信息，可以点击</em> <a class="ae ku" href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports" rel="noopener ugc nofollow" target="_blank"> <em class="oe">这里</em> </a> <em class="oe">。</em></p></div></div>    
</body>
</html>