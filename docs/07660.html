<html>
<head>
<title>Data Loss Prevention (DLP) for Slack Using Amazon Macie &amp; AppFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Amazon Macie和AppFlow为Slack提供数据丢失防护(DLP)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dlp-for-slack-using-amazon-macie-appflow-50990e2269e5?source=collection_archive---------57-----------------------#2020-06-08">https://towardsdatascience.com/dlp-for-slack-using-amazon-macie-appflow-50990e2269e5?source=collection_archive---------57-----------------------#2020-06-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="acea" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">AWS安全性</h2><div class=""/><div class=""><h2 id="a898" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Amazon Macie、AppFlow的Slack集成、CloudWatch事件来检测和通知Slack通道中的敏感数据泄漏</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/1d138cb47fd2bb587a2c790399d518af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LdFJdmHQHzc1Zb5h5c7zzg.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://www.pexels.com/@ferarcosn?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Fernando Arcos </a>从<a class="ae lh" href="https://www.pexels.com/photo/white-caution-cone-on-keyboard-211151/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>拍摄</p></figure><p id="c271" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">AWS最近宣布了一项名为亚马逊AppFlow的新服务。Amazon AppFlow允许我们集成和自动化各种软件即服务(SaaS)应用程序和AWS服务之间的数据流。</p><p id="6cfa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这可以在许多方面改变游戏规则，并可以开辟许多新的可能性和有趣的用例。Amazon AppFlow可以支持从SaaS应用程序到AWS以及从受支持的AWS服务到SaaS应用程序的数据流。在SaaS应用程序已经与<a class="ae lh" href="https://aws.amazon.com/privatelink/" rel="noopener ugc nofollow" target="_blank"> AWS PrivateLink </a>集成的情况下，数据流也可以以安全的方式发生。</p><blockquote class="me"><p id="9d01" class="mf mg it bd mh mi mj mk ml mm mn md dk translated">让我们考虑一个有趣的数据泄漏场景</p></blockquote><p id="2987" class="pw-post-body-paragraph li lj it lk b ll mo kd ln lo mp kg lq lr mq lt lu lv mr lx ly lz ms mb mc md im bi translated">如今，许多企业使用Slack这样的交流平台进行更好的协作，甚至使用ChatOps。我在这个场景中选择了Slack，因为在我写这篇文章的时候，它是Amazon AppFlow中唯一支持的通信平台。</p><h2 id="4acc" class="mt mu it bd mv mw mx dn my mz na dp nb lr nc nd ne lv nf ng nh lz ni nj nk iz bi translated">方案</h2><p id="4207" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">DevOps团队表示，Slack用户可能会错误地在Slack频道上发布敏感信息(PII、社会安全号码、信用卡号、访问密钥等等)。</p><p id="c417" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nq">作为一项企业指导方针，您可能希望实施相关政策，以阻止或至少通知用户在其他渠道/团队成员可以看到的空闲渠道上共享此类信息。</em></p><p id="bbef" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">给定场景，让我们看看如何使用AWS服务构建解决方案。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><blockquote class="me"><p id="eff0" class="mf mg it bd mh mi mj mk ml mm mn md dk translated">解决方案看起来怎么样？</p></blockquote><h1 id="7c35" class="ny mu it bd mv nz oa ob my oc od oe nb ki of kj ne kl og km nh ko oh kp nk oi bi translated">体系结构</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oj"><img src="../Images/1456b7f9e728ba4912aec40ce96679ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DPnhzL3FAYSQ1OJQGri82w.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">无服务器解决方案架构</p></figure><p id="a56f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">高级实施步骤—</p><blockquote class="ok ol om"><p id="2039" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated">将Amazon AppFlow与一个Slack通道集成为源。</p><p id="0918" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated">将对话数据上传到亚马逊S3。</p><p id="24d6" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated">使用Amazon Macie来发现和检测S3内容中的敏感数据。</p><p id="5f68" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated">使用Amazon Macie生成的Amazon CloudWatch事件采取适当的措施进行补救或通知。</p></blockquote></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><h1 id="0040" class="ny mu it bd mv nz oq ob my oc or oe nb ki os kj ne kl ot km nh ko ou kp nk oi bi translated">实施细节</h1><h2 id="6b0e" class="mt mu it bd mv mw mx dn my mz na dp nb lr nc nd ne lv nf ng nh lz ni nj nk iz bi translated">将Amazon AppFlow与一个Slack通道集成为源</h2><p id="5f85" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">作为此步骤的先决条件，您需要以下详细信息来从AppFlow连接到Slack。每当您尝试将AppFlow流连接配置为Slack时，都会看到此弹出窗口。如果需要建立新的连接，请参考下面的步骤3。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/4b568776d7419c91e7de678d7c9e7cae.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*rjqJjY_kYEpqbJ-IWKRv1Q.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:松弛连接细节</p></figure><blockquote class="me"><p id="7b65" class="mf mg it bd mh mi ow ox oy oz pa md dk translated">设置Amazon AppFlow</p></blockquote><blockquote class="ok ol om"><p id="6752" class="li lj nq lk b ll mo kd ln lo mp kg lq on mq lt lu oo mr lx ly op ms mb mc md im bi translated"><strong class="lk jd">步骤1:为亚马逊AppFlow创建一个S3桶</strong></p></blockquote><p id="006b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">创建一个S3桶，Amazon AppFlow将从Slack上传数据。此时不需要额外的配置。如果需要，请检查此链接—</p><div class="pb pc gp gr pd pe"><a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/create-bucket.html" rel="noopener  ugc nofollow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">我如何创建一个S3桶？</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">在将数据上传到亚马逊S3之前，您必须在其中一个AWS区域创建一个存储桶来存储您的数据。之后…</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><blockquote class="ok ol om"><p id="9d4e" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated"><strong class="lk jd">第二步:指定流程细节</strong></p></blockquote><p id="577c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">提供流名称、描述、加密和可选标记。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pn"><img src="../Images/1b050d72ccf24f39757fc5df3de4631f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nIhX0RvP-IhpebjTwIHZgw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:流量详情</p></figure><p id="8758" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意，Amazon Macie在加密数据发现方面有一定的限制。正如您将看到的，我们将为Amazon Macie使用<code class="fe po pp pq pr b">AWSServiceRoleForAmazonMacie</code>服务关联角色，我们将不得不使用自定义的AWS KMS客户管理密钥(CMK)，如下面的截图“图片:数据加密”所示。如果您还没有可以使用的AWS KMS键，请创建一个。</p><p id="e96a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:我必须获得这个配置部分以及KMS密钥权限(在下面的后面部分讨论),并且还要经过AWS的验证，因为这些信息并不容易获得。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ps"><img src="../Images/27167f0f55280a4b083cfa24e70fa62f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7jkOYDEMwOlqNJPOxLJTYg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:数据加密</p></figure><p id="a7e2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有关亚马逊Macie的加密/解密相关细节，请参考此链接—</p><div class="pb pc gp gr pd pe"><a href="https://docs.aws.amazon.com/macie/latest/user/discovery-supported-encryption-types.html" rel="noopener  ugc nofollow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">用Amazon Macie分析加密的S3对象</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">如果一个对象存储在亚马逊S3存储桶中并且是加密的，亚马逊Macie可能无法分析其中的数据…</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><blockquote class="ok ol om"><p id="9a8d" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated"><strong class="lk jd">第三步:配置流量</strong></p></blockquote><p id="7287" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里需要创建一个新的松弛连接。遵循此链接中仔细提供的说明——</p><div class="pb pc gp gr pd pe"><a href="https://docs.aws.amazon.com/appflow/latest/userguide/requirements.html#slack" rel="noopener  ugc nofollow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">亚马逊AppFlow的要求</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">在使用Amazon AppFlow创建流之前，请确认您拥有关于源和…的所需信息</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="bbb4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦创建了连接，就配置您想要监视的Slack通道。目前，不可能在同一个流中选择多个通道。因此，如果您想要监视多个通道，您必须配置多个流。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pt"><img src="../Images/13f7b3be53c68afd0fe7719f26defc6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZrHDno7tzjM0uJBY5eOP6A.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:配置流量</p></figure><p id="4d49" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">配置Amazon AppFlow将在其中上传松弛渠道对话数据的目标S3存储桶。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pu"><img src="../Images/1b5a55661a7ad67419666d34ed8fd53a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xCmjhpaVcPmCiM7T5-tmwA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:目的地详情</p></figure><p id="b6b6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">可以根据需要安排流触发。松弛集成不支持“事件时运行流”触发器。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pv"><img src="../Images/e180effb4ed9b23f674c441dd496df10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lDTZnp0ehL6Bo-7so6Vjyg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:流量触发器</p></figure><blockquote class="ok ol om"><p id="070c" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated"><strong class="lk jd">步骤4:创建源和目标数据字段之间的映射</strong></p></blockquote><p id="65d7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在此步骤中，您可以选择需要映射到目标字段的源字段。在本例中，我已经映射了所有字段。您可以只选择几个您需要的，它允许您做一些数据修改，以及像屏蔽字段。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pw"><img src="../Images/145bcabf028d223afe893caaf9f1b99c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_i-jCqITUiDCLx2VL6o7aQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:数据映射</p></figure><p id="876c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我没有添加任何验证或过滤器。继续做你喜欢的实验。</p><p id="7ae6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，创造流动。</p><p id="44eb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">创建完成后，在Slack通道中提交一些消息，看看AppFlow是否成功地将数据上传到S3。测试数据应该是Amazon Macie能够正确检测的有效格式。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi px"><img src="../Images/39619097887418f38fd394f17b1d0658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*biDEKfXiQ6FFei1Ra5M57A.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">仅测试数据！😄</p></figure><p id="f47a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦流量开始触发，您可以看到如下运行历史。现在忽略0 KB的大小。当流处理非空数据时，它将显示正确的大小。</p><p id="c06a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nq">注意,“错误”记录不提供任何故障排除选项。没有可供浏览的链接，没有CloudWatch日志，只是一个黑洞。在AWS在未来的版本中提供一种方法之前，您只能靠自己找出问题所在！我现在已经提交了一个功能请求。如果您找到了进一步排除故障的方法，请与我们分享。</em></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi py"><img src="../Images/40082932c1de982b5bba6d6fc5c583c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hfMqbdQ-9ALtVoAn9yYtfQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:跑步记录</p></figure><h2 id="f399" class="mt mu it bd mv mw mx dn my mz na dp nb lr nc nd ne lv nf ng nh lz ni nj nk iz bi translated">将对话数据上传到亚马逊S3</h2><p id="3469" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">如果流运行成功，它应该将数据上传到配置的S3存储桶。上传的对象存储在使用流名称创建的路径下。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/c95c427bed420ee9d622be582c392748.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*GHoaVINErFcuWSMT0oLxyg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:S3</p></figure><p id="bba0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">根据配置的数据映射，S3对象内容可能如下所示</p><pre class="ks kt ku kv gt qa pr qb qc aw qd bi"><span id="4953" class="mt mu it pr b gy qe qf l qg qh">{“client_msg_id”:”51c6e23c-abb2–4dc2–82e6–12ff9216af58",”text”:”aws_access_key AKIAJVCPCOZKBNJFRAXQ”,”ts”:”1591923645.001300",”type”:”message”}</span></pre><blockquote class="me"><p id="6da2" class="mf mg it bd mh mi ow ox oy oz pa md dk translated">S3铲斗配置</p></blockquote><p id="6b51" class="pw-post-body-paragraph li lj it lk b ll mo kd ln lo mp kg lq lr mq lt lu lv mr lx ly lz ms mb mc md im bi translated">Amazon AppFlow自动配置了一个S3存储桶策略以及一个如下所示的策略声明。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi qi"><img src="../Images/2678808062e3e964bd67cecc0fe8e51a.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*ESc2X0VWcSoO5V5CH06Qtg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:AppFlow S3桶政策</p></figure><p id="5453" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这种策略对于Amazon AppFlow来说很好，但是我们必须添加一个额外的策略，如下图所示，以允许Amazon Macie从S3桶中读取数据。这里的权限可能看起来过于宽松。继续尝试，使其更具限制性。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi qj"><img src="../Images/cd9f52bea68a5bba8469677e713996af.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*PgLPZ2epg_I50YiHjylwQQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:亚马逊Macie的S3桶政策声明</p></figure><h2 id="f504" class="mt mu it bd mv mw mx dn my mz na dp nb lr nc nd ne lv nf ng nh lz ni nj nk iz bi translated">使用Amazon Macie发现和检测S3内容中的敏感数据</h2><p id="f62e" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">随着数据上传到S3，现在我们可以配置Amazon Macie来分类S3数据，并在检测到敏感数据时接收生成的警报。</p><p id="3690" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">亚马逊Macie使用机器学习来自动发现、分类和保护存储在S3桶中的敏感数据。</p><h2 id="23ed" class="mt mu it bd mv mw mx dn my mz na dp nb lr nc nd ne lv nf ng nh lz ni nj nk iz bi translated">使用Amazon Macie生成的Amazon CloudWatch事件采取适当的补救或通知措施</h2><p id="6392" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">可以捕获由Amazon Macie发现生成的CloudWatch事件。可以创建一个事件规则来向所需的目标发送通知。现在，我们将配置一个简单的SNS主题作为规则的通知目标。</p><blockquote class="me"><p id="0037" class="mf mg it bd mh mi mj mk ml mm mn md dk translated">让我们在配置Macie之前配置通知系统</p></blockquote><blockquote class="ok ol om"><p id="a079" class="li lj nq lk b ll mo kd ln lo mp kg lq on mq lt lu oo mr lx ly op ms mb mc md im bi translated"><strong class="lk jd">第一步:创建或重用一个SNS主题，需要订阅者</strong></p></blockquote><p id="c54e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请参考此链接创建SNS主题-</p><div class="pb pc gp gr pd pe"><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/US_SetupSNS.html" rel="noopener  ugc nofollow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">设置Amazon SNS通知</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">或者，如果您计划使用AWS管理控制台创建CloudWatch警报，您可以跳过这一步…</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><blockquote class="ok ol om"><p id="0a85" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated"><strong class="lk jd">第二步:创建一个云观察事件规则</strong></p></blockquote><p id="2868" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用下面的事件模式和SNS主题创建一个CloudWatch事件规则。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qk"><img src="../Images/4423033e37971ddbaee90cced618a4d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f8IlVylNV-ZV2ObQWD3Tnw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:Macie的CloudWatch事件规则</p></figure><blockquote class="me"><p id="bc41" class="mf mg it bd mh mi ow ox oy oz pa md dk translated">现在，让我们配置Amazon Macie</p></blockquote><p id="fd21" class="pw-post-body-paragraph li lj it lk b ll mo kd ln lo mp kg lq lr mq lt lu lv mr lx ly lz ms mb mc md im bi translated"><em class="nq">先决条件:</em>需要启用亚马逊Macie。如果你已经在使用Macie经典版，建议<a class="ae lh" href="https://docs.aws.amazon.com/macie/latest/userguide/macie-migration.html" rel="noopener ugc nofollow" target="_blank">升级到新版本</a>。新版本有很多改进。同样参考<a class="ae lh" href="https://aws.amazon.com/blogs/aws/new-enhanced-amazon-macie-now-available/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>。</p><p id="9141" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">启用Macie后，您会看到一个类似下图的带有摘要视图的仪表板。Macie可能需要一些时间来发现和显示数据，具体取决于数据量。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ql"><img src="../Images/e9d4d094ad8c59aae0a71e9c9c5a361c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tFMpiEAFM0yjFI7nCeEsgg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:亚马逊Macie仪表盘</p></figure><blockquote class="ok ol om"><p id="4d1f" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated"><strong class="lk jd">第一步:配置AWS KMS CMK权限</strong></p></blockquote><p id="e672" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">添加如下所示的关键策略语句，以允许Amazon Macie的服务关联角色使用CMK密钥解密由Amazon AppFlow加密的S3对象。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qm"><img src="../Images/3498dbd1d1b7c7fab396284474369ac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7gnfa97CLcbRDzmvzh2DXw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:AWS KMS CMK亚马逊Macie关键政策声明</p></figure><blockquote class="ok ol om"><p id="2fab" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated"><strong class="lk jd">步骤2:创建自定义数据标识符(可选；取决于使用案例)</strong></p></blockquote><p id="563d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我正在为这个特定的用例演示配置自定义数据标识符。但是，它对你来说可能是可选的。我将在一个<a class="ae lh" href="https://docs.aws.amazon.com/macie/latest/user/discovery-jobs.html" rel="noopener ugc nofollow" target="_blank"> Macie数据分类作业</a>配置中使用它们。</p><p id="53fd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我已经配置了2个基于正则表达式的标识符，分别用正则表达式<code class="fe po pp pq pr b">AKIA[0–9A-Z]{16}</code>和<code class="fe po pp pq pr b">[0–9a-zA-Z/+]{40}</code>来检测AWS访问密钥和AWS秘密密钥。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qn"><img src="../Images/fda64eff96a8ccb4c0dc0fe1a6f9af38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aO5PY86sQTZSV6xKW52gbQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">设置自定义数据标识符</p></figure><blockquote class="ok ol om"><p id="ffd9" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated"><strong class="lk jd">步骤3:创建数据分类作业</strong></p></blockquote><p id="96cf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">转至“S3存储桶”页面，选择要发现和分类数据的存储桶，然后单击“创建作业”。单击下一步。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qo"><img src="../Images/cfabddb0367c7c882182bc1b66924740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m2RKAi_X_nIAtFZ3NGCWTw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:S3水桶精选</p></figure><p id="43ca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在“范围”屏幕中，配置作业执行频率和数据发现标准。我为此用例选择了“一次性工作”。而且，因为我想发现所有数据并进行分类，所以我没有配置任何包含和/或排除标准。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qp"><img src="../Images/87e25e8d8830ad8e29a107e2bd72a07c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FLew7I8y5PAoUk8jKsXciA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:发现和分类范围</p></figure><p id="c833" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果需要，选择自定义数据标识符。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qq"><img src="../Images/43409d624dac58637624dcb24ab4a72f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61AKFFQpCuo73BOIJXS-6A.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:添加自定义数据标识符</p></figure><p id="8a7e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">提供作业名称和描述，并创建作业。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qr"><img src="../Images/fe3f7b9e931b04b84f8f50e8b9cdc7bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AN11QNCaSZKEUuz9p9Mc_w.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:工作名称和描述</p></figure><p id="d8cf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">根据需要发现和分类的数据量，这项工作需要一些时间才能完成。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qs"><img src="../Images/356f3259ede55671bd04dbb74e818b4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tu9I5lmxOejx-U8aH7s4rw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:工作列表</p></figure><blockquote class="ok ol om"><p id="e8ce" class="li lj nq lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated"><strong class="lk jd">第四步:查看亚马逊Macie调查结果</strong></p></blockquote><p id="3568" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦作业发现敏感数据，就可以在“调查结果”屏幕下过滤和搜索调查结果。Amazon Macie显示了调查结果的严重程度、类型和其他细节，可以进一步深入研究。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qt"><img src="../Images/42c6c62ba5c3356fea0094bf725def8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1NdwdXzm2JKlk8O6CsLxTA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:工作发现</p></figure><blockquote class="me"><p id="745d" class="mf mg it bd mh mi ow ox oy oz pa md dk translated">从时差中发送更多数据</p></blockquote><p id="bdf8" class="pw-post-body-paragraph li lj it lk b ll mo kd ln lo mp kg lq lr mq lt lu lv mr lx ly lz ms mb mc md im bi translated">现在我们已经有了预期的解决方案，启动Slack并在通道中发送更多带有适当敏感数据的消息。</p><p id="ea53" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">假设Amazon AppFlow每隔几分钟就处理一次数据，我们应该会在Macie中看到警告，也会收到SNS通知。</p><p id="8caf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面的通知是普通的SNS消息格式，所以可能不是很直观。根据CloudWatch事件目标，可以采取适当的措施，并根据需要处理数据。但是，无论如何你得到了这个想法！</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qu"><img src="../Images/8b3d984bde28810e858c23cb6b29af89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*un4Dmqd_4MeHX-oeRcdpcQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片:SNS通知</p></figure></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><h1 id="e1f4" class="ny mu it bd mv nz oq ob my oc or oe nb ki os kj ne kl ot km nh ko ou kp nk oi bi translated">结论</h1><p id="445c" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">谢谢你读到这里！</p><p id="da58" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，这篇文章展示了我们如何构建一个AWS解决方案来检测和通知基于聊天的通信平台中的敏感数据泄漏场景。该架构完全无服务器、安全且可扩展。</p><p id="0403" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">关于这个解决方案，有一点需要注意</p><p id="60a0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上传到Slack频道的文档和图像不能被Amazon AppFlow处理，也不能以相同的格式存储在S3。因此，亚马逊Macie将无法检测通过此类对象传递的敏感信息。</p><p id="cf43" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nq">如果需要这样的能力，我们应该能够使用Slack APIs和AWS Lambda构建一个解决方案来检索数据，并将其存储回S3供Amazon Macie分析。</em></p><p id="78de" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">根据需求，可以使用亚马逊人工智能服务(如Rekognition、Textract等)构建各种这样的解决方案。也是。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><h1 id="8b9d" class="ny mu it bd mv nz oq ob my oc or oe nb ki os kj ne kl ot km nh ko ou kp nk oi bi translated">参考</h1><div class="pb pc gp gr pd pe"><a href="https://aws.amazon.com/appflow/" rel="noopener  ugc nofollow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">亚马逊应用流-亚马逊网络服务</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">安全集成应用程序并自动处理任意规模的数据流，无需代码。Amazon AppFlow是一个完全托管的…</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">aws.amazon.com</p></div></div><div class="qv l"><div class="qw l qx qy qz qv ra lb pe"/></div></div></a></div><div class="pb pc gp gr pd pe"><a href="https://aws.amazon.com/blogs/aws/new-announcing-amazon-appflow/" rel="noopener  ugc nofollow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">新-宣布亚马逊应用流|亚马逊网络服务</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">软件即服务(SaaS)应用对我们的客户越来越重要，采用率也在不断提高…</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">aws.amazon.com</p></div></div><div class="qv l"><div class="rb l qx qy qz qv ra lb pe"/></div></div></a></div><div class="pb pc gp gr pd pe"><a href="https://docs.aws.amazon.com/macie/latest/user/what-is-macie.html" rel="noopener  ugc nofollow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">什么是亚马逊Macie？</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">亚马逊Macie是一个完全托管的数据安全和数据隐私服务，使用机器学习和模式匹配…</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><div class="pb pc gp gr pd pe"><a href="https://aws.amazon.com/blogs/aws/new-enhanced-amazon-macie-now-available/" rel="noopener  ugc nofollow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">全新增强的Amazon Macie现已推出，价格大幅降低| Amazon Web Services</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">Amazon Macie是一个完全托管的服务，它使用机器学习来帮助您发现和保护您的敏感数据…</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">aws.amazon.com</p></div></div><div class="qv l"><div class="rc l qx qy qz qv ra lb pe"/></div></div></a></div></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><p id="634f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nq">关注我上</em><a class="ae lh" href="https://www.linkedin.com/in/bideep/" rel="noopener ugc nofollow" target="_blank"><em class="nq">LinkedIn</em></a><em class="nq">，</em><a class="ae lh" href="https://twitter.com/bbideep" rel="noopener ugc nofollow" target="_blank"><em class="nq">Twitter</em></a><em class="nq">。</em></p><p id="ed99" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://bbideep.medium.com/subscribe" rel="noopener"> <em class="nq">在</em> </a> <em class="nq">上订阅更多此类帖子。</em></p></div></div>    
</body>
</html>