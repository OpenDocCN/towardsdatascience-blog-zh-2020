<html>
<head>
<title>How to Efficiently Fine-Tune your Machine Learning Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何有效地微调你的机器学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-fine-tune-your-machine-learning-models-with-ease-8ca62d1217b1?source=collection_archive---------12-----------------------#2020-04-23">https://towardsdatascience.com/how-to-fine-tune-your-machine-learning-models-with-ease-8ca62d1217b1?source=collection_archive---------12-----------------------#2020-04-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0ac1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">发现为您的ML模型寻找最佳参数非常耗时？用这三招</h2></div><h1 id="2c29" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">动机</h1><p id="1bd5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您是否曾经想为您的模型试验不同的参数，但发现这样做真的很耗时？假设您想要使用支持向量机(SVM)来训练和预测模型。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lw"><img src="../Images/dd79456fac8619b8eb9391555a4aa8bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mCgh5MAn7E_85y5zKn76Bw.png"/></div></div></figure><p id="a505" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">你争论什么可能是<code class="fe mn mo mp mq b">C</code>的最佳值，所以你继续手动试验<code class="fe mn mo mp mq b">C</code>的不同值，希望得到好的结果。这很费时间，但还不算太糟。</p><p id="bfc6" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">但是如果要先用<code class="fe mn mo mp mq b">sklearn.feature_extraction.text.TfidfVectorizer</code>提取重要文本，再用<code class="fe mn mo mp mq b">sklearn.feature_selection.SelectKBest</code>寻找最佳特征，最后用<code class="fe mn mo mp mq b">sklearn.SVM.LinearSVC</code>训练预测模型呢？在中会有很多<strong class="lc iu">参数需要调整。此外，你需要找到一种方法来记录结果进行比较。所以你的笔记本可以看起来乱七八糟！</strong></p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mr"><img src="../Images/833a3d155d2e7b7f92d3a2db689117ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*V8zXHKsngHZ_gfE1I_7LhQ.gif"/></div></div></figure><p id="0195" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">有没有更好的方法来选择参数，缩短代码，以及保存结果进行比较？是的，当然！我们的方法就像一个美味的蛋糕，有三种简单的配料:</p><ul class=""><li id="ec69" class="ms mt it lc b ld mi lg mj lj mu ln mv lr mw lv mx my mz na bi translated">合并不同模型的管道</li><li id="1c71" class="ms mt it lc b ld nb lg nc lj nd ln ne lr nf lv mx my mz na bi translated">网格搜索以找到每个模型的最佳参数</li><li id="2834" class="ms mt it lc b ld nb lg nc lj nd ln ne lr nf lv mx my mz na bi translated">MLflow记录结果</li></ul><p id="461f" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">有你需要的所有成分吗？厉害！现在我们准备把它们放在一起。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ng"><img src="../Images/48c41ad42f285fed1d08a06d0301330c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rxuZK5PDqPBp690Y"/></div></div><p class="nh ni gj gh gi nj nk bd b be z dk translated">照片由<a class="ae nl" href="https://unsplash.com/@drewpatrickmiller?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">德鲁·帕特里克·米勒</a>在<a class="ae nl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="53d5" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">管道</h1><p id="498e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">什么是管道？<code class="fe mn mo mp mq b"><a class="ae nl" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank"><strong class="lc iu">sklearn.pipeline.Pipeline</strong></a></code>允许我们<strong class="lc iu">将一系列转换和一个最终估计器组合成一个链。</strong></p><p id="c2ce" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">例如，为了预测一条推文是否具有攻击性，在处理文本后，我们使用<code class="fe mn mo mp mq b">tfidf_vectorizer,</code>和<code class="fe mn mo mp mq b">SelectKBest</code>作为变压器，使用<code class="fe mn mo mp mq b">svm.LinearSVC</code>作为最终估计器。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="7cbb" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">上面的代码可以合并到一个管道中，管道中有一列表示为元组的步骤。在每个元组中，第一个参数是类名，第二个参数是类。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="1488" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">短得多，有条理！我们可以很容易地将任何步骤切换到另一个转换器或估计器。确保管道中的类来自<code class="fe mn mo mp mq b">sklearn.</code>如果不是，你可以像这样用<code class="fe mn mo mp mq b">def __init__, def fit(),</code>和<code class="fe mn mo mp mq b">def transform()</code>轻松创建定制的<code class="fe mn mo mp mq b">sklearn</code>类。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nm nn l"/></div><p class="nh ni gj gh gi nj nk bd b be z dk translated">在这里找到示例源代码<a class="ae nl" href="https://github.com/khuyentran1401/Speed-Dating/blob/master/preprocessors.py" rel="noopener ugc nofollow" target="_blank"/></p></figure><h1 id="5451" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">网格搜索简历</h1><p id="32e3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">因此，我们准备好了转换和预测数据的管道。但是参数调优呢？通过<code class="fe mn mo mp mq b"><a class="ae nl" href="https://scikit-learn.org/stable/modules/compose.html" rel="noopener ugc nofollow" target="_blank"><strong class="lc iu"><em class="no">sklearn.model_selection.GridSearchCV</em></strong></a><strong class="lc iu"><em class="no">.</em></strong></code>，我们可以很容易地找到管道中变压器和估算器的最佳参数</p><p id="9515" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">假设我们想要找到<code class="fe mn mo mp mq b">SelectKBest</code>的最佳值<code class="fe mn mo mp mq b">k</code>，最佳值<code class="fe mn mo mp mq b">C</code>的最佳值<code class="fe mn mo mp mq b">svm.LinearSVC,</code>，最佳值<code class="fe mn mo mp mq b">analyzer, ngram_range,</code>和<code class="fe mn mo mp mq b">binary</code>的最佳值<code class="fe mn mo mp mq b">TfidfVectorizer.</code>，我们可以给网格几个参数来搜索。参数表示为嵌套在字典中的列表。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="418e" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">为了设置特定类的参数，我们使用<code class="fe mn mo mp mq b">class_name__parameter = [para_1, para_2, para_3].</code>确保类名和参数之间有两个下划线。</p><p id="be58" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated"><code class="fe mn mo mp mq b">grid_search.fit(X_train, y_train) </code>使用不同的参数、指定的转换和估算器创建几次运行。将为转化步骤选择产生最佳结果的参数组合。</p><p id="cd5f" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">我们还可以用不同的变压器和估算器创建其他管道，并再次使用GridSearchCV来寻找最佳参数！但是我们如何保存所有运行的结果呢？</p><p id="beca" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">可以通过上下滚动屏幕或拍摄结果照片来观察结果。但是这很费时间，没有考虑到我们可能希望在以后的项目中看到结果。有没有更好的方法来跟踪我们的结果？这就是我们需要像MLflow这样的跟踪工具的时候</p><h1 id="9bcb" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">MLflow</h1><p id="3fec" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae nl" href="https://mlflow.org/docs/latest/index.html" rel="noopener ugc nofollow" target="_blank"> MLflow </a>是一个管理端到端机器学习生命周期的工具，包括跟踪实验、以可复制的形式打包ML代码以供共享和部署。我们将利用这个工具来记录我们的结果。</p><p id="6f2e" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">MLflow的安装可以像这样简单</p><pre class="lx ly lz ma gt np mq nq nr aw ns bi"><span id="d0c2" class="nt kj it mq b gy nu nv l nw nx">pip install mlflow</span></pre><p id="e010" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">让我们将目前为止所做的与物流跟踪工具结合起来</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="30b8" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">在这段代码中，我们只添加了三个元素来记录结果:</p><ul class=""><li id="e7ff" class="ms mt it lc b ld mi lg mj lj mu ln mv lr mw lv mx my mz na bi translated"><code class="fe mn mo mp mq b">mlflow.set_experiment('name_of_experiment')</code>创造新的实验</li><li id="25cb" class="ms mt it lc b ld nb lg nc lj nd ln ne lr nf lv mx my mz na bi translated"><code class="fe mn mo mp mq b">mlflow.start_run()</code>我们要运行实验的代码在里面</li><li id="4f93" class="ms mt it lc b ld nb lg nc lj nd ln ne lr nf lv mx my mz na bi translated"><code class="fe mn mo mp mq b">mlflow.log_param()</code>和<code class="fe mn mo mp mq b">mlflow.log_metric()</code>来记录参数和指标</li></ul><p id="cadf" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">将上面的文件保存为<code class="fe mn mo mp mq b">train.py.</code>最后一步是运行文件</p><pre class="lx ly lz ma gt np mq nq nr aw ns bi"><span id="1bb2" class="nt kj it mq b gy nu nv l nw nx">python train.py</span></pre><p id="de0b" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">代码运行完成后，我们可以通过运行</p><pre class="lx ly lz ma gt np mq nq nr aw ns bi"><span id="b6d8" class="nt kj it mq b gy nu nv l nw nx">mlflow ui</span></pre><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ny"><img src="../Images/20513ab3602346589d667ad96c3f4ea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-kWPQ2g7fvTGGTNQ8XICBw.png"/></div></div></figure><p id="4090" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">访问链接<a class="ae nl" href="http://127.0.0.1:5000" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>，我们应该会看到这个</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nz"><img src="../Images/aaf74b44f854453126b247d01779427b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5OYI4ot8Upc-PUkw3UrELw.png"/></div></div></figure><p id="6fe4" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">正如我们从上面可以看到的，实验的指标和参数都被记录下来了！我们可以创建几个实验并记录这些实验的结果，以便进行简单有效的比较。</p><h1 id="e017" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="ca23" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">恭喜你！您已经学习了如何使用Pipeline、GridSearchCV和MLflow高效地调整机器学习模型的参数。您可以在这里找到本文<a class="ae nl" href="https://github.com/khuyentran1401/Machine-learning-pipeline" rel="noopener ugc nofollow" target="_blank">的类似示例代码。我鼓励你在现有的机器学习项目中尝试这些方法。从长远来看，编码方法上的一点点改变就能产生很大的不同。有效地进行实验并跟踪结果不仅会节省您的时间，还会使您更容易找到最佳参数并从实验中学习。</a></p><p id="2899" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">我喜欢写一些基本的数据科学概念，并尝试不同的算法和数据科学工具。你可以在<a class="ae nl" href="https://www.linkedin.com/in/khuyen-tran-1401/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae nl" href="https://twitter.com/KhuyenTran16" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系我。</p><p id="f306" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">如果你想查看我写的所有文章的代码，请点击这里。在Medium上关注我，了解我的最新数据科学文章，例如:</p><div class="oa ob gp gr oc od"><a rel="noopener follow" target="_blank" href="/how-to-organize-your-data-science-articles-with-github-b5b9427dad37"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">如何用Github组织你的数据科学文章</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">被新信息淹没？现在，您可以轻松地跟踪文章并为其创建自定义注释</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="on l oo op oq om or mg od"/></div></div></a></div><div class="oa ob gp gr oc od"><a rel="noopener follow" target="_blank" href="/how-to-create-a-drop-down-menu-and-a-slide-bar-for-your-favorite-visualization-tool-3a50b7c9ea01"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">如何为你最喜欢的可视化工具创建下拉菜单和滑动条</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">使用Python Widget，您可以用3行代码升级可视化</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="os l oo op oq om or mg od"/></div></div></a></div><div class="oa ob gp gr oc od"><a rel="noopener follow" target="_blank" href="/how-to-share-your-jupyter-notebook-in-3-lines-of-code-with-ngrok-bfe1495a9c0c"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">如何用Ngrok用3行代码分享你的Jupyter笔记本</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">想象一下，让你的朋友在远程机器上使用你的本地Jupyter笔记本</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="ot l oo op oq om or mg od"/></div></div></a></div><div class="oa ob gp gr oc od"><a rel="noopener follow" target="_blank" href="/how-to-monitor-and-log-your-machine-learning-experiment-remotely-with-hyperdash-aa7106b15509"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">如何使用HyperDash远程监控和记录您的机器学习实验</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">培训需要很长时间才能完成，但你需要去洗手间休息一下…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="ou l oo op oq om or mg od"/></div></div></a></div><div class="oa ob gp gr oc od"><a rel="noopener follow" target="_blank" href="/cython-a-speed-up-tool-for-your-python-function-9bab64364bfd"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">cy thon——Python函数的加速工具</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">当调整你的算法得到小的改进时，你可能想用Cython获得额外的速度，一个…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="ov l oo op oq om or mg od"/></div></div></a></div></div></div>    
</body>
</html>