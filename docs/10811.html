<html>
<head>
<title>TensorFlow vs PyTorch — Convolutional Neural Networks (CNN)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TensorFlow vs PyTorch —卷积神经网络(CNN)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tensorflow-vs-pytorch-convolutional-neural-networks-cnn-dd9ca6ddafce?source=collection_archive---------16-----------------------#2020-07-28">https://towardsdatascience.com/tensorflow-vs-pytorch-convolutional-neural-networks-cnn-dd9ca6ddafce?source=collection_archive---------16-----------------------#2020-07-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="348b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">CNN 在 TensorFlow 和 PyTorch 中对一个著名数据集的实现及结果比较</h2></div><p id="0784" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我之前的<a class="ae le" rel="noopener" target="_blank" href="/tensorflow-vs-pytorch-linear-regression-e07781a83525">文章</a>中，我已经给出了一个<strong class="kk iu"> <em class="lf">简单线性回归</em> </strong>在<strong class="kk iu"> <em class="lf"> TensorFlow </em> </strong>和<strong class="kk iu"> <em class="lf"> PyTorch </em> </strong>框架中的实现，并比较了它们的结果。在本文中，我们将使用两种框架在一个非常著名的时尚 MNIST 数据集上完成卷积神经网络(CNN)的应用，并比较结果。</p><h1 id="287c" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">起源—</h1><p id="dc25" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">让我们简要了解一下框架及其历史。首先，<em class="lf"> PyTorch </em>是基于 Torch 库的开源机器学习库。PyTorch 最初是由脸书的人工智能研究实验室(FAIR)开发的。它是免费的开源软件。</p><p id="7799" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一方面，<em class="lf"> TensorFlow </em>由<em class="lf">谷歌大脑</em>团队开发，用于谷歌内部研究目的。它广泛用于机器学习应用，如神经网络。它也是免费的开源软件。</p><p id="77d2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了了解哪种框架更有效、更简单，我们将使用这两种框架构建一个 ConvNet，并对它们进行比较。对于张量流，我们将使用 Keras 库。</p><h2 id="b798" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">问题—</h2><p id="4374" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">为了比较这两个框架，我们将使用著名的<a class="ae le" href="https://github.com/zalandoresearch/fashion-mnist" rel="noopener ugc nofollow" target="_blank">时尚-MNIST </a>数据集。它是由 60，000 个样本的训练集和 10，000 个样本的测试集组成的 Zalando 文章图像的数据集<strong class="kk iu"> </strong>。每个例子是一个 28×28 的灰度图像，与来自 10 个类别的标签相关联，例如衬衫、包、凉鞋、外套、运动鞋等。我们将使用两种框架构建一个具有 LeNet 通用架构的 CNN 网络，并比较它们的结果。</p><h1 id="1f95" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">步骤 1:导入库</h1><p id="fc40" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">第一步，我们将导入 TensorFlow 和 PyTorch 框架所需的库。</p><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">导入库</p></figure><h1 id="27b7" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">步骤 2:获取和拆分数据集</h1><p id="090f" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">下一步，我们将获得时尚 MNIST 数据集。由于它是一个非常常见的数据集，两个框架都预加载了一些功能，使我们能够下载并使用数据集。</p><h2 id="fca4" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">PyTorch</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="01bf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 PyTorch 中，内置模块用于加载数据集。由于我们需要张量形式的数据，通过使用<code class="fe na nb nc nd b">torchvision.transforms.ToTensor()</code>将数据转换成张量，并将其赋给变量<code class="fe na nb nc nd b">transforms. </code>，然后使用<code class="fe na nb nc nd b">torchvision.datasets</code>下载数据。数据相应地被分成训练数据集和测试数据集。</p><h2 id="788e" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">张量流</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7c85" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一方面，与 PyTorch 版本相比，使用 TensorFlow 从 keras 库中获取数据更加简单。数据集从<code class="fe na nb nc nd b">keras.datasets</code>加载，并相应地分成训练图像和测试图像。</p><h1 id="6571" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">步骤 3:加载数据</h1><p id="adf5" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在这一步中，我们将把数据加载到训练集和测试集中。此外，我们还将查看图像在两个框架中是如何存储的。</p><h2 id="29e0" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">PyTorch</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/d1504d2ac8bdd8d2f4a84f887c436b84.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*WlAyVJv-evto1pTG3-4K8A.png"/></div></figure><p id="d5f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 PyTorch 中，图像存储在范围 0-1 中，因此图像以黑白显示。使用<code class="fe na nb nc nd b">DataLoader</code>功能将图像加载到 train_loader 和 test_loader 中。此外，还会打印图像的标签。</p><h2 id="9a0b" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">张量流</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/74122e5160334e9cf00553f74ec0397d.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*3zQ5Ic7j_HMClpVTOkkaEQ.png"/></div></figure><p id="a496" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一方面，TensorFlow 存储 0–255 范围内的图像，因此同一图像中存在颜色渐变。TensorFlow 加载数据的方法更简单。</p><h1 id="a950" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">步骤 4:构建模型</h1><p id="e37c" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在这一步，我们将建立 CNN 模型。为此，我们将构建标准的 LeNet-5 架构，这是一个非常简单的架构，建于 1998 年。下面给出的是 LeNet-5 的架构。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/10e09b9f83377dd1d9488dfe242e15ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eQW6Y-L_qKpuKsra.jpg"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">(<a class="ae le" href="https://engmrk.com/lenet-5-a-classic-cnn-architecture/" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></figure><h2 id="a9c3" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">PyTorch</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7b9f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，我们使用 PyTorch 框架构建 LeNet-5 架构。它具有 2 个卷积层，每个卷积层之后是平均池层、2 个全连接层和具有 10 个类别的最终输出分类器层，因为最终输出具有 10 个类别的时尚项目。</p><p id="2221" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，通过创建一个特殊的类“NeuralNet”来构建模型，其中我们必须使用 __init__ 方法来定义网络/模型的每一层。将此函数<strong class="kk iu"><em class="lf">‘forward’</em></strong>调用很重要，因为这将覆盖<code class="fe na nb nc nd b">nn.Module</code>中的基本 forward 函数，并允许所有<code class="fe na nb nc nd b">nn.Module</code>功能正常工作。</p><h2 id="3cba" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">张量流</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="89c5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一方面，在 TensorFlow 中构建相同的模型不需要创建类，即使我们使用了<code class="fe na nb nc nd b">Sequential()</code>方法。我们发现，使用 TensorFlow 框架构建相同的模型比直接在 PyTorch 框架中构建相同的模型要简单明了得多。</p><h1 id="fd85" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">步骤 5:可视化模型</h1><p id="e052" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在这一步中，我们将编译上一步中构建的模型，并设置优化器和损失函数。为此，在两个框架中，我们将使用<strong class="kk iu"> <em class="lf"> Adam </em> </strong>优化器和<strong class="kk iu"> <em class="lf">分类交叉熵</em> </strong>损失函数，因为数据集中有 2 个以上的类。</p><h2 id="e15e" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">PyTorch</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7887" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 PyTotch 中，我们首先创建一个在最后一步中构建的'<em class="lf"> NeuralNet </em>'模型的实例作为<code class="fe na nb nc nd b">modelpy</code>。然后，我们将优化器和损失函数分配给相应的变量。然后我们通过打印<code class="fe na nb nc nd b">modelpy</code>来可视化模型。</p><h2 id="d6a1" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">张量流</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="52fb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一方面，在 TensorFlow 框架中，我们使用了<code class="fe na nb nc nd b">compile() </code>函数，在该函数中，我们将如上所述定义优化器和损失函数。然后我们使用<code class="fe na nb nc nd b">summary()</code>来查看上面构建的 LeNet-5 架构的层。</p><h1 id="c743" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">步骤 6:训练模型</h1><p id="4e51" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在这一步中，我们根据训练集中的数据部署为训练而构建的模型。对于这两个框架，我们将为 30 个时期<strong class="kk iu"><em class="lf"/></strong>训练模型，并查看结果。</p><h2 id="daf0" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">PyTorch</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="c8f4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于 PyTorch，我们必须单独计算所有步骤，包括损失函数、优化器、反向传播和更新循环 的<strong class="kk iu"> <em class="lf">中的每一步。</em></strong></p><h2 id="e53b" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">张量流</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="1bce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 TensorFlow 中，时尚 MNIST 是一个二维数组，我们必须将训练数据集整形为张量，并将标签从整数转换为二进制类矩阵。使用<code class="fe na nb nc nd b">fit()</code>函数对模型进行训练，该函数由定义的历元数组成。</p><h1 id="80a5" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">第七步:比较结果</h1><p id="4ba9" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在最后一步，我们将比较使用测试集上的框架构建的两个模型的结果。</p><h2 id="eb0a" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">PyTorch</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7e9e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 PyTorch 中，输出预测由<code class="fe na nb nc nd b">outputs = modelpy(images)</code>预测。然后计算并显示测试集的准确度。</p><h2 id="76ae" class="md lh it bd li me mf dn lm mg mh dp lq kr mi mj ls kv mk ml lu kz mm mn lw mo bi translated">张量流</h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="bfc2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 TensorFlow 中，<code class="fe na nb nc nd b">predict()</code>函数用于预测测试数据集中图像的类别，并计算和显示准确度。</p><h1 id="31a0" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">结果</h1><p id="355a" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">测试集由 1000 幅图像组成，基于 PyTorch 和 TensorFlow 框架构建的模型用于预测测试集图像的类别。</p><pre class="mp mq mr ms gt nm nd nn no aw np bi"><span id="1f87" class="md lh it nd b gy nq nr l ns nt">&gt;&gt;Test Accuracy of the model on the 10000 test images: <strong class="nd iu">89%</strong> with PyTorch</span><span id="1ac1" class="md lh it nd b gy nu nr l ns nt">&gt;&gt;Test Accuracy of the model on the 10000 test images: <strong class="nd iu">91.34%</strong> with TensorFlow</span></pre><p id="6276" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从结果中我们看到 TensorFlow 模型的测试集准确率为<strong class="kk iu"> <em class="lf"> 91.34% </em> </strong>，比 PyTorch 模型的<strong class="kk iu"> <em class="lf"> 89% </em> </strong>略高。</p><h1 id="7ac2" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">结论</h1><p id="e021" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">从上面的比较中，我们能够理解使用当今深度学习中使用的两个最流行的框架来构建 CNN 模型。</p><p id="779e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我看来，如果你是一个初学者，完全不知道使用哪个框架，我建议你从 TensorFlow 框架开始，因为它更简单，更容易理解。另一方面，PyTorch 更快、更动态，但需要对 Python API 有一点了解。</p><p id="109e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我附上了我的 GitHub 库，你可以在那里找到比较的完整代码。</p><div class="nv nw gp gr nx ny"><a href="https://github.com/mk-gurucharan/TensorFlow-vs-PyTorch-CNN" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">MK-gurucharan/tensor flow-vs-py torch-CNN</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">GitHub 是超过 5000 万开发人员的家园，他们一起工作来托管和审查代码、管理项目和构建…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om nf ny"/></div></div></a></div><p id="b714" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请查看我以前的文章，在这篇文章中，我给出了构建简单线性回归模型的两种框架的比较。</p><div class="nv nw gp gr nx ny"><a rel="noopener follow" target="_blank" href="/tensorflow-vs-pytorch-linear-regression-e07781a83525"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">TensorFlow 与 PyTorch —线性回归</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">TensorFlow 和 PyTorch 框架中线性回归的实现及其结果的比较</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">towardsdatascience.com</p></div></div><div class="oh l"><div class="on l oj ok ol oh om nf ny"/></div></div></a></div><p id="f809" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我真的希望我能够很好地比较今天深度学习中使用的两个最流行的框架。在我的下一篇文章中与大家见面。到那时，快乐的机器学习！</p></div></div>    
</body>
</html>