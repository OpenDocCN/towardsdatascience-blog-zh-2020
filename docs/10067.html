<html>
<head>
<title>Python’s geocoding — Convert a list of addresses into a map</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 的地理编码-将地址列表转换为地图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pythons-geocoding-convert-a-list-of-addresses-into-a-map-f522ef513fd6?source=collection_archive---------1-----------------------#2020-07-16">https://towardsdatascience.com/pythons-geocoding-convert-a-list-of-addresses-into-a-map-f522ef513fd6?source=collection_archive---------1-----------------------#2020-07-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8995" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用地理定位 API 接收绘制客户、工厂、车队和其他主题的地图所需的数据。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/302b6dd07d8a938e59a8b8f1014f0217.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p3MPFYg8ZmudNtbv"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@dead____artist?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">捕捉人心。</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="053c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们每个人都有一个数据库，里面有客户的地址，工厂或商店的名单，我们销售产品或合作的地区。在地图上显示这些数据是现代仪表盘的必备功能。为了做到这一点，我们必须将地址(城市名称或地区)转换成地理空间数据——纬度和经度。然后我们可以在引人注目的地图上展示它们。</p><p id="39e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">你会学到什么</strong></p><p id="1c73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将探索如何:</p><ul class=""><li id="eb22" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="#3d61" rel="noopener ugc nofollow">选择理想的地图服务</a></li><li id="ee9f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#c8f7" rel="noopener ugc nofollow">使用</a> <code class="fe mj mk ml mm b"><a class="ae ky" href="#c8f7" rel="noopener ugc nofollow">requests</a></code>连接 API(老式方式)</li><li id="86f0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#3128" rel="noopener ugc nofollow">用 Python 的</a> <code class="fe mj mk ml mm b"><a class="ae ky" href="#3128" rel="noopener ugc nofollow">geopy</a></code> <a class="ae ky" href="#3128" rel="noopener ugc nofollow">库</a>获取位置(及更多)</li><li id="f48d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#5352" rel="noopener ugc nofollow">将地址列表转换为地理点</a></li><li id="3427" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#03c6" rel="noopener ugc nofollow">用</a><code class="fe mj mk ml mm b"><a class="ae ky" href="#03c6" rel="noopener ugc nofollow">folium</a></code><a class="ae ky" href="#03c6" rel="noopener ugc nofollow"/><code class="fe mj mk ml mm b"><a class="ae ky" href="#03c6" rel="noopener ugc nofollow">plotly</a></code>将采集的数据显示在地图上</li><li id="11a1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#e0df" rel="noopener ugc nofollow">将地图保存成。html 文件</a></li></ul><p id="d3f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过 Github-<a class="ae ky" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Maps/Geocoding/Address%20to%20Location.ipynb" rel="noopener ugc nofollow" target="_blank">Address to location . ipynb</a>下载这款 jupyter 笔记本，跟随我的脚步。</p><h2 id="3d61" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">谁提供制图数据？</h2><p id="8132" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">要将地址转换成坐标，你可以购买一个带有地理位置的地址数据库，或者查询一些地理定位服务提供商。任何提供地图的人通常都会提供一个地理定位 API(通常需要付费)。让我们回顾一下一些主要的提供商:</p><ul class=""><li id="6d85" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://developers.google.com/maps/documentation" rel="noopener ugc nofollow" target="_blank">谷歌地图平台</a></li><li id="3b9b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://docs.mapbox.com/api/" rel="noopener ugc nofollow" target="_blank">地图框 API </a></li><li id="df6a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://docs.microsoft.com/en-us/bingmaps/rest-services/" rel="noopener ugc nofollow" target="_blank">必应 API </a></li><li id="a682" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">OpenStreetMap API——(免费)</li><li id="bcdc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://tech.yandex.com/maps/" rel="noopener ugc nofollow" target="_blank"> Yandex 地图 API </a></li></ul><p id="a8c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文回顾了一些主要的提供商:</p><div class="nl nm gp gr nn no"><a href="https://medium.com/rakuten-rapidapi/top-10-map-apis-google-maps-bing-maps-mapbox-and-other-geolocation-apis-cb442fec07ed" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">十大地图应用程序接口:谷歌地图、必应地图、地图盒子和其他地理定位应用程序接口</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">地图已经成为你离不开的必备追踪工具。它们是任何公司不可或缺的一部分…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc ks no"/></div></div></a></div><h2 id="c8f7" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">如何连接到映射 API</h2><p id="db4a" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">大多数 API 都允许直接调用。你把你的地址发送到一个网址，然后接收地理位置信息。多年来，我们使用 python <code class="fe mj mk ml mm b">requests</code>库来做这件事。让我们探索对 Google API 的请求。</p><blockquote class="od oe of"><p id="fde2" class="kz la og lb b lc ld ju le lf lg jx lh oh lj lk ll oi ln lo lp oj lr ls lt lu im bi translated">要连接到 Google API，您需要一个 API 密钥。你必须提出要求，然后保守秘密，因为你为服务付费。谷歌每月免费提供 200 美元，足以完成 40000 次地理编码请求。</p></blockquote><p id="2845" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">地理编码调用通常非常简单:</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="ad5a" class="mn mo it mm b gy oo op l oq or">Base address: <a class="ae ky" href="https://maps.googleapis.com/maps/api/geocode/json" rel="noopener ugc nofollow" target="_blank">https://maps.googleapis.com/maps/api/geocode/json</a>?<br/>Parameters:<br/>   # blank spaces are turned to %20<br/>   address=1 Apple Park Way, Cupertino, CA<br/>   key=API_KEY</span></pre><p id="1560" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你准备好你想要搜索的数据。在<code class="fe mj mk ml mm b">urllib</code>的帮助下，你可以很容易地将参数转换成一个 URL，你调用<code class="fe mj mk ml mm b">requests.get().</code>得到的响应要么是 XML，但更常见的是由<code class="fe mj mk ml mm b">json.loads</code>处理的<code class="fe mj mk ml mm b">json</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">调用 Google API 将一个地区转换成地理位置</p></figure><h2 id="3128" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">使用 GeoPy 简化您的工作</h2><p id="a60e" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">您可以努力利用映射提供者 API 的文档来充分利用它，但是利用像<a class="ae ky" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> GeoPy </a>这样的现有库更容易。使用 Geopy，您只需几行代码就可以完成上述操作。</p><p id="c2ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Geopy 为流行的地图服务提供了一个类。<a class="ae ky" href="https://nominatim.openstreetmap.org/" rel="noopener ugc nofollow" target="_blank">nomim</a>是广受欢迎的<a class="ae ky" href="https://www.openstreetmap.org/#map=7/49.817/15.478" rel="noopener ugc nofollow" target="_blank"> OpenStreetMap </a>背后的服务，它允许你免费进行地理编码。但是你应该遵守<a class="ae ky" href="https://operations.osmfoundation.org/policies/nominatim/" rel="noopener ugc nofollow" target="_blank">的使用政策</a>以便让每个人都能使用它:</p><blockquote class="od oe of"><p id="a0c2" class="kz la og lb b lc ld ju le lf lg jx lh oh lj lk ll oi ln lo lp oj lr ls lt lu im bi translated">一般来说，不鼓励对大量数据进行批量地理编码。如果遵循这些附加规则，较小的一次性批量任务是允许的</p></blockquote><ul class=""><li id="e54e" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">将您的请求限制在<strong class="lb iu">单线程</strong></li><li id="9f0c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">仅限 1 台机器，<strong class="lb iu">无分布式脚本</strong>(包括多个 Amazon EC2 实例或类似实例)</li><li id="6160" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">结果<strong class="lb iu">必须缓存</strong>在你这边。重复发送相同查询的客户端可能被分类为有故障和被阻止。</li></ul><p id="2fbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你是有一个小项目还是只想给老板留下好印象？让我们用 geo py . Nominatim 进行地理编码，首先，我们将 nominam 初始化为<code class="fe mj mk ml mm b">geolocator</code>变量:</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="50be" class="mn mo it mm b gy oo op l oq or">from geopy.geocoders import Nominatim<br/>geolocator = Nominatim(user_agent="example app")</span></pre><p id="05a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后你需要一个地区的信息，我选择了意大利的托斯卡纳区:</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="25f9" class="mn mo it mm b gy oo op l oq or">[In]: geolocator.geocode("<strong class="mm iu">Tuscany, Italy</strong>").raw</span><span id="dcdd" class="mn mo it mm b gy ou op l oq or">[Out]: {'place_id': 232933113,<br/> 'licence': 'Data © OpenStreetMap contributors, ODbL 1.0. <a class="ae ky" href="https://osm.org/copyright'," rel="noopener ugc nofollow" target="_blank">https://osm.org/copyright',</a><br/> 'osm_type': 'relation',<br/> 'osm_id': 41977,<br/> 'boundingbox': ['42.237615', '44.4725419', '9.6867692', '12.3713544'],<br/> <strong class="mm iu">'lat': '43.4586541'</strong>,<br/> <strong class="mm iu">'lon': '11.1389204'</strong>,<br/> 'display_name': 'Toscana, Italia',<br/> 'class': 'boundary',<br/> 'type': 'administrative',<br/> 'importance': 0.6870417219974091,<br/> 'icon': 'https://nominatim.openstreetmap.org/images/mapicons/poi_boundary_administrative.p.20.png'}</span></pre><p id="dcf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从响应中，您可以获得纬度和经度</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="9b8d" class="mn mo it mm b gy oo op l oq or">[In]: geolocator.geocode("<strong class="mm iu">Tuscany, Italy</strong>").point<br/>[Out]: Point(43.4586541, 11.1389204, 0.0)</span></pre><p id="36d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类似地，你可以从一个完整的地址请求地理定位，例如，苹果公司的<a class="ae ky" href="https://en.wikipedia.org/wiki/Apple_Park" rel="noopener ugc nofollow" target="_blank">总部。</a></p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="74f1" class="mn mo it mm b gy oo op l oq or"># request <br/>geolocator.geocode("1 Apple Park Way, Cupertino, CA")</span><span id="2fbc" class="mn mo it mm b gy ou op l oq or"># extract the coordinates:<br/>('37.3337572', '-122.0113815')</span></pre><p id="2b58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Geopy 允许<code class="fe mj mk ml mm b">geocode</code>操作将地址转换为坐标，而相反的<code class="fe mj mk ml mm b">reverse</code>操作将位置转换为地址:</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="a071" class="mn mo it mm b gy oo op l oq or">[In]: geolocator.reverse('37.3337572, -122.0113815')</span><span id="e8e6" class="mn mo it mm b gy ou op l oq or">[Out]: Location(Apple Park, 1, Apple Park Way, Monta Vista, Cupertino, Santa Clara County, California, 94087, United States of America, (37.3348469, -122.01139215737962, 0.0))</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">完整教程使用 GeoPy 收集苹果总部的位置，然后。倒转来确认它是正确的地方</p></figure><h2 id="3098" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">谷歌地理公园</h2><p id="f7c8" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">您可以通过 Geopy 使用许多地图服务，只需提供 API 密钥或用户凭据。例如，使用谷歌地图 API:</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="d19b" class="mn mo it mm b gy oo op l oq or">geolocator = GoogleV3(api_key=AUTH_KEY)</span></pre><p id="77d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请求地理位置使用与上面相同的代码:</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="10de" class="mn mo it mm b gy oo op l oq or">[In]: geolocator.geocode("1 Apple Park Way, Cupertino, CA").point<br/>[Out]: Point(37.3337572, -122.0113815, 0.0)</span></pre><p id="606c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管响应 JSON 的结构将反映所使用的服务。Google 响应中的 Lat 和 Lon 存储在<code class="fe mj mk ml mm b">"geometry"."location"</code>中。但是 Geopy 为您做了这项工作，您只需读取<code class="fe mj mk ml mm b">.point</code>属性。</p><h2 id="5352" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">将地址列表转换为地理坐标</h2><p id="848e" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在地图上显示带有地址的数据集之前，您需要找到这些点的地理位置。让我们来看看这份地址名单:</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="625c" class="mn mo it mm b gy oo op l oq or">data = """Name,Address<br/>EU,"Rue de la Loi/Wetstraat 175, Brussel, Belgium"<br/>Apple,"1 Apple Park Way, Cupertino, CA"<br/>Google,"1600 Amphitheatre Parkway Mountain View, CA 94043"<br/>UN,"760 United Nations Plaza; Manhattan, New York City"<br/>"""</span></pre><p id="f761" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们知道我们可以使用 GeoPy 的<code class="fe mj mk ml mm b">geolocator.geocode</code>，但是将熊猫数据帧转换成坐标的最有效方法是什么呢？我喜欢 Abdishakur 在这篇文章中描述的方法</p><div class="nl nm gp gr nn no"><a rel="noopener follow" target="_blank" href="/geocode-with-python-161ec1e62b89"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">使用 Python 进行地理编码</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">如何将物理地址转换为地理位置→经纬度</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">towardsdatascience.com</p></div></div><div class="nx l"><div class="ov l nz oa ob nx oc ks no"/></div></div></a></div><ol class=""><li id="b442" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ow mb mc md bi translated">我将从我们的列表中创建一个熊猫数据框架</li></ol><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="02ef" class="mn mo it mm b gy oo op l oq or">df = pd.read_csv(io.StringIO(data))<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/824453f875537db2ea46db5700d893ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*iU8Ro2yhX9mjvJyt2sodzQ.jpeg"/></div></figure><p id="5ce1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.将<code class="fe mj mk ml mm b">geolocator.geocode</code>应用于地址栏</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="1e6c" class="mn mo it mm b gy oo op l oq or">df["loc"] = df["Address"].apply(geolocator.geocode)</span></pre><p id="0ad8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.从地理编码的响应中获取包含纬度和经度的<code class="fe mj mk ml mm b">.point</code>，如果它不是<code class="fe mj mk ml mm b">None</code>。</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="8046" class="mn mo it mm b gy oo op l oq or">df["point"]= df["loc"].apply(lambda loc: tuple(loc.point) if loc else None)</span></pre><p id="8f01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.将<code class="fe mj mk ml mm b">.point</code>拆分成单独的列<code class="fe mj mk ml mm b">'lat'</code> <code class="fe mj mk ml mm b">'lon'</code>和<code class="fe mj mk ml mm b">'altitude'</code></p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="4762" class="mn mo it mm b gy oo op l oq or">df[['lat', 'lon', 'altitude']] = pd.DataFrame(df['point'].to_list(), index=df.index)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/1be2103d237c3a69d1b4afe1a70539b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CBOI2c_HLpGzDbYiwTDlVg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">步骤 2-4 将从地理编码的响应中挖掘地理位置</p></figure><p id="2dea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集中有<code class="fe mj mk ml mm b">'lat'</code>和<code class="fe mj mk ml mm b">'loc'</code>列就足以在任何背景图上显示这些点。</p><h1 id="03c6" class="oz mo it bd mp pa pb pc ms pd pe pf mv jz pg ka my kc ph kd nb kf pi kg ne pj bi translated">将地理点转换为地图</h1><p id="ae17" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">地理坐标是没有用的，除非你把它们显示在地图上。Python 提供了几个库来使这项任务变得足够简单。</p><ul class=""><li id="8050" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://python-visualization.github.io/folium/" rel="noopener ugc nofollow" target="_blank">leave</a>库，使用<a class="ae ky" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank">leave . js</a>在<a class="ae ky" href="https://www.openstreetmap.org/" rel="noopener ugc nofollow" target="_blank"> OpenStreetMap </a>或任何其他地图数据提供者的顶部创建典型地图</li><li id="48b8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://plotly.com/" rel="noopener ugc nofollow" target="_blank"> plotly </a>使用其固有的地图数据</li></ul><h2 id="317d" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">用叶子创建地图</h2><p id="bf6e" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">树叶地图是交互式的，它们包含带有弹出窗口的标记，可以聚集在具有高密度点的区域中，您可以使用图层并选择不同的源地图。这很容易编码:</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="c085" class="mn mo it mm b gy oo op l oq or"># import the library and its Marker clusterization service<br/>import folium<br/>from folium.plugins import MarkerCluster</span><span id="1ed0" class="mn mo it mm b gy ou op l oq or"># Create a map object and center it to the avarage coordinates to m<br/>m = folium.Map(location=df[["lat", "lon"]].mean().to_list(), zoom_start=2)</span><span id="8f7e" class="mn mo it mm b gy ou op l oq or"># if the points are too close to each other, cluster them, create a cluster overlay with MarkerCluster, add to m<br/>marker_cluster = MarkerCluster().add_to(m)</span><span id="c1e9" class="mn mo it mm b gy ou op l oq or"># draw the markers and assign popup and hover texts<br/># add the markers the the cluster layers so that they are automatically clustered<br/>for i,r in df.iterrows():<br/>    location = (r["lat"], r["lon"])<br/>    folium.Marker(location=location,<br/>                      popup = r['Name'],<br/>                      tooltip=r['Name'])\<br/>    .add_to(marker_cluster)</span><span id="ce93" class="mn mo it mm b gy ou op l oq or"># display the map<br/>m</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/d2c727a05e1f01573429626c349b977d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JNgvbrkPiBBDahYWVLKBvg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一张有叶子的简单地图。硅谷聚集了太多的点。</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><h2 id="711c" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">使用 Plotly 创建地图</h2><p id="9149" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">Plotly 越来越受欢迎。因为它引入了 Plotly express 接口，所以创建图表是一个单独的线性过程，这也适用于地图图表。下面我们来看看如何用 Plotly 创建一个类似的地图。</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="97e6" class="mn mo it mm b gy oo op l oq or"># import the plotly express<br/>import plotly.express as px</span><span id="4ffa" class="mn mo it mm b gy ou op l oq or"># set up the chart from the df dataFrame<br/>fig = px.scatter_geo(df, <br/>                     # longitude is taken from the df["lon"] columns and latitude from df["lat"]<br/>                     lon="lon", <br/>                     lat="lat", <br/>                     # choose the map chart's projection<br/>                     projection="natural earth",<br/>                     # columns which is in bold in the pop up<br/>                     hover_name = "Name",<br/>                     # format of the popup not to display these columns' data<br/>                     hover_data = {"Name":False,<br/>                                   "lon": False,<br/>                                   "lat": False<br/>                                     }<br/>                     )</span></pre><p id="3d97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mj mk ml mm b">.scatter_geo(df)</code>根据测向数据帧中的数据在地图上创建点，如位置或弹出窗口。我们可以为每个数据点设置不同的大小或颜色，但我们在 df 数据帧中没有这样做，所以我们可以使用<code class="fe mj mk ml mm b">.update_traces()</code>为所有数据点指定相同的大小或颜色。</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="2c85" class="mn mo it mm b gy oo op l oq or">fig.update_traces(marker=dict(size=25, color="red"))</span></pre><p id="6fcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你不必像在 leav 中那样确定理想的缩放比例，只需将<code class="fe mj mk ml mm b">fitbounds</code>设置为“位置”即可。您还可以显示国家、河流、海洋、湖泊，并用<code class="fe mj mk ml mm b">.update_geos</code>指定它们的颜色。</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="95bc" class="mn mo it mm b gy oo op l oq or">fig.update_geos(fitbounds="locations", showcountries = True)</span></pre><p id="7685" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们使用<code class="fe mj mk ml mm b">.update_layout</code>添加一个标题，并通过<code class="fe mj mk ml mm b">fig.show()</code>显示最终的图表。</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="a22d" class="mn mo it mm b gy oo op l oq or">fig.update_layout(title = "Your customers")<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/2665d8b58824ce5fba4f75726783c959.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gu2ECGAD3qzXYfZ-_Eqlng.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个简单的地图。</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><h2 id="e0df" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">将地图导出到 html</h2><p id="eefe" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">欣赏笔记本中的地图可能会令人满意，但偶尔您希望与没有安装 python 的人共享您的工作。幸运的是将地图导出到。html 只有一行代码。</p><p id="ad02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Folium 的<code class="fe mj mk ml mm b">.save</code>方法创建了一个文件，该文件从 CDN 获得所有必要的资源，如 jquery、bootstrap、leaflet，并且该文件只有 8 KB。</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="9c4f" class="mn mo it mm b gy oo op l oq or">m.save("folium_map.html")</span></pre><p id="2d2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Plotly 使用带有几个可选参数的<code class="fe mj mk ml mm b">.write_html</code>命令。最重要的是<code class="fe mj mk ml mm b">include_plotlyjs</code>。您可以设置输出文件是否将包含超过 3 MB 的 plotly 库，以实现那些漂亮的图表效果，或者您是否只想要可以包含在另一个 plotly 项目中的数据点。在第二种情况下，大小将是 9 KB。</p><pre class="kj kk kl km gt ok mm ol om aw on bi"><span id="9773" class="mn mo it mm b gy oo op l oq or">fig.write_html("plotly_map.html", include_plotlyjs=True)</span></pre><h1 id="d50f" class="oz mo it bd mp pa pb pc ms pd pe pf mv jz pg ka my kc ph kd nb kf pi kg ne pj bi translated">结论</h1><p id="3220" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在地图上显示数据是展示公司数据的有效方式。Python 的库帮助我们快速收集必要的地理空间数据，并使用它们绘制地图。您可以使用开源数据或付费服务来完成这项任务。</p><p id="4fe9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你想寻找更多的灵感吗，试试 plotly 和 leav 地图集</p><div class="nl nm gp gr nn no"><a href="https://plotly.com/python/maps/" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">地图</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">Plotly 的 Python 图形库可以制作交互式、出版物质量的在线地图。如何使用…制作地图的示例</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">plotly.com</p></div></div><div class="nx l"><div class="pm l nz oa ob nx oc ks no"/></div></div></a></div><div class="nl nm gp gr nn no"><a href="https://nbviewer.jupyter.org/github/python-visualization/folium/tree/master/examples/" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">Jupyter 笔记本浏览器</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">编辑描述</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">nbviewer.jupyter.org</p></div></div></div></a></div><p id="ae02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您喜欢本教程吗，请查看我的其他关于各种数据相关主题的文章:</p><div class="nl nm gp gr nn no"><a rel="noopener follow" target="_blank" href="/complete-guide-to-pythons-cross-validation-with-examples-a9676b5cac12"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">python 交叉验证的完整指南及示例</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">sklearn 交叉验证的示例和使用案例解释了 k 折叠、洗牌、分层以及它如何影响…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">towardsdatascience.com</p></div></div><div class="nx l"><div class="pn l nz oa ob nx oc ks no"/></div></div></a></div><div class="nl nm gp gr nn no"><a rel="noopener follow" target="_blank" href="/dealing-with-extra-white-spaces-while-reading-csv-in-pandas-67b0c2b71e6a"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">阅读熊猫 CSV 时处理多余的空格</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">为什么我们关心空白？内置熊猫功能，自定义处理。创建 1M 测试数据和…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">towardsdatascience.com</p></div></div><div class="nx l"><div class="po l nz oa ob nx oc ks no"/></div></div></a></div></div></div>    
</body>
</html>