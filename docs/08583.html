<html>
<head>
<title>Random Forest for prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测用随机森林</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/random-forest-ca80e56224c1?source=collection_archive---------3-----------------------#2020-06-22">https://towardsdatascience.com/random-forest-ca80e56224c1?source=collection_archive---------3-----------------------#2020-06-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8bdb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用随机森林预测汽车价格</h2></div><p id="06c5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个在多个决策树之间操作的过程，通过选择其中的大多数作为最佳值来获得最佳结果。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/23d83edadbf7727514f5b0b5182e4b9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AlKlTj2t1SkKu6xeifcJHg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">有输出的多重决策树。(图片鸣谢:<a class="ae lr" href="https://easydrawingguides.com/" rel="noopener ugc nofollow" target="_blank">easydrawingguides.com</a>，作者编辑)</p></figure><p id="db16" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请将上面的图像视为具有不同结果的多个决策树的代表。在 4 个决策树中，3 个的输出与 1 相同，而一个决策树的输出为 0。应用上面提到的定义，随机森林操作四个决策树，并且为了获得最佳结果，它选择大多数(即 3 个)决策树提供的结果。因此，在这种情况下，最佳结果将是 1。</p><p id="50cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于决策树，您可以通过点击链接【https://towardsdatascience.com/decision-tree-ba64f977f7c3 T2】访问更早的故事</p><p id="8018" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">用途</strong></p><ol class=""><li id="41d4" class="ls lt iq kh b ki kj kl km ko lu ks lv kw lw la lx ly lz ma bi translated">遥感:随机森林(RF)通常用于遥感，以预测数据的准确性/分类。</li><li id="38e7" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">物体检测:射频在更短的时间内对物体检测起主要作用。</li></ol><p id="8427" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">为什么？</strong></p><ol class=""><li id="83bd" class="ls lt iq kh b ki kj kl km ko lu ks lv kw lw la lx ly lz ma bi translated">因为我们在多个决策树上工作，所以过度拟合的可能性较小。</li><li id="dc42" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">更高的准确性:因为它运行在更大的数据集上，所以准确性更高。</li><li id="6230" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">估计缺失数据:因为它运行在一个更大的数据集上，所以您也可以估计缺失值。</li></ol><p id="6f18" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">随机森林是如何工作的？</strong></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mg"><img src="../Images/76fb26a0277af4422ac54473b66c995f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yk3G7s4FSdZ-DjsArdiKdA.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">多重决策树(图片由作者提供)</p></figure><p id="d53f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上图中，我们使用 3 个不同的决策树进行了相同的分类。树 1 使用颜色对数据进行分类，树 2 使用花瓣大小和颜色，树 3 使用花瓣寿命和颜色。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/e7df2628f6134b4a2061a2833a994e54.png" data-original-src="https://miro.medium.com/v2/resize:fit:346/format:webp/1*SUrAFIZlgUQpc6TgrlQ1tQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">缺少颜色数据的花(图片来源:Vectorstock.com)</p></figure><p id="c533" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在模特训练有素。考虑到我们有一朵缺少颜色数据的花。树 1 将无法识别此数据，因为它用颜色对所有东西进行了分类，所以它会将其归入郁金香花类别。</p><p id="8e42" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">树 2:它作用于颜色和花瓣大小。根据花瓣的大小，它会变成假的，即不小，然后是颜色，即不是黄色。这是对它是一朵玫瑰的预测。</p><p id="db82" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">树 3:它对寿命和颜色有效。第一个分类将是一个错误的类别，随后是非黄色。正如预测的那样，这是一朵玫瑰。</p><p id="715a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们尝试使用 Python 随机森林。首先，我们将导入所需的 python 库。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="ef23" class="mn mo iq mj b gy mp mq l mr ms">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>%matplotlib inline</span></pre><p id="2601" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们正在进口熊猫、NumPy 和 matplotlib。接下来，我们将消费数据并查看它。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/5c6b40a67c2a059e2d4ebd5346bbe415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*D_b4_yysYmWjrrDPps4AYQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/825155073c29f0ea61f469acb2df5f81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*tmmSafBHRS-4GXaXV7PiXg.png"/></div></figure><p id="c6cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">df.head()将给出每一列的前 5 行的详细信息。我们可以使用 df.tail()获得最后 5 行，使用类似的 df.head(10)获得前 10 行。</p><p id="6e40" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据是关于汽车的，我们需要用上面的数据来预测汽车的价格</p><p id="bb9f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用随机森林来获得汽车的价格。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="ed62" class="mn mo iq mj b gy mp mq l mr ms">df.dtypes</span><span id="0004" class="mn mo iq mj b gy mv mq l mr ms">symboling              int64<br/>normalized-losses      int64<br/>make                  object<br/>aspiration            object<br/>num-of-doors          object<br/>body-style            object<br/>drive-wheels          object<br/>engine-location       object<br/>wheel-base           float64<br/>length               float64<br/>width                float64<br/>height               float64<br/>curb-weight            int64<br/>engine-type           object<br/>num-of-cylinders      object<br/>engine-size            int64<br/>fuel-system           object<br/>bore                 float64<br/>stroke               float64<br/>compression-ratio    float64<br/>horsepower           float64<br/>peak-rpm             float64<br/>city-mpg               int64<br/>highway-mpg            int64<br/>price                float64<br/>city-L/100km         float64<br/>horsepower-binned     object<br/>diesel                 int64<br/>gas                    int64<br/>dtype: object</span></pre><p id="94d9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">dtypes 给出列的数据类型。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="cbac" class="mn mo iq mj b gy mp mq l mr ms">df.describe()</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/314059c7691e2053e1b357040be5b765.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*DzhzR8CuGIoevXralFNi2g.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="4084" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的数据框中，所有的列都不是数字。因此，我们将只考虑那些数值为数字的列，并使所有的数字都浮动。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="e1ff" class="mn mo iq mj b gy mp mq l mr ms">df.dtypes<br/>for x <strong class="mj ir">in</strong> df:<br/>    if df[x].dtypes == "int64":<br/>        df[x] = df[x].astype(float)<br/>        print (df[x].dtypes)</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/26618ce149d48544e117260807050b35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*JwsEBAQkel0QV0wwcAvxiA.png"/></div></figure><p id="ec25" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">准备数据与分类任务一样，在本节中，我们将把数据划分为属性和标签，从而划分为训练集和测试集。我们将创建 2 个数据集，一个用于价格，另一个(df-price)。由于我们的数据框包含大量对象格式的数据，因此在本次分析中，我们将删除所有对象类型的列，对于所有 NaN 值，我们将删除该行。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="a10b" class="mn mo iq mj b gy mp mq l mr ms">df = df.select_dtypes(exclude=['object'])<br/>df=df.fillna(df.mean())<br/>X = df.drop('price',axis=1)<br/>y = df['price']</span></pre><p id="0884" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，X 变量包含数据集中的所有列，除了标签“价格”列。y 变量包含“价格”列中的值，这意味着 X 变量包含属性集，y 变量包含相应的标签。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="241d" class="mn mo iq mj b gy mp mq l mr ms">from sklearn.model_selection import train_test_split<br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=0)</span></pre><p id="60d7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了训练树，我们将使用 Random Forest 类并用 fit 方法调用它。我们将有一个随机的 1000 棵决策树的森林。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="3931" class="mn mo iq mj b gy mp mq l mr ms">from sklearn.ensemble import RandomForestRegressor<br/>regressor = RandomForestRegressor(n_estimators = 1000, random_state = 42)<br/>regressor.fit(X_train, y_train)</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi my"><img src="../Images/51ad3cf8d53d597fe41c3349b952b227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*yvdU1g1eGr49vXw24su-uw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="5495" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们来预测一下价格。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="963a" class="mn mo iq mj b gy mp mq l mr ms">y_pred = regressor.predict(X_test)</span></pre><p id="be70" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们检查实际值和预测值之间的差异。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="9d5f" class="mn mo iq mj b gy mp mq l mr ms">df=pd.DataFrame({'Actual':y_test, 'Predicted':y_pred})<br/>df</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/775082b59707f818ac4a4d45f89c2511.png" data-original-src="https://miro.medium.com/v2/resize:fit:430/format:webp/1*6eNtL1sCVC8pai0vVh1CeA.png"/></div></figure><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="e897" class="mn mo iq mj b gy mp mq l mr ms">from sklearn import metrics<br/>print('Mean Absolute Error:', metrics.mean_absolute_error(y_test, y_pred))<br/>print('Mean Squared Error:', metrics.mean_squared_error(y_test, y_pred))<br/>print('Root Mean Squared Error:', np.sqrt(metrics.mean_squared_error(y_test, y_pred)))</span><span id="c05f" class="mn mo iq mj b gy mv mq l mr ms">Mean Absolute Error: 1993.2901175839186<br/>Mean Squared Error: 9668487.223350348<br/>Root Mean Squared Error: 3109.4191134921566</span></pre><p id="e1dd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们算法的平均绝对误差是 1993.2901175839186，小于“价格”列中所有值平均值的 20%。这意味着我们的算法做出了预测，但还需要很多改进。</p><p id="9136" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们检查一下我们预测的准确性。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="87ec" class="mn mo iq mj b gy mp mq l mr ms"><em class="na"># Calculate the absolute errors</em><br/>errors = abs(y_pred - y_test)<br/><em class="na"># Print out the mean absolute error (mae)</em><br/>print('Mean Absolute Error:', round(np.mean(errors), 2), 'degrees.')<br/><br/><em class="na"># Calculate mean absolute percentage error (MAPE)</em><br/>mape = 100 * (errors / y_test)<br/><em class="na"># Calculate and display accuracy</em><br/>accuracy = 100 - np.mean(mape)<br/>print('Accuracy:', round(accuracy, 2), '%.')</span><span id="4093" class="mn mo iq mj b gy mv mq l mr ms">Mean Absolute Error: 1993.29 degrees.<br/>Accuracy: 87.87 %.</span></pre><p id="9875" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">87.8%的准确率并不是一个很高的分数，还有很大的提升空间。</p><p id="c278" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们画出实际值和预测值之间的差异。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="b055" class="mn mo iq mj b gy mp mq l mr ms">import seaborn as sns<br/>plt.figure(figsize=(5, 7))<br/><br/><br/>ax = sns.distplot(y, hist=False, color="r", label="Actual Value")<br/>sns.distplot(y_pred, hist=False, color="b", label="Fitted Values" , ax=ax)<br/><br/><br/>plt.title('Actual vs Fitted Values for Price')<br/><br/><br/>plt.show()<br/>plt.close()</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/57512b3e6caa9103d1563b90f751089f.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/1*DiI8xeUJEUjK2evrDGgrtA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">实际与预测(图片由作者提供)</p></figure><p id="1ea4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以上是实际值和预测值之间的曲线图。让我们想象一下随机的森林树。</p><pre class="lc ld le lf gt mi mj mk ml aw mm bi"><span id="f38c" class="mn mo iq mj b gy mp mq l mr ms">import pydot<br/><em class="na"># Pull out one tree from the forest</em><br/>Tree = regressor.estimators_[5]<br/><em class="na"># Export the image to a dot file</em><br/>from sklearn import tree<br/>plt.figure(figsize=(25,15))<br/>tree.plot_tree(Tree,filled=True, <br/>              rounded=True, <br/>              fontsize=14);</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/da426308ed65bae765217aa24eb81765.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*03cYLaghkvIZ9tgWDbOnXg.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">随机森林树(作者图片)</p></figure><p id="75fa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以在<a class="ae lr" href="https://www.kaggle.com/adityakumar529/random-forest" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/adityakumar529/random-forest</a>处检查代码。</p><p id="db03" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lr" href="https://github.com/adityakumar529/Coursera_Capstone/blob/master/Random_forest.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/adityakumar 529/Coursera _ Capstone/blob/master/Random _ forest . ipynb</a></p></div></div>    
</body>
</html>