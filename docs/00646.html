<html>
<head>
<title>Using Google BigQuery to Analyze Data from the EBI Small Molecules Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google BigQuery分析EBI小分子数据库的数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-google-bigquery-to-analyze-data-from-the-ebi-small-molecules-database-2dcabdc73bc9?source=collection_archive---------32-----------------------#2020-01-18">https://towardsdatascience.com/using-google-bigquery-to-analyze-data-from-the-ebi-small-molecules-database-2dcabdc73bc9?source=collection_archive---------32-----------------------#2020-01-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a5f6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">分析欧洲生物信息学研究所CheMBL数据集</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f83e2c3f1c9a16198ef152ff8a5a9a10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K--e3R7aPMrk5ZJ0vrMN6Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">曼努埃尔·盖辛格在<a class="ae ky" href="https://www.pexels.com/photo/interior-of-office-building-325229/" rel="noopener ugc nofollow" target="_blank">的照片</a></p></figure><p id="d2ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CheMBL是一个生物活性分子的药物发现数据库。它汇集了化学、生物活性和基因组学信息，目标是帮助将基因组信息转化为有效的新药。在这篇文章中，我们将对CheMBL数据库中的数据样本进行探索性的数据分析。</p><p id="af8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要访问这些数据，您需要创建一个Google Cloud帐户，安装Google BigQuery并生成认证凭证。操作说明可以在<a class="ae ky" href="https://cloud.google.com/bigquery/docs/bigquery-storage-python-pandas" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="5f11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><p id="c4a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们导入必要的google身份验证和BigQuery包:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="132b" class="ma mb it lw b gy mc md l me mf">from google.oauth2 import service_account<br/>from google.cloud import bigquery</span></pre><p id="83a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要导入熊猫并将列设置定义为“None”。我们这样做是为了显示所有的列，因为pandas默认情况下会截断它们。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3807" class="ma mb it lw b gy mc md l me mf">import pandas as pd<br/>pd.set_option("display.max_columns", None)</span></pre><p id="a48d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们定义密钥路径、客户端凭证和客户端对象:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8ec5" class="ma mb it lw b gy mc md l me mf">key_path = "key_path/key.json"</span><span id="211c" class="ma mb it lw b gy mg md l me mf">credentials = service_account.Credentials.from_service_account_file(<br/>    key_path,<br/>    scopes=["<a class="ae ky" href="https://www.googleapis.com/auth/cloud-platform" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/cloud-platform</a>"],<br/>)</span><span id="6e9b" class="ma mb it lw b gy mg md l me mf">client = bigquery.Client(<br/>    credentials=credentials,<br/>    project=credentials.project_id,<br/>)</span></pre><p id="6feb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们定义数据集引用，其中我们传入数据库的名称“ebi_chembl”和项目的名称“patents-public-data”:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7673" class="ma mb it lw b gy mc md l me mf">dataset_ref = client.dataset("ebi_chembl", project="patents-public-data")<br/></span></pre><p id="e03d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看看有空的桌子。共有229张桌子，但我们将查看前10张桌子的名称:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b75b" class="ma mb it lw b gy mc md l me mf">columns = [x.table_id for x in client.list_tables(dataset_ref)][:10]<br/>print(columns)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/97524817e3a8d6e888e5a1314579e247.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hAfS7f48-hpQSRoQgbkkpQ.png"/></div></div></figure><p id="1fd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看列表中的第一个元素“action_type”:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2714" class="ma mb it lw b gy mc md l me mf">table_ref = dataset_ref.table('action_type')<br/>table = client.get_table(table_ref)</span></pre><p id="5fdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以将结果存储在数据帧中，并打印前五行:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2bbf" class="ma mb it lw b gy mc md l me mf">df = client.list_rows(table).to_dataframe()<br/>print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/cbfb1d2603e94a07239cbe0a30322d65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JpRzSj1zr_Si2tGS_Xtklg.png"/></div></div></figure><p id="f6bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以从python中的collections模块导入counter方法来分析动作类型的分布:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7707" class="ma mb it lw b gy mc md l me mf">from collections import Counter<br/>print(Counter(df['action_type'].values))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/afde6ce4e7fbb93258a8228da84ef9b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LXFH46bwE7vr-8dhyBrySg.png"/></div></div></figure><p id="aa99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看接下来的十张表，看看是否有更详细的信息:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9f75" class="ma mb it lw b gy mc md l me mf">columns = [x.table_id for x in client.list_tables(dataset_ref)][10:20]<br/>print(columns)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/2856b3e777eab9c8493c240bcdc04f03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T5U0f5e7rOv_wtZEYfasOQ.png"/></div></div></figure><p id="3ef6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一下“化验分类”表:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="57c8" class="ma mb it lw b gy mc md l me mf">table_ref = dataset_ref.table('assay_classification')<br/>table = client.get_table(table_ref)</span><span id="b61b" class="ma mb it lw b gy mg md l me mf">df = client.list_rows(table).to_dataframe()<br/>print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/75bd7ebf7d28a48a8c3ba20f64566aa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rb5blY0UDwDaPI_4pKur5A.png"/></div></div></figure><p id="6bd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用计数器来看看“l1”最常见的3个值:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0960" class="ma mb it lw b gy mc md l me mf">from collections import Counter<br/>print(Counter(df['l1'].values).most_common(3))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/8200e7bf9345309d2f2cbdcb1a6fed6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6BMoco_xEZmNkNE4IEwUUA.png"/></div></div></figure><p id="dad4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于“l2”:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="397e" class="ma mb it lw b gy mc md l me mf">from collections import Counter<br/>print(Counter(df['l2'].values).most_common(3))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/6a58cfb5dff2d5b99aead3466ed1ca11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xYkq_oeGdQddP7C5fPLsBQ.png"/></div></div></figure><p id="2e6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以将这些输出可视化。让我们定义一个函数，它将类别字符串作为输入，并显示三个最常见值的条形图:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a9ed" class="ma mb it lw b gy mc md l me mf">def plot_most_common(category):<br/>    bar_plot = dict(Counter(df[category].values).most_common(3))<br/>    plt.bar(*zip(*bar_plot.items()))<br/>    plt.show()</span></pre><p id="dd81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们用“l1”调用函数:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="fcf6" class="ma mb it lw b gy mc md l me mf">plot_most_common('l1')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/e584c2de78d0767d95f1a33096aff7cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*njciQ8qy91Tye8ZCEhTfPA.png"/></div></div></figure><p id="0b18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和“l2”:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d53a" class="ma mb it lw b gy mc md l me mf">plot_most_common('l2')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/6b1c3ccc8a3f9f767dcc98786a51f10e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IqjJXc8hTnhGMwqmR9Vupg.png"/></div></div></figure><p id="51de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们讨论了如何使用Google BigQuery访问欧洲生物信息学研究所CheMBL数据库。该数据库包含化学，生物活性和基因组信息，可以帮助小分子药物的发现。我们对action_type和assay_classification表进行了一些基本分析，并生成了一些可视化结果。这篇文章的代码可以在<a class="ae ky" href="https://github.com/spierre91/medium_code" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。感谢您的阅读！</p></div></div>    
</body>
</html>