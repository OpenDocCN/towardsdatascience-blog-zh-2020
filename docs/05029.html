<html>
<head>
<title>A detailed explanation of the Attention U-Net</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">注意 U-Net 的详细说明</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-detailed-explanation-of-the-attention-u-net-b371a5590831?source=collection_archive---------7-----------------------#2020-05-01">https://towardsdatascience.com/a-detailed-explanation-of-the-attention-u-net-b371a5590831?source=collection_archive---------7-----------------------#2020-05-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="b631" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">U-网中的注意门</h2><div class=""/><div class=""><h2 id="7f3c" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">了解新颖的注意力门，它可以自动聚焦于图像中的目标结构</h2></div><p id="42ba" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在这个故事中，我解释了 Oktay 等人写的<a class="ae ln" href="https://arxiv.org/abs/1804.03999" rel="noopener ugc nofollow" target="_blank"> Attention U-Net:学习在哪里寻找胰腺</a>中的 Attention U-Net。艾尔。该论文写于 2018 年，提出了一种新颖的注意力门(AG)机制，允许 U-Net 专注于不同大小和形状的目标结构。</p></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="a088" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated">概述</h1><ol class=""><li id="e70d" class="mn mo it kt b ku mp kx mq la mr le ms li mt lm mu mv mw mx bi translated">什么是注意力？</li><li id="bad7" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">为什么 U-Net 需要关注</li><li id="26c8" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">注意力是如何实现的？</li><li id="72f9" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">分析</li></ol></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="13d1" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated">1.什么是注意力？</h1><p id="b49b" class="pw-post-body-paragraph kr ks it kt b ku mp kd kw kx mq kg kz la nd lc ld le ne lg lh li nf lk ll lm im bi translated">在图像分割的背景下，注意力是一种在训练期间仅突出相关激活的方式。这减少了浪费在无关激活上的计算资源，为网络提供了更好的泛化能力。本质上，网络可以“关注”图像的某些部分。</p><p id="f4c4" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">答:努力关注</strong></p><p id="6121" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">注意力有两种形式，<strong class="kt jd">硬</strong>和<strong class="kt jd">软</strong>。硬注意的工作原理是通过裁剪图像或迭代区域提议来突出相关区域。由于硬注意一次只能选择一个图像的一个区域，所以它有两层含义，它是不可微的，需要强化学习来训练。</p><p id="fb4b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">由于它是不可微的，这意味着对于图像中的给定区域，网络可以“关注”或不关注，没有中间状态。因此，无法进行标准的反向传播，需要蒙特卡罗采样来计算反向传播各个阶段的精度。考虑到准确性取决于采样的好坏，因此需要其他技术(如强化学习)来使模型有效。</p><p id="bafe" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> b .软注意</strong></p><p id="d63b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">软注意通过对图像的不同部分进行加权来工作。高相关性区域乘以较大的权重，低相关性区域用较小的权重标记。随着模型被训练，更多的焦点被给予具有较高权重的区域。与硬注意不同，这些权重可以应用于图像中的许多小块。</p><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi ng"><img src="../Images/f3644847be98da521cfc0bcf557a168d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jOQ3BdjoRKbVtG-n8tPycw.png"/></div></div><p class="ns nt gj gh gi nu nv bd b be z dk translated">当处理句子中的不同单词时，图像上的软注意力权重的可视化。较亮的区域具有较高的权重。<a class="ae ln" href="http://proceedings.mlr.press/v37/xuc15.pdf" rel="noopener ugc nofollow" target="_blank">(徐等，2015) </a></p></figure><p id="414c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">由于软注意的确定性，它仍然是可区分的，可以用标准的反向传播来训练。随着模型被训练，权重也被训练，使得模型在决定关注哪些部分方面变得更好。</p><p id="4a2b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">强烈关注:</p><ol class=""><li id="aba0" class="mn mo it kt b ku kv kx ky la nw le nx li ny lm mu mv mw mx bi translated">一次只挑补丁注意</li><li id="2503" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">不可微，需要强化学习</li></ol><p id="236c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">软性关注:</p><ol class=""><li id="d36f" class="mn mo it kt b ku kv kx ky la nw le nx li ny lm mu mv mw mx bi translated">对图像的不同块进行加权以确定相关性</li><li id="d1cd" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">可微分的，可以用反向传播来训练</li></ol></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="148c" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated">2.为什么在 U-Net 中需要注意力？</h1><p id="8f1f" class="pw-post-body-paragraph kr ks it kt b ku mp kd kw kx mq kg kz la nd lc ld le ne lg lh li nf lk ll lm im bi translated">为了理解为什么注意力在 U-Net 中是有益的，我们需要看看所使用的跳跃连接。</p><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/40d93306512d58695f4bda083c01fe77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*P8_bEkGZ_wtCjqkcugaTmw.png"/></div><p class="ns nt gj gh gi nu nv bd b be z dk translated">灰色箭头表示 U 形网络中使用的长跳线连接。<a class="ae ln" href="https://arxiv.org/abs/1505.04597" rel="noopener ugc nofollow" target="_blank"> (Ronneberger 等人，2015) </a></p></figure><p id="fd18" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在扩展路径中的上采样期间，重新创建的空间信息是不精确的。为了解决这个问题，U-Net 使用跳过连接，将来自下采样路径的空间信息与上采样路径相结合。然而，这带来了许多冗余的低级特征提取，因为初始层中的特征表示很差。</p><p id="931c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">在跳过连接处实施的软</strong>注意将主动抑制不相关区域中的激活，减少带来的冗余特征的数量。</p></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="8285" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated">3.注意力是如何实现的？</h1><p id="b89e" class="pw-post-body-paragraph kr ks it kt b ku mp kd kw kx mq kg kz la nd lc ld le ne lg lh li nf lk ll lm im bi translated">Oktay 等人推出的注意门使用的是<strong class="kt jd">加性软</strong>注意。</p><p id="b678" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> a .注意门的故障</strong></p><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/87f93f37125960a9f4bce52a0a261ddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*wCeLHKdHbIkwry36Nx5HrA.png"/></div><p class="ns nt gj gh gi nu nv bd b be z dk translated"><strong class="bd ob">顶部</strong>:注意门(AG)示意图。<strong class="bd ob">底部</strong>:AGs 是如何在每个 skip 连接上实现的。</p></figure><ol class=""><li id="7f63" class="mn mo it kt b ku kv kx ky la nw le nx li ny lm mu mv mw mx bi translated">注意力门接受两个输入，向量<strong class="kt jd"> <em class="oc"> x </em> </strong> <em class="oc"> </em>和<strong class="kt jd"> <em class="oc"> g </em> </strong>。</li><li id="1969" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">向量<strong class="kt jd"> <em class="oc"> g </em> </strong>取自网络的下一个最低层。该矢量具有更小的维度和更好的特征表示，因为它来自网络的更深处。</li><li id="3854" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">在上面的示例图中，矢量<strong class="kt jd"><em class="oc">×矢量</em>×矢量</strong>的尺寸为 64×64×64(滤镜×高度×宽度)，矢量<strong class="kt jd">×g×T33】的尺寸为 32×32×32。</strong></li><li id="932b" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">向量<strong class="kt jd"> <em class="oc"> x </em> </strong>经过步长卷积，其尺寸变为 64×32×32，向量<strong class="kt jd"> <em class="oc"> g </em> </strong>经过 1×1 卷积，其尺寸变为 64×32×32。</li><li id="ad44" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">这两个向量按元素求和。该过程导致<strong class="kt jd">对齐的权重变大</strong>，而非对齐的权重变得相对较小。</li><li id="5dae" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">合成向量经过 ReLU 激活层和 1x1 卷积，将维度折叠为 1x32x32。</li><li id="0008" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">这个向量经过一个 sigmoid 层，该层在范围[0，1]之间缩放向量，产生注意系数(权重)，其中系数越接近 1 表示越相关的特征。</li><li id="b1b5" class="mn mo it kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">使用三线性插值将关注系数上采样到矢量<strong class="kt jd"><em class="oc">×矢量</em> </strong>的原始尺寸(64×64)。关注系数被逐元素地乘以<strong class="kt jd">原始</strong> <strong class="kt jd"> <em class="oc"> x </em> </strong>向量，根据相关性缩放该向量。然后像往常一样在 skip 连接中传递。</li></ol><p id="f826" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">Oktay 等人还提出了一种基于网格的门控机制，该机制从上采样路径而不是下采样路径(除了最低层)获取<strong class="kt jd"> <em class="oc"> g </em> </strong>向量，因为该向量已经通过先前的注意门被调节到来自多个尺度的空间信息。</p><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi od"><img src="../Images/84a9ed98511a7e37f56ebb73234c8cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*ELpa5SFtkXZacCPcWu1PAw.png"/></div><p class="ns nt gj gh gi nu nv bd b be z dk translated">注意系数在 3、6、10 和 150 个时期显现，其中红色突出了较高的注意系数。(Oktay et。阿尔，2018)</p></figure><p id="5aa2" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如上图所示，随着训练的进行，网络学会聚焦于所需的区域。注意门的可微分性质允许它在反向传播期间被训练，这意味着注意系数在突出相关区域方面变得更好。</p><p id="5f84" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> b .在 Keras 的实施情况</strong></p><figure class="nh ni nj nk gt nl"><div class="bz fp l di"><div class="oe of l"/></div></figure></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="8fcb" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated">4.分析</h1><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi og"><img src="../Images/ff8dc8ee433902c58f31cfda329548fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wi4PHS0-ZGM_Ti0O4uJeNQ.png"/></div></div><p class="ns nt gj gh gi nu nv bd b be z dk translated">CT-150 数据集上的结果(Oktay 等人，2018 年)</p></figure><p id="ec36" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">Oktay 等人获得的结果表明，在整体骰子系数得分方面，注意力 U-Net 比普通 U-Net 的表现好得多。虽然注意 U-Net 有更多的参数，但并没有显著增加，推理时间也只是略微延长。</p><p id="4f35" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">总之，注意门是一种在大量数据集上一致地改进 U-Net 的简单方法，并且在计算成本方面没有显著的开销。</p><p id="d4ff" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">要获得预先实施了注意力、递归和初始层的 U-Net 的完整实施，请检查<a class="ae ln" href="https://github.com/robinvvinod/unet/" rel="noopener ugc nofollow" target="_blank">https://github.com/robinvvinod/unet/</a>。</p></div></div>    
</body>
</html>