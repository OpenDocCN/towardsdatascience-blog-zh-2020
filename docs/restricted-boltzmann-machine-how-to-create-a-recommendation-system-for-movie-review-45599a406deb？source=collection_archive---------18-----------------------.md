# ä½œä¸ºç”µå½±è¯„è®ºæ¨èç³»ç»Ÿçš„å—é™ç»å°”å…¹æ›¼æœºå™¨åˆ›é€ (ä¸Š)

> åŸæ–‡ï¼š<https://towardsdatascience.com/restricted-boltzmann-machine-how-to-create-a-recommendation-system-for-movie-review-45599a406deb?source=collection_archive---------18----------------------->

## å…³äºå—é™æ³¢å°”å…¹æ›¼æœºå™¨çš„ç›´è§‚ä»‹ç»ä»¥åŠä½¿ç”¨ç”µå½±åˆ†çº§æ•°æ®è¿›è¡Œæ¨¡å‹è®­ç»ƒçš„è¯¦ç»†æ•°æ®å¤„ç†æ­¥éª¤

![](img/5b9e5dfeb6777fe2e2f4f9d77faefdd4.png)

é€šè¿‡[é“¾æ¥](https://unsplash.com/photos/CiUR8zISX60)æ”¹ç¼–è‡ª unsplash çš„ Img

è¿™æ˜¯å¦‚ä½•å»ºç«‹ä¸€ä¸ªå—é™æ³¢å°”å…¹æ›¼æœºå™¨(RBM)ä½œä¸ºæ¨èç³»ç»Ÿçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚è¿™é‡Œé‡ç‚¹æ˜¯**æ•°æ®å¤„ç†**ã€‚

> æ‚¨å°†å­¦ä¹ å¦‚ä½•å°†åŸå§‹ç”µå½±åˆ†çº§æ•°æ®è½¬æ¢ä¸ºå‡†å¤‡è®­ç»ƒ RBM æ¨¡å‹çš„æ•°æ®ã€‚å®ƒåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ã€‚

1.  RBM ç®€ä»‹
2.  é—®é¢˜é™ˆè¿°
3.  æ•°æ®å¤„ç†

ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹æ—…ç¨‹ğŸƒâ€â™‚ï¸ğŸƒâ€â™€ï¸.

1.  **RBM ç®€ä»‹**

é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»ç»å°”å…¹æ›¼æœº(BM)è¯´èµ·ã€‚BM æ˜¯ä¸€ç§æ— ç›‘ç£çš„ç¥ç»ç½‘ç»œã€‚å¦‚å›¾ 1 æ‰€ç¤ºï¼ŒBM æœ‰ä¸‰ä¸ªæ˜æ˜¾çš„ç‰¹å¾ã€‚

*   æ²¡æœ‰è¾“å‡ºå›¾å±‚
*   è¿æ¥ä¹‹é—´æ²¡æœ‰æ–¹å‘
*   æ¯ä¸ªç¥ç»å…ƒå½¼æ­¤ç´§å¯†ç›¸è¿ï¼Œç”šè‡³åœ¨è¾“å…¥èŠ‚ç‚¹(å¯è§èŠ‚ç‚¹)ä¹‹é—´ä¹Ÿæ˜¯å¦‚æ­¤

![](img/902ab051083d72f8662fae9931745673.png)

å›¾ 1 ç»å°”å…¹æ›¼æœºå™¨å›¾(ä½œè€…åˆ›å»ºçš„ Img)

> ä¸ºä»€ä¹ˆ BM è¿™ä¹ˆç‰¹åˆ«ï¼Ÿä»æ ¹æœ¬ä¸Šè¯´ï¼ŒBM å¹¶ä¸æœŸå¾…æŠ•å…¥ã€‚ç›¸åï¼Œå®ƒè‡ªå·±ç”Ÿæˆæ¨¡å‹çš„çŠ¶æ€æˆ–å€¼ã€‚å› æ­¤ï¼ŒBM æ˜¯ä¸€ä¸ªç”Ÿæˆæ€§æ¨¡å‹ï¼Œè€Œä¸æ˜¯ç¡®å®šæ€§æ¨¡å‹ã€‚BM ä¸åŒºåˆ†å¯è§èŠ‚ç‚¹å’Œéšè—èŠ‚ç‚¹ã€‚å¯è§èŠ‚ç‚¹åªæ˜¯æˆ‘ä»¬åº¦é‡å€¼çš„åœ°æ–¹ã€‚

> ç„¶è€Œï¼ŒBM æœ‰ä¸€ä¸ªé—®é¢˜ã€‚éšç€èŠ‚ç‚¹æ•°é‡çš„å¢åŠ ï¼Œè¿æ¥çš„æ•°é‡å‘ˆæŒ‡æ•°å¢é•¿ï¼Œè¿™ä½¿å¾—ä¸å¯èƒ½è®¡ç®—å®Œæ•´çš„ BMã€‚å› æ­¤ï¼Œå»ºè®®é‡‡ç”¨ RBMï¼Œå¦‚å›¾ 2 æ‰€ç¤ºã€‚

![](img/de9c8f32c33c233a6290093f29893579.png)

å›¾ 2 å—é™ç»å°”å…¹æ›¼æœºå™¨å›¾(ä½œè€…åˆ›å»ºçš„ Img)

ä¸å®Œå…¨ BM ç›¸æ¯”ï¼ŒRBM ä¸å…è®¸éšè—èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å’Œå¯è§èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ã€‚è¿™æ˜¯å”¯ä¸€çš„åŒºåˆ«ğŸ“£ğŸ“£ã€‚

é€šè¿‡è®­ç»ƒè¿‡ç¨‹ï¼Œæˆ‘ä»¬å‘ RBM è¾“å…¥å¤§é‡æ•°æ®ï¼ŒRBM å­¦ä¼šäº†å¦‚ä½•åˆ†é…æ¯ä¸ªéšè—èŠ‚ç‚¹æ¥è¡¨ç¤ºç”µå½±çš„ç‰¹å¾ï¼Œå¦‚æµæ´¾ã€æ¼”å‘˜ã€å¯¼æ¼”ç­‰ã€‚æ¢å¥è¯è¯´ï¼Œè°ƒæ•´æ¯ä¸ªèŠ‚ç‚¹çš„æƒé‡ï¼Œä½¿å¾—éšè—èŠ‚ç‚¹æ›´å¥½åœ°åæ˜ ç‰¹å¾ã€‚

å…·ä½“æ¥è¯´ï¼ŒRBM å°†æ¥å—ä»å¯è§èŠ‚ç‚¹åˆ°éšè—èŠ‚ç‚¹çš„è¾“å…¥ã€‚å®ƒå°è¯•åŸºäºéšè—èŠ‚ç‚¹å€¼æ¥é‡æ„è¾“å…¥å€¼ã€‚å¦‚æœé‡æ„å€¼ä¸æ­£ç¡®ï¼Œåˆ™è°ƒæ•´æƒé‡ï¼ŒRBM å†æ¬¡é‡æ„è¾“å…¥ã€‚æœ€åï¼ŒRBM è¢«è®­ç»ƒæˆæœ€èƒ½ä»£è¡¨ç”Ÿæˆæ‰€æœ‰æ•°æ®çš„ç³»ç»Ÿã€‚å¥½å¤„æ˜¯æ‰€æœ‰æƒé‡éƒ½ç»è¿‡ä¼˜åŒ–ï¼ŒRBM å¯ä»¥äº†è§£ç³»ç»Ÿçš„æ­£å¸¸å’Œå¼‚å¸¸æƒ…å†µã€‚

2.**é—®é¢˜é™ˆè¿°**

ç»™å‡ºå¤§é‡çš„ç”µå½±åˆ†çº§æ•°æ®æ¥å»ºç«‹ RBMã€‚ä»»åŠ¡æ˜¯é¢„æµ‹ä¸€ä¸ªç”¨æˆ·å–œæ¬¢ä¸€éƒ¨ç”µå½±æ˜¯ 1ï¼Œä¸å–œæ¬¢æ˜¯ 0ã€‚

3.**æ•°æ®å¤„ç†**

æ•°æ® *MovieLens 100K ç”µå½±æ”¶è§†ç‡*æ¥è‡ª*ç¾¤é•œå¤´ç ”ç©¶*è¿™é‡Œã€‚ç®€å•çœ‹ä¸€ä¸‹å›¾ 3 ä¸­çš„æ•°æ®ï¼Œ **Movies** æ•°æ®åŒ…å«ç”µå½±çš„åç§°å’Œç±»å‹ï¼Œ **Ratings** æ•°æ®åŒ…å«ç”¨æˆ· IDã€ç”µå½± IDã€ä» 0 åˆ° 5 çš„ç”¨æˆ·è¯„çº§å’Œæ—¶é—´æˆ³ï¼Œ **User** æ•°æ®åŒ…å«ç”¨æˆ· IDã€æ€§åˆ«ã€å¹´é¾„ã€å·¥ä½œä»£ç å’Œé‚®æ”¿ç¼–ç ã€‚

![](img/6e56beaf66fb0dca0154471e3b75870c.png)

å›¾ 3 æºæ•°æ®é›†ç‰‡æ®µ

3.1 å¯¼å…¥æ•°æ®

æ•°æ®é›†åŒ…å« 80ï¼Œ000 è¡Œè®­ç»ƒé›†å’Œ 20ï¼Œ000 è¡Œæµ‹è¯•é›†ã€‚è®©æˆ‘ä»¬è¯»ä¸€è¯»ã€‚å…·ä½“æ¥è¯´ï¼Œ

```
training_set = pd.read_csv(â€˜ml-100k/u1.baseâ€™, delimiter = â€˜\tâ€™)
training_set = np.array(training_set, dtype = â€˜intâ€™)test_set = pd.read_csv(â€˜ml-100k/u1.testâ€™, delimiter = â€˜\tâ€™)
test_set = np.array(test_set, dtype = â€˜intâ€™)
```

**æ³¨æ„ï¼Œæˆ‘ä»¬å°† Dataframe è½¬æ¢ä¸º Numpy æ•°ç»„ï¼Œå› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨ Pytorch å¼ é‡ï¼Œå®ƒéœ€è¦æ•°ç»„ä½œä¸ºè¾“å…¥ã€‚**å›¾ 4 æ˜¾ç¤ºäº†è®­ç»ƒ/æµ‹è¯•é›†ï¼ŒåŒ…æ‹¬ç”¨æˆ· IDã€ç”µå½± IDã€è¯„çº§å’Œæ—¶é—´æˆ³(å¯¹äºæ¨¡å‹è®­ç»ƒæ˜¯ä¸å¯é€†çš„)ã€‚

![](img/f0fb657d015a91ab43ffcb0c0f67e148.png)

å›¾ 4 è®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†ç‰‡æ®µ

3.2 æ•°æ®ç»“æ„åˆ›å»º

> **ä¸ºäº†å‡†å¤‡è®­ç»ƒ/æµ‹è¯•æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä»¥æ•°ç»„æ ¼å¼åˆ›å»ºè®­ç»ƒ/æµ‹è¯•é›†ï¼Œæ¯è¡Œä»£è¡¨ä¸€ä¸ªç”¨æˆ·ï¼Œè¡Œä¸­çš„æ¯ä¸ªå•å…ƒæ ¼ä»£è¡¨æ¯éƒ¨ç”µå½±çš„è¯„çº§ã€‚**è¿™æ˜¯ RBM çš„é¢„æœŸè¾“å…¥ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†ç”¨æˆ·æ€»æ•°ä½œä¸ºè¡Œå·ï¼Œå°†ç”µå½±æ€»æ•°ä½œä¸ºåˆ—å·ã€‚

```
nb_users = int(max(max(training_set[:, 0]), max(test_set[:, 0])))
nb_movies = int(max(max(training_set[:, 1]), max(test_set[:, 1])))
```

æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®è½¬æ¢å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªåˆ—è¡¨åˆ—è¡¨ã€‚æ¯ä¸ªå­åˆ—è¡¨ä»£è¡¨ä¸€ä¸ªç”¨æˆ·å¯¹æ‰€æœ‰ç”µå½±çš„è¯„çº§ã€‚å¦‚æœç”¨æˆ·æ²¡æœ‰å¯¹ç”µå½±è¿›è¡Œåˆ†çº§ï¼Œåˆ™å°†åˆ†çº§åˆå§‹åŒ–ä¸º 0ã€‚

```
def convert(data):
    new_data = []
    for id_users in range(1, nb_users + 1):
        id_movies = data[:,1][data[:,0] == id_users]
        id_ratings = data[:,2][data[:,0] == id_users]
        ratings = np.zeros(nb_movies)
        ratings[id_movies â€” 1] = id_ratings
        new_data.append(list(ratings))
    return new_data
```

é€šè¿‡ä¸Šé¢çš„è½¬æ¢ï¼Œæˆ‘ä»¬è½¬æ¢äº†è®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚

```
training_set = convert(training_set)
test_set = convert(test_set)
```

å›¾ 5 æ˜¾ç¤ºäº†æœ€ç»ˆçš„è®­ç»ƒé›†ã€‚åŒæ ·ï¼Œæ¯è¡ŒåŒ…å«ç”¨æˆ·å¯¹æ‰€æœ‰ç”µå½±çš„è¯„çº§ã€‚

![](img/037662beb29acaa89f49fac7020c2e18.png)

å›¾ 5 æœ€ç»ˆè®­ç»ƒæ•°æ®é›†çš„ç‰‡æ®µ

æœ€åï¼Œæˆ‘ä»¬å°† list ç±»å‹çš„**åˆ—è¡¨è½¬æ¢ä¸º**å¼ é‡**ï¼Œå› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨ Pytorch æ„å»º RBMã€‚**

```
training_set = torch.FloatTensor(training_set)
test_set = torch.FloatTensor(test_set)
```

3.3 äºŒè¿›åˆ¶æ•°æ®è½¬æ¢

æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯é¢„æµ‹ç”¨æˆ·æ˜¯å¦å–œæ¬¢ç”µå½±ä¸º 1ï¼Œä¸å–œæ¬¢ä¸º 0ã€‚RBM å°†é‡‡ç”¨ç”¨æˆ·çš„ç”µå½±è¯„çº§ï¼Œå¹¶è¯•å›¾é¢„æµ‹æœªè¢«ç”¨æˆ·è¯„çº§çš„ç”µå½±ã€‚å› ä¸ºè¦é¢„æµ‹çš„è¯„çº§æ˜¯æ ¹æ®åŸå§‹è¾“å…¥è®¡ç®—çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä»¥ä¸€è‡´çš„æ–¹å¼ä¿æŒè¾“å…¥è¯„çº§å’Œé¢„æµ‹è¯„çº§ã€‚

å…·ä½“æ¥è¯´ï¼Œå…ˆå‰è®¾ç½®ä¸º 0 çš„è¯„çº§è¢«é‡ç½®ä¸º-1ï¼Œç»™å‡º 1 æˆ– 2 çš„ç”µå½±è¢«è®¾ç½®ä¸º 0(ä¸å–œæ¬¢)ï¼Œè¯„çº§è¶…è¿‡ 3 çš„ç”µå½±è¢«è®¾ç½®ä¸º 1(å–œæ¬¢)ã€‚

```
training_set[training_set == 0] = -1
training_set[training_set == 1] = 0
training_set[training_set == 2] = 0
training_set[training_set >= 3] = 1test_set[test_set == 0] = -1
test_set[test_set == 1] = 0
test_set[test_set == 2] = 0
test_set[test_set >= 3] = 1
```

å¤ªå¥½äº†ã€‚æˆ‘ä»¬æˆåŠŸåœ°å°†åŸå§‹è¯„çº§æ•°æ®è½¬æ¢ä¸ºäºŒè¿›åˆ¶è¯„çº§æ•°æ®ï¼Œå‡†å¤‡å¥½è®­ç»ƒæ¨¡å‹ã€‚

**å¤ªå¥½äº†ï¼è¿™å°±æ˜¯ç¬¬ 1 éƒ¨åˆ†çš„å…¨éƒ¨å†…å®¹ã€‚æ¥ä¸‹æ¥çš„** [**ç¯‡**](https://medium.com/@vistaxjtu/restricted-boltzmann-machine-as-a-recommendation-system-for-movie-review-part-2-9a6cab91d85b) **å°†ä¸€æ­¥æ­¥èµ°å®Œå¦‚ä½•æ‰“é€ ä¸€ä¸ª RBMã€‚å¦‚æœéœ€è¦æºä»£ç ï¼Œè¯·è®¿é—®æˆ‘çš„**[**Github**](https://github.com/luke4u/Movie-Rating-Prediction)**é¡µé¢ğŸ¤ğŸ¤ã€‚**