<html>
<head>
<title>General Guidelines on Handling Missing Data in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理熊猫丢失数据的一般准则</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/general-guidelines-on-handling-missing-data-in-pandas-67e03a3e343c?source=collection_archive---------28-----------------------#2020-02-29">https://towardsdatascience.com/general-guidelines-on-handling-missing-data-in-pandas-67e03a3e343c?source=collection_archive---------28-----------------------#2020-02-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/48a44ee37d9b35384cec9e267cc7072a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i7HAh3TD1recKFErr_G1Iw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图片由 Willi <a class="ae jg" href="https://pixabay.com/users/wilhei-883152/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=693865" rel="noopener ugc nofollow" target="_blank"> Heidelbach </a>来自<a class="ae jg" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><div class=""/><div class=""><h2 id="2b9e" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">缺失值在现实生活的数据集中很常见。需要正确处理它们，以便进一步处理和正确解释数据。</h2></div><p id="f820" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为一名成瘾科学家，我的研究包括从临床试验的社区参与者那里收集数据。一些参与者可能会跳过临床访视，因此数据可能会在整个访视中丢失。有时，参与者可以跳过某个问卷的一些问题，导致部分数据缺失。参与者在需要整数值的地方输入不相关的自由文本的情况也时有发生。由于这些不同的原因，临床数据中缺失值是很常见的。</p><p id="f29d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，处理缺失值是处理临床数据的常规任务，这也适用于许多其他真实数据。在本文中，通过一个假设的例子，我将向您展示我们应该如何处理 Pandas 中丢失的数据 Pandas 是我最喜欢的数据处理 Python 包之一。出于本教程的目的，我在<a class="ae jg" href="https://gist.github.com/ycui1/dd33483219aeec871b9137a1e7925235" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上创建了一个假想的数据集。当然，实际的临床数据或其他现实生活中的数据可能更混乱，因此也更复杂，但同样的原则也适用。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="4e51" class="mb mc jj bd md me mf mg mh mi mj mk ml kp mm kq mn ks mo kt mp kv mq kw mr ms bi translated">第一步。了解您的数据</h1><p id="61fe" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated"><strong class="la jk">基本原理:</strong>了解数据大小和数据类型的有效性(例如，预期的数据类型和范围)。</p><p id="9e2e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一步是理解你正在处理的数据。例如，假设我们的数据是对调查的回答的集合，包括下面左面板中显示的四个问题。在右边的面板中，我们将数据作为熊猫的数据框导入，并快速查看数据框。我们知道数据帧有 20 行和 5 列，subject_id 是整数，而其余的字符串。</p><p id="af39" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，在实际的数据处理中，我通常会运行一些分类变量的频率表和数值变量的单变量分析，以更深入地了解我们的数据。这些超出了本文的范围，我们可以在以后的单独文章中讨论它们。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi my"><img src="../Images/273154488e24a10402fbad96afaf663b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0vrB9E1hNoICzCWNeg3DNA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">假设调查数据</p></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="344c" class="mb mc jj bd md me mf mg mh mi mj mk ml kp mm kq mn ks mo kt mp kv mq kw mr ms bi translated">第二步。记录数据</h1><p id="4d05" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">理由:我们需要检查我们所有的数据是否有效。为了方便起见，我们将重新编码我们的数据。但是，如果某些值无效，我们将把它们重新编码为缺失。</p><p id="2a52" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于这四个问题，我们希望 q1-q4 的回答遵循下面的验证规则。为了方便起见，我还列出了我们将为现有列重新编码的数据类型。</p><figure class="mz na nb nc gt iv"><div class="bz fp l di"><div class="nd ne l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">数据验证规则</p></figure><p id="eeff" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为我们确切地知道数据应该是什么样子，所以我们可以开发详细的验证规则，并在验证和重新编码过程中将这些规则应用到每一列。</p><p id="efc9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面的代码向您展示了我们将如何做。为清楚起见，这四列(即 q1-q4)中的每一列都单独重新编码。请注意，我们现在仍然希望保留旧的列，这样我们可以将它们与重新编码的列进行比较，以确保数据被正确地重新编码。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nf"><img src="../Images/26f326e3fd8bc49bc02ca468a13e4103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aKq_ud8u32DQtBEyWoM3Fg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">数据记录</p></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="4643" class="mb mc jj bd md me mf mg mh mi mj mk ml kp mm kq mn ks mo kt mp kv mq kw mr ms bi translated">第三步。检查丢失的数据</h1><p id="0282" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">基本原理:在我们对缺失数据做任何事情之前，我们需要找出我们有多少缺失数据。</p><p id="fb13" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦我们完成了数据记录，我们就可以检查我们的数据集中有多少缺失的数据。因为我们现在只对重新编码的列感兴趣，所以我们可以简单地删除旧列，只检查新列的数据缺失。我们注意到的另一件事是，每条记录对于一个主题是唯一的，因此我们可以在删除旧列后使用 subject_id 作为索引创建一个新的数据框。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ng"><img src="../Images/7e686d73ceaafbf00606486c50c4fd65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YxBZIqHWnLqCYoRSIBadEg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">检查数据缺失</p></figure><p id="6df3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如上图所示，我们可以使用<code class="fe nh ni nj nk b">isnull()</code>来评估每个单元格是否缺失(<code class="fe nh ni nj nk b">True</code>)或不缺失(<code class="fe nh ni nj nk b">False</code>)。由于真值被评估为 1，当我们使用<code class="fe nh ni nj nk b">sum()</code>函数时，可以显示每一列缺失值的数量。为了找出总的缺失数，我们只需运行<code class="fe nh ni nj nk b">df_r.isnull().sum().sum()</code>，在我们的例子中，我们有 21 个缺失值。</p><p id="f507" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与这个主题相关的是另一个方法<code class="fe nh ni nj nk b">isna()</code>，它做的事情和<code class="fe nh ni nj nk b">isnull()</code>一样。如果要检查非缺失数据，可以使用<code class="fe nh ni nj nk b">notna()</code>或<code class="fe nh ni nj nk b">notnull()</code>方法。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="f465" class="mb mc jj bd md me mf mg mh mi mj mk ml kp mm kq mn ks mo kt mp kv mq kw mr ms bi translated">第四步。处理缺失值</h1><p id="a626" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated"><strong class="la jk">基本原理:</strong>需要显式处理缺失值，以避免数据集的错误解释。</p><p id="2d0b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">缺失数据的处理方式由几个因素决定，例如缺失的性质(例如，随机缺失或非随机缺失)和潜在的预期措施—生物、心理或物理。换句话说，缺失是在数据的大背景下逐案处理的。本节将向您展示一些处理缺失数据的常用方法。</p><h2 id="5132" class="nl mc jj bd md nm nn dn mh no np dp ml lh nq nr mn ll ns nt mp lp nu nv mr nw bi translated"><strong class="ak">删除缺失值的数据记录</strong></h2><p id="3144" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">第一种方法是删除缺少值的数据记录。下面的代码片段向您展示了我们如何使用<code class="fe nh ni nj nk b">dropna()</code>方法来删除丢失数据的行。当然，我们可以在列上做类似的操作，但是我们通常不这么做，因为列在大多数时候是研究兴趣的变量。下面使用的每种方法都有其预期应用的简要描述。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/b4f11f6d0ddfc5cf32d5ab936c7b706c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pq3OM5JeOt4uCze9ZEHnaQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">删除缺少值的记录</p></figure><p id="bcb9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用<code class="fe nh ni nj nk b">dropna()</code>方法的几个要点:</p><ul class=""><li id="2421" class="ny nz jj la b lb lc le lf lh oa ll ob lp oc lt od oe of og bi translated"><code class="fe nh ni nj nk b">thresh</code>参数指定了指定轴的每个系列应该具有的非缺失值的最小数量。</li><li id="3332" class="ny nz jj la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated">您可以使用<code class="fe nh ni nj nk b">'any’</code>和<code class="fe nh ni nj nk b">‘all’</code>作为<code class="fe nh ni nj nk b">how</code>参数，这将删除丢失部分或全部值的记录。</li><li id="1083" class="ny nz jj la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated">您可以删除指定轴、行或列上的缺失值。</li><li id="0699" class="ny nz jj la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated">除非方法调用指定了<code class="fe nh ni nj nk b">inplace=True</code>，否则<code class="fe nh ni nj nk b">dropna()</code>方法不会改变原始数据帧。</li></ul><h2 id="2660" class="nl mc jj bd md nm nn dn mh no np dp ml lh nq nr mn ll ns nt mp lp nu nv mr nw bi translated">用缺失值填充数据记录</h2><p id="0353" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">另一种方法是用一些值来填充缺失的值。为此，我们可以使用<code class="fe nh ni nj nk b">fillna()</code>方法。与<code class="fe nh ni nj nk b">dropna()</code>方法类似，您可以在两个轴上使用<code class="fe nh ni nj nk b">fillna()</code>。下面的代码片段提供了一些常见的用例。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi om"><img src="../Images/5f743207e1b673357015aab080f24ad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hz3bvbDhmOtJghwiwONdkA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">用缺失值填充记录</p></figure><p id="fd86" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用<code class="fe nh ni nj nk b">fillna()</code>方法的几个要点:</p><ul class=""><li id="1350" class="ny nz jj la b lb lc le lf lh oa ll ob lp oc lt od oe of og bi translated"><code class="fe nh ni nj nk b">limit</code>参数指定要填充的最大记录数。当设置了<code class="fe nh ni nj nk b">method</code>参数时，该限制适用于上一个和下一个可用有效值之间的间隔，当未设置该参数时，该限制适用于列。</li><li id="b599" class="ny nz jj la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated">您可以使用<code class="fe nh ni nj nk b">'ffill'</code>和<code class="fe nh ni nj nk b">'bfill'</code>作为<code class="fe nh ni nj nk b">method</code>参数，它们分别使用最后一个或下一个有效值来填补空白。</li><li id="74d1" class="ny nz jj la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated">您可以填充指定轴、行或列上缺少的值。</li><li id="a1c2" class="ny nz jj la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated">除非方法调用指定了<code class="fe nh ni nj nk b">inplace=True</code>，否则<code class="fe nh ni nj nk b">fillna()</code>方法不会改变原始数据帧。</li></ul></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="3823" class="mb mc jj bd md me mf mg mh mi mj mk ml kp mm kq mn ks mo kt mp kv mq kw mr ms bi translated"><strong class="ak">外卖</strong></h1><p id="75e2" class="pw-post-body-paragraph ky kz jj la b lb mt kk ld le mu kn lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">处理缺失值并不像某些人想象的那么简单。一些研究人员经常忽略的部分实际上是我们数据处理的最早步骤——从内容角度理解我们数据的含义。例如，对于我自己作为一名成瘾科学家，我总是检查我的数据集对应哪些问题，基于这些问题，我可以正确处理缺失的数据。</p><p id="040e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我不能再强调这一点，但最大的收获是在彻底理解数据内容含义的情况下处理数据。</p></div></div>    
</body>
</html>