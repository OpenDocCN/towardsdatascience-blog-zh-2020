<html>
<head>
<title>Managing Your Machine Learning Experiments with MLflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 MLflow 管理您的机器学习实验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/managing-your-machine-learning-experiments-with-mlflow-1cd6ee21996e?source=collection_archive---------11-----------------------#2020-08-26">https://towardsdatascience.com/managing-your-machine-learning-experiments-with-mlflow-1cd6ee21996e?source=collection_archive---------11-----------------------#2020-08-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="40fe" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">告别繁琐的实验跟踪和杂乱的模型监控</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/42b29b06834d248c4ab3eff35bd0a9e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1YUEXhcCNgjCZx8O"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@sctgrhm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯科特·格雷厄姆</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ab97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated">我仍然记得我和我的队友在从事机器学习(ML)项目时的那段痛苦时光。</p><p id="63f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单调而又刻意地，我们手动地将无数实验的结果转移到 Google Sheet 上，并将保存的模型组织到文件夹中。当然，我们确实试图尽可能地自动化这个过程，但是管理我们的 ML 实验仍然是一件混乱的事情。</p><p id="e447" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果上述情况听起来像是你正在经历的事情，希望这篇文章能够帮助你摆脱困境，减轻你的痛苦。</p><p id="2dfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为管理 ML 实验的最佳开源解决方案之一(见其他工具<a class="ae ky" href="https://www.reddit.com/r/MachineLearning/comments/bx0apm/d_how_do_you_manage_your_machine_learning/" rel="noopener ugc nofollow" target="_blank">此处</a>), ML flow 将极大地改善您的福祉(作为数据科学家、机器学习专家等)。)并让您和您的团队保持理智，同时跟踪您的模型💪。</p><h1 id="9b81" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">MLflow 如何帮助我？</h1><p id="5fe0" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">只需将几行代码集成到您的脚本中，您就可以将您的模型参数和指标自动记录到一个有组织的仪表板中，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/148867f4c6395c4d4faacdeb945d12ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DJo3qOWOGMAkpjgqgxyxDw.png"/></div></div></figure><p id="db1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击表中的每一行将会显示更多的细节，包括为该次运行保存的模型的路径(一次运行基本上就是一次模型训练)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/7bb75d88c9c4592d1c761d718aae2e33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iRuYJ5HxmHDONn7ysGOIxQ.png"/></div></div></figure><p id="76ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如前所述，重要的是，只需在脚本中添加几行代码，所有这些都可以自动化。</p><p id="6ef3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的示例代码片段中，我们在与 MLflow 相关的所有代码行上方放置了注释。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="d5fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，在我们的示例中有三个主要部分:</p><p id="df20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.<strong class="lb iu">设置实验</strong>:在使用<code class="fe nf ng nh ni b">mlflow.start_run()</code>开始运行之前，我们在这里设置一个实验名称(<code class="fe nf ng nh ni b">mlflow.set_experiment()</code>)和路径(<code class="fe nf ng nh ni b">mlflow.set_tracking_uri()</code>)来记录我们的运行。</p><p id="e661" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.<strong class="lb iu">训练模型</strong>:这里没什么特别的，就是正常的模型训练。</p><p id="2bf7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.<strong class="lb iu">日志</strong>:日志参数(<code class="fe nf ng nh ni b">mlflow.log_params()</code>)、度量(<code class="fe nf ng nh ni b">mlflow.log_metric()</code>)和模型(<code class="fe nf ng nh ni b">mlflow.sklearn.log_model()</code>)。</p><p id="7372" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行代码后，您可以在终端中执行<code class="fe nf ng nh ni b">mlflow ui</code>,将会有一个链接指向您的 MLflow 仪表板。</p><p id="981a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单利落对吧？😎</p><p id="2c59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，到目前为止，我们向您展示的是本地环境。如果我们想和其他队友合作呢？这就是远程服务器发挥作用的地方，本文的下一节将向您展示这样做的步骤。</p><h1 id="07eb" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">在谷歌云上部署 MLflow 的步骤</h1><p id="de7d" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">我们首先列出要采取的一般步骤，然后用截图详细说明每个步骤(随意点击每个步骤进行导航)。拥有一个 Google Cloud 帐户是遵循这些步骤的唯一先决条件。请注意，谷歌云为新注册用户提供免费试用，所以你可以免费试用。</p><ol class=""><li id="e77a" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated"><a class="ae ky" href="#92b8" rel="noopener ugc nofollow">设置虚拟机为 MLflow 服务</a></li><li id="47bc" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated"><a class="ae ky" href="#fe86" rel="noopener ugc nofollow">创建云存储桶来存储我们的模型</a></li><li id="c1cd" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated"><a class="ae ky" href="#889a" rel="noopener ugc nofollow">启动 MLflow 服务器</a></li><li id="9500" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated"><a class="ae ky" href="#73fb" rel="noopener ugc nofollow">使用 Nginx 通过反向代理添加用户认证</a></li><li id="4058" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated"><a class="ae ky" href="#0407" rel="noopener ugc nofollow">修改代码以允许访问 MLflow 服务器</a></li></ol><h1 id="92b8" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">1.设置虚拟机(VM)</h1><p id="7ae6" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">我们的第一步是通过谷歌云控制台设置一个计算引擎虚拟机实例。</p><p id="53fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">a)登录您的谷歌云控制台后，启用<a class="ae ky" href="https://console.cloud.google.com/apis/library/compute.googleapis.com?q=compute" rel="noopener ugc nofollow" target="_blank">计算引擎 API </a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/6c89a85741821868cb33260198d6a010.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_w3fyqA52Kf2fsnuXiyD_g.png"/></div></div></figure><p id="59bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">b)启动谷歌云壳</p><p id="31ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会在控制台页面的右上角看到一个类似于下面红框中按钮的按钮。点击它，会弹出一个终端。我们将使用这个终端来启动我们的虚拟机。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/ccaa0e501f21df438906405a6f2983ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/0*cKCN3RSXfP9YdX5r.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">点击红框中的按钮，启动谷歌云外壳</p></figure><p id="9d65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">c)创建一个计算引擎虚拟机实例</p><p id="4da9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 Google Cloud Shell 中键入以下内容，创建一个名为<em class="nz"> mlflow-server </em>的 VM 实例。</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="6af8" class="oe mf it ni b gy of og l oh oi">gcloud compute instances create mlflow-server \<br/>--machine-type n1-standard-1 \<br/>--zone us-central1-a \<br/>--tags mlflow-server \<br/>--metadata startup-script='#! /bin/bash<br/>sudo apt update<br/>sudo apt-get -y install tmux<br/>echo Installing python3-pip<br/>sudo apt install -y python3-pip<br/>export PATH="$HOME/.local/bin:$PATH"<br/>echo Installing mlflow and google_cloud_storage<br/>pip3 install mlflow google-cloud-storage'</span></pre><p id="4cec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面代码中参数的简要描述:</p><ul class=""><li id="7297" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu oj np nq nr bi translated"><em class="nz"> machine-type </em>为我们的虚拟机指定 CPU 和 RAM 的数量。您可以从该<a class="ae ky" href="https://cloud.google.com/compute/docs/machine-types#machine_type_comparison" rel="noopener ugc nofollow" target="_blank">列表</a>中选择其他类型。</li><li id="2eab" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu oj np nq nr bi translated"><em class="nz">区域</em>是指您的集群所在的数据中心区域。你可以选择<a class="ae ky" href="https://cloud.google.com/compute/docs/regions-zones/#available" rel="noopener ugc nofollow" target="_blank">离你的用户不太远的地方</a>。</li><li id="c6b8" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu oj np nq nr bi translated"><em class="nz">标签</em>允许我们在以后添加网络防火墙规则时识别实例。</li><li id="cec5" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu oj np nq nr bi translated"><em class="nz">元数据启动脚本</em>提供了一个 bash 脚本，它将在我们的实例启动时执行，安装所需的各种包。</li></ul><p id="e816" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">d)创建防火墙规则</p><p id="8e10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是为了允许在端口 5000 上访问我们的 MLflow 服务器。</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="1fe4" class="oe mf it ni b gy of og l oh oi">gcloud compute firewall-rules create mlflow-server \<br/>--direction=INGRESS --priority=999 --network=default \<br/>--action=ALLOW --rules=tcp:5000 --source-ranges=<a class="ae ky" href="http://0.0.0.0/0" rel="noopener ugc nofollow" target="_blank">0.0.0.0/0</a> \<br/>--target-tags=mlflow-server</span></pre><h1 id="fe86" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">2.创建云存储桶</h1><p id="b45a" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">在 Google Cloud Shell 中运行下面的代码，用您选择的唯一名称替换<em class="nz"> &lt; BUCKET_NAME &gt; </em>。这个桶将是我们以后存放模型的地方。</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="0337" class="oe mf it ni b gy of og l oh oi">gsutil mb gs://&lt;BUCKET_NAME&gt;</span></pre><h1 id="889a" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">3.启动 MLflow 服务器</h1><p id="cb1b" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">我们现在将 SSH 到我们的<em class="nz"> mlflow-server </em>实例中。</p><p id="295a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到<a class="ae ky" href="https://console.cloud.google.com/compute/" rel="noopener ugc nofollow" target="_blank">计算引擎页面</a>并为您的实例单击 SSH 按钮。您的 VM 实例的终端应该会弹出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/79b4427ac6b68863415de51f15da7c51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3fe-oDrlYvBH7g-aY50ElA.png"/></div></div></figure><p id="411d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当终端准备就绪时，记下显示在计算引擎页面上的<em class="nz"> mlflow-server </em>实例的内部和外部 IP。我们以后会需要它们。</p><p id="c979" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在启动我们的 MLflow 服务器之前，让我们做一个快速检查，以确保所有东西都已安装。由于我们的启动脚本需要几分钟的时间来完成执行，如果您太快地使用 SSH，这些包可能还没有全部安装好。要检查是否安装了 MLflow，请在终端中键入:</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="41b2" class="oe mf it ni b gy of og l oh oi">mlflow --version</span></pre><p id="694c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果已经安装了 MLflow，您应该可以看到它的版本。如果没有，不要担心，要么再等一会儿，要么执行我们的 bash 脚本中步骤 1c 下的命令来手动安装包。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/ddc47ae6eea616229a3b8b562e8d82e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xdu1G3j0HUIFIhnXtyiRJg.png"/></div></div></figure><p id="d66e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果已经安装了 MLflow，我们现在可以通过执行以下命令使用 tmux 打开一个新窗口:</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="bb94" class="oe mf it ni b gy of og l oh oi">tmux</span></pre><p id="2fc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过运行下面的代码启动我们的 MLflow 服务器，将<em class="nz"> &lt; BUCKET_NAME &gt; </em>和<em class="nz"> &lt; INTERNAL_IP &gt; </em>分别替换为步骤 2 中的 BUCKET 名称和前面提到的您的内部 IP 地址。</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="7985" class="oe mf it ni b gy of og l oh oi">mlflow server \<br/>--backend-store-uri sqlite:///mlflow.db \<br/>--default-artifact-root gs://&lt;BUCKET_NAME&gt; \<br/>--host &lt;INTERNAL_IP&gt;</span></pre><p id="3b8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您看到类似以下截图的内容，恭喜您的 MLflow 服务器已经启动并运行😄。您现在可以在浏览器中访问<code class="fe nf ng nh ni b">&lt;External_IP&gt;:5000</code>来查看您的 MLflow 仪表盘。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/631da1abd96d1ac8f9b0d15df0be704d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d3Zp5auCPUV0j1u186kyIA.png"/></div></div></figure><h1 id="73fb" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">4.添加用户验证</h1><p id="b50e" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">如果您不介意让拥有您外部 IP 地址的任何人查看您的 MLflow 仪表板，那么您可以跳过这一步。但我猜你不是一个暴露狂，对吗？还是你？😱</p><p id="c618" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要添加用户认证，首先让我们通过按下<code class="fe nf ng nh ni b">Ctrl+c</code>暂时停止我们的 MLflow 服务器。然后在用<code class="fe nf ng nh ni b">Ctrl+b</code> <code class="fe nf ng nh ni b">d</code>拆窗户之前，说出终结者的那句名言“我会回来的”。</p><p id="0822" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">a)安装 Nginx 和 Apache 实用程序</p><p id="8625" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们终端的主窗口中，执行:</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="beee" class="oe mf it ni b gy of og l oh oi">sudo apt-get install nginx apache2-utils</span></pre><p id="b90e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Nginx 将设置我们的 web 服务器，而 Apache 工具将为我们提供对<code class="fe nf ng nh ni b">htpasswd</code>命令的访问，我们将使用该命令创建密码文件。</p><p id="c16b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">b)添加密码文件</p><p id="a29c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行以下程序，将<em class="nz"> &lt;用户名&gt; </em>替换为酷名。</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="d4bb" class="oe mf it ni b gy of og l oh oi">sudo htpasswd -c /etc/nginx/.htpasswd &lt;USERNAME&gt;</span></pre><p id="0fe8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后设置你的无人能破译的密码。</p><p id="f7b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您需要一个聚会，只需省去<code class="fe nf ng nh ni b">-c</code>参数来添加额外的用户:</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="04a6" class="oe mf it ni b gy of og l oh oi">sudo htpasswd /etc/nginx/.htpasswd &lt;ANOTHER_USER&gt;</span></pre><p id="a179" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">c)启用密码和反向代理</p><p id="2c45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要配置 Nginx，让我们的密码文件生效，并设置 MLflow 服务器的反向代理。我们通过修改<code class="fe nf ng nh ni b">default</code>服务器块文件来做到这一点:</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="b2d7" class="oe mf it ni b gy of og l oh oi">sudo nano /etc/nginx/sites-enabled/default</span></pre><p id="946e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过将<em class="nz">位置</em>下的内容替换为三个粗体行来修改文件:</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="ae48" class="oe mf it ni b gy of og l oh oi">server {<br/>  location / {<br/>    <strong class="ni iu">proxy_pass </strong><a class="ae ky" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"><strong class="ni iu">http://localhost:5000</strong></a><strong class="ni iu">;<br/>    auth_basic "Restricted Content";<br/>    auth_basic_user_file /etc/nginx/.htpasswd;</strong><br/>  }<br/>}</span></pre><p id="3155" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按<code class="fe nf ng nh ni b">Ctrl+x</code> <code class="fe nf ng nh ni b">y</code> <code class="fe nf ng nh ni b">Enter</code>保存修改并退出编辑器。</p><p id="ef75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重新启动 Nginx 以使更改生效:</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="7b62" class="oe mf it ni b gy of og l oh oi">sudo service nginx restart</span></pre><p id="407f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe nf ng nh ni b">tmux</code>创建新会话或重新连接到我们之前的 tmux 会话:</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="26ee" class="oe mf it ni b gy of og l oh oi">tmux attach-session -t 0</span></pre><p id="05ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再次启动我们的 MLflow 服务器，但这一次，我们的主机被设置为<em class="nz"> localhost </em>:</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="f791" class="oe mf it ni b gy of og l oh oi">mlflow server \<br/>--backend-store-uri sqlite:///mlflow.db \<br/>--default-artifact-root gs://&lt;BUCKET_NAME&gt; \<br/>--host localhost</span></pre><p id="df56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">d)启用 HTTP 流量</p><p id="4641" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们按照这个<a class="ae ky" href="https://cloud.google.com/vpc/docs/special-configurations#developer-console-external-http" rel="noopener ugc nofollow" target="_blank">链接</a>中的步骤，为我们的实例启用 HTTP 流量，以允许访问我们的 Nginx web 服务器。实际上，当您在计算引擎页面上单击我们的<em class="nz"> mlflow-server </em>实例时，您可以在防火墙部分下编辑并选择<em class="nz">允许 HTTP 流量</em>和<em class="nz">允许 HTTPS 流量</em>。</p><p id="46d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果您访问您的外部 IP(省去<em class="nz"> :5000 </em>，只访问外部 IP)，您应该被提示输入凭证。键入您之前设置的用户名和密码，然后“打开芝麻”，您的 MLflow 仪表盘又回到了您的眼前。</p><h1 id="0407" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">5.修改代码以访问服务器</h1><p id="e388" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">为了让我们的脚本登录到服务器，我们需要通过提供一些凭证作为环境变量来修改我们的代码。</p><p id="e15d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">a)创建并下载服务帐户 json</p><p id="57d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按照此处的步骤<a class="ae ky" href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys#creating_service_account_keys" rel="noopener ugc nofollow" target="_blank">创建新的服务账户密钥。</a></p><p id="21bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">b) Pip 在本地安装谷歌云存储</p><p id="c079" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nz"> google-cloud-storage </em>包需要安装在客户端和服务器上，以便访问 google 云存储。我们已经通过启动脚本在服务器上安装了这个包，所以您只需要在本地安装它。</p><p id="9280" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">c)将凭证设置为环境变量</p><p id="0f6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的代码中，添加以下内容以使您的脚本能够访问服务器，并相应地替换它们:</p><ul class=""><li id="8d2f" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu oj np nq nr bi translated"><google_application_credentials>:下载服务账号密钥的路径</google_application_credentials></li><li id="7643" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu oj np nq nr bi translated"><mlflow_tracking_username>:用户名</mlflow_tracking_username></li><li id="7f36" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu oj np nq nr bi translated"><mlflow_tracking_password>:密码</mlflow_tracking_password></li></ul><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="24fb" class="oe mf it ni b gy of og l oh oi">import os</span><span id="1e22" class="oe mf it ni b gy on og l oh oi"># Set path to service account json file<br/>os.environ['GOOGLE_APPLICATION_CREDENTIALS'] = &lt;GOOGLE_APPLICATION_CREDENTIALS&gt;</span><span id="4eb8" class="oe mf it ni b gy on og l oh oi"># Set username and password if authentication was added<br/>os.environ['MLFLOW_TRACKING_USERNAME'] = &lt;MLFLOW_TRACKING_USERNAME&gt;<br/>os.environ['MLFLOW_TRACKING_PASSWORD'] = &lt;MLFLOW_TRACKING_PASSWORD&gt;</span></pre><p id="bd83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">d)将外部 IP 设置为 MLflow 跟踪 URI</p><p id="bb3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在前面的示例代码中，<code class="fe nf ng nh ni b">mlflow.set_tracking_uri()</code>被设置为本地文件夹路径。现在将其设置为&lt; EXTERNAL_IP &gt; :80，例如:<a class="ae ky" href="http://35.225.50.9:80" rel="noopener ugc nofollow" target="_blank">http://35.225.50.9:80</a>。</p><pre class="kj kk kl km gt oa ni ob oc aw od bi"><span id="d558" class="oe mf it ni b gy of og l oh oi">mlflow.set_tracking_uri(&lt;EXTERNAL_IP&gt;:80)</span></pre><p id="cf5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以轻松地与您的队友协作，并将您的模型登录到服务器。👏 👏 👏</p><p id="2587" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了测试方便，我们的完整示例代码可以在<a class="ae ky" href="https://gist.github.com/jiahao87/e7d9ede444a41161879d7b4845f0a6c0" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl oo op hx oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="im in io ip iq"><p id="e3cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过上面的指南，我们希望您现在能够在本地和 Google Cloud 上部署 MLflow 来管理您的 ML 实验。此外，在您进行实验之后，MLflow 在您将模型部署到生产环境中之后，仍然可以用来监控您的模型。</p><p id="5e11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读，我希望这篇文章是有用的:)也请随时评论您可能有的任何问题或建议。</p><h1 id="3aa2" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">参考</h1><div class="ov ow gp gr ox oy"><a href="https://www.mlflow.org/docs/latest/quickstart.html" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd iu gy z fp pd fr fs pe fu fw is bi translated">快速入门</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">您可以通过运行以下命令来安装 MLflow:注意 MLflow 在 MacOS 上工作。如果您在使用默认系统 Python 时遇到问题…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">www.mlflow.org</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm ks oy"/></div></div></a></div><div class="ov ow gp gr ox oy"><a href="https://karimlahrichi.com/2020/03/13/add-authentication-to-mlflow/" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd iu gy z fp pd fr fs pe fu fw is bi translated">向 MLflow 添加身份验证</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">这是 MLflow 的第三次安装，我们将在 MLflow 跟踪服务器前添加一个 nginx 反向代理…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">karimlahrichi.com</p></div></div><div class="ph l"><div class="pn l pj pk pl ph pm ks oy"/></div></div></a></div></div></div>    
</body>
</html>