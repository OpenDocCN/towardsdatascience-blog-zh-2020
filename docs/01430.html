<html>
<head>
<title>Managing Machine Learning Development Cycle With Mlflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Mlflow管理机器学习开发周期</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/managing-machine-learning-development-cycle-with-mlflow-part-1-2-7a3f5871c708?source=collection_archive---------22-----------------------#2020-02-08">https://towardsdatascience.com/managing-machine-learning-development-cycle-with-mlflow-part-1-2-7a3f5871c708?source=collection_archive---------22-----------------------#2020-02-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="716e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用mlflow跟踪、比较、评估和服务您的机器学习模型。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cc83aedb40725c2ee5df70977d95feb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yUp6g_T1kosoINft"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@marvin_ronsdorf?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马文·朗斯多夫</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="2732" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">管理机器学习开发生命周期是一项复杂的任务。可复制性是很难的，通常从开发最好的模型并将其转移到生产的过渡会变得混乱和延迟。</p><p id="0c04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原因是每个新模型都需要修改生产代码，因为现在您的服务器需要指向新模型并快速迭代，同时还要维护审计跟踪，这是一项具有挑战性的任务。这就是mlflow的用武之地。从跟踪模型参数、度量和工件，到将您的代码作为项目在其他系统上运行，以及为模型服务，Mlflow都做了。</p><p id="bab4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:按照<a class="ae kv" href="https://www.mlflow.org/docs/latest/quickstart.html" rel="noopener ugc nofollow" target="_blank">文档</a>安装mlflow</p><h2 id="7406" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">物流跟踪</h2><p id="56d0" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">让我们从跟踪模块开始，设置我们的跟踪服务器。要设置我们的跟踪服务器，我们首先需要创建一个数据库。只需打开mysql命令提示符并执行以下查询</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="9e91" class="ls lt iq mr b gy mv mw l mx my">-&gt; CREATE DATABASE mlflow_tracking_database;</span></pre><p id="4db5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您有了数据库来跟踪您的机器学习模型结果、参数和模型。数据库将存储度量、参数和其他元相关信息。对于运行期间产生的文件或工件，我们将使用基于文件的存储，并在下面的命令中指定路径，以便在跟踪服务器中找到这些运行。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="36c8" class="ls lt iq mr b gy mv mw l mx my">mlflow server --backend-store-uri   mysql+pymysql://root@localhost/mlflow_tracking_database --default-artifact-root file:/./mlruns -h 0.0.0.0 -p 5000</span></pre><p id="8dea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mz na nb mr b">--backend-sotre-uri</code>指定我们需要跟踪mlflow运行的数据库的uri，而<code class="fe mz na nb mr b">--default-artifact-root</code>指定存储模型文件和其他工件的路径。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/4aa6e657c1f088b75afdad4bad490803.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YbIaEAd2ErRyO347B3HWSg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">mlflow跟踪服务器命令的屏幕截图</p></figure><p id="bda4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的跟踪服务器现在应该已经启动并运行了。要验证其设置是否正确，只需进入<code class="fe mz na nb mr b">http://localhost:8000</code>，您将看到mlflow界面。</p><p id="39fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们训练几个模型，并使用我们刚刚创建的服务器记录它们。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">密码</p></figure><p id="2558" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以多次运行这个脚本，也可以运行另一个脚本，我们的所有运行都将被记录到我们刚刚设置的跟踪服务器中。在多次迭代和尝试不同的技术之后，我们可以比较我们在跟踪服务器上跟踪的运行。这个跟踪服务器的优点是，同一个网络中的多个团队可以以集中的方式跟踪他们的跑步，每个人都可以更有效和高效地协作。</p><h2 id="b177" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">ml流程模型</h2><p id="59ae" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在mlflow UI中比较运行后，我们需要做的就是识别最佳模型的运行id，并使用mlflow模型功能提供它。这将建立一个web服务器，允许您发送POST请求以从您的模型中获得预测。</p><p id="8ecb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mz na nb mr b">$ mlflow models serve -m file:/home/saad/downloads/&lt;run-id&gt;/XGB_Model</code></p><p id="74fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mz na nb mr b">-m</code> flag指定了模型uri。你也可以根据自己的需要传递其他的标志。例如<code class="fe mz na nb mr b">--no-conda</code>将允许你在相同的环境中运行你的模型，而不是创建一个新的。你可以在这里了解更多关于服务mlflow模型<a class="ae kv" href="https://www.mlflow.org/docs/latest/cli.html#mlflow-models-serve" rel="noopener ugc nofollow" target="_blank"/></p><blockquote class="nf ng nh"><p id="b535" class="kw kx ni ky b kz la jr lb lc ld ju le nj lg lh li nk lk ll lm nl lo lp lq lr ij bi translated">注意:<code class="fe mz na nb mr b">mlflow models serve</code>仅在Linux上可用，在windows上尚不支持。</p></blockquote><p id="462f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，为了测试我们的mlflow模型服务器，我们需要做的就是发送一个POST请求。我将使用邮递员来做这件事。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/10a48dc5fc693454eb33b467bc8cf49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9GYOWNenOzxV94jkt-l7KA.png"/></div></div></figure><p id="0db4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如所料，我从mlflow模型服务器得到了一个指定价格的响应。我希望这篇文章能让你快速了解mlflow以及如何在生产中使用它。</p><p id="1167" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我个人认为mlflow使得机器学习模型的开发周期变得更加容易。它非常直观，而且有一个不断发展的社区在你遇到困难时帮助你。Mlflow仍然有很多东西可以提供，我鼓励你进一步探索它。</p><p id="e671" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">参考资料:</p><p id="a213" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[1]<a class="ae kv" href="https://www.mlflow.org/docs/latest/tracking.html" rel="noopener ugc nofollow" target="_blank">https://www.mlflow.org/docs/latest/tracking.html</a></p><p id="2c1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.mlflow.org/docs/latest/models.html" rel="noopener ugc nofollow" target="_blank">https://www.mlflow.org/docs/latest/models.html</a></p></div></div>    
</body>
</html>