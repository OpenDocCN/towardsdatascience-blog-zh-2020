<html>
<head>
<title>Genetic Algorithms in Python using the DEAP library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 DEAP 库的 Python 中的遗传算法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/genetic-algorithms-in-python-using-the-deap-library-e67f7ce4024c?source=collection_archive---------12-----------------------#2020-05-29">https://towardsdatascience.com/genetic-algorithms-in-python-using-the-deap-library-e67f7ce4024c?source=collection_archive---------12-----------------------#2020-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5846" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">应用于大量营养素膳食计划的优化</h2></div><p id="3937" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我将介绍 Python 中的遗传算法，以及一个优化膳食计划的例子。</p><h1 id="dd76" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">示例以及如何应用优化</h1><p id="807b" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">当优化膳食计划时，有许多事情要考虑。在这个例子中，我们将为一个人制定一个每周膳食计划，这个人已经决定了他们想要吃多少卡路里，以及这些卡路里中有多少百分比应该来自蛋白质、碳水化合物和脂肪。</p><p id="fa92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了这些固定值，优化程序还需要一个预定义的产品列表，用户可以从中进行选择。对于这些产品中的每一种，我们知道每单位的卡路里数，以及脂肪、蛋白质和碳水化合物的百分比。</p><h2 id="3bd8" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated"><strong class="ak">我们示例中人员的目标数量是:</strong></h2><p id="fc4a" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated"><em class="mn">总热量= 2500 * 7 天= 17500 卡路里<br/>蛋白质百分比= 30% <br/>碳水化合物百分比= 50% <br/>脂肪百分比= 20% </em></p><h2 id="5f17" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated"><strong class="ak">下面列出了可供选择的产品:</strong></h2><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/cb4270424adea7dee81de37b59fce494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*FylLZOvHUlULI8_b66OuNg.png"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">Python 中的遗传算法——产品表。作者配图。</p></figure><h2 id="8d53" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated"><strong class="ak">优化的目标</strong></h2><p id="3279" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">优化程序的目标是找到一周的产品列表，其中每周总热量和宏量营养素尽可能接近目标量。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/34ffcfa83250c8e45769013cbe0320c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oaUNnduzADWCBb7V.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">本文将使用 DEAP 的遗传算法。来源:<a class="ae nf" href="https://deap.readthedocs.io/en/master/_images/deap_long.png" rel="noopener ugc nofollow" target="_blank">https://deap.readthedocs.io/en/master/_images/deap_long.png</a></p></figure><h1 id="a598" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated"><strong class="ak">遗传算法优化</strong></h1><p id="6d14" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">存在许多优化算法，遗传算法是其中之一。遗传算法之所以迷人，是因为其背后的思想非常耐人寻味:遗传算法是基于遗传学中自然选择的思想。</p><h2 id="2f8c" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">繁殖/交配</h2><p id="60ca" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">那么优化在遗传学中是如何工作的，比如在动物中？这是一个简单的原则:一个个体被编码为一系列基因。这种动物可能会也可能不会通过与伴侣繁殖将自己的基因组合传递给下一代。如果发生这种情况，后代将拥有来自母亲和父亲的基因组合。</p><h2 id="031a" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">变化</h2><p id="a85a" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">除了繁殖，还有第二个影响将决定新一代的基因库:突变。由于许多随机环境，有一些基因会在任何新个体中随机改变。</p><h2 id="d685" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">选择</h2><p id="07d4" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">达尔文的选择原则指出，适者生存。我们认为在繁殖前死亡的动物有不良基因。因为它们不繁殖，所以它们不会把基因传给下一代。这样下一代的基因会比上一代略好。</p><h2 id="c087" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">人口优化</h2><p id="3542" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">这种自然选择的原理可以看作是一种优化算法。通过死亡，大自然把每一代人的坏基因都扔了出去。剩下的人口会越来越好。</p><h2 id="9d7a" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">将遗传算法应用于其他优化</h2><p id="5fb2" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">对于优化的其他用例，遗传算法实现了相同的迭代交配、变异和选择方法。而不是用一个基因序列作为一个个体，它可以是许多其他的东西。</p><p id="6fd9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，在优化膳食计划的例子中，我们可以将“购物清单”写成个人。只买 1000 根香蕉而不买其他东西会是一个相对糟糕的购物清单。每样东西买 10 个已经很现实了。</p><p id="d144" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们为这种遗传优化所做的如下:</p><ol class=""><li id="5df2" class="ng nh it kk b kl km ko kp kr ni kv nj kz nk ld nl nm nn no bi translated">生成大量随机购物清单</li><li id="1d2a" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nl nm nn no bi translated">通过测量它们离目标数量的距离来选择最佳的。</li><li id="d529" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nl nm nn no bi translated">然后，将这些顶级候选项混合在一起，以给出新的购物列表，这些列表是顶级父候选项的随机组合(应用了一些随机变异)</li><li id="1279" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nl nm nn no bi translated">我们重复第 2 步和第 3 步，直到我们观察到几代人都没有改善(或者尽可能长)</li><li id="d476" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nl nm nn no bi translated">然后，我们从最终群体中选择最佳个体，我们确信这是我们可能拥有的最佳购物清单之一。</li></ol><h1 id="79ea" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">Python 中的遗传算法</h1><p id="fc1e" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">听起来很神奇，我们用 Python 做个实际案例吧。我们将使用 DEAP 图书馆，因为它有许多我们可以重复使用的基因功能。你可以跟着这里的总笔记本走。</p><h2 id="3c52" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">在 Python 中设置输入</h2><p id="0293" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">首先，让我们确定目标营养素的数量。我用不同的方式设定它们，因为实际上它们通常以每份营养素的百分比来表示，但为了优化，用克来表示更容易。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nu"><img src="../Images/055d65865c5e3c6c38233572efada5df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PA6fm0uws-YeGKY0PfYRhA.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">Python 中的遗传算法——目标数量。作者配图。</p></figure><p id="d798" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建产品表的第二件事是:</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nv"><img src="../Images/873aea1e8b94b939b755a2455bea1b03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SPPWEeAIdio2_xlBATVh6g.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">Python 中的遗传算法——产品表。作者配图。</p></figure><h2 id="69cf" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">为我们的具体示例设置 Python 中的 DEAP 工具箱</h2><h2 id="dfa8" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated"><strong class="ak">设计 DEAP 工具箱设置</strong></h2><p id="0e38" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">现在是更困难的部分，为我们的具体例子建立 DEAP 工具箱。你需要指定你的染色体的形状。最简单的形状是列表。</p><p id="9cb4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本例中，我选择了长度为 21 的列表，因为在 products 表中有 21 个产品。然后我知道第一个元素是香蕉的数量，第二个元素是橘子的数量等等。</p><h2 id="1cfd" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated"><strong class="ak">为 DEAP 工具箱设置的语法</strong></h2><p id="56ca" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">我知道，但是算法不需要知道。它在个体中是不可见的。正如我们在下面看到的，这个个体是使用 creator.create 创建的，这里它被指定为 list，但是有一个附加的 fitness。这种适合度被定义为 FitnessMin。</p><p id="a59b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">个人现在还没有填写。填充发生在函数“个人”被注册到工具箱的地方。个体是基于函数 n_per_product 的，它返回 21 个随机数的列表:正如您所认识到的，这些是每个产品的数量。</p><p id="b1dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">人口只是登记为一份个人名单。</p><p id="919e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">评估函数是我定义的，它计算总购物清单的卡路里数与目标卡路里数之间的绝对差值。就像你在笔记本上看到的，把其他的量加进去是相对容易的。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nw"><img src="../Images/70ec1bac5e6b090a33750912691b3c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-E68gvQvn48NsMeLhQ4Wdg.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">Python 中的遗传算法—建立 DEAP 工具箱。作者配图。</p></figure><p id="1588" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">交配，变异和选择功能是直接从 DEAP 图书馆。</p><h2 id="7535" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">优化循环</h2><p id="0c84" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">下面的函数进行优化。几乎是从 DEAP 的<a class="ae nf" href="https://deap.readthedocs.io/en/master/examples/ga_onemax.html" rel="noopener ugc nofollow" target="_blank">例单中逐字抄来的。感谢我为这个例子选择的设置，只需要做很少的修改。</a></p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nx"><img src="../Images/a6961eba69177266f3cb673039789e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*jUvi6b4WBNADjMqdw-fSiA.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">Python 中的遗传算法——主函数。作者配图。</p></figure><h1 id="9eb6" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">遗传算法的结果</h1><p id="b6c6" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">上一代的最佳个体是下面显示为“单变量 _ 选择”列的列表。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/97deeae4cb05206c25f97fdc8f6d869a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*SAOKL1CX8eWYRoZZuJqGAg.png"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">Python 中的遗传算法。作者配图。</p></figure><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/5b421b57c8cc9e61057006a1e67c3d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*6nDcBtLZE0wQTjWGQbn16w.png"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">Python 中的遗传算法。作者配图。</p></figure><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/6880a03f9579cca50d563b9b53d8fe27.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*5br89bO6ulUbLIQAZ2-jxw.png"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">Python 中的遗传算法——解决方案。作者配图。</p></figure><h1 id="e116" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">多元优化</h1><p id="901c" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">目前，我们只优化了卡路里的数量，而没有考虑是否主要是蛋白质、脂肪或碳水化合物远离目标。DEAP 有可能非常容易地从单目标转移到多目标优化。</p><p id="0aa4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">代码中唯一要改变的是 evaluate 函数，它现在应该返回四个值的元组(卡路里误差、蛋白质误差、脂肪误差和碳水化合物误差),并添加一个权重向量来平衡每一个值的权重。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ob"><img src="../Images/f882c6856dbc5f2d8235d5ec321422c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HC2CDQGGBwatgZ6e3R2yQQ.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">Python 中的遗传算法——多目标评估。作者配图。</p></figure><h1 id="1147" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">单目标与多目标优化</h1><p id="3c04" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">进一步检查单目标和多目标优化的结果是有趣的。在使用当前权重的情况下，它给出了以下内容:</p><ul class=""><li id="4fd3" class="ng nh it kk b kl km ko kp kr ni kv nj kz nk ld oc nm nn no bi translated">计算四个目标的误差，我们看到多元解的总误差更好</li><li id="e4d0" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld oc nm nn no bi translated">我们还看到误差的分布是不同的。例如，如果蛋白质的正确性更重要，可以通过增加蛋白质的权重来调整。</li></ul><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi od"><img src="../Images/682f122aa5f4a64cd64a1e1567541dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zS9GvDc9pbEGxvLInJB4Zw.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">Python 中的遗传算法——分析结果。作者配图。</p></figure><p id="cfa3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最终，产品表总是限制因素:在某些时候，不可能找到完美达到目标的特定产品的组合。为了有一个更好的解决方案，我们必须增加更多的产品。</p><h1 id="16c7" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">结论</h1><p id="4352" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">关于遗传算法的实际工作还有很多要了解的，但是我希望这篇文章至少给你一个使用 Python 中的 DEAP 库开始使用遗传算法的快速方法，以及一个很好的用例例子。</p><p id="8937" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不要犹豫，使用带有两个例子的<a class="ae nf" href="https://jooskorstanje.com/genetic-algorithm-optimize-your-diet.html" rel="noopener ugc nofollow" target="_blank">示例笔记本，在遗传算法</a>的学习道路上更进一步。<em class="mn">现在，感谢阅读！</em></p></div></div>    
</body>
</html>