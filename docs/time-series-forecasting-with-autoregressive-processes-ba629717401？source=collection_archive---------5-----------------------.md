# å…·æœ‰è‡ªå›å½’è¿‡ç¨‹çš„æ—¶é—´åºåˆ—é¢„æµ‹

> åŸæ–‡ï¼š<https://towardsdatascience.com/time-series-forecasting-with-autoregressive-processes-ba629717401?source=collection_archive---------5----------------------->

## Python ä¸­æ—¶é—´åºåˆ—åˆ†æçš„ AR(p)è¿‡ç¨‹å®è·µæ•™ç¨‹

![](img/ea39f75f826ecc03a83067b623b58961.png)

ä¼Šè²å¨œÂ·ç§‘ä¼Šåˆ‡å¨ƒåœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

# ä»‹ç»

åœ¨æœ¬å®è·µæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºä½¿ç”¨è‡ªå›å½’è¿‡ç¨‹è¿›è¡Œæ—¶é—´åºåˆ—å»ºæ¨¡çš„ä¸»é¢˜ã€‚

æœ¬æ–‡å°†æ¶µç›–æ—¶é—´åºåˆ—åˆ†æä¸­çš„ä»¥ä¸‹å…³é”®è¦ç´ :

*   è‡ªå›å½’è¿‡ç¨‹
*   å°¤å°”-æ²ƒå…‹æ–¹ç¨‹
*   å¹³ç¨³æ€§
*   æ‰©å……çš„è¿ªå…‹-å¯Œå‹’è¯•éªŒ

ç¡®ä¿å‡†å¤‡å¥½ Jupyter ç¬”è®°æœ¬ï¼Œä»¥ä¾¿è·Ÿè¿›ã€‚ä»£ç å’Œæ•°æ®é›†å¯åœ¨[è¿™é‡Œ](https://github.com/marcopeix/time-series-analysis)è·å¾—ã€‚

æˆ‘ä»¬å¼€å§‹å§ï¼

> äº†è§£å¦‚ä½•ä½¿ç”¨æ›´å¤æ‚çš„æ¨¡å‹ï¼Œå¦‚ SARIMAXã€VARMAXï¼Œå¹¶åº”ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹(LSTMã€CNNã€ResNetã€è‡ªå›å½’ LSTM)è¿›è¡Œæ—¶é—´åºåˆ—åˆ†æï¼Œå¹¶ä½¿ç”¨ Python ä¸­çš„[åº”ç”¨æ—¶é—´åºåˆ—åˆ†æ](https://www.datasciencewithmarco.com/offers/tdU2mtVK)ï¼

# è‡ªå›å½’è¿‡ç¨‹

ä¸€ä¸ª**è‡ªå›å½’æ¨¡å‹**ä½¿ç”¨ç›®æ ‡è¿‡å»å€¼çš„çº¿æ€§ç»„åˆè¿›è¡Œé¢„æµ‹ã€‚å½“ç„¶ï¼Œå›å½’æ˜¯é’ˆå¯¹ç›®æ ‡æœ¬èº«è¿›è¡Œçš„ã€‚æ•°å­¦ä¸Šï¼ŒAR(p)æ¨¡å‹è¡¨ç¤ºä¸º:

![](img/3a7ea325900a6b2f2ee9e104d591f240.png)

è‡ªå›å½’æ¨¡å‹

å…¶ä¸­:

*   p:è¿™æ˜¯å‘½ä»¤å—
*   c:æ˜¯å¸¸æ•°
*   Îµ:å™ªå£°

AR(p)æ¨¡å‹éå¸¸çµæ´»ï¼Œå¯ä»¥æ¨¡æ‹Ÿè®¸å¤šä¸åŒç±»å‹çš„æ—¶é—´åºåˆ—æ¨¡å¼ã€‚å½“æˆ‘ä»¬æ¨¡æ‹Ÿè‡ªå›å½’è¿‡ç¨‹æ—¶ï¼Œè¿™æ˜¯å¾ˆå®¹æ˜“æƒ³è±¡çš„ã€‚

é€šå¸¸ï¼Œè‡ªå›å½’æ¨¡å‹ä»…é€‚ç”¨äºå¹³ç¨³æ—¶é—´åºåˆ—ã€‚è¿™é™åˆ¶äº†å‚æ•°*Ï†*çš„èŒƒå›´ã€‚

ä¾‹å¦‚ï¼ŒAR(1)æ¨¡å‹ä¼šå°† *phi* é™åˆ¶åœ¨-1 å’Œ 1 ä¹‹é—´ã€‚éšç€æ¨¡å‹é˜¶æ•°çš„å¢åŠ ï¼Œè¿™äº›çº¦æŸå˜å¾—æ›´åŠ å¤æ‚ï¼Œä½†æ˜¯åœ¨ Python ä¸­å»ºæ¨¡æ—¶ä¼šè‡ªåŠ¨è€ƒè™‘è¿™äº›çº¦æŸã€‚

## AR(2)è¿‡ç¨‹çš„æ¨¡æ‹Ÿ

è®©æˆ‘ä»¬ç”¨ Python æ¨¡æ‹Ÿä¸€ä¸ª AR(2)æµç¨‹ã€‚

æˆ‘ä»¬ä»å¯¼å…¥ä¸€äº›åº“å¼€å§‹ã€‚å¹¶éæ‰€æœ‰è¿™äº›éƒ½å°†ç”¨äºæ¨¡æ‹Ÿï¼Œä½†å®ƒä»¬å°†æ˜¯æœ¬æ•™ç¨‹å…¶ä½™éƒ¨åˆ†æ‰€å¿…éœ€çš„ã€‚

```
from statsmodels.graphics.tsaplots import plot_pacf
from statsmodels.graphics.tsaplots import plot_acf
from statsmodels.tsa.arima_process import ArmaProcess
from statsmodels.tsa.stattools import pacf
from statsmodels.regression.linear_model import yule_walker
from statsmodels.tsa.stattools import adfuller
import matplotlib.pyplot as plt
import numpy as np%matplotlib inline
```

æˆ‘ä»¬å°†ä½¿ç”¨ *ArmaProcess* åº“æ¥æ¨¡æ‹Ÿæ—¶é—´åºåˆ—ã€‚å®ƒè¦æ±‚æˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„å‚æ•°ã€‚

æˆ‘ä»¬å°†æ¨¡æ‹Ÿä»¥ä¸‹è¿‡ç¨‹:

![](img/8fd10d40ea027d0d4b3417c118762810.png)

AR(2)è¿‡ç¨‹

å› ä¸ºæˆ‘ä»¬æ­£åœ¨å¤„ç†ä¸€ä¸ª 2 é˜¶çš„è‡ªå›å½’æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰æ»å 0ï¼Œ1 å’Œ 2 çš„ç³»æ•°ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å°†å–æ¶ˆç§»åŠ¨å¹³å‡çº¿è¿‡ç¨‹çš„å½±å“ã€‚

æœ€åï¼Œæˆ‘ä»¬å°†ç”Ÿæˆ 10 000 ä¸ªæ•°æ®ç‚¹ã€‚

åœ¨ä»£ç ä¸­:

```
ar2 = np.array([1, 0.33, 0.5])
ma = np.array([1])simulated_AR2_data = ArmaProcess(ar2, ma).generate_sample(nsample=10000)
```

æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶æ—¶é—´åºåˆ—:

```
plt.figure(figsize=[10, 7.5]); # Set dimensions for figure
plt.plot(simulated_AR2_data)
plt.title("Simulated AR(2) Process")
plt.show()
```

æ‚¨åº”è¯¥ä¼šå¾—åˆ°ç±»ä¼¼è¿™æ ·çš„ç»“æœ:

![](img/f0f0d6d2cd296b47a9b98a27e6bd736b.png)

æ¨¡æ‹Ÿ AR(2)è¿‡ç¨‹çš„å›¾

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è‡ªç›¸å…³å›¾(ç›¸å…³å›¾):

```
plot_acf(simulated_AR2_data);
```

![](img/078d80ab3a8a9c2c64e964a3de691f8b.png)

AR(2)è¿‡ç¨‹çš„ç›¸å…³å›¾

ä½ å¯ä»¥çœ‹åˆ°ç³»æ•°åœ¨æ…¢æ…¢è¡°å‡ã€‚è¿™æ„å‘³ç€å®ƒä¸å¤ªå¯èƒ½æ˜¯ä¸€ä¸ª[ç§»åŠ¨å¹³å‡è¿‡ç¨‹](/basic-statistics-for-time-series-analysis-in-python-4cb147d56535)ï¼Œè¿™è¡¨æ˜æ—¶é—´åºåˆ—å¯èƒ½å¯ä»¥ç”¨ä¸€ä¸ªè‡ªå›å½’è¿‡ç¨‹æ¥å»ºæ¨¡(è¿™æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºè¿™æ­£æ˜¯æˆ‘ä»¬æ­£åœ¨æ¨¡æ‹Ÿçš„)ã€‚

ä¸ºäº†ç¡®ä¿è¿™æ˜¯æ­£ç¡®çš„ï¼Œè®©æˆ‘ä»¬ç»˜åˆ¶åè‡ªç›¸å…³å›¾:

```
plot_pacf(simulated_AR2_data);
```

![](img/365bec3f7124660e16ae2f8d6e5057c8.png)

AR(2)è¿‡ç¨‹çš„åè‡ªç›¸å…³å›¾

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæ»å 2 ä¹‹åï¼Œç³»æ•°å¹¶ä¸æ˜¾è‘—ã€‚å› æ­¤ï¼Œéƒ¨åˆ†è‡ªç›¸å…³å›¾å¯¹äºç¡®å®š AR(p)è¿‡ç¨‹çš„é˜¶æ•°æ˜¯æœ‰ç”¨çš„ã€‚

æ‚¨è¿˜å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥æ¯ä¸ªç³»æ•°çš„å€¼:

```
pacf_coef_AR2 = pacf(simulated_AR2_data)
print(pacf_coef_AR2)
```

ç°åœ¨ï¼Œåœ¨çœŸå®çš„é¡¹ç›®è®¾ç½®ä¸­ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰¾åˆ° AR(p)è¿‡ç¨‹çš„é˜¶ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥ä¼°è®¡ç³»æ•°*Ï†*ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å°¤å°”-æ²ƒå…‹æ–¹ç¨‹ã€‚è¿™ä¸ªæ–¹ç¨‹å…è®¸æˆ‘ä»¬åœ¨å·²çŸ¥é˜¶æ•°çš„æƒ…å†µä¸‹ä¼°è®¡ AR(p)æ¨¡å‹çš„ç³»æ•°ã€‚

```
rho, sigma = yule_walker(simulated_AR2_data, 2, method='mle')
print(f'rho: {-rho}')
print(f'sigma: {sigma}')
```

![](img/62d3c44e4bb14b40b261fed6e2710fa4.png)

å°¤å°”-æ²ƒå…‹ç³»æ•°ä¼°è®¡

å¦‚ä½ æ‰€è§ï¼ŒYule-Walker æ–¹ç¨‹åœ¨ä¼°ç®—æˆ‘ä»¬çš„ç³»æ•°æ–¹é¢åšå¾—ä¸é”™ï¼Œéå¸¸æ¥è¿‘ 0.33 å’Œ 0.5ã€‚

## AR(3)è¿‡ç¨‹çš„æ¨¡æ‹Ÿ

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ª AR(3)è¿‡ç¨‹ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†æ¨¡æ‹Ÿ:

![](img/82be40e5b34ede169b83dd0e98c87d76.png)

AR(3)è¿‡ç¨‹æ¨¡æ‹Ÿ

ç±»ä¼¼äºä¹‹å‰æ‰€åšçš„ï¼Œè®©æˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„ç³»æ•°å¹¶ç”Ÿæˆ 10 000 ä¸ªæ•°æ®ç‚¹:

```
ar3 = np.array([1, 0.33, 0.5, 0.07])
ma = np.array([1])simulated_AR3_data = ArmaProcess(ar3,ma).generate_sample(nsample=10000)
```

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†æ—¶é—´åºåˆ—å¯è§†åŒ–:

```
plt.figure(figsize=[10, 7.5]); # Set dimensions for figure
plt.plot(simulated_AR3_data)
plt.title("Simulated AR(3) Process")
plt.show()
```

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„å†…å®¹:

![](img/f27557f180c8c1f02c40781a71415137.png)

æ¨¡æ‹Ÿ AR(3)è¿‡ç¨‹

ç°åœ¨ï¼Œçœ‹çœ‹ PACF å’Œ ACF:

```
plot_pacf(simulated_AR3_data);
plot_acf(simulated_AR3_data);
```

![](img/c7cbebdfe69510a8c6bc9e3c73aa8552.png)

AR(3)æµç¨‹çš„ PACF å’Œ ACF

ä½ å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº PACF å‡½æ•°æ¥è¯´ï¼Œæ»å 3 ä¹‹åçš„ç³»æ•°å¹¶ä¸åƒé¢„æœŸçš„é‚£æ ·æ˜¾è‘—ã€‚

æœ€åï¼Œè®©æˆ‘ä»¬ä½¿ç”¨å°¤å°”-æ²ƒå…‹æ–¹ç¨‹æ¥ä¼°è®¡ç³»æ•°:

```
rho, sigma = yule_walker(simulated_AR3_data, 3, method='mle')
print(f'rho: {-rho}')
print(f'sigma: {sigma}')
```

![](img/484167879dff48fc394197680e29469f.png)

å°¤å°”-æ²ƒå…‹ç³»æ•°ä¼°è®¡

åŒæ ·ï¼Œä¼°è®¡å€¼ç›¸å½“æ¥è¿‘å®é™…å€¼ã€‚

# é¡¹ç›®â€”é¢„æµ‹å¼ºç”Ÿå…¬å¸çš„å­£åº¦æ¯è‚¡æ”¶ç›Š

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†è‡ªå›å½’è¿‡ç¨‹çš„çŸ¥è¯†åº”ç”¨åˆ°é¡¹ç›®è®¾ç½®ä¸­ã€‚

ç›®æ ‡æ˜¯æ¨¡æ‹Ÿå¼ºç”Ÿå…¬å¸ 1960 å¹´è‡³ 1980 å¹´é—´çš„æ¯è‚¡å­£åº¦æ”¶ç›Š(EPS)ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è¯»ä¸€ä¸‹[æ•°æ®é›†](https://github.com/marcopeix/time-series-analysis):

```
import pandas as pddata = pd.read_csv('jj.csv')
data.head()
```

![](img/92ebfc3ccfc676a67b141479468b0d8e.png)

æ•°æ®é›†çš„å‰äº”è¡Œ

ç°åœ¨ï¼Œå‰äº”è¡Œå¯¹æˆ‘ä»¬æ¥è¯´ä¸æ˜¯å¾ˆæœ‰ç”¨ã€‚è®©æˆ‘ä»¬ç»˜åˆ¶æ•´ä¸ªæ•°æ®é›†ï¼Œä»¥è·å¾—æ›´å¥½çš„å¯è§†åŒ–è¡¨ç¤ºã€‚

```
plt.figure(figsize=[15, 7.5]); # Set dimensions for figure
plt.scatter(data['date'], data['data'])
plt.title('Quaterly EPS for Johnson & Johnson')
plt.ylabel('EPS per share ($)')
plt.xlabel('Date')
plt.xticks(rotation=90)
plt.grid(True)
plt.show()
```

![](img/79e05087b34d78d12ea8dcd6ccd47bcd.png)

å¼ºç”Ÿå…¬å¸ 1960 å¹´è‡³ 1980 å¹´é—´çš„æ¯è‚¡æ”¶ç›Š

å‰å®³ï¼ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°æ®æœ‰æ˜æ˜¾çš„ä¸Šå‡è¶‹åŠ¿ã€‚è™½ç„¶è¿™å¯¹å…¬å¸æ¥è¯´å¯èƒ½æ˜¯ä¸€ä¸ªå¥½è¿¹è±¡ï¼Œä½†å°±æ—¶é—´åºåˆ—å»ºæ¨¡è€Œè¨€ï¼Œè¿™å¹¶ä¸å¥½ï¼Œå› ä¸ºè¿™æ„å‘³ç€æ—¶é—´åºåˆ—ä¸æ˜¯å¹³ç¨³çš„ã€‚

å¦‚å‰æ‰€è¿°ï¼ŒAR(p)è¿‡ç¨‹ä»…é€‚ç”¨äºå¹³ç¨³åºåˆ—ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å¯¹æ•°æ®è¿›è¡Œä¸€äº›è½¬æ¢ï¼Œä½¿å…¶ä¿æŒç¨³å®šã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†å–å¯¹æ•°å·®ã€‚è¿™ç›¸å½“äºå–æ¯ä¸ªå€¼çš„å¯¹æ•°ï¼Œå‡å»å‰ä¸€ä¸ªå€¼ã€‚

```
# Take the log difference to make data stationarydata['data'] = np.log(data['data'])
data['data'] = data['data'].diff()
data = data.drop(data.index[0])
data.head()
```

ç»˜åˆ¶è½¬æ¢åçš„æ—¶é—´åºåˆ—:

```
plt.figure(figsize=[15, 7.5]); # Set dimensions for figure
plt.plot(data['data'])
plt.title("Log Difference of Quaterly EPS for Johnson & Johnson")
plt.show()
```

![](img/0615704bff48cc2348ab2732cc8b3efe.png)

å¼ºç”Ÿå…¬å¸å­£åº¦æ¯è‚¡æ”¶ç›Šçš„å¯¹æ•°å·®å¼‚

ç°åœ¨ï¼Œä¼¼ä¹æˆ‘ä»¬æ¶ˆé™¤äº†è¿™ç§è¶‹åŠ¿ã€‚ç„¶è€Œï¼Œåœ¨ç”¨ AR(p)è¿‡ç¨‹å»ºæ¨¡ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿æˆ‘ä»¬çš„åºåˆ—æ˜¯å¹³ç¨³çš„ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ‰©å±•çš„ Dicker-Fuller æ£€éªŒã€‚è¿™å°†ç»™æˆ‘ä»¬ç»Ÿè®¡ä¸Šçš„ä¿¡å¿ƒï¼Œæˆ‘ä»¬çš„æ—¶é—´åºåˆ—ç¡®å®æ˜¯å¹³ç¨³çš„ã€‚

```
ad_fuller_result = adfuller(data['data'])
print(f'ADF Statistic: {ad_fuller_result[0]}')
print(f'p-value: {ad_fuller_result[1]}')
```

![](img/f37e92c3620b58ab4e8a3ae27904f921.png)

ADF æµ‹è¯•çš„ç»“æœ

ç”±äºæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå¤§çš„è´Ÿ ADF ç»Ÿè®¡é‡å’Œå°äº 0.05 çš„ p å€¼ï¼Œæˆ‘ä»¬å¯ä»¥æ‹’ç»é›¶å‡è®¾ï¼Œè¯´æˆ‘ä»¬çš„æ—¶é—´åºåˆ—æ˜¯å¹³ç¨³çš„ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡ç»˜åˆ¶ PACF æ¥æ‰¾åˆ°è¯¥è¿‡ç¨‹çš„é¡ºåº:

```
plot_pacf(data['data']);
plot_acf(data['data']);
```

![](img/233e0d758d8e1aeee3590a2cf2e600dc.png)

PACF å’Œ ACF

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œåœ¨æ»å 4 ä¹‹åï¼ŒPACF ç³»æ•°ä¸å†é‡è¦ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†å‡è®¾ä¸€ä¸ª 4 é˜¶çš„è‡ªå›å½’è¿‡ç¨‹ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œé€šè¿‡ Yule-Walker æ–¹ç¨‹æ¥ä¼°ç®—ç³»æ•°:

```
# Try a AR(4) model
rho, sigma = yule_walker(data['data'], 4)
print(f'rho: {-rho}')
print(f'sigma: {sigma}')
```

![](img/fa41a05858095019ecd3c9db6b8e4497.png)

å°¤å°”-æ²ƒå…‹ç³»æ•°ä¼°è®¡

å› æ­¤ï¼Œè¯¥å‡½æ•°è¿‘ä¼¼ä¸º:

![](img/086e093acdcd8b0945008053a1f448cf.png)

è¯·æ³¨æ„ï¼Œæ­¤ç­‰å¼æ¨¡æ‹Ÿäº†è½¬æ¢åçš„åºåˆ—ã€‚

# ç»“è®º

æ­å–œä½ ï¼æ‚¨ç°åœ¨äº†è§£äº†ä»€ä¹ˆæ˜¯è‡ªå›å½’æ¨¡å‹ï¼Œå¦‚ä½•è¯†åˆ«è‡ªå›å½’è¿‡ç¨‹ï¼Œå¦‚ä½•ç¡®å®šå…¶é¡ºåºï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒæ¥æ¨¡æ‹Ÿç°å®ç”Ÿæ´»ä¸­çš„æ—¶é—´åºåˆ—ã€‚

æé«˜æ‚¨çš„æ—¶é—´åºåˆ—åˆ†ææŠ€èƒ½ï¼Œå¹¶å­¦ä¹  Python ä¸­æ—¶é—´åºåˆ—åˆ†æçš„æœ€æ–°æœ€ä½³å®è·µ:

*   [åœ¨ Python ä¸­åº”ç”¨æ—¶é—´åºåˆ—åˆ†æ](https://www.datasciencewithmarco.com/offers/tdU2mtVK)

å¹²æ¯ğŸº