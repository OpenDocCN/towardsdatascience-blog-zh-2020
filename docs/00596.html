<html>
<head>
<title>Writing your own Scikit-learn classes — for beginners.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为初学者编写自己的Scikit-learn类。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/writing-your-own-scikit-learn-classes-for-beginners-1e4e7d4de203?source=collection_archive---------20-----------------------#2020-01-17">https://towardsdatascience.com/writing-your-own-scikit-learn-classes-for-beginners-1e4e7d4de203?source=collection_archive---------20-----------------------#2020-01-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6fd3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让你尽快入门的基础知识</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/16e1c183cebabf890271997480963afc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y1dQgNrQ8FyVQ8Rm.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自:<a class="ae ky" href="https://en.wikipedia.org/wiki/File:Scikit_learn_logo_small.svg" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/File:Scikit _ learn _ logo _ small . SVG</a></p></figure><p id="069b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> S </span> cikit-learn是用于监督机器学习的最流行的Python库之一，它是一个非常强大的工具，同时也很简单。但我认为，它成功的原因主要不是因为它的核心功能，而是因为它的所有模块都具有很好的内聚性和一致性。这也是除了它的流行之外，为什么许多其他流行的库如XGBoost、pyGAM、lighGBM和pyEarth都是以Scikit-learn的风格编写的，并确保与它兼容，几乎就像它们是核心库的一部分一样。许多与Scikit-learn兼容的有用项目可以在<a class="ae ky" href="https://scikit-learn.org/stable/related_projects.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="8302" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种内聚兼容性是Scikit-learn拥有自己的一套简单指南的结果，如果遵循这些指南，将确保一切正常运行。它还提供了一组基类，使得创建自己的类的过程更加容易。如果您是编写自己的类的新手，无论是为了自己使用还是为了一个库，本文都可以为您提供一个坚实的起点。</p><h1 id="19c5" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">作为一个初学者，为什么要编写自己的类？</h1><p id="c4f0" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">现在，您可能想知道为什么有人要编写自己的类，如果已经有这么多专业编写的类可以使用的话？你考虑一下是对的，因为如果免费提供的软件能完全满足你的需要，你就不应该再费心去写自己的了。然而，即使作为一个初学者，你也有可能在你自己独特的工作流程中遇到一些你想做的操作，但是没有什么东西可以完全按照你想要的那样去做。如果这个操作是您经常要做的，那么为它编写自己的类会很有用。</p><p id="def1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，如果您的操作处于一系列具有预写类的操作之间，它可能会阻止您将其添加到管道中以实现完全自动化。此外，使用Scikit-learn工具(如GridSearchCV)不可能在整个过程中使用模型选择。</p><p id="a8f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他一些很好的理由是:</p><ul class=""><li id="4c20" class="nc nd it lb b lc ld lf lg li ne lm nf lq ng lu nh ni nj nk bi translated">它发展你的编程技能。</li><li id="4e25" class="nc nd it lb b lc nl lf nm li nn lm no lq np lu nh ni nj nk bi translated">它可以随着时间的推移而发展，为您自己的工作提供更多的选项和功能，也可能最终对他人有用。</li><li id="d249" class="nc nd it lb b lc nl lf nm li nn lm no lq np lu nh ni nj nk bi translated">它使您能够为开源社区做出贡献。理解你所使用的大多数极其强大的工具之所以可以免费获得是因为这些贡献。</li></ul><p id="cd58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，让我们直接开始创建自己的类。</p><p id="7904" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您想要构建一个转换器，从列中的所有值中减去列中的最小数字。例如，假设一列有数字[10，11，12，13，14，15]，我们的转换器将把它改为[0，1，2，3，4，5]。这可能不是一个特别有用的变压器位，这是一个非常简单的例子，刚刚开始。</p><p id="0a4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建两个玩具数据帧:</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="8434" class="nv mf it nr b gy nw nx l ny nz">import pandas as pd</span><span id="b096" class="nv mf it nr b gy oa nx l ny nz">df_a = pd.DataFrame({‘Number’:[11, 12, 13, 14, 15],’Color’: [‘Red’, ‘Blue’, ‘Green’, ‘Yellow’, ‘Orange’]})<br/>df_b = pd.DataFrame({‘Number’:[21, 22, 23, 24, 25],’Color’: [‘Violet’, ‘Black’, ‘White’, ‘Brown’, ‘Pink’]})</span></pre><p id="009a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是它们的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/5e8df24978344a7234bdf306b9f6f046.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*lt7nvALBEPsbiTp1chXF9Q.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/cf08c658c47fe36bdaa17bc222e12ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*JgyggZxXW4pkwwdvL1VVLQ.png"/></div></figure><p id="331b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们编写转换器:</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="b782" class="nv mf it nr b gy nw nx l ny nz"># These allow us the class to inherit Scikit-learn methods<br/># such as fit and transform<br/>from sklearn.base import BaseEstimator, TransformerMixin</span><span id="e0ea" class="nv mf it nr b gy oa nx l ny nz"># This function just makes sure that the object is fitted<br/>from sklearn.utils.validation import check_is_fitted</span><span id="de20" class="nv mf it nr b gy oa nx l ny nz">class SubtractMin(BaseEstimator, TransformerMixin):<br/>     def __init__(self, cols_to_operate):<br/>         self.columns = cols_to_operate</span><span id="c05c" class="nv mf it nr b gy oa nx l ny nz">     def fit(self, X, y = None):<br/>         self.min_val_ = X[self.columns].min()<br/>         return self<br/> <br/>     def transform(self, X):<br/>         # make sure that it was fitted<br/>         check_is_fitted(self, ‘min_val_’)<br/> <br/>         X = X.copy() # This is so we do not make changes to the            <br/>                        original dataframe<br/>         X[self.columns] = X[self.columns] — self.min_val_<br/>         return X</span></pre><p id="9bd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们从sklearn.base导入的类是使它工作的粘合剂。正是它们让我们的功能适合Scikit-learn的管道和模型选择工具。BaseEstimator只是给了它所有Scikit-learn估算器都需要的get_params和set_params方法。TransformerMixin为它提供了fit_transform方法。</p><p id="2608" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">BaseEstimator文档可以在<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.base.BaseEstimator.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到，TransformerMixin文档可以在<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.base.TransformerMixin.html#sklearn.base.TransformerMixin" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="7ac5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据您想要构建的估计器的类型，还有其他类型的“<a class="ae ky" href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.base" rel="noopener ugc nofollow" target="_blank">mixin</a>”可用，例如ClassifierMixin和RegressorMixin，它们提供了对评分方法的访问。您可能知道，一般来说，数据处理器使用fit方法(以及fit_transform ),模型(回归器和分类器)使用predict方法。因此，在创建评估器时，您需要添加适当的类作为父类。例如，一个自定义回归器需要BaseEstimator和RegressorMixin，其他更复杂的类根据其功能可能需要更多。</p><p id="eabe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">check_is_fitted只是一种验证方法，用于确保在尝试对对象进行某些操作之前，已经对其进行了拟合。</p><p id="cbce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在__init__方法中，我们为它添加了转换器需要的所有初始参数。在这里，我们需要操作的只是数据帧的列名。</p><p id="5376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">fit和transform方法是所有Scikit-Learn转换器的必需方法(对于回归和分类器，它将是fit和predict)。在我们的例子中，fit方法只是找出列中的最小值并存储它。你可能注意到了，这里有一个y = None，尽管我们在fit方法中没有用到y。这是为了与Scikit-learn中的其他类保持一致，并确保管道中的兼容性。合体的方法也<strong class="lb iu">总是</strong>得回归自我。</p><p id="41d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">transform方法完成工作并返回输出。我们制作一个副本，这样原始数据帧就不会被触及，然后减去fit方法存储的最小值，然后返回输出。显然，这将在您自己的有用方法中更详细地说明。</p><p id="faba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看我们的变压器在工作。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="db2a" class="nv mf it nr b gy nw nx l ny nz">sub = SubtractMin(‘Number’)<br/>sub.fit_transform(df_a)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/cd16d58bf5dcf680aa333f01418844ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*iRNNvpzIpw01pFJyfqr30Q.png"/></div></figure><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="8c57" class="nv mf it nr b gy nw nx l ny nz">sub.transform(df_b)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/90af2ff2ae07f3beaff00a80eaea7d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*rvQbOcSVRkVD0I3GIlG7PQ.png"/></div></figure><p id="b997" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能注意到的第一件事是，我们使用了fit_transform方法，尽管我们没有明确使用它。如前所述，这是从TransformerMixin基类继承的。</p><p id="9036" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的转换器实际上从df_a (10)中“学习”了最小值，并在调用fit_transform方法时从列中减去该值。然后，当调用transform方法时，它从b中减去相同的最小值。</p><p id="26f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Scikit-learn有一套更详细的指南，需要遵循这些指南才能有所帮助，但是这些指南应该足以确保兼容性，并帮助您为自己的项目编写类。一旦你习惯了写你的课程，看看他们的指导方针(在这里<a class="ae ky" href="https://scikit-learn.org/stable/developers/develop.html" rel="noopener ugc nofollow" target="_blank"/>)是个好主意，这样你就可以为社区做贡献了。这些指南更适合于为Scikit-learn或类似的库做出贡献。没有必要全部遵守，但建议遵守。有很多项目并没有按照写的那样进行。把在自己的班级里努力当作一个长期目标。</p><p id="bde1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望这能成为一个足够快的指南，帮助您开始编写自己的自定义Scikit-learn类。祝你好运！</p></div></div>    
</body>
</html>