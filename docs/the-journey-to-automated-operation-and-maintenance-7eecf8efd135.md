# 自动化运维之旅

> 原文：<https://towardsdatascience.com/the-journey-to-automated-operation-and-maintenance-7eecf8efd135?source=collection_archive---------33----------------------->

## 无需人工干预即可操作服务器

您是否想象过您可以从操作和维护服务器的繁重重复的日常工作中解脱出来？你想自动化所有这些无聊的东西，专注于更有创意的吗？自动化操作和维护的价值在于消除了手动和重复性任务，使用工具和平台来自动化曾经是手动的流程，如修补、配置和部署等。

# 自动化操作和维护的范围

在学习自动化操作之前，我们先回到起点，看看什么是操作。操作和维护应包括以下内容:

*   **环境定义:**包括开发环境、测试环境、预生产环境、生产环境等。
*   **部署:**有效地将包部署到不同环境的能力。
*   **监控:**在部署后监控系统和应用程序的能力。
*   **报警响应:**报警发生时的响应和处理机制。
*   **性能优化:**包括系统各种服务的优化，如 Nginx、Java、PHP、数据库或网络。
*   **SLA 保证:**这通常需要在与业务相关部门讨论后决定。

自动化运维也应该包括以上六类。在实践中，我们将关注三个自动化。第一，自动化环境定义；第二，自动化部署；第三，自动化监控。

![](img/7d847899f89fd6c82c13723da79c5921.png)

照片由 [Goh Rhy Yan](https://unsplash.com/@gohrhyyan?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

# 自动化操作和维护的三个阶段

## 操作自动化

自动化操作和维护的第一阶段是操作自动化。在这个阶段，我们将日常事务中一系列手动执行的操作与脚本或工具联系起来。最简单的例子是将多个 shell 脚本放在一起执行特定的操作。这种程度的自动化只是解决了手动执行的一部分问题，因为一旦运行条件发生了变化，shell 脚本可能就要改了，运维压力还是很大的，而且容易出错。您管理的服务器和系统越多，出错的可能性就越大。

![](img/447d2d938a4c8641249dc910e14d700a.png)

卢卡·布拉沃在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

## 场景自动化

自动化运维的第二个阶段是场景自动化。在这个层面上，自动化工具会根据外部环境判断如何运行，这些判断条件是预先定义好的。这个级别的运维系统需要各种类型的环境数据来做出判断，还需要能够根据变化来操作，比如不同的执行步骤。因此，这个级别的运维系统需要与许多其他系统进行接口，如配置系统、网络管理系统等。，最好也有一个流程引擎。

![](img/3e3c62e4438d0c5979745d4093c047b6.png)

照片由[达里娅·内布里亚希娜](https://unsplash.com/@epicantus?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄

## 人工智能操作(AIOps)

自动化操作的第三阶段是人工智能操作，即所谓的 AIOps。这个级别的运维体系有一个数据核心，有基于数据的自我分析判断能力，有自我决策和执行的能力。这一级别的运维主要工作是在系统中加入分析策略，对这个智能运维系统进行运维，并介入对系统关键节点进行人工判断。

# 自动化操作和维护的价值

自动化运维的价值在于将运维从繁琐、常规、人为易出事的工作中分离出来，去做更有价值的业务运维、服务运维。从这个角度来说，自动化运维既不是起点，也不是终点。自动化运维不是万能的。如何构建您的自动化系统取决于您的业务支持哪种服务。自动化运维毕竟只是一个高级工具。运维的价值最终体现在业务上，实现的方式就是运营服务化(或者运营即服务)。因此，运维自动化的目标是摆脱所有的人类干预，达到一种我们可以将运维便捷化为服务的水平。

![](img/d8e42223a138b871b499845181a55a43.png)

马库斯·温克勒在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

# 自动化操作和维护的体系结构

接下来，我们将介绍自动化运维的架构。本节内容主要包括自动化运维系统的目标、自动化运维系统架构概述、自动化运维系统架构的构建原则。

# 自动化操作和维护系统的四个目标

首先，我们来看看自动化运维系统的目标。我们可以用四个字来概括构建一套自动化运维系统的目标:

1.  **完整性**意味着系统必须能够覆盖所有的操作和维护需求。
2.  **简单**意味着易于使用。如果系统的操作流程、操作界面、设计思路都很复杂，运维人员的学习成本会很高，有效性会大打折扣，系统的能力和效率也会降低。
3.  **高效**，特别是在批量处理或者执行特定任务的时候，我们希望系统能够及时反馈。
4.  **安全**。如果一个系统不安全，它可能会很快被黑客接管，所以安全也是一个重要的因素。

# 自动化操作和维护架构概述

自动化运维系统的核心是自动化运维管理平台。根据业务情况，其他模块可能略有不同。典型的模块包括自动安全检查系统、自动更新系统、自动数据分析和数据备份系统以及自动监控和报警系统。自动更新系统分为服务器端更新系统和客户端更新系统。在各个模块之间，自动化运维平台将为自动化安检系统和自动化更新系统提供底层支持；自动数据分析系统和自动更新系统将互连，并且自动数据分析系统将对自动更新系统的结果给出反馈。

# 自动化运维体系建设的三个原则

自动化运维系统是系统工程、规划和建设的理念。有几个原则供你参考。

## 渐进过程

中小型公司不需要复杂但庞大的系统。如果系统从一开始就设计的非常大，功能非常丰富，可能会导致一些无法控制的情况。这个系统可能因为耦合太强，发展无法控制，或者因为资金问题导致项目搁浅，最后都不行。但如果一开始的目标就是解决一些具体问题，有针对性，那么就更容易推进。

![](img/9c8bcea777d06540026eb1a7e5eb659c.png)

斯蒂芬·亨宁在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

## 可量测性

第二是考虑可扩展性。在设计系统的时候，可能没有那么多的功能或者设计考虑，但是要考虑当服务器数量相对膨胀的时候，系统是否还能支撑。例如，系统是否可以在 10 到 100 或数千个服务器的数量级上使用。

## 实用目的

在许多情况下，市场上可能已经有了更成熟的协议和工具。对它们进行评估，看看它们是否可以在您的生产环境中使用。如果能直接用，就没必要自己再做一套了。你自己做的这套工具，很多方面都没有经过验证，可能会造成安全问题。基于成熟的协议和框架来实现它们可以提高效率并确保稳定性和安全性。

# 自动化操作和维护的技术框架

## 监控是自动化操作和维护的核心概念

首先让我们了解一个概念:**监控是自动化运维的核心。**影响运维工作效率的主要因素是响应速度。运维人员需要持续盯着告警页面，然后通知相应人员处理告警。在生产系统中，我们需要将服务器的状态监控作为自动化运维的核心问题。监控用于驱动操作和维护事件的启动、处理和终止。ElkStack Zabbix 和 Zabbix-Agent 获取服务器每天的工作状态和服务信息，并生成时间序列统计图用于结果分析。

![](img/618f7da83811c697848d37d29be55e7e.png)

斯蒂芬·道森在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

通过精准有效的报警策略，专业的人才能做专业的事。生产系统可以通过邮件、微信、短信等方式发送报警，根据故障类型和影响程度及时通知相应人员，并根据 SLA 升级事件。一些运维系统是针对微信平台开发的，可以提供更多的功能，比如通过模板处理问题。例如，当服务器的磁盘利用率达到 90%时，就会向相应的处理人员发出警报。此时，处理人员可以从微信中选择并操作相应的垃圾清除模板、数据修复模板、删除历史日志模板等。，可用于结算操作。这样的模式自然大大提高了运维效率。

## 模板化部署是自动化运维的必备工具

模板化部署是自动化运维不可或缺的工具。对于运维工程师来说，真正意义上的服务器维护的负荷并不重，真正的负担是环境的部署。有时候环境的部署会占用运维工程师 80%以上的时间。由于操作系统版本的不同，系统环境的手动和随机初始化，以及不同软件包版本的更新，一系列的问题会导致工程师在部署运维工具或公司产品时出现各种奇怪的问题。模板描述了如何部署一组资源和安装所需的软件。模板指定要使用的资源、要设置的属性以及自动部署特定应用程序所需的参数。然后，您可以使用编排引擎自动创建和配置模板中的所有资源，以简化部署和操作维护

## 自动化运维框架和工具

接下来，我们看几个自动化操作和维护框架和工具。业界有三种主流工具:Ansible、SaltStack 和 Puppet。

**可回答的**

[](https://www.ansible.com/) [## Ansible 是简单的 IT 自动化

### Ansible 是自动化应用和 IT 基础设施的最简单方式。应用程序部署+配置管理+…

www.ansible.com](https://www.ansible.com/) 

Ansible 是基于 Python 开发的。它不能批量部署。ansible 运行的模块是批量部署的。Ansible 提供了一个框架，主要模块包括连接插件、多任务插件剧本等等。

Ansible 具有以下特征。

1.  它不需要在被控制的主机上安装客户端，也不需要服务器。使用时可以直接运行命令。但是，operation 命令的服务器 Python 版本必须高于 2.6。
2.  它基于模块，可以用任何语言开发。
3.  使用 YAML 语言定制剧本。
4.  其他包括基于 ansible 的 SSH 工作，可以有效地实现多级命令。

**盐堆**

[](https://www.saltstack.com/) [## 主页|盐栈

### IT、网络和安全运营团队使用 SaltStack 基础架构自动化软件来提高安全性…

www.saltstack.com](https://www.saltstack.com/) 

SaltStack 是服务器基础设施的集中管理平台，具有配置管理、远程执行和监控功能。SaltStack 基于 Python，结合了轻量级消息队列和 Python 第三方模块。通过部署 SaltStack 环境可以实现的功能包括在数千台服务器上批量执行命令，以及基于不同业务特征的集中配置管理、文件分发、服务器数据收集、操作系统基础和软件包管理。

**傀儡**

[](https://puppet.com/) [## 强大的基础设施自动化和交付|木偶

### 我们希望在扩大客户群的同时确保高效地扩大规模——有了 Puppet，我们可以做到这一点。我们可以关注…

puppet.com](https://puppet.com/) 

Puppet 是一个用于 Linux Unix 平台的集中式配置管理系统；它基于 C/S 架构，用 Ruby 语言开发。它可以管理配置文件、用户、cron 任务、软件包、系统服务等。Puppet 将这些系统实体称为资源，其设计目标是简化这些资源的管理，并妥善处理资源之间的依赖关系。Puppet 是一个基于 C/S 的配置管理工具。Puppet-Server 安装在中央服务器上，客户机软件安装在需要管理的目标主机上。当客户机连接到 puppet-master 时，puppet master 上的配置文件被编译，然后在客户机上运行。

# 摘要

最后，我们总结一下。首先，我们介绍了自动化运维的范围，包括三个自动化:环境自动化、部署自动化和监控自动化。接下来，我们介绍了自动化运维的三个阶段，即运营自动化、场景自动化、人工智能运营。我们还介绍了自动化操作和维护的价值。它是把运维从繁琐、常规、人为的任务中分离出来，做更有价值的业务运维、服务运维。

然后，我们介绍了自动化操作和维护系统的目标。我们可以用四个词来概括它们:完整、简单、高效和安全。接下来，我们介绍了自动化运维系统的总体架构。自动化运维管理平台是整个系统的核心。其他典型模块有自动安检系统、自动更新系统、自动数据分析和数据备份系统、自动监控和报警系统。接下来，我们介绍了构建自动化运维系统的原则。有三个原则:循序渐进，考虑可扩展性，实用目的。

上一节我们介绍了一个概念:监控是自动化运维的核心概念，响应速度是决定运维效率的一大因素。有效的监控方法可以提高响应速度和运维效率。我们引入了模板化部署，这是自动化运维不可或缺的工具。最后，我们介绍了几个用于自动化操作和维护的工具，即 Ansible、SaltStack 和 Puppet。

# 是时候不用服务器了

哇，上面好多东西，感觉筋疲力尽吧？我也有同感。经过我五年多的操作和维护经验，我找到了一个解决方案:无服务器！那是什么？那就是运行您的应用程序而不操作和管理您的服务器！这是从 HumanOps 到 AutoOps 再到 NoOps 的过程。你将所有的操作和维护工作外包给世界上最好的工程师，所有这些都由公共云服务提供商管理，他们已经构建了许多自动化工具来运行他们的网络，现在他们将服务出售给其他人。这是无服务器时代。