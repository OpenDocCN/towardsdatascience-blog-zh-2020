# ä½¿ç”¨ DVC æ„å»ºå¯ç»´æŠ¤æœºå™¨å­¦ä¹ ç®¡é“çš„æœ€ç»ˆæŒ‡å—

> åŸæ–‡ï¼š<https://towardsdatascience.com/the-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b?source=collection_archive---------13----------------------->

## [è§†é¢‘æ•™ç¨‹](https://towardsdatascience.com/tagged/video-tutorial)

## å­¦ä¹ ä½¿ç”¨ DVC æ„å»ºå¯ç»´æŠ¤çš„æœºå™¨å­¦ä¹ ç®¡é“çš„åŸåˆ™

è§†é¢‘æ•™ç¨‹

å½“æˆ‘çš„ ML é¡¹ç›®å¼€å§‹å‘å±•æ—¶ï¼Œæˆ‘é€šå¸¸ä¼šæ„Ÿåˆ°ç„¦è™‘ï¼Œå› ä¸º:**ä¸€åˆ‡éƒ½å¼€å§‹å˜å¾—æ··ä¹±**ã€**å’Œ*æˆ‘çŸ¥é“å®ƒå˜å¾—ä¸€å›¢ç³Ÿ*ã€**ä½†æ˜¯**æˆ‘ä¸çŸ¥é“å¦‚ä½•æ”¹è¿›å®ƒ**ã€‚æˆ‘å–œæ¬¢ä½¿ç”¨å¼€æºå·¥å…·å’Œæ¡†æ¶ï¼Œå› ä¸ºéšç€é¡¹ç›®çš„å‘å±•ï¼Œè´¡çŒ®è€…çš„çŸ¥è¯†ä¼šâ€œåµŒå…¥â€å…¶ä¸­ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ„å‘³ç€å¦‚æœæˆ‘åœ¨æ„å»ºå¯å¤åˆ¶çš„æœºå™¨å­¦ä¹ ç®¡é“æ–¹é¢æ²¡æœ‰å¤ªå¤šç»éªŒï¼Œå¦‚æœ**æˆ‘ä½¿ç”¨ä¸€ä¸ªç”±æ‹¥æœ‰ä¸°å¯Œæ„å»ºç»éªŒçš„äººåˆ›é€ çš„å·¥å…·**ï¼Œæˆ‘å®é™…ä¸Šæ˜¯åœ¨æˆ‘çš„é¡¹ç›®ä¸­ä½¿ç”¨ä»–ä»¬çš„åŸåˆ™**(ä»¥åŠå­¦ä¹ )ã€‚**

[DVC](https://dvc.org/) æ˜¯ä¸€ä¸ª**æœºå™¨å­¦ä¹ é¡¹ç›®**çš„å¼€æºç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚èµ·åˆï¼Œæˆ‘ä»¥ä¸ºå®ƒåªæ˜¯ä¸€ä¸ªå¤§æ–‡ä»¶çš„ Gitï¼Œä½†æ˜¯è¿™ä¸ªç³»ç»Ÿå®é™…ä¸Šæ»¡è¶³äº†æˆ‘å¯¹å®éªŒå’Œç®¡é“ç®¡ç†çš„æ‰€æœ‰éœ€æ±‚ã€‚ä»–ä»¬æœ€è¿‘å‘å¸ƒäº† [DVC 1.0](https://dvc.org/blog/dvc-1-0-release) ä»¥åŠæ–°çš„[å…¥é—¨æŒ‡å—](https://github.com/iterative/example-get-started)ï¼Œæˆ‘ç”¨å®ƒä½œä¸ºæœ¬æ•™ç¨‹çš„èµ·ç‚¹ã€‚

ä»Šå¤©æˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨ DVC æ„å»ºå¯å¤åˆ¶çš„æœºå™¨å­¦ä¹ ç®¡é“ã€‚ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æœ€ç»ˆä»£ç [ã€‚è¯´å¤Ÿäº†ï¼Œæˆ‘ä»¬å¼€å§‹å§ï¼](https://github.com/dmesquita/dvc_pipelines_and_experiments_tutorial)

![](img/3be9870d3e2b5e09124d27e05fa32755.png)

æ„Ÿè°¢ [@realaxer](https://unsplash.com/@realaxer) è¿™å¼ [é…·å›¾](https://unsplash.com/photos/9AxFJaNySB8)ï¼ï¼›)

# æˆ‘ä»¬å°†è¦å»ºé€ çš„ä¸œè¥¿

è®©æˆ‘ä»¬**å»ºç«‹ä¸€ä¸ªæ¨¡å‹æ¥** **å¯¹ 20 ä¸ªæ–°é—»ç»„æ•°æ®é›†**è¿›è¡Œåˆ†ç±»ã€‚ä¸ºäº†ç®€åŒ–è¯„ä¼°é˜¶æ®µï¼Œæˆ‘ä»¬å°†åªä½¿ç”¨ä¸¤ä¸ªç±»åˆ«ã€‚è¿™æ˜¯å®Œæˆè¯¥ä»»åŠ¡çš„ä¸»è¦è„šæœ¬:

è®­ç»ƒåˆ†ç±»å™¨çš„ä¸»è„šæœ¬

ç¼–å†™å¹²å‡€ä¸”å¯ç»´æŠ¤çš„ä»£ç çš„ä¸€ä¸ªå¥½çš„å·¥ä½œæµç¨‹æ˜¯**æ€»æ˜¯ä¸æ–­æé«˜ä»£ç çš„è´¨é‡**ã€‚å¯ä»¥åšå®éªŒçœ‹çœ‹æ˜¯å¦æœ‰æ•ˆ(å°±åƒæˆ‘ä»¬åœ¨ä¸Šé¢`main.py`åšçš„é‚£æ ·)ã€‚æ—¢ç„¶æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬è¦æ„å»ºä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–ä¸‹ä¸€æ­¥ï¼Œè®©ä»£ç æ›´æ˜“äºç»´æŠ¤ã€‚

# ğŸ’¡åˆ©ç”¨ DVC å»ºé€ ç®¡é“çš„åŸç†

å¦‚æœæˆ‘ä»¬ä»”ç»†çœ‹çœ‹`main.py`ï¼Œæˆ‘ä»¬å¯ä»¥å°†è„šæœ¬åˆ†è§£æˆé‚£äº›è‘—åçš„æœºå™¨å­¦ä¹ æ­¥éª¤:

> 1-æ”¶é›†æ•°æ®
> 
> 2-ç”Ÿæˆç‰¹å¾
> 
> 3-è®­ç»ƒæ¨¡å‹
> 
> 4 â€”è¯„ä¼°æ¨¡å‹

ç°åœ¨æˆ‘ä»¬æœ‰äº†æ­¥éª¤ï¼Œ**è¿™äº›æ˜¯ä½¿ç”¨ DVC** æ„å»ºå¯ç»´æŠ¤ç®¡é“çš„åŸåˆ™:

*   **ä¸ºæ¯ä¸ªæ­¥éª¤ç¼–å†™ä¸€ä¸ª python è„šæœ¬**
*   **å°†æ¯ä¸ªè„šæœ¬ä½¿ç”¨çš„å‚æ•°**ä¿å­˜åœ¨`yaml`æ–‡ä»¶ä¸­
*   æŒ‡å®šæ¯ä¸ªè„šæœ¬**ä¾èµ–çš„æ–‡ä»¶**
*   æŒ‡å®šæ–‡ä»¶æ¯ä¸ªè„šæœ¬**ç”Ÿæˆ**

è®©æˆ‘ä»¬å®‰è£… DVCï¼Œçœ‹çœ‹å¦‚ä½•å®ç°è¿™äº›æ­¥éª¤ã€‚

# ğŸ”¨å®‰è£… DVC

æˆ‘ä½¿ç”¨çš„æ˜¯ Linuxï¼Œæˆ‘ä»¬å°†**å®‰è£… DVC ä½œä¸º Python åº“**ã€‚ä¸ºäº†è·Ÿè¿›ï¼Œæ‚¨åº”è¯¥åœ¨æ‚¨çš„ç¯å¢ƒä¸­å®‰è£… **Python 3ã€pip** å’Œ **Git** ã€‚æˆ‘ä»¬å°†ä¸ºé¡¹ç›®åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒ(æç¤º:å¦‚æœä½ å…³å¿ƒç®¡ç†ä½ çš„é¡¹ç›®ï¼Œä½ åº”è¯¥æ€»æ˜¯è¿™æ ·åš)ã€‚DVC åœ¨ Git å­˜å‚¨åº“ä¸­å·¥ä½œå¾—æœ€å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åœ¨å¯åŠ¨ DVC é¡¹ç›®ä¹‹å‰åˆå§‹åŒ–ä¸€ä¸ª:

```
$ mkdir dvc_tutorial
$ cd dvc_tutorial$ python3 -m venv .env
$ source .env/bin/activate
(.env)$ pip3 install dvc
(.env)$ **git init**
(.env)$ **dvc init**
```

æˆ‘ä»¬å‡†å¤‡å¥½å‡ºå‘äº†ã€‚ç°åœ¨è®©æˆ‘ä»¬å®ç°æ¯ä¸€æ­¥ã€‚

# ğŸ“1â€”â€œæ”¶é›†æ•°æ®â€æ­¥éª¤

æˆ‘ä»¬ä½¿ç”¨ Scikit çš„`fetch_20newsgroups()`æ–¹æ³•å°†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½†æ˜¯æˆ‘æƒ³å°†å®ƒä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥å°†å®ƒä½œä¸ºç®¡é“ä¸‹ä¸€æ­¥çš„ä¾èµ–é¡¹ã€‚å› æ­¤ï¼Œåœ¨è¿™ä¸ªè„šæœ¬ä¸­ï¼Œæˆ‘å°†**æ”¶é›†æ•°æ®å¹¶å°†å…¶ä¿å­˜åˆ° csv æ–‡ä»¶**ã€‚

æˆ‘ä»¬å°†æ­¤é˜¶æ®µçš„åç§°è®¾ä¸º**å‡†å¤‡**ã€‚

ä¸€å¼€å§‹æˆ‘ä½¿ç”¨äº†ä¸‰ä¸ªç±»åˆ«(`['comp.graphics', 'sci.space', 'rec.sport.basecball']`)ï¼Œä½†æ˜¯å½“æˆ‘åˆ°äº†è¯„ä¼°é˜¶æ®µï¼Œæˆ‘æƒ³å¦‚æœæˆ‘åªä½¿ç”¨ä¸¤ä¸ªç±»åˆ«ï¼Œè¿™ä¸ªæ•™ç¨‹ä¼šæ›´ç®€å•ã€‚ç„¶åæˆ‘ä¸å¾—ä¸**å†æ¬¡æ„å»ºæ•°æ®é›†**ï¼Œ**ç”¨è¿™äº›ç±»åˆ«æŒ‡å®šæ–°åˆ—è¡¨**ã€‚è¿™å‘æˆ‘å±•ç¤ºäº†ä½¿ç”¨**ç±»åˆ«**ä½œä¸ºè¿™ä¸ªè„šæœ¬çš„å‚æ•°æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚DVC ä½¿ç”¨ä¸€ä¸ª`params.yam`æ–‡ä»¶ä½œä¸ºé»˜è®¤å‚æ•°æ–‡ä»¶ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¹¶åœ¨é‚£é‡Œå®šä¹‰ç±»åˆ«:

```
# file params.yaml**prepare:**
 **categories:**
        - comp.graphics
        - sci.space
```

`prepare`æ˜¯é˜¶æ®µçš„åç§°ï¼Œ`categories`æ˜¯å‚æ•°çš„åç§°ï¼Œä¸ºäº†ä½¿ç”¨`yaml`åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªé¡¹ç›®å‰æ·»åŠ ä¸€ä¸ª`-`ã€‚

æˆ‘æƒ³æŠŠæ•°æ®ä¿å­˜åˆ°ä¸€ä¸ª`data/prepared`æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨è„šæœ¬æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚ä¸‹é¢æ˜¯æœ€ç»ˆçš„`prepare.py`æ–‡ä»¶:

ä¸ºäº†æ‰§è¡Œè¿™ä¸€é˜¶æ®µçš„ç®¡é“ï¼Œæˆ‘ä»¬åªä¾èµ–äº**è„šæœ¬ä»£ç æ–‡ä»¶**ï¼Œæˆ‘ä»¬å°†**å°†è„šæœ¬ç”Ÿæˆçš„æ–‡ä»¶**ä¿å­˜åœ¨`data/prepared`æ–‡ä»¶å¤¹ä¸­ã€‚ç°åœ¨æˆ‘ä»¬æœ‰äº†æ„å»ºè¿™ä¸€æ­¥çš„æ‰€æœ‰ç»„ä»¶:

*   **å†™ä¸€ä¸ª python è„šæœ¬:** `prepare.py`
*   **ä¿å­˜å‚æ•°:`params.yaml`å†…çš„** `categories`
*   æŒ‡å®šè„šæœ¬**ä¾èµ–çš„æ–‡ä»¶:**
*   æŒ‡å®šè„šæœ¬**ç”Ÿæˆçš„æ–‡ä»¶**:**æ–‡ä»¶å¤¹`data/prepared`**

**ä¸ºäº†ä¿æŒæœ‰åºï¼Œæˆ‘ä»¬å°†è„šæœ¬ä¿å­˜åœ¨ä¸€ä¸ª`src`æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª:**

```
(.env)$ mkdir src
(.env)$ cd src **# now save the prepare.py file here**
```

**æ‚¨çš„`dvc_tutorial`æ–‡ä»¶å¤¹çš„å†…å®¹åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:**

```
â”œâ”€â”€ params.yaml
â””â”€â”€ src
    â””â”€â”€ prepare.py
```

**æ‰€æœ‰è®¾ç½®ï¼Œç°åœ¨è®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•ä½¿ç”¨ DVC å»ºç«‹è¿™ä¸ªé˜¶æ®µã€‚**

## **âº dvc è¿è¡Œâ€”â€”ä½¿ç”¨ dvc æ„å»ºé˜¶æ®µ**

**DVC å°†ç®¡é“é˜¶æ®µä¿å­˜åœ¨ä¸€ä¸ª`dvc.yaml`æ–‡ä»¶(äººç±»å¯è¯»)å’Œä¸€ä¸ª`dvc.lock`(è¿™ä»…ç”¨äº DVC)ã€‚æˆ‘ä»¬ä½¿ç”¨`**dvc run**`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæµæ°´çº¿é˜¶æ®µã€‚è¿™äº›æ˜¯ä¸»è¦é€‰é¡¹:**

```
**-n <stage>**: specify a name for the stage generated by this command**-p [<path>:]<params_list>**: specify a set of [parameter dependencies](https://dvc.org/doc/command-reference/params) the stage depends on**-d <path>**: specify a file or a directory the stage depends on**-o <path>**: specify a file or directory that is the result of running the command
```

**è®¾ç½®å®Œè¿™äº›é€‰é¡¹åï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå‘½ä»¤å‚æ•°ï¼ŒæŒ‡å®š**å¦‚ä½•å®é™…è¿è¡Œç®¡é“**çš„è¿™ä¸€æ­¥ã€‚åœ¨è¯¥æ­¥éª¤ä¸­ï¼Œå‘½ä»¤å°†æ˜¯`python3 src/prepare.py`ã€‚è®©æˆ‘ä»¬é¦–å…ˆå®‰è£…`prepare.py`éœ€è¦çš„ä¾èµ–é¡¹:**

```
(.env)$ pip install pyyaml scikit-learn pandas
```

**ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œ`**dvc run**`å‘½ä»¤æ¥ç”Ÿæˆé˜¶æ®µ:**

```
(.env)$ **dvc run -n prepare -p prepare.categories -d src/prepare.py -o data/prepared python3 src/prepare.py***Running stage 'prepare' with command:                                           
        python3 src/prepare.py
Creating 'dvc.yaml'                                                                                                                                
Adding stage 'prepare' in 'dvc.yaml'
Generating lock file 'dvc.lock'**To track the changes with git, run:**git add dvc.yaml data/.gitignore dvc.lock*
```

**ç°åœ¨ä½ çš„æ–‡ä»¶å¤¹æ˜¾ç¤ºå¦‚ä¸‹:**

```
**â”œâ”€â”€ data
â”‚   â””â”€â”€ prepared
â”‚       â”œâ”€â”€ test.csv
â”‚       â””â”€â”€ train.csv**
**â”œâ”€â”€ dvc.lock
â”œâ”€â”€ dvc.yaml**
â”œâ”€â”€ params.yaml
â””â”€â”€ src
    â””â”€â”€ prepare.py
```

**ä»¥ä¸‹æ˜¯ DVC è‡ªåŠ¨ç”Ÿæˆçš„`dvc.yaml`æ–‡ä»¶çš„å†…å®¹:**

```
**stages:**
 **prepare:**
 **cmd:** python3 src/prepare.py
 **deps:**
    - src/prepare.py
 **params:**
    - prepare.categories
 **outs:**
    - data/prepared
```

**å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿ**

## **ğŸ”¬dvc dag ä½¿ç”¨ dvc å¯è§†åŒ–ç®¡é“**

**`**dvc dag**`å‘½ä»¤æ˜¾ç¤ºæµæ°´çº¿çš„é˜¶æ®µã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªé˜¶æ®µï¼Œä½†è®©æˆ‘ä»¬çœ‹çœ‹:**

```
(.env)$ **dvc dag** *+---------+  
| prepare |  
+---------+  
~
~
/tmp/tmpixsrsfo0 (END)*
```

**æ‚¨å¯ä»¥ç‚¹å‡»`**q**`éšè—å¯è§†åŒ–æ•ˆæœã€‚**

## **â¯dvc å†ç°â€”â€”ä½¿ç”¨ DVC å†ç°ç®¡é“**

**`**dvc repro**`å‘½ä»¤é€šè¿‡æ‰§è¡Œåœ¨[é˜¶æ®µ](https://dvc.org/doc/command-reference/run)ä¸­å®šä¹‰çš„å‘½ä»¤æ¥å¤åˆ¶å…¨éƒ¨æˆ–éƒ¨åˆ†[ç®¡é“](https://dvc.org/doc/command-reference/dag)ã€‚æ­£å¦‚åŒ»ç”Ÿæ‰€è¯´:**

> **DVC **é«˜é€Ÿç¼“å­˜æ²¿é€”çš„ç›¸å…³æ•°æ®å·¥ä»¶**å¹¶åœ¨æµæ°´çº¿é˜¶æ®µé€’å½’æœç´¢ä»¥**ç¡®å®šå“ªäº›å·²ç»æ”¹å˜**ã€‚ç„¶åå®ƒæ‰§è¡Œç›¸åº”çš„å‘½ä»¤ã€‚åœ¨æ‰§è¡Œç”Ÿæˆè¾“å‡ºçš„ stages å‘½ä»¤ä¹‹å‰ï¼Œè¾“å‡ºä¼šä»å·¥ä½œåŒºä¸­åˆ é™¤ã€‚â€” [å†ç°æ–‡ä»¶](https://dvc.org/doc/command-reference/repro)**

**é…·ï¼Œé‚£æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹å§(æˆ‘è¿˜æ²¡åšä»€ä¹ˆæ”¹åŠ¨):**

```
(.env)$ **dvc repro***Stage 'prepare' didn't change, skipping                                         
Data and pipelines are up to date.*
```

**å¦‚æœæˆ‘æ›´æ”¹äº†ç±»åˆ«çš„åç§°ä¼šæ€æ ·ï¼Ÿ**

```
# file params.yamlprepare:
    categories:
        - comp.graphics
 **- rec.sport.baseball** # it was 'sci.space'
```

**ç„¶åå†æ¬¡è¿è¡Œè¯¥å‘½ä»¤ï¼Ÿ**

```
(.env)$ **dvc repro***Running stage 'prepare' with command:                                           
        python3 src/prepare.py
Updating lock file 'dvc.lock'**To track the changes with git, run:**git add dvc.lock*
```

****å®ƒå†æ¬¡è¿è¡Œé˜¶æ®µ**ï¼Œå› ä¸ºæˆ‘ä»¬æ·»åŠ äº†`**-p prepare.categories**` ä½œä¸ºè¿™ä¸ªé˜¶æ®µçš„å‚æ•°ã€‚DVC ç„¶åçœ‹åˆ°**æˆ‘ä»¬æ”¹å˜äº†è¿™ä¸ªå‚æ•°**å’Œ**å†æ¬¡è·‘å°**ã€‚`dvc.yaml`æ–‡ä»¶ä»ç„¶æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å¦‚æœä½ æ£€æŸ¥`dvc.lock`æ–‡ä»¶ï¼Œä½ ä¼šçœ‹åˆ°é‚£é‡Œçš„å‚æ•°æ”¹å˜äº†ã€‚å¾ˆç¥å¥‡å§ï¼Ÿ**

**è¿™äº›æ˜¯**åˆ›å»ºã€è¿è¡Œå’Œå¯è§†åŒ–**ç®¡é“é˜¶æ®µçš„åŸºç¡€:**

*   **`**dvc run**`**
*   **`**dvc dag**`**
*   **`**dvc repro**`**

**ç°åœ¨è®©æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€ä¸ªç®¡é“æ­¥éª¤ã€‚**

# **ğŸ“2-â€œç”Ÿæˆè¦ç´ â€æ­¥éª¤**

**æˆ‘ä»¬å°†è¿™ä¸ªé˜¶æ®µçš„åç§°è®¾ç½®ä¸º**ç‰¹å¾**ã€‚**

**åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Scikit çš„`TfidfVectorizer`å¹¶å°†è½¬æ¢åçš„çŸ©é˜µä¿å­˜åˆ°`data/features`æ–‡ä»¶å¤¹ä¸­çš„ pickle æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬å°†ä¾èµ–è„šæœ¬æ–‡ä»¶å’Œ`data/prepared`æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥è¿™æ˜¯æˆ‘ä»¬çš„é…æ–¹:**

*   ****å†™ä¸€ä¸ª python è„šæœ¬:** `featurize.py`**
*   ****ä¿å­˜å‚æ•°:** *ã€æˆ‘ä»¬ä¸éœ€è¦ä»»ä½•ã€‘***
*   **æŒ‡å®šè„šæœ¬**ä¾èµ–çš„æ–‡ä»¶:** `featurize.py`å’Œ`data/prepared`**
*   **æŒ‡å®šè„šæœ¬**ç”Ÿæˆçš„æ–‡ä»¶**:**æ–‡ä»¶å¤¹`data/features`****

****è¿™æ˜¯æœ€ç»ˆçš„`featurize.py`æ–‡ä»¶:****

****ä½ åº”è¯¥æŠŠå®ƒä¿å­˜åœ¨`/src`æ–‡ä»¶å¤¹ä¸­ï¼Œç„¶ååƒè¿™æ ·ç”¨ DVC åˆ›å»ºèˆå°:****

```
**(.env)$ **dvc run** -n featurize -d src/featurize.py -d data/prepared -o data/features python3 src/featurize.py data/prepared data/features**
```

****ç»§ç»­è¿è¡Œ`**dvc dag**`å‘½ä»¤æ¥æ£€æŸ¥ç®¡é“çš„æ–°æ­¥éª¤ã€‚****

# ****ğŸ“3 â€”â€œè®­ç»ƒæ¨¡å‹â€æ­¥éª¤****

****åœ¨è¿™ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å°†æœ€ç»ˆè®­ç»ƒæ¨¡å‹å¹¶å°†å…¶ä¿å­˜åˆ° pickle æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ï¼Œå¹¶ä¸”åªè®¾ç½® alpha å‚æ•°ã€‚è¿™æ˜¯é£Ÿè°±:****

*   ******å†™ä¸€ä¸ª python è„šæœ¬:** `train.py`****
*   ******ä¿å­˜å‚æ•°:`params.yaml`å†…çš„** `alpha`****
*   ****æŒ‡å®šè„šæœ¬**ä¾èµ–çš„æ–‡ä»¶:** `train.py`å’Œ`data/features`****
*   ****æŒ‡å®šè„šæœ¬**ç”Ÿæˆçš„æ–‡ä»¶**:**æ–‡ä»¶`model.pkl`******

****é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ·»åŠ æ–°çš„`alpha`å‚æ•°:****

```
**# file params.yamlprepare:
    categories:
        - comp.graphics
        - sci.space
**train:
    alpha: 0.1****
```

****ç„¶åå°†`train.py`è„šæœ¬ä¿å­˜åœ¨`/src`ä¸­:****

****æœ€åï¼Œç”¨ DVC åˆ›é€ èˆå°:****

```
**(.env)$ **dvc run** -n train -p train.alpha -d src/train.py -d data/features -o model.pkl python3 src/train.py data/features model.pkl**
```

# ****ğŸ“4 â€”â€œè¯„ä¼°æ¨¡å‹â€æ­¥éª¤****

****åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£ä¸¤ä¸ªæ–°çš„`**dvc run**`å‚æ•°:`--metrics`å’Œ`--plots`:****

```
****-m <path>****:** specify a metrics file produced by this stage. This option behaves like -o but registers the file in a metrics field inside the dvc.yaml stage**--plots <path>:** specify a plot metrics file produces by this stage. This option behaves like -o but registers the file in a plots field inside the dvc.yaml stage**
```

****æˆ‘ä»¬å°†ä½¿ç”¨æ›²çº¿ä¸‹çš„**é¢ç§¯(AUC)** åº¦é‡ï¼Œå¹¶è®¡ç®—ä¸åŒæ¦‚ç‡é˜ˆå€¼çš„**ç²¾ç¡®å¬å›å¯¹**æ¥ç»˜åˆ¶å›¾å½¢ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè„šæœ¬æ¥ä¿å­˜å¸¦æœ‰ AUC åˆ†æ•°çš„`scores.json`æ–‡ä»¶å’Œå¸¦æœ‰ç²¾åº¦/å¬å›/é˜ˆå€¼å¯¹çš„`plots.json`æ–‡ä»¶:****

****ç»§ç»­å°†è¿™ä¸ª`evaluate.py`è„šæœ¬ä¿å­˜åœ¨`/src`æ–‡ä»¶å¤¹ä¸­ã€‚****

****å…³äºåº¦é‡å’Œç»˜å›¾æ–‡ä»¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé€‰é¡¹:****

*   ******è®© DVC è·Ÿè¸ªåº¦é‡/å›¾è¡¨**æ–‡ä»¶æˆ–****
*   ******ä½¿ç”¨ Git** è·Ÿè¸ªæŒ‡æ ‡/å›¾è¡¨æ–‡ä»¶****

****ç”±äºåœ¨æœ¬æ•™ç¨‹ä¸­æˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ DVC æ¥è·Ÿè¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç¬¬äºŒä¸ªé€‰é¡¹ï¼Œå¹¶ä½¿ç”¨ Git æ¥è·Ÿè¸ªæ–‡ä»¶ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`--metrics-no-cache`å’Œ`--plots-no-cache`å‘½ä»¤ã€‚è¿™æ˜¯è¿™ä¸ªé˜¶æ®µçš„ç§˜è¯€:****

*   ******å†™ä¸€ä¸ª python è„šæœ¬:******
*   ******ä¿å­˜å‚æ•°:** *(æˆ‘ä»¬ä¸éœ€è¦ä»»ä½•)*****
*   ****æŒ‡å®š**è„šæœ¬ä¾èµ–çš„æ–‡ä»¶:** `evaluate.py`ã€`model.pkl`å’Œ`data/features`****
*   ****æŒ‡å®šè„šæœ¬**ç”Ÿæˆçš„æ–‡ä»¶:** *(æ— )*****
*   ******(æ–°)**æŒ‡å®šåº¦é‡å’Œç»˜å›¾æ–‡ä»¶:`scores.json`å’Œ`plots.json`****

****å¥½äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºæœ€åä¸€æ­¥:****

```
**(.env)$ **dvc run** -n evaluate -d src/evaluate.py -d model.pkl -d data/features **--metrics-no-cache** scores.json **--plots-no-cache** plots.json python3 src/evaluate.py model.pkl data/features scores.json plots.json**
```

## ****ğŸ‹ğŸ¿dvc æŒ‡æ ‡â€”ä½¿ç”¨ DVC æ¯”è¾ƒæŒ‡æ ‡****

****`**dvc metrics**`å‘½ä»¤è®©æˆ‘ä»¬æ˜¾ç¤ºå’Œæ¯”è¾ƒæŒ‡æ ‡ã€‚`**dvc metrics show**`æ‰“å°åº¦é‡å€¼ï¼Œè€Œ`**dvc metrics diff**`æ˜¾ç¤ºåº¦é‡æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶åº¦é‡å€¼ä¹‹é—´çš„å·®å¼‚(åœ¨ç”¨ Git æäº¤ä¹‹å‰)ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®é™…æƒ…å†µã€‚****

****`**dvc metrics show**`å…è®¸æˆ‘ä»¬æŸ¥çœ‹å½“å‰å¾—åˆ†:****

```
**(.env)$ **dvc metrics show**scores.json:                                                            
        auc: 0.9993366236676577**
```

****(â˜•ï¸å—¯ï¼Œé‚£è‚¡è¿‡åº¦æ‹Ÿåˆçš„å‘³é“â€¦â€¦ä½†é‚£ä¸æ˜¯ä»Šå¤©çš„é‡ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­ğŸ˜œ)****

****è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æˆ‘ä»¬ç›®å‰ä½¿ç”¨çš„å‚æ•°:****

```
**# file params.yamlprepare:
    categories:
        - comp.graphics
        - rec.sport.baseball
train:
    alpha: 0.1**
```

****`**dvc metrics diff**`å‘½ä»¤æ˜¯åœ¨å‰ä¸€æ¬¡æäº¤å’Œå½“å‰çŠ¶æ€ä¹‹é—´è®¡ç®—çš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬é¦–å…ˆæäº¤è¿™ä¸ªå®éªŒ:****

```
**(.env)$ git add src/ params.yaml dvc.yaml dvc.lock scores.json plots.json
(.env)$ git commit -m "exp: alpha=0.1"**
```

****ç°åœ¨ï¼Œè®©æˆ‘ä»¬é¦–å…ˆæ›´æ”¹ alpha å‚æ•°:****

```
**# file params.yamlprepare:
    categories:
        - comp.graphics
        - rec.sport.baseball
train:
    **alpha: 0.9****
```

****ç„¶åå†æ¬¡è¿è¡Œæ‰€æœ‰æ“ä½œ:****

```
**(.env)$ **dvc repro***Stage 'prepare' didn't change, skipping                                         
Stage 'featurize' didn't change, skipping
Restored stage 'train' from run-cache
Skipping run, checking out outputs
Updating lock file 'dvc.lock'**Restored stage 'evaluate' from run-cache
Skipping run, checking out outputs
Updating lock file 'dvc.lock'**To track the changes with git, run:**git add dvc.lock***
```

****æˆ‘ä»¬å¯ä»¥é€šè¿‡`**dvc params diff**`çœ‹åˆ°å‚æ•°å·®å¼‚:****

```
**(.env)$ **dvc params diff***Path         Param        Old    New                                            
params.yaml  train.alpha  0.1    0.9***
```

****æœ€åï¼Œçœ‹çœ‹åˆ†æ•°å¦‚ä½•éš`**dvc metrics diff**`å˜åŒ–:****

```
**(.env)$ **dvc metrics diff***Path         Metric    Value    Change                                          
scores.json  auc       0.99869  -0.00064***
```

## ****ğŸ“Šdvc å›¾â€”ä½¿ç”¨ DVC å¯è§†åŒ–å¹¶æ¯”è¾ƒ*æŒ‡æ ‡*****

****`**dvc plots**`å‘½ä»¤å°†å›¾å½¢ç”Ÿæˆä¸º HTML æ–‡ä»¶ï¼Œå¯é€šè¿‡ç½‘ç»œæµè§ˆå™¨æ‰“å¼€ã€‚è¿™äº› HTML æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ [Vega-Lite](https://vega.github.io/vega-lite/) ã€‚è®©æˆ‘ä»¬ç”»ä¸€æ¡ç²¾ç¡®å›å¿†æ›²çº¿ã€‚`plots.json`æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤º:****

```
**# file plots.json{
  "proc": [
    {
      "precision": 0.927570093457944,
      "recall": 1.0,
      "threshold": 0.4513363759032511
    },
    {
      "precision": 0.927400468384075,
      "recall": 0.9974811083123426,
      "threshold": 0.45201756623495926
    },
    # [...]
  ]
}**
```

****æˆ‘ä»¬æƒ³è¦ä¸€ä¸ªåœ¨ y è½´ä¸Šæœ‰ç²¾åº¦ï¼Œåœ¨ y è½´ä¸Šæœ‰å›å¿†çš„å›¾ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ª:****

```
**(.env)$ **dvc plots show** -y precision -x recall plots.json**
```

****![](img/7f0dc3645de9f6ce90d30a17173dc67c.png)****

****ç²¾ç¡®å›å¿†æ›²çº¿****

****æˆ‘ä»¬ç”šè‡³å¯ä»¥ç”»å‡º alpha=0.1 å’Œ alpha=0.9 çš„ç²¾åº¦åˆ†æ•°ä¹‹é—´çš„å·®å¼‚****

```
**(.env)$ **dvc plots diff** --targets plots.json -y precision**
```

****![](img/439ddf58096b1020a2a3bb3cc9db66a7.png)****

****ä¸åŒçš„ alpha å€¼æœ‰ä¸åŒçš„ç²¾åº¦åˆ†æ•°****

****æˆ‘ä»¬çš„æ—…è¡Œåˆ°æ­¤ç»“æŸã€‚ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æ›´å¤šå‰§æƒ…é€‰é¡¹å’Œé…ç½®:ã€https://dvc.org/doc/command-reference/plots[ã€‚](https://dvc.org/doc/command-reference/plots)****

****æœ¬æ•™ç¨‹çš„æœ€ç»ˆä»£ç æ˜¯[è¿™é‡Œ](https://github.com/dmesquita/dvc_pipelines_and_experiments_tutorial)****

# ****ç»“æŸè¯­****

****ä½¿ç”¨ DVC è·Ÿè¸ªå®éªŒå’Œç®¡ç†æœºå™¨å­¦ä¹ ç®¡é“çœŸçš„å¯ä»¥è®©æˆ‘ä»¬çš„é¡¹ç›®æ›´ä¸Šä¸€å±‚æ¥¼ã€‚è®©ä½ çš„ ML é¡¹ç›®å¯å¤åˆ¶çš„å…³é”®æ˜¯**ä¸ºæ¯ä¸ªæ­¥éª¤å’Œ**åˆ›å»ºå•ä¸ª Python è„šæœ¬**æŒ‡å®šæ¯ä¸ªè„šæœ¬ä½¿ç”¨çš„å‚æ•°ã€è¾“å…¥**å’Œè¾“å‡º**ã€‚æ‚¨å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„`**dvc run**`å‘½ä»¤æ¥å®ç°ï¼Œå¹¶ä½¿ç”¨`**dvc repro**`æ¥è¿è¡Œæ‚¨å–œæ¬¢çš„ç®¡é“ã€‚******

****é™¤äº†å®éªŒå’Œç®¡é“ç®¡ç†ï¼ŒDVC è¿˜æä¾›**ç‰ˆæœ¬æ§åˆ¶å’Œ**éƒ¨ç½²å’Œåä½œåŠŸèƒ½ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œå’Œ[è¿™é‡Œ](https://dvc.org/doc/use-cases/sharing-data-and-model-files)äº†è§£æ›´å¤šã€‚****

****ä»Šå¤©å°±åˆ°è¿™é‡Œï¼Œæ„Ÿè°¢é˜…è¯»ï¼ğŸ˜****