<html>
<head>
<title>Peek to Peak : Time Series Forecasting to predict demand for meal kits</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从峰值到峰值:时间序列预测，以预测餐包的需求</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/peek-to-peak-time-series-forecasting-to-predict-demand-for-meal-kits-53c055e77bfd?source=collection_archive---------29-----------------------#2020-05-10">https://towardsdatascience.com/peek-to-peak-time-series-forecasting-to-predict-demand-for-meal-kits-53c055e77bfd?source=collection_archive---------29-----------------------#2020-05-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq jr js"><p id="e3dc" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">这个项目是由Aditi Khandelwal，Amrita Dutta，Aneesh Goel和Simran Kalera完成的，他们参加了哥伦比亚大学的MS商业分析项目。</p></blockquote><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ks"><img src="../Images/746e547e64226d9f551bd6b7d34a15e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:430/format:webp/1*F8wIx2IT78Z2jeQslPmnVw.jpeg"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">窥视过去(来源:<a class="ae le" href="https://clipartart.com/images/peeking-clipart-2.jpg" rel="noopener ugc nofollow" target="_blank">剪贴画</a>)</p></figure><p id="746b" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">解决了“晚饭吃什么”这个长期存在的问题套餐配送服务为消费者提供了一种在家做饭的便捷方式，而不必进行膳食计划和食品杂货店购物。<a class="ae le" href="https://www.packagedfacts.com/Meal-Kit-Delivery-10037319/" rel="noopener ugc nofollow" target="_blank">餐包递送是一个15亿美元的市场，并且还在增长</a>。据报道，每四个美国人中就有一个订购了套餐。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi li"><img src="../Images/ceed96ca4f55ce330a814d1ca9bbb852.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*7GAmIUtZbdaz6tjQ4EAYMw.jpeg"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">让你的利润达到顶峰(来源:<a class="ae le" href="https://www.iconfinder.com/icons/3814596/bar_chart_data_data_science_graph_information_positive_icon" rel="noopener ugc nofollow" target="_blank"> Iconfinder </a></p></figure><p id="2cfc" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">我们的目标是通过使用机器学习的历史数据来预测每周需求。我们的目标是开发一个模型，帮助减少套餐服务的“损失”。这是通过量化货币损失实现的，每周可节省数千美元。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lj"><img src="../Images/13033f5d8269e5b945a2843b237cc43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BxUOcjpS2DLXnVnM.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">数据字典</p></figure><p id="90c3" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">首先，我们有一个流行的餐包服务的3个数据集:</p><ol class=""><li id="d86a" class="lo lp it jw b jx jy kb kc lf lq lg lr lh ls kr lt lu lv lw bi translated">每周需求数据表示从第1周到第145周的每周订单</li><li id="9d6a" class="lo lp it jw b jx lx kb ly lf lz lg ma lh mb kr lt lu lv lw bi translated">履行中心包含关于每个center_id的数据</li><li id="08f5" class="lo lp it jw b jx lx kb ly lf lz lg ma lh mb kr lt lu lv lw bi translated">膳食数据包括订购膳食的类型和类别</li></ol><p id="bbd1" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">第一步包括合并三个数据集并寻找缺失值。在时间序列中，丢失的数据可能被隐藏，因为数据可能在时间步长(1周)上不一致，并可能在构建模型时导致问题。数据被分组为每个膳食id-中心id组合。其中一些组合不是每周都订购/提供，而是通过将这些周的需求视为0，并将价格视为该组合的平均价格来估算。我们的假设是，这顿饭是在失踪的几周内提供的，但是没有人买。</p><p id="f6cc" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">在研究了餐包市场后，人们意识到大部分成本来自易腐商品。对于一个企业来说，站在本周的立场上了解下周的需求是非常理想的。这将帮助他们订购/安排新的库存，并为下周的订单管理物流。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="mc md l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">来源:<a class="ae le" href="https://media.giphy.com/media/ggzTLwA6f45DMxyUfe/giphy.gif" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><h1 id="02f2" class="me mf it bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">特征工程</h1><p id="054a" class="pw-post-body-paragraph jt ju it jw b jx nc jz ka kb nd kd ke lf ne kh ki lg nf kl km lh ng kp kq kr im bi translated">在执行基本的探索性数据分析后，价格和需求列被转换成对数标度，以得到正态分布。该数据有许多分类列，因此设计了捕捉这些变量的每周平均需求的特性。下面显示一个:<strong class="jw iu"> Avg_orders_cat_week </strong>。</p><p id="9db6" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">制定了反映不同类别每周价格波动的比率。例如，比率<strong class="jw iu">价格/avg_price_week_category </strong>指示第1周的膳食1062的价格比同一周所有饮料的平均价格低<strong class="jw iu"> 0.977 </strong>。这里的想法是，价格低的饭菜可能有高需求。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nh"><img src="../Images/5dbe2c8ce95028812a0254dd24175340.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-kS39qftRnaWuor1"/></div></div></figure><p id="09a6" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">我们提出的第二种特征是超前和滞后特征，它们是时间序列预测的核心。</p><p id="16cc" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">一个显而易见的问题是，我们的数据滞后了多少时间步？</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/7c555e570560441555d0b2dff85cdb43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/0*zfZiZxIgwPYUbkry"/></div></figure><p id="ace5" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">需求的自相关图显示滞后的最佳数量是2(如果值在圆锥之外，则相关性在统计上是显著的，否则可能是偶然的)</p><p id="4f6a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">在选择了最佳滞后之后，我们创建了超前-滞后特征并为建模设置了数据。下图中的每一行都是进入模型的内容。假设我们处于第4周，我们希望预测第5周的需求，即标签(<strong class="jw iu"> lead </strong>)。我们使用了第4周的几个特性，第3周的几个特性和第5周的一些特性(餐费、提供的折扣等，假设它会在一周前固定下来)。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nj"><img src="../Images/2dee253814c22be3555068710f45d0a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-zd5FrrLzHZbCcLL.png"/></div></div></figure><p id="ba07" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">一些特点是:</p><ol class=""><li id="399c" class="lo lp it jw b jx jy kb kc lf lq lg lr lh ls kr lt lu lv lw bi translated">第4周的需求(<strong class="jw iu">需求</strong>)</li><li id="819e" class="lo lp it jw b jx lx kb ly lf lz lg ma lh mb kr lt lu lv lw bi translated">第3周的需求(<strong class="jw iu"> demand_lag1 </strong>)</li><li id="07b2" class="lo lp it jw b jx lx kb ly lf lz lg ma lh mb kr lt lu lv lw bi translated">前几周的平均需求(<strong class="jw iu">扩大_平均</strong></li><li id="55f8" class="lo lp it jw b jx lx kb ly lf lz lg ma lh mb kr lt lu lv lw bi translated">第4周和第3周订单的加权平均值(<strong class="jw iu"> weighted_average_2w </strong></li><li id="c85f" class="lo lp it jw b jx lx kb ly lf lz lg ma lh mb kr lt lu lv lw bi translated">第4周、第3周和第2周订单的加权平均值(<strong class="jw iu"> weighted_average_3w </strong></li><li id="219f" class="lo lp it jw b jx lx kb ly lf lz lg ma lh mb kr lt lu lv lw bi translated">第4周提供的折扣(<strong class="jw iu"> perc_diff </strong>)</li><li id="02a2" class="lo lp it jw b jx lx kb ly lf lz lg ma lh mb kr lt lu lv lw bi translated">第5周提供的折扣(<strong class="jw iu"> perc_diff_lead1 </strong>)。</li></ol><p id="ed74" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">数据被分成训练集、验证集和测试集。在去除空值之后，训练数据是从第3周到第142周；第144周验证，第145周测试。下面的代码片段显示了不同型号的性能。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lj"><img src="../Images/c28ea596772ee9a459033d1282bf58da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uFxYUc7UmjyPphAx.png"/></div></div></figure><p id="f603" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">随机森林是选择的模型，它给出了均方误差和R平方的可比结果，并且可以进一步调整。</p><p id="37a3" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">调整最大深度参数后，我们在整个训练集和验证集上重新训练模型，并在测试集上获得以下结果:</p><ol class=""><li id="e67a" class="lo lp it jw b jx jy kb kc lf lq lg lr lh ls kr lt lu lv lw bi translated">均方差:<strong class="jw iu"> 0.31 </strong></li><li id="ac4b" class="lo lp it jw b jx lx kb ly lf lz lg ma lh mb kr lt lu lv lw bi translated">r平方:<strong class="jw iu"> 0.89 </strong></li></ol><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nk"><img src="../Images/4fff24fdd4635e1b79f9e2c894b19a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NE6MeTrMQ-JSBa0R"/></div></div></figure><p id="7dad" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">特征重要性图显示滞后特征是下周需求的最重要预测因素，这是直观的。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="nl md l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">来源:<a class="ae le" href="https://media.giphy.com/media/9HQRIttS5C4Za/giphy.gif" rel="noopener ugc nofollow" target="_blank"> giphy </a></p></figure><h1 id="68f9" class="me mf it bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">言归正传！</h1><p id="5de6" class="pw-post-body-paragraph jt ju it jw b jx nc jz ka kb nd kd ke lf ne kh ki lg nf kl km lh ng kp kq kr im bi translated">该行业亏损的主要原因是易腐食品的保质期有限。如果需求预测不准确，可能会导致订单预测过高或过低。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lj"><img src="../Images/aaf1709581306327cccbb30f8cbe3d1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*B8_M-1pkfZIoLfJX.png"/></div></div></figure><p id="bde6" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">假设我们的随机森林回归器预测了5个订单，而观察到的实际销售额是6，我们对需求的预测值低了1，因此错过了一个订单，我们称之为“订单损失”。同样，如果我们的模型预测5个订单，实际销售额是4，这是一个过度预测的情况，会导致我们所说的“库存损失”,并会因变质易腐品而出现。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nm"><img src="../Images/e390ad99c733081c0a14c4127f7def80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IqVuUgC4u8kqjXlbAklReQ.jpeg"/></div></div></figure><p id="ac7a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated"><a class="ae le" href="https://www.hellofreshgroup.com/download/companies/hellofresh/Quarterly%20Reports/DE000A161408-Q1-2020-EQ-E-00.pdf" rel="noopener ugc nofollow" target="_blank">我们做了几个假设</a>看看左边展示的这个商业模式。参考该图，<br/> <strong class="jw iu">库存损失</strong>将是我们超额预测的情况下，由于<strong class="jw iu">库存成本</strong>而导致的损失。另一方面，<strong class="jw iu">订单损失</strong>是由于<strong class="jw iu">低于预测</strong>而导致的损失，我们无法满足需求，因此损失了利润。</p><p id="4fd2" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated"><strong class="jw iu"> <em class="jv">如果一个公司没有预测模型会怎样？</em> </strong></p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lj"><img src="../Images/53007127800172b704fb85e507d123fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YD9909bnU3P0MWO-.png"/></div></div></figure><p id="9a70" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated"><em class="jv">基线比较:</em>如果一家公司根本没有任何预测模型，那么我们假设他们会取第1周到第144周订单的平均值，并预测下一周的订单。<br/>如果基准模型预测需求为4，而实际需求为7，我们将会得到-3的基准损失，这是我们利润的3倍。如果我们的集合模型预测需求为8，那么这将导致1倍的库存损失。然后，通过对所有膳食id和中心id的损失进行累积求和，计算总基线损失和预测损失。</p><h1 id="f711" class="me mf it bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">我们的模型真的有助于预测需求并节省一些钱吗？</h1><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="nn md l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">资料来源:<a class="ae le" href="https://media.giphy.com/media/qzeCF4ymrgFXy/giphy.gif" rel="noopener ugc nofollow" target="_blank">吉菲</a></p></figure><p id="6983" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">基线损失:</p><p id="bccf" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated"><strong class="jw iu">386，015美元</strong></p><p id="2cf4" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">集合模型损失:</p><p id="6ea1" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">279，384美元</p><h1 id="e8b4" class="me mf it bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">该分析为公司节省了每周106，631美元！</h1><h1 id="00ec" class="me mf it bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">额外的用例:测量价格变化的需求弹性。</h1><p id="d6e6" class="pw-post-body-paragraph jt ju it jw b jx nc jz ka kb nd kd ke lf ne kh ki lg nf kl km lh ng kp kq kr im bi translated">现在我们已经达到了尽量减少损失的目标，我们探索的另一个用例是:</p><p id="b770" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">如果成本增加25%,我们的模型能预测需求的变化吗？</p><p id="6ea7" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">在一个理想的世界里，我们想要一个模型，它给出一个完美的预测，不会给我们带来损失，但是这样一个理想的场景是不存在的。考虑到我们的模型的预测是准确的，我们运行我们的预训练模型，结帐价格增加了25%。这使得需求每周减少46，000个订单，这很直观，因为这些客户可能都是对价格敏感的客户。</p><p id="aa7f" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">同样，如果我们推出50%的黑色星期五促销，我们预计每周需求将增加40，524个订单。</p><p id="35b4" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">似乎我们的模型比我们想象的有更多定量和定性的答案。</p><p id="19d1" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">我们研究了餐包市场；应用机器学习为公司带来利润，并展示了这种模式如何为这一独特的行业带来利润。</p><blockquote class="jq jr js"><p id="edb6" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">你可以在我们的GitHub Repo上访问我们的代码:【https://github.com/aditi310896/Demand-Forecasting T4】</p></blockquote><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi no"><img src="../Images/c25901e1726a616568c7f3cb6097049e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7bynpSn8hx9hysf4cLmwsw.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">来源:<a class="ae le" href="https://www.zdnet.com/article/how-hellofresh-harnesses-big-data-to-cook-up-millions-of-custom-meals/" rel="noopener ugc nofollow" target="_blank"> hellofresh </a></p></figure></div></div>    
</body>
</html>