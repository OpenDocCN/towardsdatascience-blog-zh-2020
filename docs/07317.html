<html>
<head>
<title>Ditch the Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">丢弃数据库</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/ditch-the-database-20a5a0a1fb72?source=collection_archive---------13-----------------------#2020-06-03">https://towardsdatascience.com/ditch-the-database-20a5a0a1fb72?source=collection_archive---------13-----------------------#2020-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0e85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何使用自动气象站S3选择查询更智能，也许更便宜</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/586e9dc83e0362be44893c0994f5975d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iwSfk8QQwE3umx1n"/></div></div><p class="kx ky gj gh gi kz la bd b be z dk translated">马库斯·斯皮斯克在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="8686" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lc">亚马逊S3精选是亚马逊S3的一项功能，于2018年4月正式上市。通过使用亚马逊S3精选，可以在没有“经典”数据库的情况下运行应用程序，从而简化应用程序架构。</em></p><p id="2595" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">任何处理数据的人都可能在其数据管道的某个点上使用过基于云的存储解决方案。就个人而言，亚马逊S3是我的首选，因为它使用相对简单，易于扩展，与其他AWS服务相结合，并且存储几乎任何文件类型的对象。</p><p id="6aac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然亚马逊S3在存储数据集方面很棒，但像其他传统的基于云的对象存储解决方案一样，它不允许检索数据集的子集(即必须检索整个数据集)。例如，如果您需要100万行数据集中的前1000行，您必须检索整个数据集并进行本地过滤。这使得使用亚马逊S3作为应用程序的唯一数据库变得不切实际，特别是那些经常需要检索更大数据集的子集的应用程序(例如检索客户记录的web应用程序)。</p><p id="188d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输入亚马逊S3精选🙌</p><h1 id="e649" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">概述—亚马逊S3精选</h1><p id="e859" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">亚马逊S3选择允许您使用简单的SQL表达式从亚马逊S3对象中提取您需要的数据。这是巨大的！！！</p><p id="8da8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用S3选择，您不再需要为了保留几行而检索整个数据集。相反，您可以使用经典的SQL表达式就地查询数据，并只检索一个子集，例如两个日期之间或高于某个价格的数据。目前，亚马逊S3精选支持CSV、JSON和Apache Parquet格式的对象。</p><blockquote class="mg mh mi"><p id="0149" class="jn jo lc jp b jq jr js jt ju jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj kk ij bi translated">通过减少您的应用程序必须加载和处理的数据量，S3精选可以将大多数频繁从S3访问数据的应用程序的性能提高<strong class="jp ir">多达400% </strong>。—亚马逊网络服务</p></blockquote><h1 id="36d1" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">使用亚马逊S3精选进行简化</h1><p id="f039" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">亚马逊S3精选最好的部分是它如何简化应用程序结构。在亚马逊S3精选之前，web应用程序的典型结构可能如下所示。</p><ul class=""><li id="e088" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated"><em class="lc">将数据存储在经典SQL(即MySQL或PostgreSQL)或NoSQL(即DynamoDB)数据库中，以便进行查询。</em></li><li id="0dc3" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated"><em class="lc">在持久对象存储器(即亚马逊S3)中保存数据的备份副本</em></li><li id="14a2" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated"><em class="lc">将新数据转移到亚马逊S3，然后添加到数据库。</em></li></ul><p id="d568" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用亚马逊S3选择web应用程序的结构如下所示。</p><ul class=""><li id="3ac1" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated"><em class="lc">将数据存储在亚马逊S3，以便查询。</em></li></ul><p id="54f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">好多了！现在你可以只使用亚马逊S3来构建一个端到端的应用程序。它速度快，价格便宜，界面简单！👍</strong></p><h1 id="0e12" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">示例—亚马逊S3精选</h1><p id="fe06" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">最近<a class="ae lb" rel="noopener" target="_blank" href="/building-a-dynamic-weather-download-app-1ce64a6c3e61">我构建并部署了一个web应用程序</a>，让下载和可视化加拿大历史天气数据变得更加容易和快捷。这是我构建的第一个web应用程序，其中我没有使用经典数据库，而是直接从亚马逊S3存储和查询静态和动态数据。使用亚马逊S3选择，我能够快速方便地从我的动态仪表板中获取用户输入，将它们传递到选择表达式中，并只查询和检索请求的数据。</p><p id="9137" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一些示例数据和一个在亚马逊S3查询CSV并返回可以读入熊猫数据帧的CSV格式的函数。CSV的亚马逊S3 SQL语法可能有点复杂。您可以使用列名或列索引进行查询，根据您选择的列名或列索引，SQL表达式会有所不同。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi na"><img src="../Images/2c9b5e4456fd910d036b01ab32df26ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*8UlDvpMo-E7hleDkTfsRBA.png"/></div><p class="kx ky gj gh gi kz la bd b be z dk translated">示例“test.csv”</p></figure><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kx ky gj gh gi kz la bd b be z dk translated">用于在亚马逊S3查询CSV并将数据解包为CSV格式的函数</p></figure><h2 id="17ad" class="nd le iq bd lf ne nf dn lj ng nh dp ln jy ni nj lr kc nk nl lv kg nm nn lz no bi translated">如何按列名查询？</h2><p id="a0dc" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">让我们使用列名在两个日期之间查询上面的数据集，并只返回日期、风速和风向的相应列。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kx ky gj gh gi kz la bd b be z dk translated">使用列名在亚马逊S3查询CSV</p></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi np"><img src="../Images/81eca03ea9e8dce9a4d5750c8313dfd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*k4AuXMAuitFm6qruIXcTiA.png"/></div><p class="kx ky gj gh gi kz la bd b be z dk translated">查询结果</p></figure><h2 id="ac3c" class="nd le iq bd lf ne nf dn lj ng nh dp ln jy ni nj lr kc nk nl lv kg nm nn lz no bi translated"><strong class="ak">如何按列索引查询？</strong></h2><p id="024b" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">让我们使用列索引查询上面的数据集，当温度高于20摄氏度时，只返回日期和温度的对应列。</p><p id="77b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，在S3选择中，索引从1开始(即<em class="lc"> s._1 </em>),而Python的索引是0。通过使用“cast”命令将一种数据类型转换为另一种数据类型，确保您正在比较SQL表达式中的常见数据类型。如果我的温度数据是字符串格式，我将需要<em class="lc">" cast(s . 4 as float)&gt;20 "</em>。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kx ky gj gh gi kz la bd b be z dk translated">使用列索引在亚马逊S3查询CSV</p></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/8018339b3242d0e82a89f440079e2af8.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*V6rzFWfyeE5wRDc2WlEzoQ.png"/></div><p class="kx ky gj gh gi kz la bd b be z dk translated">查询结果</p></figure><h2 id="f19e" class="nd le iq bd lf ne nf dn lj ng nh dp ln jy ni nj lr kc nk nl lv kg nm nn lz no bi translated">如何查询表头名称？</h2><p id="b483" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">让我们只查询上面数据集中的标题名称，这样我们就可以使用它们来追加到其他查询结果中，或者作为动态仪表板下拉列表的输入。在这种情况下，我将<em class="lc"> use_header </em>设置为<em class="lc"> False </em>，以便在第一行返回列名，并且<em class="lc"> </em>使用S3选择限制特性将返回的行数限制为1。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kx ky gj gh gi kz la bd b be z dk translated">在亚马逊S3查询列标题CSV</p></figure><pre class="km kn ko kp gt nr ns nt nu aw nv bi"><span id="81cf" class="nd le iq ns b gy nw nx l ny nz">#  query result<br/>['Date/Time', 'Longitude', 'Latitude', 'Temperature', 'Wind Speed', 'Wind Direction']</span></pre><h1 id="3fde" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">亚马逊S3精选的成本</h1><p id="6ed5" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">亚马逊S3精选很便宜！以下是我的应用程序的启动成本明细(截至2020年6月)。</p><ul class=""><li id="20a6" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">亚马逊S3对象存储—每GB 0.023美元(前50tb/月)</li><li id="c7b4" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">亚马逊S3选择——每1000条选择命令0.0004美元</li><li id="2e3a" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">亚马逊S3数据传输—每GB 0.01美元(S3 →美国东部地区)</li></ul><p id="7729" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在S3存储了大约37 GB的数据，每月执行近100，000条SELECT命令，每月从S3传输大约50 GB的数据。这使我每月的估计费用达到…1.39美元！</p><h1 id="81fb" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">结论</h1><p id="d392" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">虽然亚马逊S3精选已经推出两年多了(在代码年，这是一个千年😆)这是一个简化应用程序的好工具，尤其是微服务框架。</p><p id="e2a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查询愉快！</p></div></div>    
</body>
</html>