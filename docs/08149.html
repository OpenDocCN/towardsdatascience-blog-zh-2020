<html>
<head>
<title>5 Steps in Pandas to Process Petrophysical Well Logs (part2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pandas 处理岩石物理测井的 5 个步骤(下)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-steps-in-pandas-to-process-petrophysical-well-logs-de6c8d03d9b1?source=collection_archive---------58-----------------------#2020-06-15">https://towardsdatascience.com/5-steps-in-pandas-to-process-petrophysical-well-logs-de6c8d03d9b1?source=collection_archive---------58-----------------------#2020-06-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="91dc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我使用这些更高级的步骤来处理 python 中的测井数据</h2></div><p id="b128" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在之前的<a class="ae le" rel="noopener" target="_blank" href="/10-steps-in-pandas-to-process-las-file-and-plot-610732093338">工作</a>中，我们使用 pandas 实现了 10 个简单的步骤来处理 LAS 格式的岩石物理测井记录。在这个项目中，我们将更深入地使用更先进的方法来处理测井数据。</p><p id="5d64" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这 5 个步骤是:<br/> 1)函数定义<br/> 2)应用函数<br/>3)λ函数<br/> 4)切割函数<br/> 5)可视化</p><p id="9598" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了避免我们之前已经在特定油井数据上做的额外工作，我们将使用该项目的输出。如果你以前做过一个项目，你可以将数据帧写入 csv 文件(使用<em class="lf"> to_csv </em>命令)在这里使用。否则，您可以通过<a class="ae le" href="https://github.com/mardani72/LAS_Pandas" rel="noopener ugc nofollow" target="_blank">我的 github 账号</a>访问并下载名为 1050383876v2.csv 的 csv 格式，您也可以从我的账号<a class="ae le" href="https://github.com/mardani72/LAS_Pandas/blob/master/5stepsV2.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>下载完整的 Jupiter 笔记本文件。</p><p id="52f4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们首先在工作簿上添加所需的库:</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="e8e6" class="lp lq it ll b gy lr ls l lt lu">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>%matplotlib inline</span></pre><p id="feb6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，将 csv 数据读入 df 变量:</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="ef32" class="lp lq it ll b gy lr ls l lt lu">df = pd.read_csv('1050383876v2.csv')<br/>df.head()</span></pre><figure class="lg lh li lj gt lw gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/8a5f358119125b5efce2cf71ee436078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*jWSHLhphunNe0tMBar5lRw.png"/></div></figure><p id="0bc1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据集看起来很干净。我还去掉了上面有一些 NaN 值的部分，所以起始深度是 1000 米。</p><h1 id="3d65" class="lz lq it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated"><strong class="ak"> 1。功能定义</strong></h1><p id="21b9" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">函数是一组执行特定任务的语句。函数可以使更大的程序更具可读性。它还可以帮助我们防止重复。一个函数有一个特殊的结构:<br/> 1-关键字<strong class="kk iu"> <em class="lf"> def </em> </strong>，<br/> 2-函数名，<br/> 3-我们传递值给函数的参数，<br/> 4-冒号(:)，<br/> 5-主体中的更多语句，<br/> 6-可选的返回语句。</p><h2 id="90bb" class="lp lq it bd ma mv mw dn me mx my dp mi kr mz na mk kv nb nc mm kz nd ne mo nf bi translated">根据密度测井计算孔隙度</h2><p id="4565" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">根据岩石物理测井计算孔隙度有几种方法。这里我们将使用密度法。密度工具测量井筒条件下的岩石中等体积密度(<em class="lf"> b </em>)。了解充填岩石孔隙度的流体密度(<em class="lf"> f </em>)和颗粒密度(<em class="lf"> ma </em>)有助于我们计算岩石的孔隙面积百分比。等式是:</p><figure class="lg lh li lj gt lw gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/f5defbfd8aed6513a603b43f7c79c543.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*AG3hLR4mJik-puLijZalSg.png"/></div></figure><p id="58a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从<em class="lf"> def </em>关键字开始，密度孔隙度(<em class="lf"> den </em>)函数可以用以下自变量(参数)定义:<em class="lf"> rb </em>，<em class="lf"> rf </em>，<em class="lf"> rm。</em></p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="1e69" class="lp lq it ll b gy lr ls l lt lu">def den(rb, rf, rm):<br/>    # rb = bulk density from well log readings<br/>    # rf = fluid density<br/>    # rm = matrix density or grain density of rocks<br/>    return (rm-rb)*100/(rm-rf)</span></pre><p id="6bfc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">简单地说，该函数将返回密度孔隙度，如代码的最后一行所示。这里我们更喜欢用百分比(乘以 100)来表示孔隙率。定义密度孔隙度函数后，我们可以将其应用于数据集。</p><h1 id="21a4" class="lz lq it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">2.应用功能</h1><p id="4086" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">使用 a<em class="lf">apply</em>函数，可将预定义函数(此处为密度孔隙度)应用于列或行方向的数据帧的每个元素。如果我们将其保留为默认值，它将出现在列上。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="eba5" class="lp lq it ll b gy lr ls l lt lu">df['DNPOR'] = df['RHOB'].apply(den, rf=1, rm=2.71 )</span></pre><p id="960c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于<em class="lf"> den </em>函数取 3 个值(<em class="lf"> rb </em>，<em class="lf"> rf </em>，<em class="lf"> rm </em>)，我们可以从数据集引入主值(<em class="lf"> rb =df['RHOB'] </em>)，并使用 apply 函数手动定义<em class="lf"> rf </em>和<em class="lf"> rm </em>常量。这里我假设流体成分是密度为 1 的水，主要矿物是密度为 2.71 的方解石。密度孔隙度存储在一个名为 DNPOR 的新列中。</p><h1 id="a9bb" class="lz lq it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">3.λ函数</h1><p id="b8ee" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">Lambda 函数是一个简单的单行函数，没有<em class="lf"> def </em>或<em class="lf"> return </em>关键字。事实上，它们是隐含的。要使用这个函数，我们需要键入 lambda，后跟参数。然后，冒号出现在 return 参数之前。</p><h2 id="909e" class="lp lq it bd ma mv mw dn me mx my dp mi kr mz na mk kv nb nc mm kz nd ne mo nf bi translated">根据密度和中子孔隙度计算总孔隙度</h2><p id="3020" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">总孔隙度定义为密度和中子孔隙度的平均值。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="91e9" class="lp lq it ll b gy lr ls l lt lu">Tot_por = lambda DN,CN: (DN+CN)/2</span></pre><p id="5cf1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">函数名为<em class="lf"> Tot_por </em>。对于<em class="lf">λ</em>函数，DN 和 CN 是密度和中子参数，后跟一个冒号。函数将返回这两个输入的平均值。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="5243" class="lp lq it ll b gy lr ls l lt lu">df['TPOR'] = Tot_por(df['CNPOR'], df["DNPOR"])<br/>df.head()</span></pre><p id="7da2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">调用<em class="lf"> Tot_por </em>函数并引入 DataFrame 的相应列作为输入将创建总孔隙度，该孔隙度将存储在数据集中名为 TPOR 的新列中。</p><figure class="lg lh li lj gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/df1959c7d118029a1122e2f35d795618.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DiIcIhx0Sp5AWdlWdze6sQ.png"/></div></div></figure><h1 id="f9e9" class="lz lq it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">4.切割功能</h1><p id="5bef" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">当我们需要将数据值分段并分类到特定的容器中时，我们可以使用 Cut 函数。这里，我们将使用该函数根据岩石物理性质 GR 定义简单的岩石相。</p><h2 id="042a" class="lp lq it bd ma mv mw dn me mx my dp mi kr mz na mk kv nb nc mm kz nd ne mo nf bi translated">相分类</h2><p id="36fa" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">相分类在地球科学中是一个巨大的主题，各种度量标准都可以发挥作用，但在这里，我们非常简单地看待它。根据测井记录中的自然伽马读数，我们可以从泥质地层中识别清洁地层。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="8128" class="lp lq it ll b gy lr ls l lt lu">df['facies_gr'] = pd.cut(df['GR'], bins=[0,40,300], labels=['clean', 'shaly'] )</span></pre><p id="ef2a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据 0 到 40(清洁)和 40 到 300(泥质)之间的 GR 读数，向数据集添加一个新列。</p><h1 id="4091" class="lz lq it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">5.形象化</h1><p id="b0af" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">通常，python 中使用 matplotlib 库进行绘图。在这项工作中，我更喜欢使用 seaborn 库，因为它很简单。我想用我们在前面部分定义的相的图例颜色来显示密度孔隙度与中子孔隙度的散点图。这只需一行代码即可实现，而在 matplotlib 中，这需要 for 循环。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="f66c" class="lp lq it ll b gy lr ls l lt lu">sns.lmplot(x='DNPOR', y='DT', hue='facies_gr', data=df)</span></pre><figure class="lg lh li lj gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nm"><img src="../Images/5f3353a592d366cfd0880347654dc594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KxsUZJOC7nvI1Je8aTPAvg.png"/></div></div></figure><h1 id="6464" class="lz lq it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">结论</h1><p id="26a3" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">在这项工作中，我尝试在 pandas 中使用更高级的步骤来处理岩石物理测井数据。函数是使用编程避免重复的一种便捷方式。python 的函数如<em class="lf"> apply </em>和<em class="lf"> cut </em>或者自定义函数(本工作中的<em class="lf">den</em>&amp;<em class="lf">Tot _ por</em>)对处理测井数据都是有用的。</p><p id="0a6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你有任何建议，我很乐意看到你的评论！</p></div></div>    
</body>
</html>