<html>
<head>
<title>Machine Learning Model Deployment as REST API in Four Easy Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过四个简单的步骤将机器学习模型部署为REST API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-model-deployment-as-rest-api-in-four-easy-steps-e65764f7c5c?source=collection_archive---------6-----------------------#2020-01-07">https://towardsdatascience.com/machine-learning-model-deployment-as-rest-api-in-four-easy-steps-e65764f7c5c?source=collection_archive---------6-----------------------#2020-01-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0ed2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">分四步部署您的机器学习模型</h2></div><p id="636e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我之前关于机器学习集成建模的博客中，我们开发了一个分类模型，根据病史和诊断，如患者的怀孕次数、身体质量指数、胰岛素水平、年龄等，将患者分类为糖尿病或非糖尿病患者。</p><p id="5200" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是文章的链接:</p><div class="lf lg gp gr lh li"><a href="https://medium.com/sanrusha-consultancy/ensemble-learning-bagging-f9329e07fc22" rel="noopener follow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd iu gy z fp ln fr fs lo fu fw is bi translated">集成学习</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">集成技术在通过bagging减少方差、通过boosting减少偏倚和提高预测精度方面具有强大的功能</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">medium.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw lx li"/></div></div></a></div><p id="756c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是该博客中创建最佳模型的数据来源和练习摘要:</p><p id="4efe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据源:</p><div class="lf lg gp gr lh li"><a href="https://www.kaggle.com/uciml/pima-indians-diabetes-database/data" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd iu gy z fp ln fr fs lo fu fw is bi translated">皮马印第安人糖尿病数据库</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">基于诊断方法预测糖尿病的发病</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">www.kaggle.com</p></div></div><div class="lr l"><div class="ly l lt lu lv lr lw lx li"/></div></div></a></div><p id="9fa2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是模型的Python代码:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="bf68" class="mi mj it me b gy mk ml l mm mn">import pandas as pd<br/>import numpy as np<br/>from sklearn.ensemble import RandomForestClassifier</span><span id="8c99" class="mi mj it me b gy mo ml l mm mn"># Read data into pandas dataframe<br/>df=pd.read_csv(r'C:\Machinelearning\diabetes.csv')<br/>#Define Feature Matrix (X) and Label Array (y)<br/>X=df.drop(['Outcome'],axis=1)<br/>y=df['Outcome']</span><span id="1ad3" class="mi mj it me b gy mo ml l mm mn">lr=RandomForestClassifier(n_estimators=53, n_jobs=1,random_state=8)<br/>lr.fit(X,y)</span></pre><p id="d99d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好了，我们准备好模型了。现在是时候部署它了。</p><p id="84ce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在现实生活的项目中，机器学习模型被其他应用程序使用。这些应用程序可以是任何东西，可以是面向客户的运营应用程序(如公司网站)或后台应用程序(如ERP ),也可以是数据分析应用程序。这些应用程序应该能够向模型发送特征变量值并获得预测。</p><p id="046a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然有各种各样的方法来实现它，但在这篇博客中，我将带你经历通过REST API部署机器学习模型的步骤。一旦模型可以通过REST API进行交互，任何应用程序都可以通过API调用传递特征值来寻求模型的预测。</p><p id="456f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下图显示了我们将要遵循的步骤。步骤1已经完成。</p><figure class="lz ma mb mc gt mq gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/a5eeb41518515a6159c5824d6c4a737a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*7SMWIjw2Y5Y5MEMfhDx5WQ.png"/></div></figure><h2 id="2697" class="mi mj it bd ms mt mu dn mv mw mx dp my kr mz na nb kv nc nd ne kz nf ng nh ni bi translated">步骤2:序列化模型</h2><p id="88e3" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">运行下面的Python代码行来完成步骤2。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a163" class="mi mj it me b gy mk ml l mm mn">#Serialize the model and save<br/>from sklearn.externals import joblib<br/>joblib.dump(lr, 'randomfs.pkl')<br/>print("Random Forest Model Saved")</span><span id="d844" class="mi mj it me b gy mo ml l mm mn">#Load the model<br/>lr = joblib.load('randomfs.pkl')</span><span id="a941" class="mi mj it me b gy mo ml l mm mn"># Save features from training<br/>rnd_columns = list(X_train.columns)<br/>joblib.dump(rnd_columns, 'rnd_columns.pkl')<br/>print("Random Forest Model Colums Saved")</span></pre><p id="aa8f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="bb00" class="mi mj it me b gy mk ml l mm mn">Random Forest Model Saved<br/>Random Forest Model Colums Saved</span></pre><p id="3f15" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您应该会发现在您的系统上创建了以下两个文件。如果你使用的是Windows操作系统，并且没有设置Python路径到别的地方，你会在C:\Users\ <your userid="">文件夹中找到这些文件。</your></p><figure class="lz ma mb mc gt mq gh gi paragraph-image"><div class="gh gi no"><img src="../Images/f458c8f5b161012e8addf9316268a0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*HGcTcLUu7coqJg1n0V9kKA.png"/></div></figure><p id="03bb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">到目前为止一切顺利！</p><p id="9d77" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">确保将步骤1和步骤2中的python代码组合在一个文件中，并存储在与上面相同的目录中。让我们将这个文件命名为randomfs.py</p><figure class="lz ma mb mc gt mq gh gi paragraph-image"><div class="gh gi np"><img src="../Images/6063f807995308435ad317318fa2effe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*_jrqyFOM8-11ZWbbNnkSmQ.png"/></div></figure><p id="285a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">总之，下面是文件randomfs.py的内容</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="efcb" class="mi mj it me b gy mk ml l mm mn">import pandas as pd<br/>import numpy as np<br/>from sklearn.ensemble import RandomForestClassifier</span><span id="12eb" class="mi mj it me b gy mo ml l mm mn"># Read data into pandas dataframe<br/>df=pd.read_csv(r'C:\Machinelearning\diabetes.csv')<br/>#Define Feature Matrix (X) and Label Array (y)<br/>X=df.drop(['Outcome'],axis=1)<br/>y=df['Outcome']</span><span id="c859" class="mi mj it me b gy mo ml l mm mn">lr=RandomForestClassifier(n_estimators=53, n_jobs=1,random_state=8)<br/>lr.fit(X,y)</span><span id="edc5" class="mi mj it me b gy mo ml l mm mn"><br/>#Serialize the model and save<br/>from sklearn.externals import joblib<br/>joblib.dump(lr, 'randomfs.pkl')<br/>print("Random Forest Model Saved")</span><span id="0019" class="mi mj it me b gy mo ml l mm mn">#Load the model<br/>lr = joblib.load('randomfs.pkl')</span><span id="1579" class="mi mj it me b gy mo ml l mm mn"># Save features from training<br/>rnd_columns = list(X_train.columns)<br/>joblib.dump(rnd_columns, 'rnd_columns.pkl')<br/>print("Random Forest Model Colums Saved")</span></pre><p id="9500" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">第三步:网络服务</strong></p><p id="72c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想知道什么是web服务，这里有一个来自<a class="ae nq" href="https://en.wikipedia.org/wiki/Web_service" rel="noopener ugc nofollow" target="_blank">维基百科</a>的简短解释</p><p id="42e6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">web服务是运行在计算机设备上的服务器，在网络上的特定端口监听请求，提供Web文档(HTML、JSON、XML、图像)，并创建Web应用服务，用于解决web (www、internet、HTTP)上的特定领域问题。</em></p><p id="f7a0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你现在更困惑，我会说，现在不要太担心它。就当是网站运行的服务器吧。网站可以通过这些称为Web服务的服务与其他应用程序对话。</p><p id="647f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好了，现在我们已经完成了这一部分，让我们来了解一下第三步需要做什么。</p><p id="16cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Python有一个非常有用的库Flask，这是一个web服务开发框架。如果您使用的是Anaconda发行版，Flask已经为您安装好了。</p><p id="ad00" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在真正的行动开始了。在您选择的记事本中写下代码行，并将其保存为. py文件。不要使用Jupyter笔记本进行此操作。如果你使用Jupyter笔记本来做这件事，你可能会得到错误。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="1c7a" class="mi mj it me b gy mk ml l mm mn">#Install Libraries<br/>from flask import Flask, request, jsonify<br/>from sklearn.externals import joblib<br/>import traceback<br/>import pandas as pd<br/>import numpy as np</span><span id="34bd" class="mi mj it me b gy mo ml l mm mn">application = Flask(__name__)</span><span id="537b" class="mi mj it me b gy mo ml l mm mn">@application.route(‘/prediction’, methods=[‘POST’])</span><span id="4113" class="mi mj it me b gy mo ml l mm mn">#define function</span><span id="bd11" class="mi mj it me b gy mo ml l mm mn">def predict():<br/> if lr:<br/> try:<br/> json_ = request.json<br/> print(json_)<br/> query = pd.get_dummies(pd.DataFrame(json_))<br/> query = query.reindex(columns=rnd_columns, fill_value=0)</span><span id="c491" class="mi mj it me b gy mo ml l mm mn">predict = list(lr.predict(query))</span><span id="d0e9" class="mi mj it me b gy mo ml l mm mn">return jsonify({‘prediction’: str(predict)})</span><span id="5527" class="mi mj it me b gy mo ml l mm mn">except:</span><span id="7a57" class="mi mj it me b gy mo ml l mm mn">return jsonify({‘trace’: traceback.format_exc()})<br/> else:<br/> print (‘Model not good’)<br/> return (‘Model is not good’)</span><span id="3397" class="mi mj it me b gy mo ml l mm mn">if __name__ == ‘__main__’:<br/> try:<br/> port = int(sys.argv[1])<br/> except:<br/> port = 12345 </span><span id="9505" class="mi mj it me b gy mo ml l mm mn">lr = joblib.load(“randomfs.pkl”) <br/> print (‘Model loaded’)<br/> rnd_columns = joblib.load(“rnd_columns.pkl”) # Load “rnd_columns.pkl”<br/> print (‘Model columns loaded’)</span><span id="d126" class="mi mj it me b gy mo ml l mm mn">app.run(port=port, debug=True)</span></pre><p id="dae7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将它作为rndfsapi.py保存在存储其他三个文件的同一目录中。</p><figure class="lz ma mb mc gt mq gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/81b41dd4687bf28065bcdc17e079f469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*J512hmoz5rhnDbEyS9JIFg.png"/></div></figure><figure class="lz ma mb mc gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ns"><img src="../Images/7f55ace6d457dcc072dbc5c897c3e1f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_zJj6tB2Djq7Sgp2dxLehQ.png"/></div></div></figure><p id="535e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在打开Anaconda提示符并运行命令python rndsfapi.py，这将编译文件并在提到的端口12345启动Web服务。</p><figure class="lz ma mb mc gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi nx"><img src="../Images/f2f28070d38532c5f7de1dcc1d9c8e2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z8Bz3DvxjiUL1_16bJVpqg.png"/></div></div></figure><p id="06e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经完成了这一步的活动。让我们进入下一步。</p><h2 id="6308" class="mi mj it bd ms mt mu dn mv mw mx dp my kr mz na nb kv nc nd ne kz nf ng nh ni bi translated">步骤4:测试REST API</h2><p id="8263" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">对于这一步，您将需要一个像Postman这样的REST API测试工具。你可以从下面的链接下载邮差。</p><div class="lf lg gp gr lh li"><a href="https://www.getpostman.com/tools" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd iu gy z fp ln fr fs lo fu fw is bi translated">邮递员|工具</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">为您的API创建详细的、可通过web查看的文档，设置为公共或私有。帮助开发人员使用您的API…</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">www.getpostman.com</p></div></div><div class="lr l"><div class="ny l lt lu lv lr lw lx li"/></div></div></a></div><p id="b9cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下载完成后，启动postman。在发布操作旁边输入显示URL，然后单击发送按钮。您将看到如下所示的内容。</p><figure class="lz ma mb mc gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi nz"><img src="../Images/ec6fa0a5715bf333d7f5d7a0f9a8cc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51u3M5o-BK_Ilg1r7_VBkA.png"/></div></div></figure><p id="2345" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，在body部分输入以下特征值。这就是调用应用程序发送需要预测的特征值的方式。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="f2a2" class="mi mj it me b gy mk ml l mm mn">[<br/>{“Pregnancies”:7,”Glucose”:120,”BloodPressure”:90,”SkinThickness”:23,”Insulin”:135,”BMI”:28,”DiabetesPedigreeFunction”:0.5,”Age”:45}<br/>]</span></pre><p id="9aeb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在正文中输入这些特征值，然后单击发送按钮。</p><figure class="lz ma mb mc gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi oa"><img src="../Images/61ea46b2e57ebe8df6ea172262ab75f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sqNsdTeacKBdvdW7AJ160w.png"/></div></div></figure><p id="54a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以在突出显示的正文部分查看下面的预测。这个病人没有糖尿病。</p><p id="219b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">恭喜你！</p><p id="c8d5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在您知道如何将机器学习模型部署为REST API。</p><p id="aa8c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">参考资料:</p><div class="lf lg gp gr lh li"><a href="https://www.udemy.com/course/applied-machine-learning-hands-on-course/?referralCode=00F08274D257B06E3201" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd iu gy z fp ln fr fs lo fu fw is bi translated">机器学习实践课程</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">加入最全面的机器学习实践课程，因为现在是开始的时候了！从基础…</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">www.udemy.com</p></div></div><div class="lr l"><div class="ob l lt lu lv lr lw lx li"/></div></div></a></div><div class="lf lg gp gr lh li"><a href="https://www.youtube.com/c/endtoendmachinelearning" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd iu gy z fp ln fr fs lo fu fw is bi translated">端到端机器学习</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">Sanrusha是基于机器学习和人工智能的解决方案的领先提供商。我们努力通过使用人工智能让生活变得更美好。</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">www.youtube.com</p></div></div><div class="lr l"><div class="oc l lt lu lv lr lw lx li"/></div></div></a></div></div></div>    
</body>
</html>