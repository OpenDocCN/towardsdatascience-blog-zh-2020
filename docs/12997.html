<html>
<head>
<title>A Poor Example of Transfer Learning: Applying VGG Pre-trained model with Keras</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">迁移学习的一个糟糕例子:VGG 预训练模型在 Keras 中的应用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-demonstration-of-transfer-learning-of-vgg-convolutional-neural-network-pre-trained-model-with-c9f5b8b1ab0a?source=collection_archive---------8-----------------------#2020-09-07">https://towardsdatascience.com/a-demonstration-of-transfer-learning-of-vgg-convolutional-neural-network-pre-trained-model-with-c9f5b8b1ab0a?source=collection_archive---------8-----------------------#2020-09-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6140" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用特征提取过程对 Mnist 数字数据进行分类的迁移学习演示</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9c4f3f41521ee16c747e1bc0efd74904.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IzfaloTjjKlATEWq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@tq_photos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> T. Q. </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="efe6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">迁移学习是机器学习中最先进的技术之一，已广泛应用于图像分类。在这篇文章中，我将讨论迁移学习，VGG 模型和特征提取。在最后一部分，我将展示一个有趣的迁移学习的例子，其中迁移学习技术在对<strong class="lb iu"> MNist 数字数据集</strong>进行分类时表现出乎意料地差。</p><p id="af3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> V </span>VGG 小组参加了一年一度的计算机视觉竞赛——ImageNet 大规模视觉识别挑战赛(<a class="ae ky" href="http://www.image-net.org/challenges/LSVRC/" rel="noopener ugc nofollow" target="_blank"> ILSVRC </a>)，并提交了著名的 VGG 模型，用于参加对象定位(检测来自 200 个类别的图像中的对象)和图像分类任务(1000 个类别的分类)的竞赛。ImageNet 数据集是比赛中使用的主要计算机视觉基准数据集，包括属于 1000 个类别的超过 1400 万张图像。VGG 模型以 92.7%的前 5 名测试准确率超越了其他模型，并在 2014 年 ILSVRC 竞赛中获得了第一名和第二名。</p><p id="fd70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> VGG 建筑</strong></p><p id="73a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">VGG 有两种不同的架构:VGG-16 包含 16 层，VGG-19 包含 19 层。在本文中，我们将重点关注 VGG-16，它主要包含三个不同的部分:卷积、池和全连接层——它从两个卷积层开始，然后是池，然后是两个卷积，然后是池，再重复三个卷积，然后是池，最后是三个全连接层。下图显示了 VGG-16 模型的架构。VGG 模型最有趣的部分是模型权重可用于不同的平台(如 Keras ),并可用于进一步的分析——开发模型和应用程序。将模型的权重用于进一步任务的想法引发了迁移学习的想法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/b353dcf93fe7e6afd0b9b44a556898fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:474/format:webp/1*Z5jNPTu8Xexp9rRs7RNKbA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">VGG-16 建筑</p></figure><p id="479a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以运行以下三行代码，用 python 绘制 VGG-16 模型架构:</p><pre class="kj kk kl km gt mg mh mi mj aw mk bi"><span id="c211" class="ml mm it mh b gy mn mo l mp mq">from keras.applications.vgg16 import VGG16<br/>from keras.utils import  plot_model<br/>model = VGG16()<br/>plot_model(model)</span></pre><p id="b323" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">迁移学习</strong></p><p id="0878" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们知道，随着神经网络架构的增加/深化，训练时间呈指数增长。一般来说，用大规模数据集训练一个 3-5 层的神经网络可能需要几个小时/几天。因此，由于模型架构中完全连接的图层/节点的深度和数量，在大规模数据集上从头开始部署 VGG 是一项令人厌倦且计算量巨大的任务。另一个挑战是从零开始构建 VGG 需要相当大的内存空间和带宽，因为 ImageNet 训练的 VGG-16 砝码的大小为<em class="me"> 528 </em> MB。然而，我们可以执行<strong class="lb iu">转移学习，即</strong>，利用权重等知识以及之前训练过的(例如预训练的 VGG)模型的特征，来解决类似的问题，而不是从零开始构建 VGG。例如，如果我们想开发一个二进制图像分类器，那么我们可以使用一个预先训练的模型，它是在像 VGG 这样的大型基准图像数据集上训练的。因此，迁移学习是一种机器学习方法，其中为一项任务开发的模型被重新用作第二项任务的模型的起点。迁移学习通常用于加快训练时间，最终提高模型的性能。在利用迁移学习的同时，我们必须考虑到使用迁移学习的好处并不明显。</p><p id="32ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">什么时候使用迁移学习？</strong></p><p id="1e03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以阅读深度学习的世界  <em class="me">中的文章<a class="ae ky" href="https://analyticsindiamag.com/transfer-learning-deep-learning-significance/" rel="noopener ugc nofollow" target="_blank"> <em class="me">迁移学习的意义，解释什么时候使用迁移学习。</em></a></em></p><p id="8c55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当训练数据不足时，机器学习算法尤其是深度神经网络可能无法正确学习。迁移学习可以在解决这一问题和调整模式以适应新任务方面发挥重要作用。在应用迁移学习时，我们可以寻找一些因素[1]:</p><ol class=""><li id="4ad7" class="mr ms it lb b lc ld lf lg li mt lm mu lq mv lu mw mx my mz bi translated"><strong class="lb iu">更高的起点:</strong>有迁移学习的模型初始阶段的表现应该会优于没有迁移学习的模型。</li><li id="a02e" class="mr ms it lb b lc na lf nb li nc lm nd lq ne lu mw mx my mz bi translated"><strong class="lb iu">更高的斜率:</strong>在源模型的训练阶段，性能斜率或改进率比其他情况下更陡。</li><li id="3b87" class="mr ms it lb b lc na lf nb li nc lm nd lq ne lu mw mx my mz bi translated"><strong class="lb iu">更高的渐近线:</strong>预训练的应该更平滑地收敛。</li></ol><p id="f362" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">为什么要用 VGG 模式进行迁移学习？</strong></p><p id="faa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设给定数量的训练样本(图像)不足以构建分类器，在这种情况下，VGG 可以很容易地用于特征提取，因为它是在数百万个图像上训练的。VGG 是在 2014 年推出的，尽管如此，通过 2014 年之后出现的许多最先进的图像分类器，它在一些特定任务上比其他分类器具有更好的准确性。</p><p id="f61b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将用 VGG 模型展示迁移学习的一个例子，它表明迁移学习方法没有达到标准。在以后的文章中，我们将展示另一个例子，在这个例子中，利用迁移学习方法，模型的性能得到了预期的提高。</p><p id="72df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这次演示中，我们使用著名的 MNIST 数字数据集。我们使用仅包含数字 8 和 6 的 MNIST 数据集的一部分。总共有 8200 个样本，每个样本有 784 个特征。我们使用 VGG 预训练的权重为 MNIST 数据集提取特征。</p><p id="a230" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">步骤 1 —数据准备</strong></p><p id="fa15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将数据集从本地硬盘上传到 Google Colab，并将标签从 8 和 6 转换为 1 和 0。</p><pre class="kj kk kl km gt mg mh mi mj aw mk bi"><span id="4973" class="ml mm it mh b gy mn mo l mp mq">from google.colab import files<br/>uploaded = files.upload()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/86ce303808885b709fc568aeb6a7da33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*SQR8FrRR2_ZiBp0R-3RhAA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从本地驱动器上传数据到 Colab</p></figure><p id="470d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们读取数据集。下图显示标签为 8 &amp; 6。在后面的部分中，我们将应用逻辑回归，我们将标签转换为 1 和 0。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/34e9c86731826e1e5c6bfcb47447e7dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*ED8syZytLgKheix5hxrAFA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据片段</p></figure><p id="baf8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行这一行代码将转换标签:</p><pre class="kj kk kl km gt mg mh mi mj aw mk bi"><span id="3ff5" class="ml mm it mh b gy mn mo l mp mq">data['label'] = np.where(data['label'] == 8, 1, 0)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/a311fdd202f99213626e3cb51188e6b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:412/format:webp/1*8QVL4Ff1oYof39Oq6fVstg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">转换数据集的标签</p></figure><p id="4bfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">步骤 2——从 VGG-16 模型中提取特征</strong></p><p id="4166" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在提取特征之前，只需观察 VGG-16 模型的总结:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/84364fbcd51c83812452d330a4069160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*hjelBIjiFbGEX3mP1jyvEw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">VGG-16 模型综述</p></figure><p id="e778" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总之，VGG-16 包含 16 层，其中在展平最后一个卷积层(第一个突出显示)之后，特征的数量是 25，088，并且在最后一层(预测或最终密集层)中，节点的数量是 1000，因为 VGG-16 主要针对 1000 类分类问题进行训练(第二个突出显示)。</p><p id="142a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于迁移学习的目的，我们可以使用 VGG 模型从 MNIST 数据集中提取 25088 个特征。红色垂直线显示特征提取的切割。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/0627458430f449e6e063d4c11eddfca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*TPjQkqbdV9Ckg4k_oU7nBw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">VGG-16 的特征提取</p></figure><p id="14c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码部分将在最后的卷积层之后剪切 VGG 模型:</p><pre class="kj kk kl km gt mg mh mi mj aw mk bi"><span id="93f0" class="ml mm it mh b gy mn mo l mp mq">from keras import  models<br/>base_model = VGG16(weights='imagenet')<br/>model_VGG16 = models.Model(inputs=base_model.input, outputs=base_model.get_layer(<strong class="mh iu">'flatten'</strong>).output)</span></pre><p id="fbff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/3149ec6b90f57be1d98d1c5688ab79f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*91YMjkN7y_VzL2d1A49okQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">VGG 模型在去掉最后三层后的总结</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/fa3daaff996edd2e25612d70c0139f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rItYRUEiRAOx2XoinxW0Ng.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">利用 VGG-16 模型的特征提取</p></figure><p id="220a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在使用 VGG 模型从数字数据中提取特征之后，我们用这些特征训练了逻辑回归二元分类器，并执行 10 重交叉验证。同时，我们还对原始的 mnist 数字数据进行了逻辑回归，并进行 10 重交叉验证，以将结果与迁移学习的性能进行比较。</p><p id="1cac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下两个表显示了对原始数据和从原始数据中提取的特征应用逻辑回归的结果。在没有迁移学习的情况下，即将 LR 应用于原始数字数据实现了大约 98%的准确度，而利用迁移学习特征的模型仅实现了 50%的准确度，这类似于二进制分类问题的随机猜测。总的来说，我们期望随着迁移学习的进行，模型的性能会提高。然而，在这个演示中，我们发现随着迁移学习，模型性能急剧下降。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/60017d3bf317f7d816f8400c2f0618cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkEHOjxoS_jDqQKtVMZOXw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">逻辑回归应用于 Mnist 数字数据的结果</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/518c472283bd99e46b061aac3e4609e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X1thwiSSC1MW_QXrUvyBXg.png"/></div></div></figure><p id="3e88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">VGG16 性能不佳的可能原因:</p><ol class=""><li id="5d3f" class="mr ms it lb b lc ld lf lg li mt lm mu lq mv lu mw mx my mz bi translated">VGG-16 是为 3 通道 RGB 图像训练的，而 Mnist 数字数据是 1 通道灰度</li></ol><p id="cdda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.通过 VGG-16 高级代表性特征学习的 ImageNet 数据中的背景噪声</p><p id="e457" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.VGG-16 训练用于 1000 级分类，而对于这个任务，我们使用它进行二进制分类</p><p id="65f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然具有迁移学习的模型在该实验中没有提供有益的结果，但是利用 VGG 的其他层进行特征提取过程或者微调参数可以产生更好的准确性。总之，迁移学习是一种最先进的机器学习技术，可以提高模型的性能。然而，灵活运用迁移学习技术是获得适当优势的必要条件。</p><h1 id="3b7a" class="no mm it bd np nq nr ns nt nu nv nw nx jz ny ka nz kc oa kd ob kf oc kg od oe bi translated">阅读默罕默德·马苏姆博士(以及媒体上成千上万的其他作家)的每一个故事。</h1><p id="edaa" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">你的会员费将直接支持和激励穆罕默德·马苏姆和你所阅读的成千上万的其他作家。你还可以在媒体上看到所有的故事—<a class="ae ky" href="https://masum-math8065.medium.com/membership" rel="noopener"><strong class="lb iu"/></a></p><p id="983a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">阅读愉快！</strong></p><p id="6fc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参考:</p><p id="eae9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[1]<a class="ae ky" href="https://analyticsindiamag.com/transfer-learning-deep-learning-significance/" rel="noopener ugc nofollow" target="_blank">https://analyticsindiamag . com/transfer-learning-deep-learning-significance/</a></p><p id="b8fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://keras.io/guides/transfer_learning/" rel="noopener ugc nofollow" target="_blank">https://keras.io/guides/transfer_learning/</a></p><p id="d484" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3]<a class="ae ky" href="https://www.alibabacloud.com/blog/part-1-image-classification-using-features-extracted-by-transfer-learning-in-keras_595289" rel="noopener ugc nofollow" target="_blank">https://www . Alibaba cloud . com/blog/part-1-image-class ification-using-features-extracted-by-transfer-learning-in-keras _ 595289</a></p></div></div>    
</body>
</html>