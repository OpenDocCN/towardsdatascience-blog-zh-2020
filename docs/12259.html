<html>
<head>
<title>Forecasting Football Scores With GgPlot2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 GgPlot2 预测足球比分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/forecasting-football-scores-with-ggplot2-949de7c1cb52?source=collection_archive---------14-----------------------#2020-08-24">https://towardsdatascience.com/forecasting-football-scores-with-ggplot2-949de7c1cb52?source=collection_archive---------14-----------------------#2020-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="43c0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用泊松帮助可视化足球正确的分数在 R</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4462ef2e136a942201e27a6bc6e1bc2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nA33Kf_SYByN2AAbUUYYZA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">李名炀(<a class="ae ky" href="https://unsplash.com/@guoshiwushuang" rel="noopener ugc nofollow" target="_blank">@果事无双</a>)在<a class="ae ky" href="https://unsplash.com/photos/6J7eIvNwttQ" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="6878" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">胡闹</h1><p id="3721" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我之前的一篇帖子中，我提到一场足球比赛的比分可以用<a class="ae ky" href="https://en.wikipedia.org/wiki/Poisson_distribution" rel="noopener ugc nofollow" target="_blank">泊松分布</a>来近似计算，但我没有过多地谈论这个话题。好吧，你今天很幸运…我们将看看这个主题，在这篇文章的最后，我们将有 Ggplot2 可视化说明一场足球比赛的可能比分，这真的很棒。</p><p id="4e31" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，讲一点泊松分布的根。这种概率分布的发现归功于十九世纪的法国数学家西蒙·丹尼斯·泊松。像他同时代的许多人一样，他主要研究它的理论。直到俄罗斯统计学家 Ladislaus Bortkiewicz 于 1898 年出版了他的书《大数定律》，泊松分布才在实践中得到广泛应用。</p><p id="541f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">众所周知，Bortkiewicz 获得了普鲁士军队 20 年来的一组数据，记录了被马踢死的士兵人数。冷酷无情。</p><p id="8eff" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">总之，他证明了这些死亡可以用泊松分布来近似，剩下的，正如他们所说的，都是历史了。</p><p id="ee08" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在…一个人如何从普鲁士骑兵到足球比分？</p><h1 id="fb7b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">愚弄你和我</h1><p id="0ada" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们先来看看满足泊松过程的基本假设:</p><ol class=""><li id="431a" class="mt mu it lt b lu mn lx mo ma mv me mw mi mx mm my mz na nb bi translated"><strong class="lt iu">事件在给定时间间隔内发生的概率不随时间变化</strong></li><li id="3b86" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated"><strong class="lt iu">事件随机发生</strong></li><li id="4f62" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated"><strong class="lt iu">事件独立发生</strong></li></ol><p id="b62d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在把进球想象成足球比赛中的一个事件。如果我们有一个指标可以表达一支球队在 90 分钟内的得分率/强度，我们可以说第一个假设得到了满足。这很难定义，但谢天谢地，体育迷们(我应该补充一句，他们比我聪明一百倍)已经为此提出了<a class="ae ky" href="https://fbref.com/en/expected-goals-model-explained/" rel="noopener ugc nofollow" target="_blank">预期目标</a> (xG)。今天谢谢你！</p><p id="7b45" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下一个问题-足球比赛中进球是随机出现的吗？也就是说，在一场比赛中是否有一个特定的时间点更容易进球？<a class="ae ky" href="https://medium.com/@Soccermatics/luck-skill-and-randomness-aaa8d80836ea" rel="noopener">这个家伙</a>说不，许多其他<a class="ae ky" href="https://www.nytimes.com/2014/07/08/science/soccer-a-beautiful-game-of-chance.html#:~:text=It%20involves%20hundreds%20of%20skillful,victory%20is%20a%20single%20goal." rel="noopener ugc nofollow" target="_blank">的文章和研究</a>也表明进球<em class="ms">确实</em>在足球比赛中随机发生。在实践中，目标可能不像人们想象的那样随机，但是…我们有足够的证据证明它们是随机的，所以让我们打勾，现在继续。</p><p id="e765" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在是最后一个假设——目标是相互独立的。如果一支球队落后，球员们肯定会更加努力地回到比赛中去，以扳平比分。或者，如果一个队已经领先 5 个球，球员可能会因为自满而放松油门，让一个人进入。无论哪种方式，你都必须说目标<strong class="lt iu"><em class="ms"/></strong>不是彼此独立发生的，使用基本泊松过程来模拟足球比分在这里开始失效。</p><p id="2f31" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有一些技术可以调整比赛中的目标依赖性，但我们都有白天的工作——所以让我们把它留到另一天……现在同意三分之二并不坏(而且，我正在努力在 it 中生成有用的内容，所以我们在这里)。为了进一步阅读，我建议看看这篇<a class="ae ky" href="https://dashee87.github.io/data%20science/football/r/predicting-football-results-with-statistical-modelling/" rel="noopener ugc nofollow" target="_blank">精彩的博客文章</a>，它基本上为足球做了一个 Bortkiewicz，表明你可以用泊松分布近似一个赛季的进球数。</p><h1 id="d783" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">蹄</h1><p id="bb7a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我之前关于 xG 的<a class="ae ky" rel="noopener" target="_blank" href="/did-liverpool-deserve-to-win-the-premier-league-eda7a4e1b9ca#h1">帖子</a>中，我创建了一个简单的泊松模型来帮助预测 r 中一场足球比赛的结果(主场胜利、平局、客场胜利)。我们将在这里使用类似的东西，但更侧重于获得正确得分的概率作为输出。</p><p id="3a84" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">r 已经从它的基础热图库中走了很长一段路，这些热图库还不太成熟。Ggplot2 是一个神奇的软件包，它允许构建各种图形和图表。为了使用它们，我们必须首先在 RStudio 中安装一些依赖项:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="192a" class="nm la it ni b gy nn no l np nq">install.packages('tidyr')<br/>install.packages('dplyr')<br/>install.packages('scales')<br/>install.packages('ggplot2')</span><span id="1d9c" class="nm la it ni b gy nr no l np nq">library('tidyr')<br/>library('dplyr')<br/>library('scales')<br/>library('ggplot2')</span></pre><p id="aecb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">酷，现在让我们回到我们最初的假设之一——在一场足球比赛中，球队在 90 分钟内有恒定的得分率。我们将使用取自<a class="ae ky" href="https://projects.fivethirtyeight.com/soccer-predictions/champions-league/" rel="noopener ugc nofollow" target="_blank"> FiveThirtyEight 的模型</a>的基于镜头的 xG，用于巴塞罗那和拜仁慕尼黑之间的冠军联赛四分之一决赛(哦，天哪……)。让我们构造并获取一个<code class="fe ns nt nu ni b">ScoreGrid</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="840f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们创建了一个 11 列 11 行的数据框，每个条目代表一个正确的分数。因此[ <strong class="lt iu">行<em class="ms"> i </em>，列<em class="ms"> j </em> </strong>中的条目将是得分<strong class="lt iu"> <em class="ms"> i，j </em> </strong> <em class="ms"> </em>，其中<strong class="lt iu"> <em class="ms"> i </em> </strong> <em class="ms"> </em>为主场得分，<strong class="lt iu"> <em class="ms"> j </em> </strong> <em class="ms"> </em>为客场得分。因此，entry [ <em class="ms"> 1，2 </em> ]将会是客场队以 2-1 获胜。给定<code class="fe ns nt nu ni b">homeXg</code>和<code class="fe ns nt nu ni b">awayXg</code>，<code class="fe ns nt nu ni b">dpois</code>有助于为每个分数<em class="ms"> i </em>生成随机泊松概率。最后，我们将个人得分限制在 9 分，一旦我们达到 10 分，我们将把概率加在一起，并将它们分组为一个条目。这只会让事情变得更简单。</p><p id="357c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们快速旋转一下。在 RStudio 控制台中，键入</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="2da7" class="nm la it ni b gy nn no l np nq">ScoreGrid(1.7,1.1)</span></pre><p id="b7cf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你应该知道这个:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/3652ddb23799ae295d054d5676e92399.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*LYfVcdQTgqhLD1idju0RqA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">足球正确得分网格。作者图片</p></figure><p id="b720" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">网格不错，但不太好看。</p><h1 id="e710" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">罗伯特·莱万戈尔斯基</h1><p id="065a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们现在建立正确的分数视觉。我们将在 Ggplot2 中使用<code class="fe ns nt nu ni b">geom_tile()</code>,它会在最后生成一个漂亮的热图。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="96b8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Ggplot2 要求输入数据为<code class="fe ns nt nu ni b">tidy</code>数据帧，因此从基数 R <code class="fe ns nt nu ni b">data.frame</code>的转换发生在第 10 行的<code class="fe ns nt nu ni b">pivot_longer</code>处。接下来，我们需要将所有的<code class="fe ns nt nu ni b">vars</code>转换为<code class="fe ns nt nu ni b">factors</code>，并按照正确的顺序对等级进行排序(记住<em class="ms"> 10+ </em>是一个因子，使用<code class="fe ns nt nu ni b">as.numeric</code>只会使它变成一个<code class="fe ns nt nu ni b">NA</code>)。我们希望它是列表中的最后一级)。这在第 14 行用<code class="fe ns nt nu ni b">~forcats::fct_relevel</code>完成。除此之外的所有内容都只包含 Ggplot2 图的常见构件。</p><p id="690f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">好了，我们开始吧。启动 R 控制台，输入团队名称和 xG 输入，无论您来自哪里:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="8a11" class="nm la it ni b gy nn no l np nq">ScoreHeatMap("Barcelona", "Bayern_Munich", 1.2, 5.6, "FiveThirtyEight")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/161dba51b298f13bac2a54dae9b24e10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*cafndS1XwgPL1hOdsYmExw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">巴塞罗那 vs 拜仁慕尼黑正确的比分可视化。作者图片</p></figure><p id="cec8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这场比赛中，男人对男孩，只要看看可视化/热图，你就可以看到根据 xG，拜仁慕尼黑最有可能的比分是 5-1。事实上，拜仁实际上以 8 比 2 获胜。罗伯特·莱万戈尔斯基的确。</p><p id="29fc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">再举一个例子来说明一场势均力敌的比赛，昨晚巴黎圣日耳曼和拜仁慕尼黑之间的冠军联赛决赛:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="6c60" class="nm la it ni b gy nn no l np nq">ScoreHeatMap("Paris_SG", "Bayern_Munich", 1.4,1.6,"FiveThirtyEight")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/3aad7bd671bbba9bd95eba9840a5450f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*1xzQqbSYxjA0KM4YqmnSxQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">巴黎圣日耳曼 vs 拜仁慕尼黑正确比分可视化。图片作者。</p></figure><p id="4c3b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一场激烈得多的比赛，1-1 是最有可能的比分，拜仁慕尼黑实际上以 1-0 获胜。</p><h1 id="0553" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">稳定的模型</h1><p id="a3a3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">和往常一样，有几个警告，其中一个我们已经讨论过了——即目标不是相互独立的，所以这个模型值得重新审视。此外，如果这些 xG 机会中的任何一个有不同的结果(即射门击中门柱或偏出而不是进入)，我们可能<a class="ae ky" href="https://en.wikipedia.org/wiki/Butterfly_effect" rel="noopener ugc nofollow" target="_blank">今天就不会在这里谈论这个问题</a> …让我们不要忘记 xG 本身是一个有缺陷的指标，它没有捕捉到一场足球比赛中的许多细微差别。</p><p id="dbf7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">尽管如此，这些视觉效果很好地展示了一场比赛的结果——如果有什么不同的话，这是一次很好的使用一些令人印象深刻的 R 库进行图形和可视化的练习。</p><p id="d4cb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">和往常一样，如果我想不通的话，你可以在我的 Github 仓库里找到所有这些。为今天干杯…</p></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><h1 id="1122" class="kz la it bd lb lc oh le lf lg oi li lj jz oj ka ll kc ok kd ln kf ol kg lp lq bi translated">其他文章</h1><div class="om on gp gr oo op"><a rel="noopener follow" target="_blank" href="/did-liverpool-deserve-to-win-the-premier-league-eda7a4e1b9ca"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">利物浦值得赢得英超冠军吗？</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">使用 Python、R 和预期目标的英超联赛 2019/20 回顾</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">towardsdatascience.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd ks op"/></div></div></a></div><h1 id="bf59" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">足球正确比分可视化 R 码</strong></h1><div class="om on gp gr oo op"><a href="https://github.com/ourandy/blog-repo" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">ourandy/博客-回购</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">博客文章的存储库。在 GitHub 上创建一个帐户，为我们的 andy/blog-repo 开发做出贡献。</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">github.com</p></div></div><div class="oy l"><div class="pe l pa pb pc oy pd ks op"/></div></div></a></div></div></div>    
</body>
</html>