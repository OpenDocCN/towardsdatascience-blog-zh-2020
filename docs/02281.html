<html>
<head>
<title>Using Python to Create a Spotify Playlist of the Samples on an Album</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 创建专辑中样本的 Spotify 播放列表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-python-to-create-spotify-playlists-of-the-samples-on-an-album-e3f20187ee5e?source=collection_archive---------19-----------------------#2020-03-04">https://towardsdatascience.com/using-python-to-create-spotify-playlists-of-the-samples-on-an-album-e3f20187ee5e?source=collection_archive---------19-----------------------#2020-03-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/4d49a1ba5e89634dd113f38e9199e419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j1bKgDVc2VIZV1AG"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">(通过<a class="ae jg" href="https://unsplash.com/photos/dZPp5ZVMcN0" rel="noopener ugc nofollow" target="_blank">去飞溅</a></p></figure><div class=""/><div class=""><h2 id="fe35" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">用循环和随机样本交换鼓循环和灵魂样本</h2></div><h1 id="50a0" class="ky kz jj bd la lb lc ld le lf lg lh li kp lj kq lk ks ll kt lm kv ln kw lo lp bi translated">介绍</h1><p id="7b9a" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">作为一个狂热的嘻哈迷，我一直对采样极其感兴趣。对于门外汉来说，音乐采样是将一首现有歌曲的一部分重新用作新歌的一部分的行为。一个很好的例子是坎耶·韦斯特 2005 年专辑<em class="mm"/><a class="ae jg" href="https://open.spotify.com/album/5ll74bqtkcXlKE7wwkMq4g?si=TcITaOg8T8qtnIGBqDxERQ" rel="noopener ugc nofollow" target="_blank"><em class="mm"/></a>中的<a class="ae jg" href="https://open.spotify.com/track/0TzIHqhAbvYR6qJKrMMFlk?si=pImuTmN8TlmdzGCXnikQ4A" rel="noopener ugc nofollow" target="_blank">我回家的路</a>，这是吉尔·斯科特-赫伦 1971 年专辑中的<a class="ae jg" href="https://open.spotify.com/track/7Fztxy3uXxR169c6vLzhS9?si=F8tR0cDbRaazHZUfb4JQtg" rel="noopener ugc nofollow" target="_blank">家是仇恨的地方</a>，<a class="ae jg" href="https://open.spotify.com/album/6gZlPB0fBBD75qUSKSFKs0?si=7LoFiYE5SU6IkCb8zkbkxA" rel="noopener ugc nofollow" target="_blank"> <em class="mm">一个人的片段</em> </a> <em class="mm">。</em></p><p id="dfe2" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated"><em class="mm">迟到的报名</em>充满了从前面提到的苍鹭曲目到雪莉·贝西的经典曲目“<a class="ae jg" href="https://open.spotify.com/track/5MOMDX8hLLVOtji1vhSPmb?si=K5SSMOyaQ7qUb8clQEbhnw" rel="noopener ugc nofollow" target="_blank">钻石恒久远</a>”的精彩样本，该曲目曾作为同名邦德电影的主题曲。听了无数遍《迟到的登记》( Late Registration )( T23 ),我想更深入地了解音乐，并探索韦斯特和联合制作人乔恩·布里昂(Jon Brion)通过采样对文字的影响。我开始在<a class="ae jg" href="https://genius.com/" rel="noopener ugc nofollow" target="_blank"> Genius </a>上搜索歌曲，找到样本的名称，并手动将它们添加到 Spotify 播放列表中。不出所料，过了一段时间后，这变得很麻烦，所以我写了一个脚本来自动化这个过程。下面，我将以<em class="mm">后期注册</em>为例演示脚本是如何工作的，但是如果你想直接跳到代码中，你可以在我的<a class="ae jg" href="https://github.com/eric-hochberger/sample-playlists" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><h1 id="239b" class="ky kz jj bd la lb lc ld le lf lg lh li kp lj kq lk ks ll kt lm kv ln kw lo lp bi translated">网页抓取</h1><p id="ac13" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">第一步是生成来自<em class="mm">延迟注册</em>的样本列表。如前所述，<a class="ae jg" href="http://genius.com" rel="noopener ugc nofollow" target="_blank"> Genius </a>拥有大量关于每首歌曲样本的众包数据，因此只需收集专辑中每首歌曲页面的链接，循环浏览它们，并从每首歌曲中收集样本信息:</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/22def167de6d044ab2044e65add9abae.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*iZ--yN9dmsgSwaXk61Sj_Q.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://genius.com/Kanye-west-my-way-home-lyrics" rel="noopener ugc nofollow" target="_blank"> Genius </a>关于“我回家的路”的曲目信息</p></figure><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="mx my l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">使用 Python 模块 BeautifulSoup4 和请求</p></figure><p id="5472" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">至少我是这么认为的。在使用这种策略运行 scraper 时，看到结果数据帧包含 12 个结果(其中两个是重复的)，我怀疑 scraper 丢失了信息，所以我在 Genius song 页面上做了一些手动检查以找出原因。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mz"><img src="../Images/17faff61be63b418ee4be68694747ba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*49uuwUA0ozAaKKvzRf71kQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">天才歌曲页为《<a class="ae jg" href="https://genius.com/Kanye-west-late-lyrics" rel="noopener ugc nofollow" target="_blank">晚期</a>》作者坎耶·韦斯特</p></figure><p id="f5b4" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">事实证明，一些 Genius 歌曲页面上的样本信息位于介绍性制作注释中，而不是歌曲的信息框中。这是一个令人沮丧的认识，但它促使我设计一个解决方法。</p><h2 id="8a73" class="na kz jj bd la nb nc dn le nd ne dp li lz nf ng lk md nh ni lm mh nj nk lo nl bi translated">从注释中获取样本数据</h2><p id="9811" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">像 Spotify 一样，Genius 也有一个<a class="ae jg" href="https://docs.genius.com/" rel="noopener ugc nofollow" target="_blank">免费 API </a>，它允许用户提取关于特定注释的信息，所以一旦我分离出注释，我只需要提取样本信息。因为注释不是标准化的，所以解析文本以确定样本的名称并不简单。然而，我注意到，每当 Genius 用户引用样本时，他们都会提供一个附带的 Youtube 链接。多么体贴。利用这些信息，我能够开发一个补充的 scraper，该 scraper 隔离一个 Genius 产品注释，并通过在注释中抓取 Youtube 视频的标题来输出示例信息:</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="5966" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">现在配备了这个更健壮的 scraper，我们可以看看从<em class="mm">晚注册</em> 的<a class="ae jg" href="https://genius.com/albums/Kanye-west/Late-registration" rel="noopener ugc nofollow" target="_blank"> Genius URL 输出的数据:</a></p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/8f925ca7fac99256a9838b9f2a2a368c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*AdXNblcHXcfu05ZVI7EWiA.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">信息框中的示例数据(作者截图)</p></figure><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/be33753216f5ee2a27b886b099daa8c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*SxvBs78uLQ1lX6gv3GUjFA.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来自注释的示例数据(作者截图)</p></figure><p id="f072" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">接下来，我将这两个数据帧分别称为<code class="fe no np nq nr b">sample_data</code>和<code class="fe no np nq nr b">titles</code>。尽管由于数据帧中存在重复的轨道，刮刀可能会出现一些错误，但这实际上是刮刀正在工作的证据。<em class="mm">后期注册的前两首曲目，“</em> <a class="ae jg" href="https://open.spotify.com/track/62KeM7jbmYvzT5FycdiQeS?si=75vnCko8Qni30xu_SaMwlA" rel="noopener ugc nofollow" target="_blank">叫醒韦斯特先生</a>”和“<a class="ae jg" href="https://open.spotify.com/track/6yIjtVtnOBeC8SwdVHzAuF?si=93OmnffeT8-ylVvBtJr-xg" rel="noopener ugc nofollow" target="_blank">听见他们说</a>”被<a class="ae jg" href="https://open.spotify.com/track/32nMIZuO9A0TtXq0uI5XWr?si=fp_sJRFRSsyW_kWOzkjUzg" rel="noopener ugc nofollow" target="_blank">这首华丽的娜塔莉·科尔曲目</a>的样本出色地联系在一起，前者原样采样介绍性的钢琴部分，后者采用循环上的一段相同的钢琴部分作为其节拍的基础《钻石是永恒的》出现了两次，因为这张专辑包含了原版的"<a class="ae jg" href="https://open.spotify.com/track/0uGDH1WaBzmznj0ilMu4VI?si=yxByf8AZQAmHkteKXM0g_g" rel="noopener ugc nofollow" target="_blank">来自塞拉利昂的钻石</a>"，它是 Bassey 曲目的样本，也是这张专辑的主打单曲，还有一张<a class="ae jg" href="https://open.spotify.com/track/66VueiRZubO0SwPAFtPZpu?si=uNa-PgjHQRytOSJNc3hroQ" rel="noopener ugc nofollow" target="_blank">由 Kanye 的导师 Jay-Z 演唱的混音版</a>。</p><h1 id="c634" class="ky kz jj bd la lb lc ld le lf lg lh li kp lj kq lk ks ll kt lm kv ln kw lo lp bi translated"><strong class="ak">使用 Spotify 创建 Spotify 播放列表</strong></h1><p id="05e6" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">下一步是自动创建一个恰当命名的 Spotify 播放列表，这可以通过<code class="fe no np nq nr b">Spotipy</code>模块轻松完成。启动<code class="fe no np nq nr b">Spotipy</code>是一个<a class="ae jg" href="https://spotipy.readthedocs.io/en/2.9.0/#getting-started" rel="noopener ugc nofollow" target="_blank">的简短过程</a>，它可以归结为向 Spotify 注册为开发人员，以获得一个客户端 id 和一个客户端密码，结合一个活跃的 Spotify 用户名，允许你通过 Spotify 的免费 API，通过 Python 对你的 Spotify 帐户执行无数操作。我使用 Spotipy 的“授权代码流”来授权使用我的帐户，然后创建一个 Spotipy 对象:</p><pre class="mt mu mv mw gt ns nr nt nu aw nv bi"><span id="72c3" class="na kz jj nr b gy nw nx l ny nz">token = util.prompt_for_user_token(username,scope,client_id=client_id,client_secret=client_secret,redirect_uri='http://localhost/') <br/>sp = spotipy.Spotify(auth=token)</span></pre><p id="9fbb" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">现在我们可以创建播放列表了:</p><pre class="mt mu mv mw gt ns nr nt nu aw nv bi"><span id="6c97" class="na kz jj nr b gy nw nx l ny nz">playlist_name = f"Samples in {album_title} by {album_artist}"    sp.user_playlist_create(username, name=playlist_name)</span></pre><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/99bb34ff6898e8dcd57994e0d733c64e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8asUGW813dafRsdGJQQWqw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://www.spotify.com/us/" rel="noopener ugc nofollow" target="_blank"> Spotify </a>上的播放列表</p></figure><p id="f908" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">非常简单。执行这段代码后，我们在 Spotify 上有了一个标题描述性的播放列表，可以添加歌曲了。</p><h1 id="f9cc" class="ky kz jj bd la lb lc ld le lf lg lh li kp lj kq lk ks ll kt lm kv ln kw lo lp bi translated">向播放列表添加曲目</h1><p id="99b4" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">不幸的是，将曲目添加到播放列表并不像提交您想要的曲目列表那么简单，但我们不做数据科学，因为这很容易。我们这样做是因为这很难，因为创建 Spotify 音乐播放列表的挑战将有助于组织和衡量我们最好的精力和技能，因为这是一个我们将接受的挑战，一个我们不愿意推迟的挑战，一个我们<a class="ae jg" href="https://genius.com/2228973" rel="noopener ugc nofollow" target="_blank">打算赢得</a>的挑战！但是，我跑题了。</p><p id="2f23" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">下面是我写的一些代码，用于从<code class="fe no np nq nr b">sample_data</code>数据帧和 Youtube 视频标题列表中获取 Spotify 曲目 id 列表。我使用了<code class="fe no np nq nr b">Spotipy</code>和<code class="fe no np nq nr b">fuzzywuzzy</code>，这是一个模糊字符串匹配模块，我稍后将讨论它的用途:</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="effe" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">由于我采取了一些不直观的步骤，我们将更详细地分解这段代码。我通过实验发现，Spotify 搜索的第一个结果并不总是想要的曲目，这是由于 Spotify 搜索算法的特性，我不会假装理解，因此有必要检索多个结果:</p><pre class="mt mu mv mw gt ns nr nt nu aw nv bi"><span id="06f6" class="na kz jj nr b gy nw nx l ny nz">results = sp.search(q=f"{sample_data['title'][i]} {sample_data['artist'][i]} ", limit=5, type='track')</span></pre><p id="fc3f" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">然后，我必须验证五个回答中的哪一个是我首先想要的音轨。诚然，我第一次尝试这样做是一个彻底的失败。我当时年轻乐观，认为 Spotify 搜索结果的标题会与众包网站 Genius 从网上搜集的标题完全一致。他们没有。作为一名经验丰富的老手，我通过模糊(近似)字符串将 Spotify 结果的艺术家和曲目标题与<code class="fe no np nq nr b">sample_data</code>数据帧中列出的艺术家和曲目标题进行匹配。下面是代码的简化版本:</p><pre class="mt mu mv mw gt ns nr nt nu aw nv bi"><span id="7dbc" class="na kz jj nr b gy nw nx l ny nz">if fuzz.partial_ratio(Spotify_artist_name, sample_data_artist_name) &gt; 90 and fuzz.partial_ratio(Spotify_track_title, sample_data_track_title) &gt; 90:                    <br/>track_ids.append(Spotify_track_id) #append track id                   </span></pre><p id="b1df" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">由于几乎不可能从 Youtube 视频的标题中区分艺术家和曲目名称，因此我们无法核实 Spotify 在<strong class="ls jk">注释工作流程</strong>中的结果。然而，这一工作流程产生了许多我们在其他情况下不会发现的额外样品，因此我发现其好处超过了潜在的成本。</p><h2 id="9767" class="na kz jj bd la nb nc dn le nd ne dp li lz nf ng lk md nh ni lm mh nj nk lo nl bi translated">关于模糊字符串匹配的简短说明</h2><p id="9e8d" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">模糊字符串匹配包含一组量化两个字符串相似程度的方法。他们这样做的方法是计算使一个字符串与另一个字符串完全匹配所需的改变次数(想想替换一个字母，删除一个空格)。我将用一个例子来说明为什么我们需要这种技术:</p><p id="35b1" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">如果你检查上面的<code class="fe no np nq nr b">sample_data</code>数据框，你会看到“凯吉夫妇”的“天梦”在 Spotify 上，这支乐队的名字是“凯吉斯”艰难。显然，如果我们对艺术家姓名进行精确匹配，我们不会在播放列表中找到这个正确的样本。但是，通过使用<code class="fe no np nq nr b">fuzzywuzzy</code>函数<code class="fe no np nq nr b">partial_ratio()</code>，它是一个模糊字符串匹配算法的实现，我们得到:</p><pre class="mt mu mv mw gt ns nr nt nu aw nv bi"><span id="47fa" class="na kz jj nr b gy nw nx l ny nz">fuzz.partial_ratio("The Kay-Gees", "The Kay Gees")<br/>100</span></pre><p id="dbab" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">由于一些差异比这更具戏剧性，我将艺术家和曲目标题字符串的匹配阈值都设置为 90，但请随意试验您自己的！</p><h2 id="480d" class="na kz jj bd la nb nc dn le nd ne dp li lz nf ng lk md nh ni lm mh nj nk lo nl bi translated">将曲目添加到播放列表</h2><p id="c57a" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">幸运的是，将曲目添加到播放列表<strong class="ls jk">就像提交您想要的曲目的曲目 id 列表<strong class="ls jk">一样简单，这正是上面的<code class="fe no np nq nr b">GetTrackIDs()</code>函数的输出。我们需要的唯一附加信息是我们之前创建的播放列表的<code class="fe no np nq nr b">playlist_id</code>:</strong></strong></p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="5304" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">现在我们将曲目添加到播放列表中:</p><pre class="mt mu mv mw gt ns nr nt nu aw nv bi"><span id="b5d6" class="na kz jj nr b gy nw nx l ny nz">sp.user_playlist_add_tracks(username, playlist_id, track_ids)</span></pre><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ob my l"/></div></figure><p id="90b5" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">瞧啊。我们在 Kanye West 的<em class="mm">晚注册上有一个相当广泛的歌曲样本播放列表。</em>唯一明显的错误是管弦乐版的《钻石恒久远》(Diamonds is Forever)，在我看来，这是一个小小的代价，以确保我们包括纽约社区合唱团 1977 年的《自从你走进我的生活》，它为西部经典的旋律提供了核心的号角，“<a class="ae jg" href="https://open.spotify.com/track/4fRTe59xEeNHT4uyAGsV27?si=e-0rfstWTO2YbQiTzRbjHQ" rel="noopener ugc nofollow" target="_blank">快克音乐</a>”</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="a2d3" class="pw-post-body-paragraph lq lr jj ls b lt mn kk lv lw mo kn ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">我希望你阅读这个演示的乐趣有我制作它的一半多，<a class="ae jg" href="https://genius.com/2216206" rel="noopener ugc nofollow" target="_blank">因为我玩得很开心</a>。我的<a class="ae jg" href="https://github.com/eric-hochberger" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上有更多与音乐相关的项目。</p></div></div>    
</body>
</html>