<html>
<head>
<title>All About Target Encoding For Classification Tasks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分类任务的目标编码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/all-about-target-encoding-d356c4e9e82?source=collection_archive---------35-----------------------#2020-07-06">https://towardsdatascience.com/all-about-target-encoding-d356c4e9e82?source=collection_archive---------35-----------------------#2020-07-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6289" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">设置上下文以实现多类分类的目标编码</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7a7175f13a542f0fa78c6fb3b8a74059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-XcWQUjBD9KWUMPf"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@silvanarnet?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Silvan Arnet </a>拍摄的照片</p></figure><h2 id="379c" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">背景</h2><p id="31b7" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">最近我做了一个项目，其中的目标是多类。这是一项简单的预测任务，数据集既包括分类特征，也包括数字特征。</p><p id="007c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">对于那些想知道什么是多类分类的人:如果你想用‘0 对 1’、‘点击过的对没点击的’或者‘猫对狗’来回答，你的分类问题是二进制的；如果要用‘红色 vs 绿色 vs 蓝色 vs 黄色’或者‘轿车 vs 舱口 vs SUV’来回答，那么问题就是多级的。</p><p id="8fcb" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">因此，我正在研究合适的方法来编码分类特征。不用猜，我被带到了 medium 文章中，列举了 mean target 编码的好处，它如何优于其他方法，以及如何使用<a class="ae kv" href="http://contrib.scikit-learn.org/category_encoders/index.html" rel="noopener ugc nofollow" target="_blank"> category_encoders </a>库只用两行代码就完成了任务。然而，令我惊讶的是，我发现没有文章在多类目标上演示这一点。我查阅了 category_encoders 的文档，发现它没有提到支持多类目标。我深入研究了一下<a class="ae kv" href="http://contrib.scikit-learn.org/category_encoders/_modules/category_encoders/target_encoder.html#TargetEncoder" rel="noopener ugc nofollow" target="_blank">源代码</a>，发现这个库只适用于二进制或连续目标。</p><blockquote class="mq"><p id="8655" class="mr ms iq bd mt mu mv mw mx my mz mk dk translated">所以我想:“每一个问题背后都蕴藏着一个机会。”—罗伯特·基波萨基</p></blockquote><p id="f0da" class="pw-post-body-paragraph ls lt iq lu b lv na jr lx ly nb ju ma lf nc mc md lj nd mf mg ln ne mi mj mk ij bi translated">继续深入，我直奔丹尼尔·米西-巴雷卡的<a class="ae kv" href="https://dl.acm.org/doi/10.1145/507533.507538" rel="noopener ugc nofollow" target="_blank">原始论文</a>，该论文介绍了平均目标编码。不仅对于回归问题，本文还给出了二元分类和多类分类的解决方法。这也是 category_encoders 引用的关于目标编码的论文。</p><p id="4109" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">虽然有几篇文章解释了回归和二进制分类问题的目标编码，但我的目标是实现多类变量的目标编码。然而，在此之前，我们需要了解它是如何对二进制目标完成的。在本文中，我将概述介绍目标编码的文章，并通过示例展示目标编码如何解决二进制问题。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h2 id="0559" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">该理论</h2><p id="2d93" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">简而言之，这篇论文对分类目标是这样说的:</p><p id="f7bd" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">(如果您希望通过示例来理解，请跳过本节)</p><p id="9867" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">人们可以将一个类别的每一次出现映射到目标属性的概率估计。在分类场景中，数字表示对应于目标的后验概率，由分类属性的值决定。给定分类属性的值，这实际上是目标期望值的数字表示。为了避免由于一个类别中的少量观察值而导致的过度拟合，还应用了均值平滑。</p><p id="e379" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">让我们实际地看待这个问题。在二元问题中，目标不是 0 就是 1。然后，分类变量中的类别的概率估计可以由经验贝叶斯概率 P(Y=1|X=Xi)给出，即</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/63bb9f688809ba59f138bbc2d236c174.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*Fd0b3IzBjvzUq2lh9jLdUg.png"/></div></figure><p id="49af" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">其中，n(TR)是总行数，n(Y)是目标值为 1 的总行数，n(i)是第 I 个类别的行数，n(iY)是第 I 个类别中目标值为 1 的行数。因此，第一项中的分数表示第 I 类中概率为 1，而第二项中的分数表示整体数据中概率为 1。λ是一个给出单调权重的函数，当我们有少量的几个类别时，这很有帮助，随着 n(i)计数从 0 到 1 增加。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/b5a8b3c36562022c5962bfbfd3367739.png" data-original-src="https://miro.medium.com/v2/resize:fit:458/format:webp/1*l-qTVdRgLvcT-e7hskn4vQ.png"/></div></figure><p id="2338" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">如果您使用了 category_encoders 库中的 TargetEncoder，k 是“min_sample_leaf”参数，f 是“smoothing”参数。</p><p id="bfc3" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">引入加权因子是有意义的，因为当样本量很大时，我们应该对上面第一项提供的后验概率估计值给予更多的信任。然而，如果样本量很小，那么我们用从属属性的先验概率(即所有 y 的平均值)给出的零假设来代替概率估计。通过这种转换，丢失的值被当作另一个变量来处理。</p><p id="b6c0" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">本文也将同样的概念推广到多类目标。我们对每一类目标都有一个新的特性。在给定分类属性的值的情况下，每个特征实际上是一类目标的期望值的数字表示。当然，如果目标有非常多的类，输入的数量会显著增加。然而，实际上班级的数量通常很少。请在我的下一篇文章中阅读更多相关内容。</p><p id="07bf" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">在下一节中，我们用一个例子来看看二进制分类的情况。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h2 id="1310" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">一个例子</h2><p id="dfdb" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">让我们看一个二进制目标例子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/64830c1bc5aa360e3a864ea652a4ea00.png" data-original-src="https://miro.medium.com/v2/resize:fit:268/format:webp/1*WB3kb2ccRgV2-jpwJNhZFQ.png"/></div></div></figure><p id="c06c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">如果特征性别的类别是‘男性’，目标为 1 的概率是多少？</p><p id="8571" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">是 1/2=0.5。</p><p id="bff8" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">同样，如果特征性别的类别是‘女性’，目标为 1 的概率是多少？</p><p id="6d71" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">是 1/4=0.25。</p><p id="a33e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">够简单吗？</p><p id="c226" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">等等，现在如果你用 0.25 代替所有出现的“女性”，你就冒了所谓的过度拟合的风险。这是因为你没有考虑到 1 的总概率不是 0.5。是 4/9=0.4。</p><p id="33c1" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">为了说明这一事实，我们使用上一节中显示的公式，给这个“先验”信息添加一个权重。</p><p id="7be3" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">设置 min_sample_leaf，k=1 和平滑，f=1，</p><p id="16d8" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">对于‘男性’，我们有两行，所以 n = 2；</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="c6a0" class="kw kx iq nr b gy nv nw l nx ny">λ(‘Male’)=1/(1+exp(-(2–1)/1))=0.73    # Weight Factor for 'Male'  </span><span id="cb94" class="kw kx iq nr b gy nz nw l nx ny">Target Statistic=(Weight Factor * Probability of 1 for Males)<br/>                  + ((1-Weight Factor) * Probability of 1 Overall)</span><span id="4ec3" class="kw kx iq nr b gy nz nw l nx ny">S(‘Male’)=(0.73 * 0.5) + ((1–0.73) * 0.4) = 0.485</span></pre><p id="fcb6" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">同样，对于‘女性’，我们有四行，所以 n = 4；</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="aa36" class="kw kx iq nr b gy nv nw l nx ny">λ(‘Female’)=1/(1+exp(-(4–1)/1))=0.95    # Weight Factor for 'Female'</span><span id="b339" class="kw kx iq nr b gy nz nw l nx ny">Target Statistic=(Weight Factor * Probability of 1 for Females)<br/>                  + ((1-Weight Factor) * Probability of 1 Overall)</span><span id="ae37" class="kw kx iq nr b gy nz nw l nx ny">S(‘Female’)=(0.95 * 0.25) + ((1–0.95) * 0.4) = 0.259</span></pre><p id="660d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">如果您仔细观察，您可能会注意到λ有助于突出那些行数较多的类别。在我们的例子中，有 4 行性别“女性”，而只有 2 行性别“男性”。相应的权重因子分别为 0.95 和 0.73。</p><p id="0a1a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">因此，用 0.485 替换所有出现的“男性”，用 0.259 替换所有出现的“女性”。“其他”的值可以以类似的方式计算。</p><p id="952e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">恭喜你！您刚刚实现了目标编码。</p><p id="7fc4" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">不信任我？</p><p id="aa6f" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">通过运行下面的代码自己检查一下，它使用您最喜欢的 category_encoders 库做同样的事情:</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="0d5c" class="kw kx iq nr b gy nv nw l nx ny">!pip install category_encoders</span><span id="5042" class="kw kx iq nr b gy nz nw l nx ny">import category_encoders as ce</span><span id="995c" class="kw kx iq nr b gy nz nw l nx ny">x=['Male','Male','Female','Female','Female','Female','Other','Other','Other']</span><span id="445c" class="kw kx iq nr b gy nz nw l nx ny">y=[1,0,0,0,0,1,1,1,0]</span><span id="0863" class="kw kx iq nr b gy nz nw l nx ny">print(ce.TargetEncoder().fit_transform(x,y))</span></pre></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h2 id="fe69" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h2><p id="74dd" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">在本文中，我介绍了 category_encoders 库的 TargetEncoder 类的一个缺点。我解释并总结了介绍目标编码的文章。我通过一个例子解释了如何用数值代替类别。</p><p id="ef19" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">我的下一篇文章将完全集中在我们如何对多类目标做同样的事情。敬请期待！</p><p id="6350" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated"><strong class="lu ir">编辑:</strong>发表下一个，演示实现多类目标编码<a class="ae kv" href="https://medium.com/@mohannishant6/target-encoding-for-multi-class-classification-c9a7bcb1a53" rel="noopener">这里</a>。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="ca8b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">在<a class="ae kv" href="https://www.linkedin.com/in/mohannishant/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上与我联系</p><p id="4c62" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">在<a class="ae kv" href="https://github.com/mohannishant6" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上查看一些我感兴趣的项目</p></div></div>    
</body>
</html>