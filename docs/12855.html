<html>
<head>
<title>Develop and sell a Python API — from start to end tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开发和销售 Python API —从头到尾教程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/develop-and-sell-a-python-api-from-start-to-end-tutorial-9a038e433966?source=collection_archive---------0-----------------------#2020-09-04">https://towardsdatascience.com/develop-and-sell-a-python-api-from-start-to-end-tutorial-9a038e433966?source=collection_archive---------0-----------------------#2020-09-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="45a1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">本文从头到尾描述了开发 Python API 的过程，并在更困难的领域提供了帮助。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/20cd35450c7dd8d17762e12a87303f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ul-AJ0m3BlUg_Zd8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="ky">图片:</em><a class="ae kz" href="https://unsplash.com/photos/LJ9KY8pIH3E" rel="noopener ugc nofollow" target="_blank"><em class="ky"/></a></p></figure><p id="1eaa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">最近看了一篇博文，是关于建立自己的 API 并出售的。</p><p id="4273" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我很受启发，想测试一下是否有效。仅用了 5 天时间，我就能够从头到尾创建一个 API。所以我想我会分享我遇到的问题，详细阐述文章介绍的概念，并提供一个快速的清单来自己构建一些东西。所有这些都是通过开发另一个 API 实现的。</p><h1 id="4e16" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">目录</h1><ul class=""><li id="0d8e" class="mo mp it lc b ld mq lg mr lj ms ln mt lr mu lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#about-this-article" rel="noopener ugc nofollow" target="_blank">关于本文</a></li><li id="5e26" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#disclaimer" rel="noopener ugc nofollow" target="_blank">免责声明</a></li><li id="baa5" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#stack-used" rel="noopener ugc nofollow" target="_blank">使用的堆栈</a></li><li id="5e32" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#1-create-project-formalities" rel="noopener ugc nofollow" target="_blank"> 1。创建项目手续</a></li><li id="ebd2" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#2-create-a-solution-for-a-problem" rel="noopener ugc nofollow" target="_blank"> 2。创建问题的解决方案</a></li><li id="5b74" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#3-deploy-to-aws" rel="noopener ugc nofollow" target="_blank"> 3。部署到 AWS </a></li><li id="692d" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#4-set-up-rapidapi" rel="noopener ugc nofollow" target="_blank"> 4。设置 Rapidapi </a></li><li id="ad33" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#end-result" rel="noopener ugc nofollow" target="_blank">最终结果</a></li><li id="c922" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#inspiration" rel="noopener ugc nofollow" target="_blank">灵感</a></li><li id="db78" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#about" rel="noopener ugc nofollow" target="_blank">关于</a></li></ul><h1 id="0e8b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">关于这篇文章</h1><p id="e8a4" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">这篇文章可以被认为是其他文章的教程和理解(列在我的“灵感”部分)。</p><p id="6983" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">它从头到尾描绘了一幅开发 Python API 的图画，并在更困难的领域提供了帮助，比如 AWS 和 Rapidapi 的设置。</p><p id="4220" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我想这对其他想做同样事情的人会有帮助。我在路上遇到了一些问题，所以我想分享一下我的方法。这也是一个很好的方式来建立副业项目，甚至可能赚一些钱。</p><p id="3637" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如目录所示，它由 4 个主要部分组成，即:</p><ol class=""><li id="2f27" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv nk mw mx my bi translated">设置环境</li><li id="f2a3" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">使用 Python 创建问题解决方案</li><li id="62ac" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">设置 AWS</li><li id="cf4f" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">设置 Rapidapi</li></ol><p id="eb7e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">你会在 Github 上找到我所有的开源代码:</p><ul class=""><li id="1e33" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/pandas_transform_format" rel="noopener ugc nofollow" target="_blank">https://github.com/Createdd/pandas_transform_format</a></li></ul><p id="a29a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您将在 Rapidapi 上找到最终结果:</p><ul class=""><li id="5142" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv mv mw mx my bi translated"><a class="ae kz" href="https://rapidapi.com/Createdd/api/excel-to-other-formats" rel="noopener ugc nofollow" target="_blank">https://rapidapi.com/Createdd/api/excel-to-other-formats</a></li></ul><p id="4ab2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你觉得这篇文章有帮助，请告诉我和/或购买 Rapidapi 上的功能以示支持。</p><h1 id="1a73" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">放弃</h1><p id="b43c" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">我与本文中使用的任何服务都没有关联。</p><p id="2522" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我不认为自己是专家。如果你觉得我错过了重要的步骤或者忽略了什么，可以考虑在评论区指出来或者联系我。此外，始终确保监控您的 AWS 成本，不要为您不知道的事情付费。</p><p id="5fb4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我总是乐于听取建设性的意见以及如何改进。</p><h1 id="17ed" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">使用的堆栈</h1><p id="0f06" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">我们将使用</p><ul class=""><li id="eb12" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv mv mw mx my bi translated">Github(代码托管)，</li><li id="ed1f" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">依赖和环境管理，</li><li id="5717" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">Jupyter 笔记本(代码开发和文档)，</li><li id="656c" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">Python(编程语言)，</li><li id="858f" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">AWS(部署)，</li><li id="79d1" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">Rapidapi(销售市场)</li></ul><h1 id="8871" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">1.创建项目手续</h1><p id="5a2c" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">它总是一样的，但却是必要的。我按照以下步骤来做:</p><ol class=""><li id="3a1c" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv nk mw mx my bi translated">创建本地文件夹<code class="fe nl nm nn no b">mkdir NAME</code></li><li id="01c6" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">用<code class="fe nl nm nn no b">NAME</code>在 Github 上创建一个新的存储库</li><li id="a0cf" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">创造康达环境<code class="fe nl nm nn no b">conda create --name NAME python=3.7</code></li><li id="24b4" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">激活康达环境<code class="fe nl nm nn no b">conda activate PATH_TO_ENVIRONMENT</code></li><li id="f2e6" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">创建 git 回购<code class="fe nl nm nn no b">git init</code></li><li id="951d" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">连接到 Github repo。添加自述文件，提交并</li></ol><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="bbec" class="nt lx it no b gy nu nv l nw nx">git remote add origin URL_TO_GIT_REPO<br/>git push -u origin master</span></pre><p id="d9e7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们有:</p><ul class=""><li id="398a" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv mv mw mx my bi translated">本地文件夹</li><li id="4ff3" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">github 知识库</li><li id="45eb" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">anaconda 虚拟环境</li><li id="067c" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">git 版本控制</li></ul><h1 id="e06b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">2.创建问题的解决方案</h1><p id="4347" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">然后我们需要创造一个解决问题的方法。为了便于演示，我将展示如何将 excel csv 文件转换成其他格式。基本功能将首先在 Jupyter 笔记本上进行编码和测试。</p><ul class=""><li id="a180" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#install-packages" rel="noopener ugc nofollow" target="_blank"> <em class="ny">安装包</em> </a></li><li id="b75e" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#develop-solution-to-problem" rel="noopener ugc nofollow" target="_blank"> <em class="ny">制定解决问题的方案</em> </a></li><li id="b38b" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#download-data" rel="noopener ugc nofollow" target="_blank"> <em class="ny">下载数据</em> </a></li><li id="906b" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#create-functionality" rel="noopener ugc nofollow" target="_blank"> <em class="ny">创建功能</em> </a></li><li id="a41b" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#build-server-to-execute-function-with-rest" rel="noopener ugc nofollow" target="_blank"> <em class="ny">构建服务器执行 REST 功能</em> </a></li></ul><h1 id="62ea" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">安装软件包</h1><p id="5f74" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">安装 jupyter 笔记本和 jupytext:</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="fcbd" class="nt lx it no b gy nu nv l nw nx">pip install notebook jupytext</span></pre><p id="91d2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在<code class="fe nl nm nn no b">.git/hooks/pre-commit</code>中设置一个钩子，用于正确跟踪 git 中的笔记本变化:</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="76ca" class="nt lx it no b gy nu nv l nw nx">touch .git/hooks/pre-commit<br/>code  .git/hooks/pre-commit</span></pre><p id="19e1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">把这个复制到文件里</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="46f3" class="nt lx it no b gy nu nv l nw nx">#!/bin/sh<br/># For every ipynb file in the git index, add a Python representation<br/>jupytext --from ipynb --to py:light --pre-commit</span></pre><p id="d2ef" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">之后让钩子可执行(在 mac 上)</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="e499" class="nt lx it no b gy nu nv l nw nx">chmod +x .git/hooks/pre-commit</span></pre><h1 id="b9c8" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">找到解决问题的方法</h1><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="5286" class="nt lx it no b gy nu nv l nw nx">pip install pandas requests</span></pre><p id="c9ab" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">添加一个<code class="fe nl nm nn no b">.gitignore</code>文件并添加数据文件夹(<code class="fe nl nm nn no b">data/</code>)以不将数据上传到主机。</p><h1 id="3b12" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">下载数据</h1><p id="2468" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">下载一个示例数据集<a class="ae kz" href="https://www.kaggle.com/c/titanic" rel="noopener ugc nofollow" target="_blank"> (titanic dataset) </a>并保存到一个数据文件夹中:</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="8a12" class="nt lx it no b gy nu nv l nw nx">def download(url: str, dest_folder: str):<br/>    if not os.path.exists(dest_folder):<br/>        os.makedirs(dest_folder)</span><span id="44be" class="nt lx it no b gy nz nv l nw nx">    filename = url.split('/')[-1].replace(" ", "_")<br/>    file_path = os.path.join(dest_folder, filename)</span><span id="d10e" class="nt lx it no b gy nz nv l nw nx">    r = requests.get(url, stream=True)<br/>    if r.ok:<br/>        print("saving to", os.path.abspath(file_path))<br/>        with open(file_path, 'wb') as f:<br/>            for chunk in r.iter_content(chunk_size=1024 * 8):<br/>                if chunk:<br/>                    f.write(chunk)<br/>                    f.flush()<br/>                    os.fsync(f.fileno())<br/>    else:<br/>        print("Download failed: status code {}\n{}".format(r.status_code, r.text))<br/></span><span id="7522" class="nt lx it no b gy nz nv l nw nx">url_to_titanic_data = 'https://web.stanford.edu/class/archive/cs/cs109/cs109.1166/stuff/titanic.csv'</span><span id="813f" class="nt lx it no b gy nz nv l nw nx">download(url_to_titanic_data,'./data')</span></pre><h1 id="9ff5" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">创建功能</h1><p id="ca8a" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">转换格式</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="906e" class="nt lx it no b gy nu nv l nw nx">df = pd.read_csv('./data/titanic.csv')<br/>df.to_json(r'./data/titanic.json')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/e24cdd48ff35c6a3ca9889a6985b8f35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cfcXWGG6Uo__Be_4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Jupyter 笔记本中的转换示例</p></figure><h1 id="6776" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">用 REST 构建服务器来执行功能</h1><p id="f69a" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">在 jupyter notebook 中开发了功能后，我们希望在 python 应用程序中实际提供该功能。</p><p id="a800" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">有很多方法可以使用 jupyter 笔记本的某些部分，但是为了简单起见，我们现在重新创建它。</p><p id="c104" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">添加一个<code class="fe nl nm nn no b">app.py</code>文件。</p><p id="6091" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">例如，我们希望用户上传一个 excel 文件并返回转换成 JSON 的文件。</p><p id="6c81" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">浏览互联网，我们可以看到已经有软件包可以处理 flask 和 excel 格式。所以让我们利用它们。</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="d65c" class="nt lx it no b gy nu nv l nw nx">pip install Flask</span></pre><p id="e26c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">启动 Flask 服务器时使用</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="0934" class="nt lx it no b gy nu nv l nw nx">env FLASK_APP=app.py FLASK_ENV=development flask run</span></pre><p id="d431" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Tipp:用<a class="ae kz" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>测试你的后端功能。它很容易设置，并允许我们快速测试后端功能。在“表单-数据”选项卡中上传 excel:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/2f1d16375d0704f6cf728fcf4acb3bb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c1RfdwvkGf1Z1rvQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用邮递员测试后端</p></figure><p id="2395" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这里您可以看到上传的 titanic csv 文件和数据集返回的列名。</p><p id="1dc5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们只需编写将 excel 转换成 json 的函数，如下所示:</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="18f7" class="nt lx it no b gy nu nv l nw nx">import json<br/>import pandas as pd<br/>from flask import Flask, request</span><span id="0ce1" class="nt lx it no b gy nz nv l nw nx">app = Flask(__name__)</span><span id="b62e" class="nt lx it no b gy nz nv l nw nx">@app.route('/get_json', methods=['GET', 'POST'])<br/>def upload_file():<br/>    if request.method == 'POST':<br/>        provided_data = request.files.get('file')<br/>        if provided_data is None:<br/>            return 'Please enter valid excel format ', 400</span><span id="802c" class="nt lx it no b gy nz nv l nw nx">        data = provided_data<br/>        df = pd.read_csv(data)<br/>        transformed = df.to_json()</span><span id="f025" class="nt lx it no b gy nz nv l nw nx">        result = {<br/>            'result': transformed,<br/>        }</span><span id="a6a9" class="nt lx it no b gy nz nv l nw nx">        json.dumps(result)</span><span id="a3fd" class="nt lx it no b gy nz nv l nw nx">        return result<br/></span><span id="42f9" class="nt lx it no b gy nz nv l nw nx">if __name__ == '__main__':<br/>    app.run()</span></pre><p id="2ce8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">(查看我的<a class="ae kz" href="https://github.com/Createdd/pandas_transform_format" rel="noopener ugc nofollow" target="_blank">库</a>中的完整代码。)</p><p id="e2b4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">例如，现在我们有了将 csv 文件转换成 json 的功能。</p><h1 id="05b6" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">3.部署到 AWS</h1><p id="f94d" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">在本地开发之后，我们想把它放到云中。</p><ul class=""><li id="1b70" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#set-up-zappa" rel="noopener ugc nofollow" target="_blank"> <em class="ny">设置 zappa </em> </a></li><li id="f6d4" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#set-up-aws" rel="noopener ugc nofollow" target="_blank"> <em class="ny">设置 AWS </em> </a></li><li id="c049" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#aws-credentials" rel="noopener ugc nofollow" target="_blank"> <em class="ny"> AWS 凭证</em> </a></li><li id="f878" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#set-up-credentials-with-users-and-roles-in-iam" rel="noopener ugc nofollow" target="_blank"> <em class="ny">在 IAM </em> </a>中设置用户和角色的凭证</li><li id="06e8" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#add-credentials-in-your-project" rel="noopener ugc nofollow" target="_blank"> <em class="ny">在项目中添加凭证</em> </a></li><li id="503d" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#aws-api-gateway" rel="noopener ugc nofollow" target="_blank"> <em class="ny"> AWS API 网关</em> </a></li></ul><h1 id="930c" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">设置 zappa</h1><p id="498b" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">在我们本地创建应用程序后，我们需要开始在一个真实的服务器上设置主机。我们将使用<a class="ae kz" href="https://github.com/Miserlou/Zappa" rel="noopener ugc nofollow" target="_blank"> zappa </a>。</p><blockquote class="oc od oe"><p id="cba2" class="la lb ny lc b ld le ju lf lg lh jx li of lk ll lm og lo lp lq oh ls lt lu lv im bi translated"><em class="it"> Zappa 使得在 AWS Lambda + API Gateway 上构建和部署无服务器、事件驱动的 Python 应用程序(包括但不限于 WSGI web apps)变得超级简单。可以把它想象成 Python 应用程序的“无服务器”网络托管。这意味着无限扩展、零停机、零维护，而成本只是您当前部署的一小部分！</em></p></blockquote><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="e7a3" class="nt lx it no b gy nu nv l nw nx">pip install zappa</span></pre><p id="2307" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">由于我们使用的是 conda 环境，我们需要指定它:</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="31bc" class="nt lx it no b gy nu nv l nw nx">which python</span></pre><p id="6ec0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">会给你<code class="fe nl nm nn no b">/Users/XXX/opt/anaconda3/envs/XXXX/bin/python</code>(针对 Mac)</p><p id="ff25" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">移除<code class="fe nl nm nn no b">bin/python/</code>并导出</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="43b0" class="nt lx it no b gy nu nv l nw nx">export VIRTUAL_ENV=/Users/XXXX/opt/anaconda3/envs/XXXXX/</span></pre><p id="5e30" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们能做的</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="f2ec" class="nt lx it no b gy nu nv l nw nx">zappa init</span></pre><p id="1673" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">来设置配置。</p><p id="a878" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">只要点击浏览所有内容，你就会有一个<code class="fe nl nm nn no b">zappa_settings.json</code>的样子</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="b4cd" class="nt lx it no b gy nu nv l nw nx">{<br/>    "dev": {<br/>        "app_function": "app.app",<br/>        "aws_region": "eu-central-1",<br/>        "profile_name": "default",<br/>        "project_name": "pandas-transform-format",<br/>        "runtime": "python3.7",<br/>        "s3_bucket": "zappa-pandas-transform-format"<br/>    }<br/>}</span></pre><p id="2f83" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">请注意，我们还没有准备好部署。首先，我们需要获得一些 AWS 凭证。</p><h1 id="06d7" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">设置 AWS</h1><h1 id="f0e1" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">AWS 凭据</h1><p id="c807" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">首先，你需要得到一个 AWS <code class="fe nl nm nn no b">access key id</code>和<code class="fe nl nm nn no b">access key</code></p><p id="f706" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">你可能认为这很简单:</p><p id="91cc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要获得凭据，您需要</p><ul class=""><li id="68c1" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv mv mw mx my bi translated">转到:<a class="ae kz" href="http://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">http://aws.amazon.com/</a></li><li id="750a" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">注册并创建一个新账户(他们会给你一年试用期或类似的选择)</li><li id="4fc5" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">转到您的 AWS 帐户概述</li><li id="a8b2" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">账户菜单；子菜单:安全凭证</li></ul><p id="0f1a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">但是不，AWS 中的权限更多！</p><h2 id="41e0" class="nt lx it bd ly oi oj dn mc ok ol dp mg lj om on mi ln oo op mk lr oq or mm os bi translated">使用 IAM 中的用户和角色设置凭据</h2><p id="b206" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">我发现 Peter Kazarinoff 的这篇文章非常有帮助。他非常详细地解释了下一部分。我下面的要点方法是一个快速总结，我经常引用他的步骤。如果你被困在某个地方，请查看他的文章了解更多细节。</p><p id="7f85" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我尽可能简单地分解它:</p><ol class=""><li id="d783" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv nk mw mx my bi translated">在 AWS 控制台中，在搜索框中键入 IAM。IAM 是 AWS 用户和权限仪表板。</li><li id="03ee" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">创建一个组</li><li id="6ccd" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">为您的群组命名(例如 zappa_group)</li><li id="5e12" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">为您的小组创建我们自己的特定内联策略</li><li id="0e1c" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">在“权限”选项卡的“内联策略”部分下，选择链接以创建新的内联策略</li><li id="98ac" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">在设置权限屏幕中，单击自定义策略单选按钮，然后单击右侧的“选择”按钮。</li><li id="3df1" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">创建一个用 json 格式编写的定制策略</li><li id="62c4" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">通读并复制此处讨论的一项政策:【https://github.com/Miserlou/Zappa/issues/244<a class="ae kz" href="https://github.com/Miserlou/Zappa/issues/244" rel="noopener ugc nofollow" target="_blank"/></li><li id="de6b" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">向下滚动到“我的自定义策略”查看我的策略的片段。</li><li id="b6e8" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">使用您的 AWS 帐号粘贴和修改 json 后，单击“验证策略”按钮以确保您复制了有效的 json。然后单击“应用策略”按钮，将内联策略附加到该组。</li><li id="0e07" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">创建一个用户并将该用户添加到组中</li><li id="2ddb" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">回到 IAM 控制面板，使用“用户”左侧菜单选项和“添加用户”按钮创建一个新用户。</li><li id="96fb" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">在“添加用户”屏幕中，为新用户命名，并选择编程访问的访问类型。然后点击“下一步:权限”按钮。</li><li id="fdc5" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">在“设置权限”屏幕中，选择您之前在“将用户添加到组”部分创建的组，然后单击“下一步:标记”。</li><li id="6c67" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">标签是可选的。如果需要，添加标签，然后单击“下一步:查看”。</li><li id="303f" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">查看用户详细信息，然后单击“创建用户”</li><li id="568f" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">复制用户的密钥</li><li id="2039" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">先不要关闭 AWS IAM 窗口。在下一步中，您将把这些密钥复制并粘贴到一个文件中。此时，将这些密钥复制并保存到一个安全位置的文本文件中不失为一个好主意。确保不要在版本控制下保存密钥。</li></ol><p id="5804" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我的自定义策略:</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="cfcc" class="nt lx it no b gy nu nv l nw nx">{<br/>  "Version": "2012-10-17",<br/>  "Statement": [<br/>    {<br/>      "Effect": "Allow",<br/>      "Action": [<br/>        "iam:AttachRolePolicy",<br/>        "iam:GetRole",<br/>        "iam:CreateRole",<br/>        "iam:PassRole",<br/>        "iam:PutRolePolicy"<br/>      ],<br/>      "Resource": [<br/>        "arn:aws:iam::XXXXXXXXXXXXXXXX:role/*-ZappaLambdaExecutionRole"<br/>      ]<br/>    },<br/>    {<br/>      "Effect": "Allow",<br/>      "Action": [<br/>        "lambda:CreateFunction",<br/>        "lambda:ListVersionsByFunction",<br/>        "logs:DescribeLogStreams",<br/>        "events:PutRule",<br/>        "lambda:GetFunctionConfiguration",<br/>        "cloudformation:DescribeStackResource",<br/>        "apigateway:DELETE",<br/>        "apigateway:UpdateRestApiPolicy",<br/>        "events:ListRuleNamesByTarget",<br/>        "apigateway:PATCH",<br/>        "events:ListRules",<br/>        "cloudformation:UpdateStack",<br/>        "lambda:DeleteFunction",<br/>        "events:RemoveTargets",<br/>        "logs:FilterLogEvents",<br/>        "apigateway:GET",<br/>        "lambda:GetAlias",<br/>        "events:ListTargetsByRule",<br/>        "cloudformation:ListStackResources",<br/>        "events:DescribeRule",<br/>        "logs:DeleteLogGroup",<br/>        "apigateway:PUT",<br/>        "lambda:InvokeFunction",<br/>        "lambda:GetFunction",<br/>        "lambda:UpdateFunctionConfiguration",<br/>        "cloudformation:DescribeStacks",<br/>        "lambda:UpdateFunctionCode",<br/>        "lambda:DeleteFunctionConcurrency",<br/>        "events:DeleteRule",<br/>        "events:PutTargets",<br/>        "lambda:AddPermission",<br/>        "cloudformation:CreateStack",<br/>        "cloudformation:DeleteStack",<br/>        "apigateway:POST",<br/>        "lambda:RemovePermission",<br/>        "lambda:GetPolicy"<br/>      ],<br/>      "Resource": "*"<br/>    },<br/>    {<br/>      "Effect": "Allow",<br/>      "Action": [<br/>        "s3:ListBucketMultipartUploads",<br/>        "s3:CreateBucket",<br/>        "s3:ListBucket"<br/>      ],<br/>      "Resource": "arn:aws:s3:::zappa-*"<br/>    },<br/>    {<br/>      "Effect": "Allow",<br/>      "Action": [<br/>        "s3:PutObject",<br/>        "s3:GetObject",<br/>        "s3:AbortMultipartUpload",<br/>        "s3:DeleteObject",<br/>        "s3:ListMultipartUploadParts"<br/>      ],<br/>      "Resource": "arn:aws:s3:::zappa-*/*"<br/>    }<br/>  ]<br/>}</span></pre><p id="f098" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">注意:用您的 AWS 帐号替换内嵌政策中的 XXXXXXXXXXX。</p><p id="52ec" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您的 AWS 帐号可以通过点击“支持→”支持中心找到。您的帐号列在左上角的支持中心。上面的 json 是对我有用的。但是，我估计这组安全权限可能太开放了。为了增加安全性，你可以慢慢削减权限，看看 Zappa 是否还在部署。上面的设置是最后对我起作用的。如果你想了解更多关于运行 Zappa 所需的特定 AWS 权限，你可以在 GitHub 上深入讨论:<a class="ae kz" href="https://github.com/Miserlou/Zappa/issues/244" rel="noopener ugc nofollow" target="_blank">https://github.com/Miserlou/Zappa/issues/244</a>。</p><h2 id="f771" class="nt lx it bd ly oi oj dn mc ok ol dp mg lj om on mi ln oo op mk lr oq or mm os bi translated">在项目中添加凭据</h2><p id="20b9" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">使用以下命令在根目录下创建一个<code class="fe nl nm nn no b">.aws/credentials</code>文件夹</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="72ca" class="nt lx it no b gy nu nv l nw nx">mkdir ~/.aws<br/>code ~/.aws/credentials</span></pre><p id="0e71" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">并从 AWS 粘贴您的凭据</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="097b" class="nt lx it no b gy nu nv l nw nx">[dev]<br/>aws_access_key_id = YOUR_KEY<br/>aws_secret_access_key = YOUR_KEY</span></pre><p id="cfa4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">与<code class="fe nl nm nn no b">config</code>相同</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="fe66" class="nt lx it no b gy nu nv l nw nx">code ~/.aws/config</span><span id="7077" class="nt lx it no b gy nz nv l nw nx">[default]<br/>region = YOUR_REGION (eg. eu-central-1)</span></pre><p id="fa3e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">注意，<code class="fe nl nm nn no b">code</code>是用我选择的编辑器 vscode 打开一个文件夹。</p><p id="be59" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">将分配给用户的 AWS 访问密钥 id 和秘密访问密钥保存在文件~/中。AWS/凭据。请注意。aws/ directory 需要在您的主目录中，并且凭据文件没有文件扩展名。</p><p id="03fa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，您可以使用</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="fe6c" class="nt lx it no b gy nu nv l nw nx">zappa deploy dev</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/a055758b4d32298d4048d734ddb24470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ccV5-7lFuTyfwN5t.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 zappa 部署应用程序</p></figure><p id="07b6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">不应该再有任何错误了。但是，如果还有一些，您可以使用以下命令进行调试:</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="9b3d" class="nt lx it no b gy nu nv l nw nx">zappa status<br/>zappa tail</span></pre><p id="b560" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">最常见的错误是与权限相关的(然后检查您的权限策略)或关于不兼容的 python 库。无论哪种方式，zappa 都会为调试提供足够好的错误消息。</p><p id="21d8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您更新您的代码，不要忘记使用</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="5569" class="nt lx it no b gy nu nv l nw nx">zappa update dev</span></pre><h1 id="bf0a" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">AWS API 网关</h1><p id="d47d" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">要在市场上设置 API，我们需要首先用 API-key 限制它的使用，然后在市场平台上设置它。</p><p id="8aff" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我发现 Nagesh Bansal 的这篇文章<a class="ae kz" href="https://medium.com/@bansalnagesh/how-to-sell-your-apis-b4b5c9a273f8" rel="noopener">很有帮助。他非常详细地解释了下一部分。我下面的要点方法是一个快速总结，我经常引用他的步骤。如果你被困在某个地方，请查看他的文章了解更多细节。</a></p><p id="aaf6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我再一次把它分解:</p><ol class=""><li id="8a51" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv nk mw mx my bi translated">转到 AWS 控制台并转到 API 网关</li><li id="fa59" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">点击你的 API</li><li id="2874" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">我们希望创建一个 x-api-key 来限制对 api 的不希望的访问，并且也有一个计量使用</li><li id="66dc" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">为 API 创建一个使用计划，包括所需的限制和配额限制</li><li id="8a8d" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">创建关联的 API 阶段</li><li id="2e23" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">添加 API 密钥</li><li id="ca5b" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">在 API 键概述部分，单击 API 键处的“显示”并复制它</li><li id="8aa9" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">然后将 API 与键相关联，并丢弃所有没有键的请求</li><li id="b986" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">回到 API 概述。在“资源”下，单击“/任意”转到“方法请求”。然后在“设置”中，将“需要 API 密钥”设置为真</li><li id="8d35" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">对“/{proxy+}方法执行相同的操作</li></ol><p id="d130" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">它看起来像这样</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/7dcbc89d23f01fb8364bdddbe327a247.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_2zUQiTDwJI2ubhr.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在 AWS API 网关中设置限制</p></figure><p id="c48a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，您已经限制了对 API 的访问。</p><h1 id="f9ca" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">4.设置 Rapidapi</h1><ul class=""><li id="70eb" class="mo mp it lc b ld mq lg mr lj ms ln mt lr mu lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#create-api-on-rapidapi" rel="noopener ugc nofollow" target="_blank"> <em class="ny">在 Rapidapi </em>上创建 API</a></li><li id="3a6c" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#test-your-own-api" rel="noopener ugc nofollow" target="_blank"> <em class="ny">测试自己的 API </em> </a></li><li id="8291" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#create-private-plan-for-testing" rel="noopener ugc nofollow" target="_blank"> <em class="ny">创建私有测试计划</em> </a></li><li id="0213" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#test-endpoint-with-rapidapi" rel="noopener ugc nofollow" target="_blank"> <em class="ny">用 rapidapi 测试终点</em> </a></li><li id="7c5e" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md#create-code-to-consume-api" rel="noopener ugc nofollow" target="_blank"> <em class="ny">创建代码来消费 API </em> </a></li></ul><h1 id="586b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">在 Rapidapi 上创建 API</h1><ol class=""><li id="e473" class="mo mp it lc b ld mq lg mr lj ms ln mt lr mu lv nk mw mx my bi translated">转到“我的 API”和“添加新 API”</li><li id="e8d1" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">添加名称、描述和类别。请注意，以后不能再更改 API 名称</li><li id="026a" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">在 settings 中，添加您的 AWS API 的 URL(它在您使用 zappa 部署时显示)</li><li id="9d4d" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv nk mw mx my bi translated">在“转换”下的“访问控制”部分，添加您在 AWS 中添加的 API 键</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/85e28d8554c3cbb72749c5f419ecca75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dGVsxkQcTXhhHWYP.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Rapidapi 中的访问控制</p></figure><p id="0fed" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">5.在安全选项卡中，您可以检查一切</p><p id="72bd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">6.然后转到“端点”,通过单击“创建 REST 端点”从 Python 应用程序添加路径</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/7e75f6462ef355d74977b92f61795778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zeYZd13Mwaxgjr0p.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加 REST 端点</p></figure><p id="876d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">7.为您的 API 添加图像</p><p id="199e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">8.制定定价计划。Rapidapi 发表了一篇自己的关于定价选择和策略的文章。正如他们总结的那样，如何定价取决于你的偏好和产品。</p><p id="4688" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">9.我创建了一个免费增值定价计划。这样做的原因是，我想给免费测试它的机会，但增加了定期使用它的价格。此外，我想创建一个计划来支持我的工作。例如:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/5c69f7b4b4725fa15aad73b7b55d4bdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kYUsDuRILtI12cpm.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">制定价格计划</p></figure><p id="591e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">10.创建一些文档和教程。这很容易解释。我们鼓励这样做，因为如果你的 API 被恰当地记录下来，人们会更容易使用它。</p><p id="93cc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">11.最后一步是公开您的 API。但在此之前，亲自测试一下是很有用的。</p><h1 id="24ac" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">测试您自己的 API</h1><h1 id="012e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">创建私人测试计划</h1><p id="b28c" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">设置好一切之后，您当然应该使用提供的代码片段进行测试。这一步并不简单，我必须联系支持人员来理解它。现在我在这里简化一下。</p><p id="7db0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为自己制定一个私人计划，不要设定任何限制。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/73be7ed67a24b7f2b49f875c97ebfec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XBHLtYlQZ0HRJ0Su.png"/></div></div></figure><p id="6293" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">转到 API 的“用户”部分，然后转到“免费计划用户”，选择您自己并“邀请”您加入私人计划。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/d8e120bba2b15f43ab1d0d6bb8bba280.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wXSAfSsErQ9W0zc1.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将您自己加入您的私人计划</p></figure><p id="e4b6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，您已经订阅了自己的私人计划，可以使用提供的代码片段测试功能。</p><h1 id="3b16" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">使用 Rapidapi 测试端点</h1><p id="c3be" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">上传一个示例 excel 文件，然后单击“测试端点”。然后你会得到一个 200 ok 的回复。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/130fcfabca93c3e1a60804d4b0ccb1d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nQHIMaBcXiekV9H0.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在 Rapidapi 中测试端点</p></figure><h1 id="575c" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">创建使用 API 的代码</h1><p id="e0bb" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">现在要使用 API，您可以简单地复制 Rapidapi 提供的代码片段。例如 Python 和请求库:</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="b8e5" class="nt lx it no b gy nu nv l nw nx">import requests</span><span id="25d5" class="nt lx it no b gy nz nv l nw nx">url = "https://excel-to-other-formats.p.rapidapi.com/upload"</span><span id="0ba2" class="nt lx it no b gy nz nv l nw nx">payload = ""<br/>headers = {<br/>    'x-rapidapi-host': "excel-to-other-formats.p.rapidapi.com",<br/>    'x-rapidapi-key': "YOUR_KEY",<br/>    'content-type': "multipart/form-data"<br/>    }</span><span id="4657" class="nt lx it no b gy nz nv l nw nx">response = requests.request("POST", url, data=payload, headers=headers)</span><span id="5521" class="nt lx it no b gy nz nv l nw nx">print(response.text)</span></pre><h1 id="501d" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">最终结果</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/cdf913bfe4e4a7340dd45d37e80e178a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZkIJ5UucSZBCMGCo.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae kz" href="https://rapidapi.com/Createdd/api/excel-to-other-formats" rel="noopener ugc nofollow" target="_blank">https://rapidapi.com/Createdd/api/excel-to-other-formats</a></p></figure><h1 id="b082" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">灵感</h1><p id="f0a9" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">文章<a class="ae kz" rel="noopener" target="_blank" href="/api-as-a-product-how-to-sell-your-work-when-all-you-know-is-a-back-end-bd78b1449119">“作为产品的原料药。如何在你只知道一个后端的情况下销售你的作品？</a></p><blockquote class="oc od oe"><p id="7db8" class="la lb ny lc b ld le ju lf lg lh jx li of lk ll lm og lo lp lq oh ls lt lu lv im bi translated">制作一个解决问题的 API</p><p id="08fe" class="la lb ny lc b ld le ju lf lg lh jx li of lk ll lm og lo lp lq oh ls lt lu lv im bi translated">使用无服务器架构进行部署</p><p id="18f0" class="la lb ny lc b ld le ju lf lg lh jx li of lk ll lm og lo lp lq oh ls lt lu lv im bi translated">通过 API 市场分发</p></blockquote><p id="98ea" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">对于设置一切，我发现 Nagesh Bansal 的文章非常有帮助:</p><ul class=""><li id="b51d" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv mv mw mx my bi translated"><a class="ae kz" href="https://medium.com/@bansalnagesh/how-to-sell-your-apis-b4b5c9a273f8" rel="noopener">https://medium . com/@ bansalnagesh/how-to-sell-your-API-B4 b5 C9 a 273 f 8</a></li><li id="013a" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://medium.com/@bansalnagesh/launch-your-api-on-aws-with-0-upfront-cost-using-zappa-in-10-minutes-eb6d00623842" rel="noopener">https://medium . com/@ bansalnagesh/launch-your-API-on-AWS-with-0-pred-cost-using-zappa-in-10-minutes-eb6d 00623842</a></li></ul><p id="5b16" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">彼得·卡扎林诺夫的这篇文章:<a class="ae kz" href="https://pythonforundergradengineers.com/deploy-serverless-web-app-aws-lambda-zappa.html" rel="noopener ugc nofollow" target="_blank">https://python forundergradengineers . com/deploy-server less-we B- app-AWS-lambda-zappa . html</a></p><p id="9177" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我鼓励你也看看那些文章。</p><p id="adfa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae kz" href="https://github.com/Createdd/Writing/blob/master/2020/articles/pythonApi.md" rel="noopener ugc nofollow" target="_blank">你也可以直接在 Github 上阅读我的文章(为了更好的代码格式)</a></p></div><div class="ab cl ow ox hx oy" role="separator"><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb"/></div><div class="im in io ip iq"><h1 id="b14b" class="lw lx it bd ly lz pd mb mc md pe mf mg jz pf ka mi kc pg kd mk kf ph kg mm mn bi translated">关于</h1><p id="5538" class="pw-post-body-paragraph la lb it lc b ld mq ju lf lg mr jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">丹尼尔是一名企业家、软件开发人员和律师。他曾在各种 IT 公司、税务咨询、管理咨询和奥地利法院工作。</p><p id="4d4a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">他的知识和兴趣目前围绕着编程机器学习应用程序及其所有相关方面。从本质上说，他认为自己是复杂环境的问题解决者，这在他的各种项目中都有所体现。</p><p id="ff64" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您有想法、项目或问题，请不要犹豫与我们联系。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://www.buymeacoffee.com/createdd"><div class="gh gi pi"><img src="../Images/83466a0fecfad25d83533bd8e919086d.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*mW8ks3kpW9KQewTN8fe25w.png"/></div></a><p class="ku kv gj gh gi kw kx bd b be z dk translated">你可以在 https://www.buymeacoffee.com/createdd 支持我</p></figure><div class="pj pk gp gr pl pm"><a href="https://www.createdd.com/" rel="noopener  ugc nofollow" target="_blank"><div class="pn ab fo"><div class="po ab pp cl cj pq"><h2 class="bd iu gy z fp pr fr fs ps fu fw is bi translated">主页</h2><div class="pt l"><h3 class="bd b gy z fp pr fr fs ps fu fw dk translated">关于我丹尼尔是一名企业家，软件开发人员和律师。他曾在各种 IT 公司，税务咨询…</h3></div><div class="pu l"><p class="bd b dl z fp pr fr fs ps fu fw dk translated">www.createdd.com</p></div></div><div class="pv l"><div class="pw l px py pz pv qa ks pm"/></div></div></a></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qb"><img src="../Images/5c56309e7d317e21e90fe8823769b080.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/0*uACesQjpb4lm1QRR"/></div></figure><p id="8cba" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">连接到:</p><ul class=""><li id="cf3a" class="mo mp it lc b ld le lg lh lj nh ln ni lr nj lv mv mw mx my bi translated"><a class="ae kz" href="https://www.linkedin.com/in/createdd" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a></li><li id="0ba6" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://github.com/Createdd" rel="noopener ugc nofollow" target="_blank"> Github </a></li><li id="dffd" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://medium.com/@createdd" rel="noopener">中等</a></li><li id="367e" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://twitter.com/_createdd" rel="noopener ugc nofollow" target="_blank">推特</a></li><li id="0f1f" class="mo mp it lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated"><a class="ae kz" href="https://www.instagram.com/create.dd/" rel="noopener ugc nofollow" target="_blank"> Instagram </a></li></ul></div></div>    
</body>
</html>