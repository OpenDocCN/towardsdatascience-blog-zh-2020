<html>
<head>
<title>How to Augmentate Data Using Keras</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Keras 扩充数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-augmentate-data-using-keras-38d84bd1c80c?source=collection_archive---------18-----------------------#2020-07-21">https://towardsdatascience.com/how-to-augmentate-data-using-keras-38d84bd1c80c?source=collection_archive---------18-----------------------#2020-07-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2051" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Python 和 Keras 进行数据扩充</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2e0aa46b481c770bb151aa37c4b27524.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j-gxThvYNCymNBoK5R7Ztw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">本·斯特恩在<a class="ae ky" href="https://unsplash.com/s/photos/puzzle?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9afd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想要扩充数据或增加训练或验证数据的数量，数据扩充非常有用。例如，如果你有 2000 张图片，你想得到其中的 5000 或 10000 张，那么这将非常有用。</p><p id="32ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但如果你有 5 或 10 张图像，不要指望从数据增强中获得 2000 或 10000 张图像，仍然能够从深度学习模型中获得不错的结果。因为深度学习模型会高度偏向这 5 张或者 10 张图片。</p><blockquote class="lv lw lx"><p id="f88e" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">如果你的图片少于 100 张，我建议你使用传统的机器学习</p></blockquote></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h2 id="3e92" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">使用单幅图像演示数据扩充过程。</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/48095fe98fee4684d5976573832e045f.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*Fkjo06ReZtEjoq3i0UKZ6A.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">test.jpg——图片来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=74050" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/WikiImages-1897/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=74050" rel="noopener ugc nofollow" target="_blank">维基图片</a></p></figure><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="1f7f" class="mj mk it ne b gy ni nj l nk nl">from keras.preprocessing.image import ImageDataGenerator<br/>from skimage import io</span><span id="890f" class="mj mk it ne b gy nm nj l nk nl">datagen = ImageDataGenerator(        <br/>            rotation_range=45,<br/>            width_shift_range=0.2,  <br/>            height_shift_range=0.2,    <br/>            shear_range=0.2,        <br/>            zoom_range=0.2,        <br/>            horizontal_flip=True,         <br/>            fill_mode='constant', cval=125)</span><span id="6fb8" class="mj mk it ne b gy nm nj l nk nl">x = io.imread('test_image/test.jpg')</span><span id="9df1" class="mj mk it ne b gy nm nj l nk nl">x = x.reshape((1, ) + x.shape)<br/>i = 0<br/>for batch in datagen.flow(x, batch_size=16,<br/>                          save_to_dir='augmented',<br/>                          save_prefix='aug',<br/>                          save_format='png'):    <br/>  i += 1    <br/>  if i &gt; 20:        <br/>     break</span></pre><p id="47d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们数据扩充需要的库是 Keras 的<code class="fe nn no np ne b">ImageDataGenerator</code>。为了读取单个图像，我还从<code class="fe nn no np ne b">skimage</code>导入了<code class="fe nn no np ne b">io</code>。首先，我们需要为数据生成器创建一个实例。方法是创建一个名为<code class="fe nn no np ne b">datagen</code>的变量(你可以给它取任何你喜欢的名字)，并用内部参数使它等于<code class="fe nn no np ne b">ImageDataGenerator</code>。</p><p id="94f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np ne b">rotation_range=45</code>表示我想在 0 到 45 度之间随机旋转我的图像。<code class="fe nn no np ne b">width_shift_range=0.2</code>和<code class="fe nn no np ne b">height_shift_range=0.2</code>表示将图像沿 X 轴移动 20%，沿 Y 轴移动 20%。<code class="fe nn no np ne b">shear_range=0.2</code>表示将图像剪切 20%。<code class="fe nn no np ne b">zoom_range</code>表示放大缩小 20%。对于镜面反射，我已经给出了<code class="fe nn no np ne b">horizontal_flip=True</code>。<code class="fe nn no np ne b">ImageDataGenerator</code>最重要的论点是<code class="fe nn no np ne b">fill_mode</code>。当你的图像移动 20%时，会有一些剩余空间。您可以选择几种方法来填充该区域，</p><ul class=""><li id="b9be" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated"><strong class="lb iu">常量</strong>——用黑色填充该区域。您可以通过给<code class="fe nn no np ne b">cval</code>一个值来改变颜色</li><li id="b63c" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><strong class="lb iu">最近的</strong>——用最近的像素填充该区域并拉伸它。</li><li id="bcb7" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><strong class="lb iu">反射</strong>——用图像的反射填充该区域。</li><li id="7884" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><strong class="lb iu">环绕</strong> —通过环绕图像来填充该区域。</li></ul><p id="5455" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用后，<code class="fe nn no np ne b">io.read</code>我们可以读取图像。在读取图像后，您可以看到图像是<code class="fe nn no np ne b">(256, 256, 3)</code>，在对其进行整形后，您可以看到图像是<code class="fe nn no np ne b">(1, 256, 256, 3)</code>，因为当我们进入卷积层时，输入大小通常首先是图像的数量。其次是尺寸，最后是配色方案。</p><p id="f094" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们应用实例<code class="fe nn no np ne b">datagen</code>的方式是使用<code class="fe nn no np ne b">datagen.flow</code>。这里我们使用<code class="fe nn no np ne b">.flow </code>，因为只有一个图像。<code class="fe nn no np ne b">batch_size=16</code>表示正在生成或放大 16 幅图像，并将图像保存在<code class="fe nn no np ne b">augmented</code>文件夹中。由于<code class="fe nn no np ne b">datagen</code>是在一个有限循环中，我们需要使用一个<code class="fe nn no np ne b">for-loop</code>并在它到达 20 张图像时中断它。(类似于<code class="fe nn no np ne b">epochs</code>)</p><p id="ef21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们知道了它是如何工作的，让我们看看不同<code class="fe nn no np ne b">fill_mode</code>的例子，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/b7670132e8c90ecb619a62255ed4d3f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5LxwcUf-GsrtC8IL1liaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">cval=125 的常数</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/c1c4eb78d71ae1207f4c609b2a6596b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f565Cm1XOX9BlM7Hk_J5NA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">最近的</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/6aa4da4d79d803872d0fcbc18fa612eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W9S1emNZFbM4a_awJ8jkqA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示</p></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h2 id="6063" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">使用多幅图像演示数据扩充过程。</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/0a90a6c8db67e41edce6df00d582feb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*hXbNHB_o7TPqkRPkLXsJUw.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">test1.jpg——图片由<a class="ae ky" href="https://pixabay.com/users/janeb13-725943/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1144965" rel="noopener ugc nofollow" target="_blank">提供。欢迎并感谢您的访问！来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1144965" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的ツ </a></p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/48095fe98fee4684d5976573832e045f.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*Fkjo06ReZtEjoq3i0UKZ6A.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">test2.jpg——图片来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=74050" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/WikiImages-1897/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=74050" rel="noopener ugc nofollow" target="_blank">维基图片</a></p></figure><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="6bf0" class="mj mk it ne b gy ni nj l nk nl">from keras.preprocessing.image import ImageDataGenerator<br/>from skimage import io</span><span id="0d7b" class="mj mk it ne b gy nm nj l nk nl">datagen = ImageDataGenerator(        <br/>            rotation_range=45,<br/>            width_shift_range=0.2,  <br/>            height_shift_range=0.2,    <br/>            shear_range=0.2,        <br/>            zoom_range=0.2,        <br/>            horizontal_flip=True,         <br/>            fill_mode='reflect')</span><span id="9afc" class="mj mk it ne b gy nm nj l nk nl">import numpy as np<br/>import os<br/>from PIL import Image</span><span id="3805" class="mj mk it ne b gy nm nj l nk nl">image_directory = 'test_folder/'<br/>SIZE = 128<br/>dataset = []</span><span id="62b6" class="mj mk it ne b gy nm nj l nk nl">my_images = os.listdir(image_directory)<br/>for i, image_name in enumerate(my_images):    <br/>   if (image_name.split('.')[1] == 'jpg'):        <br/>       image = io.imread(image_directory + image_name)        <br/>       image = Image.fromarray(image, 'RGB')        <br/>       image = image.resize((SIZE,SIZE)) <br/>       dataset.append(np.array(image))</span><span id="a205" class="mj mk it ne b gy nm nj l nk nl">x = np.array(dataset)</span><span id="7030" class="mj mk it ne b gy nm nj l nk nl">i = 0<br/>for batch in datagen.flow(x, batch_size=16,<br/>                          save_to_dir='augmented',<br/>                          save_prefix='aug',<br/>                          save_format='png'):    <br/>  i += 1    <br/>  if i &gt; 20:        <br/>     break</span></pre><p id="c0e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我必须定义<code class="fe nn no np ne b">SIZE = 128</code>,因为不管你的图像大小是多少，我们都可以把它调整到一个普通的大小。为了读取所有的图像，我将使用<code class="fe nn no np ne b">for-loop</code>来读取图像。对于每幅图像，我们必须在<code class="fe nn no np ne b">.jpg</code>时将其分割。最后，调整大小的图像将被添加到数组中。我们可以像上面所做的那样做其余的事情。现在我们有了<code class="fe nn no np ne b">test1.jpg</code>和<code class="fe nn no np ne b">test2.jpg</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/9ce100146a9388eb527d7f42950d8865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2mhFGoGkYs_okplkKK-cjA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">输出</p></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h2 id="014c" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">使用多类来演示数据扩充过程。</h2><p id="27d1" class="pw-post-body-paragraph kz la it lb b lc oi ju le lf oj jx lh li ok lk ll lm ol lo lp lq om ls lt lu im bi translated">多类是你在大多数课程中所期望的。现在，我已经将每张图片按照它们的类别进行了分类，因为这就是数据在数据集中的表现方式。使用<code class="fe nn no np ne b">datagen.flow_from_directory</code>将分别读取子文件夹中的图像。举个例子，如果你有猫，狗，车等类。然后将所有这些图像放入相应的文件夹中。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="e0c9" class="mj mk it ne b gy ni nj l nk nl">i = 0<br/>for batch in datagen.flow_from_directory(directory='test_folder/',<br/>                                          batch_size=16,<br/>                                          target_size=(256, 256),   <br/>                                          color_mode="rgb",     <br/>                                          save_to_dir='augmented',   <br/>                                          save_prefix='aug',    <br/>                                          save_format='png'):    <br/>   i += 1    <br/>   if i &gt; 31:        <br/>     break</span></pre></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h2 id="8b72" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">结论</h2><p id="d217" class="pw-post-body-paragraph kz la it lb b lc oi ju le lf oj jx lh li ok lk ll lm ol lo lp lq om ls lt lu im bi translated">文章到此为止。我希望你能学到新的东西。谢谢，注意安全！</p><h2 id="2c33" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">资源</h2><div class="on oo gp gr op oq"><a href="https://www.youtube.com/channel/UC34rW-HtPJulxr5wp2Xa04w" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">Sreeni 为显微镜专家开发的 Python</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">本频道将带您了解学习 Python 编码的整个过程；从基础到高级…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">www.youtube.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ks oq"/></div></div></a></div></div></div>    
</body>
</html>