<html>
<head>
<title>Creating Beautiful Sankey Diagrams with floWeaver</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用floWeaver创建漂亮的桑基图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-beautiful-sankey-diagrams-with-floweaver-dc1f02fe76bc?source=collection_archive---------5-----------------------#2020-02-15">https://towardsdatascience.com/creating-beautiful-sankey-diagrams-with-floweaver-dc1f02fe76bc?source=collection_archive---------5-----------------------#2020-02-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8bc1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用Python升级您的Sankey游戏</h2></div><p id="d0a2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不久前，我写了“<a class="ae le" rel="noopener" target="_blank" href="/the-what-why-and-how-of-sankey-diagrams-430cbd4980b5?source=friends_link&amp;sk=9c367ca35aa2e63ca5166a7ef7426ae8">桑基图</a>的什么、为什么和如何”在探索Matplotlib的Sankey库的过程中，我发现了一个可爱的替代品:floWeaver。如果您正在寻找一个不同风格的Sankey风格的图来记录流程，这个博客就是为您准备的。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/046812937d443eeb2c41fa4ed7bfb2a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GBt5G_fHeLhcQ4CTtQBAsA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">叙利亚难民及其目的地的桑基图(注:性别/年龄数据系捏造)。</p></figure><p id="7602" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">老实说，我希望floWeaver比matplotlib sankey更容易使用。我最终发现它是不同的，而不是更容易/更难。我确实认为默认设置的图表更吸引我，在默认设置中，您必须有一个愿景，并在matplotlib sankey中更有意识地进行设计选择。</p><h1 id="fd30" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">当floWeaver运行良好时</h1><p id="d62c" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">以下是一些您可能选择floWeaver而不是matplotlib sankey的情况:</p><ul class=""><li id="dcad" class="mo mp it kk b kl km ko kp kr mq kv mr kz ms ld mt mu mv mw bi translated">您希望跟踪跨节点的流(例如，标记原始输入源，即使它经过了几个步骤)</li><li id="caee" class="mo mp it kk b kl mx ko my kr mz kv na kz nb ld mt mu mv mw bi translated">您没有连接到箭头和方向端点(例如，指向上或指向下的流)</li><li id="91bb" class="mo mp it kk b kl mx ko my kr mz kv na kz nb ld mt mu mv mw bi translated">你可以接受好看的默认值，不需要对字体大小之类的东西进行太多的控制</li></ul><h1 id="571e" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">安装floWeaver</h1><p id="ce8a" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">在<a class="ae le" href="https://github.com/ricklupton/floweaver" rel="noopener ugc nofollow" target="_blank"> floWeaver GitHub </a>上找到你需要知道的一切。或者这里是给<code class="fe nc nd ne nf b">conda</code>用户的概要:</p><p id="fee0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安装floWeaver本身:</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="f812" class="nk ls it nf b gy nl nm l nn no">conda install -c conda-forge floweaver</span></pre><p id="2942" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安装ipysankeywidget以在Jupyter笔记本中显示sankey图:</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="d45e" class="nk ls it nf b gy nl nm l nn no">conda install -c conda-forge ipysankeywidget</span></pre><p id="a809" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">启用ipywidgets。这可能已经启用，但确认一下也无妨:</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="e683" class="nk ls it nf b gy nl nm l nn no">jupyter nbextension enable --py widgetsnbextension --sys-prefix</span></pre><h1 id="1e62" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">数据格式</h1><p id="d48c" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">看起来<code class="fe nc nd ne nf b">floWeaver</code>需要列/特性“源”、“目标”和“值”。从这里，您可以添加其他特性，使用您想要的任何列名。这些源和目标将成为您的终端节点的一个选项。如果你真的想绘制一个其他的特征作为你的末端节点，那也可以，但是你的末端节点的一个选项仍然应该在“目标”列中(如果我的推断是正确的)</p><p id="bf2c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是我将在下面使用的示例的数据表:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/10c74563efeec017914e755899d56768.png" data-original-src="https://miro.medium.com/v2/resize:fit:460/format:webp/1*vrsHkBprhnyUQ1o1ASOSYg.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">叙利亚难民数据表</p></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/6a0f89313905a79e27cbb401d1aec1cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/format:webp/1*4OP5E16fzW7a_2E5nB_-GA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">扩大的叙利亚难民数据表(捏造的数据)</p></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/ba417b462a79e27cdab17899c431cb65.png" data-original-src="https://miro.medium.com/v2/resize:fit:460/format:webp/1*rItEy35zdciUrQg_Gc6MVg.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">家庭财务数据表</p></figure><h1 id="73c7" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">使用floWeaver</h1><p id="afbc" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">首先，在Rick Lubton 和团队的教程、文档和例子中找到这个和更多。我强烈建议您使用它们(<a class="ae le" href="https://floweaver.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> docs </a>，<a class="ae le" href="https://github.com/ricklupton/floweaver" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>)来进一步调查。</p><h2 id="3f97" class="nk ls it bd lt nr ns dn lx nt nu dp mb kr nv nw md kv nx ny mf kz nz oa mh ob bi translated">制作桑基图</h2><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/6f19e015d00a01659ce54f932e036343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TUpHmBoLVp7npiyfFkK3EQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">简单难民数据集的桑基图。</p></figure><ol class=""><li id="526b" class="mo mp it kk b kl km ko kp kr mq kv mr kz ms ld oc mu mv mw bi translated">从导入和导入数据集开始。这里我们使用上面显示的简单难民数据集。</li></ol><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="4beb" class="nk ls it nf b gy nl nm l nn no">import pandas as pd<br/>from floweaver import *</span><span id="4f56" class="nk ls it nf b gy od nm l nn no">refugees = pd.read_csv('refugees.csv')</span></pre><p id="2c70" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.设置您的节点、顺序、包和分区</p><p id="f323" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">节点是桑基图的聚集点。你的流动将要流入和流出的固定“位置”。在本例中，左侧是叙利亚，右侧是七个目的地。您可以根据需要命名节点组。每个“进程组”将显示为一组垂直排列的节点。注意ProcessGroup接受一个列表作为它的参数，但是在节点名称是否重复方面是灵活的。</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="413b" class="nk ls it nf b gy nl nm l nn no">nodes = {<br/>    'start': ProcessGroup(['Syria']), # one (Syria) at the start <br/>    'end': ProcessGroup(list(refugees['target'])), # 7 at the end<br/>}</span></pre><p id="8ab9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">顺序是您希望节点进程组出现的顺序(从左到右)。请注意，这是一个进程组/节点名称列表:</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="b2df" class="nk ls it nf b gy nl nm l nn no">ordering = [[‘start’], [‘end’]]</span></pre><p id="d6b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">束是您想要显示的一组连接。这使您可以选择删除任何不必要的连接。包应该是floWeaver的列表。捆绑包含连接信息的对象。</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="196d" class="nk ls it nf b gy nl nm l nn no">bundles = [Bundle('start', 'end')]</span></pre><p id="bf68" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">即使您已经定义了节点，我们也需要设置分区，以指示我们希望它们被分割的确切方式。使用<code class="fe nc nd ne nf b">.unique()</code>让我们不必单独列出每个目的地。</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="8fa9" class="nk ls it nf b gy nl nm l nn no">nodes['start'].partition = Partition.Simple('source', ['Syria'])<br/>nodes['end'].partition = Partition.Simple('target', <br/>                                        refugees['target'].unique())</span></pre><p id="4bb4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.创建并显示您的桑基图</p><p id="4765" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用上面的节点、排序和捆绑包创建Sankey:</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="d15d" class="nk ls it nf b gy nl nm l nn no">sdd = SankeyDefinition(nodes, bundles, ordering)</span></pre><p id="443e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要显示桑基，将floWeaver的<code class="fe nc nd ne nf b">weave(<em class="oe">sankey_definition, dataset, measures=’value’, link_width=None, link_color=None, palette=None</em>)</code>与<code class="fe nc nd ne nf b">.to_widget()</code>结合使用，以显示在Jupyter笔记本中。如果要保存图像，请在<code class="fe nc nd ne nf b">.to_widget()</code>后添加<code class="fe nc nd ne nf b">.auto_save_png(<em class="oe">filename</em>)</code>。</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="9a87" class="nk ls it nf b gy nl nm l nn no">weave(sdd, refugees).to_widget().auto_save_png('syria1.png')</span></pre><h2 id="2e38" class="nk ls it bd lt nr ns dn lx nt nu dp mb kr nv nw md kv nx ny mf kz nz oa mh ob bi translated">将较小的功能捆绑到一个组合类别中</h2><p id="3410" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">正如你在上面看到的，我们有一些非常小的流量。除了修改end nodes分区之外，您可以使用与上面相同的代码将它们捆绑在一起。不是列出同一级别上的所有节点，而是为您想要进行的任何分组创建一个(名称，节点列表)元组。</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="d99e" class="nk ls it nf b gy nl nm l nn no">nodes[‘end’].partition = Partition.Simple(‘target’, <br/>                            [‘Turkey’, <br/>                             ‘Lebanon’, <br/>                             ‘Jordan’, <br/>                             ‘Europe’,<br/>                             (‘Other’, [‘Iraq’, ‘Egypt’, ‘USA’])])</span></pre><p id="398c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您需要重新创建Sankey定义并重新编制Sankey:</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="9164" class="nk ls it nf b gy nl nm l nn no">sdd = SankeyDefinition(nodes, bundles, ordering)<br/>weave(sdd, refugees).to_widget().auto_save_png('syria_other.png')</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/efaf5ce64256363cf817ee7793251d89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pdhKxXUm0oUM9ldVrV42oQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">叙利亚难民与伊拉克、埃及和美国捆绑成“其他”的桑基图</p></figure><h2 id="5466" class="nk ls it bd lt nr ns dn lx nt nu dp mb kr nv nw md kv nx ny mf kz nz oa mh ob bi translated">突出显示不同的(非目标)特征</h2><p id="e6a1" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">为了突出显示一个非目标特性，再次调整分区。在这里，我们按地区划分。</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="dc96" class="nk ls it nf b gy nl nm l nn no"># set end partition to region<br/>nodes[‘end’].partition = Partition.Simple(‘region’, <br/>                                       refugees[‘region’].unique())</span><span id="aa72" class="nk ls it nf b gy od nm l nn no"># create SankeyDefintion, display and save image<br/>sdd = SankeyDefinition(nodes, bundles, ordering)<br/>weave(sdd, refugees).to_widget().auto_save_png('syria_region.png')</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/6907caad9832ce54e01f010dcad056a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w9CbboPcWl9JxofX1wdKBg.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">按地区分列的锡兰难民目的地桑基图。</p></figure><h2 id="0037" class="nk ls it bd lt nr ns dn lx nt nu dp mb kr nv nw md kv nx ny mf kz nz oa mh ob bi translated">添加路点(中间步骤)</h2><p id="4396" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">突出流程中不同特征或步骤的另一种方式是通过路点(额外的节点集)。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/8cd21b56b71e5412f02446a43db8c8f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ec0Szg5Znmq2-X5649fS8A.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">按地区和目的地分列的叙利亚难民目的地桑基图。</p></figure><p id="9349" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要添加此路点，我们需要</p><ol class=""><li id="59a8" class="mo mp it kk b kl km ko kp kr mq kv mr kz ms ld oc mu mv mw bi translated">为我们的航点(区域)创建一个新的分区</li><li id="141d" class="mo mp it kk b kl mx ko my kr mz kv na kz nb ld oc mu mv mw bi translated">将航路点添加到我们的节点字典中，提供给<code class="fe nc nd ne nf b">Waypoint</code>新的区域划分</li><li id="b577" class="mo mp it kk b kl mx ko my kr mz kv na kz nb ld oc mu mv mw bi translated">将航点添加到我们的订购列表中(中间)</li><li id="d442" class="mo mp it kk b kl mx ko my kr mz kv na kz nb ld oc mu mv mw bi translated">通过添加waypoints=[ <em class="oe"> node_name </em>作为参数，将航点添加到我们的包中。</li></ol><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="e4b5" class="nk ls it nf b gy nl nm l nn no"># create region partition<br/>region = Partition.Simple('region', refugees['region'].unique())</span><span id="dd31" class="nk ls it nf b gy od nm l nn no"># set the "nodes"<br/>nodes = {<br/>    'start': ProcessGroup(['Syria']),<br/>    'middle': Waypoint(region),<br/>    'end': ProcessGroup(list(refugees['target'].unique())), <br/>}</span><span id="81ad" class="nk ls it nf b gy od nm l nn no"># set the order of the nodes left to right<br/>ordering = [['start'], ['middle'], ['end']]</span><span id="7e1b" class="nk ls it nf b gy od nm l nn no"># set the "bundle" of connections<br/>bundles = [Bundle('start', 'end', waypoints=['middle'])]</span><span id="013f" class="nk ls it nf b gy od nm l nn no"># partition the groups for display<br/>nodes['start'].partition = Partition.Simple('source', ['Syria'])<br/>nodes['end'].partition = Partition.Simple('target', <br/>                                        refugees['target'].unique())</span><span id="e031" class="nk ls it nf b gy od nm l nn no"># set color palette<br/>palette = {'North America': '#ED533B', 'Middle East': '#3CAEA3', <br/>           'Europe': '#F6D55C'}</span><span id="99ef" class="nk ls it nf b gy od nm l nn no"># create sankey with flow_partition<br/>sdd = SankeyDefinition(nodes, bundles, ordering, <br/>                       flow_partition=region)</span><span id="453e" class="nk ls it nf b gy od nm l nn no"># display sankey (with color palette) and save as png<br/>weave(sdd, refugees, palette=palette).to_widget().auto_save_png('syria_waypt.png')</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/c136265b99c2ba80b595a89a9f35392f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KxYrpG9jAO_uYj9ubZ7RNA.png"/></div></figure><h2 id="4440" class="nk ls it bd lt nr ns dn lx nt nu dp mb kr nv nw md kv nx ny mf kz nz oa mh ob bi translated">调整显示功能</h2><p id="dc93" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">要调整颜色，创建一个调色板字典，在SankeyDefinition中添加您想要着色的分区作为“flow_partition”，并将您的调色板添加到<code class="fe nc nd ne nf b">weave()</code>。注意:这段代码使用了上面的节点、包、排序和数据集。</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="20ef" class="nk ls it nf b gy nl nm l nn no"># set color palette<br/>palette = {'North America': '#ED533B', 'Middle East': '#3CAEA3', <br/>           'Europe': '#F6D55C'}</span><span id="4bc1" class="nk ls it nf b gy od nm l nn no"># create sankey with flow_partition for color<br/>sdd = SankeyDefinition(nodes, bundles, ordering, <br/>                       flow_partition=region)</span><span id="6f1c" class="nk ls it nf b gy od nm l nn no"># display sankey (with color palette) and save as png<br/>weave(sdd, refugees, palette=palette) \<br/>     .to_widget().auto_save_png('syria_waypt.png')</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/8cd21b56b71e5412f02446a43db8c8f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ec0Szg5Znmq2-X5649fS8A.png"/></div></figure><p id="8332" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要调整Sankey输出的大小，创建一个大小字典并将其添加为<code class="fe nc nd ne nf b">.to_widget()</code>的参数</p><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="d52a" class="nk ls it nf b gy nl nm l nn no"># image size<br/>size = dict(width=570, height=300)</span><span id="7883" class="nk ls it nf b gy od nm l nn no"># create sankey diagram<br/>weave(sdd, refugees).to_widget(**size).auto_save_png('syria_sm.png')</span></pre></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="da21" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是最后一个例子，一起展示。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/c7fbb871ee48be62f6a32867fce51e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mqyOX8Z8vUXwEv115dQnuA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">假设家庭资金流动的桑基图</p></figure><pre class="lg lh li lj gt ng nf nh ni aw nj bi"><span id="a2b3" class="nk ls it nf b gy nl nm l nn no"># set the nodes<br/>nodes = {<br/>    'start': ProcessGroup(list(household['source'])),<br/>    'category': Waypoint(Partition.Simple('category', <br/>                         household['category'].unique())),<br/>    'end': ProcessGroup(list(household['target'])),<br/>}</span><span id="c04b" class="nk ls it nf b gy od nm l nn no"># set the order of the nodes left to right<br/>ordering = [['start'], <br/>            ['category'],<br/>            ['end']]</span><span id="b62d" class="nk ls it nf b gy od nm l nn no"># set the "bundle" of connections you want to show<br/>bundles = [Bundle('start', 'end', waypoints=['category'])]</span><span id="ef25" class="nk ls it nf b gy od nm l nn no"># add the partitions<br/>partner = Partition.Simple('source', household['source'].unique())<br/>nodes['start'].partition = partner<br/>nodes['end'].partition = Partition.Simple('target', <br/>                         household['target'].unique())</span><span id="3638" class="nk ls it nf b gy od nm l nn no"># add the color palette<br/>palette = {'partner 1': '#027368', 'partner 2': '#58A4B0'}</span><span id="37e7" class="nk ls it nf b gy od nm l nn no"># create the sankey diagram<br/>sdd = SankeyDefinition(nodes, bundles, ordering, <br/>                       flow_partition=partner)</span><span id="84a8" class="nk ls it nf b gy od nm l nn no"># display the sankey diagram<br/>weave(sdd, household, palette=palette).to_widget().auto_save_png('./images/household.png')</span></pre><p id="221b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在上面看到，颜色划分并不总是产生我想要的结果，但是在这一点上，我不确定如何调整它。对我来说，根据航路点给流着色看起来最可爱，但不一定能实现桑基图的目标——别忘了把它放在最前面！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/9f4a45da81010bda8bea48ae65c92c23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HHZ6kBSJCTRxj1i2qTKeFA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">更美观的家用桑基图，但不是很好地显示了乐趣、必需品和拯救每个伙伴的贡献。</p></figure></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="f4b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">和往常一样，请查看<a class="ae le" href="https://github.com/allisonhonold/floweaver_blog" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中的完整代码。编码快乐！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="on oo di op bf oq"><div class="gh gi om"><img src="../Images/9d56096ba69ad03d08649768bdb049de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*en_A2xv-Wa6zC39O"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">叙利亚日落。照片由<a class="ae le" href="https://unsplash.com/@tkassis?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">蒂莫西·卡西斯</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div></div>    
</body>
</html>