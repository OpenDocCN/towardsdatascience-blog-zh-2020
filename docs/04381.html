<html>
<head>
<title>How to create bubble maps in Python with Geospatial data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用地理空间数据在Python中创建气泡图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-bubble-maps-in-python-with-geospatial-data-e51118c3d767?source=collection_archive---------19-----------------------#2020-04-20">https://towardsdatascience.com/how-to-create-bubble-maps-in-python-with-geospatial-data-e51118c3d767?source=collection_archive---------19-----------------------#2020-04-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f469" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">初学者指南和教程。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d655d7a49bea1d0c118fa013d06ffd38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kvbTaVRLk4eW5Xgc"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Marc Sendra Martorell 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="b75d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想过如何用Python和地理空间数据创建气泡图吗？我将向您展示如何轻松地以静态格式和交互式格式制作气泡图。</p><blockquote class="lv"><p id="9bb6" class="lw lx it bd ly lz ma mb mc md me lu dk translated">A <code class="fe mf mg mh mi b">bubble map</code>使用size作为编码变量。圆圈的大小代表一个地理区域的数值。</p></blockquote><figure class="mk ml mm mn mo kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/b8f30a62ebc2eaf26bfd665aed597777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Necl7a_UpZgFzlaszuepQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">气泡图</p></figure><p id="f77b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们经常使用Choropleth地图来显示区域，在这种情况下，我们使用颜色编码。Choropleth地图有一个固有的大面积偏差问题。相比之下，气泡图使用圆形来表示区域或区域的数值。</p><p id="3171" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用Python创建泡泡图看起来很复杂，也有点高级，但事实并非如此。这就像创建带有纬度和经度列的气泡图。让我们首先导入我们需要的库。</p><pre class="kj kk kl km gt mp mi mq mr aw ms bi"><span id="3a8b" class="mt mu it mi b gy mv mw l mx my">import pandas as pd<br/>import numpy as np</span><span id="c2ec" class="mt mu it mi b gy mz mw l mx my">import geopandas as gpd</span><span id="5ba1" class="mt mu it mi b gy mz mw l mx my">import matplotlib.pyplot as plt<br/>import plotly_express as px</span></pre><p id="9539" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用Geopandas读取数据。使用Geopandas，您可以读取大多数地理数据格式，如Shapefile、Geojson、Geo package等..在本例中，我们使用的是瑞典莫尔蒙市的人口数据。</p><pre class="kj kk kl km gt mp mi mq mr aw ms bi"><span id="352c" class="mt mu it mi b gy mv mw l mx my">gdf = gpd.read_file(“data/malmo-pop.shp”)<br/>gdf.head()</span></pre><p id="f56b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是数据集的第一行。对于每个行政单位(Deso ),我们有许多人口细分栏(5岁至80岁及以上)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/a03834fe8efe7d68407e0f01d3a6b76c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ewNS3T8ngo9cbJM1OvaPaQ.png"/></div></div></figure><p id="83bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们通常使用choropleth地图和颜色编码。正如我们将要看到的，我们可以用Geopandas非常容易地创建一个choropleth地图。请注意，我们首先通过细分总人口来标准化数据(年龄80_w)。</p><pre class="kj kk kl km gt mp mi mq mr aw ms bi"><span id="e462" class="mt mu it mi b gy mv mw l mx my">gdf["Age_80_norm"] = (gdf["Age80_w"] / gdf["Total"]) * 100</span><span id="41b8" class="mt mu it mi b gy mz mw l mx my">fig, ax = plt.subplots(figsize=(16,16))<br/>gdf.plot(ax=ax, column="Age_80_norm", cmap="Blues",edgecolor="grey", linewidth=0.4, legend=True)<br/>ax.axis("off")<br/>plt.axis('equal')<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/bb8d6e0cd9629139684243e09791a102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dVw5GZvXdJr3rv77hflfA.png"/></div></div></figure><h2 id="3c86" class="mt mu it bd nc nd ne dn nf ng nh dp ni li nj nk nl lm nm nn no lq np nq nr ns bi translated">气泡图</h2><p id="9d4d" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">或者，我们可以使用气泡图，避免choropleth图的一些缺陷。例如，我们不需要对数据进行归一化，我们可以使用总体细分。但是，我们需要对数据进行一些转换，以便能够创建气泡图。</p><p id="7e42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，我们使用的数据是多边形，如果我们想创建气泡图，我们需要点。然而，这是使用Geopandas的一个简单过程。我们只需要改变几何列，在这种情况下，多边形为点几何。</p><pre class="kj kk kl km gt mp mi mq mr aw ms bi"><span id="4369" class="mt mu it mi b gy mv mw l mx my">gdf_points = gdf.copy()<br/>gdf_points[‘geometry’] = gdf_points[‘geometry’].centroid</span></pre><p id="34bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先将具有面几何的地理数据框架复制到新的地理数据框架中。因为我们希望气泡位于区域的中心，我们可以使用Geopandas中的质心函数来实现这一点。</p><p id="e010" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们有了具有不同几何列的相同地理数据框架，即点几何。让我们绘制一个气泡图，因为我们现在有了点数据集。</p><pre class="kj kk kl km gt mp mi mq mr aw ms bi"><span id="31f3" class="mt mu it mi b gy mv mw l mx my">fig, ax = plt.subplots(figsize=(16,16))<br/>gdf.plot(ax=ax, color=”lightgray”, edgecolor=”grey”, linewidth=0.4)<br/>gdf_points.plot(ax=ax,color=”#07424A”, markersize=”Age80_w”,alpha=0.7, categorical=False, legend=True )</span><span id="19d5" class="mt mu it mi b gy mz mw l mx my">ax.axis(“off”)<br/>plt.axis(‘equal’)<br/>plt.show()</span></pre><p id="c19c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的地图显示了瑞典莫尔蒙一个较小行政区域内80岁及以上人口的气泡图。每个圆圈代表基于80岁及以上人口小计的不同大小。要构建气泡图，您需要为您想要映射的列提供<em class="ny"> markersize </em>，在本例中是Age80_w。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/e16f334d107d1046d704a052d0d6b267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dlrcLqOpM9OMA63r2hwz3A.png"/></div></div></figure><p id="922e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，这是一个静态贴图，气泡贴图的一个常见问题是点圆的重叠。我们可以避免这种情况的一种方法是创建交互式地图，允许用户与感兴趣的区域进行交互和放大。在下一节中，我们将看到如何创建一个交互式气泡图。</p><h2 id="5e55" class="mt mu it bd nc nd ne dn nf ng nh dp ni li nj nk nl lm nm nn no lq np nq nr ns bi translated">交互式气泡地图</h2><p id="2f72" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">有不同的Python库用于绘制交互式气泡图。为了构建一个交互式气泡图，我们使用Plotly Express。我们只需要转换到另一个投影，用Plotly Express显示地图。Plotly Express具有scatter_mapbox()函数，该函数可以获取地理数据框和要用于气泡图的列。</p><pre class="kj kk kl km gt mp mi mq mr aw ms bi"><span id="9d73" class="mt mu it mi b gy mv mw l mx my">gdf_points_4326 = gdf_points.to_crs(“EPSG:4326”)</span><span id="06c7" class="mt mu it mi b gy mz mw l mx my">fig = px.scatter_mapbox(<br/>                        gdf_points_4326, <br/>                        lat=gdf_points_4326.geometry.y, <br/>                        lon=gdf_points_4326.geometry.x, <br/>                        size=”Age80_w”, <br/>                        color=”Total”, <br/>                        hover_name = “Age80_w”,<br/>                  color_continuous_scale=px.colors.colorbrewer.Reds,  <br/>                        size_max=15, <br/>                        zoom=10<br/>                    )<br/>fig.show()</span></pre><p id="7ccd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Plotly Express，我们可以通过创建交互式气泡图来避免气泡图的重叠问题。见下图GIF。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/80ac631b9d559c8d3ef70aae98fead32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*sp0lxgjJLKDMcwf0qeO3IQ.gif"/></div></figure><p id="3d84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">气泡图可以是显示具有不同气泡大小的数值变量的替代图，而不是最常用的choropleth图。如果您有一个带有值(即年龄细分)的区域(即行政区)列表，气泡图可以代替Choropleth图。气泡图没有choropleth图固有的大面积偏差。</p><h2 id="3dbf" class="mt mu it bd nc nd ne dn nf ng nh dp ni li nj nk nl lm nm nn no lq np nq nr ns bi translated">结论</h2><p id="9666" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">在本教程中，我们已经看到了如何使用Python创建静态和交互式气泡图。静态气泡图存在重叠问题。为了避免这种情况，您可以创建允许放大/缩小的交互式地图，或者增加静态地图圆圈的透明度。</p><p id="9419" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程的代码可以在这个Github存储库中找到。</p><div class="ob oc gp gr od oe"><a href="https://github.com/shakasom/esda/blob/master/Bubble%20Maps%20Medium.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">shakasom/esda</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">permalink dissolve GitHub是4000多万开发人员的家园，他们一起工作来托管和审查代码，管理…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">github.com</p></div></div><div class="on l"><div class="oo l op oq or on os ks oe"/></div></div></a></div></div></div>    
</body>
</html>