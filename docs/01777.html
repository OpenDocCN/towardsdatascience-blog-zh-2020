<html>
<head>
<title>Predicting Spotify Track Skips</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测 Spotify 曲目跳过</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-spotify-track-skips-49cf4a48b2a5?source=collection_archive---------23-----------------------#2020-02-18">https://towardsdatascience.com/predicting-spotify-track-skips-49cf4a48b2a5?source=collection_archive---------23-----------------------#2020-02-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8027" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">致力于 Spotify 顺序跳过预测挑战</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/931629c23e98ac4c63f63c08a93d95d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PDqu2PJfoC5DZlCIOOp4fg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">(截图由 Spotify 提供)</p></figure><h1 id="a84c" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">介绍</h1><p id="ea92" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">作为 Metis 数据科学训练营的第三个项目，我做了一个稍微简化的版本的<em class="mj"> Spotify 顺序跳过预测挑战</em>【1】。</p><p id="d48e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我相信你知道，Spotify 是一家流媒体服务公司，其商业模式的核心是向用户提供歌曲推荐，以保持他们使用他们的应用程序。</p><blockquote class="mp mq mr"><p id="665f" class="ln lo mj lp b lq mk jr ls lt ml ju lv ms mm ly lz mt mn mc md mu mo mg mh mi ij bi translated">Spotify 拥有超过<em class="iq">1.9 亿</em>活跃用户，与超过<em class="iq">4000 万</em>首歌曲互动。</p></blockquote><p id="fd09" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">挑战的目标是<em class="mj">预测用户在收听过程中跳过任何一首歌曲的可能性</em>。</p><h1 id="e75e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">方法学</h1><h2 id="23b6" class="mv kw iq bd kx mw mx dn lb my mz dp lf lw na nb lh ma nc nd lj me ne nf ll ng bi translated">数据</h2><p id="893e" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">Spotify 为比赛提供了两套主要信息。一个表有关于用户收听会话的信息。例如:</p><ul class=""><li id="876a" class="nh ni iq lp b lq mk lt ml lw nj ma nk me nl mi nm nn no np bi translated">会话 ID</li><li id="373e" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated">在会话中的位置</li><li id="ad7a" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated">轨道 ID</li><li id="06b0" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated">如果轨道被跳过或没有被跳过</li><li id="ddd7" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated">其他会话元数据</li></ul><p id="e14a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">请注意，用户会话的长度都在 10 到 20 首曲目之间，并且不包括任何关于用户的可识别信息。</p><p id="31cd" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">第二个表包含关于磁道的元数据(对应于会话表中的<code class="fe nv nw nx ny b">track_id</code>功能)，例如:</p><ul class=""><li id="bcd2" class="nh ni iq lp b lq mk lt ml lw nj ma nk me nl mi nm nn no np bi translated">轨道持续时间</li><li id="51eb" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated">追踪在美国的受欢迎程度</li><li id="dc74" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated">发布年份</li></ul><p id="dbc9" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">以及一些额外的功能，由 Spotify 生成，用于描述歌曲，例如:</p><ul class=""><li id="adbb" class="nh ni iq lp b lq mk lt ml lw nj ma nk me nl mi nm nn no np bi translated"><em class="mj">声音度</em></li><li id="deda" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated"><em class="mj">跳动</em>力量<em class="mj">力量</em></li><li id="d31d" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated"><em class="mj">弹性</em></li><li id="463d" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated"><em class="mj">可跳舞性</em></li></ul><p id="3321" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">该数据集还包括每首曲目的一组 8 个“声音矢量”，它们是 Spotify 为每首曲目生成的潜在编码。</p><p id="d202" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">出于许可的原因，Spotify 将曲目信息匿名化，因此没有任何关于曲目名称、艺术家、专辑或流派的数据。</p><p id="136a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">所提供的数据集中的目标(无论是否跳过了音轨)与大约 51.7%被跳过的音轨保持平衡。所以没有必要为了训练而调整班级平衡。</p><p id="1dcd" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">有多余的数据，所以我使用了会话表中大约 100k 行的子集和跟踪表中相应的行，我将它们加载到托管在 AWS EC2 实例上的 Postgres 数据库中。数据库模式如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/b344b699c29614f014483d8ec0988be4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0TKrSOTokxyvAk5TmCXh2A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Spotify 跳过数据的模式</p></figure><p id="2d37" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">为了了解单个会话可能是什么样子，下图显示了单个用户会话的曲线图，因为它与其中一个功能相关，即“音轨响度”，Spotify 对歌曲特征的描述，而不是传统意义上的“音量”，其中颜色指示跳过和未跳过的音轨。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/47eaa3333fd311d7868925c2b9fef1af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zEN0rVldTYr6k9uCQ_w70w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">单个会话的音轨跳过与音轨响度</p></figure><p id="a91c" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">虽然它本身没有意义，但它说明了如何根据歌曲属性绘制每个会话。在这个例子中，随着响度值降低，用户只听了前 11 个音轨中的两个，然后听了所有剩余的 9 个音轨。</p><p id="b58c" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">此外，为了更好地了解整体发行曲目属性，我绘制了一小部分功能的分布，并突出显示了三首不同歌曲在分布中的位置(使用来自 Spotify API 的数据)。这三首来自三个不同流派的歌曲是:</p><ul class=""><li id="d3df" class="nh ni iq lp b lq mk lt ml lw nj ma nk me nl mi nm nn no np bi translated">威利·尼尔森的<a class="ae ob" href="https://open.spotify.com/track/7jWbXvrgdbkajU8L28ahn5?si=SjrUPcJ8T_OZE9SY6qhF7w" rel="noopener ugc nofollow" target="_blank">拦路强盗</a>(国家)</li><li id="ec5f" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated">武堂帮的<a class="ae ob" href="https://open.spotify.com/track/1Sgj10byiGzPpI2IrXSFEn?si=idphDdbRTduLWbG1G84KjQ" rel="noopener ugc nofollow" target="_blank">护丫脖子</a>(嘻哈/R &amp; B)</li><li id="5520" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated">约翰·科尔特兰的《蓝色世界》<a class="ae ob" href="https://open.spotify.com/track/5z8eOnPiOC22EYpniAX3Qg?si=K55hpE-6TjSfgf_6k0zJWA" rel="noopener ugc nofollow" target="_blank"/>(爵士乐)</li></ul><p id="03d9" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">以下是属性“能量”、“响度”、“跳舞度”和“声音度”的属性分布图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/a998d7175cd89b6b7eb10c854fc2d0b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QHqnrORJz3svoFm6EbwiAA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">标绘 3 首歌曲作为参考的音轨特征子集的分布</p></figure><h2 id="c965" class="mv kw iq bd kx mw mx dn lb my mz dp lf lw na nb lh ma nc nd lj me ne nf ll ng bi translated">特征工程</h2><p id="3c4b" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这些数据本质上是有序的。该模型对任何给定歌曲的跳过预测将基于在用户收听会话中较早跳过的歌曲。因此，为了让我的模型考虑到这一点，我添加了一组特征来表示以前音轨的音频特征以及这些音轨是否被跳过。</p><p id="68bb" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><em class="mj">旁注:我还尝试了一种替代方法，在这种方法中，我添加了两组特征，分别对应于被跳过的先前轨道和未被跳过的轨道的平均轨道特征信息，但是发现计算时间更长，添加了两倍的特征，并且没有提高模型性能。</em></p><h2 id="3b4d" class="mv kw iq bd kx mw mx dn lb my mz dp lf lw na nb lh ma nc nd lj me ne nf ll ng bi translated">型号选择</h2><p id="a299" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">根据竞赛指南，目标衡量标准是准确性。</p><p id="23c5" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我开始用逻辑回归模型作为基线，但是发现它的准确性很差。因此，从那以后，我转向了基于树的模型，这种模型不太容易解释，但能够自动处理复杂的功能交互。</p><h1 id="5918" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">结果</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/0687b1c397fe8a60db981ccd6fa7554a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pV2DGPRS8MxLxcBD038zxA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">比较逻辑回归和 LightGBM 模型性能的 ROC 曲线</p></figure><p id="1eab" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我最好的模型的最终测试精度是<strong class="lp ir"> 0.73 </strong>，使用的是 LightGBM 的<code class="fe nv nw nx ny b">LGBMClassifier</code>模型，考虑到问题，这已经相当不错了，但还有改进的空间。</p><p id="f3d3" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">在训练模型之后，我分析了误差，寻找改进模型的地方，但是在残差中没有发现任何明确的趋势。</p><h1 id="c019" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">结论</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/7874b7366154cd2eb8bf028e09c35279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dt1FIuuejuxopjwudDrA5Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最终 LightGBM 模型的相对特征重要性排序</p></figure><p id="6fc9" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">该图显示了最终模型的前 10 个功能的相对重要性排名。该模型将<em class="mj">曲目流行度</em>列为最重要的特征，其次是<em class="mj">曲目持续时间</em>，然后是<em class="mj">上一首曲目的流行度</em>。这个排名似乎总的来说是有意义的，并没有发现什么太令人惊讶的事情，除了可能的事实是<em class="mj">曲目流行度</em>的排名远远高于下一个最重要的功能。然而，有趣的是，这个图(以及在下面的附录中可以看到的完整排名的图)显示，在少数情况下，该模型似乎正在比较当前曲目和先前曲目的特征。一些例子包括<em class="mj">流行度</em>、<em class="mj">持续时间</em>和<em class="mj">响度</em>。</p><p id="a1dd" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">同样，该模型的性能是合理的，与精确度为 0.51 的完全天真的模型(总是预测音轨将被跳过)相比，精确度为 0.73，但仍有很大的改进空间。</p><h1 id="c10f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">未来的工作</h1><p id="a9d2" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">展望未来，需要继续努力的几个领域包括:</p><ul class=""><li id="326e" class="nh ni iq lp b lq mk lt ml lw nj ma nk me nl mi nm nn no np bi translated">添加无监督学习，根据曲目特征对歌曲进行聚类，并可能生成“伪流派”</li><li id="87a8" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated">使用递归神经网络进行预测，这可以更自然地处理<em class="mj">序列</em>轨迹信息</li><li id="0baa" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated">用来自 Spotify API 的更多数据补充数据集(如流派信息)</li><li id="04f1" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated">创建一个 Flask 应用程序，它使用 D3 来可视化模型预测，并允许用户交互式地探索数据集</li></ul><p id="a954" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">感谢阅读，我很想听听你的想法！</p><h1 id="870e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">附录</h1><h2 id="b07c" class="mv kw iq bd kx mw mx dn lb my mz dp lf lw na nb lh ma nc nd lj me ne nf ll ng bi translated">特征子集描述</h2><ul class=""><li id="8116" class="nh ni iq lp b lq lr lt lu lw oe ma of me og mi nm nn no np bi translated"><em class="mj">声音度</em>:音轨有声音的可能性</li><li id="4073" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated"><em class="mj">可跳舞性</em>:描述一个曲目适合跳舞的程度</li><li id="b78d" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated"><em class="mj">能量</em>:轨迹强度的量度</li><li id="d1d4" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated"><em class="mj">价</em>:音轨所传达的“积极”程度</li><li id="4e40" class="nh ni iq lp b lq nq lt nr lw ns ma nt me nu mi nm nn no np bi translated"><em class="mj">语音识别</em>:检测口语单词的存在</li></ul><h2 id="4113" class="mv kw iq bd kx mw mx dn lb my mz dp lf lw na nb lh ma nc nd lj me ne nf ll ng bi translated">全模型特征重要性等级</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/08d01e74742970286b9464afebb01ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEJBWWLOaZIlkZF1MGw9ng.png"/></div></div></figure><h2 id="97ec" class="mv kw iq bd kx mw mx dn lb my mz dp lf lw na nb lh ma nc nd lj me ne nf ll ng bi translated">轨迹"<em class="oi">声矢量"</em>相关矩阵</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/ee3f228b32f44abe31b90d7687252af1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fs1wlUmAy-X509AkHeK0Aw.png"/></div></div></figure><h1 id="3c74" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">引文</h1><p id="498d" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这里有一个挑战网站的链接(这里有更多关于数据集和挑战规则的信息)。</p><p id="d02a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">[1] B. Brost，R. Mehrotra 和 T. Jehan，<a class="ae ob" href="https://arxiv.org/abs/1901.09851" rel="noopener ugc nofollow" target="_blank">音乐流会话数据集</a> (2019)，2019 年网络会议论文集</p></div></div>    
</body>
</html>