<html>
<head>
<title>Prototyping My Video Search Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æˆ‘çš„è§†é¢‘æœç´¢å¼•æ“åŸå‹</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/prototyping-my-video-search-engine-d6fb03c9bcd1?source=collection_archive---------57-----------------------#2020-04-20">https://towardsdatascience.com/prototyping-my-video-search-engine-d6fb03c9bcd1?source=collection_archive---------57-----------------------#2020-04-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="8276" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨<a class="ae ko" rel="noopener" target="_blank" href="/evaluating-the-accuracy-of-my-video-search-engine-1235f375bd5">çš„ä¸Šä¸€ç¯‡æ–‡ç« </a>ä¸­ï¼Œæˆ‘è¯„ä¼°äº†æˆ‘çš„ç‰©ä½“æ¢æµ‹å™¨çš„å‡†ç¡®æ€§ï¼Œå®ƒåœ¨ä¸€åœºè§†é¢‘å½•åˆ¶çš„æ¯”èµ›ä¸­å‘ç°äº†ä¸€ä¸ªä¹’ä¹“çƒã€‚å¹³å‡ç²¾åº¦ä¸º0.57ï¼Œæ¨¡å‹çš„ä¾‹å­åœ¨ä»¥å‰ä»æœªè§è¿‡çš„é•œå¤´ä¸Šæ¨å¹¿å¾—å¾ˆå¥½ï¼Œæˆ‘é¼“èµ·å‹‡æ°”ç»„è£…äº†è¿™ä¸ªåŸå‹:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="25c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ¦‚æ‹¬åœ°è¯´ï¼Œæˆ‘åˆ†äº«äº†è¿™ä¸ªé—®é¢˜å’Œå…³äºèµ°å‘æ•°æ®ç§‘å­¦çš„å»ºè®®<a class="ae ko" rel="noopener" target="_blank" href="/the-video-search-engine-my-journey-into-computer-vision-9789824e76bb"/>:</p><blockquote class="kw kx ky"><p id="6dd1" class="jq jr kz js b jt ju jv jw jx jy jz ka la kc kd ke lb kg kh ki lc kk kl km kn im bi translated">åˆ¶ä½œè§†é¢‘å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯è°æœ‰æ—¶é—´çœ‹å®Œå‘¢ï¼Ÿæˆ‘æå‡ºä¸€ä¸ªè§†é¢‘æœç´¢å¼•æ“æ¥å¯»æ‰¾ç›¸å…³çš„æ—¶åˆ»ã€‚ã€‚ã€‚ã€‚æˆ‘çš„ç›®æ ‡æ˜¯å»ºç«‹ä¸€ä¸ªåŸå‹ï¼Œå®ƒå°†è§†é¢‘è®°å½•ä¹’ä¹“çƒæ¯”èµ›ï¼Œå½“çƒåœ¨æ¯”èµ›æ—¶æå–è§†é¢‘å‰ªè¾‘ï¼Œå¹¶å‘ç”¨æˆ·æ˜¾ç¤ºç›¸å…³å‰ªè¾‘ã€‚</p></blockquote><p id="aabd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†æˆ‘çš„è§†é¢‘æœç´¢å¼•æ“çš„ç«¯åˆ°ç«¯åŸå‹ã€‚</p><h2 id="73eb" class="ld le it bd lf lg lh dn li lj lk dp ll kb lm ln lo kf lp lq lr kj ls lt lu lv bi translated">ç³»ç»Ÿè®¾è®¡</h2><p id="ed13" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">æˆ‘å–œæ¬¢ä»æœ€ç»ˆç»“æœå¼€å§‹ï¼Œç„¶ååå‘å·¥ä½œæ¥è§„åˆ’æ•´ä¸ªç³»ç»Ÿã€‚æˆ‘çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªç®€å•çš„æµè§ˆå™¨ä½“éªŒï¼Œæ’­æ”¾å®Œæ•´é•¿åº¦çš„è§†é¢‘ï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›è§‚çœ‹ç²¾å½©ç‰‡æ®µçš„é€‰é¡¹ã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/9c67be8b23e06eb4bbfa1dd891fb5e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aQ_DM2CI2XHy_DJsaeVPQA.png"/></div></div></figure><p id="f6ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘åˆ¶ä½œäº†ä¸€ä¸ªç³»ç»Ÿå›¾ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥ç†è§£æˆ‘å°†è¦ç¼–ç çš„æ¯ä¸ªç»„ä»¶ã€‚æ€»ä½“è€Œè¨€ï¼Œæˆ‘çš„ç³»ç»ŸåŒ…æ‹¬ä¸‰å¤§è¦ç´ :</p><ol class=""><li id="b9bc" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated">å‡½æ•°è·å–è§†é¢‘æ–‡ä»¶ï¼Œè§£æå®ƒçš„å¸§ï¼Œåœ¨æ¯å¸§ä¸Šè°ƒç”¨æˆ‘çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå¹¶å­˜å‚¨æ¯ä¸ªå‰ªè¾‘çš„ç›¸å…³æ—¶é—´æˆ³ï¼›</li><li id="6217" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">ä¸€ä¸ªå‰ªè¾‘æ—¶é—´æˆ³çš„æ•°æ®åº“ï¼Œå½“ç”¨æˆ·ç‚¹å‡»â€œè§‚çœ‹ç²¾å½©ç‰‡æ®µå·â€æŒ‰é’®æ—¶ï¼Œå¯ä»¥ä»æµè§ˆå™¨è°ƒç”¨è¯¥æ•°æ®åº“ï¼›å’Œ</li><li id="386f" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">æ ¹æ®ç”¨æˆ·è¾“å…¥æ’­æ”¾å…¨é•¿è§†é¢‘æˆ–ç²¾å½©ç‰‡æ®µçš„webä½“éªŒã€‚</li></ol><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mw"><img src="../Images/d5174775c203d6ff7ce3fd04dd19378f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XcJp6eePyMJfxhdLIs3wCg.png"/></div></div></figure><p id="f743" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä»¥ä¸‹éƒ¨åˆ†åŒ…æ‹¬Pythonä»£ç å’Œå¯¹æ¯ä¸ªå…ƒç´ çš„è§£é‡Šã€‚</p><h2 id="95d0" class="ld le it bd lf lg lh dn li lj lk dp ll kb lm ln lo kf lp lq lr kj ls lt lu lv bi translated">1.ç”¨æˆ‘çš„ç‰©ä½“æ£€æµ‹ç®—æ³•å¤„ç†è§†é¢‘</h2><p id="ec86" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">æˆ‘é¦–å…ˆå¯¼å…¥ç›¸å…³çš„åŒ…å¹¶åˆå§‹åŒ–å˜é‡:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="55a4" class="ld le it my b gy nc nd l ne nf">import boto3<br/>import cv2<br/>import datetime<br/>import json<br/>import pytz<br/>from pytz import timezone<br/>import os<br/><br/>dynamodb = boto3.resource('dynamodb', region_name=os.environ["AWS_DEFAULT_REGION"],                          aws_access_key_id=os.environ["AWS_ACCESS_KEY_ID"],<br/>aws_secret_access_key=os.environ["AWS_SECRET_ACCESS_KEY"])</span><span id="c3ff" class="ld le it my b gy ng nd l ne nf">ddb_table = dynamodb.Table("pp-video-clips")</span><span id="6f8b" class="ld le it my b gy ng nd l ne nf">runtime_client = boto3.client('sagemaker-runtime')<br/>endpoint_name = 'pp-ball-detector-endpoint'</span><span id="51a3" class="ld le it my b gy ng nd l ne nf">test_video_file = 'tt-video-1080p.mp4' # from local in example to save time &amp; money<br/>crop_x1 = 710<br/>crop_x2 = crop_x1 + 512<br/>crop_y1 = 183<br/>crop_y2 = crop_y1 + 512<br/>timestamps = [0.0]<br/>detection_threshold = 0.50<br/>lookback_frames = 30<br/>last_n_detections = [0] * lookback_frames<br/>nth_iteration = 0<br/>shouldSaveTimestamp = 0<br/>last_n_shouldSaveTimestamp = [0, 0]<br/>nth_iteration_shouldSaveTimestamp = 0<br/>ith_frame = 0<br/>clip_id = 0<br/>clip_start_time = None<br/>clip_end_time = None</span></pre><p id="7c82" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä½¿ç”¨2018å¹´ç¾å›½å›½å®¶ä¹’ä¹“çƒé”¦æ ‡èµ›è§†é¢‘ä½œä¸º<code class="fe nh ni nj my b">test_video_file</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="21a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ç”¨<a class="ae ko" href="https://pypi.org/project/opencv-python/" rel="noopener ugc nofollow" target="_blank"> CV2 </a>æ‰“å¼€è§†é¢‘æ–‡ä»¶ï¼Œå¹¶æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ª<code class="fe nh ni nj my b">cap</code>å˜é‡ä¸­ã€‚ç„¶åï¼Œæˆ‘å­˜å‚¨è§†é¢‘ä¸­çš„æœ€åä¸€å¸§ï¼Œå› ä¸ºå®ƒå°†å¸®åŠ©æˆ‘å¤„ç†å‰ªè¾‘æ²¡æœ‰å…¶ä»–ç»“æŸæ—¶é—´æˆ³çš„è¾¹ç¼˜æƒ…å†µã€‚(<em class="kz">è¯¦è§ä¸‹ä¸€èŠ‚ã€‚</em>)</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="0dc8" class="ld le it my b gy nc nd l ne nf">cap = cv2.VideoCapture(test_video_file)<br/>cap.set(cv2.CAP_PROP_POS_AVI_RATIO,1) # fast forward to video end<br/>last_frame = cap.get(cv2.CAP_PROP_POS_FRAMES) - 1 # get final frame<br/>cap.set(cv2.CAP_PROP_POS_AVI_RATIO,0) # rewind to beginning</span></pre><p id="1b29" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘åœ¨ä¸€ä¸ª<code class="fe nh ni nj my b">while</code>å¾ªç¯ä¸­å¤„ç†æ¯ä¸ªè§†é¢‘å¸§ã€‚è™½ç„¶æœ‰è®¸å¤šæ‘„åƒæœºè§’åº¦ï¼Œä½†å¤§å¤šæ•°ç›¸å…³å†…å®¹éƒ½å‡ºç°åœ¨æ¡Œé¢å‘¨å›´ã€‚ç”±äºæˆ‘çš„ResNet-50å¯¹è±¡æ£€æµ‹å™¨éœ€è¦ä¸€ä¸ª224 x 224åƒç´ çš„è¾“å…¥å›¾åƒï¼Œå› æ­¤æˆ‘ç®€åŒ–äº†è¿™ä¸ªåŸå‹ï¼Œåœ¨æ¯ä¸€å¸§ä¸­è£å‰ªä¸€ä¸ªå›ºå®šçš„æ­£æ–¹å½¢æ¥æ£€æµ‹æ­£åœ¨è¿åŠ¨çš„çƒã€‚</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="1064" class="ld le it my b gy nc nd l ne nf">while (cap.isOpened()):<br/>    frame_exists, frame = cap.read()<br/>    if frame_exists == False:<br/>        break<br/>    if frame_exists:<br/>        timestamp = cap.get(cv2.CAP_PROP_POS_MSEC)<br/>        crop_frame = frame[crop_y1:crop_y2, crop_x1:crop_x2]</span></pre><p id="4356" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¾‹å¦‚ï¼Œå¤§å¤šæ•°åŒ¹é…éƒ½æ˜¯ä»è¿™ä¸ªæ‘„åƒæœºè§’åº¦å‘ç”Ÿçš„:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nk"><img src="../Images/e46906582aad62913e79a1bc677c953b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4m-GIaO0CH3ikJzCD0DbQQ.png"/></div></div></figure><p id="9b24" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘çš„ä»£ç ä½¿ç”¨å¸¦æœ‰<code class="fe nh ni nj my b">crop_frame = frame[crop_y1:crop_y2, crop_x1:crop_x2]</code>çš„ç»¿è‰²æ–¹å—ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æˆ‘çš„Sagemakeræ¨¡å‹ç«¯ç‚¹:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="203d" class="ld le it my b gy nc nd l ne nf">height = crop_frame.shape[0]<br/>width = crop_frame.shape[1]<br/>success, encoded_frame = cv2.imencode('.png', crop_frame)<br/><br/>response = runtime_client.invoke_endpoint(EndpointName=endpoint_name, ContentType='image/png', Body=encoded_frame.tobytes())</span><span id="1adf" class="ld le it my b gy ng nd l ne nf">result = response['Body'].read().decode('ascii')</span><span id="75c3" class="ld le it my b gy ng nd l ne nf">detections = json.loads(result)</span></pre><p id="0100" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe nh ni nj my b">detections</code>ç»“æœåŒ…æ‹¬æŒ‰ç½®ä¿¡åº¦é™åºæ’åˆ—çš„Næ¬¡æ£€æµ‹ã€‚æˆ‘é€‰æ‹©åˆ—è¡¨ä¸­çš„(ç¬¬ä¸€ä¸ª)æœ€ä½³æ£€æµ‹ï¼Œå› ä¸ºæˆ‘çš„é¢†åŸŸç‰¹å®šçš„åº”ç”¨ç¨‹åºå‡è®¾åœ¨ä»»ä½•ç»™å®šæ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªä¹’ä¹“çƒåœ¨è¿åŠ¨ã€‚æˆ‘è¿˜è·å–æœ€ä½³æ£€æµ‹çš„ç½®ä¿¡åº¦å¾—åˆ†ï¼Œå¹¶è®¡ç®—è¾¹ç•Œæ¡†çš„xï¼Œyåæ ‡:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="d76a" class="ld le it my b gy nc nd l ne nf">best_detection = detections['prediction'][0]<br/>(klass, score, x0, y0, x1, y1) = best_detection<br/>xmin = int(x0 * width)<br/>ymin = int(y0 * height)<br/>xmax = int(x1 * width)<br/>ymax = int(y1 * height)</span></pre><p id="c7ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘é€šè¿‡æ¯”è¾ƒ<code class="fe nh ni nj my b">best_detection</code>å¾—åˆ†å’Œ<code class="fe nh ni nj my b">detection_threshold</code>æ¥ç¡®å®šæ˜¯å¦æ£€æµ‹åˆ°çƒã€‚æˆ‘å°è¯•äº†å„ç§é˜ˆå€¼ï¼Œæˆ‘å‘ç°0.5åˆ°0.7ä¹‹é—´çš„å€¼æ•ˆæœæœ€å¥½ï¼Œå‰ææ˜¯æˆ‘ä»¬ä½¿ç”¨30å¸§çš„ç¼“å†²åŒº(ä¸‹é¢çš„å°†è¯¦ç»†ä»‹ç»<em class="kz">)ã€‚</em></p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="4de7" class="ld le it my b gy nc nd l ne nf">if score &gt; detection_threshold:<br/>    ball_detection = 1<br/>else:<br/>    ball_detection = 0</span></pre><p id="2216" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡é¡ºåˆ©ã€‚æˆ‘ä»¬ç°åœ¨æœ‰äº†è§†é¢‘ä¸­æ¯ä¸€å¸§çš„æ£€æµ‹è¾“å‡ºï¼</p><h2 id="27bf" class="ld le it bd lf lg lh dn li lj lk dp ll kb lm ln lo kf lp lq lr kj ls lt lu lv bi translated">2.å°†å‰ªè¾‘å­˜å‚¨åœ¨æ•°æ®åº“ä¸­</h2><p id="441c" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ã€‚é‰´äºè§†é¢‘å‹ç¼©æ¨¡ç³Šå’Œçƒçš„é«˜é€Ÿåº¦ï¼Œåœ¨<code class="fe nh ni nj my b">frame-n</code>ä¸­ï¼Œçƒæ£€æµ‹å™¨å¯èƒ½ä¼šé”™è¿‡çƒ(å¾—åˆ†åˆšå¥½ä½äºdetection_threshold)ï¼Œåœ¨<code class="fe nh ni nj my b">frame-n+1</code>ä¸­æ‰¾åˆ°çƒï¼Œç„¶ååœ¨<code class="fe nh ni nj my b">frame-n+2</code>ä¸­é”™è¿‡çƒã€‚å¦‚æœæˆ‘ä»¬ä»è¿™ä¸ªä¿¡å·ä¸­åˆ›å»ºè§†é¢‘å‰ªè¾‘ï¼Œå®ƒå°†å¯¼è‡´çŸ­æš‚ã€ä¸è¿è´¯çš„çªå‡ºæ˜¾ç¤ºã€‚è¿™ä¸ªä¿¡å·å¤„ç†é—®é¢˜è¢«ç§°ä¸º<a class="ae ko" href="https://my.eng.utah.edu/~cs5780/debouncing.pdf" rel="noopener ugc nofollow" target="_blank">å»æŠ–</a>ã€‚</p><p id="3495" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªç¼“å†²åŒºæ¥ç¡®å®šæ˜¯åœ¨å½“å‰å¸§è¿˜æ˜¯åœ¨ä¸Šä¸€ä¸ª<code class="fe nh ni nj my b">n-frames</code>ä¸­æ£€æµ‹åˆ°çƒã€‚ç›®æ ‡æ˜¯è·å¾—å˜é‡<code class="fe nh ni nj my b">shouldSaveTimestamp</code>çš„è¾“å‡ºæ¨¡å¼:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nl"><img src="../Images/bb4147ebdceefe97a2589b9136a712ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7eqLQjTvShJxSiKl5OkFwg.png"/></div></div></figure><p id="a80d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™ä¸ªå¸§ç¼“å†²å™¨å…è®¸çƒæ£€æµ‹å™¨å¶å°”å‡ºé”™ï¼Œå¦åˆ™æœ‰ä¸€ä¸ªæ€»çš„è‚¯å®šä¿¡å·è¡¨æ˜æœ‰çƒåœ¨è¿åŠ¨ã€‚</p><p id="a061" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½¿ç”¨<code class="fe nh ni nj my b">shouldSaveTimestamp</code>å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨<code class="fe nh ni nj my b">shouldSaveTimestamp</code>ä»0 â†’ 1æ—¶ä¿å­˜<code class="fe nh ni nj my b">start_timestamp</code>å’Œåœ¨<code class="fe nh ni nj my b">shouldSaveTimestamp</code>ä»1â†’ 0æ—¶ä¿å­˜<code class="fe nh ni nj my b">end_timestamp</code>æ¥è¿›ä¸€æ­¥è¯†åˆ«å‰ªè¾‘ã€‚</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="0870" class="ld le it my b gy nc nd l ne nf"># create n-Frames buffer; feed latest detection back one position<br/>for nth_frame in range(len(last_n_detections)):<br/>    if nth_frame &lt; len(last_n_detections) - 1: # if not the last element, then:<br/>        last_n_detections[nth_frame] = last_n_detections[nth_frame+1]<br/>    else:<br/>        last_n_detections[nth_frame] = ball_detection</span><span id="d203" class="ld le it my b gy ng nd l ne nf"># identify when the ball is in play using the buffer<br/>if (ball_detection &gt; 0 or sum(last_n_detections) &gt; 0 ):<br/>    shouldSaveTimestamp = 1<br/>else:<br/>    shouldSaveTimestamp = 0</span><span id="a960" class="ld le it my b gy ng nd l ne nf"># create a buffer to identify 0-&gt;1 and 1-&gt;0 clip conditions<br/>last_n_shouldSaveTimestamp[0] = last_n_shouldSaveTimestamp[1]<br/>last_n_shouldSaveTimestamp[1] = shouldSaveTimestamp</span><span id="3630" class="ld le it my b gy ng nd l ne nf"># if shouldSaveTimestamp goes from 0 to 1, save "start timestamp"<br/>if last_n_shouldSaveTimestamp[0] == 0 and last_n_shouldSaveTimestamp[1] == 1:<br/>    clip_start_time = timestamp<br/><br/># if shouldSaveTimestamp goes from 1 to 0, save "end timestamp"<br/>if last_n_shouldSaveTimestamp[0] == 1 and last_n_shouldSaveTimestamp[1] == 0:<br/>    clip_end_time = timestamp</span><span id="9f9e" class="ld le it my b gy ng nd l ne nf"># handle some edge cases:<br/>if ith_frame == last_frame and clip_start_time is not None:<br/>    # take the last timestamp as the end time<br/>    clip_end_time = timestamp<br/><br/>if ith_frame == last_frame and clip_start_time is None:<br/>    # take the whole video as a clip :(<br/>    clip_start_time = 0<br/>    clip_start_time = timestamp</span></pre><p id="4da9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœæˆ‘ä»¬æœ‰æœ‰æ•ˆçš„å¼€å§‹å’Œç»“æŸæ—¶é—´æˆ³ï¼Œå‰©ä¸‹çš„å°±æ˜¯åœ¨æ•°æ®åº“ä¸­ä¿å­˜ä¸€ä¸ªå‰ªè¾‘ã€‚æˆ‘é€‰æ‹©DynamoDBæ˜¯å› ä¸ºå®ƒå…·æœ‰æ— æ¨¡å¼çš„è®¾è®¡ï¼Œä»¥åŠä¸å‰ç«¯æ¡†æ¶(å¦‚React)çš„ç®€å•ã€æœ‰æ®å¯æŸ¥çš„è¿æ¥ã€‚</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="28a2" class="ld le it my b gy nc nd l ne nf">if (clip_start_time is not None and clip_end_time is not None):<br/>    # Persist clip to DynamoDB<br/>    clip_start_time = round(clip_start_time/1000, 1)<br/>    clip_end_time = round(clip_end_time/1000, 1)<br/>    ddb_item = {<br/>        'video_filename': str(clip_id),<br/>        'start_end_times': '{},{}'.format(clip_start_time, clip_end_time)<br/>    }<br/>    ddb_table.put_item(Item=ddb_item)<br/>    # reset clip start/end times<br/>    clip_start_time = None<br/>    clip_end_time = None<br/>    clip_id += 1</span><span id="7694" class="ld le it my b gy ng nd l ne nf"># increment the frame counter before looping back to the top<br/>ith_frame += 1</span></pre><p id="3d30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å°±æ˜¯è¿™æ ·ï¼ä¸‹é¢æ˜¯ä»£ç å¤„ç†ä¸€ä¸ªç¤ºä¾‹è§†é¢‘æ—¶æˆ‘çš„æ—¥å¿—è¾“å‡º:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nm"><img src="../Images/ac3637f1231b7937c25c453bd0d1e261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KtR93DnZ21jLEvpMN0ttZQ.png"/></div></div></figure><p id="6a25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶åï¼ŒéªŒè¯æ•°æ®çš„ç”œèœœå–œæ‚¦ä¼ åˆ°äº†DynamoDB:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/5d9dc873557f2bc62c679a863afcc3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*G7Nmeazc0kukc04bv29ntw.png"/></div></figure><p id="ee48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘åº”è¯¥æåˆ°ï¼Œå‡ºäºè¯Šæ–­ç›®çš„ï¼Œæˆ‘åœ¨ä¸»<code class="fe nh ni nj my b">while</code>å¾ªç¯ä¸­æ·»åŠ äº†ä»¥ä¸‹ä»£ç :</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="9765" class="ld le it my b gy nc nd l ne nf">draw_bb_on_frame(ith_frame, crop_frame, score, xmin, ymin, xmax, ymax)</span><span id="c362" class="ld le it my b gy ng nd l ne nf"># where this function is defined earlier:<br/>def draw_bb_on_frame(ith_frame, image, score, x0, y0, x1, y1):<br/>    cv2.rectangle(image, (x0,y0),(x1,y1), (0, 0, 255), 1)<br/>    cv2.putText(image, "Confidence: {:.4f}".format(score), (10, 30),<br/>                cv2.FONT_HERSHEY_SIMPLEX, 0.6, (0, 255, 0), 2)<br/>    if not cv2.imwrite('cv2-test-' + str(ith_frame) + '.jpg', image):<br/>        raise Exception("Could not write image")</span></pre><p id="9b37" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¯¥ä»£ç ç‰‡æ®µåœ¨æ¯ä¸ªè§†é¢‘å¸§ä¸Šç»˜åˆ¶åˆ†æ•°å’Œè¾¹ç•Œæ¡†ã€‚ä¸éœ€è¦æˆ–ä¸å»ºè®®åœ¨æœ€ç»ˆåŸå‹ä¸­åŒ…å«è¿™ä¸€æ­¥éª¤ï¼Œå› ä¸º(1)å®ƒé€šè¿‡ä¸ºæ¯ä¸€å¸§å†™å…¥ä¸€ä¸ªå›¾åƒæ¥é™åˆ¶è¿è¡Œé€Ÿåº¦ï¼Œå¹¶ä¸”(2)äº§ç”Ÿ21ï¼Œ000å¤šä¸ªå›¾åƒ(1.35åƒå…†å­—èŠ‚ï¼)åŒæ—¶å¤„ç†ä¸€ä¸ª12åˆ†é’Ÿçš„è§†é¢‘ã€‚ä½†æ˜¯å½“æˆ‘è°ƒè¯•ç³»ç»Ÿå’Œè°ƒæ•´<code class="fe nh ni nj my b">detection_threshold</code>å€¼æ—¶ï¼Œè¿™ä¸ªå‡½æ•°å¯¹äºè¯Šæ–­å‘ç”Ÿäº†ä»€ä¹ˆéå¸¸æœ‰ç”¨ã€‚</p><h2 id="14e6" class="ld le it bd lf lg lh dn li lj lk dp ll kb lm ln lo kf lp lq lr kj ls lt lu lv bi translated">3.ä¸ºWebæµè§ˆå™¨æ„å»ºç²¾å½©ç‰‡æ®µå·</h2><p id="6b3f" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•åŠ è½½è§†é¢‘ï¼Œå¹¶ä½¿ç”¨è·å–çš„æ—¶é—´æˆ³ä»æµè§ˆå™¨è°ƒç”¨æ•°æ®åº“ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·å•å‡»â€œhighlight reelâ€æŒ‰é’®æ—¶å¯¹å‰ªè¾‘è¿›è¡Œæ’åºå’Œè‡ªåŠ¨æ’­æ”¾ã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/9a314c536cbd9bc9352ff7a459e80bbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9x5r6HIcfr7nazK7PEFZrQ.png"/></div></div></figure><p id="d220" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»ä¸€ä¸ªåŸºæœ¬çš„Reactåº”ç”¨ç¨‹åº<code class="fe nh ni nj my b">npx create-react-app pp-web-ui &amp;&amp; cd pp-web-ui</code>å¼€å§‹ã€‚ç„¶åï¼Œæˆ‘æ·»åŠ ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ã€‚è™½ç„¶æœ‰è®¸å¤šé€‰é¡¹å¯ç”¨ï¼Œä½†æˆ‘è¿˜æ˜¯æ¨è<a class="ae ko" href="https://www.npmjs.com/package/video.js/v/7.0.3" rel="noopener ugc nofollow" target="_blank"> Video.js </a>ï¼Œå› ä¸º:</p><ul class=""><li id="6c90" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn no mo mp mq bi translated">å®ƒæ”¯æŒ<a class="ae ko" href="https://www.w3.org/TR/media-frags/" rel="noopener ugc nofollow" target="_blank">åª’ä½“ç‰‡æ®µåè®®</a>ä½¿ç”¨å¼€å§‹/ç»“æŸæ—¶é—´æˆ³æ ‡è®°å‰ªè¾‘ï¼Œå¹¶ä¸”</li><li id="6937" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn no mo mp mq bi translated">å®ƒæ”¯æŒä¸€ä¸ª<a class="ae ko" href="https://www.npmjs.com/package/videojs-playlist" rel="noopener ugc nofollow" target="_blank">æ’­æ”¾åˆ—è¡¨æ’ä»¶</a>æ¥æ’åºå’Œè‡ªåŠ¨æ’­æ”¾å¤šä¸ªè¿™æ ·çš„å‰ªè¾‘ã€‚</li></ul><p id="e226" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘è¿è¡Œ<code class="fe nh ni nj my b">npm install video.js &amp;&amp; npm install videojs-playlist</code>ï¼Œåœ¨webåº”ç”¨ç¨‹åºä¸­å®ä¾‹åŒ–ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ï¼Œå¹¶åŠ è½½å®Œæ•´çš„è§†é¢‘å‰ªè¾‘ã€‚ä¸ºæ­¤ï¼Œæˆ‘åœ¨Reactåº”ç”¨ç¨‹åºçš„<code class="fe nh ni nj my b">/components</code>ç›®å½•ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°ç»„ä»¶<code class="fe nh ni nj my b">VideoPlayer.js</code>ã€‚</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="82b2" class="ld le it my b gy nc nd l ne nf">import React from 'react';<br/>import videojs from 'video.js'<br/>import 'video.js/dist/video-js.css';<br/>import './VideoContainer.css';</span><span id="f859" class="ld le it my b gy ng nd l ne nf">export default class VideoPlayer extends React.Component {<br/> <br/>  componentDidMount() {<br/>    // instantiate Video.js<br/>    this.player = videojs(this.videoNode, this.props.vidOptions, function onPlayerReady() {<br/>      console.log('onPlayerReady', this)<br/>    });<br/>  }</span><span id="c254" class="ld le it my b gy ng nd l ne nf">// destroy player on unmount<br/>  componentWillUnmount() {<br/>    if (this.player) {<br/>      this.player.dispose()<br/>    }<br/>  }</span><span id="2126" class="ld le it my b gy ng nd l ne nf">  render() {</span><span id="5428" class="ld le it my b gy ng nd l ne nf">let playerStyle = {      <br/>            margin: '10px auto',      <br/>          }</span><span id="d32c" class="ld le it my b gy ng nd l ne nf">return (<br/>      &lt;div&gt; <br/>        &lt;div data-vjs-player&gt;<br/>          &lt;video  ref={ node =&gt; this.videoNode = node } <br/>                  className="video-js"<br/>                  style={playerStyle}<br/>          &gt;        <br/>          &lt;/video&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="7330" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶åï¼Œæˆ‘å°†é‚£ä¸ª<code class="fe nh ni nj my b">VideoPlayer.js</code>ç»„ä»¶æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨ç»„ä»¶ä¸­ï¼Œåœ¨é‚£é‡Œæˆ‘å¤„ç†æ•°æ®åº“é€»è¾‘:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="d5a6" class="ld le it my b gy nc nd l ne nf">import React, { Component } from 'react';<br/>import VideoPlayer from './VideoPlayer';<br/>import './VideoContainer.css';</span><span id="6b80" class="ld le it my b gy ng nd l ne nf">const videoJsOptions = {<br/>          autoplay: true,<br/>          controls: true,<br/>          height: 480, <br/>          sources: [{<br/>                        src: '<a class="ae ko" href="http://localhost:3000/tt-video-1080p.mp4'" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/tt-video-1080p.mp4'</a>,<br/>                        type: 'video/mp4'<br/>                    }]<br/>        }</span><span id="b79f" class="ld le it my b gy ng nd l ne nf">class VideoContainer extends Component {<br/>    constructor(props) {<br/>        super(props);<br/>    }</span><span id="5702" class="ld le it my b gy ng nd l ne nf">componentDidMount(){<br/>        <br/>    }            </span><span id="e99f" class="ld le it my b gy ng nd l ne nf">render() {<br/>         return (<br/>                &lt;div&gt;<br/>                    &lt;VideoPlayer className="center" vidOptions={videoJsOptions} /&gt;;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        )<br/>    }<br/>}</span><span id="e18a" class="ld le it my b gy ng nd l ne nf">export default VideoContainer;</span></pre><p id="b789" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶åï¼Œæˆ‘å°†<code class="fe nh ni nj my b">VideoContainer.js</code>ç»„ä»¶æ·»åŠ åˆ°ä¸»App.jsæ–‡ä»¶ä¸­ï¼Œä»¥åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºè§†é¢‘:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="4325" class="ld le it my b gy nc nd l ne nf">import React from 'react';<br/>import logo from './logo.svg';<br/>import './App.css';<br/>import VideoContainer from './components/VideoContainer';<br/>import 'bootstrap/dist/css/bootstrap.min.css';</span><span id="a08e" class="ld le it my b gy ng nd l ne nf">function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;VideoContainer /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="c4cf" class="ld le it my b gy ng nd l ne nf">export default App;</span></pre><p id="d99c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç®€å•â€”â€”æºè§†é¢‘ç°åœ¨å¯ä»¥åœ¨ç½‘ç»œæµè§ˆå™¨ä¸Šæ’­æ”¾äº†ï¼å¦å¤–ï¼Œä¸Šé¢çš„ä¸‰ä¸ªç»„ä»¶ä»£è¡¨äº†å‰ç«¯ä½“éªŒçš„æ•´ä¸ªæ¡†æ¶ã€‚åœ¨ä¸‹é¢çš„å‰©ä½™éƒ¨åˆ†ä¸­ï¼Œæˆ‘æ›´æ–°äº†<code class="fe nh ni nj my b">VideoPlayer.js</code>å’Œ<code class="fe nh ni nj my b">VideoContainer.js</code>æ¥è·å–æ—¶é—´æˆ³ï¼Œå¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œå¹¶åœ¨ç”¨æˆ·å•å‡»â€œhighlight reelâ€æŒ‰é’®æ—¶è‡ªåŠ¨æ’­æ”¾å‰ªè¾‘ã€‚</p><h2 id="14d7" class="ld le it bd lf lg lh dn li lj lk dp ll kb lm ln lo kf lp lq lr kj ls lt lu lv bi translated">ä»DynamoDBè·å–æ—¶é—´æˆ³onClick</h2><p id="73bf" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘æ·»åŠ äº†<a class="ae ko" href="https://www.npmjs.com/package/aws-sdk" rel="noopener ugc nofollow" target="_blank"> AWS-SDKåŒ…</a>å¹¶è°ƒç”¨DynamoDBçš„<code class="fe nh ni nj my b">.scan</code>å‡½æ•°æ¥è·å–æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ—¶é—´æˆ³ã€‚</p><p id="8cf2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é¦–å…ˆï¼Œæˆ‘æ‰§è¡Œ<code class="fe nh ni nj my b">npm install aws-sdk</code>ï¼Œå¯¼å…¥åŒ…ï¼Œå¹¶åˆå§‹åŒ–<code class="fe nh ni nj my b">VideoConainer.js</code>ä¸­çš„å˜é‡:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="5e60" class="ld le it my b gy nc nd l ne nf">import * as AWS from 'aws-sdk';</span><span id="7cd9" class="ld le it my b gy ng nd l ne nf">AWS.config.update({<br/>  region: 'us-east-1',<br/>  endpoint: 'dynamodb.us-east-1.amazonaws.com',<br/>  accessKeyId: 'USE-YOUR-OWN',<br/>  secretAccessKey: 'USE-YOUR-OWN'<br/>});</span></pre><p id="2b8d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ³¨æ„:æˆ‘åœ¨è¿™ä¸ªä¾‹å­ä¸­ç¡¬ç¼–ç äº†DynamoDBå‡­è¯ï¼Œåªæ˜¯å‡ºäºæ•™å­¦ç›®çš„ã€‚<code class="fe nh ni nj my b">accessKeyId</code>å’Œ<code class="fe nh ni nj my b">secretAccessKey</code> <a class="ae ko" href="https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/setting-credentials.html" rel="noopener ugc nofollow" target="_blank">ä¸åº”è¯¥ç¡¬ç¼–ç </a>åœ¨åº”ç”¨ç¨‹åºæˆ–æµè§ˆå™¨è„šæœ¬ä¸­ã€‚</p><p id="73ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘æ›´æ–°<code class="fe nh ni nj my b">componentDidMount</code>æ¥åˆå§‹åŒ–DynamoDB:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="f3dd" class="ld le it my b gy nc nd l ne nf">componentDidMount(){<br/>        this.dynamodb = new AWS.DynamoDB();<br/>        this.docClient = new AWS.DynamoDB.DocumentClient();<br/>        <br/>    }</span></pre><p id="80db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶åï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ªclick handlerå‡½æ•°ï¼Œå®ƒä»DynamoDBè·å–æ—¶é—´æˆ³ï¼ŒæŒ‰ç…§å‰ªè¾‘IDçš„å‡åºå¯¹å‰ªè¾‘è¿›è¡Œæ’åº(åœ¨æˆ‘çš„ä»£ç ä¸­ç§°ä¸º<code class="fe nh ni nj my b">video_filename</code>ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª<code class="fe nh ni nj my b">videojs-playlist</code>æ’ä»¶æ‰€æœŸæœ›çš„<code class="fe nh ni nj my b">sources</code>æ•°ç»„:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="0ec1" class="ld le it my b gy nc nd l ne nf">onClickHandler(){<br/>        var params = {<br/>          TableName: 'pp-video-clips',<br/>         };</span><span id="c3eb" class="ld le it my b gy ng nd l ne nf">this.dynamodb.scan(params, (error, result) =&gt; {<br/>            if (error) {<br/>                console.log(error);<br/>            }</span><span id="2735" class="ld le it my b gy ng nd l ne nf">                const allVideosObjects = result.Items</span><span id="9b10" class="ld le it my b gy ng nd l ne nf">                const sortedVidObj = allVideosObjects.sort((a, b) =&gt; (a.video_filename.S &gt; b.video_filename.S) ? 1 : -1)</span><span id="cfcf" class="ld le it my b gy ng nd l ne nf">               const videosObjects = sortedVidObj.map(item =&gt; { return {<br/>                    sources: [{<br/>                         src: '<a class="ae ko" href="http://localhost:3000/tt-video-1080p.mp4#t='+item.start_end_times.S" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/tt-video-1080p.mp4#t='+item.start_end_times.S</a>,<br/>                        type: 'video/mp4'<br/>                    }]<br/>                }      <br/>            })<br/>            <br/>            this.setState(videosObjects);<br/>        })            <br/>    }</span></pre><p id="d5f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‚¨ä¼šæ³¨æ„åˆ°<code class="fe nh ni nj my b">src</code>é”®/å€¼å¯¹åŒ…æ‹¬è¿™ä¸ªç‰¹æ®Šçš„æ ‡è®°<code class="fe nh ni nj my b">#t='item.start_end_times.S'</code>ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªåª’ä½“ç‰‡æ®µã€‚è¿™å‘Šè¯‰è§†é¢‘æ’­æ”¾å™¨åªæ’­æ”¾æ¥è‡ª<code class="fe nh ni nj my b">time = {start_time},{end_time}</code>çš„ä¸€ä¸ªç‰‡æ®µï¼Œç„¶åæš‚åœã€‚</p><p id="ae38" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶åï¼Œæˆ‘æ›´æ–°äº†<code class="fe nh ni nj my b">VideoContainer.js</code>ç»„ä»¶çš„<code class="fe nh ni nj my b">render()</code>å—ï¼Œä»¥(1)è·å–çŠ¶æ€å˜é‡(åœ¨é‚£é‡Œæˆ‘å­˜å‚¨äº†<code class="fe nh ni nj my b">sources</code>çš„æ•°ç»„)ï¼Œ(2)æ ¹æ®è§†é¢‘æ’­æ”¾å™¨åº”è¯¥æ’­æ”¾å®Œæ•´é•¿åº¦çš„å‰ªè¾‘è¿˜æ˜¯é«˜äº®å‰ªè¾‘çš„æ•°ç»„ï¼Œæœ‰æ¡ä»¶åœ°å‘ˆç°è§†é¢‘æ’­æ”¾å™¨ï¼Œä»¥åŠ(3)å¦‚æœå•å‡»äº†â€œè§‚çœ‹é«˜äº®å·â€æŒ‰é’®ï¼Œåˆ™è°ƒç”¨onClickHandlerå‡½æ•°:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="0067" class="ld le it my b gy nc nd l ne nf">render() {        <br/>        let videosObjects = this.state; <br/>        var videoSourcesArray = Object.values(videosObjects);</span><span id="9f48" class="ld le it my b gy ng nd l ne nf">let videoBlock;<br/>        if (videoSourcesArray &amp;&amp; videoSourcesArray.length) {<br/>          videoBlock = &lt;VideoPlayer className="center" vidOptions={videoJsOptions} vidSources = {videoSourcesArray} /&gt;;<br/>        } else {<br/>          videoBlock = &lt;VideoPlayer className="center" vidOptions={videoJsOptions}/&gt;;<br/>        }</span><span id="8545" class="ld le it my b gy ng nd l ne nf">return (<br/>            &lt;div&gt;<br/>                &lt;h2 className="center big"&gt;Rod's Video Search Engine&lt;/h2&gt;<br/>                &lt;div className="pad20"&gt;<br/>                    &lt;button className="btn_reel" onClick={() =&gt; { this.onClickHandler() }}&gt;<br/>                        Watch Highlight Reel<br/>                    &lt;/button&gt;<br/>                &lt;/div&gt;<br/>                &lt;div&gt;<br/>                    {videoBlock}<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        )<br/>    }</span></pre><h2 id="7ff8" class="ld le it bd lf lg lh dn li lj lk dp ll kb lm ln lo kf lp lq lr kj ls lt lu lv bi translated">ä½¿ç”¨Video.jsæ’­æ”¾åˆ—è¡¨è‡ªåŠ¨æ’­æ”¾å‰ªè¾‘</h2><p id="097c" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘å°†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨Video.jsæ’­æ”¾åˆ—è¡¨æ¥è‡ªåŠ¨æ’­æ”¾å‰ªè¾‘ã€‚</p><p id="9aa6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é¦–å…ˆï¼Œæˆ‘å¯¼å…¥åŒ…å¹¶åœ¨<code class="fe nh ni nj my b">VideoPlayer.js</code>ä¸­æ³¨å†Œæ’ä»¶:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="8221" class="ld le it my b gy nc nd l ne nf">import videojsPlaylistPlugin from 'videojs-playlist';<br/>videojs.registerPlugin('playlist', videojsPlaylistPlugin);</span></pre><p id="6b9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶åæˆ‘ä¿®æ”¹<code class="fe nh ni nj my b">componentDidUpdate</code>æ¥æ¥æ”¶æ¥è‡ªDynamoDBçš„è§†é¢‘æºæ•°ç»„ï¼Œå¹¶å¼€å§‹è‡ªåŠ¨æ’­æ”¾å‰ªè¾‘ï¼Œæ¯ä¸ªå‰ªè¾‘ä¹‹é—´é—´éš”0ç§’:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="ef1f" class="ld le it my b gy nc nd l ne nf">componentDidUpdate() {<br/>     this.player.playlist(this.props.vidSources);<br/>     this.player.playlist.autoadvance(0);    <br/>  }</span></pre><p id="24f9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸€ä¸ªæŒ‘æˆ˜æ˜¯åª’ä½“ç‰‡æ®µåœ¨æ¯ä¸ªå‰ªè¾‘çš„ç»“å°¾â€œæš‚åœâ€è§†é¢‘ï¼Œè€Œä¸æ˜¯ä½¿ç”¨â€œç»“æŸâ€äº‹ä»¶ã€‚å› æ­¤ï¼Œä¸ºäº†è®©æ’­æ”¾åˆ—è¡¨å‰è¿›åˆ°ä¸‹ä¸€ä¸ªè§†é¢‘å‰ªè¾‘ï¼Œæˆ‘å¿…é¡»åˆ›å»ºä¸€ä¸ª<code class="fe nh ni nj my b">onPause</code>å¤„ç†ç¨‹åº:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="af3a" class="ld le it my b gy nc nd l ne nf">onPause(){<br/>    if(this.props.vidSources &amp;&amp; this.props.vidSources.length &gt; 0) {<br/>      this.player.playlist.next();<br/>    }<br/>  }</span></pre><p id="c61b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªç¼ºç‚¹/ä¼˜ç‚¹æ˜¯ç‚¹å‡»è§†é¢‘ç®—ä½œä¸€ä¸ª<code class="fe nh ni nj my b">onPause</code>äº‹ä»¶ï¼Œå®ƒä¼šè‡ªåŠ¨å¿«è¿›åˆ°ä¸‹ä¸€ä¸ªå‰ªè¾‘ã€‚è®©æˆ‘ä»¬æŠŠå®ƒè®°ä¸ºä¸€ä¸ª<em class="kz">ç‰¹æ€§ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªbug </em>ğŸ˜‰</p><p id="7a05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æœ€åï¼Œæˆ‘æ›´æ–°äº†<code class="fe nh ni nj my b">render()</code>å—ä¸­çš„<code class="fe nh ni nj my b">return</code>è¯­å¥æ¥ç›‘å¬<code class="fe nh ni nj my b">onPause</code>äº‹ä»¶ï¼Œè¯¥äº‹ä»¶è°ƒç”¨<code class="fe nh ni nj my b">onPause</code>å¤„ç†å‡½æ•°:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="b20e" class="ld le it my b gy nc nd l ne nf">return (<br/>      &lt;div&gt; <br/>        &lt;div data-vjs-player&gt;<br/>          &lt;video  ref={ node =&gt; this.videoNode = node } <br/>                  className="video-js"<br/>                  style={playerStyle}<br/>                  onPause={() =&gt; { this.onPause() }}<br/>          &gt;        <br/>          &lt;/video&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>    )</span></pre><p id="539b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è½¬çœ¼é—´ã€‚å®Œæ•´é•¿åº¦çš„è§†é¢‘åœ¨åŠ è½½ç½‘ç»œåº”ç”¨ç¨‹åºæ—¶æ’­æ”¾ï¼Œå½“ç”¨æˆ·ç‚¹å‡»â€œè§‚çœ‹ç²¾å½©ç‰‡æ®µå·â€æŒ‰é’®æ—¶ï¼Œ<em class="kz">çƒåœ¨å‰ªè¾‘å¸§</em>è§†é¢‘å‰ªè¾‘è‡ªåŠ¨æ’­æ”¾ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´è§†é¢‘(å·¦)å’Œé«˜äº®æ˜¾ç¤ºçš„è§†é¢‘ç‰‡æ®µ(å³)çš„å¯¹æ¯”:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="c6f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘åº”è¯¥æ”¹è¿›ä¸€äº›ä¸œè¥¿:</p><ul class=""><li id="e69e" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn no mo mp mq bi translated">è¿™äº›å‰ªè¾‘å¹¶ä¸å®Œç¾ï¼Œæœ‰æ—¶è¿™ä¸ªåŸå‹åœ¨ä¸åˆ°2ç§’çš„æ—¶é—´å†…å°±èƒ½å‰ªè¾‘å¥½ä¸€ä¸ªå‰ªè¾‘ã€‚æˆ‘åº”è¯¥è€ƒè™‘ä¸€ä¸ªæ›´é•¿çš„å¸§ç¼“å†²åŒºæ¥é˜²æ­¢è¿™ç§æƒ…å†µã€‚</li><li id="2baa" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn no mo mp mq bi translated">æˆ‘ç”¨<code class="fe nh ni nj my b">clip_id</code>çš„<code class="fe nh ni nj my b">string</code>è€Œä¸æ˜¯<code class="fe nh ni nj my b">integer</code>åˆ›å»ºäº†DynamoDBè¡¨ï¼Œå› æ­¤å¯¹å‰ªè¾‘çš„æ’åºæ˜¯ä¸æ­£ç¡®çš„(ä¾‹å¦‚ï¼Œå‰ªè¾‘99åœ¨å‰ªè¾‘10ä¹‹å‰æ’­æ”¾)</li></ul><h2 id="9b67" class="ld le it bd lf lg lh dn li lj lk dp ll kb lm ln lo kf lp lq lr kj ls lt lu lv bi translated">åœ¨çœŸå®åœºæ™¯ä¸­è¯„ä¼°åŸå‹</h2><p id="5a59" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">è™½ç„¶ä¸Šé¢çš„ç²¾å½©é•œå¤´æ„Ÿè§‰å¾ˆç¥å¥‡ï¼Œä½†å®ƒçš„å·¥ä½œåº”è¯¥ä¸ä¼šä»¤äººæƒŠè®¶ï¼Œå› ä¸ºæˆ‘åœ¨æ¥è‡ªåŒä¸€è§†é¢‘æºçš„2000å¸§ä¸Šè®­ç»ƒäº†æˆ‘çš„ç®—æ³•ã€‚</p><p id="eb4c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">çœŸæ­£çš„é—®é¢˜æ˜¯:</p><blockquote class="np"><p id="fbb2" class="nq nr it bd ns nt nu nv nw nx ny kn dk translated">è¿™ä¸ªç³»ç»Ÿä¸çœŸå®ä¸–ç•Œçš„å½•éŸ³ç›¸æ¯”è¡¨ç°å¦‚ä½•ï¼Ÿ</p></blockquote><p id="96e2" class="pw-post-body-paragraph jq jr it js b jt nz jv jw jx oa jz ka kb ob kd ke kf oc kh ki kj od kl km kn im bi translated">å¹¸è¿çš„æ˜¯ï¼Œæˆ‘çš„æœ‹å‹ä¿ç•™äº†è®°å½•çš„æ¯”èµ›ï¼Œä¾›ä»–çš„æ•™ç»ƒè®­ç»ƒä»–ã€‚</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="a6f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å“¦ï¼Œå“¦â€¦ä¸€ä¸ªç™½è‰²çš„çƒåœ¨ç™½è‰²çš„å¢™ä¸Šâ€¦ğŸ¤¦â€â™‚ï¸</p><p id="c508" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘æ²¡æœ‰è¢«å“ä½ï¼Œå¤„ç†äº†è§†é¢‘ã€‚ä½†è¯¥ç³»ç»Ÿäº§ç”Ÿçš„å‰ªè¾‘éå¸¸çŸ­ï¼Œå¯èƒ½æ˜¯ç”±äºæ‘„åƒæœºè§’åº¦å’Œç™½å¢™ä¸Šçš„ç™½çƒçš„ç½®ä¿¡åº¦è¾ƒä½ã€‚è¯¥å›¾ç»˜åˆ¶äº†ç›¸å¯¹äºè§†é¢‘æ—¶é—´æˆ³çš„ç½®ä¿¡åº¦å¾—åˆ†:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oe"><img src="../Images/35d0a77cbc39d3382f78de86acf68cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3_B0QoFCAV7E-fK6nXzvwg.png"/></div></div></figure><p id="ffc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨0.30çš„<code class="fe nh ni nj my b">detection_threshold</code>å¤„æœ‰å¾ˆå¤šå¥½çš„(çœŸé˜³æ€§)æ£€æµ‹ï¼Œä½†æ˜¯ä¹Ÿæœ‰åŒæ ·å¤šçš„å‡é˜³æ€§ï¼Œå¦‚æœä¸æ˜¯æ›´å¤šçš„è¯ã€‚å°†é˜ˆå€¼æé«˜åˆ°0.40(æ©™è‰²è™šçº¿)æ¶ˆé™¤äº†å¤§å¤šæ•°å‡é˜³æ€§ï¼Œå°½ç®¡æˆ‘ç•™ä¸‹äº†ä¸€äº›çœŸé˜³æ€§(å‚è§æ—¶é—´æˆ³27.9ç§’å¤„çš„çº¢è‰²æ ‡è®°)ã€‚).æˆ‘è§‰å¾—è¿™æ˜¯ä¸€ä¸ªå¯ä»¥æ¥å—çš„æƒè¡¡ï¼Œæˆ‘é‡æ–°å¤„ç†äº†è§†é¢‘ï¼Œè€—æ—¶4.76å°æ—¶ã€‚</p><p id="3739" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä»¥ä¸‹æ˜¯æˆ‘çš„â€œé›†é”¦å·â€(å³)ä¸å®Œæ•´è§†é¢‘(å·¦)çš„å¯¹æ¯”:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="ebae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘çš„æ¨¡å‹åˆ é™¤äº†å¤§çº¦4åˆ†é’Ÿçš„æ— è¶£å†…å®¹(å½“<em class="kz">çƒä¸åœ¨</em>æ—¶ï¼Œ36%çš„å½•åˆ¶æ—¶é—´)ã€‚åœ¨ç»™Sandeepçœ‹äº†â€œç²¾å½©ç‰‡æ®µâ€ä¹‹åï¼Œä»–ç‚¹äº†ç‚¹å¤´ï¼Œç¬‘äº†ç¬‘ï¼Œå¹¶æ„Ÿå¹é“â€œå¤ªæ£’äº†ï¼â€</p><h2 id="61f7" class="ld le it bd lf lg lh dn li lj lk dp ll kb lm ln lo kf lp lq lr kj ls lt lu lv bi translated">æœªæ¥æ–¹å‘</h2><p id="e1c1" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">æœ‰è®¸å¤šé—®é¢˜å€¼å¾—æ¢è®¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ</p><ul class=""><li id="b2f8" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn no mo mp mq bi translated">å¦‚æœç©å®¶ä½¿ç”¨æ©™è‰²ä¹’ä¹“çƒï¼Œæ¨¡å‹ä¼šå¤±è´¥å—ï¼Ÿ</li><li id="c5f7" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn no mo mp mq bi translated">å¯¹äºæ¢æµ‹æ¯”èµ›ä¸­çš„çƒæ¥è¯´ï¼Œä¸€äº›æ‘„åƒæœºè§’åº¦æ›´å·®å—ï¼Ÿ</li><li id="dd00" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn no mo mp mq bi translated">æˆ‘å¯ä»¥å‡çº§å‰ç«¯ä½“éªŒï¼Œå…è®¸ç”¨æˆ·ä¸Šä¼ ä»–ä»¬è‡ªå·±çš„è§†é¢‘å¹¶è¯†åˆ«â€œæ„Ÿå…´è¶£çš„é¢†åŸŸâ€å—ï¼Ÿ</li><li id="827f" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn no mo mp mq bi translated">æˆ‘å¯ä»¥é€šè¿‡ä½¿ç”¨PyTorchæˆ–Kerasæ»šåŠ¨æˆ‘ä»¬è‡ªå·±çš„å·ç§¯ç¥ç»ç½‘ç»œæ¥æé«˜æ¨¡å‹ç²¾åº¦å—ï¼Ÿ</li><li id="d305" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn no mo mp mq bi translated">æˆ‘å¯ä»¥åŠ å¿«è§†é¢‘å¤„ç†æ—¶é—´å—ï¼Ÿ(å‰§æœ¬èŠ±äº†6ä¸ªå°æ—¶å¤„ç†äº†12åˆ†é’Ÿçš„è§†é¢‘ï¼)</li><li id="0022" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn no mo mp mq bi translated">æˆ‘èƒ½å¤šå¿«å¤šå®¹æ˜“åœ°å°†è¿™ä¸ªåŸå‹æ¨å¹¿åˆ°å…¶ä»–è¿åŠ¨ï¼Œæ¯”å¦‚å‡»å‰‘æˆ–ç½‘çƒï¼Ÿ</li><li id="feec" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn no mo mp mq bi translated">å¦‚æœæˆ‘ä»¬éœ€è¦é¢„æµ‹å¤šä¸ªç±»åˆ«(ä¾‹å¦‚ï¼Œâ€œæ¯”èµ›ä¸­çš„çƒâ€ä¸â€œæ¯”èµ›ä¸­çš„çƒâ€æˆ–â€œå‘çƒä¸­çš„çƒâ€)ï¼Œæ€§èƒ½ä¼šå¦‚ä½•å˜åŒ–ï¼Ÿ</li></ul><p id="0018" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨æœªæ¥çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘å°†ç»§ç»­æ¢ç´¢è¿™äº›é—®é¢˜ã€‚å¦‚æœä½ å¯¹æˆ‘çš„ç»“å¯¹ç¼–ç¨‹æ„Ÿå…´è¶£ï¼Œè¯·åœ¨è¯„è®ºåŒºç•™è¨€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‘¨æœ«æ‰¾åˆ°æ—¶é—´ï¼</p></div></div>    
</body>
</html>