<html>
<head>
<title>Predictive Analytics: Regression Analysis with LSTM, GRU and BiLSTM in TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é¢„æµ‹åˆ†æ:ç”¨ TensorFlow ä¸­çš„ LSTMã€GRU å’Œæ¯”å°”æ–¯ç‰¹å§†è¿›è¡Œå›å½’åˆ†æ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/predictive-analysis-rnn-lstm-and-gru-to-predict-water-consumption-e6bb3c2b4b02?source=collection_archive---------3-----------------------#2020-07-16">https://towardsdatascience.com/predictive-analysis-rnn-lstm-and-gru-to-predict-water-consumption-e6bb3c2b4b02?source=collection_archive---------3-----------------------#2020-07-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/d4246c039b5c2109517fed74fd420b8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yCuXkBbkJxSkw6iI8ohrhw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">åœ¨<a class="ae jg" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„<a class="ae jg" href="https://unsplash.com/@thisisengineering" rel="noopener ugc nofollow" target="_blank">this is å·¥ç¨‹</a>æ‹æ‘„</p></figure><div class=""/><div class=""><h2 id="b8dd" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">å…³äºå¼€å‘ LSTMã€GRU å’Œæ¯”å°”æ–¯ç‰¹å§†æ¨¡å‹è¿›è¡Œç”¨æ°´é‡å¤šæ­¥é¢„æµ‹çš„åˆ†æ­¥æŒ‡å—</h2></div><p id="7ffb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lu translated"><span class="l lv lw lx bm ly lz ma mb mc di">åœ¨</span>è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å¼€å‘äº†ä¸‰ä¸ªè¿ç»­æ¨¡å‹ï¼›LSTMã€GRU å’ŒåŒå‘ LSTMï¼Œé¢„æµ‹æ°”å€™å˜åŒ–å½±å“ä¸‹çš„ç”¨æ°´é‡ã€‚ç„¶åï¼Œæˆ‘ç”¨æœ€å¯é çš„ä¸€ä¸ªå¯¹æœªæ¥ 10 å¹´çš„åŸå¸‚ç”¨æ°´é‡è¿›è¡Œå¤šæ­¥é¢„æµ‹ã€‚</p><p id="7ca0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">é¦–å…ˆï¼Œè®©æˆ‘æé†’ä½ ä¸€ä¸‹åŸºæœ¬é¢ã€‚ç„¶åï¼Œæˆ‘å°†å¸¦æ‚¨å®Œæˆä¸€ä¸ªå®Œæ•´çš„ Python æ•°æ®ç§‘å­¦é¡¹ç›®ã€‚</p><p id="8bad" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">ğŸ‘©â€ğŸ’»</strong> <a class="ae jg" href="https://github.com/NioushaR/LSTM-GRU-BiLSTM-in-TensorFlow-for-predictive-analytics" rel="noopener ugc nofollow" target="_blank"> <strong class="la jk">ä¸Šçš„ Python ä»£ç  GitHub </strong> </a></p><h1 id="3860" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">é€’å½’ç¥ç»ç½‘ç»œ</h1><p id="68c9" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">é€’å½’ç¥ç»ç½‘ç»œ(RNN)æ˜¯ä¸€ç§è®¾è®¡ç”¨äºä½¿ç”¨æ—¶åºæ•°æ®çš„ç¥ç»ç½‘ç»œã€‚åœ¨ RNNs ä¸­ï¼Œè¾“å‡ºå¯ä»¥ä½œä¸ºè¾“å…¥åé¦ˆåˆ°ç½‘ç»œä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå¾ªç¯ç»“æ„ã€‚</p><h2 id="9400" class="na me jj bd mf nb nc dn mj nd ne dp mn lh nf ng mp ll nh ni mr lp nj nk mt nl bi translated">æ¢¯åº¦æ¶ˆå¤±é—®é¢˜</h2><p id="99a5" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">é€šè¿‡åå‘ä¼ æ’­æ¥è®­ç»ƒ rnnã€‚åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼ŒRNNs ä¼šé‡åˆ°æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚æ¢¯åº¦æ˜¯ç”¨äºæ›´æ–°ç¥ç»ç½‘ç»œæƒé‡çš„å€¼ã€‚æ¢¯åº¦æ¶ˆå¤±é—®é¢˜æ˜¯å½“æ¢¯åº¦éšç€æ—¶é—´å‘åä¼ æ’­è€Œæ”¶ç¼©æ—¶ã€‚å› æ­¤ï¼Œæ¢¯åº¦è¾ƒå°çš„å±‚ä¸ä¼šå­¦ä¹ ï¼Œå®ƒä»¬ä¼šå¯¼è‡´ç½‘ç»œå…·æœ‰çŸ­æœŸè®°å¿†ã€‚</p><p id="53f1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">ğŸ’¡â“ </strong>æ¸å˜æ¶ˆå¤±é—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ</p><h1 id="0d9b" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">é•¿çŸ­æœŸè®°å¿†</h1><p id="c9c6" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">é•¿çŸ­æœŸè®°å¿†(LSTM)æ˜¯ä¸€ç§ä¸“é—¨çš„ RNNï¼Œä»¥å‡è½»æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚LSTMs å¯ä»¥ä½¿ç”¨ä¸€ç§ç§°ä¸º gates çš„æœºåˆ¶æ¥å­¦ä¹ é•¿æœŸä¾èµ–å…³ç³»ã€‚è¿™äº›é—¨å¯ä»¥äº†è§£åºåˆ—ä¸­å“ªäº›ä¿¡æ¯æ˜¯é‡è¦çš„ï¼Œåº”è¯¥ä¿ç•™æˆ–ä¸¢å¼ƒã€‚LSTMs æœ‰ä¸‰ä¸ªé—¨ï¼›è¾“å…¥ï¼Œå¿˜è®°ï¼Œè¾“å‡ºã€‚</p><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nm"><img src="../Images/aaf7785d34594586d9329f48781345fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kq5qv8aXLyF0mmzE4G9YVQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">LSTM ç»†èƒçš„ç»“æ„</p></figure><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nr"><img src="../Images/d942fb3786c704f1b2abd725b7c64e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oq_iXPyXcW8wnLRMtM1-Fw.png"/></div></div></figure><h1 id="4076" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">åŒå‘ LSTMs</h1><p id="1924" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">åŒå‘ lstm(BiSTM)çš„æ€æƒ³æ˜¯åœ¨ LSTM æ¨¡å‹ä¸­èšåˆç‰¹å®šæ—¶é—´æ­¥é•¿çš„è¿‡å»å’Œæœªæ¥çš„è¾“å…¥ä¿¡æ¯ã€‚åœ¨ BiLSTM ä¸­ï¼Œåœ¨ä»»ä½•æ—¶é—´ç‚¹ï¼Œæ‚¨éƒ½å¯ä»¥ä¿å­˜è¿‡å»å’Œæœªæ¥çš„ä¿¡æ¯ã€‚</p><h1 id="a896" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">é—¨æ§å¾ªç¯å•å…ƒ</h1><p id="426f" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">é—¨æ§é€’å½’å•å…ƒ(GRU)æ˜¯æ–°ä¸€ä»£çš„ç¥ç»ç½‘ç»œï¼Œéå¸¸ç±»ä¼¼äº LSTMã€‚GRU æ‘†è„±äº†ç»†èƒçŠ¶æ€ï¼Œä½¿ç”¨éšè—çŠ¶æ€æ¥ä¼ é€’ä¿¡æ¯ã€‚GRU å’Œ LSTM çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ GRU åªæœ‰ä¸¤ä¸ªå¤§é—¨ï¼›å¤ä½å’Œæ›´æ–°é—¨ã€‚</p><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ns"><img src="../Images/10f207acf691c6e0fd139e7a13d1db87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZU3rzM9x71iMUjHlQ3uBw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">GRU ç»†èƒçš„ç»“æ„</p></figure><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nt"><img src="../Images/8b1c74f5420387dfae86af0753b737b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g4VOuCmutyxkLRu5DBDffQ.png"/></div></div></figure></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="807d" class="md me jj bd mf mg ob mi mj mk oc mm mn kp od kq mp ks oe kt mr kv of kw mt mu bi translated">â˜ºæ—¶é—´è®©æˆ‘ä»¬çš„æ‰‹ dirtyâ—</h1><h2 id="304a" class="na me jj bd mf nb nc dn mj nd ne dp mn lh nf ng mp ll nh ni mr lp nj nk mt nl bi translated">èµ„æ–™ç»„</h2><p id="5f59" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">åŠ æ‹¿å¤§é­åŒ—å…‹çœçš„ Brossard å¸‚è¢«é€‰ä¸ºç ”ç©¶åœ°ç‚¹ã€‚è¿™åº§åŸå¸‚æ˜¯è’™ç‰¹åˆ©å°”å¤§éƒ½å¸‚åŒºçš„ä¸€éƒ¨åˆ†ã€‚æœ¬é¡¹ç›®<strong class="la jk">æ—¥ç”¨æ°´é‡</strong>æ•°æ®å–è‡ª 2011 å¹´ 9 æœˆ 1 æ—¥è‡³ 2015 å¹´ 9 æœˆ 30 æ—¥ã€‚æ”¶é›†åŒæœŸ<strong class="la jk">æœ€ä½æ°”æ¸©</strong>ã€<strong class="la jk">æœ€é«˜æ°”æ¸©</strong>å’Œ<strong class="la jk">æ€»é™æ°´é‡</strong>ã€‚è¿™äº›æ°”å€™å˜é‡çš„æµ‹é‡æ•°æ®æ¥è‡ª<a class="ae jg" href="https://www.concordia.ca/news/stories/2019/01/07/historical-canadian-climate-data-is-now-only-a-few-clicks-away.html" rel="noopener ugc nofollow" target="_blank">åŠ æ‹¿å¤§ç¯å¢ƒéƒ¨</a>ã€‚</p><h2 id="e953" class="na me jj bd mf nb nc dn mj nd ne dp mn lh nf ng mp ll nh ni mr lp nj nk mt nl bi translated">å¯¼å…¥åº“</h2><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi og"><img src="../Images/86adab9c7807e3bd7f6322aca0549fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ktiEFNqTLC-twGFd8MW0CQ.png"/></div></div></figure><h2 id="c7f2" class="na me jj bd mf nb nc dn mj nd ne dp mn lh nf ng mp ll nh ni mr lp nj nk mt nl bi translated">è®¾ç½®éšæœºç§å­</h2><p id="32f7" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">è®¾ç½®éšæœºç§å­ä»¥åœ¨æ¯æ¬¡è¿è¡Œä»£ç åè·å¾—ç›¸åŒçš„ç»“æœã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="34b3" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Set random seed for reproducibility</strong><br/>tf.random.set_seed(1234)</span></pre><h1 id="980f" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">æ­¥éª¤ 1:è¯»å–å’Œæµè§ˆæ•°æ®</h1><p id="a5e2" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘æ­£åœ¨å¤„ç†å¤šå˜é‡æ—¶é—´åºåˆ—æ•°æ®ã€‚å½“æˆ‘ä» CSV æ–‡ä»¶å¯¼å…¥æ•°æ®æ—¶ï¼Œæˆ‘é€šè¿‡<strong class="la jk"> parse_dates = ['Date'] </strong>ç¡®ä¿<strong class="la jk"> Date </strong>åˆ—å…·æœ‰æ­£ç¡®çš„<em class="oq"> DateTime </em>æ ¼å¼ã€‚æ­¤å¤–ï¼Œå½“æˆ‘å¤„ç†æ—¥æœŸå’Œæ—¶é—´æ—¶ï¼Œå¦‚æœæˆ‘å°†<strong class="la jk">æ—¥æœŸ</strong>åˆ—è®¾ç½®ä¸º dataframe ç´¢å¼•ï¼Œå°±ä¼šå˜å¾—å®¹æ˜“å¾—å¤šã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="43a3" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Read file</strong><br/>file = 'Data.csv'<br/>raw_data = pd.read_csv(file, parse_dates = ['Date'],<br/>                       index_col = 'Date')<br/>df = raw_data.copy()</span></pre><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi or"><img src="../Images/0f8f5a51309d131369f6ffb95431908e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SExlfaPPzMhHvCBLTGojlQ.png"/></div></div></figure><ul class=""><li id="c051" class="os ot jj la b lb lc le lf lh ou ll ov lp ow lt ox oy oz pa bi translated">Max_T:æœ€é«˜æ¸©åº¦(â„ƒ)</li><li id="343e" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">Min_T:æœ€ä½æ¸©åº¦(â„ƒ)</li><li id="dff3" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">T_P:æ€»é™æ°´é‡(æ¯«ç±³)</li><li id="e32f" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">UWC:åŸå¸‚ç”¨æ°´é‡(ç«‹æ–¹ç±³/äºº.å¤©)</li></ul><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="2478" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Define a function to draw time_series plot</strong><br/>def timeseries (x_axis, y_axis, x_label, y_label):<br/>    plt.figure(figsize = (10, 6))<br/>    plt.plot(x_axis, y_axis, color ='black')<br/>    plt.xlabel(x_label, {'fontsize': 12}) <br/>    plt.ylabel(y_label, {'fontsize': 12})</span><span id="7455" class="na me jj oi b gy pg on l oo op">timeseries(df.index, df['WC (m3/capita.day)'], 'Time (day)','Daily Water consumption ($m^3$/capita.day)')</span></pre><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/605873cd11ee6112485b60c44bb7e482.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vj5zK5u37FZd5Cs0LNB_UQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">2011 å¹´ 9 æœˆ 1 æ—¥è‡³ 2015 å¹´ 9 æœˆ 30 æ—¥çš„æ—¥ç”¨æ°´é‡æ—¶é—´åºåˆ—</p></figure><h1 id="69fc" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">ç¬¬äºŒæ­¥:æ•°æ®é¢„å¤„ç†</h1><p id="6d03" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">æ•°æ®é¢„å¤„ç†æ˜¯æœ€è€—æ—¶çš„æ­¥éª¤ï¼ŒåŒ…æ‹¬:</p><ul class=""><li id="9ac6" class="os ot jj la b lb lc le lf lh ou ll ov lp ow lt ox oy oz pa bi translated">å¤„ç†ç¼ºå¤±å€¼</li><li id="fb0b" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">æ›¿æ¢å¼‚å¸¸å€¼</li><li id="abb0" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">å°†æ•°æ®é›†æ‹†åˆ†ä¸ºè®­ç»ƒå’Œæµ‹è¯•æ•°æ®</li><li id="54ad" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">æ‹†åˆ†ç›®æ ‡å˜é‡å’Œå› å˜é‡</li><li id="afca" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">æ•°æ®è½¬æ¢</li><li id="d467" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">åˆ›å»º 3D è¾“å…¥æ•°æ®é›†</li></ul><h2 id="7521" class="na me jj bd mf nb nc dn mj nd ne dp mn lh nf ng mp ll nh ni mr lp nj nk mt nl bi translated">2.1 å¤„ç†ç¼ºå¤±å€¼</h2><p id="27c4" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">å¯¹äºæ—¶é—´åºåˆ—æ•°æ®ï¼Œä½¿ç”¨çº¿æ€§æ’å€¼æ›¿æ¢ç¼ºå¤±å€¼æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="f3aa" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Check missing values</strong><br/>df.isnull().sum()</span></pre><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pi"><img src="../Images/2c6dcbd867519661fdf14774d487782f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yEErGkjKxzKohZs6eXRYwA.png"/></div></div></figure><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="764c" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Replace missing values by interpolation</strong><br/>def replace_missing (attribute):<br/>    return attribute.interpolate(inplace=True)</span><span id="fd61" class="na me jj oi b gy pg on l oo op">replace_missing(df['Max_T'])<br/>replace_missing(df['Min_T'])<br/>replace_missing(df['T_P'])<br/>replace_missing(df['UWC'])</span></pre><h2 id="a453" class="na me jj bd mf nb nc dn mj nd ne dp mn lh nf ng mp ll nh ni mr lp nj nk mt nl bi translated">2.2 æ›¿æ¢å¼‚å¸¸å€¼</h2><p id="3d18" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">æˆ‘ä½¿ç”¨ç»Ÿè®¡æ–¹æ³•æ¥æ£€æµ‹å¼‚å¸¸å€¼ã€‚ç»Ÿè®¡æ–¹æ³•å‡è®¾æ•°æ®ç‚¹å‘ˆæ­£æ€åˆ†å¸ƒã€‚å› æ­¤ï¼Œä½æ¦‚ç‡åŒºåŸŸä¸­çš„å€¼è¢«è§†ä¸ºå¼‚å¸¸å€¼ã€‚æˆ‘åœ¨ç»Ÿè®¡æ–¹æ³•ä¸­åº”ç”¨äº†æœ€å¤§ä¼¼ç„¶çš„æ¦‚å¿µï¼Œè¿™æ„å‘³ç€è¶…å‡ºÎ¼ 2ÏƒèŒƒå›´çš„å€¼è¢«æ ‡è®°ä¸ºå¼‚å¸¸å€¼ã€‚æ³¨æ„ï¼Œåœ¨æ­£æ€åˆ†å¸ƒçš„å‡è®¾ä¸‹ï¼ŒÎ¼ 2ÏƒåŒ…å« 95%çš„æ•°æ®ã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="6b4b" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Outlier detection</strong><br/>up_b = df['UWC'].mean() + 2*df['UWC'].std()<br/>low_b = df['UWC'].mean() - 2*df['UWC'].std()</span><span id="06c3" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># Replace outlier by interpolation for base consumption</strong><br/>df.loc[df['UWC'] &gt; up_b, 'UWC'] = np.nan<br/>df.loc[df['UWC'] &lt; low_b, 'UWC'] = np.nan<br/>df['UWC'].interpolate(inplace=True)</span></pre><h2 id="3e5a" class="na me jj bd mf nb nc dn mj nd ne dp mn lh nf ng mp ll nh ni mr lp nj nk mt nl bi translated">2.3 å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒå’Œæµ‹è¯•æ•°æ®</h2><p id="0973" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘å°†å‰ 80%çš„æ•°æ®è®¾ç½®ä¸ºè®­ç»ƒæ•°æ®ï¼Œå‰©ä¸‹çš„ 20%ä¸ºæµ‹è¯•æ•°æ®ã€‚æˆ‘ç”¨è®­ç»ƒæ•°æ®è®­ç»ƒæ¨¡å‹ï¼Œå¹¶ç”¨æµ‹è¯•æ•°æ®éªŒè¯å…¶æ€§èƒ½ã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="0df2" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Split train data and test data</strong><br/>train_size = int(len(df)*0.8)<br/>train_dataset, test_dataset = df.iloc[:train_size],<br/>df.iloc[train_size:]</span><span id="80b0" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># Plot train and test data</strong><br/>plt.figure(figsize = (10, 6))<br/>plt.plot(train_dataset.UWC)<br/>plt.plot(test_dataset.UWC)<br/>plt.xlabel('Time (day)')<br/>plt.ylabel('Daily water consumption ($m^3$/capita.day)')<br/>plt.legend(['Train set', 'Test set'], loc='upper right')</span><span id="b946" class="na me jj oi b gy pg on l oo op">print('Dimension of train data: ',train_dataset.shape)<br/>print('Dimension of test data: ', test_dataset.shape)</span></pre><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pj"><img src="../Images/5c7c85e937c8c7c8d292bf0de594e61d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lC87Hdkl4zYCLj9ukGPVNQ.png"/></div></div></figure><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/f0db92de7e645aee915dbbd6bde926e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SKIE7MwhSsR4Zv8D4n0qpA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®çš„é¢„å¤„ç†æ—¥ç”¨æ°´é‡æ—¶é—´åºåˆ—</p></figure><h2 id="4819" class="na me jj bd mf nb nc dn mj nd ne dp mn lh nf ng mp ll nh ni mr lp nj nk mt nl bi translated">2.4 æ‹†åˆ†ç›®æ ‡å˜é‡å’Œå› å˜é‡</h2><p id="e1b1" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">UWC æ˜¯ç›®æ ‡å˜é‡(è¾“å‡º)ï¼Œæ˜¯å› å˜é‡(è¾“å…¥)çš„å‡½æ•°ï¼›Max_Tï¼ŒMin_T å’Œ T_Pã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="bf70" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Split train data to X and y</strong><br/>X_train = train_dataset.drop('UWC', axis = 1)<br/>y_train = train_dataset.loc[:,['UWC']]</span><span id="7254" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># Split test data to X and y</strong><br/>X_test = test_dataset.drop('UWC', axis = 1)<br/>y_test = test_dataset.loc[:,['UWC']]</span></pre><h2 id="dd44" class="na me jj bd mf nb nc dn mj nd ne dp mn lh nf ng mp ll nh ni mr lp nj nk mt nl bi translated">2.5 æ•°æ®è½¬æ¢</h2><p id="fe53" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">ä¸€ä¸ªå¾ˆå¥½çš„ç»éªŒæ³•åˆ™æ˜¯ï¼Œè§„èŒƒåŒ–çš„æ•°æ®ä¼šåœ¨ç¥ç»ç½‘ç»œä¸­äº§ç”Ÿæ›´å¥½çš„æ€§èƒ½ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä½¿ç”¨æ¥è‡ª<a class="ae jg" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> scikit-learn </a>çš„<a class="ae jg" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html" rel="noopener ugc nofollow" target="_blank"> MinMaxScaler </a>ã€‚</p><p id="eee7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">æˆ‘ä¸ºè¾“å…¥å’Œè¾“å‡ºå®šä¹‰äº†ä¸åŒçš„æ ‡é‡ï¼Œå› ä¸ºå®ƒä»¬æœ‰ä¸åŒçš„å½¢çŠ¶ã€‚è¿™å¯¹äºä½¿ç”¨<strong class="la jk">é€†å˜æ¢</strong>åŠŸèƒ½å°¤å…¶é‡è¦ã€‚</p><ul class=""><li id="484f" class="os ot jj la b lb lc le lf lh ou ll ov lp ow lt ox oy oz pa bi translated">X_train.shape: (1192ï¼Œ3)</li><li id="1ab3" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">y_train.shape: (1192ï¼Œ1)</li><li id="69d8" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">X_test.shape: (299ï¼Œ3)</li><li id="dcbf" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">y_test.shape: (299ï¼Œ1)</li></ul><p id="b34e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">åŠ¡å¿…ç¡®ä¿è¾“å‡ºçš„æ¯”ä¾‹åœ¨ 0â€“1 èŒƒå›´å†…ï¼Œä»¥åŒ¹é… LSTMã€GRU å’Œæ¯”å°”æ–¯ç‰¹å§†è¾“å‡ºå±‚çš„æ¿€æ´»å‡½æ•°(tanh)çš„æ¯”ä¾‹ã€‚æ­¤å¤–ï¼Œè¾“å…¥å˜é‡æœ€å¥½æ˜¯å°å€¼ï¼Œå¯èƒ½åœ¨ 0-1 çš„èŒƒå›´å†…ã€‚</p><p id="5461" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">ğŸ’¡</strong><strong class="la jk">stepsâ“æœ‰å“ªäº›æ•°æ®è½¬æ¢</strong></p><ul class=""><li id="1eb6" class="os ot jj la b lb lc le lf lh ou ll ov lp ow lt ox oy oz pa bi translated">ä½¿ç”¨å¯ç”¨çš„è®­ç»ƒæ•°æ®æ‹Ÿåˆå®šæ ‡å™¨(MinMaxScaler)(è¿™æ„å‘³ç€ä½¿ç”¨è®­ç»ƒæ•°æ®ä¼°è®¡æœ€å°å’Œæœ€å¤§å¯è§‚æµ‹å€¼ã€‚)</li><li id="3e86" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">å°†ç¼©æ”¾å™¨åº”ç”¨äºè®­ç»ƒæ•°æ®</li><li id="ed7b" class="os ot jj la b lb pb le pc lh pd ll pe lp pf lt ox oy oz pa bi translated">å°†å®šæ ‡å™¨åº”ç”¨äºæµ‹è¯•æ•°æ®</li></ul><p id="4eac" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨è®­ç»ƒæ•°æ®ä¸Šå®‰è£…çš„ç¼©æ”¾å™¨æ¥ç¼©æ”¾ä¸å¯è§çš„æ•°æ®ã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="3ca8" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Different scaler for input and output</strong><br/>scaler_x = MinMaxScaler(feature_range = (0,1))<br/>scaler_y = MinMaxScaler(feature_range = (0,1))</span><span id="a66a" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># Fit the scaler using available training data</strong><br/>input_scaler = scaler_x.fit(X_train)<br/>output_scaler = scaler_y.fit(y_train)</span><span id="83a9" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># Apply the scaler to training data</strong><br/>train_y_norm = output_scaler.transform(y_train)<br/>train_x_norm = input_scaler.transform(X_train)</span><span id="026b" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># Apply the scaler to test data</strong><br/>test_y_norm = output_scaler.transform(y_test)<br/>test_x_norm = input_scaler.transform(X_test)</span></pre><h2 id="0ffa" class="na me jj bd mf nb nc dn mj nd ne dp mn lh nf ng mp ll nh ni mr lp nj nk mt nl bi translated">2.6 åˆ›å»º 3D è¾“å…¥æ•°æ®é›†</h2><p id="d3ad" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">LSTMã€GRU å’Œæ¯”å°”æ–¯ç‰¹å§†é‡‡ç”¨ 3D è¾“å…¥(æ ·æœ¬æ•°ã€æ—¶é—´æ­¥æ•°ã€ç‰¹å¾æ•°)ã€‚å› æ­¤ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªåŠ©æ‰‹å‡½æ•°ï¼Œ<em class="oq"> create_dataset </em>ï¼Œæ¥é‡å¡‘è¾“å…¥ã€‚</p><p id="b9d0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘å®šä¹‰ time_steps = 30ã€‚è¿™æ„å‘³ç€æ¨¡å‹åŸºäºæœ€è¿‘ 30 å¤©çš„æ•°æ®è¿›è¡Œé¢„æµ‹(åœ¨ for å¾ªç¯çš„ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œè¾“å…¥æºå¸¦å‰ 30 å¤©ï¼Œè¾“å‡ºæ˜¯ç¬¬ 30 å¤©çš„ UWC)ã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="64e7" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Create a 3D input</strong><br/>def create_dataset (X, y, time_steps = 1):<br/>    Xs, ys = [], []<br/>    for i in range(len(X)-time_steps):<br/>        v = X[i:i+time_steps, :]<br/>        Xs.append(v)<br/>        ys.append(y[i+time_steps])<br/>    return np.array(Xs), np.array(ys)</span><span id="d601" class="na me jj oi b gy pg on l oo op">TIME_STEPS = 30</span><span id="e12c" class="na me jj oi b gy pg on l oo op">X_test, y_test = create_dataset(test_x_norm, test_y_norm,   <br/>                                TIME_STEPS)<br/>X_train, y_train = create_dataset(train_x_norm, train_y_norm, <br/>                                  TIME_STEPS)<br/>print('X_train.shape: ', X_test.shape)<br/>print('y_train.shape: ', y_train.shape)<br/>print('X_test.shape: ', X_test.shape)<br/>print('y_test.shape: ', y_train.shape)</span></pre><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pk"><img src="../Images/52cd204156b257c807699d2d8b8629e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QKKogbchzp5tTqFxuIhb6A.png"/></div></div></figure><h1 id="8624" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">æ­¥éª¤ 3:åˆ›å»ºæ¯”å°”æ–¯ç‰¹å§†ã€LSTM å’Œ GRU æ¨¡å‹</h1><h1 id="7576" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">3.1 tensor flow ä¸­çš„æ¯”å°”æ–¯ç‰¹å§†ã€LSTM å’Œ GRU æ¨¡å‹</h1><p id="a9bf" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œ<em class="oq"> create_model_bilstm </em>ï¼Œåˆ›å»ºä¸€ä¸ª BDLSM å¹¶è·å–éšè—å±‚ä¸­çš„å•å…ƒ(ç¥ç»å…ƒ)æ•°é‡ã€‚ç¬¬äºŒä¸ªå‡½æ•°<em class="oq"> create_model </em>è·å¾—ä¸¤ä¸ªè¾“å…¥ï¼›éšè—å±‚ä¸­çš„å•å…ƒæ•°é‡å’Œæ¨¡å‹åç§°(LSTM æˆ– GRU)ã€‚</p><p id="ef66" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">ä¸ºäº†ç®€å•èµ·è§ï¼Œæ¯”å°”æ–¯ç‰¹å§†ã€LSTM å’Œ GRU åœ¨è¾“å…¥å±‚æœ‰ 64 ä¸ªç¥ç»å…ƒï¼Œä¸€ä¸ªéšè—å±‚åŒ…æ‹¬ 64 ä¸ªç¥ç»å…ƒï¼Œåœ¨è¾“å‡ºå±‚æœ‰ 1 ä¸ªç¥ç»å…ƒã€‚</p><p id="fdf4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">ä¸ºäº†ä½¿ LSTM å’Œ GRU æ¨¡å‹å¯¹å˜åŒ–å…·æœ‰é²æ£’æ€§ï¼Œä½¿ç”¨äº†<strong class="la jk">ä¸‹é™</strong>å‡½æ•°ã€‚<strong class="la jk">æ‰çº¿(0.2) </strong>éšæœºæ‰çº¿ 20%çš„å•ä½ã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="7cc3" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Create BiLSTM model</strong><br/>def create_model_bilstm(units):<br/>    model = Sequential()<br/>    model.add(Bidirectional(LSTM(units = units,                             <br/>              return_sequences=True),<br/>              input_shape=(X_train.shape[1], X_train.shape[2])))<br/>    model.add(Bidirectional(LSTM(units = units)))<br/>    model.add(Dense(1))<br/>    <strong class="oi jk">#Compile model</strong><br/>    model.compile(loss='mse', optimizer='adam')<br/>    return model</span><span id="ff8e" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># Create LSTM or GRU model</strong><br/>def create_model(units, m):<br/>    model = Sequential()<br/>    model.add(m (units = units, return_sequences = True,<br/>                input_shape = [X_train.shape[1], X_train.shape[2]]))<br/>    model.add(Dropout(0.2))<br/>    model.add(m (units = units))<br/>    model.add(Dropout(0.2))<br/>    model.add(Dense(units = 1))<br/>    <strong class="oi jk">#Compile model</strong><br/>    model.compile(loss='mse', optimizer='adam')<br/>    return model</span><span id="5b6d" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># BiLSTM</strong><br/>model_bilstm = create_model_bilstm(64)</span><span id="c2da" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># GRU and LSTM</strong><br/>model_gru = create_model(64, GRU)<br/>model_lstm = create_model(64, LSTM)</span></pre><h1 id="ed3f" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">3.2 æ‹Ÿåˆæ¨¡å‹</h1><p id="0f45" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">æˆ‘ç”¨ 100 ä¸ª<strong class="la jk">æ—¶æœŸ</strong>å’Œ<strong class="la jk">æ‰¹é‡</strong> = 32 çš„è®­ç»ƒæ•°æ®è®­ç»ƒæ¨¡å‹ã€‚æˆ‘è®©æ¨¡å‹ä½¿ç”¨ 20%çš„è®­ç»ƒæ•°æ®ä½œä¸ºéªŒè¯æ•°æ®ã€‚æˆ‘è®¾ç½®<strong class="la jk"> shuffle = False </strong>æ˜¯å› ä¸ºå®ƒæä¾›äº†æ›´å¥½çš„æ€§èƒ½ã€‚</p><p id="503e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">ä¸ºäº†é¿å…è¿‡åº¦æ‹Ÿåˆï¼Œæˆ‘è®¾ç½®äº†ä¸€ä¸ª<em class="oq">æå‰åœæ­¢</em>ï¼Œå½“<em class="oq">éªŒè¯æŸå¤±</em>åœ¨ 10 ä¸ªå‘¨æœŸåæ²¡æœ‰æ”¹å–„æ—¶(è€å¿ƒ= 10)åœæ­¢è®­ç»ƒã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="300d" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Fit BiLSTM, LSTM and GRU</strong><br/>def fit_model(model):<br/>    early_stop = keras.callbacks.EarlyStopping(monitor = 'val_loss',<br/>                                               patience = 10)<br/>    history = model.fit(X_train, y_train, epochs = 100,  <br/>                        validation_split = 0.2, batch_size = 32, <br/>                        shuffle = False, callbacks = [early_stop])<br/>    return history</span><span id="29a1" class="na me jj oi b gy pg on l oo op">history_bilstm = fit_model(model_bilstm)<br/>history_lstm = fit_model(model_lstm)<br/>history_gru = fit_model(model_gru)</span></pre><h2 id="e297" class="na me jj bd mf nb nc dn mj nd ne dp mn lh nf ng mp ll nh ni mr lp nj nk mt nl bi translated">ç»˜åˆ¶åˆ—è½¦æŸå¤±å’ŒéªŒè¯æŸå¤±</h2><p id="95eb" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">åœ¨æ­¤å›¾ä¸­ï¼Œæˆ‘å°†æŸ¥çœ‹æ¯ä¸ªæ¨¡å‹ä¸­çš„æ—¶æœŸæ•°ï¼Œå¹¶è¯„ä¼°æ¨¡å‹åœ¨é¢„æµ‹ä¸­çš„æ€§èƒ½ã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="8b0c" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Plot train loss and validation loss</strong><br/>def plot_loss (history):<br/>    plt.figure(figsize = (10, 6))<br/>    plt.plot(history.history['loss'])<br/>    plt.plot(history.history['val_loss'])<br/>    plt.ylabel('Loss')<br/>    plt.xlabel('epoch')<br/>    plt.legend(['Train loss', 'Validation loss'], loc='upper right')</span><span id="8e8a" class="na me jj oi b gy pg on l oo op">plot_loss (history_bilstm)<br/>plot_loss (history_lstm)<br/>plot_loss (history_gru)</span></pre><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/da3ef85ca3f594f559a423965fd561a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*edGyuCIYlK6mDe-DheoUfQ.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">BiLSTM çš„åˆ—è½¦æŸå¤±ä¸éªŒè¯æŸå¤±</p></figure><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/f959490a60a75a23ff51d54a7de00e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gRNCR5n_yCpLwuULp0EUZQ.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">LSTM çš„åˆ—è½¦æŸå¤±ä¸éªŒè¯æŸå¤±</p></figure><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/85acbb4fb7404f7552ed8ead576fa385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Pa1AQiZeyn9g_grF5NcmA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">GRU çš„åˆ—è½¦æŸå¤±ä¸éªŒè¯æŸå¤±</p></figure><h1 id="b57d" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">3.3 é€†å˜æ¢ç›®æ ‡å˜é‡</h1><p id="95a8" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">å»ºç«‹æ¨¡å‹åï¼Œæˆ‘å¿…é¡»ä½¿ç”¨<strong class="la jk">scaler _ y . inverse _ transform</strong>å°†ç›®æ ‡å˜é‡è½¬æ¢å›åŸå§‹æ•°æ®ç©ºé—´ï¼Œç”¨äºè®­ç»ƒå’Œæµ‹è¯•æ•°æ®ã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="3193" class="na me jj oi b gy om on l oo op">y_test = scaler_y.inverse_transform(y_test)<br/>y_train = scaler_y.inverse_transform(y_train)</span></pre><h1 id="6740" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">3.4 ä½¿ç”¨æ¯”å°”æ–¯ç‰¹å§†ã€LSTM å’Œ GRU è¿›è¡Œé¢„æµ‹</h1><p id="0619" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">åœ¨è¿™é‡Œï¼Œæˆ‘ç”¨æ¯”å°”æ–¯ç‰¹å§†ã€LSTM å’Œ GRU æ¨¡å‹é¢„æµ‹ UWCã€‚ç„¶åï¼Œæˆ‘ç»˜åˆ¶äº†ä¸‰ä¸ªæ¨¡å‹çš„çœŸå®æœªæ¥(æµ‹è¯•æ•°æ®)ä¸é¢„æµ‹ã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="f152" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Make prediction</strong><br/>def prediction(model):<br/>    prediction = model.predict(X_test)<br/>    prediction = scaler_y.inverse_transform(prediction)<br/>    return prediction</span><span id="020d" class="na me jj oi b gy pg on l oo op">prediction_bilstm = prediction(model_bilstm)<br/>prediction_lstm = prediction(model_lstm)<br/>prediction_gru = prediction(model_gru)</span><span id="8c8c" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># Plot true future vs prediction</strong><br/>def plot_future(prediction, y_test):<br/>    plt.figure(figsize=(10, 6))<br/>    range_future = len(prediction)<br/>    plt.plot(np.arange(range_future), np.array(y_test), <br/>             label='True Future')     <br/>    plt.plot(np.arange(range_future),np.array(prediction),<br/>            label='Prediction')<br/>    plt.legend(loc='upper left')<br/>    plt.xlabel('Time (day)')<br/>    plt.ylabel('Daily water consumption ($m^3$/capita.day)')</span><span id="d859" class="na me jj oi b gy pg on l oo op">plot_future(prediction_bilstm, y_test)<br/>plot_future(prediction_lstm, y_test)<br/>plot_future(prediction_gru, y_test)</span></pre><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/3420ce9b51eb5c05259f4487da176e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Y9naIoSbaBVzqPu0KfLqQ.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">BiLSTM æ¨¡å‹çš„çœŸå®æœªæ¥ä¸æ—¥ç”¨æ°´é‡é¢„æµ‹</p></figure><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/cb4f54f4b7c36cbf487cf6d86a54b7d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RCisyJ94jk3M2CjXIgrnxw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">LSTM æ¨¡å‹çš„çœŸå®æœªæ¥ä¸æ—¥ç”¨æ°´é‡é¢„æµ‹</p></figure><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/06d4303ea502575e3752a5a61e1246d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kfn-3WYLhsBhXTafC6tKYg.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">GRU æ¨¡å‹çš„çœŸå®æœªæ¥ä¸æ—¥ç”¨æ°´é‡é¢„æµ‹</p></figure><h1 id="449e" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">3.5 è®¡ç®— RMSE å’Œæ¢…</h1><p id="7945" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">è®©æˆ‘ç”¨ä¸¤ä¸ªæ‹Ÿåˆä¼˜åº¦æ¥è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="0628" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Define a function to calculate MAE and RMSE</strong><br/>def evaluate_prediction(predictions, actual, model_name):<br/>    errors = predictions - actual<br/>    mse = np.square(errors).mean()<br/>    rmse = np.sqrt(mse)<br/>    mae = np.abs(errors).mean()</span><span id="6290" class="na me jj oi b gy pg on l oo op">print(model_name + ':')<br/>    print('Mean Absolute Error: {:.4f}'.format(mae))<br/>    print('Root Mean Square Error: {:.4f}'.format(rmse))<br/>    print('')</span><span id="197e" class="na me jj oi b gy pg on l oo op">evaluate_prediction(prediction_bilstm, y_test, 'Bidirectional LSTM')<br/>evaluate_prediction(prediction_lstm, y_test, 'LSTM')<br/>evaluate_prediction(prediction_gru, y_test, 'GRU')</span></pre><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pl"><img src="../Images/ad0757160024f3897e8a44f488ea57e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8JA-iD_NGzr9hZu_GxQTXg.png"/></div></div></figure><p id="7eb6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">ä¸‰ä¸ªæ¨¡å‹çš„æ‹Ÿåˆä¼˜åº¦è¡¨æ˜å®ƒä»¬å…·æœ‰éå¸¸ç›¸ä¼¼çš„æ€§èƒ½ã€‚å³ä¾¿å¦‚æ­¤ï¼Œä¸ LSTM å’Œ GRU ç›¸æ¯”ï¼Œ<strong class="la jk"> BiLSTM </strong>æ¨¡å‹å…·æœ‰æ›´é«˜çš„å‡†ç¡®æ€§ã€‚å› æ­¤ï¼Œæˆ‘ä½¿ç”¨ BiLSTM æ¨¡å‹å¯¹ UWC æœªæ¥ 10 å¹´è¿›è¡Œå¤šæ­¥é¢„æµ‹ã€‚</p><p id="0c8b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">âš ï¸ <strong class="la jk">æ³¨æ„:</strong>è¿™ä¸ªé¡¹ç›®çš„ç»“æœå¹¶ä¸æ„å‘³ç€ BiLSTM æ¯” LSTM å’Œ GRU æœ‰æ›´å¥½çš„ç»“æœã€‚è¿™åªæ˜¯è¯´æ˜å¦‚ä½•æ¯”è¾ƒè¿™äº›æ¨¡å‹ï¼Œä»¥å¾—å‡ºæœ€å¯é çš„é¢„æµ‹ã€‚</p><h1 id="cd53" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">æ­¥éª¤ 4:10 å¹´ç”¨æ°´é‡çš„å¤šæ­¥é¢„æµ‹</h1><p id="50dd" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">æˆ‘åœ¨ç ”ç©¶åœ°ç‚¹å¯¼å…¥æ°”å€™æ•°æ®é¢„æµ‹ï¼Œå¹¶å¯¹ 2015 å¹´ 1 æœˆ 1 æ—¥è‡³ 2025 å¹´ 1 æœˆ 1 æ—¥æœŸé—´çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ã€‚</p><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pm"><img src="../Images/fe22db8af5b618c23fefdcd594f31070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5xMqdW2Jv3XbQKss-pfw7A.png"/></div></div></figure><p id="f7f8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">æˆ‘åˆ›å»ºäº†ä¸€ä¸ªåŠ©æ‰‹å‡½æ•°ï¼Œ<em class="oq"> plot_history_future </em>ï¼Œæ¥ç»˜åˆ¶å†å²å’Œæœªæ¥çš„ UWCã€‚ç„¶åï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ï¼Œ<em class="oq"> forecastï¼Œ</em>æ¥é‡å¡‘çœ‹ä¸è§çš„è¾“å…¥ï¼Œå¹¶ä½¿ç”¨ LSTM æ¨¡å‹è¿›è¡Œé¢„æµ‹ã€‚</p><pre class="nn no np nq gt oh oi oj ok aw ol bi"><span id="d17d" class="na me jj oi b gy om on l oo op"><strong class="oi jk"># Plot histoy and future data</strong><br/>def plot_history_future(y_train, prediction):<br/>    plt.figure(figsize=(10, 6))</span><span id="62c4" class="na me jj oi b gy pg on l oo op">    range_history = len(y_train)<br/>    range_future = list(range(range_history, range_history +<br/>                   len(prediction)))</span><span id="b3b7" class="na me jj oi b gy pg on l oo op">    plt.plot(np.arange(range_history), np.array(y_train), <br/>             label='History')<br/>    plt.plot(range_future, np.array(prediction),label='Prediction')<br/>    plt.legend(loc='upper right')<br/>    plt.xlabel('Time (day)')<br/>    plt.ylabel('Daily water consumption ($m^3$/capita.day)')</span><span id="cd61" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># Multi-step forecasting </strong><br/>def forecast(X_input, time_steps):<br/>    <strong class="oi jk"># Scale the unseen input with the scaler fitted on the train set</strong><br/>    X = input_scaler.transform(X_input)<br/>    <strong class="oi jk"># Reshape unseen data to a 3D input</strong><br/>    Xs = []<br/>    for i in range(len(X) - time_steps):<br/>        v = X[i:i+time_steps, :]<br/>        Xs.append(v)</span><span id="e679" class="na me jj oi b gy pg on l oo op">    X_transformed = np.array(Xs)</span><span id="46c9" class="na me jj oi b gy pg on l oo op"><strong class="oi jk"># Make prediction for unseen data using LSTM model</strong><br/>    prediction = model_bilstm.predict(X_transformed)<br/>    prediction_actual = scaler_y.inverse_transform(prediction)<br/>    return prediction_actual</span><span id="8655" class="na me jj oi b gy pg on l oo op">prediction = forecast(X_new, TIME_STEPS)<br/>plot_history_future(y_train, prediction)</span></pre><figure class="nn no np nq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/a2aabfb65b4b7b671225b82281d07eac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lUNJBuOXc-BraERp5Lwxqg.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">åŸºäº BiLSTM æ¨¡å‹çš„æ—¥ç”¨æ°´é‡å†å²ä¸é¢„æµ‹</p></figure><h1 id="d35f" class="md me jj bd mf mg mh mi mj mk ml mm mn kp mo kq mp ks mq kt mr kv ms kw mt mu bi translated">ç»“è®º</h1><p id="87a5" class="pw-post-body-paragraph ky kz jj la b lb mv kk ld le mw kn lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">æ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚æˆ‘çŸ¥é“è¿™æ˜¯ä¸€ä¸ªç›¸å½“é•¿çš„æ•™ç¨‹ğŸ˜æˆ‘å¸Œæœ›å®ƒèƒ½å¸®åŠ©ä½ åœ¨ Tensorflow ä¸­ä¸ºä¸€ä¸ªæ•°æ®ç§‘å­¦é¡¹ç›®å¼€å‘ LSTMã€GRU å’Œæ¯”å°”æ–¯ç‰¹å§†æ¨¡å‹ğŸ˜Š</p><p id="1df7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">éå¸¸æ„Ÿè°¢æ‚¨çš„åé¦ˆã€‚ä½ å¯ä»¥åœ¨ LinkedIn ä¸Šæ‰¾åˆ°æˆ‘ã€‚</p></div></div>    
</body>
</html>