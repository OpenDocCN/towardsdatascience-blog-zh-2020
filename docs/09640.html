<html>
<head>
<title>Read NetCDF Data with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 读取 NetCDF 数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/read-netcdf-data-with-python-901f7ff61648?source=collection_archive---------0-----------------------#2020-07-09">https://towardsdatascience.com/read-netcdf-data-with-python-901f7ff61648?source=collection_archive---------0-----------------------#2020-07-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="79b7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">访问一种有点混乱但功能强大的数据格式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/41a3b2ccd12c98350a6ff0d814c7a3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WEEoh4Yud5gLYfb0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@waldemarbrandt67w?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Waldemar Brandt </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6022" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">网络通用数据格式(NetCDF)通常用于存储多维地理数据。这些数据的一些例子是温度、降雨量和风速。存储在 NetCDF 中的变量经常在大面积(大陆)地区每天被测量多次。由于每天进行多次测量，数据值会快速积累，变得难以处理。当每个值还被分配给一个地理位置时，数据管理会变得更加复杂。NetCDF 为这些挑战提供了解决方案。本文将带您开始使用 Python 从 NetCDF 文件中读取数据。</p><h2 id="fb56" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">装置</h2><p id="644b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">NetCDF 文件可以用一些不同的 Python 模块读取。最受欢迎的是<code class="fe mt mu mv mw b">netCDF4</code>和<code class="fe mt mu mv mw b">gdal</code>。对于这篇文章，我们将严格集中在<code class="fe mt mu mv mw b">netCDF4</code>上，因为这是我个人的偏好。</p><blockquote class="mx my mz"><p id="16c0" class="kz la na lb b lc ld ju le lf lg jx lh nb lj lk ll nc ln lo lp nd lr ls lt lu im bi translated">有关如何使用 xarray 和 rioxarray 在 Python 中读取和绘制 NetCDF 数据的信息，请查看本文。</p></blockquote><p id="9383" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装很简单。我通常建议使用 anaconda Python 发行版来消除依赖关系和版本控制带来的混乱。要安装 anaconda (conda)，只需输入<code class="fe mt mu mv mw b">conda install netCDF4</code>。或者，你可以用<code class="fe mt mu mv mw b">pip</code>安装。</p><p id="0bb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了确保您的<code class="fe mt mu mv mw b">netCDF4</code>模块安装正确，在终端中启动一个交互式会话(键入<code class="fe mt mu mv mw b">python</code>并按下‘Enter’)。然后<code class="fe mt mu mv mw b">import netCDF4 as nc</code>。</p><h2 id="b0ea" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">加载 NetCDF 数据集</h2><p id="c386" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">加载数据集很简单，只需将一个 NetCDF 文件路径传递给<code class="fe mt mu mv mw b">netCDF4.Dataset()</code>。对于这篇文章，我使用了一个包含来自<a class="ae ky" href="https://daymet.ornl.gov/" rel="noopener ugc nofollow" target="_blank"> Daymet </a>的气候数据的文件。</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="e45c" class="lv lw it mw b gy ni nj l nk nl">import netCDF4 as nc</span><span id="2047" class="lv lw it mw b gy nm nj l nk nl">fn = '/path/to/file.nc4'<br/>ds = nc.Dataset(fn)</span></pre><h2 id="657c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">通用文件结构</h2><p id="6c38" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">NetCDF 文件有三个基本部分:元数据、维度和变量。变量包含元数据和数据。<code class="fe mt mu mv mw b">netCDF4</code>允许我们访问与 NetCDF 文件相关的元数据和数据。</p><h2 id="c647" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">访问元数据</h2><p id="2387" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">打印数据集<code class="fe mt mu mv mw b">ds</code>，为我们提供文件中包含的变量及其尺寸的信息。</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="d63e" class="lv lw it mw b gy ni nj l nk nl">print(ds)</span></pre><p id="2cb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和输出。。。</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="2259" class="lv lw it mw b gy ni nj l nk nl">&lt;class 'netCDF4._netCDF4.Dataset'&gt;</span><span id="0754" class="lv lw it mw b gy nm nj l nk nl">root group (NETCDF4_CLASSIC data model, file format HDF5):</span><span id="4103" class="lv lw it mw b gy nm nj l nk nl">start_year: 1980</span><span id="0031" class="lv lw it mw b gy nm nj l nk nl">source: Daymet Software Version 3.0</span><span id="e995" class="lv lw it mw b gy nm nj l nk nl">Version_software: Daymet Software Version 3.0</span><span id="f387" class="lv lw it mw b gy nm nj l nk nl">Version_data: Daymet Data Version 3.0</span><span id="3633" class="lv lw it mw b gy nm nj l nk nl">Conventions: CF-1.6</span><span id="bbfe" class="lv lw it mw b gy nm nj l nk nl">citation: Please see <a class="ae ky" href="http://daymet.ornl.gov/" rel="noopener ugc nofollow" target="_blank">http://daymet.ornl.gov/</a> for current Daymet data citation information</span><span id="6e84" class="lv lw it mw b gy nm nj l nk nl">references: Please see <a class="ae ky" href="http://daymet.ornl.gov/" rel="noopener ugc nofollow" target="_blank">http://daymet.ornl.gov/</a> for current information on Daymet references</span><span id="ac33" class="lv lw it mw b gy nm nj l nk nl">dimensions(sizes): time(1), nv(2), y(8075), x(7814)</span><span id="1e94" class="lv lw it mw b gy nm nj l nk nl">variables(dimensions): float32 time_bnds(time,nv), int16 lambert_conformal_conic(), float32 lat(y,x), float32 lon(y,x), float32 prcp(time,y,x), float32 time(time), float32 x(x), float32 y(y)</span><span id="f75e" class="lv lw it mw b gy nm nj l nk nl">groups:</span></pre><p id="7748" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面您可以看到文件格式、数据源、数据版本、引用、维度和变量的信息。我们感兴趣的变量是<code class="fe mt mu mv mw b">lat</code>、<code class="fe mt mu mv mw b">lon</code>、<code class="fe mt mu mv mw b">time</code>和<code class="fe mt mu mv mw b">prcp</code>(降水量)。有了这些变量，我们就能找到给定时间、给定地点的降雨量。该文件仅包含一个时间步长(时间维度为 1)。</p><p id="6bcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">元数据也可以作为 Python 字典访问，这(在我看来)更有用。</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="191c" class="lv lw it mw b gy ni nj l nk nl">print(ds.__dict__)</span><span id="1569" class="lv lw it mw b gy nm nj l nk nl">OrderedDict([('start_year', 1980), ('source', 'Daymet Software Version 3.0'), ('Version_software', 'Daymet Software Version 3.0'), ('Version_data', 'Daymet Data Version 3.0'), ('Conventions', 'CF-1.6'), ('citation', 'Please see <a class="ae ky" href="http://daymet.ornl.gov/" rel="noopener ugc nofollow" target="_blank">http://daymet.ornl.gov/</a> for current Daymet data citation information'), ('references', 'Please see <a class="ae ky" href="http://daymet.ornl.gov/" rel="noopener ugc nofollow" target="_blank">http://daymet.ornl.gov/</a> for current information on Daymet references')])</span></pre><p id="196e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么任何元数据项都可以用它的键来访问。例如:</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="f07b" class="lv lw it mw b gy ni nj l nk nl">print(ds.__dict__['start_year']</span><span id="58d3" class="lv lw it mw b gy nm nj l nk nl">1980</span></pre><h2 id="a795" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">规模</h2><p id="2376" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">对维度的访问类似于文件元数据。每个维度都存储为包含相关信息的维度类。可以通过遍历所有可用维度来访问所有维度的元数据，如下所示。</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="4ffd" class="lv lw it mw b gy ni nj l nk nl">for dim in ds.dimensions.values():<br/>    print(dim)</span><span id="e230" class="lv lw it mw b gy nm nj l nk nl">&lt;class 'netCDF4._netCDF4.Dimension'&gt; (unlimited): name = 'time', size = 1</span><span id="67e9" class="lv lw it mw b gy nm nj l nk nl">&lt;class 'netCDF4._netCDF4.Dimension'&gt;: name = 'nv', size = 2</span><span id="6be3" class="lv lw it mw b gy nm nj l nk nl">&lt;class 'netCDF4._netCDF4.Dimension'&gt;: name = 'y', size = 8075</span><span id="0b1e" class="lv lw it mw b gy nm nj l nk nl">&lt;class 'netCDF4._netCDF4.Dimension'&gt;: name = 'x', size = 7814</span></pre><p id="ef27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单个维度是这样访问的:<code class="fe mt mu mv mw b">ds.dimensions['x']</code>。</p><h2 id="2f2e" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">可变元数据</h2><p id="efa1" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">访问变量元数据的方式与访问维度的方式相同。下面的代码展示了这是如何做到的。我放弃了输出，因为它很长。</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="e542" class="lv lw it mw b gy ni nj l nk nl">for var in ds.variables.values():<br/>    print(var)</span></pre><p id="ac96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面为<code class="fe mt mu mv mw b">prcp</code>(降水)演示了访问特定变量信息的程序。</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="349a" class="lv lw it mw b gy ni nj l nk nl">print(ds['prcp'])</span></pre><p id="005b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和输出。。。</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="73c2" class="lv lw it mw b gy ni nj l nk nl">&lt;class 'netCDF4._netCDF4.Variable'&gt;</span><span id="bc9d" class="lv lw it mw b gy nm nj l nk nl">float32 prcp(time, y, x)</span><span id="3ef5" class="lv lw it mw b gy nm nj l nk nl">_FillValue: -9999.0</span><span id="be23" class="lv lw it mw b gy nm nj l nk nl">coordinates: lat lon</span><span id="a01b" class="lv lw it mw b gy nm nj l nk nl">grid_mapping: lambert_conformal_conic</span><span id="af20" class="lv lw it mw b gy nm nj l nk nl">missing_value: -9999.0</span><span id="590d" class="lv lw it mw b gy nm nj l nk nl">cell_methods: area: mean time: sum within days time: sum over days</span><span id="0404" class="lv lw it mw b gy nm nj l nk nl">units: mm</span><span id="3635" class="lv lw it mw b gy nm nj l nk nl">long_name: annual total precipitation</span><span id="3f2c" class="lv lw it mw b gy nm nj l nk nl">unlimited dimensions: time</span><span id="7d50" class="lv lw it mw b gy nm nj l nk nl">current shape = (1, 8075, 7814)</span></pre><h2 id="dbbd" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">访问数据值</h2><p id="ab9f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">通过数组索引访问实际的降水数据值，并返回一个<code class="fe mt mu mv mw b">numpy</code>数组。所有变量数据返回如下:</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="f4b7" class="lv lw it mw b gy ni nj l nk nl">prcp =<!-- --> <!-- -->ds['prcp'][:]</span></pre><p id="1022" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者可以返回一个子集。下面的代码返回一个 2D 子集。</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="5f70" class="lv lw it mw b gy ni nj l nk nl">prcp =<!-- --> <!-- -->ds['prcp'][0, 4000:4005, 4000:4005]</span></pre><p id="3327" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是 2D 子集的结果。</p><pre class="kj kk kl km gt ne mw nf ng aw nh bi"><span id="2c3e" class="lv lw it mw b gy ni nj l nk nl">[[341.0 347.0 336.0 329.0 353.0]</span><span id="bfb7" class="lv lw it mw b gy nm nj l nk nl">[336.0 339.0 341.0 332.0 349.0]</span><span id="484d" class="lv lw it mw b gy nm nj l nk nl">[337.0 340.0 334.0 336.0 348.0]</span><span id="d3cb" class="lv lw it mw b gy nm nj l nk nl">[342.0 344.0 332.0 338.0 350.0]</span><span id="b9cf" class="lv lw it mw b gy nm nj l nk nl">[350.0 351.0 342.0 346.0 348.0]]</span></pre><h2 id="ec0b" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结论</h2><p id="0691" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">NetCDF 文件通常用于地理时间序列数据。最初，由于包含大量数据，并且与最常用的 csv 和光栅文件的格式不同，使用它们可能有点吓人。NetCDF 是记录地理数据的好方法，因为它内置了文档和元数据。这使得最终用户可以毫不含糊地准确理解数据所代表的内容。NetCDF 数据以 numpy 数组的形式访问，这为分析和整合到现有工具和工作流中提供了许多可能性。</p></div></div>    
</body>
</html>