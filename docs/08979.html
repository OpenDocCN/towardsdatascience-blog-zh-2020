<html>
<head>
<title>Using Machine Learning to Predict Country Population</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用机器学习预测国家人口</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-machine-learning-to-predict-country-population-550f9e5f3e24?source=collection_archive---------23-----------------------#2020-06-28">https://towardsdatascience.com/using-machine-learning-to-predict-country-population-550f9e5f3e24?source=collection_archive---------23-----------------------#2020-06-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2e9d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">基于 50 多年的人口记录来预测下一年人口的简单线性回归模型。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f2a1ab9be5f58fcfbf12a276d7bbdfce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rvatBVxBlOyeGxClUwk1wg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@ryoji__iwata?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">岩田良治</a>在<a class="ae kv" href="/s/photos/people?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="a34b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">机器学习已经成为最近的热门话题之一。有很多开发和研究正在进行，以保持这一领域向前发展。在本文中，我将演示一个简单的线性回归模型，该模型将预测一个国家未来几年的人口。</p><p id="0448" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我不打算在这里详细解释线性回归，因为在 Medium 中有许多文章和许多在线课程提供了对线性回归的深入讨论。我将简单地展示和解释一个使用 python 中的线性回归开发的小项目。这个项目中使用的数据集是从<a class="ae kv" href="https://data.worldbank.org/indicator/SP.POP.TOTL" rel="noopener ugc nofollow" target="_blank">世界银行</a>收集的。</p><p id="63c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此项目需要以下库。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="f992" class="lx ly iq lt b gy lz ma l mb mc">import pandas as pd<br/>import numpy as np<br/><em class="md">from</em> sklearn.linear_model <em class="md">import</em> LinearRegression<br/><em class="md">import</em> re<br/><em class="md">import</em> json</span></pre><p id="7ce8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要忽略代码输出中的警告，可以使用警告模块，但这是可选的。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="e227" class="lx ly iq lt b gy lz ma l mb mc"><em class="md">import</em> warnings<br/>warnings.filterwarnings("ignore")</span></pre><p id="04f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">导入必要的库之后，现在是将数据加载到熊猫数据报的时候了。下载后我把人口文件保存为 pop.csv。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="ff59" class="lx ly iq lt b gy lz ma l mb mc">df = pd.read_csv('pop.csv')<br/>df.head()</span></pre><p id="a246" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将产生以下结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi me"><img src="../Images/504437eefeed3cd467d0806edd1aeebb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kq6u3-yL3JDxWX0ODwp2uQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">df.head()</p></figure><p id="a20a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从上图可以看出，在将数据传递给线性回归模型之前，还需要进行一些预处理。有几个不必要的列，如指标代码、指标名称和本项目不需要的其他列。在此之前，我想根据国家名称列选择一个国家。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="0af7" class="lx ly iq lt b gy lz ma l mb mc">bd=df.loc[df['Country Name']=='Bangladesh']<br/>bd.drop(['Country Name','Country Code','Indicator Name','Indicator Code'],axis=1,inplace=True)<br/>bd = bd.T<br/>bd.head()</span></pre><p id="22e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我以前在这里。loc 选择孟加拉国，选择后，我删除了四列，这样我就有了所有年份的列和人口的行。我调换了数据框架，这样我就只有两列，即年份和人口。下图是上述代码的结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mf"><img src="../Images/f15c4b8af76410d7a3cde987806340bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*mJKvY2DDm0wDiX4OT6guRg.jpeg"/></div></div></figure><p id="d647" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是没有显示列名，而是显示 18。此外，年份显示为一个索引。对于自回归(AR)模型来说，如果年份被显示为指数，那就很好了。但是对于线性回归，我希望 year 作为一个不同的列，而不是一个索引。因为</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="b39a" class="lx ly iq lt b gy lz ma l mb mc">y = mx + c</span></pre><p id="7b13" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个简单的线性回归公式，其中<em class="md"> y </em>是预测变量或因变量，<em class="md"> x </em>是自变量，<em class="md"> m </em>是斜率或系数，<em class="md"> c </em>是截距。在这个项目中，<em class="md"> x </em>是年份，<em class="md"> y </em>是预测人口。因此，下面的代码将帮助我准备过程和重命名列。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="ae2b" class="lx ly iq lt b gy lz ma l mb mc">bd.dropna(inplace=True)<br/>bd=bd.reset_index().rename(columns={18:'population','index':'year'})<br/>bd.head()</span></pre><p id="4315" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将产生以下结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/0e45a4d9dafee7f9def6e2b5f0448640.png" data-original-src="https://miro.medium.com/v2/resize:fit:342/format:webp/1*JtjG64ipvPvvVnDuuxeJQw.jpeg"/></div></figure><p id="f215" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我可以使用这个数据框架来训练线性回归模型，并获得所需的输出。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="d9d8" class="lx ly iq lt b gy lz ma l mb mc">x = bd.iloc[:, 0].values.reshape(-1, 1)<br/>y = bd.iloc[:, 1].values.reshape(-1, 1)<br/>model = LinearRegression().fit(x, y)<br/>y_pred = model.predict([[2019]])<br/>y_pred</span></pre><p id="7aa6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这段代码中，我将我的年份和人口转换为 2D 数组，这是 LinearRegression 中需要使用的。然后我简单的调用了模型，在模型中拟合 x 和 y。之后我用 model.predict()预测了下面这个结果。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="4c38" class="lx ly iq lt b gy lz ma l mb mc">array([[1.65040186e+08]])</span></pre><p id="6bdb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，所有这些都很好，但我有 100 多个国家的人口信息，我只限于一个国家使用上面的代码块。上面的代码块将作为下面代码块的主干，它将显示原始项目的实现。这个项目将接受国家和年份的用户输入，之后，我可以像以前一样做一些预处理，稍微调整一下，并使用线性回归模型来显示预测的结果。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="b8c6" class="lx ly iq lt b gy lz ma l mb mc">def main():<br/>    country = input("Please input the country name: ").lower()<br/>    year = int(input("Please input the year to predict: "))<br/>    df = pd.read_csv('pop.csv')<br/>    lists, df = country_list_gen(df)<br/>    if country in lists:<br/>        df = selecting_country(df, country)<br/>        model = prediction_model(df)<br/>        result = prediction(model,year)<br/>        print(f"\n Result: {country.upper()} population in {year} will be {result:,d}")<br/>    else:<br/>        print('kindly check country name spelling from country_list.json')<br/>    <br/>if __name__ == "__main__":<br/>    main()</span></pre><p id="cbce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码是我的脚本的主要功能。首先，它接受用户输入的国家名称，并将其转换成小写字符串。之后它也会以年份为输入，转换成整数。然后使用 pandas read_csv()将原始 CSV 文件加载到 dataframe 中。然后，它执行下面的函数。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="2665" class="lx ly iq lt b gy lz ma l mb mc">def country_list_gen(df):<br/>    df.rename(columns={'Country Name':'country_name'},inplace=True)<br/>    df['country_name'] = df['country_name'].apply(lambda row: row.lower())<br/>    lists = df['country_name'].unique().tolist()<br/>    with open('country_list.json','w', encoding='utf-8') as f:<br/>        json.dump(lists, f, ensure_ascii=False,indent=4)<br/>    return lists, df</span></pre><p id="35fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个将所有唯一的国家名称存储在 JSON 文件中的功能，这将帮助用户检查该国家是否可用，以及是否有任何拼写错误。该函数将原始数据帧作为输入参数，并重命名 country_name 列。之后，它将使用。应用()和 lambda 函数。然后，所有唯一的国家名称被转换成列表，并保存为 country_list.json 文件。最后，它将列表和修改后的数据帧返回给主函数。为了便于阅读，我再次给出了主要的函数代码。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="f4a7" class="lx ly iq lt b gy lz ma l mb mc">def main():<br/>    country = input("Please input the country name: ").lower()<br/>    year = int(input("Please input the year to predict: "))<br/>    df = pd.read_csv('pop.csv')<br/>    lists, df = country_list_gen(df)<br/>    if country in lists:<br/>        df = selecting_country(df, country)<br/>        model = prediction_model(df)<br/>        result = prediction(model,year)<br/>        print(f"\n Result: {country.upper()} population in {year} will be {result:,d}")<br/>    else:<br/>        print('kindly check available country name and thier spelling from country_list.json')</span></pre><p id="27b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，返回的列表包含可用的国家名称，因此执行一个简单的 if-else 语句。如果用户输入的国家名称在列表中不可用，或者如果我的列表中有拼写错误，那么它会指示用户查看 country_list.json 文件。但是，如果名称已经匹配，那么它将执行以下功能。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="5906" class="lx ly iq lt b gy lz ma l mb mc">def selecting_country(df,country):<br/>    df = df.loc[df['country_name']==country]<br/>    df.drop(['country_name','Country Code','Indicator Name','Indicator Code'],axis=1,inplace=True)<br/>    df = df.T<br/>    df.dropna(inplace=True)<br/>    df = df.reset_index()<br/>    return df</span><span id="fc67" class="lx ly iq lt b gy mh ma l mb mc">def prediction_model(df):<br/>    x = df.iloc[:, 0].values.reshape(-1,1)<br/>    y = df.iloc[:, 1].values.reshape(-1,1)<br/>    model = LinearRegression().fit(x,y)<br/>    return model</span><span id="139b" class="lx ly iq lt b gy mh ma l mb mc">def prediction(model, year):<br/>    return int(model.coef_[0][0] * year + model.intercept_[0])</span></pre><p id="9cb8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">selecting _ country 函数获取国家名称并过滤数据帧，然后丢弃不必要的字段，转置并重置数据帧的索引，并将其返回给主函数。然后，主函数调用 prediction_model，并将数据帧作为参数发送。在这里，我不关心重命名列名，因为我将它们转换为 x 和 y 的 2D 数组。之后，调用 LinearRegression()并用 x 和 y 拟合模型。然后，拟合的模型被发送到主函数。然后，主函数将这个模型与用户在预测函数中提示的年份一起传递。该预测函数只需从模型中获取系数和截距，并使用“y=mx+c”来导出预测的人口。</p><p id="cd80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面给出了两种不同场景的示例输出，一种是正确的国家名称，另一种是错误的拼写。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/7b537736d06cc238cbbf2ce3a214733f.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*R9u4CVISMekEH6ugsurZ1w.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">正确名称</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mj"><img src="../Images/ddcd1bc0dd9bda24627c4a14fc30a1bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gBqMUn3313QstZWEmvLRKw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">拼写错误</p></figure><p id="8629" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我在一小时内完成的项目。这是一个非常简单和容易实现的项目，并且对线性回归模型有实际的理解。我来自孟加拉国，这就是我在这篇文章中使用孟加拉国作为国名的原因。你可以从<a class="ae kv" href="https://github.com/aesutsha/population-prediction" rel="noopener ugc nofollow" target="_blank"> GitHub </a>访问并查看完整代码。你可以在这里看到我以前的文章<a class="ae kv" rel="noopener" target="_blank" href="/using-free-api-to-get-geolocation-information-from-public-ip-address-8fe23a88df9b"/>，它是关于使用免费 API 从公共 IP 地址获取地理位置信息的。</p><p id="c3a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">非常感谢您阅读我的文章。我希望，当我做这个项目和写这篇文章的时候，你学到了一些新的东西。</p></div></div>    
</body>
</html>