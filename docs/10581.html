<html>
<head>
<title>Downloading OpenImages Dataset in Google Drive using Colab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Colab 下载 Google Drive 中的 OpenImages 数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/downloading-openimages-dataset-in-google-drive-using-colab-132502f0dbde?source=collection_archive---------37-----------------------#2020-07-24">https://towardsdatascience.com/downloading-openimages-dataset-in-google-drive-using-colab-132502f0dbde?source=collection_archive---------37-----------------------#2020-07-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fff7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">下载您的自定义数据集</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bbc43cb1ff44b987468f485a81b06461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NMsiwi7SanSiuieQBgqEGw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://storage.googleapis.com/openimages/web/index.html" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/openimages/web/index.html</a></p></figure><p id="aecf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想要在自定义数据集上训练您的计算机视觉模型，但不想在网上搜索图像。试试 OpenImages 吧，这是一个开源数据集，拥有约 900 万张不同的图像，有 600 个对象类别和谷歌提供的丰富注释。数据集包含图像级标签注释、对象边界框、对象分段、视觉关系、本地化叙述等。</p><p id="9ce6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以根据自己的兴趣下载特定的类别，而不是下载整个数据集。在本文中，我们将使用 google colab 下载一些选定的类/类别，并将数据保存在 Google Drive 中。您也可以在本地运行时使用 jupyter notebook。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="2568" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mc">对于这篇文章，你需要一个谷歌账户和谷歌硬盘空间来下载数据。</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><ol class=""><li id="d0ad" class="md me it lb b lc ld lf lg li mf lm mg lq mh lu mi mj mk ml bi translated">在 Colab 中安装您的 Google Drive。</li></ol><p id="bb27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.创建一个存储数据的文件夹。在这里，我创建了一个名为<strong class="lb iu"> OpenImages 的目录。</strong></p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="e386" class="mr ms it mn b gy mt mu l mv mw">!mkdir OpenImages</span></pre><p id="b35c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.将工作目录更改为您刚刚创建的文件夹。使用“！pwd”命令。</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="4013" class="mr ms it mn b gy mt mu l mv mw">cd OpenImages</span></pre><p id="e98c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.运行以下命令，下载用于训练、测试和验证的注释文件以及类文件。</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="32cf" class="mr ms it mn b gy mt mu l mv mw"><em class="mc"># Download required meta-files</em><br/><em class="mc">!wget https://storage.googleapis.com/openimages/2018_04/class-descriptions-boxable.csv</em><br/> <br/><em class="mc">!wget https://storage.googleapis.com/openimages/2018_04/train/train-annotations-bbox.csv</em><br/> <br/><em class="mc">!wget https://storage.googleapis.com/openimages/2018_04/validation/validation-annotations-bbox.csv</em><br/> <br/><em class="mc">!wget https://storage.googleapis.com/openimages/2018_04/test/test-annotations-bbox.csv</em></span></pre><p id="ddc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.使用 GitHub 链接将 downloadOI.py 保存在您的工作目录中(<a class="ae ky" href="https://github.com/spmallick/learnopencv/blob/master/downloadOpenImages/downloadOI.py" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/SPM lick/learnopencv/blob/master/download open images/download oi . py</a>)或者复制链接中的代码并直接创建文件，如下所示。(感谢<strong class="lb iu">SATA ya mal lick</strong>/<strong class="lb iu">learnopencv</strong>提供了这个令人惊叹的代码库。如果你对计算机视觉和 OpenCV 感兴趣，一定要看看这个神奇的 Github 库。</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="3897" class="mr ms it mn b gy mt mu l mv mw">#This magic function is used to create the files.downloadOI.py is the file name<br/>%%writefile downloadOI.py</span><span id="7e58" class="mr ms it mn b gy mx mu l mv mw">#Author : Sunita Nayak, Big Vision LLC<br/><br/>#### Usage example: python3 downloadOI.py --classes 'Ice_cream,Cookie' --mode train<br/><br/>import argparse<br/>import csv<br/>import subprocess<br/>import os<br/>from tqdm import tqdm<br/>import multiprocessing<br/>from multiprocessing import Pool as thread_pool<br/><br/>cpu_count = multiprocessing.cpu_count()<br/><br/>parser = argparse.ArgumentParser(description='Download Class specific images from OpenImagesV4')<br/>parser.add_argument("--mode", help="Dataset category - train, validation or test", required=True)<br/>parser.add_argument("--classes", help="Names of object classes to be downloaded", required=True)<br/>parser.add_argument("--nthreads", help="Number of threads to use", required=False, type=int, default=cpu_count*2)<br/>parser.add_argument("--occluded", help="Include occluded images", required=False, type=int, default=1)<br/>parser.add_argument("--truncated", help="Include truncated images", required=False, type=int, default=1)<br/>parser.add_argument("--groupOf", help="Include groupOf images", required=False, type=int, default=1)<br/>parser.add_argument("--depiction", help="Include depiction images", required=False, type=int, default=1)<br/>parser.add_argument("--inside", help="Include inside images", required=False, type=int, default=1)<br/><br/>args = parser.parse_args()<br/><br/>run_mode = args.mode<br/><br/>threads = args.nthreads<br/><br/>classes = []<br/>for class_name in args.classes.split(','):<br/>    classes.append(class_name)<br/><br/>with open('./class-descriptions-boxable.csv', mode='r') as infile:<br/>    reader = csv.reader(infile)<br/>    dict_list = {rows[1]:rows[0] for rows in reader}<br/><br/>subprocess.run(['rm', '-rf', run_mode])<br/>subprocess.run([ 'mkdir', run_mode])<br/><br/>pool = thread_pool(threads)<br/>commands = []<br/>cnt = 0<br/><br/>for ind in range(0, len(classes)):<br/>    <br/>    class_name = classes[ind]<br/>    print("Class "+str(ind) + " : " + class_name)<br/>    <br/>    subprocess.run([ 'mkdir', run_mode+'/'+class_name])<br/><br/>    command = "grep "+dict_list[class_name.replace('_', ' ')] + " ./" + run_mode + "-annotations-bbox.csv"<br/>    class_annotations = subprocess.run(command.split(), stdout=subprocess.PIPE).stdout.decode('utf-8')<br/>    class_annotations = class_annotations.splitlines()<br/><br/>    for line in class_annotations:<br/><br/>        line_parts = line.split(',')<br/>        <br/>        #IsOccluded,IsTruncated,IsGroupOf,IsDepiction,IsInside<br/>        if (args.occluded==0 and int(line_parts[8])&gt;0):<br/>            print("Skipped %s",line_parts[0])<br/>            continue<br/>        if (args.truncated==0 and int(line_parts[9])&gt;0):<br/>            print("Skipped %s",line_parts[0])<br/>            continue<br/>        if (args.groupOf==0 and int(line_parts[10])&gt;0):<br/>            print("Skipped %s",line_parts[0])<br/>            continue<br/>        if (args.depiction==0 and int(line_parts[11])&gt;0):<br/>            print("Skipped %s",line_parts[0])<br/>            continue<br/>        if (args.inside==0 and int(line_parts[12])&gt;0):<br/>            print("Skipped %s",line_parts[0])<br/>            continue<br/><br/>        cnt = cnt + 1<br/><br/>        command = 'aws s3 --no-sign-request --only-show-errors cp s3://open-images-dataset/'+run_mode+'/'+line_parts[0]+'.jpg '+ run_mode+'/'+class_name+'/'+line_parts[0]+'.jpg'<br/>        commands.append(command)<br/>        <br/>        with open('%s/%s/%s.txt'%(run_mode,class_name,line_parts[0]),'a') as f:<br/>            f.write(','.join([class_name, line_parts[4], line_parts[5], line_parts[6], line_parts[7]])+'\n')<br/><br/>print("Annotation Count : "+str(cnt))<br/>commands = list(set(commands))<br/>print("Number of images to be downloaded : "+str(len(commands)))<br/><br/>list(tqdm(pool.imap(os.system, commands), total = len(commands) ))<br/><br/>pool.close()<br/>pool.join()</span></pre><p id="4775" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6.目录<strong class="lb iu"> OpenImages </strong>中的内容应该是这样的</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/7b5c48b595805ef538ed331796a7dabe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8zVRan4eg1dmpkokveFMKw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">目录的内容</p></figure><p id="bf77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">7.运行以下命令以避免“<strong class="lb iu">AWS:not found sh:1:AWS:not found</strong>”错误。</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="c0c8" class="mr ms it mn b gy mt mu l mv mw">!pip install awscli</span></pre><p id="078e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">8.下载特定数据。在这里我下载了 2 个类<strong class="lb iu">水槽</strong>和<strong class="lb iu">马桶</strong>。您可以尝试多个类并下载数据。你可以在“<strong class="lb iu"><em class="mc">class-descriptions-box able . CSV</em></strong><em class="mc">”中找到所有的类名。</em></p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="82c4" class="mr ms it mn b gy mt mu l mv mw"><em class="mc"># Download Sink and Toilet images for test</em> <br/>!python3 downloadOI.py --classes "Sink,Toilet" --mode test</span><span id="5f31" class="mr ms it mn b gy mx mu l mv mw"><em class="mc"># Download Sink and Toilet images for train<br/></em>!python3 downloadOI.py --classes "Sink,Toilet" --mode train</span><span id="3621" class="mr ms it mn b gy mx mu l mv mw"><em class="mc"># Download Sink and Toilet images for validation<br/></em>!python3 downloadOI.py --classes "Sink,Toilet" --mode validation</span></pre><p id="b42e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有 3 种模式可供选择</p><p id="7c99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mc"> a) </em> <strong class="lb iu"> <em class="mc"> —模式训练</em> </strong> <em class="mc">:下载训练数据</em></p><p id="eac7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mc"> b) </em> <strong class="lb iu"> <em class="mc"> —模式测试</em> </strong> <em class="mc">:下载测试数据</em></p><p id="fdbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mc"> c) </em> <strong class="lb iu"> <em class="mc"> —模式验证</em> </strong> <em class="mc">:下载验证数据</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/7a4ce0f4add2be4019e01488e1cbddfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*JC5nnSOZk0LWK0E9ulLBcg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这是下载数据的外观</p></figure><p id="7ace" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个类别都有一个图像文件以及文本文件中的注释。</p><ul class=""><li id="0328" class="md me it lb b lc ld lf lg li mf lm mg lq mh lu na mj mk ml bi translated">文件路径:<code class="fe nb nc nd mn b">OpenImages/train/Sink/01681d52ad599ab4.jpg</code></li><li id="d7c8" class="md me it lb b lc ne lf nf li ng lm nh lq ni lu na mj mk ml bi translated">图像文件:<code class="fe nb nc nd mn b">01681d52ad599ab4.jpg</code></li><li id="4323" class="md me it lb b lc ne lf nf li ng lm nh lq ni lu na mj mk ml bi translated">文本文件:<code class="fe nb nc nd mn b">01681d52ad599ab4.txt</code></li><li id="f602" class="md me it lb b lc ne lf nf li ng lm nh lq ni lu na mj mk ml bi translated">文本文件内容:<code class="fe nb nc nd mn b">Sink,0.249529,0.420054,0.659844,0.682363</code></li></ul><p id="ca46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">。txt 文件具有边界框的尺寸。如果图像有多个对象，它可以有多个条目。</p><p id="d9fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:请记住，每次运行这个命令时，旧的数据都会被删除。因此，如果你想再次使用该命令，最好在其他文件夹中尝试，以避免删除之前下载的数据。</p><p id="d755" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已。使用它并下载自定义数据来训练您的自定义计算机视觉模型。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="2926" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Github 链接到代码<a class="ae ky" href="https://github.com/mringupt/Colab/blob/master/Downloading_OpenImages_Custom_Dataset.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/mringup/Colab/blob/master/Downloading _ open images _ Custom _ dataset . ipynb</a></p></div></div>    
</body>
</html>