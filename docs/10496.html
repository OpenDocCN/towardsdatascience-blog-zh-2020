<html>
<head>
<title>Why we should use Python Decorator more often</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我们应该更频繁地使用 Python Decorator</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-we-should-use-python-decorator-more-often-e59b56b2b8df?source=collection_archive---------16-----------------------#2020-07-23">https://towardsdatascience.com/why-we-should-use-python-decorator-more-often-e59b56b2b8df?source=collection_archive---------16-----------------------#2020-07-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="ee4e" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">Python 装饰者</h2><div class=""/><div class=""><h2 id="9521" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">Python Decorator 是一个强大的工具，它可以帮助我们操作一个函数的功能，一个只需添加@decorator_name 的测试方法</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/faafca4ee9491258894eeb0b39a8df51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFzB0wkW8dFNhTAl34Dxzg.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">马库斯·斯皮斯克在<a class="ae lh" href="https://unsplash.com/s/photos/decorate?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="3820" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi ml translated"><span class="l mm mn mo bm mp mq mr ms mt di">在</span> Python 中，一切都是对象，这意味着每个实体都有一些元数据(称为<em class="mu">属性</em>)和相关的功能(称为<em class="mu">方法</em>)。这些属性和方法是通过点语法访问的。我们定义的名字只是绑定到这些对象的标识符。函数也不例外，它们也是对象(带有属性)。同一个函数对象可以绑定各种不同的名称。</p><p id="804b" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">例如:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="5b93" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">这里我们将函数赋给一个变量。我们会注意到，变量赋值后，就变成了函数。下面是 test_decorator 的输出:</p><pre class="ks kt ku kv gt mx my mz na aw nb bi"><span id="0ba3" class="nc nd it my b gy ne nf l ng nh">test_decorators.py::test_decorator PASSED                                [100%]8<br/>3</span></pre><p id="97e4" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">Python 中的函数也可以将其他函数作为输入，然后返回其他函数。这种技术被称为高阶函数。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="3b7d" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">这里我们传递函数(double 或 triple)作为函数 operate 的输入。当运行 test_decorator 时，我们将在控制台中看到:</p><pre class="ks kt ku kv gt mx my mz na aw nb bi"><span id="838f" class="nc nd it my b gy ne nf l ng nh">test_decorators.py::test_decorator PASSED                                [100%]6<br/>9</span></pre><p id="04e0" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">函数和方法被称为<strong class="lr jd">可调用的</strong>，因为它们可以被调用。</p><p id="54a9" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">事实上，任何实现特殊的<code class="fe ni nj nk my b">__call__()</code>方法的对象都被称为 callable。所以，在最基本的意义上，装饰器是一个返回可调用对象的可调用对象。</p><p id="f4c9" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">基本上，装饰者接受一个函数，添加一些功能并返回它。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="9748" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">运行 test_decorator 会显示</p><pre class="ks kt ku kv gt mx my mz na aw nb bi"><span id="c0a9" class="nc nd it my b gy ne nf l ng nh">test_decorators.py::test_decorator PASSED                                [100%]I got decorated<br/>I am ordinary<br/>None</span></pre><p id="5353" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">通常，我们会看到使用@decorator_name 以语法糖的方式编写 decorator</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="14c1" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">运行 test_decorator 会显示相同的</p><pre class="ks kt ku kv gt mx my mz na aw nb bi"><span id="f1fb" class="nc nd it my b gy ne nf l ng nh">test_decorators.py::test_decorator PASSED                                [100%]I got decorated<br/>I am ordinary<br/>None</span></pre></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="6fc2" class="nl nd it bd nm nn no np nq nr ns nt nu ki nv kj nw kl nx km ny ko nz kp oa ob bi translated">可以一起玩的简单装饰</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="9220" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">这是一个简单的装饰器，为使用该装饰器的方法打印开始时间和结束时间。</p><p id="b4e7" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">在控制台中，您将看到</p><pre class="ks kt ku kv gt mx my mz na aw nb bi"><span id="5cbc" class="nc nd it my b gy ne nf l ng nh">test_decorators.py::test_decorator_simple PASSED                         [100%]Start time is : 2020-07-21 14:41:44.064251<br/>Time in test : 2020-07-21 14:41:44.064337<br/>End time is : 2020-07-21 14:41:44.064366</span></pre></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="f069" class="nl nd it bd nm nn no np nq nr ns nt nu ki nv kj nw kl nx km ny ko nz kp oa ob bi translated">有争论的装饰者</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="1cf1" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">运行测试代码将向控制台显示这一点</p><pre class="ks kt ku kv gt mx my mz na aw nb bi"><span id="1dc7" class="nc nd it my b gy ne nf l ng nh">test_decorators.py::test_decorator_with_arguments PASSED                 [100%]Inside wrapped_f()<br/>Decorator arguments: Donald Le 1990<br/>Testing decorator with arguments<br/>After f(*args)</span></pre></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="d465" class="nl nd it bd nm nn no np nq nr ns nt nu ki nv kj nw kl nx km ny ko nz kp oa ob bi translated">用 Python 链接装饰器</h1><p id="8487" class="pw-post-body-paragraph lp lq it lr b ls oc kd lu lv od kg lx ly oe ma mb mc of me mf mg og mi mj mk im bi translated">在 Python 中，多个装饰者可以链接在一起。</p><p id="55af" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">也就是说，一个函数可以用不同的(或相同的)装饰者进行多次装饰。我们简单地将装饰器放在期望的功能之上。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="67e3" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">运行这个将显示</p><pre class="ks kt ku kv gt mx my mz na aw nb bi"><span id="8f68" class="nc nd it my b gy ne nf l ng nh">test_decorators.py::test_decorator PASSED                                [100%]..............................<br/>Start time is 2020-07-22 10:35:17.462552<br/>Test Decorator<br/>End time is 2020-07-22 10:35:17.462579<br/>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></pre></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="1a28" class="nl nd it bd nm nn no np nq nr ns nt nu ki nv kj nw kl nx km ny ko nz kp oa ob bi translated">Decorators 与 pytest 等其他框架集成</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="5ea6" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">然后我们可以在测试方法中使用它</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="face" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">很好奇装饰器的值是如何使用的，它实际上是在收集 testrail id 的 pytest 挂钩中使用的。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="0efc" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">这是我们如何从 pytest 获得装饰值的:</p><pre class="ks kt ku kv gt mx my mz na aw nb bi"><span id="aabe" class="nc nd it my b gy ne nf l ng nh">testrail_ids = item.get_closest_marker('testrail').kwargs.get('ids')</span></pre><p id="d763" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">就是这样。</p><p id="0a45" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">感谢您阅读我的帖子。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="e8ac" class="nl nd it bd nm nn no np nq nr ns nt nu ki nv kj nw kl nx km ny ko nz kp oa ob bi translated">参考</h1><p id="7313" class="pw-post-body-paragraph lp lq it lr b ls oc kd lu lv od kg lx ly oe ma mb mc of me mf mg og mi mj mk im bi translated"><a class="ae lh" href="https://www.geeksforgeeks.org/decorators-in-python/" rel="noopener ugc nofollow" target="_blank">https://www.geeksforgeeks.org/decorators-in-python/</a></p><div class="oh oi gp gr oj ok"><a href="https://python-3-patterns-idioms-test.readthedocs.io/en/latest/PythonDecorators.html" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd jd gy z fp op fr fs oq fu fw jc bi translated">装饰者——Python 3 模式、配方和习惯用法</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">请注意，本章是一项正在进行的工作；在我完成之前，你最好不要开始改变…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">python-3-模式-习语-test.readthedocs.io</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy lb ok"/></div></div></a></div><div class="oh oi gp gr oj ok"><a href="https://www.programiz.com/python-programming/decorator" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd jd gy z fp op fr fs oq fu fw jc bi translated">Python 装饰者</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">Python 有一个有趣的特性，叫做 decorators，用于向现有代码添加功能。这也叫…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">www.programiz.com</p></div></div></div></a></div><p id="44cb" class="pw-post-body-paragraph lp lq it lr b ls lt kd lu lv lw kg lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated"><strong class="lr jd">注</strong>:如果你喜欢这个故事，想看类似这样的故事，而你还没有订阅媒体，请通过这个链接【https://ledinhcuong99.medium.com/membership】的<a class="ae lh" href="https://ledinhcuong99.medium.com/membership" rel="noopener">订阅媒体</a>。这可以支持我这样写内容。谢谢大家！</p></div></div>    
</body>
</html>