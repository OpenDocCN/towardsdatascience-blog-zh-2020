<html>
<head>
<title>Calculate and Plot S&amp;P 500 Daily Returns</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">计算并绘制标准普尔 500 每日回报</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/calculate-and-plot-s-p-500-daily-returns-2ce359e014d6?source=collection_archive---------5-----------------------#2020-02-08">https://towardsdatascience.com/calculate-and-plot-s-p-500-daily-returns-2ce359e014d6?source=collection_archive---------5-----------------------#2020-02-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3ba6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 Python，Pandas 和 Matplotlib</h2></div><p id="2ee1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大多数投资者总是试图找到一个简单问题的答案，即<em class="lb">金融市场未来将如何表现</em>。</p><p id="4dfa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">显然，没有人知道答案，因此，投资者和金融分析师花费大量时间试图找出对未来股票价格的最佳估计。<strong class="kh ir">蟒蛇和熊猫</strong>可以成为一个伟大的盟友，帮助我们找到上述问题的最佳答案。在这个故事中，我们将编写一个 Python 脚本，它将让我们:</p><ul class=""><li id="4a23" class="lc ld iq kh b ki kj kl km ko le ks lf kw lg la lh li lj lk bi translated"><strong class="kh ir">用 Python 和熊猫检索市场数据</strong></li><li id="35e8" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lh li lj lk bi translated"><strong class="kh ir">计算市场日收益率</strong></li><li id="0bf0" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lh li lj lk bi translated"><strong class="kh ir">在图表中绘制市场日收益率</strong></li></ul><p id="c877" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">读完这篇文章后，你将能够分析你感兴趣的任何公司的市场回报。我们开始吧。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/05ec65503cafeb55befe0bdb826d3c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zYdIvtzKNytPiHTk"/></div></div><p class="mc md gj gh gi me mf bd b be z dk translated">斯蒂芬·道森在<a class="ae mg" href="https://unsplash.com/s/photos/stock-market?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="2b5d" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">用 Python 检索市场数据</h1><p id="cd0d" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">首先，要进行任何分析，我们都需要数据。幸运是，使用 Python 我们可以在几秒钟内下载数百个数据点。对于我们的分析，我们需要检索股票价格形式的市场数据。</p><p id="7929" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为市场数据的代理，我将使用<strong class="kh ir"> </strong> <a class="ae mg" href="https://en.wikipedia.org/wiki/S%26P_500_Index" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> S &amp; P 500 指数</strong> </a>来跟踪美国 500 家最大公司的<strong class="kh ir">表现。</strong></p><p id="4d4e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">标准普尔 500 日报的数据可以使用 Pandas 和 Pandas DataReader 提取。Pandas DataReader 是一个很棒的软件包，可以用 Pandas 远程访问数据。</p><p id="ad68" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在 Pandas DataReader 中，我们有多个来源可以下载数据，用 Python 执行多种财务分析。例如，我们可以从可靠的提供商那里获得股票数据或经济指标。查看<a class="ae mg" href="https://pandas-datareader.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Pandas DataReader </a>文档了解更多信息。</p><p id="f47d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了我们的分析，我们将从<a class="ae mg" href="https://pandas-datareader.readthedocs.io/en/latest/remote_data.html#fred" rel="noopener ugc nofollow" target="_blank"> FRED 数据源</a>中检索数据。首先，我们需要导入<em class="lb"> Pandas </em>、<em class="lb"> datetime </em>和<em class="lb"> Pandas_datareader </em>包。</p><p id="d582" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们可以简单地定义一个日期范围并使用<em class="lb"> web。DataReader </em>方法以 Pandas DataFrame 的形式下载数据，并将其存储在变量名<em class="lb"> SP500 </em>中。</p><p id="a3f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将想要下载的数据集的名称(即 sp500)、数据的提供者或来源(“Fred”)以及开始和结束日期作为参数传递给了<em class="lb"> DataReader </em>方法:</p><pre class="lr ls lt lu gt ne nf ng nh aw ni bi"><span id="e5bc" class="nj mi iq nf b gy nk nl l nm nn">import pandas as pd<br/>#if you get an error after executing the code, try adding below. pd.core.common.is_list_like = pd.api.types.is_list_like</span><span id="dd58" class="nj mi iq nf b gy no nl l nm nn">import pandas_datareader.data as web<br/>import datetime</span><span id="0383" class="nj mi iq nf b gy no nl l nm nn">start = datetime.datetime(2010, 1, 1)<br/>end = datetime.datetime(2020, 1, 27)</span><span id="75fd" class="nj mi iq nf b gy no nl l nm nn">SP500 = web.DataReader(['sp500'], 'fred', start, end)</span></pre><p id="932d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行代码后，我们得到了下面的 Pandas DataFrame，显示了历史 S &amp; P 500 每日价格:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi np"><img src="../Images/841bae633455b52e8e3ee89885c93c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/0*pp1JbdkbtU-OWvlO"/></div></figure><h1 id="3ce7" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">计算标准普尔 500 的每日回报率</h1><p id="5eb3" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">太好了，我们在熊猫数据框架中有过去 10 年的标准普尔 500 指数价格。现在，我们准备计算过去 10 年的<strong class="kh ir"> S &amp; P 500 日收益率</strong>，并将它们作为一个新列添加到我们的数据框架中，我们将称之为<em class="lb"> daily_return </em>。</p><p id="4b72" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了计算回报率，我们可以使用下面的公式，其中<em class="lb"> P1 </em>指的是<em class="lb">当前价格</em>，而<em class="lb"> P0 </em>指的是<em class="lb">初始价格</em>或我们用来计算回报的参考价格。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/2e5c751493169bb41e59d8718d2691a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/0*n6gcOnuCjnefH7LA"/></div><p class="mc md gj gh gi me mf bd b be z dk translated">收益率</p></figure><pre class="lr ls lt lu gt ne nf ng nh aw ni bi"><span id="d585" class="nj mi iq nf b gy nk nl l nm nn">SP500['daily_return'] = (SP500['sp500']/ SP500['sp500'].shift(1)) -1<br/><br/>#Drop all Not a number values using drop method.<br/>SP500.dropna(inplace = True)</span></pre><p id="5421" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="lb"> shift </em> </strong>方法所做的是将我们的索引移动作为参数提供的数字。在我们的例子中，我们将把<em class="lb"> sp500 </em>列中的每个值移动一位。这意味着我们将当天的价格降低到前一天的价格。</p><p id="0b0b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们打印 SP500 数据帧的最后五个值，看看我们得到了什么:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/444b37c80bbb8b528f69de2c78e903e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/0*VkcsL8fTCvXLc40J"/></div><p class="mc md gj gh gi me mf bd b be z dk translated">标准普尔 500 每日回报</p></figure><h1 id="0896" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">策划标准普尔 500 每日回报</h1><p id="0ee1" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">我们有我们的标准普尔 500 价格和回报准备用 Python 绘图。让我们先画出每日回报。</p><p id="ee3d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用 Python 和 Matplotlib 绘图超级简单，我们只需要从我们的 SP500 数据框架中选择<em class="lb"> daily_return </em>列，并使用方法<em class="lb"> plot </em>。</p><pre class="lr ls lt lu gt ne nf ng nh aw ni bi"><span id="8dac" class="nj mi iq nf b gy nk nl l nm nn">SP500['daily_return'].plot(title='S&amp;P 500 daily returns')</span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/47712e6c16dc79cbd18de81efc29c2a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tmt3ufGn2NK1sT3k"/></div></div><p class="mc md gj gh gi me mf bd b be z dk translated">策划 S&amp;P500 每日回报</p></figure><p id="db90" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不错！我们可以很容易地从图表中找出一些非常有用的信息。例如，我们可以看到标准普尔 500 指数最差的日回报率是在 2011 年，日回报率为-7%。</p><p id="1e8a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们可以看到，标准普尔 500 指数最好的一天是在 2019 年年中，日回报率约为 5%。</p><p id="8147" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了每日回报，我们还可以绘制过去 10 年的标准普尔 500 价格演变图。这里我们可以观察到一个明显的上升趋势。</p><pre class="lr ls lt lu gt ne nf ng nh aw ni bi"><span id="ce68" class="nj mi iq nf b gy nk nl l nm nn">SP500['sp500'].plot(title='S&amp;P 500 Price')</span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/8b1e587acdbf00487d9c58b88d48cc03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kJB9TqgRuNBvjnIA"/></div></div><p class="mc md gj gh gi me mf bd b be z dk translated">绘制标准普尔 500 价格</p></figure><h1 id="9e68" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">包扎</h1><p id="0388" class="pw-post-body-paragraph kf kg iq kh b ki mz jr kk kl na ju kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">在这个关于<strong class="kh ir"> Python for Finance </strong>的故事中，我们检索了<strong class="kh ir"> S &amp; P 500 的历史价格</strong>，以便计算和绘制指数的每日回报。</p><p id="063f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">绘制每日市场回报是一个很好的方法来可视化任何特定时期的股票回报。你可以用任何其他股票或指数来尝试。</p><p id="f049" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我真的希望你喜欢这个故事！如果您有任何问题或不清楚的地方，请随时回复。我还有一个 Youtube 视频，一步一步地解释了本教程中使用的代码:</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="ns nt l"/></div><p class="mc md gj gh gi me mf bd b be z dk translated">策划 SP500 每日回报</p></figure></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="b75a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">原载于 2020 年 2 月 8 日</em><a class="ae mg" href="https://codingandfun.com/python-for-finance-calculate-and-plot-sp-500-daily-returns/" rel="noopener ugc nofollow" target="_blank"><em class="lb">【https://codingandfun.com】</em></a><em class="lb">。</em></p></div></div>    
</body>
</html>