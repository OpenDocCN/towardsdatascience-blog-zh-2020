<html>
<head>
<title>Plotting Geographical Data with Geopandas &amp; Geoplot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Geopandas &amp; Geoplot 绘制地理数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/plotting-geographical-data-with-geopandas-338cc7e17e4e?source=collection_archive---------11-----------------------#2020-02-23">https://towardsdatascience.com/plotting-geographical-data-with-geopandas-338cc7e17e4e?source=collection_archive---------11-----------------------#2020-02-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0c1b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用 Geopandas 和 Geoplot 制作美丽的地图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/22da15b94bd251adc46042172d5d4caa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*khwfZP8Zda4jVAgP-KUjAA.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">来源:<a class="ae ku" href="https://www.mapuipatterns.com/choropleth-map/" rel="noopener ugc nofollow" target="_blank">地图 UI 模式</a></p></figure><h1 id="d9bb" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated">背景</h1><p id="9027" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">回到 2019 年 2 月，我一直在一家媒体公司担任研究员。我的工作涉及大量的数据和电子表格来存储和分析。但是对于这样一个快速发展的行业，每天都有数百万行新数据流入，Microsoft Excel 很难完成这项工作。仅仅更新几个电子表格就很容易花费一整个上午的时间，因为在处理大量数据时，Excel 的性能会迅速下降。我想为我的作品学习一些新工具，我在<a class="ae ku" href="https://www.coderschool.vn/en/" rel="noopener ugc nofollow" target="_blank">代码学校</a>找到了一个关于 Python 的数据分析课程。对于像我这样有商业背景的人来说，编码就像火箭科学一样，我认为我不会感兴趣。然而，由于 Excel 经常崩溃，我感到沮丧，我还是试了一下，天哪，真是令人兴奋。从那时起我就开始写代码，现在我在我学习第一行代码的学校教书。</p><p id="fec9" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">我在工作中经常遇到的一个话题就是处理地理数据。在我了解 Python 之前，在地图上绘制数据是一项非常具有挑战性的任务。我们的选择之一是 Tableau 和它的地图功能(来源:<a class="ae ku" href="https://help.tableau.com/current/pro/desktop/en-us/maps_howto_simple.htm" rel="noopener ugc nofollow" target="_blank"> Tableau </a>)。然而，Tableau 的一个局限性是，它只能按越南各省绘制数据，而许多项目要求数据按地区显示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/60fb22d07fdfaa768013c750244a74b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*zuGOZJJKMenc1QgZC5gwsQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">填充多边形选项不适用于越南地区。来源:<a class="ae ku" href="https://community.tableau.com/groups/vietnam/blog/2018/05/08/t%C3%ADnh-n%C4%83ng-m%E1%BB%9Bi-tr%C3%AAn-tableau-2018" rel="noopener ugc nofollow" target="_blank"> Tableau 社区论坛</a></p></figure><p id="4195" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">在这方面，Python 提供了更大的灵活性，在地图上绘图时也提供了更多的定制选项。</p><h1 id="fc0b" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated"><strong class="ak">地质公园&amp;地质公园</strong></h1><p id="7022" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated"><a class="ae ku" href="https://geopandas.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lp iu"> Geopandas </strong> </a>和<a class="ae ku" href="https://residentmario.github.io/geoplot/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lp iu"> Geoplot </strong> </a> <strong class="lp iu"> </strong>是两个允许我们处理和可视化地理数据的 Python 库。<strong class="lp iu"> Geopandas </strong>基于<strong class="lp iu"> pandas </strong>并扩展其特性以允许操作几何数据类型。<strong class="lp iu"> Geoplot </strong>同样建立在<strong class="lp iu"> matplotlib </strong>之上，用于制图绘图。如果你对<strong class="lp iu">熊猫</strong>和<strong class="lp iu"> matplotlib </strong>不熟悉，我建议你从这两篇文章开始:</p><div class="mp mq gp gr mr ms"><a rel="noopener follow" target="_blank" href="/a-quick-introduction-to-the-pandas-python-library-f1b678f34673"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">“熊猫”Python 库快速介绍</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">一些背景</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">towardsdatascience.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng ko ms"/></div></div></a></div><div class="mp mq gp gr mr ms"><a rel="noopener follow" target="_blank" href="/data-visualization-using-matplotlib-16f1aae5ce70"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">使用 Matplotlib 实现数据可视化</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">数据可视化是商业活动的重要组成部分，因为现在的组织收集了大量的数据…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">towardsdatascience.com</p></div></div><div class="nb l"><div class="nh l nd ne nf nb ng ko ms"/></div></div></a></div><p id="2aa7" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">在这个例子中，我将在 Colab 笔记本环境中运行代码。首先，我们需要安装<strong class="lp iu"> Geopandas </strong>和<strong class="lp iu"> Geoplot: </strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">安装 geopandas 和 geoplot</p></figure><p id="746d" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">导入必要的库:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">导入库</p></figure><p id="dad5" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">世界各国的几何数据在互联网上随处可见。它们有许多不同的格式，其中大部分都受 geopandas 的支持。越南各省的几何数据可在<a class="ae ku" href="http://opendata.hcmgis.vn/" rel="noopener ugc nofollow" target="_blank"> HCMGIS OpenData </a>上获得。在这个例子中，我将使用 JSON 格式。<strong class="lp iu"> Geopandas </strong>具有函数<em class="nk"> read_file </em>从源中读取几何数据。这将返回一个包含许多列的 Geopandas 数据帧，但是我们只需要关心名称(地区)、省份和几何列。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nl"><img src="../Images/4c6cea8eb3fa23d15ee3097c16bb938d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QP9xF1zq7gM2PDu8IelEJA.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">越南几何数据</p></figure><p id="8761" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">注意几何栏中的数据:它们是<strong class="lp iu">多多边形</strong>格式，代表世界地图上该地区的形状和位置。</p><p id="6548" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">我们还需要一些数据来绘制在地图上。我准备了一些. csv 文件形式的示例数据。它包含了越南一些地区的数字数据和他们所属的省份。我们可以用<strong class="lp iu">熊猫读文件。</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">阅读示例数据</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/63d621ed6ba4505f946f6bca9c627486.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*nyCh4wLjyRwMqJwoTNHnEg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">这是我们要在地图上说明的数据。</p></figure><p id="c6ac" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">为了在地图上展示我们的示例数据，我们需要将它与几何数据结合起来。这可以通过方法<em class="nk">合并来实现。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">将示例数据与其各自的几何数据相结合</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nr"><img src="../Images/4a9287344a4e534ba98a202d15d43e5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a8MOKk4zp-JPlSV6FegpOg.png"/></div></div></figure><p id="666d" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">我们现在可以用<strong class="lp iu"> geoplot </strong>制作一张地图。在这个例子中，我制作了一个 Choropleth 地图，其中变量数据(色调)的值由多边形的颜色表示。<strong class="lp iu">地质公园</strong>有更多地图类型选项，查看他们的<a class="ae ku" href="https://residentmario.github.io/geoplot/plot_references/plot_reference.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">绘制一张 choropleth 地图</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/a721c72176d47b7900094e645533aaea.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*5D7f8C49DNu7B3-OErf1VA.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">这是我们的结果！</p></figure><p id="7562" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">这张地图看起来不太好，但我们可以添加一些调整来使它变得更好！</p><h1 id="3a41" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated">改进情节</h1><p id="ca7d" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">把越南的所有区都画在一起可能不是一个好主意，因为越南的区太多了。相反，我们可以按地区细分国家。例如，通过对数据框应用过滤器，我可以只选择四个省份进行绘图。</p><p id="c577" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">更改<em class="nk"> figsize </em>参数来配置贴图的大小，更改<em class="nk"> cmap </em>参数来配置用于多边形的调色板。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nt"><img src="../Images/3d1d240f9a007861f18e5f9ee8308171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0-vPrb8xEV2HJb34Ft3d9w.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">现在看起来好多了！</p></figure><p id="98dd" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">我们经常想要做的是给绘图添加一些标签(例如，地区的名称和变量的值)。由于<strong class="lp iu"> geoplot </strong>构建在<strong class="lp iu"> matplotlib </strong>之上，我们可以使用<em class="nk"> plt.text </em>来完成此操作。但是，它需要标签在图上的位置。方法<em class="nk"> centroid </em>返回多边形中心点的 x-y 坐标，这正是我们需要的！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">生成每个多边形的中心点</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nu"><img src="../Images/975c838b9154da1f4a63e7325ecfcae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pGDmC7e1GaOAbAG63YrEUQ.png"/></div></div></figure><p id="13e2" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">现在我们可以用<strong class="lp iu"> matplotlib </strong>给绘图添加一些标签。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">将地区名称及其各自的数据值添加到地图中</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nt"><img src="../Images/eb254e864f4d687a00315816b3ff4cec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E7b-gpSvJpE-5oD0S5q5Jg.png"/></div></div></figure><p id="2ab7" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">注意到右下角那些杂乱的文本簇了吗？就是因为胡志明市的区太小，彼此标签太靠近。一个解决办法是从地图上去掉胡志明市的行政区划。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">排除胡志明市的区域标签</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nt"><img src="../Images/16b11b014fc33c48d736bd2636385175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7DijjEJXXx0U-MdqjXkDzw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">我们的最终结果！</p></figure><p id="7ede" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">geopandas 的另一个非常有用的特性是将多个多边形组合成更大的块。例如，当您希望按省份而不是按地区显示数据时，这尤其有用。<strong class="lp iu"> geopandas </strong>具有 dissolve()函数，可以将地区数据行聚合到相应的省份中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">使用 Sum 函数将地区聚合为省份</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/ecd9c5a25fdab0efc9b7e27f1cda7a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*L5uhRbIBsKf5NKsTU_0PuA.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">聚集数据框架</p></figure><p id="1fa3" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">各省现在都在数据框的索引中，所以绘制标签的代码需要做一些小的修改。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">我们需要再次生成 x-y 坐标</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nt"><img src="../Images/6a0670c37791237a246c0982ce21c193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5MdOvdLJcukD4MoiC_y4Q.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">这些地区现在被分成几个省</p></figure><h1 id="4c11" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated">结论</h1><p id="ea16" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">Geopandas 和<strong class="lp iu"> Geoplot </strong>是两个非常有用的可视化地理数据的 Python 库。他们需要更多的努力，但也允许对情节有更多的控制。</p></div></div>    
</body>
</html>