<html>
<head>
<title>EfficientNet: Scaling of Convolutional Neural Networks done right</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">EfficientNet:卷积神经网络的扩展做得很好</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/efficientnet-scaling-of-convolutional-neural-networks-done-right-3fde32aef8ff?source=collection_archive---------6-----------------------#2020-06-16">https://towardsdatascience.com/efficientnet-scaling-of-convolutional-neural-networks-done-right-3fde32aef8ff?source=collection_archive---------6-----------------------#2020-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1f68" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何智能缩放 CNN 以实现精度增益</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8793864b942849450e4245d0f2faa704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z7bj-ah-j19UuNXG"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@lidyanada?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Lidya Nada </a>拍摄的照片</p></figure><p id="62ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自从 Alex net 赢得 2012 年 ImageNet 挑战赛以来，卷积神经网络在计算机视觉领域变得无处不在。他们甚至发现了它们在自然语言处理中的应用，其中最先进的模型使用卷积运算来保留上下文并提供更好的预测。然而，与所有其他神经网络一样，设计 CNN 的关键问题之一是模型缩放，即决定如何增加模型大小以提供更好的准确性。</p><p id="c80c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个繁琐的过程，需要手动反复试验，直到产生满足资源约束的足够精确的模型。该过程耗费资源和时间，并且经常产生具有次优精度和效率的模型。</p><p id="6957" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到这个问题，谷歌在 2019 年发布了一篇论文，涉及一个新的 CNN 家族，即 EfficientNet。与 GPipe 等先进模型相比，这些 CNN 不仅提供了更好的精度，还通过减少参数和 FLOPS(每秒浮点运算)流形提高了模型的效率。本文的主要贡献是:</p><ul class=""><li id="9f90" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">设计一个简单的手机大小的基线架构:<strong class="lb iu"> EfficientNet-B0 </strong></li><li id="72d9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">提供一种有效的<strong class="lb iu">复合缩放</strong>方法来增加模型大小，以实现最大的精度增益。</li></ul><h1 id="d63a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"><strong class="ak"> EfficientNet-B0 架构</strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/2045ab58b88eacefce9fa79dff113e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*97Nv71OSEdJah3miRDBJrg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表 1。基线网络的架构细节</p></figure><p id="db27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">复合缩放方法可以推广到现有的 CNN 架构，例如移动网络和 ResNet。然而，选择一个良好的基线网络对于实现最佳结果至关重要，因为复合比例方法仅<strong class="lb iu">通过复制基础网络的底层卷积运算和网络结构来增强</strong>网络的预测能力。</p><p id="8417" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，作者利用神经架构搜索构建了一个高效的网络架构，<strong class="lb iu"> EfficientNet-B0 </strong>。仅用<strong class="lb iu"> 5.3M </strong>参数和<strong class="lb iu"> 0.39B </strong> FLOPS 就在 ImageNet 上实现了<strong class="lb iu"> 77.3%的准确率</strong>。(Resnet-50 提供 76%的精度，参数为 26M，触发器为 4.1B)。</p><p id="2da1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该网络的主要构建模块由 MBConv 组成，并添加了压缩和激励优化功能。MBConv 类似于 MobileNet v2 中使用的反向残差块。这些在卷积块的开始和结束之间形成快捷连接。首先使用 1x1 卷积来扩展输入激活图，以增加特征图的深度。随后是 3×3 深度方向卷积和点方向卷积，减少了输出特征图中的通道数量。捷径连接连接较窄的层，而较宽的层存在于跳跃连接之间。这种结构有助于减少所需操作的总数以及模型大小。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/58f50d384d5e6ebfc62fdf3101163410.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*jFCQv8hphvYJ25t-4uQQTg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图一。反向剩余块</p></figure><p id="d64a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该块的代码可以推测为:</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="ba99" class="ni mk it ne b gy nj nk l nl nm">from keras.layers import Conv2D, DepthwiseConv2D, Add<br/>def inverted_residual_block(x, expand=64, squeeze=16):<br/>    block = Conv2D(expand, (1,1), activation=’relu’)(x)<br/>    block = DepthwiseConv2D((3,3), activation=’relu’)(block)<br/>    block = Conv2D(squeeze, (1,1), activation=’relu’)(block)<br/>    return Add()([block, x])</span></pre><h1 id="8f97" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">复合缩放</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/476c8f6e28cb05341893f914f57cfc9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lGcFaOK6lW5hHskGyINPgw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图二。模型缩放。(a)是一个基线网络示例；(b)-(d)是仅增加网络宽度、深度或分辨率的一个维度的传统缩放。(e)是我们提出的复合缩放方法，它以固定的比例统一缩放所有三个维度。</p></figure><p id="dadc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">卷积神经网络可以在三个维度上扩展:<em class="no">深度、宽度、分辨率</em>。网络的<strong class="lb iu">深度</strong>对应于网络的层数。<strong class="lb iu">宽度</strong>与层中神经元的数量相关，或者更确切地说，与卷积层中滤波器的数量相关。<strong class="lb iu">分辨率</strong>就是输入图像的高度和宽度。上面的图 2 更清晰地展示了这三个方面的扩展。</p><p id="e05b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过堆叠更多的卷积层来增加深度，允许网络学习更复杂的特征。然而，更深层次的网络往往会受到梯度消失的影响，变得难以训练。虽然诸如批量标准化和跳过连接的新技术在解决这个问题上是有效的，但是经验研究表明，仅通过增加网络的深度而获得的实际精度会很快饱和。例如，Resnet-1000 提供了与 Resnet-100 相同的精度，尽管有额外的层。</p><p id="c7a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">缩放网络的宽度允许层学习更精细的特征。这一概念已在众多作品中广泛使用，如广域网络和移动网络。然而，与增加深度的情况一样，增加宽度会阻止网络学习复杂的特征，从而导致精度增益下降。</p><p id="8da2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更高的输入分辨率提供了关于图像的更多细节，因此增强了模型推理更小对象和提取更精细模式的能力。但是像其他缩放维度一样，这本身也提供了有限的精度增益。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/66c3c44047bb1ec0f2919bb83d487c97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HL7IUF3PBOVsC84EVAXvUg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 3。用不同的网络宽度(w)、深度(d)和分辨率(r)系数放大基线模型。</p></figure><p id="fb25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这导致了一个重要的观察结果:</p><p id="6294" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">观察 1 <em class="no"> : </em> </strong> <em class="no">按比例增加网络宽度、深度或分辨率的任何维度都会提高精度，但是对于更大的模型，精度增益会减小。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/30f6eafa761a0c880aceffdb90e984b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*f8bHkxSfPwgxUtCC5waXLg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 4。为不同的基线网络调整网络宽度。</p></figure><p id="969c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着，为提高精确度而进行的网络缩放应该部分地由这三个维度的组合来贡献。图 4<em class="no">中的经验证据证实了这一点，在图 4</em>中，对于不同的深度和分辨率设置，网络的精度以增加的宽度进行建模。</p><p id="d82a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果表明，仅缩放一维(宽度)会使精度增益迅速停滞。然而，将此与层数(深度)或输入分辨率的增加相结合，可以增强模型的预测能力。</p><p id="2256" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些观察多少有些意料之中，可以用直觉来解释。例如，如果输入图像的空间分辨率增加，卷积层的数量也应该增加，使得感受野足够大以跨越现在包含更多像素的整个图像。这导致了第二个观察结果:</p><p id="2b99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">观察 2: </strong> <em class="no">为了追求更高的精度和效率，在 ConvNet 扩展期间平衡网络宽度、深度和分辨率的所有维度至关重要。</em></p><h2 id="d157" class="ni mk it bd ml nr ns dn mp nt nu dp mt li nv nw mv lm nx ny mx lq nz oa mz ob bi translated"><strong class="ak">建议的缩放方法</strong></h2><p id="5e94" class="pw-post-body-paragraph kz la it lb b lc oc ju le lf od jx lh li oe lk ll lm of lo lp lq og ls lt lu im bi translated">卷积神经网络可以被认为是各种卷积层的堆叠或组合。此外，这些层可以被划分成不同的级，例如 ResNet 具有五个级，并且每个级中的所有层具有相同的卷积类型。因此，CNN 在数学上可以表示为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/75a72947fb7021128e3bb6a38ceacfb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*MpUnjGjHY04RlHqUriA-tw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等式 1</p></figure><p id="b441" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中 n 表示网络，I 表示级数，F ᵢ表示第 I 级的卷积运算，L ᵢ表示 F ᵢ在级 I 中重复的次数。H ᵢ、W ᵢ和 C ᵢ简单地表示级 I 的输入张量形状</p><p id="7772" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从等式 1 可以推导出，L ᵢ控制网络的深度，C ᵢ负责网络的宽度，而 H ᵢ和 W ᵢ影响输入分辨率。找到一组好的系数来缩放每一层的这些维度是不可能的，因为搜索空间是巨大的。因此，为了限制搜索空间，作者制定了一套基本规则。</p><ul class=""><li id="fdbf" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">比例模型中的所有层/级将使用与基线网络相同的卷积运算</li><li id="cbb9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">所有层必须以恒定的比例均匀缩放</li></ul><p id="0cd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建立这些规则后，等式 1 可以参数化为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/da1ed00edc2f2631603c835a9ee012f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*zAJT0Mr-6Q86hZ82V3DnBQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等式 2</p></figure><p id="e269" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中 w、d、r 是用于缩放网络宽度、深度和分辨率的系数；F̂ ᵢ、L̂ ᵢ、ĥᵢ、ŵᵢ、ĉᵢ是基线网络中预定义的参数。</p><p id="ff55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作者提出了一种简单但有效的缩放技术，该技术使用<strong class="lb iu">复合系数ɸ </strong>以原则方式统一缩放网络宽度、深度和分辨率:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/399e320e5cda2ab0ace8aa7702b40b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*ROPqmZGUtbGpZhBD1UHDJg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等式 3</p></figure><p id="0e37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ɸ是一个用户定义的全局比例因子(整数)，它控制有多少资源可用，而<strong class="lb iu"> α </strong>、<strong class="lb iu"> β </strong>和<strong class="lb iu"> γ </strong>决定如何将这些资源分别分配给网络深度、宽度和分辨率。卷积运算的 FLOPS 与<strong class="lb iu"> <em class="no"> d，w，r，</em> </strong>成比例，因为<strong class="lb iu"> <em class="no"> </em> </strong>深度加倍会使 FLOPS 加倍，而宽度或分辨率加倍会使 FLOPS 增加几乎四倍。因此，使用等式 3 缩放网络将使总 FLOPS 增加(α * β * γ ) ^ɸ。因此，为了确保总 flops 不超过 2^ϕ，应用约束(α * β * γ ) ≈ 2。这意味着，如果我们有两倍的可用资源，我们可以简单地使用复合系数 1 将 FLOPS 缩放 2 倍。</p><p id="b51a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参数- <strong class="lb iu"> α </strong>、<strong class="lb iu"> β </strong>和<strong class="lb iu"> γ- </strong>可通过设置<strong class="lb iu"> ɸ=1 </strong>并找到产生最佳精度的参数，使用网格搜索来确定。一旦找到，这些参数可以固定，复合系数<strong class="lb iu"> ɸ </strong>可以增加，以获得更大但更精确的模型。这就是 EfficientNet-B1 到 EfficientNet-B7 的构造方式，名称末尾的整数表示复合系数的值。</p><h2 id="7a5e" class="ni mk it bd ml nr ns dn mp nt nu dp mt li nv nw mv lm nx ny mx lq nz oa mz ob bi translated">结果</h2><p id="c327" class="pw-post-body-paragraph kz la it lb b lc oc ju le lf od jx lh li oe lk ll lm of lo lp lq og ls lt lu im bi translated">这种技术使作者能够生产出比现有的 ConvNets 精度更高的模型，同时也极大地减少了总体 FLOPS 和模型尺寸。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/faca7ccbb2805e13ec16e2e3e9229a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u_BKCyVCx69sYBxtZoXYaw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表二。针对 ImageNet 挑战，比较 EfficientNet 与现有网络</p></figure><p id="3e85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种缩放方法是通用的，可以与其他架构一起使用，以有效地缩放卷积神经网络，并提供更好的精度。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/3fb3abed66f5dd420a3b08a7b31d22f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*FXdptqgO_VHSlOS1SgCF6Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表 3。向上扩展 MobileNets 和 ResNet。</p></figure><h1 id="ea5f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">参考资料:</h1><ul class=""><li id="ceee" class="lv lw it lb b lc oc lf od li om lm on lq oo lu ma mb mc md bi translated"><a class="ae ky" href="http://Rethinking Model Scaling for Convolutional Neural Networks" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">高效网</strong> </a> <strong class="lb iu">，</strong> ICML 2019</li><li id="06db" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://arxiv.org/abs/arXiv:1801.04381" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">MobileNet v2</strong></a><strong class="lb iu">，</strong> CVPR <strong class="lb iu"> </strong> 2018</li><li id="bbaf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="http://papers.nips.cc/paper/8305-gpipe-efficient-training-of-giant-neural-networks-using-pipeline-parallelism" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">GPipe</strong></a><strong class="lb iu"/>NIPS 2019</li><li id="7118" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">官方发布的代码:<a class="ae ky" href="https://github.com/tensorflow/tpu/tree/master/models/official/efficientnet" rel="noopener ugc nofollow" target="_blank">https://github . com/tensor flow/TPU/tree/master/models/official/efficient net</a></li></ul></div></div>    
</body>
</html>