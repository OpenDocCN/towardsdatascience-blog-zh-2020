<html>
<head>
<title>Creating Variable Factor Map (PCA) Plot with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 创建可变因子图(PCA)图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/principal-components-analysis-plot-for-python-311013a33cd9?source=collection_archive---------15-----------------------#2020-07-30">https://towardsdatascience.com/principal-components-analysis-plot-for-python-311013a33cd9?source=collection_archive---------15-----------------------#2020-07-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b057" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在本教程中，我将向你展示如何一步一步地使用 matplotlib 创建可变因子图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/91ec69a865f1ebda7f203a670f85b977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hckR4920RoABauOmKDudLA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="e899" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">一.导言</h1><p id="30c0" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">分析中最有趣的活动之一是使用漂亮的可视化工具。有了<strong class="ls iu">变量因子图</strong>，就可以轻松解释<strong class="ls iu">主成分</strong> <strong class="ls iu">分析</strong>。一张图胜过千言万语</p><p id="fa5d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">主成分分析(PCA)是一种降维方法，用于降低大型数据集的维数。它将多个要素转换为数量少得多的新要素，同时保留原始数据的大部分信息和可变性。</p><p id="c4aa" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">如果特征的数量是 2，我们可以将它们放入 2D 图中，并想象不同的特征如何影响每个新的组成部分。上图中，来自<strong class="ls iu">虹膜数据集</strong>的<strong class="ls iu">四个特征</strong>(萼片宽度、萼片长度、花瓣宽度、花瓣长度)被压缩成<strong class="ls iu">两个</strong>。它们是<strong class="ls iu">组件 1 </strong> (y 轴)和<strong class="ls iu">组件 2 </strong> (x 轴)，保持了原始数据集 97.77%的信息。四个向量表示这两个分量如何解释四个原始特征。</p><h1 id="f502" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">二。编码</h1><p id="41a5" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">代码是使用 Python 和<code class="fe mr ms mt mu b">matplotlib</code>的最少知识创建的。我相信简单是所有真正优雅的基调。创建这个情节有三个重要步骤</p><ul class=""><li id="bf2f" class="mv mw it ls b lt mm lw mn lz mx md my mh mz ml na nb nc nd bi translated">数据准备</li><li id="b6a3" class="mv mw it ls b lt ne lw nf lz ng md nh mh ni ml na nb nc nd bi translated">PCA 分解</li><li id="f517" class="mv mw it ls b lt ne lw nf lz ng md nh mh ni ml na nb nc nd bi translated">情节</li></ul><h2 id="b011" class="nj kz it bd la nk nl dn le nm nn dp li lz no np lk md nq nr lm mh ns nt lo nu bi translated">1)数据准备</h2><p id="c51f" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我们首先从<code class="fe mr ms mt mu b">sklearn</code>导入虹膜数据集</p><pre class="kj kk kl km gt nv mu nw nx aw ny bi"><span id="2300" class="nj kz it mu b gy nz oa l ob oc">from sklearn import datasets<br/>import pandas as pd<br/>iris = datasets.load_iris()</span><span id="9df0" class="nj kz it mu b gy od oa l ob oc">X=pd.DataFrame(data=iris.data,columns=iris.feature_names)<br/>X</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/9d107f6b68f1d8d0a6fc9f8ba857582b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DbXDYWR_R4TWCl7EjMqVOg.png"/></div></div></figure><p id="9338" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">iris 数据集有 4 个特征，我们希望将这 4 个部分转换为之前讨论过的 2 个部分。</p><h2 id="436e" class="nj kz it bd la nk nl dn le nm nn dp li lz no np lk md nq nr lm mh ns nt lo nu bi translated">2) PCA 分解</h2><p id="524c" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated"><code class="fe mr ms mt mu b">scikit-learn</code>包使得 PCA 方法变得非常方便，我们需要做的就是从<code class="fe mr ms mt mu b">sklearn</code>分解库中导入 PCA。</p><pre class="kj kk kl km gt nv mu nw nx aw ny bi"><span id="cad1" class="nj kz it mu b gy nz oa l ob oc">from sklearn.decomposition import PCA</span><span id="2dc6" class="nj kz it mu b gy od oa l ob oc">columns=X.columns.values #Store the name of the columns for labeling<br/>pca=PCA(n_components=2)<br/>pca.fit(X)<br/>pca_values=pca.components_<br/>pca.components_</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/121d07123c1b4cfb5b3238c724bba23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GTDxmP3NcqCOMkq2wnJyGQ.png"/></div></div></figure><p id="9acf" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我们定义<code class="fe mr ms mt mu b">n_component=2</code>，用<code class="fe mr ms mt mu b">fit</code>的方法训练模型，存储 PCA <code class="fe mr ms mt mu b">components_</code>。这些<code class="fe mr ms mt mu b">components_</code>代表特征空间中的主轴。这里的两个数组表示 4 个特征的(x，y)坐标。稍后我们将在单位圆上用 4 个向量来画出这些点，这就是有趣的地方。</p><h1 id="f08c" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">3)情节</h1><h2 id="332f" class="nj kz it bd la nk nl dn le nm nn dp li lz no np lk md nq nr lm mh ns nt lo nu bi translated">a)圆圈</h2><p id="9c94" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">让我们首先调整字体和大小的阴谋</p><pre class="kj kk kl km gt nv mu nw nx aw ny bi"><span id="04e7" class="nj kz it mu b gy nz oa l ob oc">import matplotlib.pyplot as plt<br/> <br/>plt.figure(figsize=(10,10))<br/>plt.rcParams.update({'font.size': 14})</span></pre><p id="3a09" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">下一步是画一个圆。我们将使用圆形函数</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/62e63a26d464873e41506c6a899fafe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/1*AMz5JfrTeN-sbDRyBOj7iQ.png"/></div></figure><pre class="kj kk kl km gt nv mu nw nx aw ny bi"><span id="bd76" class="nj kz it mu b gy nz oa l ob oc">#Plot circle</span><span id="f8ec" class="nj kz it mu b gy od oa l ob oc">#Create a list of 500 points with equal spacing between -1 and 1</span><span id="ab3f" class="nj kz it mu b gy od oa l ob oc">import numpy as np<br/>x=np.linspace(start=-1,stop=1,num=500)</span><span id="45df" class="nj kz it mu b gy od oa l ob oc">#Find y1 and y2 for these points<br/>y_positive=lambda x: np.sqrt(1-x**2) <br/>y_negative=lambda x: -np.sqrt(1-x**2)<br/>plt.plot(x,list(map(y_positive, x)), color='maroon')<br/>plt.plot(x,list(map(y_negative, x)),color='maroon')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/409f65324ee870efc0f2c302fe56d2ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LD7oMo_fgMqNprQ8gSc6WQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d197" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">如果你不知道<a class="ae oi" href="https://www.w3schools.com/python/python_lambda.asp" rel="noopener ugc nofollow" target="_blank">λ</a>或<a class="ae oi" href="https://www.w3schools.com/python/ref_func_map.asp" rel="noopener ugc nofollow" target="_blank"> map </a>函数，你应该把这些有用的方法放进你的工具箱</p><p id="28a6" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我们将用同样的逻辑画一个更小的圆，只是为了更美观</p><pre class="kj kk kl km gt nv mu nw nx aw ny bi"><span id="9802" class="nj kz it mu b gy nz oa l ob oc">#Plot smaller circle<br/>x=np.linspace(start=-0.5,stop=0.5,num=500)<br/>y_positive=lambda x: np.sqrt(0.5**2-x**2) <br/>y_negative=lambda x: -np.sqrt(0.5**2-x**2)<br/>plt.plot(x,list(map(y_positive, x)), color='maroon')<br/>plt.plot(x,list(map(y_negative, x)),color='maroon')</span></pre><p id="27e0" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">让我们也添加 x 轴和 y 轴，这也是完全可选的！</p><pre class="kj kk kl km gt nv mu nw nx aw ny bi"><span id="7e9b" class="nj kz it mu b gy nz oa l ob oc">#Create broken lines<br/>x=np.linspace(start=-1,stop=1,num=30)<br/>plt.scatter(x,[0]*len(x), marker='_',color='maroon')<br/>plt.scatter([0]*len(x), x, marker='|',color='maroon')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/16eb4b9f2c59f710ce5f425c4866f1fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p6yuiKznm9ULsCOKoS00hg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4e26" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">如果你完成了这一步，你就完成了一半。给自己一个鼓励！</p><h2 id="0875" class="nj kz it bd la nk nl dn le nm nn dp li lz no np lk md nq nr lm mh ns nt lo nu bi translated">b)矢量</h2><p id="224b" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在绘制矢量之前，让我们定义将要使用的颜色。下面的代码为相应的特征定义了 6 种不同的颜色，如果特征多于 6 个，颜色列表将重复其循环。</p><pre class="kj kk kl km gt nv mu nw nx aw ny bi"><span id="beed" class="nj kz it mu b gy nz oa l ob oc">#Define color list<br/>colors = ['blue', 'red', 'green', 'black', 'purple', 'brown']<br/>if len(pca_values[0]) &gt; 6:<br/>    colors=colors*(int(len(pca_values[0])/6)+1)</span></pre><p id="2b4b" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">现在让我们画出向量并标记它们</p><pre class="kj kk kl km gt nv mu nw nx aw ny bi"><span id="6cab" class="nj kz it mu b gy nz oa l ob oc">add_string=""<br/>for i in range(len(pca_values[0])):<br/>    xi=pca_values[0][i]<br/>    yi=pca_values[1][i]<br/>    plt.arrow(0,0, <br/>              dx=xi, dy=yi, <br/>              head_width=0.03, head_length=0.03, <br/>              color=colors[i], length_includes_head=True)</span><span id="5f32" class="nj kz it mu b gy od oa l ob oc">    add_string=f" ({round(xi,2)} {round(yi,2)})"<br/>    plt.text(pca_values[0, i], <br/>             pca_values[1, i] , <br/>             s=columns[i] + add_string )</span></pre><p id="61af" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">函数<code class="fe mr ms mt mu b">plt.arrow</code>取向量的起点和终点。这里，初始点是原点(0，0)，端点是先前从 PCA 分量方法获得的。</p><p id="e289" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">最后，我们为剧情添加一些其他的化妆品。</p><pre class="kj kk kl km gt nv mu nw nx aw ny bi"><span id="40f8" class="nj kz it mu b gy nz oa l ob oc">plt.xlabel(f"Component 1 ({round(pca.explained_variance_ratio_[0]*100,2)}%)")<br/>plt.ylabel(f"Component 2 ({round(pca.explained_variance_ratio_[1]*100,2)}%)")<br/>plt.title('Variable factor map (PCA)')<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/0fc42c9520e74597b6f4c7d73b28a7dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yO8yI6k_hTORFGO1cumuEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="c789" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">三.结论</h1><p id="7bd8" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">您也可以通过执行以下操作来导入上述代码</p><pre class="kj kk kl km gt nv mu nw nx aw ny bi"><span id="bb97" class="nj kz it mu b gy nz oa l ob oc">pip install -i <a class="ae oi" href="https://test.pypi.org/simple/" rel="noopener ugc nofollow" target="_blank">https://test.pypi.org/simple/</a> variable-factor-map-Huy-Bui==0.0.3</span><span id="4038" class="nj kz it mu b gy od oa l ob oc">from variable_factor_map import pca_map <br/>from sklearn import datasets<br/>import pandas as pd</span><span id="a8ca" class="nj kz it mu b gy od oa l ob oc">iris = datasets.load_iris()<br/>X=pd.DataFrame(data=iris.data,columns=iris.feature_names)</span><span id="8c92" class="nj kz it mu b gy od oa l ob oc">pca_map(X, figsize=(10,10), sup="Iris", print_values= False)</span></pre><p id="fd49" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated"><code class="fe mr ms mt mu b">pca_map</code>功能有 4 个输入:</p><ul class=""><li id="7176" class="mv mw it ls b lt mm lw mn lz mx md my mh mz ml na nb nc nd bi translated"><strong class="ls iu"> X </strong>:熊猫数据框</li><li id="71b5" class="mv mw it ls b lt ne lw nf lz ng md nh mh ni ml na nb nc nd bi translated"><strong class="ls iu"> figsize </strong> (float，float):输出的宽度和高度。默认值为(10，10)</li><li id="b33a" class="mv mw it ls b lt ne lw nf lz ng md nh mh ni ml na nb nc nd bi translated"><strong class="ls iu"> sup </strong>(字符串):剧情标题。默认值为空字符串</li><li id="57fc" class="mv mw it ls b lt ne lw nf lz ng md nh mh ni ml na nb nc nd bi translated"><strong class="ls iu">打印值</strong>(布尔):显示矢量值。默认值为 False</li></ul><p id="5949" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">也可以访问我的<a class="ae oi" href="https://github.com/williamhuybui/PCA_Variable_Factor_Map" rel="noopener ugc nofollow" target="_blank"> GitHub </a>看源代码。玩 Python 玩得开心！</p></div></div>    
</body>
</html>