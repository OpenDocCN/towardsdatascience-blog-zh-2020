<html>
<head>
<title>A Single Line of Python Code Scraping Dataset from Webpages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从网页中抓取数据集的一行Python代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-single-line-of-python-code-scraping-dataset-from-webpages-c9d2a8805d61?source=collection_archive---------10-----------------------#2020-05-31">https://towardsdatascience.com/a-single-line-of-python-code-scraping-dataset-from-webpages-c9d2a8805d61?source=collection_archive---------10-----------------------#2020-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/77f959c66dd092c05b807e27f3097ff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-7yilUR1C2qQc0Re"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">马库斯·斯皮斯克在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="756e" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">使用Python从网页和下载中搜寻API端点</h2></div><p id="c49a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">无论我们拥有什么水平的数据科学/分析技能，没有数据集你什么都做不了。</p><p id="f0a6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">的确，有许多开源数据集，如Kaggle和Data.world。然而，它们更适合用于练习和学习目的，但可能无法满足我们的一般需求。</p><p id="7a50" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通常，数据科学家/分析师可能有或多或少的网络搜集技能，所以无论何时你在网站上看到数据集，都更容易获得。从网站上抓取内容后，一系列的转换、提取和清洗操作将帮助我们为下一步获取干净的数据集。这是Python的典型用法之一，因为Python中有很多优秀的web抓取库可用，比如Scrapy和Beautiful Soup。</p><p id="5944" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，学习这些网络抓取库并不容易。此外，对于那些没有web开发背景的人来说，这可能不是数据科学家/分析师的常见技能，理解和确定HTML DOM和XPath等概念可能会更加困难。</p><p id="a8ee" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，在本文中，我将介绍一种更简单的从网站下载数据集的方法。你会发现你甚至可以用熊猫来做所有的工作！</p><h1 id="47e5" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">新冠肺炎新病例数据集</h1><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mm"><img src="../Images/69d8da3329e90cc9326c15b531ef3050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*49dTKtWUDgaOS0dW"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@martinsanchez?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马丁·桑切斯</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="b918" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一个例子是新冠肺炎新案例数据集。原来有许多公开的数据来源，如政府网站将公布这一点。然而，我只是想以此为例，因为我发现这是一个非常好的典型例子。</p><p id="a32f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">今天，当我从“时代”(澳大利亚的一个受欢迎的媒体)网站扫描新闻时，我发现有一个条形图显示澳大利亚每天新增的确诊病例(见下面的截图)。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mr"><img src="../Images/bc349c89898539752c6bb3ef41419101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ArtwyZlRAOO4K4sVNs4QCw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">截图来自网站:<a class="ae jg" href="https://www.theage.com.au/" rel="noopener ugc nofollow" target="_blank">https://www.theage.com.au/</a></p></figure><p id="a207" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我想得到他们的数据呢？让我们找到它的API端点！</p><h2 id="6d26" class="ms lv jj bd lw mt mu dn ma mv mw dp me lh mx my mg ll mz na mi lp nb nc mk nd bi translated">搜寻API端点</h2><p id="1f29" class="pw-post-body-paragraph ky kz jj la b lb ne kk ld le nf kn lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">现在大多数流行的web浏览器都提供了它们的开发人员控制台。我们将使用控制台来完成这项工作。以下是从浏览器调用控制台的一些快捷方式:</p><ul class=""><li id="0ed5" class="nj nk jj la b lb lc le lf lh nl ll nm lp nn lt no np nq nr bi translated">谷歌浏览器:Ctrl + Shift + I</li><li id="b3a4" class="nj nk jj la b lb ns le nt lh nu ll nv lp nw lt no np nq nr bi translated">火狐:Ctrl + Shift + K</li><li id="3137" class="nj nk jj la b lb ns le nt lh nu ll nv lp nw lt no np nq nr bi translated">微软Edge: F12</li></ul><p id="4029" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里我将使用谷歌浏览器进行演示。但是不用担心，大多数浏览器都有非常相似的开发者控制台。相信你一定能搞清楚特色在哪里。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/9ba98078057863eccec109f0257f457d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*ztd2FrDkoBBSu_slI23IrA.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">谷歌Chrome开发者控制台截图</p></figure><p id="9fb4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">控制台出现后，转到“网络”选项卡。我们正在寻找一个API端点，所以如果它可用的话，它将被捕获为一个“XHR”请求。因此，让我们选择XHR滤波器。</p><blockquote class="ny nz oa"><p id="1221" class="ky kz ob la b lb lc kk ld le lf kn lg oc li lj lk od lm ln lo oe lq lr ls lt im bi translated">XMLHttpRequest  ( <strong class="la jk"> XHR </strong>)是一个对象形式的API，其方法在网络浏览器和网络服务器之间传输数据。该对象由浏览器的JavaScript环境提供。特别是，从XHR检索数据以不断修改加载的网页是Ajax设计的基本概念。不管名字如何，XHR可以用于除HTTP之外的协议，数据不仅可以是XML的形式，也可以是JSON、HTML或纯文本的形式。[1]</p></blockquote><p id="79da" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有时，网页可能会有一些JavaScripts在后台运行，以完成一些预定的任务，浏览器会捕捉到它们。如果您想要一个更清晰的捕获请求列表，最好的方法是</p><ul class=""><li id="990e" class="nj nk jj la b lb lc le lf lh nl ll nm lp nn lt no np nq nr bi translated">确保“录制”按钮已启用</li><li id="4dca" class="nj nk jj la b lb ns le nt lh nu ll nv lp nw lt no np nq nr bi translated">刷新网页</li><li id="bab8" class="nj nk jj la b lb ns le nt lh nu ll nv lp nw lt no np nq nr bi translated">当您看到与数据相关的内容已经完全呈现在网页上时，请停止“记录”</li></ul><p id="52a2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，您将在开发人员控制台中看到一个请求列表。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div class="gh gi of"><img src="../Images/22cc4def243c18baa7a7aa0e6c5861eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*WZth8Nk1XvKLQAkcoqRdHg.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">谷歌Chrome开发者控制台截图</p></figure><p id="3578" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好的。这个很明显。我们可以看到，有人请求将其名称命名为“新冠肺炎-新-案例-JSON . JSON……”。一定是这样！</p><p id="896b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">转到“Headers”选项卡，您将看到该请求的详细信息。最重要的是网址。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi og"><img src="../Images/fc9e82d1477eff74809ece7ac7f9189c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*FyaxBW-gyUxb-WUEoOHyHw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">谷歌Chrome开发者控制台截图</p></figure><p id="1dbc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们将URL作为另一个浏览器选项卡打开，看看会发生什么。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/de8032723fabe1479d66b633e6566d8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UQvkMO7jgPl912ASHOeIDQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">截图来自谷歌Chrome</p></figure><p id="341a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">酷！这是我们正在寻找的API端点。</p><h2 id="9953" class="ms lv jj bd lw mt mu dn ma mv mw dp me lh mx my mg ll mz na mi lp nb nc mk nd bi translated">使用Pandas读取API端点</h2><p id="919f" class="pw-post-body-paragraph ky kz jj la b lb ne kk ld le nf kn lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">怎么消费？极其容易！</p><p id="a903" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我相信如果你是数据科学家或数据分析师，你一定会使用Pandas Dataframe。只需一行Python代码，您就可以将所有内容直接放入Pandas Dataframe。</p><pre class="mn mo mp mq gt oi oj ok ol aw om bi"><span id="894a" class="ms lv jj oj b gy on oo l op oq">df = pd.read_json('<a class="ae jg" href="https://www.theage.com.au/interactive/2020/coronavirus/data-feeder/covid-19-new-cases-json.json?v=3'" rel="noopener ugc nofollow" target="_blank">https://www.theage.com.au/interactive/2020/coronavirus/data-feeder/covid-19-new-cases-json.json?v=3'</a>)</span></pre><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi or"><img src="../Images/3a2d54dd34eac26a36121c98bc50b4a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m7zAkybg8V1iFx4xIwTXcw.png"/></div></div></figure><h1 id="395a" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">宜家家具清单</h1><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi os"><img src="../Images/6f134c8d0b5a1987faddd9dcb724f5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lJGh2_kW7jBk0gVf"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@snowshade?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">奥列格·拉普捷夫</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="8b60" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并不是所有的网站都在使用REST API端点，所以我不会说这是一种通用的方法。然而，你会发现有相当多的网站在使用它。让我们再举一个例子，宜家网站。</p><p id="eaf7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设你想从宜家获得所有的床和产品细节，以便进行分析。下面是我的浏览器从URL(<a class="ae jg" href="https://www.ikea.com/au/en/cat/beds-bm003/" rel="noopener ugc nofollow" target="_blank">https://www.ikea.com/au/en/cat/beds-bm003/</a>)捕捉到的请求。</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/2013db625f820fbf6569de489d6d499c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*DuEWdDLC2WjgwlM6DqWgVQ.png"/></div></figure><p id="0654" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个更有趣。请注意，它说“产品计数”是220，但“产品窗口”只给出其中的24个。如果你注意一下这个页面，就会发现只有24种产品会列在这个页面上，如果你想继续浏览更多，还会提供一个“加载更多”按钮。嗯，这在Web开发中很常见，以节省带宽和服务器资源。</p><p id="8dc5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但这意味着我们必须放弃吗？绝对不是。让我们来看看请求URL:</p><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/ee7f7d5bb66af2b592e87ec6c47855de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*jio7on2-zBsD_TXq904hiw.png"/></div></figure><p id="c531" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你见过有一种属性叫“大小”吗？它正好等于24，这是页面大小。让我们尝试将它改为<code class="fe ov ow ox oj b">size=220</code>，并使用Python内置库<code class="fe ov ow ox oj b">requests</code>发送请求。</p><pre class="mn mo mp mq gt oi oj ok ol aw om bi"><span id="b41b" class="ms lv jj oj b gy on oo l op oq">import requests</span><span id="3380" class="ms lv jj oj b gy oy oo l op oq">json = requests.get(<br/>    '<a class="ae jg" href="https://sik.search.blue.cdtapps.com/au/en/product-list-page?category=bm003&amp;sort=RELEVANCE&amp;size=220&amp;c=plp&amp;v=20200430'" rel="noopener ugc nofollow" target="_blank">https://sik.search.blue.cdtapps.com/au/en/product-list-page?category=bm003&amp;sort=RELEVANCE&amp;size=220&amp;c=plp&amp;v=20200430'</a><br/>).json()['productListPage']['productWindow']</span></pre><p id="1fc0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这次我们不能直接使用Pandas的原因是产品列表不在JSON对象的根级别。相反，它在<code class="fe ov ow ox oj b">root.productListPage.productWindow</code>。</p><p id="16e6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">之后，请求会将JSON对象转换为Python字典，因此我们现在可以使用Pandas来读取它。</p><pre class="mn mo mp mq gt oi oj ok ol aw om bi"><span id="c3e7" class="ms lv jj oj b gy on oo l op oq">df = pd.DataFrame.from_dict(json)</span></pre><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oz"><img src="../Images/18106b02893b17691d8d0c681ec468c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*odPVhFoC0dJemKs7Bj6Jgw.png"/></div></div></figure><h1 id="2774" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">摘要</h1><figure class="mn mo mp mq gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pa"><img src="../Images/6666607ea150fd5446817272f30fd5cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4HmaNI46NwE_qdiI"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@aaronburden?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Aaron Burden </a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="a7bb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那不是又快又容易吗？不用学那些网页抓取库。但是，当然，这种方法不会对所有的网站都有效，这就是为什么网络抓取库仍然是必要的。然而，当网站上有可用的API端点时，为什么不直接找到它并直接使用它呢？</p><div class="is it gp gr iu pb"><a href="https://medium.com/@qiuyujx/membership" rel="noopener follow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd jk gy z fp pg fr fs ph fu fw ji bi translated">通过我的推荐链接加入Medium克里斯托弗·陶</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">medium.com</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp ja pb"/></div></div></a></div><p id="7d6b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你觉得我的文章有帮助，请考虑加入Medium会员来支持我和成千上万的其他作者！(点击上面的链接)</p><h1 id="ee38" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">参考</h1><p id="cc38" class="pw-post-body-paragraph ky kz jj la b lb ne kk ld le nf kn lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">[1]维基百科。XMLHttpRequest。<a class="ae jg" href="https://en.wikipedia.org/wiki/XMLHttpRequest" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/XMLHttpRequest</a></p></div></div>    
</body>
</html>