<html>
<head>
<title>COVID-19 confirmed cases — an interactive web app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新冠肺炎确诊病例——一个交互式网络应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/covid-19-confirmed-cases-an-interactive-web-app-d5d6de3c0ad3?source=collection_archive---------53-----------------------#2020-08-04">https://towardsdatascience.com/covid-19-confirmed-cases-an-interactive-web-app-d5d6de3c0ad3?source=collection_archive---------53-----------------------#2020-08-04</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="467f" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">我如何使用 Dash 来制作我想看的图表</h2></div><p id="d053" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">关于新冠肺炎峰值和浪涌的新闻遍布互联网，数据也很容易获得。<a class="ae lc" href="https://www.cdc.gov/covid-data-tracker/#cases" rel="noopener ugc nofollow" target="_blank"> CDC </a>、<a class="ae lc" href="https://usafacts.org/visualizations/coronavirus-covid-19-spread-map/" rel="noopener ugc nofollow" target="_blank"> USAFacts </a>、<a class="ae lc" href="https://www.worldometers.info/coronavirus/country/us/" rel="noopener ugc nofollow" target="_blank"> Worldometer </a>等都有很棒的数据可视化，但有时它们没有你想要的东西。我想看到每个州的新冠肺炎案例的折线图，所以我自己用<a class="ae lc" href="https://dash.plotly.com/introduction" rel="noopener ugc nofollow" target="_blank">破折号</a>做了这个图。在本文中，我将介绍构建和部署 Dash 应用程序的过程，您可以在这里查看我的应用程序<a class="ae lc" href="https://bystate-covid-app.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="le lf lg lh gu li gi gj paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gi gj ld"><img src="../Images/90da94c78ab6aa38a2fe9f63b6ad76ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*SVMH4LUh1xg8Tu5imYvPzA.gif"/></div></div><p class="lp lq gk gi gj lr ls bd b be z dk translated">选择各个州将其数据添加到图表中</p></figure><h1 id="59be" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">破折号</h1><p id="7eb0" class="pw-post-body-paragraph kg kh ir ki b kj ml js kl km mm jv ko kp mn kr ks kt mo kv kw kx mp kz la lb ik bi translated">Dash 是一个易于使用的 web 应用程序框架。它允许您用 Python 编写简单的程序，生成漂亮的交互式数据可视化。Dash 应用程序有两个主要部分:1)应用程序布局和 2)回调。首先，让我们弄些样板文件出来。</p><figure class="le lf lg lh gu li"><div class="bz fq l di"><div class="mq mr l"/></div></figure><p id="fa55" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">我的应用程序的<code class="fe ms mt mu mv b">#Data prep code here</code>如下所示。数据可以在<a class="ae lc" href="https://usafacts.org/visualizations/coronavirus-covid-19-spread-map/" rel="noopener ugc nofollow" target="_blank">这里</a>下载，数据被读入，一些列被删除。数据框架包含县级确诊的新冠肺炎病例，因此<code class="fe ms mt mu mv b">by_state.groupby</code>代码将这些数据整合到州计数中。最后，状态 ID 存储在一个列表中，供以后使用。还有几个样式设置用来改变按钮的颜色，稍后会详细介绍。</p><figure class="le lf lg lh gu li"><div class="bz fq l di"><div class="mq mr l"/></div></figure><h2 id="dfdc" class="mw lu ir bd lv mx my dn lz mz na dp md kp nb nc mf kt nd ne mh kx nf ng mj nh bi translated">布局</h2><p id="d8be" class="pw-post-body-paragraph kg kh ir ki b kj ml js kl km mm jv ko kp mn kr ks kt mo kv kw kx mp kz la lb ik bi translated">这是你添加应用程序所有不同部分的地方。使用<code class="fe ms mt mu mv b">dash_html_components</code>，您可以添加 HTML 组件，如标题、段落和 div。使用<code class="fe ms mt mu mv b">dash_core_components</code>，您可以添加下拉菜单、按钮、图表等。请务必查看<a class="ae lc" href="https://dash.plotly.com/dash-html-components" rel="noopener ugc nofollow" target="_blank"> html </a>和<a class="ae lc" href="https://dash.plotly.com/dash-core-components" rel="noopener ugc nofollow" target="_blank">核心</a>组件的文档，这样您就可以准确地添加您需要的内容。对于我的应用程序，三个最重要的交互式组件是用于选择州的清单、用于选择所有州的按钮和用于选择日期范围的日期选择器。您可以在下面看到应用程序布局的代码。</p><figure class="le lf lg lh gu li"><div class="bz fq l di"><div class="mq mr l"/></div></figure><p id="7d9b" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><code class="fe ms mt mu mv b">dcc.Checklist</code>组件允许用户选择他们想在图表中看到的州。它的 ID 是<code class="fe ms mt mu mv b">state-select</code>。<code class="fe ms mt mu mv b">options</code>来自上述的状态 ID 列表，而<code class="fe ms mt mu mv b">value=['NY','TX'</code>是初始值。<code class="fe ms mt mu mv b">labelStyle</code>将复选框和相关的状态 ID 放在一起，否则当浏览器窗口被调整时，它们会被分开。<code class="fe ms mt mu mv b">html.Button</code>有显示文本、ID、点击次数和样式变量。<code class="fe ms mt mu mv b">dcc.DatePickerRange</code>允许用户选择他们想要查看的日期。它有最小和最大允许日期以及初始开始和结束日期。初始可见月份决定了当您更改范围时显示的日历月份。</p><figure class="le lf lg lh gu li gi gj paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gi gj ld"><img src="../Images/6c77ba2daac6026688376b85ca2ba393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5PAUphLeKQwAs03APTOvng.gif"/></div></div><p class="lp lq gk gi gj lr ls bd b be z dk translated">使用交互式日历选择日期范围</p></figure><p id="bada" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">图表非常简单；它是用<code class="fe ms mt mu mv b">dcc.Graph</code>组件声明的。它的 ID 是<code class="fe ms mt mu mv b">'lines'</code>并且<code class="fe ms mt mu mv b">config=</code>部分删除了一个模式栏。</p><h2 id="aebc" class="mw lu ir bd lv mx my dn lz mz na dp md kp nb nc mf kt nd ne mh kx nf ng mj nh bi translated">复试</h2><p id="a9ee" class="pw-post-body-paragraph kg kh ir ki b kj ml js kl km mm jv ko kp mn kr ks kt mo kv kw kx mp kz la lb ik bi translated">Dash 应用程序的第二部分包含回调函数。这是赋予应用程序交互性的部分。它有一个简单的格式:有一个 decorator 后跟一个函数。应用程序的输入和输出在<code class="fe ms mt mu mv b">@app.callback</code>装饰器之后声明。每个输入和输出都遵循格式<code class="fe ms mt mu mv b">(component-id,component-property)</code>，其中 id 和属性引用回应用程序布局代码。</p><p id="d73e" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">输出和输入都是列表。我的应用程序中有四个输入，每个都来自布局中描述的一个交互组件。这些输入然后被传递给<code class="fe ms mt mu mv b">update_graph</code>回调函数。来自<code class="fe ms mt mu mv b">state-select</code>输入的<code class="fe ms mt mu mv b">value </code>被传入<code class="fe ms mt mu mv b">grpnames</code>，来自<code class="fe ms mt mu mv b">button</code>的<code class="fe ms mt mu mv b">n_clicks</code>被传入<code class="fe ms mt mu mv b">clicks</code>，以此类推。对于我的应用程序，有两个输出都是从<code class="fe ms mt mu mv b">update_graph</code>回调函数返回的。<code class="fe ms mt mu mv b">Output('lines','figure')</code>将绘图发送给<code class="fe ms mt mu mv b">dcc.Graph</code>组件，而<code class="fe ms mt mu mv b">Output('button','style')</code>组件将样式发送给<code class="fe ms mt mu mv b">html.Button</code>组件。</p><figure class="le lf lg lh gu li"><div class="bz fq l di"><div class="mq mr l"/></div></figure><p id="720d" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><code class="fe ms mt mu mv b">update_graph</code>功能有几个步骤。首先，按钮的点击次数用于确定是否选择了“所有状态”。如果数量是奇数，则<code class="fe ms mt mu mv b">style</code>变量被设置为<code class="fe ms mt mu mv b">bl</code>。接下来，来自<code class="fe ms mt mu mv b">dcc.DatePickerRange</code>的日期被重新格式化，以符合下载的数据。</p><figure class="le lf lg lh gu li gi gj paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gi gj ld"><img src="../Images/3c0f7b47fdf26bbad6fd5d62f568ca45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8rW9n_14usfIpL5YXyijRw.gif"/></div></div><p class="lp lq gk gi gj lr ls bd b be z dk translated">单击“所有状态”按钮以可视化每个状态的数据</p></figure><p id="e533" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><code class="fe ms mt mu mv b">plot the data</code>段创建数据帧的副本，并使用 melt 功能将其从宽格式转换为窄格式。这使得绘图变得容易，你可以在这里了解更多关于这种转换的信息。if/else 代码确定是否选择了“所有状态”,并相应地返回数据的子集。最后，数据被剔除，以包含使用<code class="fe ms mt mu mv b">dcc.DataPickerRange</code>选择的相关日期。</p><p id="c1b9" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">Plotly.express 用于绘制数据，x 轴为日期，y 轴为确诊病例数，并按州进行着色。注意<code class="fe ms mt mu mv b">x='variable'</code>和<code class="fe ms mt mu mv b">y='value'</code>是指 melt 函数生成的列名。<code class="fe ms mt mu mv b">Plot</code>和<code class="fe ms mt mu mv b">style</code>从回调中返回，并发送到布局组件，如输出语句中所声明的。</p><h2 id="bf1f" class="mw lu ir bd lv mx my dn lz mz na dp md kp nb nc mf kt nd ne mh kx nf ng mj nh bi translated">与 Heroku 一起部署</h2><p id="5749" class="pw-post-body-paragraph kg kh ir ki b kj ml js kl km mm jv ko kp mn kr ks kt mo kv kw kx mp kz la lb ik bi translated"><a class="ae lc" href="https://devcenter.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>是一个云平台，你可以在这里部署各种网络应用。它有很好的文档，易于使用，并支持 python 应用程序。要部署 Dash 应用程序，您可以遵循这里的简单说明<a class="ae lc" href="https://dash.plotly.com/deployment" rel="noopener ugc nofollow" target="_blank"/>。下面是我使用<a class="ae lc" href="https://ubuntu.com/wsl" rel="noopener ugc nofollow" target="_blank"> WSL </a>在 Windows 中运行 Ubuntu 终端来部署我的应用程序的步骤。</p><pre class="le lf lg lh gu ni mv nj nk aw nl bi"><span id="6608" class="mw lu ir mv b gz nm nn l no np">#Step 1<br/>mkdir covid_app<br/>cd covid_app</span></pre><p id="da57" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">现在，您已经创建了自己的目录并将其刻录到 cd 中，您需要设置一个虚拟环境并安装必要的库。</p><pre class="le lf lg lh gu ni mv nj nk aw nl bi"><span id="4c14" class="mw lu ir mv b gz nm nn l no np">#Step 2<br/>git init<br/>virtualenv venv<br/>source venv/bin/activate<br/>pip install dash<br/>pip install plotly<br/>pip install gunicorn</span></pre><p id="7c28" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">您的目录中至少需要四个文件:1) app.py，2)。gitignore，3) Procfile，4) requirements.txt. app.py 就是你的 Dash app，里面包含了上面描述的代码。的。gitignore 文件应该如下所示:</p><pre class="le lf lg lh gu ni mv nj nk aw nl bi"><span id="e4ac" class="mw lu ir mv b gz nm nn l no np">venv<br/>*.pyc<br/>.DS_Store<br/>.env</span></pre><p id="034e" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">Procfile 没有文件扩展名<strong class="ki is">并且包含一行简单的代码:</strong></p><pre class="le lf lg lh gu ni mv nj nk aw nl bi"><span id="75f0" class="mw lu ir mv b gz nm nn l no np">web: gunicorn app:server</span></pre><p id="e822" class="pw-post-body-paragraph kg kh ir ki b kj kk js kl km kn jv ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">可以用这个命令生成 requirements . txt:<code class="fe ms mt mu mv b">pip freeze &gt; requirements.txt</code>。现在，您可以使用 heroku 部署您的应用程序，如下所示:</p><pre class="le lf lg lh gu ni mv nj nk aw nl bi"><span id="920c" class="mw lu ir mv b gz nm nn l no np">heroku create my-dash-app<br/>git add .<br/>git commit -m 'Initial commit'<br/>git push heroku master <br/>heroku ps:scale web=1</span></pre><h2 id="31cd" class="mw lu ir bd lv mx my dn lz mz na dp md kp nb nc mf kt nd ne mh kx nf ng mj nh bi translated">零碎东西</h2><p id="6c55" class="pw-post-body-paragraph kg kh ir ki b kj ml js kl km mm jv ko kp mn kr ks kt mo kv kw kx mp kz la lb ik bi translated">你可以在这里查看上述<a class="ae lc" href="https://bystate-covid-app.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">的 app。这是一个简单的交互式图表，它实现了我很想看到的可视化。我可能会扩展该项目，以包含其他可视化，并将尝试写下我所做的任何补充。也就是说，当你开始自己的 Dash 应用程序项目时，你可能需要注意一些其他的主题。其中之一是<code class="fe ms mt mu mv b">assets</code>目录。如果您在应用程序目录中创建了其中的一个，您可以包含 css 和 JavaScript 文件来为您的应用程序设计样式和添加功能。你可以在这里</a>了解更多关于那个<a class="ae lc" href="https://dash.plotly.com/external-resources" rel="noopener ugc nofollow" target="_blank">的信息。甚至还有专门为生物信息学设计的 Dash Bio 套件。我目前正在攻读生物信息学博士学位，所以我一定会探索这个功能，并在未来的文章中写出来。</a></p></div></div>    
</body>
</html>